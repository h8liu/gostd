<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2884346">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2884401">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2884455">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2884506">package</span>&nbsp;<span class="ident" id="2884514">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2884519">import</span>&nbsp;<span class="op" id="2884526">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2884529">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2884538">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2884557">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2884567">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2884575">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2884589">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2884595">&#34;os&#34;</span><br>
<span class="lineno">15</span><span class="op" id="2884600">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2884603">var</span>&nbsp;<span class="op" id="2884607">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884610">ErrFormat</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2884623">=</span>&nbsp;<span class="ident" id="2884625">errors</span><span class="op" id="2884631">.</span><span class="ident" id="2884632">New</span><span class="op" id="2884635">(</span><span class="string" id="2884636">&#34;zip:&nbsp;not&nbsp;a&nbsp;valid&nbsp;zip&nbsp;file&#34;</span><span class="op" id="2884663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884666">ErrAlgorithm</span>&nbsp;<span class="op" id="2884679">=</span>&nbsp;<span class="ident" id="2884681">errors</span><span class="op" id="2884687">.</span><span class="ident" id="2884688">New</span><span class="op" id="2884691">(</span><span class="string" id="2884692">&#34;zip:&nbsp;unsupported&nbsp;compression&nbsp;algorithm&#34;</span><span class="op" id="2884732">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884735">ErrChecksum</span>&nbsp;&nbsp;<span class="op" id="2884748">=</span>&nbsp;<span class="ident" id="2884750">errors</span><span class="op" id="2884756">.</span><span class="ident" id="2884757">New</span><span class="op" id="2884760">(</span><span class="string" id="2884761">&#34;zip:&nbsp;checksum&nbsp;error&#34;</span><span class="op" id="2884782">)</span><br>
<span class="lineno"></span><span class="op" id="2884784">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2884787">type</span>&nbsp;<span class="ident" id="2884792">Reader</span>&nbsp;<span class="keyword" id="2884799">struct</span>&nbsp;<span class="op" id="2884806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884809">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2884817">io</span><span class="op" id="2884819">.</span><span class="ident" id="2884820">ReaderAt</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884830">File</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2884838">[</span><span class="op" id="2884839">]</span><span class="op" id="2884840">*</span><span class="ident" id="2884841">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884847">Comment</span>&nbsp;<span class="builtintype" id="2884855">string</span><br>
<span class="lineno"></span><span class="op" id="2884862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2884865">type</span>&nbsp;<span class="ident" id="2884870">ReadCloser</span>&nbsp;<span class="keyword" id="2884881">struct</span>&nbsp;<span class="op" id="2884888">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884891">f</span>&nbsp;<span class="op" id="2884893">*</span><span class="ident" id="2884894">os</span><span class="op" id="2884896">.</span><span class="ident" id="2884897">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884903">Reader</span><br>
<span class="lineno"></span><span class="op" id="2884910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2884913">type</span>&nbsp;<span class="ident" id="2884918">File</span>&nbsp;<span class="keyword" id="2884923">struct</span>&nbsp;<span class="op" id="2884930">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884933">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884945">zipr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2884958">io</span><span class="op" id="2884960">.</span><span class="ident" id="2884961">ReaderAt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884971">zipsize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2884984">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2884991">headerOffset</span>&nbsp;<span class="ident" id="2885004">int64</span><br>
<span class="lineno"></span><span class="op" id="2885010">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2885013">func</span>&nbsp;<span class="op" id="2885018">(</span><span class="ident" id="2885019">f</span>&nbsp;<span class="op" id="2885021">*</span><span class="ident" id="2885022">File</span><span class="op" id="2885026">)</span>&nbsp;<span class="ident" id="2885028">hasDataDescriptor</span><span class="op" id="2885045">(</span><span class="op" id="2885046">)</span>&nbsp;<span class="builtintype" id="2885048">bool</span>&nbsp;<span class="op" id="2885053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885056">return</span>&nbsp;<span class="ident" id="2885063">f</span><span class="op" id="2885064">.</span><span class="ident" id="2885065">Flags</span><span class="op" id="2885070">&amp;</span><span class="num" id="2885071">0x8</span>&nbsp;<span class="op" id="2885075">!=</span>&nbsp;<span class="num" id="2885078">0</span><br>
<span class="lineno"></span><span class="op" id="2885080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="2885083">//&nbsp;OpenReader&nbsp;will&nbsp;open&nbsp;the&nbsp;Zip&nbsp;file&nbsp;specified&nbsp;by&nbsp;name&nbsp;and&nbsp;return&nbsp;a&nbsp;ReadCloser.</span><br>
<span class="lineno"></span><span class="keyword" id="2885163">func</span>&nbsp;<span class="ident" id="2885168">OpenReader</span><span class="op" id="2885178">(</span><span class="ident" id="2885179">name</span>&nbsp;<span class="builtintype" id="2885184">string</span><span class="op" id="2885190">)</span>&nbsp;<span class="op" id="2885192">(</span><span class="op" id="2885193">*</span><span class="ident" id="2885194">ReadCloser</span><span class="op" id="2885204">,</span>&nbsp;<span class="builtintype" id="2885206">error</span><span class="op" id="2885211">)</span>&nbsp;<span class="op" id="2885213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885216">f</span><span class="op" id="2885217">,</span>&nbsp;<span class="ident" id="2885219">err</span>&nbsp;<span class="op" id="2885223">:=</span>&nbsp;<span class="ident" id="2885226">os</span><span class="op" id="2885228">.</span><span class="ident" id="2885229">Open</span><span class="op" id="2885233">(</span><span class="ident" id="2885234">name</span><span class="op" id="2885238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885241">if</span>&nbsp;<span class="ident" id="2885244">err</span>&nbsp;<span class="op" id="2885248">!=</span>&nbsp;<span class="ident" id="2885251">nil</span>&nbsp;<span class="op" id="2885255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885259">return</span>&nbsp;<span class="ident" id="2885266">nil</span><span class="op" id="2885269">,</span>&nbsp;<span class="ident" id="2885271">err</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2885276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885279">fi</span><span class="op" id="2885281">,</span>&nbsp;<span class="ident" id="2885283">err</span>&nbsp;<span class="op" id="2885287">:=</span>&nbsp;<span class="ident" id="2885290">f</span><span class="op" id="2885291">.</span><span class="ident" id="2885292">Stat</span><span class="op" id="2885296">(</span><span class="op" id="2885297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885300">if</span>&nbsp;<span class="ident" id="2885303">err</span>&nbsp;<span class="op" id="2885307">!=</span>&nbsp;<span class="ident" id="2885310">nil</span>&nbsp;<span class="op" id="2885314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885318">f</span><span class="op" id="2885319">.</span><span class="ident" id="2885320">Close</span><span class="op" id="2885325">(</span><span class="op" id="2885326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885330">return</span>&nbsp;<span class="ident" id="2885337">nil</span><span class="op" id="2885340">,</span>&nbsp;<span class="ident" id="2885342">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2885347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885350">r</span>&nbsp;<span class="op" id="2885352">:=</span>&nbsp;<span class="builtinfunc" id="2885355">new</span><span class="op" id="2885358">(</span><span class="ident" id="2885359">ReadCloser</span><span class="op" id="2885369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885372">if</span>&nbsp;<span class="ident" id="2885375">err</span>&nbsp;<span class="op" id="2885379">:=</span>&nbsp;<span class="ident" id="2885382">r</span><span class="op" id="2885383">.</span><span class="ident" id="2885384">init</span><span class="op" id="2885388">(</span><span class="ident" id="2885389">f</span><span class="op" id="2885390">,</span>&nbsp;<span class="ident" id="2885392">fi</span><span class="op" id="2885394">.</span><span class="ident" id="2885395">Size</span><span class="op" id="2885399">(</span><span class="op" id="2885400">)</span><span class="op" id="2885401">)</span><span class="op" id="2885402">;</span>&nbsp;<span class="ident" id="2885404">err</span>&nbsp;<span class="op" id="2885408">!=</span>&nbsp;<span class="ident" id="2885411">nil</span>&nbsp;<span class="op" id="2885415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885419">f</span><span class="op" id="2885420">.</span><span class="ident" id="2885421">Close</span><span class="op" id="2885426">(</span><span class="op" id="2885427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885431">return</span>&nbsp;<span class="ident" id="2885438">nil</span><span class="op" id="2885441">,</span>&nbsp;<span class="ident" id="2885443">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2885448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885451">r</span><span class="op" id="2885452">.</span><span class="ident" id="2885453">f</span>&nbsp;<span class="op" id="2885455">=</span>&nbsp;<span class="ident" id="2885457">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885460">return</span>&nbsp;<span class="ident" id="2885467">r</span><span class="op" id="2885468">,</span>&nbsp;<span class="ident" id="2885470">nil</span><br>
<span class="lineno"></span><span class="op" id="2885474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="2885477">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r,&nbsp;which&nbsp;is&nbsp;assumed&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2885547">//&nbsp;have&nbsp;the&nbsp;given&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="2885580">func</span>&nbsp;<span class="ident" id="2885585">NewReader</span><span class="op" id="2885594">(</span><span class="ident" id="2885595">r</span>&nbsp;<span class="ident" id="2885597">io</span><span class="op" id="2885599">.</span><span class="ident" id="2885600">ReaderAt</span><span class="op" id="2885608">,</span>&nbsp;<span class="ident" id="2885610">size</span>&nbsp;<span class="ident" id="2885615">int64</span><span class="op" id="2885620">)</span>&nbsp;<span class="op" id="2885622">(</span><span class="op" id="2885623">*</span><span class="ident" id="2885624">Reader</span><span class="op" id="2885630">,</span>&nbsp;<span class="builtintype" id="2885632">error</span><span class="op" id="2885637">)</span>&nbsp;<span class="op" id="2885639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885642">zr</span>&nbsp;<span class="op" id="2885645">:=</span>&nbsp;<span class="builtinfunc" id="2885648">new</span><span class="op" id="2885651">(</span><span class="ident" id="2885652">Reader</span><span class="op" id="2885658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885661">if</span>&nbsp;<span class="ident" id="2885664">err</span>&nbsp;<span class="op" id="2885668">:=</span>&nbsp;<span class="ident" id="2885671">zr</span><span class="op" id="2885673">.</span><span class="ident" id="2885674">init</span><span class="op" id="2885678">(</span><span class="ident" id="2885679">r</span><span class="op" id="2885680">,</span>&nbsp;<span class="ident" id="2885682">size</span><span class="op" id="2885686">)</span><span class="op" id="2885687">;</span>&nbsp;<span class="ident" id="2885689">err</span>&nbsp;<span class="op" id="2885693">!=</span>&nbsp;<span class="ident" id="2885696">nil</span>&nbsp;<span class="op" id="2885700">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885704">return</span>&nbsp;<span class="ident" id="2885711">nil</span><span class="op" id="2885714">,</span>&nbsp;<span class="ident" id="2885716">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2885721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885724">return</span>&nbsp;<span class="ident" id="2885731">zr</span><span class="op" id="2885733">,</span>&nbsp;<span class="ident" id="2885735">nil</span><br>
<span class="lineno"></span><span class="op" id="2885739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="2885742">func</span>&nbsp;<span class="op" id="2885747">(</span><span class="ident" id="2885748">z</span>&nbsp;<span class="op" id="2885750">*</span><span class="ident" id="2885751">Reader</span><span class="op" id="2885757">)</span>&nbsp;<span class="ident" id="2885759">init</span><span class="op" id="2885763">(</span><span class="ident" id="2885764">r</span>&nbsp;<span class="ident" id="2885766">io</span><span class="op" id="2885768">.</span><span class="ident" id="2885769">ReaderAt</span><span class="op" id="2885777">,</span>&nbsp;<span class="ident" id="2885779">size</span>&nbsp;<span class="ident" id="2885784">int64</span><span class="op" id="2885789">)</span>&nbsp;<span class="builtintype" id="2885791">error</span>&nbsp;<span class="op" id="2885797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885800">end</span><span class="op" id="2885803">,</span>&nbsp;<span class="ident" id="2885805">err</span>&nbsp;<span class="op" id="2885809">:=</span>&nbsp;<span class="ident" id="2885812">readDirectoryEnd</span><span class="op" id="2885828">(</span><span class="ident" id="2885829">r</span><span class="op" id="2885830">,</span>&nbsp;<span class="ident" id="2885832">size</span><span class="op" id="2885836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885839">if</span>&nbsp;<span class="ident" id="2885842">err</span>&nbsp;<span class="op" id="2885846">!=</span>&nbsp;<span class="ident" id="2885849">nil</span>&nbsp;<span class="op" id="2885853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885857">return</span>&nbsp;<span class="ident" id="2885864">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2885869">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885872">z</span><span class="op" id="2885873">.</span><span class="ident" id="2885874">r</span>&nbsp;<span class="op" id="2885876">=</span>&nbsp;<span class="ident" id="2885878">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885881">z</span><span class="op" id="2885882">.</span><span class="ident" id="2885883">File</span>&nbsp;<span class="op" id="2885888">=</span>&nbsp;<span class="builtinfunc" id="2885890">make</span><span class="op" id="2885894">(</span><span class="op" id="2885895">[</span><span class="op" id="2885896">]</span><span class="op" id="2885897">*</span><span class="ident" id="2885898">File</span><span class="op" id="2885902">,</span>&nbsp;<span class="num" id="2885904">0</span><span class="op" id="2885905">,</span>&nbsp;<span class="ident" id="2885907">end</span><span class="op" id="2885910">.</span><span class="ident" id="2885911">directoryRecords</span><span class="op" id="2885927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885930">z</span><span class="op" id="2885931">.</span><span class="ident" id="2885932">Comment</span>&nbsp;<span class="op" id="2885940">=</span>&nbsp;<span class="ident" id="2885942">end</span><span class="op" id="2885945">.</span><span class="ident" id="2885946">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885955">rs</span>&nbsp;<span class="op" id="2885958">:=</span>&nbsp;<span class="ident" id="2885961">io</span><span class="op" id="2885963">.</span><span class="ident" id="2885964">NewSectionReader</span><span class="op" id="2885980">(</span><span class="ident" id="2885981">r</span><span class="op" id="2885982">,</span>&nbsp;<span class="num" id="2885984">0</span><span class="op" id="2885985">,</span>&nbsp;<span class="ident" id="2885987">size</span><span class="op" id="2885991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2885994">if</span>&nbsp;<span class="ident" id="2885997">_</span><span class="op" id="2885998">,</span>&nbsp;<span class="ident" id="2886000">err</span>&nbsp;<span class="op" id="2886004">=</span>&nbsp;<span class="ident" id="2886006">rs</span><span class="op" id="2886008">.</span><span class="ident" id="2886009">Seek</span><span class="op" id="2886013">(</span><span class="ident" id="2886014">int64</span><span class="op" id="2886019">(</span><span class="ident" id="2886020">end</span><span class="op" id="2886023">.</span><span class="ident" id="2886024">directoryOffset</span><span class="op" id="2886039">)</span><span class="op" id="2886040">,</span>&nbsp;<span class="ident" id="2886042">os</span><span class="op" id="2886044">.</span><span class="ident" id="2886045">SEEK_SET</span><span class="op" id="2886053">)</span><span class="op" id="2886054">;</span>&nbsp;<span class="ident" id="2886056">err</span>&nbsp;<span class="op" id="2886060">!=</span>&nbsp;<span class="ident" id="2886063">nil</span>&nbsp;<span class="op" id="2886067">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886071">return</span>&nbsp;<span class="ident" id="2886078">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2886083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886086">buf</span>&nbsp;<span class="op" id="2886090">:=</span>&nbsp;<span class="ident" id="2886093">bufio</span><span class="op" id="2886098">.</span><span class="ident" id="2886099">NewReader</span><span class="op" id="2886108">(</span><span class="ident" id="2886109">rs</span><span class="op" id="2886111">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2886115">//&nbsp;The&nbsp;count&nbsp;of&nbsp;files&nbsp;inside&nbsp;a&nbsp;zip&nbsp;is&nbsp;truncated&nbsp;to&nbsp;fit&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2886184">//&nbsp;Gloss&nbsp;over&nbsp;this&nbsp;by&nbsp;reading&nbsp;headers&nbsp;until&nbsp;we&nbsp;encounter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2886242">//&nbsp;a&nbsp;bad&nbsp;one,&nbsp;and&nbsp;then&nbsp;only&nbsp;report&nbsp;a&nbsp;ErrFormat&nbsp;or&nbsp;UnexpectedEOF&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2886310">//&nbsp;the&nbsp;file&nbsp;count&nbsp;modulo&nbsp;65536&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886356">for</span>&nbsp;<span class="op" id="2886360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886364">f</span>&nbsp;<span class="op" id="2886366">:=</span>&nbsp;<span class="op" id="2886369">&amp;</span><span class="ident" id="2886370">File</span><span class="op" id="2886374">{</span><span class="ident" id="2886375">zipr</span><span class="op" id="2886379">:</span>&nbsp;<span class="ident" id="2886381">r</span><span class="op" id="2886382">,</span>&nbsp;<span class="ident" id="2886384">zipsize</span><span class="op" id="2886391">:</span>&nbsp;<span class="ident" id="2886393">size</span><span class="op" id="2886397">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886401">err</span>&nbsp;<span class="op" id="2886405">=</span>&nbsp;<span class="ident" id="2886407">readDirectoryHeader</span><span class="op" id="2886426">(</span><span class="ident" id="2886427">f</span><span class="op" id="2886428">,</span>&nbsp;<span class="ident" id="2886430">buf</span><span class="op" id="2886433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886437">if</span>&nbsp;<span class="ident" id="2886440">err</span>&nbsp;<span class="op" id="2886444">==</span>&nbsp;<span class="ident" id="2886447">ErrFormat</span>&nbsp;<span class="op" id="2886457">||</span>&nbsp;<span class="ident" id="2886460">err</span>&nbsp;<span class="op" id="2886464">==</span>&nbsp;<span class="ident" id="2886467">io</span><span class="op" id="2886469">.</span><span class="ident" id="2886470">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="2886487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886492">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2886500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886504">if</span>&nbsp;<span class="ident" id="2886507">err</span>&nbsp;<span class="op" id="2886511">!=</span>&nbsp;<span class="ident" id="2886514">nil</span>&nbsp;<span class="op" id="2886518">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886523">return</span>&nbsp;<span class="ident" id="2886530">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2886536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886540">z</span><span class="op" id="2886541">.</span><span class="ident" id="2886542">File</span>&nbsp;<span class="op" id="2886547">=</span>&nbsp;<span class="builtinfunc" id="2886549">append</span><span class="op" id="2886555">(</span><span class="ident" id="2886556">z</span><span class="op" id="2886557">.</span><span class="ident" id="2886558">File</span><span class="op" id="2886562">,</span>&nbsp;<span class="ident" id="2886564">f</span><span class="op" id="2886565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2886568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886571">if</span>&nbsp;<span class="builtintype" id="2886574">uint16</span><span class="op" id="2886580">(</span><span class="builtinfunc" id="2886581">len</span><span class="op" id="2886584">(</span><span class="ident" id="2886585">z</span><span class="op" id="2886586">.</span><span class="ident" id="2886587">File</span><span class="op" id="2886591">)</span><span class="op" id="2886592">)</span>&nbsp;<span class="op" id="2886594">!=</span>&nbsp;<span class="builtintype" id="2886597">uint16</span><span class="op" id="2886603">(</span><span class="ident" id="2886604">end</span><span class="op" id="2886607">.</span><span class="ident" id="2886608">directoryRecords</span><span class="op" id="2886624">)</span>&nbsp;<span class="op" id="2886626">{</span>&nbsp;<span class="comment" id="2886628">//&nbsp;only&nbsp;compare&nbsp;16&nbsp;bits&nbsp;here</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2886659">//&nbsp;Return&nbsp;the&nbsp;readDirectoryHeader&nbsp;error&nbsp;if&nbsp;we&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2886712">//&nbsp;the&nbsp;wrong&nbsp;number&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886756">return</span>&nbsp;<span class="ident" id="2886763">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2886768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886771">return</span>&nbsp;<span class="ident" id="2886778">nil</span><br>
<span class="lineno">110</span><span class="op" id="2886782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2886785">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Zip&nbsp;file,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="2886846">func</span>&nbsp;<span class="op" id="2886851">(</span><span class="ident" id="2886852">rc</span>&nbsp;<span class="op" id="2886855">*</span><span class="ident" id="2886856">ReadCloser</span><span class="op" id="2886866">)</span>&nbsp;<span class="ident" id="2886868">Close</span><span class="op" id="2886873">(</span><span class="op" id="2886874">)</span>&nbsp;<span class="builtintype" id="2886876">error</span>&nbsp;<span class="op" id="2886882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886885">return</span>&nbsp;<span class="ident" id="2886892">rc</span><span class="op" id="2886894">.</span><span class="ident" id="2886895">f</span><span class="op" id="2886896">.</span><span class="ident" id="2886897">Close</span><span class="op" id="2886902">(</span><span class="op" id="2886903">)</span><br>
<span class="lineno">115</span><span class="op" id="2886905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2886908">//&nbsp;DataOffset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;file&#39;s&nbsp;possibly-compressed</span><br>
<span class="lineno"></span><span class="comment" id="2886975">//&nbsp;data,&nbsp;relative&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2887027">//</span><br>
<span class="lineno">120</span><span class="comment" id="2887030">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;instead&nbsp;use&nbsp;Open,&nbsp;which&nbsp;transparently</span><br>
<span class="lineno"></span><span class="comment" id="2887091">//&nbsp;decompresses&nbsp;data&nbsp;and&nbsp;verifies&nbsp;checksums.</span><br>
<span class="lineno"></span><span class="keyword" id="2887136">func</span>&nbsp;<span class="op" id="2887141">(</span><span class="ident" id="2887142">f</span>&nbsp;<span class="op" id="2887144">*</span><span class="ident" id="2887145">File</span><span class="op" id="2887149">)</span>&nbsp;<span class="ident" id="2887151">DataOffset</span><span class="op" id="2887161">(</span><span class="op" id="2887162">)</span>&nbsp;<span class="op" id="2887164">(</span><span class="ident" id="2887165">offset</span>&nbsp;<span class="ident" id="2887172">int64</span><span class="op" id="2887177">,</span>&nbsp;<span class="ident" id="2887179">err</span>&nbsp;<span class="builtintype" id="2887183">error</span><span class="op" id="2887188">)</span>&nbsp;<span class="op" id="2887190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887193">bodyOffset</span><span class="op" id="2887203">,</span>&nbsp;<span class="ident" id="2887205">err</span>&nbsp;<span class="op" id="2887209">:=</span>&nbsp;<span class="ident" id="2887212">f</span><span class="op" id="2887213">.</span><span class="ident" id="2887214">findBodyOffset</span><span class="op" id="2887228">(</span><span class="op" id="2887229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887232">if</span>&nbsp;<span class="ident" id="2887235">err</span>&nbsp;<span class="op" id="2887239">!=</span>&nbsp;<span class="ident" id="2887242">nil</span>&nbsp;<span class="op" id="2887246">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887250">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887261">return</span>&nbsp;<span class="ident" id="2887268">f</span><span class="op" id="2887269">.</span><span class="ident" id="2887270">headerOffset</span>&nbsp;<span class="op" id="2887283">+</span>&nbsp;<span class="ident" id="2887285">bodyOffset</span><span class="op" id="2887295">,</span>&nbsp;<span class="ident" id="2887297">nil</span><br>
<span class="lineno"></span><span class="op" id="2887301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="2887304">//&nbsp;Open&nbsp;returns&nbsp;a&nbsp;ReadCloser&nbsp;that&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;File&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="2887378">//&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;be&nbsp;read&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="keyword" id="2887422">func</span>&nbsp;<span class="op" id="2887427">(</span><span class="ident" id="2887428">f</span>&nbsp;<span class="op" id="2887430">*</span><span class="ident" id="2887431">File</span><span class="op" id="2887435">)</span>&nbsp;<span class="ident" id="2887437">Open</span><span class="op" id="2887441">(</span><span class="op" id="2887442">)</span>&nbsp;<span class="op" id="2887444">(</span><span class="ident" id="2887445">rc</span>&nbsp;<span class="ident" id="2887448">io</span><span class="op" id="2887450">.</span><span class="ident" id="2887451">ReadCloser</span><span class="op" id="2887461">,</span>&nbsp;<span class="ident" id="2887463">err</span>&nbsp;<span class="builtintype" id="2887467">error</span><span class="op" id="2887472">)</span>&nbsp;<span class="op" id="2887474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887477">bodyOffset</span><span class="op" id="2887487">,</span>&nbsp;<span class="ident" id="2887489">err</span>&nbsp;<span class="op" id="2887493">:=</span>&nbsp;<span class="ident" id="2887496">f</span><span class="op" id="2887497">.</span><span class="ident" id="2887498">findBodyOffset</span><span class="op" id="2887512">(</span><span class="op" id="2887513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887516">if</span>&nbsp;<span class="ident" id="2887519">err</span>&nbsp;<span class="op" id="2887523">!=</span>&nbsp;<span class="ident" id="2887526">nil</span>&nbsp;<span class="op" id="2887530">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887534">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887545">size</span>&nbsp;<span class="op" id="2887550">:=</span>&nbsp;<span class="ident" id="2887553">int64</span><span class="op" id="2887558">(</span><span class="ident" id="2887559">f</span><span class="op" id="2887560">.</span><span class="ident" id="2887561">CompressedSize64</span><span class="op" id="2887577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887580">r</span>&nbsp;<span class="op" id="2887582">:=</span>&nbsp;<span class="ident" id="2887585">io</span><span class="op" id="2887587">.</span><span class="ident" id="2887588">NewSectionReader</span><span class="op" id="2887604">(</span><span class="ident" id="2887605">f</span><span class="op" id="2887606">.</span><span class="ident" id="2887607">zipr</span><span class="op" id="2887611">,</span>&nbsp;<span class="ident" id="2887613">f</span><span class="op" id="2887614">.</span><span class="ident" id="2887615">headerOffset</span><span class="op" id="2887627">+</span><span class="ident" id="2887628">bodyOffset</span><span class="op" id="2887638">,</span>&nbsp;<span class="ident" id="2887640">size</span><span class="op" id="2887644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887647">dcomp</span>&nbsp;<span class="op" id="2887653">:=</span>&nbsp;<span class="ident" id="2887656">decompressor</span><span class="op" id="2887668">(</span><span class="ident" id="2887669">f</span><span class="op" id="2887670">.</span><span class="ident" id="2887671">Method</span><span class="op" id="2887677">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887680">if</span>&nbsp;<span class="ident" id="2887683">dcomp</span>&nbsp;<span class="op" id="2887689">==</span>&nbsp;<span class="ident" id="2887692">nil</span>&nbsp;<span class="op" id="2887696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887700">err</span>&nbsp;<span class="op" id="2887704">=</span>&nbsp;<span class="ident" id="2887706">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887721">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887732">rc</span>&nbsp;<span class="op" id="2887735">=</span>&nbsp;<span class="ident" id="2887737">dcomp</span><span class="op" id="2887742">(</span><span class="ident" id="2887743">r</span><span class="op" id="2887744">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887747">var</span>&nbsp;<span class="ident" id="2887751">desr</span>&nbsp;<span class="ident" id="2887756">io</span><span class="op" id="2887758">.</span><span class="ident" id="2887759">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887767">if</span>&nbsp;<span class="ident" id="2887770">f</span><span class="op" id="2887771">.</span><span class="ident" id="2887772">hasDataDescriptor</span><span class="op" id="2887789">(</span><span class="op" id="2887790">)</span>&nbsp;<span class="op" id="2887792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887796">desr</span>&nbsp;<span class="op" id="2887801">=</span>&nbsp;<span class="ident" id="2887803">io</span><span class="op" id="2887805">.</span><span class="ident" id="2887806">NewSectionReader</span><span class="op" id="2887822">(</span><span class="ident" id="2887823">f</span><span class="op" id="2887824">.</span><span class="ident" id="2887825">zipr</span><span class="op" id="2887829">,</span>&nbsp;<span class="ident" id="2887831">f</span><span class="op" id="2887832">.</span><span class="ident" id="2887833">headerOffset</span><span class="op" id="2887845">+</span><span class="ident" id="2887846">bodyOffset</span><span class="op" id="2887856">+</span><span class="ident" id="2887857">size</span><span class="op" id="2887861">,</span>&nbsp;<span class="ident" id="2887863">dataDescriptorLen</span><span class="op" id="2887880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887886">rc</span>&nbsp;<span class="op" id="2887889">=</span>&nbsp;<span class="op" id="2887891">&amp;</span><span class="ident" id="2887892">checksumReader</span><span class="op" id="2887906">{</span><span class="ident" id="2887907">rc</span><span class="op" id="2887909">,</span>&nbsp;<span class="ident" id="2887911">crc32</span><span class="op" id="2887916">.</span><span class="ident" id="2887917">NewIEEE</span><span class="op" id="2887924">(</span><span class="op" id="2887925">)</span><span class="op" id="2887926">,</span>&nbsp;<span class="ident" id="2887928">f</span><span class="op" id="2887929">,</span>&nbsp;<span class="ident" id="2887931">desr</span><span class="op" id="2887935">,</span>&nbsp;<span class="ident" id="2887937">nil</span><span class="op" id="2887940">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887943">return</span><br>
<span class="lineno"></span><span class="op" id="2887950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2887953">type</span>&nbsp;<span class="ident" id="2887958">checksumReader</span>&nbsp;<span class="keyword" id="2887973">struct</span>&nbsp;<span class="op" id="2887980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887983">rc</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2887988">io</span><span class="op" id="2887990">.</span><span class="ident" id="2887991">ReadCloser</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888003">hash</span>&nbsp;<span class="ident" id="2888008">hash</span><span class="op" id="2888012">.</span><span class="ident" id="2888013">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888021">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2888026">*</span><span class="ident" id="2888027">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888033">desr</span>&nbsp;<span class="ident" id="2888038">io</span><span class="op" id="2888040">.</span><span class="ident" id="2888041">Reader</span>&nbsp;<span class="comment" id="2888048">//&nbsp;if&nbsp;non-nil,&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888098">err</span>&nbsp;&nbsp;<span class="builtintype" id="2888103">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2888113">//&nbsp;sticky&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="2888129">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="2888132">func</span>&nbsp;<span class="op" id="2888137">(</span><span class="ident" id="2888138">r</span>&nbsp;<span class="op" id="2888140">*</span><span class="ident" id="2888141">checksumReader</span><span class="op" id="2888155">)</span>&nbsp;<span class="ident" id="2888157">Read</span><span class="op" id="2888161">(</span><span class="ident" id="2888162">b</span>&nbsp;<span class="op" id="2888164">[</span><span class="op" id="2888165">]</span><span class="builtintype" id="2888166">byte</span><span class="op" id="2888170">)</span>&nbsp;<span class="op" id="2888172">(</span><span class="ident" id="2888173">n</span>&nbsp;<span class="builtintype" id="2888175">int</span><span class="op" id="2888178">,</span>&nbsp;<span class="ident" id="2888180">err</span>&nbsp;<span class="builtintype" id="2888184">error</span><span class="op" id="2888189">)</span>&nbsp;<span class="op" id="2888191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888194">if</span>&nbsp;<span class="ident" id="2888197">r</span><span class="op" id="2888198">.</span><span class="ident" id="2888199">err</span>&nbsp;<span class="op" id="2888203">!=</span>&nbsp;<span class="ident" id="2888206">nil</span>&nbsp;<span class="op" id="2888210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888214">return</span>&nbsp;<span class="num" id="2888221">0</span><span class="op" id="2888222">,</span>&nbsp;<span class="ident" id="2888224">r</span><span class="op" id="2888225">.</span><span class="ident" id="2888226">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2888231">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888234">n</span><span class="op" id="2888235">,</span>&nbsp;<span class="ident" id="2888237">err</span>&nbsp;<span class="op" id="2888241">=</span>&nbsp;<span class="ident" id="2888243">r</span><span class="op" id="2888244">.</span><span class="ident" id="2888245">rc</span><span class="op" id="2888247">.</span><span class="ident" id="2888248">Read</span><span class="op" id="2888252">(</span><span class="ident" id="2888253">b</span><span class="op" id="2888254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888257">r</span><span class="op" id="2888258">.</span><span class="ident" id="2888259">hash</span><span class="op" id="2888263">.</span><span class="ident" id="2888264">Write</span><span class="op" id="2888269">(</span><span class="ident" id="2888270">b</span><span class="op" id="2888271">[</span><span class="op" id="2888272">:</span><span class="ident" id="2888273">n</span><span class="op" id="2888274">]</span><span class="op" id="2888275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888278">if</span>&nbsp;<span class="ident" id="2888281">err</span>&nbsp;<span class="op" id="2888285">==</span>&nbsp;<span class="ident" id="2888288">nil</span>&nbsp;<span class="op" id="2888292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888296">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2888304">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888307">if</span>&nbsp;<span class="ident" id="2888310">err</span>&nbsp;<span class="op" id="2888314">==</span>&nbsp;<span class="ident" id="2888317">io</span><span class="op" id="2888319">.</span><span class="ident" id="2888320">EOF</span>&nbsp;<span class="op" id="2888324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888328">if</span>&nbsp;<span class="ident" id="2888331">r</span><span class="op" id="2888332">.</span><span class="ident" id="2888333">desr</span>&nbsp;<span class="op" id="2888338">!=</span>&nbsp;<span class="ident" id="2888341">nil</span>&nbsp;<span class="op" id="2888345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888350">if</span>&nbsp;<span class="ident" id="2888353">err1</span>&nbsp;<span class="op" id="2888358">:=</span>&nbsp;<span class="ident" id="2888361">readDataDescriptor</span><span class="op" id="2888379">(</span><span class="ident" id="2888380">r</span><span class="op" id="2888381">.</span><span class="ident" id="2888382">desr</span><span class="op" id="2888386">,</span>&nbsp;<span class="ident" id="2888388">r</span><span class="op" id="2888389">.</span><span class="ident" id="2888390">f</span><span class="op" id="2888391">)</span><span class="op" id="2888392">;</span>&nbsp;<span class="ident" id="2888394">err1</span>&nbsp;<span class="op" id="2888399">!=</span>&nbsp;<span class="ident" id="2888402">nil</span>&nbsp;<span class="op" id="2888406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888412">err</span>&nbsp;<span class="op" id="2888416">=</span>&nbsp;<span class="ident" id="2888418">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2888426">}</span>&nbsp;<span class="keyword" id="2888428">else</span>&nbsp;<span class="keyword" id="2888433">if</span>&nbsp;<span class="ident" id="2888436">r</span><span class="op" id="2888437">.</span><span class="ident" id="2888438">hash</span><span class="op" id="2888442">.</span><span class="ident" id="2888443">Sum32</span><span class="op" id="2888448">(</span><span class="op" id="2888449">)</span>&nbsp;<span class="op" id="2888451">!=</span>&nbsp;<span class="ident" id="2888454">r</span><span class="op" id="2888455">.</span><span class="ident" id="2888456">f</span><span class="op" id="2888457">.</span><span class="ident" id="2888458">CRC32</span>&nbsp;<span class="op" id="2888464">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888470">err</span>&nbsp;<span class="op" id="2888474">=</span>&nbsp;<span class="ident" id="2888476">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2888491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2888495">}</span>&nbsp;<span class="keyword" id="2888497">else</span>&nbsp;<span class="op" id="2888502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2888507">//&nbsp;If&nbsp;there&#39;s&nbsp;not&nbsp;a&nbsp;data&nbsp;descriptor,&nbsp;we&nbsp;still&nbsp;compare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2888564">//&nbsp;the&nbsp;CRC32&nbsp;of&nbsp;what&nbsp;we&#39;ve&nbsp;read&nbsp;against&nbsp;the&nbsp;file&nbsp;header</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2888623">//&nbsp;or&nbsp;TOC&#39;s&nbsp;CRC32,&nbsp;if&nbsp;it&nbsp;seems&nbsp;like&nbsp;it&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888674">if</span>&nbsp;<span class="ident" id="2888677">r</span><span class="op" id="2888678">.</span><span class="ident" id="2888679">f</span><span class="op" id="2888680">.</span><span class="ident" id="2888681">CRC32</span>&nbsp;<span class="op" id="2888687">!=</span>&nbsp;<span class="num" id="2888690">0</span>&nbsp;<span class="op" id="2888692">&amp;&amp;</span>&nbsp;<span class="ident" id="2888695">r</span><span class="op" id="2888696">.</span><span class="ident" id="2888697">hash</span><span class="op" id="2888701">.</span><span class="ident" id="2888702">Sum32</span><span class="op" id="2888707">(</span><span class="op" id="2888708">)</span>&nbsp;<span class="op" id="2888710">!=</span>&nbsp;<span class="ident" id="2888713">r</span><span class="op" id="2888714">.</span><span class="ident" id="2888715">f</span><span class="op" id="2888716">.</span><span class="ident" id="2888717">CRC32</span>&nbsp;<span class="op" id="2888723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888729">err</span>&nbsp;<span class="op" id="2888733">=</span>&nbsp;<span class="ident" id="2888735">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2888750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2888754">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2888757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888760">r</span><span class="op" id="2888761">.</span><span class="ident" id="2888762">err</span>&nbsp;<span class="op" id="2888766">=</span>&nbsp;<span class="ident" id="2888768">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888773">return</span><br>
<span class="lineno"></span><span class="op" id="2888780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="2888783">func</span>&nbsp;<span class="op" id="2888788">(</span><span class="ident" id="2888789">r</span>&nbsp;<span class="op" id="2888791">*</span><span class="ident" id="2888792">checksumReader</span><span class="op" id="2888806">)</span>&nbsp;<span class="ident" id="2888808">Close</span><span class="op" id="2888813">(</span><span class="op" id="2888814">)</span>&nbsp;<span class="builtintype" id="2888816">error</span>&nbsp;<span class="op" id="2888822">{</span>&nbsp;<span class="keyword" id="2888824">return</span>&nbsp;<span class="ident" id="2888831">r</span><span class="op" id="2888832">.</span><span class="ident" id="2888833">rc</span><span class="op" id="2888835">.</span><span class="ident" id="2888836">Close</span><span class="op" id="2888841">(</span><span class="op" id="2888842">)</span>&nbsp;<span class="op" id="2888844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2888847">//&nbsp;findBodyOffset&nbsp;does&nbsp;the&nbsp;minimum&nbsp;work&nbsp;to&nbsp;verify&nbsp;the&nbsp;file&nbsp;has&nbsp;a&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="2888919">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;file&nbsp;body&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="2888956">func</span>&nbsp;<span class="op" id="2888961">(</span><span class="ident" id="2888962">f</span>&nbsp;<span class="op" id="2888964">*</span><span class="ident" id="2888965">File</span><span class="op" id="2888969">)</span>&nbsp;<span class="ident" id="2888971">findBodyOffset</span><span class="op" id="2888985">(</span><span class="op" id="2888986">)</span>&nbsp;<span class="op" id="2888988">(</span><span class="ident" id="2888989">int64</span><span class="op" id="2888994">,</span>&nbsp;<span class="builtintype" id="2888996">error</span><span class="op" id="2889001">)</span>&nbsp;<span class="op" id="2889003">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889006">var</span>&nbsp;<span class="ident" id="2889010">buf</span>&nbsp;<span class="op" id="2889014">[</span><span class="ident" id="2889015">fileHeaderLen</span><span class="op" id="2889028">]</span><span class="builtintype" id="2889029">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889035">if</span>&nbsp;<span class="ident" id="2889038">_</span><span class="op" id="2889039">,</span>&nbsp;<span class="ident" id="2889041">err</span>&nbsp;<span class="op" id="2889045">:=</span>&nbsp;<span class="ident" id="2889048">f</span><span class="op" id="2889049">.</span><span class="ident" id="2889050">zipr</span><span class="op" id="2889054">.</span><span class="ident" id="2889055">ReadAt</span><span class="op" id="2889061">(</span><span class="ident" id="2889062">buf</span><span class="op" id="2889065">[</span><span class="op" id="2889066">:</span><span class="op" id="2889067">]</span><span class="op" id="2889068">,</span>&nbsp;<span class="ident" id="2889070">f</span><span class="op" id="2889071">.</span><span class="ident" id="2889072">headerOffset</span><span class="op" id="2889084">)</span><span class="op" id="2889085">;</span>&nbsp;<span class="ident" id="2889087">err</span>&nbsp;<span class="op" id="2889091">!=</span>&nbsp;<span class="ident" id="2889094">nil</span>&nbsp;<span class="op" id="2889098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889102">return</span>&nbsp;<span class="num" id="2889109">0</span><span class="op" id="2889110">,</span>&nbsp;<span class="ident" id="2889112">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2889117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889120">b</span>&nbsp;<span class="op" id="2889122">:=</span>&nbsp;<span class="ident" id="2889125">readBuf</span><span class="op" id="2889132">(</span><span class="ident" id="2889133">buf</span><span class="op" id="2889136">[</span><span class="op" id="2889137">:</span><span class="op" id="2889138">]</span><span class="op" id="2889139">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889142">if</span>&nbsp;<span class="ident" id="2889145">sig</span>&nbsp;<span class="op" id="2889149">:=</span>&nbsp;<span class="ident" id="2889152">b</span><span class="op" id="2889153">.</span><span class="builtintype" id="2889154">uint32</span><span class="op" id="2889160">(</span><span class="op" id="2889161">)</span><span class="op" id="2889162">;</span>&nbsp;<span class="ident" id="2889164">sig</span>&nbsp;<span class="op" id="2889168">!=</span>&nbsp;<span class="ident" id="2889171">fileHeaderSignature</span>&nbsp;<span class="op" id="2889191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889195">return</span>&nbsp;<span class="num" id="2889202">0</span><span class="op" id="2889203">,</span>&nbsp;<span class="ident" id="2889205">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2889216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889219">b</span>&nbsp;<span class="op" id="2889221">=</span>&nbsp;<span class="ident" id="2889223">b</span><span class="op" id="2889224">[</span><span class="num" id="2889225">22</span><span class="op" id="2889227">:</span><span class="op" id="2889228">]</span>&nbsp;<span class="comment" id="2889230">//&nbsp;skip&nbsp;over&nbsp;most&nbsp;of&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889263">filenameLen</span>&nbsp;<span class="op" id="2889275">:=</span>&nbsp;<span class="builtintype" id="2889278">int</span><span class="op" id="2889281">(</span><span class="ident" id="2889282">b</span><span class="op" id="2889283">.</span><span class="builtintype" id="2889284">uint16</span><span class="op" id="2889290">(</span><span class="op" id="2889291">)</span><span class="op" id="2889292">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889295">extraLen</span>&nbsp;<span class="op" id="2889304">:=</span>&nbsp;<span class="builtintype" id="2889307">int</span><span class="op" id="2889310">(</span><span class="ident" id="2889311">b</span><span class="op" id="2889312">.</span><span class="builtintype" id="2889313">uint16</span><span class="op" id="2889319">(</span><span class="op" id="2889320">)</span><span class="op" id="2889321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889324">return</span>&nbsp;<span class="ident" id="2889331">int64</span><span class="op" id="2889336">(</span><span class="ident" id="2889337">fileHeaderLen</span>&nbsp;<span class="op" id="2889351">+</span>&nbsp;<span class="ident" id="2889353">filenameLen</span>&nbsp;<span class="op" id="2889365">+</span>&nbsp;<span class="ident" id="2889367">extraLen</span><span class="op" id="2889375">)</span><span class="op" id="2889376">,</span>&nbsp;<span class="ident" id="2889378">nil</span><br>
<span class="lineno"></span><span class="op" id="2889382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2889385">//&nbsp;readDirectoryHeader&nbsp;attempts&nbsp;to&nbsp;read&nbsp;a&nbsp;directory&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno">210</span><span class="comment" id="2889452">//&nbsp;It&nbsp;returns&nbsp;io.ErrUnexpectedEOF&nbsp;if&nbsp;it&nbsp;cannot&nbsp;read&nbsp;a&nbsp;complete&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="2889523">//&nbsp;and&nbsp;ErrFormat&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;find&nbsp;a&nbsp;valid&nbsp;header&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="2889585">func</span>&nbsp;<span class="ident" id="2889590">readDirectoryHeader</span><span class="op" id="2889609">(</span><span class="ident" id="2889610">f</span>&nbsp;<span class="op" id="2889612">*</span><span class="ident" id="2889613">File</span><span class="op" id="2889617">,</span>&nbsp;<span class="ident" id="2889619">r</span>&nbsp;<span class="ident" id="2889621">io</span><span class="op" id="2889623">.</span><span class="ident" id="2889624">Reader</span><span class="op" id="2889630">)</span>&nbsp;<span class="builtintype" id="2889632">error</span>&nbsp;<span class="op" id="2889638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889641">var</span>&nbsp;<span class="ident" id="2889645">buf</span>&nbsp;<span class="op" id="2889649">[</span><span class="ident" id="2889650">directoryHeaderLen</span><span class="op" id="2889668">]</span><span class="builtintype" id="2889669">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889675">if</span>&nbsp;<span class="ident" id="2889678">_</span><span class="op" id="2889679">,</span>&nbsp;<span class="ident" id="2889681">err</span>&nbsp;<span class="op" id="2889685">:=</span>&nbsp;<span class="ident" id="2889688">io</span><span class="op" id="2889690">.</span><span class="ident" id="2889691">ReadFull</span><span class="op" id="2889699">(</span><span class="ident" id="2889700">r</span><span class="op" id="2889701">,</span>&nbsp;<span class="ident" id="2889703">buf</span><span class="op" id="2889706">[</span><span class="op" id="2889707">:</span><span class="op" id="2889708">]</span><span class="op" id="2889709">)</span><span class="op" id="2889710">;</span>&nbsp;<span class="ident" id="2889712">err</span>&nbsp;<span class="op" id="2889716">!=</span>&nbsp;<span class="ident" id="2889719">nil</span>&nbsp;<span class="op" id="2889723">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889727">return</span>&nbsp;<span class="ident" id="2889734">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2889739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889742">b</span>&nbsp;<span class="op" id="2889744">:=</span>&nbsp;<span class="ident" id="2889747">readBuf</span><span class="op" id="2889754">(</span><span class="ident" id="2889755">buf</span><span class="op" id="2889758">[</span><span class="op" id="2889759">:</span><span class="op" id="2889760">]</span><span class="op" id="2889761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889764">if</span>&nbsp;<span class="ident" id="2889767">sig</span>&nbsp;<span class="op" id="2889771">:=</span>&nbsp;<span class="ident" id="2889774">b</span><span class="op" id="2889775">.</span><span class="builtintype" id="2889776">uint32</span><span class="op" id="2889782">(</span><span class="op" id="2889783">)</span><span class="op" id="2889784">;</span>&nbsp;<span class="ident" id="2889786">sig</span>&nbsp;<span class="op" id="2889790">!=</span>&nbsp;<span class="ident" id="2889793">directoryHeaderSignature</span>&nbsp;<span class="op" id="2889818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889822">return</span>&nbsp;<span class="ident" id="2889829">ErrFormat</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2889840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889843">f</span><span class="op" id="2889844">.</span><span class="ident" id="2889845">CreatorVersion</span>&nbsp;<span class="op" id="2889860">=</span>&nbsp;<span class="ident" id="2889862">b</span><span class="op" id="2889863">.</span><span class="builtintype" id="2889864">uint16</span><span class="op" id="2889870">(</span><span class="op" id="2889871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889874">f</span><span class="op" id="2889875">.</span><span class="ident" id="2889876">ReaderVersion</span>&nbsp;<span class="op" id="2889890">=</span>&nbsp;<span class="ident" id="2889892">b</span><span class="op" id="2889893">.</span><span class="builtintype" id="2889894">uint16</span><span class="op" id="2889900">(</span><span class="op" id="2889901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889904">f</span><span class="op" id="2889905">.</span><span class="ident" id="2889906">Flags</span>&nbsp;<span class="op" id="2889912">=</span>&nbsp;<span class="ident" id="2889914">b</span><span class="op" id="2889915">.</span><span class="builtintype" id="2889916">uint16</span><span class="op" id="2889922">(</span><span class="op" id="2889923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889926">f</span><span class="op" id="2889927">.</span><span class="ident" id="2889928">Method</span>&nbsp;<span class="op" id="2889935">=</span>&nbsp;<span class="ident" id="2889937">b</span><span class="op" id="2889938">.</span><span class="builtintype" id="2889939">uint16</span><span class="op" id="2889945">(</span><span class="op" id="2889946">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889949">f</span><span class="op" id="2889950">.</span><span class="ident" id="2889951">ModifiedTime</span>&nbsp;<span class="op" id="2889964">=</span>&nbsp;<span class="ident" id="2889966">b</span><span class="op" id="2889967">.</span><span class="builtintype" id="2889968">uint16</span><span class="op" id="2889974">(</span><span class="op" id="2889975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889978">f</span><span class="op" id="2889979">.</span><span class="ident" id="2889980">ModifiedDate</span>&nbsp;<span class="op" id="2889993">=</span>&nbsp;<span class="ident" id="2889995">b</span><span class="op" id="2889996">.</span><span class="builtintype" id="2889997">uint16</span><span class="op" id="2890003">(</span><span class="op" id="2890004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890007">f</span><span class="op" id="2890008">.</span><span class="ident" id="2890009">CRC32</span>&nbsp;<span class="op" id="2890015">=</span>&nbsp;<span class="ident" id="2890017">b</span><span class="op" id="2890018">.</span><span class="builtintype" id="2890019">uint32</span><span class="op" id="2890025">(</span><span class="op" id="2890026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890029">f</span><span class="op" id="2890030">.</span><span class="ident" id="2890031">CompressedSize</span>&nbsp;<span class="op" id="2890046">=</span>&nbsp;<span class="ident" id="2890048">b</span><span class="op" id="2890049">.</span><span class="builtintype" id="2890050">uint32</span><span class="op" id="2890056">(</span><span class="op" id="2890057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890060">f</span><span class="op" id="2890061">.</span><span class="ident" id="2890062">UncompressedSize</span>&nbsp;<span class="op" id="2890079">=</span>&nbsp;<span class="ident" id="2890081">b</span><span class="op" id="2890082">.</span><span class="builtintype" id="2890083">uint32</span><span class="op" id="2890089">(</span><span class="op" id="2890090">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890093">f</span><span class="op" id="2890094">.</span><span class="ident" id="2890095">CompressedSize64</span>&nbsp;<span class="op" id="2890112">=</span>&nbsp;<span class="ident" id="2890114">uint64</span><span class="op" id="2890120">(</span><span class="ident" id="2890121">f</span><span class="op" id="2890122">.</span><span class="ident" id="2890123">CompressedSize</span><span class="op" id="2890137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890140">f</span><span class="op" id="2890141">.</span><span class="ident" id="2890142">UncompressedSize64</span>&nbsp;<span class="op" id="2890161">=</span>&nbsp;<span class="ident" id="2890163">uint64</span><span class="op" id="2890169">(</span><span class="ident" id="2890170">f</span><span class="op" id="2890171">.</span><span class="ident" id="2890172">UncompressedSize</span><span class="op" id="2890188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890191">filenameLen</span>&nbsp;<span class="op" id="2890203">:=</span>&nbsp;<span class="builtintype" id="2890206">int</span><span class="op" id="2890209">(</span><span class="ident" id="2890210">b</span><span class="op" id="2890211">.</span><span class="builtintype" id="2890212">uint16</span><span class="op" id="2890218">(</span><span class="op" id="2890219">)</span><span class="op" id="2890220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890223">extraLen</span>&nbsp;<span class="op" id="2890232">:=</span>&nbsp;<span class="builtintype" id="2890235">int</span><span class="op" id="2890238">(</span><span class="ident" id="2890239">b</span><span class="op" id="2890240">.</span><span class="builtintype" id="2890241">uint16</span><span class="op" id="2890247">(</span><span class="op" id="2890248">)</span><span class="op" id="2890249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890252">commentLen</span>&nbsp;<span class="op" id="2890263">:=</span>&nbsp;<span class="builtintype" id="2890266">int</span><span class="op" id="2890269">(</span><span class="ident" id="2890270">b</span><span class="op" id="2890271">.</span><span class="builtintype" id="2890272">uint16</span><span class="op" id="2890278">(</span><span class="op" id="2890279">)</span><span class="op" id="2890280">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890283">b</span>&nbsp;<span class="op" id="2890285">=</span>&nbsp;<span class="ident" id="2890287">b</span><span class="op" id="2890288">[</span><span class="num" id="2890289">4</span><span class="op" id="2890290">:</span><span class="op" id="2890291">]</span>&nbsp;<span class="comment" id="2890293">//&nbsp;skipped&nbsp;start&nbsp;disk&nbsp;number&nbsp;and&nbsp;internal&nbsp;attributes&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890359">f</span><span class="op" id="2890360">.</span><span class="ident" id="2890361">ExternalAttrs</span>&nbsp;<span class="op" id="2890375">=</span>&nbsp;<span class="ident" id="2890377">b</span><span class="op" id="2890378">.</span><span class="builtintype" id="2890379">uint32</span><span class="op" id="2890385">(</span><span class="op" id="2890386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890389">f</span><span class="op" id="2890390">.</span><span class="ident" id="2890391">headerOffset</span>&nbsp;<span class="op" id="2890404">=</span>&nbsp;<span class="ident" id="2890406">int64</span><span class="op" id="2890411">(</span><span class="ident" id="2890412">b</span><span class="op" id="2890413">.</span><span class="builtintype" id="2890414">uint32</span><span class="op" id="2890420">(</span><span class="op" id="2890421">)</span><span class="op" id="2890422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890425">d</span>&nbsp;<span class="op" id="2890427">:=</span>&nbsp;<span class="builtinfunc" id="2890430">make</span><span class="op" id="2890434">(</span><span class="op" id="2890435">[</span><span class="op" id="2890436">]</span><span class="builtintype" id="2890437">byte</span><span class="op" id="2890441">,</span>&nbsp;<span class="ident" id="2890443">filenameLen</span><span class="op" id="2890454">+</span><span class="ident" id="2890455">extraLen</span><span class="op" id="2890463">+</span><span class="ident" id="2890464">commentLen</span><span class="op" id="2890474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2890477">if</span>&nbsp;<span class="ident" id="2890480">_</span><span class="op" id="2890481">,</span>&nbsp;<span class="ident" id="2890483">err</span>&nbsp;<span class="op" id="2890487">:=</span>&nbsp;<span class="ident" id="2890490">io</span><span class="op" id="2890492">.</span><span class="ident" id="2890493">ReadFull</span><span class="op" id="2890501">(</span><span class="ident" id="2890502">r</span><span class="op" id="2890503">,</span>&nbsp;<span class="ident" id="2890505">d</span><span class="op" id="2890506">)</span><span class="op" id="2890507">;</span>&nbsp;<span class="ident" id="2890509">err</span>&nbsp;<span class="op" id="2890513">!=</span>&nbsp;<span class="ident" id="2890516">nil</span>&nbsp;<span class="op" id="2890520">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2890524">return</span>&nbsp;<span class="ident" id="2890531">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2890536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890539">f</span><span class="op" id="2890540">.</span><span class="ident" id="2890541">Name</span>&nbsp;<span class="op" id="2890546">=</span>&nbsp;<span class="builtintype" id="2890548">string</span><span class="op" id="2890554">(</span><span class="ident" id="2890555">d</span><span class="op" id="2890556">[</span><span class="op" id="2890557">:</span><span class="ident" id="2890558">filenameLen</span><span class="op" id="2890569">]</span><span class="op" id="2890570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890573">f</span><span class="op" id="2890574">.</span><span class="ident" id="2890575">Extra</span>&nbsp;<span class="op" id="2890581">=</span>&nbsp;<span class="ident" id="2890583">d</span><span class="op" id="2890584">[</span><span class="ident" id="2890585">filenameLen</span>&nbsp;<span class="op" id="2890597">:</span>&nbsp;<span class="ident" id="2890599">filenameLen</span><span class="op" id="2890610">+</span><span class="ident" id="2890611">extraLen</span><span class="op" id="2890619">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890622">f</span><span class="op" id="2890623">.</span><span class="ident" id="2890624">Comment</span>&nbsp;<span class="op" id="2890632">=</span>&nbsp;<span class="builtintype" id="2890634">string</span><span class="op" id="2890640">(</span><span class="ident" id="2890641">d</span><span class="op" id="2890642">[</span><span class="ident" id="2890643">filenameLen</span><span class="op" id="2890654">+</span><span class="ident" id="2890655">extraLen</span><span class="op" id="2890663">:</span><span class="op" id="2890664">]</span><span class="op" id="2890665">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2890669">if</span>&nbsp;<span class="builtinfunc" id="2890672">len</span><span class="op" id="2890675">(</span><span class="ident" id="2890676">f</span><span class="op" id="2890677">.</span><span class="ident" id="2890678">Extra</span><span class="op" id="2890683">)</span>&nbsp;<span class="op" id="2890685">&gt;</span>&nbsp;<span class="num" id="2890687">0</span>&nbsp;<span class="op" id="2890689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890693">b</span>&nbsp;<span class="op" id="2890695">:=</span>&nbsp;<span class="ident" id="2890698">readBuf</span><span class="op" id="2890705">(</span><span class="ident" id="2890706">f</span><span class="op" id="2890707">.</span><span class="ident" id="2890708">Extra</span><span class="op" id="2890713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2890717">for</span>&nbsp;<span class="builtinfunc" id="2890721">len</span><span class="op" id="2890724">(</span><span class="ident" id="2890725">b</span><span class="op" id="2890726">)</span>&nbsp;<span class="op" id="2890728">&gt;=</span>&nbsp;<span class="num" id="2890731">4</span>&nbsp;<span class="op" id="2890733">{</span>&nbsp;<span class="comment" id="2890735">//&nbsp;need&nbsp;at&nbsp;least&nbsp;tag&nbsp;and&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890768">tag</span>&nbsp;<span class="op" id="2890772">:=</span>&nbsp;<span class="ident" id="2890775">b</span><span class="op" id="2890776">.</span><span class="builtintype" id="2890777">uint16</span><span class="op" id="2890783">(</span><span class="op" id="2890784">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890789">size</span>&nbsp;<span class="op" id="2890794">:=</span>&nbsp;<span class="ident" id="2890797">b</span><span class="op" id="2890798">.</span><span class="builtintype" id="2890799">uint16</span><span class="op" id="2890805">(</span><span class="op" id="2890806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2890811">if</span>&nbsp;<span class="builtintype" id="2890814">int</span><span class="op" id="2890817">(</span><span class="ident" id="2890818">size</span><span class="op" id="2890822">)</span>&nbsp;<span class="op" id="2890824">&gt;</span>&nbsp;<span class="builtinfunc" id="2890826">len</span><span class="op" id="2890829">(</span><span class="ident" id="2890830">b</span><span class="op" id="2890831">)</span>&nbsp;<span class="op" id="2890833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2890839">return</span>&nbsp;<span class="ident" id="2890846">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2890859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2890864">if</span>&nbsp;<span class="ident" id="2890867">tag</span>&nbsp;<span class="op" id="2890871">==</span>&nbsp;<span class="ident" id="2890874">zip64ExtraId</span>&nbsp;<span class="op" id="2890887">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2890893">//&nbsp;update&nbsp;directory&nbsp;values&nbsp;from&nbsp;the&nbsp;zip64&nbsp;extra&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890951">eb</span>&nbsp;<span class="op" id="2890954">:=</span>&nbsp;<span class="ident" id="2890957">readBuf</span><span class="op" id="2890964">(</span><span class="ident" id="2890965">b</span><span class="op" id="2890966">[</span><span class="op" id="2890967">:</span><span class="ident" id="2890968">size</span><span class="op" id="2890972">]</span><span class="op" id="2890973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2890979">if</span>&nbsp;<span class="builtinfunc" id="2890982">len</span><span class="op" id="2890985">(</span><span class="ident" id="2890986">eb</span><span class="op" id="2890988">)</span>&nbsp;<span class="op" id="2890990">&gt;=</span>&nbsp;<span class="num" id="2890993">8</span>&nbsp;<span class="op" id="2890995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2891002">f</span><span class="op" id="2891003">.</span><span class="ident" id="2891004">UncompressedSize64</span>&nbsp;<span class="op" id="2891023">=</span>&nbsp;<span class="ident" id="2891025">eb</span><span class="op" id="2891027">.</span><span class="ident" id="2891028">uint64</span><span class="op" id="2891034">(</span><span class="op" id="2891035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2891041">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891047">if</span>&nbsp;<span class="builtinfunc" id="2891050">len</span><span class="op" id="2891053">(</span><span class="ident" id="2891054">eb</span><span class="op" id="2891056">)</span>&nbsp;<span class="op" id="2891058">&gt;=</span>&nbsp;<span class="num" id="2891061">8</span>&nbsp;<span class="op" id="2891063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2891070">f</span><span class="op" id="2891071">.</span><span class="ident" id="2891072">CompressedSize64</span>&nbsp;<span class="op" id="2891089">=</span>&nbsp;<span class="ident" id="2891091">eb</span><span class="op" id="2891093">.</span><span class="ident" id="2891094">uint64</span><span class="op" id="2891100">(</span><span class="op" id="2891101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2891107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891113">if</span>&nbsp;<span class="builtinfunc" id="2891116">len</span><span class="op" id="2891119">(</span><span class="ident" id="2891120">eb</span><span class="op" id="2891122">)</span>&nbsp;<span class="op" id="2891124">&gt;=</span>&nbsp;<span class="num" id="2891127">8</span>&nbsp;<span class="op" id="2891129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2891136">f</span><span class="op" id="2891137">.</span><span class="ident" id="2891138">headerOffset</span>&nbsp;<span class="op" id="2891151">=</span>&nbsp;<span class="ident" id="2891153">int64</span><span class="op" id="2891158">(</span><span class="ident" id="2891159">eb</span><span class="op" id="2891161">.</span><span class="ident" id="2891162">uint64</span><span class="op" id="2891168">(</span><span class="op" id="2891169">)</span><span class="op" id="2891170">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2891176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2891181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2891186">b</span>&nbsp;<span class="op" id="2891188">=</span>&nbsp;<span class="ident" id="2891190">b</span><span class="op" id="2891191">[</span><span class="ident" id="2891192">size</span><span class="op" id="2891196">:</span><span class="op" id="2891197">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2891201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2891205">//&nbsp;Should&nbsp;have&nbsp;consumed&nbsp;the&nbsp;whole&nbsp;header.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2891249">//&nbsp;But&nbsp;popular&nbsp;zip&nbsp;&amp;&nbsp;JAR&nbsp;creation&nbsp;tools&nbsp;are&nbsp;broken&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2891306">//&nbsp;may&nbsp;pad&nbsp;extra&nbsp;zeros&nbsp;at&nbsp;the&nbsp;end,&nbsp;so&nbsp;accept&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2891359">//&nbsp;too.&nbsp;See&nbsp;golang.org/issue/8186.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891396">for</span>&nbsp;<span class="ident" id="2891400">_</span><span class="op" id="2891401">,</span>&nbsp;<span class="ident" id="2891403">v</span>&nbsp;<span class="op" id="2891405">:=</span>&nbsp;<span class="keyword" id="2891408">range</span>&nbsp;<span class="ident" id="2891414">b</span>&nbsp;<span class="op" id="2891416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891421">if</span>&nbsp;<span class="ident" id="2891424">v</span>&nbsp;<span class="op" id="2891426">!=</span>&nbsp;<span class="num" id="2891429">0</span>&nbsp;<span class="op" id="2891431">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891437">return</span>&nbsp;<span class="ident" id="2891444">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2891457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2891461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2891464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891467">return</span>&nbsp;<span class="ident" id="2891474">nil</span><br>
<span class="lineno">280</span><span class="op" id="2891478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2891481">func</span>&nbsp;<span class="ident" id="2891486">readDataDescriptor</span><span class="op" id="2891504">(</span><span class="ident" id="2891505">r</span>&nbsp;<span class="ident" id="2891507">io</span><span class="op" id="2891509">.</span><span class="ident" id="2891510">Reader</span><span class="op" id="2891516">,</span>&nbsp;<span class="ident" id="2891518">f</span>&nbsp;<span class="op" id="2891520">*</span><span class="ident" id="2891521">File</span><span class="op" id="2891525">)</span>&nbsp;<span class="builtintype" id="2891527">error</span>&nbsp;<span class="op" id="2891533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891536">var</span>&nbsp;<span class="ident" id="2891540">buf</span>&nbsp;<span class="op" id="2891544">[</span><span class="ident" id="2891545">dataDescriptorLen</span><span class="op" id="2891562">]</span><span class="builtintype" id="2891563">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2891570">//&nbsp;The&nbsp;spec&nbsp;says:&nbsp;&#34;Although&nbsp;not&nbsp;originally&nbsp;assigned&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2891625">//&nbsp;signature,&nbsp;the&nbsp;value&nbsp;0x08074b50&nbsp;has&nbsp;commonly&nbsp;been&nbsp;adopted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2891687">//&nbsp;as&nbsp;a&nbsp;signature&nbsp;value&nbsp;for&nbsp;the&nbsp;data&nbsp;descriptor&nbsp;record.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2891744">//&nbsp;Implementers&nbsp;should&nbsp;be&nbsp;aware&nbsp;that&nbsp;ZIP&nbsp;files&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2891799">//&nbsp;encountered&nbsp;with&nbsp;or&nbsp;without&nbsp;this&nbsp;signature&nbsp;marking&nbsp;data</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2891859">//&nbsp;descriptors&nbsp;and&nbsp;should&nbsp;account&nbsp;for&nbsp;either&nbsp;case&nbsp;when&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2891923">//&nbsp;ZIP&nbsp;files&nbsp;to&nbsp;ensure&nbsp;compatibility.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2891963">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2891967">//&nbsp;dataDescriptorLen&nbsp;includes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;signature&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2892028">//&nbsp;first&nbsp;read&nbsp;just&nbsp;those&nbsp;4&nbsp;bytes&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;exists.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892083">if</span>&nbsp;<span class="ident" id="2892086">_</span><span class="op" id="2892087">,</span>&nbsp;<span class="ident" id="2892089">err</span>&nbsp;<span class="op" id="2892093">:=</span>&nbsp;<span class="ident" id="2892096">io</span><span class="op" id="2892098">.</span><span class="ident" id="2892099">ReadFull</span><span class="op" id="2892107">(</span><span class="ident" id="2892108">r</span><span class="op" id="2892109">,</span>&nbsp;<span class="ident" id="2892111">buf</span><span class="op" id="2892114">[</span><span class="op" id="2892115">:</span><span class="num" id="2892116">4</span><span class="op" id="2892117">]</span><span class="op" id="2892118">)</span><span class="op" id="2892119">;</span>&nbsp;<span class="ident" id="2892121">err</span>&nbsp;<span class="op" id="2892125">!=</span>&nbsp;<span class="ident" id="2892128">nil</span>&nbsp;<span class="op" id="2892132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892136">return</span>&nbsp;<span class="ident" id="2892143">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2892148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892151">off</span>&nbsp;<span class="op" id="2892155">:=</span>&nbsp;<span class="num" id="2892158">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892161">maybeSig</span>&nbsp;<span class="op" id="2892170">:=</span>&nbsp;<span class="ident" id="2892173">readBuf</span><span class="op" id="2892180">(</span><span class="ident" id="2892181">buf</span><span class="op" id="2892184">[</span><span class="op" id="2892185">:</span><span class="num" id="2892186">4</span><span class="op" id="2892187">]</span><span class="op" id="2892188">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892191">if</span>&nbsp;<span class="ident" id="2892194">maybeSig</span><span class="op" id="2892202">.</span><span class="builtintype" id="2892203">uint32</span><span class="op" id="2892209">(</span><span class="op" id="2892210">)</span>&nbsp;<span class="op" id="2892212">!=</span>&nbsp;<span class="ident" id="2892215">dataDescriptorSignature</span>&nbsp;<span class="op" id="2892239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2892243">//&nbsp;No&nbsp;data&nbsp;descriptor&nbsp;signature.&nbsp;Keep&nbsp;these&nbsp;four</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2892294">//&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892306">off</span>&nbsp;<span class="op" id="2892310">+=</span>&nbsp;<span class="num" id="2892313">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2892316">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892319">if</span>&nbsp;<span class="ident" id="2892322">_</span><span class="op" id="2892323">,</span>&nbsp;<span class="ident" id="2892325">err</span>&nbsp;<span class="op" id="2892329">:=</span>&nbsp;<span class="ident" id="2892332">io</span><span class="op" id="2892334">.</span><span class="ident" id="2892335">ReadFull</span><span class="op" id="2892343">(</span><span class="ident" id="2892344">r</span><span class="op" id="2892345">,</span>&nbsp;<span class="ident" id="2892347">buf</span><span class="op" id="2892350">[</span><span class="ident" id="2892351">off</span><span class="op" id="2892354">:</span><span class="num" id="2892355">12</span><span class="op" id="2892357">]</span><span class="op" id="2892358">)</span><span class="op" id="2892359">;</span>&nbsp;<span class="ident" id="2892361">err</span>&nbsp;<span class="op" id="2892365">!=</span>&nbsp;<span class="ident" id="2892368">nil</span>&nbsp;<span class="op" id="2892372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892376">return</span>&nbsp;<span class="ident" id="2892383">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2892388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892391">b</span>&nbsp;<span class="op" id="2892393">:=</span>&nbsp;<span class="ident" id="2892396">readBuf</span><span class="op" id="2892403">(</span><span class="ident" id="2892404">buf</span><span class="op" id="2892407">[</span><span class="op" id="2892408">:</span><span class="num" id="2892409">12</span><span class="op" id="2892411">]</span><span class="op" id="2892412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892415">if</span>&nbsp;<span class="ident" id="2892418">b</span><span class="op" id="2892419">.</span><span class="builtintype" id="2892420">uint32</span><span class="op" id="2892426">(</span><span class="op" id="2892427">)</span>&nbsp;<span class="op" id="2892429">!=</span>&nbsp;<span class="ident" id="2892432">f</span><span class="op" id="2892433">.</span><span class="ident" id="2892434">CRC32</span>&nbsp;<span class="op" id="2892440">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892444">return</span>&nbsp;<span class="ident" id="2892451">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2892464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2892468">//&nbsp;The&nbsp;two&nbsp;sizes&nbsp;that&nbsp;follow&nbsp;here&nbsp;can&nbsp;be&nbsp;either&nbsp;32&nbsp;bits&nbsp;or&nbsp;64&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2892536">//&nbsp;but&nbsp;the&nbsp;spec&nbsp;is&nbsp;not&nbsp;very&nbsp;clear&nbsp;on&nbsp;this&nbsp;and&nbsp;different</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2892593">//&nbsp;interpretations&nbsp;has&nbsp;been&nbsp;made&nbsp;causing&nbsp;incompatibilities.&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2892657">//&nbsp;already&nbsp;have&nbsp;the&nbsp;sizes&nbsp;from&nbsp;the&nbsp;central&nbsp;directory&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2892721">//&nbsp;just&nbsp;ignore&nbsp;these.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892745">return</span>&nbsp;<span class="ident" id="2892752">nil</span><br>
<span class="lineno">320</span><span class="op" id="2892756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2892759">func</span>&nbsp;<span class="ident" id="2892764">readDirectoryEnd</span><span class="op" id="2892780">(</span><span class="ident" id="2892781">r</span>&nbsp;<span class="ident" id="2892783">io</span><span class="op" id="2892785">.</span><span class="ident" id="2892786">ReaderAt</span><span class="op" id="2892794">,</span>&nbsp;<span class="ident" id="2892796">size</span>&nbsp;<span class="ident" id="2892801">int64</span><span class="op" id="2892806">)</span>&nbsp;<span class="op" id="2892808">(</span><span class="ident" id="2892809">dir</span>&nbsp;<span class="op" id="2892813">*</span><span class="ident" id="2892814">directoryEnd</span><span class="op" id="2892826">,</span>&nbsp;<span class="ident" id="2892828">err</span>&nbsp;<span class="builtintype" id="2892832">error</span><span class="op" id="2892837">)</span>&nbsp;<span class="op" id="2892839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2892842">//&nbsp;look&nbsp;for&nbsp;directoryEndSignature&nbsp;in&nbsp;the&nbsp;last&nbsp;1k,&nbsp;then&nbsp;in&nbsp;the&nbsp;last&nbsp;65k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892914">var</span>&nbsp;<span class="ident" id="2892918">buf</span>&nbsp;<span class="op" id="2892922">[</span><span class="op" id="2892923">]</span><span class="builtintype" id="2892924">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892930">var</span>&nbsp;<span class="ident" id="2892934">directoryEndOffset</span>&nbsp;<span class="ident" id="2892953">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892960">for</span>&nbsp;<span class="ident" id="2892964">i</span><span class="op" id="2892965">,</span>&nbsp;<span class="ident" id="2892967">bLen</span>&nbsp;<span class="op" id="2892972">:=</span>&nbsp;<span class="keyword" id="2892975">range</span>&nbsp;<span class="op" id="2892981">[</span><span class="op" id="2892982">]</span><span class="ident" id="2892983">int64</span><span class="op" id="2892988">{</span><span class="num" id="2892989">1024</span><span class="op" id="2892993">,</span>&nbsp;<span class="num" id="2892995">65</span>&nbsp;<span class="op" id="2892998">*</span>&nbsp;<span class="num" id="2893000">1024</span><span class="op" id="2893004">}</span>&nbsp;<span class="op" id="2893006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893010">if</span>&nbsp;<span class="ident" id="2893013">bLen</span>&nbsp;<span class="op" id="2893018">&gt;</span>&nbsp;<span class="ident" id="2893020">size</span>&nbsp;<span class="op" id="2893025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893030">bLen</span>&nbsp;<span class="op" id="2893035">=</span>&nbsp;<span class="ident" id="2893037">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2893044">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893048">buf</span>&nbsp;<span class="op" id="2893052">=</span>&nbsp;<span class="builtinfunc" id="2893054">make</span><span class="op" id="2893058">(</span><span class="op" id="2893059">[</span><span class="op" id="2893060">]</span><span class="builtintype" id="2893061">byte</span><span class="op" id="2893065">,</span>&nbsp;<span class="builtintype" id="2893067">int</span><span class="op" id="2893070">(</span><span class="ident" id="2893071">bLen</span><span class="op" id="2893075">)</span><span class="op" id="2893076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893080">if</span>&nbsp;<span class="ident" id="2893083">_</span><span class="op" id="2893084">,</span>&nbsp;<span class="ident" id="2893086">err</span>&nbsp;<span class="op" id="2893090">:=</span>&nbsp;<span class="ident" id="2893093">r</span><span class="op" id="2893094">.</span><span class="ident" id="2893095">ReadAt</span><span class="op" id="2893101">(</span><span class="ident" id="2893102">buf</span><span class="op" id="2893105">,</span>&nbsp;<span class="ident" id="2893107">size</span><span class="op" id="2893111">-</span><span class="ident" id="2893112">bLen</span><span class="op" id="2893116">)</span><span class="op" id="2893117">;</span>&nbsp;<span class="ident" id="2893119">err</span>&nbsp;<span class="op" id="2893123">!=</span>&nbsp;<span class="ident" id="2893126">nil</span>&nbsp;<span class="op" id="2893130">&amp;&amp;</span>&nbsp;<span class="ident" id="2893133">err</span>&nbsp;<span class="op" id="2893137">!=</span>&nbsp;<span class="ident" id="2893140">io</span><span class="op" id="2893142">.</span><span class="ident" id="2893143">EOF</span>&nbsp;<span class="op" id="2893147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893152">return</span>&nbsp;<span class="ident" id="2893159">nil</span><span class="op" id="2893162">,</span>&nbsp;<span class="ident" id="2893164">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2893170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893174">if</span>&nbsp;<span class="ident" id="2893177">p</span>&nbsp;<span class="op" id="2893179">:=</span>&nbsp;<span class="ident" id="2893182">findSignatureInBlock</span><span class="op" id="2893202">(</span><span class="ident" id="2893203">buf</span><span class="op" id="2893206">)</span><span class="op" id="2893207">;</span>&nbsp;<span class="ident" id="2893209">p</span>&nbsp;<span class="op" id="2893211">&gt;=</span>&nbsp;<span class="num" id="2893214">0</span>&nbsp;<span class="op" id="2893216">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893221">buf</span>&nbsp;<span class="op" id="2893225">=</span>&nbsp;<span class="ident" id="2893227">buf</span><span class="op" id="2893230">[</span><span class="ident" id="2893231">p</span><span class="op" id="2893232">:</span><span class="op" id="2893233">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893238">directoryEndOffset</span>&nbsp;<span class="op" id="2893257">=</span>&nbsp;<span class="ident" id="2893259">size</span>&nbsp;<span class="op" id="2893264">-</span>&nbsp;<span class="ident" id="2893266">bLen</span>&nbsp;<span class="op" id="2893271">+</span>&nbsp;<span class="ident" id="2893273">int64</span><span class="op" id="2893278">(</span><span class="ident" id="2893279">p</span><span class="op" id="2893280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893285">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2893293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893297">if</span>&nbsp;<span class="ident" id="2893300">i</span>&nbsp;<span class="op" id="2893302">==</span>&nbsp;<span class="num" id="2893305">1</span>&nbsp;<span class="op" id="2893307">||</span>&nbsp;<span class="ident" id="2893310">bLen</span>&nbsp;<span class="op" id="2893315">==</span>&nbsp;<span class="ident" id="2893318">size</span>&nbsp;<span class="op" id="2893323">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893328">return</span>&nbsp;<span class="ident" id="2893335">nil</span><span class="op" id="2893338">,</span>&nbsp;<span class="ident" id="2893340">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2893352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2893355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2893359">//&nbsp;read&nbsp;header&nbsp;into&nbsp;struct</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893387">b</span>&nbsp;<span class="op" id="2893389">:=</span>&nbsp;<span class="ident" id="2893392">readBuf</span><span class="op" id="2893399">(</span><span class="ident" id="2893400">buf</span><span class="op" id="2893403">[</span><span class="num" id="2893404">4</span><span class="op" id="2893405">:</span><span class="op" id="2893406">]</span><span class="op" id="2893407">)</span>&nbsp;<span class="comment" id="2893409">//&nbsp;skip&nbsp;signature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893428">d</span>&nbsp;<span class="op" id="2893430">:=</span>&nbsp;<span class="op" id="2893433">&amp;</span><span class="ident" id="2893434">directoryEnd</span><span class="op" id="2893446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893450">diskNbr</span><span class="op" id="2893457">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2893470">uint32</span><span class="op" id="2893476">(</span><span class="ident" id="2893477">b</span><span class="op" id="2893478">.</span><span class="builtintype" id="2893479">uint16</span><span class="op" id="2893485">(</span><span class="op" id="2893486">)</span><span class="op" id="2893487">)</span><span class="op" id="2893488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893492">dirDiskNbr</span><span class="op" id="2893502">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2893512">uint32</span><span class="op" id="2893518">(</span><span class="ident" id="2893519">b</span><span class="op" id="2893520">.</span><span class="builtintype" id="2893521">uint16</span><span class="op" id="2893527">(</span><span class="op" id="2893528">)</span><span class="op" id="2893529">)</span><span class="op" id="2893530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893534">dirRecordsThisDisk</span><span class="op" id="2893552">:</span>&nbsp;<span class="ident" id="2893554">uint64</span><span class="op" id="2893560">(</span><span class="ident" id="2893561">b</span><span class="op" id="2893562">.</span><span class="builtintype" id="2893563">uint16</span><span class="op" id="2893569">(</span><span class="op" id="2893570">)</span><span class="op" id="2893571">)</span><span class="op" id="2893572">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893576">directoryRecords</span><span class="op" id="2893592">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2893596">uint64</span><span class="op" id="2893602">(</span><span class="ident" id="2893603">b</span><span class="op" id="2893604">.</span><span class="builtintype" id="2893605">uint16</span><span class="op" id="2893611">(</span><span class="op" id="2893612">)</span><span class="op" id="2893613">)</span><span class="op" id="2893614">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893618">directorySize</span><span class="op" id="2893631">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2893638">uint64</span><span class="op" id="2893644">(</span><span class="ident" id="2893645">b</span><span class="op" id="2893646">.</span><span class="builtintype" id="2893647">uint32</span><span class="op" id="2893653">(</span><span class="op" id="2893654">)</span><span class="op" id="2893655">)</span><span class="op" id="2893656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893660">directoryOffset</span><span class="op" id="2893675">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2893680">uint64</span><span class="op" id="2893686">(</span><span class="ident" id="2893687">b</span><span class="op" id="2893688">.</span><span class="builtintype" id="2893689">uint32</span><span class="op" id="2893695">(</span><span class="op" id="2893696">)</span><span class="op" id="2893697">)</span><span class="op" id="2893698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893702">commentLen</span><span class="op" id="2893712">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2893722">b</span><span class="op" id="2893723">.</span><span class="builtintype" id="2893724">uint16</span><span class="op" id="2893730">(</span><span class="op" id="2893731">)</span><span class="op" id="2893732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2893735">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893738">l</span>&nbsp;<span class="op" id="2893740">:=</span>&nbsp;<span class="builtintype" id="2893743">int</span><span class="op" id="2893746">(</span><span class="ident" id="2893747">d</span><span class="op" id="2893748">.</span><span class="ident" id="2893749">commentLen</span><span class="op" id="2893759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893762">if</span>&nbsp;<span class="ident" id="2893765">l</span>&nbsp;<span class="op" id="2893767">&gt;</span>&nbsp;<span class="builtinfunc" id="2893769">len</span><span class="op" id="2893772">(</span><span class="ident" id="2893773">b</span><span class="op" id="2893774">)</span>&nbsp;<span class="op" id="2893776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893780">return</span>&nbsp;<span class="ident" id="2893787">nil</span><span class="op" id="2893790">,</span>&nbsp;<span class="ident" id="2893792">errors</span><span class="op" id="2893798">.</span><span class="ident" id="2893799">New</span><span class="op" id="2893802">(</span><span class="string" id="2893803">&#34;zip:&nbsp;invalid&nbsp;comment&nbsp;length&#34;</span><span class="op" id="2893832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2893835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893838">d</span><span class="op" id="2893839">.</span><span class="ident" id="2893840">comment</span>&nbsp;<span class="op" id="2893848">=</span>&nbsp;<span class="builtintype" id="2893850">string</span><span class="op" id="2893856">(</span><span class="ident" id="2893857">b</span><span class="op" id="2893858">[</span><span class="op" id="2893859">:</span><span class="ident" id="2893860">l</span><span class="op" id="2893861">]</span><span class="op" id="2893862">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893866">p</span><span class="op" id="2893867">,</span>&nbsp;<span class="ident" id="2893869">err</span>&nbsp;<span class="op" id="2893873">:=</span>&nbsp;<span class="ident" id="2893876">findDirectory64End</span><span class="op" id="2893894">(</span><span class="ident" id="2893895">r</span><span class="op" id="2893896">,</span>&nbsp;<span class="ident" id="2893898">directoryEndOffset</span><span class="op" id="2893916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893919">if</span>&nbsp;<span class="ident" id="2893922">err</span>&nbsp;<span class="op" id="2893926">==</span>&nbsp;<span class="ident" id="2893929">nil</span>&nbsp;<span class="op" id="2893933">&amp;&amp;</span>&nbsp;<span class="ident" id="2893936">p</span>&nbsp;<span class="op" id="2893938">&gt;=</span>&nbsp;<span class="num" id="2893941">0</span>&nbsp;<span class="op" id="2893943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893947">err</span>&nbsp;<span class="op" id="2893951">=</span>&nbsp;<span class="ident" id="2893953">readDirectory64End</span><span class="op" id="2893971">(</span><span class="ident" id="2893972">r</span><span class="op" id="2893973">,</span>&nbsp;<span class="ident" id="2893975">p</span><span class="op" id="2893976">,</span>&nbsp;<span class="ident" id="2893978">d</span><span class="op" id="2893979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2893982">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893985">if</span>&nbsp;<span class="ident" id="2893988">err</span>&nbsp;<span class="op" id="2893992">!=</span>&nbsp;<span class="ident" id="2893995">nil</span>&nbsp;<span class="op" id="2893999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2894003">return</span>&nbsp;<span class="ident" id="2894010">nil</span><span class="op" id="2894013">,</span>&nbsp;<span class="ident" id="2894015">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2894020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2894024">//&nbsp;Make&nbsp;sure&nbsp;directoryOffset&nbsp;points&nbsp;to&nbsp;somewhere&nbsp;in&nbsp;our&nbsp;file.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2894087">if</span>&nbsp;<span class="ident" id="2894090">o</span>&nbsp;<span class="op" id="2894092">:=</span>&nbsp;<span class="ident" id="2894095">int64</span><span class="op" id="2894100">(</span><span class="ident" id="2894101">d</span><span class="op" id="2894102">.</span><span class="ident" id="2894103">directoryOffset</span><span class="op" id="2894118">)</span><span class="op" id="2894119">;</span>&nbsp;<span class="ident" id="2894121">o</span>&nbsp;<span class="op" id="2894123">&lt;</span>&nbsp;<span class="num" id="2894125">0</span>&nbsp;<span class="op" id="2894127">||</span>&nbsp;<span class="ident" id="2894130">o</span>&nbsp;<span class="op" id="2894132">&gt;=</span>&nbsp;<span class="ident" id="2894135">size</span>&nbsp;<span class="op" id="2894140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2894144">return</span>&nbsp;<span class="ident" id="2894151">nil</span><span class="op" id="2894154">,</span>&nbsp;<span class="ident" id="2894156">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2894167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2894170">return</span>&nbsp;<span class="ident" id="2894177">d</span><span class="op" id="2894178">,</span>&nbsp;<span class="ident" id="2894180">nil</span><br>
<span class="lineno"></span><span class="op" id="2894184">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="2894187">//&nbsp;findDirectory64End&nbsp;tries&nbsp;to&nbsp;read&nbsp;the&nbsp;zip64&nbsp;locator&nbsp;just&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2894257">//&nbsp;directory&nbsp;end&nbsp;and&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2894327">//&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="2894337">func</span>&nbsp;<span class="ident" id="2894342">findDirectory64End</span><span class="op" id="2894360">(</span><span class="ident" id="2894361">r</span>&nbsp;<span class="ident" id="2894363">io</span><span class="op" id="2894365">.</span><span class="ident" id="2894366">ReaderAt</span><span class="op" id="2894374">,</span>&nbsp;<span class="ident" id="2894376">directoryEndOffset</span>&nbsp;<span class="ident" id="2894395">int64</span><span class="op" id="2894400">)</span>&nbsp;<span class="op" id="2894402">(</span><span class="ident" id="2894403">int64</span><span class="op" id="2894408">,</span>&nbsp;<span class="builtintype" id="2894410">error</span><span class="op" id="2894415">)</span>&nbsp;<span class="op" id="2894417">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2894420">locOffset</span>&nbsp;<span class="op" id="2894430">:=</span>&nbsp;<span class="ident" id="2894433">directoryEndOffset</span>&nbsp;<span class="op" id="2894452">-</span>&nbsp;<span class="ident" id="2894454">directory64LocLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2894473">if</span>&nbsp;<span class="ident" id="2894476">locOffset</span>&nbsp;<span class="op" id="2894486">&lt;</span>&nbsp;<span class="num" id="2894488">0</span>&nbsp;<span class="op" id="2894490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2894494">return</span>&nbsp;<span class="op" id="2894501">-</span><span class="num" id="2894502">1</span><span class="op" id="2894503">,</span>&nbsp;<span class="ident" id="2894505">nil</span>&nbsp;<span class="comment" id="2894509">//&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;a&nbsp;header&nbsp;outside&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2894559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2894562">buf</span>&nbsp;<span class="op" id="2894566">:=</span>&nbsp;<span class="builtinfunc" id="2894569">make</span><span class="op" id="2894573">(</span><span class="op" id="2894574">[</span><span class="op" id="2894575">]</span><span class="builtintype" id="2894576">byte</span><span class="op" id="2894580">,</span>&nbsp;<span class="ident" id="2894582">directory64LocLen</span><span class="op" id="2894599">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2894602">if</span>&nbsp;<span class="ident" id="2894605">_</span><span class="op" id="2894606">,</span>&nbsp;<span class="ident" id="2894608">err</span>&nbsp;<span class="op" id="2894612">:=</span>&nbsp;<span class="ident" id="2894615">r</span><span class="op" id="2894616">.</span><span class="ident" id="2894617">ReadAt</span><span class="op" id="2894623">(</span><span class="ident" id="2894624">buf</span><span class="op" id="2894627">,</span>&nbsp;<span class="ident" id="2894629">locOffset</span><span class="op" id="2894638">)</span><span class="op" id="2894639">;</span>&nbsp;<span class="ident" id="2894641">err</span>&nbsp;<span class="op" id="2894645">!=</span>&nbsp;<span class="ident" id="2894648">nil</span>&nbsp;<span class="op" id="2894652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2894656">return</span>&nbsp;<span class="op" id="2894663">-</span><span class="num" id="2894664">1</span><span class="op" id="2894665">,</span>&nbsp;<span class="ident" id="2894667">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2894672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2894675">b</span>&nbsp;<span class="op" id="2894677">:=</span>&nbsp;<span class="ident" id="2894680">readBuf</span><span class="op" id="2894687">(</span><span class="ident" id="2894688">buf</span><span class="op" id="2894691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2894694">if</span>&nbsp;<span class="ident" id="2894697">sig</span>&nbsp;<span class="op" id="2894701">:=</span>&nbsp;<span class="ident" id="2894704">b</span><span class="op" id="2894705">.</span><span class="builtintype" id="2894706">uint32</span><span class="op" id="2894712">(</span><span class="op" id="2894713">)</span><span class="op" id="2894714">;</span>&nbsp;<span class="ident" id="2894716">sig</span>&nbsp;<span class="op" id="2894720">!=</span>&nbsp;<span class="ident" id="2894723">directory64LocSignature</span>&nbsp;<span class="op" id="2894747">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2894751">return</span>&nbsp;<span class="op" id="2894758">-</span><span class="num" id="2894759">1</span><span class="op" id="2894760">,</span>&nbsp;<span class="ident" id="2894762">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2894767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2894770">b</span>&nbsp;<span class="op" id="2894772">=</span>&nbsp;<span class="ident" id="2894774">b</span><span class="op" id="2894775">[</span><span class="num" id="2894776">4</span><span class="op" id="2894777">:</span><span class="op" id="2894778">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2894786">//&nbsp;skip&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2894867">p</span>&nbsp;<span class="op" id="2894869">:=</span>&nbsp;<span class="ident" id="2894872">b</span><span class="op" id="2894873">.</span><span class="ident" id="2894874">uint64</span><span class="op" id="2894880">(</span><span class="op" id="2894881">)</span>&nbsp;<span class="comment" id="2894883">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2894948">return</span>&nbsp;<span class="ident" id="2894955">int64</span><span class="op" id="2894960">(</span><span class="ident" id="2894961">p</span><span class="op" id="2894962">)</span><span class="op" id="2894963">,</span>&nbsp;<span class="ident" id="2894965">nil</span><br>
<span class="lineno">395</span><span class="op" id="2894969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2894972">//&nbsp;readDirectory64End&nbsp;reads&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;and&nbsp;updates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2895040">//&nbsp;directory&nbsp;end&nbsp;with&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="2895094">func</span>&nbsp;<span class="ident" id="2895099">readDirectory64End</span><span class="op" id="2895117">(</span><span class="ident" id="2895118">r</span>&nbsp;<span class="ident" id="2895120">io</span><span class="op" id="2895122">.</span><span class="ident" id="2895123">ReaderAt</span><span class="op" id="2895131">,</span>&nbsp;<span class="ident" id="2895133">offset</span>&nbsp;<span class="ident" id="2895140">int64</span><span class="op" id="2895145">,</span>&nbsp;<span class="ident" id="2895147">d</span>&nbsp;<span class="op" id="2895149">*</span><span class="ident" id="2895150">directoryEnd</span><span class="op" id="2895162">)</span>&nbsp;<span class="op" id="2895164">(</span><span class="ident" id="2895165">err</span>&nbsp;<span class="builtintype" id="2895169">error</span><span class="op" id="2895174">)</span>&nbsp;<span class="op" id="2895176">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2895179">buf</span>&nbsp;<span class="op" id="2895183">:=</span>&nbsp;<span class="builtinfunc" id="2895186">make</span><span class="op" id="2895190">(</span><span class="op" id="2895191">[</span><span class="op" id="2895192">]</span><span class="builtintype" id="2895193">byte</span><span class="op" id="2895197">,</span>&nbsp;<span class="ident" id="2895199">directory64EndLen</span><span class="op" id="2895216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2895219">if</span>&nbsp;<span class="ident" id="2895222">_</span><span class="op" id="2895223">,</span>&nbsp;<span class="ident" id="2895225">err</span>&nbsp;<span class="op" id="2895229">:=</span>&nbsp;<span class="ident" id="2895232">r</span><span class="op" id="2895233">.</span><span class="ident" id="2895234">ReadAt</span><span class="op" id="2895240">(</span><span class="ident" id="2895241">buf</span><span class="op" id="2895244">,</span>&nbsp;<span class="ident" id="2895246">offset</span><span class="op" id="2895252">)</span><span class="op" id="2895253">;</span>&nbsp;<span class="ident" id="2895255">err</span>&nbsp;<span class="op" id="2895259">!=</span>&nbsp;<span class="ident" id="2895262">nil</span>&nbsp;<span class="op" id="2895266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2895270">return</span>&nbsp;<span class="ident" id="2895277">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2895282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2895286">b</span>&nbsp;<span class="op" id="2895288">:=</span>&nbsp;<span class="ident" id="2895291">readBuf</span><span class="op" id="2895298">(</span><span class="ident" id="2895299">buf</span><span class="op" id="2895302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2895305">if</span>&nbsp;<span class="ident" id="2895308">sig</span>&nbsp;<span class="op" id="2895312">:=</span>&nbsp;<span class="ident" id="2895315">b</span><span class="op" id="2895316">.</span><span class="builtintype" id="2895317">uint32</span><span class="op" id="2895323">(</span><span class="op" id="2895324">)</span><span class="op" id="2895325">;</span>&nbsp;<span class="ident" id="2895327">sig</span>&nbsp;<span class="op" id="2895331">!=</span>&nbsp;<span class="ident" id="2895334">directory64EndSignature</span>&nbsp;<span class="op" id="2895358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2895362">return</span>&nbsp;<span class="ident" id="2895369">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2895380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2895384">b</span>&nbsp;<span class="op" id="2895386">=</span>&nbsp;<span class="ident" id="2895388">b</span><span class="op" id="2895389">[</span><span class="num" id="2895390">12</span><span class="op" id="2895392">:</span><span class="op" id="2895393">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2895418">//&nbsp;skip&nbsp;dir&nbsp;size,&nbsp;version&nbsp;and&nbsp;version&nbsp;needed&nbsp;(uint64&nbsp;+&nbsp;2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2895485">d</span><span class="op" id="2895486">.</span><span class="ident" id="2895487">diskNbr</span>&nbsp;<span class="op" id="2895495">=</span>&nbsp;<span class="ident" id="2895497">b</span><span class="op" id="2895498">.</span><span class="builtintype" id="2895499">uint32</span><span class="op" id="2895505">(</span><span class="op" id="2895506">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2895519">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2895543">d</span><span class="op" id="2895544">.</span><span class="ident" id="2895545">dirDiskNbr</span>&nbsp;<span class="op" id="2895556">=</span>&nbsp;<span class="ident" id="2895558">b</span><span class="op" id="2895559">.</span><span class="builtintype" id="2895560">uint32</span><span class="op" id="2895566">(</span><span class="op" id="2895567">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2895577">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2895640">d</span><span class="op" id="2895641">.</span><span class="ident" id="2895642">dirRecordsThisDisk</span>&nbsp;<span class="op" id="2895661">=</span>&nbsp;<span class="ident" id="2895663">b</span><span class="op" id="2895664">.</span><span class="ident" id="2895665">uint64</span><span class="op" id="2895671">(</span><span class="op" id="2895672">)</span>&nbsp;<span class="comment" id="2895674">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2895740">d</span><span class="op" id="2895741">.</span><span class="ident" id="2895742">directoryRecords</span>&nbsp;<span class="op" id="2895759">=</span>&nbsp;<span class="ident" id="2895761">b</span><span class="op" id="2895762">.</span><span class="ident" id="2895763">uint64</span><span class="op" id="2895769">(</span><span class="op" id="2895770">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="2895774">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2895827">d</span><span class="op" id="2895828">.</span><span class="ident" id="2895829">directorySize</span>&nbsp;<span class="op" id="2895843">=</span>&nbsp;<span class="ident" id="2895845">b</span><span class="op" id="2895846">.</span><span class="ident" id="2895847">uint64</span><span class="op" id="2895853">(</span><span class="op" id="2895854">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2895861">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2895895">d</span><span class="op" id="2895896">.</span><span class="ident" id="2895897">directoryOffset</span>&nbsp;<span class="op" id="2895913">=</span>&nbsp;<span class="ident" id="2895915">b</span><span class="op" id="2895916">.</span><span class="ident" id="2895917">uint64</span><span class="op" id="2895923">(</span><span class="op" id="2895924">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2895929">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896012">return</span>&nbsp;<span class="ident" id="2896019">nil</span><br>
<span class="lineno"></span><span class="op" id="2896023">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="2896026">func</span>&nbsp;<span class="ident" id="2896031">findSignatureInBlock</span><span class="op" id="2896051">(</span><span class="ident" id="2896052">b</span>&nbsp;<span class="op" id="2896054">[</span><span class="op" id="2896055">]</span><span class="builtintype" id="2896056">byte</span><span class="op" id="2896060">)</span>&nbsp;<span class="builtintype" id="2896062">int</span>&nbsp;<span class="op" id="2896066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896069">for</span>&nbsp;<span class="ident" id="2896073">i</span>&nbsp;<span class="op" id="2896075">:=</span>&nbsp;<span class="builtinfunc" id="2896078">len</span><span class="op" id="2896081">(</span><span class="ident" id="2896082">b</span><span class="op" id="2896083">)</span>&nbsp;<span class="op" id="2896085">-</span>&nbsp;<span class="ident" id="2896087">directoryEndLen</span><span class="op" id="2896102">;</span>&nbsp;<span class="ident" id="2896104">i</span>&nbsp;<span class="op" id="2896106">&gt;=</span>&nbsp;<span class="num" id="2896109">0</span><span class="op" id="2896110">;</span>&nbsp;<span class="ident" id="2896112">i</span><span class="op" id="2896113">--</span>&nbsp;<span class="op" id="2896116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2896120">//&nbsp;defined&nbsp;from&nbsp;directoryEndSignature&nbsp;in&nbsp;struct.go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896173">if</span>&nbsp;<span class="ident" id="2896176">b</span><span class="op" id="2896177">[</span><span class="ident" id="2896178">i</span><span class="op" id="2896179">]</span>&nbsp;<span class="op" id="2896181">==</span>&nbsp;<span class="string" id="2896184">&#39;P&#39;</span>&nbsp;<span class="op" id="2896188">&amp;&amp;</span>&nbsp;<span class="ident" id="2896191">b</span><span class="op" id="2896192">[</span><span class="ident" id="2896193">i</span><span class="op" id="2896194">+</span><span class="num" id="2896195">1</span><span class="op" id="2896196">]</span>&nbsp;<span class="op" id="2896198">==</span>&nbsp;<span class="string" id="2896201">&#39;K&#39;</span>&nbsp;<span class="op" id="2896205">&amp;&amp;</span>&nbsp;<span class="ident" id="2896208">b</span><span class="op" id="2896209">[</span><span class="ident" id="2896210">i</span><span class="op" id="2896211">+</span><span class="num" id="2896212">2</span><span class="op" id="2896213">]</span>&nbsp;<span class="op" id="2896215">==</span>&nbsp;<span class="num" id="2896218">0x05</span>&nbsp;<span class="op" id="2896223">&amp;&amp;</span>&nbsp;<span class="ident" id="2896226">b</span><span class="op" id="2896227">[</span><span class="ident" id="2896228">i</span><span class="op" id="2896229">+</span><span class="num" id="2896230">3</span><span class="op" id="2896231">]</span>&nbsp;<span class="op" id="2896233">==</span>&nbsp;<span class="num" id="2896236">0x06</span>&nbsp;<span class="op" id="2896241">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2896246">//&nbsp;n&nbsp;is&nbsp;length&nbsp;of&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2896275">n</span>&nbsp;<span class="op" id="2896277">:=</span>&nbsp;<span class="builtintype" id="2896280">int</span><span class="op" id="2896283">(</span><span class="ident" id="2896284">b</span><span class="op" id="2896285">[</span><span class="ident" id="2896286">i</span><span class="op" id="2896287">+</span><span class="ident" id="2896288">directoryEndLen</span><span class="op" id="2896303">-</span><span class="num" id="2896304">2</span><span class="op" id="2896305">]</span><span class="op" id="2896306">)</span>&nbsp;<span class="op" id="2896308">|</span>&nbsp;<span class="builtintype" id="2896310">int</span><span class="op" id="2896313">(</span><span class="ident" id="2896314">b</span><span class="op" id="2896315">[</span><span class="ident" id="2896316">i</span><span class="op" id="2896317">+</span><span class="ident" id="2896318">directoryEndLen</span><span class="op" id="2896333">-</span><span class="num" id="2896334">1</span><span class="op" id="2896335">]</span><span class="op" id="2896336">)</span><span class="op" id="2896337">&lt;&lt;</span><span class="num" id="2896339">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896344">if</span>&nbsp;<span class="ident" id="2896347">n</span><span class="op" id="2896348">+</span><span class="ident" id="2896349">directoryEndLen</span><span class="op" id="2896364">+</span><span class="ident" id="2896365">i</span>&nbsp;<span class="op" id="2896367">&lt;=</span>&nbsp;<span class="builtinfunc" id="2896370">len</span><span class="op" id="2896373">(</span><span class="ident" id="2896374">b</span><span class="op" id="2896375">)</span>&nbsp;<span class="op" id="2896377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896383">return</span>&nbsp;<span class="ident" id="2896390">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2896395">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2896399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2896402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896405">return</span>&nbsp;<span class="op" id="2896412">-</span><span class="num" id="2896413">1</span><br>
<span class="lineno"></span><span class="op" id="2896415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="2896418">type</span>&nbsp;<span class="ident" id="2896423">readBuf</span>&nbsp;<span class="op" id="2896431">[</span><span class="op" id="2896432">]</span><span class="builtintype" id="2896433">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2896439">func</span>&nbsp;<span class="op" id="2896444">(</span><span class="ident" id="2896445">b</span>&nbsp;<span class="op" id="2896447">*</span><span class="ident" id="2896448">readBuf</span><span class="op" id="2896455">)</span>&nbsp;<span class="builtintype" id="2896457">uint16</span><span class="op" id="2896463">(</span><span class="op" id="2896464">)</span>&nbsp;<span class="builtintype" id="2896466">uint16</span>&nbsp;<span class="op" id="2896473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2896476">v</span>&nbsp;<span class="op" id="2896478">:=</span>&nbsp;<span class="ident" id="2896481">binary</span><span class="op" id="2896487">.</span><span class="ident" id="2896488">LittleEndian</span><span class="op" id="2896500">.</span><span class="ident" id="2896501">Uint16</span><span class="op" id="2896507">(</span><span class="op" id="2896508">*</span><span class="ident" id="2896509">b</span><span class="op" id="2896510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2896513">*</span><span class="ident" id="2896514">b</span>&nbsp;<span class="op" id="2896516">=</span>&nbsp;<span class="op" id="2896518">(</span><span class="op" id="2896519">*</span><span class="ident" id="2896520">b</span><span class="op" id="2896521">)</span><span class="op" id="2896522">[</span><span class="num" id="2896523">2</span><span class="op" id="2896524">:</span><span class="op" id="2896525">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896528">return</span>&nbsp;<span class="ident" id="2896535">v</span><br>
<span class="lineno"></span><span class="op" id="2896537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2896540">func</span>&nbsp;<span class="op" id="2896545">(</span><span class="ident" id="2896546">b</span>&nbsp;<span class="op" id="2896548">*</span><span class="ident" id="2896549">readBuf</span><span class="op" id="2896556">)</span>&nbsp;<span class="builtintype" id="2896558">uint32</span><span class="op" id="2896564">(</span><span class="op" id="2896565">)</span>&nbsp;<span class="builtintype" id="2896567">uint32</span>&nbsp;<span class="op" id="2896574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2896577">v</span>&nbsp;<span class="op" id="2896579">:=</span>&nbsp;<span class="ident" id="2896582">binary</span><span class="op" id="2896588">.</span><span class="ident" id="2896589">LittleEndian</span><span class="op" id="2896601">.</span><span class="ident" id="2896602">Uint32</span><span class="op" id="2896608">(</span><span class="op" id="2896609">*</span><span class="ident" id="2896610">b</span><span class="op" id="2896611">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2896614">*</span><span class="ident" id="2896615">b</span>&nbsp;<span class="op" id="2896617">=</span>&nbsp;<span class="op" id="2896619">(</span><span class="op" id="2896620">*</span><span class="ident" id="2896621">b</span><span class="op" id="2896622">)</span><span class="op" id="2896623">[</span><span class="num" id="2896624">4</span><span class="op" id="2896625">:</span><span class="op" id="2896626">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896629">return</span>&nbsp;<span class="ident" id="2896636">v</span><br>
<span class="lineno"></span><span class="op" id="2896638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2896641">func</span>&nbsp;<span class="op" id="2896646">(</span><span class="ident" id="2896647">b</span>&nbsp;<span class="op" id="2896649">*</span><span class="ident" id="2896650">readBuf</span><span class="op" id="2896657">)</span>&nbsp;<span class="ident" id="2896659">uint64</span><span class="op" id="2896665">(</span><span class="op" id="2896666">)</span>&nbsp;<span class="ident" id="2896668">uint64</span>&nbsp;<span class="op" id="2896675">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2896678">v</span>&nbsp;<span class="op" id="2896680">:=</span>&nbsp;<span class="ident" id="2896683">binary</span><span class="op" id="2896689">.</span><span class="ident" id="2896690">LittleEndian</span><span class="op" id="2896702">.</span><span class="ident" id="2896703">Uint64</span><span class="op" id="2896709">(</span><span class="op" id="2896710">*</span><span class="ident" id="2896711">b</span><span class="op" id="2896712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2896715">*</span><span class="ident" id="2896716">b</span>&nbsp;<span class="op" id="2896718">=</span>&nbsp;<span class="op" id="2896720">(</span><span class="op" id="2896721">*</span><span class="ident" id="2896722">b</span><span class="op" id="2896723">)</span><span class="op" id="2896724">[</span><span class="num" id="2896725">8</span><span class="op" id="2896726">:</span><span class="op" id="2896727">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896730">return</span>&nbsp;<span class="ident" id="2896737">v</span><br>
<span class="lineno"></span><span class="op" id="2896739">}</span>
</div>
</body>
</html>
