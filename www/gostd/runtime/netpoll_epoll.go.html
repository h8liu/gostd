<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1981356">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1981411">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1981465">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1981516">//&nbsp;+build&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1981533">package</span>&nbsp;<span class="ident" id="1981541">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1981550">import</span>&nbsp;<span class="string" id="1981557">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1981567">func</span>&nbsp;<span class="ident" id="1981572">epollcreate</span><span class="op" id="1981583">(</span><span class="ident" id="1981584">size</span>&nbsp;<span class="builtintype" id="1981589">int32</span><span class="op" id="1981594">)</span>&nbsp;<span class="builtintype" id="1981596">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1981602">func</span>&nbsp;<span class="ident" id="1981607">epollcreate1</span><span class="op" id="1981619">(</span><span class="ident" id="1981620">flags</span>&nbsp;<span class="builtintype" id="1981626">int32</span><span class="op" id="1981631">)</span>&nbsp;<span class="builtintype" id="1981633">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1981640">//go:noescape</span><br>
<span class="lineno">15</span><span class="keyword" id="1981654">func</span>&nbsp;<span class="ident" id="1981659">epollctl</span><span class="op" id="1981667">(</span><span class="ident" id="1981668">epfd</span><span class="op" id="1981672">,</span>&nbsp;<span class="ident" id="1981674">op</span><span class="op" id="1981676">,</span>&nbsp;<span class="ident" id="1981678">fd</span>&nbsp;<span class="builtintype" id="1981681">int32</span><span class="op" id="1981686">,</span>&nbsp;<span class="ident" id="1981688">ev</span>&nbsp;<span class="op" id="1981691">*</span><span class="ident" id="1981692">epollevent</span><span class="op" id="1981702">)</span>&nbsp;<span class="builtintype" id="1981704">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1981711">//go:noescape</span><br>
<span class="lineno"></span><span class="keyword" id="1981725">func</span>&nbsp;<span class="ident" id="1981730">epollwait</span><span class="op" id="1981739">(</span><span class="ident" id="1981740">epfd</span>&nbsp;<span class="builtintype" id="1981745">int32</span><span class="op" id="1981750">,</span>&nbsp;<span class="ident" id="1981752">ev</span>&nbsp;<span class="op" id="1981755">*</span><span class="ident" id="1981756">epollevent</span><span class="op" id="1981766">,</span>&nbsp;<span class="ident" id="1981768">nev</span><span class="op" id="1981771">,</span>&nbsp;<span class="ident" id="1981773">timeout</span>&nbsp;<span class="builtintype" id="1981781">int32</span><span class="op" id="1981786">)</span>&nbsp;<span class="builtintype" id="1981788">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1981794">func</span>&nbsp;<span class="ident" id="1981799">closeonexec</span><span class="op" id="1981810">(</span><span class="ident" id="1981811">fd</span>&nbsp;<span class="builtintype" id="1981814">int32</span><span class="op" id="1981819">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1981822">var</span>&nbsp;<span class="op" id="1981826">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1981829">epfd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1981844">int32</span>&nbsp;<span class="op" id="1981850">=</span>&nbsp;<span class="op" id="1981852">-</span><span class="num" id="1981853">1</span>&nbsp;<span class="comment" id="1981855">//&nbsp;epoll&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1981876">netpolllasterr</span>&nbsp;<span class="builtintype" id="1981891">int32</span><br>
<span class="lineno"></span><span class="op" id="1981897">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="1981900">func</span>&nbsp;<span class="ident" id="1981905">netpollinit</span><span class="op" id="1981916">(</span><span class="op" id="1981917">)</span>&nbsp;<span class="op" id="1981919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1981922">epfd</span>&nbsp;<span class="op" id="1981927">=</span>&nbsp;<span class="ident" id="1981929">epollcreate1</span><span class="op" id="1981941">(</span><span class="ident" id="1981942">_EPOLL_CLOEXEC</span><span class="op" id="1981956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1981959">if</span>&nbsp;<span class="ident" id="1981962">epfd</span>&nbsp;<span class="op" id="1981967">&gt;=</span>&nbsp;<span class="num" id="1981970">0</span>&nbsp;<span class="op" id="1981972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1981976">return</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1981984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1981987">epfd</span>&nbsp;<span class="op" id="1981992">=</span>&nbsp;<span class="ident" id="1981994">epollcreate</span><span class="op" id="1982005">(</span><span class="num" id="1982006">1024</span><span class="op" id="1982010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982013">if</span>&nbsp;<span class="ident" id="1982016">epfd</span>&nbsp;<span class="op" id="1982021">&gt;=</span>&nbsp;<span class="num" id="1982024">0</span>&nbsp;<span class="op" id="1982026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982030">closeonexec</span><span class="op" id="1982041">(</span><span class="ident" id="1982042">epfd</span><span class="op" id="1982046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982050">return</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1982058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1982061">println</span><span class="op" id="1982068">(</span><span class="string" id="1982069">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;epoll&nbsp;descriptor&#34;</span><span class="op" id="1982117">,</span>&nbsp;<span class="op" id="1982119">-</span><span class="ident" id="1982120">epfd</span><span class="op" id="1982124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982127">gothrow</span><span class="op" id="1982134">(</span><span class="string" id="1982135">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;descriptor&#34;</span><span class="op" id="1982177">)</span><br>
<span class="lineno"></span><span class="op" id="1982179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="1982182">func</span>&nbsp;<span class="ident" id="1982187">netpollopen</span><span class="op" id="1982198">(</span><span class="ident" id="1982199">fd</span>&nbsp;<span class="builtintype" id="1982202">uintptr</span><span class="op" id="1982209">,</span>&nbsp;<span class="ident" id="1982211">pd</span>&nbsp;<span class="op" id="1982214">*</span><span class="ident" id="1982215">pollDesc</span><span class="op" id="1982223">)</span>&nbsp;<span class="builtintype" id="1982225">int32</span>&nbsp;<span class="op" id="1982231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982234">var</span>&nbsp;<span class="ident" id="1982238">ev</span>&nbsp;<span class="ident" id="1982241">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982253">ev</span><span class="op" id="1982255">.</span><span class="ident" id="1982256">events</span>&nbsp;<span class="op" id="1982263">=</span>&nbsp;<span class="ident" id="1982265">_EPOLLIN</span>&nbsp;<span class="op" id="1982274">|</span>&nbsp;<span class="ident" id="1982276">_EPOLLOUT</span>&nbsp;<span class="op" id="1982286">|</span>&nbsp;<span class="ident" id="1982288">_EPOLLRDHUP</span>&nbsp;<span class="op" id="1982300">|</span>&nbsp;<span class="ident" id="1982302">_EPOLLET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1982312">*</span><span class="op" id="1982313">(</span><span class="op" id="1982314">*</span><span class="op" id="1982315">*</span><span class="ident" id="1982316">pollDesc</span><span class="op" id="1982324">)</span><span class="op" id="1982325">(</span><span class="ident" id="1982326">unsafe</span><span class="op" id="1982332">.</span><span class="ident" id="1982333">Pointer</span><span class="op" id="1982340">(</span><span class="op" id="1982341">&amp;</span><span class="ident" id="1982342">ev</span><span class="op" id="1982344">.</span><span class="ident" id="1982345">data</span><span class="op" id="1982349">)</span><span class="op" id="1982350">)</span>&nbsp;<span class="op" id="1982352">=</span>&nbsp;<span class="ident" id="1982354">pd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982358">return</span>&nbsp;<span class="op" id="1982365">-</span><span class="ident" id="1982366">epollctl</span><span class="op" id="1982374">(</span><span class="ident" id="1982375">epfd</span><span class="op" id="1982379">,</span>&nbsp;<span class="ident" id="1982381">_EPOLL_CTL_ADD</span><span class="op" id="1982395">,</span>&nbsp;<span class="builtintype" id="1982397">int32</span><span class="op" id="1982402">(</span><span class="ident" id="1982403">fd</span><span class="op" id="1982405">)</span><span class="op" id="1982406">,</span>&nbsp;<span class="op" id="1982408">&amp;</span><span class="ident" id="1982409">ev</span><span class="op" id="1982411">)</span><br>
<span class="lineno">45</span><span class="op" id="1982413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1982416">func</span>&nbsp;<span class="ident" id="1982421">netpollclose</span><span class="op" id="1982433">(</span><span class="ident" id="1982434">fd</span>&nbsp;<span class="builtintype" id="1982437">uintptr</span><span class="op" id="1982444">)</span>&nbsp;<span class="builtintype" id="1982446">int32</span>&nbsp;<span class="op" id="1982452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982455">var</span>&nbsp;<span class="ident" id="1982459">ev</span>&nbsp;<span class="ident" id="1982462">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982474">return</span>&nbsp;<span class="op" id="1982481">-</span><span class="ident" id="1982482">epollctl</span><span class="op" id="1982490">(</span><span class="ident" id="1982491">epfd</span><span class="op" id="1982495">,</span>&nbsp;<span class="ident" id="1982497">_EPOLL_CTL_DEL</span><span class="op" id="1982511">,</span>&nbsp;<span class="builtintype" id="1982513">int32</span><span class="op" id="1982518">(</span><span class="ident" id="1982519">fd</span><span class="op" id="1982521">)</span><span class="op" id="1982522">,</span>&nbsp;<span class="op" id="1982524">&amp;</span><span class="ident" id="1982525">ev</span><span class="op" id="1982527">)</span><br>
<span class="lineno">50</span><span class="op" id="1982529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1982532">func</span>&nbsp;<span class="ident" id="1982537">netpollarm</span><span class="op" id="1982547">(</span><span class="ident" id="1982548">pd</span>&nbsp;<span class="op" id="1982551">*</span><span class="ident" id="1982552">pollDesc</span><span class="op" id="1982560">,</span>&nbsp;<span class="ident" id="1982562">mode</span>&nbsp;<span class="builtintype" id="1982567">int</span><span class="op" id="1982570">)</span>&nbsp;<span class="op" id="1982572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982575">gothrow</span><span class="op" id="1982582">(</span><span class="string" id="1982583">&#34;unused&#34;</span><span class="op" id="1982591">)</span><br>
<span class="lineno"></span><span class="op" id="1982593">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="1982596">//&nbsp;polls&nbsp;for&nbsp;ready&nbsp;network&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="1982635">//&nbsp;returns&nbsp;list&nbsp;of&nbsp;goroutines&nbsp;that&nbsp;become&nbsp;runnable</span><br>
<span class="lineno"></span><span class="keyword" id="1982686">func</span>&nbsp;<span class="ident" id="1982691">netpoll</span><span class="op" id="1982698">(</span><span class="ident" id="1982699">block</span>&nbsp;<span class="builtintype" id="1982705">bool</span><span class="op" id="1982709">)</span>&nbsp;<span class="op" id="1982711">(</span><span class="ident" id="1982712">gp</span>&nbsp;<span class="op" id="1982715">*</span><span class="ident" id="1982716">g</span><span class="op" id="1982717">)</span>&nbsp;<span class="op" id="1982719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982722">if</span>&nbsp;<span class="ident" id="1982725">epfd</span>&nbsp;<span class="op" id="1982730">==</span>&nbsp;<span class="op" id="1982733">-</span><span class="num" id="1982734">1</span>&nbsp;<span class="op" id="1982736">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982740">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1982748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982751">waitms</span>&nbsp;<span class="op" id="1982758">:=</span>&nbsp;<span class="builtintype" id="1982761">int32</span><span class="op" id="1982766">(</span><span class="op" id="1982767">-</span><span class="num" id="1982768">1</span><span class="op" id="1982769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982772">if</span>&nbsp;<span class="op" id="1982775">!</span><span class="ident" id="1982776">block</span>&nbsp;<span class="op" id="1982782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982786">waitms</span>&nbsp;<span class="op" id="1982793">=</span>&nbsp;<span class="num" id="1982795">0</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1982798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982801">var</span>&nbsp;<span class="ident" id="1982805">events</span>&nbsp;<span class="op" id="1982812">[</span><span class="num" id="1982813">128</span><span class="op" id="1982816">]</span><span class="ident" id="1982817">epollevent</span><br>
<span class="lineno"></span><span class="ident" id="1982828">retry</span><span class="op" id="1982833">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982836">n</span>&nbsp;<span class="op" id="1982838">:=</span>&nbsp;<span class="ident" id="1982841">epollwait</span><span class="op" id="1982850">(</span><span class="ident" id="1982851">epfd</span><span class="op" id="1982855">,</span>&nbsp;<span class="op" id="1982857">&amp;</span><span class="ident" id="1982858">events</span><span class="op" id="1982864">[</span><span class="num" id="1982865">0</span><span class="op" id="1982866">]</span><span class="op" id="1982867">,</span>&nbsp;<span class="builtintype" id="1982869">int32</span><span class="op" id="1982874">(</span><span class="builtinfunc" id="1982875">len</span><span class="op" id="1982878">(</span><span class="ident" id="1982879">events</span><span class="op" id="1982885">)</span><span class="op" id="1982886">)</span><span class="op" id="1982887">,</span>&nbsp;<span class="ident" id="1982889">waitms</span><span class="op" id="1982895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982898">if</span>&nbsp;<span class="ident" id="1982901">n</span>&nbsp;<span class="op" id="1982903">&lt;</span>&nbsp;<span class="num" id="1982905">0</span>&nbsp;<span class="op" id="1982907">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982911">if</span>&nbsp;<span class="ident" id="1982914">n</span>&nbsp;<span class="op" id="1982916">!=</span>&nbsp;<span class="op" id="1982919">-</span><span class="ident" id="1982920">_EINTR</span>&nbsp;<span class="op" id="1982927">&amp;&amp;</span>&nbsp;<span class="ident" id="1982930">n</span>&nbsp;<span class="op" id="1982932">!=</span>&nbsp;<span class="ident" id="1982935">netpolllasterr</span>&nbsp;<span class="op" id="1982950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982955">netpolllasterr</span>&nbsp;<span class="op" id="1982970">=</span>&nbsp;<span class="ident" id="1982972">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1982977">println</span><span class="op" id="1982984">(</span><span class="string" id="1982985">&#34;runtime:&nbsp;epollwait&nbsp;on&nbsp;fd&#34;</span><span class="op" id="1983011">,</span>&nbsp;<span class="ident" id="1983013">epfd</span><span class="op" id="1983017">,</span>&nbsp;<span class="string" id="1983019">&#34;failed&nbsp;with&#34;</span><span class="op" id="1983032">,</span>&nbsp;<span class="op" id="1983034">-</span><span class="ident" id="1983035">n</span><span class="op" id="1983036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1983040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983044">goto</span>&nbsp;<span class="ident" id="1983049">retry</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1983056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983059">for</span>&nbsp;<span class="ident" id="1983063">i</span>&nbsp;<span class="op" id="1983065">:=</span>&nbsp;<span class="builtintype" id="1983068">int32</span><span class="op" id="1983073">(</span><span class="num" id="1983074">0</span><span class="op" id="1983075">)</span><span class="op" id="1983076">;</span>&nbsp;<span class="ident" id="1983078">i</span>&nbsp;<span class="op" id="1983080">&lt;</span>&nbsp;<span class="ident" id="1983082">n</span><span class="op" id="1983083">;</span>&nbsp;<span class="ident" id="1983085">i</span><span class="op" id="1983086">++</span>&nbsp;<span class="op" id="1983089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983093">ev</span>&nbsp;<span class="op" id="1983096">:=</span>&nbsp;<span class="op" id="1983099">&amp;</span><span class="ident" id="1983100">events</span><span class="op" id="1983106">[</span><span class="ident" id="1983107">i</span><span class="op" id="1983108">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983112">if</span>&nbsp;<span class="ident" id="1983115">ev</span><span class="op" id="1983117">.</span><span class="ident" id="1983118">events</span>&nbsp;<span class="op" id="1983125">==</span>&nbsp;<span class="num" id="1983128">0</span>&nbsp;<span class="op" id="1983130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983135">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1983146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983150">var</span>&nbsp;<span class="ident" id="1983154">mode</span>&nbsp;<span class="builtintype" id="1983159">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983167">if</span>&nbsp;<span class="ident" id="1983170">ev</span><span class="op" id="1983172">.</span><span class="ident" id="1983173">events</span><span class="op" id="1983179">&amp;</span><span class="op" id="1983180">(</span><span class="ident" id="1983181">_EPOLLIN</span><span class="op" id="1983189">|</span><span class="ident" id="1983190">_EPOLLRDHUP</span><span class="op" id="1983201">|</span><span class="ident" id="1983202">_EPOLLHUP</span><span class="op" id="1983211">|</span><span class="ident" id="1983212">_EPOLLERR</span><span class="op" id="1983221">)</span>&nbsp;<span class="op" id="1983223">!=</span>&nbsp;<span class="num" id="1983226">0</span>&nbsp;<span class="op" id="1983228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983233">mode</span>&nbsp;<span class="op" id="1983238">+=</span>&nbsp;<span class="string" id="1983241">&#39;r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1983247">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983251">if</span>&nbsp;<span class="ident" id="1983254">ev</span><span class="op" id="1983256">.</span><span class="ident" id="1983257">events</span><span class="op" id="1983263">&amp;</span><span class="op" id="1983264">(</span><span class="ident" id="1983265">_EPOLLOUT</span><span class="op" id="1983274">|</span><span class="ident" id="1983275">_EPOLLHUP</span><span class="op" id="1983284">|</span><span class="ident" id="1983285">_EPOLLERR</span><span class="op" id="1983294">)</span>&nbsp;<span class="op" id="1983296">!=</span>&nbsp;<span class="num" id="1983299">0</span>&nbsp;<span class="op" id="1983301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983306">mode</span>&nbsp;<span class="op" id="1983311">+=</span>&nbsp;<span class="string" id="1983314">&#39;w&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1983320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983324">if</span>&nbsp;<span class="ident" id="1983327">mode</span>&nbsp;<span class="op" id="1983332">!=</span>&nbsp;<span class="num" id="1983335">0</span>&nbsp;<span class="op" id="1983337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983342">pd</span>&nbsp;<span class="op" id="1983345">:=</span>&nbsp;<span class="op" id="1983348">*</span><span class="op" id="1983349">(</span><span class="op" id="1983350">*</span><span class="op" id="1983351">*</span><span class="ident" id="1983352">pollDesc</span><span class="op" id="1983360">)</span><span class="op" id="1983361">(</span><span class="ident" id="1983362">unsafe</span><span class="op" id="1983368">.</span><span class="ident" id="1983369">Pointer</span><span class="op" id="1983376">(</span><span class="op" id="1983377">&amp;</span><span class="ident" id="1983378">ev</span><span class="op" id="1983380">.</span><span class="ident" id="1983381">data</span><span class="op" id="1983385">)</span><span class="op" id="1983386">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983391">netpollready</span><span class="op" id="1983403">(</span><span class="op" id="1983404">(</span><span class="op" id="1983405">*</span><span class="op" id="1983406">*</span><span class="ident" id="1983407">g</span><span class="op" id="1983408">)</span><span class="op" id="1983409">(</span><span class="ident" id="1983410">noescape</span><span class="op" id="1983418">(</span><span class="ident" id="1983419">unsafe</span><span class="op" id="1983425">.</span><span class="ident" id="1983426">Pointer</span><span class="op" id="1983433">(</span><span class="op" id="1983434">&amp;</span><span class="ident" id="1983435">gp</span><span class="op" id="1983437">)</span><span class="op" id="1983438">)</span><span class="op" id="1983439">)</span><span class="op" id="1983440">,</span>&nbsp;<span class="ident" id="1983442">pd</span><span class="op" id="1983444">,</span>&nbsp;<span class="ident" id="1983446">mode</span><span class="op" id="1983450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1983454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1983457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983460">if</span>&nbsp;<span class="ident" id="1983463">block</span>&nbsp;<span class="op" id="1983469">&amp;&amp;</span>&nbsp;<span class="ident" id="1983472">gp</span>&nbsp;<span class="op" id="1983475">==</span>&nbsp;<span class="ident" id="1983478">nil</span>&nbsp;<span class="op" id="1983482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983486">goto</span>&nbsp;<span class="ident" id="1983491">retry</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1983498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983501">return</span>&nbsp;<span class="ident" id="1983508">gp</span><br>
<span class="lineno"></span><span class="op" id="1983511">}</span>
</div>
</body>
</html>
