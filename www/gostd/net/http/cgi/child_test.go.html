<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html" class="current">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7953310">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7953365">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7953419">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7953470">//&nbsp;Tests&nbsp;for&nbsp;CGI&nbsp;(the&nbsp;child&nbsp;process&nbsp;perspective)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7953520">package</span>&nbsp;<span class="ident" id="7953528">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7953533">import</span>&nbsp;<span class="op" id="7953540">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953543">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7953553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7953556">func</span>&nbsp;<span class="ident" id="7953561">TestRequest</span><span class="op" id="7953572">(</span><span class="ident" id="7953573">t</span>&nbsp;<span class="op" id="7953575">*</span><span class="ident" id="7953576">testing</span><span class="op" id="7953583">.</span><span class="ident" id="7953584">T</span><span class="op" id="7953585">)</span>&nbsp;<span class="op" id="7953587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953590">env</span>&nbsp;<span class="op" id="7953594">:=</span>&nbsp;<span class="keyword" id="7953597">map</span><span class="op" id="7953600">[</span><span class="builtintype" id="7953601">string</span><span class="op" id="7953607">]</span><span class="builtintype" id="7953608">string</span><span class="op" id="7953614">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953618">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7953635">:</span>&nbsp;<span class="string" id="7953637">&#34;HTTP/1.1&#34;</span><span class="op" id="7953647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953651">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7953667">:</span>&nbsp;&nbsp;<span class="string" id="7953670">&#34;GET&#34;</span><span class="op" id="7953675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953679">&#34;HTTP_HOST&#34;</span><span class="op" id="7953690">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953698">&#34;example.com&#34;</span><span class="op" id="7953711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953715">&#34;HTTP_REFERER&#34;</span><span class="op" id="7953729">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953734">&#34;elsewhere&#34;</span><span class="op" id="7953745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953749">&#34;HTTP_USER_AGENT&#34;</span><span class="op" id="7953766">:</span>&nbsp;<span class="string" id="7953768">&#34;goclient&#34;</span><span class="op" id="7953778">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953782">&#34;HTTP_FOO_BAR&#34;</span><span class="op" id="7953796">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953801">&#34;baz&#34;</span><span class="op" id="7953806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953810">&#34;REQUEST_URI&#34;</span><span class="op" id="7953823">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953829">&#34;/path?a=b&#34;</span><span class="op" id="7953840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953844">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="7953860">:</span>&nbsp;&nbsp;<span class="string" id="7953863">&#34;123&#34;</span><span class="op" id="7953868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953872">&#34;CONTENT_TYPE&#34;</span><span class="op" id="7953886">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953891">&#34;text/xml&#34;</span><span class="op" id="7953901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953905">&#34;REMOTE_ADDR&#34;</span><span class="op" id="7953918">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7953924">&#34;5.6.7.8&#34;</span><span class="op" id="7953933">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7953936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953939">req</span><span class="op" id="7953942">,</span>&nbsp;<span class="ident" id="7953944">err</span>&nbsp;<span class="op" id="7953948">:=</span>&nbsp;<span class="ident" id="7953951">RequestFromMap</span><span class="op" id="7953965">(</span><span class="ident" id="7953966">env</span><span class="op" id="7953969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7953972">if</span>&nbsp;<span class="ident" id="7953975">err</span>&nbsp;<span class="op" id="7953979">!=</span>&nbsp;<span class="builtintype" id="7953982">nil</span>&nbsp;<span class="op" id="7953986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7953990">t</span><span class="op" id="7953991">.</span><span class="ident" id="7953992">Fatalf</span><span class="op" id="7953998">(</span><span class="string" id="7953999">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7954019">,</span>&nbsp;<span class="ident" id="7954021">err</span><span class="op" id="7954024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954027">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7954030">if</span>&nbsp;<span class="ident" id="7954033">g</span><span class="op" id="7954034">,</span>&nbsp;<span class="ident" id="7954036">e</span>&nbsp;<span class="op" id="7954038">:=</span>&nbsp;<span class="ident" id="7954041">req</span><span class="op" id="7954044">.</span><span class="ident" id="7954045">UserAgent</span><span class="op" id="7954054">(</span><span class="op" id="7954055">)</span><span class="op" id="7954056">,</span>&nbsp;<span class="string" id="7954058">&#34;goclient&#34;</span><span class="op" id="7954068">;</span>&nbsp;<span class="ident" id="7954070">e</span>&nbsp;<span class="op" id="7954072">!=</span>&nbsp;<span class="ident" id="7954075">g</span>&nbsp;<span class="op" id="7954077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954081">t</span><span class="op" id="7954082">.</span><span class="ident" id="7954083">Errorf</span><span class="op" id="7954089">(</span><span class="string" id="7954090">&#34;expected&nbsp;UserAgent&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7954121">,</span>&nbsp;<span class="ident" id="7954123">e</span><span class="op" id="7954124">,</span>&nbsp;<span class="ident" id="7954126">g</span><span class="op" id="7954127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7954133">if</span>&nbsp;<span class="ident" id="7954136">g</span><span class="op" id="7954137">,</span>&nbsp;<span class="ident" id="7954139">e</span>&nbsp;<span class="op" id="7954141">:=</span>&nbsp;<span class="ident" id="7954144">req</span><span class="op" id="7954147">.</span><span class="ident" id="7954148">Method</span><span class="op" id="7954154">,</span>&nbsp;<span class="string" id="7954156">&#34;GET&#34;</span><span class="op" id="7954161">;</span>&nbsp;<span class="ident" id="7954163">e</span>&nbsp;<span class="op" id="7954165">!=</span>&nbsp;<span class="ident" id="7954168">g</span>&nbsp;<span class="op" id="7954170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954174">t</span><span class="op" id="7954175">.</span><span class="ident" id="7954176">Errorf</span><span class="op" id="7954182">(</span><span class="string" id="7954183">&#34;expected&nbsp;Method&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7954211">,</span>&nbsp;<span class="ident" id="7954213">e</span><span class="op" id="7954214">,</span>&nbsp;<span class="ident" id="7954216">g</span><span class="op" id="7954217">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7954223">if</span>&nbsp;<span class="ident" id="7954226">g</span><span class="op" id="7954227">,</span>&nbsp;<span class="ident" id="7954229">e</span>&nbsp;<span class="op" id="7954231">:=</span>&nbsp;<span class="ident" id="7954234">req</span><span class="op" id="7954237">.</span><span class="ident" id="7954238">Header</span><span class="op" id="7954244">.</span><span class="ident" id="7954245">Get</span><span class="op" id="7954248">(</span><span class="string" id="7954249">&#34;Content-Type&#34;</span><span class="op" id="7954263">)</span><span class="op" id="7954264">,</span>&nbsp;<span class="string" id="7954266">&#34;text/xml&#34;</span><span class="op" id="7954276">;</span>&nbsp;<span class="ident" id="7954278">e</span>&nbsp;<span class="op" id="7954280">!=</span>&nbsp;<span class="ident" id="7954283">g</span>&nbsp;<span class="op" id="7954285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954289">t</span><span class="op" id="7954290">.</span><span class="ident" id="7954291">Errorf</span><span class="op" id="7954297">(</span><span class="string" id="7954298">&#34;expected&nbsp;Content-Type&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7954332">,</span>&nbsp;<span class="ident" id="7954334">e</span><span class="op" id="7954335">,</span>&nbsp;<span class="ident" id="7954337">g</span><span class="op" id="7954338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7954344">if</span>&nbsp;<span class="ident" id="7954347">g</span><span class="op" id="7954348">,</span>&nbsp;<span class="ident" id="7954350">e</span>&nbsp;<span class="op" id="7954352">:=</span>&nbsp;<span class="ident" id="7954355">req</span><span class="op" id="7954358">.</span><span class="ident" id="7954359">ContentLength</span><span class="op" id="7954372">,</span>&nbsp;<span class="ident" id="7954374">int64</span><span class="op" id="7954379">(</span><span class="num" id="7954380">123</span><span class="op" id="7954383">)</span><span class="op" id="7954384">;</span>&nbsp;<span class="ident" id="7954386">e</span>&nbsp;<span class="op" id="7954388">!=</span>&nbsp;<span class="ident" id="7954391">g</span>&nbsp;<span class="op" id="7954393">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954397">t</span><span class="op" id="7954398">.</span><span class="ident" id="7954399">Errorf</span><span class="op" id="7954405">(</span><span class="string" id="7954406">&#34;expected&nbsp;ContentLength&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7954441">,</span>&nbsp;<span class="ident" id="7954443">e</span><span class="op" id="7954444">,</span>&nbsp;<span class="ident" id="7954446">g</span><span class="op" id="7954447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7954453">if</span>&nbsp;<span class="ident" id="7954456">g</span><span class="op" id="7954457">,</span>&nbsp;<span class="ident" id="7954459">e</span>&nbsp;<span class="op" id="7954461">:=</span>&nbsp;<span class="ident" id="7954464">req</span><span class="op" id="7954467">.</span><span class="ident" id="7954468">Referer</span><span class="op" id="7954475">(</span><span class="op" id="7954476">)</span><span class="op" id="7954477">,</span>&nbsp;<span class="string" id="7954479">&#34;elsewhere&#34;</span><span class="op" id="7954490">;</span>&nbsp;<span class="ident" id="7954492">e</span>&nbsp;<span class="op" id="7954494">!=</span>&nbsp;<span class="ident" id="7954497">g</span>&nbsp;<span class="op" id="7954499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954503">t</span><span class="op" id="7954504">.</span><span class="ident" id="7954505">Errorf</span><span class="op" id="7954511">(</span><span class="string" id="7954512">&#34;expected&nbsp;Referer&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7954541">,</span>&nbsp;<span class="ident" id="7954543">e</span><span class="op" id="7954544">,</span>&nbsp;<span class="ident" id="7954546">g</span><span class="op" id="7954547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954550">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7954553">if</span>&nbsp;<span class="ident" id="7954556">req</span><span class="op" id="7954559">.</span><span class="ident" id="7954560">Header</span>&nbsp;<span class="op" id="7954567">==</span>&nbsp;<span class="builtintype" id="7954570">nil</span>&nbsp;<span class="op" id="7954574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954578">t</span><span class="op" id="7954579">.</span><span class="ident" id="7954580">Fatalf</span><span class="op" id="7954586">(</span><span class="string" id="7954587">&#34;unexpected&nbsp;nil&nbsp;Header&#34;</span><span class="op" id="7954610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7954616">if</span>&nbsp;<span class="ident" id="7954619">g</span><span class="op" id="7954620">,</span>&nbsp;<span class="ident" id="7954622">e</span>&nbsp;<span class="op" id="7954624">:=</span>&nbsp;<span class="ident" id="7954627">req</span><span class="op" id="7954630">.</span><span class="ident" id="7954631">Header</span><span class="op" id="7954637">.</span><span class="ident" id="7954638">Get</span><span class="op" id="7954641">(</span><span class="string" id="7954642">&#34;Foo-Bar&#34;</span><span class="op" id="7954651">)</span><span class="op" id="7954652">,</span>&nbsp;<span class="string" id="7954654">&#34;baz&#34;</span><span class="op" id="7954659">;</span>&nbsp;<span class="ident" id="7954661">e</span>&nbsp;<span class="op" id="7954663">!=</span>&nbsp;<span class="ident" id="7954666">g</span>&nbsp;<span class="op" id="7954668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954672">t</span><span class="op" id="7954673">.</span><span class="ident" id="7954674">Errorf</span><span class="op" id="7954680">(</span><span class="string" id="7954681">&#34;expected&nbsp;Foo-Bar&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7954710">,</span>&nbsp;<span class="ident" id="7954712">e</span><span class="op" id="7954713">,</span>&nbsp;<span class="ident" id="7954715">g</span><span class="op" id="7954716">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7954722">if</span>&nbsp;<span class="ident" id="7954725">g</span><span class="op" id="7954726">,</span>&nbsp;<span class="ident" id="7954728">e</span>&nbsp;<span class="op" id="7954730">:=</span>&nbsp;<span class="ident" id="7954733">req</span><span class="op" id="7954736">.</span><span class="ident" id="7954737">URL</span><span class="op" id="7954740">.</span><span class="ident" id="7954741">String</span><span class="op" id="7954747">(</span><span class="op" id="7954748">)</span><span class="op" id="7954749">,</span>&nbsp;<span class="string" id="7954751">&#34;http://example.com/path?a=b&#34;</span><span class="op" id="7954780">;</span>&nbsp;<span class="ident" id="7954782">e</span>&nbsp;<span class="op" id="7954784">!=</span>&nbsp;<span class="ident" id="7954787">g</span>&nbsp;<span class="op" id="7954789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954793">t</span><span class="op" id="7954794">.</span><span class="ident" id="7954795">Errorf</span><span class="op" id="7954801">(</span><span class="string" id="7954802">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7954827">,</span>&nbsp;<span class="ident" id="7954829">e</span><span class="op" id="7954830">,</span>&nbsp;<span class="ident" id="7954832">g</span><span class="op" id="7954833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7954839">if</span>&nbsp;<span class="ident" id="7954842">g</span><span class="op" id="7954843">,</span>&nbsp;<span class="ident" id="7954845">e</span>&nbsp;<span class="op" id="7954847">:=</span>&nbsp;<span class="ident" id="7954850">req</span><span class="op" id="7954853">.</span><span class="ident" id="7954854">FormValue</span><span class="op" id="7954863">(</span><span class="string" id="7954864">&#34;a&#34;</span><span class="op" id="7954867">)</span><span class="op" id="7954868">,</span>&nbsp;<span class="string" id="7954870">&#34;b&#34;</span><span class="op" id="7954873">;</span>&nbsp;<span class="ident" id="7954875">e</span>&nbsp;<span class="op" id="7954877">!=</span>&nbsp;<span class="ident" id="7954880">g</span>&nbsp;<span class="op" id="7954882">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954886">t</span><span class="op" id="7954887">.</span><span class="ident" id="7954888">Errorf</span><span class="op" id="7954894">(</span><span class="string" id="7954895">&#34;expected&nbsp;FormValue(a)&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7954929">,</span>&nbsp;<span class="ident" id="7954931">e</span><span class="op" id="7954932">,</span>&nbsp;<span class="ident" id="7954934">g</span><span class="op" id="7954935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7954938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7954941">if</span>&nbsp;<span class="ident" id="7954944">req</span><span class="op" id="7954947">.</span><span class="ident" id="7954948">Trailer</span>&nbsp;<span class="op" id="7954956">==</span>&nbsp;<span class="builtintype" id="7954959">nil</span>&nbsp;<span class="op" id="7954963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7954967">t</span><span class="op" id="7954968">.</span><span class="ident" id="7954969">Errorf</span><span class="op" id="7954975">(</span><span class="string" id="7954976">&#34;unexpected&nbsp;nil&nbsp;Trailer&#34;</span><span class="op" id="7955000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7955003">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7955006">if</span>&nbsp;<span class="ident" id="7955009">req</span><span class="op" id="7955012">.</span><span class="ident" id="7955013">TLS</span>&nbsp;<span class="op" id="7955017">!=</span>&nbsp;<span class="builtintype" id="7955020">nil</span>&nbsp;<span class="op" id="7955024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955028">t</span><span class="op" id="7955029">.</span><span class="ident" id="7955030">Errorf</span><span class="op" id="7955036">(</span><span class="string" id="7955037">&#34;expected&nbsp;nil&nbsp;TLS&#34;</span><span class="op" id="7955055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7955058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7955061">if</span>&nbsp;<span class="ident" id="7955064">e</span><span class="op" id="7955065">,</span>&nbsp;<span class="ident" id="7955067">g</span>&nbsp;<span class="op" id="7955069">:=</span>&nbsp;<span class="string" id="7955072">&#34;5.6.7.8:0&#34;</span><span class="op" id="7955083">,</span>&nbsp;<span class="ident" id="7955085">req</span><span class="op" id="7955088">.</span><span class="ident" id="7955089">RemoteAddr</span><span class="op" id="7955099">;</span>&nbsp;<span class="ident" id="7955101">e</span>&nbsp;<span class="op" id="7955103">!=</span>&nbsp;<span class="ident" id="7955106">g</span>&nbsp;<span class="op" id="7955108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955112">t</span><span class="op" id="7955113">.</span><span class="ident" id="7955114">Errorf</span><span class="op" id="7955120">(</span><span class="string" id="7955121">&#34;RemoteAddr:&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7955150">,</span>&nbsp;<span class="ident" id="7955152">g</span><span class="op" id="7955153">,</span>&nbsp;<span class="ident" id="7955155">e</span><span class="op" id="7955156">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7955159">}</span><br>
<span class="lineno"></span><span class="op" id="7955161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7955164">func</span>&nbsp;<span class="ident" id="7955169">TestRequestWithTLS</span><span class="op" id="7955187">(</span><span class="ident" id="7955188">t</span>&nbsp;<span class="op" id="7955190">*</span><span class="ident" id="7955191">testing</span><span class="op" id="7955198">.</span><span class="ident" id="7955199">T</span><span class="op" id="7955200">)</span>&nbsp;<span class="op" id="7955202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955205">env</span>&nbsp;<span class="op" id="7955209">:=</span>&nbsp;<span class="keyword" id="7955212">map</span><span class="op" id="7955215">[</span><span class="builtintype" id="7955216">string</span><span class="op" id="7955222">]</span><span class="builtintype" id="7955223">string</span><span class="op" id="7955229">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955233">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7955250">:</span>&nbsp;<span class="string" id="7955252">&#34;HTTP/1.1&#34;</span><span class="op" id="7955262">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955266">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7955282">:</span>&nbsp;&nbsp;<span class="string" id="7955285">&#34;GET&#34;</span><span class="op" id="7955290">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955294">&#34;HTTP_HOST&#34;</span><span class="op" id="7955305">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955313">&#34;example.com&#34;</span><span class="op" id="7955326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955330">&#34;HTTP_REFERER&#34;</span><span class="op" id="7955344">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955349">&#34;elsewhere&#34;</span><span class="op" id="7955360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955364">&#34;REQUEST_URI&#34;</span><span class="op" id="7955377">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955383">&#34;/path?a=b&#34;</span><span class="op" id="7955394">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955398">&#34;CONTENT_TYPE&#34;</span><span class="op" id="7955412">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955417">&#34;text/xml&#34;</span><span class="op" id="7955427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955431">&#34;HTTPS&#34;</span><span class="op" id="7955438">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955450">&#34;1&#34;</span><span class="op" id="7955453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955457">&#34;REMOTE_ADDR&#34;</span><span class="op" id="7955470">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955476">&#34;5.6.7.8&#34;</span><span class="op" id="7955485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7955488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955491">req</span><span class="op" id="7955494">,</span>&nbsp;<span class="ident" id="7955496">err</span>&nbsp;<span class="op" id="7955500">:=</span>&nbsp;<span class="ident" id="7955503">RequestFromMap</span><span class="op" id="7955517">(</span><span class="ident" id="7955518">env</span><span class="op" id="7955521">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7955524">if</span>&nbsp;<span class="ident" id="7955527">err</span>&nbsp;<span class="op" id="7955531">!=</span>&nbsp;<span class="builtintype" id="7955534">nil</span>&nbsp;<span class="op" id="7955538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955542">t</span><span class="op" id="7955543">.</span><span class="ident" id="7955544">Fatalf</span><span class="op" id="7955550">(</span><span class="string" id="7955551">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7955571">,</span>&nbsp;<span class="ident" id="7955573">err</span><span class="op" id="7955576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7955579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7955582">if</span>&nbsp;<span class="ident" id="7955585">g</span><span class="op" id="7955586">,</span>&nbsp;<span class="ident" id="7955588">e</span>&nbsp;<span class="op" id="7955590">:=</span>&nbsp;<span class="ident" id="7955593">req</span><span class="op" id="7955596">.</span><span class="ident" id="7955597">URL</span><span class="op" id="7955600">.</span><span class="ident" id="7955601">String</span><span class="op" id="7955607">(</span><span class="op" id="7955608">)</span><span class="op" id="7955609">,</span>&nbsp;<span class="string" id="7955611">&#34;https://example.com/path?a=b&#34;</span><span class="op" id="7955641">;</span>&nbsp;<span class="ident" id="7955643">e</span>&nbsp;<span class="op" id="7955645">!=</span>&nbsp;<span class="ident" id="7955648">g</span>&nbsp;<span class="op" id="7955650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955654">t</span><span class="op" id="7955655">.</span><span class="ident" id="7955656">Errorf</span><span class="op" id="7955662">(</span><span class="string" id="7955663">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7955688">,</span>&nbsp;<span class="ident" id="7955690">e</span><span class="op" id="7955691">,</span>&nbsp;<span class="ident" id="7955693">g</span><span class="op" id="7955694">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7955697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7955700">if</span>&nbsp;<span class="ident" id="7955703">req</span><span class="op" id="7955706">.</span><span class="ident" id="7955707">TLS</span>&nbsp;<span class="op" id="7955711">==</span>&nbsp;<span class="builtintype" id="7955714">nil</span>&nbsp;<span class="op" id="7955718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955722">t</span><span class="op" id="7955723">.</span><span class="ident" id="7955724">Errorf</span><span class="op" id="7955730">(</span><span class="string" id="7955731">&#34;expected&nbsp;non-nil&nbsp;TLS&#34;</span><span class="op" id="7955753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7955756">}</span><br>
<span class="lineno"></span><span class="op" id="7955758">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="7955761">func</span>&nbsp;<span class="ident" id="7955766">TestRequestWithoutHost</span><span class="op" id="7955788">(</span><span class="ident" id="7955789">t</span>&nbsp;<span class="op" id="7955791">*</span><span class="ident" id="7955792">testing</span><span class="op" id="7955799">.</span><span class="ident" id="7955800">T</span><span class="op" id="7955801">)</span>&nbsp;<span class="op" id="7955803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955806">env</span>&nbsp;<span class="op" id="7955810">:=</span>&nbsp;<span class="keyword" id="7955813">map</span><span class="op" id="7955816">[</span><span class="builtintype" id="7955817">string</span><span class="op" id="7955823">]</span><span class="builtintype" id="7955824">string</span><span class="op" id="7955830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955834">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7955851">:</span>&nbsp;<span class="string" id="7955853">&#34;HTTP/1.1&#34;</span><span class="op" id="7955863">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955867">&#34;HTTP_HOST&#34;</span><span class="op" id="7955878">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955886">&#34;&#34;</span><span class="op" id="7955888">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955892">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7955908">:</span>&nbsp;&nbsp;<span class="string" id="7955911">&#34;GET&#34;</span><span class="op" id="7955916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955920">&#34;REQUEST_URI&#34;</span><span class="op" id="7955933">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955939">&#34;/path?a=b&#34;</span><span class="op" id="7955950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7955954">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="7955970">:</span>&nbsp;&nbsp;<span class="string" id="7955973">&#34;123&#34;</span><span class="op" id="7955978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7955981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7955984">req</span><span class="op" id="7955987">,</span>&nbsp;<span class="ident" id="7955989">err</span>&nbsp;<span class="op" id="7955993">:=</span>&nbsp;<span class="ident" id="7955996">RequestFromMap</span><span class="op" id="7956010">(</span><span class="ident" id="7956011">env</span><span class="op" id="7956014">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7956017">if</span>&nbsp;<span class="ident" id="7956020">err</span>&nbsp;<span class="op" id="7956024">!=</span>&nbsp;<span class="builtintype" id="7956027">nil</span>&nbsp;<span class="op" id="7956031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7956035">t</span><span class="op" id="7956036">.</span><span class="ident" id="7956037">Fatalf</span><span class="op" id="7956043">(</span><span class="string" id="7956044">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7956064">,</span>&nbsp;<span class="ident" id="7956066">err</span><span class="op" id="7956069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7956072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7956075">if</span>&nbsp;<span class="ident" id="7956078">req</span><span class="op" id="7956081">.</span><span class="ident" id="7956082">URL</span>&nbsp;<span class="op" id="7956086">==</span>&nbsp;<span class="builtintype" id="7956089">nil</span>&nbsp;<span class="op" id="7956093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7956097">t</span><span class="op" id="7956098">.</span><span class="ident" id="7956099">Fatalf</span><span class="op" id="7956105">(</span><span class="string" id="7956106">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="7956126">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7956129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7956132">if</span>&nbsp;<span class="ident" id="7956135">g</span><span class="op" id="7956136">,</span>&nbsp;<span class="ident" id="7956138">e</span>&nbsp;<span class="op" id="7956140">:=</span>&nbsp;<span class="ident" id="7956143">req</span><span class="op" id="7956146">.</span><span class="ident" id="7956147">URL</span><span class="op" id="7956150">.</span><span class="ident" id="7956151">String</span><span class="op" id="7956157">(</span><span class="op" id="7956158">)</span><span class="op" id="7956159">,</span>&nbsp;<span class="string" id="7956161">&#34;/path?a=b&#34;</span><span class="op" id="7956172">;</span>&nbsp;<span class="ident" id="7956174">e</span>&nbsp;<span class="op" id="7956176">!=</span>&nbsp;<span class="ident" id="7956179">g</span>&nbsp;<span class="op" id="7956181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7956185">t</span><span class="op" id="7956186">.</span><span class="ident" id="7956187">Errorf</span><span class="op" id="7956193">(</span><span class="string" id="7956194">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7956213">,</span>&nbsp;<span class="ident" id="7956215">g</span><span class="op" id="7956216">,</span>&nbsp;<span class="ident" id="7956218">e</span><span class="op" id="7956219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7956222">}</span><br>
<span class="lineno"></span><span class="op" id="7956224">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="7956227">func</span>&nbsp;<span class="ident" id="7956232">TestRequestWithoutRequestURI</span><span class="op" id="7956260">(</span><span class="ident" id="7956261">t</span>&nbsp;<span class="op" id="7956263">*</span><span class="ident" id="7956264">testing</span><span class="op" id="7956271">.</span><span class="ident" id="7956272">T</span><span class="op" id="7956273">)</span>&nbsp;<span class="op" id="7956275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7956278">env</span>&nbsp;<span class="op" id="7956282">:=</span>&nbsp;<span class="keyword" id="7956285">map</span><span class="op" id="7956288">[</span><span class="builtintype" id="7956289">string</span><span class="op" id="7956295">]</span><span class="builtintype" id="7956296">string</span><span class="op" id="7956302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7956306">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7956323">:</span>&nbsp;<span class="string" id="7956325">&#34;HTTP/1.1&#34;</span><span class="op" id="7956335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7956339">&#34;HTTP_HOST&#34;</span><span class="op" id="7956350">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7956358">&#34;example.com&#34;</span><span class="op" id="7956371">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7956375">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7956391">:</span>&nbsp;&nbsp;<span class="string" id="7956394">&#34;GET&#34;</span><span class="op" id="7956399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7956403">&#34;SCRIPT_NAME&#34;</span><span class="op" id="7956416">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7956422">&#34;/dir/scriptname&#34;</span><span class="op" id="7956439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7956443">&#34;PATH_INFO&#34;</span><span class="op" id="7956454">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7956462">&#34;/p1/p2&#34;</span><span class="op" id="7956470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7956474">&#34;QUERY_STRING&#34;</span><span class="op" id="7956488">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7956493">&#34;a=1&amp;b=2&#34;</span><span class="op" id="7956502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7956506">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="7956522">:</span>&nbsp;&nbsp;<span class="string" id="7956525">&#34;123&#34;</span><span class="op" id="7956530">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7956533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7956536">req</span><span class="op" id="7956539">,</span>&nbsp;<span class="ident" id="7956541">err</span>&nbsp;<span class="op" id="7956545">:=</span>&nbsp;<span class="ident" id="7956548">RequestFromMap</span><span class="op" id="7956562">(</span><span class="ident" id="7956563">env</span><span class="op" id="7956566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7956569">if</span>&nbsp;<span class="ident" id="7956572">err</span>&nbsp;<span class="op" id="7956576">!=</span>&nbsp;<span class="builtintype" id="7956579">nil</span>&nbsp;<span class="op" id="7956583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7956587">t</span><span class="op" id="7956588">.</span><span class="ident" id="7956589">Fatalf</span><span class="op" id="7956595">(</span><span class="string" id="7956596">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7956616">,</span>&nbsp;<span class="ident" id="7956618">err</span><span class="op" id="7956621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7956624">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7956627">if</span>&nbsp;<span class="ident" id="7956630">req</span><span class="op" id="7956633">.</span><span class="ident" id="7956634">URL</span>&nbsp;<span class="op" id="7956638">==</span>&nbsp;<span class="builtintype" id="7956641">nil</span>&nbsp;<span class="op" id="7956645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7956649">t</span><span class="op" id="7956650">.</span><span class="ident" id="7956651">Fatalf</span><span class="op" id="7956657">(</span><span class="string" id="7956658">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="7956678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7956681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7956684">if</span>&nbsp;<span class="ident" id="7956687">g</span><span class="op" id="7956688">,</span>&nbsp;<span class="ident" id="7956690">e</span>&nbsp;<span class="op" id="7956692">:=</span>&nbsp;<span class="ident" id="7956695">req</span><span class="op" id="7956698">.</span><span class="ident" id="7956699">URL</span><span class="op" id="7956702">.</span><span class="ident" id="7956703">String</span><span class="op" id="7956709">(</span><span class="op" id="7956710">)</span><span class="op" id="7956711">,</span>&nbsp;<span class="string" id="7956713">&#34;http://example.com/dir/scriptname/p1/p2?a=1&amp;b=2&#34;</span><span class="op" id="7956762">;</span>&nbsp;<span class="ident" id="7956764">e</span>&nbsp;<span class="op" id="7956766">!=</span>&nbsp;<span class="ident" id="7956769">g</span>&nbsp;<span class="op" id="7956771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7956775">t</span><span class="op" id="7956776">.</span><span class="ident" id="7956777">Errorf</span><span class="op" id="7956783">(</span><span class="string" id="7956784">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7956803">,</span>&nbsp;<span class="ident" id="7956805">g</span><span class="op" id="7956806">,</span>&nbsp;<span class="ident" id="7956808">e</span><span class="op" id="7956809">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7956812">}</span><br>
<span class="lineno"></span><span class="op" id="7956814">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
