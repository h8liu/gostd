<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html" class="current">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3901886">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3901941">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3901995">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3902046">package</span>&nbsp;<span class="ident" id="3902054">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3902060">import</span>&nbsp;<span class="op" id="3902067">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3902070">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span><span class="op" id="3902085">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="3902088">//&nbsp;CertPool&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;certificates.</span><br>
<span class="lineno"></span><span class="keyword" id="3902126">type</span>&nbsp;<span class="ident" id="3902131">CertPool</span>&nbsp;<span class="keyword" id="3902140">struct</span>&nbsp;<span class="op" id="3902147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3902150">bySubjectKeyId</span>&nbsp;<span class="keyword" id="3902165">map</span><span class="op" id="3902168">[</span><span class="builtintype" id="3902169">string</span><span class="op" id="3902175">]</span><span class="op" id="3902176">[</span><span class="op" id="3902177">]</span><span class="builtintype" id="3902178">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3902183">byName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3902198">map</span><span class="op" id="3902201">[</span><span class="builtintype" id="3902202">string</span><span class="op" id="3902208">]</span><span class="op" id="3902209">[</span><span class="op" id="3902210">]</span><span class="builtintype" id="3902211">int</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3902216">certs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3902231">[</span><span class="op" id="3902232">]</span><span class="op" id="3902233">*</span><span class="ident" id="3902234">Certificate</span><br>
<span class="lineno"></span><span class="op" id="3902246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3902249">//&nbsp;NewCertPool&nbsp;returns&nbsp;a&nbsp;new,&nbsp;empty&nbsp;CertPool.</span><br>
<span class="lineno"></span><span class="keyword" id="3902295">func</span>&nbsp;<span class="ident" id="3902300">NewCertPool</span><span class="op" id="3902311">(</span><span class="op" id="3902312">)</span>&nbsp;<span class="op" id="3902314">*</span><span class="ident" id="3902315">CertPool</span>&nbsp;<span class="op" id="3902324">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3902327">return</span>&nbsp;<span class="op" id="3902334">&amp;</span><span class="ident" id="3902335">CertPool</span><span class="op" id="3902343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3902347">make</span><span class="op" id="3902351">(</span><span class="keyword" id="3902352">map</span><span class="op" id="3902355">[</span><span class="builtintype" id="3902356">string</span><span class="op" id="3902362">]</span><span class="op" id="3902363">[</span><span class="op" id="3902364">]</span><span class="builtintype" id="3902365">int</span><span class="op" id="3902368">)</span><span class="op" id="3902369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3902373">make</span><span class="op" id="3902377">(</span><span class="keyword" id="3902378">map</span><span class="op" id="3902381">[</span><span class="builtintype" id="3902382">string</span><span class="op" id="3902388">]</span><span class="op" id="3902389">[</span><span class="op" id="3902390">]</span><span class="builtintype" id="3902391">int</span><span class="op" id="3902394">)</span><span class="op" id="3902395">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3902399">nil</span><span class="op" id="3902402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3902405">}</span><br>
<span class="lineno">25</span><span class="op" id="3902407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3902410">//&nbsp;findVerifiedParents&nbsp;attempts&nbsp;to&nbsp;find&nbsp;certificates&nbsp;in&nbsp;s&nbsp;which&nbsp;have&nbsp;signed&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3902490">//&nbsp;given&nbsp;certificate.&nbsp;If&nbsp;any&nbsp;candidates&nbsp;were&nbsp;rejected&nbsp;then&nbsp;errCert&nbsp;will&nbsp;be&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="3902569">//&nbsp;to&nbsp;one&nbsp;of&nbsp;them,&nbsp;arbitrarily,&nbsp;and&nbsp;err&nbsp;will&nbsp;contain&nbsp;the&nbsp;reason&nbsp;that&nbsp;it&nbsp;was</span><br>
<span class="lineno">30</span><span class="comment" id="3902645">//&nbsp;rejected.</span><br>
<span class="lineno"></span><span class="keyword" id="3902658">func</span>&nbsp;<span class="op" id="3902663">(</span><span class="ident" id="3902664">s</span>&nbsp;<span class="op" id="3902666">*</span><span class="ident" id="3902667">CertPool</span><span class="op" id="3902675">)</span>&nbsp;<span class="ident" id="3902677">findVerifiedParents</span><span class="op" id="3902696">(</span><span class="ident" id="3902697">cert</span>&nbsp;<span class="op" id="3902702">*</span><span class="ident" id="3902703">Certificate</span><span class="op" id="3902714">)</span>&nbsp;<span class="op" id="3902716">(</span><span class="ident" id="3902717">parents</span>&nbsp;<span class="op" id="3902725">[</span><span class="op" id="3902726">]</span><span class="builtintype" id="3902727">int</span><span class="op" id="3902730">,</span>&nbsp;<span class="ident" id="3902732">errCert</span>&nbsp;<span class="op" id="3902740">*</span><span class="ident" id="3902741">Certificate</span><span class="op" id="3902752">,</span>&nbsp;<span class="ident" id="3902754">err</span>&nbsp;<span class="builtintype" id="3902758">error</span><span class="op" id="3902763">)</span>&nbsp;<span class="op" id="3902765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3902768">if</span>&nbsp;<span class="ident" id="3902771">s</span>&nbsp;<span class="op" id="3902773">==</span>&nbsp;<span class="builtintype" id="3902776">nil</span>&nbsp;<span class="op" id="3902780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3902784">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3902792">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3902795">var</span>&nbsp;<span class="ident" id="3902799">candidates</span>&nbsp;<span class="op" id="3902810">[</span><span class="op" id="3902811">]</span><span class="builtintype" id="3902812">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3902818">if</span>&nbsp;<span class="builtinfunc" id="3902821">len</span><span class="op" id="3902824">(</span><span class="ident" id="3902825">cert</span><span class="op" id="3902829">.</span><span class="ident" id="3902830">AuthorityKeyId</span><span class="op" id="3902844">)</span>&nbsp;<span class="op" id="3902846">&gt;</span>&nbsp;<span class="num" id="3902848">0</span>&nbsp;<span class="op" id="3902850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3902854">candidates</span>&nbsp;<span class="op" id="3902865">=</span>&nbsp;<span class="ident" id="3902867">s</span><span class="op" id="3902868">.</span><span class="ident" id="3902869">bySubjectKeyId</span><span class="op" id="3902883">[</span><span class="builtintype" id="3902884">string</span><span class="op" id="3902890">(</span><span class="ident" id="3902891">cert</span><span class="op" id="3902895">.</span><span class="ident" id="3902896">AuthorityKeyId</span><span class="op" id="3902910">)</span><span class="op" id="3902911">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3902914">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3902917">if</span>&nbsp;<span class="builtinfunc" id="3902920">len</span><span class="op" id="3902923">(</span><span class="ident" id="3902924">candidates</span><span class="op" id="3902934">)</span>&nbsp;<span class="op" id="3902936">==</span>&nbsp;<span class="num" id="3902939">0</span>&nbsp;<span class="op" id="3902941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3902945">candidates</span>&nbsp;<span class="op" id="3902956">=</span>&nbsp;<span class="ident" id="3902958">s</span><span class="op" id="3902959">.</span><span class="ident" id="3902960">byName</span><span class="op" id="3902966">[</span><span class="builtintype" id="3902967">string</span><span class="op" id="3902973">(</span><span class="ident" id="3902974">cert</span><span class="op" id="3902978">.</span><span class="ident" id="3902979">RawIssuer</span><span class="op" id="3902988">)</span><span class="op" id="3902989">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3902992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3902996">for</span>&nbsp;<span class="ident" id="3903000">_</span><span class="op" id="3903001">,</span>&nbsp;<span class="ident" id="3903003">c</span>&nbsp;<span class="op" id="3903005">:=</span>&nbsp;<span class="keyword" id="3903008">range</span>&nbsp;<span class="ident" id="3903014">candidates</span>&nbsp;<span class="op" id="3903025">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3903029">if</span>&nbsp;<span class="ident" id="3903032">err</span>&nbsp;<span class="op" id="3903036">=</span>&nbsp;<span class="ident" id="3903038">cert</span><span class="op" id="3903042">.</span><span class="ident" id="3903043">CheckSignatureFrom</span><span class="op" id="3903061">(</span><span class="ident" id="3903062">s</span><span class="op" id="3903063">.</span><span class="ident" id="3903064">certs</span><span class="op" id="3903069">[</span><span class="ident" id="3903070">c</span><span class="op" id="3903071">]</span><span class="op" id="3903072">)</span><span class="op" id="3903073">;</span>&nbsp;<span class="ident" id="3903075">err</span>&nbsp;<span class="op" id="3903079">==</span>&nbsp;<span class="builtintype" id="3903082">nil</span>&nbsp;<span class="op" id="3903086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3903091">parents</span>&nbsp;<span class="op" id="3903099">=</span>&nbsp;<span class="builtinfunc" id="3903101">append</span><span class="op" id="3903107">(</span><span class="ident" id="3903108">parents</span><span class="op" id="3903115">,</span>&nbsp;<span class="ident" id="3903117">c</span><span class="op" id="3903118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3903122">}</span>&nbsp;<span class="keyword" id="3903124">else</span>&nbsp;<span class="op" id="3903129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3903134">errCert</span>&nbsp;<span class="op" id="3903142">=</span>&nbsp;<span class="ident" id="3903144">s</span><span class="op" id="3903145">.</span><span class="ident" id="3903146">certs</span><span class="op" id="3903151">[</span><span class="ident" id="3903152">c</span><span class="op" id="3903153">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3903157">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3903160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3903164">return</span><br>
<span class="lineno"></span><span class="op" id="3903171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3903174">//&nbsp;AddCert&nbsp;adds&nbsp;a&nbsp;certificate&nbsp;to&nbsp;a&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="3903215">func</span>&nbsp;<span class="op" id="3903220">(</span><span class="ident" id="3903221">s</span>&nbsp;<span class="op" id="3903223">*</span><span class="ident" id="3903224">CertPool</span><span class="op" id="3903232">)</span>&nbsp;<span class="ident" id="3903234">AddCert</span><span class="op" id="3903241">(</span><span class="ident" id="3903242">cert</span>&nbsp;<span class="op" id="3903247">*</span><span class="ident" id="3903248">Certificate</span><span class="op" id="3903259">)</span>&nbsp;<span class="op" id="3903261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3903264">if</span>&nbsp;<span class="ident" id="3903267">cert</span>&nbsp;<span class="op" id="3903272">==</span>&nbsp;<span class="builtintype" id="3903275">nil</span>&nbsp;<span class="op" id="3903279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3903283">panic</span><span class="op" id="3903288">(</span><span class="string" id="3903289">&#34;adding&nbsp;nil&nbsp;Certificate&nbsp;to&nbsp;CertPool&#34;</span><span class="op" id="3903325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3903328">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3903332">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;certificate&nbsp;isn&#39;t&nbsp;being&nbsp;added&nbsp;twice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3903388">for</span>&nbsp;<span class="ident" id="3903392">_</span><span class="op" id="3903393">,</span>&nbsp;<span class="ident" id="3903395">c</span>&nbsp;<span class="op" id="3903397">:=</span>&nbsp;<span class="keyword" id="3903400">range</span>&nbsp;<span class="ident" id="3903406">s</span><span class="op" id="3903407">.</span><span class="ident" id="3903408">certs</span>&nbsp;<span class="op" id="3903414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3903418">if</span>&nbsp;<span class="ident" id="3903421">c</span><span class="op" id="3903422">.</span><span class="ident" id="3903423">Equal</span><span class="op" id="3903428">(</span><span class="ident" id="3903429">cert</span><span class="op" id="3903433">)</span>&nbsp;<span class="op" id="3903435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3903440">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3903449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3903452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3903456">n</span>&nbsp;<span class="op" id="3903458">:=</span>&nbsp;<span class="builtinfunc" id="3903461">len</span><span class="op" id="3903464">(</span><span class="ident" id="3903465">s</span><span class="op" id="3903466">.</span><span class="ident" id="3903467">certs</span><span class="op" id="3903472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3903475">s</span><span class="op" id="3903476">.</span><span class="ident" id="3903477">certs</span>&nbsp;<span class="op" id="3903483">=</span>&nbsp;<span class="builtinfunc" id="3903485">append</span><span class="op" id="3903491">(</span><span class="ident" id="3903492">s</span><span class="op" id="3903493">.</span><span class="ident" id="3903494">certs</span><span class="op" id="3903499">,</span>&nbsp;<span class="ident" id="3903501">cert</span><span class="op" id="3903505">)</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3903509">if</span>&nbsp;<span class="builtinfunc" id="3903512">len</span><span class="op" id="3903515">(</span><span class="ident" id="3903516">cert</span><span class="op" id="3903520">.</span><span class="ident" id="3903521">SubjectKeyId</span><span class="op" id="3903533">)</span>&nbsp;<span class="op" id="3903535">&gt;</span>&nbsp;<span class="num" id="3903537">0</span>&nbsp;<span class="op" id="3903539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3903543">keyId</span>&nbsp;<span class="op" id="3903549">:=</span>&nbsp;<span class="builtintype" id="3903552">string</span><span class="op" id="3903558">(</span><span class="ident" id="3903559">cert</span><span class="op" id="3903563">.</span><span class="ident" id="3903564">SubjectKeyId</span><span class="op" id="3903576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3903580">s</span><span class="op" id="3903581">.</span><span class="ident" id="3903582">bySubjectKeyId</span><span class="op" id="3903596">[</span><span class="ident" id="3903597">keyId</span><span class="op" id="3903602">]</span>&nbsp;<span class="op" id="3903604">=</span>&nbsp;<span class="builtinfunc" id="3903606">append</span><span class="op" id="3903612">(</span><span class="ident" id="3903613">s</span><span class="op" id="3903614">.</span><span class="ident" id="3903615">bySubjectKeyId</span><span class="op" id="3903629">[</span><span class="ident" id="3903630">keyId</span><span class="op" id="3903635">]</span><span class="op" id="3903636">,</span>&nbsp;<span class="ident" id="3903638">n</span><span class="op" id="3903639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3903642">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3903645">name</span>&nbsp;<span class="op" id="3903650">:=</span>&nbsp;<span class="builtintype" id="3903653">string</span><span class="op" id="3903659">(</span><span class="ident" id="3903660">cert</span><span class="op" id="3903664">.</span><span class="ident" id="3903665">RawSubject</span><span class="op" id="3903675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3903678">s</span><span class="op" id="3903679">.</span><span class="ident" id="3903680">byName</span><span class="op" id="3903686">[</span><span class="ident" id="3903687">name</span><span class="op" id="3903691">]</span>&nbsp;<span class="op" id="3903693">=</span>&nbsp;<span class="builtinfunc" id="3903695">append</span><span class="op" id="3903701">(</span><span class="ident" id="3903702">s</span><span class="op" id="3903703">.</span><span class="ident" id="3903704">byName</span><span class="op" id="3903710">[</span><span class="ident" id="3903711">name</span><span class="op" id="3903715">]</span><span class="op" id="3903716">,</span>&nbsp;<span class="ident" id="3903718">n</span><span class="op" id="3903719">)</span><br>
<span class="lineno"></span><span class="op" id="3903721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3903724">//&nbsp;AppendCertsFromPEM&nbsp;attempts&nbsp;to&nbsp;parse&nbsp;a&nbsp;series&nbsp;of&nbsp;PEM&nbsp;encoded&nbsp;certificates.</span><br>
<span class="lineno">80</span><span class="comment" id="3903802">//&nbsp;It&nbsp;appends&nbsp;any&nbsp;certificates&nbsp;found&nbsp;to&nbsp;s&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;certificates</span><br>
<span class="lineno"></span><span class="comment" id="3903881">//&nbsp;were&nbsp;successfully&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="3903910">//</span><br>
<span class="lineno"></span><span class="comment" id="3903913">//&nbsp;On&nbsp;many&nbsp;Linux&nbsp;systems,&nbsp;/etc/ssl/cert.pem&nbsp;will&nbsp;contain&nbsp;the&nbsp;system&nbsp;wide&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="3903990">//&nbsp;of&nbsp;root&nbsp;CAs&nbsp;in&nbsp;a&nbsp;format&nbsp;suitable&nbsp;for&nbsp;this&nbsp;function.</span><br>
<span class="lineno">85</span><span class="keyword" id="3904045">func</span>&nbsp;<span class="op" id="3904050">(</span><span class="ident" id="3904051">s</span>&nbsp;<span class="op" id="3904053">*</span><span class="ident" id="3904054">CertPool</span><span class="op" id="3904062">)</span>&nbsp;<span class="ident" id="3904064">AppendCertsFromPEM</span><span class="op" id="3904082">(</span><span class="ident" id="3904083">pemCerts</span>&nbsp;<span class="op" id="3904092">[</span><span class="op" id="3904093">]</span><span class="builtintype" id="3904094">byte</span><span class="op" id="3904098">)</span>&nbsp;<span class="op" id="3904100">(</span><span class="ident" id="3904101">ok</span>&nbsp;<span class="builtintype" id="3904104">bool</span><span class="op" id="3904108">)</span>&nbsp;<span class="op" id="3904110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3904113">for</span>&nbsp;<span class="builtinfunc" id="3904117">len</span><span class="op" id="3904120">(</span><span class="ident" id="3904121">pemCerts</span><span class="op" id="3904129">)</span>&nbsp;<span class="op" id="3904131">&gt;</span>&nbsp;<span class="num" id="3904133">0</span>&nbsp;<span class="op" id="3904135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3904139">var</span>&nbsp;<span class="ident" id="3904143">block</span>&nbsp;<span class="op" id="3904149">*</span><span class="ident" id="3904150">pem</span><span class="op" id="3904153">.</span><span class="ident" id="3904154">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3904162">block</span><span class="op" id="3904167">,</span>&nbsp;<span class="ident" id="3904169">pemCerts</span>&nbsp;<span class="op" id="3904178">=</span>&nbsp;<span class="ident" id="3904180">pem</span><span class="op" id="3904183">.</span><span class="ident" id="3904184">Decode</span><span class="op" id="3904190">(</span><span class="ident" id="3904191">pemCerts</span><span class="op" id="3904199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3904203">if</span>&nbsp;<span class="ident" id="3904206">block</span>&nbsp;<span class="op" id="3904212">==</span>&nbsp;<span class="builtintype" id="3904215">nil</span>&nbsp;<span class="op" id="3904219">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3904224">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3904232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3904236">if</span>&nbsp;<span class="ident" id="3904239">block</span><span class="op" id="3904244">.</span><span class="ident" id="3904245">Type</span>&nbsp;<span class="op" id="3904250">!=</span>&nbsp;<span class="string" id="3904253">&#34;CERTIFICATE&#34;</span>&nbsp;<span class="op" id="3904267">||</span>&nbsp;<span class="builtinfunc" id="3904270">len</span><span class="op" id="3904273">(</span><span class="ident" id="3904274">block</span><span class="op" id="3904279">.</span><span class="ident" id="3904280">Headers</span><span class="op" id="3904287">)</span>&nbsp;<span class="op" id="3904289">!=</span>&nbsp;<span class="num" id="3904292">0</span>&nbsp;<span class="op" id="3904294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3904299">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3904310">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3904315">cert</span><span class="op" id="3904319">,</span>&nbsp;<span class="ident" id="3904321">err</span>&nbsp;<span class="op" id="3904325">:=</span>&nbsp;<span class="ident" id="3904328">ParseCertificate</span><span class="op" id="3904344">(</span><span class="ident" id="3904345">block</span><span class="op" id="3904350">.</span><span class="ident" id="3904351">Bytes</span><span class="op" id="3904356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3904360">if</span>&nbsp;<span class="ident" id="3904363">err</span>&nbsp;<span class="op" id="3904367">!=</span>&nbsp;<span class="builtintype" id="3904370">nil</span>&nbsp;<span class="op" id="3904374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3904379">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3904390">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3904395">s</span><span class="op" id="3904396">.</span><span class="ident" id="3904397">AddCert</span><span class="op" id="3904404">(</span><span class="ident" id="3904405">cert</span><span class="op" id="3904409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3904413">ok</span>&nbsp;<span class="op" id="3904416">=</span>&nbsp;<span class="builtintype" id="3904418">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3904424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3904428">return</span><br>
<span class="lineno"></span><span class="op" id="3904435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3904438">//&nbsp;Subjects&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;the&nbsp;DER-encoded&nbsp;subjects&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3904496">//&nbsp;all&nbsp;of&nbsp;the&nbsp;certificates&nbsp;in&nbsp;the&nbsp;pool.</span><br>
<span class="lineno">110</span><span class="keyword" id="3904536">func</span>&nbsp;<span class="op" id="3904541">(</span><span class="ident" id="3904542">s</span>&nbsp;<span class="op" id="3904544">*</span><span class="ident" id="3904545">CertPool</span><span class="op" id="3904553">)</span>&nbsp;<span class="ident" id="3904555">Subjects</span><span class="op" id="3904563">(</span><span class="op" id="3904564">)</span>&nbsp;<span class="op" id="3904566">(</span><span class="ident" id="3904567">res</span>&nbsp;<span class="op" id="3904571">[</span><span class="op" id="3904572">]</span><span class="op" id="3904573">[</span><span class="op" id="3904574">]</span><span class="builtintype" id="3904575">byte</span><span class="op" id="3904579">)</span>&nbsp;<span class="op" id="3904581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3904584">res</span>&nbsp;<span class="op" id="3904588">=</span>&nbsp;<span class="builtinfunc" id="3904590">make</span><span class="op" id="3904594">(</span><span class="op" id="3904595">[</span><span class="op" id="3904596">]</span><span class="op" id="3904597">[</span><span class="op" id="3904598">]</span><span class="builtintype" id="3904599">byte</span><span class="op" id="3904603">,</span>&nbsp;<span class="builtinfunc" id="3904605">len</span><span class="op" id="3904608">(</span><span class="ident" id="3904609">s</span><span class="op" id="3904610">.</span><span class="ident" id="3904611">certs</span><span class="op" id="3904616">)</span><span class="op" id="3904617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3904620">for</span>&nbsp;<span class="ident" id="3904624">i</span><span class="op" id="3904625">,</span>&nbsp;<span class="ident" id="3904627">c</span>&nbsp;<span class="op" id="3904629">:=</span>&nbsp;<span class="keyword" id="3904632">range</span>&nbsp;<span class="ident" id="3904638">s</span><span class="op" id="3904639">.</span><span class="ident" id="3904640">certs</span>&nbsp;<span class="op" id="3904646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3904650">res</span><span class="op" id="3904653">[</span><span class="ident" id="3904654">i</span><span class="op" id="3904655">]</span>&nbsp;<span class="op" id="3904657">=</span>&nbsp;<span class="ident" id="3904659">c</span><span class="op" id="3904660">.</span><span class="ident" id="3904661">RawSubject</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3904673">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3904676">return</span><br>
<span class="lineno"></span><span class="op" id="3904683">}</span>
</div>
</body>
</html>
