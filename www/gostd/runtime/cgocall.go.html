<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html" class="current">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1394334">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1394390">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1394444">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1394495">//&nbsp;Cgo&nbsp;call&nbsp;and&nbsp;callback&nbsp;support.</span><br>
<span class="lineno"></span><span class="comment" id="1394529">//</span><br>
<span class="lineno"></span><span class="comment" id="1394532">//&nbsp;To&nbsp;call&nbsp;into&nbsp;the&nbsp;C&nbsp;function&nbsp;f&nbsp;from&nbsp;Go,&nbsp;the&nbsp;cgo-generated&nbsp;code&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1394603">//&nbsp;runtime.cgocall(_cgo_Cfunc_f,&nbsp;frame),&nbsp;where&nbsp;_cgo_Cfunc_f&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1394668">//&nbsp;gcc-compiled&nbsp;function&nbsp;written&nbsp;by&nbsp;cgo.</span><br>
<span class="lineno">10</span><span class="comment" id="1394709">//</span><br>
<span class="lineno"></span><span class="comment" id="1394712">//&nbsp;runtime.cgocall&nbsp;(below)&nbsp;locks&nbsp;g&nbsp;to&nbsp;m,&nbsp;calls&nbsp;entersyscall</span><br>
<span class="lineno"></span><span class="comment" id="1394772">//&nbsp;so&nbsp;as&nbsp;not&nbsp;to&nbsp;block&nbsp;other&nbsp;goroutines&nbsp;or&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span><span class="comment" id="1394837">//&nbsp;and&nbsp;then&nbsp;calls&nbsp;runtime.asmcgocall(_cgo_Cfunc_f,&nbsp;frame).</span><br>
<span class="lineno"></span><span class="comment" id="1394896">//</span><br>
<span class="lineno">15</span><span class="comment" id="1394899">//&nbsp;runtime.asmcgocall&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;to&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1394968">//&nbsp;(assumed&nbsp;to&nbsp;be&nbsp;an&nbsp;operating&nbsp;system-allocated&nbsp;stack,&nbsp;so&nbsp;safe&nbsp;to&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="1395038">//&nbsp;gcc-compiled&nbsp;code&nbsp;on)&nbsp;and&nbsp;calls&nbsp;_cgo_Cfunc_f(frame).</span><br>
<span class="lineno"></span><span class="comment" id="1395094">//</span><br>
<span class="lineno"></span><span class="comment" id="1395097">//&nbsp;_cgo_Cfunc_f&nbsp;invokes&nbsp;the&nbsp;actual&nbsp;C&nbsp;function&nbsp;f&nbsp;with&nbsp;arguments</span><br>
<span class="lineno">20</span><span class="comment" id="1395160">//&nbsp;taken&nbsp;from&nbsp;the&nbsp;frame&nbsp;structure,&nbsp;records&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;frame,</span><br>
<span class="lineno"></span><span class="comment" id="1395229">//&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.asmcgocall.</span><br>
<span class="lineno"></span><span class="comment" id="1395267">//</span><br>
<span class="lineno"></span><span class="comment" id="1395270">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.asmcgocall&nbsp;switches&nbsp;back&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1395339">//&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocall.</span><br>
<span class="lineno">25</span><span class="comment" id="1395403">//</span><br>
<span class="lineno"></span><span class="comment" id="1395406">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocall&nbsp;calls&nbsp;exitsyscall,&nbsp;which&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="1395483">//&nbsp;until&nbsp;this&nbsp;m&nbsp;can&nbsp;run&nbsp;Go&nbsp;code&nbsp;without&nbsp;violating&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit,</span><br>
<span class="lineno"></span><span class="comment" id="1395556">//&nbsp;and&nbsp;then&nbsp;unlocks&nbsp;g&nbsp;from&nbsp;m.</span><br>
<span class="lineno"></span><span class="comment" id="1395586">//</span><br>
<span class="lineno">30</span><span class="comment" id="1395589">//&nbsp;The&nbsp;above&nbsp;description&nbsp;skipped&nbsp;over&nbsp;the&nbsp;possibility&nbsp;of&nbsp;the&nbsp;gcc-compiled</span><br>
<span class="lineno"></span><span class="comment" id="1395663">//&nbsp;function&nbsp;f&nbsp;calling&nbsp;back&nbsp;into&nbsp;Go.&nbsp;&nbsp;If&nbsp;that&nbsp;happens,&nbsp;we&nbsp;continue&nbsp;down</span><br>
<span class="lineno"></span><span class="comment" id="1395734">//&nbsp;the&nbsp;rabbit&nbsp;hole&nbsp;during&nbsp;the&nbsp;execution&nbsp;of&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="1395780">//</span><br>
<span class="lineno"></span><span class="comment" id="1395783">//&nbsp;To&nbsp;make&nbsp;it&nbsp;possible&nbsp;for&nbsp;gcc-compiled&nbsp;C&nbsp;code&nbsp;to&nbsp;call&nbsp;a&nbsp;Go&nbsp;function&nbsp;p.GoF,</span><br>
<span class="lineno">35</span><span class="comment" id="1395859">//&nbsp;cgo&nbsp;writes&nbsp;a&nbsp;gcc-compiled&nbsp;function&nbsp;named&nbsp;GoF&nbsp;(not&nbsp;p.GoF,&nbsp;since&nbsp;gcc&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="1395937">//&nbsp;know&nbsp;about&nbsp;packages).&nbsp;&nbsp;The&nbsp;gcc-compiled&nbsp;C&nbsp;function&nbsp;f&nbsp;calls&nbsp;GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1396004">//</span><br>
<span class="lineno"></span><span class="comment" id="1396007">//&nbsp;GoF&nbsp;calls&nbsp;crosscall2(_cgoexp_GoF,&nbsp;frame,&nbsp;framesize).&nbsp;&nbsp;Crosscall2</span><br>
<span class="lineno"></span><span class="comment" id="1396075">//&nbsp;(in&nbsp;cgo/gcc_$GOARCH.S,&nbsp;a&nbsp;gcc-compiled&nbsp;assembly&nbsp;file)&nbsp;is&nbsp;a&nbsp;two-argument</span><br>
<span class="lineno">40</span><span class="comment" id="1396149">//&nbsp;adapter&nbsp;from&nbsp;the&nbsp;gcc&nbsp;function&nbsp;call&nbsp;ABI&nbsp;to&nbsp;the&nbsp;6c&nbsp;function&nbsp;call&nbsp;ABI.</span><br>
<span class="lineno"></span><span class="comment" id="1396220">//&nbsp;It&nbsp;is&nbsp;called&nbsp;from&nbsp;gcc&nbsp;to&nbsp;call&nbsp;6c&nbsp;functions.&nbsp;&nbsp;In&nbsp;this&nbsp;case&nbsp;it&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1396290">//&nbsp;_cgoexp_GoF(frame,&nbsp;framesize),&nbsp;still&nbsp;running&nbsp;on&nbsp;m-&gt;g0&#39;s&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1396355">//&nbsp;and&nbsp;outside&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit.&nbsp;&nbsp;Thus,&nbsp;this&nbsp;code&nbsp;cannot&nbsp;yet</span><br>
<span class="lineno"></span><span class="comment" id="1396421">//&nbsp;call&nbsp;arbitrary&nbsp;Go&nbsp;code&nbsp;directly&nbsp;and&nbsp;must&nbsp;be&nbsp;careful&nbsp;not&nbsp;to&nbsp;allocate</span><br>
<span class="lineno">45</span><span class="comment" id="1396492">//&nbsp;memory&nbsp;or&nbsp;use&nbsp;up&nbsp;m-&gt;g0&#39;s&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1396527">//</span><br>
<span class="lineno"></span><span class="comment" id="1396530">//&nbsp;_cgoexp_GoF&nbsp;calls&nbsp;runtime.cgocallback(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1396597">//&nbsp;(The&nbsp;reason&nbsp;for&nbsp;having&nbsp;_cgoexp_GoF&nbsp;instead&nbsp;of&nbsp;writing&nbsp;a&nbsp;crosscall3</span><br>
<span class="lineno"></span><span class="comment" id="1396667">//&nbsp;to&nbsp;make&nbsp;this&nbsp;call&nbsp;directly&nbsp;is&nbsp;that&nbsp;_cgoexp_GoF,&nbsp;because&nbsp;it&nbsp;is&nbsp;compiled</span><br>
<span class="lineno">50</span><span class="comment" id="1396741">//&nbsp;with&nbsp;6c&nbsp;instead&nbsp;of&nbsp;gcc,&nbsp;can&nbsp;refer&nbsp;to&nbsp;dotted&nbsp;names&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="1396799">//&nbsp;runtime.cgocallback&nbsp;and&nbsp;p.GoF.)</span><br>
<span class="lineno"></span><span class="comment" id="1396834">//</span><br>
<span class="lineno"></span><span class="comment" id="1396837">//&nbsp;runtime.cgocallback&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;from&nbsp;m-&gt;g0&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1396901">//&nbsp;stack&nbsp;to&nbsp;the&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack,&nbsp;on&nbsp;which&nbsp;it&nbsp;calls</span><br>
<span class="lineno">55</span><span class="comment" id="1396965">//&nbsp;runtime.cgocallbackg(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1397015">//&nbsp;As&nbsp;part&nbsp;of&nbsp;the&nbsp;stack&nbsp;switch,&nbsp;runtime.cgocallback&nbsp;saves&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="1397085">//&nbsp;SP&nbsp;as&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;so&nbsp;that&nbsp;any&nbsp;use&nbsp;of&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1397155">//&nbsp;execution&nbsp;of&nbsp;the&nbsp;callback&nbsp;will&nbsp;be&nbsp;done&nbsp;below&nbsp;the&nbsp;existing&nbsp;stack&nbsp;frames.</span><br>
<span class="lineno"></span><span class="comment" id="1397230">//&nbsp;Before&nbsp;overwriting&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;it&nbsp;pushes&nbsp;the&nbsp;old&nbsp;value&nbsp;on&nbsp;the</span><br>
<span class="lineno">60</span><span class="comment" id="1397300">//&nbsp;m-&gt;g0&nbsp;stack,&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;restored&nbsp;later.</span><br>
<span class="lineno"></span><span class="comment" id="1397350">//</span><br>
<span class="lineno"></span><span class="comment" id="1397353">//&nbsp;runtime.cgocallbackg&nbsp;(below)&nbsp;is&nbsp;now&nbsp;running&nbsp;on&nbsp;a&nbsp;real&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1397420">//&nbsp;stack&nbsp;(not&nbsp;an&nbsp;m-&gt;g0&nbsp;stack).&nbsp;&nbsp;First&nbsp;it&nbsp;calls&nbsp;runtime.exitsyscall,&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="1397499">//&nbsp;block&nbsp;until&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit&nbsp;allows&nbsp;running&nbsp;this&nbsp;goroutine.</span><br>
<span class="lineno">65</span><span class="comment" id="1397567">//&nbsp;Once&nbsp;exitsyscall&nbsp;has&nbsp;returned,&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;do&nbsp;things&nbsp;like&nbsp;call&nbsp;the&nbsp;memory</span><br>
<span class="lineno"></span><span class="comment" id="1397646">//&nbsp;allocator&nbsp;or&nbsp;invoke&nbsp;the&nbsp;Go&nbsp;callback&nbsp;function&nbsp;p.GoF.&nbsp;&nbsp;runtime.cgocallbackg</span><br>
<span class="lineno"></span><span class="comment" id="1397723">//&nbsp;first&nbsp;defers&nbsp;a&nbsp;function&nbsp;to&nbsp;unwind&nbsp;m-&gt;g0.sched.sp,&nbsp;so&nbsp;that&nbsp;if&nbsp;p.GoF</span><br>
<span class="lineno"></span><span class="comment" id="1397793">//&nbsp;panics,&nbsp;m-&gt;g0.sched.sp&nbsp;will&nbsp;be&nbsp;restored&nbsp;to&nbsp;its&nbsp;old&nbsp;value:&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1397870">//&nbsp;and&nbsp;the&nbsp;m-&gt;curg&nbsp;stack&nbsp;will&nbsp;be&nbsp;unwound&nbsp;in&nbsp;lock&nbsp;step.</span><br>
<span class="lineno">70</span><span class="comment" id="1397925">//&nbsp;Then&nbsp;it&nbsp;calls&nbsp;p.GoF.&nbsp;&nbsp;Finally&nbsp;it&nbsp;pops&nbsp;but&nbsp;does&nbsp;not&nbsp;execute&nbsp;the&nbsp;deferred</span><br>
<span class="lineno"></span><span class="comment" id="1398000">//&nbsp;function,&nbsp;calls&nbsp;runtime.entersyscall,&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocallback.</span><br>
<span class="lineno"></span><span class="comment" id="1398077">//</span><br>
<span class="lineno"></span><span class="comment" id="1398080">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocallback&nbsp;switches&nbsp;back&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1398146">//&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;(the&nbsp;pointer&nbsp;is&nbsp;still&nbsp;in&nbsp;m-&gt;g0.sched.sp),&nbsp;restores&nbsp;the&nbsp;old</span><br>
<span class="lineno">75</span><span class="comment" id="1398222">//&nbsp;m-&gt;g0.sched.sp&nbsp;value&nbsp;from&nbsp;the&nbsp;stack,&nbsp;and&nbsp;returns&nbsp;to&nbsp;_cgoexp_GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1398290">//</span><br>
<span class="lineno"></span><span class="comment" id="1398293">//&nbsp;_cgoexp_GoF&nbsp;immediately&nbsp;returns&nbsp;to&nbsp;crosscall2,&nbsp;which&nbsp;restores&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1398362">//&nbsp;callee-save&nbsp;registers&nbsp;for&nbsp;gcc&nbsp;and&nbsp;returns&nbsp;to&nbsp;GoF,&nbsp;which&nbsp;returns&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="1398436">package</span>&nbsp;<span class="ident" id="1398444">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1398453">import</span>&nbsp;<span class="string" id="1398460">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1398470">//&nbsp;Call&nbsp;from&nbsp;Go&nbsp;to&nbsp;C.</span><br>
<span class="lineno">85</span><span class="comment" id="1398492">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1398505">func</span>&nbsp;<span class="ident" id="1398510">cgocall</span><span class="op" id="1398517">(</span><span class="ident" id="1398518">fn</span><span class="op" id="1398520">,</span>&nbsp;<span class="ident" id="1398522">arg</span>&nbsp;<span class="ident" id="1398526">unsafe</span><span class="op" id="1398532">.</span><span class="ident" id="1398533">Pointer</span><span class="op" id="1398540">)</span>&nbsp;<span class="op" id="1398542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1398545">cgocall_errno</span><span class="op" id="1398558">(</span><span class="ident" id="1398559">fn</span><span class="op" id="1398561">,</span>&nbsp;<span class="ident" id="1398563">arg</span><span class="op" id="1398566">)</span><br>
<span class="lineno"></span><span class="op" id="1398568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="1398571">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1398584">func</span>&nbsp;<span class="ident" id="1398589">cgocall_errno</span><span class="op" id="1398602">(</span><span class="ident" id="1398603">fn</span><span class="op" id="1398605">,</span>&nbsp;<span class="ident" id="1398607">arg</span>&nbsp;<span class="ident" id="1398611">unsafe</span><span class="op" id="1398617">.</span><span class="ident" id="1398618">Pointer</span><span class="op" id="1398625">)</span>&nbsp;<span class="builtintype" id="1398627">int32</span>&nbsp;<span class="op" id="1398633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1398636">if</span>&nbsp;<span class="op" id="1398639">!</span><span class="ident" id="1398640">iscgo</span>&nbsp;<span class="op" id="1398646">&amp;&amp;</span>&nbsp;<span class="ident" id="1398649">GOOS</span>&nbsp;<span class="op" id="1398654">!=</span>&nbsp;<span class="string" id="1398657">&#34;solaris&#34;</span>&nbsp;<span class="op" id="1398667">&amp;&amp;</span>&nbsp;<span class="ident" id="1398670">GOOS</span>&nbsp;<span class="op" id="1398675">!=</span>&nbsp;<span class="string" id="1398678">&#34;windows&#34;</span>&nbsp;<span class="op" id="1398688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1398692">gothrow</span><span class="op" id="1398699">(</span><span class="string" id="1398700">&#34;cgocall&nbsp;unavailable&#34;</span><span class="op" id="1398721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1398724">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1398728">if</span>&nbsp;<span class="ident" id="1398731">fn</span>&nbsp;<span class="op" id="1398734">==</span>&nbsp;<span class="builtintype" id="1398737">nil</span>&nbsp;<span class="op" id="1398741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1398745">gothrow</span><span class="op" id="1398752">(</span><span class="string" id="1398753">&#34;cgocall&nbsp;nil&#34;</span><span class="op" id="1398766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1398769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1398773">if</span>&nbsp;<span class="ident" id="1398776">raceenabled</span>&nbsp;<span class="op" id="1398788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1398792">racereleasemerge</span><span class="op" id="1398808">(</span><span class="ident" id="1398809">unsafe</span><span class="op" id="1398815">.</span><span class="ident" id="1398816">Pointer</span><span class="op" id="1398823">(</span><span class="op" id="1398824">&amp;</span><span class="ident" id="1398825">racecgosync</span><span class="op" id="1398836">)</span><span class="op" id="1398837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1398840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1398844">//&nbsp;Create&nbsp;an&nbsp;extra&nbsp;M&nbsp;for&nbsp;callbacks&nbsp;on&nbsp;threads&nbsp;not&nbsp;created&nbsp;by&nbsp;Go&nbsp;on&nbsp;first&nbsp;cgo&nbsp;call.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1398928">if</span>&nbsp;<span class="ident" id="1398931">needextram</span>&nbsp;<span class="op" id="1398942">==</span>&nbsp;<span class="num" id="1398945">1</span>&nbsp;<span class="op" id="1398947">&amp;&amp;</span>&nbsp;<span class="ident" id="1398950">cas</span><span class="op" id="1398953">(</span><span class="op" id="1398954">&amp;</span><span class="ident" id="1398955">needextram</span><span class="op" id="1398965">,</span>&nbsp;<span class="num" id="1398967">1</span><span class="op" id="1398968">,</span>&nbsp;<span class="num" id="1398970">0</span><span class="op" id="1398971">)</span>&nbsp;<span class="op" id="1398973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1398977">onM</span><span class="op" id="1398980">(</span><span class="ident" id="1398981">newextram</span><span class="op" id="1398990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1398993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1398997">/*<br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Lock&nbsp;g&nbsp;to&nbsp;m&nbsp;to&nbsp;ensure&nbsp;we&nbsp;stay&nbsp;on&nbsp;the&nbsp;same&nbsp;stack&nbsp;if&nbsp;we&nbsp;do&nbsp;a<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;cgo&nbsp;callback.&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1399130">lockOSThread</span><span class="op" id="1399142">(</span><span class="op" id="1399143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1399146">mp</span>&nbsp;<span class="op" id="1399149">:=</span>&nbsp;<span class="ident" id="1399152">getg</span><span class="op" id="1399156">(</span><span class="op" id="1399157">)</span><span class="op" id="1399158">.</span><span class="ident" id="1399159">m</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1399162">mp</span><span class="op" id="1399164">.</span><span class="ident" id="1399165">ncgocall</span><span class="op" id="1399173">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1399177">mp</span><span class="op" id="1399179">.</span><span class="ident" id="1399180">ncgo</span><span class="op" id="1399184">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1399188">defer</span>&nbsp;<span class="ident" id="1399194">endcgo</span><span class="op" id="1399200">(</span><span class="ident" id="1399201">mp</span><span class="op" id="1399203">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1399207">/*<br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Announce&nbsp;we&nbsp;are&nbsp;entering&nbsp;a&nbsp;system&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;so&nbsp;that&nbsp;the&nbsp;scheduler&nbsp;knows&nbsp;to&nbsp;create&nbsp;another<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;M&nbsp;to&nbsp;run&nbsp;goroutines&nbsp;while&nbsp;we&nbsp;are&nbsp;in&nbsp;the<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;foreign&nbsp;code.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;call&nbsp;to&nbsp;asmcgocall&nbsp;is&nbsp;guaranteed&nbsp;not&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;split&nbsp;the&nbsp;stack&nbsp;and&nbsp;does&nbsp;not&nbsp;allocate&nbsp;memory,<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;so&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;while&nbsp;&#34;in&nbsp;a&nbsp;system&nbsp;call&#34;,&nbsp;outside<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;$GOMAXPROCS&nbsp;accounting.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1399565">entersyscall</span><span class="op" id="1399577">(</span><span class="op" id="1399578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1399581">errno</span>&nbsp;<span class="op" id="1399587">:=</span>&nbsp;<span class="ident" id="1399590">asmcgocall_errno</span><span class="op" id="1399606">(</span><span class="ident" id="1399607">fn</span><span class="op" id="1399609">,</span>&nbsp;<span class="ident" id="1399611">arg</span><span class="op" id="1399614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1399617">exitsyscall</span><span class="op" id="1399628">(</span><span class="op" id="1399629">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1399633">return</span>&nbsp;<span class="ident" id="1399640">errno</span><br>
<span class="lineno">135</span><span class="op" id="1399646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1399649">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1399662">func</span>&nbsp;<span class="ident" id="1399667">endcgo</span><span class="op" id="1399673">(</span><span class="ident" id="1399674">mp</span>&nbsp;<span class="op" id="1399677">*</span><span class="ident" id="1399678">m</span><span class="op" id="1399679">)</span>&nbsp;<span class="op" id="1399681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1399684">mp</span><span class="op" id="1399686">.</span><span class="ident" id="1399687">ncgo</span><span class="op" id="1399691">--</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1399695">if</span>&nbsp;<span class="ident" id="1399698">mp</span><span class="op" id="1399700">.</span><span class="ident" id="1399701">ncgo</span>&nbsp;<span class="op" id="1399706">==</span>&nbsp;<span class="num" id="1399709">0</span>&nbsp;<span class="op" id="1399711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1399715">//&nbsp;We&nbsp;are&nbsp;going&nbsp;back&nbsp;to&nbsp;Go&nbsp;and&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;recursive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1399771">//&nbsp;call.&nbsp;&nbsp;Let&nbsp;the&nbsp;GC&nbsp;collect&nbsp;any&nbsp;memory&nbsp;allocated&nbsp;via</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1399827">//&nbsp;_cgo_allocate&nbsp;that&nbsp;is&nbsp;no&nbsp;longer&nbsp;referenced.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1399876">mp</span><span class="op" id="1399878">.</span><span class="ident" id="1399879">cgomal</span>&nbsp;<span class="op" id="1399886">=</span>&nbsp;<span class="builtintype" id="1399888">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1399893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1399897">if</span>&nbsp;<span class="ident" id="1399900">raceenabled</span>&nbsp;<span class="op" id="1399912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1399916">raceacquire</span><span class="op" id="1399927">(</span><span class="ident" id="1399928">unsafe</span><span class="op" id="1399934">.</span><span class="ident" id="1399935">Pointer</span><span class="op" id="1399942">(</span><span class="op" id="1399943">&amp;</span><span class="ident" id="1399944">racecgosync</span><span class="op" id="1399955">)</span><span class="op" id="1399956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1399959">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1399963">unlockOSThread</span><span class="op" id="1399977">(</span><span class="op" id="1399978">)</span>&nbsp;<span class="comment" id="1399980">//&nbsp;invalidates&nbsp;mp</span><br>
<span class="lineno"></span><span class="op" id="1399998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1400001">//&nbsp;Helper&nbsp;functions&nbsp;for&nbsp;cgo&nbsp;code.</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="1400036">//&nbsp;Filled&nbsp;by&nbsp;schedinit&nbsp;from&nbsp;corresponding&nbsp;C&nbsp;variables,</span><br>
<span class="lineno"></span><span class="comment" id="1400091">//&nbsp;which&nbsp;are&nbsp;in&nbsp;turn&nbsp;filled&nbsp;in&nbsp;by&nbsp;dynamic&nbsp;linker&nbsp;when&nbsp;Cgo&nbsp;is&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="1400163">var</span>&nbsp;<span class="ident" id="1400167">cgoMalloc</span><span class="op" id="1400176">,</span>&nbsp;<span class="ident" id="1400178">cgoFree</span>&nbsp;<span class="ident" id="1400186">unsafe</span><span class="op" id="1400192">.</span><span class="ident" id="1400193">Pointer</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="keyword" id="1400202">func</span>&nbsp;<span class="ident" id="1400207">cmalloc</span><span class="op" id="1400214">(</span><span class="ident" id="1400215">n</span>&nbsp;<span class="builtintype" id="1400217">uintptr</span><span class="op" id="1400224">)</span>&nbsp;<span class="ident" id="1400226">unsafe</span><span class="op" id="1400232">.</span><span class="ident" id="1400233">Pointer</span>&nbsp;<span class="op" id="1400241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1400244">var</span>&nbsp;<span class="ident" id="1400248">args</span>&nbsp;<span class="keyword" id="1400253">struct</span>&nbsp;<span class="op" id="1400260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1400264">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1400268">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1400277">ret</span>&nbsp;<span class="ident" id="1400281">unsafe</span><span class="op" id="1400287">.</span><span class="ident" id="1400288">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1400297">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1400300">args</span><span class="op" id="1400304">.</span><span class="ident" id="1400305">n</span>&nbsp;<span class="op" id="1400307">=</span>&nbsp;<span class="builtintype" id="1400309">uint64</span><span class="op" id="1400315">(</span><span class="ident" id="1400316">n</span><span class="op" id="1400317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1400320">cgocall</span><span class="op" id="1400327">(</span><span class="ident" id="1400328">cgoMalloc</span><span class="op" id="1400337">,</span>&nbsp;<span class="ident" id="1400339">unsafe</span><span class="op" id="1400345">.</span><span class="ident" id="1400346">Pointer</span><span class="op" id="1400353">(</span><span class="op" id="1400354">&amp;</span><span class="ident" id="1400355">args</span><span class="op" id="1400359">)</span><span class="op" id="1400360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1400363">if</span>&nbsp;<span class="ident" id="1400366">args</span><span class="op" id="1400370">.</span><span class="ident" id="1400371">ret</span>&nbsp;<span class="op" id="1400375">==</span>&nbsp;<span class="builtintype" id="1400378">nil</span>&nbsp;<span class="op" id="1400382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1400386">gothrow</span><span class="op" id="1400393">(</span><span class="string" id="1400394">&#34;C&nbsp;malloc&nbsp;failed&#34;</span><span class="op" id="1400411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1400414">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1400417">return</span>&nbsp;<span class="ident" id="1400424">args</span><span class="op" id="1400428">.</span><span class="ident" id="1400429">ret</span><br>
<span class="lineno"></span><span class="op" id="1400433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1400436">func</span>&nbsp;<span class="ident" id="1400441">cfree</span><span class="op" id="1400446">(</span><span class="ident" id="1400447">p</span>&nbsp;<span class="ident" id="1400449">unsafe</span><span class="op" id="1400455">.</span><span class="ident" id="1400456">Pointer</span><span class="op" id="1400463">)</span>&nbsp;<span class="op" id="1400465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1400468">cgocall</span><span class="op" id="1400475">(</span><span class="ident" id="1400476">cgoFree</span><span class="op" id="1400483">,</span>&nbsp;<span class="ident" id="1400485">p</span><span class="op" id="1400486">)</span><br>
<span class="lineno">175</span><span class="op" id="1400488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1400491">//&nbsp;Call&nbsp;from&nbsp;C&nbsp;back&nbsp;to&nbsp;Go.</span><br>
<span class="lineno"></span><span class="comment" id="1400518">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1400531">func</span>&nbsp;<span class="ident" id="1400536">cgocallbackg</span><span class="op" id="1400548">(</span><span class="op" id="1400549">)</span>&nbsp;<span class="op" id="1400551">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1400554">gp</span>&nbsp;<span class="op" id="1400557">:=</span>&nbsp;<span class="ident" id="1400560">getg</span><span class="op" id="1400564">(</span><span class="op" id="1400565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1400568">if</span>&nbsp;<span class="ident" id="1400571">gp</span>&nbsp;<span class="op" id="1400574">!=</span>&nbsp;<span class="ident" id="1400577">gp</span><span class="op" id="1400579">.</span><span class="ident" id="1400580">m</span><span class="op" id="1400581">.</span><span class="ident" id="1400582">curg</span>&nbsp;<span class="op" id="1400587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1400591">println</span><span class="op" id="1400598">(</span><span class="string" id="1400599">&#34;runtime:&nbsp;bad&nbsp;g&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1400630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1400634">exit</span><span class="op" id="1400638">(</span><span class="num" id="1400639">2</span><span class="op" id="1400640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1400643">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1400647">//&nbsp;entersyscall&nbsp;saves&nbsp;the&nbsp;caller&#39;s&nbsp;SP&nbsp;to&nbsp;allow&nbsp;the&nbsp;GC&nbsp;to&nbsp;trace&nbsp;the&nbsp;Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1400718">//&nbsp;stack.&nbsp;However,&nbsp;since&nbsp;we&#39;re&nbsp;returning&nbsp;to&nbsp;an&nbsp;earlier&nbsp;stack&nbsp;frame&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1400790">//&nbsp;need&nbsp;to&nbsp;pair&nbsp;with&nbsp;the&nbsp;entersyscall()&nbsp;call&nbsp;made&nbsp;by&nbsp;cgocall,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1400861">//&nbsp;save&nbsp;syscall*&nbsp;and&nbsp;let&nbsp;reentersyscall&nbsp;restore&nbsp;them.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1400916">savedsp</span>&nbsp;<span class="op" id="1400924">:=</span>&nbsp;<span class="ident" id="1400927">unsafe</span><span class="op" id="1400933">.</span><span class="ident" id="1400934">Pointer</span><span class="op" id="1400941">(</span><span class="ident" id="1400942">gp</span><span class="op" id="1400944">.</span><span class="ident" id="1400945">syscallsp</span><span class="op" id="1400954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1400957">savedpc</span>&nbsp;<span class="op" id="1400965">:=</span>&nbsp;<span class="ident" id="1400968">gp</span><span class="op" id="1400970">.</span><span class="ident" id="1400971">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1400982">exitsyscall</span><span class="op" id="1400993">(</span><span class="op" id="1400994">)</span>&nbsp;<span class="comment" id="1400996">//&nbsp;coming&nbsp;out&nbsp;of&nbsp;cgo&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1401023">cgocallbackg1</span><span class="op" id="1401036">(</span><span class="op" id="1401037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1401040">//&nbsp;going&nbsp;back&nbsp;to&nbsp;cgo&nbsp;call</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1401067">reentersyscall</span><span class="op" id="1401081">(</span><span class="ident" id="1401082">savedpc</span><span class="op" id="1401089">,</span>&nbsp;<span class="ident" id="1401091">savedsp</span><span class="op" id="1401098">)</span><br>
<span class="lineno"></span><span class="op" id="1401100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1401103">func</span>&nbsp;<span class="ident" id="1401108">cgocallbackg1</span><span class="op" id="1401121">(</span><span class="op" id="1401122">)</span>&nbsp;<span class="op" id="1401124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1401127">gp</span>&nbsp;<span class="op" id="1401130">:=</span>&nbsp;<span class="ident" id="1401133">getg</span><span class="op" id="1401137">(</span><span class="op" id="1401138">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1401141">if</span>&nbsp;<span class="ident" id="1401144">gp</span><span class="op" id="1401146">.</span><span class="ident" id="1401147">m</span><span class="op" id="1401148">.</span><span class="ident" id="1401149">needextram</span>&nbsp;<span class="op" id="1401160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1401164">gp</span><span class="op" id="1401166">.</span><span class="ident" id="1401167">m</span><span class="op" id="1401168">.</span><span class="ident" id="1401169">needextram</span>&nbsp;<span class="op" id="1401180">=</span>&nbsp;<span class="builtintype" id="1401182">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1401190">onM</span><span class="op" id="1401193">(</span><span class="ident" id="1401194">newextram</span><span class="op" id="1401203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1401206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1401210">//&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1401257">restore</span>&nbsp;<span class="op" id="1401265">:=</span>&nbsp;<span class="builtintype" id="1401268">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1401274">defer</span>&nbsp;<span class="ident" id="1401280">unwindm</span><span class="op" id="1401287">(</span><span class="op" id="1401288">&amp;</span><span class="ident" id="1401289">restore</span><span class="op" id="1401296">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1401300">if</span>&nbsp;<span class="ident" id="1401303">raceenabled</span>&nbsp;<span class="op" id="1401315">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1401319">raceacquire</span><span class="op" id="1401330">(</span><span class="ident" id="1401331">unsafe</span><span class="op" id="1401337">.</span><span class="ident" id="1401338">Pointer</span><span class="op" id="1401345">(</span><span class="op" id="1401346">&amp;</span><span class="ident" id="1401347">racecgosync</span><span class="op" id="1401358">)</span><span class="op" id="1401359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1401362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1401366">type</span>&nbsp;<span class="ident" id="1401371">args</span>&nbsp;<span class="keyword" id="1401376">struct</span>&nbsp;<span class="op" id="1401383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1401387">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1401395">*</span><span class="ident" id="1401396">funcval</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1401406">arg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1401414">unsafe</span><span class="op" id="1401420">.</span><span class="ident" id="1401421">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1401431">argsize</span>&nbsp;<span class="builtintype" id="1401439">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1401448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1401451">var</span>&nbsp;<span class="ident" id="1401455">cb</span>&nbsp;<span class="op" id="1401458">*</span><span class="ident" id="1401459">args</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1401466">//&nbsp;Location&nbsp;of&nbsp;callback&nbsp;arguments&nbsp;depends&nbsp;on&nbsp;stack&nbsp;frame&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1401531">//&nbsp;and&nbsp;size&nbsp;of&nbsp;stack&nbsp;frame&nbsp;of&nbsp;cgocallback_gofunc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1401582">sp</span>&nbsp;<span class="op" id="1401585">:=</span>&nbsp;<span class="ident" id="1401588">gp</span><span class="op" id="1401590">.</span><span class="ident" id="1401591">m</span><span class="op" id="1401592">.</span><span class="ident" id="1401593">g0</span><span class="op" id="1401595">.</span><span class="ident" id="1401596">sched</span><span class="op" id="1401601">.</span><span class="ident" id="1401602">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1401606">switch</span>&nbsp;<span class="ident" id="1401613">GOARCH</span>&nbsp;<span class="op" id="1401620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1401623">default</span><span class="op" id="1401630">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1401634">gothrow</span><span class="op" id="1401641">(</span><span class="string" id="1401642">&#34;cgocallbackg&nbsp;is&nbsp;unimplemented&nbsp;on&nbsp;arch&#34;</span><span class="op" id="1401681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1401684">case</span>&nbsp;<span class="string" id="1401689">&#34;arm&#34;</span><span class="op" id="1401694">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1401698">//&nbsp;On&nbsp;arm,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;two&nbsp;words&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;saved&nbsp;LR&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1401767">//&nbsp;SP&nbsp;and&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;between&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;the&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1401842">cb</span>&nbsp;<span class="op" id="1401845">=</span>&nbsp;<span class="op" id="1401847">(</span><span class="op" id="1401848">*</span><span class="ident" id="1401849">args</span><span class="op" id="1401853">)</span><span class="op" id="1401854">(</span><span class="ident" id="1401855">unsafe</span><span class="op" id="1401861">.</span><span class="ident" id="1401862">Pointer</span><span class="op" id="1401869">(</span><span class="ident" id="1401870">sp</span>&nbsp;<span class="op" id="1401873">+</span>&nbsp;<span class="num" id="1401875">4</span><span class="op" id="1401876">*</span><span class="ident" id="1401877">ptrSize</span><span class="op" id="1401884">)</span><span class="op" id="1401885">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1401888">case</span>&nbsp;<span class="string" id="1401893">&#34;amd64&#34;</span><span class="op" id="1401900">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1401904">//&nbsp;On&nbsp;amd64,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;one&nbsp;word,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1401960">cb</span>&nbsp;<span class="op" id="1401963">=</span>&nbsp;<span class="op" id="1401965">(</span><span class="op" id="1401966">*</span><span class="ident" id="1401967">args</span><span class="op" id="1401971">)</span><span class="op" id="1401972">(</span><span class="ident" id="1401973">unsafe</span><span class="op" id="1401979">.</span><span class="ident" id="1401980">Pointer</span><span class="op" id="1401987">(</span><span class="ident" id="1401988">sp</span>&nbsp;<span class="op" id="1401991">+</span>&nbsp;<span class="num" id="1401993">2</span><span class="op" id="1401994">*</span><span class="ident" id="1401995">ptrSize</span><span class="op" id="1402002">)</span><span class="op" id="1402003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1402006">case</span>&nbsp;<span class="string" id="1402011">&#34;386&#34;</span><span class="op" id="1402016">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1402020">//&nbsp;On&nbsp;386,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;three&nbsp;words,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1402077">cb</span>&nbsp;<span class="op" id="1402080">=</span>&nbsp;<span class="op" id="1402082">(</span><span class="op" id="1402083">*</span><span class="ident" id="1402084">args</span><span class="op" id="1402088">)</span><span class="op" id="1402089">(</span><span class="ident" id="1402090">unsafe</span><span class="op" id="1402096">.</span><span class="ident" id="1402097">Pointer</span><span class="op" id="1402104">(</span><span class="ident" id="1402105">sp</span>&nbsp;<span class="op" id="1402108">+</span>&nbsp;<span class="num" id="1402110">4</span><span class="op" id="1402111">*</span><span class="ident" id="1402112">ptrSize</span><span class="op" id="1402119">)</span><span class="op" id="1402120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1402123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1402127">//&nbsp;Invoke&nbsp;callback.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1402148">reflectcall</span><span class="op" id="1402159">(</span><span class="ident" id="1402160">unsafe</span><span class="op" id="1402166">.</span><span class="ident" id="1402167">Pointer</span><span class="op" id="1402174">(</span><span class="ident" id="1402175">cb</span><span class="op" id="1402177">.</span><span class="ident" id="1402178">fn</span><span class="op" id="1402180">)</span><span class="op" id="1402181">,</span>&nbsp;<span class="ident" id="1402183">unsafe</span><span class="op" id="1402189">.</span><span class="ident" id="1402190">Pointer</span><span class="op" id="1402197">(</span><span class="ident" id="1402198">cb</span><span class="op" id="1402200">.</span><span class="ident" id="1402201">arg</span><span class="op" id="1402204">)</span><span class="op" id="1402205">,</span>&nbsp;<span class="builtintype" id="1402207">uint32</span><span class="op" id="1402213">(</span><span class="ident" id="1402214">cb</span><span class="op" id="1402216">.</span><span class="ident" id="1402217">argsize</span><span class="op" id="1402224">)</span><span class="op" id="1402225">,</span>&nbsp;<span class="num" id="1402227">0</span><span class="op" id="1402228">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1402232">if</span>&nbsp;<span class="ident" id="1402235">raceenabled</span>&nbsp;<span class="op" id="1402247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1402251">racereleasemerge</span><span class="op" id="1402267">(</span><span class="ident" id="1402268">unsafe</span><span class="op" id="1402274">.</span><span class="ident" id="1402275">Pointer</span><span class="op" id="1402282">(</span><span class="op" id="1402283">&amp;</span><span class="ident" id="1402284">racecgosync</span><span class="op" id="1402295">)</span><span class="op" id="1402296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1402299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1402303">//&nbsp;Do&nbsp;not&nbsp;unwind&nbsp;m-&gt;g0-&gt;sched.sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1402338">//&nbsp;Our&nbsp;caller,&nbsp;cgocallback,&nbsp;will&nbsp;do&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1402381">restore</span>&nbsp;<span class="op" id="1402389">=</span>&nbsp;<span class="builtintype" id="1402391">false</span><br>
<span class="lineno"></span><span class="op" id="1402397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="1402400">func</span>&nbsp;<span class="ident" id="1402405">unwindm</span><span class="op" id="1402412">(</span><span class="ident" id="1402413">restore</span>&nbsp;<span class="op" id="1402421">*</span><span class="builtintype" id="1402422">bool</span><span class="op" id="1402426">)</span>&nbsp;<span class="op" id="1402428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1402431">if</span>&nbsp;<span class="op" id="1402434">!</span><span class="op" id="1402435">*</span><span class="ident" id="1402436">restore</span>&nbsp;<span class="op" id="1402444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1402448">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1402456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1402459">//&nbsp;Restore&nbsp;sp&nbsp;saved&nbsp;by&nbsp;cgocallback&nbsp;during</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1402502">//&nbsp;unwind&nbsp;of&nbsp;g&#39;s&nbsp;stack&nbsp;(see&nbsp;comment&nbsp;at&nbsp;top&nbsp;of&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1402556">mp</span>&nbsp;<span class="op" id="1402559">:=</span>&nbsp;<span class="ident" id="1402562">acquirem</span><span class="op" id="1402570">(</span><span class="op" id="1402571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1402574">sched</span>&nbsp;<span class="op" id="1402580">:=</span>&nbsp;<span class="op" id="1402583">&amp;</span><span class="ident" id="1402584">mp</span><span class="op" id="1402586">.</span><span class="ident" id="1402587">g0</span><span class="op" id="1402589">.</span><span class="ident" id="1402590">sched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1402597">switch</span>&nbsp;<span class="ident" id="1402604">GOARCH</span>&nbsp;<span class="op" id="1402611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1402614">default</span><span class="op" id="1402621">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1402625">gothrow</span><span class="op" id="1402632">(</span><span class="string" id="1402633">&#34;unwindm&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1402658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1402661">case</span>&nbsp;<span class="string" id="1402666">&#34;386&#34;</span><span class="op" id="1402671">,</span>&nbsp;<span class="string" id="1402673">&#34;amd64&#34;</span><span class="op" id="1402680">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1402684">sched</span><span class="op" id="1402689">.</span><span class="ident" id="1402690">sp</span>&nbsp;<span class="op" id="1402693">=</span>&nbsp;<span class="op" id="1402695">*</span><span class="op" id="1402696">(</span><span class="op" id="1402697">*</span><span class="builtintype" id="1402698">uintptr</span><span class="op" id="1402705">)</span><span class="op" id="1402706">(</span><span class="ident" id="1402707">unsafe</span><span class="op" id="1402713">.</span><span class="ident" id="1402714">Pointer</span><span class="op" id="1402721">(</span><span class="ident" id="1402722">sched</span><span class="op" id="1402727">.</span><span class="ident" id="1402728">sp</span><span class="op" id="1402730">)</span><span class="op" id="1402731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1402734">case</span>&nbsp;<span class="string" id="1402739">&#34;arm&#34;</span><span class="op" id="1402744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1402748">sched</span><span class="op" id="1402753">.</span><span class="ident" id="1402754">sp</span>&nbsp;<span class="op" id="1402757">=</span>&nbsp;<span class="op" id="1402759">*</span><span class="op" id="1402760">(</span><span class="op" id="1402761">*</span><span class="builtintype" id="1402762">uintptr</span><span class="op" id="1402769">)</span><span class="op" id="1402770">(</span><span class="ident" id="1402771">unsafe</span><span class="op" id="1402777">.</span><span class="ident" id="1402778">Pointer</span><span class="op" id="1402785">(</span><span class="ident" id="1402786">sched</span><span class="op" id="1402791">.</span><span class="ident" id="1402792">sp</span>&nbsp;<span class="op" id="1402795">+</span>&nbsp;<span class="num" id="1402797">4</span><span class="op" id="1402798">)</span><span class="op" id="1402799">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1402802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1402805">releasem</span><span class="op" id="1402813">(</span><span class="ident" id="1402814">mp</span><span class="op" id="1402816">)</span><br>
<span class="lineno"></span><span class="op" id="1402818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1402821">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno">270</span><span class="keyword" id="1402845">func</span>&nbsp;<span class="ident" id="1402850">badcgocallback</span><span class="op" id="1402864">(</span><span class="op" id="1402865">)</span>&nbsp;<span class="op" id="1402867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1402870">gothrow</span><span class="op" id="1402877">(</span><span class="string" id="1402878">&#34;misaligned&nbsp;stack&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1402911">)</span><br>
<span class="lineno"></span><span class="op" id="1402913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1402916">//&nbsp;called&nbsp;from&nbsp;(incomplete)&nbsp;assembly</span><br>
<span class="lineno">275</span><span class="keyword" id="1402953">func</span>&nbsp;<span class="ident" id="1402958">cgounimpl</span><span class="op" id="1402967">(</span><span class="op" id="1402968">)</span>&nbsp;<span class="op" id="1402970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1402973">gothrow</span><span class="op" id="1402980">(</span><span class="string" id="1402981">&#34;cgo&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1403002">)</span><br>
<span class="lineno"></span><span class="op" id="1403004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1403007">var</span>&nbsp;<span class="ident" id="1403011">racecgosync</span>&nbsp;<span class="builtintype" id="1403023">uint64</span>&nbsp;<span class="comment" id="1403030">//&nbsp;represents&nbsp;possible&nbsp;synchronization&nbsp;in&nbsp;C&nbsp;code</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
