<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3116137">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3116193">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3116247">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3116298">package</span>&nbsp;<span class="ident" id="3116306">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3116312">import</span>&nbsp;<span class="op" id="3116319">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3116322">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3116331">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3116349">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3116352">//&nbsp;The&nbsp;algorithm&nbsp;uses&nbsp;at&nbsp;most&nbsp;sniffLen&nbsp;bytes&nbsp;to&nbsp;make&nbsp;its&nbsp;decision.</span><br>
<span class="lineno"></span><span class="keyword" id="3116419">const</span>&nbsp;<span class="ident" id="3116425">sniffLen</span>&nbsp;<span class="op" id="3116434">=</span>&nbsp;<span class="num" id="3116436">512</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3116441">//&nbsp;DetectContentType&nbsp;implements&nbsp;the&nbsp;algorithm&nbsp;described</span><br>
<span class="lineno"></span><span class="comment" id="3116497">//&nbsp;at&nbsp;http://mimesniff.spec.whatwg.org/&nbsp;to&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3116554">//&nbsp;Content-Type&nbsp;of&nbsp;the&nbsp;given&nbsp;data.&nbsp;&nbsp;It&nbsp;considers&nbsp;at&nbsp;most&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3116615">//&nbsp;first&nbsp;512&nbsp;bytes&nbsp;of&nbsp;data.&nbsp;&nbsp;DetectContentType&nbsp;always&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3116677">//&nbsp;a&nbsp;valid&nbsp;MIME&nbsp;type:&nbsp;if&nbsp;it&nbsp;cannot&nbsp;determine&nbsp;a&nbsp;more&nbsp;specific&nbsp;one,&nbsp;it</span><br>
<span class="lineno">20</span><span class="comment" id="3116746">//&nbsp;returns&nbsp;&#34;application/octet-stream&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3116785">func</span>&nbsp;<span class="ident" id="3116790">DetectContentType</span><span class="op" id="3116807">(</span><span class="ident" id="3116808">data</span>&nbsp;<span class="op" id="3116813">[</span><span class="op" id="3116814">]</span><span class="builtintype" id="3116815">byte</span><span class="op" id="3116819">)</span>&nbsp;<span class="builtintype" id="3116821">string</span>&nbsp;<span class="op" id="3116828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116831">if</span>&nbsp;<span class="builtinfunc" id="3116834">len</span><span class="op" id="3116837">(</span><span class="ident" id="3116838">data</span><span class="op" id="3116842">)</span>&nbsp;<span class="op" id="3116844">&gt;</span>&nbsp;<span class="ident" id="3116846">sniffLen</span>&nbsp;<span class="op" id="3116855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3116859">data</span>&nbsp;<span class="op" id="3116864">=</span>&nbsp;<span class="ident" id="3116866">data</span><span class="op" id="3116870">[</span><span class="op" id="3116871">:</span><span class="ident" id="3116872">sniffLen</span><span class="op" id="3116880">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3116883">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3116887">//&nbsp;Index&nbsp;of&nbsp;the&nbsp;first&nbsp;non-whitespace&nbsp;byte&nbsp;in&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3116939">firstNonWS</span>&nbsp;<span class="op" id="3116950">:=</span>&nbsp;<span class="num" id="3116953">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116956">for</span>&nbsp;<span class="op" id="3116960">;</span>&nbsp;<span class="ident" id="3116962">firstNonWS</span>&nbsp;<span class="op" id="3116973">&lt;</span>&nbsp;<span class="builtinfunc" id="3116975">len</span><span class="op" id="3116978">(</span><span class="ident" id="3116979">data</span><span class="op" id="3116983">)</span>&nbsp;<span class="op" id="3116985">&amp;&amp;</span>&nbsp;<span class="ident" id="3116988">isWS</span><span class="op" id="3116992">(</span><span class="ident" id="3116993">data</span><span class="op" id="3116997">[</span><span class="ident" id="3116998">firstNonWS</span><span class="op" id="3117008">]</span><span class="op" id="3117009">)</span><span class="op" id="3117010">;</span>&nbsp;<span class="ident" id="3117012">firstNonWS</span><span class="op" id="3117022">++</span>&nbsp;<span class="op" id="3117025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3117028">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117032">for</span>&nbsp;<span class="ident" id="3117036">_</span><span class="op" id="3117037">,</span>&nbsp;<span class="ident" id="3117039">sig</span>&nbsp;<span class="op" id="3117043">:=</span>&nbsp;<span class="keyword" id="3117046">range</span>&nbsp;<span class="ident" id="3117052">sniffSignatures</span>&nbsp;<span class="op" id="3117068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117072">if</span>&nbsp;<span class="ident" id="3117075">ct</span>&nbsp;<span class="op" id="3117078">:=</span>&nbsp;<span class="ident" id="3117081">sig</span><span class="op" id="3117084">.</span><span class="ident" id="3117085">match</span><span class="op" id="3117090">(</span><span class="ident" id="3117091">data</span><span class="op" id="3117095">,</span>&nbsp;<span class="ident" id="3117097">firstNonWS</span><span class="op" id="3117107">)</span><span class="op" id="3117108">;</span>&nbsp;<span class="ident" id="3117110">ct</span>&nbsp;<span class="op" id="3117113">!=</span>&nbsp;<span class="string" id="3117116">&#34;&#34;</span>&nbsp;<span class="op" id="3117119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117124">return</span>&nbsp;<span class="ident" id="3117131">ct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3117136">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3117139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117143">return</span>&nbsp;<span class="string" id="3117150">&#34;application/octet-stream&#34;</span>&nbsp;<span class="comment" id="3117177">//&nbsp;fallback</span><br>
<span class="lineno"></span><span class="op" id="3117189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="3117192">func</span>&nbsp;<span class="ident" id="3117197">isWS</span><span class="op" id="3117201">(</span><span class="ident" id="3117202">b</span>&nbsp;<span class="builtintype" id="3117204">byte</span><span class="op" id="3117208">)</span>&nbsp;<span class="builtintype" id="3117210">bool</span>&nbsp;<span class="op" id="3117215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117218">return</span>&nbsp;<span class="ident" id="3117225">bytes</span><span class="op" id="3117230">.</span><span class="ident" id="3117231">IndexByte</span><span class="op" id="3117240">(</span><span class="op" id="3117241">[</span><span class="op" id="3117242">]</span><span class="builtintype" id="3117243">byte</span><span class="op" id="3117247">(</span><span class="string" id="3117248">&#34;\t\n\x0C\r&nbsp;&#34;</span><span class="op" id="3117261">)</span><span class="op" id="3117262">,</span>&nbsp;<span class="ident" id="3117264">b</span><span class="op" id="3117265">)</span>&nbsp;<span class="op" id="3117267">!=</span>&nbsp;<span class="op" id="3117270">-</span><span class="num" id="3117271">1</span><br>
<span class="lineno"></span><span class="op" id="3117273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3117276">type</span>&nbsp;<span class="ident" id="3117281">sniffSig</span>&nbsp;<span class="keyword" id="3117290">interface</span>&nbsp;<span class="op" id="3117300">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3117303">//&nbsp;match&nbsp;returns&nbsp;the&nbsp;MIME&nbsp;type&nbsp;of&nbsp;the&nbsp;data,&nbsp;or&nbsp;&#34;&#34;&nbsp;if&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117366">match</span><span class="op" id="3117371">(</span><span class="ident" id="3117372">data</span>&nbsp;<span class="op" id="3117377">[</span><span class="op" id="3117378">]</span><span class="builtintype" id="3117379">byte</span><span class="op" id="3117383">,</span>&nbsp;<span class="ident" id="3117385">firstNonWS</span>&nbsp;<span class="builtintype" id="3117396">int</span><span class="op" id="3117399">)</span>&nbsp;<span class="builtintype" id="3117401">string</span><br>
<span class="lineno"></span><span class="op" id="3117408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3117411">//&nbsp;Data&nbsp;matching&nbsp;the&nbsp;table&nbsp;in&nbsp;section&nbsp;6.</span><br>
<span class="lineno">50</span><span class="keyword" id="3117452">var</span>&nbsp;<span class="ident" id="3117456">sniffSignatures</span>&nbsp;<span class="op" id="3117472">=</span>&nbsp;<span class="op" id="3117474">[</span><span class="op" id="3117475">]</span><span class="ident" id="3117476">sniffSig</span><span class="op" id="3117484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117487">htmlSig</span><span class="op" id="3117494">(</span><span class="string" id="3117495">&#34;&lt;!DOCTYPE&nbsp;HTML&#34;</span><span class="op" id="3117511">)</span><span class="op" id="3117512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117515">htmlSig</span><span class="op" id="3117522">(</span><span class="string" id="3117523">&#34;&lt;HTML&#34;</span><span class="op" id="3117530">)</span><span class="op" id="3117531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117534">htmlSig</span><span class="op" id="3117541">(</span><span class="string" id="3117542">&#34;&lt;HEAD&#34;</span><span class="op" id="3117549">)</span><span class="op" id="3117550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117553">htmlSig</span><span class="op" id="3117560">(</span><span class="string" id="3117561">&#34;&lt;SCRIPT&#34;</span><span class="op" id="3117570">)</span><span class="op" id="3117571">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117574">htmlSig</span><span class="op" id="3117581">(</span><span class="string" id="3117582">&#34;&lt;IFRAME&#34;</span><span class="op" id="3117591">)</span><span class="op" id="3117592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117595">htmlSig</span><span class="op" id="3117602">(</span><span class="string" id="3117603">&#34;&lt;H1&#34;</span><span class="op" id="3117608">)</span><span class="op" id="3117609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117612">htmlSig</span><span class="op" id="3117619">(</span><span class="string" id="3117620">&#34;&lt;DIV&#34;</span><span class="op" id="3117626">)</span><span class="op" id="3117627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117630">htmlSig</span><span class="op" id="3117637">(</span><span class="string" id="3117638">&#34;&lt;FONT&#34;</span><span class="op" id="3117645">)</span><span class="op" id="3117646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117649">htmlSig</span><span class="op" id="3117656">(</span><span class="string" id="3117657">&#34;&lt;TABLE&#34;</span><span class="op" id="3117665">)</span><span class="op" id="3117666">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117669">htmlSig</span><span class="op" id="3117676">(</span><span class="string" id="3117677">&#34;&lt;A&#34;</span><span class="op" id="3117681">)</span><span class="op" id="3117682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117685">htmlSig</span><span class="op" id="3117692">(</span><span class="string" id="3117693">&#34;&lt;STYLE&#34;</span><span class="op" id="3117701">)</span><span class="op" id="3117702">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117705">htmlSig</span><span class="op" id="3117712">(</span><span class="string" id="3117713">&#34;&lt;TITLE&#34;</span><span class="op" id="3117721">)</span><span class="op" id="3117722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117725">htmlSig</span><span class="op" id="3117732">(</span><span class="string" id="3117733">&#34;&lt;B&#34;</span><span class="op" id="3117737">)</span><span class="op" id="3117738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117741">htmlSig</span><span class="op" id="3117748">(</span><span class="string" id="3117749">&#34;&lt;BODY&#34;</span><span class="op" id="3117756">)</span><span class="op" id="3117757">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117760">htmlSig</span><span class="op" id="3117767">(</span><span class="string" id="3117768">&#34;&lt;BR&#34;</span><span class="op" id="3117773">)</span><span class="op" id="3117774">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117777">htmlSig</span><span class="op" id="3117784">(</span><span class="string" id="3117785">&#34;&lt;P&#34;</span><span class="op" id="3117789">)</span><span class="op" id="3117790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117793">htmlSig</span><span class="op" id="3117800">(</span><span class="string" id="3117801">&#34;&lt;!--&#34;</span><span class="op" id="3117807">)</span><span class="op" id="3117808">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3117812">&amp;</span><span class="ident" id="3117813">maskedSig</span><span class="op" id="3117822">{</span><span class="ident" id="3117823">mask</span><span class="op" id="3117827">:</span>&nbsp;<span class="op" id="3117829">[</span><span class="op" id="3117830">]</span><span class="builtintype" id="3117831">byte</span><span class="op" id="3117835">(</span><span class="string" id="3117836">&#34;\xFF\xFF\xFF\xFF\xFF&#34;</span><span class="op" id="3117858">)</span><span class="op" id="3117859">,</span>&nbsp;<span class="ident" id="3117861">pat</span><span class="op" id="3117864">:</span>&nbsp;<span class="op" id="3117866">[</span><span class="op" id="3117867">]</span><span class="builtintype" id="3117868">byte</span><span class="op" id="3117872">(</span><span class="string" id="3117873">&#34;&lt;?xml&#34;</span><span class="op" id="3117880">)</span><span class="op" id="3117881">,</span>&nbsp;<span class="ident" id="3117883">skipWS</span><span class="op" id="3117889">:</span>&nbsp;<span class="builtintype" id="3117891">true</span><span class="op" id="3117895">,</span>&nbsp;<span class="ident" id="3117897">ct</span><span class="op" id="3117899">:</span>&nbsp;<span class="string" id="3117901">&#34;text/xml;&nbsp;charset=utf-8&#34;</span><span class="op" id="3117926">}</span><span class="op" id="3117927">,</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3117931">&amp;</span><span class="ident" id="3117932">exactSig</span><span class="op" id="3117940">{</span><span class="op" id="3117941">[</span><span class="op" id="3117942">]</span><span class="builtintype" id="3117943">byte</span><span class="op" id="3117947">(</span><span class="string" id="3117948">&#34;%PDF-&#34;</span><span class="op" id="3117955">)</span><span class="op" id="3117956">,</span>&nbsp;<span class="string" id="3117958">&#34;application/pdf&#34;</span><span class="op" id="3117975">}</span><span class="op" id="3117976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3117979">&amp;</span><span class="ident" id="3117980">exactSig</span><span class="op" id="3117988">{</span><span class="op" id="3117989">[</span><span class="op" id="3117990">]</span><span class="builtintype" id="3117991">byte</span><span class="op" id="3117995">(</span><span class="string" id="3117996">&#34;%!PS-Adobe-&#34;</span><span class="op" id="3118009">)</span><span class="op" id="3118010">,</span>&nbsp;<span class="string" id="3118012">&#34;application/postscript&#34;</span><span class="op" id="3118036">}</span><span class="op" id="3118037">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3118041">//&nbsp;UTF&nbsp;BOMs.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118055">&amp;</span><span class="ident" id="3118056">maskedSig</span><span class="op" id="3118065">{</span><span class="ident" id="3118066">mask</span><span class="op" id="3118070">:</span>&nbsp;<span class="op" id="3118072">[</span><span class="op" id="3118073">]</span><span class="builtintype" id="3118074">byte</span><span class="op" id="3118078">(</span><span class="string" id="3118079">&#34;\xFF\xFF\x00\x00&#34;</span><span class="op" id="3118097">)</span><span class="op" id="3118098">,</span>&nbsp;<span class="ident" id="3118100">pat</span><span class="op" id="3118103">:</span>&nbsp;<span class="op" id="3118105">[</span><span class="op" id="3118106">]</span><span class="builtintype" id="3118107">byte</span><span class="op" id="3118111">(</span><span class="string" id="3118112">&#34;\xFE\xFF\x00\x00&#34;</span><span class="op" id="3118130">)</span><span class="op" id="3118131">,</span>&nbsp;<span class="ident" id="3118133">ct</span><span class="op" id="3118135">:</span>&nbsp;<span class="string" id="3118137">&#34;text/plain;&nbsp;charset=utf-16be&#34;</span><span class="op" id="3118167">}</span><span class="op" id="3118168">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118171">&amp;</span><span class="ident" id="3118172">maskedSig</span><span class="op" id="3118181">{</span><span class="ident" id="3118182">mask</span><span class="op" id="3118186">:</span>&nbsp;<span class="op" id="3118188">[</span><span class="op" id="3118189">]</span><span class="builtintype" id="3118190">byte</span><span class="op" id="3118194">(</span><span class="string" id="3118195">&#34;\xFF\xFF\x00\x00&#34;</span><span class="op" id="3118213">)</span><span class="op" id="3118214">,</span>&nbsp;<span class="ident" id="3118216">pat</span><span class="op" id="3118219">:</span>&nbsp;<span class="op" id="3118221">[</span><span class="op" id="3118222">]</span><span class="builtintype" id="3118223">byte</span><span class="op" id="3118227">(</span><span class="string" id="3118228">&#34;\xFF\xFE\x00\x00&#34;</span><span class="op" id="3118246">)</span><span class="op" id="3118247">,</span>&nbsp;<span class="ident" id="3118249">ct</span><span class="op" id="3118251">:</span>&nbsp;<span class="string" id="3118253">&#34;text/plain;&nbsp;charset=utf-16le&#34;</span><span class="op" id="3118283">}</span><span class="op" id="3118284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118287">&amp;</span><span class="ident" id="3118288">maskedSig</span><span class="op" id="3118297">{</span><span class="ident" id="3118298">mask</span><span class="op" id="3118302">:</span>&nbsp;<span class="op" id="3118304">[</span><span class="op" id="3118305">]</span><span class="builtintype" id="3118306">byte</span><span class="op" id="3118310">(</span><span class="string" id="3118311">&#34;\xFF\xFF\xFF\x00&#34;</span><span class="op" id="3118329">)</span><span class="op" id="3118330">,</span>&nbsp;<span class="ident" id="3118332">pat</span><span class="op" id="3118335">:</span>&nbsp;<span class="op" id="3118337">[</span><span class="op" id="3118338">]</span><span class="builtintype" id="3118339">byte</span><span class="op" id="3118343">(</span><span class="string" id="3118344">&#34;\xEF\xBB\xBF\x00&#34;</span><span class="op" id="3118362">)</span><span class="op" id="3118363">,</span>&nbsp;<span class="ident" id="3118365">ct</span><span class="op" id="3118367">:</span>&nbsp;<span class="string" id="3118369">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="3118396">}</span><span class="op" id="3118397">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118401">&amp;</span><span class="ident" id="3118402">exactSig</span><span class="op" id="3118410">{</span><span class="op" id="3118411">[</span><span class="op" id="3118412">]</span><span class="builtintype" id="3118413">byte</span><span class="op" id="3118417">(</span><span class="string" id="3118418">&#34;GIF87a&#34;</span><span class="op" id="3118426">)</span><span class="op" id="3118427">,</span>&nbsp;<span class="string" id="3118429">&#34;image/gif&#34;</span><span class="op" id="3118440">}</span><span class="op" id="3118441">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118444">&amp;</span><span class="ident" id="3118445">exactSig</span><span class="op" id="3118453">{</span><span class="op" id="3118454">[</span><span class="op" id="3118455">]</span><span class="builtintype" id="3118456">byte</span><span class="op" id="3118460">(</span><span class="string" id="3118461">&#34;GIF89a&#34;</span><span class="op" id="3118469">)</span><span class="op" id="3118470">,</span>&nbsp;<span class="string" id="3118472">&#34;image/gif&#34;</span><span class="op" id="3118483">}</span><span class="op" id="3118484">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118487">&amp;</span><span class="ident" id="3118488">exactSig</span><span class="op" id="3118496">{</span><span class="op" id="3118497">[</span><span class="op" id="3118498">]</span><span class="builtintype" id="3118499">byte</span><span class="op" id="3118503">(</span><span class="string" id="3118504">&#34;\x89\x50\x4E\x47\x0D\x0A\x1A\x0A&#34;</span><span class="op" id="3118538">)</span><span class="op" id="3118539">,</span>&nbsp;<span class="string" id="3118541">&#34;image/png&#34;</span><span class="op" id="3118552">}</span><span class="op" id="3118553">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118556">&amp;</span><span class="ident" id="3118557">exactSig</span><span class="op" id="3118565">{</span><span class="op" id="3118566">[</span><span class="op" id="3118567">]</span><span class="builtintype" id="3118568">byte</span><span class="op" id="3118572">(</span><span class="string" id="3118573">&#34;\xFF\xD8\xFF&#34;</span><span class="op" id="3118587">)</span><span class="op" id="3118588">,</span>&nbsp;<span class="string" id="3118590">&#34;image/jpeg&#34;</span><span class="op" id="3118602">}</span><span class="op" id="3118603">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118606">&amp;</span><span class="ident" id="3118607">exactSig</span><span class="op" id="3118615">{</span><span class="op" id="3118616">[</span><span class="op" id="3118617">]</span><span class="builtintype" id="3118618">byte</span><span class="op" id="3118622">(</span><span class="string" id="3118623">&#34;BM&#34;</span><span class="op" id="3118627">)</span><span class="op" id="3118628">,</span>&nbsp;<span class="string" id="3118630">&#34;image/bmp&#34;</span><span class="op" id="3118641">}</span><span class="op" id="3118642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118645">&amp;</span><span class="ident" id="3118646">maskedSig</span><span class="op" id="3118655">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118659">mask</span><span class="op" id="3118663">:</span>&nbsp;<span class="op" id="3118665">[</span><span class="op" id="3118666">]</span><span class="builtintype" id="3118667">byte</span><span class="op" id="3118671">(</span><span class="string" id="3118672">&#34;\xFF\xFF\xFF\xFF\x00\x00\x00\x00\xFF\xFF\xFF\xFF\xFF\xFF&#34;</span><span class="op" id="3118730">)</span><span class="op" id="3118731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118735">pat</span><span class="op" id="3118738">:</span>&nbsp;&nbsp;<span class="op" id="3118741">[</span><span class="op" id="3118742">]</span><span class="builtintype" id="3118743">byte</span><span class="op" id="3118747">(</span><span class="string" id="3118748">&#34;RIFF\x00\x00\x00\x00WEBPVP&#34;</span><span class="op" id="3118776">)</span><span class="op" id="3118777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118781">ct</span><span class="op" id="3118783">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="3118787">&#34;image/webp&#34;</span><span class="op" id="3118799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118802">}</span><span class="op" id="3118803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118806">&amp;</span><span class="ident" id="3118807">exactSig</span><span class="op" id="3118815">{</span><span class="op" id="3118816">[</span><span class="op" id="3118817">]</span><span class="builtintype" id="3118818">byte</span><span class="op" id="3118822">(</span><span class="string" id="3118823">&#34;\x00\x00\x01\x00&#34;</span><span class="op" id="3118841">)</span><span class="op" id="3118842">,</span>&nbsp;<span class="string" id="3118844">&#34;image/vnd.microsoft.icon&#34;</span><span class="op" id="3118870">}</span><span class="op" id="3118871">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118874">&amp;</span><span class="ident" id="3118875">exactSig</span><span class="op" id="3118883">{</span><span class="op" id="3118884">[</span><span class="op" id="3118885">]</span><span class="builtintype" id="3118886">byte</span><span class="op" id="3118890">(</span><span class="string" id="3118891">&#34;\x4F\x67\x67\x53\x00&#34;</span><span class="op" id="3118913">)</span><span class="op" id="3118914">,</span>&nbsp;<span class="string" id="3118916">&#34;application/ogg&#34;</span><span class="op" id="3118933">}</span><span class="op" id="3118934">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118937">&amp;</span><span class="ident" id="3118938">maskedSig</span><span class="op" id="3118947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118951">mask</span><span class="op" id="3118955">:</span>&nbsp;<span class="op" id="3118957">[</span><span class="op" id="3118958">]</span><span class="builtintype" id="3118959">byte</span><span class="op" id="3118963">(</span><span class="string" id="3118964">&#34;\xFF\xFF\xFF\xFF\x00\x00\x00\x00\xFF\xFF\xFF\xFF&#34;</span><span class="op" id="3119014">)</span><span class="op" id="3119015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119019">pat</span><span class="op" id="3119022">:</span>&nbsp;&nbsp;<span class="op" id="3119025">[</span><span class="op" id="3119026">]</span><span class="builtintype" id="3119027">byte</span><span class="op" id="3119031">(</span><span class="string" id="3119032">&#34;RIFF\x00\x00\x00\x00WAVE&#34;</span><span class="op" id="3119058">)</span><span class="op" id="3119059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119063">ct</span><span class="op" id="3119065">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="3119069">&#34;audio/wave&#34;</span><span class="op" id="3119081">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3119084">}</span><span class="op" id="3119085">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3119088">&amp;</span><span class="ident" id="3119089">exactSig</span><span class="op" id="3119097">{</span><span class="op" id="3119098">[</span><span class="op" id="3119099">]</span><span class="builtintype" id="3119100">byte</span><span class="op" id="3119104">(</span><span class="string" id="3119105">&#34;\x1A\x45\xDF\xA3&#34;</span><span class="op" id="3119123">)</span><span class="op" id="3119124">,</span>&nbsp;<span class="string" id="3119126">&#34;video/webm&#34;</span><span class="op" id="3119138">}</span><span class="op" id="3119139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3119142">&amp;</span><span class="ident" id="3119143">exactSig</span><span class="op" id="3119151">{</span><span class="op" id="3119152">[</span><span class="op" id="3119153">]</span><span class="builtintype" id="3119154">byte</span><span class="op" id="3119158">(</span><span class="string" id="3119159">&#34;\x52\x61\x72\x20\x1A\x07\x00&#34;</span><span class="op" id="3119189">)</span><span class="op" id="3119190">,</span>&nbsp;<span class="string" id="3119192">&#34;application/x-rar-compressed&#34;</span><span class="op" id="3119222">}</span><span class="op" id="3119223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3119226">&amp;</span><span class="ident" id="3119227">exactSig</span><span class="op" id="3119235">{</span><span class="op" id="3119236">[</span><span class="op" id="3119237">]</span><span class="builtintype" id="3119238">byte</span><span class="op" id="3119242">(</span><span class="string" id="3119243">&#34;\x50\x4B\x03\x04&#34;</span><span class="op" id="3119261">)</span><span class="op" id="3119262">,</span>&nbsp;<span class="string" id="3119264">&#34;application/zip&#34;</span><span class="op" id="3119281">}</span><span class="op" id="3119282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3119285">&amp;</span><span class="ident" id="3119286">exactSig</span><span class="op" id="3119294">{</span><span class="op" id="3119295">[</span><span class="op" id="3119296">]</span><span class="builtintype" id="3119297">byte</span><span class="op" id="3119301">(</span><span class="string" id="3119302">&#34;\x1F\x8B\x08&#34;</span><span class="op" id="3119316">)</span><span class="op" id="3119317">,</span>&nbsp;<span class="string" id="3119319">&#34;application/x-gzip&#34;</span><span class="op" id="3119339">}</span><span class="op" id="3119340">,</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3119344">//&nbsp;TODO(dsymonds):&nbsp;Re-enable&nbsp;this&nbsp;when&nbsp;the&nbsp;spec&nbsp;is&nbsp;sorted&nbsp;w.r.t.&nbsp;MP4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3119415">//mp4Sig(0),</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119430">textSig</span><span class="op" id="3119437">(</span><span class="num" id="3119438">0</span><span class="op" id="3119439">)</span><span class="op" id="3119440">,</span>&nbsp;<span class="comment" id="3119442">//&nbsp;should&nbsp;be&nbsp;last</span><br>
<span class="lineno">105</span><span class="op" id="3119460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3119463">type</span>&nbsp;<span class="ident" id="3119468">exactSig</span>&nbsp;<span class="keyword" id="3119477">struct</span>&nbsp;<span class="op" id="3119484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119487">sig</span>&nbsp;<span class="op" id="3119491">[</span><span class="op" id="3119492">]</span><span class="builtintype" id="3119493">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119499">ct</span>&nbsp;&nbsp;<span class="builtintype" id="3119503">string</span><br>
<span class="lineno">110</span><span class="op" id="3119510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3119513">func</span>&nbsp;<span class="op" id="3119518">(</span><span class="ident" id="3119519">e</span>&nbsp;<span class="op" id="3119521">*</span><span class="ident" id="3119522">exactSig</span><span class="op" id="3119530">)</span>&nbsp;<span class="ident" id="3119532">match</span><span class="op" id="3119537">(</span><span class="ident" id="3119538">data</span>&nbsp;<span class="op" id="3119543">[</span><span class="op" id="3119544">]</span><span class="builtintype" id="3119545">byte</span><span class="op" id="3119549">,</span>&nbsp;<span class="ident" id="3119551">firstNonWS</span>&nbsp;<span class="builtintype" id="3119562">int</span><span class="op" id="3119565">)</span>&nbsp;<span class="builtintype" id="3119567">string</span>&nbsp;<span class="op" id="3119574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119577">if</span>&nbsp;<span class="ident" id="3119580">bytes</span><span class="op" id="3119585">.</span><span class="ident" id="3119586">HasPrefix</span><span class="op" id="3119595">(</span><span class="ident" id="3119596">data</span><span class="op" id="3119600">,</span>&nbsp;<span class="ident" id="3119602">e</span><span class="op" id="3119603">.</span><span class="ident" id="3119604">sig</span><span class="op" id="3119607">)</span>&nbsp;<span class="op" id="3119609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119613">return</span>&nbsp;<span class="ident" id="3119620">e</span><span class="op" id="3119621">.</span><span class="ident" id="3119622">ct</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3119626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119629">return</span>&nbsp;<span class="string" id="3119636">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3119639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3119642">type</span>&nbsp;<span class="ident" id="3119647">maskedSig</span>&nbsp;<span class="keyword" id="3119657">struct</span>&nbsp;<span class="op" id="3119664">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119667">mask</span><span class="op" id="3119671">,</span>&nbsp;<span class="ident" id="3119673">pat</span>&nbsp;<span class="op" id="3119677">[</span><span class="op" id="3119678">]</span><span class="builtintype" id="3119679">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119685">skipWS</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3119695">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119701">ct</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3119711">string</span><br>
<span class="lineno"></span><span class="op" id="3119718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="3119721">func</span>&nbsp;<span class="op" id="3119726">(</span><span class="ident" id="3119727">m</span>&nbsp;<span class="op" id="3119729">*</span><span class="ident" id="3119730">maskedSig</span><span class="op" id="3119739">)</span>&nbsp;<span class="ident" id="3119741">match</span><span class="op" id="3119746">(</span><span class="ident" id="3119747">data</span>&nbsp;<span class="op" id="3119752">[</span><span class="op" id="3119753">]</span><span class="builtintype" id="3119754">byte</span><span class="op" id="3119758">,</span>&nbsp;<span class="ident" id="3119760">firstNonWS</span>&nbsp;<span class="builtintype" id="3119771">int</span><span class="op" id="3119774">)</span>&nbsp;<span class="builtintype" id="3119776">string</span>&nbsp;<span class="op" id="3119783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119786">if</span>&nbsp;<span class="ident" id="3119789">m</span><span class="op" id="3119790">.</span><span class="ident" id="3119791">skipWS</span>&nbsp;<span class="op" id="3119798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119802">data</span>&nbsp;<span class="op" id="3119807">=</span>&nbsp;<span class="ident" id="3119809">data</span><span class="op" id="3119813">[</span><span class="ident" id="3119814">firstNonWS</span><span class="op" id="3119824">:</span><span class="op" id="3119825">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3119828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119831">if</span>&nbsp;<span class="builtinfunc" id="3119834">len</span><span class="op" id="3119837">(</span><span class="ident" id="3119838">data</span><span class="op" id="3119842">)</span>&nbsp;<span class="op" id="3119844">&lt;</span>&nbsp;<span class="builtinfunc" id="3119846">len</span><span class="op" id="3119849">(</span><span class="ident" id="3119850">m</span><span class="op" id="3119851">.</span><span class="ident" id="3119852">mask</span><span class="op" id="3119856">)</span>&nbsp;<span class="op" id="3119858">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119862">return</span>&nbsp;<span class="string" id="3119869">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3119873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119876">for</span>&nbsp;<span class="ident" id="3119880">i</span><span class="op" id="3119881">,</span>&nbsp;<span class="ident" id="3119883">mask</span>&nbsp;<span class="op" id="3119888">:=</span>&nbsp;<span class="keyword" id="3119891">range</span>&nbsp;<span class="ident" id="3119897">m</span><span class="op" id="3119898">.</span><span class="ident" id="3119899">mask</span>&nbsp;<span class="op" id="3119904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119908">db</span>&nbsp;<span class="op" id="3119911">:=</span>&nbsp;<span class="ident" id="3119914">data</span><span class="op" id="3119918">[</span><span class="ident" id="3119919">i</span><span class="op" id="3119920">]</span>&nbsp;<span class="op" id="3119922">&amp;</span>&nbsp;<span class="ident" id="3119924">mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119931">if</span>&nbsp;<span class="ident" id="3119934">db</span>&nbsp;<span class="op" id="3119937">!=</span>&nbsp;<span class="ident" id="3119940">m</span><span class="op" id="3119941">.</span><span class="ident" id="3119942">pat</span><span class="op" id="3119945">[</span><span class="ident" id="3119946">i</span><span class="op" id="3119947">]</span>&nbsp;<span class="op" id="3119949">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119954">return</span>&nbsp;<span class="string" id="3119961">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3119966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3119969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119972">return</span>&nbsp;<span class="ident" id="3119979">m</span><span class="op" id="3119980">.</span><span class="ident" id="3119981">ct</span><br>
<span class="lineno"></span><span class="op" id="3119984">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="3119987">type</span>&nbsp;<span class="ident" id="3119992">htmlSig</span>&nbsp;<span class="op" id="3120000">[</span><span class="op" id="3120001">]</span><span class="builtintype" id="3120002">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3120008">func</span>&nbsp;<span class="op" id="3120013">(</span><span class="ident" id="3120014">h</span>&nbsp;<span class="ident" id="3120016">htmlSig</span><span class="op" id="3120023">)</span>&nbsp;<span class="ident" id="3120025">match</span><span class="op" id="3120030">(</span><span class="ident" id="3120031">data</span>&nbsp;<span class="op" id="3120036">[</span><span class="op" id="3120037">]</span><span class="builtintype" id="3120038">byte</span><span class="op" id="3120042">,</span>&nbsp;<span class="ident" id="3120044">firstNonWS</span>&nbsp;<span class="builtintype" id="3120055">int</span><span class="op" id="3120058">)</span>&nbsp;<span class="builtintype" id="3120060">string</span>&nbsp;<span class="op" id="3120067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3120070">data</span>&nbsp;<span class="op" id="3120075">=</span>&nbsp;<span class="ident" id="3120077">data</span><span class="op" id="3120081">[</span><span class="ident" id="3120082">firstNonWS</span><span class="op" id="3120092">:</span><span class="op" id="3120093">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120096">if</span>&nbsp;<span class="builtinfunc" id="3120099">len</span><span class="op" id="3120102">(</span><span class="ident" id="3120103">data</span><span class="op" id="3120107">)</span>&nbsp;<span class="op" id="3120109">&lt;</span>&nbsp;<span class="builtinfunc" id="3120111">len</span><span class="op" id="3120114">(</span><span class="ident" id="3120115">h</span><span class="op" id="3120116">)</span><span class="op" id="3120117">+</span><span class="num" id="3120118">1</span>&nbsp;<span class="op" id="3120120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120124">return</span>&nbsp;<span class="string" id="3120131">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3120135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120138">for</span>&nbsp;<span class="ident" id="3120142">i</span><span class="op" id="3120143">,</span>&nbsp;<span class="ident" id="3120145">b</span>&nbsp;<span class="op" id="3120147">:=</span>&nbsp;<span class="keyword" id="3120150">range</span>&nbsp;<span class="ident" id="3120156">h</span>&nbsp;<span class="op" id="3120158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3120162">db</span>&nbsp;<span class="op" id="3120165">:=</span>&nbsp;<span class="ident" id="3120168">data</span><span class="op" id="3120172">[</span><span class="ident" id="3120173">i</span><span class="op" id="3120174">]</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120178">if</span>&nbsp;<span class="string" id="3120181">&#39;A&#39;</span>&nbsp;<span class="op" id="3120185">&lt;=</span>&nbsp;<span class="ident" id="3120188">b</span>&nbsp;<span class="op" id="3120190">&amp;&amp;</span>&nbsp;<span class="ident" id="3120193">b</span>&nbsp;<span class="op" id="3120195">&lt;=</span>&nbsp;<span class="string" id="3120198">&#39;Z&#39;</span>&nbsp;<span class="op" id="3120202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3120207">db</span>&nbsp;<span class="op" id="3120210">&amp;=</span>&nbsp;<span class="num" id="3120213">0xDF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3120220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120224">if</span>&nbsp;<span class="ident" id="3120227">b</span>&nbsp;<span class="op" id="3120229">!=</span>&nbsp;<span class="ident" id="3120232">db</span>&nbsp;<span class="op" id="3120235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120240">return</span>&nbsp;<span class="string" id="3120247">&#34;&#34;</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3120252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3120255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3120258">//&nbsp;Next&nbsp;byte&nbsp;must&nbsp;be&nbsp;space&nbsp;or&nbsp;right&nbsp;angle&nbsp;bracket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120310">if</span>&nbsp;<span class="ident" id="3120313">db</span>&nbsp;<span class="op" id="3120316">:=</span>&nbsp;<span class="ident" id="3120319">data</span><span class="op" id="3120323">[</span><span class="builtinfunc" id="3120324">len</span><span class="op" id="3120327">(</span><span class="ident" id="3120328">h</span><span class="op" id="3120329">)</span><span class="op" id="3120330">]</span><span class="op" id="3120331">;</span>&nbsp;<span class="ident" id="3120333">db</span>&nbsp;<span class="op" id="3120336">!=</span>&nbsp;<span class="string" id="3120339">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3120343">&amp;&amp;</span>&nbsp;<span class="ident" id="3120346">db</span>&nbsp;<span class="op" id="3120349">!=</span>&nbsp;<span class="string" id="3120352">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="3120356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120360">return</span>&nbsp;<span class="string" id="3120367">&#34;&#34;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3120371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120374">return</span>&nbsp;<span class="string" id="3120381">&#34;text/html;&nbsp;charset=utf-8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3120408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3120411">type</span>&nbsp;<span class="ident" id="3120416">mp4Sig</span>&nbsp;<span class="builtintype" id="3120423">int</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="3120428">func</span>&nbsp;<span class="op" id="3120433">(</span><span class="ident" id="3120434">mp4Sig</span><span class="op" id="3120440">)</span>&nbsp;<span class="ident" id="3120442">match</span><span class="op" id="3120447">(</span><span class="ident" id="3120448">data</span>&nbsp;<span class="op" id="3120453">[</span><span class="op" id="3120454">]</span><span class="builtintype" id="3120455">byte</span><span class="op" id="3120459">,</span>&nbsp;<span class="ident" id="3120461">firstNonWS</span>&nbsp;<span class="builtintype" id="3120472">int</span><span class="op" id="3120475">)</span>&nbsp;<span class="builtintype" id="3120477">string</span>&nbsp;<span class="op" id="3120484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3120487">//&nbsp;c.f.&nbsp;section&nbsp;6.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120509">if</span>&nbsp;<span class="builtinfunc" id="3120512">len</span><span class="op" id="3120515">(</span><span class="ident" id="3120516">data</span><span class="op" id="3120520">)</span>&nbsp;<span class="op" id="3120522">&lt;</span>&nbsp;<span class="num" id="3120524">8</span>&nbsp;<span class="op" id="3120526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120530">return</span>&nbsp;<span class="string" id="3120537">&#34;&#34;</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3120541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3120544">boxSize</span>&nbsp;<span class="op" id="3120552">:=</span>&nbsp;<span class="builtintype" id="3120555">int</span><span class="op" id="3120558">(</span><span class="ident" id="3120559">binary</span><span class="op" id="3120565">.</span><span class="ident" id="3120566">BigEndian</span><span class="op" id="3120575">.</span><span class="ident" id="3120576">Uint32</span><span class="op" id="3120582">(</span><span class="ident" id="3120583">data</span><span class="op" id="3120587">[</span><span class="op" id="3120588">:</span><span class="num" id="3120589">4</span><span class="op" id="3120590">]</span><span class="op" id="3120591">)</span><span class="op" id="3120592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120595">if</span>&nbsp;<span class="ident" id="3120598">boxSize</span><span class="op" id="3120605">%</span><span class="num" id="3120606">4</span>&nbsp;<span class="op" id="3120608">!=</span>&nbsp;<span class="num" id="3120611">0</span>&nbsp;<span class="op" id="3120613">||</span>&nbsp;<span class="builtinfunc" id="3120616">len</span><span class="op" id="3120619">(</span><span class="ident" id="3120620">data</span><span class="op" id="3120624">)</span>&nbsp;<span class="op" id="3120626">&lt;</span>&nbsp;<span class="ident" id="3120628">boxSize</span>&nbsp;<span class="op" id="3120636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120640">return</span>&nbsp;<span class="string" id="3120647">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3120651">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120654">if</span>&nbsp;<span class="op" id="3120657">!</span><span class="ident" id="3120658">bytes</span><span class="op" id="3120663">.</span><span class="ident" id="3120664">Equal</span><span class="op" id="3120669">(</span><span class="ident" id="3120670">data</span><span class="op" id="3120674">[</span><span class="num" id="3120675">4</span><span class="op" id="3120676">:</span><span class="num" id="3120677">8</span><span class="op" id="3120678">]</span><span class="op" id="3120679">,</span>&nbsp;<span class="op" id="3120681">[</span><span class="op" id="3120682">]</span><span class="builtintype" id="3120683">byte</span><span class="op" id="3120687">(</span><span class="string" id="3120688">&#34;ftyp&#34;</span><span class="op" id="3120694">)</span><span class="op" id="3120695">)</span>&nbsp;<span class="op" id="3120697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120701">return</span>&nbsp;<span class="string" id="3120708">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3120712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120715">for</span>&nbsp;<span class="ident" id="3120719">st</span>&nbsp;<span class="op" id="3120722">:=</span>&nbsp;<span class="num" id="3120725">8</span><span class="op" id="3120726">;</span>&nbsp;<span class="ident" id="3120728">st</span>&nbsp;<span class="op" id="3120731">&lt;</span>&nbsp;<span class="ident" id="3120733">boxSize</span><span class="op" id="3120740">;</span>&nbsp;<span class="ident" id="3120742">st</span>&nbsp;<span class="op" id="3120745">+=</span>&nbsp;<span class="num" id="3120748">4</span>&nbsp;<span class="op" id="3120750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120754">if</span>&nbsp;<span class="ident" id="3120757">st</span>&nbsp;<span class="op" id="3120760">==</span>&nbsp;<span class="num" id="3120763">12</span>&nbsp;<span class="op" id="3120766">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3120771">//&nbsp;minor&nbsp;version&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120798">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3120809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3120813">seg</span>&nbsp;<span class="op" id="3120817">:=</span>&nbsp;<span class="builtintype" id="3120820">string</span><span class="op" id="3120826">(</span><span class="ident" id="3120827">data</span><span class="op" id="3120831">[</span><span class="ident" id="3120832">st</span>&nbsp;<span class="op" id="3120835">:</span>&nbsp;<span class="ident" id="3120837">st</span><span class="op" id="3120839">+</span><span class="num" id="3120840">3</span><span class="op" id="3120841">]</span><span class="op" id="3120842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120846">switch</span>&nbsp;<span class="ident" id="3120853">seg</span>&nbsp;<span class="op" id="3120857">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120861">case</span>&nbsp;<span class="string" id="3120866">&#34;mp4&#34;</span><span class="op" id="3120871">,</span>&nbsp;<span class="string" id="3120873">&#34;iso&#34;</span><span class="op" id="3120878">,</span>&nbsp;<span class="string" id="3120880">&#34;M4V&#34;</span><span class="op" id="3120885">,</span>&nbsp;<span class="string" id="3120887">&#34;M4P&#34;</span><span class="op" id="3120892">,</span>&nbsp;<span class="string" id="3120894">&#34;M4B&#34;</span><span class="op" id="3120899">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120904">return</span>&nbsp;<span class="string" id="3120911">&#34;video/mp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3120926">/*&nbsp;The&nbsp;remainder&nbsp;are&nbsp;not&nbsp;in&nbsp;the&nbsp;spec.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspcase&nbsp;&#34;M4A&#34;:<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;&#34;audio/mp4&#34;<br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspcase&nbsp;&#34;3gp&#34;:<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;&#34;video/3gpp&#34;<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspcase&nbsp;&#34;jp2&#34;:<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;&#34;image/jp2&#34;&nbsp;//&nbsp;JPEG&nbsp;2000<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp*/</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3121100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3121103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3121106">return</span>&nbsp;<span class="string" id="3121113">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3121116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="keyword" id="3121119">type</span>&nbsp;<span class="ident" id="3121124">textSig</span>&nbsp;<span class="builtintype" id="3121132">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3121137">func</span>&nbsp;<span class="op" id="3121142">(</span><span class="ident" id="3121143">textSig</span><span class="op" id="3121150">)</span>&nbsp;<span class="ident" id="3121152">match</span><span class="op" id="3121157">(</span><span class="ident" id="3121158">data</span>&nbsp;<span class="op" id="3121163">[</span><span class="op" id="3121164">]</span><span class="builtintype" id="3121165">byte</span><span class="op" id="3121169">,</span>&nbsp;<span class="ident" id="3121171">firstNonWS</span>&nbsp;<span class="builtintype" id="3121182">int</span><span class="op" id="3121185">)</span>&nbsp;<span class="builtintype" id="3121187">string</span>&nbsp;<span class="op" id="3121194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3121197">//&nbsp;c.f.&nbsp;section&nbsp;5,&nbsp;step&nbsp;4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3121225">for</span>&nbsp;<span class="ident" id="3121229">_</span><span class="op" id="3121230">,</span>&nbsp;<span class="ident" id="3121232">b</span>&nbsp;<span class="op" id="3121234">:=</span>&nbsp;<span class="keyword" id="3121237">range</span>&nbsp;<span class="ident" id="3121243">data</span><span class="op" id="3121247">[</span><span class="ident" id="3121248">firstNonWS</span><span class="op" id="3121258">:</span><span class="op" id="3121259">]</span>&nbsp;<span class="op" id="3121261">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3121265">switch</span>&nbsp;<span class="op" id="3121272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3121276">case</span>&nbsp;<span class="num" id="3121281">0x00</span>&nbsp;<span class="op" id="3121286">&lt;=</span>&nbsp;<span class="ident" id="3121289">b</span>&nbsp;<span class="op" id="3121291">&amp;&amp;</span>&nbsp;<span class="ident" id="3121294">b</span>&nbsp;<span class="op" id="3121296">&lt;=</span>&nbsp;<span class="num" id="3121299">0x08</span><span class="op" id="3121303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3121308">b</span>&nbsp;<span class="op" id="3121310">==</span>&nbsp;<span class="num" id="3121313">0x0B</span><span class="op" id="3121317">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3121322">0x0E</span>&nbsp;<span class="op" id="3121327">&lt;=</span>&nbsp;<span class="ident" id="3121330">b</span>&nbsp;<span class="op" id="3121332">&amp;&amp;</span>&nbsp;<span class="ident" id="3121335">b</span>&nbsp;<span class="op" id="3121337">&lt;=</span>&nbsp;<span class="num" id="3121340">0x1A</span><span class="op" id="3121344">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3121349">0x1C</span>&nbsp;<span class="op" id="3121354">&lt;=</span>&nbsp;<span class="ident" id="3121357">b</span>&nbsp;<span class="op" id="3121359">&amp;&amp;</span>&nbsp;<span class="ident" id="3121362">b</span>&nbsp;<span class="op" id="3121364">&lt;=</span>&nbsp;<span class="num" id="3121367">0x1F</span><span class="op" id="3121371">:</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3121376">return</span>&nbsp;<span class="string" id="3121383">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3121388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3121391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3121394">return</span>&nbsp;<span class="string" id="3121401">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3121429">}</span>
</div>
</body>
</html>
