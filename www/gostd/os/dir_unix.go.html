<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2306139">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2306194">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2306248">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2306299">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2306369">package</span>&nbsp;<span class="ident" id="2306377">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2306381">import</span>&nbsp;<span class="op" id="2306388">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2306391">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2306397">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2306407">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2306410">const</span>&nbsp;<span class="op" id="2306416">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2306419">blockSize</span>&nbsp;<span class="op" id="2306429">=</span>&nbsp;<span class="num" id="2306431">4096</span><br>
<span class="lineno"></span><span class="op" id="2306436">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2306439">func</span>&nbsp;<span class="op" id="2306444">(</span><span class="ident" id="2306445">f</span>&nbsp;<span class="op" id="2306447">*</span><span class="ident" id="2306448">File</span><span class="op" id="2306452">)</span>&nbsp;<span class="ident" id="2306454">readdirnames</span><span class="op" id="2306466">(</span><span class="ident" id="2306467">n</span>&nbsp;<span class="builtintype" id="2306469">int</span><span class="op" id="2306472">)</span>&nbsp;<span class="op" id="2306474">(</span><span class="ident" id="2306475">names</span>&nbsp;<span class="op" id="2306481">[</span><span class="op" id="2306482">]</span><span class="builtintype" id="2306483">string</span><span class="op" id="2306489">,</span>&nbsp;<span class="ident" id="2306491">err</span>&nbsp;<span class="builtintype" id="2306495">error</span><span class="op" id="2306500">)</span>&nbsp;<span class="op" id="2306502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2306505">//&nbsp;If&nbsp;this&nbsp;file&nbsp;has&nbsp;no&nbsp;dirinfo,&nbsp;create&nbsp;one.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2306550">if</span>&nbsp;<span class="ident" id="2306553">f</span><span class="op" id="2306554">.</span><span class="ident" id="2306555">dirinfo</span>&nbsp;<span class="op" id="2306563">==</span>&nbsp;<span class="ident" id="2306566">nil</span>&nbsp;<span class="op" id="2306570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2306574">f</span><span class="op" id="2306575">.</span><span class="ident" id="2306576">dirinfo</span>&nbsp;<span class="op" id="2306584">=</span>&nbsp;<span class="builtinfunc" id="2306586">new</span><span class="op" id="2306589">(</span><span class="ident" id="2306590">dirInfo</span><span class="op" id="2306597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2306601">//&nbsp;The&nbsp;buffer&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;a&nbsp;block&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2306648">f</span><span class="op" id="2306649">.</span><span class="ident" id="2306650">dirinfo</span><span class="op" id="2306657">.</span><span class="ident" id="2306658">buf</span>&nbsp;<span class="op" id="2306662">=</span>&nbsp;<span class="builtinfunc" id="2306664">make</span><span class="op" id="2306668">(</span><span class="op" id="2306669">[</span><span class="op" id="2306670">]</span><span class="builtintype" id="2306671">byte</span><span class="op" id="2306675">,</span>&nbsp;<span class="ident" id="2306677">blockSize</span><span class="op" id="2306686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2306689">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2306692">d</span>&nbsp;<span class="op" id="2306694">:=</span>&nbsp;<span class="ident" id="2306697">f</span><span class="op" id="2306698">.</span><span class="ident" id="2306699">dirinfo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2306709">size</span>&nbsp;<span class="op" id="2306714">:=</span>&nbsp;<span class="ident" id="2306717">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2306720">if</span>&nbsp;<span class="ident" id="2306723">size</span>&nbsp;<span class="op" id="2306728">&lt;=</span>&nbsp;<span class="num" id="2306731">0</span>&nbsp;<span class="op" id="2306733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2306737">size</span>&nbsp;<span class="op" id="2306742">=</span>&nbsp;<span class="num" id="2306744">100</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2306750">n</span>&nbsp;<span class="op" id="2306752">=</span>&nbsp;<span class="op" id="2306754">-</span><span class="num" id="2306755">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2306758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2306762">names</span>&nbsp;<span class="op" id="2306768">=</span>&nbsp;<span class="builtinfunc" id="2306770">make</span><span class="op" id="2306774">(</span><span class="op" id="2306775">[</span><span class="op" id="2306776">]</span><span class="builtintype" id="2306777">string</span><span class="op" id="2306783">,</span>&nbsp;<span class="num" id="2306785">0</span><span class="op" id="2306786">,</span>&nbsp;<span class="ident" id="2306788">size</span><span class="op" id="2306792">)</span>&nbsp;<span class="comment" id="2306794">//&nbsp;Empty&nbsp;with&nbsp;room&nbsp;to&nbsp;grow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2306823">for</span>&nbsp;<span class="ident" id="2306827">n</span>&nbsp;<span class="op" id="2306829">!=</span>&nbsp;<span class="num" id="2306832">0</span>&nbsp;<span class="op" id="2306834">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2306838">//&nbsp;Refill&nbsp;the&nbsp;buffer&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2306874">if</span>&nbsp;<span class="ident" id="2306877">d</span><span class="op" id="2306878">.</span><span class="ident" id="2306879">bufp</span>&nbsp;<span class="op" id="2306884">&gt;=</span>&nbsp;<span class="ident" id="2306887">d</span><span class="op" id="2306888">.</span><span class="ident" id="2306889">nbuf</span>&nbsp;<span class="op" id="2306894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2306899">d</span><span class="op" id="2306900">.</span><span class="ident" id="2306901">bufp</span>&nbsp;<span class="op" id="2306906">=</span>&nbsp;<span class="num" id="2306908">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2306913">var</span>&nbsp;<span class="ident" id="2306917">errno</span>&nbsp;<span class="builtintype" id="2306923">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2306932">d</span><span class="op" id="2306933">.</span><span class="ident" id="2306934">nbuf</span><span class="op" id="2306938">,</span>&nbsp;<span class="ident" id="2306940">errno</span>&nbsp;<span class="op" id="2306946">=</span>&nbsp;<span class="ident" id="2306948">fixCount</span><span class="op" id="2306956">(</span><span class="ident" id="2306957">syscall</span><span class="op" id="2306964">.</span><span class="ident" id="2306965">ReadDirent</span><span class="op" id="2306975">(</span><span class="ident" id="2306976">f</span><span class="op" id="2306977">.</span><span class="ident" id="2306978">fd</span><span class="op" id="2306980">,</span>&nbsp;<span class="ident" id="2306982">d</span><span class="op" id="2306983">.</span><span class="ident" id="2306984">buf</span><span class="op" id="2306987">)</span><span class="op" id="2306988">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2306993">if</span>&nbsp;<span class="ident" id="2306996">errno</span>&nbsp;<span class="op" id="2307002">!=</span>&nbsp;<span class="ident" id="2307005">nil</span>&nbsp;<span class="op" id="2307009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2307015">return</span>&nbsp;<span class="ident" id="2307022">names</span><span class="op" id="2307027">,</span>&nbsp;<span class="ident" id="2307029">NewSyscallError</span><span class="op" id="2307044">(</span><span class="string" id="2307045">&#34;readdirent&#34;</span><span class="op" id="2307057">,</span>&nbsp;<span class="ident" id="2307059">errno</span><span class="op" id="2307064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2307069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2307074">if</span>&nbsp;<span class="ident" id="2307077">d</span><span class="op" id="2307078">.</span><span class="ident" id="2307079">nbuf</span>&nbsp;<span class="op" id="2307084">&lt;=</span>&nbsp;<span class="num" id="2307087">0</span>&nbsp;<span class="op" id="2307089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2307095">break</span>&nbsp;<span class="comment" id="2307101">//&nbsp;EOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2307111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2307115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2307120">//&nbsp;Drain&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2307142">var</span>&nbsp;<span class="ident" id="2307146">nb</span><span class="op" id="2307148">,</span>&nbsp;<span class="ident" id="2307150">nc</span>&nbsp;<span class="builtintype" id="2307153">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2307159">nb</span><span class="op" id="2307161">,</span>&nbsp;<span class="ident" id="2307163">nc</span><span class="op" id="2307165">,</span>&nbsp;<span class="ident" id="2307167">names</span>&nbsp;<span class="op" id="2307173">=</span>&nbsp;<span class="ident" id="2307175">syscall</span><span class="op" id="2307182">.</span><span class="ident" id="2307183">ParseDirent</span><span class="op" id="2307194">(</span><span class="ident" id="2307195">d</span><span class="op" id="2307196">.</span><span class="ident" id="2307197">buf</span><span class="op" id="2307200">[</span><span class="ident" id="2307201">d</span><span class="op" id="2307202">.</span><span class="ident" id="2307203">bufp</span><span class="op" id="2307207">:</span><span class="ident" id="2307208">d</span><span class="op" id="2307209">.</span><span class="ident" id="2307210">nbuf</span><span class="op" id="2307214">]</span><span class="op" id="2307215">,</span>&nbsp;<span class="ident" id="2307217">n</span><span class="op" id="2307218">,</span>&nbsp;<span class="ident" id="2307220">names</span><span class="op" id="2307225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2307229">d</span><span class="op" id="2307230">.</span><span class="ident" id="2307231">bufp</span>&nbsp;<span class="op" id="2307236">+=</span>&nbsp;<span class="ident" id="2307239">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2307244">n</span>&nbsp;<span class="op" id="2307246">-=</span>&nbsp;<span class="ident" id="2307249">nc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2307253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2307256">if</span>&nbsp;<span class="ident" id="2307259">n</span>&nbsp;<span class="op" id="2307261">&gt;=</span>&nbsp;<span class="num" id="2307264">0</span>&nbsp;<span class="op" id="2307266">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2307269">len</span><span class="op" id="2307272">(</span><span class="ident" id="2307273">names</span><span class="op" id="2307278">)</span>&nbsp;<span class="op" id="2307280">==</span>&nbsp;<span class="num" id="2307283">0</span>&nbsp;<span class="op" id="2307285">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2307289">return</span>&nbsp;<span class="ident" id="2307296">names</span><span class="op" id="2307301">,</span>&nbsp;<span class="ident" id="2307303">io</span><span class="op" id="2307305">.</span><span class="ident" id="2307306">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2307311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2307314">return</span>&nbsp;<span class="ident" id="2307321">names</span><span class="op" id="2307326">,</span>&nbsp;<span class="ident" id="2307328">nil</span><br>
<span class="lineno"></span><span class="op" id="2307332">}</span>
</div>
</body>
</html>
