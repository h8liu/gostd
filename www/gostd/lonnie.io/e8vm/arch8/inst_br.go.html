<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5052740">package</span>&nbsp;<span class="ident" id="5052748">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5052755">//&nbsp;InstBr&nbsp;exectues&nbsp;branch&nbsp;instruction</span><br>
<span class="lineno"></span><span class="keyword" id="5052793">type</span>&nbsp;<span class="ident" id="5052798">instBr</span>&nbsp;<span class="keyword" id="5052805">struct</span><span class="op" id="5052811">{</span><span class="op" id="5052812">}</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span><span class="comment" id="5052815">//&nbsp;I&nbsp;executes&nbsp;the&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="5052846">//&nbsp;Might&nbsp;return&nbsp;invalid&nbsp;instruction&nbsp;exception.</span><br>
<span class="lineno"></span><span class="keyword" id="5052893">func</span>&nbsp;<span class="op" id="5052898">(</span><span class="ident" id="5052899">i</span>&nbsp;<span class="op" id="5052901">*</span><span class="ident" id="5052902">instBr</span><span class="op" id="5052908">)</span>&nbsp;<span class="ident" id="5052910">I</span><span class="op" id="5052911">(</span><span class="ident" id="5052912">cpu</span>&nbsp;<span class="op" id="5052916">*</span><span class="ident" id="5052917">cpu</span><span class="op" id="5052920">,</span>&nbsp;<span class="ident" id="5052922">in</span>&nbsp;<span class="builtintype" id="5052925">uint32</span><span class="op" id="5052931">)</span>&nbsp;<span class="op" id="5052933">*</span><span class="ident" id="5052934">Excep</span>&nbsp;<span class="op" id="5052940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5052943">op</span>&nbsp;<span class="op" id="5052946">:=</span>&nbsp;<span class="op" id="5052949">(</span><span class="ident" id="5052950">in</span>&nbsp;<span class="op" id="5052953">&gt;&gt;</span>&nbsp;<span class="num" id="5052956">24</span><span class="op" id="5052958">)</span>&nbsp;<span class="op" id="5052960">&amp;</span>&nbsp;<span class="num" id="5052962">0xff</span>&nbsp;&nbsp;<span class="comment" id="5052968">//&nbsp;(32:24]</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5052980">src1</span>&nbsp;<span class="op" id="5052985">:=</span>&nbsp;<span class="op" id="5052988">(</span><span class="ident" id="5052989">in</span>&nbsp;<span class="op" id="5052992">&gt;&gt;</span>&nbsp;<span class="num" id="5052995">21</span><span class="op" id="5052997">)</span>&nbsp;<span class="op" id="5052999">&amp;</span>&nbsp;<span class="num" id="5053001">0x7</span>&nbsp;<span class="comment" id="5053005">//&nbsp;(24:21]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053017">src2</span>&nbsp;<span class="op" id="5053022">:=</span>&nbsp;<span class="op" id="5053025">(</span><span class="ident" id="5053026">in</span>&nbsp;<span class="op" id="5053029">&gt;&gt;</span>&nbsp;<span class="num" id="5053032">18</span><span class="op" id="5053034">)</span>&nbsp;<span class="op" id="5053036">&amp;</span>&nbsp;<span class="num" id="5053038">0x7</span>&nbsp;<span class="comment" id="5053042">//&nbsp;(21:18]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053054">im</span>&nbsp;<span class="op" id="5053057">:=</span>&nbsp;<span class="ident" id="5053060">in</span>&nbsp;<span class="op" id="5053063">&amp;</span>&nbsp;<span class="num" id="5053065">0x3ffff</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5053079">//&nbsp;(18:0]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053091">s1</span>&nbsp;<span class="op" id="5053094">:=</span>&nbsp;<span class="ident" id="5053097">cpu</span><span class="op" id="5053100">.</span><span class="ident" id="5053101">regs</span><span class="op" id="5053105">[</span><span class="ident" id="5053106">src1</span><span class="op" id="5053110">]</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053113">s2</span>&nbsp;<span class="op" id="5053116">:=</span>&nbsp;<span class="ident" id="5053119">cpu</span><span class="op" id="5053122">.</span><span class="ident" id="5053123">regs</span><span class="op" id="5053127">[</span><span class="ident" id="5053128">src2</span><span class="op" id="5053132">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053135">pc</span>&nbsp;<span class="op" id="5053138">:=</span>&nbsp;<span class="ident" id="5053141">cpu</span><span class="op" id="5053144">.</span><span class="ident" id="5053145">regs</span><span class="op" id="5053149">[</span><span class="ident" id="5053150">PC</span><span class="op" id="5053152">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053155">br</span>&nbsp;<span class="op" id="5053158">:=</span>&nbsp;<span class="ident" id="5053161">pc</span>&nbsp;<span class="op" id="5053164">+</span>&nbsp;<span class="builtintype" id="5053166">uint32</span><span class="op" id="5053172">(</span><span class="builtintype" id="5053173">int32</span><span class="op" id="5053178">(</span><span class="ident" id="5053179">im</span><span class="op" id="5053181">&lt;&lt;</span><span class="num" id="5053183">14</span><span class="op" id="5053185">)</span><span class="op" id="5053186">&gt;&gt;</span><span class="num" id="5053188">12</span><span class="op" id="5053190">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053194">switch</span>&nbsp;<span class="ident" id="5053201">op</span>&nbsp;<span class="op" id="5053204">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053207">case</span>&nbsp;<span class="num" id="5053212">32</span><span class="op" id="5053214">:</span>&nbsp;<span class="comment" id="5053216">//&nbsp;bne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053225">if</span>&nbsp;<span class="ident" id="5053228">s1</span>&nbsp;<span class="op" id="5053231">!=</span>&nbsp;<span class="ident" id="5053234">s2</span>&nbsp;<span class="op" id="5053237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053242">pc</span>&nbsp;<span class="op" id="5053245">=</span>&nbsp;<span class="ident" id="5053247">br</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5053252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053255">case</span>&nbsp;<span class="num" id="5053260">33</span><span class="op" id="5053262">:</span>&nbsp;<span class="comment" id="5053264">//&nbsp;beq</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053273">if</span>&nbsp;<span class="ident" id="5053276">s1</span>&nbsp;<span class="op" id="5053279">==</span>&nbsp;<span class="ident" id="5053282">s2</span>&nbsp;<span class="op" id="5053285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053290">pc</span>&nbsp;<span class="op" id="5053293">=</span>&nbsp;<span class="ident" id="5053295">br</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5053300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053303">default</span><span class="op" id="5053310">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053314">return</span>&nbsp;<span class="ident" id="5053321">errInvalidInst</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5053337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053341">cpu</span><span class="op" id="5053344">.</span><span class="ident" id="5053345">regs</span><span class="op" id="5053349">[</span><span class="ident" id="5053350">PC</span><span class="op" id="5053352">]</span>&nbsp;<span class="op" id="5053354">=</span>&nbsp;<span class="ident" id="5053356">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053360">return</span>&nbsp;<span class="ident" id="5053367">nil</span><br>
<span class="lineno"></span><span class="op" id="5053371">}</span>
</div>
</body>
</html>
