<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5593857">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5593912">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5593966">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5594017">//&nbsp;Package&nbsp;image&nbsp;implements&nbsp;a&nbsp;basic&nbsp;2-D&nbsp;image&nbsp;library.</span><br>
<span class="lineno"></span><span class="comment" id="5594072">//</span><br>
<span class="lineno"></span><span class="comment" id="5594075">//&nbsp;The&nbsp;fundamental&nbsp;interface&nbsp;is&nbsp;called&nbsp;Image.&nbsp;An&nbsp;Image&nbsp;contains&nbsp;colors,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="5594153">//&nbsp;are&nbsp;described&nbsp;in&nbsp;the&nbsp;image/color&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="5594198">//</span><br>
<span class="lineno">10</span><span class="comment" id="5594201">//&nbsp;Values&nbsp;of&nbsp;the&nbsp;Image&nbsp;interface&nbsp;are&nbsp;created&nbsp;either&nbsp;by&nbsp;calling&nbsp;functions&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="5594279">//&nbsp;as&nbsp;NewRGBA&nbsp;and&nbsp;NewPaletted,&nbsp;or&nbsp;by&nbsp;calling&nbsp;Decode&nbsp;on&nbsp;an&nbsp;io.Reader&nbsp;containing</span><br>
<span class="lineno"></span><span class="comment" id="5594358">//&nbsp;image&nbsp;data&nbsp;in&nbsp;a&nbsp;format&nbsp;such&nbsp;as&nbsp;GIF,&nbsp;JPEG&nbsp;or&nbsp;PNG.&nbsp;Decoding&nbsp;any&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="5594434">//&nbsp;image&nbsp;format&nbsp;requires&nbsp;the&nbsp;prior&nbsp;registration&nbsp;of&nbsp;a&nbsp;decoder&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5594505">//&nbsp;Registration&nbsp;is&nbsp;typically&nbsp;automatic&nbsp;as&nbsp;a&nbsp;side&nbsp;effect&nbsp;of&nbsp;initializing&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="5594582">//&nbsp;format&#39;s&nbsp;package&nbsp;so&nbsp;that,&nbsp;to&nbsp;decode&nbsp;a&nbsp;PNG&nbsp;image,&nbsp;it&nbsp;suffices&nbsp;to&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="5594654">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;image/png&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5594678">//&nbsp;in&nbsp;a&nbsp;program&#39;s&nbsp;main&nbsp;package.&nbsp;The&nbsp;_&nbsp;means&nbsp;to&nbsp;import&nbsp;a&nbsp;package&nbsp;purely&nbsp;for&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5594757">//&nbsp;initialization&nbsp;side&nbsp;effects.</span><br>
<span class="lineno"></span><span class="comment" id="5594789">//</span><br>
<span class="lineno">20</span><span class="comment" id="5594792">//&nbsp;See&nbsp;&#34;The&nbsp;Go&nbsp;image&nbsp;package&#34;&nbsp;for&nbsp;more&nbsp;details:</span><br>
<span class="lineno"></span><span class="comment" id="5594840">//&nbsp;http://golang.org/doc/articles/image_package.html</span><br>
<span class="lineno"></span><span class="keyword" id="5594893">package</span>&nbsp;<span class="ident" id="5594901">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5594908">import</span>&nbsp;<span class="op" id="5594915">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5594918">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="5594932">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5594935">//&nbsp;Config&nbsp;holds&nbsp;an&nbsp;image&#39;s&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions.</span><br>
<span class="lineno"></span><span class="keyword" id="5594990">type</span>&nbsp;<span class="ident" id="5594995">Config</span>&nbsp;<span class="keyword" id="5595002">struct</span>&nbsp;<span class="op" id="5595009">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595012">ColorModel</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595026">color</span><span class="op" id="5595031">.</span><span class="ident" id="5595032">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595039">Width</span><span class="op" id="5595044">,</span>&nbsp;<span class="ident" id="5595046">Height</span>&nbsp;<span class="builtintype" id="5595053">int</span><br>
<span class="lineno"></span><span class="op" id="5595057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5595060">//&nbsp;Image&nbsp;is&nbsp;a&nbsp;finite&nbsp;rectangular&nbsp;grid&nbsp;of&nbsp;color.Color&nbsp;values&nbsp;taken&nbsp;from&nbsp;a&nbsp;color</span><br>
<span class="lineno">35</span><span class="comment" id="5595139">//&nbsp;model.</span><br>
<span class="lineno"></span><span class="keyword" id="5595149">type</span>&nbsp;<span class="ident" id="5595154">Image</span>&nbsp;<span class="keyword" id="5595160">interface</span>&nbsp;<span class="op" id="5595170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5595173">//&nbsp;ColorModel&nbsp;returns&nbsp;the&nbsp;Image&#39;s&nbsp;color&nbsp;model.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595221">ColorModel</span><span class="op" id="5595231">(</span><span class="op" id="5595232">)</span>&nbsp;<span class="ident" id="5595234">color</span><span class="op" id="5595239">.</span><span class="ident" id="5595240">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5595247">//&nbsp;Bounds&nbsp;returns&nbsp;the&nbsp;domain&nbsp;for&nbsp;which&nbsp;At&nbsp;can&nbsp;return&nbsp;non-zero&nbsp;color.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5595317">//&nbsp;The&nbsp;bounds&nbsp;do&nbsp;not&nbsp;necessarily&nbsp;contain&nbsp;the&nbsp;point&nbsp;(0,&nbsp;0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595377">Bounds</span><span class="op" id="5595383">(</span><span class="op" id="5595384">)</span>&nbsp;<span class="ident" id="5595386">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5595397">//&nbsp;At&nbsp;returns&nbsp;the&nbsp;color&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5595446">//&nbsp;At(Bounds().Min.X,&nbsp;Bounds().Min.Y)&nbsp;returns&nbsp;the&nbsp;upper-left&nbsp;pixel&nbsp;of&nbsp;the&nbsp;grid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5595527">//&nbsp;At(Bounds().Max.X-1,&nbsp;Bounds().Max.Y-1)&nbsp;returns&nbsp;the&nbsp;lower-right&nbsp;one.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595599">At</span><span class="op" id="5595601">(</span><span class="ident" id="5595602">x</span><span class="op" id="5595603">,</span>&nbsp;<span class="ident" id="5595605">y</span>&nbsp;<span class="builtintype" id="5595607">int</span><span class="op" id="5595610">)</span>&nbsp;<span class="ident" id="5595612">color</span><span class="op" id="5595617">.</span><span class="ident" id="5595618">Color</span><br>
<span class="lineno"></span><span class="op" id="5595624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5595627">//&nbsp;PalettedImage&nbsp;is&nbsp;an&nbsp;image&nbsp;whose&nbsp;colors&nbsp;may&nbsp;come&nbsp;from&nbsp;a&nbsp;limited&nbsp;palette.</span><br>
<span class="lineno"></span><span class="comment" id="5595702">//&nbsp;If&nbsp;m&nbsp;is&nbsp;a&nbsp;PalettedImage&nbsp;and&nbsp;m.ColorModel()&nbsp;returns&nbsp;a&nbsp;PalettedColorModel&nbsp;p,</span><br>
<span class="lineno">50</span><span class="comment" id="5595780">//&nbsp;then&nbsp;m.At(x,&nbsp;y)&nbsp;should&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;p[m.ColorIndexAt(x,&nbsp;y)].&nbsp;If&nbsp;m&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5595855">//&nbsp;color&nbsp;model&nbsp;is&nbsp;not&nbsp;a&nbsp;PalettedColorModel,&nbsp;then&nbsp;ColorIndexAt&#39;s&nbsp;behavior&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5595931">//&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="keyword" id="5595945">type</span>&nbsp;<span class="ident" id="5595950">PalettedImage</span>&nbsp;<span class="keyword" id="5595964">interface</span>&nbsp;<span class="op" id="5595974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5595977">//&nbsp;ColorIndexAt&nbsp;returns&nbsp;the&nbsp;palette&nbsp;index&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596044">ColorIndexAt</span><span class="op" id="5596056">(</span><span class="ident" id="5596057">x</span><span class="op" id="5596058">,</span>&nbsp;<span class="ident" id="5596060">y</span>&nbsp;<span class="builtintype" id="5596062">int</span><span class="op" id="5596065">)</span>&nbsp;<span class="builtintype" id="5596067">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596074">Image</span><br>
<span class="lineno"></span><span class="op" id="5596080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5596083">//&nbsp;RGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA&nbsp;values.</span><br>
<span class="lineno">60</span><span class="keyword" id="5596156">type</span>&nbsp;<span class="ident" id="5596161">RGBA</span>&nbsp;<span class="keyword" id="5596166">struct</span>&nbsp;<span class="op" id="5596173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5596176">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5596244">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596312">Pix</span>&nbsp;<span class="op" id="5596316">[</span><span class="op" id="5596317">]</span><span class="builtintype" id="5596318">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5596325">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596401">Stride</span>&nbsp;<span class="builtintype" id="5596408">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5596413">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596445">Rect</span>&nbsp;<span class="ident" id="5596450">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5596460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="5596463">func</span>&nbsp;<span class="op" id="5596468">(</span><span class="ident" id="5596469">p</span>&nbsp;<span class="op" id="5596471">*</span><span class="ident" id="5596472">RGBA</span><span class="op" id="5596476">)</span>&nbsp;<span class="ident" id="5596478">ColorModel</span><span class="op" id="5596488">(</span><span class="op" id="5596489">)</span>&nbsp;<span class="ident" id="5596491">color</span><span class="op" id="5596496">.</span><span class="ident" id="5596497">Model</span>&nbsp;<span class="op" id="5596503">{</span>&nbsp;<span class="keyword" id="5596505">return</span>&nbsp;<span class="ident" id="5596512">color</span><span class="op" id="5596517">.</span><span class="ident" id="5596518">RGBAModel</span>&nbsp;<span class="op" id="5596528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5596531">func</span>&nbsp;<span class="op" id="5596536">(</span><span class="ident" id="5596537">p</span>&nbsp;<span class="op" id="5596539">*</span><span class="ident" id="5596540">RGBA</span><span class="op" id="5596544">)</span>&nbsp;<span class="ident" id="5596546">Bounds</span><span class="op" id="5596552">(</span><span class="op" id="5596553">)</span>&nbsp;<span class="ident" id="5596555">Rectangle</span>&nbsp;<span class="op" id="5596565">{</span>&nbsp;<span class="keyword" id="5596567">return</span>&nbsp;<span class="ident" id="5596574">p</span><span class="op" id="5596575">.</span><span class="ident" id="5596576">Rect</span>&nbsp;<span class="op" id="5596581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5596584">func</span>&nbsp;<span class="op" id="5596589">(</span><span class="ident" id="5596590">p</span>&nbsp;<span class="op" id="5596592">*</span><span class="ident" id="5596593">RGBA</span><span class="op" id="5596597">)</span>&nbsp;<span class="ident" id="5596599">At</span><span class="op" id="5596601">(</span><span class="ident" id="5596602">x</span><span class="op" id="5596603">,</span>&nbsp;<span class="ident" id="5596605">y</span>&nbsp;<span class="builtintype" id="5596607">int</span><span class="op" id="5596610">)</span>&nbsp;<span class="ident" id="5596612">color</span><span class="op" id="5596617">.</span><span class="ident" id="5596618">Color</span>&nbsp;<span class="op" id="5596624">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596627">return</span>&nbsp;<span class="ident" id="5596634">p</span><span class="op" id="5596635">.</span><span class="ident" id="5596636">RGBAAt</span><span class="op" id="5596642">(</span><span class="ident" id="5596643">x</span><span class="op" id="5596644">,</span>&nbsp;<span class="ident" id="5596646">y</span><span class="op" id="5596647">)</span><br>
<span class="lineno"></span><span class="op" id="5596649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5596652">func</span>&nbsp;<span class="op" id="5596657">(</span><span class="ident" id="5596658">p</span>&nbsp;<span class="op" id="5596660">*</span><span class="ident" id="5596661">RGBA</span><span class="op" id="5596665">)</span>&nbsp;<span class="ident" id="5596667">RGBAAt</span><span class="op" id="5596673">(</span><span class="ident" id="5596674">x</span><span class="op" id="5596675">,</span>&nbsp;<span class="ident" id="5596677">y</span>&nbsp;<span class="builtintype" id="5596679">int</span><span class="op" id="5596682">)</span>&nbsp;<span class="ident" id="5596684">color</span><span class="op" id="5596689">.</span><span class="ident" id="5596690">RGBA</span>&nbsp;<span class="op" id="5596695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596698">if</span>&nbsp;<span class="op" id="5596701">!</span><span class="op" id="5596702">(</span><span class="ident" id="5596703">Point</span><span class="op" id="5596708">{</span><span class="ident" id="5596709">x</span><span class="op" id="5596710">,</span>&nbsp;<span class="ident" id="5596712">y</span><span class="op" id="5596713">}</span><span class="op" id="5596714">.</span><span class="ident" id="5596715">In</span><span class="op" id="5596717">(</span><span class="ident" id="5596718">p</span><span class="op" id="5596719">.</span><span class="ident" id="5596720">Rect</span><span class="op" id="5596724">)</span><span class="op" id="5596725">)</span>&nbsp;<span class="op" id="5596727">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596731">return</span>&nbsp;<span class="ident" id="5596738">color</span><span class="op" id="5596743">.</span><span class="ident" id="5596744">RGBA</span><span class="op" id="5596748">{</span><span class="op" id="5596749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596755">i</span>&nbsp;<span class="op" id="5596757">:=</span>&nbsp;<span class="ident" id="5596760">p</span><span class="op" id="5596761">.</span><span class="ident" id="5596762">PixOffset</span><span class="op" id="5596771">(</span><span class="ident" id="5596772">x</span><span class="op" id="5596773">,</span>&nbsp;<span class="ident" id="5596775">y</span><span class="op" id="5596776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596779">return</span>&nbsp;<span class="ident" id="5596786">color</span><span class="op" id="5596791">.</span><span class="ident" id="5596792">RGBA</span><span class="op" id="5596796">{</span><span class="ident" id="5596797">p</span><span class="op" id="5596798">.</span><span class="ident" id="5596799">Pix</span><span class="op" id="5596802">[</span><span class="ident" id="5596803">i</span><span class="op" id="5596804">+</span><span class="num" id="5596805">0</span><span class="op" id="5596806">]</span><span class="op" id="5596807">,</span>&nbsp;<span class="ident" id="5596809">p</span><span class="op" id="5596810">.</span><span class="ident" id="5596811">Pix</span><span class="op" id="5596814">[</span><span class="ident" id="5596815">i</span><span class="op" id="5596816">+</span><span class="num" id="5596817">1</span><span class="op" id="5596818">]</span><span class="op" id="5596819">,</span>&nbsp;<span class="ident" id="5596821">p</span><span class="op" id="5596822">.</span><span class="ident" id="5596823">Pix</span><span class="op" id="5596826">[</span><span class="ident" id="5596827">i</span><span class="op" id="5596828">+</span><span class="num" id="5596829">2</span><span class="op" id="5596830">]</span><span class="op" id="5596831">,</span>&nbsp;<span class="ident" id="5596833">p</span><span class="op" id="5596834">.</span><span class="ident" id="5596835">Pix</span><span class="op" id="5596838">[</span><span class="ident" id="5596839">i</span><span class="op" id="5596840">+</span><span class="num" id="5596841">3</span><span class="op" id="5596842">]</span><span class="op" id="5596843">}</span><br>
<span class="lineno"></span><span class="op" id="5596845">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="5596848">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5596927">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5596951">func</span>&nbsp;<span class="op" id="5596956">(</span><span class="ident" id="5596957">p</span>&nbsp;<span class="op" id="5596959">*</span><span class="ident" id="5596960">RGBA</span><span class="op" id="5596964">)</span>&nbsp;<span class="ident" id="5596966">PixOffset</span><span class="op" id="5596975">(</span><span class="ident" id="5596976">x</span><span class="op" id="5596977">,</span>&nbsp;<span class="ident" id="5596979">y</span>&nbsp;<span class="builtintype" id="5596981">int</span><span class="op" id="5596984">)</span>&nbsp;<span class="builtintype" id="5596986">int</span>&nbsp;<span class="op" id="5596990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596993">return</span>&nbsp;<span class="op" id="5597000">(</span><span class="ident" id="5597001">y</span><span class="op" id="5597002">-</span><span class="ident" id="5597003">p</span><span class="op" id="5597004">.</span><span class="ident" id="5597005">Rect</span><span class="op" id="5597009">.</span><span class="ident" id="5597010">Min</span><span class="op" id="5597013">.</span><span class="ident" id="5597014">Y</span><span class="op" id="5597015">)</span><span class="op" id="5597016">*</span><span class="ident" id="5597017">p</span><span class="op" id="5597018">.</span><span class="ident" id="5597019">Stride</span>&nbsp;<span class="op" id="5597026">+</span>&nbsp;<span class="op" id="5597028">(</span><span class="ident" id="5597029">x</span><span class="op" id="5597030">-</span><span class="ident" id="5597031">p</span><span class="op" id="5597032">.</span><span class="ident" id="5597033">Rect</span><span class="op" id="5597037">.</span><span class="ident" id="5597038">Min</span><span class="op" id="5597041">.</span><span class="ident" id="5597042">X</span><span class="op" id="5597043">)</span><span class="op" id="5597044">*</span><span class="num" id="5597045">4</span><br>
<span class="lineno">90</span><span class="op" id="5597047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5597050">func</span>&nbsp;<span class="op" id="5597055">(</span><span class="ident" id="5597056">p</span>&nbsp;<span class="op" id="5597058">*</span><span class="ident" id="5597059">RGBA</span><span class="op" id="5597063">)</span>&nbsp;<span class="ident" id="5597065">Set</span><span class="op" id="5597068">(</span><span class="ident" id="5597069">x</span><span class="op" id="5597070">,</span>&nbsp;<span class="ident" id="5597072">y</span>&nbsp;<span class="builtintype" id="5597074">int</span><span class="op" id="5597077">,</span>&nbsp;<span class="ident" id="5597079">c</span>&nbsp;<span class="ident" id="5597081">color</span><span class="op" id="5597086">.</span><span class="ident" id="5597087">Color</span><span class="op" id="5597092">)</span>&nbsp;<span class="op" id="5597094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597097">if</span>&nbsp;<span class="op" id="5597100">!</span><span class="op" id="5597101">(</span><span class="ident" id="5597102">Point</span><span class="op" id="5597107">{</span><span class="ident" id="5597108">x</span><span class="op" id="5597109">,</span>&nbsp;<span class="ident" id="5597111">y</span><span class="op" id="5597112">}</span><span class="op" id="5597113">.</span><span class="ident" id="5597114">In</span><span class="op" id="5597116">(</span><span class="ident" id="5597117">p</span><span class="op" id="5597118">.</span><span class="ident" id="5597119">Rect</span><span class="op" id="5597123">)</span><span class="op" id="5597124">)</span>&nbsp;<span class="op" id="5597126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597130">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597141">i</span>&nbsp;<span class="op" id="5597143">:=</span>&nbsp;<span class="ident" id="5597146">p</span><span class="op" id="5597147">.</span><span class="ident" id="5597148">PixOffset</span><span class="op" id="5597157">(</span><span class="ident" id="5597158">x</span><span class="op" id="5597159">,</span>&nbsp;<span class="ident" id="5597161">y</span><span class="op" id="5597162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597165">c1</span>&nbsp;<span class="op" id="5597168">:=</span>&nbsp;<span class="ident" id="5597171">color</span><span class="op" id="5597176">.</span><span class="ident" id="5597177">RGBAModel</span><span class="op" id="5597186">.</span><span class="ident" id="5597187">Convert</span><span class="op" id="5597194">(</span><span class="ident" id="5597195">c</span><span class="op" id="5597196">)</span><span class="op" id="5597197">.</span><span class="op" id="5597198">(</span><span class="ident" id="5597199">color</span><span class="op" id="5597204">.</span><span class="ident" id="5597205">RGBA</span><span class="op" id="5597209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597212">p</span><span class="op" id="5597213">.</span><span class="ident" id="5597214">Pix</span><span class="op" id="5597217">[</span><span class="ident" id="5597218">i</span><span class="op" id="5597219">+</span><span class="num" id="5597220">0</span><span class="op" id="5597221">]</span>&nbsp;<span class="op" id="5597223">=</span>&nbsp;<span class="ident" id="5597225">c1</span><span class="op" id="5597227">.</span><span class="ident" id="5597228">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597231">p</span><span class="op" id="5597232">.</span><span class="ident" id="5597233">Pix</span><span class="op" id="5597236">[</span><span class="ident" id="5597237">i</span><span class="op" id="5597238">+</span><span class="num" id="5597239">1</span><span class="op" id="5597240">]</span>&nbsp;<span class="op" id="5597242">=</span>&nbsp;<span class="ident" id="5597244">c1</span><span class="op" id="5597246">.</span><span class="ident" id="5597247">G</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597250">p</span><span class="op" id="5597251">.</span><span class="ident" id="5597252">Pix</span><span class="op" id="5597255">[</span><span class="ident" id="5597256">i</span><span class="op" id="5597257">+</span><span class="num" id="5597258">2</span><span class="op" id="5597259">]</span>&nbsp;<span class="op" id="5597261">=</span>&nbsp;<span class="ident" id="5597263">c1</span><span class="op" id="5597265">.</span><span class="ident" id="5597266">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597269">p</span><span class="op" id="5597270">.</span><span class="ident" id="5597271">Pix</span><span class="op" id="5597274">[</span><span class="ident" id="5597275">i</span><span class="op" id="5597276">+</span><span class="num" id="5597277">3</span><span class="op" id="5597278">]</span>&nbsp;<span class="op" id="5597280">=</span>&nbsp;<span class="ident" id="5597282">c1</span><span class="op" id="5597284">.</span><span class="ident" id="5597285">A</span><br>
<span class="lineno"></span><span class="op" id="5597287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5597290">func</span>&nbsp;<span class="op" id="5597295">(</span><span class="ident" id="5597296">p</span>&nbsp;<span class="op" id="5597298">*</span><span class="ident" id="5597299">RGBA</span><span class="op" id="5597303">)</span>&nbsp;<span class="ident" id="5597305">SetRGBA</span><span class="op" id="5597312">(</span><span class="ident" id="5597313">x</span><span class="op" id="5597314">,</span>&nbsp;<span class="ident" id="5597316">y</span>&nbsp;<span class="builtintype" id="5597318">int</span><span class="op" id="5597321">,</span>&nbsp;<span class="ident" id="5597323">c</span>&nbsp;<span class="ident" id="5597325">color</span><span class="op" id="5597330">.</span><span class="ident" id="5597331">RGBA</span><span class="op" id="5597335">)</span>&nbsp;<span class="op" id="5597337">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597340">if</span>&nbsp;<span class="op" id="5597343">!</span><span class="op" id="5597344">(</span><span class="ident" id="5597345">Point</span><span class="op" id="5597350">{</span><span class="ident" id="5597351">x</span><span class="op" id="5597352">,</span>&nbsp;<span class="ident" id="5597354">y</span><span class="op" id="5597355">}</span><span class="op" id="5597356">.</span><span class="ident" id="5597357">In</span><span class="op" id="5597359">(</span><span class="ident" id="5597360">p</span><span class="op" id="5597361">.</span><span class="ident" id="5597362">Rect</span><span class="op" id="5597366">)</span><span class="op" id="5597367">)</span>&nbsp;<span class="op" id="5597369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597373">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597384">i</span>&nbsp;<span class="op" id="5597386">:=</span>&nbsp;<span class="ident" id="5597389">p</span><span class="op" id="5597390">.</span><span class="ident" id="5597391">PixOffset</span><span class="op" id="5597400">(</span><span class="ident" id="5597401">x</span><span class="op" id="5597402">,</span>&nbsp;<span class="ident" id="5597404">y</span><span class="op" id="5597405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597408">p</span><span class="op" id="5597409">.</span><span class="ident" id="5597410">Pix</span><span class="op" id="5597413">[</span><span class="ident" id="5597414">i</span><span class="op" id="5597415">+</span><span class="num" id="5597416">0</span><span class="op" id="5597417">]</span>&nbsp;<span class="op" id="5597419">=</span>&nbsp;<span class="ident" id="5597421">c</span><span class="op" id="5597422">.</span><span class="ident" id="5597423">R</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597426">p</span><span class="op" id="5597427">.</span><span class="ident" id="5597428">Pix</span><span class="op" id="5597431">[</span><span class="ident" id="5597432">i</span><span class="op" id="5597433">+</span><span class="num" id="5597434">1</span><span class="op" id="5597435">]</span>&nbsp;<span class="op" id="5597437">=</span>&nbsp;<span class="ident" id="5597439">c</span><span class="op" id="5597440">.</span><span class="ident" id="5597441">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597444">p</span><span class="op" id="5597445">.</span><span class="ident" id="5597446">Pix</span><span class="op" id="5597449">[</span><span class="ident" id="5597450">i</span><span class="op" id="5597451">+</span><span class="num" id="5597452">2</span><span class="op" id="5597453">]</span>&nbsp;<span class="op" id="5597455">=</span>&nbsp;<span class="ident" id="5597457">c</span><span class="op" id="5597458">.</span><span class="ident" id="5597459">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597462">p</span><span class="op" id="5597463">.</span><span class="ident" id="5597464">Pix</span><span class="op" id="5597467">[</span><span class="ident" id="5597468">i</span><span class="op" id="5597469">+</span><span class="num" id="5597470">3</span><span class="op" id="5597471">]</span>&nbsp;<span class="op" id="5597473">=</span>&nbsp;<span class="ident" id="5597475">c</span><span class="op" id="5597476">.</span><span class="ident" id="5597477">A</span><br>
<span class="lineno"></span><span class="op" id="5597479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5597482">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5597559">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5597631">func</span>&nbsp;<span class="op" id="5597636">(</span><span class="ident" id="5597637">p</span>&nbsp;<span class="op" id="5597639">*</span><span class="ident" id="5597640">RGBA</span><span class="op" id="5597644">)</span>&nbsp;<span class="ident" id="5597646">SubImage</span><span class="op" id="5597654">(</span><span class="ident" id="5597655">r</span>&nbsp;<span class="ident" id="5597657">Rectangle</span><span class="op" id="5597666">)</span>&nbsp;<span class="ident" id="5597668">Image</span>&nbsp;<span class="op" id="5597674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597677">r</span>&nbsp;<span class="op" id="5597679">=</span>&nbsp;<span class="ident" id="5597681">r</span><span class="op" id="5597682">.</span><span class="ident" id="5597683">Intersect</span><span class="op" id="5597692">(</span><span class="ident" id="5597693">p</span><span class="op" id="5597694">.</span><span class="ident" id="5597695">Rect</span><span class="op" id="5597699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5597702">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5597783">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5597865">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597915">if</span>&nbsp;<span class="ident" id="5597918">r</span><span class="op" id="5597919">.</span><span class="ident" id="5597920">Empty</span><span class="op" id="5597925">(</span><span class="op" id="5597926">)</span>&nbsp;<span class="op" id="5597928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597932">return</span>&nbsp;<span class="op" id="5597939">&amp;</span><span class="ident" id="5597940">RGBA</span><span class="op" id="5597944">{</span><span class="op" id="5597945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597948">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597951">i</span>&nbsp;<span class="op" id="5597953">:=</span>&nbsp;<span class="ident" id="5597956">p</span><span class="op" id="5597957">.</span><span class="ident" id="5597958">PixOffset</span><span class="op" id="5597967">(</span><span class="ident" id="5597968">r</span><span class="op" id="5597969">.</span><span class="ident" id="5597970">Min</span><span class="op" id="5597973">.</span><span class="ident" id="5597974">X</span><span class="op" id="5597975">,</span>&nbsp;<span class="ident" id="5597977">r</span><span class="op" id="5597978">.</span><span class="ident" id="5597979">Min</span><span class="op" id="5597982">.</span><span class="ident" id="5597983">Y</span><span class="op" id="5597984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597987">return</span>&nbsp;<span class="op" id="5597994">&amp;</span><span class="ident" id="5597995">RGBA</span><span class="op" id="5597999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598003">Pix</span><span class="op" id="5598006">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598011">p</span><span class="op" id="5598012">.</span><span class="ident" id="5598013">Pix</span><span class="op" id="5598016">[</span><span class="ident" id="5598017">i</span><span class="op" id="5598018">:</span><span class="op" id="5598019">]</span><span class="op" id="5598020">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598024">Stride</span><span class="op" id="5598030">:</span>&nbsp;<span class="ident" id="5598032">p</span><span class="op" id="5598033">.</span><span class="ident" id="5598034">Stride</span><span class="op" id="5598040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598044">Rect</span><span class="op" id="5598048">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5598052">r</span><span class="op" id="5598053">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5598056">}</span><br>
<span class="lineno"></span><span class="op" id="5598058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5598061">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5598134">func</span>&nbsp;<span class="op" id="5598139">(</span><span class="ident" id="5598140">p</span>&nbsp;<span class="op" id="5598142">*</span><span class="ident" id="5598143">RGBA</span><span class="op" id="5598147">)</span>&nbsp;<span class="ident" id="5598149">Opaque</span><span class="op" id="5598155">(</span><span class="op" id="5598156">)</span>&nbsp;<span class="builtintype" id="5598158">bool</span>&nbsp;<span class="op" id="5598163">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598166">if</span>&nbsp;<span class="ident" id="5598169">p</span><span class="op" id="5598170">.</span><span class="ident" id="5598171">Rect</span><span class="op" id="5598175">.</span><span class="ident" id="5598176">Empty</span><span class="op" id="5598181">(</span><span class="op" id="5598182">)</span>&nbsp;<span class="op" id="5598184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598188">return</span>&nbsp;<span class="builtintype" id="5598195">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5598201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598204">i0</span><span class="op" id="5598206">,</span>&nbsp;<span class="ident" id="5598208">i1</span>&nbsp;<span class="op" id="5598211">:=</span>&nbsp;<span class="num" id="5598214">3</span><span class="op" id="5598215">,</span>&nbsp;<span class="ident" id="5598217">p</span><span class="op" id="5598218">.</span><span class="ident" id="5598219">Rect</span><span class="op" id="5598223">.</span><span class="ident" id="5598224">Dx</span><span class="op" id="5598226">(</span><span class="op" id="5598227">)</span><span class="op" id="5598228">*</span><span class="num" id="5598229">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598232">for</span>&nbsp;<span class="ident" id="5598236">y</span>&nbsp;<span class="op" id="5598238">:=</span>&nbsp;<span class="ident" id="5598241">p</span><span class="op" id="5598242">.</span><span class="ident" id="5598243">Rect</span><span class="op" id="5598247">.</span><span class="ident" id="5598248">Min</span><span class="op" id="5598251">.</span><span class="ident" id="5598252">Y</span><span class="op" id="5598253">;</span>&nbsp;<span class="ident" id="5598255">y</span>&nbsp;<span class="op" id="5598257">&lt;</span>&nbsp;<span class="ident" id="5598259">p</span><span class="op" id="5598260">.</span><span class="ident" id="5598261">Rect</span><span class="op" id="5598265">.</span><span class="ident" id="5598266">Max</span><span class="op" id="5598269">.</span><span class="ident" id="5598270">Y</span><span class="op" id="5598271">;</span>&nbsp;<span class="ident" id="5598273">y</span><span class="op" id="5598274">++</span>&nbsp;<span class="op" id="5598277">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598281">for</span>&nbsp;<span class="ident" id="5598285">i</span>&nbsp;<span class="op" id="5598287">:=</span>&nbsp;<span class="ident" id="5598290">i0</span><span class="op" id="5598292">;</span>&nbsp;<span class="ident" id="5598294">i</span>&nbsp;<span class="op" id="5598296">&lt;</span>&nbsp;<span class="ident" id="5598298">i1</span><span class="op" id="5598300">;</span>&nbsp;<span class="ident" id="5598302">i</span>&nbsp;<span class="op" id="5598304">+=</span>&nbsp;<span class="num" id="5598307">4</span>&nbsp;<span class="op" id="5598309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598314">if</span>&nbsp;<span class="ident" id="5598317">p</span><span class="op" id="5598318">.</span><span class="ident" id="5598319">Pix</span><span class="op" id="5598322">[</span><span class="ident" id="5598323">i</span><span class="op" id="5598324">]</span>&nbsp;<span class="op" id="5598326">!=</span>&nbsp;<span class="num" id="5598329">0xff</span>&nbsp;<span class="op" id="5598334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598340">return</span>&nbsp;<span class="builtintype" id="5598347">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5598356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5598360">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598364">i0</span>&nbsp;<span class="op" id="5598367">+=</span>&nbsp;<span class="ident" id="5598370">p</span><span class="op" id="5598371">.</span><span class="ident" id="5598372">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598381">i1</span>&nbsp;<span class="op" id="5598384">+=</span>&nbsp;<span class="ident" id="5598387">p</span><span class="op" id="5598388">.</span><span class="ident" id="5598389">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5598397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598400">return</span>&nbsp;<span class="builtintype" id="5598407">true</span><br>
<span class="lineno"></span><span class="op" id="5598412">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="5598415">//&nbsp;NewRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5598468">func</span>&nbsp;<span class="ident" id="5598473">NewRGBA</span><span class="op" id="5598480">(</span><span class="ident" id="5598481">r</span>&nbsp;<span class="ident" id="5598483">Rectangle</span><span class="op" id="5598492">)</span>&nbsp;<span class="op" id="5598494">*</span><span class="ident" id="5598495">RGBA</span>&nbsp;<span class="op" id="5598500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598503">w</span><span class="op" id="5598504">,</span>&nbsp;<span class="ident" id="5598506">h</span>&nbsp;<span class="op" id="5598508">:=</span>&nbsp;<span class="ident" id="5598511">r</span><span class="op" id="5598512">.</span><span class="ident" id="5598513">Dx</span><span class="op" id="5598515">(</span><span class="op" id="5598516">)</span><span class="op" id="5598517">,</span>&nbsp;<span class="ident" id="5598519">r</span><span class="op" id="5598520">.</span><span class="ident" id="5598521">Dy</span><span class="op" id="5598523">(</span><span class="op" id="5598524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598527">buf</span>&nbsp;<span class="op" id="5598531">:=</span>&nbsp;<span class="builtinfunc" id="5598534">make</span><span class="op" id="5598538">(</span><span class="op" id="5598539">[</span><span class="op" id="5598540">]</span><span class="builtintype" id="5598541">uint8</span><span class="op" id="5598546">,</span>&nbsp;<span class="num" id="5598548">4</span><span class="op" id="5598549">*</span><span class="ident" id="5598550">w</span><span class="op" id="5598551">*</span><span class="ident" id="5598552">h</span><span class="op" id="5598553">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598556">return</span>&nbsp;<span class="op" id="5598563">&amp;</span><span class="ident" id="5598564">RGBA</span><span class="op" id="5598568">{</span><span class="ident" id="5598569">buf</span><span class="op" id="5598572">,</span>&nbsp;<span class="num" id="5598574">4</span>&nbsp;<span class="op" id="5598576">*</span>&nbsp;<span class="ident" id="5598578">w</span><span class="op" id="5598579">,</span>&nbsp;<span class="ident" id="5598581">r</span><span class="op" id="5598582">}</span><br>
<span class="lineno"></span><span class="op" id="5598584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5598587">//&nbsp;RGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5598664">type</span>&nbsp;<span class="ident" id="5598669">RGBA64</span>&nbsp;<span class="keyword" id="5598676">struct</span>&nbsp;<span class="op" id="5598683">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5598686">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5598776">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598844">Pix</span>&nbsp;<span class="op" id="5598848">[</span><span class="op" id="5598849">]</span><span class="builtintype" id="5598850">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5598857">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598933">Stride</span>&nbsp;<span class="builtintype" id="5598940">int</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5598945">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598977">Rect</span>&nbsp;<span class="ident" id="5598982">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5598992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5598995">func</span>&nbsp;<span class="op" id="5599000">(</span><span class="ident" id="5599001">p</span>&nbsp;<span class="op" id="5599003">*</span><span class="ident" id="5599004">RGBA64</span><span class="op" id="5599010">)</span>&nbsp;<span class="ident" id="5599012">ColorModel</span><span class="op" id="5599022">(</span><span class="op" id="5599023">)</span>&nbsp;<span class="ident" id="5599025">color</span><span class="op" id="5599030">.</span><span class="ident" id="5599031">Model</span>&nbsp;<span class="op" id="5599037">{</span>&nbsp;<span class="keyword" id="5599039">return</span>&nbsp;<span class="ident" id="5599046">color</span><span class="op" id="5599051">.</span><span class="ident" id="5599052">RGBA64Model</span>&nbsp;<span class="op" id="5599064">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5599067">func</span>&nbsp;<span class="op" id="5599072">(</span><span class="ident" id="5599073">p</span>&nbsp;<span class="op" id="5599075">*</span><span class="ident" id="5599076">RGBA64</span><span class="op" id="5599082">)</span>&nbsp;<span class="ident" id="5599084">Bounds</span><span class="op" id="5599090">(</span><span class="op" id="5599091">)</span>&nbsp;<span class="ident" id="5599093">Rectangle</span>&nbsp;<span class="op" id="5599103">{</span>&nbsp;<span class="keyword" id="5599105">return</span>&nbsp;<span class="ident" id="5599112">p</span><span class="op" id="5599113">.</span><span class="ident" id="5599114">Rect</span>&nbsp;<span class="op" id="5599119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5599122">func</span>&nbsp;<span class="op" id="5599127">(</span><span class="ident" id="5599128">p</span>&nbsp;<span class="op" id="5599130">*</span><span class="ident" id="5599131">RGBA64</span><span class="op" id="5599137">)</span>&nbsp;<span class="ident" id="5599139">At</span><span class="op" id="5599141">(</span><span class="ident" id="5599142">x</span><span class="op" id="5599143">,</span>&nbsp;<span class="ident" id="5599145">y</span>&nbsp;<span class="builtintype" id="5599147">int</span><span class="op" id="5599150">)</span>&nbsp;<span class="ident" id="5599152">color</span><span class="op" id="5599157">.</span><span class="ident" id="5599158">Color</span>&nbsp;<span class="op" id="5599164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599167">return</span>&nbsp;<span class="ident" id="5599174">p</span><span class="op" id="5599175">.</span><span class="ident" id="5599176">RGBA64At</span><span class="op" id="5599184">(</span><span class="ident" id="5599185">x</span><span class="op" id="5599186">,</span>&nbsp;<span class="ident" id="5599188">y</span><span class="op" id="5599189">)</span><br>
<span class="lineno">175</span><span class="op" id="5599191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5599194">func</span>&nbsp;<span class="op" id="5599199">(</span><span class="ident" id="5599200">p</span>&nbsp;<span class="op" id="5599202">*</span><span class="ident" id="5599203">RGBA64</span><span class="op" id="5599209">)</span>&nbsp;<span class="ident" id="5599211">RGBA64At</span><span class="op" id="5599219">(</span><span class="ident" id="5599220">x</span><span class="op" id="5599221">,</span>&nbsp;<span class="ident" id="5599223">y</span>&nbsp;<span class="builtintype" id="5599225">int</span><span class="op" id="5599228">)</span>&nbsp;<span class="ident" id="5599230">color</span><span class="op" id="5599235">.</span><span class="ident" id="5599236">RGBA64</span>&nbsp;<span class="op" id="5599243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599246">if</span>&nbsp;<span class="op" id="5599249">!</span><span class="op" id="5599250">(</span><span class="ident" id="5599251">Point</span><span class="op" id="5599256">{</span><span class="ident" id="5599257">x</span><span class="op" id="5599258">,</span>&nbsp;<span class="ident" id="5599260">y</span><span class="op" id="5599261">}</span><span class="op" id="5599262">.</span><span class="ident" id="5599263">In</span><span class="op" id="5599265">(</span><span class="ident" id="5599266">p</span><span class="op" id="5599267">.</span><span class="ident" id="5599268">Rect</span><span class="op" id="5599272">)</span><span class="op" id="5599273">)</span>&nbsp;<span class="op" id="5599275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599279">return</span>&nbsp;<span class="ident" id="5599286">color</span><span class="op" id="5599291">.</span><span class="ident" id="5599292">RGBA64</span><span class="op" id="5599298">{</span><span class="op" id="5599299">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5599302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599305">i</span>&nbsp;<span class="op" id="5599307">:=</span>&nbsp;<span class="ident" id="5599310">p</span><span class="op" id="5599311">.</span><span class="ident" id="5599312">PixOffset</span><span class="op" id="5599321">(</span><span class="ident" id="5599322">x</span><span class="op" id="5599323">,</span>&nbsp;<span class="ident" id="5599325">y</span><span class="op" id="5599326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599329">return</span>&nbsp;<span class="ident" id="5599336">color</span><span class="op" id="5599341">.</span><span class="ident" id="5599342">RGBA64</span><span class="op" id="5599348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5599352">uint16</span><span class="op" id="5599358">(</span><span class="ident" id="5599359">p</span><span class="op" id="5599360">.</span><span class="ident" id="5599361">Pix</span><span class="op" id="5599364">[</span><span class="ident" id="5599365">i</span><span class="op" id="5599366">+</span><span class="num" id="5599367">0</span><span class="op" id="5599368">]</span><span class="op" id="5599369">)</span><span class="op" id="5599370">&lt;&lt;</span><span class="num" id="5599372">8</span>&nbsp;<span class="op" id="5599374">|</span>&nbsp;<span class="builtintype" id="5599376">uint16</span><span class="op" id="5599382">(</span><span class="ident" id="5599383">p</span><span class="op" id="5599384">.</span><span class="ident" id="5599385">Pix</span><span class="op" id="5599388">[</span><span class="ident" id="5599389">i</span><span class="op" id="5599390">+</span><span class="num" id="5599391">1</span><span class="op" id="5599392">]</span><span class="op" id="5599393">)</span><span class="op" id="5599394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5599398">uint16</span><span class="op" id="5599404">(</span><span class="ident" id="5599405">p</span><span class="op" id="5599406">.</span><span class="ident" id="5599407">Pix</span><span class="op" id="5599410">[</span><span class="ident" id="5599411">i</span><span class="op" id="5599412">+</span><span class="num" id="5599413">2</span><span class="op" id="5599414">]</span><span class="op" id="5599415">)</span><span class="op" id="5599416">&lt;&lt;</span><span class="num" id="5599418">8</span>&nbsp;<span class="op" id="5599420">|</span>&nbsp;<span class="builtintype" id="5599422">uint16</span><span class="op" id="5599428">(</span><span class="ident" id="5599429">p</span><span class="op" id="5599430">.</span><span class="ident" id="5599431">Pix</span><span class="op" id="5599434">[</span><span class="ident" id="5599435">i</span><span class="op" id="5599436">+</span><span class="num" id="5599437">3</span><span class="op" id="5599438">]</span><span class="op" id="5599439">)</span><span class="op" id="5599440">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5599444">uint16</span><span class="op" id="5599450">(</span><span class="ident" id="5599451">p</span><span class="op" id="5599452">.</span><span class="ident" id="5599453">Pix</span><span class="op" id="5599456">[</span><span class="ident" id="5599457">i</span><span class="op" id="5599458">+</span><span class="num" id="5599459">4</span><span class="op" id="5599460">]</span><span class="op" id="5599461">)</span><span class="op" id="5599462">&lt;&lt;</span><span class="num" id="5599464">8</span>&nbsp;<span class="op" id="5599466">|</span>&nbsp;<span class="builtintype" id="5599468">uint16</span><span class="op" id="5599474">(</span><span class="ident" id="5599475">p</span><span class="op" id="5599476">.</span><span class="ident" id="5599477">Pix</span><span class="op" id="5599480">[</span><span class="ident" id="5599481">i</span><span class="op" id="5599482">+</span><span class="num" id="5599483">5</span><span class="op" id="5599484">]</span><span class="op" id="5599485">)</span><span class="op" id="5599486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5599490">uint16</span><span class="op" id="5599496">(</span><span class="ident" id="5599497">p</span><span class="op" id="5599498">.</span><span class="ident" id="5599499">Pix</span><span class="op" id="5599502">[</span><span class="ident" id="5599503">i</span><span class="op" id="5599504">+</span><span class="num" id="5599505">6</span><span class="op" id="5599506">]</span><span class="op" id="5599507">)</span><span class="op" id="5599508">&lt;&lt;</span><span class="num" id="5599510">8</span>&nbsp;<span class="op" id="5599512">|</span>&nbsp;<span class="builtintype" id="5599514">uint16</span><span class="op" id="5599520">(</span><span class="ident" id="5599521">p</span><span class="op" id="5599522">.</span><span class="ident" id="5599523">Pix</span><span class="op" id="5599526">[</span><span class="ident" id="5599527">i</span><span class="op" id="5599528">+</span><span class="num" id="5599529">7</span><span class="op" id="5599530">]</span><span class="op" id="5599531">)</span><span class="op" id="5599532">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5599535">}</span><br>
<span class="lineno"></span><span class="op" id="5599537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="5599540">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5599619">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5599643">func</span>&nbsp;<span class="op" id="5599648">(</span><span class="ident" id="5599649">p</span>&nbsp;<span class="op" id="5599651">*</span><span class="ident" id="5599652">RGBA64</span><span class="op" id="5599658">)</span>&nbsp;<span class="ident" id="5599660">PixOffset</span><span class="op" id="5599669">(</span><span class="ident" id="5599670">x</span><span class="op" id="5599671">,</span>&nbsp;<span class="ident" id="5599673">y</span>&nbsp;<span class="builtintype" id="5599675">int</span><span class="op" id="5599678">)</span>&nbsp;<span class="builtintype" id="5599680">int</span>&nbsp;<span class="op" id="5599684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599687">return</span>&nbsp;<span class="op" id="5599694">(</span><span class="ident" id="5599695">y</span><span class="op" id="5599696">-</span><span class="ident" id="5599697">p</span><span class="op" id="5599698">.</span><span class="ident" id="5599699">Rect</span><span class="op" id="5599703">.</span><span class="ident" id="5599704">Min</span><span class="op" id="5599707">.</span><span class="ident" id="5599708">Y</span><span class="op" id="5599709">)</span><span class="op" id="5599710">*</span><span class="ident" id="5599711">p</span><span class="op" id="5599712">.</span><span class="ident" id="5599713">Stride</span>&nbsp;<span class="op" id="5599720">+</span>&nbsp;<span class="op" id="5599722">(</span><span class="ident" id="5599723">x</span><span class="op" id="5599724">-</span><span class="ident" id="5599725">p</span><span class="op" id="5599726">.</span><span class="ident" id="5599727">Rect</span><span class="op" id="5599731">.</span><span class="ident" id="5599732">Min</span><span class="op" id="5599735">.</span><span class="ident" id="5599736">X</span><span class="op" id="5599737">)</span><span class="op" id="5599738">*</span><span class="num" id="5599739">8</span><br>
<span class="lineno"></span><span class="op" id="5599741">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="5599744">func</span>&nbsp;<span class="op" id="5599749">(</span><span class="ident" id="5599750">p</span>&nbsp;<span class="op" id="5599752">*</span><span class="ident" id="5599753">RGBA64</span><span class="op" id="5599759">)</span>&nbsp;<span class="ident" id="5599761">Set</span><span class="op" id="5599764">(</span><span class="ident" id="5599765">x</span><span class="op" id="5599766">,</span>&nbsp;<span class="ident" id="5599768">y</span>&nbsp;<span class="builtintype" id="5599770">int</span><span class="op" id="5599773">,</span>&nbsp;<span class="ident" id="5599775">c</span>&nbsp;<span class="ident" id="5599777">color</span><span class="op" id="5599782">.</span><span class="ident" id="5599783">Color</span><span class="op" id="5599788">)</span>&nbsp;<span class="op" id="5599790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599793">if</span>&nbsp;<span class="op" id="5599796">!</span><span class="op" id="5599797">(</span><span class="ident" id="5599798">Point</span><span class="op" id="5599803">{</span><span class="ident" id="5599804">x</span><span class="op" id="5599805">,</span>&nbsp;<span class="ident" id="5599807">y</span><span class="op" id="5599808">}</span><span class="op" id="5599809">.</span><span class="ident" id="5599810">In</span><span class="op" id="5599812">(</span><span class="ident" id="5599813">p</span><span class="op" id="5599814">.</span><span class="ident" id="5599815">Rect</span><span class="op" id="5599819">)</span><span class="op" id="5599820">)</span>&nbsp;<span class="op" id="5599822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599826">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5599834">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599837">i</span>&nbsp;<span class="op" id="5599839">:=</span>&nbsp;<span class="ident" id="5599842">p</span><span class="op" id="5599843">.</span><span class="ident" id="5599844">PixOffset</span><span class="op" id="5599853">(</span><span class="ident" id="5599854">x</span><span class="op" id="5599855">,</span>&nbsp;<span class="ident" id="5599857">y</span><span class="op" id="5599858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599861">c1</span>&nbsp;<span class="op" id="5599864">:=</span>&nbsp;<span class="ident" id="5599867">color</span><span class="op" id="5599872">.</span><span class="ident" id="5599873">RGBA64Model</span><span class="op" id="5599884">.</span><span class="ident" id="5599885">Convert</span><span class="op" id="5599892">(</span><span class="ident" id="5599893">c</span><span class="op" id="5599894">)</span><span class="op" id="5599895">.</span><span class="op" id="5599896">(</span><span class="ident" id="5599897">color</span><span class="op" id="5599902">.</span><span class="ident" id="5599903">RGBA64</span><span class="op" id="5599909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599912">p</span><span class="op" id="5599913">.</span><span class="ident" id="5599914">Pix</span><span class="op" id="5599917">[</span><span class="ident" id="5599918">i</span><span class="op" id="5599919">+</span><span class="num" id="5599920">0</span><span class="op" id="5599921">]</span>&nbsp;<span class="op" id="5599923">=</span>&nbsp;<span class="builtintype" id="5599925">uint8</span><span class="op" id="5599930">(</span><span class="ident" id="5599931">c1</span><span class="op" id="5599933">.</span><span class="ident" id="5599934">R</span>&nbsp;<span class="op" id="5599936">&gt;&gt;</span>&nbsp;<span class="num" id="5599939">8</span><span class="op" id="5599940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599943">p</span><span class="op" id="5599944">.</span><span class="ident" id="5599945">Pix</span><span class="op" id="5599948">[</span><span class="ident" id="5599949">i</span><span class="op" id="5599950">+</span><span class="num" id="5599951">1</span><span class="op" id="5599952">]</span>&nbsp;<span class="op" id="5599954">=</span>&nbsp;<span class="builtintype" id="5599956">uint8</span><span class="op" id="5599961">(</span><span class="ident" id="5599962">c1</span><span class="op" id="5599964">.</span><span class="ident" id="5599965">R</span><span class="op" id="5599966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599969">p</span><span class="op" id="5599970">.</span><span class="ident" id="5599971">Pix</span><span class="op" id="5599974">[</span><span class="ident" id="5599975">i</span><span class="op" id="5599976">+</span><span class="num" id="5599977">2</span><span class="op" id="5599978">]</span>&nbsp;<span class="op" id="5599980">=</span>&nbsp;<span class="builtintype" id="5599982">uint8</span><span class="op" id="5599987">(</span><span class="ident" id="5599988">c1</span><span class="op" id="5599990">.</span><span class="ident" id="5599991">G</span>&nbsp;<span class="op" id="5599993">&gt;&gt;</span>&nbsp;<span class="num" id="5599996">8</span><span class="op" id="5599997">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600000">p</span><span class="op" id="5600001">.</span><span class="ident" id="5600002">Pix</span><span class="op" id="5600005">[</span><span class="ident" id="5600006">i</span><span class="op" id="5600007">+</span><span class="num" id="5600008">3</span><span class="op" id="5600009">]</span>&nbsp;<span class="op" id="5600011">=</span>&nbsp;<span class="builtintype" id="5600013">uint8</span><span class="op" id="5600018">(</span><span class="ident" id="5600019">c1</span><span class="op" id="5600021">.</span><span class="ident" id="5600022">G</span><span class="op" id="5600023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600026">p</span><span class="op" id="5600027">.</span><span class="ident" id="5600028">Pix</span><span class="op" id="5600031">[</span><span class="ident" id="5600032">i</span><span class="op" id="5600033">+</span><span class="num" id="5600034">4</span><span class="op" id="5600035">]</span>&nbsp;<span class="op" id="5600037">=</span>&nbsp;<span class="builtintype" id="5600039">uint8</span><span class="op" id="5600044">(</span><span class="ident" id="5600045">c1</span><span class="op" id="5600047">.</span><span class="ident" id="5600048">B</span>&nbsp;<span class="op" id="5600050">&gt;&gt;</span>&nbsp;<span class="num" id="5600053">8</span><span class="op" id="5600054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600057">p</span><span class="op" id="5600058">.</span><span class="ident" id="5600059">Pix</span><span class="op" id="5600062">[</span><span class="ident" id="5600063">i</span><span class="op" id="5600064">+</span><span class="num" id="5600065">5</span><span class="op" id="5600066">]</span>&nbsp;<span class="op" id="5600068">=</span>&nbsp;<span class="builtintype" id="5600070">uint8</span><span class="op" id="5600075">(</span><span class="ident" id="5600076">c1</span><span class="op" id="5600078">.</span><span class="ident" id="5600079">B</span><span class="op" id="5600080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600083">p</span><span class="op" id="5600084">.</span><span class="ident" id="5600085">Pix</span><span class="op" id="5600088">[</span><span class="ident" id="5600089">i</span><span class="op" id="5600090">+</span><span class="num" id="5600091">6</span><span class="op" id="5600092">]</span>&nbsp;<span class="op" id="5600094">=</span>&nbsp;<span class="builtintype" id="5600096">uint8</span><span class="op" id="5600101">(</span><span class="ident" id="5600102">c1</span><span class="op" id="5600104">.</span><span class="ident" id="5600105">A</span>&nbsp;<span class="op" id="5600107">&gt;&gt;</span>&nbsp;<span class="num" id="5600110">8</span><span class="op" id="5600111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600114">p</span><span class="op" id="5600115">.</span><span class="ident" id="5600116">Pix</span><span class="op" id="5600119">[</span><span class="ident" id="5600120">i</span><span class="op" id="5600121">+</span><span class="num" id="5600122">7</span><span class="op" id="5600123">]</span>&nbsp;<span class="op" id="5600125">=</span>&nbsp;<span class="builtintype" id="5600127">uint8</span><span class="op" id="5600132">(</span><span class="ident" id="5600133">c1</span><span class="op" id="5600135">.</span><span class="ident" id="5600136">A</span><span class="op" id="5600137">)</span><br>
<span class="lineno">210</span><span class="op" id="5600139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5600142">func</span>&nbsp;<span class="op" id="5600147">(</span><span class="ident" id="5600148">p</span>&nbsp;<span class="op" id="5600150">*</span><span class="ident" id="5600151">RGBA64</span><span class="op" id="5600157">)</span>&nbsp;<span class="ident" id="5600159">SetRGBA64</span><span class="op" id="5600168">(</span><span class="ident" id="5600169">x</span><span class="op" id="5600170">,</span>&nbsp;<span class="ident" id="5600172">y</span>&nbsp;<span class="builtintype" id="5600174">int</span><span class="op" id="5600177">,</span>&nbsp;<span class="ident" id="5600179">c</span>&nbsp;<span class="ident" id="5600181">color</span><span class="op" id="5600186">.</span><span class="ident" id="5600187">RGBA64</span><span class="op" id="5600193">)</span>&nbsp;<span class="op" id="5600195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600198">if</span>&nbsp;<span class="op" id="5600201">!</span><span class="op" id="5600202">(</span><span class="ident" id="5600203">Point</span><span class="op" id="5600208">{</span><span class="ident" id="5600209">x</span><span class="op" id="5600210">,</span>&nbsp;<span class="ident" id="5600212">y</span><span class="op" id="5600213">}</span><span class="op" id="5600214">.</span><span class="ident" id="5600215">In</span><span class="op" id="5600217">(</span><span class="ident" id="5600218">p</span><span class="op" id="5600219">.</span><span class="ident" id="5600220">Rect</span><span class="op" id="5600224">)</span><span class="op" id="5600225">)</span>&nbsp;<span class="op" id="5600227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600231">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5600239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600242">i</span>&nbsp;<span class="op" id="5600244">:=</span>&nbsp;<span class="ident" id="5600247">p</span><span class="op" id="5600248">.</span><span class="ident" id="5600249">PixOffset</span><span class="op" id="5600258">(</span><span class="ident" id="5600259">x</span><span class="op" id="5600260">,</span>&nbsp;<span class="ident" id="5600262">y</span><span class="op" id="5600263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600266">p</span><span class="op" id="5600267">.</span><span class="ident" id="5600268">Pix</span><span class="op" id="5600271">[</span><span class="ident" id="5600272">i</span><span class="op" id="5600273">+</span><span class="num" id="5600274">0</span><span class="op" id="5600275">]</span>&nbsp;<span class="op" id="5600277">=</span>&nbsp;<span class="builtintype" id="5600279">uint8</span><span class="op" id="5600284">(</span><span class="ident" id="5600285">c</span><span class="op" id="5600286">.</span><span class="ident" id="5600287">R</span>&nbsp;<span class="op" id="5600289">&gt;&gt;</span>&nbsp;<span class="num" id="5600292">8</span><span class="op" id="5600293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600296">p</span><span class="op" id="5600297">.</span><span class="ident" id="5600298">Pix</span><span class="op" id="5600301">[</span><span class="ident" id="5600302">i</span><span class="op" id="5600303">+</span><span class="num" id="5600304">1</span><span class="op" id="5600305">]</span>&nbsp;<span class="op" id="5600307">=</span>&nbsp;<span class="builtintype" id="5600309">uint8</span><span class="op" id="5600314">(</span><span class="ident" id="5600315">c</span><span class="op" id="5600316">.</span><span class="ident" id="5600317">R</span><span class="op" id="5600318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600321">p</span><span class="op" id="5600322">.</span><span class="ident" id="5600323">Pix</span><span class="op" id="5600326">[</span><span class="ident" id="5600327">i</span><span class="op" id="5600328">+</span><span class="num" id="5600329">2</span><span class="op" id="5600330">]</span>&nbsp;<span class="op" id="5600332">=</span>&nbsp;<span class="builtintype" id="5600334">uint8</span><span class="op" id="5600339">(</span><span class="ident" id="5600340">c</span><span class="op" id="5600341">.</span><span class="ident" id="5600342">G</span>&nbsp;<span class="op" id="5600344">&gt;&gt;</span>&nbsp;<span class="num" id="5600347">8</span><span class="op" id="5600348">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600351">p</span><span class="op" id="5600352">.</span><span class="ident" id="5600353">Pix</span><span class="op" id="5600356">[</span><span class="ident" id="5600357">i</span><span class="op" id="5600358">+</span><span class="num" id="5600359">3</span><span class="op" id="5600360">]</span>&nbsp;<span class="op" id="5600362">=</span>&nbsp;<span class="builtintype" id="5600364">uint8</span><span class="op" id="5600369">(</span><span class="ident" id="5600370">c</span><span class="op" id="5600371">.</span><span class="ident" id="5600372">G</span><span class="op" id="5600373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600376">p</span><span class="op" id="5600377">.</span><span class="ident" id="5600378">Pix</span><span class="op" id="5600381">[</span><span class="ident" id="5600382">i</span><span class="op" id="5600383">+</span><span class="num" id="5600384">4</span><span class="op" id="5600385">]</span>&nbsp;<span class="op" id="5600387">=</span>&nbsp;<span class="builtintype" id="5600389">uint8</span><span class="op" id="5600394">(</span><span class="ident" id="5600395">c</span><span class="op" id="5600396">.</span><span class="ident" id="5600397">B</span>&nbsp;<span class="op" id="5600399">&gt;&gt;</span>&nbsp;<span class="num" id="5600402">8</span><span class="op" id="5600403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600406">p</span><span class="op" id="5600407">.</span><span class="ident" id="5600408">Pix</span><span class="op" id="5600411">[</span><span class="ident" id="5600412">i</span><span class="op" id="5600413">+</span><span class="num" id="5600414">5</span><span class="op" id="5600415">]</span>&nbsp;<span class="op" id="5600417">=</span>&nbsp;<span class="builtintype" id="5600419">uint8</span><span class="op" id="5600424">(</span><span class="ident" id="5600425">c</span><span class="op" id="5600426">.</span><span class="ident" id="5600427">B</span><span class="op" id="5600428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600431">p</span><span class="op" id="5600432">.</span><span class="ident" id="5600433">Pix</span><span class="op" id="5600436">[</span><span class="ident" id="5600437">i</span><span class="op" id="5600438">+</span><span class="num" id="5600439">6</span><span class="op" id="5600440">]</span>&nbsp;<span class="op" id="5600442">=</span>&nbsp;<span class="builtintype" id="5600444">uint8</span><span class="op" id="5600449">(</span><span class="ident" id="5600450">c</span><span class="op" id="5600451">.</span><span class="ident" id="5600452">A</span>&nbsp;<span class="op" id="5600454">&gt;&gt;</span>&nbsp;<span class="num" id="5600457">8</span><span class="op" id="5600458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600461">p</span><span class="op" id="5600462">.</span><span class="ident" id="5600463">Pix</span><span class="op" id="5600466">[</span><span class="ident" id="5600467">i</span><span class="op" id="5600468">+</span><span class="num" id="5600469">7</span><span class="op" id="5600470">]</span>&nbsp;<span class="op" id="5600472">=</span>&nbsp;<span class="builtintype" id="5600474">uint8</span><span class="op" id="5600479">(</span><span class="ident" id="5600480">c</span><span class="op" id="5600481">.</span><span class="ident" id="5600482">A</span><span class="op" id="5600483">)</span><br>
<span class="lineno">225</span><span class="op" id="5600485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5600488">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5600565">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5600637">func</span>&nbsp;<span class="op" id="5600642">(</span><span class="ident" id="5600643">p</span>&nbsp;<span class="op" id="5600645">*</span><span class="ident" id="5600646">RGBA64</span><span class="op" id="5600652">)</span>&nbsp;<span class="ident" id="5600654">SubImage</span><span class="op" id="5600662">(</span><span class="ident" id="5600663">r</span>&nbsp;<span class="ident" id="5600665">Rectangle</span><span class="op" id="5600674">)</span>&nbsp;<span class="ident" id="5600676">Image</span>&nbsp;<span class="op" id="5600682">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600685">r</span>&nbsp;<span class="op" id="5600687">=</span>&nbsp;<span class="ident" id="5600689">r</span><span class="op" id="5600690">.</span><span class="ident" id="5600691">Intersect</span><span class="op" id="5600700">(</span><span class="ident" id="5600701">p</span><span class="op" id="5600702">.</span><span class="ident" id="5600703">Rect</span><span class="op" id="5600707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5600710">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5600791">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5600873">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600923">if</span>&nbsp;<span class="ident" id="5600926">r</span><span class="op" id="5600927">.</span><span class="ident" id="5600928">Empty</span><span class="op" id="5600933">(</span><span class="op" id="5600934">)</span>&nbsp;<span class="op" id="5600936">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600940">return</span>&nbsp;<span class="op" id="5600947">&amp;</span><span class="ident" id="5600948">RGBA64</span><span class="op" id="5600954">{</span><span class="op" id="5600955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5600958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600961">i</span>&nbsp;<span class="op" id="5600963">:=</span>&nbsp;<span class="ident" id="5600966">p</span><span class="op" id="5600967">.</span><span class="ident" id="5600968">PixOffset</span><span class="op" id="5600977">(</span><span class="ident" id="5600978">r</span><span class="op" id="5600979">.</span><span class="ident" id="5600980">Min</span><span class="op" id="5600983">.</span><span class="ident" id="5600984">X</span><span class="op" id="5600985">,</span>&nbsp;<span class="ident" id="5600987">r</span><span class="op" id="5600988">.</span><span class="ident" id="5600989">Min</span><span class="op" id="5600992">.</span><span class="ident" id="5600993">Y</span><span class="op" id="5600994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600997">return</span>&nbsp;<span class="op" id="5601004">&amp;</span><span class="ident" id="5601005">RGBA64</span><span class="op" id="5601011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601015">Pix</span><span class="op" id="5601018">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5601023">p</span><span class="op" id="5601024">.</span><span class="ident" id="5601025">Pix</span><span class="op" id="5601028">[</span><span class="ident" id="5601029">i</span><span class="op" id="5601030">:</span><span class="op" id="5601031">]</span><span class="op" id="5601032">,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601036">Stride</span><span class="op" id="5601042">:</span>&nbsp;<span class="ident" id="5601044">p</span><span class="op" id="5601045">.</span><span class="ident" id="5601046">Stride</span><span class="op" id="5601052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601056">Rect</span><span class="op" id="5601060">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5601064">r</span><span class="op" id="5601065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601068">}</span><br>
<span class="lineno"></span><span class="op" id="5601070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="5601073">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5601146">func</span>&nbsp;<span class="op" id="5601151">(</span><span class="ident" id="5601152">p</span>&nbsp;<span class="op" id="5601154">*</span><span class="ident" id="5601155">RGBA64</span><span class="op" id="5601161">)</span>&nbsp;<span class="ident" id="5601163">Opaque</span><span class="op" id="5601169">(</span><span class="op" id="5601170">)</span>&nbsp;<span class="builtintype" id="5601172">bool</span>&nbsp;<span class="op" id="5601177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601180">if</span>&nbsp;<span class="ident" id="5601183">p</span><span class="op" id="5601184">.</span><span class="ident" id="5601185">Rect</span><span class="op" id="5601189">.</span><span class="ident" id="5601190">Empty</span><span class="op" id="5601195">(</span><span class="op" id="5601196">)</span>&nbsp;<span class="op" id="5601198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601202">return</span>&nbsp;<span class="builtintype" id="5601209">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601215">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601218">i0</span><span class="op" id="5601220">,</span>&nbsp;<span class="ident" id="5601222">i1</span>&nbsp;<span class="op" id="5601225">:=</span>&nbsp;<span class="num" id="5601228">6</span><span class="op" id="5601229">,</span>&nbsp;<span class="ident" id="5601231">p</span><span class="op" id="5601232">.</span><span class="ident" id="5601233">Rect</span><span class="op" id="5601237">.</span><span class="ident" id="5601238">Dx</span><span class="op" id="5601240">(</span><span class="op" id="5601241">)</span><span class="op" id="5601242">*</span><span class="num" id="5601243">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601246">for</span>&nbsp;<span class="ident" id="5601250">y</span>&nbsp;<span class="op" id="5601252">:=</span>&nbsp;<span class="ident" id="5601255">p</span><span class="op" id="5601256">.</span><span class="ident" id="5601257">Rect</span><span class="op" id="5601261">.</span><span class="ident" id="5601262">Min</span><span class="op" id="5601265">.</span><span class="ident" id="5601266">Y</span><span class="op" id="5601267">;</span>&nbsp;<span class="ident" id="5601269">y</span>&nbsp;<span class="op" id="5601271">&lt;</span>&nbsp;<span class="ident" id="5601273">p</span><span class="op" id="5601274">.</span><span class="ident" id="5601275">Rect</span><span class="op" id="5601279">.</span><span class="ident" id="5601280">Max</span><span class="op" id="5601283">.</span><span class="ident" id="5601284">Y</span><span class="op" id="5601285">;</span>&nbsp;<span class="ident" id="5601287">y</span><span class="op" id="5601288">++</span>&nbsp;<span class="op" id="5601291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601295">for</span>&nbsp;<span class="ident" id="5601299">i</span>&nbsp;<span class="op" id="5601301">:=</span>&nbsp;<span class="ident" id="5601304">i0</span><span class="op" id="5601306">;</span>&nbsp;<span class="ident" id="5601308">i</span>&nbsp;<span class="op" id="5601310">&lt;</span>&nbsp;<span class="ident" id="5601312">i1</span><span class="op" id="5601314">;</span>&nbsp;<span class="ident" id="5601316">i</span>&nbsp;<span class="op" id="5601318">+=</span>&nbsp;<span class="num" id="5601321">8</span>&nbsp;<span class="op" id="5601323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601328">if</span>&nbsp;<span class="ident" id="5601331">p</span><span class="op" id="5601332">.</span><span class="ident" id="5601333">Pix</span><span class="op" id="5601336">[</span><span class="ident" id="5601337">i</span><span class="op" id="5601338">+</span><span class="num" id="5601339">0</span><span class="op" id="5601340">]</span>&nbsp;<span class="op" id="5601342">!=</span>&nbsp;<span class="num" id="5601345">0xff</span>&nbsp;<span class="op" id="5601350">||</span>&nbsp;<span class="ident" id="5601353">p</span><span class="op" id="5601354">.</span><span class="ident" id="5601355">Pix</span><span class="op" id="5601358">[</span><span class="ident" id="5601359">i</span><span class="op" id="5601360">+</span><span class="num" id="5601361">1</span><span class="op" id="5601362">]</span>&nbsp;<span class="op" id="5601364">!=</span>&nbsp;<span class="num" id="5601367">0xff</span>&nbsp;<span class="op" id="5601372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601378">return</span>&nbsp;<span class="builtintype" id="5601385">false</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601402">i0</span>&nbsp;<span class="op" id="5601405">+=</span>&nbsp;<span class="ident" id="5601408">p</span><span class="op" id="5601409">.</span><span class="ident" id="5601410">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601419">i1</span>&nbsp;<span class="op" id="5601422">+=</span>&nbsp;<span class="ident" id="5601425">p</span><span class="op" id="5601426">.</span><span class="ident" id="5601427">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601435">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601438">return</span>&nbsp;<span class="builtintype" id="5601445">true</span><br>
<span class="lineno"></span><span class="op" id="5601450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5601453">//&nbsp;NewRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5601510">func</span>&nbsp;<span class="ident" id="5601515">NewRGBA64</span><span class="op" id="5601524">(</span><span class="ident" id="5601525">r</span>&nbsp;<span class="ident" id="5601527">Rectangle</span><span class="op" id="5601536">)</span>&nbsp;<span class="op" id="5601538">*</span><span class="ident" id="5601539">RGBA64</span>&nbsp;<span class="op" id="5601546">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601549">w</span><span class="op" id="5601550">,</span>&nbsp;<span class="ident" id="5601552">h</span>&nbsp;<span class="op" id="5601554">:=</span>&nbsp;<span class="ident" id="5601557">r</span><span class="op" id="5601558">.</span><span class="ident" id="5601559">Dx</span><span class="op" id="5601561">(</span><span class="op" id="5601562">)</span><span class="op" id="5601563">,</span>&nbsp;<span class="ident" id="5601565">r</span><span class="op" id="5601566">.</span><span class="ident" id="5601567">Dy</span><span class="op" id="5601569">(</span><span class="op" id="5601570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601573">pix</span>&nbsp;<span class="op" id="5601577">:=</span>&nbsp;<span class="builtinfunc" id="5601580">make</span><span class="op" id="5601584">(</span><span class="op" id="5601585">[</span><span class="op" id="5601586">]</span><span class="builtintype" id="5601587">uint8</span><span class="op" id="5601592">,</span>&nbsp;<span class="num" id="5601594">8</span><span class="op" id="5601595">*</span><span class="ident" id="5601596">w</span><span class="op" id="5601597">*</span><span class="ident" id="5601598">h</span><span class="op" id="5601599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601602">return</span>&nbsp;<span class="op" id="5601609">&amp;</span><span class="ident" id="5601610">RGBA64</span><span class="op" id="5601616">{</span><span class="ident" id="5601617">pix</span><span class="op" id="5601620">,</span>&nbsp;<span class="num" id="5601622">8</span>&nbsp;<span class="op" id="5601624">*</span>&nbsp;<span class="ident" id="5601626">w</span><span class="op" id="5601627">,</span>&nbsp;<span class="ident" id="5601629">r</span><span class="op" id="5601630">}</span><br>
<span class="lineno"></span><span class="op" id="5601632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5601635">//&nbsp;NRGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5601710">type</span>&nbsp;<span class="ident" id="5601715">NRGBA</span>&nbsp;<span class="keyword" id="5601721">struct</span>&nbsp;<span class="op" id="5601728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5601731">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5601799">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601867">Pix</span>&nbsp;<span class="op" id="5601871">[</span><span class="op" id="5601872">]</span><span class="builtintype" id="5601873">uint8</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5601880">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601956">Stride</span>&nbsp;<span class="builtintype" id="5601963">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5601968">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602000">Rect</span>&nbsp;<span class="ident" id="5602005">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5602015">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="5602018">func</span>&nbsp;<span class="op" id="5602023">(</span><span class="ident" id="5602024">p</span>&nbsp;<span class="op" id="5602026">*</span><span class="ident" id="5602027">NRGBA</span><span class="op" id="5602032">)</span>&nbsp;<span class="ident" id="5602034">ColorModel</span><span class="op" id="5602044">(</span><span class="op" id="5602045">)</span>&nbsp;<span class="ident" id="5602047">color</span><span class="op" id="5602052">.</span><span class="ident" id="5602053">Model</span>&nbsp;<span class="op" id="5602059">{</span>&nbsp;<span class="keyword" id="5602061">return</span>&nbsp;<span class="ident" id="5602068">color</span><span class="op" id="5602073">.</span><span class="ident" id="5602074">NRGBAModel</span>&nbsp;<span class="op" id="5602085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5602088">func</span>&nbsp;<span class="op" id="5602093">(</span><span class="ident" id="5602094">p</span>&nbsp;<span class="op" id="5602096">*</span><span class="ident" id="5602097">NRGBA</span><span class="op" id="5602102">)</span>&nbsp;<span class="ident" id="5602104">Bounds</span><span class="op" id="5602110">(</span><span class="op" id="5602111">)</span>&nbsp;<span class="ident" id="5602113">Rectangle</span>&nbsp;<span class="op" id="5602123">{</span>&nbsp;<span class="keyword" id="5602125">return</span>&nbsp;<span class="ident" id="5602132">p</span><span class="op" id="5602133">.</span><span class="ident" id="5602134">Rect</span>&nbsp;<span class="op" id="5602139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5602142">func</span>&nbsp;<span class="op" id="5602147">(</span><span class="ident" id="5602148">p</span>&nbsp;<span class="op" id="5602150">*</span><span class="ident" id="5602151">NRGBA</span><span class="op" id="5602156">)</span>&nbsp;<span class="ident" id="5602158">At</span><span class="op" id="5602160">(</span><span class="ident" id="5602161">x</span><span class="op" id="5602162">,</span>&nbsp;<span class="ident" id="5602164">y</span>&nbsp;<span class="builtintype" id="5602166">int</span><span class="op" id="5602169">)</span>&nbsp;<span class="ident" id="5602171">color</span><span class="op" id="5602176">.</span><span class="ident" id="5602177">Color</span>&nbsp;<span class="op" id="5602183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602186">return</span>&nbsp;<span class="ident" id="5602193">p</span><span class="op" id="5602194">.</span><span class="ident" id="5602195">NRGBAAt</span><span class="op" id="5602202">(</span><span class="ident" id="5602203">x</span><span class="op" id="5602204">,</span>&nbsp;<span class="ident" id="5602206">y</span><span class="op" id="5602207">)</span><br>
<span class="lineno"></span><span class="op" id="5602209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5602212">func</span>&nbsp;<span class="op" id="5602217">(</span><span class="ident" id="5602218">p</span>&nbsp;<span class="op" id="5602220">*</span><span class="ident" id="5602221">NRGBA</span><span class="op" id="5602226">)</span>&nbsp;<span class="ident" id="5602228">NRGBAAt</span><span class="op" id="5602235">(</span><span class="ident" id="5602236">x</span><span class="op" id="5602237">,</span>&nbsp;<span class="ident" id="5602239">y</span>&nbsp;<span class="builtintype" id="5602241">int</span><span class="op" id="5602244">)</span>&nbsp;<span class="ident" id="5602246">color</span><span class="op" id="5602251">.</span><span class="ident" id="5602252">NRGBA</span>&nbsp;<span class="op" id="5602258">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602261">if</span>&nbsp;<span class="op" id="5602264">!</span><span class="op" id="5602265">(</span><span class="ident" id="5602266">Point</span><span class="op" id="5602271">{</span><span class="ident" id="5602272">x</span><span class="op" id="5602273">,</span>&nbsp;<span class="ident" id="5602275">y</span><span class="op" id="5602276">}</span><span class="op" id="5602277">.</span><span class="ident" id="5602278">In</span><span class="op" id="5602280">(</span><span class="ident" id="5602281">p</span><span class="op" id="5602282">.</span><span class="ident" id="5602283">Rect</span><span class="op" id="5602287">)</span><span class="op" id="5602288">)</span>&nbsp;<span class="op" id="5602290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602294">return</span>&nbsp;<span class="ident" id="5602301">color</span><span class="op" id="5602306">.</span><span class="ident" id="5602307">NRGBA</span><span class="op" id="5602312">{</span><span class="op" id="5602313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5602316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602319">i</span>&nbsp;<span class="op" id="5602321">:=</span>&nbsp;<span class="ident" id="5602324">p</span><span class="op" id="5602325">.</span><span class="ident" id="5602326">PixOffset</span><span class="op" id="5602335">(</span><span class="ident" id="5602336">x</span><span class="op" id="5602337">,</span>&nbsp;<span class="ident" id="5602339">y</span><span class="op" id="5602340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602343">return</span>&nbsp;<span class="ident" id="5602350">color</span><span class="op" id="5602355">.</span><span class="ident" id="5602356">NRGBA</span><span class="op" id="5602361">{</span><span class="ident" id="5602362">p</span><span class="op" id="5602363">.</span><span class="ident" id="5602364">Pix</span><span class="op" id="5602367">[</span><span class="ident" id="5602368">i</span><span class="op" id="5602369">+</span><span class="num" id="5602370">0</span><span class="op" id="5602371">]</span><span class="op" id="5602372">,</span>&nbsp;<span class="ident" id="5602374">p</span><span class="op" id="5602375">.</span><span class="ident" id="5602376">Pix</span><span class="op" id="5602379">[</span><span class="ident" id="5602380">i</span><span class="op" id="5602381">+</span><span class="num" id="5602382">1</span><span class="op" id="5602383">]</span><span class="op" id="5602384">,</span>&nbsp;<span class="ident" id="5602386">p</span><span class="op" id="5602387">.</span><span class="ident" id="5602388">Pix</span><span class="op" id="5602391">[</span><span class="ident" id="5602392">i</span><span class="op" id="5602393">+</span><span class="num" id="5602394">2</span><span class="op" id="5602395">]</span><span class="op" id="5602396">,</span>&nbsp;<span class="ident" id="5602398">p</span><span class="op" id="5602399">.</span><span class="ident" id="5602400">Pix</span><span class="op" id="5602403">[</span><span class="ident" id="5602404">i</span><span class="op" id="5602405">+</span><span class="num" id="5602406">3</span><span class="op" id="5602407">]</span><span class="op" id="5602408">}</span><br>
<span class="lineno">295</span><span class="op" id="5602410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5602413">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5602492">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5602516">func</span>&nbsp;<span class="op" id="5602521">(</span><span class="ident" id="5602522">p</span>&nbsp;<span class="op" id="5602524">*</span><span class="ident" id="5602525">NRGBA</span><span class="op" id="5602530">)</span>&nbsp;<span class="ident" id="5602532">PixOffset</span><span class="op" id="5602541">(</span><span class="ident" id="5602542">x</span><span class="op" id="5602543">,</span>&nbsp;<span class="ident" id="5602545">y</span>&nbsp;<span class="builtintype" id="5602547">int</span><span class="op" id="5602550">)</span>&nbsp;<span class="builtintype" id="5602552">int</span>&nbsp;<span class="op" id="5602556">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602559">return</span>&nbsp;<span class="op" id="5602566">(</span><span class="ident" id="5602567">y</span><span class="op" id="5602568">-</span><span class="ident" id="5602569">p</span><span class="op" id="5602570">.</span><span class="ident" id="5602571">Rect</span><span class="op" id="5602575">.</span><span class="ident" id="5602576">Min</span><span class="op" id="5602579">.</span><span class="ident" id="5602580">Y</span><span class="op" id="5602581">)</span><span class="op" id="5602582">*</span><span class="ident" id="5602583">p</span><span class="op" id="5602584">.</span><span class="ident" id="5602585">Stride</span>&nbsp;<span class="op" id="5602592">+</span>&nbsp;<span class="op" id="5602594">(</span><span class="ident" id="5602595">x</span><span class="op" id="5602596">-</span><span class="ident" id="5602597">p</span><span class="op" id="5602598">.</span><span class="ident" id="5602599">Rect</span><span class="op" id="5602603">.</span><span class="ident" id="5602604">Min</span><span class="op" id="5602607">.</span><span class="ident" id="5602608">X</span><span class="op" id="5602609">)</span><span class="op" id="5602610">*</span><span class="num" id="5602611">4</span><br>
<span class="lineno"></span><span class="op" id="5602613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5602616">func</span>&nbsp;<span class="op" id="5602621">(</span><span class="ident" id="5602622">p</span>&nbsp;<span class="op" id="5602624">*</span><span class="ident" id="5602625">NRGBA</span><span class="op" id="5602630">)</span>&nbsp;<span class="ident" id="5602632">Set</span><span class="op" id="5602635">(</span><span class="ident" id="5602636">x</span><span class="op" id="5602637">,</span>&nbsp;<span class="ident" id="5602639">y</span>&nbsp;<span class="builtintype" id="5602641">int</span><span class="op" id="5602644">,</span>&nbsp;<span class="ident" id="5602646">c</span>&nbsp;<span class="ident" id="5602648">color</span><span class="op" id="5602653">.</span><span class="ident" id="5602654">Color</span><span class="op" id="5602659">)</span>&nbsp;<span class="op" id="5602661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602664">if</span>&nbsp;<span class="op" id="5602667">!</span><span class="op" id="5602668">(</span><span class="ident" id="5602669">Point</span><span class="op" id="5602674">{</span><span class="ident" id="5602675">x</span><span class="op" id="5602676">,</span>&nbsp;<span class="ident" id="5602678">y</span><span class="op" id="5602679">}</span><span class="op" id="5602680">.</span><span class="ident" id="5602681">In</span><span class="op" id="5602683">(</span><span class="ident" id="5602684">p</span><span class="op" id="5602685">.</span><span class="ident" id="5602686">Rect</span><span class="op" id="5602690">)</span><span class="op" id="5602691">)</span>&nbsp;<span class="op" id="5602693">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602697">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5602705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602708">i</span>&nbsp;<span class="op" id="5602710">:=</span>&nbsp;<span class="ident" id="5602713">p</span><span class="op" id="5602714">.</span><span class="ident" id="5602715">PixOffset</span><span class="op" id="5602724">(</span><span class="ident" id="5602725">x</span><span class="op" id="5602726">,</span>&nbsp;<span class="ident" id="5602728">y</span><span class="op" id="5602729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602732">c1</span>&nbsp;<span class="op" id="5602735">:=</span>&nbsp;<span class="ident" id="5602738">color</span><span class="op" id="5602743">.</span><span class="ident" id="5602744">NRGBAModel</span><span class="op" id="5602754">.</span><span class="ident" id="5602755">Convert</span><span class="op" id="5602762">(</span><span class="ident" id="5602763">c</span><span class="op" id="5602764">)</span><span class="op" id="5602765">.</span><span class="op" id="5602766">(</span><span class="ident" id="5602767">color</span><span class="op" id="5602772">.</span><span class="ident" id="5602773">NRGBA</span><span class="op" id="5602778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602781">p</span><span class="op" id="5602782">.</span><span class="ident" id="5602783">Pix</span><span class="op" id="5602786">[</span><span class="ident" id="5602787">i</span><span class="op" id="5602788">+</span><span class="num" id="5602789">0</span><span class="op" id="5602790">]</span>&nbsp;<span class="op" id="5602792">=</span>&nbsp;<span class="ident" id="5602794">c1</span><span class="op" id="5602796">.</span><span class="ident" id="5602797">R</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602800">p</span><span class="op" id="5602801">.</span><span class="ident" id="5602802">Pix</span><span class="op" id="5602805">[</span><span class="ident" id="5602806">i</span><span class="op" id="5602807">+</span><span class="num" id="5602808">1</span><span class="op" id="5602809">]</span>&nbsp;<span class="op" id="5602811">=</span>&nbsp;<span class="ident" id="5602813">c1</span><span class="op" id="5602815">.</span><span class="ident" id="5602816">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602819">p</span><span class="op" id="5602820">.</span><span class="ident" id="5602821">Pix</span><span class="op" id="5602824">[</span><span class="ident" id="5602825">i</span><span class="op" id="5602826">+</span><span class="num" id="5602827">2</span><span class="op" id="5602828">]</span>&nbsp;<span class="op" id="5602830">=</span>&nbsp;<span class="ident" id="5602832">c1</span><span class="op" id="5602834">.</span><span class="ident" id="5602835">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602838">p</span><span class="op" id="5602839">.</span><span class="ident" id="5602840">Pix</span><span class="op" id="5602843">[</span><span class="ident" id="5602844">i</span><span class="op" id="5602845">+</span><span class="num" id="5602846">3</span><span class="op" id="5602847">]</span>&nbsp;<span class="op" id="5602849">=</span>&nbsp;<span class="ident" id="5602851">c1</span><span class="op" id="5602853">.</span><span class="ident" id="5602854">A</span><br>
<span class="lineno"></span><span class="op" id="5602856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="5602859">func</span>&nbsp;<span class="op" id="5602864">(</span><span class="ident" id="5602865">p</span>&nbsp;<span class="op" id="5602867">*</span><span class="ident" id="5602868">NRGBA</span><span class="op" id="5602873">)</span>&nbsp;<span class="ident" id="5602875">SetNRGBA</span><span class="op" id="5602883">(</span><span class="ident" id="5602884">x</span><span class="op" id="5602885">,</span>&nbsp;<span class="ident" id="5602887">y</span>&nbsp;<span class="builtintype" id="5602889">int</span><span class="op" id="5602892">,</span>&nbsp;<span class="ident" id="5602894">c</span>&nbsp;<span class="ident" id="5602896">color</span><span class="op" id="5602901">.</span><span class="ident" id="5602902">NRGBA</span><span class="op" id="5602907">)</span>&nbsp;<span class="op" id="5602909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602912">if</span>&nbsp;<span class="op" id="5602915">!</span><span class="op" id="5602916">(</span><span class="ident" id="5602917">Point</span><span class="op" id="5602922">{</span><span class="ident" id="5602923">x</span><span class="op" id="5602924">,</span>&nbsp;<span class="ident" id="5602926">y</span><span class="op" id="5602927">}</span><span class="op" id="5602928">.</span><span class="ident" id="5602929">In</span><span class="op" id="5602931">(</span><span class="ident" id="5602932">p</span><span class="op" id="5602933">.</span><span class="ident" id="5602934">Rect</span><span class="op" id="5602938">)</span><span class="op" id="5602939">)</span>&nbsp;<span class="op" id="5602941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602945">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5602953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602956">i</span>&nbsp;<span class="op" id="5602958">:=</span>&nbsp;<span class="ident" id="5602961">p</span><span class="op" id="5602962">.</span><span class="ident" id="5602963">PixOffset</span><span class="op" id="5602972">(</span><span class="ident" id="5602973">x</span><span class="op" id="5602974">,</span>&nbsp;<span class="ident" id="5602976">y</span><span class="op" id="5602977">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602980">p</span><span class="op" id="5602981">.</span><span class="ident" id="5602982">Pix</span><span class="op" id="5602985">[</span><span class="ident" id="5602986">i</span><span class="op" id="5602987">+</span><span class="num" id="5602988">0</span><span class="op" id="5602989">]</span>&nbsp;<span class="op" id="5602991">=</span>&nbsp;<span class="ident" id="5602993">c</span><span class="op" id="5602994">.</span><span class="ident" id="5602995">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602998">p</span><span class="op" id="5602999">.</span><span class="ident" id="5603000">Pix</span><span class="op" id="5603003">[</span><span class="ident" id="5603004">i</span><span class="op" id="5603005">+</span><span class="num" id="5603006">1</span><span class="op" id="5603007">]</span>&nbsp;<span class="op" id="5603009">=</span>&nbsp;<span class="ident" id="5603011">c</span><span class="op" id="5603012">.</span><span class="ident" id="5603013">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603016">p</span><span class="op" id="5603017">.</span><span class="ident" id="5603018">Pix</span><span class="op" id="5603021">[</span><span class="ident" id="5603022">i</span><span class="op" id="5603023">+</span><span class="num" id="5603024">2</span><span class="op" id="5603025">]</span>&nbsp;<span class="op" id="5603027">=</span>&nbsp;<span class="ident" id="5603029">c</span><span class="op" id="5603030">.</span><span class="ident" id="5603031">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603034">p</span><span class="op" id="5603035">.</span><span class="ident" id="5603036">Pix</span><span class="op" id="5603039">[</span><span class="ident" id="5603040">i</span><span class="op" id="5603041">+</span><span class="num" id="5603042">3</span><span class="op" id="5603043">]</span>&nbsp;<span class="op" id="5603045">=</span>&nbsp;<span class="ident" id="5603047">c</span><span class="op" id="5603048">.</span><span class="ident" id="5603049">A</span><br>
<span class="lineno"></span><span class="op" id="5603051">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="5603054">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5603131">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5603203">func</span>&nbsp;<span class="op" id="5603208">(</span><span class="ident" id="5603209">p</span>&nbsp;<span class="op" id="5603211">*</span><span class="ident" id="5603212">NRGBA</span><span class="op" id="5603217">)</span>&nbsp;<span class="ident" id="5603219">SubImage</span><span class="op" id="5603227">(</span><span class="ident" id="5603228">r</span>&nbsp;<span class="ident" id="5603230">Rectangle</span><span class="op" id="5603239">)</span>&nbsp;<span class="ident" id="5603241">Image</span>&nbsp;<span class="op" id="5603247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603250">r</span>&nbsp;<span class="op" id="5603252">=</span>&nbsp;<span class="ident" id="5603254">r</span><span class="op" id="5603255">.</span><span class="ident" id="5603256">Intersect</span><span class="op" id="5603265">(</span><span class="ident" id="5603266">p</span><span class="op" id="5603267">.</span><span class="ident" id="5603268">Rect</span><span class="op" id="5603272">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5603275">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5603356">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5603438">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603488">if</span>&nbsp;<span class="ident" id="5603491">r</span><span class="op" id="5603492">.</span><span class="ident" id="5603493">Empty</span><span class="op" id="5603498">(</span><span class="op" id="5603499">)</span>&nbsp;<span class="op" id="5603501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603505">return</span>&nbsp;<span class="op" id="5603512">&amp;</span><span class="ident" id="5603513">NRGBA</span><span class="op" id="5603518">{</span><span class="op" id="5603519">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603525">i</span>&nbsp;<span class="op" id="5603527">:=</span>&nbsp;<span class="ident" id="5603530">p</span><span class="op" id="5603531">.</span><span class="ident" id="5603532">PixOffset</span><span class="op" id="5603541">(</span><span class="ident" id="5603542">r</span><span class="op" id="5603543">.</span><span class="ident" id="5603544">Min</span><span class="op" id="5603547">.</span><span class="ident" id="5603548">X</span><span class="op" id="5603549">,</span>&nbsp;<span class="ident" id="5603551">r</span><span class="op" id="5603552">.</span><span class="ident" id="5603553">Min</span><span class="op" id="5603556">.</span><span class="ident" id="5603557">Y</span><span class="op" id="5603558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603561">return</span>&nbsp;<span class="op" id="5603568">&amp;</span><span class="ident" id="5603569">NRGBA</span><span class="op" id="5603574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603578">Pix</span><span class="op" id="5603581">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5603586">p</span><span class="op" id="5603587">.</span><span class="ident" id="5603588">Pix</span><span class="op" id="5603591">[</span><span class="ident" id="5603592">i</span><span class="op" id="5603593">:</span><span class="op" id="5603594">]</span><span class="op" id="5603595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603599">Stride</span><span class="op" id="5603605">:</span>&nbsp;<span class="ident" id="5603607">p</span><span class="op" id="5603608">.</span><span class="ident" id="5603609">Stride</span><span class="op" id="5603615">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603619">Rect</span><span class="op" id="5603623">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5603627">r</span><span class="op" id="5603628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603631">}</span><br>
<span class="lineno"></span><span class="op" id="5603633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5603636">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno">345</span><span class="keyword" id="5603709">func</span>&nbsp;<span class="op" id="5603714">(</span><span class="ident" id="5603715">p</span>&nbsp;<span class="op" id="5603717">*</span><span class="ident" id="5603718">NRGBA</span><span class="op" id="5603723">)</span>&nbsp;<span class="ident" id="5603725">Opaque</span><span class="op" id="5603731">(</span><span class="op" id="5603732">)</span>&nbsp;<span class="builtintype" id="5603734">bool</span>&nbsp;<span class="op" id="5603739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603742">if</span>&nbsp;<span class="ident" id="5603745">p</span><span class="op" id="5603746">.</span><span class="ident" id="5603747">Rect</span><span class="op" id="5603751">.</span><span class="ident" id="5603752">Empty</span><span class="op" id="5603757">(</span><span class="op" id="5603758">)</span>&nbsp;<span class="op" id="5603760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603764">return</span>&nbsp;<span class="builtintype" id="5603771">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603780">i0</span><span class="op" id="5603782">,</span>&nbsp;<span class="ident" id="5603784">i1</span>&nbsp;<span class="op" id="5603787">:=</span>&nbsp;<span class="num" id="5603790">3</span><span class="op" id="5603791">,</span>&nbsp;<span class="ident" id="5603793">p</span><span class="op" id="5603794">.</span><span class="ident" id="5603795">Rect</span><span class="op" id="5603799">.</span><span class="ident" id="5603800">Dx</span><span class="op" id="5603802">(</span><span class="op" id="5603803">)</span><span class="op" id="5603804">*</span><span class="num" id="5603805">4</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603808">for</span>&nbsp;<span class="ident" id="5603812">y</span>&nbsp;<span class="op" id="5603814">:=</span>&nbsp;<span class="ident" id="5603817">p</span><span class="op" id="5603818">.</span><span class="ident" id="5603819">Rect</span><span class="op" id="5603823">.</span><span class="ident" id="5603824">Min</span><span class="op" id="5603827">.</span><span class="ident" id="5603828">Y</span><span class="op" id="5603829">;</span>&nbsp;<span class="ident" id="5603831">y</span>&nbsp;<span class="op" id="5603833">&lt;</span>&nbsp;<span class="ident" id="5603835">p</span><span class="op" id="5603836">.</span><span class="ident" id="5603837">Rect</span><span class="op" id="5603841">.</span><span class="ident" id="5603842">Max</span><span class="op" id="5603845">.</span><span class="ident" id="5603846">Y</span><span class="op" id="5603847">;</span>&nbsp;<span class="ident" id="5603849">y</span><span class="op" id="5603850">++</span>&nbsp;<span class="op" id="5603853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603857">for</span>&nbsp;<span class="ident" id="5603861">i</span>&nbsp;<span class="op" id="5603863">:=</span>&nbsp;<span class="ident" id="5603866">i0</span><span class="op" id="5603868">;</span>&nbsp;<span class="ident" id="5603870">i</span>&nbsp;<span class="op" id="5603872">&lt;</span>&nbsp;<span class="ident" id="5603874">i1</span><span class="op" id="5603876">;</span>&nbsp;<span class="ident" id="5603878">i</span>&nbsp;<span class="op" id="5603880">+=</span>&nbsp;<span class="num" id="5603883">4</span>&nbsp;<span class="op" id="5603885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603890">if</span>&nbsp;<span class="ident" id="5603893">p</span><span class="op" id="5603894">.</span><span class="ident" id="5603895">Pix</span><span class="op" id="5603898">[</span><span class="ident" id="5603899">i</span><span class="op" id="5603900">]</span>&nbsp;<span class="op" id="5603902">!=</span>&nbsp;<span class="num" id="5603905">0xff</span>&nbsp;<span class="op" id="5603910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603916">return</span>&nbsp;<span class="builtintype" id="5603923">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603932">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603940">i0</span>&nbsp;<span class="op" id="5603943">+=</span>&nbsp;<span class="ident" id="5603946">p</span><span class="op" id="5603947">.</span><span class="ident" id="5603948">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603957">i1</span>&nbsp;<span class="op" id="5603960">+=</span>&nbsp;<span class="ident" id="5603963">p</span><span class="op" id="5603964">.</span><span class="ident" id="5603965">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603976">return</span>&nbsp;<span class="builtintype" id="5603983">true</span><br>
<span class="lineno">360</span><span class="op" id="5603988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5603991">//&nbsp;NewNRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5604046">func</span>&nbsp;<span class="ident" id="5604051">NewNRGBA</span><span class="op" id="5604059">(</span><span class="ident" id="5604060">r</span>&nbsp;<span class="ident" id="5604062">Rectangle</span><span class="op" id="5604071">)</span>&nbsp;<span class="op" id="5604073">*</span><span class="ident" id="5604074">NRGBA</span>&nbsp;<span class="op" id="5604080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604083">w</span><span class="op" id="5604084">,</span>&nbsp;<span class="ident" id="5604086">h</span>&nbsp;<span class="op" id="5604088">:=</span>&nbsp;<span class="ident" id="5604091">r</span><span class="op" id="5604092">.</span><span class="ident" id="5604093">Dx</span><span class="op" id="5604095">(</span><span class="op" id="5604096">)</span><span class="op" id="5604097">,</span>&nbsp;<span class="ident" id="5604099">r</span><span class="op" id="5604100">.</span><span class="ident" id="5604101">Dy</span><span class="op" id="5604103">(</span><span class="op" id="5604104">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604107">pix</span>&nbsp;<span class="op" id="5604111">:=</span>&nbsp;<span class="builtinfunc" id="5604114">make</span><span class="op" id="5604118">(</span><span class="op" id="5604119">[</span><span class="op" id="5604120">]</span><span class="builtintype" id="5604121">uint8</span><span class="op" id="5604126">,</span>&nbsp;<span class="num" id="5604128">4</span><span class="op" id="5604129">*</span><span class="ident" id="5604130">w</span><span class="op" id="5604131">*</span><span class="ident" id="5604132">h</span><span class="op" id="5604133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604136">return</span>&nbsp;<span class="op" id="5604143">&amp;</span><span class="ident" id="5604144">NRGBA</span><span class="op" id="5604149">{</span><span class="ident" id="5604150">pix</span><span class="op" id="5604153">,</span>&nbsp;<span class="num" id="5604155">4</span>&nbsp;<span class="op" id="5604157">*</span>&nbsp;<span class="ident" id="5604159">w</span><span class="op" id="5604160">,</span>&nbsp;<span class="ident" id="5604162">r</span><span class="op" id="5604163">}</span><br>
<span class="lineno"></span><span class="op" id="5604165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5604168">//&nbsp;NRGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA64&nbsp;values.</span><br>
<span class="lineno">370</span><span class="keyword" id="5604247">type</span>&nbsp;<span class="ident" id="5604252">NRGBA64</span>&nbsp;<span class="keyword" id="5604260">struct</span>&nbsp;<span class="op" id="5604267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5604270">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5604360">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604428">Pix</span>&nbsp;<span class="op" id="5604432">[</span><span class="op" id="5604433">]</span><span class="builtintype" id="5604434">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5604441">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604517">Stride</span>&nbsp;<span class="builtintype" id="5604524">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5604529">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604561">Rect</span>&nbsp;<span class="ident" id="5604566">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5604576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="5604579">func</span>&nbsp;<span class="op" id="5604584">(</span><span class="ident" id="5604585">p</span>&nbsp;<span class="op" id="5604587">*</span><span class="ident" id="5604588">NRGBA64</span><span class="op" id="5604595">)</span>&nbsp;<span class="ident" id="5604597">ColorModel</span><span class="op" id="5604607">(</span><span class="op" id="5604608">)</span>&nbsp;<span class="ident" id="5604610">color</span><span class="op" id="5604615">.</span><span class="ident" id="5604616">Model</span>&nbsp;<span class="op" id="5604622">{</span>&nbsp;<span class="keyword" id="5604624">return</span>&nbsp;<span class="ident" id="5604631">color</span><span class="op" id="5604636">.</span><span class="ident" id="5604637">NRGBA64Model</span>&nbsp;<span class="op" id="5604650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5604653">func</span>&nbsp;<span class="op" id="5604658">(</span><span class="ident" id="5604659">p</span>&nbsp;<span class="op" id="5604661">*</span><span class="ident" id="5604662">NRGBA64</span><span class="op" id="5604669">)</span>&nbsp;<span class="ident" id="5604671">Bounds</span><span class="op" id="5604677">(</span><span class="op" id="5604678">)</span>&nbsp;<span class="ident" id="5604680">Rectangle</span>&nbsp;<span class="op" id="5604690">{</span>&nbsp;<span class="keyword" id="5604692">return</span>&nbsp;<span class="ident" id="5604699">p</span><span class="op" id="5604700">.</span><span class="ident" id="5604701">Rect</span>&nbsp;<span class="op" id="5604706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5604709">func</span>&nbsp;<span class="op" id="5604714">(</span><span class="ident" id="5604715">p</span>&nbsp;<span class="op" id="5604717">*</span><span class="ident" id="5604718">NRGBA64</span><span class="op" id="5604725">)</span>&nbsp;<span class="ident" id="5604727">At</span><span class="op" id="5604729">(</span><span class="ident" id="5604730">x</span><span class="op" id="5604731">,</span>&nbsp;<span class="ident" id="5604733">y</span>&nbsp;<span class="builtintype" id="5604735">int</span><span class="op" id="5604738">)</span>&nbsp;<span class="ident" id="5604740">color</span><span class="op" id="5604745">.</span><span class="ident" id="5604746">Color</span>&nbsp;<span class="op" id="5604752">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604755">return</span>&nbsp;<span class="ident" id="5604762">p</span><span class="op" id="5604763">.</span><span class="ident" id="5604764">NRGBA64At</span><span class="op" id="5604773">(</span><span class="ident" id="5604774">x</span><span class="op" id="5604775">,</span>&nbsp;<span class="ident" id="5604777">y</span><span class="op" id="5604778">)</span><br>
<span class="lineno"></span><span class="op" id="5604780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5604783">func</span>&nbsp;<span class="op" id="5604788">(</span><span class="ident" id="5604789">p</span>&nbsp;<span class="op" id="5604791">*</span><span class="ident" id="5604792">NRGBA64</span><span class="op" id="5604799">)</span>&nbsp;<span class="ident" id="5604801">NRGBA64At</span><span class="op" id="5604810">(</span><span class="ident" id="5604811">x</span><span class="op" id="5604812">,</span>&nbsp;<span class="ident" id="5604814">y</span>&nbsp;<span class="builtintype" id="5604816">int</span><span class="op" id="5604819">)</span>&nbsp;<span class="ident" id="5604821">color</span><span class="op" id="5604826">.</span><span class="ident" id="5604827">NRGBA64</span>&nbsp;<span class="op" id="5604835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604838">if</span>&nbsp;<span class="op" id="5604841">!</span><span class="op" id="5604842">(</span><span class="ident" id="5604843">Point</span><span class="op" id="5604848">{</span><span class="ident" id="5604849">x</span><span class="op" id="5604850">,</span>&nbsp;<span class="ident" id="5604852">y</span><span class="op" id="5604853">}</span><span class="op" id="5604854">.</span><span class="ident" id="5604855">In</span><span class="op" id="5604857">(</span><span class="ident" id="5604858">p</span><span class="op" id="5604859">.</span><span class="ident" id="5604860">Rect</span><span class="op" id="5604864">)</span><span class="op" id="5604865">)</span>&nbsp;<span class="op" id="5604867">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604871">return</span>&nbsp;<span class="ident" id="5604878">color</span><span class="op" id="5604883">.</span><span class="ident" id="5604884">NRGBA64</span><span class="op" id="5604891">{</span><span class="op" id="5604892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5604895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604898">i</span>&nbsp;<span class="op" id="5604900">:=</span>&nbsp;<span class="ident" id="5604903">p</span><span class="op" id="5604904">.</span><span class="ident" id="5604905">PixOffset</span><span class="op" id="5604914">(</span><span class="ident" id="5604915">x</span><span class="op" id="5604916">,</span>&nbsp;<span class="ident" id="5604918">y</span><span class="op" id="5604919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604922">return</span>&nbsp;<span class="ident" id="5604929">color</span><span class="op" id="5604934">.</span><span class="ident" id="5604935">NRGBA64</span><span class="op" id="5604942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5604946">uint16</span><span class="op" id="5604952">(</span><span class="ident" id="5604953">p</span><span class="op" id="5604954">.</span><span class="ident" id="5604955">Pix</span><span class="op" id="5604958">[</span><span class="ident" id="5604959">i</span><span class="op" id="5604960">+</span><span class="num" id="5604961">0</span><span class="op" id="5604962">]</span><span class="op" id="5604963">)</span><span class="op" id="5604964">&lt;&lt;</span><span class="num" id="5604966">8</span>&nbsp;<span class="op" id="5604968">|</span>&nbsp;<span class="builtintype" id="5604970">uint16</span><span class="op" id="5604976">(</span><span class="ident" id="5604977">p</span><span class="op" id="5604978">.</span><span class="ident" id="5604979">Pix</span><span class="op" id="5604982">[</span><span class="ident" id="5604983">i</span><span class="op" id="5604984">+</span><span class="num" id="5604985">1</span><span class="op" id="5604986">]</span><span class="op" id="5604987">)</span><span class="op" id="5604988">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5604992">uint16</span><span class="op" id="5604998">(</span><span class="ident" id="5604999">p</span><span class="op" id="5605000">.</span><span class="ident" id="5605001">Pix</span><span class="op" id="5605004">[</span><span class="ident" id="5605005">i</span><span class="op" id="5605006">+</span><span class="num" id="5605007">2</span><span class="op" id="5605008">]</span><span class="op" id="5605009">)</span><span class="op" id="5605010">&lt;&lt;</span><span class="num" id="5605012">8</span>&nbsp;<span class="op" id="5605014">|</span>&nbsp;<span class="builtintype" id="5605016">uint16</span><span class="op" id="5605022">(</span><span class="ident" id="5605023">p</span><span class="op" id="5605024">.</span><span class="ident" id="5605025">Pix</span><span class="op" id="5605028">[</span><span class="ident" id="5605029">i</span><span class="op" id="5605030">+</span><span class="num" id="5605031">3</span><span class="op" id="5605032">]</span><span class="op" id="5605033">)</span><span class="op" id="5605034">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5605038">uint16</span><span class="op" id="5605044">(</span><span class="ident" id="5605045">p</span><span class="op" id="5605046">.</span><span class="ident" id="5605047">Pix</span><span class="op" id="5605050">[</span><span class="ident" id="5605051">i</span><span class="op" id="5605052">+</span><span class="num" id="5605053">4</span><span class="op" id="5605054">]</span><span class="op" id="5605055">)</span><span class="op" id="5605056">&lt;&lt;</span><span class="num" id="5605058">8</span>&nbsp;<span class="op" id="5605060">|</span>&nbsp;<span class="builtintype" id="5605062">uint16</span><span class="op" id="5605068">(</span><span class="ident" id="5605069">p</span><span class="op" id="5605070">.</span><span class="ident" id="5605071">Pix</span><span class="op" id="5605074">[</span><span class="ident" id="5605075">i</span><span class="op" id="5605076">+</span><span class="num" id="5605077">5</span><span class="op" id="5605078">]</span><span class="op" id="5605079">)</span><span class="op" id="5605080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5605084">uint16</span><span class="op" id="5605090">(</span><span class="ident" id="5605091">p</span><span class="op" id="5605092">.</span><span class="ident" id="5605093">Pix</span><span class="op" id="5605096">[</span><span class="ident" id="5605097">i</span><span class="op" id="5605098">+</span><span class="num" id="5605099">6</span><span class="op" id="5605100">]</span><span class="op" id="5605101">)</span><span class="op" id="5605102">&lt;&lt;</span><span class="num" id="5605104">8</span>&nbsp;<span class="op" id="5605106">|</span>&nbsp;<span class="builtintype" id="5605108">uint16</span><span class="op" id="5605114">(</span><span class="ident" id="5605115">p</span><span class="op" id="5605116">.</span><span class="ident" id="5605117">Pix</span><span class="op" id="5605120">[</span><span class="ident" id="5605121">i</span><span class="op" id="5605122">+</span><span class="num" id="5605123">7</span><span class="op" id="5605124">]</span><span class="op" id="5605125">)</span><span class="op" id="5605126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5605129">}</span><br>
<span class="lineno"></span><span class="op" id="5605131">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="comment" id="5605134">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5605213">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5605237">func</span>&nbsp;<span class="op" id="5605242">(</span><span class="ident" id="5605243">p</span>&nbsp;<span class="op" id="5605245">*</span><span class="ident" id="5605246">NRGBA64</span><span class="op" id="5605253">)</span>&nbsp;<span class="ident" id="5605255">PixOffset</span><span class="op" id="5605264">(</span><span class="ident" id="5605265">x</span><span class="op" id="5605266">,</span>&nbsp;<span class="ident" id="5605268">y</span>&nbsp;<span class="builtintype" id="5605270">int</span><span class="op" id="5605273">)</span>&nbsp;<span class="builtintype" id="5605275">int</span>&nbsp;<span class="op" id="5605279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5605282">return</span>&nbsp;<span class="op" id="5605289">(</span><span class="ident" id="5605290">y</span><span class="op" id="5605291">-</span><span class="ident" id="5605292">p</span><span class="op" id="5605293">.</span><span class="ident" id="5605294">Rect</span><span class="op" id="5605298">.</span><span class="ident" id="5605299">Min</span><span class="op" id="5605302">.</span><span class="ident" id="5605303">Y</span><span class="op" id="5605304">)</span><span class="op" id="5605305">*</span><span class="ident" id="5605306">p</span><span class="op" id="5605307">.</span><span class="ident" id="5605308">Stride</span>&nbsp;<span class="op" id="5605315">+</span>&nbsp;<span class="op" id="5605317">(</span><span class="ident" id="5605318">x</span><span class="op" id="5605319">-</span><span class="ident" id="5605320">p</span><span class="op" id="5605321">.</span><span class="ident" id="5605322">Rect</span><span class="op" id="5605326">.</span><span class="ident" id="5605327">Min</span><span class="op" id="5605330">.</span><span class="ident" id="5605331">X</span><span class="op" id="5605332">)</span><span class="op" id="5605333">*</span><span class="num" id="5605334">8</span><br>
<span class="lineno">405</span><span class="op" id="5605336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5605339">func</span>&nbsp;<span class="op" id="5605344">(</span><span class="ident" id="5605345">p</span>&nbsp;<span class="op" id="5605347">*</span><span class="ident" id="5605348">NRGBA64</span><span class="op" id="5605355">)</span>&nbsp;<span class="ident" id="5605357">Set</span><span class="op" id="5605360">(</span><span class="ident" id="5605361">x</span><span class="op" id="5605362">,</span>&nbsp;<span class="ident" id="5605364">y</span>&nbsp;<span class="builtintype" id="5605366">int</span><span class="op" id="5605369">,</span>&nbsp;<span class="ident" id="5605371">c</span>&nbsp;<span class="ident" id="5605373">color</span><span class="op" id="5605378">.</span><span class="ident" id="5605379">Color</span><span class="op" id="5605384">)</span>&nbsp;<span class="op" id="5605386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5605389">if</span>&nbsp;<span class="op" id="5605392">!</span><span class="op" id="5605393">(</span><span class="ident" id="5605394">Point</span><span class="op" id="5605399">{</span><span class="ident" id="5605400">x</span><span class="op" id="5605401">,</span>&nbsp;<span class="ident" id="5605403">y</span><span class="op" id="5605404">}</span><span class="op" id="5605405">.</span><span class="ident" id="5605406">In</span><span class="op" id="5605408">(</span><span class="ident" id="5605409">p</span><span class="op" id="5605410">.</span><span class="ident" id="5605411">Rect</span><span class="op" id="5605415">)</span><span class="op" id="5605416">)</span>&nbsp;<span class="op" id="5605418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5605422">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5605430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605433">i</span>&nbsp;<span class="op" id="5605435">:=</span>&nbsp;<span class="ident" id="5605438">p</span><span class="op" id="5605439">.</span><span class="ident" id="5605440">PixOffset</span><span class="op" id="5605449">(</span><span class="ident" id="5605450">x</span><span class="op" id="5605451">,</span>&nbsp;<span class="ident" id="5605453">y</span><span class="op" id="5605454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605457">c1</span>&nbsp;<span class="op" id="5605460">:=</span>&nbsp;<span class="ident" id="5605463">color</span><span class="op" id="5605468">.</span><span class="ident" id="5605469">NRGBA64Model</span><span class="op" id="5605481">.</span><span class="ident" id="5605482">Convert</span><span class="op" id="5605489">(</span><span class="ident" id="5605490">c</span><span class="op" id="5605491">)</span><span class="op" id="5605492">.</span><span class="op" id="5605493">(</span><span class="ident" id="5605494">color</span><span class="op" id="5605499">.</span><span class="ident" id="5605500">NRGBA64</span><span class="op" id="5605507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605510">p</span><span class="op" id="5605511">.</span><span class="ident" id="5605512">Pix</span><span class="op" id="5605515">[</span><span class="ident" id="5605516">i</span><span class="op" id="5605517">+</span><span class="num" id="5605518">0</span><span class="op" id="5605519">]</span>&nbsp;<span class="op" id="5605521">=</span>&nbsp;<span class="builtintype" id="5605523">uint8</span><span class="op" id="5605528">(</span><span class="ident" id="5605529">c1</span><span class="op" id="5605531">.</span><span class="ident" id="5605532">R</span>&nbsp;<span class="op" id="5605534">&gt;&gt;</span>&nbsp;<span class="num" id="5605537">8</span><span class="op" id="5605538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605541">p</span><span class="op" id="5605542">.</span><span class="ident" id="5605543">Pix</span><span class="op" id="5605546">[</span><span class="ident" id="5605547">i</span><span class="op" id="5605548">+</span><span class="num" id="5605549">1</span><span class="op" id="5605550">]</span>&nbsp;<span class="op" id="5605552">=</span>&nbsp;<span class="builtintype" id="5605554">uint8</span><span class="op" id="5605559">(</span><span class="ident" id="5605560">c1</span><span class="op" id="5605562">.</span><span class="ident" id="5605563">R</span><span class="op" id="5605564">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605567">p</span><span class="op" id="5605568">.</span><span class="ident" id="5605569">Pix</span><span class="op" id="5605572">[</span><span class="ident" id="5605573">i</span><span class="op" id="5605574">+</span><span class="num" id="5605575">2</span><span class="op" id="5605576">]</span>&nbsp;<span class="op" id="5605578">=</span>&nbsp;<span class="builtintype" id="5605580">uint8</span><span class="op" id="5605585">(</span><span class="ident" id="5605586">c1</span><span class="op" id="5605588">.</span><span class="ident" id="5605589">G</span>&nbsp;<span class="op" id="5605591">&gt;&gt;</span>&nbsp;<span class="num" id="5605594">8</span><span class="op" id="5605595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605598">p</span><span class="op" id="5605599">.</span><span class="ident" id="5605600">Pix</span><span class="op" id="5605603">[</span><span class="ident" id="5605604">i</span><span class="op" id="5605605">+</span><span class="num" id="5605606">3</span><span class="op" id="5605607">]</span>&nbsp;<span class="op" id="5605609">=</span>&nbsp;<span class="builtintype" id="5605611">uint8</span><span class="op" id="5605616">(</span><span class="ident" id="5605617">c1</span><span class="op" id="5605619">.</span><span class="ident" id="5605620">G</span><span class="op" id="5605621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605624">p</span><span class="op" id="5605625">.</span><span class="ident" id="5605626">Pix</span><span class="op" id="5605629">[</span><span class="ident" id="5605630">i</span><span class="op" id="5605631">+</span><span class="num" id="5605632">4</span><span class="op" id="5605633">]</span>&nbsp;<span class="op" id="5605635">=</span>&nbsp;<span class="builtintype" id="5605637">uint8</span><span class="op" id="5605642">(</span><span class="ident" id="5605643">c1</span><span class="op" id="5605645">.</span><span class="ident" id="5605646">B</span>&nbsp;<span class="op" id="5605648">&gt;&gt;</span>&nbsp;<span class="num" id="5605651">8</span><span class="op" id="5605652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605655">p</span><span class="op" id="5605656">.</span><span class="ident" id="5605657">Pix</span><span class="op" id="5605660">[</span><span class="ident" id="5605661">i</span><span class="op" id="5605662">+</span><span class="num" id="5605663">5</span><span class="op" id="5605664">]</span>&nbsp;<span class="op" id="5605666">=</span>&nbsp;<span class="builtintype" id="5605668">uint8</span><span class="op" id="5605673">(</span><span class="ident" id="5605674">c1</span><span class="op" id="5605676">.</span><span class="ident" id="5605677">B</span><span class="op" id="5605678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605681">p</span><span class="op" id="5605682">.</span><span class="ident" id="5605683">Pix</span><span class="op" id="5605686">[</span><span class="ident" id="5605687">i</span><span class="op" id="5605688">+</span><span class="num" id="5605689">6</span><span class="op" id="5605690">]</span>&nbsp;<span class="op" id="5605692">=</span>&nbsp;<span class="builtintype" id="5605694">uint8</span><span class="op" id="5605699">(</span><span class="ident" id="5605700">c1</span><span class="op" id="5605702">.</span><span class="ident" id="5605703">A</span>&nbsp;<span class="op" id="5605705">&gt;&gt;</span>&nbsp;<span class="num" id="5605708">8</span><span class="op" id="5605709">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605712">p</span><span class="op" id="5605713">.</span><span class="ident" id="5605714">Pix</span><span class="op" id="5605717">[</span><span class="ident" id="5605718">i</span><span class="op" id="5605719">+</span><span class="num" id="5605720">7</span><span class="op" id="5605721">]</span>&nbsp;<span class="op" id="5605723">=</span>&nbsp;<span class="builtintype" id="5605725">uint8</span><span class="op" id="5605730">(</span><span class="ident" id="5605731">c1</span><span class="op" id="5605733">.</span><span class="ident" id="5605734">A</span><span class="op" id="5605735">)</span><br>
<span class="lineno"></span><span class="op" id="5605737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5605740">func</span>&nbsp;<span class="op" id="5605745">(</span><span class="ident" id="5605746">p</span>&nbsp;<span class="op" id="5605748">*</span><span class="ident" id="5605749">NRGBA64</span><span class="op" id="5605756">)</span>&nbsp;<span class="ident" id="5605758">SetNRGBA64</span><span class="op" id="5605768">(</span><span class="ident" id="5605769">x</span><span class="op" id="5605770">,</span>&nbsp;<span class="ident" id="5605772">y</span>&nbsp;<span class="builtintype" id="5605774">int</span><span class="op" id="5605777">,</span>&nbsp;<span class="ident" id="5605779">c</span>&nbsp;<span class="ident" id="5605781">color</span><span class="op" id="5605786">.</span><span class="ident" id="5605787">NRGBA64</span><span class="op" id="5605794">)</span>&nbsp;<span class="op" id="5605796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5605799">if</span>&nbsp;<span class="op" id="5605802">!</span><span class="op" id="5605803">(</span><span class="ident" id="5605804">Point</span><span class="op" id="5605809">{</span><span class="ident" id="5605810">x</span><span class="op" id="5605811">,</span>&nbsp;<span class="ident" id="5605813">y</span><span class="op" id="5605814">}</span><span class="op" id="5605815">.</span><span class="ident" id="5605816">In</span><span class="op" id="5605818">(</span><span class="ident" id="5605819">p</span><span class="op" id="5605820">.</span><span class="ident" id="5605821">Rect</span><span class="op" id="5605825">)</span><span class="op" id="5605826">)</span>&nbsp;<span class="op" id="5605828">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5605832">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5605840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605843">i</span>&nbsp;<span class="op" id="5605845">:=</span>&nbsp;<span class="ident" id="5605848">p</span><span class="op" id="5605849">.</span><span class="ident" id="5605850">PixOffset</span><span class="op" id="5605859">(</span><span class="ident" id="5605860">x</span><span class="op" id="5605861">,</span>&nbsp;<span class="ident" id="5605863">y</span><span class="op" id="5605864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605867">p</span><span class="op" id="5605868">.</span><span class="ident" id="5605869">Pix</span><span class="op" id="5605872">[</span><span class="ident" id="5605873">i</span><span class="op" id="5605874">+</span><span class="num" id="5605875">0</span><span class="op" id="5605876">]</span>&nbsp;<span class="op" id="5605878">=</span>&nbsp;<span class="builtintype" id="5605880">uint8</span><span class="op" id="5605885">(</span><span class="ident" id="5605886">c</span><span class="op" id="5605887">.</span><span class="ident" id="5605888">R</span>&nbsp;<span class="op" id="5605890">&gt;&gt;</span>&nbsp;<span class="num" id="5605893">8</span><span class="op" id="5605894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605897">p</span><span class="op" id="5605898">.</span><span class="ident" id="5605899">Pix</span><span class="op" id="5605902">[</span><span class="ident" id="5605903">i</span><span class="op" id="5605904">+</span><span class="num" id="5605905">1</span><span class="op" id="5605906">]</span>&nbsp;<span class="op" id="5605908">=</span>&nbsp;<span class="builtintype" id="5605910">uint8</span><span class="op" id="5605915">(</span><span class="ident" id="5605916">c</span><span class="op" id="5605917">.</span><span class="ident" id="5605918">R</span><span class="op" id="5605919">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605922">p</span><span class="op" id="5605923">.</span><span class="ident" id="5605924">Pix</span><span class="op" id="5605927">[</span><span class="ident" id="5605928">i</span><span class="op" id="5605929">+</span><span class="num" id="5605930">2</span><span class="op" id="5605931">]</span>&nbsp;<span class="op" id="5605933">=</span>&nbsp;<span class="builtintype" id="5605935">uint8</span><span class="op" id="5605940">(</span><span class="ident" id="5605941">c</span><span class="op" id="5605942">.</span><span class="ident" id="5605943">G</span>&nbsp;<span class="op" id="5605945">&gt;&gt;</span>&nbsp;<span class="num" id="5605948">8</span><span class="op" id="5605949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605952">p</span><span class="op" id="5605953">.</span><span class="ident" id="5605954">Pix</span><span class="op" id="5605957">[</span><span class="ident" id="5605958">i</span><span class="op" id="5605959">+</span><span class="num" id="5605960">3</span><span class="op" id="5605961">]</span>&nbsp;<span class="op" id="5605963">=</span>&nbsp;<span class="builtintype" id="5605965">uint8</span><span class="op" id="5605970">(</span><span class="ident" id="5605971">c</span><span class="op" id="5605972">.</span><span class="ident" id="5605973">G</span><span class="op" id="5605974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605977">p</span><span class="op" id="5605978">.</span><span class="ident" id="5605979">Pix</span><span class="op" id="5605982">[</span><span class="ident" id="5605983">i</span><span class="op" id="5605984">+</span><span class="num" id="5605985">4</span><span class="op" id="5605986">]</span>&nbsp;<span class="op" id="5605988">=</span>&nbsp;<span class="builtintype" id="5605990">uint8</span><span class="op" id="5605995">(</span><span class="ident" id="5605996">c</span><span class="op" id="5605997">.</span><span class="ident" id="5605998">B</span>&nbsp;<span class="op" id="5606000">&gt;&gt;</span>&nbsp;<span class="num" id="5606003">8</span><span class="op" id="5606004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606007">p</span><span class="op" id="5606008">.</span><span class="ident" id="5606009">Pix</span><span class="op" id="5606012">[</span><span class="ident" id="5606013">i</span><span class="op" id="5606014">+</span><span class="num" id="5606015">5</span><span class="op" id="5606016">]</span>&nbsp;<span class="op" id="5606018">=</span>&nbsp;<span class="builtintype" id="5606020">uint8</span><span class="op" id="5606025">(</span><span class="ident" id="5606026">c</span><span class="op" id="5606027">.</span><span class="ident" id="5606028">B</span><span class="op" id="5606029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606032">p</span><span class="op" id="5606033">.</span><span class="ident" id="5606034">Pix</span><span class="op" id="5606037">[</span><span class="ident" id="5606038">i</span><span class="op" id="5606039">+</span><span class="num" id="5606040">6</span><span class="op" id="5606041">]</span>&nbsp;<span class="op" id="5606043">=</span>&nbsp;<span class="builtintype" id="5606045">uint8</span><span class="op" id="5606050">(</span><span class="ident" id="5606051">c</span><span class="op" id="5606052">.</span><span class="ident" id="5606053">A</span>&nbsp;<span class="op" id="5606055">&gt;&gt;</span>&nbsp;<span class="num" id="5606058">8</span><span class="op" id="5606059">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606062">p</span><span class="op" id="5606063">.</span><span class="ident" id="5606064">Pix</span><span class="op" id="5606067">[</span><span class="ident" id="5606068">i</span><span class="op" id="5606069">+</span><span class="num" id="5606070">7</span><span class="op" id="5606071">]</span>&nbsp;<span class="op" id="5606073">=</span>&nbsp;<span class="builtintype" id="5606075">uint8</span><span class="op" id="5606080">(</span><span class="ident" id="5606081">c</span><span class="op" id="5606082">.</span><span class="ident" id="5606083">A</span><span class="op" id="5606084">)</span><br>
<span class="lineno"></span><span class="op" id="5606086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5606089">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5606166">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno">440</span><span class="keyword" id="5606238">func</span>&nbsp;<span class="op" id="5606243">(</span><span class="ident" id="5606244">p</span>&nbsp;<span class="op" id="5606246">*</span><span class="ident" id="5606247">NRGBA64</span><span class="op" id="5606254">)</span>&nbsp;<span class="ident" id="5606256">SubImage</span><span class="op" id="5606264">(</span><span class="ident" id="5606265">r</span>&nbsp;<span class="ident" id="5606267">Rectangle</span><span class="op" id="5606276">)</span>&nbsp;<span class="ident" id="5606278">Image</span>&nbsp;<span class="op" id="5606284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606287">r</span>&nbsp;<span class="op" id="5606289">=</span>&nbsp;<span class="ident" id="5606291">r</span><span class="op" id="5606292">.</span><span class="ident" id="5606293">Intersect</span><span class="op" id="5606302">(</span><span class="ident" id="5606303">p</span><span class="op" id="5606304">.</span><span class="ident" id="5606305">Rect</span><span class="op" id="5606309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5606312">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5606393">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5606475">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606525">if</span>&nbsp;<span class="ident" id="5606528">r</span><span class="op" id="5606529">.</span><span class="ident" id="5606530">Empty</span><span class="op" id="5606535">(</span><span class="op" id="5606536">)</span>&nbsp;<span class="op" id="5606538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606542">return</span>&nbsp;<span class="op" id="5606549">&amp;</span><span class="ident" id="5606550">NRGBA64</span><span class="op" id="5606557">{</span><span class="op" id="5606558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5606561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606564">i</span>&nbsp;<span class="op" id="5606566">:=</span>&nbsp;<span class="ident" id="5606569">p</span><span class="op" id="5606570">.</span><span class="ident" id="5606571">PixOffset</span><span class="op" id="5606580">(</span><span class="ident" id="5606581">r</span><span class="op" id="5606582">.</span><span class="ident" id="5606583">Min</span><span class="op" id="5606586">.</span><span class="ident" id="5606587">X</span><span class="op" id="5606588">,</span>&nbsp;<span class="ident" id="5606590">r</span><span class="op" id="5606591">.</span><span class="ident" id="5606592">Min</span><span class="op" id="5606595">.</span><span class="ident" id="5606596">Y</span><span class="op" id="5606597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606600">return</span>&nbsp;<span class="op" id="5606607">&amp;</span><span class="ident" id="5606608">NRGBA64</span><span class="op" id="5606615">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606619">Pix</span><span class="op" id="5606622">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5606627">p</span><span class="op" id="5606628">.</span><span class="ident" id="5606629">Pix</span><span class="op" id="5606632">[</span><span class="ident" id="5606633">i</span><span class="op" id="5606634">:</span><span class="op" id="5606635">]</span><span class="op" id="5606636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606640">Stride</span><span class="op" id="5606646">:</span>&nbsp;<span class="ident" id="5606648">p</span><span class="op" id="5606649">.</span><span class="ident" id="5606650">Stride</span><span class="op" id="5606656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606660">Rect</span><span class="op" id="5606664">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5606668">r</span><span class="op" id="5606669">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5606672">}</span><br>
<span class="lineno"></span><span class="op" id="5606674">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="5606677">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5606750">func</span>&nbsp;<span class="op" id="5606755">(</span><span class="ident" id="5606756">p</span>&nbsp;<span class="op" id="5606758">*</span><span class="ident" id="5606759">NRGBA64</span><span class="op" id="5606766">)</span>&nbsp;<span class="ident" id="5606768">Opaque</span><span class="op" id="5606774">(</span><span class="op" id="5606775">)</span>&nbsp;<span class="builtintype" id="5606777">bool</span>&nbsp;<span class="op" id="5606782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606785">if</span>&nbsp;<span class="ident" id="5606788">p</span><span class="op" id="5606789">.</span><span class="ident" id="5606790">Rect</span><span class="op" id="5606794">.</span><span class="ident" id="5606795">Empty</span><span class="op" id="5606800">(</span><span class="op" id="5606801">)</span>&nbsp;<span class="op" id="5606803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606807">return</span>&nbsp;<span class="builtintype" id="5606814">true</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5606820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606823">i0</span><span class="op" id="5606825">,</span>&nbsp;<span class="ident" id="5606827">i1</span>&nbsp;<span class="op" id="5606830">:=</span>&nbsp;<span class="num" id="5606833">6</span><span class="op" id="5606834">,</span>&nbsp;<span class="ident" id="5606836">p</span><span class="op" id="5606837">.</span><span class="ident" id="5606838">Rect</span><span class="op" id="5606842">.</span><span class="ident" id="5606843">Dx</span><span class="op" id="5606845">(</span><span class="op" id="5606846">)</span><span class="op" id="5606847">*</span><span class="num" id="5606848">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606851">for</span>&nbsp;<span class="ident" id="5606855">y</span>&nbsp;<span class="op" id="5606857">:=</span>&nbsp;<span class="ident" id="5606860">p</span><span class="op" id="5606861">.</span><span class="ident" id="5606862">Rect</span><span class="op" id="5606866">.</span><span class="ident" id="5606867">Min</span><span class="op" id="5606870">.</span><span class="ident" id="5606871">Y</span><span class="op" id="5606872">;</span>&nbsp;<span class="ident" id="5606874">y</span>&nbsp;<span class="op" id="5606876">&lt;</span>&nbsp;<span class="ident" id="5606878">p</span><span class="op" id="5606879">.</span><span class="ident" id="5606880">Rect</span><span class="op" id="5606884">.</span><span class="ident" id="5606885">Max</span><span class="op" id="5606888">.</span><span class="ident" id="5606889">Y</span><span class="op" id="5606890">;</span>&nbsp;<span class="ident" id="5606892">y</span><span class="op" id="5606893">++</span>&nbsp;<span class="op" id="5606896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606900">for</span>&nbsp;<span class="ident" id="5606904">i</span>&nbsp;<span class="op" id="5606906">:=</span>&nbsp;<span class="ident" id="5606909">i0</span><span class="op" id="5606911">;</span>&nbsp;<span class="ident" id="5606913">i</span>&nbsp;<span class="op" id="5606915">&lt;</span>&nbsp;<span class="ident" id="5606917">i1</span><span class="op" id="5606919">;</span>&nbsp;<span class="ident" id="5606921">i</span>&nbsp;<span class="op" id="5606923">+=</span>&nbsp;<span class="num" id="5606926">8</span>&nbsp;<span class="op" id="5606928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606933">if</span>&nbsp;<span class="ident" id="5606936">p</span><span class="op" id="5606937">.</span><span class="ident" id="5606938">Pix</span><span class="op" id="5606941">[</span><span class="ident" id="5606942">i</span><span class="op" id="5606943">+</span><span class="num" id="5606944">0</span><span class="op" id="5606945">]</span>&nbsp;<span class="op" id="5606947">!=</span>&nbsp;<span class="num" id="5606950">0xff</span>&nbsp;<span class="op" id="5606955">||</span>&nbsp;<span class="ident" id="5606958">p</span><span class="op" id="5606959">.</span><span class="ident" id="5606960">Pix</span><span class="op" id="5606963">[</span><span class="ident" id="5606964">i</span><span class="op" id="5606965">+</span><span class="num" id="5606966">1</span><span class="op" id="5606967">]</span>&nbsp;<span class="op" id="5606969">!=</span>&nbsp;<span class="num" id="5606972">0xff</span>&nbsp;<span class="op" id="5606977">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606983">return</span>&nbsp;<span class="builtintype" id="5606990">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5606999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5607003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607007">i0</span>&nbsp;<span class="op" id="5607010">+=</span>&nbsp;<span class="ident" id="5607013">p</span><span class="op" id="5607014">.</span><span class="ident" id="5607015">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607024">i1</span>&nbsp;<span class="op" id="5607027">+=</span>&nbsp;<span class="ident" id="5607030">p</span><span class="op" id="5607031">.</span><span class="ident" id="5607032">Stride</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5607040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607043">return</span>&nbsp;<span class="builtintype" id="5607050">true</span><br>
<span class="lineno"></span><span class="op" id="5607055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5607058">//&nbsp;NewNRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno">475</span><span class="keyword" id="5607117">func</span>&nbsp;<span class="ident" id="5607122">NewNRGBA64</span><span class="op" id="5607132">(</span><span class="ident" id="5607133">r</span>&nbsp;<span class="ident" id="5607135">Rectangle</span><span class="op" id="5607144">)</span>&nbsp;<span class="op" id="5607146">*</span><span class="ident" id="5607147">NRGBA64</span>&nbsp;<span class="op" id="5607155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607158">w</span><span class="op" id="5607159">,</span>&nbsp;<span class="ident" id="5607161">h</span>&nbsp;<span class="op" id="5607163">:=</span>&nbsp;<span class="ident" id="5607166">r</span><span class="op" id="5607167">.</span><span class="ident" id="5607168">Dx</span><span class="op" id="5607170">(</span><span class="op" id="5607171">)</span><span class="op" id="5607172">,</span>&nbsp;<span class="ident" id="5607174">r</span><span class="op" id="5607175">.</span><span class="ident" id="5607176">Dy</span><span class="op" id="5607178">(</span><span class="op" id="5607179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607182">pix</span>&nbsp;<span class="op" id="5607186">:=</span>&nbsp;<span class="builtinfunc" id="5607189">make</span><span class="op" id="5607193">(</span><span class="op" id="5607194">[</span><span class="op" id="5607195">]</span><span class="builtintype" id="5607196">uint8</span><span class="op" id="5607201">,</span>&nbsp;<span class="num" id="5607203">8</span><span class="op" id="5607204">*</span><span class="ident" id="5607205">w</span><span class="op" id="5607206">*</span><span class="ident" id="5607207">h</span><span class="op" id="5607208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607211">return</span>&nbsp;<span class="op" id="5607218">&amp;</span><span class="ident" id="5607219">NRGBA64</span><span class="op" id="5607226">{</span><span class="ident" id="5607227">pix</span><span class="op" id="5607230">,</span>&nbsp;<span class="num" id="5607232">8</span>&nbsp;<span class="op" id="5607234">*</span>&nbsp;<span class="ident" id="5607236">w</span><span class="op" id="5607237">,</span>&nbsp;<span class="ident" id="5607239">r</span><span class="op" id="5607240">}</span><br>
<span class="lineno"></span><span class="op" id="5607242">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="5607245">//&nbsp;Alpha&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5607320">type</span>&nbsp;<span class="ident" id="5607325">Alpha</span>&nbsp;<span class="keyword" id="5607331">struct</span>&nbsp;<span class="op" id="5607338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5607341">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5607405">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607473">Pix</span>&nbsp;<span class="op" id="5607477">[</span><span class="op" id="5607478">]</span><span class="builtintype" id="5607479">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5607486">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607562">Stride</span>&nbsp;<span class="builtintype" id="5607569">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5607574">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607606">Rect</span>&nbsp;<span class="ident" id="5607611">Rectangle</span><br>
<span class="lineno">490</span><span class="op" id="5607621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5607624">func</span>&nbsp;<span class="op" id="5607629">(</span><span class="ident" id="5607630">p</span>&nbsp;<span class="op" id="5607632">*</span><span class="ident" id="5607633">Alpha</span><span class="op" id="5607638">)</span>&nbsp;<span class="ident" id="5607640">ColorModel</span><span class="op" id="5607650">(</span><span class="op" id="5607651">)</span>&nbsp;<span class="ident" id="5607653">color</span><span class="op" id="5607658">.</span><span class="ident" id="5607659">Model</span>&nbsp;<span class="op" id="5607665">{</span>&nbsp;<span class="keyword" id="5607667">return</span>&nbsp;<span class="ident" id="5607674">color</span><span class="op" id="5607679">.</span><span class="ident" id="5607680">AlphaModel</span>&nbsp;<span class="op" id="5607691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5607694">func</span>&nbsp;<span class="op" id="5607699">(</span><span class="ident" id="5607700">p</span>&nbsp;<span class="op" id="5607702">*</span><span class="ident" id="5607703">Alpha</span><span class="op" id="5607708">)</span>&nbsp;<span class="ident" id="5607710">Bounds</span><span class="op" id="5607716">(</span><span class="op" id="5607717">)</span>&nbsp;<span class="ident" id="5607719">Rectangle</span>&nbsp;<span class="op" id="5607729">{</span>&nbsp;<span class="keyword" id="5607731">return</span>&nbsp;<span class="ident" id="5607738">p</span><span class="op" id="5607739">.</span><span class="ident" id="5607740">Rect</span>&nbsp;<span class="op" id="5607745">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="5607748">func</span>&nbsp;<span class="op" id="5607753">(</span><span class="ident" id="5607754">p</span>&nbsp;<span class="op" id="5607756">*</span><span class="ident" id="5607757">Alpha</span><span class="op" id="5607762">)</span>&nbsp;<span class="ident" id="5607764">At</span><span class="op" id="5607766">(</span><span class="ident" id="5607767">x</span><span class="op" id="5607768">,</span>&nbsp;<span class="ident" id="5607770">y</span>&nbsp;<span class="builtintype" id="5607772">int</span><span class="op" id="5607775">)</span>&nbsp;<span class="ident" id="5607777">color</span><span class="op" id="5607782">.</span><span class="ident" id="5607783">Color</span>&nbsp;<span class="op" id="5607789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607792">return</span>&nbsp;<span class="ident" id="5607799">p</span><span class="op" id="5607800">.</span><span class="ident" id="5607801">AlphaAt</span><span class="op" id="5607808">(</span><span class="ident" id="5607809">x</span><span class="op" id="5607810">,</span>&nbsp;<span class="ident" id="5607812">y</span><span class="op" id="5607813">)</span><br>
<span class="lineno"></span><span class="op" id="5607815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="5607818">func</span>&nbsp;<span class="op" id="5607823">(</span><span class="ident" id="5607824">p</span>&nbsp;<span class="op" id="5607826">*</span><span class="ident" id="5607827">Alpha</span><span class="op" id="5607832">)</span>&nbsp;<span class="ident" id="5607834">AlphaAt</span><span class="op" id="5607841">(</span><span class="ident" id="5607842">x</span><span class="op" id="5607843">,</span>&nbsp;<span class="ident" id="5607845">y</span>&nbsp;<span class="builtintype" id="5607847">int</span><span class="op" id="5607850">)</span>&nbsp;<span class="ident" id="5607852">color</span><span class="op" id="5607857">.</span><span class="ident" id="5607858">Alpha</span>&nbsp;<span class="op" id="5607864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607867">if</span>&nbsp;<span class="op" id="5607870">!</span><span class="op" id="5607871">(</span><span class="ident" id="5607872">Point</span><span class="op" id="5607877">{</span><span class="ident" id="5607878">x</span><span class="op" id="5607879">,</span>&nbsp;<span class="ident" id="5607881">y</span><span class="op" id="5607882">}</span><span class="op" id="5607883">.</span><span class="ident" id="5607884">In</span><span class="op" id="5607886">(</span><span class="ident" id="5607887">p</span><span class="op" id="5607888">.</span><span class="ident" id="5607889">Rect</span><span class="op" id="5607893">)</span><span class="op" id="5607894">)</span>&nbsp;<span class="op" id="5607896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607900">return</span>&nbsp;<span class="ident" id="5607907">color</span><span class="op" id="5607912">.</span><span class="ident" id="5607913">Alpha</span><span class="op" id="5607918">{</span><span class="op" id="5607919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5607922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607925">i</span>&nbsp;<span class="op" id="5607927">:=</span>&nbsp;<span class="ident" id="5607930">p</span><span class="op" id="5607931">.</span><span class="ident" id="5607932">PixOffset</span><span class="op" id="5607941">(</span><span class="ident" id="5607942">x</span><span class="op" id="5607943">,</span>&nbsp;<span class="ident" id="5607945">y</span><span class="op" id="5607946">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607949">return</span>&nbsp;<span class="ident" id="5607956">color</span><span class="op" id="5607961">.</span><span class="ident" id="5607962">Alpha</span><span class="op" id="5607967">{</span><span class="ident" id="5607968">p</span><span class="op" id="5607969">.</span><span class="ident" id="5607970">Pix</span><span class="op" id="5607973">[</span><span class="ident" id="5607974">i</span><span class="op" id="5607975">]</span><span class="op" id="5607976">}</span><br>
<span class="lineno"></span><span class="op" id="5607978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5607981">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5608060">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">510</span><span class="keyword" id="5608084">func</span>&nbsp;<span class="op" id="5608089">(</span><span class="ident" id="5608090">p</span>&nbsp;<span class="op" id="5608092">*</span><span class="ident" id="5608093">Alpha</span><span class="op" id="5608098">)</span>&nbsp;<span class="ident" id="5608100">PixOffset</span><span class="op" id="5608109">(</span><span class="ident" id="5608110">x</span><span class="op" id="5608111">,</span>&nbsp;<span class="ident" id="5608113">y</span>&nbsp;<span class="builtintype" id="5608115">int</span><span class="op" id="5608118">)</span>&nbsp;<span class="builtintype" id="5608120">int</span>&nbsp;<span class="op" id="5608124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608127">return</span>&nbsp;<span class="op" id="5608134">(</span><span class="ident" id="5608135">y</span><span class="op" id="5608136">-</span><span class="ident" id="5608137">p</span><span class="op" id="5608138">.</span><span class="ident" id="5608139">Rect</span><span class="op" id="5608143">.</span><span class="ident" id="5608144">Min</span><span class="op" id="5608147">.</span><span class="ident" id="5608148">Y</span><span class="op" id="5608149">)</span><span class="op" id="5608150">*</span><span class="ident" id="5608151">p</span><span class="op" id="5608152">.</span><span class="ident" id="5608153">Stride</span>&nbsp;<span class="op" id="5608160">+</span>&nbsp;<span class="op" id="5608162">(</span><span class="ident" id="5608163">x</span><span class="op" id="5608164">-</span><span class="ident" id="5608165">p</span><span class="op" id="5608166">.</span><span class="ident" id="5608167">Rect</span><span class="op" id="5608171">.</span><span class="ident" id="5608172">Min</span><span class="op" id="5608175">.</span><span class="ident" id="5608176">X</span><span class="op" id="5608177">)</span><span class="op" id="5608178">*</span><span class="num" id="5608179">1</span><br>
<span class="lineno"></span><span class="op" id="5608181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5608184">func</span>&nbsp;<span class="op" id="5608189">(</span><span class="ident" id="5608190">p</span>&nbsp;<span class="op" id="5608192">*</span><span class="ident" id="5608193">Alpha</span><span class="op" id="5608198">)</span>&nbsp;<span class="ident" id="5608200">Set</span><span class="op" id="5608203">(</span><span class="ident" id="5608204">x</span><span class="op" id="5608205">,</span>&nbsp;<span class="ident" id="5608207">y</span>&nbsp;<span class="builtintype" id="5608209">int</span><span class="op" id="5608212">,</span>&nbsp;<span class="ident" id="5608214">c</span>&nbsp;<span class="ident" id="5608216">color</span><span class="op" id="5608221">.</span><span class="ident" id="5608222">Color</span><span class="op" id="5608227">)</span>&nbsp;<span class="op" id="5608229">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608232">if</span>&nbsp;<span class="op" id="5608235">!</span><span class="op" id="5608236">(</span><span class="ident" id="5608237">Point</span><span class="op" id="5608242">{</span><span class="ident" id="5608243">x</span><span class="op" id="5608244">,</span>&nbsp;<span class="ident" id="5608246">y</span><span class="op" id="5608247">}</span><span class="op" id="5608248">.</span><span class="ident" id="5608249">In</span><span class="op" id="5608251">(</span><span class="ident" id="5608252">p</span><span class="op" id="5608253">.</span><span class="ident" id="5608254">Rect</span><span class="op" id="5608258">)</span><span class="op" id="5608259">)</span>&nbsp;<span class="op" id="5608261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608265">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608276">i</span>&nbsp;<span class="op" id="5608278">:=</span>&nbsp;<span class="ident" id="5608281">p</span><span class="op" id="5608282">.</span><span class="ident" id="5608283">PixOffset</span><span class="op" id="5608292">(</span><span class="ident" id="5608293">x</span><span class="op" id="5608294">,</span>&nbsp;<span class="ident" id="5608296">y</span><span class="op" id="5608297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608300">p</span><span class="op" id="5608301">.</span><span class="ident" id="5608302">Pix</span><span class="op" id="5608305">[</span><span class="ident" id="5608306">i</span><span class="op" id="5608307">]</span>&nbsp;<span class="op" id="5608309">=</span>&nbsp;<span class="ident" id="5608311">color</span><span class="op" id="5608316">.</span><span class="ident" id="5608317">AlphaModel</span><span class="op" id="5608327">.</span><span class="ident" id="5608328">Convert</span><span class="op" id="5608335">(</span><span class="ident" id="5608336">c</span><span class="op" id="5608337">)</span><span class="op" id="5608338">.</span><span class="op" id="5608339">(</span><span class="ident" id="5608340">color</span><span class="op" id="5608345">.</span><span class="ident" id="5608346">Alpha</span><span class="op" id="5608351">)</span><span class="op" id="5608352">.</span><span class="ident" id="5608353">A</span><br>
<span class="lineno">520</span><span class="op" id="5608355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5608358">func</span>&nbsp;<span class="op" id="5608363">(</span><span class="ident" id="5608364">p</span>&nbsp;<span class="op" id="5608366">*</span><span class="ident" id="5608367">Alpha</span><span class="op" id="5608372">)</span>&nbsp;<span class="ident" id="5608374">SetAlpha</span><span class="op" id="5608382">(</span><span class="ident" id="5608383">x</span><span class="op" id="5608384">,</span>&nbsp;<span class="ident" id="5608386">y</span>&nbsp;<span class="builtintype" id="5608388">int</span><span class="op" id="5608391">,</span>&nbsp;<span class="ident" id="5608393">c</span>&nbsp;<span class="ident" id="5608395">color</span><span class="op" id="5608400">.</span><span class="ident" id="5608401">Alpha</span><span class="op" id="5608406">)</span>&nbsp;<span class="op" id="5608408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608411">if</span>&nbsp;<span class="op" id="5608414">!</span><span class="op" id="5608415">(</span><span class="ident" id="5608416">Point</span><span class="op" id="5608421">{</span><span class="ident" id="5608422">x</span><span class="op" id="5608423">,</span>&nbsp;<span class="ident" id="5608425">y</span><span class="op" id="5608426">}</span><span class="op" id="5608427">.</span><span class="ident" id="5608428">In</span><span class="op" id="5608430">(</span><span class="ident" id="5608431">p</span><span class="op" id="5608432">.</span><span class="ident" id="5608433">Rect</span><span class="op" id="5608437">)</span><span class="op" id="5608438">)</span>&nbsp;<span class="op" id="5608440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608444">return</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608455">i</span>&nbsp;<span class="op" id="5608457">:=</span>&nbsp;<span class="ident" id="5608460">p</span><span class="op" id="5608461">.</span><span class="ident" id="5608462">PixOffset</span><span class="op" id="5608471">(</span><span class="ident" id="5608472">x</span><span class="op" id="5608473">,</span>&nbsp;<span class="ident" id="5608475">y</span><span class="op" id="5608476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608479">p</span><span class="op" id="5608480">.</span><span class="ident" id="5608481">Pix</span><span class="op" id="5608484">[</span><span class="ident" id="5608485">i</span><span class="op" id="5608486">]</span>&nbsp;<span class="op" id="5608488">=</span>&nbsp;<span class="ident" id="5608490">c</span><span class="op" id="5608491">.</span><span class="ident" id="5608492">A</span><br>
<span class="lineno"></span><span class="op" id="5608494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="5608497">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5608574">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5608646">func</span>&nbsp;<span class="op" id="5608651">(</span><span class="ident" id="5608652">p</span>&nbsp;<span class="op" id="5608654">*</span><span class="ident" id="5608655">Alpha</span><span class="op" id="5608660">)</span>&nbsp;<span class="ident" id="5608662">SubImage</span><span class="op" id="5608670">(</span><span class="ident" id="5608671">r</span>&nbsp;<span class="ident" id="5608673">Rectangle</span><span class="op" id="5608682">)</span>&nbsp;<span class="ident" id="5608684">Image</span>&nbsp;<span class="op" id="5608690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608693">r</span>&nbsp;<span class="op" id="5608695">=</span>&nbsp;<span class="ident" id="5608697">r</span><span class="op" id="5608698">.</span><span class="ident" id="5608699">Intersect</span><span class="op" id="5608708">(</span><span class="ident" id="5608709">p</span><span class="op" id="5608710">.</span><span class="ident" id="5608711">Rect</span><span class="op" id="5608715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5608718">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5608799">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5608881">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608931">if</span>&nbsp;<span class="ident" id="5608934">r</span><span class="op" id="5608935">.</span><span class="ident" id="5608936">Empty</span><span class="op" id="5608941">(</span><span class="op" id="5608942">)</span>&nbsp;<span class="op" id="5608944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608948">return</span>&nbsp;<span class="op" id="5608955">&amp;</span><span class="ident" id="5608956">Alpha</span><span class="op" id="5608961">{</span><span class="op" id="5608962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608965">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608968">i</span>&nbsp;<span class="op" id="5608970">:=</span>&nbsp;<span class="ident" id="5608973">p</span><span class="op" id="5608974">.</span><span class="ident" id="5608975">PixOffset</span><span class="op" id="5608984">(</span><span class="ident" id="5608985">r</span><span class="op" id="5608986">.</span><span class="ident" id="5608987">Min</span><span class="op" id="5608990">.</span><span class="ident" id="5608991">X</span><span class="op" id="5608992">,</span>&nbsp;<span class="ident" id="5608994">r</span><span class="op" id="5608995">.</span><span class="ident" id="5608996">Min</span><span class="op" id="5608999">.</span><span class="ident" id="5609000">Y</span><span class="op" id="5609001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609004">return</span>&nbsp;<span class="op" id="5609011">&amp;</span><span class="ident" id="5609012">Alpha</span><span class="op" id="5609017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609021">Pix</span><span class="op" id="5609024">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5609029">p</span><span class="op" id="5609030">.</span><span class="ident" id="5609031">Pix</span><span class="op" id="5609034">[</span><span class="ident" id="5609035">i</span><span class="op" id="5609036">:</span><span class="op" id="5609037">]</span><span class="op" id="5609038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609042">Stride</span><span class="op" id="5609048">:</span>&nbsp;<span class="ident" id="5609050">p</span><span class="op" id="5609051">.</span><span class="ident" id="5609052">Stride</span><span class="op" id="5609058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609062">Rect</span><span class="op" id="5609066">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5609070">r</span><span class="op" id="5609071">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609074">}</span><br>
<span class="lineno"></span><span class="op" id="5609076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5609079">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5609152">func</span>&nbsp;<span class="op" id="5609157">(</span><span class="ident" id="5609158">p</span>&nbsp;<span class="op" id="5609160">*</span><span class="ident" id="5609161">Alpha</span><span class="op" id="5609166">)</span>&nbsp;<span class="ident" id="5609168">Opaque</span><span class="op" id="5609174">(</span><span class="op" id="5609175">)</span>&nbsp;<span class="builtintype" id="5609177">bool</span>&nbsp;<span class="op" id="5609182">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609185">if</span>&nbsp;<span class="ident" id="5609188">p</span><span class="op" id="5609189">.</span><span class="ident" id="5609190">Rect</span><span class="op" id="5609194">.</span><span class="ident" id="5609195">Empty</span><span class="op" id="5609200">(</span><span class="op" id="5609201">)</span>&nbsp;<span class="op" id="5609203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609207">return</span>&nbsp;<span class="builtintype" id="5609214">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609223">i0</span><span class="op" id="5609225">,</span>&nbsp;<span class="ident" id="5609227">i1</span>&nbsp;<span class="op" id="5609230">:=</span>&nbsp;<span class="num" id="5609233">0</span><span class="op" id="5609234">,</span>&nbsp;<span class="ident" id="5609236">p</span><span class="op" id="5609237">.</span><span class="ident" id="5609238">Rect</span><span class="op" id="5609242">.</span><span class="ident" id="5609243">Dx</span><span class="op" id="5609245">(</span><span class="op" id="5609246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609249">for</span>&nbsp;<span class="ident" id="5609253">y</span>&nbsp;<span class="op" id="5609255">:=</span>&nbsp;<span class="ident" id="5609258">p</span><span class="op" id="5609259">.</span><span class="ident" id="5609260">Rect</span><span class="op" id="5609264">.</span><span class="ident" id="5609265">Min</span><span class="op" id="5609268">.</span><span class="ident" id="5609269">Y</span><span class="op" id="5609270">;</span>&nbsp;<span class="ident" id="5609272">y</span>&nbsp;<span class="op" id="5609274">&lt;</span>&nbsp;<span class="ident" id="5609276">p</span><span class="op" id="5609277">.</span><span class="ident" id="5609278">Rect</span><span class="op" id="5609282">.</span><span class="ident" id="5609283">Max</span><span class="op" id="5609286">.</span><span class="ident" id="5609287">Y</span><span class="op" id="5609288">;</span>&nbsp;<span class="ident" id="5609290">y</span><span class="op" id="5609291">++</span>&nbsp;<span class="op" id="5609294">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609298">for</span>&nbsp;<span class="ident" id="5609302">i</span>&nbsp;<span class="op" id="5609304">:=</span>&nbsp;<span class="ident" id="5609307">i0</span><span class="op" id="5609309">;</span>&nbsp;<span class="ident" id="5609311">i</span>&nbsp;<span class="op" id="5609313">&lt;</span>&nbsp;<span class="ident" id="5609315">i1</span><span class="op" id="5609317">;</span>&nbsp;<span class="ident" id="5609319">i</span><span class="op" id="5609320">++</span>&nbsp;<span class="op" id="5609323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609328">if</span>&nbsp;<span class="ident" id="5609331">p</span><span class="op" id="5609332">.</span><span class="ident" id="5609333">Pix</span><span class="op" id="5609336">[</span><span class="ident" id="5609337">i</span><span class="op" id="5609338">]</span>&nbsp;<span class="op" id="5609340">!=</span>&nbsp;<span class="num" id="5609343">0xff</span>&nbsp;<span class="op" id="5609348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609354">return</span>&nbsp;<span class="builtintype" id="5609361">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609374">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609378">i0</span>&nbsp;<span class="op" id="5609381">+=</span>&nbsp;<span class="ident" id="5609384">p</span><span class="op" id="5609385">.</span><span class="ident" id="5609386">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609395">i1</span>&nbsp;<span class="op" id="5609398">+=</span>&nbsp;<span class="ident" id="5609401">p</span><span class="op" id="5609402">.</span><span class="ident" id="5609403">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609414">return</span>&nbsp;<span class="builtintype" id="5609421">true</span><br>
<span class="lineno"></span><span class="op" id="5609426">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="5609429">//&nbsp;NewAlpha&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5609484">func</span>&nbsp;<span class="ident" id="5609489">NewAlpha</span><span class="op" id="5609497">(</span><span class="ident" id="5609498">r</span>&nbsp;<span class="ident" id="5609500">Rectangle</span><span class="op" id="5609509">)</span>&nbsp;<span class="op" id="5609511">*</span><span class="ident" id="5609512">Alpha</span>&nbsp;<span class="op" id="5609518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609521">w</span><span class="op" id="5609522">,</span>&nbsp;<span class="ident" id="5609524">h</span>&nbsp;<span class="op" id="5609526">:=</span>&nbsp;<span class="ident" id="5609529">r</span><span class="op" id="5609530">.</span><span class="ident" id="5609531">Dx</span><span class="op" id="5609533">(</span><span class="op" id="5609534">)</span><span class="op" id="5609535">,</span>&nbsp;<span class="ident" id="5609537">r</span><span class="op" id="5609538">.</span><span class="ident" id="5609539">Dy</span><span class="op" id="5609541">(</span><span class="op" id="5609542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609545">pix</span>&nbsp;<span class="op" id="5609549">:=</span>&nbsp;<span class="builtinfunc" id="5609552">make</span><span class="op" id="5609556">(</span><span class="op" id="5609557">[</span><span class="op" id="5609558">]</span><span class="builtintype" id="5609559">uint8</span><span class="op" id="5609564">,</span>&nbsp;<span class="num" id="5609566">1</span><span class="op" id="5609567">*</span><span class="ident" id="5609568">w</span><span class="op" id="5609569">*</span><span class="ident" id="5609570">h</span><span class="op" id="5609571">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609574">return</span>&nbsp;<span class="op" id="5609581">&amp;</span><span class="ident" id="5609582">Alpha</span><span class="op" id="5609587">{</span><span class="ident" id="5609588">pix</span><span class="op" id="5609591">,</span>&nbsp;<span class="num" id="5609593">1</span>&nbsp;<span class="op" id="5609595">*</span>&nbsp;<span class="ident" id="5609597">w</span><span class="op" id="5609598">,</span>&nbsp;<span class="ident" id="5609600">r</span><span class="op" id="5609601">}</span><br>
<span class="lineno"></span><span class="op" id="5609603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5609606">//&nbsp;Alpha16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5609685">type</span>&nbsp;<span class="ident" id="5609690">Alpha16</span>&nbsp;<span class="keyword" id="5609698">struct</span>&nbsp;<span class="op" id="5609705">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5609708">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5609793">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609861">Pix</span>&nbsp;<span class="op" id="5609865">[</span><span class="op" id="5609866">]</span><span class="builtintype" id="5609867">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5609874">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609950">Stride</span>&nbsp;<span class="builtintype" id="5609957">int</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5609962">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609994">Rect</span>&nbsp;<span class="ident" id="5609999">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5610009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5610012">func</span>&nbsp;<span class="op" id="5610017">(</span><span class="ident" id="5610018">p</span>&nbsp;<span class="op" id="5610020">*</span><span class="ident" id="5610021">Alpha16</span><span class="op" id="5610028">)</span>&nbsp;<span class="ident" id="5610030">ColorModel</span><span class="op" id="5610040">(</span><span class="op" id="5610041">)</span>&nbsp;<span class="ident" id="5610043">color</span><span class="op" id="5610048">.</span><span class="ident" id="5610049">Model</span>&nbsp;<span class="op" id="5610055">{</span>&nbsp;<span class="keyword" id="5610057">return</span>&nbsp;<span class="ident" id="5610064">color</span><span class="op" id="5610069">.</span><span class="ident" id="5610070">Alpha16Model</span>&nbsp;<span class="op" id="5610083">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="keyword" id="5610086">func</span>&nbsp;<span class="op" id="5610091">(</span><span class="ident" id="5610092">p</span>&nbsp;<span class="op" id="5610094">*</span><span class="ident" id="5610095">Alpha16</span><span class="op" id="5610102">)</span>&nbsp;<span class="ident" id="5610104">Bounds</span><span class="op" id="5610110">(</span><span class="op" id="5610111">)</span>&nbsp;<span class="ident" id="5610113">Rectangle</span>&nbsp;<span class="op" id="5610123">{</span>&nbsp;<span class="keyword" id="5610125">return</span>&nbsp;<span class="ident" id="5610132">p</span><span class="op" id="5610133">.</span><span class="ident" id="5610134">Rect</span>&nbsp;<span class="op" id="5610139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5610142">func</span>&nbsp;<span class="op" id="5610147">(</span><span class="ident" id="5610148">p</span>&nbsp;<span class="op" id="5610150">*</span><span class="ident" id="5610151">Alpha16</span><span class="op" id="5610158">)</span>&nbsp;<span class="ident" id="5610160">At</span><span class="op" id="5610162">(</span><span class="ident" id="5610163">x</span><span class="op" id="5610164">,</span>&nbsp;<span class="ident" id="5610166">y</span>&nbsp;<span class="builtintype" id="5610168">int</span><span class="op" id="5610171">)</span>&nbsp;<span class="ident" id="5610173">color</span><span class="op" id="5610178">.</span><span class="ident" id="5610179">Color</span>&nbsp;<span class="op" id="5610185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610188">return</span>&nbsp;<span class="ident" id="5610195">p</span><span class="op" id="5610196">.</span><span class="ident" id="5610197">Alpha16At</span><span class="op" id="5610206">(</span><span class="ident" id="5610207">x</span><span class="op" id="5610208">,</span>&nbsp;<span class="ident" id="5610210">y</span><span class="op" id="5610211">)</span><br>
<span class="lineno">590</span><span class="op" id="5610213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5610216">func</span>&nbsp;<span class="op" id="5610221">(</span><span class="ident" id="5610222">p</span>&nbsp;<span class="op" id="5610224">*</span><span class="ident" id="5610225">Alpha16</span><span class="op" id="5610232">)</span>&nbsp;<span class="ident" id="5610234">Alpha16At</span><span class="op" id="5610243">(</span><span class="ident" id="5610244">x</span><span class="op" id="5610245">,</span>&nbsp;<span class="ident" id="5610247">y</span>&nbsp;<span class="builtintype" id="5610249">int</span><span class="op" id="5610252">)</span>&nbsp;<span class="ident" id="5610254">color</span><span class="op" id="5610259">.</span><span class="ident" id="5610260">Alpha16</span>&nbsp;<span class="op" id="5610268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610271">if</span>&nbsp;<span class="op" id="5610274">!</span><span class="op" id="5610275">(</span><span class="ident" id="5610276">Point</span><span class="op" id="5610281">{</span><span class="ident" id="5610282">x</span><span class="op" id="5610283">,</span>&nbsp;<span class="ident" id="5610285">y</span><span class="op" id="5610286">}</span><span class="op" id="5610287">.</span><span class="ident" id="5610288">In</span><span class="op" id="5610290">(</span><span class="ident" id="5610291">p</span><span class="op" id="5610292">.</span><span class="ident" id="5610293">Rect</span><span class="op" id="5610297">)</span><span class="op" id="5610298">)</span>&nbsp;<span class="op" id="5610300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610304">return</span>&nbsp;<span class="ident" id="5610311">color</span><span class="op" id="5610316">.</span><span class="ident" id="5610317">Alpha16</span><span class="op" id="5610324">{</span><span class="op" id="5610325">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610331">i</span>&nbsp;<span class="op" id="5610333">:=</span>&nbsp;<span class="ident" id="5610336">p</span><span class="op" id="5610337">.</span><span class="ident" id="5610338">PixOffset</span><span class="op" id="5610347">(</span><span class="ident" id="5610348">x</span><span class="op" id="5610349">,</span>&nbsp;<span class="ident" id="5610351">y</span><span class="op" id="5610352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610355">return</span>&nbsp;<span class="ident" id="5610362">color</span><span class="op" id="5610367">.</span><span class="ident" id="5610368">Alpha16</span><span class="op" id="5610375">{</span><span class="builtintype" id="5610376">uint16</span><span class="op" id="5610382">(</span><span class="ident" id="5610383">p</span><span class="op" id="5610384">.</span><span class="ident" id="5610385">Pix</span><span class="op" id="5610388">[</span><span class="ident" id="5610389">i</span><span class="op" id="5610390">+</span><span class="num" id="5610391">0</span><span class="op" id="5610392">]</span><span class="op" id="5610393">)</span><span class="op" id="5610394">&lt;&lt;</span><span class="num" id="5610396">8</span>&nbsp;<span class="op" id="5610398">|</span>&nbsp;<span class="builtintype" id="5610400">uint16</span><span class="op" id="5610406">(</span><span class="ident" id="5610407">p</span><span class="op" id="5610408">.</span><span class="ident" id="5610409">Pix</span><span class="op" id="5610412">[</span><span class="ident" id="5610413">i</span><span class="op" id="5610414">+</span><span class="num" id="5610415">1</span><span class="op" id="5610416">]</span><span class="op" id="5610417">)</span><span class="op" id="5610418">}</span><br>
<span class="lineno"></span><span class="op" id="5610420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="5610423">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5610502">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5610526">func</span>&nbsp;<span class="op" id="5610531">(</span><span class="ident" id="5610532">p</span>&nbsp;<span class="op" id="5610534">*</span><span class="ident" id="5610535">Alpha16</span><span class="op" id="5610542">)</span>&nbsp;<span class="ident" id="5610544">PixOffset</span><span class="op" id="5610553">(</span><span class="ident" id="5610554">x</span><span class="op" id="5610555">,</span>&nbsp;<span class="ident" id="5610557">y</span>&nbsp;<span class="builtintype" id="5610559">int</span><span class="op" id="5610562">)</span>&nbsp;<span class="builtintype" id="5610564">int</span>&nbsp;<span class="op" id="5610568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610571">return</span>&nbsp;<span class="op" id="5610578">(</span><span class="ident" id="5610579">y</span><span class="op" id="5610580">-</span><span class="ident" id="5610581">p</span><span class="op" id="5610582">.</span><span class="ident" id="5610583">Rect</span><span class="op" id="5610587">.</span><span class="ident" id="5610588">Min</span><span class="op" id="5610591">.</span><span class="ident" id="5610592">Y</span><span class="op" id="5610593">)</span><span class="op" id="5610594">*</span><span class="ident" id="5610595">p</span><span class="op" id="5610596">.</span><span class="ident" id="5610597">Stride</span>&nbsp;<span class="op" id="5610604">+</span>&nbsp;<span class="op" id="5610606">(</span><span class="ident" id="5610607">x</span><span class="op" id="5610608">-</span><span class="ident" id="5610609">p</span><span class="op" id="5610610">.</span><span class="ident" id="5610611">Rect</span><span class="op" id="5610615">.</span><span class="ident" id="5610616">Min</span><span class="op" id="5610619">.</span><span class="ident" id="5610620">X</span><span class="op" id="5610621">)</span><span class="op" id="5610622">*</span><span class="num" id="5610623">2</span><br>
<span class="lineno"></span><span class="op" id="5610625">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="keyword" id="5610628">func</span>&nbsp;<span class="op" id="5610633">(</span><span class="ident" id="5610634">p</span>&nbsp;<span class="op" id="5610636">*</span><span class="ident" id="5610637">Alpha16</span><span class="op" id="5610644">)</span>&nbsp;<span class="ident" id="5610646">Set</span><span class="op" id="5610649">(</span><span class="ident" id="5610650">x</span><span class="op" id="5610651">,</span>&nbsp;<span class="ident" id="5610653">y</span>&nbsp;<span class="builtintype" id="5610655">int</span><span class="op" id="5610658">,</span>&nbsp;<span class="ident" id="5610660">c</span>&nbsp;<span class="ident" id="5610662">color</span><span class="op" id="5610667">.</span><span class="ident" id="5610668">Color</span><span class="op" id="5610673">)</span>&nbsp;<span class="op" id="5610675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610678">if</span>&nbsp;<span class="op" id="5610681">!</span><span class="op" id="5610682">(</span><span class="ident" id="5610683">Point</span><span class="op" id="5610688">{</span><span class="ident" id="5610689">x</span><span class="op" id="5610690">,</span>&nbsp;<span class="ident" id="5610692">y</span><span class="op" id="5610693">}</span><span class="op" id="5610694">.</span><span class="ident" id="5610695">In</span><span class="op" id="5610697">(</span><span class="ident" id="5610698">p</span><span class="op" id="5610699">.</span><span class="ident" id="5610700">Rect</span><span class="op" id="5610704">)</span><span class="op" id="5610705">)</span>&nbsp;<span class="op" id="5610707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610711">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610719">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610722">i</span>&nbsp;<span class="op" id="5610724">:=</span>&nbsp;<span class="ident" id="5610727">p</span><span class="op" id="5610728">.</span><span class="ident" id="5610729">PixOffset</span><span class="op" id="5610738">(</span><span class="ident" id="5610739">x</span><span class="op" id="5610740">,</span>&nbsp;<span class="ident" id="5610742">y</span><span class="op" id="5610743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610746">c1</span>&nbsp;<span class="op" id="5610749">:=</span>&nbsp;<span class="ident" id="5610752">color</span><span class="op" id="5610757">.</span><span class="ident" id="5610758">Alpha16Model</span><span class="op" id="5610770">.</span><span class="ident" id="5610771">Convert</span><span class="op" id="5610778">(</span><span class="ident" id="5610779">c</span><span class="op" id="5610780">)</span><span class="op" id="5610781">.</span><span class="op" id="5610782">(</span><span class="ident" id="5610783">color</span><span class="op" id="5610788">.</span><span class="ident" id="5610789">Alpha16</span><span class="op" id="5610796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610799">p</span><span class="op" id="5610800">.</span><span class="ident" id="5610801">Pix</span><span class="op" id="5610804">[</span><span class="ident" id="5610805">i</span><span class="op" id="5610806">+</span><span class="num" id="5610807">0</span><span class="op" id="5610808">]</span>&nbsp;<span class="op" id="5610810">=</span>&nbsp;<span class="builtintype" id="5610812">uint8</span><span class="op" id="5610817">(</span><span class="ident" id="5610818">c1</span><span class="op" id="5610820">.</span><span class="ident" id="5610821">A</span>&nbsp;<span class="op" id="5610823">&gt;&gt;</span>&nbsp;<span class="num" id="5610826">8</span><span class="op" id="5610827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610830">p</span><span class="op" id="5610831">.</span><span class="ident" id="5610832">Pix</span><span class="op" id="5610835">[</span><span class="ident" id="5610836">i</span><span class="op" id="5610837">+</span><span class="num" id="5610838">1</span><span class="op" id="5610839">]</span>&nbsp;<span class="op" id="5610841">=</span>&nbsp;<span class="builtintype" id="5610843">uint8</span><span class="op" id="5610848">(</span><span class="ident" id="5610849">c1</span><span class="op" id="5610851">.</span><span class="ident" id="5610852">A</span><span class="op" id="5610853">)</span><br>
<span class="lineno"></span><span class="op" id="5610855">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="5610858">func</span>&nbsp;<span class="op" id="5610863">(</span><span class="ident" id="5610864">p</span>&nbsp;<span class="op" id="5610866">*</span><span class="ident" id="5610867">Alpha16</span><span class="op" id="5610874">)</span>&nbsp;<span class="ident" id="5610876">SetAlpha16</span><span class="op" id="5610886">(</span><span class="ident" id="5610887">x</span><span class="op" id="5610888">,</span>&nbsp;<span class="ident" id="5610890">y</span>&nbsp;<span class="builtintype" id="5610892">int</span><span class="op" id="5610895">,</span>&nbsp;<span class="ident" id="5610897">c</span>&nbsp;<span class="ident" id="5610899">color</span><span class="op" id="5610904">.</span><span class="ident" id="5610905">Alpha16</span><span class="op" id="5610912">)</span>&nbsp;<span class="op" id="5610914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610917">if</span>&nbsp;<span class="op" id="5610920">!</span><span class="op" id="5610921">(</span><span class="ident" id="5610922">Point</span><span class="op" id="5610927">{</span><span class="ident" id="5610928">x</span><span class="op" id="5610929">,</span>&nbsp;<span class="ident" id="5610931">y</span><span class="op" id="5610932">}</span><span class="op" id="5610933">.</span><span class="ident" id="5610934">In</span><span class="op" id="5610936">(</span><span class="ident" id="5610937">p</span><span class="op" id="5610938">.</span><span class="ident" id="5610939">Rect</span><span class="op" id="5610943">)</span><span class="op" id="5610944">)</span>&nbsp;<span class="op" id="5610946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610950">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610958">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610961">i</span>&nbsp;<span class="op" id="5610963">:=</span>&nbsp;<span class="ident" id="5610966">p</span><span class="op" id="5610967">.</span><span class="ident" id="5610968">PixOffset</span><span class="op" id="5610977">(</span><span class="ident" id="5610978">x</span><span class="op" id="5610979">,</span>&nbsp;<span class="ident" id="5610981">y</span><span class="op" id="5610982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610985">p</span><span class="op" id="5610986">.</span><span class="ident" id="5610987">Pix</span><span class="op" id="5610990">[</span><span class="ident" id="5610991">i</span><span class="op" id="5610992">+</span><span class="num" id="5610993">0</span><span class="op" id="5610994">]</span>&nbsp;<span class="op" id="5610996">=</span>&nbsp;<span class="builtintype" id="5610998">uint8</span><span class="op" id="5611003">(</span><span class="ident" id="5611004">c</span><span class="op" id="5611005">.</span><span class="ident" id="5611006">A</span>&nbsp;<span class="op" id="5611008">&gt;&gt;</span>&nbsp;<span class="num" id="5611011">8</span><span class="op" id="5611012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611015">p</span><span class="op" id="5611016">.</span><span class="ident" id="5611017">Pix</span><span class="op" id="5611020">[</span><span class="ident" id="5611021">i</span><span class="op" id="5611022">+</span><span class="num" id="5611023">1</span><span class="op" id="5611024">]</span>&nbsp;<span class="op" id="5611026">=</span>&nbsp;<span class="builtintype" id="5611028">uint8</span><span class="op" id="5611033">(</span><span class="ident" id="5611034">c</span><span class="op" id="5611035">.</span><span class="ident" id="5611036">A</span><span class="op" id="5611037">)</span><br>
<span class="lineno"></span><span class="op" id="5611039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="5611042">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5611119">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5611191">func</span>&nbsp;<span class="op" id="5611196">(</span><span class="ident" id="5611197">p</span>&nbsp;<span class="op" id="5611199">*</span><span class="ident" id="5611200">Alpha16</span><span class="op" id="5611207">)</span>&nbsp;<span class="ident" id="5611209">SubImage</span><span class="op" id="5611217">(</span><span class="ident" id="5611218">r</span>&nbsp;<span class="ident" id="5611220">Rectangle</span><span class="op" id="5611229">)</span>&nbsp;<span class="ident" id="5611231">Image</span>&nbsp;<span class="op" id="5611237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611240">r</span>&nbsp;<span class="op" id="5611242">=</span>&nbsp;<span class="ident" id="5611244">r</span><span class="op" id="5611245">.</span><span class="ident" id="5611246">Intersect</span><span class="op" id="5611255">(</span><span class="ident" id="5611256">p</span><span class="op" id="5611257">.</span><span class="ident" id="5611258">Rect</span><span class="op" id="5611262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5611265">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5611346">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5611428">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611478">if</span>&nbsp;<span class="ident" id="5611481">r</span><span class="op" id="5611482">.</span><span class="ident" id="5611483">Empty</span><span class="op" id="5611488">(</span><span class="op" id="5611489">)</span>&nbsp;<span class="op" id="5611491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611495">return</span>&nbsp;<span class="op" id="5611502">&amp;</span><span class="ident" id="5611503">Alpha16</span><span class="op" id="5611510">{</span><span class="op" id="5611511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611514">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611517">i</span>&nbsp;<span class="op" id="5611519">:=</span>&nbsp;<span class="ident" id="5611522">p</span><span class="op" id="5611523">.</span><span class="ident" id="5611524">PixOffset</span><span class="op" id="5611533">(</span><span class="ident" id="5611534">r</span><span class="op" id="5611535">.</span><span class="ident" id="5611536">Min</span><span class="op" id="5611539">.</span><span class="ident" id="5611540">X</span><span class="op" id="5611541">,</span>&nbsp;<span class="ident" id="5611543">r</span><span class="op" id="5611544">.</span><span class="ident" id="5611545">Min</span><span class="op" id="5611548">.</span><span class="ident" id="5611549">Y</span><span class="op" id="5611550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611553">return</span>&nbsp;<span class="op" id="5611560">&amp;</span><span class="ident" id="5611561">Alpha16</span><span class="op" id="5611568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611572">Pix</span><span class="op" id="5611575">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5611580">p</span><span class="op" id="5611581">.</span><span class="ident" id="5611582">Pix</span><span class="op" id="5611585">[</span><span class="ident" id="5611586">i</span><span class="op" id="5611587">:</span><span class="op" id="5611588">]</span><span class="op" id="5611589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611593">Stride</span><span class="op" id="5611599">:</span>&nbsp;<span class="ident" id="5611601">p</span><span class="op" id="5611602">.</span><span class="ident" id="5611603">Stride</span><span class="op" id="5611609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611613">Rect</span><span class="op" id="5611617">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5611621">r</span><span class="op" id="5611622">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611625">}</span><br>
<span class="lineno"></span><span class="op" id="5611627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5611630">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5611703">func</span>&nbsp;<span class="op" id="5611708">(</span><span class="ident" id="5611709">p</span>&nbsp;<span class="op" id="5611711">*</span><span class="ident" id="5611712">Alpha16</span><span class="op" id="5611719">)</span>&nbsp;<span class="ident" id="5611721">Opaque</span><span class="op" id="5611727">(</span><span class="op" id="5611728">)</span>&nbsp;<span class="builtintype" id="5611730">bool</span>&nbsp;<span class="op" id="5611735">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611738">if</span>&nbsp;<span class="ident" id="5611741">p</span><span class="op" id="5611742">.</span><span class="ident" id="5611743">Rect</span><span class="op" id="5611747">.</span><span class="ident" id="5611748">Empty</span><span class="op" id="5611753">(</span><span class="op" id="5611754">)</span>&nbsp;<span class="op" id="5611756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611760">return</span>&nbsp;<span class="builtintype" id="5611767">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611776">i0</span><span class="op" id="5611778">,</span>&nbsp;<span class="ident" id="5611780">i1</span>&nbsp;<span class="op" id="5611783">:=</span>&nbsp;<span class="num" id="5611786">0</span><span class="op" id="5611787">,</span>&nbsp;<span class="ident" id="5611789">p</span><span class="op" id="5611790">.</span><span class="ident" id="5611791">Rect</span><span class="op" id="5611795">.</span><span class="ident" id="5611796">Dx</span><span class="op" id="5611798">(</span><span class="op" id="5611799">)</span><span class="op" id="5611800">*</span><span class="num" id="5611801">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611804">for</span>&nbsp;<span class="ident" id="5611808">y</span>&nbsp;<span class="op" id="5611810">:=</span>&nbsp;<span class="ident" id="5611813">p</span><span class="op" id="5611814">.</span><span class="ident" id="5611815">Rect</span><span class="op" id="5611819">.</span><span class="ident" id="5611820">Min</span><span class="op" id="5611823">.</span><span class="ident" id="5611824">Y</span><span class="op" id="5611825">;</span>&nbsp;<span class="ident" id="5611827">y</span>&nbsp;<span class="op" id="5611829">&lt;</span>&nbsp;<span class="ident" id="5611831">p</span><span class="op" id="5611832">.</span><span class="ident" id="5611833">Rect</span><span class="op" id="5611837">.</span><span class="ident" id="5611838">Max</span><span class="op" id="5611841">.</span><span class="ident" id="5611842">Y</span><span class="op" id="5611843">;</span>&nbsp;<span class="ident" id="5611845">y</span><span class="op" id="5611846">++</span>&nbsp;<span class="op" id="5611849">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611853">for</span>&nbsp;<span class="ident" id="5611857">i</span>&nbsp;<span class="op" id="5611859">:=</span>&nbsp;<span class="ident" id="5611862">i0</span><span class="op" id="5611864">;</span>&nbsp;<span class="ident" id="5611866">i</span>&nbsp;<span class="op" id="5611868">&lt;</span>&nbsp;<span class="ident" id="5611870">i1</span><span class="op" id="5611872">;</span>&nbsp;<span class="ident" id="5611874">i</span>&nbsp;<span class="op" id="5611876">+=</span>&nbsp;<span class="num" id="5611879">2</span>&nbsp;<span class="op" id="5611881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611886">if</span>&nbsp;<span class="ident" id="5611889">p</span><span class="op" id="5611890">.</span><span class="ident" id="5611891">Pix</span><span class="op" id="5611894">[</span><span class="ident" id="5611895">i</span><span class="op" id="5611896">+</span><span class="num" id="5611897">0</span><span class="op" id="5611898">]</span>&nbsp;<span class="op" id="5611900">!=</span>&nbsp;<span class="num" id="5611903">0xff</span>&nbsp;<span class="op" id="5611908">||</span>&nbsp;<span class="ident" id="5611911">p</span><span class="op" id="5611912">.</span><span class="ident" id="5611913">Pix</span><span class="op" id="5611916">[</span><span class="ident" id="5611917">i</span><span class="op" id="5611918">+</span><span class="num" id="5611919">1</span><span class="op" id="5611920">]</span>&nbsp;<span class="op" id="5611922">!=</span>&nbsp;<span class="num" id="5611925">0xff</span>&nbsp;<span class="op" id="5611930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611936">return</span>&nbsp;<span class="builtintype" id="5611943">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611956">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611960">i0</span>&nbsp;<span class="op" id="5611963">+=</span>&nbsp;<span class="ident" id="5611966">p</span><span class="op" id="5611967">.</span><span class="ident" id="5611968">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611977">i1</span>&nbsp;<span class="op" id="5611980">+=</span>&nbsp;<span class="ident" id="5611983">p</span><span class="op" id="5611984">.</span><span class="ident" id="5611985">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611996">return</span>&nbsp;<span class="builtintype" id="5612003">true</span><br>
<span class="lineno"></span><span class="op" id="5612008">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="5612011">//&nbsp;NewAlpha16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5612070">func</span>&nbsp;<span class="ident" id="5612075">NewAlpha16</span><span class="op" id="5612085">(</span><span class="ident" id="5612086">r</span>&nbsp;<span class="ident" id="5612088">Rectangle</span><span class="op" id="5612097">)</span>&nbsp;<span class="op" id="5612099">*</span><span class="ident" id="5612100">Alpha16</span>&nbsp;<span class="op" id="5612108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612111">w</span><span class="op" id="5612112">,</span>&nbsp;<span class="ident" id="5612114">h</span>&nbsp;<span class="op" id="5612116">:=</span>&nbsp;<span class="ident" id="5612119">r</span><span class="op" id="5612120">.</span><span class="ident" id="5612121">Dx</span><span class="op" id="5612123">(</span><span class="op" id="5612124">)</span><span class="op" id="5612125">,</span>&nbsp;<span class="ident" id="5612127">r</span><span class="op" id="5612128">.</span><span class="ident" id="5612129">Dy</span><span class="op" id="5612131">(</span><span class="op" id="5612132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612135">pix</span>&nbsp;<span class="op" id="5612139">:=</span>&nbsp;<span class="builtinfunc" id="5612142">make</span><span class="op" id="5612146">(</span><span class="op" id="5612147">[</span><span class="op" id="5612148">]</span><span class="builtintype" id="5612149">uint8</span><span class="op" id="5612154">,</span>&nbsp;<span class="num" id="5612156">2</span><span class="op" id="5612157">*</span><span class="ident" id="5612158">w</span><span class="op" id="5612159">*</span><span class="ident" id="5612160">h</span><span class="op" id="5612161">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612164">return</span>&nbsp;<span class="op" id="5612171">&amp;</span><span class="ident" id="5612172">Alpha16</span><span class="op" id="5612179">{</span><span class="ident" id="5612180">pix</span><span class="op" id="5612183">,</span>&nbsp;<span class="num" id="5612185">2</span>&nbsp;<span class="op" id="5612187">*</span>&nbsp;<span class="ident" id="5612189">w</span><span class="op" id="5612190">,</span>&nbsp;<span class="ident" id="5612192">r</span><span class="op" id="5612193">}</span><br>
<span class="lineno"></span><span class="op" id="5612195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5612198">//&nbsp;Gray&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5612271">type</span>&nbsp;<span class="ident" id="5612276">Gray</span>&nbsp;<span class="keyword" id="5612281">struct</span>&nbsp;<span class="op" id="5612288">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5612291">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5612354">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612422">Pix</span>&nbsp;<span class="op" id="5612426">[</span><span class="op" id="5612427">]</span><span class="builtintype" id="5612428">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5612435">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612511">Stride</span>&nbsp;<span class="builtintype" id="5612518">int</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5612523">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612555">Rect</span>&nbsp;<span class="ident" id="5612560">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5612570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5612573">func</span>&nbsp;<span class="op" id="5612578">(</span><span class="ident" id="5612579">p</span>&nbsp;<span class="op" id="5612581">*</span><span class="ident" id="5612582">Gray</span><span class="op" id="5612586">)</span>&nbsp;<span class="ident" id="5612588">ColorModel</span><span class="op" id="5612598">(</span><span class="op" id="5612599">)</span>&nbsp;<span class="ident" id="5612601">color</span><span class="op" id="5612606">.</span><span class="ident" id="5612607">Model</span>&nbsp;<span class="op" id="5612613">{</span>&nbsp;<span class="keyword" id="5612615">return</span>&nbsp;<span class="ident" id="5612622">color</span><span class="op" id="5612627">.</span><span class="ident" id="5612628">GrayModel</span>&nbsp;<span class="op" id="5612638">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="5612641">func</span>&nbsp;<span class="op" id="5612646">(</span><span class="ident" id="5612647">p</span>&nbsp;<span class="op" id="5612649">*</span><span class="ident" id="5612650">Gray</span><span class="op" id="5612654">)</span>&nbsp;<span class="ident" id="5612656">Bounds</span><span class="op" id="5612662">(</span><span class="op" id="5612663">)</span>&nbsp;<span class="ident" id="5612665">Rectangle</span>&nbsp;<span class="op" id="5612675">{</span>&nbsp;<span class="keyword" id="5612677">return</span>&nbsp;<span class="ident" id="5612684">p</span><span class="op" id="5612685">.</span><span class="ident" id="5612686">Rect</span>&nbsp;<span class="op" id="5612691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5612694">func</span>&nbsp;<span class="op" id="5612699">(</span><span class="ident" id="5612700">p</span>&nbsp;<span class="op" id="5612702">*</span><span class="ident" id="5612703">Gray</span><span class="op" id="5612707">)</span>&nbsp;<span class="ident" id="5612709">At</span><span class="op" id="5612711">(</span><span class="ident" id="5612712">x</span><span class="op" id="5612713">,</span>&nbsp;<span class="ident" id="5612715">y</span>&nbsp;<span class="builtintype" id="5612717">int</span><span class="op" id="5612720">)</span>&nbsp;<span class="ident" id="5612722">color</span><span class="op" id="5612727">.</span><span class="ident" id="5612728">Color</span>&nbsp;<span class="op" id="5612734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612737">return</span>&nbsp;<span class="ident" id="5612744">p</span><span class="op" id="5612745">.</span><span class="ident" id="5612746">GrayAt</span><span class="op" id="5612752">(</span><span class="ident" id="5612753">x</span><span class="op" id="5612754">,</span>&nbsp;<span class="ident" id="5612756">y</span><span class="op" id="5612757">)</span><br>
<span class="lineno">685</span><span class="op" id="5612759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5612762">func</span>&nbsp;<span class="op" id="5612767">(</span><span class="ident" id="5612768">p</span>&nbsp;<span class="op" id="5612770">*</span><span class="ident" id="5612771">Gray</span><span class="op" id="5612775">)</span>&nbsp;<span class="ident" id="5612777">GrayAt</span><span class="op" id="5612783">(</span><span class="ident" id="5612784">x</span><span class="op" id="5612785">,</span>&nbsp;<span class="ident" id="5612787">y</span>&nbsp;<span class="builtintype" id="5612789">int</span><span class="op" id="5612792">)</span>&nbsp;<span class="ident" id="5612794">color</span><span class="op" id="5612799">.</span><span class="ident" id="5612800">Gray</span>&nbsp;<span class="op" id="5612805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612808">if</span>&nbsp;<span class="op" id="5612811">!</span><span class="op" id="5612812">(</span><span class="ident" id="5612813">Point</span><span class="op" id="5612818">{</span><span class="ident" id="5612819">x</span><span class="op" id="5612820">,</span>&nbsp;<span class="ident" id="5612822">y</span><span class="op" id="5612823">}</span><span class="op" id="5612824">.</span><span class="ident" id="5612825">In</span><span class="op" id="5612827">(</span><span class="ident" id="5612828">p</span><span class="op" id="5612829">.</span><span class="ident" id="5612830">Rect</span><span class="op" id="5612834">)</span><span class="op" id="5612835">)</span>&nbsp;<span class="op" id="5612837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612841">return</span>&nbsp;<span class="ident" id="5612848">color</span><span class="op" id="5612853">.</span><span class="ident" id="5612854">Gray</span><span class="op" id="5612858">{</span><span class="op" id="5612859">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612865">i</span>&nbsp;<span class="op" id="5612867">:=</span>&nbsp;<span class="ident" id="5612870">p</span><span class="op" id="5612871">.</span><span class="ident" id="5612872">PixOffset</span><span class="op" id="5612881">(</span><span class="ident" id="5612882">x</span><span class="op" id="5612883">,</span>&nbsp;<span class="ident" id="5612885">y</span><span class="op" id="5612886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612889">return</span>&nbsp;<span class="ident" id="5612896">color</span><span class="op" id="5612901">.</span><span class="ident" id="5612902">Gray</span><span class="op" id="5612906">{</span><span class="ident" id="5612907">p</span><span class="op" id="5612908">.</span><span class="ident" id="5612909">Pix</span><span class="op" id="5612912">[</span><span class="ident" id="5612913">i</span><span class="op" id="5612914">]</span><span class="op" id="5612915">}</span><br>
<span class="lineno"></span><span class="op" id="5612917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="5612920">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5612999">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5613023">func</span>&nbsp;<span class="op" id="5613028">(</span><span class="ident" id="5613029">p</span>&nbsp;<span class="op" id="5613031">*</span><span class="ident" id="5613032">Gray</span><span class="op" id="5613036">)</span>&nbsp;<span class="ident" id="5613038">PixOffset</span><span class="op" id="5613047">(</span><span class="ident" id="5613048">x</span><span class="op" id="5613049">,</span>&nbsp;<span class="ident" id="5613051">y</span>&nbsp;<span class="builtintype" id="5613053">int</span><span class="op" id="5613056">)</span>&nbsp;<span class="builtintype" id="5613058">int</span>&nbsp;<span class="op" id="5613062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613065">return</span>&nbsp;<span class="op" id="5613072">(</span><span class="ident" id="5613073">y</span><span class="op" id="5613074">-</span><span class="ident" id="5613075">p</span><span class="op" id="5613076">.</span><span class="ident" id="5613077">Rect</span><span class="op" id="5613081">.</span><span class="ident" id="5613082">Min</span><span class="op" id="5613085">.</span><span class="ident" id="5613086">Y</span><span class="op" id="5613087">)</span><span class="op" id="5613088">*</span><span class="ident" id="5613089">p</span><span class="op" id="5613090">.</span><span class="ident" id="5613091">Stride</span>&nbsp;<span class="op" id="5613098">+</span>&nbsp;<span class="op" id="5613100">(</span><span class="ident" id="5613101">x</span><span class="op" id="5613102">-</span><span class="ident" id="5613103">p</span><span class="op" id="5613104">.</span><span class="ident" id="5613105">Rect</span><span class="op" id="5613109">.</span><span class="ident" id="5613110">Min</span><span class="op" id="5613113">.</span><span class="ident" id="5613114">X</span><span class="op" id="5613115">)</span><span class="op" id="5613116">*</span><span class="num" id="5613117">1</span><br>
<span class="lineno"></span><span class="op" id="5613119">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="5613122">func</span>&nbsp;<span class="op" id="5613127">(</span><span class="ident" id="5613128">p</span>&nbsp;<span class="op" id="5613130">*</span><span class="ident" id="5613131">Gray</span><span class="op" id="5613135">)</span>&nbsp;<span class="ident" id="5613137">Set</span><span class="op" id="5613140">(</span><span class="ident" id="5613141">x</span><span class="op" id="5613142">,</span>&nbsp;<span class="ident" id="5613144">y</span>&nbsp;<span class="builtintype" id="5613146">int</span><span class="op" id="5613149">,</span>&nbsp;<span class="ident" id="5613151">c</span>&nbsp;<span class="ident" id="5613153">color</span><span class="op" id="5613158">.</span><span class="ident" id="5613159">Color</span><span class="op" id="5613164">)</span>&nbsp;<span class="op" id="5613166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613169">if</span>&nbsp;<span class="op" id="5613172">!</span><span class="op" id="5613173">(</span><span class="ident" id="5613174">Point</span><span class="op" id="5613179">{</span><span class="ident" id="5613180">x</span><span class="op" id="5613181">,</span>&nbsp;<span class="ident" id="5613183">y</span><span class="op" id="5613184">}</span><span class="op" id="5613185">.</span><span class="ident" id="5613186">In</span><span class="op" id="5613188">(</span><span class="ident" id="5613189">p</span><span class="op" id="5613190">.</span><span class="ident" id="5613191">Rect</span><span class="op" id="5613195">)</span><span class="op" id="5613196">)</span>&nbsp;<span class="op" id="5613198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613202">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5613210">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613213">i</span>&nbsp;<span class="op" id="5613215">:=</span>&nbsp;<span class="ident" id="5613218">p</span><span class="op" id="5613219">.</span><span class="ident" id="5613220">PixOffset</span><span class="op" id="5613229">(</span><span class="ident" id="5613230">x</span><span class="op" id="5613231">,</span>&nbsp;<span class="ident" id="5613233">y</span><span class="op" id="5613234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613237">p</span><span class="op" id="5613238">.</span><span class="ident" id="5613239">Pix</span><span class="op" id="5613242">[</span><span class="ident" id="5613243">i</span><span class="op" id="5613244">]</span>&nbsp;<span class="op" id="5613246">=</span>&nbsp;<span class="ident" id="5613248">color</span><span class="op" id="5613253">.</span><span class="ident" id="5613254">GrayModel</span><span class="op" id="5613263">.</span><span class="ident" id="5613264">Convert</span><span class="op" id="5613271">(</span><span class="ident" id="5613272">c</span><span class="op" id="5613273">)</span><span class="op" id="5613274">.</span><span class="op" id="5613275">(</span><span class="ident" id="5613276">color</span><span class="op" id="5613281">.</span><span class="ident" id="5613282">Gray</span><span class="op" id="5613286">)</span><span class="op" id="5613287">.</span><span class="ident" id="5613288">Y</span><br>
<span class="lineno"></span><span class="op" id="5613290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5613293">func</span>&nbsp;<span class="op" id="5613298">(</span><span class="ident" id="5613299">p</span>&nbsp;<span class="op" id="5613301">*</span><span class="ident" id="5613302">Gray</span><span class="op" id="5613306">)</span>&nbsp;<span class="ident" id="5613308">SetGray</span><span class="op" id="5613315">(</span><span class="ident" id="5613316">x</span><span class="op" id="5613317">,</span>&nbsp;<span class="ident" id="5613319">y</span>&nbsp;<span class="builtintype" id="5613321">int</span><span class="op" id="5613324">,</span>&nbsp;<span class="ident" id="5613326">c</span>&nbsp;<span class="ident" id="5613328">color</span><span class="op" id="5613333">.</span><span class="ident" id="5613334">Gray</span><span class="op" id="5613338">)</span>&nbsp;<span class="op" id="5613340">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613343">if</span>&nbsp;<span class="op" id="5613346">!</span><span class="op" id="5613347">(</span><span class="ident" id="5613348">Point</span><span class="op" id="5613353">{</span><span class="ident" id="5613354">x</span><span class="op" id="5613355">,</span>&nbsp;<span class="ident" id="5613357">y</span><span class="op" id="5613358">}</span><span class="op" id="5613359">.</span><span class="ident" id="5613360">In</span><span class="op" id="5613362">(</span><span class="ident" id="5613363">p</span><span class="op" id="5613364">.</span><span class="ident" id="5613365">Rect</span><span class="op" id="5613369">)</span><span class="op" id="5613370">)</span>&nbsp;<span class="op" id="5613372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613376">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5613384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613387">i</span>&nbsp;<span class="op" id="5613389">:=</span>&nbsp;<span class="ident" id="5613392">p</span><span class="op" id="5613393">.</span><span class="ident" id="5613394">PixOffset</span><span class="op" id="5613403">(</span><span class="ident" id="5613404">x</span><span class="op" id="5613405">,</span>&nbsp;<span class="ident" id="5613407">y</span><span class="op" id="5613408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613411">p</span><span class="op" id="5613412">.</span><span class="ident" id="5613413">Pix</span><span class="op" id="5613416">[</span><span class="ident" id="5613417">i</span><span class="op" id="5613418">]</span>&nbsp;<span class="op" id="5613420">=</span>&nbsp;<span class="ident" id="5613422">c</span><span class="op" id="5613423">.</span><span class="ident" id="5613424">Y</span><br>
<span class="lineno">715</span><span class="op" id="5613426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5613429">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5613506">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5613578">func</span>&nbsp;<span class="op" id="5613583">(</span><span class="ident" id="5613584">p</span>&nbsp;<span class="op" id="5613586">*</span><span class="ident" id="5613587">Gray</span><span class="op" id="5613591">)</span>&nbsp;<span class="ident" id="5613593">SubImage</span><span class="op" id="5613601">(</span><span class="ident" id="5613602">r</span>&nbsp;<span class="ident" id="5613604">Rectangle</span><span class="op" id="5613613">)</span>&nbsp;<span class="ident" id="5613615">Image</span>&nbsp;<span class="op" id="5613621">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613624">r</span>&nbsp;<span class="op" id="5613626">=</span>&nbsp;<span class="ident" id="5613628">r</span><span class="op" id="5613629">.</span><span class="ident" id="5613630">Intersect</span><span class="op" id="5613639">(</span><span class="ident" id="5613640">p</span><span class="op" id="5613641">.</span><span class="ident" id="5613642">Rect</span><span class="op" id="5613646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5613649">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5613730">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5613812">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613862">if</span>&nbsp;<span class="ident" id="5613865">r</span><span class="op" id="5613866">.</span><span class="ident" id="5613867">Empty</span><span class="op" id="5613872">(</span><span class="op" id="5613873">)</span>&nbsp;<span class="op" id="5613875">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613879">return</span>&nbsp;<span class="op" id="5613886">&amp;</span><span class="ident" id="5613887">Gray</span><span class="op" id="5613891">{</span><span class="op" id="5613892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5613895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613898">i</span>&nbsp;<span class="op" id="5613900">:=</span>&nbsp;<span class="ident" id="5613903">p</span><span class="op" id="5613904">.</span><span class="ident" id="5613905">PixOffset</span><span class="op" id="5613914">(</span><span class="ident" id="5613915">r</span><span class="op" id="5613916">.</span><span class="ident" id="5613917">Min</span><span class="op" id="5613920">.</span><span class="ident" id="5613921">X</span><span class="op" id="5613922">,</span>&nbsp;<span class="ident" id="5613924">r</span><span class="op" id="5613925">.</span><span class="ident" id="5613926">Min</span><span class="op" id="5613929">.</span><span class="ident" id="5613930">Y</span><span class="op" id="5613931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613934">return</span>&nbsp;<span class="op" id="5613941">&amp;</span><span class="ident" id="5613942">Gray</span><span class="op" id="5613946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613950">Pix</span><span class="op" id="5613953">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5613958">p</span><span class="op" id="5613959">.</span><span class="ident" id="5613960">Pix</span><span class="op" id="5613963">[</span><span class="ident" id="5613964">i</span><span class="op" id="5613965">:</span><span class="op" id="5613966">]</span><span class="op" id="5613967">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613971">Stride</span><span class="op" id="5613977">:</span>&nbsp;<span class="ident" id="5613979">p</span><span class="op" id="5613980">.</span><span class="ident" id="5613981">Stride</span><span class="op" id="5613987">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613991">Rect</span><span class="op" id="5613995">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5613999">r</span><span class="op" id="5614000">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5614003">}</span><br>
<span class="lineno"></span><span class="op" id="5614005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span><span class="comment" id="5614008">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5614081">func</span>&nbsp;<span class="op" id="5614086">(</span><span class="ident" id="5614087">p</span>&nbsp;<span class="op" id="5614089">*</span><span class="ident" id="5614090">Gray</span><span class="op" id="5614094">)</span>&nbsp;<span class="ident" id="5614096">Opaque</span><span class="op" id="5614102">(</span><span class="op" id="5614103">)</span>&nbsp;<span class="builtintype" id="5614105">bool</span>&nbsp;<span class="op" id="5614110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614113">return</span>&nbsp;<span class="builtintype" id="5614120">true</span><br>
<span class="lineno"></span><span class="op" id="5614125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="5614128">//&nbsp;NewGray&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5614181">func</span>&nbsp;<span class="ident" id="5614186">NewGray</span><span class="op" id="5614193">(</span><span class="ident" id="5614194">r</span>&nbsp;<span class="ident" id="5614196">Rectangle</span><span class="op" id="5614205">)</span>&nbsp;<span class="op" id="5614207">*</span><span class="ident" id="5614208">Gray</span>&nbsp;<span class="op" id="5614213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614216">w</span><span class="op" id="5614217">,</span>&nbsp;<span class="ident" id="5614219">h</span>&nbsp;<span class="op" id="5614221">:=</span>&nbsp;<span class="ident" id="5614224">r</span><span class="op" id="5614225">.</span><span class="ident" id="5614226">Dx</span><span class="op" id="5614228">(</span><span class="op" id="5614229">)</span><span class="op" id="5614230">,</span>&nbsp;<span class="ident" id="5614232">r</span><span class="op" id="5614233">.</span><span class="ident" id="5614234">Dy</span><span class="op" id="5614236">(</span><span class="op" id="5614237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614240">pix</span>&nbsp;<span class="op" id="5614244">:=</span>&nbsp;<span class="builtinfunc" id="5614247">make</span><span class="op" id="5614251">(</span><span class="op" id="5614252">[</span><span class="op" id="5614253">]</span><span class="builtintype" id="5614254">uint8</span><span class="op" id="5614259">,</span>&nbsp;<span class="num" id="5614261">1</span><span class="op" id="5614262">*</span><span class="ident" id="5614263">w</span><span class="op" id="5614264">*</span><span class="ident" id="5614265">h</span><span class="op" id="5614266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614269">return</span>&nbsp;<span class="op" id="5614276">&amp;</span><span class="ident" id="5614277">Gray</span><span class="op" id="5614281">{</span><span class="ident" id="5614282">pix</span><span class="op" id="5614285">,</span>&nbsp;<span class="num" id="5614287">1</span>&nbsp;<span class="op" id="5614289">*</span>&nbsp;<span class="ident" id="5614291">w</span><span class="op" id="5614292">,</span>&nbsp;<span class="ident" id="5614294">r</span><span class="op" id="5614295">}</span><br>
<span class="lineno">745</span><span class="op" id="5614297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5614300">//&nbsp;Gray16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray16&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5614377">type</span>&nbsp;<span class="ident" id="5614382">Gray16</span>&nbsp;<span class="keyword" id="5614389">struct</span>&nbsp;<span class="op" id="5614396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5614399">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5614483">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614551">Pix</span>&nbsp;<span class="op" id="5614555">[</span><span class="op" id="5614556">]</span><span class="builtintype" id="5614557">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5614564">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614640">Stride</span>&nbsp;<span class="builtintype" id="5614647">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5614652">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614684">Rect</span>&nbsp;<span class="ident" id="5614689">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5614699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5614702">func</span>&nbsp;<span class="op" id="5614707">(</span><span class="ident" id="5614708">p</span>&nbsp;<span class="op" id="5614710">*</span><span class="ident" id="5614711">Gray16</span><span class="op" id="5614717">)</span>&nbsp;<span class="ident" id="5614719">ColorModel</span><span class="op" id="5614729">(</span><span class="op" id="5614730">)</span>&nbsp;<span class="ident" id="5614732">color</span><span class="op" id="5614737">.</span><span class="ident" id="5614738">Model</span>&nbsp;<span class="op" id="5614744">{</span>&nbsp;<span class="keyword" id="5614746">return</span>&nbsp;<span class="ident" id="5614753">color</span><span class="op" id="5614758">.</span><span class="ident" id="5614759">Gray16Model</span>&nbsp;<span class="op" id="5614771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span><span class="keyword" id="5614774">func</span>&nbsp;<span class="op" id="5614779">(</span><span class="ident" id="5614780">p</span>&nbsp;<span class="op" id="5614782">*</span><span class="ident" id="5614783">Gray16</span><span class="op" id="5614789">)</span>&nbsp;<span class="ident" id="5614791">Bounds</span><span class="op" id="5614797">(</span><span class="op" id="5614798">)</span>&nbsp;<span class="ident" id="5614800">Rectangle</span>&nbsp;<span class="op" id="5614810">{</span>&nbsp;<span class="keyword" id="5614812">return</span>&nbsp;<span class="ident" id="5614819">p</span><span class="op" id="5614820">.</span><span class="ident" id="5614821">Rect</span>&nbsp;<span class="op" id="5614826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5614829">func</span>&nbsp;<span class="op" id="5614834">(</span><span class="ident" id="5614835">p</span>&nbsp;<span class="op" id="5614837">*</span><span class="ident" id="5614838">Gray16</span><span class="op" id="5614844">)</span>&nbsp;<span class="ident" id="5614846">At</span><span class="op" id="5614848">(</span><span class="ident" id="5614849">x</span><span class="op" id="5614850">,</span>&nbsp;<span class="ident" id="5614852">y</span>&nbsp;<span class="builtintype" id="5614854">int</span><span class="op" id="5614857">)</span>&nbsp;<span class="ident" id="5614859">color</span><span class="op" id="5614864">.</span><span class="ident" id="5614865">Color</span>&nbsp;<span class="op" id="5614871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614874">return</span>&nbsp;<span class="ident" id="5614881">p</span><span class="op" id="5614882">.</span><span class="ident" id="5614883">Gray16At</span><span class="op" id="5614891">(</span><span class="ident" id="5614892">x</span><span class="op" id="5614893">,</span>&nbsp;<span class="ident" id="5614895">y</span><span class="op" id="5614896">)</span><br>
<span class="lineno"></span><span class="op" id="5614898">}</span><br>
<span class="lineno">765</span><br>
<span class="lineno"></span><span class="keyword" id="5614901">func</span>&nbsp;<span class="op" id="5614906">(</span><span class="ident" id="5614907">p</span>&nbsp;<span class="op" id="5614909">*</span><span class="ident" id="5614910">Gray16</span><span class="op" id="5614916">)</span>&nbsp;<span class="ident" id="5614918">Gray16At</span><span class="op" id="5614926">(</span><span class="ident" id="5614927">x</span><span class="op" id="5614928">,</span>&nbsp;<span class="ident" id="5614930">y</span>&nbsp;<span class="builtintype" id="5614932">int</span><span class="op" id="5614935">)</span>&nbsp;<span class="ident" id="5614937">color</span><span class="op" id="5614942">.</span><span class="ident" id="5614943">Gray16</span>&nbsp;<span class="op" id="5614950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614953">if</span>&nbsp;<span class="op" id="5614956">!</span><span class="op" id="5614957">(</span><span class="ident" id="5614958">Point</span><span class="op" id="5614963">{</span><span class="ident" id="5614964">x</span><span class="op" id="5614965">,</span>&nbsp;<span class="ident" id="5614967">y</span><span class="op" id="5614968">}</span><span class="op" id="5614969">.</span><span class="ident" id="5614970">In</span><span class="op" id="5614972">(</span><span class="ident" id="5614973">p</span><span class="op" id="5614974">.</span><span class="ident" id="5614975">Rect</span><span class="op" id="5614979">)</span><span class="op" id="5614980">)</span>&nbsp;<span class="op" id="5614982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614986">return</span>&nbsp;<span class="ident" id="5614993">color</span><span class="op" id="5614998">.</span><span class="ident" id="5614999">Gray16</span><span class="op" id="5615005">{</span><span class="op" id="5615006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5615009">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5615012">i</span>&nbsp;<span class="op" id="5615014">:=</span>&nbsp;<span class="ident" id="5615017">p</span><span class="op" id="5615018">.</span><span class="ident" id="5615019">PixOffset</span><span class="op" id="5615028">(</span><span class="ident" id="5615029">x</span><span class="op" id="5615030">,</span>&nbsp;<span class="ident" id="5615032">y</span><span class="op" id="5615033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5615036">return</span>&nbsp;<span class="ident" id="5615043">color</span><span class="op" id="5615048">.</span><span class="ident" id="5615049">Gray16</span><span class="op" id="5615055">{</span><span class="builtintype" id="5615056">uint16</span><span class="op" id="5615062">(</span><span class="ident" id="5615063">p</span><span class="op" id="5615064">.</span><span class="ident" id="5615065">Pix</span><span class="op" id="5615068">[</span><span class="ident" id="5615069">i</span><span class="op" id="5615070">+</span><span class="num" id="5615071">0</span><span class="op" id="5615072">]</span><span class="op" id="5615073">)</span><span class="op" id="5615074">&lt;&lt;</span><span class="num" id="5615076">8</span>&nbsp;<span class="op" id="5615078">|</span>&nbsp;<span class="builtintype" id="5615080">uint16</span><span class="op" id="5615086">(</span><span class="ident" id="5615087">p</span><span class="op" id="5615088">.</span><span class="ident" id="5615089">Pix</span><span class="op" id="5615092">[</span><span class="ident" id="5615093">i</span><span class="op" id="5615094">+</span><span class="num" id="5615095">1</span><span class="op" id="5615096">]</span><span class="op" id="5615097">)</span><span class="op" id="5615098">}</span><br>
<span class="lineno"></span><span class="op" id="5615100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5615103">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">775</span><span class="comment" id="5615182">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5615206">func</span>&nbsp;<span class="op" id="5615211">(</span><span class="ident" id="5615212">p</span>&nbsp;<span class="op" id="5615214">*</span><span class="ident" id="5615215">Gray16</span><span class="op" id="5615221">)</span>&nbsp;<span class="ident" id="5615223">PixOffset</span><span class="op" id="5615232">(</span><span class="ident" id="5615233">x</span><span class="op" id="5615234">,</span>&nbsp;<span class="ident" id="5615236">y</span>&nbsp;<span class="builtintype" id="5615238">int</span><span class="op" id="5615241">)</span>&nbsp;<span class="builtintype" id="5615243">int</span>&nbsp;<span class="op" id="5615247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5615250">return</span>&nbsp;<span class="op" id="5615257">(</span><span class="ident" id="5615258">y</span><span class="op" id="5615259">-</span><span class="ident" id="5615260">p</span><span class="op" id="5615261">.</span><span class="ident" id="5615262">Rect</span><span class="op" id="5615266">.</span><span class="ident" id="5615267">Min</span><span class="op" id="5615270">.</span><span class="ident" id="5615271">Y</span><span class="op" id="5615272">)</span><span class="op" id="5615273">*</span><span class="ident" id="5615274">p</span><span class="op" id="5615275">.</span><span class="ident" id="5615276">Stride</span>&nbsp;<span class="op" id="5615283">+</span>&nbsp;<span class="op" id="5615285">(</span><span class="ident" id="5615286">x</span><span class="op" id="5615287">-</span><span class="ident" id="5615288">p</span><span class="op" id="5615289">.</span><span class="ident" id="5615290">Rect</span><span class="op" id="5615294">.</span><span class="ident" id="5615295">Min</span><span class="op" id="5615298">.</span><span class="ident" id="5615299">X</span><span class="op" id="5615300">)</span><span class="op" id="5615301">*</span><span class="num" id="5615302">2</span><br>
<span class="lineno"></span><span class="op" id="5615304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">780</span><span class="keyword" id="5615307">func</span>&nbsp;<span class="op" id="5615312">(</span><span class="ident" id="5615313">p</span>&nbsp;<span class="op" id="5615315">*</span><span class="ident" id="5615316">Gray16</span><span class="op" id="5615322">)</span>&nbsp;<span class="ident" id="5615324">Set</span><span class="op" id="5615327">(</span><span class="ident" id="5615328">x</span><span class="op" id="5615329">,</span>&nbsp;<span class="ident" id="5615331">y</span>&nbsp;<span class="builtintype" id="5615333">int</span><span class="op" id="5615336">,</span>&nbsp;<span class="ident" id="5615338">c</span>&nbsp;<span class="ident" id="5615340">color</span><span class="op" id="5615345">.</span><span class="ident" id="5615346">Color</span><span class="op" id="5615351">)</span>&nbsp;<span class="op" id="5615353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5615356">if</span>&nbsp;<span class="op" id="5615359">!</span><span class="op" id="5615360">(</span><span class="ident" id="5615361">Point</span><span class="op" id="5615366">{</span><span class="ident" id="5615367">x</span><span class="op" id="5615368">,</span>&nbsp;<span class="ident" id="5615370">y</span><span class="op" id="5615371">}</span><span class="op" id="5615372">.</span><span class="ident" id="5615373">In</span><span class="op" id="5615375">(</span><span class="ident" id="5615376">p</span><span class="op" id="5615377">.</span><span class="ident" id="5615378">Rect</span><span class="op" id="5615382">)</span><span class="op" id="5615383">)</span>&nbsp;<span class="op" id="5615385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5615389">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5615397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5615400">i</span>&nbsp;<span class="op" id="5615402">:=</span>&nbsp;<span class="ident" id="5615405">p</span><span class="op" id="5615406">.</span><span class="ident" id="5615407">PixOffset</span><span class="op" id="5615416">(</span><span class="ident" id="5615417">x</span><span class="op" id="5615418">,</span>&nbsp;<span class="ident" id="5615420">y</span><span class="op" id="5615421">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5615424">c1</span>&nbsp;<span class="op" id="5615427">:=</span>&nbsp;<span class="ident" id="5615430">color</span><span class="op" id="5615435">.</span><span class="ident" id="5615436">Gray16Model</span><span class="op" id="5615447">.</span><span class="ident" id="5615448">Convert</span><span class="op" id="5615455">(</span><span class="ident" id="5615456">c</span><span class="op" id="5615457">)</span><span class="op" id="5615458">.</span><span class="op" id="5615459">(</span><span class="ident" id="5615460">color</span><span class="op" id="5615465">.</span><span class="ident" id="5615466">Gray16</span><span class="op" id="5615472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5615475">p</span><span class="op" id="5615476">.</span><span class="ident" id="5615477">Pix</span><span class="op" id="5615480">[</span><span class="ident" id="5615481">i</span><span class="op" id="5615482">+</span><span class="num" id="5615483">0</span><span class="op" id="5615484">]</span>&nbsp;<span class="op" id="5615486">=</span>&nbsp;<span class="builtintype" id="5615488">uint8</span><span class="op" id="5615493">(</span><span class="ident" id="5615494">c1</span><span class="op" id="5615496">.</span><span class="ident" id="5615497">Y</span>&nbsp;<span class="op" id="5615499">&gt;&gt;</span>&nbsp;<span class="num" id="5615502">8</span><span class="op" id="5615503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5615506">p</span><span class="op" id="5615507">.</span><span class="ident" id="5615508">Pix</span><span class="op" id="5615511">[</span><span class="ident" id="5615512">i</span><span class="op" id="5615513">+</span><span class="num" id="5615514">1</span><span class="op" id="5615515">]</span>&nbsp;<span class="op" id="5615517">=</span>&nbsp;<span class="builtintype" id="5615519">uint8</span><span class="op" id="5615524">(</span><span class="ident" id="5615525">c1</span><span class="op" id="5615527">.</span><span class="ident" id="5615528">Y</span><span class="op" id="5615529">)</span><br>
<span class="lineno"></span><span class="op" id="5615531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span><span class="keyword" id="5615534">func</span>&nbsp;<span class="op" id="5615539">(</span><span class="ident" id="5615540">p</span>&nbsp;<span class="op" id="5615542">*</span><span class="ident" id="5615543">Gray16</span><span class="op" id="5615549">)</span>&nbsp;<span class="ident" id="5615551">SetGray16</span><span class="op" id="5615560">(</span><span class="ident" id="5615561">x</span><span class="op" id="5615562">,</span>&nbsp;<span class="ident" id="5615564">y</span>&nbsp;<span class="builtintype" id="5615566">int</span><span class="op" id="5615569">,</span>&nbsp;<span class="ident" id="5615571">c</span>&nbsp;<span class="ident" id="5615573">color</span><span class="op" id="5615578">.</span><span class="ident" id="5615579">Gray16</span><span class="op" id="5615585">)</span>&nbsp;<span class="op" id="5615587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5615590">if</span>&nbsp;<span class="op" id="5615593">!</span><span class="op" id="5615594">(</span><span class="ident" id="5615595">Point</span><span class="op" id="5615600">{</span><span class="ident" id="5615601">x</span><span class="op" id="5615602">,</span>&nbsp;<span class="ident" id="5615604">y</span><span class="op" id="5615605">}</span><span class="op" id="5615606">.</span><span class="ident" id="5615607">In</span><span class="op" id="5615609">(</span><span class="ident" id="5615610">p</span><span class="op" id="5615611">.</span><span class="ident" id="5615612">Rect</span><span class="op" id="5615616">)</span><span class="op" id="5615617">)</span>&nbsp;<span class="op" id="5615619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5615623">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5615631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5615634">i</span>&nbsp;<span class="op" id="5615636">:=</span>&nbsp;<span class="ident" id="5615639">p</span><span class="op" id="5615640">.</span><span class="ident" id="5615641">PixOffset</span><span class="op" id="5615650">(</span><span class="ident" id="5615651">x</span><span class="op" id="5615652">,</span>&nbsp;<span class="ident" id="5615654">y</span><span class="op" id="5615655">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5615658">p</span><span class="op" id="5615659">.</span><span class="ident" id="5615660">Pix</span><span class="op" id="5615663">[</span><span class="ident" id="5615664">i</span><span class="op" id="5615665">+</span><span class="num" id="5615666">0</span><span class="op" id="5615667">]</span>&nbsp;<span class="op" id="5615669">=</span>&nbsp;<span class="builtintype" id="5615671">uint8</span><span class="op" id="5615676">(</span><span class="ident" id="5615677">c</span><span class="op" id="5615678">.</span><span class="ident" id="5615679">Y</span>&nbsp;<span class="op" id="5615681">&gt;&gt;</span>&nbsp;<span class="num" id="5615684">8</span><span class="op" id="5615685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5615688">p</span><span class="op" id="5615689">.</span><span class="ident" id="5615690">Pix</span><span class="op" id="5615693">[</span><span class="ident" id="5615694">i</span><span class="op" id="5615695">+</span><span class="num" id="5615696">1</span><span class="op" id="5615697">]</span>&nbsp;<span class="op" id="5615699">=</span>&nbsp;<span class="builtintype" id="5615701">uint8</span><span class="op" id="5615706">(</span><span class="ident" id="5615707">c</span><span class="op" id="5615708">.</span><span class="ident" id="5615709">Y</span><span class="op" id="5615710">)</span><br>
<span class="lineno"></span><span class="op" id="5615712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5615715">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno">800</span><span class="comment" id="5615792">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5615864">func</span>&nbsp;<span class="op" id="5615869">(</span><span class="ident" id="5615870">p</span>&nbsp;<span class="op" id="5615872">*</span><span class="ident" id="5615873">Gray16</span><span class="op" id="5615879">)</span>&nbsp;<span class="ident" id="5615881">SubImage</span><span class="op" id="5615889">(</span><span class="ident" id="5615890">r</span>&nbsp;<span class="ident" id="5615892">Rectangle</span><span class="op" id="5615901">)</span>&nbsp;<span class="ident" id="5615903">Image</span>&nbsp;<span class="op" id="5615909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5615912">r</span>&nbsp;<span class="op" id="5615914">=</span>&nbsp;<span class="ident" id="5615916">r</span><span class="op" id="5615917">.</span><span class="ident" id="5615918">Intersect</span><span class="op" id="5615927">(</span><span class="ident" id="5615928">p</span><span class="op" id="5615929">.</span><span class="ident" id="5615930">Rect</span><span class="op" id="5615934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5615937">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5616018">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5616100">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5616150">if</span>&nbsp;<span class="ident" id="5616153">r</span><span class="op" id="5616154">.</span><span class="ident" id="5616155">Empty</span><span class="op" id="5616160">(</span><span class="op" id="5616161">)</span>&nbsp;<span class="op" id="5616163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5616167">return</span>&nbsp;<span class="op" id="5616174">&amp;</span><span class="ident" id="5616175">Gray16</span><span class="op" id="5616181">{</span><span class="op" id="5616182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5616185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616188">i</span>&nbsp;<span class="op" id="5616190">:=</span>&nbsp;<span class="ident" id="5616193">p</span><span class="op" id="5616194">.</span><span class="ident" id="5616195">PixOffset</span><span class="op" id="5616204">(</span><span class="ident" id="5616205">r</span><span class="op" id="5616206">.</span><span class="ident" id="5616207">Min</span><span class="op" id="5616210">.</span><span class="ident" id="5616211">X</span><span class="op" id="5616212">,</span>&nbsp;<span class="ident" id="5616214">r</span><span class="op" id="5616215">.</span><span class="ident" id="5616216">Min</span><span class="op" id="5616219">.</span><span class="ident" id="5616220">Y</span><span class="op" id="5616221">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5616224">return</span>&nbsp;<span class="op" id="5616231">&amp;</span><span class="ident" id="5616232">Gray16</span><span class="op" id="5616238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616242">Pix</span><span class="op" id="5616245">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5616250">p</span><span class="op" id="5616251">.</span><span class="ident" id="5616252">Pix</span><span class="op" id="5616255">[</span><span class="ident" id="5616256">i</span><span class="op" id="5616257">:</span><span class="op" id="5616258">]</span><span class="op" id="5616259">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616263">Stride</span><span class="op" id="5616269">:</span>&nbsp;<span class="ident" id="5616271">p</span><span class="op" id="5616272">.</span><span class="ident" id="5616273">Stride</span><span class="op" id="5616279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616283">Rect</span><span class="op" id="5616287">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5616291">r</span><span class="op" id="5616292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5616295">}</span><br>
<span class="lineno">815</span><span class="op" id="5616297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5616300">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5616373">func</span>&nbsp;<span class="op" id="5616378">(</span><span class="ident" id="5616379">p</span>&nbsp;<span class="op" id="5616381">*</span><span class="ident" id="5616382">Gray16</span><span class="op" id="5616388">)</span>&nbsp;<span class="ident" id="5616390">Opaque</span><span class="op" id="5616396">(</span><span class="op" id="5616397">)</span>&nbsp;<span class="builtintype" id="5616399">bool</span>&nbsp;<span class="op" id="5616404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5616407">return</span>&nbsp;<span class="builtintype" id="5616414">true</span><br>
<span class="lineno">820</span><span class="op" id="5616419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5616422">//&nbsp;NewGray16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5616479">func</span>&nbsp;<span class="ident" id="5616484">NewGray16</span><span class="op" id="5616493">(</span><span class="ident" id="5616494">r</span>&nbsp;<span class="ident" id="5616496">Rectangle</span><span class="op" id="5616505">)</span>&nbsp;<span class="op" id="5616507">*</span><span class="ident" id="5616508">Gray16</span>&nbsp;<span class="op" id="5616515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616518">w</span><span class="op" id="5616519">,</span>&nbsp;<span class="ident" id="5616521">h</span>&nbsp;<span class="op" id="5616523">:=</span>&nbsp;<span class="ident" id="5616526">r</span><span class="op" id="5616527">.</span><span class="ident" id="5616528">Dx</span><span class="op" id="5616530">(</span><span class="op" id="5616531">)</span><span class="op" id="5616532">,</span>&nbsp;<span class="ident" id="5616534">r</span><span class="op" id="5616535">.</span><span class="ident" id="5616536">Dy</span><span class="op" id="5616538">(</span><span class="op" id="5616539">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616542">pix</span>&nbsp;<span class="op" id="5616546">:=</span>&nbsp;<span class="builtinfunc" id="5616549">make</span><span class="op" id="5616553">(</span><span class="op" id="5616554">[</span><span class="op" id="5616555">]</span><span class="builtintype" id="5616556">uint8</span><span class="op" id="5616561">,</span>&nbsp;<span class="num" id="5616563">2</span><span class="op" id="5616564">*</span><span class="ident" id="5616565">w</span><span class="op" id="5616566">*</span><span class="ident" id="5616567">h</span><span class="op" id="5616568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5616571">return</span>&nbsp;<span class="op" id="5616578">&amp;</span><span class="ident" id="5616579">Gray16</span><span class="op" id="5616585">{</span><span class="ident" id="5616586">pix</span><span class="op" id="5616589">,</span>&nbsp;<span class="num" id="5616591">2</span>&nbsp;<span class="op" id="5616593">*</span>&nbsp;<span class="ident" id="5616595">w</span><span class="op" id="5616596">,</span>&nbsp;<span class="ident" id="5616598">r</span><span class="op" id="5616599">}</span><br>
<span class="lineno"></span><span class="op" id="5616601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5616604">//&nbsp;Paletted&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;uint8&nbsp;indices&nbsp;into&nbsp;a&nbsp;given&nbsp;palette.</span><br>
<span class="lineno">830</span><span class="keyword" id="5616677">type</span>&nbsp;<span class="ident" id="5616682">Paletted</span>&nbsp;<span class="keyword" id="5616691">struct</span>&nbsp;<span class="op" id="5616698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5616701">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;palette&nbsp;indices.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5616768">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616836">Pix</span>&nbsp;<span class="op" id="5616840">[</span><span class="op" id="5616841">]</span><span class="builtintype" id="5616842">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5616849">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616925">Stride</span>&nbsp;<span class="builtintype" id="5616932">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5616937">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5616969">Rect</span>&nbsp;<span class="ident" id="5616974">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5616985">//&nbsp;Palette&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5617021">Palette</span>&nbsp;<span class="ident" id="5617029">color</span><span class="op" id="5617034">.</span><span class="ident" id="5617035">Palette</span><br>
<span class="lineno">840</span><span class="op" id="5617043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5617046">func</span>&nbsp;<span class="op" id="5617051">(</span><span class="ident" id="5617052">p</span>&nbsp;<span class="op" id="5617054">*</span><span class="ident" id="5617055">Paletted</span><span class="op" id="5617063">)</span>&nbsp;<span class="ident" id="5617065">ColorModel</span><span class="op" id="5617075">(</span><span class="op" id="5617076">)</span>&nbsp;<span class="ident" id="5617078">color</span><span class="op" id="5617083">.</span><span class="ident" id="5617084">Model</span>&nbsp;<span class="op" id="5617090">{</span>&nbsp;<span class="keyword" id="5617092">return</span>&nbsp;<span class="ident" id="5617099">p</span><span class="op" id="5617100">.</span><span class="ident" id="5617101">Palette</span>&nbsp;<span class="op" id="5617109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5617112">func</span>&nbsp;<span class="op" id="5617117">(</span><span class="ident" id="5617118">p</span>&nbsp;<span class="op" id="5617120">*</span><span class="ident" id="5617121">Paletted</span><span class="op" id="5617129">)</span>&nbsp;<span class="ident" id="5617131">Bounds</span><span class="op" id="5617137">(</span><span class="op" id="5617138">)</span>&nbsp;<span class="ident" id="5617140">Rectangle</span>&nbsp;<span class="op" id="5617150">{</span>&nbsp;<span class="keyword" id="5617152">return</span>&nbsp;<span class="ident" id="5617159">p</span><span class="op" id="5617160">.</span><span class="ident" id="5617161">Rect</span>&nbsp;<span class="op" id="5617166">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="5617169">func</span>&nbsp;<span class="op" id="5617174">(</span><span class="ident" id="5617175">p</span>&nbsp;<span class="op" id="5617177">*</span><span class="ident" id="5617178">Paletted</span><span class="op" id="5617186">)</span>&nbsp;<span class="ident" id="5617188">At</span><span class="op" id="5617190">(</span><span class="ident" id="5617191">x</span><span class="op" id="5617192">,</span>&nbsp;<span class="ident" id="5617194">y</span>&nbsp;<span class="builtintype" id="5617196">int</span><span class="op" id="5617199">)</span>&nbsp;<span class="ident" id="5617201">color</span><span class="op" id="5617206">.</span><span class="ident" id="5617207">Color</span>&nbsp;<span class="op" id="5617213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617216">if</span>&nbsp;<span class="builtinfunc" id="5617219">len</span><span class="op" id="5617222">(</span><span class="ident" id="5617223">p</span><span class="op" id="5617224">.</span><span class="ident" id="5617225">Palette</span><span class="op" id="5617232">)</span>&nbsp;<span class="op" id="5617234">==</span>&nbsp;<span class="num" id="5617237">0</span>&nbsp;<span class="op" id="5617239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617243">return</span>&nbsp;<span class="ident" id="5617250">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5617255">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617258">if</span>&nbsp;<span class="op" id="5617261">!</span><span class="op" id="5617262">(</span><span class="ident" id="5617263">Point</span><span class="op" id="5617268">{</span><span class="ident" id="5617269">x</span><span class="op" id="5617270">,</span>&nbsp;<span class="ident" id="5617272">y</span><span class="op" id="5617273">}</span><span class="op" id="5617274">.</span><span class="ident" id="5617275">In</span><span class="op" id="5617277">(</span><span class="ident" id="5617278">p</span><span class="op" id="5617279">.</span><span class="ident" id="5617280">Rect</span><span class="op" id="5617284">)</span><span class="op" id="5617285">)</span>&nbsp;<span class="op" id="5617287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617291">return</span>&nbsp;<span class="ident" id="5617298">p</span><span class="op" id="5617299">.</span><span class="ident" id="5617300">Palette</span><span class="op" id="5617307">[</span><span class="num" id="5617308">0</span><span class="op" id="5617309">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5617312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5617315">i</span>&nbsp;<span class="op" id="5617317">:=</span>&nbsp;<span class="ident" id="5617320">p</span><span class="op" id="5617321">.</span><span class="ident" id="5617322">PixOffset</span><span class="op" id="5617331">(</span><span class="ident" id="5617332">x</span><span class="op" id="5617333">,</span>&nbsp;<span class="ident" id="5617335">y</span><span class="op" id="5617336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617339">return</span>&nbsp;<span class="ident" id="5617346">p</span><span class="op" id="5617347">.</span><span class="ident" id="5617348">Palette</span><span class="op" id="5617355">[</span><span class="ident" id="5617356">p</span><span class="op" id="5617357">.</span><span class="ident" id="5617358">Pix</span><span class="op" id="5617361">[</span><span class="ident" id="5617362">i</span><span class="op" id="5617363">]</span><span class="op" id="5617364">]</span><br>
<span class="lineno">855</span><span class="op" id="5617366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5617369">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5617448">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5617472">func</span>&nbsp;<span class="op" id="5617477">(</span><span class="ident" id="5617478">p</span>&nbsp;<span class="op" id="5617480">*</span><span class="ident" id="5617481">Paletted</span><span class="op" id="5617489">)</span>&nbsp;<span class="ident" id="5617491">PixOffset</span><span class="op" id="5617500">(</span><span class="ident" id="5617501">x</span><span class="op" id="5617502">,</span>&nbsp;<span class="ident" id="5617504">y</span>&nbsp;<span class="builtintype" id="5617506">int</span><span class="op" id="5617509">)</span>&nbsp;<span class="builtintype" id="5617511">int</span>&nbsp;<span class="op" id="5617515">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617518">return</span>&nbsp;<span class="op" id="5617525">(</span><span class="ident" id="5617526">y</span><span class="op" id="5617527">-</span><span class="ident" id="5617528">p</span><span class="op" id="5617529">.</span><span class="ident" id="5617530">Rect</span><span class="op" id="5617534">.</span><span class="ident" id="5617535">Min</span><span class="op" id="5617538">.</span><span class="ident" id="5617539">Y</span><span class="op" id="5617540">)</span><span class="op" id="5617541">*</span><span class="ident" id="5617542">p</span><span class="op" id="5617543">.</span><span class="ident" id="5617544">Stride</span>&nbsp;<span class="op" id="5617551">+</span>&nbsp;<span class="op" id="5617553">(</span><span class="ident" id="5617554">x</span><span class="op" id="5617555">-</span><span class="ident" id="5617556">p</span><span class="op" id="5617557">.</span><span class="ident" id="5617558">Rect</span><span class="op" id="5617562">.</span><span class="ident" id="5617563">Min</span><span class="op" id="5617566">.</span><span class="ident" id="5617567">X</span><span class="op" id="5617568">)</span><span class="op" id="5617569">*</span><span class="num" id="5617570">1</span><br>
<span class="lineno"></span><span class="op" id="5617572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5617575">func</span>&nbsp;<span class="op" id="5617580">(</span><span class="ident" id="5617581">p</span>&nbsp;<span class="op" id="5617583">*</span><span class="ident" id="5617584">Paletted</span><span class="op" id="5617592">)</span>&nbsp;<span class="ident" id="5617594">Set</span><span class="op" id="5617597">(</span><span class="ident" id="5617598">x</span><span class="op" id="5617599">,</span>&nbsp;<span class="ident" id="5617601">y</span>&nbsp;<span class="builtintype" id="5617603">int</span><span class="op" id="5617606">,</span>&nbsp;<span class="ident" id="5617608">c</span>&nbsp;<span class="ident" id="5617610">color</span><span class="op" id="5617615">.</span><span class="ident" id="5617616">Color</span><span class="op" id="5617621">)</span>&nbsp;<span class="op" id="5617623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617626">if</span>&nbsp;<span class="op" id="5617629">!</span><span class="op" id="5617630">(</span><span class="ident" id="5617631">Point</span><span class="op" id="5617636">{</span><span class="ident" id="5617637">x</span><span class="op" id="5617638">,</span>&nbsp;<span class="ident" id="5617640">y</span><span class="op" id="5617641">}</span><span class="op" id="5617642">.</span><span class="ident" id="5617643">In</span><span class="op" id="5617645">(</span><span class="ident" id="5617646">p</span><span class="op" id="5617647">.</span><span class="ident" id="5617648">Rect</span><span class="op" id="5617652">)</span><span class="op" id="5617653">)</span>&nbsp;<span class="op" id="5617655">{</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617659">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5617667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5617670">i</span>&nbsp;<span class="op" id="5617672">:=</span>&nbsp;<span class="ident" id="5617675">p</span><span class="op" id="5617676">.</span><span class="ident" id="5617677">PixOffset</span><span class="op" id="5617686">(</span><span class="ident" id="5617687">x</span><span class="op" id="5617688">,</span>&nbsp;<span class="ident" id="5617690">y</span><span class="op" id="5617691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5617694">p</span><span class="op" id="5617695">.</span><span class="ident" id="5617696">Pix</span><span class="op" id="5617699">[</span><span class="ident" id="5617700">i</span><span class="op" id="5617701">]</span>&nbsp;<span class="op" id="5617703">=</span>&nbsp;<span class="builtintype" id="5617705">uint8</span><span class="op" id="5617710">(</span><span class="ident" id="5617711">p</span><span class="op" id="5617712">.</span><span class="ident" id="5617713">Palette</span><span class="op" id="5617720">.</span><span class="ident" id="5617721">Index</span><span class="op" id="5617726">(</span><span class="ident" id="5617727">c</span><span class="op" id="5617728">)</span><span class="op" id="5617729">)</span><br>
<span class="lineno"></span><span class="op" id="5617731">}</span><br>
<span class="lineno">870</span><br>
<span class="lineno"></span><span class="keyword" id="5617734">func</span>&nbsp;<span class="op" id="5617739">(</span><span class="ident" id="5617740">p</span>&nbsp;<span class="op" id="5617742">*</span><span class="ident" id="5617743">Paletted</span><span class="op" id="5617751">)</span>&nbsp;<span class="ident" id="5617753">ColorIndexAt</span><span class="op" id="5617765">(</span><span class="ident" id="5617766">x</span><span class="op" id="5617767">,</span>&nbsp;<span class="ident" id="5617769">y</span>&nbsp;<span class="builtintype" id="5617771">int</span><span class="op" id="5617774">)</span>&nbsp;<span class="builtintype" id="5617776">uint8</span>&nbsp;<span class="op" id="5617782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617785">if</span>&nbsp;<span class="op" id="5617788">!</span><span class="op" id="5617789">(</span><span class="ident" id="5617790">Point</span><span class="op" id="5617795">{</span><span class="ident" id="5617796">x</span><span class="op" id="5617797">,</span>&nbsp;<span class="ident" id="5617799">y</span><span class="op" id="5617800">}</span><span class="op" id="5617801">.</span><span class="ident" id="5617802">In</span><span class="op" id="5617804">(</span><span class="ident" id="5617805">p</span><span class="op" id="5617806">.</span><span class="ident" id="5617807">Rect</span><span class="op" id="5617811">)</span><span class="op" id="5617812">)</span>&nbsp;<span class="op" id="5617814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617818">return</span>&nbsp;<span class="num" id="5617825">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5617828">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5617831">i</span>&nbsp;<span class="op" id="5617833">:=</span>&nbsp;<span class="ident" id="5617836">p</span><span class="op" id="5617837">.</span><span class="ident" id="5617838">PixOffset</span><span class="op" id="5617847">(</span><span class="ident" id="5617848">x</span><span class="op" id="5617849">,</span>&nbsp;<span class="ident" id="5617851">y</span><span class="op" id="5617852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617855">return</span>&nbsp;<span class="ident" id="5617862">p</span><span class="op" id="5617863">.</span><span class="ident" id="5617864">Pix</span><span class="op" id="5617867">[</span><span class="ident" id="5617868">i</span><span class="op" id="5617869">]</span><br>
<span class="lineno"></span><span class="op" id="5617871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5617874">func</span>&nbsp;<span class="op" id="5617879">(</span><span class="ident" id="5617880">p</span>&nbsp;<span class="op" id="5617882">*</span><span class="ident" id="5617883">Paletted</span><span class="op" id="5617891">)</span>&nbsp;<span class="ident" id="5617893">SetColorIndex</span><span class="op" id="5617906">(</span><span class="ident" id="5617907">x</span><span class="op" id="5617908">,</span>&nbsp;<span class="ident" id="5617910">y</span>&nbsp;<span class="builtintype" id="5617912">int</span><span class="op" id="5617915">,</span>&nbsp;<span class="ident" id="5617917">index</span>&nbsp;<span class="builtintype" id="5617923">uint8</span><span class="op" id="5617928">)</span>&nbsp;<span class="op" id="5617930">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617933">if</span>&nbsp;<span class="op" id="5617936">!</span><span class="op" id="5617937">(</span><span class="ident" id="5617938">Point</span><span class="op" id="5617943">{</span><span class="ident" id="5617944">x</span><span class="op" id="5617945">,</span>&nbsp;<span class="ident" id="5617947">y</span><span class="op" id="5617948">}</span><span class="op" id="5617949">.</span><span class="ident" id="5617950">In</span><span class="op" id="5617952">(</span><span class="ident" id="5617953">p</span><span class="op" id="5617954">.</span><span class="ident" id="5617955">Rect</span><span class="op" id="5617959">)</span><span class="op" id="5617960">)</span>&nbsp;<span class="op" id="5617962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5617966">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5617974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5617977">i</span>&nbsp;<span class="op" id="5617979">:=</span>&nbsp;<span class="ident" id="5617982">p</span><span class="op" id="5617983">.</span><span class="ident" id="5617984">PixOffset</span><span class="op" id="5617993">(</span><span class="ident" id="5617994">x</span><span class="op" id="5617995">,</span>&nbsp;<span class="ident" id="5617997">y</span><span class="op" id="5617998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5618001">p</span><span class="op" id="5618002">.</span><span class="ident" id="5618003">Pix</span><span class="op" id="5618006">[</span><span class="ident" id="5618007">i</span><span class="op" id="5618008">]</span>&nbsp;<span class="op" id="5618010">=</span>&nbsp;<span class="ident" id="5618012">index</span><br>
<span class="lineno">885</span><span class="op" id="5618018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5618021">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5618098">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5618170">func</span>&nbsp;<span class="op" id="5618175">(</span><span class="ident" id="5618176">p</span>&nbsp;<span class="op" id="5618178">*</span><span class="ident" id="5618179">Paletted</span><span class="op" id="5618187">)</span>&nbsp;<span class="ident" id="5618189">SubImage</span><span class="op" id="5618197">(</span><span class="ident" id="5618198">r</span>&nbsp;<span class="ident" id="5618200">Rectangle</span><span class="op" id="5618209">)</span>&nbsp;<span class="ident" id="5618211">Image</span>&nbsp;<span class="op" id="5618217">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5618220">r</span>&nbsp;<span class="op" id="5618222">=</span>&nbsp;<span class="ident" id="5618224">r</span><span class="op" id="5618225">.</span><span class="ident" id="5618226">Intersect</span><span class="op" id="5618235">(</span><span class="ident" id="5618236">p</span><span class="op" id="5618237">.</span><span class="ident" id="5618238">Rect</span><span class="op" id="5618242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5618245">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5618326">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5618408">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5618458">if</span>&nbsp;<span class="ident" id="5618461">r</span><span class="op" id="5618462">.</span><span class="ident" id="5618463">Empty</span><span class="op" id="5618468">(</span><span class="op" id="5618469">)</span>&nbsp;<span class="op" id="5618471">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5618475">return</span>&nbsp;<span class="op" id="5618482">&amp;</span><span class="ident" id="5618483">Paletted</span><span class="op" id="5618491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5618496">Palette</span><span class="op" id="5618503">:</span>&nbsp;<span class="ident" id="5618505">p</span><span class="op" id="5618506">.</span><span class="ident" id="5618507">Palette</span><span class="op" id="5618514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5618518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5618521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5618524">i</span>&nbsp;<span class="op" id="5618526">:=</span>&nbsp;<span class="ident" id="5618529">p</span><span class="op" id="5618530">.</span><span class="ident" id="5618531">PixOffset</span><span class="op" id="5618540">(</span><span class="ident" id="5618541">r</span><span class="op" id="5618542">.</span><span class="ident" id="5618543">Min</span><span class="op" id="5618546">.</span><span class="ident" id="5618547">X</span><span class="op" id="5618548">,</span>&nbsp;<span class="ident" id="5618550">r</span><span class="op" id="5618551">.</span><span class="ident" id="5618552">Min</span><span class="op" id="5618555">.</span><span class="ident" id="5618556">Y</span><span class="op" id="5618557">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5618560">return</span>&nbsp;<span class="op" id="5618567">&amp;</span><span class="ident" id="5618568">Paletted</span><span class="op" id="5618576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5618580">Pix</span><span class="op" id="5618583">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618589">p</span><span class="op" id="5618590">.</span><span class="ident" id="5618591">Pix</span><span class="op" id="5618594">[</span><span class="ident" id="5618595">i</span><span class="op" id="5618596">:</span><span class="op" id="5618597">]</span><span class="op" id="5618598">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5618602">Stride</span><span class="op" id="5618608">:</span>&nbsp;&nbsp;<span class="ident" id="5618611">p</span><span class="op" id="5618612">.</span><span class="ident" id="5618613">Stride</span><span class="op" id="5618619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5618623">Rect</span><span class="op" id="5618627">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5618632">p</span><span class="op" id="5618633">.</span><span class="ident" id="5618634">Rect</span><span class="op" id="5618638">.</span><span class="ident" id="5618639">Intersect</span><span class="op" id="5618648">(</span><span class="ident" id="5618649">r</span><span class="op" id="5618650">)</span><span class="op" id="5618651">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5618655">Palette</span><span class="op" id="5618662">:</span>&nbsp;<span class="ident" id="5618664">p</span><span class="op" id="5618665">.</span><span class="ident" id="5618666">Palette</span><span class="op" id="5618673">,</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5618676">}</span><br>
<span class="lineno"></span><span class="op" id="5618678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5618681">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5618754">func</span>&nbsp;<span class="op" id="5618759">(</span><span class="ident" id="5618760">p</span>&nbsp;<span class="op" id="5618762">*</span><span class="ident" id="5618763">Paletted</span><span class="op" id="5618771">)</span>&nbsp;<span class="ident" id="5618773">Opaque</span><span class="op" id="5618779">(</span><span class="op" id="5618780">)</span>&nbsp;<span class="builtintype" id="5618782">bool</span>&nbsp;<span class="op" id="5618787">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5618790">var</span>&nbsp;<span class="ident" id="5618794">present</span>&nbsp;<span class="op" id="5618802">[</span><span class="num" id="5618803">256</span><span class="op" id="5618806">]</span><span class="builtintype" id="5618807">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5618813">i0</span><span class="op" id="5618815">,</span>&nbsp;<span class="ident" id="5618817">i1</span>&nbsp;<span class="op" id="5618820">:=</span>&nbsp;<span class="num" id="5618823">0</span><span class="op" id="5618824">,</span>&nbsp;<span class="ident" id="5618826">p</span><span class="op" id="5618827">.</span><span class="ident" id="5618828">Rect</span><span class="op" id="5618832">.</span><span class="ident" id="5618833">Dx</span><span class="op" id="5618835">(</span><span class="op" id="5618836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5618839">for</span>&nbsp;<span class="ident" id="5618843">y</span>&nbsp;<span class="op" id="5618845">:=</span>&nbsp;<span class="ident" id="5618848">p</span><span class="op" id="5618849">.</span><span class="ident" id="5618850">Rect</span><span class="op" id="5618854">.</span><span class="ident" id="5618855">Min</span><span class="op" id="5618858">.</span><span class="ident" id="5618859">Y</span><span class="op" id="5618860">;</span>&nbsp;<span class="ident" id="5618862">y</span>&nbsp;<span class="op" id="5618864">&lt;</span>&nbsp;<span class="ident" id="5618866">p</span><span class="op" id="5618867">.</span><span class="ident" id="5618868">Rect</span><span class="op" id="5618872">.</span><span class="ident" id="5618873">Max</span><span class="op" id="5618876">.</span><span class="ident" id="5618877">Y</span><span class="op" id="5618878">;</span>&nbsp;<span class="ident" id="5618880">y</span><span class="op" id="5618881">++</span>&nbsp;<span class="op" id="5618884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5618888">for</span>&nbsp;<span class="ident" id="5618892">_</span><span class="op" id="5618893">,</span>&nbsp;<span class="ident" id="5618895">c</span>&nbsp;<span class="op" id="5618897">:=</span>&nbsp;<span class="keyword" id="5618900">range</span>&nbsp;<span class="ident" id="5618906">p</span><span class="op" id="5618907">.</span><span class="ident" id="5618908">Pix</span><span class="op" id="5618911">[</span><span class="ident" id="5618912">i0</span><span class="op" id="5618914">:</span><span class="ident" id="5618915">i1</span><span class="op" id="5618917">]</span>&nbsp;<span class="op" id="5618919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5618924">present</span><span class="op" id="5618931">[</span><span class="ident" id="5618932">c</span><span class="op" id="5618933">]</span>&nbsp;<span class="op" id="5618935">=</span>&nbsp;<span class="builtintype" id="5618937">true</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5618944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5618948">i0</span>&nbsp;<span class="op" id="5618951">+=</span>&nbsp;<span class="ident" id="5618954">p</span><span class="op" id="5618955">.</span><span class="ident" id="5618956">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5618965">i1</span>&nbsp;<span class="op" id="5618968">+=</span>&nbsp;<span class="ident" id="5618971">p</span><span class="op" id="5618972">.</span><span class="ident" id="5618973">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5618981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5618984">for</span>&nbsp;<span class="ident" id="5618988">i</span><span class="op" id="5618989">,</span>&nbsp;<span class="ident" id="5618991">c</span>&nbsp;<span class="op" id="5618993">:=</span>&nbsp;<span class="keyword" id="5618996">range</span>&nbsp;<span class="ident" id="5619002">p</span><span class="op" id="5619003">.</span><span class="ident" id="5619004">Palette</span>&nbsp;<span class="op" id="5619012">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5619016">if</span>&nbsp;<span class="op" id="5619019">!</span><span class="ident" id="5619020">present</span><span class="op" id="5619027">[</span><span class="ident" id="5619028">i</span><span class="op" id="5619029">]</span>&nbsp;<span class="op" id="5619031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5619036">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5619047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5619051">_</span><span class="op" id="5619052">,</span>&nbsp;<span class="ident" id="5619054">_</span><span class="op" id="5619055">,</span>&nbsp;<span class="ident" id="5619057">_</span><span class="op" id="5619058">,</span>&nbsp;<span class="ident" id="5619060">a</span>&nbsp;<span class="op" id="5619062">:=</span>&nbsp;<span class="ident" id="5619065">c</span><span class="op" id="5619066">.</span><span class="ident" id="5619067">RGBA</span><span class="op" id="5619071">(</span><span class="op" id="5619072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5619076">if</span>&nbsp;<span class="ident" id="5619079">a</span>&nbsp;<span class="op" id="5619081">!=</span>&nbsp;<span class="num" id="5619084">0xffff</span>&nbsp;<span class="op" id="5619091">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5619096">return</span>&nbsp;<span class="builtintype" id="5619103">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5619111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5619114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5619117">return</span>&nbsp;<span class="builtintype" id="5619124">true</span><br>
<span class="lineno"></span><span class="op" id="5619129">}</span><br>
<span class="lineno">930</span><br>
<span class="lineno"></span><span class="comment" id="5619132">//&nbsp;NewPaletted&nbsp;returns&nbsp;a&nbsp;new&nbsp;Paletted&nbsp;with&nbsp;the&nbsp;given&nbsp;width,&nbsp;height&nbsp;and&nbsp;palette.</span><br>
<span class="lineno"></span><span class="keyword" id="5619212">func</span>&nbsp;<span class="ident" id="5619217">NewPaletted</span><span class="op" id="5619228">(</span><span class="ident" id="5619229">r</span>&nbsp;<span class="ident" id="5619231">Rectangle</span><span class="op" id="5619240">,</span>&nbsp;<span class="ident" id="5619242">p</span>&nbsp;<span class="ident" id="5619244">color</span><span class="op" id="5619249">.</span><span class="ident" id="5619250">Palette</span><span class="op" id="5619257">)</span>&nbsp;<span class="op" id="5619259">*</span><span class="ident" id="5619260">Paletted</span>&nbsp;<span class="op" id="5619269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5619272">w</span><span class="op" id="5619273">,</span>&nbsp;<span class="ident" id="5619275">h</span>&nbsp;<span class="op" id="5619277">:=</span>&nbsp;<span class="ident" id="5619280">r</span><span class="op" id="5619281">.</span><span class="ident" id="5619282">Dx</span><span class="op" id="5619284">(</span><span class="op" id="5619285">)</span><span class="op" id="5619286">,</span>&nbsp;<span class="ident" id="5619288">r</span><span class="op" id="5619289">.</span><span class="ident" id="5619290">Dy</span><span class="op" id="5619292">(</span><span class="op" id="5619293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5619296">pix</span>&nbsp;<span class="op" id="5619300">:=</span>&nbsp;<span class="builtinfunc" id="5619303">make</span><span class="op" id="5619307">(</span><span class="op" id="5619308">[</span><span class="op" id="5619309">]</span><span class="builtintype" id="5619310">uint8</span><span class="op" id="5619315">,</span>&nbsp;<span class="num" id="5619317">1</span><span class="op" id="5619318">*</span><span class="ident" id="5619319">w</span><span class="op" id="5619320">*</span><span class="ident" id="5619321">h</span><span class="op" id="5619322">)</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5619325">return</span>&nbsp;<span class="op" id="5619332">&amp;</span><span class="ident" id="5619333">Paletted</span><span class="op" id="5619341">{</span><span class="ident" id="5619342">pix</span><span class="op" id="5619345">,</span>&nbsp;<span class="num" id="5619347">1</span>&nbsp;<span class="op" id="5619349">*</span>&nbsp;<span class="ident" id="5619351">w</span><span class="op" id="5619352">,</span>&nbsp;<span class="ident" id="5619354">r</span><span class="op" id="5619355">,</span>&nbsp;<span class="ident" id="5619357">p</span><span class="op" id="5619358">}</span><br>
<span class="lineno"></span><span class="op" id="5619360">}</span>
</div>
</body>
</html>
