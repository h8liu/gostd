<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html</h2>
<ul>
<li><a href="/gostd/html/entity.go.html">entity.go</a></li>
<li><a href="/gostd/html/entity_test.go.html">entity_test.go</a></li>
<li><a href="/gostd/html/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/escape_test.go.html">escape_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4727902">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4727957">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4728011">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4728062">//&nbsp;Package&nbsp;html&nbsp;provides&nbsp;functions&nbsp;for&nbsp;escaping&nbsp;and&nbsp;unescaping&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="4728136">package</span>&nbsp;<span class="ident" id="4728144">html</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4728150">import</span>&nbsp;<span class="op" id="4728157">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728160">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728169">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728180">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4728195">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4728198">type</span>&nbsp;<span class="ident" id="4728203">writer</span>&nbsp;<span class="keyword" id="4728210">interface</span>&nbsp;<span class="op" id="4728220">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4728223">WriteString</span><span class="op" id="4728234">(</span><span class="builtintype" id="4728235">string</span><span class="op" id="4728241">)</span>&nbsp;<span class="op" id="4728243">(</span><span class="builtintype" id="4728244">int</span><span class="op" id="4728247">,</span>&nbsp;<span class="builtintype" id="4728249">error</span><span class="op" id="4728254">)</span><br>
<span class="lineno"></span><span class="op" id="4728256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4728259">//&nbsp;These&nbsp;replacements&nbsp;permit&nbsp;compatibility&nbsp;with&nbsp;old&nbsp;numeric&nbsp;entities&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4728333">//&nbsp;assumed&nbsp;Windows-1252&nbsp;encoding.</span><br>
<span class="lineno">20</span><span class="comment" id="4728367">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><span class="keyword" id="4728478">var</span>&nbsp;<span class="ident" id="4728482">replacementTable</span>&nbsp;<span class="op" id="4728499">=</span>&nbsp;<span class="op" id="4728501">[</span><span class="op" id="4728502">...</span><span class="op" id="4728505">]</span><span class="builtintype" id="4728506">rune</span><span class="op" id="4728510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728513">&#39;\u20AC&#39;</span><span class="op" id="4728521">,</span>&nbsp;<span class="comment" id="4728523">//&nbsp;First&nbsp;entry&nbsp;is&nbsp;what&nbsp;0x80&nbsp;should&nbsp;be&nbsp;replaced&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728577">&#39;\u0081&#39;</span><span class="op" id="4728585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728588">&#39;\u201A&#39;</span><span class="op" id="4728596">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728599">&#39;\u0192&#39;</span><span class="op" id="4728607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728610">&#39;\u201E&#39;</span><span class="op" id="4728618">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728621">&#39;\u2026&#39;</span><span class="op" id="4728629">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728632">&#39;\u2020&#39;</span><span class="op" id="4728640">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728643">&#39;\u2021&#39;</span><span class="op" id="4728651">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728654">&#39;\u02C6&#39;</span><span class="op" id="4728662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728665">&#39;\u2030&#39;</span><span class="op" id="4728673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728676">&#39;\u0160&#39;</span><span class="op" id="4728684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728687">&#39;\u2039&#39;</span><span class="op" id="4728695">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728698">&#39;\u0152&#39;</span><span class="op" id="4728706">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728709">&#39;\u008D&#39;</span><span class="op" id="4728717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728720">&#39;\u017D&#39;</span><span class="op" id="4728728">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728731">&#39;\u008F&#39;</span><span class="op" id="4728739">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728742">&#39;\u0090&#39;</span><span class="op" id="4728750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728753">&#39;\u2018&#39;</span><span class="op" id="4728761">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728764">&#39;\u2019&#39;</span><span class="op" id="4728772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728775">&#39;\u201C&#39;</span><span class="op" id="4728783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728786">&#39;\u201D&#39;</span><span class="op" id="4728794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728797">&#39;\u2022&#39;</span><span class="op" id="4728805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728808">&#39;\u2013&#39;</span><span class="op" id="4728816">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728819">&#39;\u2014&#39;</span><span class="op" id="4728827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728830">&#39;\u02DC&#39;</span><span class="op" id="4728838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728841">&#39;\u2122&#39;</span><span class="op" id="4728849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728852">&#39;\u0161&#39;</span><span class="op" id="4728860">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728863">&#39;\u203A&#39;</span><span class="op" id="4728871">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728874">&#39;\u0153&#39;</span><span class="op" id="4728882">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728885">&#39;\u009D&#39;</span><span class="op" id="4728893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728896">&#39;\u017E&#39;</span><span class="op" id="4728904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4728907">&#39;\u0178&#39;</span><span class="op" id="4728915">,</span>&nbsp;<span class="comment" id="4728917">//&nbsp;Last&nbsp;entry&nbsp;is&nbsp;0x9F.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4728941">//&nbsp;0x00-&gt;&#39;\uFFFD&#39;&nbsp;is&nbsp;handled&nbsp;programmatically.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4728989">//&nbsp;0x0D-&gt;&#39;\u000D&#39;&nbsp;is&nbsp;a&nbsp;no-op.</span><br>
<span class="lineno"></span><span class="op" id="4729019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4729022">//&nbsp;unescapeEntity&nbsp;reads&nbsp;an&nbsp;entity&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;from&nbsp;b[src:]&nbsp;and&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4729096">//&nbsp;corresponding&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;b[dst:],&nbsp;returning&nbsp;the&nbsp;incremented&nbsp;dst&nbsp;and&nbsp;src&nbsp;cursors.</span><br>
<span class="lineno">60</span><span class="comment" id="4729176">//&nbsp;Precondition:&nbsp;b[src]&nbsp;==&nbsp;&#39;&amp;&#39;&nbsp;&amp;&amp;&nbsp;dst&nbsp;&lt;=&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="4729222">//&nbsp;attribute&nbsp;should&nbsp;be&nbsp;true&nbsp;if&nbsp;parsing&nbsp;an&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4729281">func</span>&nbsp;<span class="ident" id="4729286">unescapeEntity</span><span class="op" id="4729300">(</span><span class="ident" id="4729301">b</span>&nbsp;<span class="op" id="4729303">[</span><span class="op" id="4729304">]</span><span class="builtintype" id="4729305">byte</span><span class="op" id="4729309">,</span>&nbsp;<span class="ident" id="4729311">dst</span><span class="op" id="4729314">,</span>&nbsp;<span class="ident" id="4729316">src</span>&nbsp;<span class="builtintype" id="4729320">int</span><span class="op" id="4729323">,</span>&nbsp;<span class="ident" id="4729325">attribute</span>&nbsp;<span class="builtintype" id="4729335">bool</span><span class="op" id="4729339">)</span>&nbsp;<span class="op" id="4729341">(</span><span class="ident" id="4729342">dst1</span><span class="op" id="4729346">,</span>&nbsp;<span class="ident" id="4729348">src1</span>&nbsp;<span class="builtintype" id="4729353">int</span><span class="op" id="4729356">)</span>&nbsp;<span class="op" id="4729358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4729361">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4729474">//&nbsp;i&nbsp;starts&nbsp;at&nbsp;1&nbsp;because&nbsp;we&nbsp;already&nbsp;know&nbsp;that&nbsp;s[0]&nbsp;==&nbsp;&#39;&amp;&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729534">i</span><span class="op" id="4729535">,</span>&nbsp;<span class="ident" id="4729537">s</span>&nbsp;<span class="op" id="4729539">:=</span>&nbsp;<span class="num" id="4729542">1</span><span class="op" id="4729543">,</span>&nbsp;<span class="ident" id="4729545">b</span><span class="op" id="4729546">[</span><span class="ident" id="4729547">src</span><span class="op" id="4729550">:</span><span class="op" id="4729551">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4729555">if</span>&nbsp;<span class="builtinfunc" id="4729558">len</span><span class="op" id="4729561">(</span><span class="ident" id="4729562">s</span><span class="op" id="4729563">)</span>&nbsp;<span class="op" id="4729565">&lt;=</span>&nbsp;<span class="num" id="4729568">1</span>&nbsp;<span class="op" id="4729570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729574">b</span><span class="op" id="4729575">[</span><span class="ident" id="4729576">dst</span><span class="op" id="4729579">]</span>&nbsp;<span class="op" id="4729581">=</span>&nbsp;<span class="ident" id="4729583">b</span><span class="op" id="4729584">[</span><span class="ident" id="4729585">src</span><span class="op" id="4729588">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4729592">return</span>&nbsp;<span class="ident" id="4729599">dst</span>&nbsp;<span class="op" id="4729603">+</span>&nbsp;<span class="num" id="4729605">1</span><span class="op" id="4729606">,</span>&nbsp;<span class="ident" id="4729608">src</span>&nbsp;<span class="op" id="4729612">+</span>&nbsp;<span class="num" id="4729614">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4729617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4729621">if</span>&nbsp;<span class="ident" id="4729624">s</span><span class="op" id="4729625">[</span><span class="ident" id="4729626">i</span><span class="op" id="4729627">]</span>&nbsp;<span class="op" id="4729629">==</span>&nbsp;<span class="string" id="4729632">&#39;#&#39;</span>&nbsp;<span class="op" id="4729636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4729640">if</span>&nbsp;<span class="builtinfunc" id="4729643">len</span><span class="op" id="4729646">(</span><span class="ident" id="4729647">s</span><span class="op" id="4729648">)</span>&nbsp;<span class="op" id="4729650">&lt;=</span>&nbsp;<span class="num" id="4729653">3</span>&nbsp;<span class="op" id="4729655">{</span>&nbsp;<span class="comment" id="4729657">//&nbsp;We&nbsp;need&nbsp;to&nbsp;have&nbsp;at&nbsp;least&nbsp;&#34;&amp;#.&#34;.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729695">b</span><span class="op" id="4729696">[</span><span class="ident" id="4729697">dst</span><span class="op" id="4729700">]</span>&nbsp;<span class="op" id="4729702">=</span>&nbsp;<span class="ident" id="4729704">b</span><span class="op" id="4729705">[</span><span class="ident" id="4729706">src</span><span class="op" id="4729709">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4729714">return</span>&nbsp;<span class="ident" id="4729721">dst</span>&nbsp;<span class="op" id="4729725">+</span>&nbsp;<span class="num" id="4729727">1</span><span class="op" id="4729728">,</span>&nbsp;<span class="ident" id="4729730">src</span>&nbsp;<span class="op" id="4729734">+</span>&nbsp;<span class="num" id="4729736">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4729740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729744">i</span><span class="op" id="4729745">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729750">c</span>&nbsp;<span class="op" id="4729752">:=</span>&nbsp;<span class="ident" id="4729755">s</span><span class="op" id="4729756">[</span><span class="ident" id="4729757">i</span><span class="op" id="4729758">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729762">hex</span>&nbsp;<span class="op" id="4729766">:=</span>&nbsp;<span class="builtintype" id="4729769">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4729777">if</span>&nbsp;<span class="ident" id="4729780">c</span>&nbsp;<span class="op" id="4729782">==</span>&nbsp;<span class="string" id="4729785">&#39;x&#39;</span>&nbsp;<span class="op" id="4729789">||</span>&nbsp;<span class="ident" id="4729792">c</span>&nbsp;<span class="op" id="4729794">==</span>&nbsp;<span class="string" id="4729797">&#39;X&#39;</span>&nbsp;<span class="op" id="4729801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729806">hex</span>&nbsp;<span class="op" id="4729810">=</span>&nbsp;<span class="builtintype" id="4729812">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729820">i</span><span class="op" id="4729821">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4729826">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729831">x</span>&nbsp;<span class="op" id="4729833">:=</span>&nbsp;<span class="string" id="4729836">&#39;\x00&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4729845">for</span>&nbsp;<span class="ident" id="4729849">i</span>&nbsp;<span class="op" id="4729851">&lt;</span>&nbsp;<span class="builtinfunc" id="4729853">len</span><span class="op" id="4729856">(</span><span class="ident" id="4729857">s</span><span class="op" id="4729858">)</span>&nbsp;<span class="op" id="4729860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729865">c</span>&nbsp;<span class="op" id="4729867">=</span>&nbsp;<span class="ident" id="4729869">s</span><span class="op" id="4729870">[</span><span class="ident" id="4729871">i</span><span class="op" id="4729872">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729877">i</span><span class="op" id="4729878">++</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4729884">if</span>&nbsp;<span class="ident" id="4729887">hex</span>&nbsp;<span class="op" id="4729891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4729897">if</span>&nbsp;<span class="string" id="4729900">&#39;0&#39;</span>&nbsp;<span class="op" id="4729904">&lt;=</span>&nbsp;<span class="ident" id="4729907">c</span>&nbsp;<span class="op" id="4729909">&amp;&amp;</span>&nbsp;<span class="ident" id="4729912">c</span>&nbsp;<span class="op" id="4729914">&lt;=</span>&nbsp;<span class="string" id="4729917">&#39;9&#39;</span>&nbsp;<span class="op" id="4729921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4729928">x</span>&nbsp;<span class="op" id="4729930">=</span>&nbsp;<span class="num" id="4729932">16</span><span class="op" id="4729934">*</span><span class="ident" id="4729935">x</span>&nbsp;<span class="op" id="4729937">+</span>&nbsp;<span class="builtintype" id="4729939">rune</span><span class="op" id="4729943">(</span><span class="ident" id="4729944">c</span><span class="op" id="4729945">)</span>&nbsp;<span class="op" id="4729947">-</span>&nbsp;<span class="string" id="4729949">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4729958">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4729971">}</span>&nbsp;<span class="keyword" id="4729973">else</span>&nbsp;<span class="keyword" id="4729978">if</span>&nbsp;<span class="string" id="4729981">&#39;a&#39;</span>&nbsp;<span class="op" id="4729985">&lt;=</span>&nbsp;<span class="ident" id="4729988">c</span>&nbsp;<span class="op" id="4729990">&amp;&amp;</span>&nbsp;<span class="ident" id="4729993">c</span>&nbsp;<span class="op" id="4729995">&lt;=</span>&nbsp;<span class="string" id="4729998">&#39;f&#39;</span>&nbsp;<span class="op" id="4730002">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4730009">x</span>&nbsp;<span class="op" id="4730011">=</span>&nbsp;<span class="num" id="4730013">16</span><span class="op" id="4730015">*</span><span class="ident" id="4730016">x</span>&nbsp;<span class="op" id="4730018">+</span>&nbsp;<span class="builtintype" id="4730020">rune</span><span class="op" id="4730024">(</span><span class="ident" id="4730025">c</span><span class="op" id="4730026">)</span>&nbsp;<span class="op" id="4730028">-</span>&nbsp;<span class="string" id="4730030">&#39;a&#39;</span>&nbsp;<span class="op" id="4730034">+</span>&nbsp;<span class="num" id="4730036">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4730044">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4730057">}</span>&nbsp;<span class="keyword" id="4730059">else</span>&nbsp;<span class="keyword" id="4730064">if</span>&nbsp;<span class="string" id="4730067">&#39;A&#39;</span>&nbsp;<span class="op" id="4730071">&lt;=</span>&nbsp;<span class="ident" id="4730074">c</span>&nbsp;<span class="op" id="4730076">&amp;&amp;</span>&nbsp;<span class="ident" id="4730079">c</span>&nbsp;<span class="op" id="4730081">&lt;=</span>&nbsp;<span class="string" id="4730084">&#39;F&#39;</span>&nbsp;<span class="op" id="4730088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4730095">x</span>&nbsp;<span class="op" id="4730097">=</span>&nbsp;<span class="num" id="4730099">16</span><span class="op" id="4730101">*</span><span class="ident" id="4730102">x</span>&nbsp;<span class="op" id="4730104">+</span>&nbsp;<span class="builtintype" id="4730106">rune</span><span class="op" id="4730110">(</span><span class="ident" id="4730111">c</span><span class="op" id="4730112">)</span>&nbsp;<span class="op" id="4730114">-</span>&nbsp;<span class="string" id="4730116">&#39;A&#39;</span>&nbsp;<span class="op" id="4730120">+</span>&nbsp;<span class="num" id="4730122">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4730130">continue</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4730143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4730148">}</span>&nbsp;<span class="keyword" id="4730150">else</span>&nbsp;<span class="keyword" id="4730155">if</span>&nbsp;<span class="string" id="4730158">&#39;0&#39;</span>&nbsp;<span class="op" id="4730162">&lt;=</span>&nbsp;<span class="ident" id="4730165">c</span>&nbsp;<span class="op" id="4730167">&amp;&amp;</span>&nbsp;<span class="ident" id="4730170">c</span>&nbsp;<span class="op" id="4730172">&lt;=</span>&nbsp;<span class="string" id="4730175">&#39;9&#39;</span>&nbsp;<span class="op" id="4730179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4730185">x</span>&nbsp;<span class="op" id="4730187">=</span>&nbsp;<span class="num" id="4730189">10</span><span class="op" id="4730191">*</span><span class="ident" id="4730192">x</span>&nbsp;<span class="op" id="4730194">+</span>&nbsp;<span class="builtintype" id="4730196">rune</span><span class="op" id="4730200">(</span><span class="ident" id="4730201">c</span><span class="op" id="4730202">)</span>&nbsp;<span class="op" id="4730204">-</span>&nbsp;<span class="string" id="4730206">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4730214">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4730226">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4730231">if</span>&nbsp;<span class="ident" id="4730234">c</span>&nbsp;<span class="op" id="4730236">!=</span>&nbsp;<span class="string" id="4730239">&#39;;&#39;</span>&nbsp;<span class="op" id="4730243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4730249">i</span><span class="op" id="4730250">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4730256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4730261">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4730269">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4730274">if</span>&nbsp;<span class="ident" id="4730277">i</span>&nbsp;<span class="op" id="4730279">&lt;=</span>&nbsp;<span class="num" id="4730282">3</span>&nbsp;<span class="op" id="4730284">{</span>&nbsp;<span class="comment" id="4730286">//&nbsp;No&nbsp;characters&nbsp;matched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4730315">b</span><span class="op" id="4730316">[</span><span class="ident" id="4730317">dst</span><span class="op" id="4730320">]</span>&nbsp;<span class="op" id="4730322">=</span>&nbsp;<span class="ident" id="4730324">b</span><span class="op" id="4730325">[</span><span class="ident" id="4730326">src</span><span class="op" id="4730329">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4730334">return</span>&nbsp;<span class="ident" id="4730341">dst</span>&nbsp;<span class="op" id="4730345">+</span>&nbsp;<span class="num" id="4730347">1</span><span class="op" id="4730348">,</span>&nbsp;<span class="ident" id="4730350">src</span>&nbsp;<span class="op" id="4730354">+</span>&nbsp;<span class="num" id="4730356">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4730360">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4730365">if</span>&nbsp;<span class="num" id="4730368">0x80</span>&nbsp;<span class="op" id="4730373">&lt;=</span>&nbsp;<span class="ident" id="4730376">x</span>&nbsp;<span class="op" id="4730378">&amp;&amp;</span>&nbsp;<span class="ident" id="4730381">x</span>&nbsp;<span class="op" id="4730383">&lt;=</span>&nbsp;<span class="num" id="4730386">0x9F</span>&nbsp;<span class="op" id="4730391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4730396">//&nbsp;Replace&nbsp;characters&nbsp;from&nbsp;Windows-1252&nbsp;with&nbsp;UTF-8&nbsp;equivalents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4730463">x</span>&nbsp;<span class="op" id="4730465">=</span>&nbsp;<span class="ident" id="4730467">replacementTable</span><span class="op" id="4730483">[</span><span class="ident" id="4730484">x</span><span class="op" id="4730485">-</span><span class="num" id="4730486">0x80</span><span class="op" id="4730490">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4730494">}</span>&nbsp;<span class="keyword" id="4730496">else</span>&nbsp;<span class="keyword" id="4730501">if</span>&nbsp;<span class="ident" id="4730504">x</span>&nbsp;<span class="op" id="4730506">==</span>&nbsp;<span class="num" id="4730509">0</span>&nbsp;<span class="op" id="4730511">||</span>&nbsp;<span class="op" id="4730514">(</span><span class="num" id="4730515">0xD800</span>&nbsp;<span class="op" id="4730522">&lt;=</span>&nbsp;<span class="ident" id="4730525">x</span>&nbsp;<span class="op" id="4730527">&amp;&amp;</span>&nbsp;<span class="ident" id="4730530">x</span>&nbsp;<span class="op" id="4730532">&lt;=</span>&nbsp;<span class="num" id="4730535">0xDFFF</span><span class="op" id="4730541">)</span>&nbsp;<span class="op" id="4730543">||</span>&nbsp;<span class="ident" id="4730546">x</span>&nbsp;<span class="op" id="4730548">&gt;</span>&nbsp;<span class="num" id="4730550">0x10FFFF</span>&nbsp;<span class="op" id="4730559">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4730564">//&nbsp;Replace&nbsp;invalid&nbsp;characters&nbsp;with&nbsp;the&nbsp;replacement&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4730629">x</span>&nbsp;<span class="op" id="4730631">=</span>&nbsp;<span class="string" id="4730633">&#39;\uFFFD&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4730644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4730649">return</span>&nbsp;<span class="ident" id="4730656">dst</span>&nbsp;<span class="op" id="4730660">+</span>&nbsp;<span class="ident" id="4730662">utf8</span><span class="op" id="4730666">.</span><span class="ident" id="4730667">EncodeRune</span><span class="op" id="4730677">(</span><span class="ident" id="4730678">b</span><span class="op" id="4730679">[</span><span class="ident" id="4730680">dst</span><span class="op" id="4730683">:</span><span class="op" id="4730684">]</span><span class="op" id="4730685">,</span>&nbsp;<span class="ident" id="4730687">x</span><span class="op" id="4730688">)</span><span class="op" id="4730689">,</span>&nbsp;<span class="ident" id="4730691">src</span>&nbsp;<span class="op" id="4730695">+</span>&nbsp;<span class="ident" id="4730697">i</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4730700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4730704">//&nbsp;Consume&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;characters&nbsp;possible,&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4730768">//&nbsp;consumed&nbsp;characters&nbsp;matching&nbsp;one&nbsp;of&nbsp;the&nbsp;named&nbsp;references.</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4730831">for</span>&nbsp;<span class="ident" id="4730835">i</span>&nbsp;<span class="op" id="4730837">&lt;</span>&nbsp;<span class="builtinfunc" id="4730839">len</span><span class="op" id="4730842">(</span><span class="ident" id="4730843">s</span><span class="op" id="4730844">)</span>&nbsp;<span class="op" id="4730846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4730850">c</span>&nbsp;<span class="op" id="4730852">:=</span>&nbsp;<span class="ident" id="4730855">s</span><span class="op" id="4730856">[</span><span class="ident" id="4730857">i</span><span class="op" id="4730858">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4730862">i</span><span class="op" id="4730863">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4730868">//&nbsp;Lower-cased&nbsp;characters&nbsp;are&nbsp;more&nbsp;common&nbsp;in&nbsp;entities,&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;them&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4730953">if</span>&nbsp;<span class="string" id="4730956">&#39;a&#39;</span>&nbsp;<span class="op" id="4730960">&lt;=</span>&nbsp;<span class="ident" id="4730963">c</span>&nbsp;<span class="op" id="4730965">&amp;&amp;</span>&nbsp;<span class="ident" id="4730968">c</span>&nbsp;<span class="op" id="4730970">&lt;=</span>&nbsp;<span class="string" id="4730973">&#39;z&#39;</span>&nbsp;<span class="op" id="4730977">||</span>&nbsp;<span class="string" id="4730980">&#39;A&#39;</span>&nbsp;<span class="op" id="4730984">&lt;=</span>&nbsp;<span class="ident" id="4730987">c</span>&nbsp;<span class="op" id="4730989">&amp;&amp;</span>&nbsp;<span class="ident" id="4730992">c</span>&nbsp;<span class="op" id="4730994">&lt;=</span>&nbsp;<span class="string" id="4730997">&#39;Z&#39;</span>&nbsp;<span class="op" id="4731001">||</span>&nbsp;<span class="string" id="4731004">&#39;0&#39;</span>&nbsp;<span class="op" id="4731008">&lt;=</span>&nbsp;<span class="ident" id="4731011">c</span>&nbsp;<span class="op" id="4731013">&amp;&amp;</span>&nbsp;<span class="ident" id="4731016">c</span>&nbsp;<span class="op" id="4731018">&lt;=</span>&nbsp;<span class="string" id="4731021">&#39;9&#39;</span>&nbsp;<span class="op" id="4731025">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731030">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4731041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731045">if</span>&nbsp;<span class="ident" id="4731048">c</span>&nbsp;<span class="op" id="4731050">!=</span>&nbsp;<span class="string" id="4731053">&#39;;&#39;</span>&nbsp;<span class="op" id="4731057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4731062">i</span><span class="op" id="4731063">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4731068">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731072">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4731079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4731083">entityName</span>&nbsp;<span class="op" id="4731094">:=</span>&nbsp;<span class="builtintype" id="4731097">string</span><span class="op" id="4731103">(</span><span class="ident" id="4731104">s</span><span class="op" id="4731105">[</span><span class="num" id="4731106">1</span><span class="op" id="4731107">:</span><span class="ident" id="4731108">i</span><span class="op" id="4731109">]</span><span class="op" id="4731110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731113">if</span>&nbsp;<span class="ident" id="4731116">entityName</span>&nbsp;<span class="op" id="4731127">==</span>&nbsp;<span class="string" id="4731130">&#34;&#34;</span>&nbsp;<span class="op" id="4731133">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731137">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4731148">}</span>&nbsp;<span class="keyword" id="4731150">else</span>&nbsp;<span class="keyword" id="4731155">if</span>&nbsp;<span class="ident" id="4731158">attribute</span>&nbsp;<span class="op" id="4731168">&amp;&amp;</span>&nbsp;<span class="ident" id="4731171">entityName</span><span class="op" id="4731181">[</span><span class="builtinfunc" id="4731182">len</span><span class="op" id="4731185">(</span><span class="ident" id="4731186">entityName</span><span class="op" id="4731196">)</span><span class="op" id="4731197">-</span><span class="num" id="4731198">1</span><span class="op" id="4731199">]</span>&nbsp;<span class="op" id="4731201">!=</span>&nbsp;<span class="string" id="4731204">&#39;;&#39;</span>&nbsp;<span class="op" id="4731208">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4731211">len</span><span class="op" id="4731214">(</span><span class="ident" id="4731215">s</span><span class="op" id="4731216">)</span>&nbsp;<span class="op" id="4731218">&gt;</span>&nbsp;<span class="ident" id="4731220">i</span>&nbsp;<span class="op" id="4731222">&amp;&amp;</span>&nbsp;<span class="ident" id="4731225">s</span><span class="op" id="4731226">[</span><span class="ident" id="4731227">i</span><span class="op" id="4731228">]</span>&nbsp;<span class="op" id="4731230">==</span>&nbsp;<span class="string" id="4731233">&#39;=&#39;</span>&nbsp;<span class="op" id="4731237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4731241">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4731252">}</span>&nbsp;<span class="keyword" id="4731254">else</span>&nbsp;<span class="keyword" id="4731259">if</span>&nbsp;<span class="ident" id="4731262">x</span>&nbsp;<span class="op" id="4731264">:=</span>&nbsp;<span class="ident" id="4731267">entity</span><span class="op" id="4731273">[</span><span class="ident" id="4731274">entityName</span><span class="op" id="4731284">]</span><span class="op" id="4731285">;</span>&nbsp;<span class="ident" id="4731287">x</span>&nbsp;<span class="op" id="4731289">!=</span>&nbsp;<span class="num" id="4731292">0</span>&nbsp;<span class="op" id="4731294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731298">return</span>&nbsp;<span class="ident" id="4731305">dst</span>&nbsp;<span class="op" id="4731309">+</span>&nbsp;<span class="ident" id="4731311">utf8</span><span class="op" id="4731315">.</span><span class="ident" id="4731316">EncodeRune</span><span class="op" id="4731326">(</span><span class="ident" id="4731327">b</span><span class="op" id="4731328">[</span><span class="ident" id="4731329">dst</span><span class="op" id="4731332">:</span><span class="op" id="4731333">]</span><span class="op" id="4731334">,</span>&nbsp;<span class="ident" id="4731336">x</span><span class="op" id="4731337">)</span><span class="op" id="4731338">,</span>&nbsp;<span class="ident" id="4731340">src</span>&nbsp;<span class="op" id="4731344">+</span>&nbsp;<span class="ident" id="4731346">i</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4731349">}</span>&nbsp;<span class="keyword" id="4731351">else</span>&nbsp;<span class="keyword" id="4731356">if</span>&nbsp;<span class="ident" id="4731359">x</span>&nbsp;<span class="op" id="4731361">:=</span>&nbsp;<span class="ident" id="4731364">entity2</span><span class="op" id="4731371">[</span><span class="ident" id="4731372">entityName</span><span class="op" id="4731382">]</span><span class="op" id="4731383">;</span>&nbsp;<span class="ident" id="4731385">x</span><span class="op" id="4731386">[</span><span class="num" id="4731387">0</span><span class="op" id="4731388">]</span>&nbsp;<span class="op" id="4731390">!=</span>&nbsp;<span class="num" id="4731393">0</span>&nbsp;<span class="op" id="4731395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4731399">dst1</span>&nbsp;<span class="op" id="4731404">:=</span>&nbsp;<span class="ident" id="4731407">dst</span>&nbsp;<span class="op" id="4731411">+</span>&nbsp;<span class="ident" id="4731413">utf8</span><span class="op" id="4731417">.</span><span class="ident" id="4731418">EncodeRune</span><span class="op" id="4731428">(</span><span class="ident" id="4731429">b</span><span class="op" id="4731430">[</span><span class="ident" id="4731431">dst</span><span class="op" id="4731434">:</span><span class="op" id="4731435">]</span><span class="op" id="4731436">,</span>&nbsp;<span class="ident" id="4731438">x</span><span class="op" id="4731439">[</span><span class="num" id="4731440">0</span><span class="op" id="4731441">]</span><span class="op" id="4731442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731446">return</span>&nbsp;<span class="ident" id="4731453">dst1</span>&nbsp;<span class="op" id="4731458">+</span>&nbsp;<span class="ident" id="4731460">utf8</span><span class="op" id="4731464">.</span><span class="ident" id="4731465">EncodeRune</span><span class="op" id="4731475">(</span><span class="ident" id="4731476">b</span><span class="op" id="4731477">[</span><span class="ident" id="4731478">dst1</span><span class="op" id="4731482">:</span><span class="op" id="4731483">]</span><span class="op" id="4731484">,</span>&nbsp;<span class="ident" id="4731486">x</span><span class="op" id="4731487">[</span><span class="num" id="4731488">1</span><span class="op" id="4731489">]</span><span class="op" id="4731490">)</span><span class="op" id="4731491">,</span>&nbsp;<span class="ident" id="4731493">src</span>&nbsp;<span class="op" id="4731497">+</span>&nbsp;<span class="ident" id="4731499">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4731502">}</span>&nbsp;<span class="keyword" id="4731504">else</span>&nbsp;<span class="keyword" id="4731509">if</span>&nbsp;<span class="op" id="4731512">!</span><span class="ident" id="4731513">attribute</span>&nbsp;<span class="op" id="4731523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4731527">maxLen</span>&nbsp;<span class="op" id="4731534">:=</span>&nbsp;<span class="builtinfunc" id="4731537">len</span><span class="op" id="4731540">(</span><span class="ident" id="4731541">entityName</span><span class="op" id="4731551">)</span>&nbsp;<span class="op" id="4731553">-</span>&nbsp;<span class="num" id="4731555">1</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731559">if</span>&nbsp;<span class="ident" id="4731562">maxLen</span>&nbsp;<span class="op" id="4731569">&gt;</span>&nbsp;<span class="ident" id="4731571">longestEntityWithoutSemicolon</span>&nbsp;<span class="op" id="4731601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4731606">maxLen</span>&nbsp;<span class="op" id="4731613">=</span>&nbsp;<span class="ident" id="4731615">longestEntityWithoutSemicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4731647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731651">for</span>&nbsp;<span class="ident" id="4731655">j</span>&nbsp;<span class="op" id="4731657">:=</span>&nbsp;<span class="ident" id="4731660">maxLen</span><span class="op" id="4731666">;</span>&nbsp;<span class="ident" id="4731668">j</span>&nbsp;<span class="op" id="4731670">&gt;</span>&nbsp;<span class="num" id="4731672">1</span><span class="op" id="4731673">;</span>&nbsp;<span class="ident" id="4731675">j</span><span class="op" id="4731676">--</span>&nbsp;<span class="op" id="4731679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731684">if</span>&nbsp;<span class="ident" id="4731687">x</span>&nbsp;<span class="op" id="4731689">:=</span>&nbsp;<span class="ident" id="4731692">entity</span><span class="op" id="4731698">[</span><span class="ident" id="4731699">entityName</span><span class="op" id="4731709">[</span><span class="op" id="4731710">:</span><span class="ident" id="4731711">j</span><span class="op" id="4731712">]</span><span class="op" id="4731713">]</span><span class="op" id="4731714">;</span>&nbsp;<span class="ident" id="4731716">x</span>&nbsp;<span class="op" id="4731718">!=</span>&nbsp;<span class="num" id="4731721">0</span>&nbsp;<span class="op" id="4731723">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731729">return</span>&nbsp;<span class="ident" id="4731736">dst</span>&nbsp;<span class="op" id="4731740">+</span>&nbsp;<span class="ident" id="4731742">utf8</span><span class="op" id="4731746">.</span><span class="ident" id="4731747">EncodeRune</span><span class="op" id="4731757">(</span><span class="ident" id="4731758">b</span><span class="op" id="4731759">[</span><span class="ident" id="4731760">dst</span><span class="op" id="4731763">:</span><span class="op" id="4731764">]</span><span class="op" id="4731765">,</span>&nbsp;<span class="ident" id="4731767">x</span><span class="op" id="4731768">)</span><span class="op" id="4731769">,</span>&nbsp;<span class="ident" id="4731771">src</span>&nbsp;<span class="op" id="4731775">+</span>&nbsp;<span class="ident" id="4731777">j</span>&nbsp;<span class="op" id="4731779">+</span>&nbsp;<span class="num" id="4731781">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4731786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4731790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4731793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4731797">dst1</span><span class="op" id="4731801">,</span>&nbsp;<span class="ident" id="4731803">src1</span>&nbsp;<span class="op" id="4731808">=</span>&nbsp;<span class="ident" id="4731810">dst</span><span class="op" id="4731813">+</span><span class="ident" id="4731814">i</span><span class="op" id="4731815">,</span>&nbsp;<span class="ident" id="4731817">src</span><span class="op" id="4731820">+</span><span class="ident" id="4731821">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4731824">copy</span><span class="op" id="4731828">(</span><span class="ident" id="4731829">b</span><span class="op" id="4731830">[</span><span class="ident" id="4731831">dst</span><span class="op" id="4731834">:</span><span class="ident" id="4731835">dst1</span><span class="op" id="4731839">]</span><span class="op" id="4731840">,</span>&nbsp;<span class="ident" id="4731842">b</span><span class="op" id="4731843">[</span><span class="ident" id="4731844">src</span><span class="op" id="4731847">:</span><span class="ident" id="4731848">src1</span><span class="op" id="4731852">]</span><span class="op" id="4731853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731856">return</span>&nbsp;<span class="ident" id="4731863">dst1</span><span class="op" id="4731867">,</span>&nbsp;<span class="ident" id="4731869">src1</span><br>
<span class="lineno"></span><span class="op" id="4731874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="4731877">//&nbsp;unescape&nbsp;unescapes&nbsp;b&#39;s&nbsp;entities&nbsp;in-place,&nbsp;so&nbsp;that&nbsp;&#34;a&amp;lt;b&#34;&nbsp;becomes&nbsp;&#34;a&lt;b&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4731954">func</span>&nbsp;<span class="ident" id="4731959">unescape</span><span class="op" id="4731967">(</span><span class="ident" id="4731968">b</span>&nbsp;<span class="op" id="4731970">[</span><span class="op" id="4731971">]</span><span class="builtintype" id="4731972">byte</span><span class="op" id="4731976">)</span>&nbsp;<span class="op" id="4731978">[</span><span class="op" id="4731979">]</span><span class="builtintype" id="4731980">byte</span>&nbsp;<span class="op" id="4731985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4731988">for</span>&nbsp;<span class="ident" id="4731992">i</span><span class="op" id="4731993">,</span>&nbsp;<span class="ident" id="4731995">c</span>&nbsp;<span class="op" id="4731997">:=</span>&nbsp;<span class="keyword" id="4732000">range</span>&nbsp;<span class="ident" id="4732006">b</span>&nbsp;<span class="op" id="4732008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732012">if</span>&nbsp;<span class="ident" id="4732015">c</span>&nbsp;<span class="op" id="4732017">==</span>&nbsp;<span class="string" id="4732020">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4732024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732029">dst</span><span class="op" id="4732032">,</span>&nbsp;<span class="ident" id="4732034">src</span>&nbsp;<span class="op" id="4732038">:=</span>&nbsp;<span class="ident" id="4732041">unescapeEntity</span><span class="op" id="4732055">(</span><span class="ident" id="4732056">b</span><span class="op" id="4732057">,</span>&nbsp;<span class="ident" id="4732059">i</span><span class="op" id="4732060">,</span>&nbsp;<span class="ident" id="4732062">i</span><span class="op" id="4732063">,</span>&nbsp;<span class="builtintype" id="4732065">false</span><span class="op" id="4732070">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732075">for</span>&nbsp;<span class="ident" id="4732079">src</span>&nbsp;<span class="op" id="4732083">&lt;</span>&nbsp;<span class="builtinfunc" id="4732085">len</span><span class="op" id="4732088">(</span><span class="ident" id="4732089">b</span><span class="op" id="4732090">)</span>&nbsp;<span class="op" id="4732092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732098">c</span>&nbsp;<span class="op" id="4732100">:=</span>&nbsp;<span class="ident" id="4732103">b</span><span class="op" id="4732104">[</span><span class="ident" id="4732105">src</span><span class="op" id="4732108">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732114">if</span>&nbsp;<span class="ident" id="4732117">c</span>&nbsp;<span class="op" id="4732119">==</span>&nbsp;<span class="string" id="4732122">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4732126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732133">dst</span><span class="op" id="4732136">,</span>&nbsp;<span class="ident" id="4732138">src</span>&nbsp;<span class="op" id="4732142">=</span>&nbsp;<span class="ident" id="4732144">unescapeEntity</span><span class="op" id="4732158">(</span><span class="ident" id="4732159">b</span><span class="op" id="4732160">,</span>&nbsp;<span class="ident" id="4732162">dst</span><span class="op" id="4732165">,</span>&nbsp;<span class="ident" id="4732167">src</span><span class="op" id="4732170">,</span>&nbsp;<span class="builtintype" id="4732172">false</span><span class="op" id="4732177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4732183">}</span>&nbsp;<span class="keyword" id="4732185">else</span>&nbsp;<span class="op" id="4732190">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732197">b</span><span class="op" id="4732198">[</span><span class="ident" id="4732199">dst</span><span class="op" id="4732202">]</span>&nbsp;<span class="op" id="4732204">=</span>&nbsp;<span class="ident" id="4732206">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732213">dst</span><span class="op" id="4732216">,</span>&nbsp;<span class="ident" id="4732218">src</span>&nbsp;<span class="op" id="4732222">=</span>&nbsp;<span class="ident" id="4732224">dst</span><span class="op" id="4732227">+</span><span class="num" id="4732228">1</span><span class="op" id="4732229">,</span>&nbsp;<span class="ident" id="4732231">src</span><span class="op" id="4732234">+</span><span class="num" id="4732235">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4732241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4732246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732251">return</span>&nbsp;<span class="ident" id="4732258">b</span><span class="op" id="4732259">[</span><span class="num" id="4732260">0</span><span class="op" id="4732261">:</span><span class="ident" id="4732262">dst</span><span class="op" id="4732265">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4732269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4732272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732275">return</span>&nbsp;<span class="ident" id="4732282">b</span><br>
<span class="lineno"></span><span class="op" id="4732284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="4732287">const</span>&nbsp;<span class="ident" id="4732293">escapedChars</span>&nbsp;<span class="op" id="4732306">=</span>&nbsp;<span class="string" id="4732308">`&amp;&#39;&lt;&gt;&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4732317">func</span>&nbsp;<span class="ident" id="4732322">escape</span><span class="op" id="4732328">(</span><span class="ident" id="4732329">w</span>&nbsp;<span class="ident" id="4732331">writer</span><span class="op" id="4732337">,</span>&nbsp;<span class="ident" id="4732339">s</span>&nbsp;<span class="builtintype" id="4732341">string</span><span class="op" id="4732347">)</span>&nbsp;<span class="builtintype" id="4732349">error</span>&nbsp;<span class="op" id="4732355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732358">i</span>&nbsp;<span class="op" id="4732360">:=</span>&nbsp;<span class="ident" id="4732363">strings</span><span class="op" id="4732370">.</span><span class="ident" id="4732371">IndexAny</span><span class="op" id="4732379">(</span><span class="ident" id="4732380">s</span><span class="op" id="4732381">,</span>&nbsp;<span class="ident" id="4732383">escapedChars</span><span class="op" id="4732395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732398">for</span>&nbsp;<span class="ident" id="4732402">i</span>&nbsp;<span class="op" id="4732404">!=</span>&nbsp;<span class="op" id="4732407">-</span><span class="num" id="4732408">1</span>&nbsp;<span class="op" id="4732410">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732414">if</span>&nbsp;<span class="ident" id="4732417">_</span><span class="op" id="4732418">,</span>&nbsp;<span class="ident" id="4732420">err</span>&nbsp;<span class="op" id="4732424">:=</span>&nbsp;<span class="ident" id="4732427">w</span><span class="op" id="4732428">.</span><span class="ident" id="4732429">WriteString</span><span class="op" id="4732440">(</span><span class="ident" id="4732441">s</span><span class="op" id="4732442">[</span><span class="op" id="4732443">:</span><span class="ident" id="4732444">i</span><span class="op" id="4732445">]</span><span class="op" id="4732446">)</span><span class="op" id="4732447">;</span>&nbsp;<span class="ident" id="4732449">err</span>&nbsp;<span class="op" id="4732453">!=</span>&nbsp;<span class="ident" id="4732456">nil</span>&nbsp;<span class="op" id="4732460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732465">return</span>&nbsp;<span class="ident" id="4732472">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4732478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732482">var</span>&nbsp;<span class="ident" id="4732486">esc</span>&nbsp;<span class="builtintype" id="4732490">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732499">switch</span>&nbsp;<span class="ident" id="4732506">s</span><span class="op" id="4732507">[</span><span class="ident" id="4732508">i</span><span class="op" id="4732509">]</span>&nbsp;<span class="op" id="4732511">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732515">case</span>&nbsp;<span class="string" id="4732520">&#39;&amp;&#39;</span><span class="op" id="4732523">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732528">esc</span>&nbsp;<span class="op" id="4732532">=</span>&nbsp;<span class="string" id="4732534">&#34;&amp;amp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732544">case</span>&nbsp;<span class="string" id="4732549">&#39;\&#39;&#39;</span><span class="op" id="4732553">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4732558">//&nbsp;&#34;&amp;#39;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;apos;&#34;&nbsp;and&nbsp;apos&nbsp;was&nbsp;not&nbsp;in&nbsp;HTML&nbsp;until&nbsp;HTML5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732635">esc</span>&nbsp;<span class="op" id="4732639">=</span>&nbsp;<span class="string" id="4732641">&#34;&amp;#39;&#34;</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732651">case</span>&nbsp;<span class="string" id="4732656">&#39;&lt;&#39;</span><span class="op" id="4732659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732664">esc</span>&nbsp;<span class="op" id="4732668">=</span>&nbsp;<span class="string" id="4732670">&#34;&amp;lt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732679">case</span>&nbsp;<span class="string" id="4732684">&#39;&gt;&#39;</span><span class="op" id="4732687">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732692">esc</span>&nbsp;<span class="op" id="4732696">=</span>&nbsp;<span class="string" id="4732698">&#34;&amp;gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732707">case</span>&nbsp;<span class="string" id="4732712">&#39;&#34;&#39;</span><span class="op" id="4732715">:</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4732720">//&nbsp;&#34;&amp;#34;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;quot;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732760">esc</span>&nbsp;<span class="op" id="4732764">=</span>&nbsp;<span class="string" id="4732766">&#34;&amp;#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732776">default</span><span class="op" id="4732783">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4732788">panic</span><span class="op" id="4732793">(</span><span class="string" id="4732794">&#34;unrecognized&nbsp;escape&nbsp;character&#34;</span><span class="op" id="4732825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4732829">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732833">s</span>&nbsp;<span class="op" id="4732835">=</span>&nbsp;<span class="ident" id="4732837">s</span><span class="op" id="4732838">[</span><span class="ident" id="4732839">i</span><span class="op" id="4732840">+</span><span class="num" id="4732841">1</span><span class="op" id="4732842">:</span><span class="op" id="4732843">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732847">if</span>&nbsp;<span class="ident" id="4732850">_</span><span class="op" id="4732851">,</span>&nbsp;<span class="ident" id="4732853">err</span>&nbsp;<span class="op" id="4732857">:=</span>&nbsp;<span class="ident" id="4732860">w</span><span class="op" id="4732861">.</span><span class="ident" id="4732862">WriteString</span><span class="op" id="4732873">(</span><span class="ident" id="4732874">esc</span><span class="op" id="4732877">)</span><span class="op" id="4732878">;</span>&nbsp;<span class="ident" id="4732880">err</span>&nbsp;<span class="op" id="4732884">!=</span>&nbsp;<span class="ident" id="4732887">nil</span>&nbsp;<span class="op" id="4732891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732896">return</span>&nbsp;<span class="ident" id="4732903">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4732909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732913">i</span>&nbsp;<span class="op" id="4732915">=</span>&nbsp;<span class="ident" id="4732917">strings</span><span class="op" id="4732924">.</span><span class="ident" id="4732925">IndexAny</span><span class="op" id="4732933">(</span><span class="ident" id="4732934">s</span><span class="op" id="4732935">,</span>&nbsp;<span class="ident" id="4732937">escapedChars</span><span class="op" id="4732949">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4732952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4732955">_</span><span class="op" id="4732956">,</span>&nbsp;<span class="ident" id="4732958">err</span>&nbsp;<span class="op" id="4732962">:=</span>&nbsp;<span class="ident" id="4732965">w</span><span class="op" id="4732966">.</span><span class="ident" id="4732967">WriteString</span><span class="op" id="4732978">(</span><span class="ident" id="4732979">s</span><span class="op" id="4732980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4732983">return</span>&nbsp;<span class="ident" id="4732990">err</span><br>
<span class="lineno"></span><span class="op" id="4732994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="comment" id="4732997">//&nbsp;EscapeString&nbsp;escapes&nbsp;special&nbsp;characters&nbsp;like&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&amp;lt;&#34;.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4733070">//&nbsp;escapes&nbsp;only&nbsp;five&nbsp;such&nbsp;characters:&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;&#39;&nbsp;and&nbsp;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4733126">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="4733203">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="4733219">func</span>&nbsp;<span class="ident" id="4733224">EscapeString</span><span class="op" id="4733236">(</span><span class="ident" id="4733237">s</span>&nbsp;<span class="builtintype" id="4733239">string</span><span class="op" id="4733245">)</span>&nbsp;<span class="builtintype" id="4733247">string</span>&nbsp;<span class="op" id="4733254">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4733257">if</span>&nbsp;<span class="ident" id="4733260">strings</span><span class="op" id="4733267">.</span><span class="ident" id="4733268">IndexAny</span><span class="op" id="4733276">(</span><span class="ident" id="4733277">s</span><span class="op" id="4733278">,</span>&nbsp;<span class="ident" id="4733280">escapedChars</span><span class="op" id="4733292">)</span>&nbsp;<span class="op" id="4733294">==</span>&nbsp;<span class="op" id="4733297">-</span><span class="num" id="4733298">1</span>&nbsp;<span class="op" id="4733300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4733304">return</span>&nbsp;<span class="ident" id="4733311">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4733314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4733317">var</span>&nbsp;<span class="ident" id="4733321">buf</span>&nbsp;<span class="ident" id="4733325">bytes</span><span class="op" id="4733330">.</span><span class="ident" id="4733331">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4733339">escape</span><span class="op" id="4733345">(</span><span class="op" id="4733346">&amp;</span><span class="ident" id="4733347">buf</span><span class="op" id="4733350">,</span>&nbsp;<span class="ident" id="4733352">s</span><span class="op" id="4733353">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4733356">return</span>&nbsp;<span class="ident" id="4733363">buf</span><span class="op" id="4733366">.</span><span class="ident" id="4733367">String</span><span class="op" id="4733373">(</span><span class="op" id="4733374">)</span><br>
<span class="lineno"></span><span class="op" id="4733376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4733379">//&nbsp;UnescapeString&nbsp;unescapes&nbsp;entities&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&lt;&#34;.&nbsp;It&nbsp;unescapes&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4733458">//&nbsp;larger&nbsp;range&nbsp;of&nbsp;entities&nbsp;than&nbsp;EscapeString&nbsp;escapes.&nbsp;For&nbsp;example,&nbsp;&#34;&amp;aacute;&#34;</span><br>
<span class="lineno">240</span><span class="comment" id="4733537">//&nbsp;unescapes&nbsp;to&nbsp;&#34;&#34;,&nbsp;as&nbsp;does&nbsp;&#34;&amp;#225;&#34;&nbsp;and&nbsp;&#34;&amp;xE1;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4733589">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="4733666">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="4733682">func</span>&nbsp;<span class="ident" id="4733687">UnescapeString</span><span class="op" id="4733701">(</span><span class="ident" id="4733702">s</span>&nbsp;<span class="builtintype" id="4733704">string</span><span class="op" id="4733710">)</span>&nbsp;<span class="builtintype" id="4733712">string</span>&nbsp;<span class="op" id="4733719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4733722">for</span>&nbsp;<span class="ident" id="4733726">_</span><span class="op" id="4733727">,</span>&nbsp;<span class="ident" id="4733729">c</span>&nbsp;<span class="op" id="4733731">:=</span>&nbsp;<span class="keyword" id="4733734">range</span>&nbsp;<span class="ident" id="4733740">s</span>&nbsp;<span class="op" id="4733742">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4733746">if</span>&nbsp;<span class="ident" id="4733749">c</span>&nbsp;<span class="op" id="4733751">==</span>&nbsp;<span class="string" id="4733754">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4733758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4733763">return</span>&nbsp;<span class="builtintype" id="4733770">string</span><span class="op" id="4733776">(</span><span class="ident" id="4733777">unescape</span><span class="op" id="4733785">(</span><span class="op" id="4733786">[</span><span class="op" id="4733787">]</span><span class="builtintype" id="4733788">byte</span><span class="op" id="4733792">(</span><span class="ident" id="4733793">s</span><span class="op" id="4733794">)</span><span class="op" id="4733795">)</span><span class="op" id="4733796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4733800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4733803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4733806">return</span>&nbsp;<span class="ident" id="4733813">s</span><br>
<span class="lineno">250</span><span class="op" id="4733815">}</span>
</div>
</body>
</html>
