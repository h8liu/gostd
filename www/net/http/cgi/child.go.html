<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6138082">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6138137">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6138191">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6138242">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;CGI&nbsp;from&nbsp;the&nbsp;perspective&nbsp;of&nbsp;a&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="6138302">//&nbsp;process.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6138315">package</span>&nbsp;<span class="ident" id="6138323">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6138328">import</span>&nbsp;<span class="op" id="6138335">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6138338">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6138347">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6138361">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6138371">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6138378">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6138384">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6138397">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6138404">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6138416">&#34;net/url&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6138427">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6138433">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6138444">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="6138454">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="6138457">//&nbsp;Request&nbsp;returns&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;as&nbsp;represented&nbsp;in&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="6138523">//&nbsp;environment.&nbsp;This&nbsp;assumes&nbsp;the&nbsp;current&nbsp;program&nbsp;is&nbsp;being&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="6138585">//&nbsp;by&nbsp;a&nbsp;web&nbsp;server&nbsp;in&nbsp;a&nbsp;CGI&nbsp;environment.</span><br>
<span class="lineno"></span><span class="comment" id="6138626">//&nbsp;The&nbsp;returned&nbsp;Request&#39;s&nbsp;Body&nbsp;is&nbsp;populated,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span><span class="keyword" id="6138686">func</span>&nbsp;<span class="ident" id="6138691">Request</span><span class="op" id="6138698">(</span><span class="op" id="6138699">)</span>&nbsp;<span class="op" id="6138701">(</span><span class="op" id="6138702">*</span><span class="ident" id="6138703"><a href="/net/http/cgi/child.go.html#6138404">http</a></span><span class="op" id="6138707">.</span><span class="ident" id="6138708">Request</span><span class="op" id="6138715">,</span>&nbsp;<span class="builtintype" id="6138717">error</span><span class="op" id="6138722">)</span>&nbsp;<span class="op" id="6138724">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6138727">r</span><span class="op" id="6138728">,</span>&nbsp;<span class="ident" id="6138730">err</span>&nbsp;<span class="op" id="6138734">:=</span>&nbsp;<span class="ident" id="6138737"><a href="/net/http/cgi/child.go.html#6139250">RequestFromMap</a></span><span class="op" id="6138751">(</span><span class="ident" id="6138752"><a href="/net/http/cgi/child.go.html#6138935">envMap</a></span><span class="op" id="6138758">(</span><span class="ident" id="6138759"><a href="/net/http/cgi/child.go.html#6138427">os</a></span><span class="op" id="6138761">.</span><span class="ident" id="6138762">Environ</span><span class="op" id="6138769">(</span><span class="op" id="6138770">)</span><span class="op" id="6138771">)</span><span class="op" id="6138772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6138775">if</span>&nbsp;<span class="ident" id="6138778"><a href="/net/http/cgi/child.go.html#6138730">err</a></span>&nbsp;<span class="op" id="6138782">!=</span>&nbsp;<span class="ident" id="6138785">nil</span>&nbsp;<span class="op" id="6138789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6138793">return</span>&nbsp;<span class="ident" id="6138800">nil</span><span class="op" id="6138803">,</span>&nbsp;<span class="ident" id="6138805"><a href="/net/http/cgi/child.go.html#6138730">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6138810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6138813">if</span>&nbsp;<span class="ident" id="6138816"><a href="/net/http/cgi/child.go.html#6138727">r</a></span><span class="op" id="6138817">.</span><span class="ident" id="6138818">ContentLength</span>&nbsp;<span class="op" id="6138832">&gt;</span>&nbsp;<span class="num" id="6138834">0</span>&nbsp;<span class="op" id="6138836">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6138840"><a href="/net/http/cgi/child.go.html#6138727">r</a></span><span class="op" id="6138841">.</span><span class="ident" id="6138842">Body</span>&nbsp;<span class="op" id="6138847">=</span>&nbsp;<span class="ident" id="6138849"><a href="/net/http/cgi/child.go.html#6138384">ioutil</a></span><span class="op" id="6138855">.</span><span class="ident" id="6138856">NopCloser</span><span class="op" id="6138865">(</span><span class="ident" id="6138866"><a href="/net/http/cgi/child.go.html#6138378">io</a></span><span class="op" id="6138868">.</span><span class="ident" id="6138869">LimitReader</span><span class="op" id="6138880">(</span><span class="ident" id="6138881"><a href="/net/http/cgi/child.go.html#6138427">os</a></span><span class="op" id="6138883">.</span><span class="ident" id="6138884">Stdin</span><span class="op" id="6138889">,</span>&nbsp;<span class="ident" id="6138891"><a href="/net/http/cgi/child.go.html#6138727">r</a></span><span class="op" id="6138892">.</span><span class="ident" id="6138893">ContentLength</span><span class="op" id="6138906">)</span><span class="op" id="6138907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6138910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6138913">return</span>&nbsp;<span class="ident" id="6138920"><a href="/net/http/cgi/child.go.html#6138727">r</a></span><span class="op" id="6138921">,</span>&nbsp;<span class="ident" id="6138923">nil</span><br>
<span class="lineno"></span><span class="op" id="6138927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="6138930">func</span>&nbsp;<span class="ident" id="6138935">envMap</span><span class="op" id="6138941">(</span><span class="ident" id="6138942">env</span>&nbsp;<span class="op" id="6138946">[</span><span class="op" id="6138947">]</span><span class="builtintype" id="6138948">string</span><span class="op" id="6138954">)</span>&nbsp;<span class="keyword" id="6138956">map</span><span class="op" id="6138959">[</span><span class="builtintype" id="6138960">string</span><span class="op" id="6138966">]</span><span class="builtintype" id="6138967">string</span>&nbsp;<span class="op" id="6138974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6138977">m</span>&nbsp;<span class="op" id="6138979">:=</span>&nbsp;<span class="builtinfunc" id="6138982">make</span><span class="op" id="6138986">(</span><span class="keyword" id="6138987">map</span><span class="op" id="6138990">[</span><span class="builtintype" id="6138991">string</span><span class="op" id="6138997">]</span><span class="builtintype" id="6138998">string</span><span class="op" id="6139004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139007">for</span>&nbsp;<span class="ident" id="6139011">_</span><span class="op" id="6139012">,</span>&nbsp;<span class="ident" id="6139014">kv</span>&nbsp;<span class="op" id="6139017">:=</span>&nbsp;<span class="keyword" id="6139020">range</span>&nbsp;<span class="ident" id="6139026"><a href="/net/http/cgi/child.go.html#6138942">env</a></span>&nbsp;<span class="op" id="6139030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139034">if</span>&nbsp;<span class="ident" id="6139037">idx</span>&nbsp;<span class="op" id="6139041">:=</span>&nbsp;<span class="ident" id="6139044"><a href="/net/http/cgi/child.go.html#6138444">strings</a></span><span class="op" id="6139051">.</span><span class="ident" id="6139052">Index</span><span class="op" id="6139057">(</span><span class="ident" id="6139058"><a href="/net/http/cgi/child.go.html#6139014">kv</a></span><span class="op" id="6139060">,</span>&nbsp;<span class="string" id="6139062">&#34;=&#34;</span><span class="op" id="6139065">)</span><span class="op" id="6139066">;</span>&nbsp;<span class="ident" id="6139068"><a href="/net/http/cgi/child.go.html#6139037">idx</a></span>&nbsp;<span class="op" id="6139072">!=</span>&nbsp;<span class="op" id="6139075">-</span><span class="num" id="6139076">1</span>&nbsp;<span class="op" id="6139078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139083"><a href="/net/http/cgi/child.go.html#6138977">m</a></span><span class="op" id="6139084">[</span><span class="ident" id="6139085"><a href="/net/http/cgi/child.go.html#6139014">kv</a></span><span class="op" id="6139087">[</span><span class="op" id="6139088">:</span><span class="ident" id="6139089"><a href="/net/http/cgi/child.go.html#6139037">idx</a></span><span class="op" id="6139092">]</span><span class="op" id="6139093">]</span>&nbsp;<span class="op" id="6139095">=</span>&nbsp;<span class="ident" id="6139097"><a href="/net/http/cgi/child.go.html#6139014">kv</a></span><span class="op" id="6139099">[</span><span class="ident" id="6139100"><a href="/net/http/cgi/child.go.html#6139037">idx</a></span><span class="op" id="6139103">+</span><span class="num" id="6139104">1</span><span class="op" id="6139105">:</span><span class="op" id="6139106">]</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6139110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6139113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139116">return</span>&nbsp;<span class="ident" id="6139123"><a href="/net/http/cgi/child.go.html#6138977">m</a></span><br>
<span class="lineno"></span><span class="op" id="6139125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="6139128">//&nbsp;RequestFromMap&nbsp;creates&nbsp;an&nbsp;http.Request&nbsp;from&nbsp;CGI&nbsp;variables.</span><br>
<span class="lineno"></span><span class="comment" id="6139190">//&nbsp;The&nbsp;returned&nbsp;Request&#39;s&nbsp;Body&nbsp;field&nbsp;is&nbsp;not&nbsp;populated.</span><br>
<span class="lineno"></span><span class="keyword" id="6139245">func</span>&nbsp;<span class="ident" id="6139250">RequestFromMap</span><span class="op" id="6139264">(</span><span class="ident" id="6139265">params</span>&nbsp;<span class="keyword" id="6139272">map</span><span class="op" id="6139275">[</span><span class="builtintype" id="6139276">string</span><span class="op" id="6139282">]</span><span class="builtintype" id="6139283">string</span><span class="op" id="6139289">)</span>&nbsp;<span class="op" id="6139291">(</span><span class="op" id="6139292">*</span><span class="ident" id="6139293"><a href="/net/http/cgi/child.go.html#6138404">http</a></span><span class="op" id="6139297">.</span><span class="ident" id="6139298">Request</span><span class="op" id="6139305">,</span>&nbsp;<span class="builtintype" id="6139307">error</span><span class="op" id="6139312">)</span>&nbsp;<span class="op" id="6139314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139317">r</span>&nbsp;<span class="op" id="6139319">:=</span>&nbsp;<span class="builtinfunc" id="6139322">new</span><span class="op" id="6139325">(</span><span class="ident" id="6139326"><a href="/net/http/cgi/child.go.html#6138404">http</a></span><span class="op" id="6139330">.</span><span class="ident" id="6139331">Request</span><span class="op" id="6139338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139341"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6139342">.</span><span class="ident" id="6139343">Method</span>&nbsp;<span class="op" id="6139350">=</span>&nbsp;<span class="ident" id="6139352"><a href="/net/http/cgi/child.go.html#6139265">params</a></span><span class="op" id="6139358">[</span><span class="string" id="6139359">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6139375">]</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139378">if</span>&nbsp;<span class="ident" id="6139381"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6139382">.</span><span class="ident" id="6139383">Method</span>&nbsp;<span class="op" id="6139390">==</span>&nbsp;<span class="string" id="6139393">&#34;&#34;</span>&nbsp;<span class="op" id="6139396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139400">return</span>&nbsp;<span class="ident" id="6139407">nil</span><span class="op" id="6139410">,</span>&nbsp;<span class="ident" id="6139412"><a href="/net/http/cgi/child.go.html#6138361">errors</a></span><span class="op" id="6139418">.</span><span class="ident" id="6139419">New</span><span class="op" id="6139422">(</span><span class="string" id="6139423">&#34;cgi:&nbsp;no&nbsp;REQUEST_METHOD&nbsp;in&nbsp;environment&#34;</span><span class="op" id="6139462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6139465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139469"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6139470">.</span><span class="ident" id="6139471">Proto</span>&nbsp;<span class="op" id="6139477">=</span>&nbsp;<span class="ident" id="6139479"><a href="/net/http/cgi/child.go.html#6139265">params</a></span><span class="op" id="6139485">[</span><span class="string" id="6139486">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6139503">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139506">var</span>&nbsp;<span class="ident" id="6139510">ok</span>&nbsp;<span class="builtintype" id="6139513">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139519"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6139520">.</span><span class="ident" id="6139521">ProtoMajor</span><span class="op" id="6139531">,</span>&nbsp;<span class="ident" id="6139533"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6139534">.</span><span class="ident" id="6139535">ProtoMinor</span><span class="op" id="6139545">,</span>&nbsp;<span class="ident" id="6139547"><a href="/net/http/cgi/child.go.html#6139510">ok</a></span>&nbsp;<span class="op" id="6139550">=</span>&nbsp;<span class="ident" id="6139552"><a href="/net/http/cgi/child.go.html#6138404">http</a></span><span class="op" id="6139556">.</span><span class="ident" id="6139557">ParseHTTPVersion</span><span class="op" id="6139573">(</span><span class="ident" id="6139574"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6139575">.</span><span class="ident" id="6139576">Proto</span><span class="op" id="6139581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139584">if</span>&nbsp;<span class="op" id="6139587">!</span><span class="ident" id="6139588"><a href="/net/http/cgi/child.go.html#6139510">ok</a></span>&nbsp;<span class="op" id="6139591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139595">return</span>&nbsp;<span class="ident" id="6139602">nil</span><span class="op" id="6139605">,</span>&nbsp;<span class="ident" id="6139607"><a href="/net/http/cgi/child.go.html#6138361">errors</a></span><span class="op" id="6139613">.</span><span class="ident" id="6139614">New</span><span class="op" id="6139617">(</span><span class="string" id="6139618">&#34;cgi:&nbsp;invalid&nbsp;SERVER_PROTOCOL&nbsp;version&#34;</span><span class="op" id="6139656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6139659">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139663"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6139664">.</span><span class="ident" id="6139665">Close</span>&nbsp;<span class="op" id="6139671">=</span>&nbsp;<span class="builtintype" id="6139673">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139679"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6139680">.</span><span class="ident" id="6139681">Trailer</span>&nbsp;<span class="op" id="6139689">=</span>&nbsp;<span class="ident" id="6139691"><a href="/net/http/cgi/child.go.html#6138404">http</a></span><span class="op" id="6139695">.</span><span class="ident" id="6139696">Header</span><span class="op" id="6139702">{</span><span class="op" id="6139703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139706"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6139707">.</span><span class="ident" id="6139708">Header</span>&nbsp;<span class="op" id="6139715">=</span>&nbsp;<span class="ident" id="6139717"><a href="/net/http/cgi/child.go.html#6138404">http</a></span><span class="op" id="6139721">.</span><span class="ident" id="6139722">Header</span><span class="op" id="6139728">{</span><span class="op" id="6139729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139733"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6139734">.</span><span class="ident" id="6139735">Host</span>&nbsp;<span class="op" id="6139740">=</span>&nbsp;<span class="ident" id="6139742"><a href="/net/http/cgi/child.go.html#6139265">params</a></span><span class="op" id="6139748">[</span><span class="string" id="6139749">&#34;HTTP_HOST&#34;</span><span class="op" id="6139760">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139764">if</span>&nbsp;<span class="ident" id="6139767">lenstr</span>&nbsp;<span class="op" id="6139774">:=</span>&nbsp;<span class="ident" id="6139777"><a href="/net/http/cgi/child.go.html#6139265">params</a></span><span class="op" id="6139783">[</span><span class="string" id="6139784">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="6139800">]</span><span class="op" id="6139801">;</span>&nbsp;<span class="ident" id="6139803"><a href="/net/http/cgi/child.go.html#6139767">lenstr</a></span>&nbsp;<span class="op" id="6139810">!=</span>&nbsp;<span class="string" id="6139813">&#34;&#34;</span>&nbsp;<span class="op" id="6139816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139820">clen</span><span class="op" id="6139824">,</span>&nbsp;<span class="ident" id="6139826">err</span>&nbsp;<span class="op" id="6139830">:=</span>&nbsp;<span class="ident" id="6139833"><a href="/net/http/cgi/child.go.html#6138433">strconv</a></span><span class="op" id="6139840">.</span><span class="ident" id="6139841">ParseInt</span><span class="op" id="6139849">(</span><span class="ident" id="6139850"><a href="/net/http/cgi/child.go.html#6139767">lenstr</a></span><span class="op" id="6139856">,</span>&nbsp;<span class="num" id="6139858">10</span><span class="op" id="6139860">,</span>&nbsp;<span class="num" id="6139862">64</span><span class="op" id="6139864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139868">if</span>&nbsp;<span class="ident" id="6139871"><a href="/net/http/cgi/child.go.html#6139826">err</a></span>&nbsp;<span class="op" id="6139875">!=</span>&nbsp;<span class="ident" id="6139878">nil</span>&nbsp;<span class="op" id="6139882">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139887">return</span>&nbsp;<span class="ident" id="6139894">nil</span><span class="op" id="6139897">,</span>&nbsp;<span class="ident" id="6139899"><a href="/net/http/cgi/child.go.html#6138361">errors</a></span><span class="op" id="6139905">.</span><span class="ident" id="6139906">New</span><span class="op" id="6139909">(</span><span class="string" id="6139910">&#34;cgi:&nbsp;bad&nbsp;CONTENT_LENGTH&nbsp;in&nbsp;environment:&nbsp;&#34;</span>&nbsp;<span class="op" id="6139953">+</span>&nbsp;<span class="ident" id="6139955"><a href="/net/http/cgi/child.go.html#6139767">lenstr</a></span><span class="op" id="6139961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6139965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6139969"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6139970">.</span><span class="ident" id="6139971">ContentLength</span>&nbsp;<span class="op" id="6139985">=</span>&nbsp;<span class="ident" id="6139987"><a href="/net/http/cgi/child.go.html#6139820">clen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6139993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6139997">if</span>&nbsp;<span class="ident" id="6140000">ct</span>&nbsp;<span class="op" id="6140003">:=</span>&nbsp;<span class="ident" id="6140006"><a href="/net/http/cgi/child.go.html#6139265">params</a></span><span class="op" id="6140012">[</span><span class="string" id="6140013">&#34;CONTENT_TYPE&#34;</span><span class="op" id="6140027">]</span><span class="op" id="6140028">;</span>&nbsp;<span class="ident" id="6140030"><a href="/net/http/cgi/child.go.html#6140000">ct</a></span>&nbsp;<span class="op" id="6140033">!=</span>&nbsp;<span class="string" id="6140036">&#34;&#34;</span>&nbsp;<span class="op" id="6140039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140043"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6140044">.</span><span class="ident" id="6140045">Header</span><span class="op" id="6140051">.</span><span class="ident" id="6140052">Set</span><span class="op" id="6140055">(</span><span class="string" id="6140056">&#34;Content-Type&#34;</span><span class="op" id="6140070">,</span>&nbsp;<span class="ident" id="6140072"><a href="/net/http/cgi/child.go.html#6140000">ct</a></span><span class="op" id="6140074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6140077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140081">//&nbsp;Copy&nbsp;&#34;HTTP_FOO_BAR&#34;&nbsp;variables&nbsp;to&nbsp;&#34;Foo-Bar&#34;&nbsp;Headers</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6140136">for</span>&nbsp;<span class="ident" id="6140140">k</span><span class="op" id="6140141">,</span>&nbsp;<span class="ident" id="6140143">v</span>&nbsp;<span class="op" id="6140145">:=</span>&nbsp;<span class="keyword" id="6140148">range</span>&nbsp;<span class="ident" id="6140154"><a href="/net/http/cgi/child.go.html#6139265">params</a></span>&nbsp;<span class="op" id="6140161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6140165">if</span>&nbsp;<span class="op" id="6140168">!</span><span class="ident" id="6140169"><a href="/net/http/cgi/child.go.html#6138444">strings</a></span><span class="op" id="6140176">.</span><span class="ident" id="6140177">HasPrefix</span><span class="op" id="6140186">(</span><span class="ident" id="6140187"><a href="/net/http/cgi/child.go.html#6140140">k</a></span><span class="op" id="6140188">,</span>&nbsp;<span class="string" id="6140190">&#34;HTTP_&#34;</span><span class="op" id="6140197">)</span>&nbsp;<span class="op" id="6140199">||</span>&nbsp;<span class="ident" id="6140202"><a href="/net/http/cgi/child.go.html#6140140">k</a></span>&nbsp;<span class="op" id="6140204">==</span>&nbsp;<span class="string" id="6140207">&#34;HTTP_HOST&#34;</span>&nbsp;<span class="op" id="6140219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6140224">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6140235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140239"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6140240">.</span><span class="ident" id="6140241">Header</span><span class="op" id="6140247">.</span><span class="ident" id="6140248">Add</span><span class="op" id="6140251">(</span><span class="ident" id="6140252"><a href="/net/http/cgi/child.go.html#6138444">strings</a></span><span class="op" id="6140259">.</span><span class="ident" id="6140260">Replace</span><span class="op" id="6140267">(</span><span class="ident" id="6140268"><a href="/net/http/cgi/child.go.html#6140140">k</a></span><span class="op" id="6140269">[</span><span class="num" id="6140270">5</span><span class="op" id="6140271">:</span><span class="op" id="6140272">]</span><span class="op" id="6140273">,</span>&nbsp;<span class="string" id="6140275">&#34;_&#34;</span><span class="op" id="6140278">,</span>&nbsp;<span class="string" id="6140280">&#34;-&#34;</span><span class="op" id="6140283">,</span>&nbsp;<span class="op" id="6140285">-</span><span class="num" id="6140286">1</span><span class="op" id="6140287">)</span><span class="op" id="6140288">,</span>&nbsp;<span class="ident" id="6140290"><a href="/net/http/cgi/child.go.html#6140143">v</a></span><span class="op" id="6140291">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6140294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140298">//&nbsp;TODO:&nbsp;cookies.&nbsp;&nbsp;parsing&nbsp;them&nbsp;isn&#39;t&nbsp;exported,&nbsp;though.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140356">uriStr</span>&nbsp;<span class="op" id="6140363">:=</span>&nbsp;<span class="ident" id="6140366"><a href="/net/http/cgi/child.go.html#6139265">params</a></span><span class="op" id="6140372">[</span><span class="string" id="6140373">&#34;REQUEST_URI&#34;</span><span class="op" id="6140386">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6140389">if</span>&nbsp;<span class="ident" id="6140392"><a href="/net/http/cgi/child.go.html#6140356">uriStr</a></span>&nbsp;<span class="op" id="6140399">==</span>&nbsp;<span class="string" id="6140402">&#34;&#34;</span>&nbsp;<span class="op" id="6140405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140409">//&nbsp;Fallback&nbsp;to&nbsp;SCRIPT_NAME,&nbsp;PATH_INFO&nbsp;and&nbsp;QUERY_STRING.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140467"><a href="/net/http/cgi/child.go.html#6140356">uriStr</a></span>&nbsp;<span class="op" id="6140474">=</span>&nbsp;<span class="ident" id="6140476"><a href="/net/http/cgi/child.go.html#6139265">params</a></span><span class="op" id="6140482">[</span><span class="string" id="6140483">&#34;SCRIPT_NAME&#34;</span><span class="op" id="6140496">]</span>&nbsp;<span class="op" id="6140498">+</span>&nbsp;<span class="ident" id="6140500"><a href="/net/http/cgi/child.go.html#6139265">params</a></span><span class="op" id="6140506">[</span><span class="string" id="6140507">&#34;PATH_INFO&#34;</span><span class="op" id="6140518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140522">s</span>&nbsp;<span class="op" id="6140524">:=</span>&nbsp;<span class="ident" id="6140527"><a href="/net/http/cgi/child.go.html#6139265">params</a></span><span class="op" id="6140533">[</span><span class="string" id="6140534">&#34;QUERY_STRING&#34;</span><span class="op" id="6140548">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6140552">if</span>&nbsp;<span class="ident" id="6140555"><a href="/net/http/cgi/child.go.html#6140522">s</a></span>&nbsp;<span class="op" id="6140557">!=</span>&nbsp;<span class="string" id="6140560">&#34;&#34;</span>&nbsp;<span class="op" id="6140563">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140568"><a href="/net/http/cgi/child.go.html#6140356">uriStr</a></span>&nbsp;<span class="op" id="6140575">+=</span>&nbsp;<span class="string" id="6140578">&#34;?&#34;</span>&nbsp;<span class="op" id="6140582">+</span>&nbsp;<span class="ident" id="6140584"><a href="/net/http/cgi/child.go.html#6140522">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6140588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6140591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140595">//&nbsp;There&#39;s&nbsp;apparently&nbsp;a&nbsp;de-facto&nbsp;standard&nbsp;for&nbsp;this.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140648">//&nbsp;http://docstore.mik.ua/orelly/linux/cgi/ch03_02.htm#ch03-35636</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6140715">if</span>&nbsp;<span class="ident" id="6140718">s</span>&nbsp;<span class="op" id="6140720">:=</span>&nbsp;<span class="ident" id="6140723"><a href="/net/http/cgi/child.go.html#6139265">params</a></span><span class="op" id="6140729">[</span><span class="string" id="6140730">&#34;HTTPS&#34;</span><span class="op" id="6140737">]</span><span class="op" id="6140738">;</span>&nbsp;<span class="ident" id="6140740"><a href="/net/http/cgi/child.go.html#6140718">s</a></span>&nbsp;<span class="op" id="6140742">==</span>&nbsp;<span class="string" id="6140745">&#34;on&#34;</span>&nbsp;<span class="op" id="6140750">||</span>&nbsp;<span class="ident" id="6140753"><a href="/net/http/cgi/child.go.html#6140718">s</a></span>&nbsp;<span class="op" id="6140755">==</span>&nbsp;<span class="string" id="6140758">&#34;ON&#34;</span>&nbsp;<span class="op" id="6140763">||</span>&nbsp;<span class="ident" id="6140766"><a href="/net/http/cgi/child.go.html#6140718">s</a></span>&nbsp;<span class="op" id="6140768">==</span>&nbsp;<span class="string" id="6140771">&#34;1&#34;</span>&nbsp;<span class="op" id="6140775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140779"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6140780">.</span><span class="ident" id="6140781">TLS</span>&nbsp;<span class="op" id="6140785">=</span>&nbsp;<span class="op" id="6140787">&amp;</span><span class="ident" id="6140788"><a href="/net/http/cgi/child.go.html#6138347">tls</a></span><span class="op" id="6140791">.</span><span class="ident" id="6140792">ConnectionState</span><span class="op" id="6140807">{</span><span class="ident" id="6140808">HandshakeComplete</span><span class="op" id="6140825">:</span>&nbsp;<span class="builtintype" id="6140827">true</span><span class="op" id="6140831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6140834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6140838">if</span>&nbsp;<span class="ident" id="6140841"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6140842">.</span><span class="ident" id="6140843">Host</span>&nbsp;<span class="op" id="6140848">!=</span>&nbsp;<span class="string" id="6140851">&#34;&#34;</span>&nbsp;<span class="op" id="6140854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6140858">//&nbsp;Hostname&nbsp;is&nbsp;provided,&nbsp;so&nbsp;we&nbsp;can&nbsp;reasonably&nbsp;construct&nbsp;a&nbsp;URL.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140923">rawurl</span>&nbsp;<span class="op" id="6140930">:=</span>&nbsp;<span class="ident" id="6140933"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6140934">.</span><span class="ident" id="6140935">Host</span>&nbsp;<span class="op" id="6140940">+</span>&nbsp;<span class="ident" id="6140942"><a href="/net/http/cgi/child.go.html#6140356">uriStr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6140951">if</span>&nbsp;<span class="ident" id="6140954"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6140955">.</span><span class="ident" id="6140956">TLS</span>&nbsp;<span class="op" id="6140960">==</span>&nbsp;<span class="ident" id="6140963">nil</span>&nbsp;<span class="op" id="6140967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6140972"><a href="/net/http/cgi/child.go.html#6140923">rawurl</a></span>&nbsp;<span class="op" id="6140979">=</span>&nbsp;<span class="string" id="6140981">&#34;http://&#34;</span>&nbsp;<span class="op" id="6140991">+</span>&nbsp;<span class="ident" id="6140993"><a href="/net/http/cgi/child.go.html#6140923">rawurl</a></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6141002">}</span>&nbsp;<span class="keyword" id="6141004">else</span>&nbsp;<span class="op" id="6141009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141014"><a href="/net/http/cgi/child.go.html#6140923">rawurl</a></span>&nbsp;<span class="op" id="6141021">=</span>&nbsp;<span class="string" id="6141023">&#34;https://&#34;</span>&nbsp;<span class="op" id="6141034">+</span>&nbsp;<span class="ident" id="6141036"><a href="/net/http/cgi/child.go.html#6140923">rawurl</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6141045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141049">url</span><span class="op" id="6141052">,</span>&nbsp;<span class="ident" id="6141054">err</span>&nbsp;<span class="op" id="6141058">:=</span>&nbsp;<span class="ident" id="6141061"><a href="/net/http/cgi/child.go.html#6138416">url</a></span><span class="op" id="6141064">.</span><span class="ident" id="6141065">Parse</span><span class="op" id="6141070">(</span><span class="ident" id="6141071"><a href="/net/http/cgi/child.go.html#6140923">rawurl</a></span><span class="op" id="6141077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141081">if</span>&nbsp;<span class="ident" id="6141084"><a href="/net/http/cgi/child.go.html#6141054">err</a></span>&nbsp;<span class="op" id="6141088">!=</span>&nbsp;<span class="ident" id="6141091">nil</span>&nbsp;<span class="op" id="6141095">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141100">return</span>&nbsp;<span class="ident" id="6141107">nil</span><span class="op" id="6141110">,</span>&nbsp;<span class="ident" id="6141112"><a href="/net/http/cgi/child.go.html#6138361">errors</a></span><span class="op" id="6141118">.</span><span class="ident" id="6141119">New</span><span class="op" id="6141122">(</span><span class="string" id="6141123">&#34;cgi:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;host&nbsp;and&nbsp;REQUEST_URI&nbsp;into&nbsp;a&nbsp;URL:&nbsp;&#34;</span>&nbsp;<span class="op" id="6141180">+</span>&nbsp;<span class="ident" id="6141182"><a href="/net/http/cgi/child.go.html#6140923">rawurl</a></span><span class="op" id="6141188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6141192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141196"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6141197">.</span><span class="ident" id="6141198">URL</span>&nbsp;<span class="op" id="6141202">=</span>&nbsp;<span class="ident" id="6141204"><a href="/net/http/cgi/child.go.html#6141049">url</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6141209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6141212">//&nbsp;Fallback&nbsp;logic&nbsp;if&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;Host&nbsp;header&nbsp;or&nbsp;the&nbsp;URL</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6141273">//&nbsp;failed&nbsp;to&nbsp;parse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141293">if</span>&nbsp;<span class="ident" id="6141296"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6141297">.</span><span class="ident" id="6141298">URL</span>&nbsp;<span class="op" id="6141302">==</span>&nbsp;<span class="ident" id="6141305">nil</span>&nbsp;<span class="op" id="6141309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141313">url</span><span class="op" id="6141316">,</span>&nbsp;<span class="ident" id="6141318">err</span>&nbsp;<span class="op" id="6141322">:=</span>&nbsp;<span class="ident" id="6141325"><a href="/net/http/cgi/child.go.html#6138416">url</a></span><span class="op" id="6141328">.</span><span class="ident" id="6141329">Parse</span><span class="op" id="6141334">(</span><span class="ident" id="6141335"><a href="/net/http/cgi/child.go.html#6140356">uriStr</a></span><span class="op" id="6141341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141345">if</span>&nbsp;<span class="ident" id="6141348"><a href="/net/http/cgi/child.go.html#6141318">err</a></span>&nbsp;<span class="op" id="6141352">!=</span>&nbsp;<span class="ident" id="6141355">nil</span>&nbsp;<span class="op" id="6141359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141364">return</span>&nbsp;<span class="ident" id="6141371">nil</span><span class="op" id="6141374">,</span>&nbsp;<span class="ident" id="6141376"><a href="/net/http/cgi/child.go.html#6138361">errors</a></span><span class="op" id="6141382">.</span><span class="ident" id="6141383">New</span><span class="op" id="6141386">(</span><span class="string" id="6141387">&#34;cgi:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;REQUEST_URI&nbsp;into&nbsp;a&nbsp;URL:&nbsp;&#34;</span>&nbsp;<span class="op" id="6141435">+</span>&nbsp;<span class="ident" id="6141437"><a href="/net/http/cgi/child.go.html#6140356">uriStr</a></span><span class="op" id="6141443">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6141447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141451"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6141452">.</span><span class="ident" id="6141453">URL</span>&nbsp;<span class="op" id="6141457">=</span>&nbsp;<span class="ident" id="6141459"><a href="/net/http/cgi/child.go.html#6141313">url</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6141464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6141468">//&nbsp;Request.RemoteAddr&nbsp;has&nbsp;its&nbsp;port&nbsp;set&nbsp;by&nbsp;Go&#39;s&nbsp;standard&nbsp;http</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6141530">//&nbsp;server,&nbsp;so&nbsp;we&nbsp;do&nbsp;here&nbsp;too.&nbsp;We&nbsp;don&#39;t&nbsp;have&nbsp;one,&nbsp;though,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6141594">//&nbsp;use&nbsp;a&nbsp;dummy&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141615"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6141616">.</span><span class="ident" id="6141617">RemoteAddr</span>&nbsp;<span class="op" id="6141628">=</span>&nbsp;<span class="ident" id="6141630"><a href="/net/http/cgi/child.go.html#6138397">net</a></span><span class="op" id="6141633">.</span><span class="ident" id="6141634">JoinHostPort</span><span class="op" id="6141646">(</span><span class="ident" id="6141647"><a href="/net/http/cgi/child.go.html#6139265">params</a></span><span class="op" id="6141653">[</span><span class="string" id="6141654">&#34;REMOTE_ADDR&#34;</span><span class="op" id="6141667">]</span><span class="op" id="6141668">,</span>&nbsp;<span class="string" id="6141670">&#34;0&#34;</span><span class="op" id="6141673">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141677">return</span>&nbsp;<span class="ident" id="6141684"><a href="/net/http/cgi/child.go.html#6139317">r</a></span><span class="op" id="6141685">,</span>&nbsp;<span class="ident" id="6141687">nil</span><br>
<span class="lineno">140</span><span class="op" id="6141691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6141694">//&nbsp;Serve&nbsp;executes&nbsp;the&nbsp;provided&nbsp;Handler&nbsp;on&nbsp;the&nbsp;currently&nbsp;active&nbsp;CGI</span><br>
<span class="lineno"></span><span class="comment" id="6141761">//&nbsp;request,&nbsp;if&nbsp;any.&nbsp;If&nbsp;there&#39;s&nbsp;no&nbsp;current&nbsp;CGI&nbsp;environment</span><br>
<span class="lineno"></span><span class="comment" id="6141819">//&nbsp;an&nbsp;error&nbsp;is&nbsp;returned.&nbsp;The&nbsp;provided&nbsp;handler&nbsp;may&nbsp;be&nbsp;nil&nbsp;to&nbsp;use</span><br>
<span class="lineno">145</span><span class="comment" id="6141883">//&nbsp;http.DefaultServeMux.</span><br>
<span class="lineno"></span><span class="keyword" id="6141908">func</span>&nbsp;<span class="ident" id="6141913">Serve</span><span class="op" id="6141918">(</span><span class="ident" id="6141919">handler</span>&nbsp;<span class="ident" id="6141927"><a href="/net/http/cgi/child.go.html#6138404">http</a></span><span class="op" id="6141931">.</span><span class="ident" id="6141932">Handler</span><span class="op" id="6141939">)</span>&nbsp;<span class="builtintype" id="6141941">error</span>&nbsp;<span class="op" id="6141947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6141950">req</span><span class="op" id="6141953">,</span>&nbsp;<span class="ident" id="6141955">err</span>&nbsp;<span class="op" id="6141959">:=</span>&nbsp;<span class="ident" id="6141962"><a href="/net/http/cgi/child.go.html#6138691">Request</a></span><span class="op" id="6141969">(</span><span class="op" id="6141970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141973">if</span>&nbsp;<span class="ident" id="6141976"><a href="/net/http/cgi/child.go.html#6141955">err</a></span>&nbsp;<span class="op" id="6141980">!=</span>&nbsp;<span class="ident" id="6141983">nil</span>&nbsp;<span class="op" id="6141987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6141991">return</span>&nbsp;<span class="ident" id="6141998"><a href="/net/http/cgi/child.go.html#6141955">err</a></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6142003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142006">if</span>&nbsp;<span class="ident" id="6142009"><a href="/net/http/cgi/child.go.html#6141919">handler</a></span>&nbsp;<span class="op" id="6142017">==</span>&nbsp;<span class="ident" id="6142020">nil</span>&nbsp;<span class="op" id="6142024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142028"><a href="/net/http/cgi/child.go.html#6141919">handler</a></span>&nbsp;<span class="op" id="6142036">=</span>&nbsp;<span class="ident" id="6142038"><a href="/net/http/cgi/child.go.html#6138404">http</a></span><span class="op" id="6142042">.</span><span class="ident" id="6142043">DefaultServeMux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6142060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142063">rw</span>&nbsp;<span class="op" id="6142066">:=</span>&nbsp;<span class="op" id="6142069">&amp;</span><span class="ident" id="6142070"><a href="/net/http/cgi/child.go.html#6142316">response</a></span><span class="op" id="6142078">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142082">req</span><span class="op" id="6142085">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6142090"><a href="/net/http/cgi/child.go.html#6141950">req</a></span><span class="op" id="6142093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142097">header</span><span class="op" id="6142103">:</span>&nbsp;<span class="builtinfunc" id="6142105">make</span><span class="op" id="6142109">(</span><span class="ident" id="6142110"><a href="/net/http/cgi/child.go.html#6138404">http</a></span><span class="op" id="6142114">.</span><span class="ident" id="6142115">Header</span><span class="op" id="6142121">)</span><span class="op" id="6142122">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142126">bufw</span><span class="op" id="6142130">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6142134"><a href="/net/http/cgi/child.go.html#6138338">bufio</a></span><span class="op" id="6142139">.</span><span class="ident" id="6142140">NewWriter</span><span class="op" id="6142149">(</span><span class="ident" id="6142150"><a href="/net/http/cgi/child.go.html#6138427">os</a></span><span class="op" id="6142152">.</span><span class="ident" id="6142153">Stdout</span><span class="op" id="6142159">)</span><span class="op" id="6142160">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6142163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142166"><a href="/net/http/cgi/child.go.html#6141919">handler</a></span><span class="op" id="6142173">.</span><span class="ident" id="6142174">ServeHTTP</span><span class="op" id="6142183">(</span><span class="ident" id="6142184"><a href="/net/http/cgi/child.go.html#6142063">rw</a></span><span class="op" id="6142186">,</span>&nbsp;<span class="ident" id="6142188"><a href="/net/http/cgi/child.go.html#6141950">req</a></span><span class="op" id="6142191">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142194"><a href="/net/http/cgi/child.go.html#6142063">rw</a></span><span class="op" id="6142196">.</span><span class="ident" id="6142197">Write</span><span class="op" id="6142202">(</span><span class="ident" id="6142203">nil</span><span class="op" id="6142206">)</span>&nbsp;<span class="comment" id="6142208">//&nbsp;make&nbsp;sure&nbsp;a&nbsp;response&nbsp;is&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142241">if</span>&nbsp;<span class="ident" id="6142244"><a href="/net/http/cgi/child.go.html#6141955">err</a></span>&nbsp;<span class="op" id="6142248">=</span>&nbsp;<span class="ident" id="6142250"><a href="/net/http/cgi/child.go.html#6142063">rw</a></span><span class="op" id="6142252">.</span><span class="ident" id="6142253">bufw</span><span class="op" id="6142257">.</span><span class="ident" id="6142258">Flush</span><span class="op" id="6142263">(</span><span class="op" id="6142264">)</span><span class="op" id="6142265">;</span>&nbsp;<span class="ident" id="6142267"><a href="/net/http/cgi/child.go.html#6141955">err</a></span>&nbsp;<span class="op" id="6142271">!=</span>&nbsp;<span class="ident" id="6142274">nil</span>&nbsp;<span class="op" id="6142278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142282">return</span>&nbsp;<span class="ident" id="6142289"><a href="/net/http/cgi/child.go.html#6141955">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6142294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142297">return</span>&nbsp;<span class="ident" id="6142304">nil</span><br>
<span class="lineno">165</span><span class="op" id="6142308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6142311">type</span>&nbsp;<span class="ident" id="6142316">response</span>&nbsp;<span class="keyword" id="6142325">struct</span>&nbsp;<span class="op" id="6142332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142335">req</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6142346">*</span><span class="ident" id="6142347"><a href="/net/http/cgi/child.go.html#6138404">http</a></span><span class="op" id="6142351">.</span><span class="ident" id="6142352">Request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142361">header</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6142372"><a href="/net/http/cgi/child.go.html#6138404">http</a></span><span class="op" id="6142376">.</span><span class="ident" id="6142377">Header</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142385">bufw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6142396">*</span><span class="ident" id="6142397"><a href="/net/http/cgi/child.go.html#6138338">bufio</a></span><span class="op" id="6142402">.</span><span class="ident" id="6142403">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142411">headerSent</span>&nbsp;<span class="builtintype" id="6142422">bool</span><br>
<span class="lineno"></span><span class="op" id="6142427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6142430">func</span>&nbsp;<span class="op" id="6142435">(</span><span class="ident" id="6142436">r</span>&nbsp;<span class="op" id="6142438">*</span><span class="ident" id="6142439"><a href="/net/http/cgi/child.go.html#6142316">response</a></span><span class="op" id="6142447">)</span>&nbsp;<span class="ident" id="6142449">Flush</span><span class="op" id="6142454">(</span><span class="op" id="6142455">)</span>&nbsp;<span class="op" id="6142457">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142460"><a href="/net/http/cgi/child.go.html#6142436">r</a></span><span class="op" id="6142461">.</span><span class="ident" id="6142462">bufw</span><span class="op" id="6142466">.</span><span class="ident" id="6142467">Flush</span><span class="op" id="6142472">(</span><span class="op" id="6142473">)</span><br>
<span class="lineno"></span><span class="op" id="6142475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6142478">func</span>&nbsp;<span class="op" id="6142483">(</span><span class="ident" id="6142484">r</span>&nbsp;<span class="op" id="6142486">*</span><span class="ident" id="6142487"><a href="/net/http/cgi/child.go.html#6142316">response</a></span><span class="op" id="6142495">)</span>&nbsp;<span class="ident" id="6142497">Header</span><span class="op" id="6142503">(</span><span class="op" id="6142504">)</span>&nbsp;<span class="ident" id="6142506"><a href="/net/http/cgi/child.go.html#6138404">http</a></span><span class="op" id="6142510">.</span><span class="ident" id="6142511">Header</span>&nbsp;<span class="op" id="6142518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142521">return</span>&nbsp;<span class="ident" id="6142528"><a href="/net/http/cgi/child.go.html#6142484">r</a></span><span class="op" id="6142529">.</span><span class="ident" id="6142530">header</span><br>
<span class="lineno">180</span><span class="op" id="6142537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6142540">func</span>&nbsp;<span class="op" id="6142545">(</span><span class="ident" id="6142546">r</span>&nbsp;<span class="op" id="6142548">*</span><span class="ident" id="6142549"><a href="/net/http/cgi/child.go.html#6142316">response</a></span><span class="op" id="6142557">)</span>&nbsp;<span class="ident" id="6142559">Write</span><span class="op" id="6142564">(</span><span class="ident" id="6142565">p</span>&nbsp;<span class="op" id="6142567">[</span><span class="op" id="6142568">]</span><span class="builtintype" id="6142569">byte</span><span class="op" id="6142573">)</span>&nbsp;<span class="op" id="6142575">(</span><span class="ident" id="6142576">n</span>&nbsp;<span class="builtintype" id="6142578">int</span><span class="op" id="6142581">,</span>&nbsp;<span class="ident" id="6142583">err</span>&nbsp;<span class="builtintype" id="6142587">error</span><span class="op" id="6142592">)</span>&nbsp;<span class="op" id="6142594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142597">if</span>&nbsp;<span class="op" id="6142600">!</span><span class="ident" id="6142601"><a href="/net/http/cgi/child.go.html#6142546">r</a></span><span class="op" id="6142602">.</span><span class="ident" id="6142603">headerSent</span>&nbsp;<span class="op" id="6142614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142618"><a href="/net/http/cgi/child.go.html#6142546">r</a></span><span class="op" id="6142619">.</span><span class="ident" id="6142620">WriteHeader</span><span class="op" id="6142631">(</span><span class="ident" id="6142632"><a href="/net/http/cgi/child.go.html#6138404">http</a></span><span class="op" id="6142636">.</span><span class="ident" id="6142637">StatusOK</span><span class="op" id="6142645">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6142648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142651">return</span>&nbsp;<span class="ident" id="6142658"><a href="/net/http/cgi/child.go.html#6142546">r</a></span><span class="op" id="6142659">.</span><span class="ident" id="6142660">bufw</span><span class="op" id="6142664">.</span><span class="ident" id="6142665">Write</span><span class="op" id="6142670">(</span><span class="ident" id="6142671"><a href="/net/http/cgi/child.go.html#6142565">p</a></span><span class="op" id="6142672">)</span><br>
<span class="lineno"></span><span class="op" id="6142674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6142677">func</span>&nbsp;<span class="op" id="6142682">(</span><span class="ident" id="6142683">r</span>&nbsp;<span class="op" id="6142685">*</span><span class="ident" id="6142686"><a href="/net/http/cgi/child.go.html#6142316">response</a></span><span class="op" id="6142694">)</span>&nbsp;<span class="ident" id="6142696">WriteHeader</span><span class="op" id="6142707">(</span><span class="ident" id="6142708">code</span>&nbsp;<span class="builtintype" id="6142713">int</span><span class="op" id="6142716">)</span>&nbsp;<span class="op" id="6142718">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142721">if</span>&nbsp;<span class="ident" id="6142724"><a href="/net/http/cgi/child.go.html#6142683">r</a></span><span class="op" id="6142725">.</span><span class="ident" id="6142726">headerSent</span>&nbsp;<span class="op" id="6142737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6142741">//&nbsp;Note:&nbsp;explicitly&nbsp;using&nbsp;Stderr,&nbsp;as&nbsp;Stdout&nbsp;is&nbsp;our&nbsp;HTTP&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142807"><a href="/net/http/cgi/child.go.html#6138371">fmt</a></span><span class="op" id="6142810">.</span><span class="ident" id="6142811">Fprintf</span><span class="op" id="6142818">(</span><span class="ident" id="6142819"><a href="/net/http/cgi/child.go.html#6138427">os</a></span><span class="op" id="6142821">.</span><span class="ident" id="6142822">Stderr</span><span class="op" id="6142828">,</span>&nbsp;<span class="string" id="6142830">&#34;CGI&nbsp;attempted&nbsp;to&nbsp;write&nbsp;header&nbsp;twice&nbsp;on&nbsp;request&nbsp;for&nbsp;%s&#34;</span><span class="op" id="6142885">,</span>&nbsp;<span class="ident" id="6142887"><a href="/net/http/cgi/child.go.html#6142683">r</a></span><span class="op" id="6142888">.</span><span class="ident" id="6142889">req</span><span class="op" id="6142892">.</span><span class="ident" id="6142893">URL</span><span class="op" id="6142896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6142900">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6142908">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142911"><a href="/net/http/cgi/child.go.html#6142683">r</a></span><span class="op" id="6142912">.</span><span class="ident" id="6142913">headerSent</span>&nbsp;<span class="op" id="6142924">=</span>&nbsp;<span class="builtintype" id="6142926">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6142932"><a href="/net/http/cgi/child.go.html#6138371">fmt</a></span><span class="op" id="6142935">.</span><span class="ident" id="6142936">Fprintf</span><span class="op" id="6142943">(</span><span class="ident" id="6142944"><a href="/net/http/cgi/child.go.html#6142683">r</a></span><span class="op" id="6142945">.</span><span class="ident" id="6142946">bufw</span><span class="op" id="6142950">,</span>&nbsp;<span class="string" id="6142952">&#34;Status:&nbsp;%d&nbsp;%s\r\n&#34;</span><span class="op" id="6142971">,</span>&nbsp;<span class="ident" id="6142973"><a href="/net/http/cgi/child.go.html#6142708">code</a></span><span class="op" id="6142977">,</span>&nbsp;<span class="ident" id="6142979"><a href="/net/http/cgi/child.go.html#6138404">http</a></span><span class="op" id="6142983">.</span><span class="ident" id="6142984">StatusText</span><span class="op" id="6142994">(</span><span class="ident" id="6142995"><a href="/net/http/cgi/child.go.html#6142708">code</a></span><span class="op" id="6142999">)</span><span class="op" id="6143000">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6143004">//&nbsp;Set&nbsp;a&nbsp;default&nbsp;Content-Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6143035">if</span>&nbsp;<span class="ident" id="6143038">_</span><span class="op" id="6143039">,</span>&nbsp;<span class="ident" id="6143041">hasType</span>&nbsp;<span class="op" id="6143049">:=</span>&nbsp;<span class="ident" id="6143052"><a href="/net/http/cgi/child.go.html#6142683">r</a></span><span class="op" id="6143053">.</span><span class="ident" id="6143054">header</span><span class="op" id="6143060">[</span><span class="string" id="6143061">&#34;Content-Type&#34;</span><span class="op" id="6143075">]</span><span class="op" id="6143076">;</span>&nbsp;<span class="op" id="6143078">!</span><span class="ident" id="6143079"><a href="/net/http/cgi/child.go.html#6143041">hasType</a></span>&nbsp;<span class="op" id="6143087">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6143091"><a href="/net/http/cgi/child.go.html#6142683">r</a></span><span class="op" id="6143092">.</span><span class="ident" id="6143093">header</span><span class="op" id="6143099">.</span><span class="ident" id="6143100">Add</span><span class="op" id="6143103">(</span><span class="string" id="6143104">&#34;Content-Type&#34;</span><span class="op" id="6143118">,</span>&nbsp;<span class="string" id="6143120">&#34;text/html;&nbsp;charset=utf-8&#34;</span><span class="op" id="6143146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6143149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6143153"><a href="/net/http/cgi/child.go.html#6142683">r</a></span><span class="op" id="6143154">.</span><span class="ident" id="6143155">header</span><span class="op" id="6143161">.</span><span class="ident" id="6143162">Write</span><span class="op" id="6143167">(</span><span class="ident" id="6143168"><a href="/net/http/cgi/child.go.html#6142683">r</a></span><span class="op" id="6143169">.</span><span class="ident" id="6143170">bufw</span><span class="op" id="6143174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6143177"><a href="/net/http/cgi/child.go.html#6142683">r</a></span><span class="op" id="6143178">.</span><span class="ident" id="6143179">bufw</span><span class="op" id="6143183">.</span><span class="ident" id="6143184">WriteString</span><span class="op" id="6143195">(</span><span class="string" id="6143196">&#34;\r\n&#34;</span><span class="op" id="6143202">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6143205"><a href="/net/http/cgi/child.go.html#6142683">r</a></span><span class="op" id="6143206">.</span><span class="ident" id="6143207">bufw</span><span class="op" id="6143211">.</span><span class="ident" id="6143212">Flush</span><span class="op" id="6143217">(</span><span class="op" id="6143218">)</span><br>
<span class="lineno"></span><span class="op" id="6143220">}</span>
</div>
</body>
</html>
