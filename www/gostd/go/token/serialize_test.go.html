<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7143361">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7143416">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7143470">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7143521">package</span>&nbsp;<span class="ident" id="7143529">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7143536">import</span>&nbsp;<span class="op" id="7143543">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7143546">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7143555">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7143571">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7143578">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7143588">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7143591">//&nbsp;equal&nbsp;returns&nbsp;nil&nbsp;if&nbsp;p&nbsp;and&nbsp;q&nbsp;describe&nbsp;the&nbsp;same&nbsp;file&nbsp;set;</span><br>
<span class="lineno">15</span><span class="comment" id="7143651">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;discrepancy.</span><br>
<span class="lineno"></span><span class="keyword" id="7143712">func</span>&nbsp;<span class="ident" id="7143717">equal</span><span class="op" id="7143722">(</span><span class="ident" id="7143723">p</span><span class="op" id="7143724">,</span>&nbsp;<span class="ident" id="7143726">q</span>&nbsp;<span class="op" id="7143728">*</span><span class="ident" id="7143729">FileSet</span><span class="op" id="7143736">)</span>&nbsp;<span class="builtintype" id="7143738">error</span>&nbsp;<span class="op" id="7143744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143747">if</span>&nbsp;<span class="ident" id="7143750">p</span>&nbsp;<span class="op" id="7143752">==</span>&nbsp;<span class="ident" id="7143755">q</span>&nbsp;<span class="op" id="7143757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7143761">//&nbsp;avoid&nbsp;deadlock&nbsp;if&nbsp;p&nbsp;==&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143791">return</span>&nbsp;<span class="ident" id="7143798">nil</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7143803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7143807">//&nbsp;not&nbsp;strictly&nbsp;needed&nbsp;for&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143844">p</span><span class="op" id="7143845">.</span><span class="ident" id="7143846">mutex</span><span class="op" id="7143851">.</span><span class="ident" id="7143852">Lock</span><span class="op" id="7143856">(</span><span class="op" id="7143857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7143860">q</span><span class="op" id="7143861">.</span><span class="ident" id="7143862">mutex</span><span class="op" id="7143867">.</span><span class="ident" id="7143868">Lock</span><span class="op" id="7143872">(</span><span class="op" id="7143873">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143876">defer</span>&nbsp;<span class="ident" id="7143882">q</span><span class="op" id="7143883">.</span><span class="ident" id="7143884">mutex</span><span class="op" id="7143889">.</span><span class="ident" id="7143890">Unlock</span><span class="op" id="7143896">(</span><span class="op" id="7143897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143900">defer</span>&nbsp;<span class="ident" id="7143906">p</span><span class="op" id="7143907">.</span><span class="ident" id="7143908">mutex</span><span class="op" id="7143913">.</span><span class="ident" id="7143914">Unlock</span><span class="op" id="7143920">(</span><span class="op" id="7143921">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143925">if</span>&nbsp;<span class="ident" id="7143928">p</span><span class="op" id="7143929">.</span><span class="ident" id="7143930">base</span>&nbsp;<span class="op" id="7143935">!=</span>&nbsp;<span class="ident" id="7143938">q</span><span class="op" id="7143939">.</span><span class="ident" id="7143940">base</span>&nbsp;<span class="op" id="7143945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7143949">return</span>&nbsp;<span class="ident" id="7143956">fmt</span><span class="op" id="7143959">.</span><span class="ident" id="7143960">Errorf</span><span class="op" id="7143966">(</span><span class="string" id="7143967">&#34;different&nbsp;bases:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7143994">,</span>&nbsp;<span class="ident" id="7143996">p</span><span class="op" id="7143997">.</span><span class="ident" id="7143998">base</span><span class="op" id="7144002">,</span>&nbsp;<span class="ident" id="7144004">q</span><span class="op" id="7144005">.</span><span class="ident" id="7144006">base</span><span class="op" id="7144010">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144017">if</span>&nbsp;<span class="builtinfunc" id="7144020">len</span><span class="op" id="7144023">(</span><span class="ident" id="7144024">p</span><span class="op" id="7144025">.</span><span class="ident" id="7144026">files</span><span class="op" id="7144031">)</span>&nbsp;<span class="op" id="7144033">!=</span>&nbsp;<span class="builtinfunc" id="7144036">len</span><span class="op" id="7144039">(</span><span class="ident" id="7144040">q</span><span class="op" id="7144041">.</span><span class="ident" id="7144042">files</span><span class="op" id="7144047">)</span>&nbsp;<span class="op" id="7144049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144053">return</span>&nbsp;<span class="ident" id="7144060">fmt</span><span class="op" id="7144063">.</span><span class="ident" id="7144064">Errorf</span><span class="op" id="7144070">(</span><span class="string" id="7144071">&#34;different&nbsp;number&nbsp;of&nbsp;files:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7144108">,</span>&nbsp;<span class="builtinfunc" id="7144110">len</span><span class="op" id="7144113">(</span><span class="ident" id="7144114">p</span><span class="op" id="7144115">.</span><span class="ident" id="7144116">files</span><span class="op" id="7144121">)</span><span class="op" id="7144122">,</span>&nbsp;<span class="builtinfunc" id="7144124">len</span><span class="op" id="7144127">(</span><span class="ident" id="7144128">q</span><span class="op" id="7144129">.</span><span class="ident" id="7144130">files</span><span class="op" id="7144135">)</span><span class="op" id="7144136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144139">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144143">for</span>&nbsp;<span class="ident" id="7144147">i</span><span class="op" id="7144148">,</span>&nbsp;<span class="ident" id="7144150">f</span>&nbsp;<span class="op" id="7144152">:=</span>&nbsp;<span class="keyword" id="7144155">range</span>&nbsp;<span class="ident" id="7144161">p</span><span class="op" id="7144162">.</span><span class="ident" id="7144163">files</span>&nbsp;<span class="op" id="7144169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7144173">g</span>&nbsp;<span class="op" id="7144175">:=</span>&nbsp;<span class="ident" id="7144178">q</span><span class="op" id="7144179">.</span><span class="ident" id="7144180">files</span><span class="op" id="7144185">[</span><span class="ident" id="7144186">i</span><span class="op" id="7144187">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144191">if</span>&nbsp;<span class="ident" id="7144194">f</span><span class="op" id="7144195">.</span><span class="ident" id="7144196">set</span>&nbsp;<span class="op" id="7144200">!=</span>&nbsp;<span class="ident" id="7144203">p</span>&nbsp;<span class="op" id="7144205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144210">return</span>&nbsp;<span class="ident" id="7144217">fmt</span><span class="op" id="7144220">.</span><span class="ident" id="7144221">Errorf</span><span class="op" id="7144227">(</span><span class="string" id="7144228">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7144250">,</span>&nbsp;<span class="ident" id="7144252">f</span><span class="op" id="7144253">.</span><span class="ident" id="7144254">name</span><span class="op" id="7144258">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144266">if</span>&nbsp;<span class="ident" id="7144269">g</span><span class="op" id="7144270">.</span><span class="ident" id="7144271">set</span>&nbsp;<span class="op" id="7144275">!=</span>&nbsp;<span class="ident" id="7144278">q</span>&nbsp;<span class="op" id="7144280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144285">return</span>&nbsp;<span class="ident" id="7144292">fmt</span><span class="op" id="7144295">.</span><span class="ident" id="7144296">Errorf</span><span class="op" id="7144302">(</span><span class="string" id="7144303">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7144325">,</span>&nbsp;<span class="ident" id="7144327">g</span><span class="op" id="7144328">.</span><span class="ident" id="7144329">name</span><span class="op" id="7144333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144341">if</span>&nbsp;<span class="ident" id="7144344">f</span><span class="op" id="7144345">.</span><span class="ident" id="7144346">name</span>&nbsp;<span class="op" id="7144351">!=</span>&nbsp;<span class="ident" id="7144354">g</span><span class="op" id="7144355">.</span><span class="ident" id="7144356">name</span>&nbsp;<span class="op" id="7144361">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144366">return</span>&nbsp;<span class="ident" id="7144373">fmt</span><span class="op" id="7144376">.</span><span class="ident" id="7144377">Errorf</span><span class="op" id="7144383">(</span><span class="string" id="7144384">&#34;different&nbsp;filenames:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="7144415">,</span>&nbsp;<span class="ident" id="7144417">f</span><span class="op" id="7144418">.</span><span class="ident" id="7144419">name</span><span class="op" id="7144423">,</span>&nbsp;<span class="ident" id="7144425">g</span><span class="op" id="7144426">.</span><span class="ident" id="7144427">name</span><span class="op" id="7144431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144439">if</span>&nbsp;<span class="ident" id="7144442">f</span><span class="op" id="7144443">.</span><span class="ident" id="7144444">base</span>&nbsp;<span class="op" id="7144449">!=</span>&nbsp;<span class="ident" id="7144452">g</span><span class="op" id="7144453">.</span><span class="ident" id="7144454">base</span>&nbsp;<span class="op" id="7144459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144464">return</span>&nbsp;<span class="ident" id="7144471">fmt</span><span class="op" id="7144474">.</span><span class="ident" id="7144475">Errorf</span><span class="op" id="7144481">(</span><span class="string" id="7144482">&#34;different&nbsp;base&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7144515">,</span>&nbsp;<span class="ident" id="7144517">f</span><span class="op" id="7144518">.</span><span class="ident" id="7144519">name</span><span class="op" id="7144523">,</span>&nbsp;<span class="ident" id="7144525">f</span><span class="op" id="7144526">.</span><span class="ident" id="7144527">base</span><span class="op" id="7144531">,</span>&nbsp;<span class="ident" id="7144533">g</span><span class="op" id="7144534">.</span><span class="ident" id="7144535">base</span><span class="op" id="7144539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144543">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144547">if</span>&nbsp;<span class="ident" id="7144550">f</span><span class="op" id="7144551">.</span><span class="ident" id="7144552">size</span>&nbsp;<span class="op" id="7144557">!=</span>&nbsp;<span class="ident" id="7144560">g</span><span class="op" id="7144561">.</span><span class="ident" id="7144562">size</span>&nbsp;<span class="op" id="7144567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144572">return</span>&nbsp;<span class="ident" id="7144579">fmt</span><span class="op" id="7144582">.</span><span class="ident" id="7144583">Errorf</span><span class="op" id="7144589">(</span><span class="string" id="7144590">&#34;different&nbsp;size&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7144623">,</span>&nbsp;<span class="ident" id="7144625">f</span><span class="op" id="7144626">.</span><span class="ident" id="7144627">name</span><span class="op" id="7144631">,</span>&nbsp;<span class="ident" id="7144633">f</span><span class="op" id="7144634">.</span><span class="ident" id="7144635">size</span><span class="op" id="7144639">,</span>&nbsp;<span class="ident" id="7144641">g</span><span class="op" id="7144642">.</span><span class="ident" id="7144643">size</span><span class="op" id="7144647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144655">for</span>&nbsp;<span class="ident" id="7144659">j</span><span class="op" id="7144660">,</span>&nbsp;<span class="ident" id="7144662">l</span>&nbsp;<span class="op" id="7144664">:=</span>&nbsp;<span class="keyword" id="7144667">range</span>&nbsp;<span class="ident" id="7144673">f</span><span class="op" id="7144674">.</span><span class="ident" id="7144675">lines</span>&nbsp;<span class="op" id="7144681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7144686">m</span>&nbsp;<span class="op" id="7144688">:=</span>&nbsp;<span class="ident" id="7144691">g</span><span class="op" id="7144692">.</span><span class="ident" id="7144693">lines</span><span class="op" id="7144698">[</span><span class="ident" id="7144699">j</span><span class="op" id="7144700">]</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144705">if</span>&nbsp;<span class="ident" id="7144708">l</span>&nbsp;<span class="op" id="7144710">!=</span>&nbsp;<span class="ident" id="7144713">m</span>&nbsp;<span class="op" id="7144715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144721">return</span>&nbsp;<span class="ident" id="7144728">fmt</span><span class="op" id="7144731">.</span><span class="ident" id="7144732">Errorf</span><span class="op" id="7144738">(</span><span class="string" id="7144739">&#34;different&nbsp;offsets&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7144765">,</span>&nbsp;<span class="ident" id="7144767">f</span><span class="op" id="7144768">.</span><span class="ident" id="7144769">name</span><span class="op" id="7144773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144786">for</span>&nbsp;<span class="ident" id="7144790">j</span><span class="op" id="7144791">,</span>&nbsp;<span class="ident" id="7144793">l</span>&nbsp;<span class="op" id="7144795">:=</span>&nbsp;<span class="keyword" id="7144798">range</span>&nbsp;<span class="ident" id="7144804">f</span><span class="op" id="7144805">.</span><span class="ident" id="7144806">infos</span>&nbsp;<span class="op" id="7144812">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7144817">m</span>&nbsp;<span class="op" id="7144819">:=</span>&nbsp;<span class="ident" id="7144822">g</span><span class="op" id="7144823">.</span><span class="ident" id="7144824">infos</span><span class="op" id="7144829">[</span><span class="ident" id="7144830">j</span><span class="op" id="7144831">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144836">if</span>&nbsp;<span class="ident" id="7144839">l</span><span class="op" id="7144840">.</span><span class="ident" id="7144841">Offset</span>&nbsp;<span class="op" id="7144848">!=</span>&nbsp;<span class="ident" id="7144851">m</span><span class="op" id="7144852">.</span><span class="ident" id="7144853">Offset</span>&nbsp;<span class="op" id="7144860">||</span>&nbsp;<span class="ident" id="7144863">l</span><span class="op" id="7144864">.</span><span class="ident" id="7144865">Filename</span>&nbsp;<span class="op" id="7144874">!=</span>&nbsp;<span class="ident" id="7144877">m</span><span class="op" id="7144878">.</span><span class="ident" id="7144879">Filename</span>&nbsp;<span class="op" id="7144888">||</span>&nbsp;<span class="ident" id="7144891">l</span><span class="op" id="7144892">.</span><span class="ident" id="7144893">Line</span>&nbsp;<span class="op" id="7144898">!=</span>&nbsp;<span class="ident" id="7144901">m</span><span class="op" id="7144902">.</span><span class="ident" id="7144903">Line</span>&nbsp;<span class="op" id="7144908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7144914">return</span>&nbsp;<span class="ident" id="7144921">fmt</span><span class="op" id="7144924">.</span><span class="ident" id="7144925">Errorf</span><span class="op" id="7144931">(</span><span class="string" id="7144932">&#34;different&nbsp;infos&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7144956">,</span>&nbsp;<span class="ident" id="7144958">f</span><span class="op" id="7144959">.</span><span class="ident" id="7144960">name</span><span class="op" id="7144964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144973">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7144976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7144980">//&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;about&nbsp;.last&nbsp;-&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145030">return</span>&nbsp;<span class="ident" id="7145037">nil</span><br>
<span class="lineno"></span><span class="op" id="7145041">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7145044">func</span>&nbsp;<span class="ident" id="7145049">checkSerialize</span><span class="op" id="7145063">(</span><span class="ident" id="7145064">t</span>&nbsp;<span class="op" id="7145066">*</span><span class="ident" id="7145067">testing</span><span class="op" id="7145074">.</span><span class="ident" id="7145075">T</span><span class="op" id="7145076">,</span>&nbsp;<span class="ident" id="7145078">p</span>&nbsp;<span class="op" id="7145080">*</span><span class="ident" id="7145081">FileSet</span><span class="op" id="7145088">)</span>&nbsp;<span class="op" id="7145090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145093">var</span>&nbsp;<span class="ident" id="7145097">buf</span>&nbsp;<span class="ident" id="7145101">bytes</span><span class="op" id="7145106">.</span><span class="ident" id="7145107">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145115">encode</span>&nbsp;<span class="op" id="7145122">:=</span>&nbsp;<span class="keyword" id="7145125">func</span><span class="op" id="7145129">(</span><span class="ident" id="7145130">x</span>&nbsp;<span class="keyword" id="7145132">interface</span><span class="op" id="7145141">{</span><span class="op" id="7145142">}</span><span class="op" id="7145143">)</span>&nbsp;<span class="builtintype" id="7145145">error</span>&nbsp;<span class="op" id="7145151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145155">return</span>&nbsp;<span class="ident" id="7145162">gob</span><span class="op" id="7145165">.</span><span class="ident" id="7145166">NewEncoder</span><span class="op" id="7145176">(</span><span class="op" id="7145177">&amp;</span><span class="ident" id="7145178">buf</span><span class="op" id="7145181">)</span><span class="op" id="7145182">.</span><span class="ident" id="7145183">Encode</span><span class="op" id="7145189">(</span><span class="ident" id="7145190">x</span><span class="op" id="7145191">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7145194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145197">if</span>&nbsp;<span class="ident" id="7145200">err</span>&nbsp;<span class="op" id="7145204">:=</span>&nbsp;<span class="ident" id="7145207">p</span><span class="op" id="7145208">.</span><span class="ident" id="7145209">Write</span><span class="op" id="7145214">(</span><span class="ident" id="7145215">encode</span><span class="op" id="7145221">)</span><span class="op" id="7145222">;</span>&nbsp;<span class="ident" id="7145224">err</span>&nbsp;<span class="op" id="7145228">!=</span>&nbsp;<span class="ident" id="7145231">nil</span>&nbsp;<span class="op" id="7145235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145239">t</span><span class="op" id="7145240">.</span><span class="ident" id="7145241">Errorf</span><span class="op" id="7145247">(</span><span class="string" id="7145248">&#34;writing&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7145276">,</span>&nbsp;<span class="ident" id="7145278">err</span><span class="op" id="7145281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145285">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7145293">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145296">q</span>&nbsp;<span class="op" id="7145298">:=</span>&nbsp;<span class="ident" id="7145301">NewFileSet</span><span class="op" id="7145311">(</span><span class="op" id="7145312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145315">decode</span>&nbsp;<span class="op" id="7145322">:=</span>&nbsp;<span class="keyword" id="7145325">func</span><span class="op" id="7145329">(</span><span class="ident" id="7145330">x</span>&nbsp;<span class="keyword" id="7145332">interface</span><span class="op" id="7145341">{</span><span class="op" id="7145342">}</span><span class="op" id="7145343">)</span>&nbsp;<span class="builtintype" id="7145345">error</span>&nbsp;<span class="op" id="7145351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145355">return</span>&nbsp;<span class="ident" id="7145362">gob</span><span class="op" id="7145365">.</span><span class="ident" id="7145366">NewDecoder</span><span class="op" id="7145376">(</span><span class="op" id="7145377">&amp;</span><span class="ident" id="7145378">buf</span><span class="op" id="7145381">)</span><span class="op" id="7145382">.</span><span class="ident" id="7145383">Decode</span><span class="op" id="7145389">(</span><span class="ident" id="7145390">x</span><span class="op" id="7145391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7145394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145397">if</span>&nbsp;<span class="ident" id="7145400">err</span>&nbsp;<span class="op" id="7145404">:=</span>&nbsp;<span class="ident" id="7145407">q</span><span class="op" id="7145408">.</span><span class="ident" id="7145409">Read</span><span class="op" id="7145413">(</span><span class="ident" id="7145414">decode</span><span class="op" id="7145420">)</span><span class="op" id="7145421">;</span>&nbsp;<span class="ident" id="7145423">err</span>&nbsp;<span class="op" id="7145427">!=</span>&nbsp;<span class="ident" id="7145430">nil</span>&nbsp;<span class="op" id="7145434">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145438">t</span><span class="op" id="7145439">.</span><span class="ident" id="7145440">Errorf</span><span class="op" id="7145446">(</span><span class="string" id="7145447">&#34;reading&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7145475">,</span>&nbsp;<span class="ident" id="7145477">err</span><span class="op" id="7145480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145484">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7145492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145495">if</span>&nbsp;<span class="ident" id="7145498">err</span>&nbsp;<span class="op" id="7145502">:=</span>&nbsp;<span class="ident" id="7145505">equal</span><span class="op" id="7145510">(</span><span class="ident" id="7145511">p</span><span class="op" id="7145512">,</span>&nbsp;<span class="ident" id="7145514">q</span><span class="op" id="7145515">)</span><span class="op" id="7145516">;</span>&nbsp;<span class="ident" id="7145518">err</span>&nbsp;<span class="op" id="7145522">!=</span>&nbsp;<span class="ident" id="7145525">nil</span>&nbsp;<span class="op" id="7145529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145533">t</span><span class="op" id="7145534">.</span><span class="ident" id="7145535">Errorf</span><span class="op" id="7145541">(</span><span class="string" id="7145542">&#34;filesets&nbsp;not&nbsp;identical:&nbsp;%s&#34;</span><span class="op" id="7145570">,</span>&nbsp;<span class="ident" id="7145572">err</span><span class="op" id="7145575">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7145578">}</span><br>
<span class="lineno"></span><span class="op" id="7145580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7145583">func</span>&nbsp;<span class="ident" id="7145588">TestSerialization</span><span class="op" id="7145605">(</span><span class="ident" id="7145606">t</span>&nbsp;<span class="op" id="7145608">*</span><span class="ident" id="7145609">testing</span><span class="op" id="7145616">.</span><span class="ident" id="7145617">T</span><span class="op" id="7145618">)</span>&nbsp;<span class="op" id="7145620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145623">p</span>&nbsp;<span class="op" id="7145625">:=</span>&nbsp;<span class="ident" id="7145628">NewFileSet</span><span class="op" id="7145638">(</span><span class="op" id="7145639">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145642">checkSerialize</span><span class="op" id="7145656">(</span><span class="ident" id="7145657">t</span><span class="op" id="7145658">,</span>&nbsp;<span class="ident" id="7145660">p</span><span class="op" id="7145661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7145664">//&nbsp;add&nbsp;some&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145683">for</span>&nbsp;<span class="ident" id="7145687">i</span>&nbsp;<span class="op" id="7145689">:=</span>&nbsp;<span class="num" id="7145692">0</span><span class="op" id="7145693">;</span>&nbsp;<span class="ident" id="7145695">i</span>&nbsp;<span class="op" id="7145697">&lt;</span>&nbsp;<span class="num" id="7145699">10</span><span class="op" id="7145701">;</span>&nbsp;<span class="ident" id="7145703">i</span><span class="op" id="7145704">++</span>&nbsp;<span class="op" id="7145707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145711">f</span>&nbsp;<span class="op" id="7145713">:=</span>&nbsp;<span class="ident" id="7145716">p</span><span class="op" id="7145717">.</span><span class="ident" id="7145718">AddFile</span><span class="op" id="7145725">(</span><span class="ident" id="7145726">fmt</span><span class="op" id="7145729">.</span><span class="ident" id="7145730">Sprintf</span><span class="op" id="7145737">(</span><span class="string" id="7145738">&#34;file%d&#34;</span><span class="op" id="7145746">,</span>&nbsp;<span class="ident" id="7145748">i</span><span class="op" id="7145749">)</span><span class="op" id="7145750">,</span>&nbsp;<span class="ident" id="7145752">p</span><span class="op" id="7145753">.</span><span class="ident" id="7145754">Base</span><span class="op" id="7145758">(</span><span class="op" id="7145759">)</span><span class="op" id="7145760">+</span><span class="ident" id="7145761">i</span><span class="op" id="7145762">,</span>&nbsp;<span class="ident" id="7145764">i</span><span class="op" id="7145765">*</span><span class="num" id="7145766">100</span><span class="op" id="7145769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145773">checkSerialize</span><span class="op" id="7145787">(</span><span class="ident" id="7145788">t</span><span class="op" id="7145789">,</span>&nbsp;<span class="ident" id="7145791">p</span><span class="op" id="7145792">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7145796">//&nbsp;add&nbsp;some&nbsp;lines&nbsp;and&nbsp;alternative&nbsp;file&nbsp;infos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145843">line</span>&nbsp;<span class="op" id="7145848">:=</span>&nbsp;<span class="num" id="7145851">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145858">for</span>&nbsp;<span class="ident" id="7145862">offs</span>&nbsp;<span class="op" id="7145867">:=</span>&nbsp;<span class="num" id="7145870">0</span><span class="op" id="7145871">;</span>&nbsp;<span class="ident" id="7145873">offs</span>&nbsp;<span class="op" id="7145878">&lt;</span>&nbsp;<span class="ident" id="7145880">f</span><span class="op" id="7145881">.</span><span class="ident" id="7145882">Size</span><span class="op" id="7145886">(</span><span class="op" id="7145887">)</span><span class="op" id="7145888">;</span>&nbsp;<span class="ident" id="7145890">offs</span>&nbsp;<span class="op" id="7145895">+=</span>&nbsp;<span class="num" id="7145898">40</span>&nbsp;<span class="op" id="7145901">+</span>&nbsp;<span class="ident" id="7145903">i</span>&nbsp;<span class="op" id="7145905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145910">f</span><span class="op" id="7145911">.</span><span class="ident" id="7145912">AddLine</span><span class="op" id="7145919">(</span><span class="ident" id="7145920">offs</span><span class="op" id="7145924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7145929">if</span>&nbsp;<span class="ident" id="7145932">offs</span><span class="op" id="7145936">%</span><span class="num" id="7145937">7</span>&nbsp;<span class="op" id="7145939">==</span>&nbsp;<span class="num" id="7145942">0</span>&nbsp;<span class="op" id="7145944">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7145950">f</span><span class="op" id="7145951">.</span><span class="ident" id="7145952">AddLineInfo</span><span class="op" id="7145963">(</span><span class="ident" id="7145964">offs</span><span class="op" id="7145968">,</span>&nbsp;<span class="ident" id="7145970">fmt</span><span class="op" id="7145973">.</span><span class="ident" id="7145974">Sprintf</span><span class="op" id="7145981">(</span><span class="string" id="7145982">&#34;file%d&#34;</span><span class="op" id="7145990">,</span>&nbsp;<span class="ident" id="7145992">offs</span><span class="op" id="7145996">)</span><span class="op" id="7145997">,</span>&nbsp;<span class="ident" id="7145999">line</span><span class="op" id="7146003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146009">line</span>&nbsp;<span class="op" id="7146014">+=</span>&nbsp;<span class="num" id="7146017">33</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7146023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7146027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7146031">checkSerialize</span><span class="op" id="7146045">(</span><span class="ident" id="7146046">t</span><span class="op" id="7146047">,</span>&nbsp;<span class="ident" id="7146049">p</span><span class="op" id="7146050">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7146053">}</span><br>
<span class="lineno"></span><span class="op" id="7146055">}</span>
</div>
</body>
</html>
