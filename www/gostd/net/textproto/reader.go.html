<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4290305">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4290361">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4290415">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4290466">package</span>&nbsp;<span class="ident" id="4290474">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4290485">import</span>&nbsp;<span class="op" id="4290492">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4290495">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4290504">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4290513">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4290519">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4290532">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4290543">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4290553">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4290556">//&nbsp;BUG(rsc):&nbsp;To&nbsp;let&nbsp;callers&nbsp;manage&nbsp;exposure&nbsp;to&nbsp;denial&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="4290621">//&nbsp;attacks,&nbsp;Reader&nbsp;should&nbsp;allow&nbsp;them&nbsp;to&nbsp;set&nbsp;and&nbsp;reset&nbsp;a&nbsp;limit&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="4290686">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4290736">//&nbsp;A&nbsp;Reader&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;reading&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="4290800">//&nbsp;or&nbsp;responses&nbsp;from&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4290857">type</span>&nbsp;<span class="ident" id="4290862">Reader</span>&nbsp;<span class="keyword" id="4290869">struct</span>&nbsp;<span class="op" id="4290876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290879">R</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4290883">*</span><span class="ident" id="4290884">bufio</span><span class="op" id="4290889">.</span><span class="ident" id="4290890">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290898">dot</span>&nbsp;<span class="op" id="4290902">*</span><span class="ident" id="4290903">dotReader</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290914">buf</span>&nbsp;<span class="op" id="4290918">[</span><span class="op" id="4290919">]</span><span class="builtintype" id="4290920">byte</span>&nbsp;<span class="comment" id="4290925">//&nbsp;a&nbsp;re-usable&nbsp;buffer&nbsp;for&nbsp;readContinuedLineSlice</span><br>
<span class="lineno"></span><span class="op" id="4290974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4290977">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="4291027">func</span>&nbsp;<span class="ident" id="4291032">NewReader</span><span class="op" id="4291041">(</span><span class="ident" id="4291042">r</span>&nbsp;<span class="op" id="4291044">*</span><span class="ident" id="4291045">bufio</span><span class="op" id="4291050">.</span><span class="ident" id="4291051">Reader</span><span class="op" id="4291057">)</span>&nbsp;<span class="op" id="4291059">*</span><span class="ident" id="4291060">Reader</span>&nbsp;<span class="op" id="4291067">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4291070">return</span>&nbsp;<span class="op" id="4291077">&amp;</span><span class="ident" id="4291078">Reader</span><span class="op" id="4291084">{</span><span class="ident" id="4291085">R</span><span class="op" id="4291086">:</span>&nbsp;<span class="ident" id="4291088">r</span><span class="op" id="4291089">}</span><br>
<span class="lineno"></span><span class="op" id="4291091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4291094">//&nbsp;ReadLine&nbsp;reads&nbsp;a&nbsp;single&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="4291134">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;\n&nbsp;or&nbsp;\r\n&nbsp;from&nbsp;the&nbsp;returned&nbsp;string.</span><br>
<span class="lineno">35</span><span class="keyword" id="4291192">func</span>&nbsp;<span class="op" id="4291197">(</span><span class="ident" id="4291198">r</span>&nbsp;<span class="op" id="4291200">*</span><span class="ident" id="4291201">Reader</span><span class="op" id="4291207">)</span>&nbsp;<span class="ident" id="4291209">ReadLine</span><span class="op" id="4291217">(</span><span class="op" id="4291218">)</span>&nbsp;<span class="op" id="4291220">(</span><span class="builtintype" id="4291221">string</span><span class="op" id="4291227">,</span>&nbsp;<span class="builtintype" id="4291229">error</span><span class="op" id="4291234">)</span>&nbsp;<span class="op" id="4291236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4291239">line</span><span class="op" id="4291243">,</span>&nbsp;<span class="ident" id="4291245">err</span>&nbsp;<span class="op" id="4291249">:=</span>&nbsp;<span class="ident" id="4291252">r</span><span class="op" id="4291253">.</span><span class="ident" id="4291254">readLineSlice</span><span class="op" id="4291267">(</span><span class="op" id="4291268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4291271">return</span>&nbsp;<span class="builtintype" id="4291278">string</span><span class="op" id="4291284">(</span><span class="ident" id="4291285">line</span><span class="op" id="4291289">)</span><span class="op" id="4291290">,</span>&nbsp;<span class="ident" id="4291292">err</span><br>
<span class="lineno"></span><span class="op" id="4291296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="4291299">//&nbsp;ReadLineBytes&nbsp;is&nbsp;like&nbsp;ReadLine&nbsp;but&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4291375">func</span>&nbsp;<span class="op" id="4291380">(</span><span class="ident" id="4291381">r</span>&nbsp;<span class="op" id="4291383">*</span><span class="ident" id="4291384">Reader</span><span class="op" id="4291390">)</span>&nbsp;<span class="ident" id="4291392">ReadLineBytes</span><span class="op" id="4291405">(</span><span class="op" id="4291406">)</span>&nbsp;<span class="op" id="4291408">(</span><span class="op" id="4291409">[</span><span class="op" id="4291410">]</span><span class="builtintype" id="4291411">byte</span><span class="op" id="4291415">,</span>&nbsp;<span class="builtintype" id="4291417">error</span><span class="op" id="4291422">)</span>&nbsp;<span class="op" id="4291424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4291427">line</span><span class="op" id="4291431">,</span>&nbsp;<span class="ident" id="4291433">err</span>&nbsp;<span class="op" id="4291437">:=</span>&nbsp;<span class="ident" id="4291440">r</span><span class="op" id="4291441">.</span><span class="ident" id="4291442">readLineSlice</span><span class="op" id="4291455">(</span><span class="op" id="4291456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4291459">if</span>&nbsp;<span class="ident" id="4291462">line</span>&nbsp;<span class="op" id="4291467">!=</span>&nbsp;<span class="builtintype" id="4291470">nil</span>&nbsp;<span class="op" id="4291474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4291478">buf</span>&nbsp;<span class="op" id="4291482">:=</span>&nbsp;<span class="builtinfunc" id="4291485">make</span><span class="op" id="4291489">(</span><span class="op" id="4291490">[</span><span class="op" id="4291491">]</span><span class="builtintype" id="4291492">byte</span><span class="op" id="4291496">,</span>&nbsp;<span class="builtinfunc" id="4291498">len</span><span class="op" id="4291501">(</span><span class="ident" id="4291502">line</span><span class="op" id="4291506">)</span><span class="op" id="4291507">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4291511">copy</span><span class="op" id="4291515">(</span><span class="ident" id="4291516">buf</span><span class="op" id="4291519">,</span>&nbsp;<span class="ident" id="4291521">line</span><span class="op" id="4291525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4291529">line</span>&nbsp;<span class="op" id="4291534">=</span>&nbsp;<span class="ident" id="4291536">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4291541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4291544">return</span>&nbsp;<span class="ident" id="4291551">line</span><span class="op" id="4291555">,</span>&nbsp;<span class="ident" id="4291557">err</span><br>
<span class="lineno"></span><span class="op" id="4291561">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="4291564">func</span>&nbsp;<span class="op" id="4291569">(</span><span class="ident" id="4291570">r</span>&nbsp;<span class="op" id="4291572">*</span><span class="ident" id="4291573">Reader</span><span class="op" id="4291579">)</span>&nbsp;<span class="ident" id="4291581">readLineSlice</span><span class="op" id="4291594">(</span><span class="op" id="4291595">)</span>&nbsp;<span class="op" id="4291597">(</span><span class="op" id="4291598">[</span><span class="op" id="4291599">]</span><span class="builtintype" id="4291600">byte</span><span class="op" id="4291604">,</span>&nbsp;<span class="builtintype" id="4291606">error</span><span class="op" id="4291611">)</span>&nbsp;<span class="op" id="4291613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4291616">r</span><span class="op" id="4291617">.</span><span class="ident" id="4291618">closeDot</span><span class="op" id="4291626">(</span><span class="op" id="4291627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4291630">var</span>&nbsp;<span class="ident" id="4291634">line</span>&nbsp;<span class="op" id="4291639">[</span><span class="op" id="4291640">]</span><span class="builtintype" id="4291641">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4291647">for</span>&nbsp;<span class="op" id="4291651">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4291655">l</span><span class="op" id="4291656">,</span>&nbsp;<span class="ident" id="4291658">more</span><span class="op" id="4291662">,</span>&nbsp;<span class="ident" id="4291664">err</span>&nbsp;<span class="op" id="4291668">:=</span>&nbsp;<span class="ident" id="4291671">r</span><span class="op" id="4291672">.</span><span class="ident" id="4291673">R</span><span class="op" id="4291674">.</span><span class="ident" id="4291675">ReadLine</span><span class="op" id="4291683">(</span><span class="op" id="4291684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4291688">if</span>&nbsp;<span class="ident" id="4291691">err</span>&nbsp;<span class="op" id="4291695">!=</span>&nbsp;<span class="builtintype" id="4291698">nil</span>&nbsp;<span class="op" id="4291702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4291707">return</span>&nbsp;<span class="builtintype" id="4291714">nil</span><span class="op" id="4291717">,</span>&nbsp;<span class="ident" id="4291719">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4291725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4291729">//&nbsp;Avoid&nbsp;the&nbsp;copy&nbsp;if&nbsp;the&nbsp;first&nbsp;call&nbsp;produced&nbsp;a&nbsp;full&nbsp;line.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4291789">if</span>&nbsp;<span class="ident" id="4291792">line</span>&nbsp;<span class="op" id="4291797">==</span>&nbsp;<span class="builtintype" id="4291800">nil</span>&nbsp;<span class="op" id="4291804">&amp;&amp;</span>&nbsp;<span class="op" id="4291807">!</span><span class="ident" id="4291808">more</span>&nbsp;<span class="op" id="4291813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4291818">return</span>&nbsp;<span class="ident" id="4291825">l</span><span class="op" id="4291826">,</span>&nbsp;<span class="builtintype" id="4291828">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4291834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4291838">line</span>&nbsp;<span class="op" id="4291843">=</span>&nbsp;<span class="builtinfunc" id="4291845">append</span><span class="op" id="4291851">(</span><span class="ident" id="4291852">line</span><span class="op" id="4291856">,</span>&nbsp;<span class="ident" id="4291858">l</span><span class="op" id="4291859">...</span><span class="op" id="4291862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4291866">if</span>&nbsp;<span class="op" id="4291869">!</span><span class="ident" id="4291870">more</span>&nbsp;<span class="op" id="4291875">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4291880">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4291888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4291891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4291894">return</span>&nbsp;<span class="ident" id="4291901">line</span><span class="op" id="4291905">,</span>&nbsp;<span class="builtintype" id="4291907">nil</span><br>
<span class="lineno"></span><span class="op" id="4291911">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="4291914">//&nbsp;ReadContinuedLine&nbsp;reads&nbsp;a&nbsp;possibly&nbsp;continued&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="4291975">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;trailing&nbsp;ASCII&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="comment" id="4292024">//&nbsp;Lines&nbsp;after&nbsp;the&nbsp;first&nbsp;are&nbsp;considered&nbsp;continuations&nbsp;if&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="4292086">//&nbsp;begin&nbsp;with&nbsp;a&nbsp;space&nbsp;or&nbsp;tab&nbsp;character.&nbsp;&nbsp;In&nbsp;the&nbsp;returned&nbsp;data,</span><br>
<span class="lineno">75</span><span class="comment" id="4292149">//&nbsp;continuation&nbsp;lines&nbsp;are&nbsp;separated&nbsp;from&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4292208">//&nbsp;only&nbsp;by&nbsp;a&nbsp;single&nbsp;space:&nbsp;the&nbsp;newline&nbsp;and&nbsp;leading&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="4292271">//&nbsp;are&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="4292287">//</span><br>
<span class="lineno"></span><span class="comment" id="4292290">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">80</span><span class="comment" id="4292327">//</span><br>
<span class="lineno"></span><span class="comment" id="4292330">//&nbsp;&nbsp;&nbsp;&nbsp;Line&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="4292340">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continued...</span><br>
<span class="lineno"></span><span class="comment" id="4292358">//&nbsp;&nbsp;&nbsp;&nbsp;Line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="4292368">//</span><br>
<span class="lineno">85</span><span class="comment" id="4292371">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;ReadContinuedLine&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;1&nbsp;continued...&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4292444">//&nbsp;and&nbsp;the&nbsp;second&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;2&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4292484">//</span><br>
<span class="lineno"></span><span class="comment" id="4292487">//&nbsp;A&nbsp;line&nbsp;consisting&nbsp;of&nbsp;only&nbsp;white&nbsp;space&nbsp;is&nbsp;never&nbsp;continued.</span><br>
<span class="lineno"></span><span class="comment" id="4292548">//</span><br>
<span class="lineno">90</span><span class="keyword" id="4292551">func</span>&nbsp;<span class="op" id="4292556">(</span><span class="ident" id="4292557">r</span>&nbsp;<span class="op" id="4292559">*</span><span class="ident" id="4292560">Reader</span><span class="op" id="4292566">)</span>&nbsp;<span class="ident" id="4292568">ReadContinuedLine</span><span class="op" id="4292585">(</span><span class="op" id="4292586">)</span>&nbsp;<span class="op" id="4292588">(</span><span class="builtintype" id="4292589">string</span><span class="op" id="4292595">,</span>&nbsp;<span class="builtintype" id="4292597">error</span><span class="op" id="4292602">)</span>&nbsp;<span class="op" id="4292604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292607">line</span><span class="op" id="4292611">,</span>&nbsp;<span class="ident" id="4292613">err</span>&nbsp;<span class="op" id="4292617">:=</span>&nbsp;<span class="ident" id="4292620">r</span><span class="op" id="4292621">.</span><span class="ident" id="4292622">readContinuedLineSlice</span><span class="op" id="4292644">(</span><span class="op" id="4292645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292648">return</span>&nbsp;<span class="builtintype" id="4292655">string</span><span class="op" id="4292661">(</span><span class="ident" id="4292662">line</span><span class="op" id="4292666">)</span><span class="op" id="4292667">,</span>&nbsp;<span class="ident" id="4292669">err</span><br>
<span class="lineno"></span><span class="op" id="4292673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4292676">//&nbsp;trim&nbsp;returns&nbsp;s&nbsp;with&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;spaces&nbsp;and&nbsp;tabs&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="4292745">//&nbsp;It&nbsp;does&nbsp;not&nbsp;assume&nbsp;Unicode&nbsp;or&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="4292785">func</span>&nbsp;<span class="ident" id="4292790">trim</span><span class="op" id="4292794">(</span><span class="ident" id="4292795">s</span>&nbsp;<span class="op" id="4292797">[</span><span class="op" id="4292798">]</span><span class="builtintype" id="4292799">byte</span><span class="op" id="4292803">)</span>&nbsp;<span class="op" id="4292805">[</span><span class="op" id="4292806">]</span><span class="builtintype" id="4292807">byte</span>&nbsp;<span class="op" id="4292812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292815">i</span>&nbsp;<span class="op" id="4292817">:=</span>&nbsp;<span class="num" id="4292820">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292823">for</span>&nbsp;<span class="ident" id="4292827">i</span>&nbsp;<span class="op" id="4292829">&lt;</span>&nbsp;<span class="builtinfunc" id="4292831">len</span><span class="op" id="4292834">(</span><span class="ident" id="4292835">s</span><span class="op" id="4292836">)</span>&nbsp;<span class="op" id="4292838">&amp;&amp;</span>&nbsp;<span class="op" id="4292841">(</span><span class="ident" id="4292842">s</span><span class="op" id="4292843">[</span><span class="ident" id="4292844">i</span><span class="op" id="4292845">]</span>&nbsp;<span class="op" id="4292847">==</span>&nbsp;<span class="string" id="4292850">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4292854">||</span>&nbsp;<span class="ident" id="4292857">s</span><span class="op" id="4292858">[</span><span class="ident" id="4292859">i</span><span class="op" id="4292860">]</span>&nbsp;<span class="op" id="4292862">==</span>&nbsp;<span class="string" id="4292865">&#39;\t&#39;</span><span class="op" id="4292869">)</span>&nbsp;<span class="op" id="4292871">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292875">i</span><span class="op" id="4292876">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4292880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292883">n</span>&nbsp;<span class="op" id="4292885">:=</span>&nbsp;<span class="builtinfunc" id="4292888">len</span><span class="op" id="4292891">(</span><span class="ident" id="4292892">s</span><span class="op" id="4292893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292896">for</span>&nbsp;<span class="ident" id="4292900">n</span>&nbsp;<span class="op" id="4292902">&gt;</span>&nbsp;<span class="ident" id="4292904">i</span>&nbsp;<span class="op" id="4292906">&amp;&amp;</span>&nbsp;<span class="op" id="4292909">(</span><span class="ident" id="4292910">s</span><span class="op" id="4292911">[</span><span class="ident" id="4292912">n</span><span class="op" id="4292913">-</span><span class="num" id="4292914">1</span><span class="op" id="4292915">]</span>&nbsp;<span class="op" id="4292917">==</span>&nbsp;<span class="string" id="4292920">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4292924">||</span>&nbsp;<span class="ident" id="4292927">s</span><span class="op" id="4292928">[</span><span class="ident" id="4292929">n</span><span class="op" id="4292930">-</span><span class="num" id="4292931">1</span><span class="op" id="4292932">]</span>&nbsp;<span class="op" id="4292934">==</span>&nbsp;<span class="string" id="4292937">&#39;\t&#39;</span><span class="op" id="4292941">)</span>&nbsp;<span class="op" id="4292943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292947">n</span><span class="op" id="4292948">--</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4292952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292955">return</span>&nbsp;<span class="ident" id="4292962">s</span><span class="op" id="4292963">[</span><span class="ident" id="4292964">i</span><span class="op" id="4292965">:</span><span class="ident" id="4292966">n</span><span class="op" id="4292967">]</span><br>
<span class="lineno"></span><span class="op" id="4292969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4292972">//&nbsp;ReadContinuedLineBytes&nbsp;is&nbsp;like&nbsp;ReadContinuedLine&nbsp;but</span><br>
<span class="lineno">110</span><span class="comment" id="4293028">//&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4293069">func</span>&nbsp;<span class="op" id="4293074">(</span><span class="ident" id="4293075">r</span>&nbsp;<span class="op" id="4293077">*</span><span class="ident" id="4293078">Reader</span><span class="op" id="4293084">)</span>&nbsp;<span class="ident" id="4293086">ReadContinuedLineBytes</span><span class="op" id="4293108">(</span><span class="op" id="4293109">)</span>&nbsp;<span class="op" id="4293111">(</span><span class="op" id="4293112">[</span><span class="op" id="4293113">]</span><span class="builtintype" id="4293114">byte</span><span class="op" id="4293118">,</span>&nbsp;<span class="builtintype" id="4293120">error</span><span class="op" id="4293125">)</span>&nbsp;<span class="op" id="4293127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4293130">line</span><span class="op" id="4293134">,</span>&nbsp;<span class="ident" id="4293136">err</span>&nbsp;<span class="op" id="4293140">:=</span>&nbsp;<span class="ident" id="4293143">r</span><span class="op" id="4293144">.</span><span class="ident" id="4293145">readContinuedLineSlice</span><span class="op" id="4293167">(</span><span class="op" id="4293168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4293171">if</span>&nbsp;<span class="ident" id="4293174">line</span>&nbsp;<span class="op" id="4293179">!=</span>&nbsp;<span class="builtintype" id="4293182">nil</span>&nbsp;<span class="op" id="4293186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4293190">buf</span>&nbsp;<span class="op" id="4293194">:=</span>&nbsp;<span class="builtinfunc" id="4293197">make</span><span class="op" id="4293201">(</span><span class="op" id="4293202">[</span><span class="op" id="4293203">]</span><span class="builtintype" id="4293204">byte</span><span class="op" id="4293208">,</span>&nbsp;<span class="builtinfunc" id="4293210">len</span><span class="op" id="4293213">(</span><span class="ident" id="4293214">line</span><span class="op" id="4293218">)</span><span class="op" id="4293219">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4293223">copy</span><span class="op" id="4293227">(</span><span class="ident" id="4293228">buf</span><span class="op" id="4293231">,</span>&nbsp;<span class="ident" id="4293233">line</span><span class="op" id="4293237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4293241">line</span>&nbsp;<span class="op" id="4293246">=</span>&nbsp;<span class="ident" id="4293248">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4293253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4293256">return</span>&nbsp;<span class="ident" id="4293263">line</span><span class="op" id="4293267">,</span>&nbsp;<span class="ident" id="4293269">err</span><br>
<span class="lineno"></span><span class="op" id="4293273">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="4293276">func</span>&nbsp;<span class="op" id="4293281">(</span><span class="ident" id="4293282">r</span>&nbsp;<span class="op" id="4293284">*</span><span class="ident" id="4293285">Reader</span><span class="op" id="4293291">)</span>&nbsp;<span class="ident" id="4293293">readContinuedLineSlice</span><span class="op" id="4293315">(</span><span class="op" id="4293316">)</span>&nbsp;<span class="op" id="4293318">(</span><span class="op" id="4293319">[</span><span class="op" id="4293320">]</span><span class="builtintype" id="4293321">byte</span><span class="op" id="4293325">,</span>&nbsp;<span class="builtintype" id="4293327">error</span><span class="op" id="4293332">)</span>&nbsp;<span class="op" id="4293334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4293337">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4293362">line</span><span class="op" id="4293366">,</span>&nbsp;<span class="ident" id="4293368">err</span>&nbsp;<span class="op" id="4293372">:=</span>&nbsp;<span class="ident" id="4293375">r</span><span class="op" id="4293376">.</span><span class="ident" id="4293377">readLineSlice</span><span class="op" id="4293390">(</span><span class="op" id="4293391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4293394">if</span>&nbsp;<span class="ident" id="4293397">err</span>&nbsp;<span class="op" id="4293401">!=</span>&nbsp;<span class="builtintype" id="4293404">nil</span>&nbsp;<span class="op" id="4293408">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4293412">return</span>&nbsp;<span class="builtintype" id="4293419">nil</span><span class="op" id="4293422">,</span>&nbsp;<span class="ident" id="4293424">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4293429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4293432">if</span>&nbsp;<span class="builtinfunc" id="4293435">len</span><span class="op" id="4293438">(</span><span class="ident" id="4293439">line</span><span class="op" id="4293443">)</span>&nbsp;<span class="op" id="4293445">==</span>&nbsp;<span class="num" id="4293448">0</span>&nbsp;<span class="op" id="4293450">{</span>&nbsp;<span class="comment" id="4293452">//&nbsp;blank&nbsp;line&nbsp;-&nbsp;no&nbsp;continuation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4293486">return</span>&nbsp;<span class="ident" id="4293493">line</span><span class="op" id="4293497">,</span>&nbsp;<span class="builtintype" id="4293499">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4293504">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4293508">//&nbsp;Optimistically&nbsp;assume&nbsp;that&nbsp;we&nbsp;have&nbsp;started&nbsp;to&nbsp;buffer&nbsp;the&nbsp;next&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4293579">//&nbsp;and&nbsp;it&nbsp;starts&nbsp;with&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;(the&nbsp;next&nbsp;header&nbsp;key),&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4293651">//&nbsp;avoid&nbsp;copying&nbsp;that&nbsp;buffered&nbsp;data&nbsp;around&nbsp;in&nbsp;memory&nbsp;and&nbsp;skipping&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4293723">//&nbsp;non-existent&nbsp;whitespace.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4293752">if</span>&nbsp;<span class="ident" id="4293755">r</span><span class="op" id="4293756">.</span><span class="ident" id="4293757">R</span><span class="op" id="4293758">.</span><span class="ident" id="4293759">Buffered</span><span class="op" id="4293767">(</span><span class="op" id="4293768">)</span>&nbsp;<span class="op" id="4293770">&gt;</span>&nbsp;<span class="num" id="4293772">1</span>&nbsp;<span class="op" id="4293774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4293778">peek</span><span class="op" id="4293782">,</span>&nbsp;<span class="ident" id="4293784">err</span>&nbsp;<span class="op" id="4293788">:=</span>&nbsp;<span class="ident" id="4293791">r</span><span class="op" id="4293792">.</span><span class="ident" id="4293793">R</span><span class="op" id="4293794">.</span><span class="ident" id="4293795">Peek</span><span class="op" id="4293799">(</span><span class="num" id="4293800">1</span><span class="op" id="4293801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4293805">if</span>&nbsp;<span class="ident" id="4293808">err</span>&nbsp;<span class="op" id="4293812">==</span>&nbsp;<span class="builtintype" id="4293815">nil</span>&nbsp;<span class="op" id="4293819">&amp;&amp;</span>&nbsp;<span class="ident" id="4293822">isASCIILetter</span><span class="op" id="4293835">(</span><span class="ident" id="4293836">peek</span><span class="op" id="4293840">[</span><span class="num" id="4293841">0</span><span class="op" id="4293842">]</span><span class="op" id="4293843">)</span>&nbsp;<span class="op" id="4293845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4293850">return</span>&nbsp;<span class="ident" id="4293857">trim</span><span class="op" id="4293861">(</span><span class="ident" id="4293862">line</span><span class="op" id="4293866">)</span><span class="op" id="4293867">,</span>&nbsp;<span class="builtintype" id="4293869">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4293875">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4293878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4293882">//&nbsp;ReadByte&nbsp;or&nbsp;the&nbsp;next&nbsp;readLineSlice&nbsp;will&nbsp;flush&nbsp;the&nbsp;read&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4293949">//&nbsp;copy&nbsp;the&nbsp;slice&nbsp;into&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4293978">r</span><span class="op" id="4293979">.</span><span class="ident" id="4293980">buf</span>&nbsp;<span class="op" id="4293984">=</span>&nbsp;<span class="builtinfunc" id="4293986">append</span><span class="op" id="4293992">(</span><span class="ident" id="4293993">r</span><span class="op" id="4293994">.</span><span class="ident" id="4293995">buf</span><span class="op" id="4293998">[</span><span class="op" id="4293999">:</span><span class="num" id="4294000">0</span><span class="op" id="4294001">]</span><span class="op" id="4294002">,</span>&nbsp;<span class="ident" id="4294004">trim</span><span class="op" id="4294008">(</span><span class="ident" id="4294009">line</span><span class="op" id="4294013">)</span><span class="op" id="4294014">...</span><span class="op" id="4294017">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4294021">//&nbsp;Read&nbsp;continuation&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4294050">for</span>&nbsp;<span class="ident" id="4294054">r</span><span class="op" id="4294055">.</span><span class="ident" id="4294056">skipSpace</span><span class="op" id="4294065">(</span><span class="op" id="4294066">)</span>&nbsp;<span class="op" id="4294068">&gt;</span>&nbsp;<span class="num" id="4294070">0</span>&nbsp;<span class="op" id="4294072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4294076">line</span><span class="op" id="4294080">,</span>&nbsp;<span class="ident" id="4294082">err</span>&nbsp;<span class="op" id="4294086">:=</span>&nbsp;<span class="ident" id="4294089">r</span><span class="op" id="4294090">.</span><span class="ident" id="4294091">readLineSlice</span><span class="op" id="4294104">(</span><span class="op" id="4294105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4294109">if</span>&nbsp;<span class="ident" id="4294112">err</span>&nbsp;<span class="op" id="4294116">!=</span>&nbsp;<span class="builtintype" id="4294119">nil</span>&nbsp;<span class="op" id="4294123">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4294128">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4294136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4294140">r</span><span class="op" id="4294141">.</span><span class="ident" id="4294142">buf</span>&nbsp;<span class="op" id="4294146">=</span>&nbsp;<span class="builtinfunc" id="4294148">append</span><span class="op" id="4294154">(</span><span class="ident" id="4294155">r</span><span class="op" id="4294156">.</span><span class="ident" id="4294157">buf</span><span class="op" id="4294160">,</span>&nbsp;<span class="string" id="4294162">&#39;&nbsp;&#39;</span><span class="op" id="4294165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4294169">r</span><span class="op" id="4294170">.</span><span class="ident" id="4294171">buf</span>&nbsp;<span class="op" id="4294175">=</span>&nbsp;<span class="builtinfunc" id="4294177">append</span><span class="op" id="4294183">(</span><span class="ident" id="4294184">r</span><span class="op" id="4294185">.</span><span class="ident" id="4294186">buf</span><span class="op" id="4294189">,</span>&nbsp;<span class="ident" id="4294191">line</span><span class="op" id="4294195">...</span><span class="op" id="4294198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4294201">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4294204">return</span>&nbsp;<span class="ident" id="4294211">r</span><span class="op" id="4294212">.</span><span class="ident" id="4294213">buf</span><span class="op" id="4294216">,</span>&nbsp;<span class="builtintype" id="4294218">nil</span><br>
<span class="lineno"></span><span class="op" id="4294222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4294225">//&nbsp;skipSpace&nbsp;skips&nbsp;R&nbsp;over&nbsp;all&nbsp;spaces&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="4294303">func</span>&nbsp;<span class="op" id="4294308">(</span><span class="ident" id="4294309">r</span>&nbsp;<span class="op" id="4294311">*</span><span class="ident" id="4294312">Reader</span><span class="op" id="4294318">)</span>&nbsp;<span class="ident" id="4294320">skipSpace</span><span class="op" id="4294329">(</span><span class="op" id="4294330">)</span>&nbsp;<span class="builtintype" id="4294332">int</span>&nbsp;<span class="op" id="4294336">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4294339">n</span>&nbsp;<span class="op" id="4294341">:=</span>&nbsp;<span class="num" id="4294344">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4294347">for</span>&nbsp;<span class="op" id="4294351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4294355">c</span><span class="op" id="4294356">,</span>&nbsp;<span class="ident" id="4294358">err</span>&nbsp;<span class="op" id="4294362">:=</span>&nbsp;<span class="ident" id="4294365">r</span><span class="op" id="4294366">.</span><span class="ident" id="4294367">R</span><span class="op" id="4294368">.</span><span class="ident" id="4294369">ReadByte</span><span class="op" id="4294377">(</span><span class="op" id="4294378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4294382">if</span>&nbsp;<span class="ident" id="4294385">err</span>&nbsp;<span class="op" id="4294389">!=</span>&nbsp;<span class="builtintype" id="4294392">nil</span>&nbsp;<span class="op" id="4294396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4294401">//&nbsp;Bufio&nbsp;will&nbsp;keep&nbsp;err&nbsp;until&nbsp;next&nbsp;read.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4294444">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4294452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4294456">if</span>&nbsp;<span class="ident" id="4294459">c</span>&nbsp;<span class="op" id="4294461">!=</span>&nbsp;<span class="string" id="4294464">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4294468">&amp;&amp;</span>&nbsp;<span class="ident" id="4294471">c</span>&nbsp;<span class="op" id="4294473">!=</span>&nbsp;<span class="string" id="4294476">&#39;\t&#39;</span>&nbsp;<span class="op" id="4294481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4294486">r</span><span class="op" id="4294487">.</span><span class="ident" id="4294488">R</span><span class="op" id="4294489">.</span><span class="ident" id="4294490">UnreadByte</span><span class="op" id="4294500">(</span><span class="op" id="4294501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4294506">break</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4294514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4294518">n</span><span class="op" id="4294519">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4294523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4294526">return</span>&nbsp;<span class="ident" id="4294533">n</span><br>
<span class="lineno"></span><span class="op" id="4294535">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="keyword" id="4294538">func</span>&nbsp;<span class="op" id="4294543">(</span><span class="ident" id="4294544">r</span>&nbsp;<span class="op" id="4294546">*</span><span class="ident" id="4294547">Reader</span><span class="op" id="4294553">)</span>&nbsp;<span class="ident" id="4294555">readCodeLine</span><span class="op" id="4294567">(</span><span class="ident" id="4294568">expectCode</span>&nbsp;<span class="builtintype" id="4294579">int</span><span class="op" id="4294582">)</span>&nbsp;<span class="op" id="4294584">(</span><span class="ident" id="4294585">code</span>&nbsp;<span class="builtintype" id="4294590">int</span><span class="op" id="4294593">,</span>&nbsp;<span class="ident" id="4294595">continued</span>&nbsp;<span class="builtintype" id="4294605">bool</span><span class="op" id="4294609">,</span>&nbsp;<span class="ident" id="4294611">message</span>&nbsp;<span class="builtintype" id="4294619">string</span><span class="op" id="4294625">,</span>&nbsp;<span class="ident" id="4294627">err</span>&nbsp;<span class="builtintype" id="4294631">error</span><span class="op" id="4294636">)</span>&nbsp;<span class="op" id="4294638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4294641">line</span><span class="op" id="4294645">,</span>&nbsp;<span class="ident" id="4294647">err</span>&nbsp;<span class="op" id="4294651">:=</span>&nbsp;<span class="ident" id="4294654">r</span><span class="op" id="4294655">.</span><span class="ident" id="4294656">ReadLine</span><span class="op" id="4294664">(</span><span class="op" id="4294665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4294668">if</span>&nbsp;<span class="ident" id="4294671">err</span>&nbsp;<span class="op" id="4294675">!=</span>&nbsp;<span class="builtintype" id="4294678">nil</span>&nbsp;<span class="op" id="4294682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4294686">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4294694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4294697">return</span>&nbsp;<span class="ident" id="4294704">parseCodeLine</span><span class="op" id="4294717">(</span><span class="ident" id="4294718">line</span><span class="op" id="4294722">,</span>&nbsp;<span class="ident" id="4294724">expectCode</span><span class="op" id="4294734">)</span><br>
<span class="lineno"></span><span class="op" id="4294736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4294739">func</span>&nbsp;<span class="ident" id="4294744">parseCodeLine</span><span class="op" id="4294757">(</span><span class="ident" id="4294758">line</span>&nbsp;<span class="builtintype" id="4294763">string</span><span class="op" id="4294769">,</span>&nbsp;<span class="ident" id="4294771">expectCode</span>&nbsp;<span class="builtintype" id="4294782">int</span><span class="op" id="4294785">)</span>&nbsp;<span class="op" id="4294787">(</span><span class="ident" id="4294788">code</span>&nbsp;<span class="builtintype" id="4294793">int</span><span class="op" id="4294796">,</span>&nbsp;<span class="ident" id="4294798">continued</span>&nbsp;<span class="builtintype" id="4294808">bool</span><span class="op" id="4294812">,</span>&nbsp;<span class="ident" id="4294814">message</span>&nbsp;<span class="builtintype" id="4294822">string</span><span class="op" id="4294828">,</span>&nbsp;<span class="ident" id="4294830">err</span>&nbsp;<span class="builtintype" id="4294834">error</span><span class="op" id="4294839">)</span>&nbsp;<span class="op" id="4294841">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4294844">if</span>&nbsp;<span class="builtinfunc" id="4294847">len</span><span class="op" id="4294850">(</span><span class="ident" id="4294851">line</span><span class="op" id="4294855">)</span>&nbsp;<span class="op" id="4294857">&lt;</span>&nbsp;<span class="num" id="4294859">4</span>&nbsp;<span class="op" id="4294861">||</span>&nbsp;<span class="ident" id="4294864">line</span><span class="op" id="4294868">[</span><span class="num" id="4294869">3</span><span class="op" id="4294870">]</span>&nbsp;<span class="op" id="4294872">!=</span>&nbsp;<span class="string" id="4294875">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4294879">&amp;&amp;</span>&nbsp;<span class="ident" id="4294882">line</span><span class="op" id="4294886">[</span><span class="num" id="4294887">3</span><span class="op" id="4294888">]</span>&nbsp;<span class="op" id="4294890">!=</span>&nbsp;<span class="string" id="4294893">&#39;-&#39;</span>&nbsp;<span class="op" id="4294897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4294901">err</span>&nbsp;<span class="op" id="4294905">=</span>&nbsp;<span class="ident" id="4294907">ProtocolError</span><span class="op" id="4294920">(</span><span class="string" id="4294921">&#34;short&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="4294940">+</span>&nbsp;<span class="ident" id="4294942">line</span><span class="op" id="4294946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4294950">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4294958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4294961">continued</span>&nbsp;<span class="op" id="4294971">=</span>&nbsp;<span class="ident" id="4294973">line</span><span class="op" id="4294977">[</span><span class="num" id="4294978">3</span><span class="op" id="4294979">]</span>&nbsp;<span class="op" id="4294981">==</span>&nbsp;<span class="string" id="4294984">&#39;-&#39;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4294989">code</span><span class="op" id="4294993">,</span>&nbsp;<span class="ident" id="4294995">err</span>&nbsp;<span class="op" id="4294999">=</span>&nbsp;<span class="ident" id="4295001">strconv</span><span class="op" id="4295008">.</span><span class="ident" id="4295009">Atoi</span><span class="op" id="4295013">(</span><span class="ident" id="4295014">line</span><span class="op" id="4295018">[</span><span class="num" id="4295019">0</span><span class="op" id="4295020">:</span><span class="num" id="4295021">3</span><span class="op" id="4295022">]</span><span class="op" id="4295023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4295026">if</span>&nbsp;<span class="ident" id="4295029">err</span>&nbsp;<span class="op" id="4295033">!=</span>&nbsp;<span class="builtintype" id="4295036">nil</span>&nbsp;<span class="op" id="4295040">||</span>&nbsp;<span class="ident" id="4295043">code</span>&nbsp;<span class="op" id="4295048">&lt;</span>&nbsp;<span class="num" id="4295050">100</span>&nbsp;<span class="op" id="4295054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4295058">err</span>&nbsp;<span class="op" id="4295062">=</span>&nbsp;<span class="ident" id="4295064">ProtocolError</span><span class="op" id="4295077">(</span><span class="string" id="4295078">&#34;invalid&nbsp;response&nbsp;code:&nbsp;&#34;</span>&nbsp;<span class="op" id="4295104">+</span>&nbsp;<span class="ident" id="4295106">line</span><span class="op" id="4295110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4295114">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4295122">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4295125">message</span>&nbsp;<span class="op" id="4295133">=</span>&nbsp;<span class="ident" id="4295135">line</span><span class="op" id="4295139">[</span><span class="num" id="4295140">4</span><span class="op" id="4295141">:</span><span class="op" id="4295142">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4295145">if</span>&nbsp;<span class="num" id="4295148">1</span>&nbsp;<span class="op" id="4295150">&lt;=</span>&nbsp;<span class="ident" id="4295153">expectCode</span>&nbsp;<span class="op" id="4295164">&amp;&amp;</span>&nbsp;<span class="ident" id="4295167">expectCode</span>&nbsp;<span class="op" id="4295178">&lt;</span>&nbsp;<span class="num" id="4295180">10</span>&nbsp;<span class="op" id="4295183">&amp;&amp;</span>&nbsp;<span class="ident" id="4295186">code</span><span class="op" id="4295190">/</span><span class="num" id="4295191">100</span>&nbsp;<span class="op" id="4295195">!=</span>&nbsp;<span class="ident" id="4295198">expectCode</span>&nbsp;<span class="op" id="4295209">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4295214">10</span>&nbsp;<span class="op" id="4295217">&lt;=</span>&nbsp;<span class="ident" id="4295220">expectCode</span>&nbsp;<span class="op" id="4295231">&amp;&amp;</span>&nbsp;<span class="ident" id="4295234">expectCode</span>&nbsp;<span class="op" id="4295245">&lt;</span>&nbsp;<span class="num" id="4295247">100</span>&nbsp;<span class="op" id="4295251">&amp;&amp;</span>&nbsp;<span class="ident" id="4295254">code</span><span class="op" id="4295258">/</span><span class="num" id="4295259">10</span>&nbsp;<span class="op" id="4295262">!=</span>&nbsp;<span class="ident" id="4295265">expectCode</span>&nbsp;<span class="op" id="4295276">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4295281">100</span>&nbsp;<span class="op" id="4295285">&lt;=</span>&nbsp;<span class="ident" id="4295288">expectCode</span>&nbsp;<span class="op" id="4295299">&amp;&amp;</span>&nbsp;<span class="ident" id="4295302">expectCode</span>&nbsp;<span class="op" id="4295313">&lt;</span>&nbsp;<span class="num" id="4295315">1000</span>&nbsp;<span class="op" id="4295320">&amp;&amp;</span>&nbsp;<span class="ident" id="4295323">code</span>&nbsp;<span class="op" id="4295328">!=</span>&nbsp;<span class="ident" id="4295331">expectCode</span>&nbsp;<span class="op" id="4295342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4295346">err</span>&nbsp;<span class="op" id="4295350">=</span>&nbsp;<span class="op" id="4295352">&amp;</span><span class="ident" id="4295353">Error</span><span class="op" id="4295358">{</span><span class="ident" id="4295359">code</span><span class="op" id="4295363">,</span>&nbsp;<span class="ident" id="4295365">message</span><span class="op" id="4295372">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4295375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4295378">return</span><br>
<span class="lineno"></span><span class="op" id="4295385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4295388">//&nbsp;ReadCodeLine&nbsp;reads&nbsp;a&nbsp;response&nbsp;code&nbsp;line&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno">205</span><span class="comment" id="4295443">//&nbsp;&nbsp;&nbsp;&nbsp;code&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="4295459">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code&nbsp;and&nbsp;the&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="4295518">//&nbsp;extends&nbsp;to&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;line.&nbsp;&nbsp;An&nbsp;example&nbsp;of&nbsp;such&nbsp;a&nbsp;line&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="4295585">//&nbsp;&nbsp;&nbsp;&nbsp;220&nbsp;plan9.bell-labs.com&nbsp;ESMTP</span><br>
<span class="lineno"></span><span class="comment" id="4295618">//</span><br>
<span class="lineno">210</span><span class="comment" id="4295621">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="4295693">//&nbsp;ReadCodeLine&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="4295756">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="4295822">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="4295867">//</span><br>
<span class="lineno">215</span><span class="comment" id="4295870">//&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;multi-line,&nbsp;ReadCodeLine&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4295935">//</span><br>
<span class="lineno"></span><span class="comment" id="4295938">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4295999">//</span><br>
<span class="lineno"></span><span class="keyword" id="4296002">func</span>&nbsp;<span class="op" id="4296007">(</span><span class="ident" id="4296008">r</span>&nbsp;<span class="op" id="4296010">*</span><span class="ident" id="4296011">Reader</span><span class="op" id="4296017">)</span>&nbsp;<span class="ident" id="4296019">ReadCodeLine</span><span class="op" id="4296031">(</span><span class="ident" id="4296032">expectCode</span>&nbsp;<span class="builtintype" id="4296043">int</span><span class="op" id="4296046">)</span>&nbsp;<span class="op" id="4296048">(</span><span class="ident" id="4296049">code</span>&nbsp;<span class="builtintype" id="4296054">int</span><span class="op" id="4296057">,</span>&nbsp;<span class="ident" id="4296059">message</span>&nbsp;<span class="builtintype" id="4296067">string</span><span class="op" id="4296073">,</span>&nbsp;<span class="ident" id="4296075">err</span>&nbsp;<span class="builtintype" id="4296079">error</span><span class="op" id="4296084">)</span>&nbsp;<span class="op" id="4296086">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4296089">code</span><span class="op" id="4296093">,</span>&nbsp;<span class="ident" id="4296095">continued</span><span class="op" id="4296104">,</span>&nbsp;<span class="ident" id="4296106">message</span><span class="op" id="4296113">,</span>&nbsp;<span class="ident" id="4296115">err</span>&nbsp;<span class="op" id="4296119">:=</span>&nbsp;<span class="ident" id="4296122">r</span><span class="op" id="4296123">.</span><span class="ident" id="4296124">readCodeLine</span><span class="op" id="4296136">(</span><span class="ident" id="4296137">expectCode</span><span class="op" id="4296147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4296150">if</span>&nbsp;<span class="ident" id="4296153">err</span>&nbsp;<span class="op" id="4296157">==</span>&nbsp;<span class="builtintype" id="4296160">nil</span>&nbsp;<span class="op" id="4296164">&amp;&amp;</span>&nbsp;<span class="ident" id="4296167">continued</span>&nbsp;<span class="op" id="4296177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4296181">err</span>&nbsp;<span class="op" id="4296185">=</span>&nbsp;<span class="ident" id="4296187">ProtocolError</span><span class="op" id="4296200">(</span><span class="string" id="4296201">&#34;unexpected&nbsp;multi-line&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="4296236">+</span>&nbsp;<span class="ident" id="4296238">message</span><span class="op" id="4296245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4296248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4296251">return</span><br>
<span class="lineno">225</span><span class="op" id="4296258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4296261">//&nbsp;ReadResponse&nbsp;reads&nbsp;a&nbsp;multi-line&nbsp;response&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="4296318">//</span><br>
<span class="lineno"></span><span class="comment" id="4296321">//&nbsp;&nbsp;&nbsp;&nbsp;code-message&nbsp;line&nbsp;1</span><br>
<span class="lineno">230</span><span class="comment" id="4296344">//&nbsp;&nbsp;&nbsp;&nbsp;code-message&nbsp;line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="4296367">//&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="4296374">//&nbsp;&nbsp;&nbsp;&nbsp;code&nbsp;message&nbsp;line&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="4296397">//</span><br>
<span class="lineno"></span><span class="comment" id="4296400">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code.&nbsp;The&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;the</span><br>
<span class="lineno">235</span><span class="comment" id="4296475">//&nbsp;code&nbsp;and&nbsp;a&nbsp;hyphen.&nbsp;The&nbsp;response&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;line&nbsp;that&nbsp;starts</span><br>
<span class="lineno"></span><span class="comment" id="4296546">//&nbsp;with&nbsp;the&nbsp;same&nbsp;code&nbsp;followed&nbsp;by&nbsp;a&nbsp;space.&nbsp;Each&nbsp;line&nbsp;in&nbsp;message&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4296613">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;newline&nbsp;(\n).</span><br>
<span class="lineno"></span><span class="comment" id="4296645">//</span><br>
<span class="lineno"></span><span class="comment" id="4296648">//&nbsp;See&nbsp;page&nbsp;36&nbsp;of&nbsp;RFC&nbsp;959&nbsp;(http://www.ietf.org/rfc/rfc959.txt)&nbsp;for</span><br>
<span class="lineno">240</span><span class="comment" id="4296715">//&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="4296727">//</span><br>
<span class="lineno"></span><span class="comment" id="4296730">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="4296802">//&nbsp;ReadResponse&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="4296865">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno">245</span><span class="comment" id="4296931">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="4296976">//</span><br>
<span class="lineno"></span><span class="comment" id="4296979">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4297040">//</span><br>
<span class="lineno"></span><span class="keyword" id="4297043">func</span>&nbsp;<span class="op" id="4297048">(</span><span class="ident" id="4297049">r</span>&nbsp;<span class="op" id="4297051">*</span><span class="ident" id="4297052">Reader</span><span class="op" id="4297058">)</span>&nbsp;<span class="ident" id="4297060">ReadResponse</span><span class="op" id="4297072">(</span><span class="ident" id="4297073">expectCode</span>&nbsp;<span class="builtintype" id="4297084">int</span><span class="op" id="4297087">)</span>&nbsp;<span class="op" id="4297089">(</span><span class="ident" id="4297090">code</span>&nbsp;<span class="builtintype" id="4297095">int</span><span class="op" id="4297098">,</span>&nbsp;<span class="ident" id="4297100">message</span>&nbsp;<span class="builtintype" id="4297108">string</span><span class="op" id="4297114">,</span>&nbsp;<span class="ident" id="4297116">err</span>&nbsp;<span class="builtintype" id="4297120">error</span><span class="op" id="4297125">)</span>&nbsp;<span class="op" id="4297127">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4297130">code</span><span class="op" id="4297134">,</span>&nbsp;<span class="ident" id="4297136">continued</span><span class="op" id="4297145">,</span>&nbsp;<span class="ident" id="4297147">message</span><span class="op" id="4297154">,</span>&nbsp;<span class="ident" id="4297156">err</span>&nbsp;<span class="op" id="4297160">:=</span>&nbsp;<span class="ident" id="4297163">r</span><span class="op" id="4297164">.</span><span class="ident" id="4297165">readCodeLine</span><span class="op" id="4297177">(</span><span class="ident" id="4297178">expectCode</span><span class="op" id="4297188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4297191">for</span>&nbsp;<span class="ident" id="4297195">err</span>&nbsp;<span class="op" id="4297199">==</span>&nbsp;<span class="builtintype" id="4297202">nil</span>&nbsp;<span class="op" id="4297206">&amp;&amp;</span>&nbsp;<span class="ident" id="4297209">continued</span>&nbsp;<span class="op" id="4297219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4297223">line</span><span class="op" id="4297227">,</span>&nbsp;<span class="ident" id="4297229">err</span>&nbsp;<span class="op" id="4297233">:=</span>&nbsp;<span class="ident" id="4297236">r</span><span class="op" id="4297237">.</span><span class="ident" id="4297238">ReadLine</span><span class="op" id="4297246">(</span><span class="op" id="4297247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4297251">if</span>&nbsp;<span class="ident" id="4297254">err</span>&nbsp;<span class="op" id="4297258">!=</span>&nbsp;<span class="builtintype" id="4297261">nil</span>&nbsp;<span class="op" id="4297265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4297270">return</span>&nbsp;<span class="num" id="4297277">0</span><span class="op" id="4297278">,</span>&nbsp;<span class="string" id="4297280">&#34;&#34;</span><span class="op" id="4297282">,</span>&nbsp;<span class="ident" id="4297284">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4297290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4297295">var</span>&nbsp;<span class="ident" id="4297299">code2</span>&nbsp;<span class="builtintype" id="4297305">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4297311">var</span>&nbsp;<span class="ident" id="4297315">moreMessage</span>&nbsp;<span class="builtintype" id="4297327">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4297336">code2</span><span class="op" id="4297341">,</span>&nbsp;<span class="ident" id="4297343">continued</span><span class="op" id="4297352">,</span>&nbsp;<span class="ident" id="4297354">moreMessage</span><span class="op" id="4297365">,</span>&nbsp;<span class="ident" id="4297367">err</span>&nbsp;<span class="op" id="4297371">=</span>&nbsp;<span class="ident" id="4297373">parseCodeLine</span><span class="op" id="4297386">(</span><span class="ident" id="4297387">line</span><span class="op" id="4297391">,</span>&nbsp;<span class="ident" id="4297393">expectCode</span><span class="op" id="4297403">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4297407">if</span>&nbsp;<span class="ident" id="4297410">err</span>&nbsp;<span class="op" id="4297414">!=</span>&nbsp;<span class="builtintype" id="4297417">nil</span>&nbsp;<span class="op" id="4297421">||</span>&nbsp;<span class="ident" id="4297424">code2</span>&nbsp;<span class="op" id="4297430">!=</span>&nbsp;<span class="ident" id="4297433">code</span>&nbsp;<span class="op" id="4297438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4297443">message</span>&nbsp;<span class="op" id="4297451">+=</span>&nbsp;<span class="string" id="4297454">&#34;\n&#34;</span>&nbsp;<span class="op" id="4297459">+</span>&nbsp;<span class="ident" id="4297461">strings</span><span class="op" id="4297468">.</span><span class="ident" id="4297469">TrimRight</span><span class="op" id="4297478">(</span><span class="ident" id="4297479">line</span><span class="op" id="4297483">,</span>&nbsp;<span class="string" id="4297485">&#34;\r\n&#34;</span><span class="op" id="4297491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4297496">continued</span>&nbsp;<span class="op" id="4297506">=</span>&nbsp;<span class="builtintype" id="4297508">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4297516">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4297527">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4297531">message</span>&nbsp;<span class="op" id="4297539">+=</span>&nbsp;<span class="string" id="4297542">&#34;\n&#34;</span>&nbsp;<span class="op" id="4297547">+</span>&nbsp;<span class="ident" id="4297549">moreMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4297562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4297565">return</span><br>
<span class="lineno"></span><span class="op" id="4297572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="4297575">//&nbsp;DotReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;that&nbsp;satisfies&nbsp;Reads&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4297640">//&nbsp;decoded&nbsp;text&nbsp;of&nbsp;a&nbsp;dot-encoded&nbsp;block&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4297692">//&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="4297749">//&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4297770">//</span><br>
<span class="lineno">275</span><span class="comment" id="4297773">//&nbsp;Dot&nbsp;encoding&nbsp;is&nbsp;a&nbsp;common&nbsp;framing&nbsp;used&nbsp;for&nbsp;data&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="4297830">//&nbsp;in&nbsp;text&nbsp;protocols&nbsp;such&nbsp;as&nbsp;SMTP.&nbsp;&nbsp;The&nbsp;data&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4297898">//&nbsp;of&nbsp;lines,&nbsp;each&nbsp;of&nbsp;which&nbsp;ends&nbsp;in&nbsp;&#34;\r\n&#34;.&nbsp;&nbsp;The&nbsp;sequence&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="4297962">//&nbsp;ends&nbsp;at&nbsp;a&nbsp;line&nbsp;containing&nbsp;just&nbsp;a&nbsp;dot:&nbsp;&#34;.\r\n&#34;.&nbsp;&nbsp;Lines&nbsp;beginning</span><br>
<span class="lineno"></span><span class="comment" id="4298029">//&nbsp;with&nbsp;a&nbsp;dot&nbsp;are&nbsp;escaped&nbsp;with&nbsp;an&nbsp;additional&nbsp;dot&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">280</span><span class="comment" id="4298087">//&nbsp;looking&nbsp;like&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="4298128">//</span><br>
<span class="lineno"></span><span class="comment" id="4298131">//&nbsp;The&nbsp;decoded&nbsp;form&nbsp;returned&nbsp;by&nbsp;the&nbsp;Reader&#39;s&nbsp;Read&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="4298188">//&nbsp;rewrites&nbsp;the&nbsp;&#34;\r\n&#34;&nbsp;line&nbsp;endings&nbsp;into&nbsp;the&nbsp;simpler&nbsp;&#34;\n&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4298247">//&nbsp;removes&nbsp;leading&nbsp;dot&nbsp;escapes&nbsp;if&nbsp;present,&nbsp;and&nbsp;stops&nbsp;with&nbsp;error&nbsp;io.EOF</span><br>
<span class="lineno">285</span><span class="comment" id="4298318">//&nbsp;after&nbsp;consuming&nbsp;(and&nbsp;discarding)&nbsp;the&nbsp;end-of-sequence&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="4298380">func</span>&nbsp;<span class="op" id="4298385">(</span><span class="ident" id="4298386">r</span>&nbsp;<span class="op" id="4298388">*</span><span class="ident" id="4298389">Reader</span><span class="op" id="4298395">)</span>&nbsp;<span class="ident" id="4298397">DotReader</span><span class="op" id="4298406">(</span><span class="op" id="4298407">)</span>&nbsp;<span class="ident" id="4298409">io</span><span class="op" id="4298411">.</span><span class="ident" id="4298412">Reader</span>&nbsp;<span class="op" id="4298419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4298422">r</span><span class="op" id="4298423">.</span><span class="ident" id="4298424">closeDot</span><span class="op" id="4298432">(</span><span class="op" id="4298433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4298436">r</span><span class="op" id="4298437">.</span><span class="ident" id="4298438">dot</span>&nbsp;<span class="op" id="4298442">=</span>&nbsp;<span class="op" id="4298444">&amp;</span><span class="ident" id="4298445">dotReader</span><span class="op" id="4298454">{</span><span class="ident" id="4298455">r</span><span class="op" id="4298456">:</span>&nbsp;<span class="ident" id="4298458">r</span><span class="op" id="4298459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4298462">return</span>&nbsp;<span class="ident" id="4298469">r</span><span class="op" id="4298470">.</span><span class="ident" id="4298471">dot</span><br>
<span class="lineno">290</span><span class="op" id="4298475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4298478">type</span>&nbsp;<span class="ident" id="4298483">dotReader</span>&nbsp;<span class="keyword" id="4298493">struct</span>&nbsp;<span class="op" id="4298500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4298503">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4298509">*</span><span class="ident" id="4298510">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4298518">state</span>&nbsp;<span class="builtintype" id="4298524">int</span><br>
<span class="lineno">295</span><span class="op" id="4298528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4298531">//&nbsp;Read&nbsp;satisfies&nbsp;reads&nbsp;by&nbsp;decoding&nbsp;dot-encoded&nbsp;data&nbsp;read&nbsp;from&nbsp;d.r.</span><br>
<span class="lineno"></span><span class="keyword" id="4298599">func</span>&nbsp;<span class="op" id="4298604">(</span><span class="ident" id="4298605">d</span>&nbsp;<span class="op" id="4298607">*</span><span class="ident" id="4298608">dotReader</span><span class="op" id="4298617">)</span>&nbsp;<span class="ident" id="4298619">Read</span><span class="op" id="4298623">(</span><span class="ident" id="4298624">b</span>&nbsp;<span class="op" id="4298626">[</span><span class="op" id="4298627">]</span><span class="builtintype" id="4298628">byte</span><span class="op" id="4298632">)</span>&nbsp;<span class="op" id="4298634">(</span><span class="ident" id="4298635">n</span>&nbsp;<span class="builtintype" id="4298637">int</span><span class="op" id="4298640">,</span>&nbsp;<span class="ident" id="4298642">err</span>&nbsp;<span class="builtintype" id="4298646">error</span><span class="op" id="4298651">)</span>&nbsp;<span class="op" id="4298653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4298656">//&nbsp;Run&nbsp;data&nbsp;through&nbsp;a&nbsp;simple&nbsp;state&nbsp;machine&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4298703">//&nbsp;elide&nbsp;leading&nbsp;dots,&nbsp;rewrite&nbsp;trailing&nbsp;\r\n&nbsp;into&nbsp;\n,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4298758">//&nbsp;and&nbsp;detect&nbsp;ending&nbsp;.\r\n&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4298792">const</span>&nbsp;<span class="op" id="4298798">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4298802">stateBeginLine</span>&nbsp;<span class="op" id="4298817">=</span>&nbsp;<span class="ident" id="4298819">iota</span>&nbsp;<span class="comment" id="4298824">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4298876">stateDot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4298898">//&nbsp;read&nbsp;.&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4298931">stateDotCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4298953">//&nbsp;read&nbsp;.\r&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4298988">stateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4299010">//&nbsp;read&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4299049">stateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4299071">//&nbsp;reading&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4299107">stateEOF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4299129">//&nbsp;reached&nbsp;.\r\n&nbsp;end&nbsp;marker&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4299163">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4299166">br</span>&nbsp;<span class="op" id="4299169">:=</span>&nbsp;<span class="ident" id="4299172">d</span><span class="op" id="4299173">.</span><span class="ident" id="4299174">r</span><span class="op" id="4299175">.</span><span class="ident" id="4299176">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299179">for</span>&nbsp;<span class="ident" id="4299183">n</span>&nbsp;<span class="op" id="4299185">&lt;</span>&nbsp;<span class="builtinfunc" id="4299187">len</span><span class="op" id="4299190">(</span><span class="ident" id="4299191">b</span><span class="op" id="4299192">)</span>&nbsp;<span class="op" id="4299194">&amp;&amp;</span>&nbsp;<span class="ident" id="4299197">d</span><span class="op" id="4299198">.</span><span class="ident" id="4299199">state</span>&nbsp;<span class="op" id="4299205">!=</span>&nbsp;<span class="ident" id="4299208">stateEOF</span>&nbsp;<span class="op" id="4299217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299221">var</span>&nbsp;<span class="ident" id="4299225">c</span>&nbsp;<span class="builtintype" id="4299227">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4299234">c</span><span class="op" id="4299235">,</span>&nbsp;<span class="ident" id="4299237">err</span>&nbsp;<span class="op" id="4299241">=</span>&nbsp;<span class="ident" id="4299243">br</span><span class="op" id="4299245">.</span><span class="ident" id="4299246">ReadByte</span><span class="op" id="4299254">(</span><span class="op" id="4299255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299259">if</span>&nbsp;<span class="ident" id="4299262">err</span>&nbsp;<span class="op" id="4299266">!=</span>&nbsp;<span class="builtintype" id="4299269">nil</span>&nbsp;<span class="op" id="4299273">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299278">if</span>&nbsp;<span class="ident" id="4299281">err</span>&nbsp;<span class="op" id="4299285">==</span>&nbsp;<span class="ident" id="4299288">io</span><span class="op" id="4299290">.</span><span class="ident" id="4299291">EOF</span>&nbsp;<span class="op" id="4299295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4299301">err</span>&nbsp;<span class="op" id="4299305">=</span>&nbsp;<span class="ident" id="4299307">io</span><span class="op" id="4299309">.</span><span class="ident" id="4299310">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4299330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299335">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4299343">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299347">switch</span>&nbsp;<span class="ident" id="4299354">d</span><span class="op" id="4299355">.</span><span class="ident" id="4299356">state</span>&nbsp;<span class="op" id="4299362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299366">case</span>&nbsp;<span class="ident" id="4299371">stateBeginLine</span><span class="op" id="4299385">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299390">if</span>&nbsp;<span class="ident" id="4299393">c</span>&nbsp;<span class="op" id="4299395">==</span>&nbsp;<span class="string" id="4299398">&#39;.&#39;</span>&nbsp;<span class="op" id="4299402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4299408">d</span><span class="op" id="4299409">.</span><span class="ident" id="4299410">state</span>&nbsp;<span class="op" id="4299416">=</span>&nbsp;<span class="ident" id="4299418">stateDot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299431">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4299443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299448">if</span>&nbsp;<span class="ident" id="4299451">c</span>&nbsp;<span class="op" id="4299453">==</span>&nbsp;<span class="string" id="4299456">&#39;\r&#39;</span>&nbsp;<span class="op" id="4299461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4299467">d</span><span class="op" id="4299468">.</span><span class="ident" id="4299469">state</span>&nbsp;<span class="op" id="4299475">=</span>&nbsp;<span class="ident" id="4299477">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299489">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4299501">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4299506">d</span><span class="op" id="4299507">.</span><span class="ident" id="4299508">state</span>&nbsp;<span class="op" id="4299514">=</span>&nbsp;<span class="ident" id="4299516">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299529">case</span>&nbsp;<span class="ident" id="4299534">stateDot</span><span class="op" id="4299542">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299547">if</span>&nbsp;<span class="ident" id="4299550">c</span>&nbsp;<span class="op" id="4299552">==</span>&nbsp;<span class="string" id="4299555">&#39;\r&#39;</span>&nbsp;<span class="op" id="4299560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4299566">d</span><span class="op" id="4299567">.</span><span class="ident" id="4299568">state</span>&nbsp;<span class="op" id="4299574">=</span>&nbsp;<span class="ident" id="4299576">stateDotCR</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299591">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4299603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299608">if</span>&nbsp;<span class="ident" id="4299611">c</span>&nbsp;<span class="op" id="4299613">==</span>&nbsp;<span class="string" id="4299616">&#39;\n&#39;</span>&nbsp;<span class="op" id="4299621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4299627">d</span><span class="op" id="4299628">.</span><span class="ident" id="4299629">state</span>&nbsp;<span class="op" id="4299635">=</span>&nbsp;<span class="ident" id="4299637">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299650">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4299662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4299667">d</span><span class="op" id="4299668">.</span><span class="ident" id="4299669">state</span>&nbsp;<span class="op" id="4299675">=</span>&nbsp;<span class="ident" id="4299677">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299690">case</span>&nbsp;<span class="ident" id="4299695">stateDotCR</span><span class="op" id="4299705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299710">if</span>&nbsp;<span class="ident" id="4299713">c</span>&nbsp;<span class="op" id="4299715">==</span>&nbsp;<span class="string" id="4299718">&#39;\n&#39;</span>&nbsp;<span class="op" id="4299723">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4299729">d</span><span class="op" id="4299730">.</span><span class="ident" id="4299731">state</span>&nbsp;<span class="op" id="4299737">=</span>&nbsp;<span class="ident" id="4299739">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299752">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4299764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4299769">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;.\r\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4299794">//&nbsp;Consume&nbsp;leading&nbsp;dot&nbsp;and&nbsp;emit&nbsp;saved&nbsp;\r.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4299839">br</span><span class="op" id="4299841">.</span><span class="ident" id="4299842">UnreadByte</span><span class="op" id="4299852">(</span><span class="op" id="4299853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4299858">c</span>&nbsp;<span class="op" id="4299860">=</span>&nbsp;<span class="string" id="4299862">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4299870">d</span><span class="op" id="4299871">.</span><span class="ident" id="4299872">state</span>&nbsp;<span class="op" id="4299878">=</span>&nbsp;<span class="ident" id="4299880">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299893">case</span>&nbsp;<span class="ident" id="4299898">stateCR</span><span class="op" id="4299905">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299910">if</span>&nbsp;<span class="ident" id="4299913">c</span>&nbsp;<span class="op" id="4299915">==</span>&nbsp;<span class="string" id="4299918">&#39;\n&#39;</span>&nbsp;<span class="op" id="4299923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4299929">d</span><span class="op" id="4299930">.</span><span class="ident" id="4299931">state</span>&nbsp;<span class="op" id="4299937">=</span>&nbsp;<span class="ident" id="4299939">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4299958">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4299967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4299972">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;\r\n.&nbsp;&nbsp;Emit&nbsp;saved&nbsp;\r</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4300011">br</span><span class="op" id="4300013">.</span><span class="ident" id="4300014">UnreadByte</span><span class="op" id="4300024">(</span><span class="op" id="4300025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4300030">c</span>&nbsp;<span class="op" id="4300032">=</span>&nbsp;<span class="string" id="4300034">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4300042">d</span><span class="op" id="4300043">.</span><span class="ident" id="4300044">state</span>&nbsp;<span class="op" id="4300050">=</span>&nbsp;<span class="ident" id="4300052">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4300065">case</span>&nbsp;<span class="ident" id="4300070">stateData</span><span class="op" id="4300079">:</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4300084">if</span>&nbsp;<span class="ident" id="4300087">c</span>&nbsp;<span class="op" id="4300089">==</span>&nbsp;<span class="string" id="4300092">&#39;\r&#39;</span>&nbsp;<span class="op" id="4300097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4300103">d</span><span class="op" id="4300104">.</span><span class="ident" id="4300105">state</span>&nbsp;<span class="op" id="4300111">=</span>&nbsp;<span class="ident" id="4300113">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4300125">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4300137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4300142">if</span>&nbsp;<span class="ident" id="4300145">c</span>&nbsp;<span class="op" id="4300147">==</span>&nbsp;<span class="string" id="4300150">&#39;\n&#39;</span>&nbsp;<span class="op" id="4300155">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4300161">d</span><span class="op" id="4300162">.</span><span class="ident" id="4300163">state</span>&nbsp;<span class="op" id="4300169">=</span>&nbsp;<span class="ident" id="4300171">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4300189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4300193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4300197">b</span><span class="op" id="4300198">[</span><span class="ident" id="4300199">n</span><span class="op" id="4300200">]</span>&nbsp;<span class="op" id="4300202">=</span>&nbsp;<span class="ident" id="4300204">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4300208">n</span><span class="op" id="4300209">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4300213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4300216">if</span>&nbsp;<span class="ident" id="4300219">err</span>&nbsp;<span class="op" id="4300223">==</span>&nbsp;<span class="builtintype" id="4300226">nil</span>&nbsp;<span class="op" id="4300230">&amp;&amp;</span>&nbsp;<span class="ident" id="4300233">d</span><span class="op" id="4300234">.</span><span class="ident" id="4300235">state</span>&nbsp;<span class="op" id="4300241">==</span>&nbsp;<span class="ident" id="4300244">stateEOF</span>&nbsp;<span class="op" id="4300253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4300257">err</span>&nbsp;<span class="op" id="4300261">=</span>&nbsp;<span class="ident" id="4300263">io</span><span class="op" id="4300265">.</span><span class="ident" id="4300266">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4300271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4300274">if</span>&nbsp;<span class="ident" id="4300277">err</span>&nbsp;<span class="op" id="4300281">!=</span>&nbsp;<span class="builtintype" id="4300284">nil</span>&nbsp;<span class="op" id="4300288">&amp;&amp;</span>&nbsp;<span class="ident" id="4300291">d</span><span class="op" id="4300292">.</span><span class="ident" id="4300293">r</span><span class="op" id="4300294">.</span><span class="ident" id="4300295">dot</span>&nbsp;<span class="op" id="4300299">==</span>&nbsp;<span class="ident" id="4300302">d</span>&nbsp;<span class="op" id="4300304">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4300308">d</span><span class="op" id="4300309">.</span><span class="ident" id="4300310">r</span><span class="op" id="4300311">.</span><span class="ident" id="4300312">dot</span>&nbsp;<span class="op" id="4300316">=</span>&nbsp;<span class="builtintype" id="4300318">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4300323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4300326">return</span><br>
<span class="lineno"></span><span class="op" id="4300333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="4300336">//&nbsp;closeDot&nbsp;drains&nbsp;the&nbsp;current&nbsp;DotReader&nbsp;if&nbsp;any,</span><br>
<span class="lineno"></span><span class="comment" id="4300385">//&nbsp;making&nbsp;sure&nbsp;that&nbsp;it&nbsp;reads&nbsp;until&nbsp;the&nbsp;ending&nbsp;dot&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="4300441">func</span>&nbsp;<span class="op" id="4300446">(</span><span class="ident" id="4300447">r</span>&nbsp;<span class="op" id="4300449">*</span><span class="ident" id="4300450">Reader</span><span class="op" id="4300456">)</span>&nbsp;<span class="ident" id="4300458">closeDot</span><span class="op" id="4300466">(</span><span class="op" id="4300467">)</span>&nbsp;<span class="op" id="4300469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4300472">if</span>&nbsp;<span class="ident" id="4300475">r</span><span class="op" id="4300476">.</span><span class="ident" id="4300477">dot</span>&nbsp;<span class="op" id="4300481">==</span>&nbsp;<span class="builtintype" id="4300484">nil</span>&nbsp;<span class="op" id="4300488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4300492">return</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4300500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4300503">buf</span>&nbsp;<span class="op" id="4300507">:=</span>&nbsp;<span class="builtinfunc" id="4300510">make</span><span class="op" id="4300514">(</span><span class="op" id="4300515">[</span><span class="op" id="4300516">]</span><span class="builtintype" id="4300517">byte</span><span class="op" id="4300521">,</span>&nbsp;<span class="num" id="4300523">128</span><span class="op" id="4300526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4300529">for</span>&nbsp;<span class="ident" id="4300533">r</span><span class="op" id="4300534">.</span><span class="ident" id="4300535">dot</span>&nbsp;<span class="op" id="4300539">!=</span>&nbsp;<span class="builtintype" id="4300542">nil</span>&nbsp;<span class="op" id="4300546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4300550">//&nbsp;When&nbsp;Read&nbsp;reaches&nbsp;EOF&nbsp;or&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4300590">//&nbsp;it&nbsp;will&nbsp;set&nbsp;r.dot&nbsp;==&nbsp;nil.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4300621">r</span><span class="op" id="4300622">.</span><span class="ident" id="4300623">dot</span><span class="op" id="4300626">.</span><span class="ident" id="4300627">Read</span><span class="op" id="4300631">(</span><span class="ident" id="4300632">buf</span><span class="op" id="4300635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4300638">}</span><br>
<span class="lineno"></span><span class="op" id="4300640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4300643">//&nbsp;ReadDotBytes&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;the&nbsp;decoded&nbsp;data.</span><br>
<span class="lineno">400</span><span class="comment" id="4300710">//</span><br>
<span class="lineno"></span><span class="comment" id="4300713">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4300795">func</span>&nbsp;<span class="op" id="4300800">(</span><span class="ident" id="4300801">r</span>&nbsp;<span class="op" id="4300803">*</span><span class="ident" id="4300804">Reader</span><span class="op" id="4300810">)</span>&nbsp;<span class="ident" id="4300812">ReadDotBytes</span><span class="op" id="4300824">(</span><span class="op" id="4300825">)</span>&nbsp;<span class="op" id="4300827">(</span><span class="op" id="4300828">[</span><span class="op" id="4300829">]</span><span class="builtintype" id="4300830">byte</span><span class="op" id="4300834">,</span>&nbsp;<span class="builtintype" id="4300836">error</span><span class="op" id="4300841">)</span>&nbsp;<span class="op" id="4300843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4300846">return</span>&nbsp;<span class="ident" id="4300853">ioutil</span><span class="op" id="4300859">.</span><span class="ident" id="4300860">ReadAll</span><span class="op" id="4300867">(</span><span class="ident" id="4300868">r</span><span class="op" id="4300869">.</span><span class="ident" id="4300870">DotReader</span><span class="op" id="4300879">(</span><span class="op" id="4300880">)</span><span class="op" id="4300881">)</span><br>
<span class="lineno"></span><span class="op" id="4300883">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="4300886">//&nbsp;ReadDotLines&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="4300943">//&nbsp;containing&nbsp;the&nbsp;decoded&nbsp;lines,&nbsp;with&nbsp;the&nbsp;final&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;elided&nbsp;from&nbsp;each.</span><br>
<span class="lineno"></span><span class="comment" id="4301020">//</span><br>
<span class="lineno"></span><span class="comment" id="4301023">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno">410</span><span class="keyword" id="4301105">func</span>&nbsp;<span class="op" id="4301110">(</span><span class="ident" id="4301111">r</span>&nbsp;<span class="op" id="4301113">*</span><span class="ident" id="4301114">Reader</span><span class="op" id="4301120">)</span>&nbsp;<span class="ident" id="4301122">ReadDotLines</span><span class="op" id="4301134">(</span><span class="op" id="4301135">)</span>&nbsp;<span class="op" id="4301137">(</span><span class="op" id="4301138">[</span><span class="op" id="4301139">]</span><span class="builtintype" id="4301140">string</span><span class="op" id="4301146">,</span>&nbsp;<span class="builtintype" id="4301148">error</span><span class="op" id="4301153">)</span>&nbsp;<span class="op" id="4301155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4301158">//&nbsp;We&nbsp;could&nbsp;use&nbsp;ReadDotBytes&nbsp;and&nbsp;then&nbsp;Split&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4301207">//&nbsp;but&nbsp;reading&nbsp;a&nbsp;line&nbsp;at&nbsp;a&nbsp;time&nbsp;avoids&nbsp;needing&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4301257">//&nbsp;large&nbsp;contiguous&nbsp;block&nbsp;of&nbsp;memory&nbsp;and&nbsp;is&nbsp;simpler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4301310">var</span>&nbsp;<span class="ident" id="4301314">v</span>&nbsp;<span class="op" id="4301316">[</span><span class="op" id="4301317">]</span><span class="builtintype" id="4301318">string</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4301326">var</span>&nbsp;<span class="ident" id="4301330">err</span>&nbsp;<span class="builtintype" id="4301334">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4301341">for</span>&nbsp;<span class="op" id="4301345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4301349">var</span>&nbsp;<span class="ident" id="4301353">line</span>&nbsp;<span class="builtintype" id="4301358">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301367">line</span><span class="op" id="4301371">,</span>&nbsp;<span class="ident" id="4301373">err</span>&nbsp;<span class="op" id="4301377">=</span>&nbsp;<span class="ident" id="4301379">r</span><span class="op" id="4301380">.</span><span class="ident" id="4301381">ReadLine</span><span class="op" id="4301389">(</span><span class="op" id="4301390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4301394">if</span>&nbsp;<span class="ident" id="4301397">err</span>&nbsp;<span class="op" id="4301401">!=</span>&nbsp;<span class="builtintype" id="4301404">nil</span>&nbsp;<span class="op" id="4301408">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4301413">if</span>&nbsp;<span class="ident" id="4301416">err</span>&nbsp;<span class="op" id="4301420">==</span>&nbsp;<span class="ident" id="4301423">io</span><span class="op" id="4301425">.</span><span class="ident" id="4301426">EOF</span>&nbsp;<span class="op" id="4301430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301436">err</span>&nbsp;<span class="op" id="4301440">=</span>&nbsp;<span class="ident" id="4301442">io</span><span class="op" id="4301444">.</span><span class="ident" id="4301445">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4301465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4301470">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4301478">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4301483">//&nbsp;Dot&nbsp;by&nbsp;itself&nbsp;marks&nbsp;end;&nbsp;otherwise&nbsp;cut&nbsp;one&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4301536">if</span>&nbsp;<span class="builtinfunc" id="4301539">len</span><span class="op" id="4301542">(</span><span class="ident" id="4301543">line</span><span class="op" id="4301547">)</span>&nbsp;<span class="op" id="4301549">&gt;</span>&nbsp;<span class="num" id="4301551">0</span>&nbsp;<span class="op" id="4301553">&amp;&amp;</span>&nbsp;<span class="ident" id="4301556">line</span><span class="op" id="4301560">[</span><span class="num" id="4301561">0</span><span class="op" id="4301562">]</span>&nbsp;<span class="op" id="4301564">==</span>&nbsp;<span class="string" id="4301567">&#39;.&#39;</span>&nbsp;<span class="op" id="4301571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4301576">if</span>&nbsp;<span class="builtinfunc" id="4301579">len</span><span class="op" id="4301582">(</span><span class="ident" id="4301583">line</span><span class="op" id="4301587">)</span>&nbsp;<span class="op" id="4301589">==</span>&nbsp;<span class="num" id="4301592">1</span>&nbsp;<span class="op" id="4301594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4301600">break</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4301609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301614">line</span>&nbsp;<span class="op" id="4301619">=</span>&nbsp;<span class="ident" id="4301621">line</span><span class="op" id="4301625">[</span><span class="num" id="4301626">1</span><span class="op" id="4301627">:</span><span class="op" id="4301628">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4301632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4301636">v</span>&nbsp;<span class="op" id="4301638">=</span>&nbsp;<span class="builtinfunc" id="4301640">append</span><span class="op" id="4301646">(</span><span class="ident" id="4301647">v</span><span class="op" id="4301648">,</span>&nbsp;<span class="ident" id="4301650">line</span><span class="op" id="4301654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4301657">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4301660">return</span>&nbsp;<span class="ident" id="4301667">v</span><span class="op" id="4301668">,</span>&nbsp;<span class="ident" id="4301670">err</span><br>
<span class="lineno"></span><span class="op" id="4301674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4301677">//&nbsp;ReadMIMEHeader&nbsp;reads&nbsp;a&nbsp;MIME-style&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4301729">//&nbsp;The&nbsp;header&nbsp;is&nbsp;a&nbsp;sequence&nbsp;of&nbsp;possibly&nbsp;continued&nbsp;Key:&nbsp;Value&nbsp;lines</span><br>
<span class="lineno">440</span><span class="comment" id="4301796">//&nbsp;ending&nbsp;in&nbsp;a&nbsp;blank&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="4301823">//&nbsp;The&nbsp;returned&nbsp;map&nbsp;m&nbsp;maps&nbsp;CanonicalMIMEHeaderKey(key)&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4301883">//&nbsp;sequence&nbsp;of&nbsp;values&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;encountered&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="4301949">//</span><br>
<span class="lineno"></span><span class="comment" id="4301952">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">445</span><span class="comment" id="4301989">//</span><br>
<span class="lineno"></span><span class="comment" id="4301992">//&nbsp;&nbsp;&nbsp;&nbsp;My-Key:&nbsp;Value&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="4302011">//&nbsp;&nbsp;&nbsp;&nbsp;Long-Key:&nbsp;Even</span><br>
<span class="lineno"></span><span class="comment" id="4302029">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Longer&nbsp;Value</span><br>
<span class="lineno"></span><span class="comment" id="4302052">//&nbsp;&nbsp;&nbsp;&nbsp;My-Key:&nbsp;Value&nbsp;2</span><br>
<span class="lineno">450</span><span class="comment" id="4302071">//</span><br>
<span class="lineno"></span><span class="comment" id="4302074">//&nbsp;Given&nbsp;that&nbsp;input,&nbsp;ReadMIMEHeader&nbsp;returns&nbsp;the&nbsp;map:</span><br>
<span class="lineno"></span><span class="comment" id="4302127">//</span><br>
<span class="lineno"></span><span class="comment" id="4302130">//&nbsp;&nbsp;&nbsp;&nbsp;map[string][]string{</span><br>
<span class="lineno"></span><span class="comment" id="4302154">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;My-Key&#34;:&nbsp;{&#34;Value&nbsp;1&#34;,&nbsp;&#34;Value&nbsp;2&#34;},</span><br>
<span class="lineno">455</span><span class="comment" id="4302192">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;Long-Key&#34;:&nbsp;{&#34;Even&nbsp;Longer&nbsp;Value&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="4302231">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="4302236">//</span><br>
<span class="lineno"></span><span class="keyword" id="4302239">func</span>&nbsp;<span class="op" id="4302244">(</span><span class="ident" id="4302245">r</span>&nbsp;<span class="op" id="4302247">*</span><span class="ident" id="4302248">Reader</span><span class="op" id="4302254">)</span>&nbsp;<span class="ident" id="4302256">ReadMIMEHeader</span><span class="op" id="4302270">(</span><span class="op" id="4302271">)</span>&nbsp;<span class="op" id="4302273">(</span><span class="ident" id="4302274">MIMEHeader</span><span class="op" id="4302284">,</span>&nbsp;<span class="builtintype" id="4302286">error</span><span class="op" id="4302291">)</span>&nbsp;<span class="op" id="4302293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4302296">//&nbsp;Avoid&nbsp;lots&nbsp;of&nbsp;small&nbsp;slice&nbsp;allocations&nbsp;later&nbsp;by&nbsp;allocating&nbsp;one</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4302362">//&nbsp;large&nbsp;one&nbsp;ahead&nbsp;of&nbsp;time&nbsp;which&nbsp;we&#39;ll&nbsp;cut&nbsp;up&nbsp;into&nbsp;smaller</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4302422">//&nbsp;slices.&nbsp;If&nbsp;this&nbsp;isn&#39;t&nbsp;big&nbsp;enough&nbsp;later,&nbsp;we&nbsp;allocate&nbsp;small&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4302490">var</span>&nbsp;<span class="ident" id="4302494">strs</span>&nbsp;<span class="op" id="4302499">[</span><span class="op" id="4302500">]</span><span class="builtintype" id="4302501">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4302509">hint</span>&nbsp;<span class="op" id="4302514">:=</span>&nbsp;<span class="ident" id="4302517">r</span><span class="op" id="4302518">.</span><span class="ident" id="4302519">upcomingHeaderNewlines</span><span class="op" id="4302541">(</span><span class="op" id="4302542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4302545">if</span>&nbsp;<span class="ident" id="4302548">hint</span>&nbsp;<span class="op" id="4302553">&gt;</span>&nbsp;<span class="num" id="4302555">0</span>&nbsp;<span class="op" id="4302557">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4302561">strs</span>&nbsp;<span class="op" id="4302566">=</span>&nbsp;<span class="builtinfunc" id="4302568">make</span><span class="op" id="4302572">(</span><span class="op" id="4302573">[</span><span class="op" id="4302574">]</span><span class="builtintype" id="4302575">string</span><span class="op" id="4302581">,</span>&nbsp;<span class="ident" id="4302583">hint</span><span class="op" id="4302587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4302590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4302594">m</span>&nbsp;<span class="op" id="4302596">:=</span>&nbsp;<span class="builtinfunc" id="4302599">make</span><span class="op" id="4302603">(</span><span class="ident" id="4302604">MIMEHeader</span><span class="op" id="4302614">,</span>&nbsp;<span class="ident" id="4302616">hint</span><span class="op" id="4302620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4302623">for</span>&nbsp;<span class="op" id="4302627">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4302631">kv</span><span class="op" id="4302633">,</span>&nbsp;<span class="ident" id="4302635">err</span>&nbsp;<span class="op" id="4302639">:=</span>&nbsp;<span class="ident" id="4302642">r</span><span class="op" id="4302643">.</span><span class="ident" id="4302644">readContinuedLineSlice</span><span class="op" id="4302666">(</span><span class="op" id="4302667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4302671">if</span>&nbsp;<span class="builtinfunc" id="4302674">len</span><span class="op" id="4302677">(</span><span class="ident" id="4302678">kv</span><span class="op" id="4302680">)</span>&nbsp;<span class="op" id="4302682">==</span>&nbsp;<span class="num" id="4302685">0</span>&nbsp;<span class="op" id="4302687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4302692">return</span>&nbsp;<span class="ident" id="4302699">m</span><span class="op" id="4302700">,</span>&nbsp;<span class="ident" id="4302702">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4302708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4302713">//&nbsp;Key&nbsp;ends&nbsp;at&nbsp;first&nbsp;colon;&nbsp;should&nbsp;not&nbsp;have&nbsp;spaces&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4302770">//&nbsp;they&nbsp;appear&nbsp;in&nbsp;the&nbsp;wild,&nbsp;violating&nbsp;specs,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4302823">//&nbsp;remove&nbsp;them&nbsp;if&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4302852">i</span>&nbsp;<span class="op" id="4302854">:=</span>&nbsp;<span class="ident" id="4302857">bytes</span><span class="op" id="4302862">.</span><span class="ident" id="4302863">IndexByte</span><span class="op" id="4302872">(</span><span class="ident" id="4302873">kv</span><span class="op" id="4302875">,</span>&nbsp;<span class="string" id="4302877">&#39;:&#39;</span><span class="op" id="4302880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4302884">if</span>&nbsp;<span class="ident" id="4302887">i</span>&nbsp;<span class="op" id="4302889">&lt;</span>&nbsp;<span class="num" id="4302891">0</span>&nbsp;<span class="op" id="4302893">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4302898">return</span>&nbsp;<span class="ident" id="4302905">m</span><span class="op" id="4302906">,</span>&nbsp;<span class="ident" id="4302908">ProtocolError</span><span class="op" id="4302921">(</span><span class="string" id="4302922">&#34;malformed&nbsp;MIME&nbsp;header&nbsp;line:&nbsp;&#34;</span>&nbsp;<span class="op" id="4302953">+</span>&nbsp;<span class="builtintype" id="4302955">string</span><span class="op" id="4302961">(</span><span class="ident" id="4302962">kv</span><span class="op" id="4302964">)</span><span class="op" id="4302965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4302969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4302973">endKey</span>&nbsp;<span class="op" id="4302980">:=</span>&nbsp;<span class="ident" id="4302983">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4302987">for</span>&nbsp;<span class="ident" id="4302991">endKey</span>&nbsp;<span class="op" id="4302998">&gt;</span>&nbsp;<span class="num" id="4303000">0</span>&nbsp;<span class="op" id="4303002">&amp;&amp;</span>&nbsp;<span class="ident" id="4303005">kv</span><span class="op" id="4303007">[</span><span class="ident" id="4303008">endKey</span><span class="op" id="4303014">-</span><span class="num" id="4303015">1</span><span class="op" id="4303016">]</span>&nbsp;<span class="op" id="4303018">==</span>&nbsp;<span class="string" id="4303021">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4303025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303030">endKey</span><span class="op" id="4303036">--</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4303041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303045">key</span>&nbsp;<span class="op" id="4303049">:=</span>&nbsp;<span class="ident" id="4303052">canonicalMIMEHeaderKey</span><span class="op" id="4303074">(</span><span class="ident" id="4303075">kv</span><span class="op" id="4303077">[</span><span class="op" id="4303078">:</span><span class="ident" id="4303079">endKey</span><span class="op" id="4303085">]</span><span class="op" id="4303086">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4303091">//&nbsp;Skip&nbsp;initial&nbsp;spaces&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303126">i</span><span class="op" id="4303127">++</span>&nbsp;<span class="comment" id="4303130">//&nbsp;skip&nbsp;colon</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4303146">for</span>&nbsp;<span class="ident" id="4303150">i</span>&nbsp;<span class="op" id="4303152">&lt;</span>&nbsp;<span class="builtinfunc" id="4303154">len</span><span class="op" id="4303157">(</span><span class="ident" id="4303158">kv</span><span class="op" id="4303160">)</span>&nbsp;<span class="op" id="4303162">&amp;&amp;</span>&nbsp;<span class="op" id="4303165">(</span><span class="ident" id="4303166">kv</span><span class="op" id="4303168">[</span><span class="ident" id="4303169">i</span><span class="op" id="4303170">]</span>&nbsp;<span class="op" id="4303172">==</span>&nbsp;<span class="string" id="4303175">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4303179">||</span>&nbsp;<span class="ident" id="4303182">kv</span><span class="op" id="4303184">[</span><span class="ident" id="4303185">i</span><span class="op" id="4303186">]</span>&nbsp;<span class="op" id="4303188">==</span>&nbsp;<span class="string" id="4303191">&#39;\t&#39;</span><span class="op" id="4303195">)</span>&nbsp;<span class="op" id="4303197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303202">i</span><span class="op" id="4303203">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4303208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303212">value</span>&nbsp;<span class="op" id="4303218">:=</span>&nbsp;<span class="builtintype" id="4303221">string</span><span class="op" id="4303227">(</span><span class="ident" id="4303228">kv</span><span class="op" id="4303230">[</span><span class="ident" id="4303231">i</span><span class="op" id="4303232">:</span><span class="op" id="4303233">]</span><span class="op" id="4303234">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303239">vv</span>&nbsp;<span class="op" id="4303242">:=</span>&nbsp;<span class="ident" id="4303245">m</span><span class="op" id="4303246">[</span><span class="ident" id="4303247">key</span><span class="op" id="4303250">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4303254">if</span>&nbsp;<span class="ident" id="4303257">vv</span>&nbsp;<span class="op" id="4303260">==</span>&nbsp;<span class="builtintype" id="4303263">nil</span>&nbsp;<span class="op" id="4303267">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4303270">len</span><span class="op" id="4303273">(</span><span class="ident" id="4303274">strs</span><span class="op" id="4303278">)</span>&nbsp;<span class="op" id="4303280">&gt;</span>&nbsp;<span class="num" id="4303282">0</span>&nbsp;<span class="op" id="4303284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4303289">//&nbsp;More&nbsp;than&nbsp;likely&nbsp;this&nbsp;will&nbsp;be&nbsp;a&nbsp;single-element&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4303347">//&nbsp;Most&nbsp;headers&nbsp;aren&#39;t&nbsp;multi-valued.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4303387">//&nbsp;Set&nbsp;the&nbsp;capacity&nbsp;on&nbsp;strs[0]&nbsp;to&nbsp;1,&nbsp;so&nbsp;any&nbsp;future&nbsp;append</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4303448">//&nbsp;won&#39;t&nbsp;extend&nbsp;the&nbsp;slice&nbsp;into&nbsp;the&nbsp;other&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303501">vv</span><span class="op" id="4303503">,</span>&nbsp;<span class="ident" id="4303505">strs</span>&nbsp;<span class="op" id="4303510">=</span>&nbsp;<span class="ident" id="4303512">strs</span><span class="op" id="4303516">[</span><span class="op" id="4303517">:</span><span class="num" id="4303518">1</span><span class="op" id="4303519">:</span><span class="num" id="4303520">1</span><span class="op" id="4303521">]</span><span class="op" id="4303522">,</span>&nbsp;<span class="ident" id="4303524">strs</span><span class="op" id="4303528">[</span><span class="num" id="4303529">1</span><span class="op" id="4303530">:</span><span class="op" id="4303531">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303536">vv</span><span class="op" id="4303538">[</span><span class="num" id="4303539">0</span><span class="op" id="4303540">]</span>&nbsp;<span class="op" id="4303542">=</span>&nbsp;<span class="ident" id="4303544">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303553">m</span><span class="op" id="4303554">[</span><span class="ident" id="4303555">key</span><span class="op" id="4303558">]</span>&nbsp;<span class="op" id="4303560">=</span>&nbsp;<span class="ident" id="4303562">vv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4303567">}</span>&nbsp;<span class="keyword" id="4303569">else</span>&nbsp;<span class="op" id="4303574">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303579">m</span><span class="op" id="4303580">[</span><span class="ident" id="4303581">key</span><span class="op" id="4303584">]</span>&nbsp;<span class="op" id="4303586">=</span>&nbsp;<span class="builtinfunc" id="4303588">append</span><span class="op" id="4303594">(</span><span class="ident" id="4303595">vv</span><span class="op" id="4303597">,</span>&nbsp;<span class="ident" id="4303599">value</span><span class="op" id="4303604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4303608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4303613">if</span>&nbsp;<span class="ident" id="4303616">err</span>&nbsp;<span class="op" id="4303620">!=</span>&nbsp;<span class="builtintype" id="4303623">nil</span>&nbsp;<span class="op" id="4303627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4303632">return</span>&nbsp;<span class="ident" id="4303639">m</span><span class="op" id="4303640">,</span>&nbsp;<span class="ident" id="4303642">err</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4303648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4303651">}</span><br>
<span class="lineno"></span><span class="op" id="4303653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4303656">//&nbsp;upcomingHeaderNewlines&nbsp;returns&nbsp;an&nbsp;approximation&nbsp;of&nbsp;the&nbsp;number&nbsp;of&nbsp;newlines</span><br>
<span class="lineno">515</span><span class="comment" id="4303733">//&nbsp;that&nbsp;will&nbsp;be&nbsp;in&nbsp;this&nbsp;header.&nbsp;If&nbsp;it&nbsp;gets&nbsp;confused,&nbsp;it&nbsp;returns&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4303800">func</span>&nbsp;<span class="op" id="4303805">(</span><span class="ident" id="4303806">r</span>&nbsp;<span class="op" id="4303808">*</span><span class="ident" id="4303809">Reader</span><span class="op" id="4303815">)</span>&nbsp;<span class="ident" id="4303817">upcomingHeaderNewlines</span><span class="op" id="4303839">(</span><span class="op" id="4303840">)</span>&nbsp;<span class="op" id="4303842">(</span><span class="ident" id="4303843">n</span>&nbsp;<span class="builtintype" id="4303845">int</span><span class="op" id="4303848">)</span>&nbsp;<span class="op" id="4303850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4303853">//&nbsp;Try&nbsp;to&nbsp;determine&nbsp;the&nbsp;&#39;hint&#39;&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303891">r</span><span class="op" id="4303892">.</span><span class="ident" id="4303893">R</span><span class="op" id="4303894">.</span><span class="ident" id="4303895">Peek</span><span class="op" id="4303899">(</span><span class="num" id="4303900">1</span><span class="op" id="4303901">)</span>&nbsp;<span class="comment" id="4303903">//&nbsp;force&nbsp;a&nbsp;buffer&nbsp;load&nbsp;if&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303936">s</span>&nbsp;<span class="op" id="4303938">:=</span>&nbsp;<span class="ident" id="4303941">r</span><span class="op" id="4303942">.</span><span class="ident" id="4303943">R</span><span class="op" id="4303944">.</span><span class="ident" id="4303945">Buffered</span><span class="op" id="4303953">(</span><span class="op" id="4303954">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4303957">if</span>&nbsp;<span class="ident" id="4303960">s</span>&nbsp;<span class="op" id="4303962">==</span>&nbsp;<span class="num" id="4303965">0</span>&nbsp;<span class="op" id="4303967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4303971">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4303979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4303982">peek</span><span class="op" id="4303986">,</span>&nbsp;<span class="ident" id="4303988">_</span>&nbsp;<span class="op" id="4303990">:=</span>&nbsp;<span class="ident" id="4303993">r</span><span class="op" id="4303994">.</span><span class="ident" id="4303995">R</span><span class="op" id="4303996">.</span><span class="ident" id="4303997">Peek</span><span class="op" id="4304001">(</span><span class="ident" id="4304002">s</span><span class="op" id="4304003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4304006">for</span>&nbsp;<span class="builtinfunc" id="4304010">len</span><span class="op" id="4304013">(</span><span class="ident" id="4304014">peek</span><span class="op" id="4304018">)</span>&nbsp;<span class="op" id="4304020">&gt;</span>&nbsp;<span class="num" id="4304022">0</span>&nbsp;<span class="op" id="4304024">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4304028">i</span>&nbsp;<span class="op" id="4304030">:=</span>&nbsp;<span class="ident" id="4304033">bytes</span><span class="op" id="4304038">.</span><span class="ident" id="4304039">IndexByte</span><span class="op" id="4304048">(</span><span class="ident" id="4304049">peek</span><span class="op" id="4304053">,</span>&nbsp;<span class="string" id="4304055">&#39;\n&#39;</span><span class="op" id="4304059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4304063">if</span>&nbsp;<span class="ident" id="4304066">i</span>&nbsp;<span class="op" id="4304068">&lt;</span>&nbsp;<span class="num" id="4304070">3</span>&nbsp;<span class="op" id="4304072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4304077">//&nbsp;Not&nbsp;present&nbsp;(-1)&nbsp;or&nbsp;found&nbsp;within&nbsp;the&nbsp;next&nbsp;few&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4304136">//&nbsp;implying&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;(&#34;\r\n\r\n&#34;&nbsp;or&nbsp;&#34;\n\n&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4304191">return</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4304200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4304204">n</span><span class="op" id="4304205">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4304210">peek</span>&nbsp;<span class="op" id="4304215">=</span>&nbsp;<span class="ident" id="4304217">peek</span><span class="op" id="4304221">[</span><span class="ident" id="4304222">i</span><span class="op" id="4304223">+</span><span class="num" id="4304224">1</span><span class="op" id="4304225">:</span><span class="op" id="4304226">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4304229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4304232">return</span><br>
<span class="lineno">535</span><span class="op" id="4304239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4304242">//&nbsp;CanonicalMIMEHeaderKey&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;format&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4304304">//&nbsp;MIME&nbsp;header&nbsp;key&nbsp;s.&nbsp;&nbsp;The&nbsp;canonicalization&nbsp;converts&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="4304367">//&nbsp;letter&nbsp;and&nbsp;any&nbsp;letter&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;to&nbsp;upper&nbsp;case;</span><br>
<span class="lineno">540</span><span class="comment" id="4304426">//&nbsp;the&nbsp;rest&nbsp;are&nbsp;converted&nbsp;to&nbsp;lowercase.&nbsp;&nbsp;For&nbsp;example,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4304484">//&nbsp;canonical&nbsp;key&nbsp;for&nbsp;&#34;accept-encoding&#34;&nbsp;is&nbsp;&#34;Accept-Encoding&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4304545">//&nbsp;MIME&nbsp;header&nbsp;keys&nbsp;are&nbsp;assumed&nbsp;to&nbsp;be&nbsp;ASCII&nbsp;only.</span><br>
<span class="lineno"></span><span class="keyword" id="4304595">func</span>&nbsp;<span class="ident" id="4304600">CanonicalMIMEHeaderKey</span><span class="op" id="4304622">(</span><span class="ident" id="4304623">s</span>&nbsp;<span class="builtintype" id="4304625">string</span><span class="op" id="4304631">)</span>&nbsp;<span class="builtintype" id="4304633">string</span>&nbsp;<span class="op" id="4304640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4304643">//&nbsp;Quick&nbsp;check&nbsp;for&nbsp;canonical&nbsp;encoding.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4304683">upper</span>&nbsp;<span class="op" id="4304689">:=</span>&nbsp;<span class="builtintype" id="4304692">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4304698">for</span>&nbsp;<span class="ident" id="4304702">i</span>&nbsp;<span class="op" id="4304704">:=</span>&nbsp;<span class="num" id="4304707">0</span><span class="op" id="4304708">;</span>&nbsp;<span class="ident" id="4304710">i</span>&nbsp;<span class="op" id="4304712">&lt;</span>&nbsp;<span class="builtinfunc" id="4304714">len</span><span class="op" id="4304717">(</span><span class="ident" id="4304718">s</span><span class="op" id="4304719">)</span><span class="op" id="4304720">;</span>&nbsp;<span class="ident" id="4304722">i</span><span class="op" id="4304723">++</span>&nbsp;<span class="op" id="4304726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4304730">c</span>&nbsp;<span class="op" id="4304732">:=</span>&nbsp;<span class="ident" id="4304735">s</span><span class="op" id="4304736">[</span><span class="ident" id="4304737">i</span><span class="op" id="4304738">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4304742">if</span>&nbsp;<span class="ident" id="4304745">upper</span>&nbsp;<span class="op" id="4304751">&amp;&amp;</span>&nbsp;<span class="string" id="4304754">&#39;a&#39;</span>&nbsp;<span class="op" id="4304758">&lt;=</span>&nbsp;<span class="ident" id="4304761">c</span>&nbsp;<span class="op" id="4304763">&amp;&amp;</span>&nbsp;<span class="ident" id="4304766">c</span>&nbsp;<span class="op" id="4304768">&lt;=</span>&nbsp;<span class="string" id="4304771">&#39;z&#39;</span>&nbsp;<span class="op" id="4304775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4304780">return</span>&nbsp;<span class="ident" id="4304787">canonicalMIMEHeaderKey</span><span class="op" id="4304809">(</span><span class="op" id="4304810">[</span><span class="op" id="4304811">]</span><span class="builtintype" id="4304812">byte</span><span class="op" id="4304816">(</span><span class="ident" id="4304817">s</span><span class="op" id="4304818">)</span><span class="op" id="4304819">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4304823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4304827">if</span>&nbsp;<span class="op" id="4304830">!</span><span class="ident" id="4304831">upper</span>&nbsp;<span class="op" id="4304837">&amp;&amp;</span>&nbsp;<span class="string" id="4304840">&#39;A&#39;</span>&nbsp;<span class="op" id="4304844">&lt;=</span>&nbsp;<span class="ident" id="4304847">c</span>&nbsp;<span class="op" id="4304849">&amp;&amp;</span>&nbsp;<span class="ident" id="4304852">c</span>&nbsp;<span class="op" id="4304854">&lt;=</span>&nbsp;<span class="string" id="4304857">&#39;Z&#39;</span>&nbsp;<span class="op" id="4304861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4304866">return</span>&nbsp;<span class="ident" id="4304873">canonicalMIMEHeaderKey</span><span class="op" id="4304895">(</span><span class="op" id="4304896">[</span><span class="op" id="4304897">]</span><span class="builtintype" id="4304898">byte</span><span class="op" id="4304902">(</span><span class="ident" id="4304903">s</span><span class="op" id="4304904">)</span><span class="op" id="4304905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4304909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4304913">upper</span>&nbsp;<span class="op" id="4304919">=</span>&nbsp;<span class="ident" id="4304921">c</span>&nbsp;<span class="op" id="4304923">==</span>&nbsp;<span class="string" id="4304926">&#39;-&#39;</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4304931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4304934">return</span>&nbsp;<span class="ident" id="4304941">s</span><br>
<span class="lineno"></span><span class="op" id="4304943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4304946">const</span>&nbsp;<span class="ident" id="4304952">toLower</span>&nbsp;<span class="op" id="4304960">=</span>&nbsp;<span class="string" id="4304962">&#39;a&#39;</span>&nbsp;<span class="op" id="4304966">-</span>&nbsp;<span class="string" id="4304968">&#39;A&#39;</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span><span class="comment" id="4304973">//&nbsp;canonicalMIMEHeaderKey&nbsp;is&nbsp;like&nbsp;CanonicalMIMEHeaderKey&nbsp;but&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4305037">//&nbsp;allowed&nbsp;to&nbsp;mutate&nbsp;the&nbsp;provided&nbsp;byte&nbsp;slice&nbsp;before&nbsp;returning&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4305103">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4305114">func</span>&nbsp;<span class="ident" id="4305119">canonicalMIMEHeaderKey</span><span class="op" id="4305141">(</span><span class="ident" id="4305142">a</span>&nbsp;<span class="op" id="4305144">[</span><span class="op" id="4305145">]</span><span class="builtintype" id="4305146">byte</span><span class="op" id="4305150">)</span>&nbsp;<span class="builtintype" id="4305152">string</span>&nbsp;<span class="op" id="4305159">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305162">upper</span>&nbsp;<span class="op" id="4305168">:=</span>&nbsp;<span class="builtintype" id="4305171">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4305177">for</span>&nbsp;<span class="ident" id="4305181">i</span><span class="op" id="4305182">,</span>&nbsp;<span class="ident" id="4305184">c</span>&nbsp;<span class="op" id="4305186">:=</span>&nbsp;<span class="keyword" id="4305189">range</span>&nbsp;<span class="ident" id="4305195">a</span>&nbsp;<span class="op" id="4305197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4305201">//&nbsp;Canonicalize:&nbsp;first&nbsp;letter&nbsp;upper&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4305244">//&nbsp;and&nbsp;upper&nbsp;case&nbsp;after&nbsp;each&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4305281">//&nbsp;(Host,&nbsp;User-Agent,&nbsp;If-Modified-Since).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4305325">//&nbsp;MIME&nbsp;headers&nbsp;are&nbsp;ASCII&nbsp;only,&nbsp;so&nbsp;no&nbsp;Unicode&nbsp;issues.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4305381">if</span>&nbsp;<span class="ident" id="4305384">c</span>&nbsp;<span class="op" id="4305386">==</span>&nbsp;<span class="string" id="4305389">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4305393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305398">c</span>&nbsp;<span class="op" id="4305400">=</span>&nbsp;<span class="string" id="4305402">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4305408">}</span>&nbsp;<span class="keyword" id="4305410">else</span>&nbsp;<span class="keyword" id="4305415">if</span>&nbsp;<span class="ident" id="4305418">upper</span>&nbsp;<span class="op" id="4305424">&amp;&amp;</span>&nbsp;<span class="string" id="4305427">&#39;a&#39;</span>&nbsp;<span class="op" id="4305431">&lt;=</span>&nbsp;<span class="ident" id="4305434">c</span>&nbsp;<span class="op" id="4305436">&amp;&amp;</span>&nbsp;<span class="ident" id="4305439">c</span>&nbsp;<span class="op" id="4305441">&lt;=</span>&nbsp;<span class="string" id="4305444">&#39;z&#39;</span>&nbsp;<span class="op" id="4305448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305453">c</span>&nbsp;<span class="op" id="4305455">-=</span>&nbsp;<span class="ident" id="4305458">toLower</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4305468">}</span>&nbsp;<span class="keyword" id="4305470">else</span>&nbsp;<span class="keyword" id="4305475">if</span>&nbsp;<span class="op" id="4305478">!</span><span class="ident" id="4305479">upper</span>&nbsp;<span class="op" id="4305485">&amp;&amp;</span>&nbsp;<span class="string" id="4305488">&#39;A&#39;</span>&nbsp;<span class="op" id="4305492">&lt;=</span>&nbsp;<span class="ident" id="4305495">c</span>&nbsp;<span class="op" id="4305497">&amp;&amp;</span>&nbsp;<span class="ident" id="4305500">c</span>&nbsp;<span class="op" id="4305502">&lt;=</span>&nbsp;<span class="string" id="4305505">&#39;Z&#39;</span>&nbsp;<span class="op" id="4305509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305514">c</span>&nbsp;<span class="op" id="4305516">+=</span>&nbsp;<span class="ident" id="4305519">toLower</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4305529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305533">a</span><span class="op" id="4305534">[</span><span class="ident" id="4305535">i</span><span class="op" id="4305536">]</span>&nbsp;<span class="op" id="4305538">=</span>&nbsp;<span class="ident" id="4305540">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4305544">upper</span>&nbsp;<span class="op" id="4305550">=</span>&nbsp;<span class="ident" id="4305552">c</span>&nbsp;<span class="op" id="4305554">==</span>&nbsp;<span class="string" id="4305557">&#39;-&#39;</span>&nbsp;<span class="comment" id="4305561">//&nbsp;for&nbsp;next&nbsp;time</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4305579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4305582">//&nbsp;The&nbsp;compiler&nbsp;recognizes&nbsp;m[string(byteSlice)]&nbsp;as&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4305644">//&nbsp;case,&nbsp;so&nbsp;a&nbsp;copy&nbsp;of&nbsp;a&#39;s&nbsp;bytes&nbsp;into&nbsp;a&nbsp;new&nbsp;string&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4305704">//&nbsp;happen&nbsp;in&nbsp;this&nbsp;map&nbsp;lookup:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4305735">if</span>&nbsp;<span class="ident" id="4305738">v</span>&nbsp;<span class="op" id="4305740">:=</span>&nbsp;<span class="ident" id="4305743">commonHeader</span><span class="op" id="4305755">[</span><span class="builtintype" id="4305756">string</span><span class="op" id="4305762">(</span><span class="ident" id="4305763">a</span><span class="op" id="4305764">)</span><span class="op" id="4305765">]</span><span class="op" id="4305766">;</span>&nbsp;<span class="ident" id="4305768">v</span>&nbsp;<span class="op" id="4305770">!=</span>&nbsp;<span class="string" id="4305773">&#34;&#34;</span>&nbsp;<span class="op" id="4305776">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4305780">return</span>&nbsp;<span class="ident" id="4305787">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4305790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4305793">return</span>&nbsp;<span class="builtintype" id="4305800">string</span><span class="op" id="4305806">(</span><span class="ident" id="4305807">a</span><span class="op" id="4305808">)</span><br>
<span class="lineno"></span><span class="op" id="4305810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="4305813">//&nbsp;commonHeader&nbsp;interns&nbsp;common&nbsp;header&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="4305860">var</span>&nbsp;<span class="ident" id="4305864">commonHeader</span>&nbsp;<span class="op" id="4305877">=</span>&nbsp;<span class="builtinfunc" id="4305879">make</span><span class="op" id="4305883">(</span><span class="keyword" id="4305884">map</span><span class="op" id="4305887">[</span><span class="builtintype" id="4305888">string</span><span class="op" id="4305894">]</span><span class="builtintype" id="4305895">string</span><span class="op" id="4305901">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4305904">func</span>&nbsp;<span class="ident" id="4305909">init</span><span class="op" id="4305913">(</span><span class="op" id="4305914">)</span>&nbsp;<span class="op" id="4305916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4305919">for</span>&nbsp;<span class="ident" id="4305923">_</span><span class="op" id="4305924">,</span>&nbsp;<span class="ident" id="4305926">v</span>&nbsp;<span class="op" id="4305928">:=</span>&nbsp;<span class="keyword" id="4305931">range</span>&nbsp;<span class="op" id="4305937">[</span><span class="op" id="4305938">]</span><span class="builtintype" id="4305939">string</span><span class="op" id="4305945">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4305949">&#34;Accept&#34;</span><span class="op" id="4305957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4305961">&#34;Accept-Charset&#34;</span><span class="op" id="4305977">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4305981">&#34;Accept-Encoding&#34;</span><span class="op" id="4305998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306002">&#34;Accept-Language&#34;</span><span class="op" id="4306019">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306023">&#34;Accept-Ranges&#34;</span><span class="op" id="4306038">,</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306042">&#34;Cache-Control&#34;</span><span class="op" id="4306057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306061">&#34;Cc&#34;</span><span class="op" id="4306065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306069">&#34;Connection&#34;</span><span class="op" id="4306081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306085">&#34;Content-Id&#34;</span><span class="op" id="4306097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306101">&#34;Content-Language&#34;</span><span class="op" id="4306119">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306123">&#34;Content-Length&#34;</span><span class="op" id="4306139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306143">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="4306170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306174">&#34;Content-Type&#34;</span><span class="op" id="4306188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306192">&#34;Cookie&#34;</span><span class="op" id="4306200">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306204">&#34;Date&#34;</span><span class="op" id="4306210">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306214">&#34;Dkim-Signature&#34;</span><span class="op" id="4306230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306234">&#34;Etag&#34;</span><span class="op" id="4306240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306244">&#34;Expires&#34;</span><span class="op" id="4306253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306257">&#34;From&#34;</span><span class="op" id="4306263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306267">&#34;Host&#34;</span><span class="op" id="4306273">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306277">&#34;If-Modified-Since&#34;</span><span class="op" id="4306296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306300">&#34;If-None-Match&#34;</span><span class="op" id="4306315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306319">&#34;In-Reply-To&#34;</span><span class="op" id="4306332">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306336">&#34;Last-Modified&#34;</span><span class="op" id="4306351">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306355">&#34;Location&#34;</span><span class="op" id="4306365">,</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306369">&#34;Message-Id&#34;</span><span class="op" id="4306381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306385">&#34;Mime-Version&#34;</span><span class="op" id="4306399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306403">&#34;Pragma&#34;</span><span class="op" id="4306411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306415">&#34;Received&#34;</span><span class="op" id="4306425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306429">&#34;Return-Path&#34;</span><span class="op" id="4306442">,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306446">&#34;Server&#34;</span><span class="op" id="4306454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306458">&#34;Set-Cookie&#34;</span><span class="op" id="4306470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306474">&#34;Subject&#34;</span><span class="op" id="4306483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306487">&#34;To&#34;</span><span class="op" id="4306491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306495">&#34;User-Agent&#34;</span><span class="op" id="4306507">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306511">&#34;Via&#34;</span><span class="op" id="4306516">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306520">&#34;X-Forwarded-For&#34;</span><span class="op" id="4306537">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306541">&#34;X-Imforwards&#34;</span><span class="op" id="4306555">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4306559">&#34;X-Powered-By&#34;</span><span class="op" id="4306573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4306576">}</span>&nbsp;<span class="op" id="4306578">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4306582">commonHeader</span><span class="op" id="4306594">[</span><span class="ident" id="4306595">v</span><span class="op" id="4306596">]</span>&nbsp;<span class="op" id="4306598">=</span>&nbsp;<span class="ident" id="4306600">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4306603">}</span><br>
<span class="lineno"></span><span class="op" id="4306605">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
