<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7715789">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7715844">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7715898">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7715949">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;simple&nbsp;printer&nbsp;performance&nbsp;benchmark:</span><br>
<span class="lineno"></span><span class="comment" id="7716013">//&nbsp;go&nbsp;test&nbsp;-bench=BenchmarkPrint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7716047">package</span>&nbsp;<span class="ident" id="7716055">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="7716064">import</span>&nbsp;<span class="op" id="7716071">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7716074">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7716083">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7716093">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7716106">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7716112">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7716125">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7716132">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7716142">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7716145">var</span>&nbsp;<span class="ident" id="7716149">testfile</span>&nbsp;<span class="op" id="7716158">*</span><span class="ident" id="7716159">ast</span><span class="op" id="7716162">.</span><span class="ident" id="7716163">File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7716169">func</span>&nbsp;<span class="ident" id="7716174">testprint</span><span class="op" id="7716183">(</span><span class="ident" id="7716184">out</span>&nbsp;<span class="ident" id="7716188">io</span><span class="op" id="7716190">.</span><span class="ident" id="7716191">Writer</span><span class="op" id="7716197">,</span>&nbsp;<span class="ident" id="7716199">file</span>&nbsp;<span class="op" id="7716204">*</span><span class="ident" id="7716205">ast</span><span class="op" id="7716208">.</span><span class="ident" id="7716209">File</span><span class="op" id="7716213">)</span>&nbsp;<span class="op" id="7716215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7716218">if</span>&nbsp;<span class="ident" id="7716221">err</span>&nbsp;<span class="op" id="7716225">:=</span>&nbsp;<span class="op" id="7716228">(</span><span class="op" id="7716229">&amp;</span><span class="ident" id="7716230">Config</span><span class="op" id="7716236">{</span><span class="ident" id="7716237">TabIndent</span>&nbsp;<span class="op" id="7716247">|</span>&nbsp;<span class="ident" id="7716249">UseSpaces</span><span class="op" id="7716258">,</span>&nbsp;<span class="num" id="7716260">8</span><span class="op" id="7716261">,</span>&nbsp;<span class="num" id="7716263">0</span><span class="op" id="7716264">}</span><span class="op" id="7716265">)</span><span class="op" id="7716266">.</span><span class="ident" id="7716267">Fprint</span><span class="op" id="7716273">(</span><span class="ident" id="7716274">out</span><span class="op" id="7716277">,</span>&nbsp;<span class="ident" id="7716279">fset</span><span class="op" id="7716283">,</span>&nbsp;<span class="ident" id="7716285">file</span><span class="op" id="7716289">)</span><span class="op" id="7716290">;</span>&nbsp;<span class="ident" id="7716292">err</span>&nbsp;<span class="op" id="7716296">!=</span>&nbsp;<span class="ident" id="7716299">nil</span>&nbsp;<span class="op" id="7716303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716307">log</span><span class="op" id="7716310">.</span><span class="ident" id="7716311">Fatalf</span><span class="op" id="7716317">(</span><span class="string" id="7716318">&#34;print&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7716335">,</span>&nbsp;<span class="ident" id="7716337">err</span><span class="op" id="7716340">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7716343">}</span><br>
<span class="lineno"></span><span class="op" id="7716345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7716348">//&nbsp;cannot&nbsp;initialize&nbsp;in&nbsp;init&nbsp;because&nbsp;(printer)&nbsp;Fprint&nbsp;launches&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="7716423">func</span>&nbsp;<span class="ident" id="7716428">initialize</span><span class="op" id="7716438">(</span><span class="op" id="7716439">)</span>&nbsp;<span class="op" id="7716441">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7716444">const</span>&nbsp;<span class="ident" id="7716450">filename</span>&nbsp;<span class="op" id="7716459">=</span>&nbsp;<span class="string" id="7716461">&#34;testdata/parser.go&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716484">src</span><span class="op" id="7716487">,</span>&nbsp;<span class="ident" id="7716489">err</span>&nbsp;<span class="op" id="7716493">:=</span>&nbsp;<span class="ident" id="7716496">ioutil</span><span class="op" id="7716502">.</span><span class="ident" id="7716503">ReadFile</span><span class="op" id="7716511">(</span><span class="ident" id="7716512">filename</span><span class="op" id="7716520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7716523">if</span>&nbsp;<span class="ident" id="7716526">err</span>&nbsp;<span class="op" id="7716530">!=</span>&nbsp;<span class="ident" id="7716533">nil</span>&nbsp;<span class="op" id="7716537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716541">log</span><span class="op" id="7716544">.</span><span class="ident" id="7716545">Fatalf</span><span class="op" id="7716551">(</span><span class="string" id="7716552">&#34;%s&#34;</span><span class="op" id="7716556">,</span>&nbsp;<span class="ident" id="7716558">err</span><span class="op" id="7716561">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7716564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716568">file</span><span class="op" id="7716572">,</span>&nbsp;<span class="ident" id="7716574">err</span>&nbsp;<span class="op" id="7716578">:=</span>&nbsp;<span class="ident" id="7716581">parser</span><span class="op" id="7716587">.</span><span class="ident" id="7716588">ParseFile</span><span class="op" id="7716597">(</span><span class="ident" id="7716598">fset</span><span class="op" id="7716602">,</span>&nbsp;<span class="ident" id="7716604">filename</span><span class="op" id="7716612">,</span>&nbsp;<span class="ident" id="7716614">src</span><span class="op" id="7716617">,</span>&nbsp;<span class="ident" id="7716619">parser</span><span class="op" id="7716625">.</span><span class="ident" id="7716626">ParseComments</span><span class="op" id="7716639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7716642">if</span>&nbsp;<span class="ident" id="7716645">err</span>&nbsp;<span class="op" id="7716649">!=</span>&nbsp;<span class="ident" id="7716652">nil</span>&nbsp;<span class="op" id="7716656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716660">log</span><span class="op" id="7716663">.</span><span class="ident" id="7716664">Fatalf</span><span class="op" id="7716670">(</span><span class="string" id="7716671">&#34;%s&#34;</span><span class="op" id="7716675">,</span>&nbsp;<span class="ident" id="7716677">err</span><span class="op" id="7716680">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7716683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7716687">var</span>&nbsp;<span class="ident" id="7716691">buf</span>&nbsp;<span class="ident" id="7716695">bytes</span><span class="op" id="7716700">.</span><span class="ident" id="7716701">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716709">testprint</span><span class="op" id="7716718">(</span><span class="op" id="7716719">&amp;</span><span class="ident" id="7716720">buf</span><span class="op" id="7716723">,</span>&nbsp;<span class="ident" id="7716725">file</span><span class="op" id="7716729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7716732">if</span>&nbsp;<span class="op" id="7716735">!</span><span class="ident" id="7716736">bytes</span><span class="op" id="7716741">.</span><span class="ident" id="7716742">Equal</span><span class="op" id="7716747">(</span><span class="ident" id="7716748">buf</span><span class="op" id="7716751">.</span><span class="ident" id="7716752">Bytes</span><span class="op" id="7716757">(</span><span class="op" id="7716758">)</span><span class="op" id="7716759">,</span>&nbsp;<span class="ident" id="7716761">src</span><span class="op" id="7716764">)</span>&nbsp;<span class="op" id="7716766">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716770">log</span><span class="op" id="7716773">.</span><span class="ident" id="7716774">Fatalf</span><span class="op" id="7716780">(</span><span class="string" id="7716781">&#34;print&nbsp;error:&nbsp;%s&nbsp;not&nbsp;idempotent&#34;</span><span class="op" id="7716813">,</span>&nbsp;<span class="ident" id="7716815">filename</span><span class="op" id="7716823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7716826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716830">testfile</span>&nbsp;<span class="op" id="7716839">=</span>&nbsp;<span class="ident" id="7716841">file</span><br>
<span class="lineno"></span><span class="op" id="7716846">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="7716849">func</span>&nbsp;<span class="ident" id="7716854">BenchmarkPrint</span><span class="op" id="7716868">(</span><span class="ident" id="7716869">b</span>&nbsp;<span class="op" id="7716871">*</span><span class="ident" id="7716872">testing</span><span class="op" id="7716879">.</span><span class="ident" id="7716880">B</span><span class="op" id="7716881">)</span>&nbsp;<span class="op" id="7716883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7716886">if</span>&nbsp;<span class="ident" id="7716889">testfile</span>&nbsp;<span class="op" id="7716898">==</span>&nbsp;<span class="ident" id="7716901">nil</span>&nbsp;<span class="op" id="7716905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716909">initialize</span><span class="op" id="7716919">(</span><span class="op" id="7716920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7716923">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7716926">for</span>&nbsp;<span class="ident" id="7716930">i</span>&nbsp;<span class="op" id="7716932">:=</span>&nbsp;<span class="num" id="7716935">0</span><span class="op" id="7716936">;</span>&nbsp;<span class="ident" id="7716938">i</span>&nbsp;<span class="op" id="7716940">&lt;</span>&nbsp;<span class="ident" id="7716942">b</span><span class="op" id="7716943">.</span><span class="ident" id="7716944">N</span><span class="op" id="7716945">;</span>&nbsp;<span class="ident" id="7716947">i</span><span class="op" id="7716948">++</span>&nbsp;<span class="op" id="7716951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716955">testprint</span><span class="op" id="7716964">(</span><span class="ident" id="7716965">ioutil</span><span class="op" id="7716971">.</span><span class="ident" id="7716972">Discard</span><span class="op" id="7716979">,</span>&nbsp;<span class="ident" id="7716981">testfile</span><span class="op" id="7716989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7716992">}</span><br>
<span class="lineno"></span><span class="op" id="7716994">}</span>
</div>
</body>
</html>
