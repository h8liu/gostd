<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4132906">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4132961">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4133015">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4133066">package</span>&nbsp;<span class="ident" id="4133074">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4133079">import</span>&nbsp;<span class="op" id="4133086">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4133089">&#34;container/list&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4133107">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4133117">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4133132">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4133147">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4133154">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4133160">&#34;math/big&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4133172">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4133183">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4133191">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4133198">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4133201">const</span>&nbsp;<span class="op" id="4133207">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133210">VersionSSL30</span>&nbsp;<span class="op" id="4133223">=</span>&nbsp;<span class="num" id="4133225">0x0300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133233">VersionTLS10</span>&nbsp;<span class="op" id="4133246">=</span>&nbsp;<span class="num" id="4133248">0x0301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133256">VersionTLS11</span>&nbsp;<span class="op" id="4133269">=</span>&nbsp;<span class="num" id="4133271">0x0302</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133279">VersionTLS12</span>&nbsp;<span class="op" id="4133292">=</span>&nbsp;<span class="num" id="4133294">0x0303</span><br>
<span class="lineno">25</span><span class="op" id="4133301">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4133304">const</span>&nbsp;<span class="op" id="4133310">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133313">maxPlaintext</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4133329">=</span>&nbsp;<span class="num" id="4133331">16384</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4133344">//&nbsp;maximum&nbsp;plaintext&nbsp;payload&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133381">maxCiphertext</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4133397">=</span>&nbsp;<span class="num" id="4133399">16384</span>&nbsp;<span class="op" id="4133405">+</span>&nbsp;<span class="num" id="4133407">2048</span>&nbsp;<span class="comment" id="4133412">//&nbsp;maximum&nbsp;ciphertext&nbsp;payload&nbsp;length</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133450">recordHeaderLen</span>&nbsp;<span class="op" id="4133466">=</span>&nbsp;<span class="num" id="4133468">5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4133481">//&nbsp;record&nbsp;header&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133506">maxHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4133522">=</span>&nbsp;<span class="num" id="4133524">65536</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4133537">//&nbsp;maximum&nbsp;handshake&nbsp;we&nbsp;support&nbsp;(protocol&nbsp;max&nbsp;is&nbsp;16&nbsp;MB)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133595">minVersion</span>&nbsp;<span class="op" id="4133606">=</span>&nbsp;<span class="ident" id="4133608">VersionSSL30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133622">maxVersion</span>&nbsp;<span class="op" id="4133633">=</span>&nbsp;<span class="ident" id="4133635">VersionTLS12</span><br>
<span class="lineno">35</span><span class="op" id="4133648">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4133651">//&nbsp;TLS&nbsp;record&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4133672">type</span>&nbsp;<span class="ident" id="4133677">recordType</span>&nbsp;<span class="builtintype" id="4133688">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="4133695">const</span>&nbsp;<span class="op" id="4133701">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133704">recordTypeChangeCipherSpec</span>&nbsp;<span class="ident" id="4133731">recordType</span>&nbsp;<span class="op" id="4133742">=</span>&nbsp;<span class="num" id="4133744">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133748">recordTypeAlert</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4133775">recordType</span>&nbsp;<span class="op" id="4133786">=</span>&nbsp;<span class="num" id="4133788">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133792">recordTypeHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4133819">recordType</span>&nbsp;<span class="op" id="4133830">=</span>&nbsp;<span class="num" id="4133832">22</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133836">recordTypeApplicationData</span>&nbsp;&nbsp;<span class="ident" id="4133863">recordType</span>&nbsp;<span class="op" id="4133874">=</span>&nbsp;<span class="num" id="4133876">23</span><br>
<span class="lineno">45</span><span class="op" id="4133879">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4133882">//&nbsp;TLS&nbsp;handshake&nbsp;message&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4133914">const</span>&nbsp;<span class="op" id="4133920">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133923">typeClientHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4133946">uint8</span>&nbsp;<span class="op" id="4133952">=</span>&nbsp;<span class="num" id="4133954">1</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133957">typeServerHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4133980">uint8</span>&nbsp;<span class="op" id="4133986">=</span>&nbsp;<span class="num" id="4133988">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133991">typeNewSessionTicket</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4134014">uint8</span>&nbsp;<span class="op" id="4134020">=</span>&nbsp;<span class="num" id="4134022">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134025">typeCertificate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4134048">uint8</span>&nbsp;<span class="op" id="4134054">=</span>&nbsp;<span class="num" id="4134056">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134060">typeServerKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="4134083">uint8</span>&nbsp;<span class="op" id="4134089">=</span>&nbsp;<span class="num" id="4134091">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134095">typeCertificateRequest</span>&nbsp;<span class="builtintype" id="4134118">uint8</span>&nbsp;<span class="op" id="4134124">=</span>&nbsp;<span class="num" id="4134126">13</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134130">typeServerHelloDone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4134153">uint8</span>&nbsp;<span class="op" id="4134159">=</span>&nbsp;<span class="num" id="4134161">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134165">typeCertificateVerify</span>&nbsp;&nbsp;<span class="builtintype" id="4134188">uint8</span>&nbsp;<span class="op" id="4134194">=</span>&nbsp;<span class="num" id="4134196">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134200">typeClientKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="4134223">uint8</span>&nbsp;<span class="op" id="4134229">=</span>&nbsp;<span class="num" id="4134231">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134235">typeFinished</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4134258">uint8</span>&nbsp;<span class="op" id="4134264">=</span>&nbsp;<span class="num" id="4134266">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134270">typeCertificateStatus</span>&nbsp;&nbsp;<span class="builtintype" id="4134293">uint8</span>&nbsp;<span class="op" id="4134299">=</span>&nbsp;<span class="num" id="4134301">22</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134305">typeNextProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4134328">uint8</span>&nbsp;<span class="op" id="4134334">=</span>&nbsp;<span class="num" id="4134336">67</span>&nbsp;<span class="comment" id="4134339">//&nbsp;Not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span><span class="op" id="4134360">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4134363">//&nbsp;TLS&nbsp;compression&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4134389">const</span>&nbsp;<span class="op" id="4134395">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134398">compressionNone</span>&nbsp;<span class="builtintype" id="4134414">uint8</span>&nbsp;<span class="op" id="4134420">=</span>&nbsp;<span class="num" id="4134422">0</span><br>
<span class="lineno"></span><span class="op" id="4134424">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4134427">//&nbsp;TLS&nbsp;extension&nbsp;numbers</span><br>
<span class="lineno"></span><span class="keyword" id="4134452">const</span>&nbsp;<span class="op" id="4134458">(</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134461">extensionServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4134490">uint16</span>&nbsp;<span class="op" id="4134497">=</span>&nbsp;<span class="num" id="4134499">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134502">extensionStatusRequest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4134531">uint16</span>&nbsp;<span class="op" id="4134538">=</span>&nbsp;<span class="num" id="4134540">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134543">extensionSupportedCurves</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4134572">uint16</span>&nbsp;<span class="op" id="4134579">=</span>&nbsp;<span class="num" id="4134581">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134585">extensionSupportedPoints</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4134614">uint16</span>&nbsp;<span class="op" id="4134621">=</span>&nbsp;<span class="num" id="4134623">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134627">extensionSignatureAlgorithms</span>&nbsp;<span class="builtintype" id="4134656">uint16</span>&nbsp;<span class="op" id="4134663">=</span>&nbsp;<span class="num" id="4134665">13</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134669">extensionALPN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4134698">uint16</span>&nbsp;<span class="op" id="4134705">=</span>&nbsp;<span class="num" id="4134707">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134711">extensionSessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4134740">uint16</span>&nbsp;<span class="op" id="4134747">=</span>&nbsp;<span class="num" id="4134749">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134753">extensionNextProtoNeg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4134782">uint16</span>&nbsp;<span class="op" id="4134789">=</span>&nbsp;<span class="num" id="4134791">13172</span>&nbsp;<span class="comment" id="4134797">//&nbsp;not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134819">extensionRenegotiationInfo</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4134848">uint16</span>&nbsp;<span class="op" id="4134855">=</span>&nbsp;<span class="num" id="4134857">0xff01</span><br>
<span class="lineno"></span><span class="op" id="4134864">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="4134867">//&nbsp;TLS&nbsp;signaling&nbsp;cipher&nbsp;suite&nbsp;values</span><br>
<span class="lineno"></span><span class="keyword" id="4134904">const</span>&nbsp;<span class="op" id="4134910">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134913">scsvRenegotiation</span>&nbsp;<span class="builtintype" id="4134931">uint16</span>&nbsp;<span class="op" id="4134938">=</span>&nbsp;<span class="num" id="4134940">0x00ff</span><br>
<span class="lineno"></span><span class="op" id="4134947">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4134950">//&nbsp;CurveID&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;a&nbsp;TLS&nbsp;identifier&nbsp;for&nbsp;an&nbsp;elliptic&nbsp;curve.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="4135020">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-8</span><br>
<span class="lineno"></span><span class="keyword" id="4135106">type</span>&nbsp;<span class="ident" id="4135111">CurveID</span>&nbsp;<span class="builtintype" id="4135119">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="4135127">const</span>&nbsp;<span class="op" id="4135133">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135136">CurveP256</span>&nbsp;<span class="ident" id="4135146">CurveID</span>&nbsp;<span class="op" id="4135154">=</span>&nbsp;<span class="num" id="4135156">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135160">CurveP384</span>&nbsp;<span class="ident" id="4135170">CurveID</span>&nbsp;<span class="op" id="4135178">=</span>&nbsp;<span class="num" id="4135180">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135184">CurveP521</span>&nbsp;<span class="ident" id="4135194">CurveID</span>&nbsp;<span class="op" id="4135202">=</span>&nbsp;<span class="num" id="4135204">25</span><br>
<span class="lineno"></span><span class="op" id="4135207">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="4135210">//&nbsp;TLS&nbsp;Elliptic&nbsp;Curve&nbsp;Point&nbsp;Formats</span><br>
<span class="lineno"></span><span class="comment" id="4135246">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-9</span><br>
<span class="lineno"></span><span class="keyword" id="4135332">const</span>&nbsp;<span class="op" id="4135338">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135341">pointFormatUncompressed</span>&nbsp;<span class="builtintype" id="4135365">uint8</span>&nbsp;<span class="op" id="4135371">=</span>&nbsp;<span class="num" id="4135373">0</span><br>
<span class="lineno">100</span><span class="op" id="4135375">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4135378">//&nbsp;TLS&nbsp;CertificateStatusType&nbsp;(RFC&nbsp;3546)</span><br>
<span class="lineno"></span><span class="keyword" id="4135418">const</span>&nbsp;<span class="op" id="4135424">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135427">statusTypeOCSP</span>&nbsp;<span class="builtintype" id="4135442">uint8</span>&nbsp;<span class="op" id="4135448">=</span>&nbsp;<span class="num" id="4135450">1</span><br>
<span class="lineno">105</span><span class="op" id="4135452">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4135455">//&nbsp;Certificate&nbsp;types&nbsp;(for&nbsp;certificateRequestMsg)</span><br>
<span class="lineno"></span><span class="keyword" id="4135504">const</span>&nbsp;<span class="op" id="4135510">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135513">certTypeRSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4135532">=</span>&nbsp;<span class="num" id="4135534">1</span>&nbsp;<span class="comment" id="4135536">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135576">certTypeDSSSign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4135595">=</span>&nbsp;<span class="num" id="4135597">2</span>&nbsp;<span class="comment" id="4135599">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;DSA&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135638">certTypeRSAFixedDH</span>&nbsp;<span class="op" id="4135657">=</span>&nbsp;<span class="num" id="4135659">3</span>&nbsp;<span class="comment" id="4135661">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135706">certTypeDSSFixedDH</span>&nbsp;<span class="op" id="4135725">=</span>&nbsp;<span class="num" id="4135727">4</span>&nbsp;<span class="comment" id="4135729">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135775">//&nbsp;See&nbsp;RFC4492&nbsp;sections&nbsp;3&nbsp;and&nbsp;5.5.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135811">certTypeECDSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4135834">=</span>&nbsp;<span class="num" id="4135836">64</span>&nbsp;<span class="comment" id="4135839">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDSA-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135916">certTypeRSAFixedECDH</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4135939">=</span>&nbsp;<span class="num" id="4135941">65</span>&nbsp;<span class="comment" id="4135944">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;RSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136018">certTypeECDSAFixedECDH</span>&nbsp;<span class="op" id="4136041">=</span>&nbsp;<span class="num" id="4136043">66</span>&nbsp;<span class="comment" id="4136046">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4136123">//&nbsp;Rest&nbsp;of&nbsp;these&nbsp;are&nbsp;reserved&nbsp;by&nbsp;the&nbsp;TLS&nbsp;spec</span><br>
<span class="lineno">120</span><span class="op" id="4136169">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4136172">//&nbsp;Hash&nbsp;functions&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="4136232">const</span>&nbsp;<span class="op" id="4136238">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136241">hashSHA1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4136252">uint8</span>&nbsp;<span class="op" id="4136258">=</span>&nbsp;<span class="num" id="4136260">2</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136263">hashSHA256</span>&nbsp;<span class="builtintype" id="4136274">uint8</span>&nbsp;<span class="op" id="4136280">=</span>&nbsp;<span class="num" id="4136282">4</span><br>
<span class="lineno"></span><span class="op" id="4136284">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4136287">//&nbsp;Signature&nbsp;algorithms&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="4136353">const</span>&nbsp;<span class="op" id="4136359">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136362">signatureRSA</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4136377">uint8</span>&nbsp;<span class="op" id="4136383">=</span>&nbsp;<span class="num" id="4136385">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136388">signatureECDSA</span>&nbsp;<span class="builtintype" id="4136403">uint8</span>&nbsp;<span class="op" id="4136409">=</span>&nbsp;<span class="num" id="4136411">3</span><br>
<span class="lineno"></span><span class="op" id="4136413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4136416">//&nbsp;signatureAndHash&nbsp;mirrors&nbsp;the&nbsp;TLS&nbsp;1.2,&nbsp;SignatureAndHashAlgorithm&nbsp;struct.&nbsp;See</span><br>
<span class="lineno">135</span><span class="comment" id="4136495">//&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4136523">type</span>&nbsp;<span class="ident" id="4136528">signatureAndHash</span>&nbsp;<span class="keyword" id="4136545">struct</span>&nbsp;<span class="op" id="4136552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136555">hash</span><span class="op" id="4136559">,</span>&nbsp;<span class="ident" id="4136561">signature</span>&nbsp;<span class="builtintype" id="4136571">uint8</span><br>
<span class="lineno"></span><span class="op" id="4136577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="4136580">//&nbsp;supportedSKXSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash&nbsp;algorithms</span><br>
<span class="lineno"></span><span class="comment" id="4136658">//&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2&nbsp;ClientHello.</span><br>
<span class="lineno"></span><span class="keyword" id="4136725">var</span>&nbsp;<span class="ident" id="4136729">supportedSKXSignatureAlgorithms</span>&nbsp;<span class="op" id="4136761">=</span>&nbsp;<span class="op" id="4136763">[</span><span class="op" id="4136764">]</span><span class="ident" id="4136765">signatureAndHash</span><span class="op" id="4136781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136784">{</span><span class="ident" id="4136785">hashSHA256</span><span class="op" id="4136795">,</span>&nbsp;<span class="ident" id="4136797">signatureRSA</span><span class="op" id="4136809">}</span><span class="op" id="4136810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136813">{</span><span class="ident" id="4136814">hashSHA256</span><span class="op" id="4136824">,</span>&nbsp;<span class="ident" id="4136826">signatureECDSA</span><span class="op" id="4136840">}</span><span class="op" id="4136841">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136844">{</span><span class="ident" id="4136845">hashSHA1</span><span class="op" id="4136853">,</span>&nbsp;<span class="ident" id="4136855">signatureRSA</span><span class="op" id="4136867">}</span><span class="op" id="4136868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136871">{</span><span class="ident" id="4136872">hashSHA1</span><span class="op" id="4136880">,</span>&nbsp;<span class="ident" id="4136882">signatureECDSA</span><span class="op" id="4136896">}</span><span class="op" id="4136897">,</span><br>
<span class="lineno"></span><span class="op" id="4136899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4136902">//&nbsp;supportedClientCertSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash</span><br>
<span class="lineno">150</span><span class="comment" id="4136976">//&nbsp;algorithms&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2</span><br>
<span class="lineno"></span><span class="comment" id="4137041">//&nbsp;CertificateRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="4137064">var</span>&nbsp;<span class="ident" id="4137068">supportedClientCertSignatureAlgorithms</span>&nbsp;<span class="op" id="4137107">=</span>&nbsp;<span class="op" id="4137109">[</span><span class="op" id="4137110">]</span><span class="ident" id="4137111">signatureAndHash</span><span class="op" id="4137127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4137130">{</span><span class="ident" id="4137131">hashSHA256</span><span class="op" id="4137141">,</span>&nbsp;<span class="ident" id="4137143">signatureRSA</span><span class="op" id="4137155">}</span><span class="op" id="4137156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4137159">{</span><span class="ident" id="4137160">hashSHA256</span><span class="op" id="4137170">,</span>&nbsp;<span class="ident" id="4137172">signatureECDSA</span><span class="op" id="4137186">}</span><span class="op" id="4137187">,</span><br>
<span class="lineno">155</span><span class="op" id="4137189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4137192">//&nbsp;ConnectionState&nbsp;records&nbsp;basic&nbsp;TLS&nbsp;details&nbsp;about&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4137259">type</span>&nbsp;<span class="ident" id="4137264">ConnectionState</span>&nbsp;<span class="keyword" id="4137280">struct</span>&nbsp;<span class="op" id="4137287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137290">Version</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4137317">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4137339">//&nbsp;TLS&nbsp;version&nbsp;used&nbsp;by&nbsp;the&nbsp;connection&nbsp;(e.g.&nbsp;VersionTLS12)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137398">HandshakeComplete</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4137425">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4137447">//&nbsp;TLS&nbsp;handshake&nbsp;is&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137477">DidResume</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4137504">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4137526">//&nbsp;connection&nbsp;resumes&nbsp;a&nbsp;previous&nbsp;TLS&nbsp;connection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137575">CipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4137602">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4137624">//&nbsp;cipher&nbsp;suite&nbsp;in&nbsp;use&nbsp;(TLS_RSA_WITH_RC4_128_SHA,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137680">NegotiatedProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4137707">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4137729">//&nbsp;negotiated&nbsp;next&nbsp;protocol&nbsp;(from&nbsp;Config.NextProtos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137783">NegotiatedProtocolIsMutual</span>&nbsp;<span class="builtintype" id="4137810">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4137832">//&nbsp;negotiated&nbsp;protocol&nbsp;was&nbsp;advertised&nbsp;by&nbsp;server</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137881">ServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4137908">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4137930">//&nbsp;server&nbsp;name&nbsp;requested&nbsp;by&nbsp;client,&nbsp;if&nbsp;any&nbsp;(server&nbsp;side&nbsp;only)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137993">PeerCertificates</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4138020">[</span><span class="op" id="4138021">]</span><span class="op" id="4138022">*</span><span class="ident" id="4138023">x509</span><span class="op" id="4138027">.</span><span class="ident" id="4138028">Certificate</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4138042">//&nbsp;certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;remote&nbsp;peer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138089">VerifiedChains</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4138116">[</span><span class="op" id="4138117">]</span><span class="op" id="4138118">[</span><span class="op" id="4138119">]</span><span class="op" id="4138120">*</span><span class="ident" id="4138121">x509</span><span class="op" id="4138125">.</span><span class="ident" id="4138126">Certificate</span>&nbsp;<span class="comment" id="4138138">//&nbsp;verified&nbsp;chains&nbsp;built&nbsp;from&nbsp;PeerCertificates</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4138187">//&nbsp;TLSUnique&nbsp;contains&nbsp;the&nbsp;&#34;tls-unique&#34;&nbsp;channel&nbsp;binding&nbsp;value&nbsp;(see&nbsp;RFC</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4138258">//&nbsp;5929,&nbsp;section&nbsp;3).&nbsp;For&nbsp;resumed&nbsp;sessions&nbsp;this&nbsp;value&nbsp;will&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4138324">//&nbsp;because&nbsp;resumption&nbsp;does&nbsp;not&nbsp;include&nbsp;enough&nbsp;context&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4138384">//&nbsp;https://secure-resumption.com/#channelbindings).&nbsp;This&nbsp;will&nbsp;change&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4138457">//&nbsp;future&nbsp;versions&nbsp;of&nbsp;Go&nbsp;once&nbsp;the&nbsp;TLS&nbsp;master-secret&nbsp;fix&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4138523">//&nbsp;standardized&nbsp;and&nbsp;implemented.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138557">TLSUnique</span>&nbsp;<span class="op" id="4138567">[</span><span class="op" id="4138568">]</span><span class="builtintype" id="4138569">byte</span><br>
<span class="lineno"></span><span class="op" id="4138574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4138577">//&nbsp;ClientAuthType&nbsp;declares&nbsp;the&nbsp;policy&nbsp;the&nbsp;server&nbsp;will&nbsp;follow&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4138642">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.</span><br>
<span class="lineno">180</span><span class="keyword" id="4138672">type</span>&nbsp;<span class="ident" id="4138677">ClientAuthType</span>&nbsp;<span class="builtintype" id="4138692">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4138697">const</span>&nbsp;<span class="op" id="4138703">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138706">NoClientCert</span>&nbsp;<span class="ident" id="4138719">ClientAuthType</span>&nbsp;<span class="op" id="4138734">=</span>&nbsp;<span class="ident" id="4138736">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138742">RequestClientCert</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138761">RequireAnyClientCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138783">VerifyClientCertIfGiven</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138808">RequireAndVerifyClientCert</span><br>
<span class="lineno"></span><span class="op" id="4138835">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4138838">//&nbsp;ClientSessionState&nbsp;contains&nbsp;the&nbsp;state&nbsp;needed&nbsp;by&nbsp;clients&nbsp;to&nbsp;resume&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="4138911">//&nbsp;sessions.</span><br>
<span class="lineno"></span><span class="keyword" id="4138924">type</span>&nbsp;<span class="ident" id="4138929">ClientSessionState</span>&nbsp;<span class="keyword" id="4138948">struct</span>&nbsp;<span class="op" id="4138955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138958">sessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4138977">[</span><span class="op" id="4138978">]</span><span class="builtintype" id="4138979">uint8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4138997">//&nbsp;Encrypted&nbsp;ticket&nbsp;used&nbsp;for&nbsp;session&nbsp;resumption&nbsp;with&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139058">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4139077">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4139097">//&nbsp;SSL/TLS&nbsp;version&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139144">cipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4139163">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4139183">//&nbsp;Ciphersuite&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139226">masterSecret</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4139245">[</span><span class="op" id="4139246">]</span><span class="builtintype" id="4139247">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4139265">//&nbsp;MasterSecret&nbsp;generated&nbsp;by&nbsp;client&nbsp;on&nbsp;a&nbsp;full&nbsp;handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139322">serverCertificates</span>&nbsp;<span class="op" id="4139341">[</span><span class="op" id="4139342">]</span><span class="op" id="4139343">*</span><span class="ident" id="4139344">x509</span><span class="op" id="4139348">.</span><span class="ident" id="4139349">Certificate</span>&nbsp;<span class="comment" id="4139361">//&nbsp;Certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="op" id="4139406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="4139409">//&nbsp;ClientSessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;objects&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4139489">//&nbsp;by&nbsp;a&nbsp;client&nbsp;to&nbsp;resume&nbsp;a&nbsp;TLS&nbsp;session&nbsp;with&nbsp;a&nbsp;given&nbsp;server.&nbsp;ClientSessionCache</span><br>
<span class="lineno"></span><span class="comment" id="4139568">//&nbsp;implementations&nbsp;should&nbsp;expect&nbsp;to&nbsp;be&nbsp;called&nbsp;concurrently&nbsp;from&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="4139642">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="4139657">type</span>&nbsp;<span class="ident" id="4139662">ClientSessionCache</span>&nbsp;<span class="keyword" id="4139681">interface</span>&nbsp;<span class="op" id="4139691">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4139694">//&nbsp;Get&nbsp;searches&nbsp;for&nbsp;a&nbsp;ClientSessionState&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4139767">//&nbsp;On&nbsp;return,&nbsp;ok&nbsp;is&nbsp;true&nbsp;if&nbsp;one&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139811">Get</span><span class="op" id="4139814">(</span><span class="ident" id="4139815">sessionKey</span>&nbsp;<span class="builtintype" id="4139826">string</span><span class="op" id="4139832">)</span>&nbsp;<span class="op" id="4139834">(</span><span class="ident" id="4139835">session</span>&nbsp;<span class="op" id="4139843">*</span><span class="ident" id="4139844">ClientSessionState</span><span class="op" id="4139862">,</span>&nbsp;<span class="ident" id="4139864">ok</span>&nbsp;<span class="builtintype" id="4139867">bool</span><span class="op" id="4139871">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4139875">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;ClientSessionState&nbsp;to&nbsp;the&nbsp;cache&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139944">Put</span><span class="op" id="4139947">(</span><span class="ident" id="4139948">sessionKey</span>&nbsp;<span class="builtintype" id="4139959">string</span><span class="op" id="4139965">,</span>&nbsp;<span class="ident" id="4139967">cs</span>&nbsp;<span class="op" id="4139970">*</span><span class="ident" id="4139971">ClientSessionState</span><span class="op" id="4139989">)</span><br>
<span class="lineno"></span><span class="op" id="4139991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4139994">//&nbsp;ClientHelloInfo&nbsp;contains&nbsp;information&nbsp;from&nbsp;a&nbsp;ClientHello&nbsp;message&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4140073">//&nbsp;guide&nbsp;certificate&nbsp;selection&nbsp;in&nbsp;the&nbsp;GetCertificate&nbsp;callback.</span><br>
<span class="lineno">215</span><span class="keyword" id="4140136">type</span>&nbsp;<span class="ident" id="4140141">ClientHelloInfo</span>&nbsp;<span class="keyword" id="4140157">struct</span>&nbsp;<span class="op" id="4140164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140167">//&nbsp;CipherSuites&nbsp;lists&nbsp;the&nbsp;CipherSuites&nbsp;supported&nbsp;by&nbsp;the&nbsp;client&nbsp;(e.g.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140237">//&nbsp;TLS_RSA_WITH_RC4_128_SHA).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140268">CipherSuites</span>&nbsp;<span class="op" id="4140281">[</span><span class="op" id="4140282">]</span><span class="builtintype" id="4140283">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140292">//&nbsp;ServerName&nbsp;indicates&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;server&nbsp;requested&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140364">//&nbsp;in&nbsp;order&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.&nbsp;ServerName&nbsp;is&nbsp;only&nbsp;set&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140435">//&nbsp;client&nbsp;is&nbsp;using&nbsp;SNI&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140464">//&nbsp;http://tools.ietf.org/html/rfc4366#section-3.1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140517">ServerName</span>&nbsp;<span class="builtintype" id="4140528">string</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140537">//&nbsp;SupportedCurves&nbsp;lists&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140608">//&nbsp;SupportedCurves&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Elliptic&nbsp;Curves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140673">//&nbsp;Extension&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140706">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.1).</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140761">SupportedCurves</span>&nbsp;<span class="op" id="4140777">[</span><span class="op" id="4140778">]</span><span class="ident" id="4140779">CurveID</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140789">//&nbsp;SupportedPoints&nbsp;lists&nbsp;the&nbsp;point&nbsp;formats&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140858">//&nbsp;SupportedPoints&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Point&nbsp;Formats&nbsp;Extension</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140931">//&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140954">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141009">SupportedPoints</span>&nbsp;<span class="op" id="4141025">[</span><span class="op" id="4141026">]</span><span class="builtintype" id="4141027">uint8</span><br>
<span class="lineno"></span><span class="op" id="4141033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4141036">//&nbsp;A&nbsp;Config&nbsp;structure&nbsp;is&nbsp;used&nbsp;to&nbsp;configure&nbsp;a&nbsp;TLS&nbsp;client&nbsp;or&nbsp;server.</span><br>
<span class="lineno">240</span><span class="comment" id="4141103">//&nbsp;After&nbsp;one&nbsp;has&nbsp;been&nbsp;passed&nbsp;to&nbsp;a&nbsp;TLS&nbsp;function&nbsp;it&nbsp;must&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4141165">//&nbsp;modified.&nbsp;A&nbsp;Config&nbsp;may&nbsp;be&nbsp;reused;&nbsp;the&nbsp;tls&nbsp;package&nbsp;will&nbsp;also&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4141232">//&nbsp;modify&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4141246">type</span>&nbsp;<span class="ident" id="4141251">Config</span>&nbsp;<span class="keyword" id="4141258">struct</span>&nbsp;<span class="op" id="4141265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141268">//&nbsp;Rand&nbsp;provides&nbsp;the&nbsp;source&nbsp;of&nbsp;entropy&nbsp;for&nbsp;nonces&nbsp;and&nbsp;RSA&nbsp;blinding.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141337">//&nbsp;If&nbsp;Rand&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;cryptographic&nbsp;random&nbsp;reader&nbsp;in&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141409">//&nbsp;crypto/rand.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141426">//&nbsp;The&nbsp;Reader&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141486">Rand</span>&nbsp;<span class="ident" id="4141491">io</span><span class="op" id="4141493">.</span><span class="ident" id="4141494">Reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141503">//&nbsp;Time&nbsp;returns&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;the&nbsp;number&nbsp;of&nbsp;seconds&nbsp;since&nbsp;the&nbsp;epoch.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141579">//&nbsp;If&nbsp;Time&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;time.Now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141618">Time</span>&nbsp;<span class="keyword" id="4141623">func</span><span class="op" id="4141627">(</span><span class="op" id="4141628">)</span>&nbsp;<span class="ident" id="4141630">time</span><span class="op" id="4141634">.</span><span class="ident" id="4141635">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141642">//&nbsp;Certificates&nbsp;contains&nbsp;one&nbsp;or&nbsp;more&nbsp;certificate&nbsp;chains</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141699">//&nbsp;to&nbsp;present&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141751">//&nbsp;Server&nbsp;configurations&nbsp;must&nbsp;include&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141816">Certificates</span>&nbsp;<span class="op" id="4141829">[</span><span class="op" id="4141830">]</span><span class="ident" id="4141831">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141845">//&nbsp;NameToCertificate&nbsp;maps&nbsp;from&nbsp;a&nbsp;certificate&nbsp;name&nbsp;to&nbsp;an&nbsp;element&nbsp;of</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141913">//&nbsp;Certificates.&nbsp;Note&nbsp;that&nbsp;a&nbsp;certificate&nbsp;name&nbsp;can&nbsp;be&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141979">//&nbsp;&#39;*.example.com&#39;&nbsp;and&nbsp;so&nbsp;doesn&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;a&nbsp;domain&nbsp;name&nbsp;as&nbsp;such.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142048">//&nbsp;See&nbsp;Config.BuildNameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142086">//&nbsp;The&nbsp;nil&nbsp;value&nbsp;causes&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;to&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142156">//&nbsp;for&nbsp;all&nbsp;connections.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142181">NameToCertificate</span>&nbsp;<span class="keyword" id="4142199">map</span><span class="op" id="4142202">[</span><span class="builtintype" id="4142203">string</span><span class="op" id="4142209">]</span><span class="op" id="4142210">*</span><span class="ident" id="4142211">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142225">//&nbsp;GetCertificate&nbsp;returns&nbsp;a&nbsp;Certificate&nbsp;based&nbsp;on&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142285">//&nbsp;ClientHelloInfo.&nbsp;If&nbsp;GetCertificate&nbsp;is&nbsp;nil&nbsp;or&nbsp;returns&nbsp;nil,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142356">//&nbsp;certificate&nbsp;is&nbsp;retrieved&nbsp;from&nbsp;NameToCertificate.&nbsp;If</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142412">//&nbsp;NameToCertificate&nbsp;is&nbsp;nil,&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142484">//&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142494">GetCertificate</span>&nbsp;<span class="keyword" id="4142509">func</span><span class="op" id="4142513">(</span><span class="ident" id="4142514">clientHello</span>&nbsp;<span class="op" id="4142526">*</span><span class="ident" id="4142527">ClientHelloInfo</span><span class="op" id="4142542">)</span>&nbsp;<span class="op" id="4142544">(</span><span class="op" id="4142545">*</span><span class="ident" id="4142546">Certificate</span><span class="op" id="4142557">,</span>&nbsp;<span class="builtintype" id="4142559">error</span><span class="op" id="4142564">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142568">//&nbsp;RootCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142628">//&nbsp;that&nbsp;clients&nbsp;use&nbsp;when&nbsp;verifying&nbsp;server&nbsp;certificates.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142685">//&nbsp;If&nbsp;RootCAs&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;host&#39;s&nbsp;root&nbsp;CA&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142741">RootCAs</span>&nbsp;<span class="op" id="4142749">*</span><span class="ident" id="4142750">x509</span><span class="op" id="4142754">.</span><span class="ident" id="4142755">CertPool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142766">//&nbsp;NextProtos&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported,&nbsp;application&nbsp;level&nbsp;protocols.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142834">NextProtos</span>&nbsp;<span class="op" id="4142845">[</span><span class="op" id="4142846">]</span><span class="builtintype" id="4142847">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142856">//&nbsp;ServerName&nbsp;is&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;hostname&nbsp;on&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142918">//&nbsp;certificates&nbsp;unless&nbsp;InsecureSkipVerify&nbsp;is&nbsp;given.&nbsp;It&nbsp;is&nbsp;also&nbsp;included</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142991">//&nbsp;in&nbsp;the&nbsp;client&#39;s&nbsp;handshake&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143049">ServerName</span>&nbsp;<span class="builtintype" id="4143060">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143069">//&nbsp;ClientAuth&nbsp;determines&nbsp;the&nbsp;server&#39;s&nbsp;policy&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143119">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.&nbsp;The&nbsp;default&nbsp;is&nbsp;NoClientCert.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143179">ClientAuth</span>&nbsp;<span class="ident" id="4143190">ClientAuthType</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143207">//&nbsp;ClientCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143269">//&nbsp;that&nbsp;servers&nbsp;use&nbsp;if&nbsp;required&nbsp;to&nbsp;verify&nbsp;a&nbsp;client&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143333">//&nbsp;by&nbsp;the&nbsp;policy&nbsp;in&nbsp;ClientAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143366">ClientCAs</span>&nbsp;<span class="op" id="4143376">*</span><span class="ident" id="4143377">x509</span><span class="op" id="4143381">.</span><span class="ident" id="4143382">CertPool</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143393">//&nbsp;InsecureSkipVerify&nbsp;controls&nbsp;whether&nbsp;a&nbsp;client&nbsp;verifies&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143455">//&nbsp;server&#39;s&nbsp;certificate&nbsp;chain&nbsp;and&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143501">//&nbsp;If&nbsp;InsecureSkipVerify&nbsp;is&nbsp;true,&nbsp;TLS&nbsp;accepts&nbsp;any&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143564">//&nbsp;presented&nbsp;by&nbsp;the&nbsp;server&nbsp;and&nbsp;any&nbsp;host&nbsp;name&nbsp;in&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143631">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;TLS&nbsp;is&nbsp;susceptible&nbsp;to&nbsp;man-in-the-middle&nbsp;attacks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143698">//&nbsp;This&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143740">InsecureSkipVerify</span>&nbsp;<span class="builtintype" id="4143759">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143766">//&nbsp;CipherSuites&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported&nbsp;cipher&nbsp;suites.&nbsp;If&nbsp;CipherSuites</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143837">//&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;a&nbsp;list&nbsp;of&nbsp;suites&nbsp;supported&nbsp;by&nbsp;the&nbsp;implementation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143908">CipherSuites</span>&nbsp;<span class="op" id="4143921">[</span><span class="op" id="4143922">]</span><span class="builtintype" id="4143923">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4143932">//&nbsp;PreferServerCipherSuites&nbsp;controls&nbsp;whether&nbsp;the&nbsp;server&nbsp;selects&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144001">//&nbsp;client&#39;s&nbsp;most&nbsp;preferred&nbsp;ciphersuite,&nbsp;or&nbsp;the&nbsp;server&#39;s&nbsp;most&nbsp;preferred</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144073">//&nbsp;ciphersuite.&nbsp;If&nbsp;true&nbsp;then&nbsp;the&nbsp;server&#39;s&nbsp;preference,&nbsp;as&nbsp;expressed&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144144">//&nbsp;the&nbsp;order&nbsp;of&nbsp;elements&nbsp;in&nbsp;CipherSuites,&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144196">PreferServerCipherSuites</span>&nbsp;<span class="builtintype" id="4144221">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144228">//&nbsp;SessionTicketsDisabled&nbsp;may&nbsp;be&nbsp;set&nbsp;to&nbsp;true&nbsp;to&nbsp;disable&nbsp;session&nbsp;ticket</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144300">//&nbsp;(resumption)&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144326">SessionTicketsDisabled</span>&nbsp;<span class="builtintype" id="4144349">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144356">//&nbsp;SessionTicketKey&nbsp;is&nbsp;used&nbsp;by&nbsp;TLS&nbsp;servers&nbsp;to&nbsp;provide&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144419">//&nbsp;resumption.&nbsp;See&nbsp;RFC&nbsp;5077.&nbsp;If&nbsp;zero,&nbsp;it&nbsp;will&nbsp;be&nbsp;filled&nbsp;with</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144481">//&nbsp;random&nbsp;data&nbsp;before&nbsp;the&nbsp;first&nbsp;server&nbsp;handshake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144532">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144536">//&nbsp;If&nbsp;multiple&nbsp;servers&nbsp;are&nbsp;terminating&nbsp;connections&nbsp;for&nbsp;the&nbsp;same&nbsp;host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144606">//&nbsp;they&nbsp;should&nbsp;all&nbsp;have&nbsp;the&nbsp;same&nbsp;SessionTicketKey.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144665">//&nbsp;SessionTicketKey&nbsp;leaks,&nbsp;previously&nbsp;recorded&nbsp;and&nbsp;future&nbsp;TLS</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144728">//&nbsp;connections&nbsp;using&nbsp;that&nbsp;key&nbsp;are&nbsp;compromised.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144776">SessionTicketKey</span>&nbsp;<span class="op" id="4144793">[</span><span class="num" id="4144794">32</span><span class="op" id="4144796">]</span><span class="builtintype" id="4144797">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144804">//&nbsp;SessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;entries&nbsp;for&nbsp;TLS&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144878">//&nbsp;resumption.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4144894">ClientSessionCache</span>&nbsp;<span class="ident" id="4144913">ClientSessionCache</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4144934">//&nbsp;MinVersion&nbsp;contains&nbsp;the&nbsp;minimum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145006">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;SSLv3&nbsp;is&nbsp;taken&nbsp;as&nbsp;the&nbsp;minimum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145055">MinVersion</span>&nbsp;<span class="builtintype" id="4145066">uint16</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145075">//&nbsp;MaxVersion&nbsp;contains&nbsp;the&nbsp;maximum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145147">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;the&nbsp;maximum&nbsp;version&nbsp;supported&nbsp;by&nbsp;this&nbsp;package&nbsp;is&nbsp;used,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145220">//&nbsp;which&nbsp;is&nbsp;currently&nbsp;TLS&nbsp;1.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145252">MaxVersion</span>&nbsp;<span class="builtintype" id="4145263">uint16</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145272">//&nbsp;CurvePreferences&nbsp;contains&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145343">//&nbsp;an&nbsp;ECDHE&nbsp;handshake,&nbsp;in&nbsp;preference&nbsp;order.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;default&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145415">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145428">CurvePreferences</span>&nbsp;<span class="op" id="4145445">[</span><span class="op" id="4145446">]</span><span class="ident" id="4145447">CurveID</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145457">serverInitOnce</span>&nbsp;<span class="ident" id="4145472">sync</span><span class="op" id="4145476">.</span><span class="ident" id="4145477">Once</span>&nbsp;<span class="comment" id="4145482">//&nbsp;guards&nbsp;calling&nbsp;(*Config).serverInit</span><br>
<span class="lineno"></span><span class="op" id="4145521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4145524">func</span>&nbsp;<span class="op" id="4145529">(</span><span class="ident" id="4145530">c</span>&nbsp;<span class="op" id="4145532">*</span><span class="ident" id="4145533">Config</span><span class="op" id="4145539">)</span>&nbsp;<span class="ident" id="4145541">serverInit</span><span class="op" id="4145551">(</span><span class="op" id="4145552">)</span>&nbsp;<span class="op" id="4145554">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145557">if</span>&nbsp;<span class="ident" id="4145560">c</span><span class="op" id="4145561">.</span><span class="ident" id="4145562">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4145585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145589">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4145597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4145601">//&nbsp;If&nbsp;the&nbsp;key&nbsp;has&nbsp;already&nbsp;been&nbsp;set&nbsp;then&nbsp;we&nbsp;have&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145665">for</span>&nbsp;<span class="ident" id="4145669">_</span><span class="op" id="4145670">,</span>&nbsp;<span class="ident" id="4145672">b</span>&nbsp;<span class="op" id="4145674">:=</span>&nbsp;<span class="keyword" id="4145677">range</span>&nbsp;<span class="ident" id="4145683">c</span><span class="op" id="4145684">.</span><span class="ident" id="4145685">SessionTicketKey</span>&nbsp;<span class="op" id="4145702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145706">if</span>&nbsp;<span class="ident" id="4145709">b</span>&nbsp;<span class="op" id="4145711">!=</span>&nbsp;<span class="num" id="4145714">0</span>&nbsp;<span class="op" id="4145716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145721">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4145730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4145733">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145737">if</span>&nbsp;<span class="ident" id="4145740">_</span><span class="op" id="4145741">,</span>&nbsp;<span class="ident" id="4145743">err</span>&nbsp;<span class="op" id="4145747">:=</span>&nbsp;<span class="ident" id="4145750">io</span><span class="op" id="4145752">.</span><span class="ident" id="4145753">ReadFull</span><span class="op" id="4145761">(</span><span class="ident" id="4145762">c</span><span class="op" id="4145763">.</span><span class="ident" id="4145764">rand</span><span class="op" id="4145768">(</span><span class="op" id="4145769">)</span><span class="op" id="4145770">,</span>&nbsp;<span class="ident" id="4145772">c</span><span class="op" id="4145773">.</span><span class="ident" id="4145774">SessionTicketKey</span><span class="op" id="4145790">[</span><span class="op" id="4145791">:</span><span class="op" id="4145792">]</span><span class="op" id="4145793">)</span><span class="op" id="4145794">;</span>&nbsp;<span class="ident" id="4145796">err</span>&nbsp;<span class="op" id="4145800">!=</span>&nbsp;<span class="ident" id="4145803">nil</span>&nbsp;<span class="op" id="4145807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145811">c</span><span class="op" id="4145812">.</span><span class="ident" id="4145813">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4145836">=</span>&nbsp;<span class="builtintype" id="4145838">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4145844">}</span><br>
<span class="lineno"></span><span class="op" id="4145846">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="4145849">func</span>&nbsp;<span class="op" id="4145854">(</span><span class="ident" id="4145855">c</span>&nbsp;<span class="op" id="4145857">*</span><span class="ident" id="4145858">Config</span><span class="op" id="4145864">)</span>&nbsp;<span class="ident" id="4145866">rand</span><span class="op" id="4145870">(</span><span class="op" id="4145871">)</span>&nbsp;<span class="ident" id="4145873">io</span><span class="op" id="4145875">.</span><span class="ident" id="4145876">Reader</span>&nbsp;<span class="op" id="4145883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145886">r</span>&nbsp;<span class="op" id="4145888">:=</span>&nbsp;<span class="ident" id="4145891">c</span><span class="op" id="4145892">.</span><span class="ident" id="4145893">Rand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145899">if</span>&nbsp;<span class="ident" id="4145902">r</span>&nbsp;<span class="op" id="4145904">==</span>&nbsp;<span class="ident" id="4145907">nil</span>&nbsp;<span class="op" id="4145911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145915">return</span>&nbsp;<span class="ident" id="4145922">rand</span><span class="op" id="4145926">.</span><span class="ident" id="4145927">Reader</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4145935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4145938">return</span>&nbsp;<span class="ident" id="4145945">r</span><br>
<span class="lineno"></span><span class="op" id="4145947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4145950">func</span>&nbsp;<span class="op" id="4145955">(</span><span class="ident" id="4145956">c</span>&nbsp;<span class="op" id="4145958">*</span><span class="ident" id="4145959">Config</span><span class="op" id="4145965">)</span>&nbsp;<span class="ident" id="4145967">time</span><span class="op" id="4145971">(</span><span class="op" id="4145972">)</span>&nbsp;<span class="ident" id="4145974">time</span><span class="op" id="4145978">.</span><span class="ident" id="4145979">Time</span>&nbsp;<span class="op" id="4145984">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4145987">t</span>&nbsp;<span class="op" id="4145989">:=</span>&nbsp;<span class="ident" id="4145992">c</span><span class="op" id="4145993">.</span><span class="ident" id="4145994">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146000">if</span>&nbsp;<span class="ident" id="4146003">t</span>&nbsp;<span class="op" id="4146005">==</span>&nbsp;<span class="ident" id="4146008">nil</span>&nbsp;<span class="op" id="4146012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4146016">t</span>&nbsp;<span class="op" id="4146018">=</span>&nbsp;<span class="ident" id="4146020">time</span><span class="op" id="4146024">.</span><span class="ident" id="4146025">Now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4146030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146033">return</span>&nbsp;<span class="ident" id="4146040">t</span><span class="op" id="4146041">(</span><span class="op" id="4146042">)</span><br>
<span class="lineno">380</span><span class="op" id="4146044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4146047">func</span>&nbsp;<span class="op" id="4146052">(</span><span class="ident" id="4146053">c</span>&nbsp;<span class="op" id="4146055">*</span><span class="ident" id="4146056">Config</span><span class="op" id="4146062">)</span>&nbsp;<span class="ident" id="4146064">cipherSuites</span><span class="op" id="4146076">(</span><span class="op" id="4146077">)</span>&nbsp;<span class="op" id="4146079">[</span><span class="op" id="4146080">]</span><span class="builtintype" id="4146081">uint16</span>&nbsp;<span class="op" id="4146088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4146091">s</span>&nbsp;<span class="op" id="4146093">:=</span>&nbsp;<span class="ident" id="4146096">c</span><span class="op" id="4146097">.</span><span class="ident" id="4146098">CipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146112">if</span>&nbsp;<span class="ident" id="4146115">s</span>&nbsp;<span class="op" id="4146117">==</span>&nbsp;<span class="ident" id="4146120">nil</span>&nbsp;<span class="op" id="4146124">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4146128">s</span>&nbsp;<span class="op" id="4146130">=</span>&nbsp;<span class="ident" id="4146132">defaultCipherSuites</span><span class="op" id="4146151">(</span><span class="op" id="4146152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4146155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146158">return</span>&nbsp;<span class="ident" id="4146165">s</span><br>
<span class="lineno"></span><span class="op" id="4146167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="keyword" id="4146170">func</span>&nbsp;<span class="op" id="4146175">(</span><span class="ident" id="4146176">c</span>&nbsp;<span class="op" id="4146178">*</span><span class="ident" id="4146179">Config</span><span class="op" id="4146185">)</span>&nbsp;<span class="ident" id="4146187">minVersion</span><span class="op" id="4146197">(</span><span class="op" id="4146198">)</span>&nbsp;<span class="builtintype" id="4146200">uint16</span>&nbsp;<span class="op" id="4146207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146210">if</span>&nbsp;<span class="ident" id="4146213">c</span>&nbsp;<span class="op" id="4146215">==</span>&nbsp;<span class="ident" id="4146218">nil</span>&nbsp;<span class="op" id="4146222">||</span>&nbsp;<span class="ident" id="4146225">c</span><span class="op" id="4146226">.</span><span class="ident" id="4146227">MinVersion</span>&nbsp;<span class="op" id="4146238">==</span>&nbsp;<span class="num" id="4146241">0</span>&nbsp;<span class="op" id="4146243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146247">return</span>&nbsp;<span class="ident" id="4146254">minVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4146266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146269">return</span>&nbsp;<span class="ident" id="4146276">c</span><span class="op" id="4146277">.</span><span class="ident" id="4146278">MinVersion</span><br>
<span class="lineno">395</span><span class="op" id="4146289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4146292">func</span>&nbsp;<span class="op" id="4146297">(</span><span class="ident" id="4146298">c</span>&nbsp;<span class="op" id="4146300">*</span><span class="ident" id="4146301">Config</span><span class="op" id="4146307">)</span>&nbsp;<span class="ident" id="4146309">maxVersion</span><span class="op" id="4146319">(</span><span class="op" id="4146320">)</span>&nbsp;<span class="builtintype" id="4146322">uint16</span>&nbsp;<span class="op" id="4146329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146332">if</span>&nbsp;<span class="ident" id="4146335">c</span>&nbsp;<span class="op" id="4146337">==</span>&nbsp;<span class="ident" id="4146340">nil</span>&nbsp;<span class="op" id="4146344">||</span>&nbsp;<span class="ident" id="4146347">c</span><span class="op" id="4146348">.</span><span class="ident" id="4146349">MaxVersion</span>&nbsp;<span class="op" id="4146360">==</span>&nbsp;<span class="num" id="4146363">0</span>&nbsp;<span class="op" id="4146365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146369">return</span>&nbsp;<span class="ident" id="4146376">maxVersion</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4146388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146391">return</span>&nbsp;<span class="ident" id="4146398">c</span><span class="op" id="4146399">.</span><span class="ident" id="4146400">MaxVersion</span><br>
<span class="lineno"></span><span class="op" id="4146411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4146414">var</span>&nbsp;<span class="ident" id="4146418">defaultCurvePreferences</span>&nbsp;<span class="op" id="4146442">=</span>&nbsp;<span class="op" id="4146444">[</span><span class="op" id="4146445">]</span><span class="ident" id="4146446">CurveID</span><span class="op" id="4146453">{</span><span class="ident" id="4146454">CurveP256</span><span class="op" id="4146463">,</span>&nbsp;<span class="ident" id="4146465">CurveP384</span><span class="op" id="4146474">,</span>&nbsp;<span class="ident" id="4146476">CurveP521</span><span class="op" id="4146485">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="4146488">func</span>&nbsp;<span class="op" id="4146493">(</span><span class="ident" id="4146494">c</span>&nbsp;<span class="op" id="4146496">*</span><span class="ident" id="4146497">Config</span><span class="op" id="4146503">)</span>&nbsp;<span class="ident" id="4146505">curvePreferences</span><span class="op" id="4146521">(</span><span class="op" id="4146522">)</span>&nbsp;<span class="op" id="4146524">[</span><span class="op" id="4146525">]</span><span class="ident" id="4146526">CurveID</span>&nbsp;<span class="op" id="4146534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146537">if</span>&nbsp;<span class="ident" id="4146540">c</span>&nbsp;<span class="op" id="4146542">==</span>&nbsp;<span class="ident" id="4146545">nil</span>&nbsp;<span class="op" id="4146549">||</span>&nbsp;<span class="builtinfunc" id="4146552">len</span><span class="op" id="4146555">(</span><span class="ident" id="4146556">c</span><span class="op" id="4146557">.</span><span class="ident" id="4146558">CurvePreferences</span><span class="op" id="4146574">)</span>&nbsp;<span class="op" id="4146576">==</span>&nbsp;<span class="num" id="4146579">0</span>&nbsp;<span class="op" id="4146581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146585">return</span>&nbsp;<span class="ident" id="4146592">defaultCurvePreferences</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4146617">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146620">return</span>&nbsp;<span class="ident" id="4146627">c</span><span class="op" id="4146628">.</span><span class="ident" id="4146629">CurvePreferences</span><br>
<span class="lineno"></span><span class="op" id="4146646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4146649">//&nbsp;mutualVersion&nbsp;returns&nbsp;the&nbsp;protocol&nbsp;version&nbsp;to&nbsp;use&nbsp;given&nbsp;the&nbsp;advertised</span><br>
<span class="lineno"></span><span class="comment" id="4146723">//&nbsp;version&nbsp;of&nbsp;the&nbsp;peer.</span><br>
<span class="lineno">415</span><span class="keyword" id="4146747">func</span>&nbsp;<span class="op" id="4146752">(</span><span class="ident" id="4146753">c</span>&nbsp;<span class="op" id="4146755">*</span><span class="ident" id="4146756">Config</span><span class="op" id="4146762">)</span>&nbsp;<span class="ident" id="4146764">mutualVersion</span><span class="op" id="4146777">(</span><span class="ident" id="4146778">vers</span>&nbsp;<span class="builtintype" id="4146783">uint16</span><span class="op" id="4146789">)</span>&nbsp;<span class="op" id="4146791">(</span><span class="builtintype" id="4146792">uint16</span><span class="op" id="4146798">,</span>&nbsp;<span class="builtintype" id="4146800">bool</span><span class="op" id="4146804">)</span>&nbsp;<span class="op" id="4146806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4146809">minVersion</span>&nbsp;<span class="op" id="4146820">:=</span>&nbsp;<span class="ident" id="4146823">c</span><span class="op" id="4146824">.</span><span class="ident" id="4146825">minVersion</span><span class="op" id="4146835">(</span><span class="op" id="4146836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4146839">maxVersion</span>&nbsp;<span class="op" id="4146850">:=</span>&nbsp;<span class="ident" id="4146853">c</span><span class="op" id="4146854">.</span><span class="ident" id="4146855">maxVersion</span><span class="op" id="4146865">(</span><span class="op" id="4146866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146870">if</span>&nbsp;<span class="ident" id="4146873">vers</span>&nbsp;<span class="op" id="4146878">&lt;</span>&nbsp;<span class="ident" id="4146880">minVersion</span>&nbsp;<span class="op" id="4146891">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146895">return</span>&nbsp;<span class="num" id="4146902">0</span><span class="op" id="4146903">,</span>&nbsp;<span class="builtintype" id="4146905">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4146912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146915">if</span>&nbsp;<span class="ident" id="4146918">vers</span>&nbsp;<span class="op" id="4146923">&gt;</span>&nbsp;<span class="ident" id="4146925">maxVersion</span>&nbsp;<span class="op" id="4146936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4146940">vers</span>&nbsp;<span class="op" id="4146945">=</span>&nbsp;<span class="ident" id="4146947">maxVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4146959">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4146962">return</span>&nbsp;<span class="ident" id="4146969">vers</span><span class="op" id="4146973">,</span>&nbsp;<span class="builtintype" id="4146975">true</span><br>
<span class="lineno"></span><span class="op" id="4146980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4146983">//&nbsp;getCertificate&nbsp;returns&nbsp;the&nbsp;best&nbsp;certificate&nbsp;for&nbsp;the&nbsp;given&nbsp;ClientHelloInfo,</span><br>
<span class="lineno"></span><span class="comment" id="4147061">//&nbsp;defaulting&nbsp;to&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;c.Certificates.</span><br>
<span class="lineno">430</span><span class="keyword" id="4147115">func</span>&nbsp;<span class="op" id="4147120">(</span><span class="ident" id="4147121">c</span>&nbsp;<span class="op" id="4147123">*</span><span class="ident" id="4147124">Config</span><span class="op" id="4147130">)</span>&nbsp;<span class="ident" id="4147132">getCertificate</span><span class="op" id="4147146">(</span><span class="ident" id="4147147">clientHello</span>&nbsp;<span class="op" id="4147159">*</span><span class="ident" id="4147160">ClientHelloInfo</span><span class="op" id="4147175">)</span>&nbsp;<span class="op" id="4147177">(</span><span class="op" id="4147178">*</span><span class="ident" id="4147179">Certificate</span><span class="op" id="4147190">,</span>&nbsp;<span class="builtintype" id="4147192">error</span><span class="op" id="4147197">)</span>&nbsp;<span class="op" id="4147199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147202">if</span>&nbsp;<span class="ident" id="4147205">c</span><span class="op" id="4147206">.</span><span class="ident" id="4147207">GetCertificate</span>&nbsp;<span class="op" id="4147222">!=</span>&nbsp;<span class="ident" id="4147225">nil</span>&nbsp;<span class="op" id="4147229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147233">cert</span><span class="op" id="4147237">,</span>&nbsp;<span class="ident" id="4147239">err</span>&nbsp;<span class="op" id="4147243">:=</span>&nbsp;<span class="ident" id="4147246">c</span><span class="op" id="4147247">.</span><span class="ident" id="4147248">GetCertificate</span><span class="op" id="4147262">(</span><span class="ident" id="4147263">clientHello</span><span class="op" id="4147274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147278">if</span>&nbsp;<span class="ident" id="4147281">cert</span>&nbsp;<span class="op" id="4147286">!=</span>&nbsp;<span class="ident" id="4147289">nil</span>&nbsp;<span class="op" id="4147293">||</span>&nbsp;<span class="ident" id="4147296">err</span>&nbsp;<span class="op" id="4147300">!=</span>&nbsp;<span class="ident" id="4147303">nil</span>&nbsp;<span class="op" id="4147307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147312">return</span>&nbsp;<span class="ident" id="4147319">cert</span><span class="op" id="4147323">,</span>&nbsp;<span class="ident" id="4147325">err</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4147331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4147334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147338">if</span>&nbsp;<span class="builtinfunc" id="4147341">len</span><span class="op" id="4147344">(</span><span class="ident" id="4147345">c</span><span class="op" id="4147346">.</span><span class="ident" id="4147347">Certificates</span><span class="op" id="4147359">)</span>&nbsp;<span class="op" id="4147361">==</span>&nbsp;<span class="num" id="4147364">1</span>&nbsp;<span class="op" id="4147366">||</span>&nbsp;<span class="ident" id="4147369">c</span><span class="op" id="4147370">.</span><span class="ident" id="4147371">NameToCertificate</span>&nbsp;<span class="op" id="4147389">==</span>&nbsp;<span class="ident" id="4147392">nil</span>&nbsp;<span class="op" id="4147396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4147400">//&nbsp;There&#39;s&nbsp;only&nbsp;one&nbsp;choice,&nbsp;so&nbsp;no&nbsp;point&nbsp;doing&nbsp;any&nbsp;work.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147458">return</span>&nbsp;<span class="op" id="4147465">&amp;</span><span class="ident" id="4147466">c</span><span class="op" id="4147467">.</span><span class="ident" id="4147468">Certificates</span><span class="op" id="4147480">[</span><span class="num" id="4147481">0</span><span class="op" id="4147482">]</span><span class="op" id="4147483">,</span>&nbsp;<span class="ident" id="4147485">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4147490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147494">name</span>&nbsp;<span class="op" id="4147499">:=</span>&nbsp;<span class="ident" id="4147502">strings</span><span class="op" id="4147509">.</span><span class="ident" id="4147510">ToLower</span><span class="op" id="4147517">(</span><span class="ident" id="4147518">clientHello</span><span class="op" id="4147529">.</span><span class="ident" id="4147530">ServerName</span><span class="op" id="4147540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147543">for</span>&nbsp;<span class="builtinfunc" id="4147547">len</span><span class="op" id="4147550">(</span><span class="ident" id="4147551">name</span><span class="op" id="4147555">)</span>&nbsp;<span class="op" id="4147557">&gt;</span>&nbsp;<span class="num" id="4147559">0</span>&nbsp;<span class="op" id="4147561">&amp;&amp;</span>&nbsp;<span class="ident" id="4147564">name</span><span class="op" id="4147568">[</span><span class="builtinfunc" id="4147569">len</span><span class="op" id="4147572">(</span><span class="ident" id="4147573">name</span><span class="op" id="4147577">)</span><span class="op" id="4147578">-</span><span class="num" id="4147579">1</span><span class="op" id="4147580">]</span>&nbsp;<span class="op" id="4147582">==</span>&nbsp;<span class="string" id="4147585">&#39;.&#39;</span>&nbsp;<span class="op" id="4147589">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147593">name</span>&nbsp;<span class="op" id="4147598">=</span>&nbsp;<span class="ident" id="4147600">name</span><span class="op" id="4147604">[</span><span class="op" id="4147605">:</span><span class="builtinfunc" id="4147606">len</span><span class="op" id="4147609">(</span><span class="ident" id="4147610">name</span><span class="op" id="4147614">)</span><span class="op" id="4147615">-</span><span class="num" id="4147616">1</span><span class="op" id="4147617">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4147620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147624">if</span>&nbsp;<span class="ident" id="4147627">cert</span><span class="op" id="4147631">,</span>&nbsp;<span class="ident" id="4147633">ok</span>&nbsp;<span class="op" id="4147636">:=</span>&nbsp;<span class="ident" id="4147639">c</span><span class="op" id="4147640">.</span><span class="ident" id="4147641">NameToCertificate</span><span class="op" id="4147658">[</span><span class="ident" id="4147659">name</span><span class="op" id="4147663">]</span><span class="op" id="4147664">;</span>&nbsp;<span class="ident" id="4147666">ok</span>&nbsp;<span class="op" id="4147669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147673">return</span>&nbsp;<span class="ident" id="4147680">cert</span><span class="op" id="4147684">,</span>&nbsp;<span class="ident" id="4147686">nil</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4147691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4147695">//&nbsp;try&nbsp;replacing&nbsp;labels&nbsp;in&nbsp;the&nbsp;name&nbsp;with&nbsp;wildcards&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4147762">//&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147773">labels</span>&nbsp;<span class="op" id="4147780">:=</span>&nbsp;<span class="ident" id="4147783">strings</span><span class="op" id="4147790">.</span><span class="ident" id="4147791">Split</span><span class="op" id="4147796">(</span><span class="ident" id="4147797">name</span><span class="op" id="4147801">,</span>&nbsp;<span class="string" id="4147803">&#34;.&#34;</span><span class="op" id="4147806">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147809">for</span>&nbsp;<span class="ident" id="4147813">i</span>&nbsp;<span class="op" id="4147815">:=</span>&nbsp;<span class="keyword" id="4147818">range</span>&nbsp;<span class="ident" id="4147824">labels</span>&nbsp;<span class="op" id="4147831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147835">labels</span><span class="op" id="4147841">[</span><span class="ident" id="4147842">i</span><span class="op" id="4147843">]</span>&nbsp;<span class="op" id="4147845">=</span>&nbsp;<span class="string" id="4147847">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4147853">candidate</span>&nbsp;<span class="op" id="4147863">:=</span>&nbsp;<span class="ident" id="4147866">strings</span><span class="op" id="4147873">.</span><span class="ident" id="4147874">Join</span><span class="op" id="4147878">(</span><span class="ident" id="4147879">labels</span><span class="op" id="4147885">,</span>&nbsp;<span class="string" id="4147887">&#34;.&#34;</span><span class="op" id="4147890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147894">if</span>&nbsp;<span class="ident" id="4147897">cert</span><span class="op" id="4147901">,</span>&nbsp;<span class="ident" id="4147903">ok</span>&nbsp;<span class="op" id="4147906">:=</span>&nbsp;<span class="ident" id="4147909">c</span><span class="op" id="4147910">.</span><span class="ident" id="4147911">NameToCertificate</span><span class="op" id="4147928">[</span><span class="ident" id="4147929">candidate</span><span class="op" id="4147938">]</span><span class="op" id="4147939">;</span>&nbsp;<span class="ident" id="4147941">ok</span>&nbsp;<span class="op" id="4147944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4147949">return</span>&nbsp;<span class="ident" id="4147956">cert</span><span class="op" id="4147960">,</span>&nbsp;<span class="ident" id="4147962">nil</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4147968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4147971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4147975">//&nbsp;If&nbsp;nothing&nbsp;matches,&nbsp;return&nbsp;the&nbsp;first&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148029">return</span>&nbsp;<span class="op" id="4148036">&amp;</span><span class="ident" id="4148037">c</span><span class="op" id="4148038">.</span><span class="ident" id="4148039">Certificates</span><span class="op" id="4148051">[</span><span class="num" id="4148052">0</span><span class="op" id="4148053">]</span><span class="op" id="4148054">,</span>&nbsp;<span class="ident" id="4148056">nil</span><br>
<span class="lineno">465</span><span class="op" id="4148060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4148063">//&nbsp;BuildNameToCertificate&nbsp;parses&nbsp;c.Certificates&nbsp;and&nbsp;builds&nbsp;c.NameToCertificate</span><br>
<span class="lineno"></span><span class="comment" id="4148142">//&nbsp;from&nbsp;the&nbsp;CommonName&nbsp;and&nbsp;SubjectAlternateName&nbsp;fields&nbsp;of&nbsp;each&nbsp;of&nbsp;the&nbsp;leaf</span><br>
<span class="lineno"></span><span class="comment" id="4148217">//&nbsp;certificates.</span><br>
<span class="lineno">470</span><span class="keyword" id="4148234">func</span>&nbsp;<span class="op" id="4148239">(</span><span class="ident" id="4148240">c</span>&nbsp;<span class="op" id="4148242">*</span><span class="ident" id="4148243">Config</span><span class="op" id="4148249">)</span>&nbsp;<span class="ident" id="4148251">BuildNameToCertificate</span><span class="op" id="4148273">(</span><span class="op" id="4148274">)</span>&nbsp;<span class="op" id="4148276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148279">c</span><span class="op" id="4148280">.</span><span class="ident" id="4148281">NameToCertificate</span>&nbsp;<span class="op" id="4148299">=</span>&nbsp;<span class="builtinfunc" id="4148301">make</span><span class="op" id="4148305">(</span><span class="keyword" id="4148306">map</span><span class="op" id="4148309">[</span><span class="builtintype" id="4148310">string</span><span class="op" id="4148316">]</span><span class="op" id="4148317">*</span><span class="ident" id="4148318">Certificate</span><span class="op" id="4148329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148332">for</span>&nbsp;<span class="ident" id="4148336">i</span>&nbsp;<span class="op" id="4148338">:=</span>&nbsp;<span class="keyword" id="4148341">range</span>&nbsp;<span class="ident" id="4148347">c</span><span class="op" id="4148348">.</span><span class="ident" id="4148349">Certificates</span>&nbsp;<span class="op" id="4148362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148366">cert</span>&nbsp;<span class="op" id="4148371">:=</span>&nbsp;<span class="op" id="4148374">&amp;</span><span class="ident" id="4148375">c</span><span class="op" id="4148376">.</span><span class="ident" id="4148377">Certificates</span><span class="op" id="4148389">[</span><span class="ident" id="4148390">i</span><span class="op" id="4148391">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148395">x509Cert</span><span class="op" id="4148403">,</span>&nbsp;<span class="ident" id="4148405">err</span>&nbsp;<span class="op" id="4148409">:=</span>&nbsp;<span class="ident" id="4148412">x509</span><span class="op" id="4148416">.</span><span class="ident" id="4148417">ParseCertificate</span><span class="op" id="4148433">(</span><span class="ident" id="4148434">cert</span><span class="op" id="4148438">.</span><span class="ident" id="4148439">Certificate</span><span class="op" id="4148450">[</span><span class="num" id="4148451">0</span><span class="op" id="4148452">]</span><span class="op" id="4148453">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148457">if</span>&nbsp;<span class="ident" id="4148460">err</span>&nbsp;<span class="op" id="4148464">!=</span>&nbsp;<span class="ident" id="4148467">nil</span>&nbsp;<span class="op" id="4148471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148476">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4148487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148491">if</span>&nbsp;<span class="builtinfunc" id="4148494">len</span><span class="op" id="4148497">(</span><span class="ident" id="4148498">x509Cert</span><span class="op" id="4148506">.</span><span class="ident" id="4148507">Subject</span><span class="op" id="4148514">.</span><span class="ident" id="4148515">CommonName</span><span class="op" id="4148525">)</span>&nbsp;<span class="op" id="4148527">&gt;</span>&nbsp;<span class="num" id="4148529">0</span>&nbsp;<span class="op" id="4148531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148536">c</span><span class="op" id="4148537">.</span><span class="ident" id="4148538">NameToCertificate</span><span class="op" id="4148555">[</span><span class="ident" id="4148556">x509Cert</span><span class="op" id="4148564">.</span><span class="ident" id="4148565">Subject</span><span class="op" id="4148572">.</span><span class="ident" id="4148573">CommonName</span><span class="op" id="4148583">]</span>&nbsp;<span class="op" id="4148585">=</span>&nbsp;<span class="ident" id="4148587">cert</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4148594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4148598">for</span>&nbsp;<span class="ident" id="4148602">_</span><span class="op" id="4148603">,</span>&nbsp;<span class="ident" id="4148605">san</span>&nbsp;<span class="op" id="4148609">:=</span>&nbsp;<span class="keyword" id="4148612">range</span>&nbsp;<span class="ident" id="4148618">x509Cert</span><span class="op" id="4148626">.</span><span class="ident" id="4148627">DNSNames</span>&nbsp;<span class="op" id="4148636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148641">c</span><span class="op" id="4148642">.</span><span class="ident" id="4148643">NameToCertificate</span><span class="op" id="4148660">[</span><span class="ident" id="4148661">san</span><span class="op" id="4148664">]</span>&nbsp;<span class="op" id="4148666">=</span>&nbsp;<span class="ident" id="4148668">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4148675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4148678">}</span><br>
<span class="lineno">485</span><span class="op" id="4148680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4148683">//&nbsp;A&nbsp;Certificate&nbsp;is&nbsp;a&nbsp;chain&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;certificates,&nbsp;leaf&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="4148752">type</span>&nbsp;<span class="ident" id="4148757">Certificate</span>&nbsp;<span class="keyword" id="4148769">struct</span>&nbsp;<span class="op" id="4148776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4148779">Certificate</span>&nbsp;<span class="op" id="4148791">[</span><span class="op" id="4148792">]</span><span class="op" id="4148793">[</span><span class="op" id="4148794">]</span><span class="builtintype" id="4148795">byte</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4148801">//&nbsp;PrivateKey&nbsp;contains&nbsp;the&nbsp;private&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;public&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4148873">//&nbsp;in&nbsp;Leaf.&nbsp;For&nbsp;a&nbsp;server,&nbsp;this&nbsp;must&nbsp;be&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4148934">//&nbsp;*ecdsa.PrivateKey.&nbsp;For&nbsp;a&nbsp;client&nbsp;doing&nbsp;client&nbsp;authentication,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149004">//&nbsp;can&nbsp;be&nbsp;any&nbsp;type&nbsp;that&nbsp;implements&nbsp;crypto.Signer&nbsp;(which&nbsp;includes&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149074">//&nbsp;and&nbsp;ECDSA&nbsp;private&nbsp;keys).</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149103">PrivateKey</span>&nbsp;<span class="ident" id="4149114">crypto</span><span class="op" id="4149120">.</span><span class="ident" id="4149121">PrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149133">//&nbsp;OCSPStaple&nbsp;contains&nbsp;an&nbsp;optional&nbsp;OCSP&nbsp;response&nbsp;which&nbsp;will&nbsp;be&nbsp;served</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149204">//&nbsp;to&nbsp;clients&nbsp;that&nbsp;request&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149236">OCSPStaple</span>&nbsp;<span class="op" id="4149247">[</span><span class="op" id="4149248">]</span><span class="builtintype" id="4149249">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149255">//&nbsp;Leaf&nbsp;is&nbsp;the&nbsp;parsed&nbsp;form&nbsp;of&nbsp;the&nbsp;leaf&nbsp;certificate,&nbsp;which&nbsp;may&nbsp;be</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149321">//&nbsp;initialized&nbsp;using&nbsp;x509.ParseCertificate&nbsp;to&nbsp;reduce&nbsp;per-handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149389">//&nbsp;processing&nbsp;for&nbsp;TLS&nbsp;clients&nbsp;doing&nbsp;client&nbsp;authentication.&nbsp;If&nbsp;nil,&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149461">//&nbsp;leaf&nbsp;certificate&nbsp;will&nbsp;be&nbsp;parsed&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149508">Leaf</span>&nbsp;<span class="op" id="4149513">*</span><span class="ident" id="4149514">x509</span><span class="op" id="4149518">.</span><span class="ident" id="4149519">Certificate</span><br>
<span class="lineno"></span><span class="op" id="4149531">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span><span class="comment" id="4149534">//&nbsp;A&nbsp;TLS&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="4149551">type</span>&nbsp;<span class="ident" id="4149556">record</span>&nbsp;<span class="keyword" id="4149563">struct</span>&nbsp;<span class="op" id="4149570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149573">contentType</span>&nbsp;&nbsp;<span class="ident" id="4149586">recordType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149598">major</span><span class="op" id="4149603">,</span>&nbsp;<span class="ident" id="4149605">minor</span>&nbsp;<span class="builtintype" id="4149611">uint8</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149618">payload</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4149631">[</span><span class="op" id="4149632">]</span><span class="builtintype" id="4149633">byte</span><br>
<span class="lineno"></span><span class="op" id="4149638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4149641">type</span>&nbsp;<span class="ident" id="4149646">handshakeMessage</span>&nbsp;<span class="keyword" id="4149663">interface</span>&nbsp;<span class="op" id="4149673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149676">marshal</span><span class="op" id="4149683">(</span><span class="op" id="4149684">)</span>&nbsp;<span class="op" id="4149686">[</span><span class="op" id="4149687">]</span><span class="builtintype" id="4149688">byte</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149694">unmarshal</span><span class="op" id="4149703">(</span><span class="op" id="4149704">[</span><span class="op" id="4149705">]</span><span class="builtintype" id="4149706">byte</span><span class="op" id="4149710">)</span>&nbsp;<span class="builtintype" id="4149712">bool</span><br>
<span class="lineno"></span><span class="op" id="4149717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4149720">//&nbsp;lruSessionCache&nbsp;is&nbsp;a&nbsp;ClientSessionCache&nbsp;implementation&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU</span><br>
<span class="lineno"></span><span class="comment" id="4149795">//&nbsp;caching&nbsp;strategy.</span><br>
<span class="lineno">520</span><span class="keyword" id="4149816">type</span>&nbsp;<span class="ident" id="4149821">lruSessionCache</span>&nbsp;<span class="keyword" id="4149837">struct</span>&nbsp;<span class="op" id="4149844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149847">sync</span><span class="op" id="4149851">.</span><span class="ident" id="4149852">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149860">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4149869">map</span><span class="op" id="4149872">[</span><span class="builtintype" id="4149873">string</span><span class="op" id="4149879">]</span><span class="op" id="4149880">*</span><span class="ident" id="4149881">list</span><span class="op" id="4149885">.</span><span class="ident" id="4149886">Element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149895">q</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4149904">*</span><span class="ident" id="4149905">list</span><span class="op" id="4149909">.</span><span class="ident" id="4149910">List</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149916">capacity</span>&nbsp;<span class="builtintype" id="4149925">int</span><br>
<span class="lineno"></span><span class="op" id="4149929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4149932">type</span>&nbsp;<span class="ident" id="4149937">lruSessionCacheEntry</span>&nbsp;<span class="keyword" id="4149958">struct</span>&nbsp;<span class="op" id="4149965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149968">sessionKey</span>&nbsp;<span class="builtintype" id="4149979">string</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149987">state</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4149998">*</span><span class="ident" id="4149999">ClientSessionState</span><br>
<span class="lineno"></span><span class="op" id="4150018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4150021">//&nbsp;NewLRUClientSessionCache&nbsp;returns&nbsp;a&nbsp;ClientSessionCache&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="4150093">//&nbsp;capacity&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU&nbsp;strategy.&nbsp;If&nbsp;capacity&nbsp;is&nbsp;&lt;&nbsp;1,&nbsp;a&nbsp;default&nbsp;capacity</span><br>
<span class="lineno">535</span><span class="comment" id="4150171">//&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="4150191">func</span>&nbsp;<span class="ident" id="4150196">NewLRUClientSessionCache</span><span class="op" id="4150220">(</span><span class="ident" id="4150221">capacity</span>&nbsp;<span class="builtintype" id="4150230">int</span><span class="op" id="4150233">)</span>&nbsp;<span class="ident" id="4150235">ClientSessionCache</span>&nbsp;<span class="op" id="4150254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150257">const</span>&nbsp;<span class="ident" id="4150263">defaultSessionCacheCapacity</span>&nbsp;<span class="op" id="4150291">=</span>&nbsp;<span class="num" id="4150293">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150298">if</span>&nbsp;<span class="ident" id="4150301">capacity</span>&nbsp;<span class="op" id="4150310">&lt;</span>&nbsp;<span class="num" id="4150312">1</span>&nbsp;<span class="op" id="4150314">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150318">capacity</span>&nbsp;<span class="op" id="4150327">=</span>&nbsp;<span class="ident" id="4150329">defaultSessionCacheCapacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150361">return</span>&nbsp;<span class="op" id="4150368">&amp;</span><span class="ident" id="4150369">lruSessionCache</span><span class="op" id="4150384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150388">m</span><span class="op" id="4150389">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4150398">make</span><span class="op" id="4150402">(</span><span class="keyword" id="4150403">map</span><span class="op" id="4150406">[</span><span class="builtintype" id="4150407">string</span><span class="op" id="4150413">]</span><span class="op" id="4150414">*</span><span class="ident" id="4150415">list</span><span class="op" id="4150419">.</span><span class="ident" id="4150420">Element</span><span class="op" id="4150427">)</span><span class="op" id="4150428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150432">q</span><span class="op" id="4150433">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4150442">list</span><span class="op" id="4150446">.</span><span class="ident" id="4150447">New</span><span class="op" id="4150450">(</span><span class="op" id="4150451">)</span><span class="op" id="4150452">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150456">capacity</span><span class="op" id="4150464">:</span>&nbsp;<span class="ident" id="4150466">capacity</span><span class="op" id="4150474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150477">}</span><br>
<span class="lineno"></span><span class="op" id="4150479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4150482">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;provided&nbsp;(sessionKey,&nbsp;cs)&nbsp;pair&nbsp;to&nbsp;the&nbsp;cache.</span><br>
<span class="lineno">550</span><span class="keyword" id="4150543">func</span>&nbsp;<span class="op" id="4150548">(</span><span class="ident" id="4150549">c</span>&nbsp;<span class="op" id="4150551">*</span><span class="ident" id="4150552">lruSessionCache</span><span class="op" id="4150567">)</span>&nbsp;<span class="ident" id="4150569">Put</span><span class="op" id="4150572">(</span><span class="ident" id="4150573">sessionKey</span>&nbsp;<span class="builtintype" id="4150584">string</span><span class="op" id="4150590">,</span>&nbsp;<span class="ident" id="4150592">cs</span>&nbsp;<span class="op" id="4150595">*</span><span class="ident" id="4150596">ClientSessionState</span><span class="op" id="4150614">)</span>&nbsp;<span class="op" id="4150616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150619">c</span><span class="op" id="4150620">.</span><span class="ident" id="4150621">Lock</span><span class="op" id="4150625">(</span><span class="op" id="4150626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150629">defer</span>&nbsp;<span class="ident" id="4150635">c</span><span class="op" id="4150636">.</span><span class="ident" id="4150637">Unlock</span><span class="op" id="4150643">(</span><span class="op" id="4150644">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150648">if</span>&nbsp;<span class="ident" id="4150651">elem</span><span class="op" id="4150655">,</span>&nbsp;<span class="ident" id="4150657">ok</span>&nbsp;<span class="op" id="4150660">:=</span>&nbsp;<span class="ident" id="4150663">c</span><span class="op" id="4150664">.</span><span class="ident" id="4150665">m</span><span class="op" id="4150666">[</span><span class="ident" id="4150667">sessionKey</span><span class="op" id="4150677">]</span><span class="op" id="4150678">;</span>&nbsp;<span class="ident" id="4150680">ok</span>&nbsp;<span class="op" id="4150683">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150687">entry</span>&nbsp;<span class="op" id="4150693">:=</span>&nbsp;<span class="ident" id="4150696">elem</span><span class="op" id="4150700">.</span><span class="ident" id="4150701">Value</span><span class="op" id="4150706">.</span><span class="op" id="4150707">(</span><span class="op" id="4150708">*</span><span class="ident" id="4150709">lruSessionCacheEntry</span><span class="op" id="4150729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150733">entry</span><span class="op" id="4150738">.</span><span class="ident" id="4150739">state</span>&nbsp;<span class="op" id="4150745">=</span>&nbsp;<span class="ident" id="4150747">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150752">c</span><span class="op" id="4150753">.</span><span class="ident" id="4150754">q</span><span class="op" id="4150755">.</span><span class="ident" id="4150756">MoveToFront</span><span class="op" id="4150767">(</span><span class="ident" id="4150768">elem</span><span class="op" id="4150772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150776">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150784">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150788">if</span>&nbsp;<span class="ident" id="4150791">c</span><span class="op" id="4150792">.</span><span class="ident" id="4150793">q</span><span class="op" id="4150794">.</span><span class="ident" id="4150795">Len</span><span class="op" id="4150798">(</span><span class="op" id="4150799">)</span>&nbsp;<span class="op" id="4150801">&lt;</span>&nbsp;<span class="ident" id="4150803">c</span><span class="op" id="4150804">.</span><span class="ident" id="4150805">capacity</span>&nbsp;<span class="op" id="4150814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150818">entry</span>&nbsp;<span class="op" id="4150824">:=</span>&nbsp;<span class="op" id="4150827">&amp;</span><span class="ident" id="4150828">lruSessionCacheEntry</span><span class="op" id="4150848">{</span><span class="ident" id="4150849">sessionKey</span><span class="op" id="4150859">,</span>&nbsp;<span class="ident" id="4150861">cs</span><span class="op" id="4150863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150867">c</span><span class="op" id="4150868">.</span><span class="ident" id="4150869">m</span><span class="op" id="4150870">[</span><span class="ident" id="4150871">sessionKey</span><span class="op" id="4150881">]</span>&nbsp;<span class="op" id="4150883">=</span>&nbsp;<span class="ident" id="4150885">c</span><span class="op" id="4150886">.</span><span class="ident" id="4150887">q</span><span class="op" id="4150888">.</span><span class="ident" id="4150889">PushFront</span><span class="op" id="4150898">(</span><span class="ident" id="4150899">entry</span><span class="op" id="4150904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150908">return</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150920">elem</span>&nbsp;<span class="op" id="4150925">:=</span>&nbsp;<span class="ident" id="4150928">c</span><span class="op" id="4150929">.</span><span class="ident" id="4150930">q</span><span class="op" id="4150931">.</span><span class="ident" id="4150932">Back</span><span class="op" id="4150936">(</span><span class="op" id="4150937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150940">entry</span>&nbsp;<span class="op" id="4150946">:=</span>&nbsp;<span class="ident" id="4150949">elem</span><span class="op" id="4150953">.</span><span class="ident" id="4150954">Value</span><span class="op" id="4150959">.</span><span class="op" id="4150960">(</span><span class="op" id="4150961">*</span><span class="ident" id="4150962">lruSessionCacheEntry</span><span class="op" id="4150982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4150985">delete</span><span class="op" id="4150991">(</span><span class="ident" id="4150992">c</span><span class="op" id="4150993">.</span><span class="ident" id="4150994">m</span><span class="op" id="4150995">,</span>&nbsp;<span class="ident" id="4150997">entry</span><span class="op" id="4151002">.</span><span class="ident" id="4151003">sessionKey</span><span class="op" id="4151013">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151016">entry</span><span class="op" id="4151021">.</span><span class="ident" id="4151022">sessionKey</span>&nbsp;<span class="op" id="4151033">=</span>&nbsp;<span class="ident" id="4151035">sessionKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151047">entry</span><span class="op" id="4151052">.</span><span class="ident" id="4151053">state</span>&nbsp;<span class="op" id="4151059">=</span>&nbsp;<span class="ident" id="4151061">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151065">c</span><span class="op" id="4151066">.</span><span class="ident" id="4151067">q</span><span class="op" id="4151068">.</span><span class="ident" id="4151069">MoveToFront</span><span class="op" id="4151080">(</span><span class="ident" id="4151081">elem</span><span class="op" id="4151085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151088">c</span><span class="op" id="4151089">.</span><span class="ident" id="4151090">m</span><span class="op" id="4151091">[</span><span class="ident" id="4151092">sessionKey</span><span class="op" id="4151102">]</span>&nbsp;<span class="op" id="4151104">=</span>&nbsp;<span class="ident" id="4151106">elem</span><br>
<span class="lineno"></span><span class="op" id="4151111">}</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="comment" id="4151114">//&nbsp;Get&nbsp;returns&nbsp;the&nbsp;ClientSessionState&nbsp;value&nbsp;associated&nbsp;with&nbsp;a&nbsp;given&nbsp;key.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4151190">//&nbsp;returns&nbsp;(nil,&nbsp;false)&nbsp;if&nbsp;no&nbsp;value&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="4151236">func</span>&nbsp;<span class="op" id="4151241">(</span><span class="ident" id="4151242">c</span>&nbsp;<span class="op" id="4151244">*</span><span class="ident" id="4151245">lruSessionCache</span><span class="op" id="4151260">)</span>&nbsp;<span class="ident" id="4151262">Get</span><span class="op" id="4151265">(</span><span class="ident" id="4151266">sessionKey</span>&nbsp;<span class="builtintype" id="4151277">string</span><span class="op" id="4151283">)</span>&nbsp;<span class="op" id="4151285">(</span><span class="op" id="4151286">*</span><span class="ident" id="4151287">ClientSessionState</span><span class="op" id="4151305">,</span>&nbsp;<span class="builtintype" id="4151307">bool</span><span class="op" id="4151311">)</span>&nbsp;<span class="op" id="4151313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151316">c</span><span class="op" id="4151317">.</span><span class="ident" id="4151318">Lock</span><span class="op" id="4151322">(</span><span class="op" id="4151323">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151326">defer</span>&nbsp;<span class="ident" id="4151332">c</span><span class="op" id="4151333">.</span><span class="ident" id="4151334">Unlock</span><span class="op" id="4151340">(</span><span class="op" id="4151341">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151345">if</span>&nbsp;<span class="ident" id="4151348">elem</span><span class="op" id="4151352">,</span>&nbsp;<span class="ident" id="4151354">ok</span>&nbsp;<span class="op" id="4151357">:=</span>&nbsp;<span class="ident" id="4151360">c</span><span class="op" id="4151361">.</span><span class="ident" id="4151362">m</span><span class="op" id="4151363">[</span><span class="ident" id="4151364">sessionKey</span><span class="op" id="4151374">]</span><span class="op" id="4151375">;</span>&nbsp;<span class="ident" id="4151377">ok</span>&nbsp;<span class="op" id="4151380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151384">c</span><span class="op" id="4151385">.</span><span class="ident" id="4151386">q</span><span class="op" id="4151387">.</span><span class="ident" id="4151388">MoveToFront</span><span class="op" id="4151399">(</span><span class="ident" id="4151400">elem</span><span class="op" id="4151404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151408">return</span>&nbsp;<span class="ident" id="4151415">elem</span><span class="op" id="4151419">.</span><span class="ident" id="4151420">Value</span><span class="op" id="4151425">.</span><span class="op" id="4151426">(</span><span class="op" id="4151427">*</span><span class="ident" id="4151428">lruSessionCacheEntry</span><span class="op" id="4151448">)</span><span class="op" id="4151449">.</span><span class="ident" id="4151450">state</span><span class="op" id="4151455">,</span>&nbsp;<span class="builtintype" id="4151457">true</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151466">return</span>&nbsp;<span class="ident" id="4151473">nil</span><span class="op" id="4151476">,</span>&nbsp;<span class="builtintype" id="4151478">false</span><br>
<span class="lineno"></span><span class="op" id="4151484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4151487">//&nbsp;TODO(jsing):&nbsp;Make&nbsp;these&nbsp;available&nbsp;to&nbsp;both&nbsp;crypto/x509&nbsp;and&nbsp;crypto/tls.</span><br>
<span class="lineno">590</span><span class="keyword" id="4151560">type</span>&nbsp;<span class="ident" id="4151565">dsaSignature</span>&nbsp;<span class="keyword" id="4151578">struct</span>&nbsp;<span class="op" id="4151585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151588">R</span><span class="op" id="4151589">,</span>&nbsp;<span class="ident" id="4151591">S</span>&nbsp;<span class="op" id="4151593">*</span><span class="ident" id="4151594">big</span><span class="op" id="4151597">.</span><span class="ident" id="4151598">Int</span><br>
<span class="lineno"></span><span class="op" id="4151602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4151605">type</span>&nbsp;<span class="ident" id="4151610">ecdsaSignature</span>&nbsp;<span class="ident" id="4151625">dsaSignature</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="4151639">var</span>&nbsp;<span class="ident" id="4151643">emptyConfig</span>&nbsp;<span class="ident" id="4151655">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4151663">func</span>&nbsp;<span class="ident" id="4151668">defaultConfig</span><span class="op" id="4151681">(</span><span class="op" id="4151682">)</span>&nbsp;<span class="op" id="4151684">*</span><span class="ident" id="4151685">Config</span>&nbsp;<span class="op" id="4151692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151695">return</span>&nbsp;<span class="op" id="4151702">&amp;</span><span class="ident" id="4151703">emptyConfig</span><br>
<span class="lineno">600</span><span class="op" id="4151715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4151718">var</span>&nbsp;<span class="op" id="4151722">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151725">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4151748">sync</span><span class="op" id="4151752">.</span><span class="ident" id="4151753">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151759">varDefaultCipherSuites</span>&nbsp;<span class="op" id="4151782">[</span><span class="op" id="4151783">]</span><span class="builtintype" id="4151784">uint16</span><br>
<span class="lineno">605</span><span class="op" id="4151791">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4151794">func</span>&nbsp;<span class="ident" id="4151799">defaultCipherSuites</span><span class="op" id="4151818">(</span><span class="op" id="4151819">)</span>&nbsp;<span class="op" id="4151821">[</span><span class="op" id="4151822">]</span><span class="builtintype" id="4151823">uint16</span>&nbsp;<span class="op" id="4151830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151833">once</span><span class="op" id="4151837">.</span><span class="ident" id="4151838">Do</span><span class="op" id="4151840">(</span><span class="ident" id="4151841">initDefaultCipherSuites</span><span class="op" id="4151864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151867">return</span>&nbsp;<span class="ident" id="4151874">varDefaultCipherSuites</span><br>
<span class="lineno">610</span><span class="op" id="4151897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4151900">func</span>&nbsp;<span class="ident" id="4151905">initDefaultCipherSuites</span><span class="op" id="4151928">(</span><span class="op" id="4151929">)</span>&nbsp;<span class="op" id="4151931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151934">varDefaultCipherSuites</span>&nbsp;<span class="op" id="4151957">=</span>&nbsp;<span class="builtinfunc" id="4151959">make</span><span class="op" id="4151963">(</span><span class="op" id="4151964">[</span><span class="op" id="4151965">]</span><span class="builtintype" id="4151966">uint16</span><span class="op" id="4151972">,</span>&nbsp;<span class="builtinfunc" id="4151974">len</span><span class="op" id="4151977">(</span><span class="ident" id="4151978">cipherSuites</span><span class="op" id="4151990">)</span><span class="op" id="4151991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151994">for</span>&nbsp;<span class="ident" id="4151998">i</span><span class="op" id="4151999">,</span>&nbsp;<span class="ident" id="4152001">suite</span>&nbsp;<span class="op" id="4152007">:=</span>&nbsp;<span class="keyword" id="4152010">range</span>&nbsp;<span class="ident" id="4152016">cipherSuites</span>&nbsp;<span class="op" id="4152029">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152033">varDefaultCipherSuites</span><span class="op" id="4152055">[</span><span class="ident" id="4152056">i</span><span class="op" id="4152057">]</span>&nbsp;<span class="op" id="4152059">=</span>&nbsp;<span class="ident" id="4152061">suite</span><span class="op" id="4152066">.</span><span class="ident" id="4152067">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4152071">}</span><br>
<span class="lineno"></span><span class="op" id="4152073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4152076">func</span>&nbsp;<span class="ident" id="4152081">unexpectedMessageError</span><span class="op" id="4152103">(</span><span class="ident" id="4152104">wanted</span><span class="op" id="4152110">,</span>&nbsp;<span class="ident" id="4152112">got</span>&nbsp;<span class="keyword" id="4152116">interface</span><span class="op" id="4152125">{</span><span class="op" id="4152126">}</span><span class="op" id="4152127">)</span>&nbsp;<span class="builtintype" id="4152129">error</span>&nbsp;<span class="op" id="4152135">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152138">return</span>&nbsp;<span class="ident" id="4152145">fmt</span><span class="op" id="4152148">.</span><span class="ident" id="4152149">Errorf</span><span class="op" id="4152155">(</span><span class="string" id="4152156">&#34;tls:&nbsp;received&nbsp;unexpected&nbsp;handshake&nbsp;message&nbsp;of&nbsp;type&nbsp;%T&nbsp;when&nbsp;waiting&nbsp;for&nbsp;%T&#34;</span><span class="op" id="4152231">,</span>&nbsp;<span class="ident" id="4152233">got</span><span class="op" id="4152236">,</span>&nbsp;<span class="ident" id="4152238">wanted</span><span class="op" id="4152244">)</span><br>
<span class="lineno"></span><span class="op" id="4152246">}</span>
</div>
</body>
</html>
