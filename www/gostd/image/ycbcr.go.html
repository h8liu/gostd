<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html" class="current">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5538737">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5538792">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5538846">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5538897">package</span>&nbsp;<span class="ident" id="5538905">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5538912">import</span>&nbsp;<span class="op" id="5538919">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5538922">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="5538936">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="5538939">//&nbsp;YCbCrSubsampleRatio&nbsp;is&nbsp;the&nbsp;chroma&nbsp;subsample&nbsp;ratio&nbsp;used&nbsp;in&nbsp;a&nbsp;YCbCr&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5539015">type</span>&nbsp;<span class="ident" id="5539020">YCbCrSubsampleRatio</span>&nbsp;<span class="builtintype" id="5539040">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5539045">const</span>&nbsp;<span class="op" id="5539051">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539054">YCbCrSubsampleRatio444</span>&nbsp;<span class="ident" id="5539077">YCbCrSubsampleRatio</span>&nbsp;<span class="op" id="5539097">=</span>&nbsp;<span class="ident" id="5539099">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539105">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539129">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539153">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span><span class="op" id="5539176">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5539179">func</span>&nbsp;<span class="op" id="5539184">(</span><span class="ident" id="5539185">s</span>&nbsp;<span class="ident" id="5539187">YCbCrSubsampleRatio</span><span class="op" id="5539206">)</span>&nbsp;<span class="ident" id="5539208">String</span><span class="op" id="5539214">(</span><span class="op" id="5539215">)</span>&nbsp;<span class="builtintype" id="5539217">string</span>&nbsp;<span class="op" id="5539224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539227">switch</span>&nbsp;<span class="ident" id="5539234">s</span>&nbsp;<span class="op" id="5539236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539239">case</span>&nbsp;<span class="ident" id="5539244">YCbCrSubsampleRatio444</span><span class="op" id="5539266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539270">return</span>&nbsp;<span class="string" id="5539277">&#34;YCbCrSubsampleRatio444&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539303">case</span>&nbsp;<span class="ident" id="5539308">YCbCrSubsampleRatio422</span><span class="op" id="5539330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539334">return</span>&nbsp;<span class="string" id="5539341">&#34;YCbCrSubsampleRatio422&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539367">case</span>&nbsp;<span class="ident" id="5539372">YCbCrSubsampleRatio420</span><span class="op" id="5539394">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539398">return</span>&nbsp;<span class="string" id="5539405">&#34;YCbCrSubsampleRatio420&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539431">case</span>&nbsp;<span class="ident" id="5539436">YCbCrSubsampleRatio440</span><span class="op" id="5539458">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539462">return</span>&nbsp;<span class="string" id="5539469">&#34;YCbCrSubsampleRatio440&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539498">return</span>&nbsp;<span class="string" id="5539505">&#34;YCbCrSubsampleRatioUnknown&#34;</span><br>
<span class="lineno"></span><span class="op" id="5539534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5539537">//&nbsp;YCbCr&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;Y&#39;CbCr&nbsp;colors.&nbsp;There&nbsp;is&nbsp;one&nbsp;Y&nbsp;sample&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="5539612">//&nbsp;pixel,&nbsp;but&nbsp;each&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;sample&nbsp;can&nbsp;span&nbsp;one&nbsp;or&nbsp;more&nbsp;pixels.</span><br>
<span class="lineno"></span><span class="comment" id="5539677">//&nbsp;YStride&nbsp;is&nbsp;the&nbsp;Y&nbsp;slice&nbsp;index&nbsp;delta&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span><span class="comment" id="5539751">//&nbsp;CStride&nbsp;is&nbsp;the&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;slice&nbsp;index&nbsp;delta&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels</span><br>
<span class="lineno"></span><span class="comment" id="5539832">//&nbsp;that&nbsp;map&nbsp;to&nbsp;separate&nbsp;chroma&nbsp;samples.</span><br>
<span class="lineno">40</span><span class="comment" id="5539872">//&nbsp;It&nbsp;is&nbsp;not&nbsp;an&nbsp;absolute&nbsp;requirement,&nbsp;but&nbsp;YStride&nbsp;and&nbsp;len(Y)&nbsp;are&nbsp;typically</span><br>
<span class="lineno"></span><span class="comment" id="5539947">//&nbsp;multiples&nbsp;of&nbsp;8,&nbsp;and:</span><br>
<span class="lineno"></span><span class="comment" id="5539971">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:4:4,&nbsp;CStride&nbsp;==&nbsp;YStride/1&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/1.</span><br>
<span class="lineno"></span><span class="comment" id="5540041">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:2:2,&nbsp;CStride&nbsp;==&nbsp;YStride/2&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/2.</span><br>
<span class="lineno"></span><span class="comment" id="5540111">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:2:0,&nbsp;CStride&nbsp;==&nbsp;YStride/2&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/4.</span><br>
<span class="lineno">45</span><span class="comment" id="5540181">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:4:0,&nbsp;CStride&nbsp;==&nbsp;YStride/1&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/2.</span><br>
<span class="lineno"></span><span class="keyword" id="5540251">type</span>&nbsp;<span class="ident" id="5540256">YCbCr</span>&nbsp;<span class="keyword" id="5540262">struct</span>&nbsp;<span class="op" id="5540269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540272">Y</span><span class="op" id="5540273">,</span>&nbsp;<span class="ident" id="5540275">Cb</span><span class="op" id="5540277">,</span>&nbsp;<span class="ident" id="5540279">Cr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5540287">[</span><span class="op" id="5540288">]</span><span class="builtintype" id="5540289">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540296">YStride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5540311">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540316">CStride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5540331">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540336">SubsampleRatio</span>&nbsp;<span class="ident" id="5540351">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540372">Rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5540387">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5540397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5540400">func</span>&nbsp;<span class="op" id="5540405">(</span><span class="ident" id="5540406">p</span>&nbsp;<span class="op" id="5540408">*</span><span class="ident" id="5540409">YCbCr</span><span class="op" id="5540414">)</span>&nbsp;<span class="ident" id="5540416">ColorModel</span><span class="op" id="5540426">(</span><span class="op" id="5540427">)</span>&nbsp;<span class="ident" id="5540429">color</span><span class="op" id="5540434">.</span><span class="ident" id="5540435">Model</span>&nbsp;<span class="op" id="5540441">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540444">return</span>&nbsp;<span class="ident" id="5540451">color</span><span class="op" id="5540456">.</span><span class="ident" id="5540457">YCbCrModel</span><br>
<span class="lineno"></span><span class="op" id="5540468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5540471">func</span>&nbsp;<span class="op" id="5540476">(</span><span class="ident" id="5540477">p</span>&nbsp;<span class="op" id="5540479">*</span><span class="ident" id="5540480">YCbCr</span><span class="op" id="5540485">)</span>&nbsp;<span class="ident" id="5540487">Bounds</span><span class="op" id="5540493">(</span><span class="op" id="5540494">)</span>&nbsp;<span class="ident" id="5540496">Rectangle</span>&nbsp;<span class="op" id="5540506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540509">return</span>&nbsp;<span class="ident" id="5540516">p</span><span class="op" id="5540517">.</span><span class="ident" id="5540518">Rect</span><br>
<span class="lineno">60</span><span class="op" id="5540523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5540526">func</span>&nbsp;<span class="op" id="5540531">(</span><span class="ident" id="5540532">p</span>&nbsp;<span class="op" id="5540534">*</span><span class="ident" id="5540535">YCbCr</span><span class="op" id="5540540">)</span>&nbsp;<span class="ident" id="5540542">At</span><span class="op" id="5540544">(</span><span class="ident" id="5540545">x</span><span class="op" id="5540546">,</span>&nbsp;<span class="ident" id="5540548">y</span>&nbsp;<span class="builtintype" id="5540550">int</span><span class="op" id="5540553">)</span>&nbsp;<span class="ident" id="5540555">color</span><span class="op" id="5540560">.</span><span class="ident" id="5540561">Color</span>&nbsp;<span class="op" id="5540567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540570">return</span>&nbsp;<span class="ident" id="5540577">p</span><span class="op" id="5540578">.</span><span class="ident" id="5540579">YCbCrAt</span><span class="op" id="5540586">(</span><span class="ident" id="5540587">x</span><span class="op" id="5540588">,</span>&nbsp;<span class="ident" id="5540590">y</span><span class="op" id="5540591">)</span><br>
<span class="lineno"></span><span class="op" id="5540593">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="5540596">func</span>&nbsp;<span class="op" id="5540601">(</span><span class="ident" id="5540602">p</span>&nbsp;<span class="op" id="5540604">*</span><span class="ident" id="5540605">YCbCr</span><span class="op" id="5540610">)</span>&nbsp;<span class="ident" id="5540612">YCbCrAt</span><span class="op" id="5540619">(</span><span class="ident" id="5540620">x</span><span class="op" id="5540621">,</span>&nbsp;<span class="ident" id="5540623">y</span>&nbsp;<span class="builtintype" id="5540625">int</span><span class="op" id="5540628">)</span>&nbsp;<span class="ident" id="5540630">color</span><span class="op" id="5540635">.</span><span class="ident" id="5540636">YCbCr</span>&nbsp;<span class="op" id="5540642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540645">if</span>&nbsp;<span class="op" id="5540648">!</span><span class="op" id="5540649">(</span><span class="ident" id="5540650">Point</span><span class="op" id="5540655">{</span><span class="ident" id="5540656">x</span><span class="op" id="5540657">,</span>&nbsp;<span class="ident" id="5540659">y</span><span class="op" id="5540660">}</span><span class="op" id="5540661">.</span><span class="ident" id="5540662">In</span><span class="op" id="5540664">(</span><span class="ident" id="5540665">p</span><span class="op" id="5540666">.</span><span class="ident" id="5540667">Rect</span><span class="op" id="5540671">)</span><span class="op" id="5540672">)</span>&nbsp;<span class="op" id="5540674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540678">return</span>&nbsp;<span class="ident" id="5540685">color</span><span class="op" id="5540690">.</span><span class="ident" id="5540691">YCbCr</span><span class="op" id="5540696">{</span><span class="op" id="5540697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5540700">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540703">yi</span>&nbsp;<span class="op" id="5540706">:=</span>&nbsp;<span class="ident" id="5540709">p</span><span class="op" id="5540710">.</span><span class="ident" id="5540711">YOffset</span><span class="op" id="5540718">(</span><span class="ident" id="5540719">x</span><span class="op" id="5540720">,</span>&nbsp;<span class="ident" id="5540722">y</span><span class="op" id="5540723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540726">ci</span>&nbsp;<span class="op" id="5540729">:=</span>&nbsp;<span class="ident" id="5540732">p</span><span class="op" id="5540733">.</span><span class="ident" id="5540734">COffset</span><span class="op" id="5540741">(</span><span class="ident" id="5540742">x</span><span class="op" id="5540743">,</span>&nbsp;<span class="ident" id="5540745">y</span><span class="op" id="5540746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540749">return</span>&nbsp;<span class="ident" id="5540756">color</span><span class="op" id="5540761">.</span><span class="ident" id="5540762">YCbCr</span><span class="op" id="5540767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540771">p</span><span class="op" id="5540772">.</span><span class="ident" id="5540773">Y</span><span class="op" id="5540774">[</span><span class="ident" id="5540775">yi</span><span class="op" id="5540777">]</span><span class="op" id="5540778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540782">p</span><span class="op" id="5540783">.</span><span class="ident" id="5540784">Cb</span><span class="op" id="5540786">[</span><span class="ident" id="5540787">ci</span><span class="op" id="5540789">]</span><span class="op" id="5540790">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540794">p</span><span class="op" id="5540795">.</span><span class="ident" id="5540796">Cr</span><span class="op" id="5540798">[</span><span class="ident" id="5540799">ci</span><span class="op" id="5540801">]</span><span class="op" id="5540802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5540805">}</span><br>
<span class="lineno"></span><span class="op" id="5540807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5540810">//&nbsp;YOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Y&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">80</span><span class="comment" id="5540885">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5540909">func</span>&nbsp;<span class="op" id="5540914">(</span><span class="ident" id="5540915">p</span>&nbsp;<span class="op" id="5540917">*</span><span class="ident" id="5540918">YCbCr</span><span class="op" id="5540923">)</span>&nbsp;<span class="ident" id="5540925">YOffset</span><span class="op" id="5540932">(</span><span class="ident" id="5540933">x</span><span class="op" id="5540934">,</span>&nbsp;<span class="ident" id="5540936">y</span>&nbsp;<span class="builtintype" id="5540938">int</span><span class="op" id="5540941">)</span>&nbsp;<span class="builtintype" id="5540943">int</span>&nbsp;<span class="op" id="5540947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540950">return</span>&nbsp;<span class="op" id="5540957">(</span><span class="ident" id="5540958">y</span><span class="op" id="5540959">-</span><span class="ident" id="5540960">p</span><span class="op" id="5540961">.</span><span class="ident" id="5540962">Rect</span><span class="op" id="5540966">.</span><span class="ident" id="5540967">Min</span><span class="op" id="5540970">.</span><span class="ident" id="5540971">Y</span><span class="op" id="5540972">)</span><span class="op" id="5540973">*</span><span class="ident" id="5540974">p</span><span class="op" id="5540975">.</span><span class="ident" id="5540976">YStride</span>&nbsp;<span class="op" id="5540984">+</span>&nbsp;<span class="op" id="5540986">(</span><span class="ident" id="5540987">x</span>&nbsp;<span class="op" id="5540989">-</span>&nbsp;<span class="ident" id="5540991">p</span><span class="op" id="5540992">.</span><span class="ident" id="5540993">Rect</span><span class="op" id="5540997">.</span><span class="ident" id="5540998">Min</span><span class="op" id="5541001">.</span><span class="ident" id="5541002">X</span><span class="op" id="5541003">)</span><br>
<span class="lineno"></span><span class="op" id="5541005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5541008">//&nbsp;COffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Cb&nbsp;or&nbsp;Cr&nbsp;that&nbsp;corresponds</span><br>
<span class="lineno"></span><span class="comment" id="5541087">//&nbsp;to&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5541114">func</span>&nbsp;<span class="op" id="5541119">(</span><span class="ident" id="5541120">p</span>&nbsp;<span class="op" id="5541122">*</span><span class="ident" id="5541123">YCbCr</span><span class="op" id="5541128">)</span>&nbsp;<span class="ident" id="5541130">COffset</span><span class="op" id="5541137">(</span><span class="ident" id="5541138">x</span><span class="op" id="5541139">,</span>&nbsp;<span class="ident" id="5541141">y</span>&nbsp;<span class="builtintype" id="5541143">int</span><span class="op" id="5541146">)</span>&nbsp;<span class="builtintype" id="5541148">int</span>&nbsp;<span class="op" id="5541152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541155">switch</span>&nbsp;<span class="ident" id="5541162">p</span><span class="op" id="5541163">.</span><span class="ident" id="5541164">SubsampleRatio</span>&nbsp;<span class="op" id="5541179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541182">case</span>&nbsp;<span class="ident" id="5541187">YCbCrSubsampleRatio422</span><span class="op" id="5541209">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541213">return</span>&nbsp;<span class="op" id="5541220">(</span><span class="ident" id="5541221">y</span><span class="op" id="5541222">-</span><span class="ident" id="5541223">p</span><span class="op" id="5541224">.</span><span class="ident" id="5541225">Rect</span><span class="op" id="5541229">.</span><span class="ident" id="5541230">Min</span><span class="op" id="5541233">.</span><span class="ident" id="5541234">Y</span><span class="op" id="5541235">)</span><span class="op" id="5541236">*</span><span class="ident" id="5541237">p</span><span class="op" id="5541238">.</span><span class="ident" id="5541239">CStride</span>&nbsp;<span class="op" id="5541247">+</span>&nbsp;<span class="op" id="5541249">(</span><span class="ident" id="5541250">x</span><span class="op" id="5541251">/</span><span class="num" id="5541252">2</span>&nbsp;<span class="op" id="5541254">-</span>&nbsp;<span class="ident" id="5541256">p</span><span class="op" id="5541257">.</span><span class="ident" id="5541258">Rect</span><span class="op" id="5541262">.</span><span class="ident" id="5541263">Min</span><span class="op" id="5541266">.</span><span class="ident" id="5541267">X</span><span class="op" id="5541268">/</span><span class="num" id="5541269">2</span><span class="op" id="5541270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541273">case</span>&nbsp;<span class="ident" id="5541278">YCbCrSubsampleRatio420</span><span class="op" id="5541300">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541304">return</span>&nbsp;<span class="op" id="5541311">(</span><span class="ident" id="5541312">y</span><span class="op" id="5541313">/</span><span class="num" id="5541314">2</span><span class="op" id="5541315">-</span><span class="ident" id="5541316">p</span><span class="op" id="5541317">.</span><span class="ident" id="5541318">Rect</span><span class="op" id="5541322">.</span><span class="ident" id="5541323">Min</span><span class="op" id="5541326">.</span><span class="ident" id="5541327">Y</span><span class="op" id="5541328">/</span><span class="num" id="5541329">2</span><span class="op" id="5541330">)</span><span class="op" id="5541331">*</span><span class="ident" id="5541332">p</span><span class="op" id="5541333">.</span><span class="ident" id="5541334">CStride</span>&nbsp;<span class="op" id="5541342">+</span>&nbsp;<span class="op" id="5541344">(</span><span class="ident" id="5541345">x</span><span class="op" id="5541346">/</span><span class="num" id="5541347">2</span>&nbsp;<span class="op" id="5541349">-</span>&nbsp;<span class="ident" id="5541351">p</span><span class="op" id="5541352">.</span><span class="ident" id="5541353">Rect</span><span class="op" id="5541357">.</span><span class="ident" id="5541358">Min</span><span class="op" id="5541361">.</span><span class="ident" id="5541362">X</span><span class="op" id="5541363">/</span><span class="num" id="5541364">2</span><span class="op" id="5541365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541368">case</span>&nbsp;<span class="ident" id="5541373">YCbCrSubsampleRatio440</span><span class="op" id="5541395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541399">return</span>&nbsp;<span class="op" id="5541406">(</span><span class="ident" id="5541407">y</span><span class="op" id="5541408">/</span><span class="num" id="5541409">2</span><span class="op" id="5541410">-</span><span class="ident" id="5541411">p</span><span class="op" id="5541412">.</span><span class="ident" id="5541413">Rect</span><span class="op" id="5541417">.</span><span class="ident" id="5541418">Min</span><span class="op" id="5541421">.</span><span class="ident" id="5541422">Y</span><span class="op" id="5541423">/</span><span class="num" id="5541424">2</span><span class="op" id="5541425">)</span><span class="op" id="5541426">*</span><span class="ident" id="5541427">p</span><span class="op" id="5541428">.</span><span class="ident" id="5541429">CStride</span>&nbsp;<span class="op" id="5541437">+</span>&nbsp;<span class="op" id="5541439">(</span><span class="ident" id="5541440">x</span>&nbsp;<span class="op" id="5541442">-</span>&nbsp;<span class="ident" id="5541444">p</span><span class="op" id="5541445">.</span><span class="ident" id="5541446">Rect</span><span class="op" id="5541450">.</span><span class="ident" id="5541451">Min</span><span class="op" id="5541454">.</span><span class="ident" id="5541455">X</span><span class="op" id="5541456">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541462">//&nbsp;Default&nbsp;to&nbsp;4:4:4&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541496">return</span>&nbsp;<span class="op" id="5541503">(</span><span class="ident" id="5541504">y</span><span class="op" id="5541505">-</span><span class="ident" id="5541506">p</span><span class="op" id="5541507">.</span><span class="ident" id="5541508">Rect</span><span class="op" id="5541512">.</span><span class="ident" id="5541513">Min</span><span class="op" id="5541516">.</span><span class="ident" id="5541517">Y</span><span class="op" id="5541518">)</span><span class="op" id="5541519">*</span><span class="ident" id="5541520">p</span><span class="op" id="5541521">.</span><span class="ident" id="5541522">CStride</span>&nbsp;<span class="op" id="5541530">+</span>&nbsp;<span class="op" id="5541532">(</span><span class="ident" id="5541533">x</span>&nbsp;<span class="op" id="5541535">-</span>&nbsp;<span class="ident" id="5541537">p</span><span class="op" id="5541538">.</span><span class="ident" id="5541539">Rect</span><span class="op" id="5541543">.</span><span class="ident" id="5541544">Min</span><span class="op" id="5541547">.</span><span class="ident" id="5541548">X</span><span class="op" id="5541549">)</span><br>
<span class="lineno"></span><span class="op" id="5541551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="5541554">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5541631">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5541703">func</span>&nbsp;<span class="op" id="5541708">(</span><span class="ident" id="5541709">p</span>&nbsp;<span class="op" id="5541711">*</span><span class="ident" id="5541712">YCbCr</span><span class="op" id="5541717">)</span>&nbsp;<span class="ident" id="5541719">SubImage</span><span class="op" id="5541727">(</span><span class="ident" id="5541728">r</span>&nbsp;<span class="ident" id="5541730">Rectangle</span><span class="op" id="5541739">)</span>&nbsp;<span class="ident" id="5541741">Image</span>&nbsp;<span class="op" id="5541747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541750">r</span>&nbsp;<span class="op" id="5541752">=</span>&nbsp;<span class="ident" id="5541754">r</span><span class="op" id="5541755">.</span><span class="ident" id="5541756">Intersect</span><span class="op" id="5541765">(</span><span class="ident" id="5541766">p</span><span class="op" id="5541767">.</span><span class="ident" id="5541768">Rect</span><span class="op" id="5541772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541775">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541856">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541938">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541988">if</span>&nbsp;<span class="ident" id="5541991">r</span><span class="op" id="5541992">.</span><span class="ident" id="5541993">Empty</span><span class="op" id="5541998">(</span><span class="op" id="5541999">)</span>&nbsp;<span class="op" id="5542001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542005">return</span>&nbsp;<span class="op" id="5542012">&amp;</span><span class="ident" id="5542013">YCbCr</span><span class="op" id="5542018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542023">SubsampleRatio</span><span class="op" id="5542037">:</span>&nbsp;<span class="ident" id="5542039">p</span><span class="op" id="5542040">.</span><span class="ident" id="5542041">SubsampleRatio</span><span class="op" id="5542055">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542065">yi</span>&nbsp;<span class="op" id="5542068">:=</span>&nbsp;<span class="ident" id="5542071">p</span><span class="op" id="5542072">.</span><span class="ident" id="5542073">YOffset</span><span class="op" id="5542080">(</span><span class="ident" id="5542081">r</span><span class="op" id="5542082">.</span><span class="ident" id="5542083">Min</span><span class="op" id="5542086">.</span><span class="ident" id="5542087">X</span><span class="op" id="5542088">,</span>&nbsp;<span class="ident" id="5542090">r</span><span class="op" id="5542091">.</span><span class="ident" id="5542092">Min</span><span class="op" id="5542095">.</span><span class="ident" id="5542096">Y</span><span class="op" id="5542097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542100">ci</span>&nbsp;<span class="op" id="5542103">:=</span>&nbsp;<span class="ident" id="5542106">p</span><span class="op" id="5542107">.</span><span class="ident" id="5542108">COffset</span><span class="op" id="5542115">(</span><span class="ident" id="5542116">r</span><span class="op" id="5542117">.</span><span class="ident" id="5542118">Min</span><span class="op" id="5542121">.</span><span class="ident" id="5542122">X</span><span class="op" id="5542123">,</span>&nbsp;<span class="ident" id="5542125">r</span><span class="op" id="5542126">.</span><span class="ident" id="5542127">Min</span><span class="op" id="5542130">.</span><span class="ident" id="5542131">Y</span><span class="op" id="5542132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542135">return</span>&nbsp;<span class="op" id="5542142">&amp;</span><span class="ident" id="5542143">YCbCr</span><span class="op" id="5542148">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542152">Y</span><span class="op" id="5542153">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542168">p</span><span class="op" id="5542169">.</span><span class="ident" id="5542170">Y</span><span class="op" id="5542171">[</span><span class="ident" id="5542172">yi</span><span class="op" id="5542174">:</span><span class="op" id="5542175">]</span><span class="op" id="5542176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542180">Cb</span><span class="op" id="5542182">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542196">p</span><span class="op" id="5542197">.</span><span class="ident" id="5542198">Cb</span><span class="op" id="5542200">[</span><span class="ident" id="5542201">ci</span><span class="op" id="5542203">:</span><span class="op" id="5542204">]</span><span class="op" id="5542205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542209">Cr</span><span class="op" id="5542211">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542225">p</span><span class="op" id="5542226">.</span><span class="ident" id="5542227">Cr</span><span class="op" id="5542229">[</span><span class="ident" id="5542230">ci</span><span class="op" id="5542232">:</span><span class="op" id="5542233">]</span><span class="op" id="5542234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542238">SubsampleRatio</span><span class="op" id="5542252">:</span>&nbsp;<span class="ident" id="5542254">p</span><span class="op" id="5542255">.</span><span class="ident" id="5542256">SubsampleRatio</span><span class="op" id="5542270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542274">YStride</span><span class="op" id="5542281">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542290">p</span><span class="op" id="5542291">.</span><span class="ident" id="5542292">YStride</span><span class="op" id="5542299">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542303">CStride</span><span class="op" id="5542310">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542319">p</span><span class="op" id="5542320">.</span><span class="ident" id="5542321">CStride</span><span class="op" id="5542328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542332">Rect</span><span class="op" id="5542336">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542348">r</span><span class="op" id="5542349">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542352">}</span><br>
<span class="lineno"></span><span class="op" id="5542354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="5542357">func</span>&nbsp;<span class="op" id="5542362">(</span><span class="ident" id="5542363">p</span>&nbsp;<span class="op" id="5542365">*</span><span class="ident" id="5542366">YCbCr</span><span class="op" id="5542371">)</span>&nbsp;<span class="ident" id="5542373">Opaque</span><span class="op" id="5542379">(</span><span class="op" id="5542380">)</span>&nbsp;<span class="builtintype" id="5542382">bool</span>&nbsp;<span class="op" id="5542387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542390">return</span>&nbsp;<span class="builtintype" id="5542397">true</span><br>
<span class="lineno"></span><span class="op" id="5542402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5542405">//&nbsp;NewYCbCr&nbsp;returns&nbsp;a&nbsp;new&nbsp;YCbCr&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds&nbsp;and&nbsp;subsample&nbsp;ratio.</span><br>
<span class="lineno">130</span><span class="keyword" id="5542480">func</span>&nbsp;<span class="ident" id="5542485">NewYCbCr</span><span class="op" id="5542493">(</span><span class="ident" id="5542494">r</span>&nbsp;<span class="ident" id="5542496">Rectangle</span><span class="op" id="5542505">,</span>&nbsp;<span class="ident" id="5542507">subsampleRatio</span>&nbsp;<span class="ident" id="5542522">YCbCrSubsampleRatio</span><span class="op" id="5542541">)</span>&nbsp;<span class="op" id="5542543">*</span><span class="ident" id="5542544">YCbCr</span>&nbsp;<span class="op" id="5542550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542553">w</span><span class="op" id="5542554">,</span>&nbsp;<span class="ident" id="5542556">h</span><span class="op" id="5542557">,</span>&nbsp;<span class="ident" id="5542559">cw</span><span class="op" id="5542561">,</span>&nbsp;<span class="ident" id="5542563">ch</span>&nbsp;<span class="op" id="5542566">:=</span>&nbsp;<span class="ident" id="5542569">r</span><span class="op" id="5542570">.</span><span class="ident" id="5542571">Dx</span><span class="op" id="5542573">(</span><span class="op" id="5542574">)</span><span class="op" id="5542575">,</span>&nbsp;<span class="ident" id="5542577">r</span><span class="op" id="5542578">.</span><span class="ident" id="5542579">Dy</span><span class="op" id="5542581">(</span><span class="op" id="5542582">)</span><span class="op" id="5542583">,</span>&nbsp;<span class="num" id="5542585">0</span><span class="op" id="5542586">,</span>&nbsp;<span class="num" id="5542588">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542591">switch</span>&nbsp;<span class="ident" id="5542598">subsampleRatio</span>&nbsp;<span class="op" id="5542613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542616">case</span>&nbsp;<span class="ident" id="5542621">YCbCrSubsampleRatio422</span><span class="op" id="5542643">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542647">cw</span>&nbsp;<span class="op" id="5542650">=</span>&nbsp;<span class="op" id="5542652">(</span><span class="ident" id="5542653">r</span><span class="op" id="5542654">.</span><span class="ident" id="5542655">Max</span><span class="op" id="5542658">.</span><span class="ident" id="5542659">X</span><span class="op" id="5542660">+</span><span class="num" id="5542661">1</span><span class="op" id="5542662">)</span><span class="op" id="5542663">/</span><span class="num" id="5542664">2</span>&nbsp;<span class="op" id="5542666">-</span>&nbsp;<span class="ident" id="5542668">r</span><span class="op" id="5542669">.</span><span class="ident" id="5542670">Min</span><span class="op" id="5542673">.</span><span class="ident" id="5542674">X</span><span class="op" id="5542675">/</span><span class="num" id="5542676">2</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542680">ch</span>&nbsp;<span class="op" id="5542683">=</span>&nbsp;<span class="ident" id="5542685">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542688">case</span>&nbsp;<span class="ident" id="5542693">YCbCrSubsampleRatio420</span><span class="op" id="5542715">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542719">cw</span>&nbsp;<span class="op" id="5542722">=</span>&nbsp;<span class="op" id="5542724">(</span><span class="ident" id="5542725">r</span><span class="op" id="5542726">.</span><span class="ident" id="5542727">Max</span><span class="op" id="5542730">.</span><span class="ident" id="5542731">X</span><span class="op" id="5542732">+</span><span class="num" id="5542733">1</span><span class="op" id="5542734">)</span><span class="op" id="5542735">/</span><span class="num" id="5542736">2</span>&nbsp;<span class="op" id="5542738">-</span>&nbsp;<span class="ident" id="5542740">r</span><span class="op" id="5542741">.</span><span class="ident" id="5542742">Min</span><span class="op" id="5542745">.</span><span class="ident" id="5542746">X</span><span class="op" id="5542747">/</span><span class="num" id="5542748">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542752">ch</span>&nbsp;<span class="op" id="5542755">=</span>&nbsp;<span class="op" id="5542757">(</span><span class="ident" id="5542758">r</span><span class="op" id="5542759">.</span><span class="ident" id="5542760">Max</span><span class="op" id="5542763">.</span><span class="ident" id="5542764">Y</span><span class="op" id="5542765">+</span><span class="num" id="5542766">1</span><span class="op" id="5542767">)</span><span class="op" id="5542768">/</span><span class="num" id="5542769">2</span>&nbsp;<span class="op" id="5542771">-</span>&nbsp;<span class="ident" id="5542773">r</span><span class="op" id="5542774">.</span><span class="ident" id="5542775">Min</span><span class="op" id="5542778">.</span><span class="ident" id="5542779">Y</span><span class="op" id="5542780">/</span><span class="num" id="5542781">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542784">case</span>&nbsp;<span class="ident" id="5542789">YCbCrSubsampleRatio440</span><span class="op" id="5542811">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542815">cw</span>&nbsp;<span class="op" id="5542818">=</span>&nbsp;<span class="ident" id="5542820">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542824">ch</span>&nbsp;<span class="op" id="5542827">=</span>&nbsp;<span class="op" id="5542829">(</span><span class="ident" id="5542830">r</span><span class="op" id="5542831">.</span><span class="ident" id="5542832">Max</span><span class="op" id="5542835">.</span><span class="ident" id="5542836">Y</span><span class="op" id="5542837">+</span><span class="num" id="5542838">1</span><span class="op" id="5542839">)</span><span class="op" id="5542840">/</span><span class="num" id="5542841">2</span>&nbsp;<span class="op" id="5542843">-</span>&nbsp;<span class="ident" id="5542845">r</span><span class="op" id="5542846">.</span><span class="ident" id="5542847">Min</span><span class="op" id="5542850">.</span><span class="ident" id="5542851">Y</span><span class="op" id="5542852">/</span><span class="num" id="5542853">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542856">default</span><span class="op" id="5542863">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5542867">//&nbsp;Default&nbsp;to&nbsp;4:4:4&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542902">cw</span>&nbsp;<span class="op" id="5542905">=</span>&nbsp;<span class="ident" id="5542907">w</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542911">ch</span>&nbsp;<span class="op" id="5542914">=</span>&nbsp;<span class="ident" id="5542916">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542922">b</span>&nbsp;<span class="op" id="5542924">:=</span>&nbsp;<span class="builtinfunc" id="5542927">make</span><span class="op" id="5542931">(</span><span class="op" id="5542932">[</span><span class="op" id="5542933">]</span><span class="builtintype" id="5542934">byte</span><span class="op" id="5542938">,</span>&nbsp;<span class="ident" id="5542940">w</span><span class="op" id="5542941">*</span><span class="ident" id="5542942">h</span><span class="op" id="5542943">+</span><span class="num" id="5542944">2</span><span class="op" id="5542945">*</span><span class="ident" id="5542946">cw</span><span class="op" id="5542948">*</span><span class="ident" id="5542949">ch</span><span class="op" id="5542951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542954">return</span>&nbsp;<span class="op" id="5542961">&amp;</span><span class="ident" id="5542962">YCbCr</span><span class="op" id="5542967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542971">Y</span><span class="op" id="5542972">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5542987">b</span><span class="op" id="5542988">[</span><span class="op" id="5542989">:</span><span class="ident" id="5542990">w</span><span class="op" id="5542991">*</span><span class="ident" id="5542992">h</span><span class="op" id="5542993">]</span><span class="op" id="5542994">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542998">Cb</span><span class="op" id="5543000">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5543014">b</span><span class="op" id="5543015">[</span><span class="ident" id="5543016">w</span><span class="op" id="5543017">*</span><span class="ident" id="5543018">h</span><span class="op" id="5543019">+</span><span class="num" id="5543020">0</span><span class="op" id="5543021">*</span><span class="ident" id="5543022">cw</span><span class="op" id="5543024">*</span><span class="ident" id="5543025">ch</span>&nbsp;<span class="op" id="5543028">:</span>&nbsp;<span class="ident" id="5543030">w</span><span class="op" id="5543031">*</span><span class="ident" id="5543032">h</span><span class="op" id="5543033">+</span><span class="num" id="5543034">1</span><span class="op" id="5543035">*</span><span class="ident" id="5543036">cw</span><span class="op" id="5543038">*</span><span class="ident" id="5543039">ch</span><span class="op" id="5543041">]</span><span class="op" id="5543042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543046">Cr</span><span class="op" id="5543048">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5543062">b</span><span class="op" id="5543063">[</span><span class="ident" id="5543064">w</span><span class="op" id="5543065">*</span><span class="ident" id="5543066">h</span><span class="op" id="5543067">+</span><span class="num" id="5543068">1</span><span class="op" id="5543069">*</span><span class="ident" id="5543070">cw</span><span class="op" id="5543072">*</span><span class="ident" id="5543073">ch</span>&nbsp;<span class="op" id="5543076">:</span>&nbsp;<span class="ident" id="5543078">w</span><span class="op" id="5543079">*</span><span class="ident" id="5543080">h</span><span class="op" id="5543081">+</span><span class="num" id="5543082">2</span><span class="op" id="5543083">*</span><span class="ident" id="5543084">cw</span><span class="op" id="5543086">*</span><span class="ident" id="5543087">ch</span><span class="op" id="5543089">]</span><span class="op" id="5543090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543094">SubsampleRatio</span><span class="op" id="5543108">:</span>&nbsp;<span class="ident" id="5543110">subsampleRatio</span><span class="op" id="5543124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543128">YStride</span><span class="op" id="5543135">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5543144">w</span><span class="op" id="5543145">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543149">CStride</span><span class="op" id="5543156">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5543165">cw</span><span class="op" id="5543167">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543171">Rect</span><span class="op" id="5543175">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5543187">r</span><span class="op" id="5543188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543191">}</span><br>
<span class="lineno"></span><span class="op" id="5543193">}</span>
</div>
</body>
</html>
