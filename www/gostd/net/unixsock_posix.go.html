<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html" class="current">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3202365">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3202421">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3202475">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3202526">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3202604">package</span>&nbsp;<span class="ident" id="3202612">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3202617">import</span>&nbsp;<span class="op" id="3202624">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3202627">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3202637">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3202643">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3202654">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3202661">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3202664">func</span>&nbsp;<span class="ident" id="3202669">unixSocket</span><span class="op" id="3202679">(</span><span class="ident" id="3202680">net</span>&nbsp;<span class="builtintype" id="3202684">string</span><span class="op" id="3202690">,</span>&nbsp;<span class="ident" id="3202692">laddr</span><span class="op" id="3202697">,</span>&nbsp;<span class="ident" id="3202699">raddr</span>&nbsp;<span class="ident" id="3202705">sockaddr</span><span class="op" id="3202713">,</span>&nbsp;<span class="ident" id="3202715">mode</span>&nbsp;<span class="builtintype" id="3202720">string</span><span class="op" id="3202726">,</span>&nbsp;<span class="ident" id="3202728">deadline</span>&nbsp;<span class="ident" id="3202737">time</span><span class="op" id="3202741">.</span><span class="ident" id="3202742">Time</span><span class="op" id="3202746">)</span>&nbsp;<span class="op" id="3202748">(</span><span class="op" id="3202749">*</span><span class="ident" id="3202750">netFD</span><span class="op" id="3202755">,</span>&nbsp;<span class="builtintype" id="3202757">error</span><span class="op" id="3202762">)</span>&nbsp;<span class="op" id="3202764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3202767">var</span>&nbsp;<span class="ident" id="3202771">sotype</span>&nbsp;<span class="builtintype" id="3202778">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3202783">switch</span>&nbsp;<span class="ident" id="3202790">net</span>&nbsp;<span class="op" id="3202794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3202797">case</span>&nbsp;<span class="string" id="3202802">&#34;unix&#34;</span><span class="op" id="3202808">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3202812">sotype</span>&nbsp;<span class="op" id="3202819">=</span>&nbsp;<span class="ident" id="3202821">syscall</span><span class="op" id="3202828">.</span><span class="ident" id="3202829">SOCK_STREAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3202842">case</span>&nbsp;<span class="string" id="3202847">&#34;unixgram&#34;</span><span class="op" id="3202857">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3202861">sotype</span>&nbsp;<span class="op" id="3202868">=</span>&nbsp;<span class="ident" id="3202870">syscall</span><span class="op" id="3202877">.</span><span class="ident" id="3202878">SOCK_DGRAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3202890">case</span>&nbsp;<span class="string" id="3202895">&#34;unixpacket&#34;</span><span class="op" id="3202907">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3202911">sotype</span>&nbsp;<span class="op" id="3202918">=</span>&nbsp;<span class="ident" id="3202920">syscall</span><span class="op" id="3202927">.</span><span class="ident" id="3202928">SOCK_SEQPACKET</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3202944">default</span><span class="op" id="3202951">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3202955">return</span>&nbsp;<span class="ident" id="3202962">nil</span><span class="op" id="3202965">,</span>&nbsp;<span class="ident" id="3202967">UnknownNetworkError</span><span class="op" id="3202986">(</span><span class="ident" id="3202987">net</span><span class="op" id="3202990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3202993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3202997">switch</span>&nbsp;<span class="ident" id="3203004">mode</span>&nbsp;<span class="op" id="3203009">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203012">case</span>&nbsp;<span class="string" id="3203017">&#34;dial&#34;</span><span class="op" id="3203023">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203027">if</span>&nbsp;<span class="ident" id="3203030">laddr</span>&nbsp;<span class="op" id="3203036">!=</span>&nbsp;<span class="ident" id="3203039">nil</span>&nbsp;<span class="op" id="3203043">&amp;&amp;</span>&nbsp;<span class="ident" id="3203046">laddr</span><span class="op" id="3203051">.</span><span class="ident" id="3203052">isWildcard</span><span class="op" id="3203062">(</span><span class="op" id="3203063">)</span>&nbsp;<span class="op" id="3203065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3203070">laddr</span>&nbsp;<span class="op" id="3203076">=</span>&nbsp;<span class="ident" id="3203078">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3203084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203088">if</span>&nbsp;<span class="ident" id="3203091">raddr</span>&nbsp;<span class="op" id="3203097">!=</span>&nbsp;<span class="ident" id="3203100">nil</span>&nbsp;<span class="op" id="3203104">&amp;&amp;</span>&nbsp;<span class="ident" id="3203107">raddr</span><span class="op" id="3203112">.</span><span class="ident" id="3203113">isWildcard</span><span class="op" id="3203123">(</span><span class="op" id="3203124">)</span>&nbsp;<span class="op" id="3203126">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3203131">raddr</span>&nbsp;<span class="op" id="3203137">=</span>&nbsp;<span class="ident" id="3203139">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3203145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203149">if</span>&nbsp;<span class="ident" id="3203152">raddr</span>&nbsp;<span class="op" id="3203158">==</span>&nbsp;<span class="ident" id="3203161">nil</span>&nbsp;<span class="op" id="3203165">&amp;&amp;</span>&nbsp;<span class="op" id="3203168">(</span><span class="ident" id="3203169">sotype</span>&nbsp;<span class="op" id="3203176">!=</span>&nbsp;<span class="ident" id="3203179">syscall</span><span class="op" id="3203186">.</span><span class="ident" id="3203187">SOCK_DGRAM</span>&nbsp;<span class="op" id="3203198">||</span>&nbsp;<span class="ident" id="3203201">laddr</span>&nbsp;<span class="op" id="3203207">==</span>&nbsp;<span class="ident" id="3203210">nil</span><span class="op" id="3203213">)</span>&nbsp;<span class="op" id="3203215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203220">return</span>&nbsp;<span class="ident" id="3203227">nil</span><span class="op" id="3203230">,</span>&nbsp;<span class="ident" id="3203232">errMissingAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3203252">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203255">case</span>&nbsp;<span class="string" id="3203260">&#34;listen&#34;</span><span class="op" id="3203268">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203271">default</span><span class="op" id="3203278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203282">return</span>&nbsp;<span class="ident" id="3203289">nil</span><span class="op" id="3203292">,</span>&nbsp;<span class="ident" id="3203294">errors</span><span class="op" id="3203300">.</span><span class="ident" id="3203301">New</span><span class="op" id="3203304">(</span><span class="string" id="3203305">&#34;unknown&nbsp;mode:&nbsp;&#34;</span>&nbsp;<span class="op" id="3203322">+</span>&nbsp;<span class="ident" id="3203324">mode</span><span class="op" id="3203328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3203331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3203335">fd</span><span class="op" id="3203337">,</span>&nbsp;<span class="ident" id="3203339">err</span>&nbsp;<span class="op" id="3203343">:=</span>&nbsp;<span class="ident" id="3203346">socket</span><span class="op" id="3203352">(</span><span class="ident" id="3203353">net</span><span class="op" id="3203356">,</span>&nbsp;<span class="ident" id="3203358">syscall</span><span class="op" id="3203365">.</span><span class="ident" id="3203366">AF_UNIX</span><span class="op" id="3203373">,</span>&nbsp;<span class="ident" id="3203375">sotype</span><span class="op" id="3203381">,</span>&nbsp;<span class="num" id="3203383">0</span><span class="op" id="3203384">,</span>&nbsp;<span class="builtintype" id="3203386">false</span><span class="op" id="3203391">,</span>&nbsp;<span class="ident" id="3203393">laddr</span><span class="op" id="3203398">,</span>&nbsp;<span class="ident" id="3203400">raddr</span><span class="op" id="3203405">,</span>&nbsp;<span class="ident" id="3203407">deadline</span><span class="op" id="3203415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203418">if</span>&nbsp;<span class="ident" id="3203421">err</span>&nbsp;<span class="op" id="3203425">!=</span>&nbsp;<span class="ident" id="3203428">nil</span>&nbsp;<span class="op" id="3203432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203436">return</span>&nbsp;<span class="ident" id="3203443">nil</span><span class="op" id="3203446">,</span>&nbsp;<span class="ident" id="3203448">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3203453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203456">return</span>&nbsp;<span class="ident" id="3203463">fd</span><span class="op" id="3203465">,</span>&nbsp;<span class="ident" id="3203467">nil</span><br>
<span class="lineno">50</span><span class="op" id="3203471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3203474">func</span>&nbsp;<span class="ident" id="3203479">sockaddrToUnix</span><span class="op" id="3203493">(</span><span class="ident" id="3203494">sa</span>&nbsp;<span class="ident" id="3203497">syscall</span><span class="op" id="3203504">.</span><span class="ident" id="3203505">Sockaddr</span><span class="op" id="3203513">)</span>&nbsp;<span class="ident" id="3203515">Addr</span>&nbsp;<span class="op" id="3203520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203523">if</span>&nbsp;<span class="ident" id="3203526">s</span><span class="op" id="3203527">,</span>&nbsp;<span class="ident" id="3203529">ok</span>&nbsp;<span class="op" id="3203532">:=</span>&nbsp;<span class="ident" id="3203535">sa</span><span class="op" id="3203537">.</span><span class="op" id="3203538">(</span><span class="op" id="3203539">*</span><span class="ident" id="3203540">syscall</span><span class="op" id="3203547">.</span><span class="ident" id="3203548">SockaddrUnix</span><span class="op" id="3203560">)</span><span class="op" id="3203561">;</span>&nbsp;<span class="ident" id="3203563">ok</span>&nbsp;<span class="op" id="3203566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203570">return</span>&nbsp;<span class="op" id="3203577">&amp;</span><span class="ident" id="3203578">UnixAddr</span><span class="op" id="3203586">{</span><span class="ident" id="3203587">Name</span><span class="op" id="3203591">:</span>&nbsp;<span class="ident" id="3203593">s</span><span class="op" id="3203594">.</span><span class="ident" id="3203595">Name</span><span class="op" id="3203599">,</span>&nbsp;<span class="ident" id="3203601">Net</span><span class="op" id="3203604">:</span>&nbsp;<span class="string" id="3203606">&#34;unix&#34;</span><span class="op" id="3203612">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3203615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203618">return</span>&nbsp;<span class="ident" id="3203625">nil</span><br>
<span class="lineno"></span><span class="op" id="3203629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3203632">func</span>&nbsp;<span class="ident" id="3203637">sockaddrToUnixgram</span><span class="op" id="3203655">(</span><span class="ident" id="3203656">sa</span>&nbsp;<span class="ident" id="3203659">syscall</span><span class="op" id="3203666">.</span><span class="ident" id="3203667">Sockaddr</span><span class="op" id="3203675">)</span>&nbsp;<span class="ident" id="3203677">Addr</span>&nbsp;<span class="op" id="3203682">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203685">if</span>&nbsp;<span class="ident" id="3203688">s</span><span class="op" id="3203689">,</span>&nbsp;<span class="ident" id="3203691">ok</span>&nbsp;<span class="op" id="3203694">:=</span>&nbsp;<span class="ident" id="3203697">sa</span><span class="op" id="3203699">.</span><span class="op" id="3203700">(</span><span class="op" id="3203701">*</span><span class="ident" id="3203702">syscall</span><span class="op" id="3203709">.</span><span class="ident" id="3203710">SockaddrUnix</span><span class="op" id="3203722">)</span><span class="op" id="3203723">;</span>&nbsp;<span class="ident" id="3203725">ok</span>&nbsp;<span class="op" id="3203728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203732">return</span>&nbsp;<span class="op" id="3203739">&amp;</span><span class="ident" id="3203740">UnixAddr</span><span class="op" id="3203748">{</span><span class="ident" id="3203749">Name</span><span class="op" id="3203753">:</span>&nbsp;<span class="ident" id="3203755">s</span><span class="op" id="3203756">.</span><span class="ident" id="3203757">Name</span><span class="op" id="3203761">,</span>&nbsp;<span class="ident" id="3203763">Net</span><span class="op" id="3203766">:</span>&nbsp;<span class="string" id="3203768">&#34;unixgram&#34;</span><span class="op" id="3203778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3203781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203784">return</span>&nbsp;<span class="ident" id="3203791">nil</span><br>
<span class="lineno"></span><span class="op" id="3203795">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3203798">func</span>&nbsp;<span class="ident" id="3203803">sockaddrToUnixpacket</span><span class="op" id="3203823">(</span><span class="ident" id="3203824">sa</span>&nbsp;<span class="ident" id="3203827">syscall</span><span class="op" id="3203834">.</span><span class="ident" id="3203835">Sockaddr</span><span class="op" id="3203843">)</span>&nbsp;<span class="ident" id="3203845">Addr</span>&nbsp;<span class="op" id="3203850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203853">if</span>&nbsp;<span class="ident" id="3203856">s</span><span class="op" id="3203857">,</span>&nbsp;<span class="ident" id="3203859">ok</span>&nbsp;<span class="op" id="3203862">:=</span>&nbsp;<span class="ident" id="3203865">sa</span><span class="op" id="3203867">.</span><span class="op" id="3203868">(</span><span class="op" id="3203869">*</span><span class="ident" id="3203870">syscall</span><span class="op" id="3203877">.</span><span class="ident" id="3203878">SockaddrUnix</span><span class="op" id="3203890">)</span><span class="op" id="3203891">;</span>&nbsp;<span class="ident" id="3203893">ok</span>&nbsp;<span class="op" id="3203896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203900">return</span>&nbsp;<span class="op" id="3203907">&amp;</span><span class="ident" id="3203908">UnixAddr</span><span class="op" id="3203916">{</span><span class="ident" id="3203917">Name</span><span class="op" id="3203921">:</span>&nbsp;<span class="ident" id="3203923">s</span><span class="op" id="3203924">.</span><span class="ident" id="3203925">Name</span><span class="op" id="3203929">,</span>&nbsp;<span class="ident" id="3203931">Net</span><span class="op" id="3203934">:</span>&nbsp;<span class="string" id="3203936">&#34;unixpacket&#34;</span><span class="op" id="3203948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3203951">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3203954">return</span>&nbsp;<span class="ident" id="3203961">nil</span><br>
<span class="lineno"></span><span class="op" id="3203965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3203968">func</span>&nbsp;<span class="ident" id="3203973">sotypeToNet</span><span class="op" id="3203984">(</span><span class="ident" id="3203985">sotype</span>&nbsp;<span class="builtintype" id="3203992">int</span><span class="op" id="3203995">)</span>&nbsp;<span class="builtintype" id="3203997">string</span>&nbsp;<span class="op" id="3204004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3204007">switch</span>&nbsp;<span class="ident" id="3204014">sotype</span>&nbsp;<span class="op" id="3204021">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3204024">case</span>&nbsp;<span class="ident" id="3204029">syscall</span><span class="op" id="3204036">.</span><span class="ident" id="3204037">SOCK_STREAM</span><span class="op" id="3204048">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3204052">return</span>&nbsp;<span class="string" id="3204059">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3204067">case</span>&nbsp;<span class="ident" id="3204072">syscall</span><span class="op" id="3204079">.</span><span class="ident" id="3204080">SOCK_DGRAM</span><span class="op" id="3204090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3204094">return</span>&nbsp;<span class="string" id="3204101">&#34;unixgram&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3204113">case</span>&nbsp;<span class="ident" id="3204118">syscall</span><span class="op" id="3204125">.</span><span class="ident" id="3204126">SOCK_SEQPACKET</span><span class="op" id="3204140">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3204144">return</span>&nbsp;<span class="string" id="3204151">&#34;unixpacket&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3204165">default</span><span class="op" id="3204172">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3204176">panic</span><span class="op" id="3204181">(</span><span class="string" id="3204182">&#34;sotypeToNet&nbsp;unknown&nbsp;socket&nbsp;type&#34;</span><span class="op" id="3204215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3204218">}</span><br>
<span class="lineno"></span><span class="op" id="3204220">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="3204223">func</span>&nbsp;<span class="op" id="3204228">(</span><span class="ident" id="3204229">a</span>&nbsp;<span class="op" id="3204231">*</span><span class="ident" id="3204232">UnixAddr</span><span class="op" id="3204240">)</span>&nbsp;<span class="ident" id="3204242">family</span><span class="op" id="3204248">(</span><span class="op" id="3204249">)</span>&nbsp;<span class="builtintype" id="3204251">int</span>&nbsp;<span class="op" id="3204255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3204258">return</span>&nbsp;<span class="ident" id="3204265">syscall</span><span class="op" id="3204272">.</span><span class="ident" id="3204273">AF_UNIX</span><br>
<span class="lineno"></span><span class="op" id="3204281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3204284">func</span>&nbsp;<span class="op" id="3204289">(</span><span class="ident" id="3204290">a</span>&nbsp;<span class="op" id="3204292">*</span><span class="ident" id="3204293">UnixAddr</span><span class="op" id="3204301">)</span>&nbsp;<span class="ident" id="3204303">isWildcard</span><span class="op" id="3204313">(</span><span class="op" id="3204314">)</span>&nbsp;<span class="builtintype" id="3204316">bool</span>&nbsp;<span class="op" id="3204321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3204324">return</span>&nbsp;<span class="ident" id="3204331">a</span>&nbsp;<span class="op" id="3204333">==</span>&nbsp;<span class="ident" id="3204336">nil</span>&nbsp;<span class="op" id="3204340">||</span>&nbsp;<span class="ident" id="3204343">a</span><span class="op" id="3204344">.</span><span class="ident" id="3204345">Name</span>&nbsp;<span class="op" id="3204350">==</span>&nbsp;<span class="string" id="3204353">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3204356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3204359">func</span>&nbsp;<span class="op" id="3204364">(</span><span class="ident" id="3204365">a</span>&nbsp;<span class="op" id="3204367">*</span><span class="ident" id="3204368">UnixAddr</span><span class="op" id="3204376">)</span>&nbsp;<span class="ident" id="3204378">sockaddr</span><span class="op" id="3204386">(</span><span class="ident" id="3204387">family</span>&nbsp;<span class="builtintype" id="3204394">int</span><span class="op" id="3204397">)</span>&nbsp;<span class="op" id="3204399">(</span><span class="ident" id="3204400">syscall</span><span class="op" id="3204407">.</span><span class="ident" id="3204408">Sockaddr</span><span class="op" id="3204416">,</span>&nbsp;<span class="builtintype" id="3204418">error</span><span class="op" id="3204423">)</span>&nbsp;<span class="op" id="3204425">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3204428">if</span>&nbsp;<span class="ident" id="3204431">a</span>&nbsp;<span class="op" id="3204433">==</span>&nbsp;<span class="ident" id="3204436">nil</span>&nbsp;<span class="op" id="3204440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3204444">return</span>&nbsp;<span class="ident" id="3204451">nil</span><span class="op" id="3204454">,</span>&nbsp;<span class="ident" id="3204456">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3204461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3204464">return</span>&nbsp;<span class="op" id="3204471">&amp;</span><span class="ident" id="3204472">syscall</span><span class="op" id="3204479">.</span><span class="ident" id="3204480">SockaddrUnix</span><span class="op" id="3204492">{</span><span class="ident" id="3204493">Name</span><span class="op" id="3204497">:</span>&nbsp;<span class="ident" id="3204499">a</span><span class="op" id="3204500">.</span><span class="ident" id="3204501">Name</span><span class="op" id="3204505">}</span><span class="op" id="3204506">,</span>&nbsp;<span class="ident" id="3204508">nil</span><br>
<span class="lineno"></span><span class="op" id="3204512">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="3204515">//&nbsp;UnixConn&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;interface&nbsp;for&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="3204586">//&nbsp;to&nbsp;Unix&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3204613">type</span>&nbsp;<span class="ident" id="3204618">UnixConn</span>&nbsp;<span class="keyword" id="3204627">struct</span>&nbsp;<span class="op" id="3204634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3204637">conn</span><br>
<span class="lineno">105</span><span class="op" id="3204642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3204645">func</span>&nbsp;<span class="ident" id="3204650">newUnixConn</span><span class="op" id="3204661">(</span><span class="ident" id="3204662">fd</span>&nbsp;<span class="op" id="3204665">*</span><span class="ident" id="3204666">netFD</span><span class="op" id="3204671">)</span>&nbsp;<span class="op" id="3204673">*</span><span class="ident" id="3204674">UnixConn</span>&nbsp;<span class="op" id="3204683">{</span>&nbsp;<span class="keyword" id="3204685">return</span>&nbsp;<span class="op" id="3204692">&amp;</span><span class="ident" id="3204693">UnixConn</span><span class="op" id="3204701">{</span><span class="ident" id="3204702">conn</span><span class="op" id="3204706">{</span><span class="ident" id="3204707">fd</span><span class="op" id="3204709">}</span><span class="op" id="3204710">}</span>&nbsp;<span class="op" id="3204712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3204715">//&nbsp;ReadFromUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.&nbsp;&nbsp;It</span><br>
<span class="lineno">110</span><span class="comment" id="3204786">//&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3204857">//&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3204872">//</span><br>
<span class="lineno"></span><span class="comment" id="3204875">//&nbsp;ReadFromUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3204940">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="3205007">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3205027">func</span>&nbsp;<span class="op" id="3205032">(</span><span class="ident" id="3205033">c</span>&nbsp;<span class="op" id="3205035">*</span><span class="ident" id="3205036">UnixConn</span><span class="op" id="3205044">)</span>&nbsp;<span class="ident" id="3205046">ReadFromUnix</span><span class="op" id="3205058">(</span><span class="ident" id="3205059">b</span>&nbsp;<span class="op" id="3205061">[</span><span class="op" id="3205062">]</span><span class="builtintype" id="3205063">byte</span><span class="op" id="3205067">)</span>&nbsp;<span class="op" id="3205069">(</span><span class="ident" id="3205070">n</span>&nbsp;<span class="builtintype" id="3205072">int</span><span class="op" id="3205075">,</span>&nbsp;<span class="ident" id="3205077">addr</span>&nbsp;<span class="op" id="3205082">*</span><span class="ident" id="3205083">UnixAddr</span><span class="op" id="3205091">,</span>&nbsp;<span class="ident" id="3205093">err</span>&nbsp;<span class="builtintype" id="3205097">error</span><span class="op" id="3205102">)</span>&nbsp;<span class="op" id="3205104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3205107">if</span>&nbsp;<span class="op" id="3205110">!</span><span class="ident" id="3205111">c</span><span class="op" id="3205112">.</span><span class="ident" id="3205113">ok</span><span class="op" id="3205115">(</span><span class="op" id="3205116">)</span>&nbsp;<span class="op" id="3205118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3205122">return</span>&nbsp;<span class="num" id="3205129">0</span><span class="op" id="3205130">,</span>&nbsp;<span class="ident" id="3205132">nil</span><span class="op" id="3205135">,</span>&nbsp;<span class="ident" id="3205137">syscall</span><span class="op" id="3205144">.</span><span class="ident" id="3205145">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3205153">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3205156">n</span><span class="op" id="3205157">,</span>&nbsp;<span class="ident" id="3205159">sa</span><span class="op" id="3205161">,</span>&nbsp;<span class="ident" id="3205163">err</span>&nbsp;<span class="op" id="3205167">:=</span>&nbsp;<span class="ident" id="3205170">c</span><span class="op" id="3205171">.</span><span class="ident" id="3205172">fd</span><span class="op" id="3205174">.</span><span class="ident" id="3205175">readFrom</span><span class="op" id="3205183">(</span><span class="ident" id="3205184">b</span><span class="op" id="3205185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3205188">switch</span>&nbsp;<span class="ident" id="3205195">sa</span>&nbsp;<span class="op" id="3205198">:=</span>&nbsp;<span class="ident" id="3205201">sa</span><span class="op" id="3205203">.</span><span class="op" id="3205204">(</span><span class="keyword" id="3205205">type</span><span class="op" id="3205209">)</span>&nbsp;<span class="op" id="3205211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3205214">case</span>&nbsp;<span class="op" id="3205219">*</span><span class="ident" id="3205220">syscall</span><span class="op" id="3205227">.</span><span class="ident" id="3205228">SockaddrUnix</span><span class="op" id="3205240">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3205244">if</span>&nbsp;<span class="ident" id="3205247">sa</span><span class="op" id="3205249">.</span><span class="ident" id="3205250">Name</span>&nbsp;<span class="op" id="3205255">!=</span>&nbsp;<span class="string" id="3205258">&#34;&#34;</span>&nbsp;<span class="op" id="3205261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3205266">addr</span>&nbsp;<span class="op" id="3205271">=</span>&nbsp;<span class="op" id="3205273">&amp;</span><span class="ident" id="3205274">UnixAddr</span><span class="op" id="3205282">{</span><span class="ident" id="3205283">Name</span><span class="op" id="3205287">:</span>&nbsp;<span class="ident" id="3205289">sa</span><span class="op" id="3205291">.</span><span class="ident" id="3205292">Name</span><span class="op" id="3205296">,</span>&nbsp;<span class="ident" id="3205298">Net</span><span class="op" id="3205301">:</span>&nbsp;<span class="ident" id="3205303">sotypeToNet</span><span class="op" id="3205314">(</span><span class="ident" id="3205315">c</span><span class="op" id="3205316">.</span><span class="ident" id="3205317">fd</span><span class="op" id="3205319">.</span><span class="ident" id="3205320">sotype</span><span class="op" id="3205326">)</span><span class="op" id="3205327">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3205331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3205334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3205337">return</span><br>
<span class="lineno"></span><span class="op" id="3205344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3205347">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3205402">func</span>&nbsp;<span class="op" id="3205407">(</span><span class="ident" id="3205408">c</span>&nbsp;<span class="op" id="3205410">*</span><span class="ident" id="3205411">UnixConn</span><span class="op" id="3205419">)</span>&nbsp;<span class="ident" id="3205421">ReadFrom</span><span class="op" id="3205429">(</span><span class="ident" id="3205430">b</span>&nbsp;<span class="op" id="3205432">[</span><span class="op" id="3205433">]</span><span class="builtintype" id="3205434">byte</span><span class="op" id="3205438">)</span>&nbsp;<span class="op" id="3205440">(</span><span class="builtintype" id="3205441">int</span><span class="op" id="3205444">,</span>&nbsp;<span class="ident" id="3205446">Addr</span><span class="op" id="3205450">,</span>&nbsp;<span class="builtintype" id="3205452">error</span><span class="op" id="3205457">)</span>&nbsp;<span class="op" id="3205459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3205462">if</span>&nbsp;<span class="op" id="3205465">!</span><span class="ident" id="3205466">c</span><span class="op" id="3205467">.</span><span class="ident" id="3205468">ok</span><span class="op" id="3205470">(</span><span class="op" id="3205471">)</span>&nbsp;<span class="op" id="3205473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3205477">return</span>&nbsp;<span class="num" id="3205484">0</span><span class="op" id="3205485">,</span>&nbsp;<span class="ident" id="3205487">nil</span><span class="op" id="3205490">,</span>&nbsp;<span class="ident" id="3205492">syscall</span><span class="op" id="3205499">.</span><span class="ident" id="3205500">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3205508">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3205511">n</span><span class="op" id="3205512">,</span>&nbsp;<span class="ident" id="3205514">addr</span><span class="op" id="3205518">,</span>&nbsp;<span class="ident" id="3205520">err</span>&nbsp;<span class="op" id="3205524">:=</span>&nbsp;<span class="ident" id="3205527">c</span><span class="op" id="3205528">.</span><span class="ident" id="3205529">ReadFromUnix</span><span class="op" id="3205541">(</span><span class="ident" id="3205542">b</span><span class="op" id="3205543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3205546">return</span>&nbsp;<span class="ident" id="3205553">n</span><span class="op" id="3205554">,</span>&nbsp;<span class="ident" id="3205556">addr</span><span class="op" id="3205560">.</span><span class="ident" id="3205561">toAddr</span><span class="op" id="3205567">(</span><span class="op" id="3205568">)</span><span class="op" id="3205569">,</span>&nbsp;<span class="ident" id="3205571">err</span><br>
<span class="lineno"></span><span class="op" id="3205575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3205578">//&nbsp;ReadMsgUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno">140</span><span class="comment" id="3205647">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3205718">//&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the&nbsp;flags</span><br>
<span class="lineno"></span><span class="comment" id="3205789">//&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet,&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="3205859">func</span>&nbsp;<span class="op" id="3205864">(</span><span class="ident" id="3205865">c</span>&nbsp;<span class="op" id="3205867">*</span><span class="ident" id="3205868">UnixConn</span><span class="op" id="3205876">)</span>&nbsp;<span class="ident" id="3205878">ReadMsgUnix</span><span class="op" id="3205889">(</span><span class="ident" id="3205890">b</span><span class="op" id="3205891">,</span>&nbsp;<span class="ident" id="3205893">oob</span>&nbsp;<span class="op" id="3205897">[</span><span class="op" id="3205898">]</span><span class="builtintype" id="3205899">byte</span><span class="op" id="3205903">)</span>&nbsp;<span class="op" id="3205905">(</span><span class="ident" id="3205906">n</span><span class="op" id="3205907">,</span>&nbsp;<span class="ident" id="3205909">oobn</span><span class="op" id="3205913">,</span>&nbsp;<span class="ident" id="3205915">flags</span>&nbsp;<span class="builtintype" id="3205921">int</span><span class="op" id="3205924">,</span>&nbsp;<span class="ident" id="3205926">addr</span>&nbsp;<span class="op" id="3205931">*</span><span class="ident" id="3205932">UnixAddr</span><span class="op" id="3205940">,</span>&nbsp;<span class="ident" id="3205942">err</span>&nbsp;<span class="builtintype" id="3205946">error</span><span class="op" id="3205951">)</span>&nbsp;<span class="op" id="3205953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3205956">if</span>&nbsp;<span class="op" id="3205959">!</span><span class="ident" id="3205960">c</span><span class="op" id="3205961">.</span><span class="ident" id="3205962">ok</span><span class="op" id="3205964">(</span><span class="op" id="3205965">)</span>&nbsp;<span class="op" id="3205967">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3205971">return</span>&nbsp;<span class="num" id="3205978">0</span><span class="op" id="3205979">,</span>&nbsp;<span class="num" id="3205981">0</span><span class="op" id="3205982">,</span>&nbsp;<span class="num" id="3205984">0</span><span class="op" id="3205985">,</span>&nbsp;<span class="ident" id="3205987">nil</span><span class="op" id="3205990">,</span>&nbsp;<span class="ident" id="3205992">syscall</span><span class="op" id="3205999">.</span><span class="ident" id="3206000">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3206008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3206011">n</span><span class="op" id="3206012">,</span>&nbsp;<span class="ident" id="3206014">oobn</span><span class="op" id="3206018">,</span>&nbsp;<span class="ident" id="3206020">flags</span><span class="op" id="3206025">,</span>&nbsp;<span class="ident" id="3206027">sa</span><span class="op" id="3206029">,</span>&nbsp;<span class="ident" id="3206031">err</span>&nbsp;<span class="op" id="3206035">:=</span>&nbsp;<span class="ident" id="3206038">c</span><span class="op" id="3206039">.</span><span class="ident" id="3206040">fd</span><span class="op" id="3206042">.</span><span class="ident" id="3206043">readMsg</span><span class="op" id="3206050">(</span><span class="ident" id="3206051">b</span><span class="op" id="3206052">,</span>&nbsp;<span class="ident" id="3206054">oob</span><span class="op" id="3206057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3206060">switch</span>&nbsp;<span class="ident" id="3206067">sa</span>&nbsp;<span class="op" id="3206070">:=</span>&nbsp;<span class="ident" id="3206073">sa</span><span class="op" id="3206075">.</span><span class="op" id="3206076">(</span><span class="keyword" id="3206077">type</span><span class="op" id="3206081">)</span>&nbsp;<span class="op" id="3206083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3206086">case</span>&nbsp;<span class="op" id="3206091">*</span><span class="ident" id="3206092">syscall</span><span class="op" id="3206099">.</span><span class="ident" id="3206100">SockaddrUnix</span><span class="op" id="3206112">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3206116">if</span>&nbsp;<span class="ident" id="3206119">sa</span><span class="op" id="3206121">.</span><span class="ident" id="3206122">Name</span>&nbsp;<span class="op" id="3206127">!=</span>&nbsp;<span class="string" id="3206130">&#34;&#34;</span>&nbsp;<span class="op" id="3206133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3206138">addr</span>&nbsp;<span class="op" id="3206143">=</span>&nbsp;<span class="op" id="3206145">&amp;</span><span class="ident" id="3206146">UnixAddr</span><span class="op" id="3206154">{</span><span class="ident" id="3206155">Name</span><span class="op" id="3206159">:</span>&nbsp;<span class="ident" id="3206161">sa</span><span class="op" id="3206163">.</span><span class="ident" id="3206164">Name</span><span class="op" id="3206168">,</span>&nbsp;<span class="ident" id="3206170">Net</span><span class="op" id="3206173">:</span>&nbsp;<span class="ident" id="3206175">sotypeToNet</span><span class="op" id="3206186">(</span><span class="ident" id="3206187">c</span><span class="op" id="3206188">.</span><span class="ident" id="3206189">fd</span><span class="op" id="3206191">.</span><span class="ident" id="3206192">sotype</span><span class="op" id="3206198">)</span><span class="op" id="3206199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3206203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3206206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3206209">return</span><br>
<span class="lineno">155</span><span class="op" id="3206216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3206219">//&nbsp;WriteToUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3206293">//</span><br>
<span class="lineno"></span><span class="comment" id="3206296">//&nbsp;WriteToUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">160</span><span class="comment" id="3206360">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3206427">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3206496">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3206509">func</span>&nbsp;<span class="op" id="3206514">(</span><span class="ident" id="3206515">c</span>&nbsp;<span class="op" id="3206517">*</span><span class="ident" id="3206518">UnixConn</span><span class="op" id="3206526">)</span>&nbsp;<span class="ident" id="3206528">WriteToUnix</span><span class="op" id="3206539">(</span><span class="ident" id="3206540">b</span>&nbsp;<span class="op" id="3206542">[</span><span class="op" id="3206543">]</span><span class="builtintype" id="3206544">byte</span><span class="op" id="3206548">,</span>&nbsp;<span class="ident" id="3206550">addr</span>&nbsp;<span class="op" id="3206555">*</span><span class="ident" id="3206556">UnixAddr</span><span class="op" id="3206564">)</span>&nbsp;<span class="op" id="3206566">(</span><span class="ident" id="3206567">n</span>&nbsp;<span class="builtintype" id="3206569">int</span><span class="op" id="3206572">,</span>&nbsp;<span class="ident" id="3206574">err</span>&nbsp;<span class="builtintype" id="3206578">error</span><span class="op" id="3206583">)</span>&nbsp;<span class="op" id="3206585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3206588">if</span>&nbsp;<span class="op" id="3206591">!</span><span class="ident" id="3206592">c</span><span class="op" id="3206593">.</span><span class="ident" id="3206594">ok</span><span class="op" id="3206596">(</span><span class="op" id="3206597">)</span>&nbsp;<span class="op" id="3206599">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3206603">return</span>&nbsp;<span class="num" id="3206610">0</span><span class="op" id="3206611">,</span>&nbsp;<span class="ident" id="3206613">syscall</span><span class="op" id="3206620">.</span><span class="ident" id="3206621">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3206629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3206632">if</span>&nbsp;<span class="ident" id="3206635">c</span><span class="op" id="3206636">.</span><span class="ident" id="3206637">fd</span><span class="op" id="3206639">.</span><span class="ident" id="3206640">isConnected</span>&nbsp;<span class="op" id="3206652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3206656">return</span>&nbsp;<span class="num" id="3206663">0</span><span class="op" id="3206664">,</span>&nbsp;<span class="op" id="3206666">&amp;</span><span class="ident" id="3206667">OpError</span><span class="op" id="3206674">{</span><span class="ident" id="3206675">Op</span><span class="op" id="3206677">:</span>&nbsp;<span class="string" id="3206679">&#34;write&#34;</span><span class="op" id="3206686">,</span>&nbsp;<span class="ident" id="3206688">Net</span><span class="op" id="3206691">:</span>&nbsp;<span class="ident" id="3206693">c</span><span class="op" id="3206694">.</span><span class="ident" id="3206695">fd</span><span class="op" id="3206697">.</span><span class="ident" id="3206698">net</span><span class="op" id="3206701">,</span>&nbsp;<span class="ident" id="3206703">Addr</span><span class="op" id="3206707">:</span>&nbsp;<span class="ident" id="3206709">addr</span><span class="op" id="3206713">,</span>&nbsp;<span class="ident" id="3206715">Err</span><span class="op" id="3206718">:</span>&nbsp;<span class="ident" id="3206720">ErrWriteToConnected</span><span class="op" id="3206739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3206742">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3206745">if</span>&nbsp;<span class="ident" id="3206748">addr</span>&nbsp;<span class="op" id="3206753">==</span>&nbsp;<span class="ident" id="3206756">nil</span>&nbsp;<span class="op" id="3206760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3206764">return</span>&nbsp;<span class="num" id="3206771">0</span><span class="op" id="3206772">,</span>&nbsp;<span class="op" id="3206774">&amp;</span><span class="ident" id="3206775">OpError</span><span class="op" id="3206782">{</span><span class="ident" id="3206783">Op</span><span class="op" id="3206785">:</span>&nbsp;<span class="string" id="3206787">&#34;write&#34;</span><span class="op" id="3206794">,</span>&nbsp;<span class="ident" id="3206796">Net</span><span class="op" id="3206799">:</span>&nbsp;<span class="ident" id="3206801">c</span><span class="op" id="3206802">.</span><span class="ident" id="3206803">fd</span><span class="op" id="3206805">.</span><span class="ident" id="3206806">net</span><span class="op" id="3206809">,</span>&nbsp;<span class="ident" id="3206811">Addr</span><span class="op" id="3206815">:</span>&nbsp;<span class="ident" id="3206817">nil</span><span class="op" id="3206820">,</span>&nbsp;<span class="ident" id="3206822">Err</span><span class="op" id="3206825">:</span>&nbsp;<span class="ident" id="3206827">errMissingAddress</span><span class="op" id="3206844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3206847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3206850">if</span>&nbsp;<span class="ident" id="3206853">addr</span><span class="op" id="3206857">.</span><span class="ident" id="3206858">Net</span>&nbsp;<span class="op" id="3206862">!=</span>&nbsp;<span class="ident" id="3206865">sotypeToNet</span><span class="op" id="3206876">(</span><span class="ident" id="3206877">c</span><span class="op" id="3206878">.</span><span class="ident" id="3206879">fd</span><span class="op" id="3206881">.</span><span class="ident" id="3206882">sotype</span><span class="op" id="3206888">)</span>&nbsp;<span class="op" id="3206890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3206894">return</span>&nbsp;<span class="num" id="3206901">0</span><span class="op" id="3206902">,</span>&nbsp;<span class="ident" id="3206904">syscall</span><span class="op" id="3206911">.</span><span class="ident" id="3206912">EAFNOSUPPORT</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3206926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3206929">sa</span>&nbsp;<span class="op" id="3206932">:=</span>&nbsp;<span class="op" id="3206935">&amp;</span><span class="ident" id="3206936">syscall</span><span class="op" id="3206943">.</span><span class="ident" id="3206944">SockaddrUnix</span><span class="op" id="3206956">{</span><span class="ident" id="3206957">Name</span><span class="op" id="3206961">:</span>&nbsp;<span class="ident" id="3206963">addr</span><span class="op" id="3206967">.</span><span class="ident" id="3206968">Name</span><span class="op" id="3206972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3206975">return</span>&nbsp;<span class="ident" id="3206982">c</span><span class="op" id="3206983">.</span><span class="ident" id="3206984">fd</span><span class="op" id="3206986">.</span><span class="ident" id="3206987">writeTo</span><span class="op" id="3206994">(</span><span class="ident" id="3206995">b</span><span class="op" id="3206996">,</span>&nbsp;<span class="ident" id="3206998">sa</span><span class="op" id="3207000">)</span><br>
<span class="lineno"></span><span class="op" id="3207002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="3207005">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3207058">func</span>&nbsp;<span class="op" id="3207063">(</span><span class="ident" id="3207064">c</span>&nbsp;<span class="op" id="3207066">*</span><span class="ident" id="3207067">UnixConn</span><span class="op" id="3207075">)</span>&nbsp;<span class="ident" id="3207077">WriteTo</span><span class="op" id="3207084">(</span><span class="ident" id="3207085">b</span>&nbsp;<span class="op" id="3207087">[</span><span class="op" id="3207088">]</span><span class="builtintype" id="3207089">byte</span><span class="op" id="3207093">,</span>&nbsp;<span class="ident" id="3207095">addr</span>&nbsp;<span class="ident" id="3207100">Addr</span><span class="op" id="3207104">)</span>&nbsp;<span class="op" id="3207106">(</span><span class="ident" id="3207107">n</span>&nbsp;<span class="builtintype" id="3207109">int</span><span class="op" id="3207112">,</span>&nbsp;<span class="ident" id="3207114">err</span>&nbsp;<span class="builtintype" id="3207118">error</span><span class="op" id="3207123">)</span>&nbsp;<span class="op" id="3207125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3207128">if</span>&nbsp;<span class="op" id="3207131">!</span><span class="ident" id="3207132">c</span><span class="op" id="3207133">.</span><span class="ident" id="3207134">ok</span><span class="op" id="3207136">(</span><span class="op" id="3207137">)</span>&nbsp;<span class="op" id="3207139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3207143">return</span>&nbsp;<span class="num" id="3207150">0</span><span class="op" id="3207151">,</span>&nbsp;<span class="ident" id="3207153">syscall</span><span class="op" id="3207160">.</span><span class="ident" id="3207161">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3207169">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3207172">a</span><span class="op" id="3207173">,</span>&nbsp;<span class="ident" id="3207175">ok</span>&nbsp;<span class="op" id="3207178">:=</span>&nbsp;<span class="ident" id="3207181">addr</span><span class="op" id="3207185">.</span><span class="op" id="3207186">(</span><span class="op" id="3207187">*</span><span class="ident" id="3207188">UnixAddr</span><span class="op" id="3207196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3207199">if</span>&nbsp;<span class="op" id="3207202">!</span><span class="ident" id="3207203">ok</span>&nbsp;<span class="op" id="3207206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3207210">return</span>&nbsp;<span class="num" id="3207217">0</span><span class="op" id="3207218">,</span>&nbsp;<span class="op" id="3207220">&amp;</span><span class="ident" id="3207221">OpError</span><span class="op" id="3207228">{</span><span class="string" id="3207229">&#34;write&#34;</span><span class="op" id="3207236">,</span>&nbsp;<span class="ident" id="3207238">c</span><span class="op" id="3207239">.</span><span class="ident" id="3207240">fd</span><span class="op" id="3207242">.</span><span class="ident" id="3207243">net</span><span class="op" id="3207246">,</span>&nbsp;<span class="ident" id="3207248">addr</span><span class="op" id="3207252">,</span>&nbsp;<span class="ident" id="3207254">syscall</span><span class="op" id="3207261">.</span><span class="ident" id="3207262">EINVAL</span><span class="op" id="3207268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3207271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3207274">return</span>&nbsp;<span class="ident" id="3207281">c</span><span class="op" id="3207282">.</span><span class="ident" id="3207283">WriteToUnix</span><span class="op" id="3207294">(</span><span class="ident" id="3207295">b</span><span class="op" id="3207296">,</span>&nbsp;<span class="ident" id="3207298">a</span><span class="op" id="3207299">)</span><br>
<span class="lineno">190</span><span class="op" id="3207301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3207304">//&nbsp;WriteMsgUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3207371">//&nbsp;from&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3207439">//&nbsp;the&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">195</span><span class="keyword" id="3207495">func</span>&nbsp;<span class="op" id="3207500">(</span><span class="ident" id="3207501">c</span>&nbsp;<span class="op" id="3207503">*</span><span class="ident" id="3207504">UnixConn</span><span class="op" id="3207512">)</span>&nbsp;<span class="ident" id="3207514">WriteMsgUnix</span><span class="op" id="3207526">(</span><span class="ident" id="3207527">b</span><span class="op" id="3207528">,</span>&nbsp;<span class="ident" id="3207530">oob</span>&nbsp;<span class="op" id="3207534">[</span><span class="op" id="3207535">]</span><span class="builtintype" id="3207536">byte</span><span class="op" id="3207540">,</span>&nbsp;<span class="ident" id="3207542">addr</span>&nbsp;<span class="op" id="3207547">*</span><span class="ident" id="3207548">UnixAddr</span><span class="op" id="3207556">)</span>&nbsp;<span class="op" id="3207558">(</span><span class="ident" id="3207559">n</span><span class="op" id="3207560">,</span>&nbsp;<span class="ident" id="3207562">oobn</span>&nbsp;<span class="builtintype" id="3207567">int</span><span class="op" id="3207570">,</span>&nbsp;<span class="ident" id="3207572">err</span>&nbsp;<span class="builtintype" id="3207576">error</span><span class="op" id="3207581">)</span>&nbsp;<span class="op" id="3207583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3207586">if</span>&nbsp;<span class="op" id="3207589">!</span><span class="ident" id="3207590">c</span><span class="op" id="3207591">.</span><span class="ident" id="3207592">ok</span><span class="op" id="3207594">(</span><span class="op" id="3207595">)</span>&nbsp;<span class="op" id="3207597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3207601">return</span>&nbsp;<span class="num" id="3207608">0</span><span class="op" id="3207609">,</span>&nbsp;<span class="num" id="3207611">0</span><span class="op" id="3207612">,</span>&nbsp;<span class="ident" id="3207614">syscall</span><span class="op" id="3207621">.</span><span class="ident" id="3207622">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3207630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3207633">if</span>&nbsp;<span class="ident" id="3207636">c</span><span class="op" id="3207637">.</span><span class="ident" id="3207638">fd</span><span class="op" id="3207640">.</span><span class="ident" id="3207641">sotype</span>&nbsp;<span class="op" id="3207648">==</span>&nbsp;<span class="ident" id="3207651">syscall</span><span class="op" id="3207658">.</span><span class="ident" id="3207659">SOCK_DGRAM</span>&nbsp;<span class="op" id="3207670">&amp;&amp;</span>&nbsp;<span class="ident" id="3207673">c</span><span class="op" id="3207674">.</span><span class="ident" id="3207675">fd</span><span class="op" id="3207677">.</span><span class="ident" id="3207678">isConnected</span>&nbsp;<span class="op" id="3207690">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3207694">return</span>&nbsp;<span class="num" id="3207701">0</span><span class="op" id="3207702">,</span>&nbsp;<span class="num" id="3207704">0</span><span class="op" id="3207705">,</span>&nbsp;<span class="op" id="3207707">&amp;</span><span class="ident" id="3207708">OpError</span><span class="op" id="3207715">{</span><span class="ident" id="3207716">Op</span><span class="op" id="3207718">:</span>&nbsp;<span class="string" id="3207720">&#34;write&#34;</span><span class="op" id="3207727">,</span>&nbsp;<span class="ident" id="3207729">Net</span><span class="op" id="3207732">:</span>&nbsp;<span class="ident" id="3207734">c</span><span class="op" id="3207735">.</span><span class="ident" id="3207736">fd</span><span class="op" id="3207738">.</span><span class="ident" id="3207739">net</span><span class="op" id="3207742">,</span>&nbsp;<span class="ident" id="3207744">Addr</span><span class="op" id="3207748">:</span>&nbsp;<span class="ident" id="3207750">addr</span><span class="op" id="3207754">,</span>&nbsp;<span class="ident" id="3207756">Err</span><span class="op" id="3207759">:</span>&nbsp;<span class="ident" id="3207761">ErrWriteToConnected</span><span class="op" id="3207780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3207783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3207786">if</span>&nbsp;<span class="ident" id="3207789">addr</span>&nbsp;<span class="op" id="3207794">!=</span>&nbsp;<span class="ident" id="3207797">nil</span>&nbsp;<span class="op" id="3207801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3207805">if</span>&nbsp;<span class="ident" id="3207808">addr</span><span class="op" id="3207812">.</span><span class="ident" id="3207813">Net</span>&nbsp;<span class="op" id="3207817">!=</span>&nbsp;<span class="ident" id="3207820">sotypeToNet</span><span class="op" id="3207831">(</span><span class="ident" id="3207832">c</span><span class="op" id="3207833">.</span><span class="ident" id="3207834">fd</span><span class="op" id="3207836">.</span><span class="ident" id="3207837">sotype</span><span class="op" id="3207843">)</span>&nbsp;<span class="op" id="3207845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3207850">return</span>&nbsp;<span class="num" id="3207857">0</span><span class="op" id="3207858">,</span>&nbsp;<span class="num" id="3207860">0</span><span class="op" id="3207861">,</span>&nbsp;<span class="ident" id="3207863">syscall</span><span class="op" id="3207870">.</span><span class="ident" id="3207871">EAFNOSUPPORT</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3207886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3207890">sa</span>&nbsp;<span class="op" id="3207893">:=</span>&nbsp;<span class="op" id="3207896">&amp;</span><span class="ident" id="3207897">syscall</span><span class="op" id="3207904">.</span><span class="ident" id="3207905">SockaddrUnix</span><span class="op" id="3207917">{</span><span class="ident" id="3207918">Name</span><span class="op" id="3207922">:</span>&nbsp;<span class="ident" id="3207924">addr</span><span class="op" id="3207928">.</span><span class="ident" id="3207929">Name</span><span class="op" id="3207933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3207937">return</span>&nbsp;<span class="ident" id="3207944">c</span><span class="op" id="3207945">.</span><span class="ident" id="3207946">fd</span><span class="op" id="3207948">.</span><span class="ident" id="3207949">writeMsg</span><span class="op" id="3207957">(</span><span class="ident" id="3207958">b</span><span class="op" id="3207959">,</span>&nbsp;<span class="ident" id="3207961">oob</span><span class="op" id="3207964">,</span>&nbsp;<span class="ident" id="3207966">sa</span><span class="op" id="3207968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3207971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3207974">return</span>&nbsp;<span class="ident" id="3207981">c</span><span class="op" id="3207982">.</span><span class="ident" id="3207983">fd</span><span class="op" id="3207985">.</span><span class="ident" id="3207986">writeMsg</span><span class="op" id="3207994">(</span><span class="ident" id="3207995">b</span><span class="op" id="3207996">,</span>&nbsp;<span class="ident" id="3207998">oob</span><span class="op" id="3208001">,</span>&nbsp;<span class="ident" id="3208003">nil</span><span class="op" id="3208006">)</span><br>
<span class="lineno">210</span><span class="op" id="3208008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3208011">//&nbsp;CloseRead&nbsp;shuts&nbsp;down&nbsp;the&nbsp;reading&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3208083">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3208122">func</span>&nbsp;<span class="op" id="3208127">(</span><span class="ident" id="3208128">c</span>&nbsp;<span class="op" id="3208130">*</span><span class="ident" id="3208131">UnixConn</span><span class="op" id="3208139">)</span>&nbsp;<span class="ident" id="3208141">CloseRead</span><span class="op" id="3208150">(</span><span class="op" id="3208151">)</span>&nbsp;<span class="builtintype" id="3208153">error</span>&nbsp;<span class="op" id="3208159">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3208162">if</span>&nbsp;<span class="op" id="3208165">!</span><span class="ident" id="3208166">c</span><span class="op" id="3208167">.</span><span class="ident" id="3208168">ok</span><span class="op" id="3208170">(</span><span class="op" id="3208171">)</span>&nbsp;<span class="op" id="3208173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3208177">return</span>&nbsp;<span class="ident" id="3208184">syscall</span><span class="op" id="3208191">.</span><span class="ident" id="3208192">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3208200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3208203">return</span>&nbsp;<span class="ident" id="3208210">c</span><span class="op" id="3208211">.</span><span class="ident" id="3208212">fd</span><span class="op" id="3208214">.</span><span class="ident" id="3208215">closeRead</span><span class="op" id="3208224">(</span><span class="op" id="3208225">)</span><br>
<span class="lineno"></span><span class="op" id="3208227">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3208230">//&nbsp;CloseWrite&nbsp;shuts&nbsp;down&nbsp;the&nbsp;writing&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3208303">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3208342">func</span>&nbsp;<span class="op" id="3208347">(</span><span class="ident" id="3208348">c</span>&nbsp;<span class="op" id="3208350">*</span><span class="ident" id="3208351">UnixConn</span><span class="op" id="3208359">)</span>&nbsp;<span class="ident" id="3208361">CloseWrite</span><span class="op" id="3208371">(</span><span class="op" id="3208372">)</span>&nbsp;<span class="builtintype" id="3208374">error</span>&nbsp;<span class="op" id="3208380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3208383">if</span>&nbsp;<span class="op" id="3208386">!</span><span class="ident" id="3208387">c</span><span class="op" id="3208388">.</span><span class="ident" id="3208389">ok</span><span class="op" id="3208391">(</span><span class="op" id="3208392">)</span>&nbsp;<span class="op" id="3208394">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3208398">return</span>&nbsp;<span class="ident" id="3208405">syscall</span><span class="op" id="3208412">.</span><span class="ident" id="3208413">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3208421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3208424">return</span>&nbsp;<span class="ident" id="3208431">c</span><span class="op" id="3208432">.</span><span class="ident" id="3208433">fd</span><span class="op" id="3208435">.</span><span class="ident" id="3208436">closeWrite</span><span class="op" id="3208446">(</span><span class="op" id="3208447">)</span><br>
<span class="lineno"></span><span class="op" id="3208449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="3208452">//&nbsp;DialUnix&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3208521">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3208591">//&nbsp;nil,&nbsp;it&nbsp;is&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3208651">func</span>&nbsp;<span class="ident" id="3208656">DialUnix</span><span class="op" id="3208664">(</span><span class="ident" id="3208665">net</span>&nbsp;<span class="builtintype" id="3208669">string</span><span class="op" id="3208675">,</span>&nbsp;<span class="ident" id="3208677">laddr</span><span class="op" id="3208682">,</span>&nbsp;<span class="ident" id="3208684">raddr</span>&nbsp;<span class="op" id="3208690">*</span><span class="ident" id="3208691">UnixAddr</span><span class="op" id="3208699">)</span>&nbsp;<span class="op" id="3208701">(</span><span class="op" id="3208702">*</span><span class="ident" id="3208703">UnixConn</span><span class="op" id="3208711">,</span>&nbsp;<span class="builtintype" id="3208713">error</span><span class="op" id="3208718">)</span>&nbsp;<span class="op" id="3208720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3208723">switch</span>&nbsp;<span class="ident" id="3208730">net</span>&nbsp;<span class="op" id="3208734">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3208737">case</span>&nbsp;<span class="string" id="3208742">&#34;unix&#34;</span><span class="op" id="3208748">,</span>&nbsp;<span class="string" id="3208750">&#34;unixgram&#34;</span><span class="op" id="3208760">,</span>&nbsp;<span class="string" id="3208762">&#34;unixpacket&#34;</span><span class="op" id="3208774">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3208777">default</span><span class="op" id="3208784">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3208788">return</span>&nbsp;<span class="ident" id="3208795">nil</span><span class="op" id="3208798">,</span>&nbsp;<span class="op" id="3208800">&amp;</span><span class="ident" id="3208801">OpError</span><span class="op" id="3208808">{</span><span class="ident" id="3208809">Op</span><span class="op" id="3208811">:</span>&nbsp;<span class="string" id="3208813">&#34;dial&#34;</span><span class="op" id="3208819">,</span>&nbsp;<span class="ident" id="3208821">Net</span><span class="op" id="3208824">:</span>&nbsp;<span class="ident" id="3208826">net</span><span class="op" id="3208829">,</span>&nbsp;<span class="ident" id="3208831">Addr</span><span class="op" id="3208835">:</span>&nbsp;<span class="ident" id="3208837">raddr</span><span class="op" id="3208842">,</span>&nbsp;<span class="ident" id="3208844">Err</span><span class="op" id="3208847">:</span>&nbsp;<span class="ident" id="3208849">UnknownNetworkError</span><span class="op" id="3208868">(</span><span class="ident" id="3208869">net</span><span class="op" id="3208872">)</span><span class="op" id="3208873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3208876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3208879">return</span>&nbsp;<span class="ident" id="3208886">dialUnix</span><span class="op" id="3208894">(</span><span class="ident" id="3208895">net</span><span class="op" id="3208898">,</span>&nbsp;<span class="ident" id="3208900">laddr</span><span class="op" id="3208905">,</span>&nbsp;<span class="ident" id="3208907">raddr</span><span class="op" id="3208912">,</span>&nbsp;<span class="ident" id="3208914">noDeadline</span><span class="op" id="3208924">)</span><br>
<span class="lineno">240</span><span class="op" id="3208926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3208929">func</span>&nbsp;<span class="ident" id="3208934">dialUnix</span><span class="op" id="3208942">(</span><span class="ident" id="3208943">net</span>&nbsp;<span class="builtintype" id="3208947">string</span><span class="op" id="3208953">,</span>&nbsp;<span class="ident" id="3208955">laddr</span><span class="op" id="3208960">,</span>&nbsp;<span class="ident" id="3208962">raddr</span>&nbsp;<span class="op" id="3208968">*</span><span class="ident" id="3208969">UnixAddr</span><span class="op" id="3208977">,</span>&nbsp;<span class="ident" id="3208979">deadline</span>&nbsp;<span class="ident" id="3208988">time</span><span class="op" id="3208992">.</span><span class="ident" id="3208993">Time</span><span class="op" id="3208997">)</span>&nbsp;<span class="op" id="3208999">(</span><span class="op" id="3209000">*</span><span class="ident" id="3209001">UnixConn</span><span class="op" id="3209009">,</span>&nbsp;<span class="builtintype" id="3209011">error</span><span class="op" id="3209016">)</span>&nbsp;<span class="op" id="3209018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3209021">fd</span><span class="op" id="3209023">,</span>&nbsp;<span class="ident" id="3209025">err</span>&nbsp;<span class="op" id="3209029">:=</span>&nbsp;<span class="ident" id="3209032">unixSocket</span><span class="op" id="3209042">(</span><span class="ident" id="3209043">net</span><span class="op" id="3209046">,</span>&nbsp;<span class="ident" id="3209048">laddr</span><span class="op" id="3209053">,</span>&nbsp;<span class="ident" id="3209055">raddr</span><span class="op" id="3209060">,</span>&nbsp;<span class="string" id="3209062">&#34;dial&#34;</span><span class="op" id="3209068">,</span>&nbsp;<span class="ident" id="3209070">deadline</span><span class="op" id="3209078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3209081">if</span>&nbsp;<span class="ident" id="3209084">err</span>&nbsp;<span class="op" id="3209088">!=</span>&nbsp;<span class="ident" id="3209091">nil</span>&nbsp;<span class="op" id="3209095">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3209099">return</span>&nbsp;<span class="ident" id="3209106">nil</span><span class="op" id="3209109">,</span>&nbsp;<span class="op" id="3209111">&amp;</span><span class="ident" id="3209112">OpError</span><span class="op" id="3209119">{</span><span class="ident" id="3209120">Op</span><span class="op" id="3209122">:</span>&nbsp;<span class="string" id="3209124">&#34;dial&#34;</span><span class="op" id="3209130">,</span>&nbsp;<span class="ident" id="3209132">Net</span><span class="op" id="3209135">:</span>&nbsp;<span class="ident" id="3209137">net</span><span class="op" id="3209140">,</span>&nbsp;<span class="ident" id="3209142">Addr</span><span class="op" id="3209146">:</span>&nbsp;<span class="ident" id="3209148">raddr</span><span class="op" id="3209153">,</span>&nbsp;<span class="ident" id="3209155">Err</span><span class="op" id="3209158">:</span>&nbsp;<span class="ident" id="3209160">err</span><span class="op" id="3209163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3209166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3209169">return</span>&nbsp;<span class="ident" id="3209176">newUnixConn</span><span class="op" id="3209187">(</span><span class="ident" id="3209188">fd</span><span class="op" id="3209190">)</span><span class="op" id="3209191">,</span>&nbsp;<span class="ident" id="3209193">nil</span><br>
<span class="lineno"></span><span class="op" id="3209197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="3209200">//&nbsp;UnixListener&nbsp;is&nbsp;a&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;listener.&nbsp;&nbsp;Clients&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="3209266">//&nbsp;typically&nbsp;use&nbsp;variables&nbsp;of&nbsp;type&nbsp;Listener&nbsp;instead&nbsp;of&nbsp;assuming&nbsp;Unix</span><br>
<span class="lineno"></span><span class="comment" id="3209335">//&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3209354">type</span>&nbsp;<span class="ident" id="3209359">UnixListener</span>&nbsp;<span class="keyword" id="3209372">struct</span>&nbsp;<span class="op" id="3209379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3209382">fd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3209387">*</span><span class="ident" id="3209388">netFD</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3209395">path</span>&nbsp;<span class="builtintype" id="3209400">string</span><br>
<span class="lineno"></span><span class="op" id="3209407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3209410">//&nbsp;ListenUnix&nbsp;announces&nbsp;on&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;laddr&nbsp;and&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3209480">//&nbsp;Unix&nbsp;listener.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno">260</span><span class="keyword" id="3209547">func</span>&nbsp;<span class="ident" id="3209552">ListenUnix</span><span class="op" id="3209562">(</span><span class="ident" id="3209563">net</span>&nbsp;<span class="builtintype" id="3209567">string</span><span class="op" id="3209573">,</span>&nbsp;<span class="ident" id="3209575">laddr</span>&nbsp;<span class="op" id="3209581">*</span><span class="ident" id="3209582">UnixAddr</span><span class="op" id="3209590">)</span>&nbsp;<span class="op" id="3209592">(</span><span class="op" id="3209593">*</span><span class="ident" id="3209594">UnixListener</span><span class="op" id="3209606">,</span>&nbsp;<span class="builtintype" id="3209608">error</span><span class="op" id="3209613">)</span>&nbsp;<span class="op" id="3209615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3209618">switch</span>&nbsp;<span class="ident" id="3209625">net</span>&nbsp;<span class="op" id="3209629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3209632">case</span>&nbsp;<span class="string" id="3209637">&#34;unix&#34;</span><span class="op" id="3209643">,</span>&nbsp;<span class="string" id="3209645">&#34;unixpacket&#34;</span><span class="op" id="3209657">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3209660">default</span><span class="op" id="3209667">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3209671">return</span>&nbsp;<span class="ident" id="3209678">nil</span><span class="op" id="3209681">,</span>&nbsp;<span class="op" id="3209683">&amp;</span><span class="ident" id="3209684">OpError</span><span class="op" id="3209691">{</span><span class="ident" id="3209692">Op</span><span class="op" id="3209694">:</span>&nbsp;<span class="string" id="3209696">&#34;listen&#34;</span><span class="op" id="3209704">,</span>&nbsp;<span class="ident" id="3209706">Net</span><span class="op" id="3209709">:</span>&nbsp;<span class="ident" id="3209711">net</span><span class="op" id="3209714">,</span>&nbsp;<span class="ident" id="3209716">Addr</span><span class="op" id="3209720">:</span>&nbsp;<span class="ident" id="3209722">laddr</span><span class="op" id="3209727">,</span>&nbsp;<span class="ident" id="3209729">Err</span><span class="op" id="3209732">:</span>&nbsp;<span class="ident" id="3209734">UnknownNetworkError</span><span class="op" id="3209753">(</span><span class="ident" id="3209754">net</span><span class="op" id="3209757">)</span><span class="op" id="3209758">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3209761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3209764">if</span>&nbsp;<span class="ident" id="3209767">laddr</span>&nbsp;<span class="op" id="3209773">==</span>&nbsp;<span class="ident" id="3209776">nil</span>&nbsp;<span class="op" id="3209780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3209784">return</span>&nbsp;<span class="ident" id="3209791">nil</span><span class="op" id="3209794">,</span>&nbsp;<span class="op" id="3209796">&amp;</span><span class="ident" id="3209797">OpError</span><span class="op" id="3209804">{</span><span class="ident" id="3209805">Op</span><span class="op" id="3209807">:</span>&nbsp;<span class="string" id="3209809">&#34;listen&#34;</span><span class="op" id="3209817">,</span>&nbsp;<span class="ident" id="3209819">Net</span><span class="op" id="3209822">:</span>&nbsp;<span class="ident" id="3209824">net</span><span class="op" id="3209827">,</span>&nbsp;<span class="ident" id="3209829">Addr</span><span class="op" id="3209833">:</span>&nbsp;<span class="ident" id="3209835">nil</span><span class="op" id="3209838">,</span>&nbsp;<span class="ident" id="3209840">Err</span><span class="op" id="3209843">:</span>&nbsp;<span class="ident" id="3209845">errMissingAddress</span><span class="op" id="3209862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3209865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3209868">fd</span><span class="op" id="3209870">,</span>&nbsp;<span class="ident" id="3209872">err</span>&nbsp;<span class="op" id="3209876">:=</span>&nbsp;<span class="ident" id="3209879">unixSocket</span><span class="op" id="3209889">(</span><span class="ident" id="3209890">net</span><span class="op" id="3209893">,</span>&nbsp;<span class="ident" id="3209895">laddr</span><span class="op" id="3209900">,</span>&nbsp;<span class="ident" id="3209902">nil</span><span class="op" id="3209905">,</span>&nbsp;<span class="string" id="3209907">&#34;listen&#34;</span><span class="op" id="3209915">,</span>&nbsp;<span class="ident" id="3209917">noDeadline</span><span class="op" id="3209927">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3209930">if</span>&nbsp;<span class="ident" id="3209933">err</span>&nbsp;<span class="op" id="3209937">!=</span>&nbsp;<span class="ident" id="3209940">nil</span>&nbsp;<span class="op" id="3209944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3209948">return</span>&nbsp;<span class="ident" id="3209955">nil</span><span class="op" id="3209958">,</span>&nbsp;<span class="op" id="3209960">&amp;</span><span class="ident" id="3209961">OpError</span><span class="op" id="3209968">{</span><span class="ident" id="3209969">Op</span><span class="op" id="3209971">:</span>&nbsp;<span class="string" id="3209973">&#34;listen&#34;</span><span class="op" id="3209981">,</span>&nbsp;<span class="ident" id="3209983">Net</span><span class="op" id="3209986">:</span>&nbsp;<span class="ident" id="3209988">net</span><span class="op" id="3209991">,</span>&nbsp;<span class="ident" id="3209993">Addr</span><span class="op" id="3209997">:</span>&nbsp;<span class="ident" id="3209999">laddr</span><span class="op" id="3210004">,</span>&nbsp;<span class="ident" id="3210006">Err</span><span class="op" id="3210009">:</span>&nbsp;<span class="ident" id="3210011">err</span><span class="op" id="3210014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3210017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3210020">return</span>&nbsp;<span class="op" id="3210027">&amp;</span><span class="ident" id="3210028">UnixListener</span><span class="op" id="3210040">{</span><span class="ident" id="3210041">fd</span><span class="op" id="3210043">,</span>&nbsp;<span class="ident" id="3210045">fd</span><span class="op" id="3210047">.</span><span class="ident" id="3210048">laddr</span><span class="op" id="3210053">.</span><span class="ident" id="3210054">String</span><span class="op" id="3210060">(</span><span class="op" id="3210061">)</span><span class="op" id="3210062">}</span><span class="op" id="3210063">,</span>&nbsp;<span class="ident" id="3210065">nil</span><br>
<span class="lineno"></span><span class="op" id="3210069">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="3210072">//&nbsp;AcceptUnix&nbsp;accepts&nbsp;the&nbsp;next&nbsp;incoming&nbsp;call&nbsp;and&nbsp;returns&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3210137">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3210152">func</span>&nbsp;<span class="op" id="3210157">(</span><span class="ident" id="3210158">l</span>&nbsp;<span class="op" id="3210160">*</span><span class="ident" id="3210161">UnixListener</span><span class="op" id="3210173">)</span>&nbsp;<span class="ident" id="3210175">AcceptUnix</span><span class="op" id="3210185">(</span><span class="op" id="3210186">)</span>&nbsp;<span class="op" id="3210188">(</span><span class="op" id="3210189">*</span><span class="ident" id="3210190">UnixConn</span><span class="op" id="3210198">,</span>&nbsp;<span class="builtintype" id="3210200">error</span><span class="op" id="3210205">)</span>&nbsp;<span class="op" id="3210207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3210210">if</span>&nbsp;<span class="ident" id="3210213">l</span>&nbsp;<span class="op" id="3210215">==</span>&nbsp;<span class="ident" id="3210218">nil</span>&nbsp;<span class="op" id="3210222">||</span>&nbsp;<span class="ident" id="3210225">l</span><span class="op" id="3210226">.</span><span class="ident" id="3210227">fd</span>&nbsp;<span class="op" id="3210230">==</span>&nbsp;<span class="ident" id="3210233">nil</span>&nbsp;<span class="op" id="3210237">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3210241">return</span>&nbsp;<span class="ident" id="3210248">nil</span><span class="op" id="3210251">,</span>&nbsp;<span class="ident" id="3210253">syscall</span><span class="op" id="3210260">.</span><span class="ident" id="3210261">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3210269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3210272">fd</span><span class="op" id="3210274">,</span>&nbsp;<span class="ident" id="3210276">err</span>&nbsp;<span class="op" id="3210280">:=</span>&nbsp;<span class="ident" id="3210283">l</span><span class="op" id="3210284">.</span><span class="ident" id="3210285">fd</span><span class="op" id="3210287">.</span><span class="ident" id="3210288">accept</span><span class="op" id="3210294">(</span><span class="op" id="3210295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3210298">if</span>&nbsp;<span class="ident" id="3210301">err</span>&nbsp;<span class="op" id="3210305">!=</span>&nbsp;<span class="ident" id="3210308">nil</span>&nbsp;<span class="op" id="3210312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3210316">return</span>&nbsp;<span class="ident" id="3210323">nil</span><span class="op" id="3210326">,</span>&nbsp;<span class="ident" id="3210328">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3210333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3210336">c</span>&nbsp;<span class="op" id="3210338">:=</span>&nbsp;<span class="ident" id="3210341">newUnixConn</span><span class="op" id="3210352">(</span><span class="ident" id="3210353">fd</span><span class="op" id="3210355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3210358">return</span>&nbsp;<span class="ident" id="3210365">c</span><span class="op" id="3210366">,</span>&nbsp;<span class="ident" id="3210368">nil</span><br>
<span class="lineno"></span><span class="op" id="3210372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="3210375">//&nbsp;Accept&nbsp;implements&nbsp;the&nbsp;Accept&nbsp;method&nbsp;in&nbsp;the&nbsp;Listener&nbsp;interface;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3210444">//&nbsp;waits&nbsp;for&nbsp;the&nbsp;next&nbsp;call&nbsp;and&nbsp;returns&nbsp;a&nbsp;generic&nbsp;Conn.</span><br>
<span class="lineno"></span><span class="keyword" id="3210499">func</span>&nbsp;<span class="op" id="3210504">(</span><span class="ident" id="3210505">l</span>&nbsp;<span class="op" id="3210507">*</span><span class="ident" id="3210508">UnixListener</span><span class="op" id="3210520">)</span>&nbsp;<span class="ident" id="3210522">Accept</span><span class="op" id="3210528">(</span><span class="op" id="3210529">)</span>&nbsp;<span class="op" id="3210531">(</span><span class="ident" id="3210532">c</span>&nbsp;<span class="ident" id="3210534">Conn</span><span class="op" id="3210538">,</span>&nbsp;<span class="ident" id="3210540">err</span>&nbsp;<span class="builtintype" id="3210544">error</span><span class="op" id="3210549">)</span>&nbsp;<span class="op" id="3210551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3210554">c1</span><span class="op" id="3210556">,</span>&nbsp;<span class="ident" id="3210558">err</span>&nbsp;<span class="op" id="3210562">:=</span>&nbsp;<span class="ident" id="3210565">l</span><span class="op" id="3210566">.</span><span class="ident" id="3210567">AcceptUnix</span><span class="op" id="3210577">(</span><span class="op" id="3210578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3210581">if</span>&nbsp;<span class="ident" id="3210584">err</span>&nbsp;<span class="op" id="3210588">!=</span>&nbsp;<span class="ident" id="3210591">nil</span>&nbsp;<span class="op" id="3210595">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3210599">return</span>&nbsp;<span class="ident" id="3210606">nil</span><span class="op" id="3210609">,</span>&nbsp;<span class="ident" id="3210611">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3210616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3210619">return</span>&nbsp;<span class="ident" id="3210626">c1</span><span class="op" id="3210628">,</span>&nbsp;<span class="ident" id="3210630">nil</span><br>
<span class="lineno"></span><span class="op" id="3210634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="3210637">//&nbsp;Close&nbsp;stops&nbsp;listening&nbsp;on&nbsp;the&nbsp;Unix&nbsp;address.&nbsp;&nbsp;Already&nbsp;accepted</span><br>
<span class="lineno"></span><span class="comment" id="3210701">//&nbsp;connections&nbsp;are&nbsp;not&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="3210732">func</span>&nbsp;<span class="op" id="3210737">(</span><span class="ident" id="3210738">l</span>&nbsp;<span class="op" id="3210740">*</span><span class="ident" id="3210741">UnixListener</span><span class="op" id="3210753">)</span>&nbsp;<span class="ident" id="3210755">Close</span><span class="op" id="3210760">(</span><span class="op" id="3210761">)</span>&nbsp;<span class="builtintype" id="3210763">error</span>&nbsp;<span class="op" id="3210769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3210772">if</span>&nbsp;<span class="ident" id="3210775">l</span>&nbsp;<span class="op" id="3210777">==</span>&nbsp;<span class="ident" id="3210780">nil</span>&nbsp;<span class="op" id="3210784">||</span>&nbsp;<span class="ident" id="3210787">l</span><span class="op" id="3210788">.</span><span class="ident" id="3210789">fd</span>&nbsp;<span class="op" id="3210792">==</span>&nbsp;<span class="ident" id="3210795">nil</span>&nbsp;<span class="op" id="3210799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3210803">return</span>&nbsp;<span class="ident" id="3210810">syscall</span><span class="op" id="3210817">.</span><span class="ident" id="3210818">EINVAL</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3210826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3210830">//&nbsp;The&nbsp;operating&nbsp;system&nbsp;doesn&#39;t&nbsp;clean&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3210872">//&nbsp;the&nbsp;file&nbsp;that&nbsp;announcing&nbsp;created,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3210913">//&nbsp;we&nbsp;have&nbsp;to&nbsp;clean&nbsp;it&nbsp;up&nbsp;ourselves.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3210951">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here--we&nbsp;can&#39;t&nbsp;know&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3210994">//&nbsp;sure&nbsp;whether&nbsp;someone&nbsp;else&nbsp;has&nbsp;come&nbsp;along</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3211039">//&nbsp;and&nbsp;replaced&nbsp;our&nbsp;socket&nbsp;name&nbsp;already--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3211082">//&nbsp;but&nbsp;this&nbsp;sequence&nbsp;(remove&nbsp;then&nbsp;close)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3211124">//&nbsp;is&nbsp;at&nbsp;least&nbsp;compatible&nbsp;with&nbsp;the&nbsp;auto-remove</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3211172">//&nbsp;sequence&nbsp;in&nbsp;ListenUnix.&nbsp;&nbsp;It&#39;s&nbsp;only&nbsp;non-Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3211218">//&nbsp;programs&nbsp;that&nbsp;can&nbsp;mess&nbsp;us&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3211252">if</span>&nbsp;<span class="ident" id="3211255">l</span><span class="op" id="3211256">.</span><span class="ident" id="3211257">path</span><span class="op" id="3211261">[</span><span class="num" id="3211262">0</span><span class="op" id="3211263">]</span>&nbsp;<span class="op" id="3211265">!=</span>&nbsp;<span class="string" id="3211268">&#39;@&#39;</span>&nbsp;<span class="op" id="3211272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3211276">syscall</span><span class="op" id="3211283">.</span><span class="ident" id="3211284">Unlink</span><span class="op" id="3211290">(</span><span class="ident" id="3211291">l</span><span class="op" id="3211292">.</span><span class="ident" id="3211293">path</span><span class="op" id="3211297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3211300">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3211303">return</span>&nbsp;<span class="ident" id="3211310">l</span><span class="op" id="3211311">.</span><span class="ident" id="3211312">fd</span><span class="op" id="3211314">.</span><span class="ident" id="3211315">Close</span><span class="op" id="3211320">(</span><span class="op" id="3211321">)</span><br>
<span class="lineno"></span><span class="op" id="3211323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3211326">//&nbsp;Addr&nbsp;returns&nbsp;the&nbsp;listener&#39;s&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3211374">func</span>&nbsp;<span class="op" id="3211379">(</span><span class="ident" id="3211380">l</span>&nbsp;<span class="op" id="3211382">*</span><span class="ident" id="3211383">UnixListener</span><span class="op" id="3211395">)</span>&nbsp;<span class="ident" id="3211397">Addr</span><span class="op" id="3211401">(</span><span class="op" id="3211402">)</span>&nbsp;<span class="ident" id="3211404">Addr</span>&nbsp;<span class="op" id="3211409">{</span>&nbsp;<span class="keyword" id="3211411">return</span>&nbsp;<span class="ident" id="3211418">l</span><span class="op" id="3211419">.</span><span class="ident" id="3211420">fd</span><span class="op" id="3211422">.</span><span class="ident" id="3211423">laddr</span>&nbsp;<span class="op" id="3211429">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="3211432">//&nbsp;SetDeadline&nbsp;sets&nbsp;the&nbsp;deadline&nbsp;associated&nbsp;with&nbsp;the&nbsp;listener.</span><br>
<span class="lineno"></span><span class="comment" id="3211495">//&nbsp;A&nbsp;zero&nbsp;time&nbsp;value&nbsp;disables&nbsp;the&nbsp;deadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3211539">func</span>&nbsp;<span class="op" id="3211544">(</span><span class="ident" id="3211545">l</span>&nbsp;<span class="op" id="3211547">*</span><span class="ident" id="3211548">UnixListener</span><span class="op" id="3211560">)</span>&nbsp;<span class="ident" id="3211562">SetDeadline</span><span class="op" id="3211573">(</span><span class="ident" id="3211574">t</span>&nbsp;<span class="ident" id="3211576">time</span><span class="op" id="3211580">.</span><span class="ident" id="3211581">Time</span><span class="op" id="3211585">)</span>&nbsp;<span class="op" id="3211587">(</span><span class="ident" id="3211588">err</span>&nbsp;<span class="builtintype" id="3211592">error</span><span class="op" id="3211597">)</span>&nbsp;<span class="op" id="3211599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3211602">if</span>&nbsp;<span class="ident" id="3211605">l</span>&nbsp;<span class="op" id="3211607">==</span>&nbsp;<span class="ident" id="3211610">nil</span>&nbsp;<span class="op" id="3211614">||</span>&nbsp;<span class="ident" id="3211617">l</span><span class="op" id="3211618">.</span><span class="ident" id="3211619">fd</span>&nbsp;<span class="op" id="3211622">==</span>&nbsp;<span class="ident" id="3211625">nil</span>&nbsp;<span class="op" id="3211629">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3211633">return</span>&nbsp;<span class="ident" id="3211640">syscall</span><span class="op" id="3211647">.</span><span class="ident" id="3211648">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3211656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3211659">return</span>&nbsp;<span class="ident" id="3211666">l</span><span class="op" id="3211667">.</span><span class="ident" id="3211668">fd</span><span class="op" id="3211670">.</span><span class="ident" id="3211671">setDeadline</span><span class="op" id="3211682">(</span><span class="ident" id="3211683">t</span><span class="op" id="3211684">)</span><br>
<span class="lineno"></span><span class="op" id="3211686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="3211689">//&nbsp;File&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;underlying&nbsp;os.File,&nbsp;set&nbsp;to&nbsp;blocking</span><br>
<span class="lineno"></span><span class="comment" id="3211755">//&nbsp;mode.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="3211825">//&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;l.</span><br>
<span class="lineno"></span><span class="comment" id="3211890">//</span><br>
<span class="lineno"></span><span class="comment" id="3211893">//&nbsp;The&nbsp;returned&nbsp;os.File&#39;s&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;different&nbsp;from&nbsp;the</span><br>
<span class="lineno">340</span><span class="comment" id="3211957">//&nbsp;connection&#39;s.&nbsp;&nbsp;Attempting&nbsp;to&nbsp;change&nbsp;properties&nbsp;of&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span><span class="comment" id="3212023">//&nbsp;using&nbsp;this&nbsp;duplicate&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;have&nbsp;the&nbsp;desired&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="3212087">func</span>&nbsp;<span class="op" id="3212092">(</span><span class="ident" id="3212093">l</span>&nbsp;<span class="op" id="3212095">*</span><span class="ident" id="3212096">UnixListener</span><span class="op" id="3212108">)</span>&nbsp;<span class="ident" id="3212110">File</span><span class="op" id="3212114">(</span><span class="op" id="3212115">)</span>&nbsp;<span class="op" id="3212117">(</span><span class="ident" id="3212118">f</span>&nbsp;<span class="op" id="3212120">*</span><span class="ident" id="3212121">os</span><span class="op" id="3212123">.</span><span class="ident" id="3212124">File</span><span class="op" id="3212128">,</span>&nbsp;<span class="ident" id="3212130">err</span>&nbsp;<span class="builtintype" id="3212134">error</span><span class="op" id="3212139">)</span>&nbsp;<span class="op" id="3212141">{</span>&nbsp;<span class="keyword" id="3212143">return</span>&nbsp;<span class="ident" id="3212150">l</span><span class="op" id="3212151">.</span><span class="ident" id="3212152">fd</span><span class="op" id="3212154">.</span><span class="ident" id="3212155">dup</span><span class="op" id="3212158">(</span><span class="op" id="3212159">)</span>&nbsp;<span class="op" id="3212161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3212164">//&nbsp;ListenUnixgram&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;Unix&nbsp;datagram&nbsp;packets&nbsp;addressed</span><br>
<span class="lineno">345</span><span class="comment" id="3212235">//&nbsp;to&nbsp;the&nbsp;local&nbsp;address&nbsp;laddr.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3212303">//&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo&nbsp;methods&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3212373">//&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;packets&nbsp;with&nbsp;per-packet&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3212432">func</span>&nbsp;<span class="ident" id="3212437">ListenUnixgram</span><span class="op" id="3212451">(</span><span class="ident" id="3212452">net</span>&nbsp;<span class="builtintype" id="3212456">string</span><span class="op" id="3212462">,</span>&nbsp;<span class="ident" id="3212464">laddr</span>&nbsp;<span class="op" id="3212470">*</span><span class="ident" id="3212471">UnixAddr</span><span class="op" id="3212479">)</span>&nbsp;<span class="op" id="3212481">(</span><span class="op" id="3212482">*</span><span class="ident" id="3212483">UnixConn</span><span class="op" id="3212491">,</span>&nbsp;<span class="builtintype" id="3212493">error</span><span class="op" id="3212498">)</span>&nbsp;<span class="op" id="3212500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3212503">switch</span>&nbsp;<span class="ident" id="3212510">net</span>&nbsp;<span class="op" id="3212514">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3212517">case</span>&nbsp;<span class="string" id="3212522">&#34;unixgram&#34;</span><span class="op" id="3212532">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3212535">default</span><span class="op" id="3212542">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3212546">return</span>&nbsp;<span class="ident" id="3212553">nil</span><span class="op" id="3212556">,</span>&nbsp;<span class="op" id="3212558">&amp;</span><span class="ident" id="3212559">OpError</span><span class="op" id="3212566">{</span><span class="ident" id="3212567">Op</span><span class="op" id="3212569">:</span>&nbsp;<span class="string" id="3212571">&#34;listen&#34;</span><span class="op" id="3212579">,</span>&nbsp;<span class="ident" id="3212581">Net</span><span class="op" id="3212584">:</span>&nbsp;<span class="ident" id="3212586">net</span><span class="op" id="3212589">,</span>&nbsp;<span class="ident" id="3212591">Addr</span><span class="op" id="3212595">:</span>&nbsp;<span class="ident" id="3212597">laddr</span><span class="op" id="3212602">,</span>&nbsp;<span class="ident" id="3212604">Err</span><span class="op" id="3212607">:</span>&nbsp;<span class="ident" id="3212609">UnknownNetworkError</span><span class="op" id="3212628">(</span><span class="ident" id="3212629">net</span><span class="op" id="3212632">)</span><span class="op" id="3212633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3212636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3212639">if</span>&nbsp;<span class="ident" id="3212642">laddr</span>&nbsp;<span class="op" id="3212648">==</span>&nbsp;<span class="ident" id="3212651">nil</span>&nbsp;<span class="op" id="3212655">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3212659">return</span>&nbsp;<span class="ident" id="3212666">nil</span><span class="op" id="3212669">,</span>&nbsp;<span class="op" id="3212671">&amp;</span><span class="ident" id="3212672">OpError</span><span class="op" id="3212679">{</span><span class="ident" id="3212680">Op</span><span class="op" id="3212682">:</span>&nbsp;<span class="string" id="3212684">&#34;listen&#34;</span><span class="op" id="3212692">,</span>&nbsp;<span class="ident" id="3212694">Net</span><span class="op" id="3212697">:</span>&nbsp;<span class="ident" id="3212699">net</span><span class="op" id="3212702">,</span>&nbsp;<span class="ident" id="3212704">Addr</span><span class="op" id="3212708">:</span>&nbsp;<span class="ident" id="3212710">nil</span><span class="op" id="3212713">,</span>&nbsp;<span class="ident" id="3212715">Err</span><span class="op" id="3212718">:</span>&nbsp;<span class="ident" id="3212720">errMissingAddress</span><span class="op" id="3212737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3212740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3212743">fd</span><span class="op" id="3212745">,</span>&nbsp;<span class="ident" id="3212747">err</span>&nbsp;<span class="op" id="3212751">:=</span>&nbsp;<span class="ident" id="3212754">unixSocket</span><span class="op" id="3212764">(</span><span class="ident" id="3212765">net</span><span class="op" id="3212768">,</span>&nbsp;<span class="ident" id="3212770">laddr</span><span class="op" id="3212775">,</span>&nbsp;<span class="ident" id="3212777">nil</span><span class="op" id="3212780">,</span>&nbsp;<span class="string" id="3212782">&#34;listen&#34;</span><span class="op" id="3212790">,</span>&nbsp;<span class="ident" id="3212792">noDeadline</span><span class="op" id="3212802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3212805">if</span>&nbsp;<span class="ident" id="3212808">err</span>&nbsp;<span class="op" id="3212812">!=</span>&nbsp;<span class="ident" id="3212815">nil</span>&nbsp;<span class="op" id="3212819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3212823">return</span>&nbsp;<span class="ident" id="3212830">nil</span><span class="op" id="3212833">,</span>&nbsp;<span class="op" id="3212835">&amp;</span><span class="ident" id="3212836">OpError</span><span class="op" id="3212843">{</span><span class="ident" id="3212844">Op</span><span class="op" id="3212846">:</span>&nbsp;<span class="string" id="3212848">&#34;listen&#34;</span><span class="op" id="3212856">,</span>&nbsp;<span class="ident" id="3212858">Net</span><span class="op" id="3212861">:</span>&nbsp;<span class="ident" id="3212863">net</span><span class="op" id="3212866">,</span>&nbsp;<span class="ident" id="3212868">Addr</span><span class="op" id="3212872">:</span>&nbsp;<span class="ident" id="3212874">laddr</span><span class="op" id="3212879">,</span>&nbsp;<span class="ident" id="3212881">Err</span><span class="op" id="3212884">:</span>&nbsp;<span class="ident" id="3212886">err</span><span class="op" id="3212889">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3212892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3212895">return</span>&nbsp;<span class="ident" id="3212902">newUnixConn</span><span class="op" id="3212913">(</span><span class="ident" id="3212914">fd</span><span class="op" id="3212916">)</span><span class="op" id="3212917">,</span>&nbsp;<span class="ident" id="3212919">nil</span><br>
<span class="lineno"></span><span class="op" id="3212923">}</span>
</div>
</body>
</html>
