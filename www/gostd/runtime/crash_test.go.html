<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html" class="current">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="864826">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="864881">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="864935">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="864986">package</span>&nbsp;<span class="ident" id="864994">runtime_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="865008">import</span>&nbsp;<span class="op" id="865015">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="865018">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="865031">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="865037">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="865048">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="865065">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="865076">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="865087">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="865098">&#34;text/template&#34;</span><br>
<span class="lineno"></span><span class="op" id="865114">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="865117">//&nbsp;testEnv&nbsp;excludes&nbsp;GODEBUG&nbsp;from&nbsp;the&nbsp;environment</span><br>
<span class="lineno"></span><span class="comment" id="865166">//&nbsp;to&nbsp;prevent&nbsp;its&nbsp;output&nbsp;from&nbsp;breaking&nbsp;tests&nbsp;that</span><br>
<span class="lineno">20</span><span class="comment" id="865216">//&nbsp;are&nbsp;trying&nbsp;to&nbsp;parse&nbsp;other&nbsp;command&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="865261">func</span>&nbsp;<span class="ident" id="865266">testEnv</span><span class="op" id="865273">(</span><span class="ident" id="865274">cmd</span>&nbsp;<span class="op" id="865278">*</span><span class="ident" id="865279">exec</span><span class="op" id="865283">.</span><span class="ident" id="865284">Cmd</span><span class="op" id="865287">)</span>&nbsp;<span class="op" id="865289">*</span><span class="ident" id="865290">exec</span><span class="op" id="865294">.</span><span class="ident" id="865295">Cmd</span>&nbsp;<span class="op" id="865299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="865302">if</span>&nbsp;<span class="ident" id="865305">cmd</span><span class="op" id="865308">.</span><span class="ident" id="865309">Env</span>&nbsp;<span class="op" id="865313">!=</span>&nbsp;<span class="ident" id="865316">nil</span>&nbsp;<span class="op" id="865320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="865324">panic</span><span class="op" id="865329">(</span><span class="string" id="865330">&#34;environment&nbsp;already&nbsp;set&#34;</span><span class="op" id="865355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="865358">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="865361">for</span>&nbsp;<span class="ident" id="865365">_</span><span class="op" id="865366">,</span>&nbsp;<span class="ident" id="865368">env</span>&nbsp;<span class="op" id="865372">:=</span>&nbsp;<span class="keyword" id="865375">range</span>&nbsp;<span class="ident" id="865381">os</span><span class="op" id="865383">.</span><span class="ident" id="865384">Environ</span><span class="op" id="865391">(</span><span class="op" id="865392">)</span>&nbsp;<span class="op" id="865394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="865398">if</span>&nbsp;<span class="ident" id="865401">strings</span><span class="op" id="865408">.</span><span class="ident" id="865409">HasPrefix</span><span class="op" id="865418">(</span><span class="ident" id="865419">env</span><span class="op" id="865422">,</span>&nbsp;<span class="string" id="865424">&#34;GODEBUG=&#34;</span><span class="op" id="865434">)</span>&nbsp;<span class="op" id="865436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="865441">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="865452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="865456">cmd</span><span class="op" id="865459">.</span><span class="ident" id="865460">Env</span>&nbsp;<span class="op" id="865464">=</span>&nbsp;<span class="builtinfunc" id="865466">append</span><span class="op" id="865472">(</span><span class="ident" id="865473">cmd</span><span class="op" id="865476">.</span><span class="ident" id="865477">Env</span><span class="op" id="865480">,</span>&nbsp;<span class="ident" id="865482">env</span><span class="op" id="865485">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="865488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="865491">return</span>&nbsp;<span class="ident" id="865498">cmd</span><br>
<span class="lineno"></span><span class="op" id="865502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="865505">func</span>&nbsp;<span class="ident" id="865510">executeTest</span><span class="op" id="865521">(</span><span class="ident" id="865522">t</span>&nbsp;<span class="op" id="865524">*</span><span class="ident" id="865525">testing</span><span class="op" id="865532">.</span><span class="ident" id="865533">T</span><span class="op" id="865534">,</span>&nbsp;<span class="ident" id="865536">templ</span>&nbsp;<span class="builtintype" id="865542">string</span><span class="op" id="865548">,</span>&nbsp;<span class="ident" id="865550">data</span>&nbsp;<span class="keyword" id="865555">interface</span><span class="op" id="865564">{</span><span class="op" id="865565">}</span><span class="op" id="865566">,</span>&nbsp;<span class="ident" id="865568">extra</span>&nbsp;<span class="op" id="865574">...</span><span class="builtintype" id="865577">string</span><span class="op" id="865583">)</span>&nbsp;<span class="builtintype" id="865585">string</span>&nbsp;<span class="op" id="865592">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="865595">switch</span>&nbsp;<span class="ident" id="865602">runtime</span><span class="op" id="865609">.</span><span class="ident" id="865610">GOOS</span>&nbsp;<span class="op" id="865615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="865618">case</span>&nbsp;<span class="string" id="865623">&#34;android&#34;</span><span class="op" id="865632">,</span>&nbsp;<span class="string" id="865634">&#34;nacl&#34;</span><span class="op" id="865640">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="865644">t</span><span class="op" id="865645">.</span><span class="ident" id="865646">Skipf</span><span class="op" id="865651">(</span><span class="string" id="865652">&#34;skipping&nbsp;on&nbsp;%s&#34;</span><span class="op" id="865668">,</span>&nbsp;<span class="ident" id="865670">runtime</span><span class="op" id="865677">.</span><span class="ident" id="865678">GOOS</span><span class="op" id="865682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="865685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="865689">checkStaleRuntime</span><span class="op" id="865706">(</span><span class="ident" id="865707">t</span><span class="op" id="865708">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="865712">st</span>&nbsp;<span class="op" id="865715">:=</span>&nbsp;<span class="ident" id="865718">template</span><span class="op" id="865726">.</span><span class="ident" id="865727">Must</span><span class="op" id="865731">(</span><span class="ident" id="865732">template</span><span class="op" id="865740">.</span><span class="ident" id="865741">New</span><span class="op" id="865744">(</span><span class="string" id="865745">&#34;crashSource&#34;</span><span class="op" id="865758">)</span><span class="op" id="865759">.</span><span class="ident" id="865760">Parse</span><span class="op" id="865765">(</span><span class="ident" id="865766">templ</span><span class="op" id="865771">)</span><span class="op" id="865772">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="865776">dir</span><span class="op" id="865779">,</span>&nbsp;<span class="ident" id="865781">err</span>&nbsp;<span class="op" id="865785">:=</span>&nbsp;<span class="ident" id="865788">ioutil</span><span class="op" id="865794">.</span><span class="ident" id="865795">TempDir</span><span class="op" id="865802">(</span><span class="string" id="865803">&#34;&#34;</span><span class="op" id="865805">,</span>&nbsp;<span class="string" id="865807">&#34;go-build&#34;</span><span class="op" id="865817">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="865820">if</span>&nbsp;<span class="ident" id="865823">err</span>&nbsp;<span class="op" id="865827">!=</span>&nbsp;<span class="ident" id="865830">nil</span>&nbsp;<span class="op" id="865834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="865838">t</span><span class="op" id="865839">.</span><span class="ident" id="865840">Fatalf</span><span class="op" id="865846">(</span><span class="string" id="865847">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;directory:&nbsp;%v&#34;</span><span class="op" id="865884">,</span>&nbsp;<span class="ident" id="865886">err</span><span class="op" id="865889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="865892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="865895">defer</span>&nbsp;<span class="ident" id="865901">os</span><span class="op" id="865903">.</span><span class="ident" id="865904">RemoveAll</span><span class="op" id="865913">(</span><span class="ident" id="865914">dir</span><span class="op" id="865917">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="865921">src</span>&nbsp;<span class="op" id="865925">:=</span>&nbsp;<span class="ident" id="865928">filepath</span><span class="op" id="865936">.</span><span class="ident" id="865937">Join</span><span class="op" id="865941">(</span><span class="ident" id="865942">dir</span><span class="op" id="865945">,</span>&nbsp;<span class="string" id="865947">&#34;main.go&#34;</span><span class="op" id="865956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="865959">f</span><span class="op" id="865960">,</span>&nbsp;<span class="ident" id="865962">err</span>&nbsp;<span class="op" id="865966">:=</span>&nbsp;<span class="ident" id="865969">os</span><span class="op" id="865971">.</span><span class="ident" id="865972">Create</span><span class="op" id="865978">(</span><span class="ident" id="865979">src</span><span class="op" id="865982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="865985">if</span>&nbsp;<span class="ident" id="865988">err</span>&nbsp;<span class="op" id="865992">!=</span>&nbsp;<span class="ident" id="865995">nil</span>&nbsp;<span class="op" id="865999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="866003">t</span><span class="op" id="866004">.</span><span class="ident" id="866005">Fatalf</span><span class="op" id="866011">(</span><span class="string" id="866012">&#34;failed&nbsp;to&nbsp;create&nbsp;file:&nbsp;%v&#34;</span><span class="op" id="866039">,</span>&nbsp;<span class="ident" id="866041">err</span><span class="op" id="866044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="866047">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="866050">err</span>&nbsp;<span class="op" id="866054">=</span>&nbsp;<span class="ident" id="866056">st</span><span class="op" id="866058">.</span><span class="ident" id="866059">Execute</span><span class="op" id="866066">(</span><span class="ident" id="866067">f</span><span class="op" id="866068">,</span>&nbsp;<span class="ident" id="866070">data</span><span class="op" id="866074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="866077">if</span>&nbsp;<span class="ident" id="866080">err</span>&nbsp;<span class="op" id="866084">!=</span>&nbsp;<span class="ident" id="866087">nil</span>&nbsp;<span class="op" id="866091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="866095">f</span><span class="op" id="866096">.</span><span class="ident" id="866097">Close</span><span class="op" id="866102">(</span><span class="op" id="866103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="866107">t</span><span class="op" id="866108">.</span><span class="ident" id="866109">Fatalf</span><span class="op" id="866115">(</span><span class="string" id="866116">&#34;failed&nbsp;to&nbsp;execute&nbsp;template:&nbsp;%v&#34;</span><span class="op" id="866148">,</span>&nbsp;<span class="ident" id="866150">err</span><span class="op" id="866153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="866156">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="866159">if</span>&nbsp;<span class="ident" id="866162">err</span>&nbsp;<span class="op" id="866166">:=</span>&nbsp;<span class="ident" id="866169">f</span><span class="op" id="866170">.</span><span class="ident" id="866171">Close</span><span class="op" id="866176">(</span><span class="op" id="866177">)</span><span class="op" id="866178">;</span>&nbsp;<span class="ident" id="866180">err</span>&nbsp;<span class="op" id="866184">!=</span>&nbsp;<span class="ident" id="866187">nil</span>&nbsp;<span class="op" id="866191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="866195">t</span><span class="op" id="866196">.</span><span class="ident" id="866197">Fatalf</span><span class="op" id="866203">(</span><span class="string" id="866204">&#34;failed&nbsp;to&nbsp;close&nbsp;file:&nbsp;%v&#34;</span><span class="op" id="866230">,</span>&nbsp;<span class="ident" id="866232">err</span><span class="op" id="866235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="866238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="866242">for</span>&nbsp;<span class="ident" id="866246">i</span>&nbsp;<span class="op" id="866248">:=</span>&nbsp;<span class="num" id="866251">0</span><span class="op" id="866252">;</span>&nbsp;<span class="ident" id="866254">i</span>&nbsp;<span class="op" id="866256">&lt;</span>&nbsp;<span class="builtinfunc" id="866258">len</span><span class="op" id="866261">(</span><span class="ident" id="866262">extra</span><span class="op" id="866267">)</span><span class="op" id="866268">;</span>&nbsp;<span class="ident" id="866270">i</span>&nbsp;<span class="op" id="866272">+=</span>&nbsp;<span class="num" id="866275">2</span>&nbsp;<span class="op" id="866277">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="866281">if</span>&nbsp;<span class="ident" id="866284">err</span>&nbsp;<span class="op" id="866288">:=</span>&nbsp;<span class="ident" id="866291">ioutil</span><span class="op" id="866297">.</span><span class="ident" id="866298">WriteFile</span><span class="op" id="866307">(</span><span class="ident" id="866308">filepath</span><span class="op" id="866316">.</span><span class="ident" id="866317">Join</span><span class="op" id="866321">(</span><span class="ident" id="866322">dir</span><span class="op" id="866325">,</span>&nbsp;<span class="ident" id="866327">extra</span><span class="op" id="866332">[</span><span class="ident" id="866333">i</span><span class="op" id="866334">]</span><span class="op" id="866335">)</span><span class="op" id="866336">,</span>&nbsp;<span class="op" id="866338">[</span><span class="op" id="866339">]</span><span class="builtintype" id="866340">byte</span><span class="op" id="866344">(</span><span class="ident" id="866345">extra</span><span class="op" id="866350">[</span><span class="ident" id="866351">i</span><span class="op" id="866352">+</span><span class="num" id="866353">1</span><span class="op" id="866354">]</span><span class="op" id="866355">)</span><span class="op" id="866356">,</span>&nbsp;<span class="num" id="866358">0666</span><span class="op" id="866362">)</span><span class="op" id="866363">;</span>&nbsp;<span class="ident" id="866365">err</span>&nbsp;<span class="op" id="866369">!=</span>&nbsp;<span class="ident" id="866372">nil</span>&nbsp;<span class="op" id="866376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="866381">t</span><span class="op" id="866382">.</span><span class="ident" id="866383">Fatal</span><span class="op" id="866388">(</span><span class="ident" id="866389">err</span><span class="op" id="866392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="866396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="866399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="866403">cmd</span>&nbsp;<span class="op" id="866407">:=</span>&nbsp;<span class="ident" id="866410">exec</span><span class="op" id="866414">.</span><span class="ident" id="866415">Command</span><span class="op" id="866422">(</span><span class="string" id="866423">&#34;go&#34;</span><span class="op" id="866427">,</span>&nbsp;<span class="string" id="866429">&#34;build&#34;</span><span class="op" id="866436">,</span>&nbsp;<span class="string" id="866438">&#34;-o&#34;</span><span class="op" id="866442">,</span>&nbsp;<span class="string" id="866444">&#34;a.exe&#34;</span><span class="op" id="866451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="866454">cmd</span><span class="op" id="866457">.</span><span class="ident" id="866458">Dir</span>&nbsp;<span class="op" id="866462">=</span>&nbsp;<span class="ident" id="866464">dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="866469">out</span><span class="op" id="866472">,</span>&nbsp;<span class="ident" id="866474">err</span>&nbsp;<span class="op" id="866478">:=</span>&nbsp;<span class="ident" id="866481">testEnv</span><span class="op" id="866488">(</span><span class="ident" id="866489">cmd</span><span class="op" id="866492">)</span><span class="op" id="866493">.</span><span class="ident" id="866494">CombinedOutput</span><span class="op" id="866508">(</span><span class="op" id="866509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="866512">if</span>&nbsp;<span class="ident" id="866515">err</span>&nbsp;<span class="op" id="866519">!=</span>&nbsp;<span class="ident" id="866522">nil</span>&nbsp;<span class="op" id="866526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="866530">t</span><span class="op" id="866531">.</span><span class="ident" id="866532">Fatalf</span><span class="op" id="866538">(</span><span class="string" id="866539">&#34;building&nbsp;source:&nbsp;%v\n%s&#34;</span><span class="op" id="866564">,</span>&nbsp;<span class="ident" id="866566">err</span><span class="op" id="866569">,</span>&nbsp;<span class="ident" id="866571">out</span><span class="op" id="866574">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="866577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="866581">got</span><span class="op" id="866584">,</span>&nbsp;<span class="ident" id="866586">_</span>&nbsp;<span class="op" id="866588">:=</span>&nbsp;<span class="ident" id="866591">testEnv</span><span class="op" id="866598">(</span><span class="ident" id="866599">exec</span><span class="op" id="866603">.</span><span class="ident" id="866604">Command</span><span class="op" id="866611">(</span><span class="ident" id="866612">filepath</span><span class="op" id="866620">.</span><span class="ident" id="866621">Join</span><span class="op" id="866625">(</span><span class="ident" id="866626">dir</span><span class="op" id="866629">,</span>&nbsp;<span class="string" id="866631">&#34;a.exe&#34;</span><span class="op" id="866638">)</span><span class="op" id="866639">)</span><span class="op" id="866640">)</span><span class="op" id="866641">.</span><span class="ident" id="866642">CombinedOutput</span><span class="op" id="866656">(</span><span class="op" id="866657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="866660">return</span>&nbsp;<span class="builtintype" id="866667">string</span><span class="op" id="866673">(</span><span class="ident" id="866674">got</span><span class="op" id="866677">)</span><br>
<span class="lineno"></span><span class="op" id="866679">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="866682">func</span>&nbsp;<span class="ident" id="866687">checkStaleRuntime</span><span class="op" id="866704">(</span><span class="ident" id="866705">t</span>&nbsp;<span class="op" id="866707">*</span><span class="ident" id="866708">testing</span><span class="op" id="866715">.</span><span class="ident" id="866716">T</span><span class="op" id="866717">)</span>&nbsp;<span class="op" id="866719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="866722">//&nbsp;&#39;go&nbsp;run&#39;&nbsp;uses&nbsp;the&nbsp;installed&nbsp;copy&nbsp;of&nbsp;runtime.a,&nbsp;which&nbsp;may&nbsp;be&nbsp;out&nbsp;of&nbsp;date.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="866799">out</span><span class="op" id="866802">,</span>&nbsp;<span class="ident" id="866804">err</span>&nbsp;<span class="op" id="866808">:=</span>&nbsp;<span class="ident" id="866811">testEnv</span><span class="op" id="866818">(</span><span class="ident" id="866819">exec</span><span class="op" id="866823">.</span><span class="ident" id="866824">Command</span><span class="op" id="866831">(</span><span class="string" id="866832">&#34;go&#34;</span><span class="op" id="866836">,</span>&nbsp;<span class="string" id="866838">&#34;list&#34;</span><span class="op" id="866844">,</span>&nbsp;<span class="string" id="866846">&#34;-f&#34;</span><span class="op" id="866850">,</span>&nbsp;<span class="string" id="866852">&#34;{{.Stale}}&#34;</span><span class="op" id="866864">,</span>&nbsp;<span class="string" id="866866">&#34;runtime&#34;</span><span class="op" id="866875">)</span><span class="op" id="866876">)</span><span class="op" id="866877">.</span><span class="ident" id="866878">CombinedOutput</span><span class="op" id="866892">(</span><span class="op" id="866893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="866896">if</span>&nbsp;<span class="ident" id="866899">err</span>&nbsp;<span class="op" id="866903">!=</span>&nbsp;<span class="ident" id="866906">nil</span>&nbsp;<span class="op" id="866910">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="866914">t</span><span class="op" id="866915">.</span><span class="ident" id="866916">Fatalf</span><span class="op" id="866922">(</span><span class="string" id="866923">&#34;failed&nbsp;to&nbsp;execute&nbsp;&#39;go&nbsp;list&#39;:&nbsp;%v\n%v&#34;</span><span class="op" id="866960">,</span>&nbsp;<span class="ident" id="866962">err</span><span class="op" id="866965">,</span>&nbsp;<span class="builtintype" id="866967">string</span><span class="op" id="866973">(</span><span class="ident" id="866974">out</span><span class="op" id="866977">)</span><span class="op" id="866978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="866981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="866984">if</span>&nbsp;<span class="builtintype" id="866987">string</span><span class="op" id="866993">(</span><span class="ident" id="866994">out</span><span class="op" id="866997">)</span>&nbsp;<span class="op" id="866999">!=</span>&nbsp;<span class="string" id="867002">&#34;false\n&#34;</span>&nbsp;<span class="op" id="867012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="867016">t</span><span class="op" id="867017">.</span><span class="ident" id="867018">Fatalf</span><span class="op" id="867024">(</span><span class="string" id="867025">&#34;Stale&nbsp;runtime.a.&nbsp;Run&nbsp;&#39;go&nbsp;install&nbsp;runtime&#39;.&#34;</span><span class="op" id="867069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="867072">}</span><br>
<span class="lineno">90</span><span class="op" id="867074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="867077">func</span>&nbsp;<span class="ident" id="867082">testCrashHandler</span><span class="op" id="867098">(</span><span class="ident" id="867099">t</span>&nbsp;<span class="op" id="867101">*</span><span class="ident" id="867102">testing</span><span class="op" id="867109">.</span><span class="ident" id="867110">T</span><span class="op" id="867111">,</span>&nbsp;<span class="ident" id="867113">cgo</span>&nbsp;<span class="builtintype" id="867117">bool</span><span class="op" id="867121">)</span>&nbsp;<span class="op" id="867123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="867126">type</span>&nbsp;<span class="ident" id="867131">crashTest</span>&nbsp;<span class="keyword" id="867141">struct</span>&nbsp;<span class="op" id="867148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="867152">Cgo</span>&nbsp;<span class="builtintype" id="867156">bool</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="867162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="867165">output</span>&nbsp;<span class="op" id="867172">:=</span>&nbsp;<span class="ident" id="867175">executeTest</span><span class="op" id="867186">(</span><span class="ident" id="867187">t</span><span class="op" id="867188">,</span>&nbsp;<span class="ident" id="867190">crashSource</span><span class="op" id="867201">,</span>&nbsp;<span class="op" id="867203">&amp;</span><span class="ident" id="867204">crashTest</span><span class="op" id="867213">{</span><span class="ident" id="867214">Cgo</span><span class="op" id="867217">:</span>&nbsp;<span class="ident" id="867219">cgo</span><span class="op" id="867222">}</span><span class="op" id="867223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="867226">want</span>&nbsp;<span class="op" id="867231">:=</span>&nbsp;<span class="string" id="867234">&#34;main:&nbsp;recovered&nbsp;done\nnew-thread:&nbsp;recovered&nbsp;done\nsecond-new-thread:&nbsp;recovered&nbsp;done\nmain-again:&nbsp;recovered&nbsp;done\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="867351">if</span>&nbsp;<span class="ident" id="867354">output</span>&nbsp;<span class="op" id="867361">!=</span>&nbsp;<span class="ident" id="867364">want</span>&nbsp;<span class="op" id="867369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="867373">t</span><span class="op" id="867374">.</span><span class="ident" id="867375">Fatalf</span><span class="op" id="867381">(</span><span class="string" id="867382">&#34;output:\n%s\n\nwanted:\n%s&#34;</span><span class="op" id="867410">,</span>&nbsp;<span class="ident" id="867412">output</span><span class="op" id="867418">,</span>&nbsp;<span class="ident" id="867420">want</span><span class="op" id="867424">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="867427">}</span><br>
<span class="lineno"></span><span class="op" id="867429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="867432">func</span>&nbsp;<span class="ident" id="867437">TestCrashHandler</span><span class="op" id="867453">(</span><span class="ident" id="867454">t</span>&nbsp;<span class="op" id="867456">*</span><span class="ident" id="867457">testing</span><span class="op" id="867464">.</span><span class="ident" id="867465">T</span><span class="op" id="867466">)</span>&nbsp;<span class="op" id="867468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="867471">testCrashHandler</span><span class="op" id="867487">(</span><span class="ident" id="867488">t</span><span class="op" id="867489">,</span>&nbsp;<span class="builtintype" id="867491">false</span><span class="op" id="867496">)</span><br>
<span class="lineno">105</span><span class="op" id="867498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="867501">func</span>&nbsp;<span class="ident" id="867506">testDeadlock</span><span class="op" id="867518">(</span><span class="ident" id="867519">t</span>&nbsp;<span class="op" id="867521">*</span><span class="ident" id="867522">testing</span><span class="op" id="867529">.</span><span class="ident" id="867530">T</span><span class="op" id="867531">,</span>&nbsp;<span class="ident" id="867533">source</span>&nbsp;<span class="builtintype" id="867540">string</span><span class="op" id="867546">)</span>&nbsp;<span class="op" id="867548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="867551">output</span>&nbsp;<span class="op" id="867558">:=</span>&nbsp;<span class="ident" id="867561">executeTest</span><span class="op" id="867572">(</span><span class="ident" id="867573">t</span><span class="op" id="867574">,</span>&nbsp;<span class="ident" id="867576">source</span><span class="op" id="867582">,</span>&nbsp;<span class="ident" id="867584">nil</span><span class="op" id="867587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="867590">want</span>&nbsp;<span class="op" id="867595">:=</span>&nbsp;<span class="string" id="867598">&#34;fatal&nbsp;error:&nbsp;all&nbsp;goroutines&nbsp;are&nbsp;asleep&nbsp;-&nbsp;deadlock!\n&#34;</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="867654">if</span>&nbsp;<span class="op" id="867657">!</span><span class="ident" id="867658">strings</span><span class="op" id="867665">.</span><span class="ident" id="867666">HasPrefix</span><span class="op" id="867675">(</span><span class="ident" id="867676">output</span><span class="op" id="867682">,</span>&nbsp;<span class="ident" id="867684">want</span><span class="op" id="867688">)</span>&nbsp;<span class="op" id="867690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="867694">t</span><span class="op" id="867695">.</span><span class="ident" id="867696">Fatalf</span><span class="op" id="867702">(</span><span class="string" id="867703">&#34;output&nbsp;does&nbsp;not&nbsp;start&nbsp;with&nbsp;%q:\n%s&#34;</span><span class="op" id="867739">,</span>&nbsp;<span class="ident" id="867741">want</span><span class="op" id="867745">,</span>&nbsp;<span class="ident" id="867747">output</span><span class="op" id="867753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="867756">}</span><br>
<span class="lineno"></span><span class="op" id="867758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="867761">func</span>&nbsp;<span class="ident" id="867766">TestSimpleDeadlock</span><span class="op" id="867784">(</span><span class="ident" id="867785">t</span>&nbsp;<span class="op" id="867787">*</span><span class="ident" id="867788">testing</span><span class="op" id="867795">.</span><span class="ident" id="867796">T</span><span class="op" id="867797">)</span>&nbsp;<span class="op" id="867799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="867802">testDeadlock</span><span class="op" id="867814">(</span><span class="ident" id="867815">t</span><span class="op" id="867816">,</span>&nbsp;<span class="ident" id="867818">simpleDeadlockSource</span><span class="op" id="867838">)</span><br>
<span class="lineno"></span><span class="op" id="867840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="867843">func</span>&nbsp;<span class="ident" id="867848">TestInitDeadlock</span><span class="op" id="867864">(</span><span class="ident" id="867865">t</span>&nbsp;<span class="op" id="867867">*</span><span class="ident" id="867868">testing</span><span class="op" id="867875">.</span><span class="ident" id="867876">T</span><span class="op" id="867877">)</span>&nbsp;<span class="op" id="867879">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="867882">testDeadlock</span><span class="op" id="867894">(</span><span class="ident" id="867895">t</span><span class="op" id="867896">,</span>&nbsp;<span class="ident" id="867898">initDeadlockSource</span><span class="op" id="867916">)</span><br>
<span class="lineno"></span><span class="op" id="867918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="867921">func</span>&nbsp;<span class="ident" id="867926">TestLockedDeadlock</span><span class="op" id="867944">(</span><span class="ident" id="867945">t</span>&nbsp;<span class="op" id="867947">*</span><span class="ident" id="867948">testing</span><span class="op" id="867955">.</span><span class="ident" id="867956">T</span><span class="op" id="867957">)</span>&nbsp;<span class="op" id="867959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="867962">testDeadlock</span><span class="op" id="867974">(</span><span class="ident" id="867975">t</span><span class="op" id="867976">,</span>&nbsp;<span class="ident" id="867978">lockedDeadlockSource</span><span class="op" id="867998">)</span><br>
<span class="lineno">125</span><span class="op" id="868000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="868003">func</span>&nbsp;<span class="ident" id="868008">TestLockedDeadlock2</span><span class="op" id="868027">(</span><span class="ident" id="868028">t</span>&nbsp;<span class="op" id="868030">*</span><span class="ident" id="868031">testing</span><span class="op" id="868038">.</span><span class="ident" id="868039">T</span><span class="op" id="868040">)</span>&nbsp;<span class="op" id="868042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="868045">testDeadlock</span><span class="op" id="868057">(</span><span class="ident" id="868058">t</span><span class="op" id="868059">,</span>&nbsp;<span class="ident" id="868061">lockedDeadlockSource2</span><span class="op" id="868082">)</span><br>
<span class="lineno"></span><span class="op" id="868084">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="868087">func</span>&nbsp;<span class="ident" id="868092">TestGoexitDeadlock</span><span class="op" id="868110">(</span><span class="ident" id="868111">t</span>&nbsp;<span class="op" id="868113">*</span><span class="ident" id="868114">testing</span><span class="op" id="868121">.</span><span class="ident" id="868122">T</span><span class="op" id="868123">)</span>&nbsp;<span class="op" id="868125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="868128">output</span>&nbsp;<span class="op" id="868135">:=</span>&nbsp;<span class="ident" id="868138">executeTest</span><span class="op" id="868149">(</span><span class="ident" id="868150">t</span><span class="op" id="868151">,</span>&nbsp;<span class="ident" id="868153">goexitDeadlockSource</span><span class="op" id="868173">,</span>&nbsp;<span class="ident" id="868175">nil</span><span class="op" id="868178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="868181">want</span>&nbsp;<span class="op" id="868186">:=</span>&nbsp;<span class="string" id="868189">&#34;no&nbsp;goroutines&nbsp;(main&nbsp;called&nbsp;runtime.Goexit)&nbsp;-&nbsp;deadlock!&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="868247">if</span>&nbsp;<span class="op" id="868250">!</span><span class="ident" id="868251">strings</span><span class="op" id="868258">.</span><span class="ident" id="868259">Contains</span><span class="op" id="868267">(</span><span class="ident" id="868268">output</span><span class="op" id="868274">,</span>&nbsp;<span class="ident" id="868276">want</span><span class="op" id="868280">)</span>&nbsp;<span class="op" id="868282">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="868286">t</span><span class="op" id="868287">.</span><span class="ident" id="868288">Fatalf</span><span class="op" id="868294">(</span><span class="string" id="868295">&#34;output:\n%s\n\nwant&nbsp;output&nbsp;containing:&nbsp;%s&#34;</span><span class="op" id="868338">,</span>&nbsp;<span class="ident" id="868340">output</span><span class="op" id="868346">,</span>&nbsp;<span class="ident" id="868348">want</span><span class="op" id="868352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="868355">}</span><br>
<span class="lineno"></span><span class="op" id="868357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="868360">func</span>&nbsp;<span class="ident" id="868365">TestStackOverflow</span><span class="op" id="868382">(</span><span class="ident" id="868383">t</span>&nbsp;<span class="op" id="868385">*</span><span class="ident" id="868386">testing</span><span class="op" id="868393">.</span><span class="ident" id="868394">T</span><span class="op" id="868395">)</span>&nbsp;<span class="op" id="868397">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="868400">output</span>&nbsp;<span class="op" id="868407">:=</span>&nbsp;<span class="ident" id="868410">executeTest</span><span class="op" id="868421">(</span><span class="ident" id="868422">t</span><span class="op" id="868423">,</span>&nbsp;<span class="ident" id="868425">stackOverflowSource</span><span class="op" id="868444">,</span>&nbsp;<span class="ident" id="868446">nil</span><span class="op" id="868449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="868452">want</span>&nbsp;<span class="op" id="868457">:=</span>&nbsp;<span class="string" id="868460">&#34;runtime:&nbsp;goroutine&nbsp;stack&nbsp;exceeds&nbsp;4194304-byte&nbsp;limit\nfatal&nbsp;error:&nbsp;stack&nbsp;overflow&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="868544">if</span>&nbsp;<span class="op" id="868547">!</span><span class="ident" id="868548">strings</span><span class="op" id="868555">.</span><span class="ident" id="868556">HasPrefix</span><span class="op" id="868565">(</span><span class="ident" id="868566">output</span><span class="op" id="868572">,</span>&nbsp;<span class="ident" id="868574">want</span><span class="op" id="868578">)</span>&nbsp;<span class="op" id="868580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="868584">t</span><span class="op" id="868585">.</span><span class="ident" id="868586">Fatalf</span><span class="op" id="868592">(</span><span class="string" id="868593">&#34;output&nbsp;does&nbsp;not&nbsp;start&nbsp;with&nbsp;%q:\n%s&#34;</span><span class="op" id="868629">,</span>&nbsp;<span class="ident" id="868631">want</span><span class="op" id="868635">,</span>&nbsp;<span class="ident" id="868637">output</span><span class="op" id="868643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="868646">}</span><br>
<span class="lineno">145</span><span class="op" id="868648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="868651">func</span>&nbsp;<span class="ident" id="868656">TestThreadExhaustion</span><span class="op" id="868676">(</span><span class="ident" id="868677">t</span>&nbsp;<span class="op" id="868679">*</span><span class="ident" id="868680">testing</span><span class="op" id="868687">.</span><span class="ident" id="868688">T</span><span class="op" id="868689">)</span>&nbsp;<span class="op" id="868691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="868694">output</span>&nbsp;<span class="op" id="868701">:=</span>&nbsp;<span class="ident" id="868704">executeTest</span><span class="op" id="868715">(</span><span class="ident" id="868716">t</span><span class="op" id="868717">,</span>&nbsp;<span class="ident" id="868719">threadExhaustionSource</span><span class="op" id="868741">,</span>&nbsp;<span class="ident" id="868743">nil</span><span class="op" id="868746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="868749">want</span>&nbsp;<span class="op" id="868754">:=</span>&nbsp;<span class="string" id="868757">&#34;runtime:&nbsp;program&nbsp;exceeds&nbsp;10-thread&nbsp;limit\nfatal&nbsp;error:&nbsp;thread&nbsp;exhaustion&#34;</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="868833">if</span>&nbsp;<span class="op" id="868836">!</span><span class="ident" id="868837">strings</span><span class="op" id="868844">.</span><span class="ident" id="868845">HasPrefix</span><span class="op" id="868854">(</span><span class="ident" id="868855">output</span><span class="op" id="868861">,</span>&nbsp;<span class="ident" id="868863">want</span><span class="op" id="868867">)</span>&nbsp;<span class="op" id="868869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="868873">t</span><span class="op" id="868874">.</span><span class="ident" id="868875">Fatalf</span><span class="op" id="868881">(</span><span class="string" id="868882">&#34;output&nbsp;does&nbsp;not&nbsp;start&nbsp;with&nbsp;%q:\n%s&#34;</span><span class="op" id="868918">,</span>&nbsp;<span class="ident" id="868920">want</span><span class="op" id="868924">,</span>&nbsp;<span class="ident" id="868926">output</span><span class="op" id="868932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="868935">}</span><br>
<span class="lineno"></span><span class="op" id="868937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="868940">func</span>&nbsp;<span class="ident" id="868945">TestRecursivePanic</span><span class="op" id="868963">(</span><span class="ident" id="868964">t</span>&nbsp;<span class="op" id="868966">*</span><span class="ident" id="868967">testing</span><span class="op" id="868974">.</span><span class="ident" id="868975">T</span><span class="op" id="868976">)</span>&nbsp;<span class="op" id="868978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="868981">output</span>&nbsp;<span class="op" id="868988">:=</span>&nbsp;<span class="ident" id="868991">executeTest</span><span class="op" id="869002">(</span><span class="ident" id="869003">t</span><span class="op" id="869004">,</span>&nbsp;<span class="ident" id="869006">recursivePanicSource</span><span class="op" id="869026">,</span>&nbsp;<span class="ident" id="869028">nil</span><span class="op" id="869031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="869034">want</span>&nbsp;<span class="op" id="869039">:=</span>&nbsp;<span class="string" id="869042">`wrap:&nbsp;bad<br>
<span class="lineno"></span>panic:&nbsp;again<br>
<span class="lineno"></span><br>
<span class="lineno">160</span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="869070">if</span>&nbsp;<span class="op" id="869073">!</span><span class="ident" id="869074">strings</span><span class="op" id="869081">.</span><span class="ident" id="869082">HasPrefix</span><span class="op" id="869091">(</span><span class="ident" id="869092">output</span><span class="op" id="869098">,</span>&nbsp;<span class="ident" id="869100">want</span><span class="op" id="869104">)</span>&nbsp;<span class="op" id="869106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="869110">t</span><span class="op" id="869111">.</span><span class="ident" id="869112">Fatalf</span><span class="op" id="869118">(</span><span class="string" id="869119">&#34;output&nbsp;does&nbsp;not&nbsp;start&nbsp;with&nbsp;%q:\n%s&#34;</span><span class="op" id="869155">,</span>&nbsp;<span class="ident" id="869157">want</span><span class="op" id="869161">,</span>&nbsp;<span class="ident" id="869163">output</span><span class="op" id="869169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="869172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="op" id="869175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="869178">func</span>&nbsp;<span class="ident" id="869183">TestGoexitCrash</span><span class="op" id="869198">(</span><span class="ident" id="869199">t</span>&nbsp;<span class="op" id="869201">*</span><span class="ident" id="869202">testing</span><span class="op" id="869209">.</span><span class="ident" id="869210">T</span><span class="op" id="869211">)</span>&nbsp;<span class="op" id="869213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="869216">output</span>&nbsp;<span class="op" id="869223">:=</span>&nbsp;<span class="ident" id="869226">executeTest</span><span class="op" id="869237">(</span><span class="ident" id="869238">t</span><span class="op" id="869239">,</span>&nbsp;<span class="ident" id="869241">goexitExitSource</span><span class="op" id="869257">,</span>&nbsp;<span class="ident" id="869259">nil</span><span class="op" id="869262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="869265">want</span>&nbsp;<span class="op" id="869270">:=</span>&nbsp;<span class="string" id="869273">&#34;no&nbsp;goroutines&nbsp;(main&nbsp;called&nbsp;runtime.Goexit)&nbsp;-&nbsp;deadlock!&#34;</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="869331">if</span>&nbsp;<span class="op" id="869334">!</span><span class="ident" id="869335">strings</span><span class="op" id="869342">.</span><span class="ident" id="869343">Contains</span><span class="op" id="869351">(</span><span class="ident" id="869352">output</span><span class="op" id="869358">,</span>&nbsp;<span class="ident" id="869360">want</span><span class="op" id="869364">)</span>&nbsp;<span class="op" id="869366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="869370">t</span><span class="op" id="869371">.</span><span class="ident" id="869372">Fatalf</span><span class="op" id="869378">(</span><span class="string" id="869379">&#34;output:\n%s\n\nwant&nbsp;output&nbsp;containing:&nbsp;%s&#34;</span><span class="op" id="869422">,</span>&nbsp;<span class="ident" id="869424">output</span><span class="op" id="869430">,</span>&nbsp;<span class="ident" id="869432">want</span><span class="op" id="869436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="869439">}</span><br>
<span class="lineno"></span><span class="op" id="869441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="869444">func</span>&nbsp;<span class="ident" id="869449">TestGoexitDefer</span><span class="op" id="869464">(</span><span class="ident" id="869465">t</span>&nbsp;<span class="op" id="869467">*</span><span class="ident" id="869468">testing</span><span class="op" id="869475">.</span><span class="ident" id="869476">T</span><span class="op" id="869477">)</span>&nbsp;<span class="op" id="869479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="869482">c</span>&nbsp;<span class="op" id="869484">:=</span>&nbsp;<span class="builtinfunc" id="869487">make</span><span class="op" id="869491">(</span><span class="keyword" id="869492">chan</span>&nbsp;<span class="keyword" id="869497">struct</span><span class="op" id="869503">{</span><span class="op" id="869504">}</span><span class="op" id="869505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="869508">go</span>&nbsp;<span class="keyword" id="869511">func</span><span class="op" id="869515">(</span><span class="op" id="869516">)</span>&nbsp;<span class="op" id="869518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="869522">defer</span>&nbsp;<span class="keyword" id="869528">func</span><span class="op" id="869532">(</span><span class="op" id="869533">)</span>&nbsp;<span class="op" id="869535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="869540">r</span>&nbsp;<span class="op" id="869542">:=</span>&nbsp;<span class="builtinfunc" id="869545">recover</span><span class="op" id="869552">(</span><span class="op" id="869553">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="869558">if</span>&nbsp;<span class="ident" id="869561">r</span>&nbsp;<span class="op" id="869563">!=</span>&nbsp;<span class="ident" id="869566">nil</span>&nbsp;<span class="op" id="869570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="869576">t</span><span class="op" id="869577">.</span><span class="ident" id="869578">Errorf</span><span class="op" id="869584">(</span><span class="string" id="869585">&#34;non-nil&nbsp;recover&nbsp;during&nbsp;Goexit&#34;</span><span class="op" id="869616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="869621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="869626">c</span>&nbsp;<span class="op" id="869628">&lt;-</span>&nbsp;<span class="keyword" id="869631">struct</span><span class="op" id="869637">{</span><span class="op" id="869638">}</span><span class="op" id="869639">{</span><span class="op" id="869640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="869644">}</span><span class="op" id="869645">(</span><span class="op" id="869646">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="869650">runtime</span><span class="op" id="869657">.</span><span class="ident" id="869658">Goexit</span><span class="op" id="869664">(</span><span class="op" id="869665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="869668">}</span><span class="op" id="869669">(</span><span class="op" id="869670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="869673">//&nbsp;Note:&nbsp;if&nbsp;the&nbsp;defer&nbsp;fails&nbsp;to&nbsp;run,&nbsp;we&nbsp;will&nbsp;get&nbsp;a&nbsp;deadlock&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="869738">&lt;-</span><span class="ident" id="869740">c</span><br>
<span class="lineno"></span><span class="op" id="869742">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="869745">func</span>&nbsp;<span class="ident" id="869750">TestGoNil</span><span class="op" id="869759">(</span><span class="ident" id="869760">t</span>&nbsp;<span class="op" id="869762">*</span><span class="ident" id="869763">testing</span><span class="op" id="869770">.</span><span class="ident" id="869771">T</span><span class="op" id="869772">)</span>&nbsp;<span class="op" id="869774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="869777">output</span>&nbsp;<span class="op" id="869784">:=</span>&nbsp;<span class="ident" id="869787">executeTest</span><span class="op" id="869798">(</span><span class="ident" id="869799">t</span><span class="op" id="869800">,</span>&nbsp;<span class="ident" id="869802">goNilSource</span><span class="op" id="869813">,</span>&nbsp;<span class="ident" id="869815">nil</span><span class="op" id="869818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="869821">want</span>&nbsp;<span class="op" id="869826">:=</span>&nbsp;<span class="string" id="869829">&#34;go&nbsp;of&nbsp;nil&nbsp;func&nbsp;value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="869853">if</span>&nbsp;<span class="op" id="869856">!</span><span class="ident" id="869857">strings</span><span class="op" id="869864">.</span><span class="ident" id="869865">Contains</span><span class="op" id="869873">(</span><span class="ident" id="869874">output</span><span class="op" id="869880">,</span>&nbsp;<span class="ident" id="869882">want</span><span class="op" id="869886">)</span>&nbsp;<span class="op" id="869888">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="869892">t</span><span class="op" id="869893">.</span><span class="ident" id="869894">Fatalf</span><span class="op" id="869900">(</span><span class="string" id="869901">&#34;output:\n%s\n\nwant&nbsp;output&nbsp;containing:&nbsp;%s&#34;</span><span class="op" id="869944">,</span>&nbsp;<span class="ident" id="869946">output</span><span class="op" id="869952">,</span>&nbsp;<span class="ident" id="869954">want</span><span class="op" id="869958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="869961">}</span><br>
<span class="lineno"></span><span class="op" id="869963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="869966">func</span>&nbsp;<span class="ident" id="869971">TestMainGoroutineId</span><span class="op" id="869990">(</span><span class="ident" id="869991">t</span>&nbsp;<span class="op" id="869993">*</span><span class="ident" id="869994">testing</span><span class="op" id="870001">.</span><span class="ident" id="870002">T</span><span class="op" id="870003">)</span>&nbsp;<span class="op" id="870005">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="870008">output</span>&nbsp;<span class="op" id="870015">:=</span>&nbsp;<span class="ident" id="870018">executeTest</span><span class="op" id="870029">(</span><span class="ident" id="870030">t</span><span class="op" id="870031">,</span>&nbsp;<span class="ident" id="870033">mainGoroutineIdSource</span><span class="op" id="870054">,</span>&nbsp;<span class="ident" id="870056">nil</span><span class="op" id="870059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="870062">want</span>&nbsp;<span class="op" id="870067">:=</span>&nbsp;<span class="string" id="870070">&#34;panic:&nbsp;test\n\ngoroutine&nbsp;1&nbsp;[running]:\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="870113">if</span>&nbsp;<span class="op" id="870116">!</span><span class="ident" id="870117">strings</span><span class="op" id="870124">.</span><span class="ident" id="870125">HasPrefix</span><span class="op" id="870134">(</span><span class="ident" id="870135">output</span><span class="op" id="870141">,</span>&nbsp;<span class="ident" id="870143">want</span><span class="op" id="870147">)</span>&nbsp;<span class="op" id="870149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="870153">t</span><span class="op" id="870154">.</span><span class="ident" id="870155">Fatalf</span><span class="op" id="870161">(</span><span class="string" id="870162">&#34;output&nbsp;does&nbsp;not&nbsp;start&nbsp;with&nbsp;%q:\n%s&#34;</span><span class="op" id="870198">,</span>&nbsp;<span class="ident" id="870200">want</span><span class="op" id="870204">,</span>&nbsp;<span class="ident" id="870206">output</span><span class="op" id="870212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="870215">}</span><br>
<span class="lineno">205</span><span class="op" id="870217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="870220">func</span>&nbsp;<span class="ident" id="870225">TestBreakpoint</span><span class="op" id="870239">(</span><span class="ident" id="870240">t</span>&nbsp;<span class="op" id="870242">*</span><span class="ident" id="870243">testing</span><span class="op" id="870250">.</span><span class="ident" id="870251">T</span><span class="op" id="870252">)</span>&nbsp;<span class="op" id="870254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="870257">output</span>&nbsp;<span class="op" id="870264">:=</span>&nbsp;<span class="ident" id="870267">executeTest</span><span class="op" id="870278">(</span><span class="ident" id="870279">t</span><span class="op" id="870280">,</span>&nbsp;<span class="ident" id="870282">breakpointSource</span><span class="op" id="870298">,</span>&nbsp;<span class="ident" id="870300">nil</span><span class="op" id="870303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="870306">want</span>&nbsp;<span class="op" id="870311">:=</span>&nbsp;<span class="string" id="870314">&#34;runtime.Breakpoint()&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="870338">if</span>&nbsp;<span class="op" id="870341">!</span><span class="ident" id="870342">strings</span><span class="op" id="870349">.</span><span class="ident" id="870350">Contains</span><span class="op" id="870358">(</span><span class="ident" id="870359">output</span><span class="op" id="870365">,</span>&nbsp;<span class="ident" id="870367">want</span><span class="op" id="870371">)</span>&nbsp;<span class="op" id="870373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="870377">t</span><span class="op" id="870378">.</span><span class="ident" id="870379">Fatalf</span><span class="op" id="870385">(</span><span class="string" id="870386">&#34;output:\n%s\n\nwant&nbsp;output&nbsp;containing:&nbsp;%s&#34;</span><span class="op" id="870429">,</span>&nbsp;<span class="ident" id="870431">output</span><span class="op" id="870437">,</span>&nbsp;<span class="ident" id="870439">want</span><span class="op" id="870443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="870446">}</span><br>
<span class="lineno"></span><span class="op" id="870448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="870451">const</span>&nbsp;<span class="ident" id="870457">crashSource</span>&nbsp;<span class="op" id="870469">=</span>&nbsp;<span class="string" id="870471">`<br>
<span class="lineno"></span>package&nbsp;main<br>
<span class="lineno"></span><br>
<span class="lineno"></span>import&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&#34;fmt&#34;<br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&#34;runtime&#34;<br>
<span class="lineno"></span>)<br>
<span class="lineno"></span><br>
<span class="lineno"></span>{{if&nbsp;.Cgo}}<br>
<span class="lineno"></span>import&nbsp;&#34;C&#34;<br>
<span class="lineno">225</span>{{end}}<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;test(name&nbsp;string)&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspdefer&nbsp;func()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;x&nbsp;:=&nbsp;recover();&nbsp;x&nbsp;!=&nbsp;nil&nbsp;{<br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfmt.Printf(&#34;&nbsp;recovered&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfmt.Printf(&#34;&nbsp;done\n&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspfmt.Printf(&#34;%s:&#34;,&nbsp;name)<br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbspvar&nbsp;s&nbsp;*string<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp_&nbsp;=&nbsp;*s<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspfmt.Print(&#34;SHOULD&nbsp;NOT&nbsp;BE&nbsp;HERE&#34;)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span><br>
<span class="lineno">240</span>func&nbsp;testInNewThread(name&nbsp;string)&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspc&nbsp;:=&nbsp;make(chan&nbsp;bool)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;func()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspruntime.LockOSThread()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptest(name)<br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspc&nbsp;&lt;-&nbsp;true<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&lt;-c<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span><br>
<span class="lineno">250</span>func&nbsp;main()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspruntime.LockOSThread()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsptest(&#34;main&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsptestInNewThread(&#34;new-thread&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsptestInNewThread(&#34;second-new-thread&#34;)<br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsptest(&#34;main-again&#34;)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="871047">const</span>&nbsp;<span class="ident" id="871053">simpleDeadlockSource</span>&nbsp;<span class="op" id="871074">=</span>&nbsp;<span class="string" id="871076">`<br>
<span class="lineno">260</span>package&nbsp;main<br>
<span class="lineno"></span>func&nbsp;main()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspselect&nbsp;{}<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="871121">const</span>&nbsp;<span class="ident" id="871127">initDeadlockSource</span>&nbsp;<span class="op" id="871146">=</span>&nbsp;<span class="string" id="871148">`<br>
<span class="lineno"></span>package&nbsp;main<br>
<span class="lineno"></span>func&nbsp;init()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspselect&nbsp;{}<br>
<span class="lineno">270</span>}<br>
<span class="lineno"></span>func&nbsp;main()&nbsp;{<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="871209">const</span>&nbsp;<span class="ident" id="871215">lockedDeadlockSource</span>&nbsp;<span class="op" id="871236">=</span>&nbsp;<span class="string" id="871238">`<br>
<span class="lineno"></span>package&nbsp;main<br>
<span class="lineno"></span>import&nbsp;&#34;runtime&#34;<br>
<span class="lineno"></span>func&nbsp;main()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspruntime.LockOSThread()<br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbspselect&nbsp;{}<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="871324">const</span>&nbsp;<span class="ident" id="871330">lockedDeadlockSource2</span>&nbsp;<span class="op" id="871352">=</span>&nbsp;<span class="string" id="871354">`<br>
<span class="lineno">285</span>package&nbsp;main<br>
<span class="lineno"></span>import&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&#34;runtime&#34;<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&#34;time&#34;<br>
<span class="lineno"></span>)<br>
<span class="lineno">290</span>func&nbsp;main()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;func()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspruntime.LockOSThread()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspselect&nbsp;{}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}()<br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsptime.Sleep(time.Millisecond)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspselect&nbsp;{}<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="871514">const</span>&nbsp;<span class="ident" id="871520">goexitDeadlockSource</span>&nbsp;<span class="op" id="871541">=</span>&nbsp;<span class="string" id="871543">`<br>
<span class="lineno"></span>package&nbsp;main<br>
<span class="lineno"></span>import&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;runtime&#34;<br>
<span class="lineno"></span>)<br>
<span class="lineno">305</span><br>
<span class="lineno"></span>func&nbsp;F()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;10;&nbsp;i++&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno"></span>}<br>
<span class="lineno">310</span><br>
<span class="lineno"></span>func&nbsp;main()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;F()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;go&nbsp;F()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;runtime.Goexit()<br>
<span class="lineno">315</span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="871708">const</span>&nbsp;<span class="ident" id="871714">stackOverflowSource</span>&nbsp;<span class="op" id="871734">=</span>&nbsp;<span class="string" id="871736">`<br>
<span class="lineno"></span>package&nbsp;main<br>
<span class="lineno">320</span><br>
<span class="lineno"></span>import&nbsp;&#34;runtime/debug&#34;<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;main()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspdebug.SetMaxStack(4&lt;&lt;20)<br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbspf(make([]byte,&nbsp;10))<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;f(x&nbsp;[]byte)&nbsp;byte&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspvar&nbsp;buf&nbsp;[64&lt;&lt;10]byte<br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;x[0]&nbsp;+&nbsp;f(buf[:])<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="871916">const</span>&nbsp;<span class="ident" id="871922">threadExhaustionSource</span>&nbsp;<span class="op" id="871945">=</span>&nbsp;<span class="string" id="871947">`<br>
<span class="lineno">335</span>package&nbsp;main<br>
<span class="lineno"></span><br>
<span class="lineno"></span>import&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&#34;runtime&#34;<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&#34;runtime/debug&#34;<br>
<span class="lineno">340</span>)<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;main()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspdebug.SetMaxThreads(10)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspc&nbsp;:=&nbsp;make(chan&nbsp;int)<br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbspfor&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;100;&nbsp;i++&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;func()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspruntime.LockOSThread()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspc&nbsp;&lt;-&nbsp;0<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspselect{}<br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&lt;-c<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="872173">const</span>&nbsp;<span class="ident" id="872179">recursivePanicSource</span>&nbsp;<span class="op" id="872200">=</span>&nbsp;<span class="string" id="872202">`<br>
<span class="lineno"></span>package&nbsp;main<br>
<span class="lineno"></span><br>
<span class="lineno"></span>import&nbsp;(<br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&#34;fmt&#34;<br>
<span class="lineno"></span>)<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;main()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspfunc()&nbsp;{<br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspdefer&nbsp;func()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfmt.Println(recover())<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspvar&nbsp;x&nbsp;[8192]byte<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfunc(x&nbsp;[8192]byte)&nbsp;{<br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspdefer&nbsp;func()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;err&nbsp;:=&nbsp;recover();&nbsp;err&nbsp;!=&nbsp;nil&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsppanic(&#34;wrap:&nbsp;&#34;&nbsp;+&nbsp;err.(string))<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}()<br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsppanic(&#34;bad&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}(x)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsppanic(&#34;again&#34;)<br>
<span class="lineno"></span>}<br>
<span class="lineno">380</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="872506">const</span>&nbsp;<span class="ident" id="872512">goexitExitSource</span>&nbsp;<span class="op" id="872529">=</span>&nbsp;<span class="string" id="872531">`<br>
<span class="lineno"></span>package&nbsp;main<br>
<span class="lineno"></span><br>
<span class="lineno">385</span>import&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&#34;runtime&#34;<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&#34;time&#34;<br>
<span class="lineno"></span>)<br>
<span class="lineno"></span><br>
<span class="lineno">390</span>func&nbsp;main()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;func()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptime.Sleep(time.Millisecond)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspi&nbsp;:=&nbsp;0<br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbspruntime.SetFinalizer(&amp;i,&nbsp;func(p&nbsp;*int)&nbsp;{})<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspruntime.GC()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspruntime.Goexit()<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="keyword" id="872729">const</span>&nbsp;<span class="ident" id="872735">goNilSource</span>&nbsp;<span class="op" id="872747">=</span>&nbsp;<span class="string" id="872749">`<br>
<span class="lineno"></span>package&nbsp;main<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;main()&nbsp;{<br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbspdefer&nbsp;func()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsprecover()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspvar&nbsp;f&nbsp;func()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;f()<br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbspselect{}<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="872849">const</span>&nbsp;<span class="ident" id="872855">mainGoroutineIdSource</span>&nbsp;<span class="op" id="872877">=</span>&nbsp;<span class="string" id="872879">`<br>
<span class="lineno">415</span>package&nbsp;main<br>
<span class="lineno"></span>func&nbsp;main()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsppanic(&#34;test&#34;)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="872928">const</span>&nbsp;<span class="ident" id="872934">breakpointSource</span>&nbsp;<span class="op" id="872951">=</span>&nbsp;<span class="string" id="872953">`<br>
<span class="lineno"></span>package&nbsp;main<br>
<span class="lineno"></span>import&nbsp;&#34;runtime&#34;<br>
<span class="lineno"></span>func&nbsp;main()&nbsp;{<br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbspruntime.Breakpoint()<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="873026">func</span>&nbsp;<span class="ident" id="873031">TestGoexitInPanic</span><span class="op" id="873048">(</span><span class="ident" id="873049">t</span>&nbsp;<span class="op" id="873051">*</span><span class="ident" id="873052">testing</span><span class="op" id="873059">.</span><span class="ident" id="873060">T</span><span class="op" id="873061">)</span>&nbsp;<span class="op" id="873063">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="873066">//&nbsp;see&nbsp;issue&nbsp;8774:&nbsp;this&nbsp;code&nbsp;used&nbsp;to&nbsp;trigger&nbsp;an&nbsp;infinite&nbsp;recursion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="873134">output</span>&nbsp;<span class="op" id="873141">:=</span>&nbsp;<span class="ident" id="873144">executeTest</span><span class="op" id="873155">(</span><span class="ident" id="873156">t</span><span class="op" id="873157">,</span>&nbsp;<span class="ident" id="873159">goexitInPanicSource</span><span class="op" id="873178">,</span>&nbsp;<span class="ident" id="873180">nil</span><span class="op" id="873183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="873186">want</span>&nbsp;<span class="op" id="873191">:=</span>&nbsp;<span class="string" id="873194">&#34;fatal&nbsp;error:&nbsp;no&nbsp;goroutines&nbsp;(main&nbsp;called&nbsp;runtime.Goexit)&nbsp;-&nbsp;deadlock!&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="873265">if</span>&nbsp;<span class="op" id="873268">!</span><span class="ident" id="873269">strings</span><span class="op" id="873276">.</span><span class="ident" id="873277">HasPrefix</span><span class="op" id="873286">(</span><span class="ident" id="873287">output</span><span class="op" id="873293">,</span>&nbsp;<span class="ident" id="873295">want</span><span class="op" id="873299">)</span>&nbsp;<span class="op" id="873301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="873305">t</span><span class="op" id="873306">.</span><span class="ident" id="873307">Fatalf</span><span class="op" id="873313">(</span><span class="string" id="873314">&#34;output&nbsp;does&nbsp;not&nbsp;start&nbsp;with&nbsp;%q:\n%s&#34;</span><span class="op" id="873350">,</span>&nbsp;<span class="ident" id="873352">want</span><span class="op" id="873356">,</span>&nbsp;<span class="ident" id="873358">output</span><span class="op" id="873364">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="873367">}</span><br>
<span class="lineno"></span><span class="op" id="873369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="873372">const</span>&nbsp;<span class="ident" id="873378">goexitInPanicSource</span>&nbsp;<span class="op" id="873398">=</span>&nbsp;<span class="string" id="873400">`<br>
<span class="lineno"></span>package&nbsp;main<br>
<span class="lineno">440</span>import&nbsp;&#34;runtime&#34;<br>
<span class="lineno"></span>func&nbsp;main()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;func()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspdefer&nbsp;func()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspruntime.Goexit()<br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsppanic(&#34;hello&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspruntime.Goexit()<br>
<span class="lineno"></span>}<br>
<span class="lineno">450</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="873547">func</span>&nbsp;<span class="ident" id="873552">TestPanicAfterGoexit</span><span class="op" id="873572">(</span><span class="ident" id="873573">t</span>&nbsp;<span class="op" id="873575">*</span><span class="ident" id="873576">testing</span><span class="op" id="873583">.</span><span class="ident" id="873584">T</span><span class="op" id="873585">)</span>&nbsp;<span class="op" id="873587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="873590">//&nbsp;an&nbsp;uncaught&nbsp;panic&nbsp;should&nbsp;still&nbsp;work&nbsp;after&nbsp;goexit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="873643">output</span>&nbsp;<span class="op" id="873650">:=</span>&nbsp;<span class="ident" id="873653">executeTest</span><span class="op" id="873664">(</span><span class="ident" id="873665">t</span><span class="op" id="873666">,</span>&nbsp;<span class="ident" id="873668">panicAfterGoexitSource</span><span class="op" id="873690">,</span>&nbsp;<span class="ident" id="873692">nil</span><span class="op" id="873695">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="873698">want</span>&nbsp;<span class="op" id="873703">:=</span>&nbsp;<span class="string" id="873706">&#34;panic:&nbsp;hello&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="873722">if</span>&nbsp;<span class="op" id="873725">!</span><span class="ident" id="873726">strings</span><span class="op" id="873733">.</span><span class="ident" id="873734">HasPrefix</span><span class="op" id="873743">(</span><span class="ident" id="873744">output</span><span class="op" id="873750">,</span>&nbsp;<span class="ident" id="873752">want</span><span class="op" id="873756">)</span>&nbsp;<span class="op" id="873758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="873762">t</span><span class="op" id="873763">.</span><span class="ident" id="873764">Fatalf</span><span class="op" id="873770">(</span><span class="string" id="873771">&#34;output&nbsp;does&nbsp;not&nbsp;start&nbsp;with&nbsp;%q:\n%s&#34;</span><span class="op" id="873807">,</span>&nbsp;<span class="ident" id="873809">want</span><span class="op" id="873813">,</span>&nbsp;<span class="ident" id="873815">output</span><span class="op" id="873821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="873824">}</span><br>
<span class="lineno"></span><span class="op" id="873826">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="keyword" id="873829">const</span>&nbsp;<span class="ident" id="873835">panicAfterGoexitSource</span>&nbsp;<span class="op" id="873858">=</span>&nbsp;<span class="string" id="873860">`<br>
<span class="lineno"></span>package&nbsp;main<br>
<span class="lineno"></span>import&nbsp;&#34;runtime&#34;<br>
<span class="lineno"></span>func&nbsp;main()&nbsp;{<br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbspdefer&nbsp;func()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsppanic(&#34;hello&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspruntime.Goexit()<br>
<span class="lineno"></span>}<br>
<span class="lineno">470</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="873967">func</span>&nbsp;<span class="ident" id="873972">TestRecoveredPanicAfterGoexit</span><span class="op" id="874001">(</span><span class="ident" id="874002">t</span>&nbsp;<span class="op" id="874004">*</span><span class="ident" id="874005">testing</span><span class="op" id="874012">.</span><span class="ident" id="874013">T</span><span class="op" id="874014">)</span>&nbsp;<span class="op" id="874016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="874019">output</span>&nbsp;<span class="op" id="874026">:=</span>&nbsp;<span class="ident" id="874029">executeTest</span><span class="op" id="874040">(</span><span class="ident" id="874041">t</span><span class="op" id="874042">,</span>&nbsp;<span class="ident" id="874044">recoveredPanicAfterGoexitSource</span><span class="op" id="874075">,</span>&nbsp;<span class="ident" id="874077">nil</span><span class="op" id="874080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="874083">want</span>&nbsp;<span class="op" id="874088">:=</span>&nbsp;<span class="string" id="874091">&#34;fatal&nbsp;error:&nbsp;no&nbsp;goroutines&nbsp;(main&nbsp;called&nbsp;runtime.Goexit)&nbsp;-&nbsp;deadlock!&#34;</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="874162">if</span>&nbsp;<span class="op" id="874165">!</span><span class="ident" id="874166">strings</span><span class="op" id="874173">.</span><span class="ident" id="874174">HasPrefix</span><span class="op" id="874183">(</span><span class="ident" id="874184">output</span><span class="op" id="874190">,</span>&nbsp;<span class="ident" id="874192">want</span><span class="op" id="874196">)</span>&nbsp;<span class="op" id="874198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="874202">t</span><span class="op" id="874203">.</span><span class="ident" id="874204">Fatalf</span><span class="op" id="874210">(</span><span class="string" id="874211">&#34;output&nbsp;does&nbsp;not&nbsp;start&nbsp;with&nbsp;%q:\n%s&#34;</span><span class="op" id="874247">,</span>&nbsp;<span class="ident" id="874249">want</span><span class="op" id="874253">,</span>&nbsp;<span class="ident" id="874255">output</span><span class="op" id="874261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="874264">}</span><br>
<span class="lineno"></span><span class="op" id="874266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="874269">const</span>&nbsp;<span class="ident" id="874275">recoveredPanicAfterGoexitSource</span>&nbsp;<span class="op" id="874307">=</span>&nbsp;<span class="string" id="874309">`<br>
<span class="lineno"></span>package&nbsp;main<br>
<span class="lineno"></span>import&nbsp;&#34;runtime&#34;<br>
<span class="lineno"></span>func&nbsp;main()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspdefer&nbsp;func()&nbsp;{<br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspdefer&nbsp;func()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspr&nbsp;:=&nbsp;recover()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;r&nbsp;==&nbsp;nil&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsppanic(&#34;bad&nbsp;recover&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsppanic(&#34;hello&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspruntime.Goexit()<br>
<span class="lineno"></span>}<br>
<span class="lineno">495</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="874504">func</span>&nbsp;<span class="ident" id="874509">TestRecoverBeforePanicAfterGoexit</span><span class="op" id="874542">(</span><span class="ident" id="874543">t</span>&nbsp;<span class="op" id="874545">*</span><span class="ident" id="874546">testing</span><span class="op" id="874553">.</span><span class="ident" id="874554">T</span><span class="op" id="874555">)</span>&nbsp;<span class="op" id="874557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="874560">//&nbsp;1.&nbsp;defer&nbsp;a&nbsp;function&nbsp;that&nbsp;recovers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="874598">//&nbsp;2.&nbsp;defer&nbsp;a&nbsp;function&nbsp;that&nbsp;panics</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="874634">//&nbsp;3.&nbsp;call&nbsp;goexit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="874653">//&nbsp;Goexit&nbsp;should&nbsp;run&nbsp;the&nbsp;#2&nbsp;defer.&nbsp;&nbsp;Its&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="874700">//&nbsp;should&nbsp;be&nbsp;caught&nbsp;by&nbsp;the&nbsp;#1&nbsp;defer,&nbsp;and&nbsp;execution</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="874752">//&nbsp;should&nbsp;resume&nbsp;in&nbsp;the&nbsp;caller.&nbsp;&nbsp;Like&nbsp;the&nbsp;Goexit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="874802">//&nbsp;never&nbsp;happened!</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="874822">defer</span>&nbsp;<span class="keyword" id="874828">func</span><span class="op" id="874832">(</span><span class="op" id="874833">)</span>&nbsp;<span class="op" id="874835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="874839">r</span>&nbsp;<span class="op" id="874841">:=</span>&nbsp;<span class="builtinfunc" id="874844">recover</span><span class="op" id="874851">(</span><span class="op" id="874852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="874856">if</span>&nbsp;<span class="ident" id="874859">r</span>&nbsp;<span class="op" id="874861">==</span>&nbsp;<span class="ident" id="874864">nil</span>&nbsp;<span class="op" id="874868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="874873">panic</span><span class="op" id="874878">(</span><span class="string" id="874879">&#34;bad&nbsp;recover&#34;</span><span class="op" id="874892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="874896">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="874899">}</span><span class="op" id="874900">(</span><span class="op" id="874901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="874904">defer</span>&nbsp;<span class="keyword" id="874910">func</span><span class="op" id="874914">(</span><span class="op" id="874915">)</span>&nbsp;<span class="op" id="874917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="874921">panic</span><span class="op" id="874926">(</span><span class="string" id="874927">&#34;hello&#34;</span><span class="op" id="874934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="874937">}</span><span class="op" id="874938">(</span><span class="op" id="874939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="874942">runtime</span><span class="op" id="874949">.</span><span class="ident" id="874950">Goexit</span><span class="op" id="874956">(</span><span class="op" id="874957">)</span><br>
<span class="lineno">515</span><span class="op" id="874959">}</span>
</div>
</body>
</html>
