<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html" class="current">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4002318">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4002374">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4002428">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4002479">package</span>&nbsp;<span class="ident" id="4002487">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4002492">import</span>&nbsp;<span class="op" id="4002499">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4002502">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4002512">&#34;time&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4002519">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4002522">//&nbsp;A&nbsp;Dialer&nbsp;contains&nbsp;options&nbsp;for&nbsp;connecting&nbsp;to&nbsp;an&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="4002581">//</span><br>
<span class="lineno"></span><span class="comment" id="4002584">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;each&nbsp;field&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;dialing</span><br>
<span class="lineno">15</span><span class="comment" id="4002642">//&nbsp;without&nbsp;that&nbsp;option.&nbsp;Dialing&nbsp;with&nbsp;the&nbsp;zero&nbsp;value&nbsp;of&nbsp;Dialer</span><br>
<span class="lineno"></span><span class="comment" id="4002704">//&nbsp;is&nbsp;therefore&nbsp;equivalent&nbsp;to&nbsp;just&nbsp;calling&nbsp;the&nbsp;Dial&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="4002766">type</span>&nbsp;<span class="ident" id="4002771">Dialer</span>&nbsp;<span class="keyword" id="4002778">struct</span>&nbsp;<span class="op" id="4002785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4002788">//&nbsp;Timeout&nbsp;is&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;time&nbsp;a&nbsp;dial&nbsp;will&nbsp;wait&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4002851">//&nbsp;a&nbsp;connect&nbsp;to&nbsp;complete.&nbsp;If&nbsp;Deadline&nbsp;is&nbsp;also&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4002915">//&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4002928">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4002932">//&nbsp;The&nbsp;default&nbsp;is&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4002963">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4002967">//&nbsp;With&nbsp;or&nbsp;without&nbsp;a&nbsp;timeout,&nbsp;the&nbsp;operating&nbsp;system&nbsp;may&nbsp;impose</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003030">//&nbsp;its&nbsp;own&nbsp;earlier&nbsp;timeout.&nbsp;For&nbsp;instance,&nbsp;TCP&nbsp;timeouts&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003090">//&nbsp;often&nbsp;around&nbsp;3&nbsp;minutes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003118">Timeout</span>&nbsp;<span class="ident" id="4003126">time</span><span class="op" id="4003130">.</span><span class="ident" id="4003131">Duration</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003142">//&nbsp;Deadline&nbsp;is&nbsp;the&nbsp;absolute&nbsp;point&nbsp;in&nbsp;time&nbsp;after&nbsp;which&nbsp;dials</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003203">//&nbsp;will&nbsp;fail.&nbsp;If&nbsp;Timeout&nbsp;is&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003258">//&nbsp;Zero&nbsp;means&nbsp;no&nbsp;deadline,&nbsp;or&nbsp;dependent&nbsp;on&nbsp;the&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003323">//&nbsp;as&nbsp;with&nbsp;the&nbsp;Timeout&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003355">Deadline</span>&nbsp;<span class="ident" id="4003364">time</span><span class="op" id="4003368">.</span><span class="ident" id="4003369">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003376">//&nbsp;LocalAddr&nbsp;is&nbsp;the&nbsp;local&nbsp;address&nbsp;to&nbsp;use&nbsp;when&nbsp;dialing&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003434">//&nbsp;address.&nbsp;The&nbsp;address&nbsp;must&nbsp;be&nbsp;of&nbsp;a&nbsp;compatible&nbsp;type&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003496">//&nbsp;network&nbsp;being&nbsp;dialed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003522">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;local&nbsp;address&nbsp;is&nbsp;automatically&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003575">LocalAddr</span>&nbsp;<span class="ident" id="4003585">Addr</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003592">//&nbsp;DualStack&nbsp;allows&nbsp;a&nbsp;single&nbsp;dial&nbsp;to&nbsp;attempt&nbsp;to&nbsp;establish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003651">//&nbsp;multiple&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections&nbsp;and&nbsp;to&nbsp;return&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003714">//&nbsp;established&nbsp;connection&nbsp;when&nbsp;the&nbsp;network&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003775">//&nbsp;destination&nbsp;is&nbsp;a&nbsp;host&nbsp;name&nbsp;that&nbsp;has&nbsp;multiple&nbsp;address&nbsp;family</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003839">//&nbsp;DNS&nbsp;records.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003856">DualStack</span>&nbsp;<span class="builtintype" id="4003866">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003873">//&nbsp;KeepAlive&nbsp;specifies&nbsp;the&nbsp;keep-alive&nbsp;period&nbsp;for&nbsp;an&nbsp;active</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003933">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003957">//&nbsp;If&nbsp;zero,&nbsp;keep-alives&nbsp;are&nbsp;not&nbsp;enabled.&nbsp;Network&nbsp;protocols</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4004017">//&nbsp;that&nbsp;do&nbsp;not&nbsp;support&nbsp;keep-alives&nbsp;ignore&nbsp;this&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4004072">KeepAlive</span>&nbsp;<span class="ident" id="4004082">time</span><span class="op" id="4004086">.</span><span class="ident" id="4004087">Duration</span><br>
<span class="lineno"></span><span class="op" id="4004096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="4004099">//&nbsp;Return&nbsp;either&nbsp;now+Timeout&nbsp;or&nbsp;Deadline,&nbsp;whichever&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="4004164">//&nbsp;Or&nbsp;zero,&nbsp;if&nbsp;neither&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="4004195">func</span>&nbsp;<span class="op" id="4004200">(</span><span class="ident" id="4004201">d</span>&nbsp;<span class="op" id="4004203">*</span><span class="ident" id="4004204">Dialer</span><span class="op" id="4004210">)</span>&nbsp;<span class="ident" id="4004212">deadline</span><span class="op" id="4004220">(</span><span class="op" id="4004221">)</span>&nbsp;<span class="ident" id="4004223">time</span><span class="op" id="4004227">.</span><span class="ident" id="4004228">Time</span>&nbsp;<span class="op" id="4004233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004236">if</span>&nbsp;<span class="ident" id="4004239">d</span><span class="op" id="4004240">.</span><span class="ident" id="4004241">Timeout</span>&nbsp;<span class="op" id="4004249">==</span>&nbsp;<span class="num" id="4004252">0</span>&nbsp;<span class="op" id="4004254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004258">return</span>&nbsp;<span class="ident" id="4004265">d</span><span class="op" id="4004266">.</span><span class="ident" id="4004267">Deadline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4004277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4004280">timeoutDeadline</span>&nbsp;<span class="op" id="4004296">:=</span>&nbsp;<span class="ident" id="4004299">time</span><span class="op" id="4004303">.</span><span class="ident" id="4004304">Now</span><span class="op" id="4004307">(</span><span class="op" id="4004308">)</span><span class="op" id="4004309">.</span><span class="ident" id="4004310">Add</span><span class="op" id="4004313">(</span><span class="ident" id="4004314">d</span><span class="op" id="4004315">.</span><span class="ident" id="4004316">Timeout</span><span class="op" id="4004323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004326">if</span>&nbsp;<span class="ident" id="4004329">d</span><span class="op" id="4004330">.</span><span class="ident" id="4004331">Deadline</span><span class="op" id="4004339">.</span><span class="ident" id="4004340">IsZero</span><span class="op" id="4004346">(</span><span class="op" id="4004347">)</span>&nbsp;<span class="op" id="4004349">||</span>&nbsp;<span class="ident" id="4004352">timeoutDeadline</span><span class="op" id="4004367">.</span><span class="ident" id="4004368">Before</span><span class="op" id="4004374">(</span><span class="ident" id="4004375">d</span><span class="op" id="4004376">.</span><span class="ident" id="4004377">Deadline</span><span class="op" id="4004385">)</span>&nbsp;<span class="op" id="4004387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004391">return</span>&nbsp;<span class="ident" id="4004398">timeoutDeadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4004415">}</span>&nbsp;<span class="keyword" id="4004417">else</span>&nbsp;<span class="op" id="4004422">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004426">return</span>&nbsp;<span class="ident" id="4004433">d</span><span class="op" id="4004434">.</span><span class="ident" id="4004435">Deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4004445">}</span><br>
<span class="lineno"></span><span class="op" id="4004447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4004450">func</span>&nbsp;<span class="ident" id="4004455">parseNetwork</span><span class="op" id="4004467">(</span><span class="ident" id="4004468">net</span>&nbsp;<span class="builtintype" id="4004472">string</span><span class="op" id="4004478">)</span>&nbsp;<span class="op" id="4004480">(</span><span class="ident" id="4004481">afnet</span>&nbsp;<span class="builtintype" id="4004487">string</span><span class="op" id="4004493">,</span>&nbsp;<span class="ident" id="4004495">proto</span>&nbsp;<span class="builtintype" id="4004501">int</span><span class="op" id="4004504">,</span>&nbsp;<span class="ident" id="4004506">err</span>&nbsp;<span class="builtintype" id="4004510">error</span><span class="op" id="4004515">)</span>&nbsp;<span class="op" id="4004517">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4004520">i</span>&nbsp;<span class="op" id="4004522">:=</span>&nbsp;<span class="ident" id="4004525">last</span><span class="op" id="4004529">(</span><span class="ident" id="4004530">net</span><span class="op" id="4004533">,</span>&nbsp;<span class="string" id="4004535">&#39;:&#39;</span><span class="op" id="4004538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004541">if</span>&nbsp;<span class="ident" id="4004544">i</span>&nbsp;<span class="op" id="4004546">&lt;</span>&nbsp;<span class="num" id="4004548">0</span>&nbsp;<span class="op" id="4004550">{</span>&nbsp;<span class="comment" id="4004552">//&nbsp;no&nbsp;colon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004566">switch</span>&nbsp;<span class="ident" id="4004573">net</span>&nbsp;<span class="op" id="4004577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004581">case</span>&nbsp;<span class="string" id="4004586">&#34;tcp&#34;</span><span class="op" id="4004591">,</span>&nbsp;<span class="string" id="4004593">&#34;tcp4&#34;</span><span class="op" id="4004599">,</span>&nbsp;<span class="string" id="4004601">&#34;tcp6&#34;</span><span class="op" id="4004607">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004611">case</span>&nbsp;<span class="string" id="4004616">&#34;udp&#34;</span><span class="op" id="4004621">,</span>&nbsp;<span class="string" id="4004623">&#34;udp4&#34;</span><span class="op" id="4004629">,</span>&nbsp;<span class="string" id="4004631">&#34;udp6&#34;</span><span class="op" id="4004637">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004641">case</span>&nbsp;<span class="string" id="4004646">&#34;ip&#34;</span><span class="op" id="4004650">,</span>&nbsp;<span class="string" id="4004652">&#34;ip4&#34;</span><span class="op" id="4004657">,</span>&nbsp;<span class="string" id="4004659">&#34;ip6&#34;</span><span class="op" id="4004664">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004668">case</span>&nbsp;<span class="string" id="4004673">&#34;unix&#34;</span><span class="op" id="4004679">,</span>&nbsp;<span class="string" id="4004681">&#34;unixgram&#34;</span><span class="op" id="4004691">,</span>&nbsp;<span class="string" id="4004693">&#34;unixpacket&#34;</span><span class="op" id="4004705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004709">default</span><span class="op" id="4004716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004721">return</span>&nbsp;<span class="string" id="4004728">&#34;&#34;</span><span class="op" id="4004730">,</span>&nbsp;<span class="num" id="4004732">0</span><span class="op" id="4004733">,</span>&nbsp;<span class="ident" id="4004735">UnknownNetworkError</span><span class="op" id="4004754">(</span><span class="ident" id="4004755">net</span><span class="op" id="4004758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4004762">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004766">return</span>&nbsp;<span class="ident" id="4004773">net</span><span class="op" id="4004776">,</span>&nbsp;<span class="num" id="4004778">0</span><span class="op" id="4004779">,</span>&nbsp;<span class="ident" id="4004781">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4004786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4004789">afnet</span>&nbsp;<span class="op" id="4004795">=</span>&nbsp;<span class="ident" id="4004797">net</span><span class="op" id="4004800">[</span><span class="op" id="4004801">:</span><span class="ident" id="4004802">i</span><span class="op" id="4004803">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004806">switch</span>&nbsp;<span class="ident" id="4004813">afnet</span>&nbsp;<span class="op" id="4004819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004822">case</span>&nbsp;<span class="string" id="4004827">&#34;ip&#34;</span><span class="op" id="4004831">,</span>&nbsp;<span class="string" id="4004833">&#34;ip4&#34;</span><span class="op" id="4004838">,</span>&nbsp;<span class="string" id="4004840">&#34;ip6&#34;</span><span class="op" id="4004845">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4004849">protostr</span>&nbsp;<span class="op" id="4004858">:=</span>&nbsp;<span class="ident" id="4004861">net</span><span class="op" id="4004864">[</span><span class="ident" id="4004865">i</span><span class="op" id="4004866">+</span><span class="num" id="4004867">1</span><span class="op" id="4004868">:</span><span class="op" id="4004869">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4004873">proto</span><span class="op" id="4004878">,</span>&nbsp;<span class="ident" id="4004880">i</span><span class="op" id="4004881">,</span>&nbsp;<span class="ident" id="4004883">ok</span>&nbsp;<span class="op" id="4004886">:=</span>&nbsp;<span class="ident" id="4004889">dtoi</span><span class="op" id="4004893">(</span><span class="ident" id="4004894">protostr</span><span class="op" id="4004902">,</span>&nbsp;<span class="num" id="4004904">0</span><span class="op" id="4004905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004909">if</span>&nbsp;<span class="op" id="4004912">!</span><span class="ident" id="4004913">ok</span>&nbsp;<span class="op" id="4004916">||</span>&nbsp;<span class="ident" id="4004919">i</span>&nbsp;<span class="op" id="4004921">!=</span>&nbsp;<span class="builtinfunc" id="4004924">len</span><span class="op" id="4004927">(</span><span class="ident" id="4004928">protostr</span><span class="op" id="4004936">)</span>&nbsp;<span class="op" id="4004938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4004943">proto</span><span class="op" id="4004948">,</span>&nbsp;<span class="ident" id="4004950">err</span>&nbsp;<span class="op" id="4004954">=</span>&nbsp;<span class="ident" id="4004956">lookupProtocol</span><span class="op" id="4004970">(</span><span class="ident" id="4004971">protostr</span><span class="op" id="4004979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4004984">if</span>&nbsp;<span class="ident" id="4004987">err</span>&nbsp;<span class="op" id="4004991">!=</span>&nbsp;<span class="ident" id="4004994">nil</span>&nbsp;<span class="op" id="4004998">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005004">return</span>&nbsp;<span class="string" id="4005011">&#34;&#34;</span><span class="op" id="4005013">,</span>&nbsp;<span class="num" id="4005015">0</span><span class="op" id="4005016">,</span>&nbsp;<span class="ident" id="4005018">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4005025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4005029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005033">return</span>&nbsp;<span class="ident" id="4005040">afnet</span><span class="op" id="4005045">,</span>&nbsp;<span class="ident" id="4005047">proto</span><span class="op" id="4005052">,</span>&nbsp;<span class="ident" id="4005054">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4005059">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005062">return</span>&nbsp;<span class="string" id="4005069">&#34;&#34;</span><span class="op" id="4005071">,</span>&nbsp;<span class="num" id="4005073">0</span><span class="op" id="4005074">,</span>&nbsp;<span class="ident" id="4005076">UnknownNetworkError</span><span class="op" id="4005095">(</span><span class="ident" id="4005096">net</span><span class="op" id="4005099">)</span><br>
<span class="lineno"></span><span class="op" id="4005101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4005104">func</span>&nbsp;<span class="ident" id="4005109">resolveAddr</span><span class="op" id="4005120">(</span><span class="ident" id="4005121">op</span><span class="op" id="4005123">,</span>&nbsp;<span class="ident" id="4005125">net</span><span class="op" id="4005128">,</span>&nbsp;<span class="ident" id="4005130">addr</span>&nbsp;<span class="builtintype" id="4005135">string</span><span class="op" id="4005141">,</span>&nbsp;<span class="ident" id="4005143">deadline</span>&nbsp;<span class="ident" id="4005152">time</span><span class="op" id="4005156">.</span><span class="ident" id="4005157">Time</span><span class="op" id="4005161">)</span>&nbsp;<span class="op" id="4005163">(</span><span class="ident" id="4005164">netaddr</span><span class="op" id="4005171">,</span>&nbsp;<span class="builtintype" id="4005173">error</span><span class="op" id="4005178">)</span>&nbsp;<span class="op" id="4005180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4005183">afnet</span><span class="op" id="4005188">,</span>&nbsp;<span class="ident" id="4005190">_</span><span class="op" id="4005191">,</span>&nbsp;<span class="ident" id="4005193">err</span>&nbsp;<span class="op" id="4005197">:=</span>&nbsp;<span class="ident" id="4005200">parseNetwork</span><span class="op" id="4005212">(</span><span class="ident" id="4005213">net</span><span class="op" id="4005216">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005219">if</span>&nbsp;<span class="ident" id="4005222">err</span>&nbsp;<span class="op" id="4005226">!=</span>&nbsp;<span class="ident" id="4005229">nil</span>&nbsp;<span class="op" id="4005233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005237">return</span>&nbsp;<span class="ident" id="4005244">nil</span><span class="op" id="4005247">,</span>&nbsp;<span class="ident" id="4005249">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4005254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005257">if</span>&nbsp;<span class="ident" id="4005260">op</span>&nbsp;<span class="op" id="4005263">==</span>&nbsp;<span class="string" id="4005266">&#34;dial&#34;</span>&nbsp;<span class="op" id="4005273">&amp;&amp;</span>&nbsp;<span class="ident" id="4005276">addr</span>&nbsp;<span class="op" id="4005281">==</span>&nbsp;<span class="string" id="4005284">&#34;&#34;</span>&nbsp;<span class="op" id="4005287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005291">return</span>&nbsp;<span class="ident" id="4005298">nil</span><span class="op" id="4005301">,</span>&nbsp;<span class="ident" id="4005303">errMissingAddress</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4005322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005325">switch</span>&nbsp;<span class="ident" id="4005332">afnet</span>&nbsp;<span class="op" id="4005338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005341">case</span>&nbsp;<span class="string" id="4005346">&#34;unix&#34;</span><span class="op" id="4005352">,</span>&nbsp;<span class="string" id="4005354">&#34;unixgram&#34;</span><span class="op" id="4005364">,</span>&nbsp;<span class="string" id="4005366">&#34;unixpacket&#34;</span><span class="op" id="4005378">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005382">return</span>&nbsp;<span class="ident" id="4005389">ResolveUnixAddr</span><span class="op" id="4005404">(</span><span class="ident" id="4005405">afnet</span><span class="op" id="4005410">,</span>&nbsp;<span class="ident" id="4005412">addr</span><span class="op" id="4005416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4005419">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4005422">return</span>&nbsp;<span class="ident" id="4005429">resolveInternetAddr</span><span class="op" id="4005448">(</span><span class="ident" id="4005449">afnet</span><span class="op" id="4005454">,</span>&nbsp;<span class="ident" id="4005456">addr</span><span class="op" id="4005460">,</span>&nbsp;<span class="ident" id="4005462">deadline</span><span class="op" id="4005470">)</span><br>
<span class="lineno"></span><span class="op" id="4005472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4005475">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="4005529">//</span><br>
<span class="lineno">115</span><span class="comment" id="4005532">//&nbsp;Known&nbsp;networks&nbsp;are&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;tcp6&#34;&nbsp;(IPv6-only),</span><br>
<span class="lineno"></span><span class="comment" id="4005601">//&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;udp6&#34;&nbsp;(IPv6-only),&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4005663">//&nbsp;(IPv4-only),&nbsp;&#34;ip6&#34;&nbsp;(IPv6-only),&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4005721">//&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4005738">//</span><br>
<span class="lineno">120</span><span class="comment" id="4005741">//&nbsp;For&nbsp;TCP&nbsp;and&nbsp;UDP&nbsp;networks,&nbsp;addresses&nbsp;have&nbsp;the&nbsp;form&nbsp;host:port.</span><br>
<span class="lineno"></span><span class="comment" id="4005805">//&nbsp;If&nbsp;host&nbsp;is&nbsp;a&nbsp;literal&nbsp;IPv6&nbsp;address&nbsp;it&nbsp;must&nbsp;be&nbsp;enclosed</span><br>
<span class="lineno"></span><span class="comment" id="4005862">//&nbsp;in&nbsp;square&nbsp;brackets&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4005927">//&nbsp;The&nbsp;functions&nbsp;JoinHostPort&nbsp;and&nbsp;SplitHostPort&nbsp;manipulate&nbsp;addresses</span><br>
<span class="lineno"></span><span class="comment" id="4005996">//&nbsp;in&nbsp;this&nbsp;form.</span><br>
<span class="lineno">125</span><span class="comment" id="4006013">//</span><br>
<span class="lineno"></span><span class="comment" id="4006016">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="4006029">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;12.34.56.78:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="4006062">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;google.com:http&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="4006096">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[2001:db8::1]:http&#34;)</span><br>
<span class="lineno">130</span><span class="comment" id="4006133">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[fe80::1%lo0]:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="4006168">//</span><br>
<span class="lineno"></span><span class="comment" id="4006171">//&nbsp;For&nbsp;IP&nbsp;networks,&nbsp;the&nbsp;network&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="4006241">//&nbsp;by&nbsp;a&nbsp;colon&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name&nbsp;and&nbsp;the&nbsp;addr&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4006308">//&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="4006331">//</span><br>
<span class="lineno"></span><span class="comment" id="4006334">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="4006347">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip4:1&#34;,&nbsp;&#34;127.0.0.1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="4006377">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip6:ospf&#34;,&nbsp;&#34;::1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="4006404">//</span><br>
<span class="lineno">140</span><span class="comment" id="4006407">//&nbsp;For&nbsp;Unix&nbsp;networks,&nbsp;the&nbsp;address&nbsp;must&nbsp;be&nbsp;a&nbsp;file&nbsp;system&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="4006469">func</span>&nbsp;<span class="ident" id="4006474">Dial</span><span class="op" id="4006478">(</span><span class="ident" id="4006479">network</span><span class="op" id="4006486">,</span>&nbsp;<span class="ident" id="4006488">address</span>&nbsp;<span class="builtintype" id="4006496">string</span><span class="op" id="4006502">)</span>&nbsp;<span class="op" id="4006504">(</span><span class="ident" id="4006505">Conn</span><span class="op" id="4006509">,</span>&nbsp;<span class="builtintype" id="4006511">error</span><span class="op" id="4006516">)</span>&nbsp;<span class="op" id="4006518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4006521">var</span>&nbsp;<span class="ident" id="4006525">d</span>&nbsp;<span class="ident" id="4006527">Dialer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4006535">return</span>&nbsp;<span class="ident" id="4006542">d</span><span class="op" id="4006543">.</span><span class="ident" id="4006544">Dial</span><span class="op" id="4006548">(</span><span class="ident" id="4006549">network</span><span class="op" id="4006556">,</span>&nbsp;<span class="ident" id="4006558">address</span><span class="op" id="4006565">)</span><br>
<span class="lineno"></span><span class="op" id="4006567">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="4006570">//&nbsp;DialTimeout&nbsp;acts&nbsp;like&nbsp;Dial&nbsp;but&nbsp;takes&nbsp;a&nbsp;timeout.</span><br>
<span class="lineno"></span><span class="comment" id="4006621">//&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;name&nbsp;resolution,&nbsp;if&nbsp;required.</span><br>
<span class="lineno"></span><span class="keyword" id="4006675">func</span>&nbsp;<span class="ident" id="4006680">DialTimeout</span><span class="op" id="4006691">(</span><span class="ident" id="4006692">network</span><span class="op" id="4006699">,</span>&nbsp;<span class="ident" id="4006701">address</span>&nbsp;<span class="builtintype" id="4006709">string</span><span class="op" id="4006715">,</span>&nbsp;<span class="ident" id="4006717">timeout</span>&nbsp;<span class="ident" id="4006725">time</span><span class="op" id="4006729">.</span><span class="ident" id="4006730">Duration</span><span class="op" id="4006738">)</span>&nbsp;<span class="op" id="4006740">(</span><span class="ident" id="4006741">Conn</span><span class="op" id="4006745">,</span>&nbsp;<span class="builtintype" id="4006747">error</span><span class="op" id="4006752">)</span>&nbsp;<span class="op" id="4006754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4006757">d</span>&nbsp;<span class="op" id="4006759">:=</span>&nbsp;<span class="ident" id="4006762">Dialer</span><span class="op" id="4006768">{</span><span class="ident" id="4006769">Timeout</span><span class="op" id="4006776">:</span>&nbsp;<span class="ident" id="4006778">timeout</span><span class="op" id="4006785">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4006788">return</span>&nbsp;<span class="ident" id="4006795">d</span><span class="op" id="4006796">.</span><span class="ident" id="4006797">Dial</span><span class="op" id="4006801">(</span><span class="ident" id="4006802">network</span><span class="op" id="4006809">,</span>&nbsp;<span class="ident" id="4006811">address</span><span class="op" id="4006818">)</span><br>
<span class="lineno"></span><span class="op" id="4006820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4006823">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="4006877">//</span><br>
<span class="lineno">155</span><span class="comment" id="4006880">//&nbsp;See&nbsp;func&nbsp;Dial&nbsp;for&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;network&nbsp;and&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="4006942">//&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="4006957">func</span>&nbsp;<span class="op" id="4006962">(</span><span class="ident" id="4006963">d</span>&nbsp;<span class="op" id="4006965">*</span><span class="ident" id="4006966">Dialer</span><span class="op" id="4006972">)</span>&nbsp;<span class="ident" id="4006974">Dial</span><span class="op" id="4006978">(</span><span class="ident" id="4006979">network</span><span class="op" id="4006986">,</span>&nbsp;<span class="ident" id="4006988">address</span>&nbsp;<span class="builtintype" id="4006996">string</span><span class="op" id="4007002">)</span>&nbsp;<span class="op" id="4007004">(</span><span class="ident" id="4007005">Conn</span><span class="op" id="4007009">,</span>&nbsp;<span class="builtintype" id="4007011">error</span><span class="op" id="4007016">)</span>&nbsp;<span class="op" id="4007018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007021">ra</span><span class="op" id="4007023">,</span>&nbsp;<span class="ident" id="4007025">err</span>&nbsp;<span class="op" id="4007029">:=</span>&nbsp;<span class="ident" id="4007032">resolveAddr</span><span class="op" id="4007043">(</span><span class="string" id="4007044">&#34;dial&#34;</span><span class="op" id="4007050">,</span>&nbsp;<span class="ident" id="4007052">network</span><span class="op" id="4007059">,</span>&nbsp;<span class="ident" id="4007061">address</span><span class="op" id="4007068">,</span>&nbsp;<span class="ident" id="4007070">d</span><span class="op" id="4007071">.</span><span class="ident" id="4007072">deadline</span><span class="op" id="4007080">(</span><span class="op" id="4007081">)</span><span class="op" id="4007082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4007085">if</span>&nbsp;<span class="ident" id="4007088">err</span>&nbsp;<span class="op" id="4007092">!=</span>&nbsp;<span class="ident" id="4007095">nil</span>&nbsp;<span class="op" id="4007099">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4007103">return</span>&nbsp;<span class="ident" id="4007110">nil</span><span class="op" id="4007113">,</span>&nbsp;<span class="op" id="4007115">&amp;</span><span class="ident" id="4007116">OpError</span><span class="op" id="4007123">{</span><span class="ident" id="4007124">Op</span><span class="op" id="4007126">:</span>&nbsp;<span class="string" id="4007128">&#34;dial&#34;</span><span class="op" id="4007134">,</span>&nbsp;<span class="ident" id="4007136">Net</span><span class="op" id="4007139">:</span>&nbsp;<span class="ident" id="4007141">network</span><span class="op" id="4007148">,</span>&nbsp;<span class="ident" id="4007150">Addr</span><span class="op" id="4007154">:</span>&nbsp;<span class="ident" id="4007156">nil</span><span class="op" id="4007159">,</span>&nbsp;<span class="ident" id="4007161">Err</span><span class="op" id="4007164">:</span>&nbsp;<span class="ident" id="4007166">err</span><span class="op" id="4007169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4007172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007175">dialer</span>&nbsp;<span class="op" id="4007182">:=</span>&nbsp;<span class="keyword" id="4007185">func</span><span class="op" id="4007189">(</span><span class="ident" id="4007190">deadline</span>&nbsp;<span class="ident" id="4007199">time</span><span class="op" id="4007203">.</span><span class="ident" id="4007204">Time</span><span class="op" id="4007208">)</span>&nbsp;<span class="op" id="4007210">(</span><span class="ident" id="4007211">Conn</span><span class="op" id="4007215">,</span>&nbsp;<span class="builtintype" id="4007217">error</span><span class="op" id="4007222">)</span>&nbsp;<span class="op" id="4007224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4007228">return</span>&nbsp;<span class="ident" id="4007235">dialSingle</span><span class="op" id="4007245">(</span><span class="ident" id="4007246">network</span><span class="op" id="4007253">,</span>&nbsp;<span class="ident" id="4007255">address</span><span class="op" id="4007262">,</span>&nbsp;<span class="ident" id="4007264">d</span><span class="op" id="4007265">.</span><span class="ident" id="4007266">LocalAddr</span><span class="op" id="4007275">,</span>&nbsp;<span class="ident" id="4007277">ra</span><span class="op" id="4007279">.</span><span class="ident" id="4007280">toAddr</span><span class="op" id="4007286">(</span><span class="op" id="4007287">)</span><span class="op" id="4007288">,</span>&nbsp;<span class="ident" id="4007290">deadline</span><span class="op" id="4007298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4007301">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4007304">if</span>&nbsp;<span class="ident" id="4007307">ras</span><span class="op" id="4007310">,</span>&nbsp;<span class="ident" id="4007312">ok</span>&nbsp;<span class="op" id="4007315">:=</span>&nbsp;<span class="ident" id="4007318">ra</span><span class="op" id="4007320">.</span><span class="op" id="4007321">(</span><span class="ident" id="4007322">addrList</span><span class="op" id="4007330">)</span><span class="op" id="4007331">;</span>&nbsp;<span class="ident" id="4007333">ok</span>&nbsp;<span class="op" id="4007336">&amp;&amp;</span>&nbsp;<span class="ident" id="4007339">d</span><span class="op" id="4007340">.</span><span class="ident" id="4007341">DualStack</span>&nbsp;<span class="op" id="4007351">&amp;&amp;</span>&nbsp;<span class="ident" id="4007354">network</span>&nbsp;<span class="op" id="4007362">==</span>&nbsp;<span class="string" id="4007365">&#34;tcp&#34;</span>&nbsp;<span class="op" id="4007371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007375">dialer</span>&nbsp;<span class="op" id="4007382">=</span>&nbsp;<span class="keyword" id="4007384">func</span><span class="op" id="4007388">(</span><span class="ident" id="4007389">deadline</span>&nbsp;<span class="ident" id="4007398">time</span><span class="op" id="4007402">.</span><span class="ident" id="4007403">Time</span><span class="op" id="4007407">)</span>&nbsp;<span class="op" id="4007409">(</span><span class="ident" id="4007410">Conn</span><span class="op" id="4007414">,</span>&nbsp;<span class="builtintype" id="4007416">error</span><span class="op" id="4007421">)</span>&nbsp;<span class="op" id="4007423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4007428">return</span>&nbsp;<span class="ident" id="4007435">dialMulti</span><span class="op" id="4007444">(</span><span class="ident" id="4007445">network</span><span class="op" id="4007452">,</span>&nbsp;<span class="ident" id="4007454">address</span><span class="op" id="4007461">,</span>&nbsp;<span class="ident" id="4007463">d</span><span class="op" id="4007464">.</span><span class="ident" id="4007465">LocalAddr</span><span class="op" id="4007474">,</span>&nbsp;<span class="ident" id="4007476">ras</span><span class="op" id="4007479">,</span>&nbsp;<span class="ident" id="4007481">deadline</span><span class="op" id="4007489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4007493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4007496">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007499">c</span><span class="op" id="4007500">,</span>&nbsp;<span class="ident" id="4007502">err</span>&nbsp;<span class="op" id="4007506">:=</span>&nbsp;<span class="ident" id="4007509">dial</span><span class="op" id="4007513">(</span><span class="ident" id="4007514">network</span><span class="op" id="4007521">,</span>&nbsp;<span class="ident" id="4007523">ra</span><span class="op" id="4007525">.</span><span class="ident" id="4007526">toAddr</span><span class="op" id="4007532">(</span><span class="op" id="4007533">)</span><span class="op" id="4007534">,</span>&nbsp;<span class="ident" id="4007536">dialer</span><span class="op" id="4007542">,</span>&nbsp;<span class="ident" id="4007544">d</span><span class="op" id="4007545">.</span><span class="ident" id="4007546">deadline</span><span class="op" id="4007554">(</span><span class="op" id="4007555">)</span><span class="op" id="4007556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4007559">if</span>&nbsp;<span class="ident" id="4007562">d</span><span class="op" id="4007563">.</span><span class="ident" id="4007564">KeepAlive</span>&nbsp;<span class="op" id="4007574">&gt;</span>&nbsp;<span class="num" id="4007576">0</span>&nbsp;<span class="op" id="4007578">&amp;&amp;</span>&nbsp;<span class="ident" id="4007581">err</span>&nbsp;<span class="op" id="4007585">==</span>&nbsp;<span class="ident" id="4007588">nil</span>&nbsp;<span class="op" id="4007592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4007596">if</span>&nbsp;<span class="ident" id="4007599">tc</span><span class="op" id="4007601">,</span>&nbsp;<span class="ident" id="4007603">ok</span>&nbsp;<span class="op" id="4007606">:=</span>&nbsp;<span class="ident" id="4007609">c</span><span class="op" id="4007610">.</span><span class="op" id="4007611">(</span><span class="op" id="4007612">*</span><span class="ident" id="4007613">TCPConn</span><span class="op" id="4007620">)</span><span class="op" id="4007621">;</span>&nbsp;<span class="ident" id="4007623">ok</span>&nbsp;<span class="op" id="4007626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007631">tc</span><span class="op" id="4007633">.</span><span class="ident" id="4007634">SetKeepAlive</span><span class="op" id="4007646">(</span><span class="builtintype" id="4007647">true</span><span class="op" id="4007651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007656">tc</span><span class="op" id="4007658">.</span><span class="ident" id="4007659">SetKeepAlivePeriod</span><span class="op" id="4007677">(</span><span class="ident" id="4007678">d</span><span class="op" id="4007679">.</span><span class="ident" id="4007680">KeepAlive</span><span class="op" id="4007689">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4007694">testHookSetKeepAlive</span><span class="op" id="4007714">(</span><span class="op" id="4007715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4007719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4007722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4007725">return</span>&nbsp;<span class="ident" id="4007732">c</span><span class="op" id="4007733">,</span>&nbsp;<span class="ident" id="4007735">err</span><br>
<span class="lineno"></span><span class="op" id="4007739">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="4007742">var</span>&nbsp;<span class="ident" id="4007746">testHookSetKeepAlive</span>&nbsp;<span class="op" id="4007767">=</span>&nbsp;<span class="keyword" id="4007769">func</span><span class="op" id="4007773">(</span><span class="op" id="4007774">)</span>&nbsp;<span class="op" id="4007776">{</span><span class="op" id="4007777">}</span>&nbsp;<span class="comment" id="4007779">//&nbsp;changed&nbsp;by&nbsp;dial_test.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4007807">//&nbsp;dialMulti&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;connections&nbsp;to&nbsp;each&nbsp;destination&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4007877">//&nbsp;the&nbsp;list&nbsp;of&nbsp;addresses.&nbsp;It&nbsp;will&nbsp;return&nbsp;the&nbsp;first&nbsp;established</span><br>
<span class="lineno">185</span><span class="comment" id="4007940">//&nbsp;connection&nbsp;and&nbsp;close&nbsp;the&nbsp;other&nbsp;connections.&nbsp;Otherwise&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4008008">//&nbsp;error&nbsp;on&nbsp;the&nbsp;last&nbsp;attempt.</span><br>
<span class="lineno"></span><span class="keyword" id="4008038">func</span>&nbsp;<span class="ident" id="4008043">dialMulti</span><span class="op" id="4008052">(</span><span class="ident" id="4008053">net</span><span class="op" id="4008056">,</span>&nbsp;<span class="ident" id="4008058">addr</span>&nbsp;<span class="builtintype" id="4008063">string</span><span class="op" id="4008069">,</span>&nbsp;<span class="ident" id="4008071">la</span>&nbsp;<span class="ident" id="4008074">Addr</span><span class="op" id="4008078">,</span>&nbsp;<span class="ident" id="4008080">ras</span>&nbsp;<span class="ident" id="4008084">addrList</span><span class="op" id="4008092">,</span>&nbsp;<span class="ident" id="4008094">deadline</span>&nbsp;<span class="ident" id="4008103">time</span><span class="op" id="4008107">.</span><span class="ident" id="4008108">Time</span><span class="op" id="4008112">)</span>&nbsp;<span class="op" id="4008114">(</span><span class="ident" id="4008115">Conn</span><span class="op" id="4008119">,</span>&nbsp;<span class="builtintype" id="4008121">error</span><span class="op" id="4008126">)</span>&nbsp;<span class="op" id="4008128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008131">type</span>&nbsp;<span class="ident" id="4008136">racer</span>&nbsp;<span class="keyword" id="4008142">struct</span>&nbsp;<span class="op" id="4008149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008153">Conn</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4008160">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4008167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4008170">//&nbsp;Sig&nbsp;controls&nbsp;the&nbsp;flow&nbsp;of&nbsp;dial&nbsp;results&nbsp;on&nbsp;lane.&nbsp;It&nbsp;passes&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4008233">//&nbsp;token&nbsp;to&nbsp;the&nbsp;next&nbsp;racer&nbsp;and&nbsp;also&nbsp;indicates&nbsp;the&nbsp;end&nbsp;of&nbsp;flow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4008296">//&nbsp;by&nbsp;using&nbsp;closed&nbsp;channel.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008325">sig</span>&nbsp;<span class="op" id="4008329">:=</span>&nbsp;<span class="builtinfunc" id="4008332">make</span><span class="op" id="4008336">(</span><span class="keyword" id="4008337">chan</span>&nbsp;<span class="builtintype" id="4008342">bool</span><span class="op" id="4008346">,</span>&nbsp;<span class="num" id="4008348">1</span><span class="op" id="4008349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008352">lane</span>&nbsp;<span class="op" id="4008357">:=</span>&nbsp;<span class="builtinfunc" id="4008360">make</span><span class="op" id="4008364">(</span><span class="keyword" id="4008365">chan</span>&nbsp;<span class="ident" id="4008370">racer</span><span class="op" id="4008375">,</span>&nbsp;<span class="num" id="4008377">1</span><span class="op" id="4008378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008381">for</span>&nbsp;<span class="ident" id="4008385">_</span><span class="op" id="4008386">,</span>&nbsp;<span class="ident" id="4008388">ra</span>&nbsp;<span class="op" id="4008391">:=</span>&nbsp;<span class="keyword" id="4008394">range</span>&nbsp;<span class="ident" id="4008400">ras</span>&nbsp;<span class="op" id="4008404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008408">go</span>&nbsp;<span class="keyword" id="4008411">func</span><span class="op" id="4008415">(</span><span class="ident" id="4008416">ra</span>&nbsp;<span class="ident" id="4008419">Addr</span><span class="op" id="4008423">)</span>&nbsp;<span class="op" id="4008425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008430">c</span><span class="op" id="4008431">,</span>&nbsp;<span class="ident" id="4008433">err</span>&nbsp;<span class="op" id="4008437">:=</span>&nbsp;<span class="ident" id="4008440">dialSingle</span><span class="op" id="4008450">(</span><span class="ident" id="4008451">net</span><span class="op" id="4008454">,</span>&nbsp;<span class="ident" id="4008456">addr</span><span class="op" id="4008460">,</span>&nbsp;<span class="ident" id="4008462">la</span><span class="op" id="4008464">,</span>&nbsp;<span class="ident" id="4008466">ra</span><span class="op" id="4008468">,</span>&nbsp;<span class="ident" id="4008470">deadline</span><span class="op" id="4008478">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008483">if</span>&nbsp;<span class="ident" id="4008486">_</span><span class="op" id="4008487">,</span>&nbsp;<span class="ident" id="4008489">ok</span>&nbsp;<span class="op" id="4008492">:=</span>&nbsp;<span class="op" id="4008495">&lt;-</span><span class="ident" id="4008497">sig</span><span class="op" id="4008500">;</span>&nbsp;<span class="ident" id="4008502">ok</span>&nbsp;<span class="op" id="4008505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008511">lane</span>&nbsp;<span class="op" id="4008516">&lt;-</span>&nbsp;<span class="ident" id="4008519">racer</span><span class="op" id="4008524">{</span><span class="ident" id="4008525">c</span><span class="op" id="4008526">,</span>&nbsp;<span class="ident" id="4008528">err</span><span class="op" id="4008531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4008536">}</span>&nbsp;<span class="keyword" id="4008538">else</span>&nbsp;<span class="keyword" id="4008543">if</span>&nbsp;<span class="ident" id="4008546">err</span>&nbsp;<span class="op" id="4008550">==</span>&nbsp;<span class="ident" id="4008553">nil</span>&nbsp;<span class="op" id="4008557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4008563">//&nbsp;We&nbsp;have&nbsp;to&nbsp;return&nbsp;the&nbsp;resources</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4008602">//&nbsp;that&nbsp;belong&nbsp;to&nbsp;the&nbsp;other</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4008634">//&nbsp;connections&nbsp;here&nbsp;for&nbsp;avoiding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4008671">//&nbsp;unnecessary&nbsp;resource&nbsp;starvation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008711">c</span><span class="op" id="4008712">.</span><span class="ident" id="4008713">Close</span><span class="op" id="4008718">(</span><span class="op" id="4008719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4008724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4008728">}</span><span class="op" id="4008729">(</span><span class="ident" id="4008730">ra</span><span class="op" id="4008732">.</span><span class="ident" id="4008733">toAddr</span><span class="op" id="4008739">(</span><span class="op" id="4008740">)</span><span class="op" id="4008741">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4008744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008747">defer</span>&nbsp;<span class="builtinfunc" id="4008753">close</span><span class="op" id="4008758">(</span><span class="ident" id="4008759">sig</span><span class="op" id="4008762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008765">lastErr</span>&nbsp;<span class="op" id="4008773">:=</span>&nbsp;<span class="ident" id="4008776">errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008788">nracers</span>&nbsp;<span class="op" id="4008796">:=</span>&nbsp;<span class="builtinfunc" id="4008799">len</span><span class="op" id="4008802">(</span><span class="ident" id="4008803">ras</span><span class="op" id="4008806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008809">for</span>&nbsp;<span class="ident" id="4008813">nracers</span>&nbsp;<span class="op" id="4008821">&gt;</span>&nbsp;<span class="num" id="4008823">0</span>&nbsp;<span class="op" id="4008825">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008829">sig</span>&nbsp;<span class="op" id="4008833">&lt;-</span>&nbsp;<span class="builtintype" id="4008836">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008843">racer</span>&nbsp;<span class="op" id="4008849">:=</span>&nbsp;<span class="op" id="4008852">&lt;-</span><span class="ident" id="4008854">lane</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008861">if</span>&nbsp;<span class="ident" id="4008864">racer</span><span class="op" id="4008869">.</span><span class="builtintype" id="4008870">error</span>&nbsp;<span class="op" id="4008876">==</span>&nbsp;<span class="ident" id="4008879">nil</span>&nbsp;<span class="op" id="4008883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008888">return</span>&nbsp;<span class="ident" id="4008895">racer</span><span class="op" id="4008900">.</span><span class="ident" id="4008901">Conn</span><span class="op" id="4008905">,</span>&nbsp;<span class="ident" id="4008907">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4008913">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008917">lastErr</span>&nbsp;<span class="op" id="4008925">=</span>&nbsp;<span class="ident" id="4008927">racer</span><span class="op" id="4008932">.</span><span class="builtintype" id="4008933">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4008941">nracers</span><span class="op" id="4008948">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4008952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4008955">return</span>&nbsp;<span class="ident" id="4008962">nil</span><span class="op" id="4008965">,</span>&nbsp;<span class="ident" id="4008967">lastErr</span><br>
<span class="lineno"></span><span class="op" id="4008975">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="4008978">//&nbsp;dialSingle&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;connection&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4009049">//&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="4009077">func</span>&nbsp;<span class="ident" id="4009082">dialSingle</span><span class="op" id="4009092">(</span><span class="ident" id="4009093">net</span><span class="op" id="4009096">,</span>&nbsp;<span class="ident" id="4009098">addr</span>&nbsp;<span class="builtintype" id="4009103">string</span><span class="op" id="4009109">,</span>&nbsp;<span class="ident" id="4009111">la</span><span class="op" id="4009113">,</span>&nbsp;<span class="ident" id="4009115">ra</span>&nbsp;<span class="ident" id="4009118">Addr</span><span class="op" id="4009122">,</span>&nbsp;<span class="ident" id="4009124">deadline</span>&nbsp;<span class="ident" id="4009133">time</span><span class="op" id="4009137">.</span><span class="ident" id="4009138">Time</span><span class="op" id="4009142">)</span>&nbsp;<span class="op" id="4009144">(</span><span class="ident" id="4009145">c</span>&nbsp;<span class="ident" id="4009147">Conn</span><span class="op" id="4009151">,</span>&nbsp;<span class="ident" id="4009153">err</span>&nbsp;<span class="builtintype" id="4009157">error</span><span class="op" id="4009162">)</span>&nbsp;<span class="op" id="4009164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009167">if</span>&nbsp;<span class="ident" id="4009170">la</span>&nbsp;<span class="op" id="4009173">!=</span>&nbsp;<span class="ident" id="4009176">nil</span>&nbsp;<span class="op" id="4009180">&amp;&amp;</span>&nbsp;<span class="ident" id="4009183">la</span><span class="op" id="4009185">.</span><span class="ident" id="4009186">Network</span><span class="op" id="4009193">(</span><span class="op" id="4009194">)</span>&nbsp;<span class="op" id="4009196">!=</span>&nbsp;<span class="ident" id="4009199">ra</span><span class="op" id="4009201">.</span><span class="ident" id="4009202">Network</span><span class="op" id="4009209">(</span><span class="op" id="4009210">)</span>&nbsp;<span class="op" id="4009212">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009216">return</span>&nbsp;<span class="ident" id="4009223">nil</span><span class="op" id="4009226">,</span>&nbsp;<span class="op" id="4009228">&amp;</span><span class="ident" id="4009229">OpError</span><span class="op" id="4009236">{</span><span class="ident" id="4009237">Op</span><span class="op" id="4009239">:</span>&nbsp;<span class="string" id="4009241">&#34;dial&#34;</span><span class="op" id="4009247">,</span>&nbsp;<span class="ident" id="4009249">Net</span><span class="op" id="4009252">:</span>&nbsp;<span class="ident" id="4009254">net</span><span class="op" id="4009257">,</span>&nbsp;<span class="ident" id="4009259">Addr</span><span class="op" id="4009263">:</span>&nbsp;<span class="ident" id="4009265">ra</span><span class="op" id="4009267">,</span>&nbsp;<span class="ident" id="4009269">Err</span><span class="op" id="4009272">:</span>&nbsp;<span class="ident" id="4009274">errors</span><span class="op" id="4009280">.</span><span class="ident" id="4009281">New</span><span class="op" id="4009284">(</span><span class="string" id="4009285">&#34;mismatched&nbsp;local&nbsp;address&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4009318">+</span>&nbsp;<span class="ident" id="4009320">la</span><span class="op" id="4009322">.</span><span class="ident" id="4009323">Network</span><span class="op" id="4009330">(</span><span class="op" id="4009331">)</span><span class="op" id="4009332">)</span><span class="op" id="4009333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4009336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009339">switch</span>&nbsp;<span class="ident" id="4009346">ra</span>&nbsp;<span class="op" id="4009349">:=</span>&nbsp;<span class="ident" id="4009352">ra</span><span class="op" id="4009354">.</span><span class="op" id="4009355">(</span><span class="keyword" id="4009356">type</span><span class="op" id="4009360">)</span>&nbsp;<span class="op" id="4009362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009365">case</span>&nbsp;<span class="op" id="4009370">*</span><span class="ident" id="4009371">TCPAddr</span><span class="op" id="4009378">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009382">la</span><span class="op" id="4009384">,</span>&nbsp;<span class="ident" id="4009386">_</span>&nbsp;<span class="op" id="4009388">:=</span>&nbsp;<span class="ident" id="4009391">la</span><span class="op" id="4009393">.</span><span class="op" id="4009394">(</span><span class="op" id="4009395">*</span><span class="ident" id="4009396">TCPAddr</span><span class="op" id="4009403">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009407">c</span><span class="op" id="4009408">,</span>&nbsp;<span class="ident" id="4009410">err</span>&nbsp;<span class="op" id="4009414">=</span>&nbsp;<span class="ident" id="4009416">dialTCP</span><span class="op" id="4009423">(</span><span class="ident" id="4009424">net</span><span class="op" id="4009427">,</span>&nbsp;<span class="ident" id="4009429">la</span><span class="op" id="4009431">,</span>&nbsp;<span class="ident" id="4009433">ra</span><span class="op" id="4009435">,</span>&nbsp;<span class="ident" id="4009437">deadline</span><span class="op" id="4009445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009448">case</span>&nbsp;<span class="op" id="4009453">*</span><span class="ident" id="4009454">UDPAddr</span><span class="op" id="4009461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009465">la</span><span class="op" id="4009467">,</span>&nbsp;<span class="ident" id="4009469">_</span>&nbsp;<span class="op" id="4009471">:=</span>&nbsp;<span class="ident" id="4009474">la</span><span class="op" id="4009476">.</span><span class="op" id="4009477">(</span><span class="op" id="4009478">*</span><span class="ident" id="4009479">UDPAddr</span><span class="op" id="4009486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009490">c</span><span class="op" id="4009491">,</span>&nbsp;<span class="ident" id="4009493">err</span>&nbsp;<span class="op" id="4009497">=</span>&nbsp;<span class="ident" id="4009499">dialUDP</span><span class="op" id="4009506">(</span><span class="ident" id="4009507">net</span><span class="op" id="4009510">,</span>&nbsp;<span class="ident" id="4009512">la</span><span class="op" id="4009514">,</span>&nbsp;<span class="ident" id="4009516">ra</span><span class="op" id="4009518">,</span>&nbsp;<span class="ident" id="4009520">deadline</span><span class="op" id="4009528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009531">case</span>&nbsp;<span class="op" id="4009536">*</span><span class="ident" id="4009537">IPAddr</span><span class="op" id="4009543">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009547">la</span><span class="op" id="4009549">,</span>&nbsp;<span class="ident" id="4009551">_</span>&nbsp;<span class="op" id="4009553">:=</span>&nbsp;<span class="ident" id="4009556">la</span><span class="op" id="4009558">.</span><span class="op" id="4009559">(</span><span class="op" id="4009560">*</span><span class="ident" id="4009561">IPAddr</span><span class="op" id="4009567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009571">c</span><span class="op" id="4009572">,</span>&nbsp;<span class="ident" id="4009574">err</span>&nbsp;<span class="op" id="4009578">=</span>&nbsp;<span class="ident" id="4009580">dialIP</span><span class="op" id="4009586">(</span><span class="ident" id="4009587">net</span><span class="op" id="4009590">,</span>&nbsp;<span class="ident" id="4009592">la</span><span class="op" id="4009594">,</span>&nbsp;<span class="ident" id="4009596">ra</span><span class="op" id="4009598">,</span>&nbsp;<span class="ident" id="4009600">deadline</span><span class="op" id="4009608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009611">case</span>&nbsp;<span class="op" id="4009616">*</span><span class="ident" id="4009617">UnixAddr</span><span class="op" id="4009625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009629">la</span><span class="op" id="4009631">,</span>&nbsp;<span class="ident" id="4009633">_</span>&nbsp;<span class="op" id="4009635">:=</span>&nbsp;<span class="ident" id="4009638">la</span><span class="op" id="4009640">.</span><span class="op" id="4009641">(</span><span class="op" id="4009642">*</span><span class="ident" id="4009643">UnixAddr</span><span class="op" id="4009651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4009655">c</span><span class="op" id="4009656">,</span>&nbsp;<span class="ident" id="4009658">err</span>&nbsp;<span class="op" id="4009662">=</span>&nbsp;<span class="ident" id="4009664">dialUnix</span><span class="op" id="4009672">(</span><span class="ident" id="4009673">net</span><span class="op" id="4009676">,</span>&nbsp;<span class="ident" id="4009678">la</span><span class="op" id="4009680">,</span>&nbsp;<span class="ident" id="4009682">ra</span><span class="op" id="4009684">,</span>&nbsp;<span class="ident" id="4009686">deadline</span><span class="op" id="4009694">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009697">default</span><span class="op" id="4009704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009708">return</span>&nbsp;<span class="ident" id="4009715">nil</span><span class="op" id="4009718">,</span>&nbsp;<span class="op" id="4009720">&amp;</span><span class="ident" id="4009721">OpError</span><span class="op" id="4009728">{</span><span class="ident" id="4009729">Op</span><span class="op" id="4009731">:</span>&nbsp;<span class="string" id="4009733">&#34;dial&#34;</span><span class="op" id="4009739">,</span>&nbsp;<span class="ident" id="4009741">Net</span><span class="op" id="4009744">:</span>&nbsp;<span class="ident" id="4009746">net</span><span class="op" id="4009749">,</span>&nbsp;<span class="ident" id="4009751">Addr</span><span class="op" id="4009755">:</span>&nbsp;<span class="ident" id="4009757">ra</span><span class="op" id="4009759">,</span>&nbsp;<span class="ident" id="4009761">Err</span><span class="op" id="4009764">:</span>&nbsp;<span class="op" id="4009766">&amp;</span><span class="ident" id="4009767">AddrError</span><span class="op" id="4009776">{</span><span class="ident" id="4009777">Err</span><span class="op" id="4009780">:</span>&nbsp;<span class="string" id="4009782">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="4009807">,</span>&nbsp;<span class="ident" id="4009809">Addr</span><span class="op" id="4009813">:</span>&nbsp;<span class="ident" id="4009815">addr</span><span class="op" id="4009819">}</span><span class="op" id="4009820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4009823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009826">if</span>&nbsp;<span class="ident" id="4009829">err</span>&nbsp;<span class="op" id="4009833">!=</span>&nbsp;<span class="ident" id="4009836">nil</span>&nbsp;<span class="op" id="4009840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009844">return</span>&nbsp;<span class="ident" id="4009851">nil</span><span class="op" id="4009854">,</span>&nbsp;<span class="ident" id="4009856">err</span>&nbsp;<span class="comment" id="4009860">//&nbsp;c&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4009910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4009913">return</span>&nbsp;<span class="ident" id="4009920">c</span><span class="op" id="4009921">,</span>&nbsp;<span class="ident" id="4009923">nil</span><br>
<span class="lineno"></span><span class="op" id="4009927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4009930">//&nbsp;Listen&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno">255</span><span class="comment" id="4009986">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;stream-oriented&nbsp;network:&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4010055">//&nbsp;&#34;tcp6&#34;,&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4010090">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="4010127">func</span>&nbsp;<span class="ident" id="4010132">Listen</span><span class="op" id="4010138">(</span><span class="ident" id="4010139">net</span><span class="op" id="4010142">,</span>&nbsp;<span class="ident" id="4010144">laddr</span>&nbsp;<span class="builtintype" id="4010150">string</span><span class="op" id="4010156">)</span>&nbsp;<span class="op" id="4010158">(</span><span class="ident" id="4010159">Listener</span><span class="op" id="4010167">,</span>&nbsp;<span class="builtintype" id="4010169">error</span><span class="op" id="4010174">)</span>&nbsp;<span class="op" id="4010176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4010179">la</span><span class="op" id="4010181">,</span>&nbsp;<span class="ident" id="4010183">err</span>&nbsp;<span class="op" id="4010187">:=</span>&nbsp;<span class="ident" id="4010190">resolveAddr</span><span class="op" id="4010201">(</span><span class="string" id="4010202">&#34;listen&#34;</span><span class="op" id="4010210">,</span>&nbsp;<span class="ident" id="4010212">net</span><span class="op" id="4010215">,</span>&nbsp;<span class="ident" id="4010217">laddr</span><span class="op" id="4010222">,</span>&nbsp;<span class="ident" id="4010224">noDeadline</span><span class="op" id="4010234">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4010237">if</span>&nbsp;<span class="ident" id="4010240">err</span>&nbsp;<span class="op" id="4010244">!=</span>&nbsp;<span class="ident" id="4010247">nil</span>&nbsp;<span class="op" id="4010251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4010255">return</span>&nbsp;<span class="ident" id="4010262">nil</span><span class="op" id="4010265">,</span>&nbsp;<span class="op" id="4010267">&amp;</span><span class="ident" id="4010268">OpError</span><span class="op" id="4010275">{</span><span class="ident" id="4010276">Op</span><span class="op" id="4010278">:</span>&nbsp;<span class="string" id="4010280">&#34;listen&#34;</span><span class="op" id="4010288">,</span>&nbsp;<span class="ident" id="4010290">Net</span><span class="op" id="4010293">:</span>&nbsp;<span class="ident" id="4010295">net</span><span class="op" id="4010298">,</span>&nbsp;<span class="ident" id="4010300">Addr</span><span class="op" id="4010304">:</span>&nbsp;<span class="ident" id="4010306">nil</span><span class="op" id="4010309">,</span>&nbsp;<span class="ident" id="4010311">Err</span><span class="op" id="4010314">:</span>&nbsp;<span class="ident" id="4010316">err</span><span class="op" id="4010319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4010322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4010325">var</span>&nbsp;<span class="ident" id="4010329">l</span>&nbsp;<span class="ident" id="4010331">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4010341">switch</span>&nbsp;<span class="ident" id="4010348">la</span>&nbsp;<span class="op" id="4010351">:=</span>&nbsp;<span class="ident" id="4010354">la</span><span class="op" id="4010356">.</span><span class="ident" id="4010357">toAddr</span><span class="op" id="4010363">(</span><span class="op" id="4010364">)</span><span class="op" id="4010365">.</span><span class="op" id="4010366">(</span><span class="keyword" id="4010367">type</span><span class="op" id="4010371">)</span>&nbsp;<span class="op" id="4010373">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4010376">case</span>&nbsp;<span class="op" id="4010381">*</span><span class="ident" id="4010382">TCPAddr</span><span class="op" id="4010389">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4010393">l</span><span class="op" id="4010394">,</span>&nbsp;<span class="ident" id="4010396">err</span>&nbsp;<span class="op" id="4010400">=</span>&nbsp;<span class="ident" id="4010402">ListenTCP</span><span class="op" id="4010411">(</span><span class="ident" id="4010412">net</span><span class="op" id="4010415">,</span>&nbsp;<span class="ident" id="4010417">la</span><span class="op" id="4010419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4010422">case</span>&nbsp;<span class="op" id="4010427">*</span><span class="ident" id="4010428">UnixAddr</span><span class="op" id="4010436">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4010440">l</span><span class="op" id="4010441">,</span>&nbsp;<span class="ident" id="4010443">err</span>&nbsp;<span class="op" id="4010447">=</span>&nbsp;<span class="ident" id="4010449">ListenUnix</span><span class="op" id="4010459">(</span><span class="ident" id="4010460">net</span><span class="op" id="4010463">,</span>&nbsp;<span class="ident" id="4010465">la</span><span class="op" id="4010467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4010470">default</span><span class="op" id="4010477">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4010481">return</span>&nbsp;<span class="ident" id="4010488">nil</span><span class="op" id="4010491">,</span>&nbsp;<span class="op" id="4010493">&amp;</span><span class="ident" id="4010494">OpError</span><span class="op" id="4010501">{</span><span class="ident" id="4010502">Op</span><span class="op" id="4010504">:</span>&nbsp;<span class="string" id="4010506">&#34;listen&#34;</span><span class="op" id="4010514">,</span>&nbsp;<span class="ident" id="4010516">Net</span><span class="op" id="4010519">:</span>&nbsp;<span class="ident" id="4010521">net</span><span class="op" id="4010524">,</span>&nbsp;<span class="ident" id="4010526">Addr</span><span class="op" id="4010530">:</span>&nbsp;<span class="ident" id="4010532">la</span><span class="op" id="4010534">,</span>&nbsp;<span class="ident" id="4010536">Err</span><span class="op" id="4010539">:</span>&nbsp;<span class="op" id="4010541">&amp;</span><span class="ident" id="4010542">AddrError</span><span class="op" id="4010551">{</span><span class="ident" id="4010552">Err</span><span class="op" id="4010555">:</span>&nbsp;<span class="string" id="4010557">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="4010582">,</span>&nbsp;<span class="ident" id="4010584">Addr</span><span class="op" id="4010588">:</span>&nbsp;<span class="ident" id="4010590">laddr</span><span class="op" id="4010595">}</span><span class="op" id="4010596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4010599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4010602">if</span>&nbsp;<span class="ident" id="4010605">err</span>&nbsp;<span class="op" id="4010609">!=</span>&nbsp;<span class="ident" id="4010612">nil</span>&nbsp;<span class="op" id="4010616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4010620">return</span>&nbsp;<span class="ident" id="4010627">nil</span><span class="op" id="4010630">,</span>&nbsp;<span class="ident" id="4010632">err</span>&nbsp;<span class="comment" id="4010636">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4010686">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4010689">return</span>&nbsp;<span class="ident" id="4010696">l</span><span class="op" id="4010697">,</span>&nbsp;<span class="ident" id="4010699">nil</span><br>
<span class="lineno"></span><span class="op" id="4010703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4010706">//&nbsp;ListenPacket&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="comment" id="4010768">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;packet-oriented&nbsp;network:&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,</span><br>
<span class="lineno">280</span><span class="comment" id="4010837">//&nbsp;&#34;udp6&#34;,&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;&#34;ip6&#34;&nbsp;or&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4010882">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="4010919">func</span>&nbsp;<span class="ident" id="4010924">ListenPacket</span><span class="op" id="4010936">(</span><span class="ident" id="4010937">net</span><span class="op" id="4010940">,</span>&nbsp;<span class="ident" id="4010942">laddr</span>&nbsp;<span class="builtintype" id="4010948">string</span><span class="op" id="4010954">)</span>&nbsp;<span class="op" id="4010956">(</span><span class="ident" id="4010957">PacketConn</span><span class="op" id="4010967">,</span>&nbsp;<span class="builtintype" id="4010969">error</span><span class="op" id="4010974">)</span>&nbsp;<span class="op" id="4010976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4010979">la</span><span class="op" id="4010981">,</span>&nbsp;<span class="ident" id="4010983">err</span>&nbsp;<span class="op" id="4010987">:=</span>&nbsp;<span class="ident" id="4010990">resolveAddr</span><span class="op" id="4011001">(</span><span class="string" id="4011002">&#34;listen&#34;</span><span class="op" id="4011010">,</span>&nbsp;<span class="ident" id="4011012">net</span><span class="op" id="4011015">,</span>&nbsp;<span class="ident" id="4011017">laddr</span><span class="op" id="4011022">,</span>&nbsp;<span class="ident" id="4011024">noDeadline</span><span class="op" id="4011034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011037">if</span>&nbsp;<span class="ident" id="4011040">err</span>&nbsp;<span class="op" id="4011044">!=</span>&nbsp;<span class="ident" id="4011047">nil</span>&nbsp;<span class="op" id="4011051">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011055">return</span>&nbsp;<span class="ident" id="4011062">nil</span><span class="op" id="4011065">,</span>&nbsp;<span class="op" id="4011067">&amp;</span><span class="ident" id="4011068">OpError</span><span class="op" id="4011075">{</span><span class="ident" id="4011076">Op</span><span class="op" id="4011078">:</span>&nbsp;<span class="string" id="4011080">&#34;listen&#34;</span><span class="op" id="4011088">,</span>&nbsp;<span class="ident" id="4011090">Net</span><span class="op" id="4011093">:</span>&nbsp;<span class="ident" id="4011095">net</span><span class="op" id="4011098">,</span>&nbsp;<span class="ident" id="4011100">Addr</span><span class="op" id="4011104">:</span>&nbsp;<span class="ident" id="4011106">nil</span><span class="op" id="4011109">,</span>&nbsp;<span class="ident" id="4011111">Err</span><span class="op" id="4011114">:</span>&nbsp;<span class="ident" id="4011116">err</span><span class="op" id="4011119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4011122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011125">var</span>&nbsp;<span class="ident" id="4011129">l</span>&nbsp;<span class="ident" id="4011131">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011143">switch</span>&nbsp;<span class="ident" id="4011150">la</span>&nbsp;<span class="op" id="4011153">:=</span>&nbsp;<span class="ident" id="4011156">la</span><span class="op" id="4011158">.</span><span class="ident" id="4011159">toAddr</span><span class="op" id="4011165">(</span><span class="op" id="4011166">)</span><span class="op" id="4011167">.</span><span class="op" id="4011168">(</span><span class="keyword" id="4011169">type</span><span class="op" id="4011173">)</span>&nbsp;<span class="op" id="4011175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011178">case</span>&nbsp;<span class="op" id="4011183">*</span><span class="ident" id="4011184">UDPAddr</span><span class="op" id="4011191">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011195">l</span><span class="op" id="4011196">,</span>&nbsp;<span class="ident" id="4011198">err</span>&nbsp;<span class="op" id="4011202">=</span>&nbsp;<span class="ident" id="4011204">ListenUDP</span><span class="op" id="4011213">(</span><span class="ident" id="4011214">net</span><span class="op" id="4011217">,</span>&nbsp;<span class="ident" id="4011219">la</span><span class="op" id="4011221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011224">case</span>&nbsp;<span class="op" id="4011229">*</span><span class="ident" id="4011230">IPAddr</span><span class="op" id="4011236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011240">l</span><span class="op" id="4011241">,</span>&nbsp;<span class="ident" id="4011243">err</span>&nbsp;<span class="op" id="4011247">=</span>&nbsp;<span class="ident" id="4011249">ListenIP</span><span class="op" id="4011257">(</span><span class="ident" id="4011258">net</span><span class="op" id="4011261">,</span>&nbsp;<span class="ident" id="4011263">la</span><span class="op" id="4011265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011268">case</span>&nbsp;<span class="op" id="4011273">*</span><span class="ident" id="4011274">UnixAddr</span><span class="op" id="4011282">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011286">l</span><span class="op" id="4011287">,</span>&nbsp;<span class="ident" id="4011289">err</span>&nbsp;<span class="op" id="4011293">=</span>&nbsp;<span class="ident" id="4011295">ListenUnixgram</span><span class="op" id="4011309">(</span><span class="ident" id="4011310">net</span><span class="op" id="4011313">,</span>&nbsp;<span class="ident" id="4011315">la</span><span class="op" id="4011317">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011320">default</span><span class="op" id="4011327">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011331">return</span>&nbsp;<span class="ident" id="4011338">nil</span><span class="op" id="4011341">,</span>&nbsp;<span class="op" id="4011343">&amp;</span><span class="ident" id="4011344">OpError</span><span class="op" id="4011351">{</span><span class="ident" id="4011352">Op</span><span class="op" id="4011354">:</span>&nbsp;<span class="string" id="4011356">&#34;listen&#34;</span><span class="op" id="4011364">,</span>&nbsp;<span class="ident" id="4011366">Net</span><span class="op" id="4011369">:</span>&nbsp;<span class="ident" id="4011371">net</span><span class="op" id="4011374">,</span>&nbsp;<span class="ident" id="4011376">Addr</span><span class="op" id="4011380">:</span>&nbsp;<span class="ident" id="4011382">la</span><span class="op" id="4011384">,</span>&nbsp;<span class="ident" id="4011386">Err</span><span class="op" id="4011389">:</span>&nbsp;<span class="op" id="4011391">&amp;</span><span class="ident" id="4011392">AddrError</span><span class="op" id="4011401">{</span><span class="ident" id="4011402">Err</span><span class="op" id="4011405">:</span>&nbsp;<span class="string" id="4011407">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="4011432">,</span>&nbsp;<span class="ident" id="4011434">Addr</span><span class="op" id="4011438">:</span>&nbsp;<span class="ident" id="4011440">laddr</span><span class="op" id="4011445">}</span><span class="op" id="4011446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4011449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011452">if</span>&nbsp;<span class="ident" id="4011455">err</span>&nbsp;<span class="op" id="4011459">!=</span>&nbsp;<span class="ident" id="4011462">nil</span>&nbsp;<span class="op" id="4011466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011470">return</span>&nbsp;<span class="ident" id="4011477">nil</span><span class="op" id="4011480">,</span>&nbsp;<span class="ident" id="4011482">err</span>&nbsp;<span class="comment" id="4011486">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4011536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011539">return</span>&nbsp;<span class="ident" id="4011546">l</span><span class="op" id="4011547">,</span>&nbsp;<span class="ident" id="4011549">nil</span><br>
<span class="lineno"></span><span class="op" id="4011553">}</span>
</div>
</body>
</html>
