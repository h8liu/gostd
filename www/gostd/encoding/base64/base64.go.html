<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/base64</h2>
<ul>
<li><a href="/gostd/encoding/base64/base64.go.html">base64.go</a></li>
<li><a href="/gostd/encoding/base64/base64_test.go.html">base64_test.go</a></li>
<li><a href="/gostd/encoding/base64/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1329532">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1329587">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1329641">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1329692">//&nbsp;Package&nbsp;base64&nbsp;implements&nbsp;base64&nbsp;encoding&nbsp;as&nbsp;specified&nbsp;by&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="1329763">package</span>&nbsp;<span class="ident" id="1329771">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1329779">import</span>&nbsp;<span class="op" id="1329786">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329789">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329798">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329804">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329815">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="1329825">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1329828">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encodings<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1329849">//&nbsp;An&nbsp;Encoding&nbsp;is&nbsp;a&nbsp;radix&nbsp;64&nbsp;encoding/decoding&nbsp;scheme,&nbsp;defined&nbsp;by&nbsp;a</span><br>
<span class="lineno">20</span><span class="comment" id="1329917">//&nbsp;64-character&nbsp;alphabet.&nbsp;&nbsp;The&nbsp;most&nbsp;common&nbsp;encoding&nbsp;is&nbsp;the&nbsp;&#34;base64&#34;</span><br>
<span class="lineno"></span><span class="comment" id="1329985">//&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648&nbsp;and&nbsp;used&nbsp;in&nbsp;MIME&nbsp;(RFC&nbsp;2045)&nbsp;and&nbsp;PEM</span><br>
<span class="lineno"></span><span class="comment" id="1330053">//&nbsp;(RFC&nbsp;1421).&nbsp;&nbsp;RFC&nbsp;4648&nbsp;also&nbsp;defines&nbsp;an&nbsp;alternate&nbsp;encoding,&nbsp;which&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1330123">//&nbsp;the&nbsp;standard&nbsp;encoding&nbsp;with&nbsp;-&nbsp;and&nbsp;_&nbsp;substituted&nbsp;for&nbsp;+&nbsp;and&nbsp;/.</span><br>
<span class="lineno"></span><span class="keyword" id="1330186">type</span>&nbsp;<span class="ident" id="1330191">Encoding</span>&nbsp;<span class="keyword" id="1330200">struct</span>&nbsp;<span class="op" id="1330207">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330210">encode</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1330220">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330228">decodeMap</span>&nbsp;<span class="op" id="1330238">[</span><span class="num" id="1330239">256</span><span class="op" id="1330242">]</span><span class="builtintype" id="1330243">byte</span><br>
<span class="lineno"></span><span class="op" id="1330248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1330251">const</span>&nbsp;<span class="ident" id="1330257">encodeStd</span>&nbsp;<span class="op" id="1330267">=</span>&nbsp;<span class="string" id="1330269">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#34;</span><br>
<span class="lineno">30</span><span class="keyword" id="1330336">const</span>&nbsp;<span class="ident" id="1330342">encodeURL</span>&nbsp;<span class="op" id="1330352">=</span>&nbsp;<span class="string" id="1330354">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1330422">//&nbsp;NewEncoding&nbsp;returns&nbsp;a&nbsp;new&nbsp;Encoding&nbsp;defined&nbsp;by&nbsp;the&nbsp;given&nbsp;alphabet,</span><br>
<span class="lineno"></span><span class="comment" id="1330491">//&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;64-byte&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1330526">func</span>&nbsp;<span class="ident" id="1330531">NewEncoding</span><span class="op" id="1330542">(</span><span class="ident" id="1330543">encoder</span>&nbsp;<span class="builtintype" id="1330551">string</span><span class="op" id="1330557">)</span>&nbsp;<span class="op" id="1330559">*</span><span class="ident" id="1330560">Encoding</span>&nbsp;<span class="op" id="1330569">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330572">e</span>&nbsp;<span class="op" id="1330574">:=</span>&nbsp;<span class="builtinfunc" id="1330577">new</span><span class="op" id="1330580">(</span><span class="ident" id="1330581">Encoding</span><span class="op" id="1330589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330592">e</span><span class="op" id="1330593">.</span><span class="ident" id="1330594">encode</span>&nbsp;<span class="op" id="1330601">=</span>&nbsp;<span class="ident" id="1330603">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1330612">for</span>&nbsp;<span class="ident" id="1330616">i</span>&nbsp;<span class="op" id="1330618">:=</span>&nbsp;<span class="num" id="1330621">0</span><span class="op" id="1330622">;</span>&nbsp;<span class="ident" id="1330624">i</span>&nbsp;<span class="op" id="1330626">&lt;</span>&nbsp;<span class="builtinfunc" id="1330628">len</span><span class="op" id="1330631">(</span><span class="ident" id="1330632">e</span><span class="op" id="1330633">.</span><span class="ident" id="1330634">decodeMap</span><span class="op" id="1330643">)</span><span class="op" id="1330644">;</span>&nbsp;<span class="ident" id="1330646">i</span><span class="op" id="1330647">++</span>&nbsp;<span class="op" id="1330650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330654">e</span><span class="op" id="1330655">.</span><span class="ident" id="1330656">decodeMap</span><span class="op" id="1330665">[</span><span class="ident" id="1330666">i</span><span class="op" id="1330667">]</span>&nbsp;<span class="op" id="1330669">=</span>&nbsp;<span class="num" id="1330671">0xFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1330677">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1330680">for</span>&nbsp;<span class="ident" id="1330684">i</span>&nbsp;<span class="op" id="1330686">:=</span>&nbsp;<span class="num" id="1330689">0</span><span class="op" id="1330690">;</span>&nbsp;<span class="ident" id="1330692">i</span>&nbsp;<span class="op" id="1330694">&lt;</span>&nbsp;<span class="builtinfunc" id="1330696">len</span><span class="op" id="1330699">(</span><span class="ident" id="1330700">encoder</span><span class="op" id="1330707">)</span><span class="op" id="1330708">;</span>&nbsp;<span class="ident" id="1330710">i</span><span class="op" id="1330711">++</span>&nbsp;<span class="op" id="1330714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330718">e</span><span class="op" id="1330719">.</span><span class="ident" id="1330720">decodeMap</span><span class="op" id="1330729">[</span><span class="ident" id="1330730">encoder</span><span class="op" id="1330737">[</span><span class="ident" id="1330738">i</span><span class="op" id="1330739">]</span><span class="op" id="1330740">]</span>&nbsp;<span class="op" id="1330742">=</span>&nbsp;<span class="builtintype" id="1330744">byte</span><span class="op" id="1330748">(</span><span class="ident" id="1330749">i</span><span class="op" id="1330750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1330753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1330756">return</span>&nbsp;<span class="ident" id="1330763">e</span><br>
<span class="lineno"></span><span class="op" id="1330765">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1330768">//&nbsp;StdEncoding&nbsp;is&nbsp;the&nbsp;standard&nbsp;base64&nbsp;encoding,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1330830">//&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="1330843">var</span>&nbsp;<span class="ident" id="1330847">StdEncoding</span>&nbsp;<span class="op" id="1330859">=</span>&nbsp;<span class="ident" id="1330861">NewEncoding</span><span class="op" id="1330872">(</span><span class="ident" id="1330873">encodeStd</span><span class="op" id="1330882">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="1330885">//&nbsp;URLEncoding&nbsp;is&nbsp;the&nbsp;alternate&nbsp;base64&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="comment" id="1330954">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;in&nbsp;URLs&nbsp;and&nbsp;file&nbsp;names.</span><br>
<span class="lineno"></span><span class="keyword" id="1331002">var</span>&nbsp;<span class="ident" id="1331006">URLEncoding</span>&nbsp;<span class="op" id="1331018">=</span>&nbsp;<span class="ident" id="1331020">NewEncoding</span><span class="op" id="1331031">(</span><span class="ident" id="1331032">encodeURL</span><span class="op" id="1331041">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1331044">var</span>&nbsp;<span class="ident" id="1331048">removeNewlinesMapper</span>&nbsp;<span class="op" id="1331069">=</span>&nbsp;<span class="keyword" id="1331071">func</span><span class="op" id="1331075">(</span><span class="ident" id="1331076">r</span>&nbsp;<span class="builtintype" id="1331078">rune</span><span class="op" id="1331082">)</span>&nbsp;<span class="builtintype" id="1331084">rune</span>&nbsp;<span class="op" id="1331089">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331092">if</span>&nbsp;<span class="ident" id="1331095">r</span>&nbsp;<span class="op" id="1331097">==</span>&nbsp;<span class="string" id="1331100">&#39;\r&#39;</span>&nbsp;<span class="op" id="1331105">||</span>&nbsp;<span class="ident" id="1331108">r</span>&nbsp;<span class="op" id="1331110">==</span>&nbsp;<span class="string" id="1331113">&#39;\n&#39;</span>&nbsp;<span class="op" id="1331118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331122">return</span>&nbsp;<span class="op" id="1331129">-</span><span class="num" id="1331130">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1331133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331136">return</span>&nbsp;<span class="ident" id="1331143">r</span><br>
<span class="lineno"></span><span class="op" id="1331145">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="1331148">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="1331167">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc,&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="1331221">//&nbsp;EncodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="1331259">//</span><br>
<span class="lineno"></span><span class="comment" id="1331262">//&nbsp;The&nbsp;encoding&nbsp;pads&nbsp;the&nbsp;output&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;4&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="1331320">//&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on&nbsp;individual&nbsp;blocks</span><br>
<span class="lineno">70</span><span class="comment" id="1331381">//&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="1331435">func</span>&nbsp;<span class="op" id="1331440">(</span><span class="ident" id="1331441">enc</span>&nbsp;<span class="op" id="1331445">*</span><span class="ident" id="1331446">Encoding</span><span class="op" id="1331454">)</span>&nbsp;<span class="ident" id="1331456">Encode</span><span class="op" id="1331462">(</span><span class="ident" id="1331463">dst</span><span class="op" id="1331466">,</span>&nbsp;<span class="ident" id="1331468">src</span>&nbsp;<span class="op" id="1331472">[</span><span class="op" id="1331473">]</span><span class="builtintype" id="1331474">byte</span><span class="op" id="1331478">)</span>&nbsp;<span class="op" id="1331480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331483">if</span>&nbsp;<span class="builtinfunc" id="1331486">len</span><span class="op" id="1331489">(</span><span class="ident" id="1331490">src</span><span class="op" id="1331493">)</span>&nbsp;<span class="op" id="1331495">==</span>&nbsp;<span class="num" id="1331498">0</span>&nbsp;<span class="op" id="1331500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331504">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1331512">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331516">for</span>&nbsp;<span class="builtinfunc" id="1331520">len</span><span class="op" id="1331523">(</span><span class="ident" id="1331524">src</span><span class="op" id="1331527">)</span>&nbsp;<span class="op" id="1331529">&gt;</span>&nbsp;<span class="num" id="1331531">0</span>&nbsp;<span class="op" id="1331533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331537">var</span>&nbsp;<span class="ident" id="1331541">b0</span><span class="op" id="1331543">,</span>&nbsp;<span class="ident" id="1331545">b1</span><span class="op" id="1331547">,</span>&nbsp;<span class="ident" id="1331549">b2</span><span class="op" id="1331551">,</span>&nbsp;<span class="ident" id="1331553">b3</span>&nbsp;<span class="builtintype" id="1331556">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331564">//&nbsp;Unpack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;a&nbsp;4&nbsp;byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331613">//&nbsp;destination&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331638">switch</span>&nbsp;<span class="builtinfunc" id="1331645">len</span><span class="op" id="1331648">(</span><span class="ident" id="1331649">src</span><span class="op" id="1331652">)</span>&nbsp;<span class="op" id="1331654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331658">default</span><span class="op" id="1331665">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331670">b3</span>&nbsp;<span class="op" id="1331673">=</span>&nbsp;<span class="ident" id="1331675">src</span><span class="op" id="1331678">[</span><span class="num" id="1331679">2</span><span class="op" id="1331680">]</span>&nbsp;<span class="op" id="1331682">&amp;</span>&nbsp;<span class="num" id="1331684">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331692">b2</span>&nbsp;<span class="op" id="1331695">=</span>&nbsp;<span class="ident" id="1331697">src</span><span class="op" id="1331700">[</span><span class="num" id="1331701">2</span><span class="op" id="1331702">]</span>&nbsp;<span class="op" id="1331704">&gt;&gt;</span>&nbsp;<span class="num" id="1331707">6</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331712">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331726">case</span>&nbsp;<span class="num" id="1331731">2</span><span class="op" id="1331732">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331737">b2</span>&nbsp;<span class="op" id="1331740">|=</span>&nbsp;<span class="op" id="1331743">(</span><span class="ident" id="1331744">src</span><span class="op" id="1331747">[</span><span class="num" id="1331748">1</span><span class="op" id="1331749">]</span>&nbsp;<span class="op" id="1331751">&lt;&lt;</span>&nbsp;<span class="num" id="1331754">2</span><span class="op" id="1331755">)</span>&nbsp;<span class="op" id="1331757">&amp;</span>&nbsp;<span class="num" id="1331759">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331767">b1</span>&nbsp;<span class="op" id="1331770">=</span>&nbsp;<span class="ident" id="1331772">src</span><span class="op" id="1331775">[</span><span class="num" id="1331776">1</span><span class="op" id="1331777">]</span>&nbsp;<span class="op" id="1331779">&gt;&gt;</span>&nbsp;<span class="num" id="1331782">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331787">fallthrough</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331801">case</span>&nbsp;<span class="num" id="1331806">1</span><span class="op" id="1331807">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331812">b1</span>&nbsp;<span class="op" id="1331815">|=</span>&nbsp;<span class="op" id="1331818">(</span><span class="ident" id="1331819">src</span><span class="op" id="1331822">[</span><span class="num" id="1331823">0</span><span class="op" id="1331824">]</span>&nbsp;<span class="op" id="1331826">&lt;&lt;</span>&nbsp;<span class="num" id="1331829">4</span><span class="op" id="1331830">)</span>&nbsp;<span class="op" id="1331832">&amp;</span>&nbsp;<span class="num" id="1331834">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331842">b0</span>&nbsp;<span class="op" id="1331845">=</span>&nbsp;<span class="ident" id="1331847">src</span><span class="op" id="1331850">[</span><span class="num" id="1331851">0</span><span class="op" id="1331852">]</span>&nbsp;<span class="op" id="1331854">&gt;&gt;</span>&nbsp;<span class="num" id="1331857">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1331861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331866">//&nbsp;Encode&nbsp;6-bit&nbsp;blocks&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331917">dst</span><span class="op" id="1331920">[</span><span class="num" id="1331921">0</span><span class="op" id="1331922">]</span>&nbsp;<span class="op" id="1331924">=</span>&nbsp;<span class="ident" id="1331926">enc</span><span class="op" id="1331929">.</span><span class="ident" id="1331930">encode</span><span class="op" id="1331936">[</span><span class="ident" id="1331937">b0</span><span class="op" id="1331939">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331943">dst</span><span class="op" id="1331946">[</span><span class="num" id="1331947">1</span><span class="op" id="1331948">]</span>&nbsp;<span class="op" id="1331950">=</span>&nbsp;<span class="ident" id="1331952">enc</span><span class="op" id="1331955">.</span><span class="ident" id="1331956">encode</span><span class="op" id="1331962">[</span><span class="ident" id="1331963">b1</span><span class="op" id="1331965">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331969">dst</span><span class="op" id="1331972">[</span><span class="num" id="1331973">2</span><span class="op" id="1331974">]</span>&nbsp;<span class="op" id="1331976">=</span>&nbsp;<span class="ident" id="1331978">enc</span><span class="op" id="1331981">.</span><span class="ident" id="1331982">encode</span><span class="op" id="1331988">[</span><span class="ident" id="1331989">b2</span><span class="op" id="1331991">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331995">dst</span><span class="op" id="1331998">[</span><span class="num" id="1331999">3</span><span class="op" id="1332000">]</span>&nbsp;<span class="op" id="1332002">=</span>&nbsp;<span class="ident" id="1332004">enc</span><span class="op" id="1332007">.</span><span class="ident" id="1332008">encode</span><span class="op" id="1332014">[</span><span class="ident" id="1332015">b3</span><span class="op" id="1332017">]</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332022">//&nbsp;Pad&nbsp;the&nbsp;final&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332049">if</span>&nbsp;<span class="builtinfunc" id="1332052">len</span><span class="op" id="1332055">(</span><span class="ident" id="1332056">src</span><span class="op" id="1332059">)</span>&nbsp;<span class="op" id="1332061">&lt;</span>&nbsp;<span class="num" id="1332063">3</span>&nbsp;<span class="op" id="1332065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332070">dst</span><span class="op" id="1332073">[</span><span class="num" id="1332074">3</span><span class="op" id="1332075">]</span>&nbsp;<span class="op" id="1332077">=</span>&nbsp;<span class="string" id="1332079">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332086">if</span>&nbsp;<span class="builtinfunc" id="1332089">len</span><span class="op" id="1332092">(</span><span class="ident" id="1332093">src</span><span class="op" id="1332096">)</span>&nbsp;<span class="op" id="1332098">&lt;</span>&nbsp;<span class="num" id="1332100">2</span>&nbsp;<span class="op" id="1332102">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332108">dst</span><span class="op" id="1332111">[</span><span class="num" id="1332112">2</span><span class="op" id="1332113">]</span>&nbsp;<span class="op" id="1332115">=</span>&nbsp;<span class="string" id="1332117">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332129">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332142">src</span>&nbsp;<span class="op" id="1332146">=</span>&nbsp;<span class="ident" id="1332148">src</span><span class="op" id="1332151">[</span><span class="num" id="1332152">3</span><span class="op" id="1332153">:</span><span class="op" id="1332154">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332158">dst</span>&nbsp;<span class="op" id="1332162">=</span>&nbsp;<span class="ident" id="1332164">dst</span><span class="op" id="1332167">[</span><span class="num" id="1332168">4</span><span class="op" id="1332169">:</span><span class="op" id="1332170">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332173">}</span><br>
<span class="lineno"></span><span class="op" id="1332175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="1332178">//&nbsp;EncodeToString&nbsp;returns&nbsp;the&nbsp;base64&nbsp;encoding&nbsp;of&nbsp;src.</span><br>
<span class="lineno"></span><span class="keyword" id="1332232">func</span>&nbsp;<span class="op" id="1332237">(</span><span class="ident" id="1332238">enc</span>&nbsp;<span class="op" id="1332242">*</span><span class="ident" id="1332243">Encoding</span><span class="op" id="1332251">)</span>&nbsp;<span class="ident" id="1332253">EncodeToString</span><span class="op" id="1332267">(</span><span class="ident" id="1332268">src</span>&nbsp;<span class="op" id="1332272">[</span><span class="op" id="1332273">]</span><span class="builtintype" id="1332274">byte</span><span class="op" id="1332278">)</span>&nbsp;<span class="builtintype" id="1332280">string</span>&nbsp;<span class="op" id="1332287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332290">buf</span>&nbsp;<span class="op" id="1332294">:=</span>&nbsp;<span class="builtinfunc" id="1332297">make</span><span class="op" id="1332301">(</span><span class="op" id="1332302">[</span><span class="op" id="1332303">]</span><span class="builtintype" id="1332304">byte</span><span class="op" id="1332308">,</span>&nbsp;<span class="ident" id="1332310">enc</span><span class="op" id="1332313">.</span><span class="ident" id="1332314">EncodedLen</span><span class="op" id="1332324">(</span><span class="builtinfunc" id="1332325">len</span><span class="op" id="1332328">(</span><span class="ident" id="1332329">src</span><span class="op" id="1332332">)</span><span class="op" id="1332333">)</span><span class="op" id="1332334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332337">enc</span><span class="op" id="1332340">.</span><span class="ident" id="1332341">Encode</span><span class="op" id="1332347">(</span><span class="ident" id="1332348">buf</span><span class="op" id="1332351">,</span>&nbsp;<span class="ident" id="1332353">src</span><span class="op" id="1332356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332359">return</span>&nbsp;<span class="builtintype" id="1332366">string</span><span class="op" id="1332372">(</span><span class="ident" id="1332373">buf</span><span class="op" id="1332376">)</span><br>
<span class="lineno">120</span><span class="op" id="1332378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1332381">type</span>&nbsp;<span class="ident" id="1332386">encoder</span>&nbsp;<span class="keyword" id="1332394">struct</span>&nbsp;<span class="op" id="1332401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332404">err</span>&nbsp;&nbsp;<span class="builtintype" id="1332409">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332416">enc</span>&nbsp;&nbsp;<span class="op" id="1332421">*</span><span class="ident" id="1332422">Encoding</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332432">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1332437">io</span><span class="op" id="1332439">.</span><span class="ident" id="1332440">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332448">buf</span>&nbsp;&nbsp;<span class="op" id="1332453">[</span><span class="num" id="1332454">3</span><span class="op" id="1332455">]</span><span class="builtintype" id="1332456">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1332464">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332504">nbuf</span>&nbsp;<span class="builtintype" id="1332509">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1332520">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332547">out</span>&nbsp;&nbsp;<span class="op" id="1332552">[</span><span class="num" id="1332553">1024</span><span class="op" id="1332557">]</span><span class="builtintype" id="1332558">byte</span>&nbsp;<span class="comment" id="1332563">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="1332580">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="1332583">func</span>&nbsp;<span class="op" id="1332588">(</span><span class="ident" id="1332589">e</span>&nbsp;<span class="op" id="1332591">*</span><span class="ident" id="1332592">encoder</span><span class="op" id="1332599">)</span>&nbsp;<span class="ident" id="1332601">Write</span><span class="op" id="1332606">(</span><span class="ident" id="1332607">p</span>&nbsp;<span class="op" id="1332609">[</span><span class="op" id="1332610">]</span><span class="builtintype" id="1332611">byte</span><span class="op" id="1332615">)</span>&nbsp;<span class="op" id="1332617">(</span><span class="ident" id="1332618">n</span>&nbsp;<span class="builtintype" id="1332620">int</span><span class="op" id="1332623">,</span>&nbsp;<span class="ident" id="1332625">err</span>&nbsp;<span class="builtintype" id="1332629">error</span><span class="op" id="1332634">)</span>&nbsp;<span class="op" id="1332636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332639">if</span>&nbsp;<span class="ident" id="1332642">e</span><span class="op" id="1332643">.</span><span class="ident" id="1332644">err</span>&nbsp;<span class="op" id="1332648">!=</span>&nbsp;<span class="ident" id="1332651">nil</span>&nbsp;<span class="op" id="1332655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332659">return</span>&nbsp;<span class="num" id="1332666">0</span><span class="op" id="1332667">,</span>&nbsp;<span class="ident" id="1332669">e</span><span class="op" id="1332670">.</span><span class="ident" id="1332671">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332676">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332680">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332700">if</span>&nbsp;<span class="ident" id="1332703">e</span><span class="op" id="1332704">.</span><span class="ident" id="1332705">nbuf</span>&nbsp;<span class="op" id="1332710">&gt;</span>&nbsp;<span class="num" id="1332712">0</span>&nbsp;<span class="op" id="1332714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332718">var</span>&nbsp;<span class="ident" id="1332722">i</span>&nbsp;<span class="builtintype" id="1332724">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332730">for</span>&nbsp;<span class="ident" id="1332734">i</span>&nbsp;<span class="op" id="1332736">=</span>&nbsp;<span class="num" id="1332738">0</span><span class="op" id="1332739">;</span>&nbsp;<span class="ident" id="1332741">i</span>&nbsp;<span class="op" id="1332743">&lt;</span>&nbsp;<span class="builtinfunc" id="1332745">len</span><span class="op" id="1332748">(</span><span class="ident" id="1332749">p</span><span class="op" id="1332750">)</span>&nbsp;<span class="op" id="1332752">&amp;&amp;</span>&nbsp;<span class="ident" id="1332755">e</span><span class="op" id="1332756">.</span><span class="ident" id="1332757">nbuf</span>&nbsp;<span class="op" id="1332762">&lt;</span>&nbsp;<span class="num" id="1332764">3</span><span class="op" id="1332765">;</span>&nbsp;<span class="ident" id="1332767">i</span><span class="op" id="1332768">++</span>&nbsp;<span class="op" id="1332771">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332776">e</span><span class="op" id="1332777">.</span><span class="ident" id="1332778">buf</span><span class="op" id="1332781">[</span><span class="ident" id="1332782">e</span><span class="op" id="1332783">.</span><span class="ident" id="1332784">nbuf</span><span class="op" id="1332788">]</span>&nbsp;<span class="op" id="1332790">=</span>&nbsp;<span class="ident" id="1332792">p</span><span class="op" id="1332793">[</span><span class="ident" id="1332794">i</span><span class="op" id="1332795">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332800">e</span><span class="op" id="1332801">.</span><span class="ident" id="1332802">nbuf</span><span class="op" id="1332806">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332815">n</span>&nbsp;<span class="op" id="1332817">+=</span>&nbsp;<span class="ident" id="1332820">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332824">p</span>&nbsp;<span class="op" id="1332826">=</span>&nbsp;<span class="ident" id="1332828">p</span><span class="op" id="1332829">[</span><span class="ident" id="1332830">i</span><span class="op" id="1332831">:</span><span class="op" id="1332832">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332836">if</span>&nbsp;<span class="ident" id="1332839">e</span><span class="op" id="1332840">.</span><span class="ident" id="1332841">nbuf</span>&nbsp;<span class="op" id="1332846">&lt;</span>&nbsp;<span class="num" id="1332848">3</span>&nbsp;<span class="op" id="1332850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332855">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332868">e</span><span class="op" id="1332869">.</span><span class="ident" id="1332870">enc</span><span class="op" id="1332873">.</span><span class="ident" id="1332874">Encode</span><span class="op" id="1332880">(</span><span class="ident" id="1332881">e</span><span class="op" id="1332882">.</span><span class="ident" id="1332883">out</span><span class="op" id="1332886">[</span><span class="num" id="1332887">0</span><span class="op" id="1332888">:</span><span class="op" id="1332889">]</span><span class="op" id="1332890">,</span>&nbsp;<span class="ident" id="1332892">e</span><span class="op" id="1332893">.</span><span class="ident" id="1332894">buf</span><span class="op" id="1332897">[</span><span class="num" id="1332898">0</span><span class="op" id="1332899">:</span><span class="op" id="1332900">]</span><span class="op" id="1332901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332905">if</span>&nbsp;<span class="ident" id="1332908">_</span><span class="op" id="1332909">,</span>&nbsp;<span class="ident" id="1332911">e</span><span class="op" id="1332912">.</span><span class="ident" id="1332913">err</span>&nbsp;<span class="op" id="1332917">=</span>&nbsp;<span class="ident" id="1332919">e</span><span class="op" id="1332920">.</span><span class="ident" id="1332921">w</span><span class="op" id="1332922">.</span><span class="ident" id="1332923">Write</span><span class="op" id="1332928">(</span><span class="ident" id="1332929">e</span><span class="op" id="1332930">.</span><span class="ident" id="1332931">out</span><span class="op" id="1332934">[</span><span class="num" id="1332935">0</span><span class="op" id="1332936">:</span><span class="num" id="1332937">4</span><span class="op" id="1332938">]</span><span class="op" id="1332939">)</span><span class="op" id="1332940">;</span>&nbsp;<span class="ident" id="1332942">e</span><span class="op" id="1332943">.</span><span class="ident" id="1332944">err</span>&nbsp;<span class="op" id="1332948">!=</span>&nbsp;<span class="ident" id="1332951">nil</span>&nbsp;<span class="op" id="1332955">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332960">return</span>&nbsp;<span class="ident" id="1332967">n</span><span class="op" id="1332968">,</span>&nbsp;<span class="ident" id="1332970">e</span><span class="op" id="1332971">.</span><span class="ident" id="1332972">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332982">e</span><span class="op" id="1332983">.</span><span class="ident" id="1332984">nbuf</span>&nbsp;<span class="op" id="1332989">=</span>&nbsp;<span class="num" id="1332991">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332998">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333025">for</span>&nbsp;<span class="builtinfunc" id="1333029">len</span><span class="op" id="1333032">(</span><span class="ident" id="1333033">p</span><span class="op" id="1333034">)</span>&nbsp;<span class="op" id="1333036">&gt;=</span>&nbsp;<span class="num" id="1333039">3</span>&nbsp;<span class="op" id="1333041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333045">nn</span>&nbsp;<span class="op" id="1333048">:=</span>&nbsp;<span class="builtinfunc" id="1333051">len</span><span class="op" id="1333054">(</span><span class="ident" id="1333055">e</span><span class="op" id="1333056">.</span><span class="ident" id="1333057">out</span><span class="op" id="1333060">)</span>&nbsp;<span class="op" id="1333062">/</span>&nbsp;<span class="num" id="1333064">4</span>&nbsp;<span class="op" id="1333066">*</span>&nbsp;<span class="num" id="1333068">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333072">if</span>&nbsp;<span class="ident" id="1333075">nn</span>&nbsp;<span class="op" id="1333078">&gt;</span>&nbsp;<span class="builtinfunc" id="1333080">len</span><span class="op" id="1333083">(</span><span class="ident" id="1333084">p</span><span class="op" id="1333085">)</span>&nbsp;<span class="op" id="1333087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333092">nn</span>&nbsp;<span class="op" id="1333095">=</span>&nbsp;<span class="builtinfunc" id="1333097">len</span><span class="op" id="1333100">(</span><span class="ident" id="1333101">p</span><span class="op" id="1333102">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333107">nn</span>&nbsp;<span class="op" id="1333110">-=</span>&nbsp;<span class="ident" id="1333113">nn</span>&nbsp;<span class="op" id="1333116">%</span>&nbsp;<span class="num" id="1333118">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333126">e</span><span class="op" id="1333127">.</span><span class="ident" id="1333128">enc</span><span class="op" id="1333131">.</span><span class="ident" id="1333132">Encode</span><span class="op" id="1333138">(</span><span class="ident" id="1333139">e</span><span class="op" id="1333140">.</span><span class="ident" id="1333141">out</span><span class="op" id="1333144">[</span><span class="num" id="1333145">0</span><span class="op" id="1333146">:</span><span class="op" id="1333147">]</span><span class="op" id="1333148">,</span>&nbsp;<span class="ident" id="1333150">p</span><span class="op" id="1333151">[</span><span class="num" id="1333152">0</span><span class="op" id="1333153">:</span><span class="ident" id="1333154">nn</span><span class="op" id="1333156">]</span><span class="op" id="1333157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333161">if</span>&nbsp;<span class="ident" id="1333164">_</span><span class="op" id="1333165">,</span>&nbsp;<span class="ident" id="1333167">e</span><span class="op" id="1333168">.</span><span class="ident" id="1333169">err</span>&nbsp;<span class="op" id="1333173">=</span>&nbsp;<span class="ident" id="1333175">e</span><span class="op" id="1333176">.</span><span class="ident" id="1333177">w</span><span class="op" id="1333178">.</span><span class="ident" id="1333179">Write</span><span class="op" id="1333184">(</span><span class="ident" id="1333185">e</span><span class="op" id="1333186">.</span><span class="ident" id="1333187">out</span><span class="op" id="1333190">[</span><span class="num" id="1333191">0</span>&nbsp;<span class="op" id="1333193">:</span>&nbsp;<span class="ident" id="1333195">nn</span><span class="op" id="1333197">/</span><span class="num" id="1333198">3</span><span class="op" id="1333199">*</span><span class="num" id="1333200">4</span><span class="op" id="1333201">]</span><span class="op" id="1333202">)</span><span class="op" id="1333203">;</span>&nbsp;<span class="ident" id="1333205">e</span><span class="op" id="1333206">.</span><span class="ident" id="1333207">err</span>&nbsp;<span class="op" id="1333211">!=</span>&nbsp;<span class="ident" id="1333214">nil</span>&nbsp;<span class="op" id="1333218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333223">return</span>&nbsp;<span class="ident" id="1333230">n</span><span class="op" id="1333231">,</span>&nbsp;<span class="ident" id="1333233">e</span><span class="op" id="1333234">.</span><span class="ident" id="1333235">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333245">n</span>&nbsp;<span class="op" id="1333247">+=</span>&nbsp;<span class="ident" id="1333250">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333255">p</span>&nbsp;<span class="op" id="1333257">=</span>&nbsp;<span class="ident" id="1333259">p</span><span class="op" id="1333260">[</span><span class="ident" id="1333261">nn</span><span class="op" id="1333263">:</span><span class="op" id="1333264">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333271">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333292">for</span>&nbsp;<span class="ident" id="1333296">i</span>&nbsp;<span class="op" id="1333298">:=</span>&nbsp;<span class="num" id="1333301">0</span><span class="op" id="1333302">;</span>&nbsp;<span class="ident" id="1333304">i</span>&nbsp;<span class="op" id="1333306">&lt;</span>&nbsp;<span class="builtinfunc" id="1333308">len</span><span class="op" id="1333311">(</span><span class="ident" id="1333312">p</span><span class="op" id="1333313">)</span><span class="op" id="1333314">;</span>&nbsp;<span class="ident" id="1333316">i</span><span class="op" id="1333317">++</span>&nbsp;<span class="op" id="1333320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333324">e</span><span class="op" id="1333325">.</span><span class="ident" id="1333326">buf</span><span class="op" id="1333329">[</span><span class="ident" id="1333330">i</span><span class="op" id="1333331">]</span>&nbsp;<span class="op" id="1333333">=</span>&nbsp;<span class="ident" id="1333335">p</span><span class="op" id="1333336">[</span><span class="ident" id="1333337">i</span><span class="op" id="1333338">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333344">e</span><span class="op" id="1333345">.</span><span class="ident" id="1333346">nbuf</span>&nbsp;<span class="op" id="1333351">=</span>&nbsp;<span class="builtinfunc" id="1333353">len</span><span class="op" id="1333356">(</span><span class="ident" id="1333357">p</span><span class="op" id="1333358">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333361">n</span>&nbsp;<span class="op" id="1333363">+=</span>&nbsp;<span class="builtinfunc" id="1333366">len</span><span class="op" id="1333369">(</span><span class="ident" id="1333370">p</span><span class="op" id="1333371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333374">return</span><br>
<span class="lineno"></span><span class="op" id="1333381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1333384">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno">180</span><span class="comment" id="1333438">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="1333491">func</span>&nbsp;<span class="op" id="1333496">(</span><span class="ident" id="1333497">e</span>&nbsp;<span class="op" id="1333499">*</span><span class="ident" id="1333500">encoder</span><span class="op" id="1333507">)</span>&nbsp;<span class="ident" id="1333509">Close</span><span class="op" id="1333514">(</span><span class="op" id="1333515">)</span>&nbsp;<span class="builtintype" id="1333517">error</span>&nbsp;<span class="op" id="1333523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333526">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333583">if</span>&nbsp;<span class="ident" id="1333586">e</span><span class="op" id="1333587">.</span><span class="ident" id="1333588">err</span>&nbsp;<span class="op" id="1333592">==</span>&nbsp;<span class="ident" id="1333595">nil</span>&nbsp;<span class="op" id="1333599">&amp;&amp;</span>&nbsp;<span class="ident" id="1333602">e</span><span class="op" id="1333603">.</span><span class="ident" id="1333604">nbuf</span>&nbsp;<span class="op" id="1333609">&gt;</span>&nbsp;<span class="num" id="1333611">0</span>&nbsp;<span class="op" id="1333613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333617">e</span><span class="op" id="1333618">.</span><span class="ident" id="1333619">enc</span><span class="op" id="1333622">.</span><span class="ident" id="1333623">Encode</span><span class="op" id="1333629">(</span><span class="ident" id="1333630">e</span><span class="op" id="1333631">.</span><span class="ident" id="1333632">out</span><span class="op" id="1333635">[</span><span class="num" id="1333636">0</span><span class="op" id="1333637">:</span><span class="op" id="1333638">]</span><span class="op" id="1333639">,</span>&nbsp;<span class="ident" id="1333641">e</span><span class="op" id="1333642">.</span><span class="ident" id="1333643">buf</span><span class="op" id="1333646">[</span><span class="num" id="1333647">0</span><span class="op" id="1333648">:</span><span class="ident" id="1333649">e</span><span class="op" id="1333650">.</span><span class="ident" id="1333651">nbuf</span><span class="op" id="1333655">]</span><span class="op" id="1333656">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333660">e</span><span class="op" id="1333661">.</span><span class="ident" id="1333662">nbuf</span>&nbsp;<span class="op" id="1333667">=</span>&nbsp;<span class="num" id="1333669">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333673">_</span><span class="op" id="1333674">,</span>&nbsp;<span class="ident" id="1333676">e</span><span class="op" id="1333677">.</span><span class="ident" id="1333678">err</span>&nbsp;<span class="op" id="1333682">=</span>&nbsp;<span class="ident" id="1333684">e</span><span class="op" id="1333685">.</span><span class="ident" id="1333686">w</span><span class="op" id="1333687">.</span><span class="ident" id="1333688">Write</span><span class="op" id="1333693">(</span><span class="ident" id="1333694">e</span><span class="op" id="1333695">.</span><span class="ident" id="1333696">out</span><span class="op" id="1333699">[</span><span class="num" id="1333700">0</span><span class="op" id="1333701">:</span><span class="num" id="1333702">4</span><span class="op" id="1333703">]</span><span class="op" id="1333704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333710">return</span>&nbsp;<span class="ident" id="1333717">e</span><span class="op" id="1333718">.</span><span class="ident" id="1333719">err</span><br>
<span class="lineno"></span><span class="op" id="1333723">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="1333726">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1333794">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;using&nbsp;enc&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="1333866">//&nbsp;Base64&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;4-byte&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="1333926">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno">195</span><span class="comment" id="1333994">//&nbsp;partially&nbsp;written&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="1334023">func</span>&nbsp;<span class="ident" id="1334028">NewEncoder</span><span class="op" id="1334038">(</span><span class="ident" id="1334039">enc</span>&nbsp;<span class="op" id="1334043">*</span><span class="ident" id="1334044">Encoding</span><span class="op" id="1334052">,</span>&nbsp;<span class="ident" id="1334054">w</span>&nbsp;<span class="ident" id="1334056">io</span><span class="op" id="1334058">.</span><span class="ident" id="1334059">Writer</span><span class="op" id="1334065">)</span>&nbsp;<span class="ident" id="1334067">io</span><span class="op" id="1334069">.</span><span class="ident" id="1334070">WriteCloser</span>&nbsp;<span class="op" id="1334082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334085">return</span>&nbsp;<span class="op" id="1334092">&amp;</span><span class="ident" id="1334093">encoder</span><span class="op" id="1334100">{</span><span class="ident" id="1334101">enc</span><span class="op" id="1334104">:</span>&nbsp;<span class="ident" id="1334106">enc</span><span class="op" id="1334109">,</span>&nbsp;<span class="ident" id="1334111">w</span><span class="op" id="1334112">:</span>&nbsp;<span class="ident" id="1334114">w</span><span class="op" id="1334115">}</span><br>
<span class="lineno"></span><span class="op" id="1334117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="1334120">//&nbsp;EncodedLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;base64&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="1334185">//&nbsp;of&nbsp;an&nbsp;input&nbsp;buffer&nbsp;of&nbsp;length&nbsp;n.</span><br>
<span class="lineno"></span><span class="keyword" id="1334220">func</span>&nbsp;<span class="op" id="1334225">(</span><span class="ident" id="1334226">enc</span>&nbsp;<span class="op" id="1334230">*</span><span class="ident" id="1334231">Encoding</span><span class="op" id="1334239">)</span>&nbsp;<span class="ident" id="1334241">EncodedLen</span><span class="op" id="1334251">(</span><span class="ident" id="1334252">n</span>&nbsp;<span class="builtintype" id="1334254">int</span><span class="op" id="1334257">)</span>&nbsp;<span class="builtintype" id="1334259">int</span>&nbsp;<span class="op" id="1334263">{</span>&nbsp;<span class="keyword" id="1334265">return</span>&nbsp;<span class="op" id="1334272">(</span><span class="ident" id="1334273">n</span>&nbsp;<span class="op" id="1334275">+</span>&nbsp;<span class="num" id="1334277">2</span><span class="op" id="1334278">)</span>&nbsp;<span class="op" id="1334280">/</span>&nbsp;<span class="num" id="1334282">3</span>&nbsp;<span class="op" id="1334284">*</span>&nbsp;<span class="num" id="1334286">4</span>&nbsp;<span class="op" id="1334288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1334291">/*<br>
<span class="lineno">205</span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1334310">type</span>&nbsp;<span class="ident" id="1334315">CorruptInputError</span>&nbsp;<span class="ident" id="1334333">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="1334340">func</span>&nbsp;<span class="op" id="1334345">(</span><span class="ident" id="1334346">e</span>&nbsp;<span class="ident" id="1334348">CorruptInputError</span><span class="op" id="1334365">)</span>&nbsp;<span class="ident" id="1334367">Error</span><span class="op" id="1334372">(</span><span class="op" id="1334373">)</span>&nbsp;<span class="builtintype" id="1334375">string</span>&nbsp;<span class="op" id="1334382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334385">return</span>&nbsp;<span class="string" id="1334392">&#34;illegal&nbsp;base64&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="1334429">+</span>&nbsp;<span class="ident" id="1334431">strconv</span><span class="op" id="1334438">.</span><span class="ident" id="1334439">FormatInt</span><span class="op" id="1334448">(</span><span class="ident" id="1334449">int64</span><span class="op" id="1334454">(</span><span class="ident" id="1334455">e</span><span class="op" id="1334456">)</span><span class="op" id="1334457">,</span>&nbsp;<span class="num" id="1334459">10</span><span class="op" id="1334461">)</span><br>
<span class="lineno"></span><span class="op" id="1334463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1334466">//&nbsp;decode&nbsp;is&nbsp;like&nbsp;Decode&nbsp;but&nbsp;returns&nbsp;an&nbsp;additional&nbsp;&#39;end&#39;&nbsp;value,&nbsp;which</span><br>
<span class="lineno">215</span><span class="comment" id="1334536">//&nbsp;indicates&nbsp;if&nbsp;end-of-message&nbsp;padding&nbsp;was&nbsp;encountered&nbsp;and&nbsp;thus&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="1334604">//&nbsp;additional&nbsp;data&nbsp;is&nbsp;an&nbsp;error.&nbsp;This&nbsp;method&nbsp;assumes&nbsp;that&nbsp;src&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span><span class="comment" id="1334674">//&nbsp;stripped&nbsp;of&nbsp;all&nbsp;supported&nbsp;whitespace&nbsp;(&#39;\r&#39;&nbsp;and&nbsp;&#39;\n&#39;).</span><br>
<span class="lineno"></span><span class="keyword" id="1334731">func</span>&nbsp;<span class="op" id="1334736">(</span><span class="ident" id="1334737">enc</span>&nbsp;<span class="op" id="1334741">*</span><span class="ident" id="1334742">Encoding</span><span class="op" id="1334750">)</span>&nbsp;<span class="ident" id="1334752">decode</span><span class="op" id="1334758">(</span><span class="ident" id="1334759">dst</span><span class="op" id="1334762">,</span>&nbsp;<span class="ident" id="1334764">src</span>&nbsp;<span class="op" id="1334768">[</span><span class="op" id="1334769">]</span><span class="builtintype" id="1334770">byte</span><span class="op" id="1334774">)</span>&nbsp;<span class="op" id="1334776">(</span><span class="ident" id="1334777">n</span>&nbsp;<span class="builtintype" id="1334779">int</span><span class="op" id="1334782">,</span>&nbsp;<span class="ident" id="1334784">end</span>&nbsp;<span class="builtintype" id="1334788">bool</span><span class="op" id="1334792">,</span>&nbsp;<span class="ident" id="1334794">err</span>&nbsp;<span class="builtintype" id="1334798">error</span><span class="op" id="1334803">)</span>&nbsp;<span class="op" id="1334805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334808">olen</span>&nbsp;<span class="op" id="1334813">:=</span>&nbsp;<span class="builtinfunc" id="1334816">len</span><span class="op" id="1334819">(</span><span class="ident" id="1334820">src</span><span class="op" id="1334823">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334826">for</span>&nbsp;<span class="builtinfunc" id="1334830">len</span><span class="op" id="1334833">(</span><span class="ident" id="1334834">src</span><span class="op" id="1334837">)</span>&nbsp;<span class="op" id="1334839">&gt;</span>&nbsp;<span class="num" id="1334841">0</span>&nbsp;<span class="op" id="1334843">&amp;&amp;</span>&nbsp;<span class="op" id="1334846">!</span><span class="ident" id="1334847">end</span>&nbsp;<span class="op" id="1334851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1334855">//&nbsp;Decode&nbsp;quantum&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334901">var</span>&nbsp;<span class="ident" id="1334905">dbuf</span>&nbsp;<span class="op" id="1334910">[</span><span class="num" id="1334911">4</span><span class="op" id="1334912">]</span><span class="builtintype" id="1334913">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334920">dlen</span>&nbsp;<span class="op" id="1334925">:=</span>&nbsp;<span class="num" id="1334928">4</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334933">for</span>&nbsp;<span class="ident" id="1334937">j</span>&nbsp;<span class="op" id="1334939">:=</span>&nbsp;<span class="keyword" id="1334942">range</span>&nbsp;<span class="ident" id="1334948">dbuf</span>&nbsp;<span class="op" id="1334953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334958">if</span>&nbsp;<span class="builtinfunc" id="1334961">len</span><span class="op" id="1334964">(</span><span class="ident" id="1334965">src</span><span class="op" id="1334968">)</span>&nbsp;<span class="op" id="1334970">==</span>&nbsp;<span class="num" id="1334973">0</span>&nbsp;<span class="op" id="1334975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334981">return</span>&nbsp;<span class="ident" id="1334988">n</span><span class="op" id="1334989">,</span>&nbsp;<span class="builtintype" id="1334991">false</span><span class="op" id="1334996">,</span>&nbsp;<span class="ident" id="1334998">CorruptInputError</span><span class="op" id="1335015">(</span><span class="ident" id="1335016">olen</span>&nbsp;<span class="op" id="1335021">-</span>&nbsp;<span class="builtinfunc" id="1335023">len</span><span class="op" id="1335026">(</span><span class="ident" id="1335027">src</span><span class="op" id="1335030">)</span>&nbsp;<span class="op" id="1335032">-</span>&nbsp;<span class="ident" id="1335034">j</span><span class="op" id="1335035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335045">in</span>&nbsp;<span class="op" id="1335048">:=</span>&nbsp;<span class="ident" id="1335051">src</span><span class="op" id="1335054">[</span><span class="num" id="1335055">0</span><span class="op" id="1335056">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335061">src</span>&nbsp;<span class="op" id="1335065">=</span>&nbsp;<span class="ident" id="1335067">src</span><span class="op" id="1335070">[</span><span class="num" id="1335071">1</span><span class="op" id="1335072">:</span><span class="op" id="1335073">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335078">if</span>&nbsp;<span class="ident" id="1335081">in</span>&nbsp;<span class="op" id="1335084">==</span>&nbsp;<span class="string" id="1335087">&#39;=&#39;</span>&nbsp;<span class="op" id="1335091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1335097">//&nbsp;We&#39;ve&nbsp;reached&nbsp;the&nbsp;end&nbsp;and&nbsp;there&#39;s&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335146">switch</span>&nbsp;<span class="ident" id="1335153">j</span>&nbsp;<span class="op" id="1335155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335161">case</span>&nbsp;<span class="num" id="1335166">0</span><span class="op" id="1335167">,</span>&nbsp;<span class="num" id="1335169">1</span><span class="op" id="1335170">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1335177">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335203">return</span>&nbsp;<span class="ident" id="1335210">n</span><span class="op" id="1335211">,</span>&nbsp;<span class="builtintype" id="1335213">false</span><span class="op" id="1335218">,</span>&nbsp;<span class="ident" id="1335220">CorruptInputError</span><span class="op" id="1335237">(</span><span class="ident" id="1335238">olen</span>&nbsp;<span class="op" id="1335243">-</span>&nbsp;<span class="builtinfunc" id="1335245">len</span><span class="op" id="1335248">(</span><span class="ident" id="1335249">src</span><span class="op" id="1335252">)</span>&nbsp;<span class="op" id="1335254">-</span>&nbsp;<span class="num" id="1335256">1</span><span class="op" id="1335257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335263">case</span>&nbsp;<span class="num" id="1335268">2</span><span class="op" id="1335269">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1335276">//&nbsp;&#34;==&#34;&nbsp;is&nbsp;expected,&nbsp;the&nbsp;first&nbsp;&#34;=&#34;&nbsp;is&nbsp;already&nbsp;consumed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335337">if</span>&nbsp;<span class="builtinfunc" id="1335340">len</span><span class="op" id="1335343">(</span><span class="ident" id="1335344">src</span><span class="op" id="1335347">)</span>&nbsp;<span class="op" id="1335349">==</span>&nbsp;<span class="num" id="1335352">0</span>&nbsp;<span class="op" id="1335354">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1335362">//&nbsp;not&nbsp;enough&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335390">return</span>&nbsp;<span class="ident" id="1335397">n</span><span class="op" id="1335398">,</span>&nbsp;<span class="builtintype" id="1335400">false</span><span class="op" id="1335405">,</span>&nbsp;<span class="ident" id="1335407">CorruptInputError</span><span class="op" id="1335424">(</span><span class="ident" id="1335425">olen</span><span class="op" id="1335429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335443">if</span>&nbsp;<span class="ident" id="1335446">src</span><span class="op" id="1335449">[</span><span class="num" id="1335450">0</span><span class="op" id="1335451">]</span>&nbsp;<span class="op" id="1335453">!=</span>&nbsp;<span class="string" id="1335456">&#39;=&#39;</span>&nbsp;<span class="op" id="1335460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1335468">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335495">return</span>&nbsp;<span class="ident" id="1335502">n</span><span class="op" id="1335503">,</span>&nbsp;<span class="builtintype" id="1335505">false</span><span class="op" id="1335510">,</span>&nbsp;<span class="ident" id="1335512">CorruptInputError</span><span class="op" id="1335529">(</span><span class="ident" id="1335530">olen</span>&nbsp;<span class="op" id="1335535">-</span>&nbsp;<span class="builtinfunc" id="1335537">len</span><span class="op" id="1335540">(</span><span class="ident" id="1335541">src</span><span class="op" id="1335544">)</span>&nbsp;<span class="op" id="1335546">-</span>&nbsp;<span class="num" id="1335548">1</span><span class="op" id="1335549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335563">src</span>&nbsp;<span class="op" id="1335567">=</span>&nbsp;<span class="ident" id="1335569">src</span><span class="op" id="1335572">[</span><span class="num" id="1335573">1</span><span class="op" id="1335574">:</span><span class="op" id="1335575">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335587">if</span>&nbsp;<span class="builtinfunc" id="1335590">len</span><span class="op" id="1335593">(</span><span class="ident" id="1335594">src</span><span class="op" id="1335597">)</span>&nbsp;<span class="op" id="1335599">&gt;</span>&nbsp;<span class="num" id="1335601">0</span>&nbsp;<span class="op" id="1335603">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1335610">//&nbsp;trailing&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335635">err</span>&nbsp;<span class="op" id="1335639">=</span>&nbsp;<span class="ident" id="1335641">CorruptInputError</span><span class="op" id="1335658">(</span><span class="ident" id="1335659">olen</span>&nbsp;<span class="op" id="1335664">-</span>&nbsp;<span class="builtinfunc" id="1335666">len</span><span class="op" id="1335669">(</span><span class="ident" id="1335670">src</span><span class="op" id="1335673">)</span><span class="op" id="1335674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335686">dlen</span><span class="op" id="1335690">,</span>&nbsp;<span class="ident" id="1335692">end</span>&nbsp;<span class="op" id="1335696">=</span>&nbsp;<span class="ident" id="1335698">j</span><span class="op" id="1335699">,</span>&nbsp;<span class="builtintype" id="1335701">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335710">break</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335724">dbuf</span><span class="op" id="1335728">[</span><span class="ident" id="1335729">j</span><span class="op" id="1335730">]</span>&nbsp;<span class="op" id="1335732">=</span>&nbsp;<span class="ident" id="1335734">enc</span><span class="op" id="1335737">.</span><span class="ident" id="1335738">decodeMap</span><span class="op" id="1335747">[</span><span class="ident" id="1335748">in</span><span class="op" id="1335750">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335755">if</span>&nbsp;<span class="ident" id="1335758">dbuf</span><span class="op" id="1335762">[</span><span class="ident" id="1335763">j</span><span class="op" id="1335764">]</span>&nbsp;<span class="op" id="1335766">==</span>&nbsp;<span class="num" id="1335769">0xFF</span>&nbsp;<span class="op" id="1335774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335780">return</span>&nbsp;<span class="ident" id="1335787">n</span><span class="op" id="1335788">,</span>&nbsp;<span class="builtintype" id="1335790">false</span><span class="op" id="1335795">,</span>&nbsp;<span class="ident" id="1335797">CorruptInputError</span><span class="op" id="1335814">(</span><span class="ident" id="1335815">olen</span>&nbsp;<span class="op" id="1335820">-</span>&nbsp;<span class="builtinfunc" id="1335822">len</span><span class="op" id="1335825">(</span><span class="ident" id="1335826">src</span><span class="op" id="1335829">)</span>&nbsp;<span class="op" id="1335831">-</span>&nbsp;<span class="num" id="1335833">1</span><span class="op" id="1335834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335839">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1335848">//&nbsp;Pack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;3&nbsp;byte&nbsp;destination</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1335905">//&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335918">switch</span>&nbsp;<span class="ident" id="1335925">dlen</span>&nbsp;<span class="op" id="1335930">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335934">case</span>&nbsp;<span class="num" id="1335939">4</span><span class="op" id="1335940">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335945">dst</span><span class="op" id="1335948">[</span><span class="num" id="1335949">2</span><span class="op" id="1335950">]</span>&nbsp;<span class="op" id="1335952">=</span>&nbsp;<span class="ident" id="1335954">dbuf</span><span class="op" id="1335958">[</span><span class="num" id="1335959">2</span><span class="op" id="1335960">]</span><span class="op" id="1335961">&lt;&lt;</span><span class="num" id="1335963">6</span>&nbsp;<span class="op" id="1335965">|</span>&nbsp;<span class="ident" id="1335967">dbuf</span><span class="op" id="1335971">[</span><span class="num" id="1335972">3</span><span class="op" id="1335973">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335978">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335992">case</span>&nbsp;<span class="num" id="1335997">3</span><span class="op" id="1335998">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336003">dst</span><span class="op" id="1336006">[</span><span class="num" id="1336007">1</span><span class="op" id="1336008">]</span>&nbsp;<span class="op" id="1336010">=</span>&nbsp;<span class="ident" id="1336012">dbuf</span><span class="op" id="1336016">[</span><span class="num" id="1336017">1</span><span class="op" id="1336018">]</span><span class="op" id="1336019">&lt;&lt;</span><span class="num" id="1336021">4</span>&nbsp;<span class="op" id="1336023">|</span>&nbsp;<span class="ident" id="1336025">dbuf</span><span class="op" id="1336029">[</span><span class="num" id="1336030">2</span><span class="op" id="1336031">]</span><span class="op" id="1336032">&gt;&gt;</span><span class="num" id="1336034">2</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336039">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336053">case</span>&nbsp;<span class="num" id="1336058">2</span><span class="op" id="1336059">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336064">dst</span><span class="op" id="1336067">[</span><span class="num" id="1336068">0</span><span class="op" id="1336069">]</span>&nbsp;<span class="op" id="1336071">=</span>&nbsp;<span class="ident" id="1336073">dbuf</span><span class="op" id="1336077">[</span><span class="num" id="1336078">0</span><span class="op" id="1336079">]</span><span class="op" id="1336080">&lt;&lt;</span><span class="num" id="1336082">2</span>&nbsp;<span class="op" id="1336084">|</span>&nbsp;<span class="ident" id="1336086">dbuf</span><span class="op" id="1336090">[</span><span class="num" id="1336091">1</span><span class="op" id="1336092">]</span><span class="op" id="1336093">&gt;&gt;</span><span class="num" id="1336095">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336103">dst</span>&nbsp;<span class="op" id="1336107">=</span>&nbsp;<span class="ident" id="1336109">dst</span><span class="op" id="1336112">[</span><span class="num" id="1336113">3</span><span class="op" id="1336114">:</span><span class="op" id="1336115">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336119">n</span>&nbsp;<span class="op" id="1336121">+=</span>&nbsp;<span class="ident" id="1336124">dlen</span>&nbsp;<span class="op" id="1336129">-</span>&nbsp;<span class="num" id="1336131">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336138">return</span>&nbsp;<span class="ident" id="1336145">n</span><span class="op" id="1336146">,</span>&nbsp;<span class="ident" id="1336148">end</span><span class="op" id="1336151">,</span>&nbsp;<span class="ident" id="1336153">err</span><br>
<span class="lineno"></span><span class="op" id="1336157">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="1336160">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc.&nbsp;&nbsp;It&nbsp;writes&nbsp;at&nbsp;most</span><br>
<span class="lineno"></span><span class="comment" id="1336225">//&nbsp;DecodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes</span><br>
<span class="lineno"></span><span class="comment" id="1336294">//&nbsp;written.&nbsp;&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;base64&nbsp;data,&nbsp;it&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1336363">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;CorruptInputError.</span><br>
<span class="lineno">285</span><span class="comment" id="1336426">//&nbsp;New&nbsp;line&nbsp;characters&nbsp;(\r&nbsp;and&nbsp;\n)&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="1336474">func</span>&nbsp;<span class="op" id="1336479">(</span><span class="ident" id="1336480">enc</span>&nbsp;<span class="op" id="1336484">*</span><span class="ident" id="1336485">Encoding</span><span class="op" id="1336493">)</span>&nbsp;<span class="ident" id="1336495">Decode</span><span class="op" id="1336501">(</span><span class="ident" id="1336502">dst</span><span class="op" id="1336505">,</span>&nbsp;<span class="ident" id="1336507">src</span>&nbsp;<span class="op" id="1336511">[</span><span class="op" id="1336512">]</span><span class="builtintype" id="1336513">byte</span><span class="op" id="1336517">)</span>&nbsp;<span class="op" id="1336519">(</span><span class="ident" id="1336520">n</span>&nbsp;<span class="builtintype" id="1336522">int</span><span class="op" id="1336525">,</span>&nbsp;<span class="ident" id="1336527">err</span>&nbsp;<span class="builtintype" id="1336531">error</span><span class="op" id="1336536">)</span>&nbsp;<span class="op" id="1336538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336541">src</span>&nbsp;<span class="op" id="1336545">=</span>&nbsp;<span class="ident" id="1336547">bytes</span><span class="op" id="1336552">.</span><span class="ident" id="1336553">Map</span><span class="op" id="1336556">(</span><span class="ident" id="1336557">removeNewlinesMapper</span><span class="op" id="1336577">,</span>&nbsp;<span class="ident" id="1336579">src</span><span class="op" id="1336582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336585">n</span><span class="op" id="1336586">,</span>&nbsp;<span class="ident" id="1336588">_</span><span class="op" id="1336589">,</span>&nbsp;<span class="ident" id="1336591">err</span>&nbsp;<span class="op" id="1336595">=</span>&nbsp;<span class="ident" id="1336597">enc</span><span class="op" id="1336600">.</span><span class="ident" id="1336601">decode</span><span class="op" id="1336607">(</span><span class="ident" id="1336608">dst</span><span class="op" id="1336611">,</span>&nbsp;<span class="ident" id="1336613">src</span><span class="op" id="1336616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336619">return</span><br>
<span class="lineno">290</span><span class="op" id="1336626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1336629">//&nbsp;DecodeString&nbsp;returns&nbsp;the&nbsp;bytes&nbsp;represented&nbsp;by&nbsp;the&nbsp;base64&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="1336699">func</span>&nbsp;<span class="op" id="1336704">(</span><span class="ident" id="1336705">enc</span>&nbsp;<span class="op" id="1336709">*</span><span class="ident" id="1336710">Encoding</span><span class="op" id="1336718">)</span>&nbsp;<span class="ident" id="1336720">DecodeString</span><span class="op" id="1336732">(</span><span class="ident" id="1336733">s</span>&nbsp;<span class="builtintype" id="1336735">string</span><span class="op" id="1336741">)</span>&nbsp;<span class="op" id="1336743">(</span><span class="op" id="1336744">[</span><span class="op" id="1336745">]</span><span class="builtintype" id="1336746">byte</span><span class="op" id="1336750">,</span>&nbsp;<span class="builtintype" id="1336752">error</span><span class="op" id="1336757">)</span>&nbsp;<span class="op" id="1336759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336762">s</span>&nbsp;<span class="op" id="1336764">=</span>&nbsp;<span class="ident" id="1336766">strings</span><span class="op" id="1336773">.</span><span class="ident" id="1336774">Map</span><span class="op" id="1336777">(</span><span class="ident" id="1336778">removeNewlinesMapper</span><span class="op" id="1336798">,</span>&nbsp;<span class="ident" id="1336800">s</span><span class="op" id="1336801">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336804">dbuf</span>&nbsp;<span class="op" id="1336809">:=</span>&nbsp;<span class="builtinfunc" id="1336812">make</span><span class="op" id="1336816">(</span><span class="op" id="1336817">[</span><span class="op" id="1336818">]</span><span class="builtintype" id="1336819">byte</span><span class="op" id="1336823">,</span>&nbsp;<span class="ident" id="1336825">enc</span><span class="op" id="1336828">.</span><span class="ident" id="1336829">DecodedLen</span><span class="op" id="1336839">(</span><span class="builtinfunc" id="1336840">len</span><span class="op" id="1336843">(</span><span class="ident" id="1336844">s</span><span class="op" id="1336845">)</span><span class="op" id="1336846">)</span><span class="op" id="1336847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336850">n</span><span class="op" id="1336851">,</span>&nbsp;<span class="ident" id="1336853">_</span><span class="op" id="1336854">,</span>&nbsp;<span class="ident" id="1336856">err</span>&nbsp;<span class="op" id="1336860">:=</span>&nbsp;<span class="ident" id="1336863">enc</span><span class="op" id="1336866">.</span><span class="ident" id="1336867">decode</span><span class="op" id="1336873">(</span><span class="ident" id="1336874">dbuf</span><span class="op" id="1336878">,</span>&nbsp;<span class="op" id="1336880">[</span><span class="op" id="1336881">]</span><span class="builtintype" id="1336882">byte</span><span class="op" id="1336886">(</span><span class="ident" id="1336887">s</span><span class="op" id="1336888">)</span><span class="op" id="1336889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336892">return</span>&nbsp;<span class="ident" id="1336899">dbuf</span><span class="op" id="1336903">[</span><span class="op" id="1336904">:</span><span class="ident" id="1336905">n</span><span class="op" id="1336906">]</span><span class="op" id="1336907">,</span>&nbsp;<span class="ident" id="1336909">err</span><br>
<span class="lineno"></span><span class="op" id="1336913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="1336916">type</span>&nbsp;<span class="ident" id="1336921">decoder</span>&nbsp;<span class="keyword" id="1336929">struct</span>&nbsp;<span class="op" id="1336936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336939">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1336946">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336953">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1336960">*</span><span class="ident" id="1336961">Encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336971">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1336978">io</span><span class="op" id="1336980">.</span><span class="ident" id="1336981">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336989">end</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1336996">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1337007">//&nbsp;saw&nbsp;end&nbsp;of&nbsp;message</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337030">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337037">[</span><span class="num" id="1337038">1024</span><span class="op" id="1337042">]</span><span class="builtintype" id="1337043">byte</span>&nbsp;<span class="comment" id="1337048">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337067">nbuf</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1337074">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337079">out</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1337086">[</span><span class="op" id="1337087">]</span><span class="builtintype" id="1337088">byte</span>&nbsp;<span class="comment" id="1337093">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337121">outbuf</span>&nbsp;<span class="op" id="1337128">[</span><span class="num" id="1337129">1024</span>&nbsp;<span class="op" id="1337134">/</span>&nbsp;<span class="num" id="1337136">4</span>&nbsp;<span class="op" id="1337138">*</span>&nbsp;<span class="num" id="1337140">3</span><span class="op" id="1337141">]</span><span class="builtintype" id="1337142">byte</span><br>
<span class="lineno"></span><span class="op" id="1337147">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="1337150">func</span>&nbsp;<span class="op" id="1337155">(</span><span class="ident" id="1337156">d</span>&nbsp;<span class="op" id="1337158">*</span><span class="ident" id="1337159">decoder</span><span class="op" id="1337166">)</span>&nbsp;<span class="ident" id="1337168">Read</span><span class="op" id="1337172">(</span><span class="ident" id="1337173">p</span>&nbsp;<span class="op" id="1337175">[</span><span class="op" id="1337176">]</span><span class="builtintype" id="1337177">byte</span><span class="op" id="1337181">)</span>&nbsp;<span class="op" id="1337183">(</span><span class="ident" id="1337184">n</span>&nbsp;<span class="builtintype" id="1337186">int</span><span class="op" id="1337189">,</span>&nbsp;<span class="ident" id="1337191">err</span>&nbsp;<span class="builtintype" id="1337195">error</span><span class="op" id="1337200">)</span>&nbsp;<span class="op" id="1337202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337205">if</span>&nbsp;<span class="ident" id="1337208">d</span><span class="op" id="1337209">.</span><span class="ident" id="1337210">err</span>&nbsp;<span class="op" id="1337214">!=</span>&nbsp;<span class="ident" id="1337217">nil</span>&nbsp;<span class="op" id="1337221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337225">return</span>&nbsp;<span class="num" id="1337232">0</span><span class="op" id="1337233">,</span>&nbsp;<span class="ident" id="1337235">d</span><span class="op" id="1337236">.</span><span class="ident" id="1337237">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337242">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1337246">//&nbsp;Use&nbsp;leftover&nbsp;decoded&nbsp;output&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337294">if</span>&nbsp;<span class="builtinfunc" id="1337297">len</span><span class="op" id="1337300">(</span><span class="ident" id="1337301">d</span><span class="op" id="1337302">.</span><span class="ident" id="1337303">out</span><span class="op" id="1337306">)</span>&nbsp;<span class="op" id="1337308">&gt;</span>&nbsp;<span class="num" id="1337310">0</span>&nbsp;<span class="op" id="1337312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337316">n</span>&nbsp;<span class="op" id="1337318">=</span>&nbsp;<span class="builtinfunc" id="1337320">copy</span><span class="op" id="1337324">(</span><span class="ident" id="1337325">p</span><span class="op" id="1337326">,</span>&nbsp;<span class="ident" id="1337328">d</span><span class="op" id="1337329">.</span><span class="ident" id="1337330">out</span><span class="op" id="1337333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337337">d</span><span class="op" id="1337338">.</span><span class="ident" id="1337339">out</span>&nbsp;<span class="op" id="1337343">=</span>&nbsp;<span class="ident" id="1337345">d</span><span class="op" id="1337346">.</span><span class="ident" id="1337347">out</span><span class="op" id="1337350">[</span><span class="ident" id="1337351">n</span><span class="op" id="1337352">:</span><span class="op" id="1337353">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337357">return</span>&nbsp;<span class="ident" id="1337364">n</span><span class="op" id="1337365">,</span>&nbsp;<span class="ident" id="1337367">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1337376">//&nbsp;Read&nbsp;a&nbsp;chunk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337394">nn</span>&nbsp;<span class="op" id="1337397">:=</span>&nbsp;<span class="builtinfunc" id="1337400">len</span><span class="op" id="1337403">(</span><span class="ident" id="1337404">p</span><span class="op" id="1337405">)</span>&nbsp;<span class="op" id="1337407">/</span>&nbsp;<span class="num" id="1337409">3</span>&nbsp;<span class="op" id="1337411">*</span>&nbsp;<span class="num" id="1337413">4</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337416">if</span>&nbsp;<span class="ident" id="1337419">nn</span>&nbsp;<span class="op" id="1337422">&lt;</span>&nbsp;<span class="num" id="1337424">4</span>&nbsp;<span class="op" id="1337426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337430">nn</span>&nbsp;<span class="op" id="1337433">=</span>&nbsp;<span class="num" id="1337435">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337441">if</span>&nbsp;<span class="ident" id="1337444">nn</span>&nbsp;<span class="op" id="1337447">&gt;</span>&nbsp;<span class="builtinfunc" id="1337449">len</span><span class="op" id="1337452">(</span><span class="ident" id="1337453">d</span><span class="op" id="1337454">.</span><span class="ident" id="1337455">buf</span><span class="op" id="1337458">)</span>&nbsp;<span class="op" id="1337460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337464">nn</span>&nbsp;<span class="op" id="1337467">=</span>&nbsp;<span class="builtinfunc" id="1337469">len</span><span class="op" id="1337472">(</span><span class="ident" id="1337473">d</span><span class="op" id="1337474">.</span><span class="ident" id="1337475">buf</span><span class="op" id="1337478">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337484">nn</span><span class="op" id="1337486">,</span>&nbsp;<span class="ident" id="1337488">d</span><span class="op" id="1337489">.</span><span class="ident" id="1337490">err</span>&nbsp;<span class="op" id="1337494">=</span>&nbsp;<span class="ident" id="1337496">io</span><span class="op" id="1337498">.</span><span class="ident" id="1337499">ReadAtLeast</span><span class="op" id="1337510">(</span><span class="ident" id="1337511">d</span><span class="op" id="1337512">.</span><span class="ident" id="1337513">r</span><span class="op" id="1337514">,</span>&nbsp;<span class="ident" id="1337516">d</span><span class="op" id="1337517">.</span><span class="ident" id="1337518">buf</span><span class="op" id="1337521">[</span><span class="ident" id="1337522">d</span><span class="op" id="1337523">.</span><span class="ident" id="1337524">nbuf</span><span class="op" id="1337528">:</span><span class="ident" id="1337529">nn</span><span class="op" id="1337531">]</span><span class="op" id="1337532">,</span>&nbsp;<span class="num" id="1337534">4</span><span class="op" id="1337535">-</span><span class="ident" id="1337536">d</span><span class="op" id="1337537">.</span><span class="ident" id="1337538">nbuf</span><span class="op" id="1337542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337545">d</span><span class="op" id="1337546">.</span><span class="ident" id="1337547">nbuf</span>&nbsp;<span class="op" id="1337552">+=</span>&nbsp;<span class="ident" id="1337555">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337559">if</span>&nbsp;<span class="ident" id="1337562">d</span><span class="op" id="1337563">.</span><span class="ident" id="1337564">err</span>&nbsp;<span class="op" id="1337568">!=</span>&nbsp;<span class="ident" id="1337571">nil</span>&nbsp;<span class="op" id="1337575">||</span>&nbsp;<span class="ident" id="1337578">d</span><span class="op" id="1337579">.</span><span class="ident" id="1337580">nbuf</span>&nbsp;<span class="op" id="1337585">&lt;</span>&nbsp;<span class="num" id="1337587">4</span>&nbsp;<span class="op" id="1337589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337593">return</span>&nbsp;<span class="num" id="1337600">0</span><span class="op" id="1337601">,</span>&nbsp;<span class="ident" id="1337603">d</span><span class="op" id="1337604">.</span><span class="ident" id="1337605">err</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1337614">//&nbsp;Decode&nbsp;chunk&nbsp;into&nbsp;p,&nbsp;or&nbsp;d.out&nbsp;and&nbsp;then&nbsp;p&nbsp;if&nbsp;p&nbsp;is&nbsp;too&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337678">nr</span>&nbsp;<span class="op" id="1337681">:=</span>&nbsp;<span class="ident" id="1337684">d</span><span class="op" id="1337685">.</span><span class="ident" id="1337686">nbuf</span>&nbsp;<span class="op" id="1337691">/</span>&nbsp;<span class="num" id="1337693">4</span>&nbsp;<span class="op" id="1337695">*</span>&nbsp;<span class="num" id="1337697">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337700">nw</span>&nbsp;<span class="op" id="1337703">:=</span>&nbsp;<span class="ident" id="1337706">d</span><span class="op" id="1337707">.</span><span class="ident" id="1337708">nbuf</span>&nbsp;<span class="op" id="1337713">/</span>&nbsp;<span class="num" id="1337715">4</span>&nbsp;<span class="op" id="1337717">*</span>&nbsp;<span class="num" id="1337719">3</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337722">if</span>&nbsp;<span class="ident" id="1337725">nw</span>&nbsp;<span class="op" id="1337728">&gt;</span>&nbsp;<span class="builtinfunc" id="1337730">len</span><span class="op" id="1337733">(</span><span class="ident" id="1337734">p</span><span class="op" id="1337735">)</span>&nbsp;<span class="op" id="1337737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337741">nw</span><span class="op" id="1337743">,</span>&nbsp;<span class="ident" id="1337745">d</span><span class="op" id="1337746">.</span><span class="ident" id="1337747">end</span><span class="op" id="1337750">,</span>&nbsp;<span class="ident" id="1337752">d</span><span class="op" id="1337753">.</span><span class="ident" id="1337754">err</span>&nbsp;<span class="op" id="1337758">=</span>&nbsp;<span class="ident" id="1337760">d</span><span class="op" id="1337761">.</span><span class="ident" id="1337762">enc</span><span class="op" id="1337765">.</span><span class="ident" id="1337766">decode</span><span class="op" id="1337772">(</span><span class="ident" id="1337773">d</span><span class="op" id="1337774">.</span><span class="ident" id="1337775">outbuf</span><span class="op" id="1337781">[</span><span class="num" id="1337782">0</span><span class="op" id="1337783">:</span><span class="op" id="1337784">]</span><span class="op" id="1337785">,</span>&nbsp;<span class="ident" id="1337787">d</span><span class="op" id="1337788">.</span><span class="ident" id="1337789">buf</span><span class="op" id="1337792">[</span><span class="num" id="1337793">0</span><span class="op" id="1337794">:</span><span class="ident" id="1337795">nr</span><span class="op" id="1337797">]</span><span class="op" id="1337798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337802">d</span><span class="op" id="1337803">.</span><span class="ident" id="1337804">out</span>&nbsp;<span class="op" id="1337808">=</span>&nbsp;<span class="ident" id="1337810">d</span><span class="op" id="1337811">.</span><span class="ident" id="1337812">outbuf</span><span class="op" id="1337818">[</span><span class="num" id="1337819">0</span><span class="op" id="1337820">:</span><span class="ident" id="1337821">nw</span><span class="op" id="1337823">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337827">n</span>&nbsp;<span class="op" id="1337829">=</span>&nbsp;<span class="builtinfunc" id="1337831">copy</span><span class="op" id="1337835">(</span><span class="ident" id="1337836">p</span><span class="op" id="1337837">,</span>&nbsp;<span class="ident" id="1337839">d</span><span class="op" id="1337840">.</span><span class="ident" id="1337841">out</span><span class="op" id="1337844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337848">d</span><span class="op" id="1337849">.</span><span class="ident" id="1337850">out</span>&nbsp;<span class="op" id="1337854">=</span>&nbsp;<span class="ident" id="1337856">d</span><span class="op" id="1337857">.</span><span class="ident" id="1337858">out</span><span class="op" id="1337861">[</span><span class="ident" id="1337862">n</span><span class="op" id="1337863">:</span><span class="op" id="1337864">]</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337867">}</span>&nbsp;<span class="keyword" id="1337869">else</span>&nbsp;<span class="op" id="1337874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337878">n</span><span class="op" id="1337879">,</span>&nbsp;<span class="ident" id="1337881">d</span><span class="op" id="1337882">.</span><span class="ident" id="1337883">end</span><span class="op" id="1337886">,</span>&nbsp;<span class="ident" id="1337888">d</span><span class="op" id="1337889">.</span><span class="ident" id="1337890">err</span>&nbsp;<span class="op" id="1337894">=</span>&nbsp;<span class="ident" id="1337896">d</span><span class="op" id="1337897">.</span><span class="ident" id="1337898">enc</span><span class="op" id="1337901">.</span><span class="ident" id="1337902">decode</span><span class="op" id="1337908">(</span><span class="ident" id="1337909">p</span><span class="op" id="1337910">,</span>&nbsp;<span class="ident" id="1337912">d</span><span class="op" id="1337913">.</span><span class="ident" id="1337914">buf</span><span class="op" id="1337917">[</span><span class="num" id="1337918">0</span><span class="op" id="1337919">:</span><span class="ident" id="1337920">nr</span><span class="op" id="1337922">]</span><span class="op" id="1337923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337929">d</span><span class="op" id="1337930">.</span><span class="ident" id="1337931">nbuf</span>&nbsp;<span class="op" id="1337936">-=</span>&nbsp;<span class="ident" id="1337939">nr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337943">for</span>&nbsp;<span class="ident" id="1337947">i</span>&nbsp;<span class="op" id="1337949">:=</span>&nbsp;<span class="num" id="1337952">0</span><span class="op" id="1337953">;</span>&nbsp;<span class="ident" id="1337955">i</span>&nbsp;<span class="op" id="1337957">&lt;</span>&nbsp;<span class="ident" id="1337959">d</span><span class="op" id="1337960">.</span><span class="ident" id="1337961">nbuf</span><span class="op" id="1337965">;</span>&nbsp;<span class="ident" id="1337967">i</span><span class="op" id="1337968">++</span>&nbsp;<span class="op" id="1337971">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337975">d</span><span class="op" id="1337976">.</span><span class="ident" id="1337977">buf</span><span class="op" id="1337980">[</span><span class="ident" id="1337981">i</span><span class="op" id="1337982">]</span>&nbsp;<span class="op" id="1337984">=</span>&nbsp;<span class="ident" id="1337986">d</span><span class="op" id="1337987">.</span><span class="ident" id="1337988">buf</span><span class="op" id="1337991">[</span><span class="ident" id="1337992">i</span><span class="op" id="1337993">+</span><span class="ident" id="1337994">nr</span><span class="op" id="1337996">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338003">if</span>&nbsp;<span class="ident" id="1338006">d</span><span class="op" id="1338007">.</span><span class="ident" id="1338008">err</span>&nbsp;<span class="op" id="1338012">==</span>&nbsp;<span class="ident" id="1338015">nil</span>&nbsp;<span class="op" id="1338019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338023">d</span><span class="op" id="1338024">.</span><span class="ident" id="1338025">err</span>&nbsp;<span class="op" id="1338029">=</span>&nbsp;<span class="ident" id="1338031">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1338036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338039">return</span>&nbsp;<span class="ident" id="1338046">n</span><span class="op" id="1338047">,</span>&nbsp;<span class="ident" id="1338049">d</span><span class="op" id="1338050">.</span><span class="ident" id="1338051">err</span><br>
<span class="lineno"></span><span class="op" id="1338055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1338058">type</span>&nbsp;<span class="ident" id="1338063">newlineFilteringReader</span>&nbsp;<span class="keyword" id="1338086">struct</span>&nbsp;<span class="op" id="1338093">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338096">wrapped</span>&nbsp;<span class="ident" id="1338104">io</span><span class="op" id="1338106">.</span><span class="ident" id="1338107">Reader</span><br>
<span class="lineno"></span><span class="op" id="1338114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1338117">func</span>&nbsp;<span class="op" id="1338122">(</span><span class="ident" id="1338123">r</span>&nbsp;<span class="op" id="1338125">*</span><span class="ident" id="1338126">newlineFilteringReader</span><span class="op" id="1338148">)</span>&nbsp;<span class="ident" id="1338150">Read</span><span class="op" id="1338154">(</span><span class="ident" id="1338155">p</span>&nbsp;<span class="op" id="1338157">[</span><span class="op" id="1338158">]</span><span class="builtintype" id="1338159">byte</span><span class="op" id="1338163">)</span>&nbsp;<span class="op" id="1338165">(</span><span class="builtintype" id="1338166">int</span><span class="op" id="1338169">,</span>&nbsp;<span class="builtintype" id="1338171">error</span><span class="op" id="1338176">)</span>&nbsp;<span class="op" id="1338178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338181">n</span><span class="op" id="1338182">,</span>&nbsp;<span class="ident" id="1338184">err</span>&nbsp;<span class="op" id="1338188">:=</span>&nbsp;<span class="ident" id="1338191">r</span><span class="op" id="1338192">.</span><span class="ident" id="1338193">wrapped</span><span class="op" id="1338200">.</span><span class="ident" id="1338201">Read</span><span class="op" id="1338205">(</span><span class="ident" id="1338206">p</span><span class="op" id="1338207">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338210">for</span>&nbsp;<span class="ident" id="1338214">n</span>&nbsp;<span class="op" id="1338216">&gt;</span>&nbsp;<span class="num" id="1338218">0</span>&nbsp;<span class="op" id="1338220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338224">offset</span>&nbsp;<span class="op" id="1338231">:=</span>&nbsp;<span class="num" id="1338234">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338238">for</span>&nbsp;<span class="ident" id="1338242">i</span><span class="op" id="1338243">,</span>&nbsp;<span class="ident" id="1338245">b</span>&nbsp;<span class="op" id="1338247">:=</span>&nbsp;<span class="keyword" id="1338250">range</span>&nbsp;<span class="ident" id="1338256">p</span><span class="op" id="1338257">[</span><span class="num" id="1338258">0</span><span class="op" id="1338259">:</span><span class="ident" id="1338260">n</span><span class="op" id="1338261">]</span>&nbsp;<span class="op" id="1338263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338268">if</span>&nbsp;<span class="ident" id="1338271">b</span>&nbsp;<span class="op" id="1338273">!=</span>&nbsp;<span class="string" id="1338276">&#39;\r&#39;</span>&nbsp;<span class="op" id="1338281">&amp;&amp;</span>&nbsp;<span class="ident" id="1338284">b</span>&nbsp;<span class="op" id="1338286">!=</span>&nbsp;<span class="string" id="1338289">&#39;\n&#39;</span>&nbsp;<span class="op" id="1338294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338300">if</span>&nbsp;<span class="ident" id="1338303">i</span>&nbsp;<span class="op" id="1338305">!=</span>&nbsp;<span class="ident" id="1338308">offset</span>&nbsp;<span class="op" id="1338315">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338322">p</span><span class="op" id="1338323">[</span><span class="ident" id="1338324">offset</span><span class="op" id="1338330">]</span>&nbsp;<span class="op" id="1338332">=</span>&nbsp;<span class="ident" id="1338334">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1338340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338346">offset</span><span class="op" id="1338352">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1338358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1338362">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338366">if</span>&nbsp;<span class="ident" id="1338369">offset</span>&nbsp;<span class="op" id="1338376">&gt;</span>&nbsp;<span class="num" id="1338378">0</span>&nbsp;<span class="op" id="1338380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338385">return</span>&nbsp;<span class="ident" id="1338392">offset</span><span class="op" id="1338398">,</span>&nbsp;<span class="ident" id="1338400">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1338406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1338410">//&nbsp;Previous&nbsp;buffer&nbsp;entirely&nbsp;whitespace,&nbsp;read&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338463">n</span><span class="op" id="1338464">,</span>&nbsp;<span class="ident" id="1338466">err</span>&nbsp;<span class="op" id="1338470">=</span>&nbsp;<span class="ident" id="1338472">r</span><span class="op" id="1338473">.</span><span class="ident" id="1338474">wrapped</span><span class="op" id="1338481">.</span><span class="ident" id="1338482">Read</span><span class="op" id="1338486">(</span><span class="ident" id="1338487">p</span><span class="op" id="1338488">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1338491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338494">return</span>&nbsp;<span class="ident" id="1338501">n</span><span class="op" id="1338502">,</span>&nbsp;<span class="ident" id="1338504">err</span><br>
<span class="lineno"></span><span class="op" id="1338508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1338511">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno">385</span><span class="keyword" id="1338565">func</span>&nbsp;<span class="ident" id="1338570">NewDecoder</span><span class="op" id="1338580">(</span><span class="ident" id="1338581">enc</span>&nbsp;<span class="op" id="1338585">*</span><span class="ident" id="1338586">Encoding</span><span class="op" id="1338594">,</span>&nbsp;<span class="ident" id="1338596">r</span>&nbsp;<span class="ident" id="1338598">io</span><span class="op" id="1338600">.</span><span class="ident" id="1338601">Reader</span><span class="op" id="1338607">)</span>&nbsp;<span class="ident" id="1338609">io</span><span class="op" id="1338611">.</span><span class="ident" id="1338612">Reader</span>&nbsp;<span class="op" id="1338619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338622">return</span>&nbsp;<span class="op" id="1338629">&amp;</span><span class="ident" id="1338630">decoder</span><span class="op" id="1338637">{</span><span class="ident" id="1338638">enc</span><span class="op" id="1338641">:</span>&nbsp;<span class="ident" id="1338643">enc</span><span class="op" id="1338646">,</span>&nbsp;<span class="ident" id="1338648">r</span><span class="op" id="1338649">:</span>&nbsp;<span class="op" id="1338651">&amp;</span><span class="ident" id="1338652">newlineFilteringReader</span><span class="op" id="1338674">{</span><span class="ident" id="1338675">r</span><span class="op" id="1338676">}</span><span class="op" id="1338677">}</span><br>
<span class="lineno"></span><span class="op" id="1338679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1338682">//&nbsp;DecodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;decoded&nbsp;data</span><br>
<span class="lineno">390</span><span class="comment" id="1338752">//&nbsp;corresponding&nbsp;to&nbsp;n&nbsp;bytes&nbsp;of&nbsp;base64-encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="1338804">func</span>&nbsp;<span class="op" id="1338809">(</span><span class="ident" id="1338810">enc</span>&nbsp;<span class="op" id="1338814">*</span><span class="ident" id="1338815">Encoding</span><span class="op" id="1338823">)</span>&nbsp;<span class="ident" id="1338825">DecodedLen</span><span class="op" id="1338835">(</span><span class="ident" id="1338836">n</span>&nbsp;<span class="builtintype" id="1338838">int</span><span class="op" id="1338841">)</span>&nbsp;<span class="builtintype" id="1338843">int</span>&nbsp;<span class="op" id="1338847">{</span>&nbsp;<span class="keyword" id="1338849">return</span>&nbsp;<span class="ident" id="1338856">n</span>&nbsp;<span class="op" id="1338858">/</span>&nbsp;<span class="num" id="1338860">4</span>&nbsp;<span class="op" id="1338862">*</span>&nbsp;<span class="num" id="1338864">3</span>&nbsp;<span class="op" id="1338866">}</span>
</div>
</body>
</html>
