<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc/jsonrpc</h2>
<ul>
<li><a href="/gostd/net/rpc/jsonrpc/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/server.go.html">server.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5712245">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5712301">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5712355">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5712406">//&nbsp;Package&nbsp;jsonrpc&nbsp;implements&nbsp;a&nbsp;JSON-RPC&nbsp;ClientCodec&nbsp;and&nbsp;ServerCodec</span><br>
<span class="lineno"></span><span class="comment" id="5712475">//&nbsp;for&nbsp;the&nbsp;rpc&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="5712499">package</span>&nbsp;<span class="ident" id="5712507">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5712516">import</span>&nbsp;<span class="op" id="5712523">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5712526">&#34;encoding/json&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5712543">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5712550">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5712556">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5712563">&#34;net/rpc&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5712574">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5712581">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5712584">type</span>&nbsp;<span class="ident" id="5712589">clientCodec</span>&nbsp;<span class="keyword" id="5712601">struct</span>&nbsp;<span class="op" id="5712608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5712611">dec</span>&nbsp;<span class="op" id="5712615">*</span><span class="ident" id="5712616">json</span><span class="op" id="5712620">.</span><span class="ident" id="5712621">Decoder</span>&nbsp;<span class="comment" id="5712629">//&nbsp;for&nbsp;reading&nbsp;JSON&nbsp;values</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5712657">enc</span>&nbsp;<span class="op" id="5712661">*</span><span class="ident" id="5712662">json</span><span class="op" id="5712666">.</span><span class="ident" id="5712667">Encoder</span>&nbsp;<span class="comment" id="5712675">//&nbsp;for&nbsp;writing&nbsp;JSON&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5712703">c</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5712707">io</span><span class="op" id="5712709">.</span><span class="ident" id="5712710">Closer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5712719">//&nbsp;temporary&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5712744">req</span>&nbsp;&nbsp;<span class="ident" id="5712749">clientRequest</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5712764">resp</span>&nbsp;<span class="ident" id="5712769">clientResponse</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5712786">//&nbsp;JSON-RPC&nbsp;responses&nbsp;include&nbsp;the&nbsp;request&nbsp;id&nbsp;but&nbsp;not&nbsp;the&nbsp;request&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5712860">//&nbsp;Package&nbsp;rpc&nbsp;expects&nbsp;both.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5712890">//&nbsp;We&nbsp;save&nbsp;the&nbsp;request&nbsp;method&nbsp;in&nbsp;pending&nbsp;when&nbsp;sending&nbsp;a&nbsp;request</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5712955">//&nbsp;and&nbsp;then&nbsp;look&nbsp;it&nbsp;up&nbsp;by&nbsp;request&nbsp;ID&nbsp;when&nbsp;filling&nbsp;out&nbsp;the&nbsp;rpc&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713028">mutex</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5713036">sync</span><span class="op" id="5713040">.</span><span class="ident" id="5713041">Mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5713054">//&nbsp;protects&nbsp;pending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713075">pending</span>&nbsp;<span class="keyword" id="5713083">map</span><span class="op" id="5713086">[</span><span class="ident" id="5713087">uint64</span><span class="op" id="5713093">]</span><span class="builtintype" id="5713094">string</span>&nbsp;<span class="comment" id="5713101">//&nbsp;map&nbsp;request&nbsp;id&nbsp;to&nbsp;method&nbsp;name</span><br>
<span class="lineno"></span><span class="op" id="5713134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5713137">//&nbsp;NewClientCodec&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.ClientCodec&nbsp;using&nbsp;JSON-RPC&nbsp;on&nbsp;conn.</span><br>
<span class="lineno"></span><span class="keyword" id="5713209">func</span>&nbsp;<span class="ident" id="5713214">NewClientCodec</span><span class="op" id="5713228">(</span><span class="ident" id="5713229">conn</span>&nbsp;<span class="ident" id="5713234">io</span><span class="op" id="5713236">.</span><span class="ident" id="5713237">ReadWriteCloser</span><span class="op" id="5713252">)</span>&nbsp;<span class="ident" id="5713254">rpc</span><span class="op" id="5713257">.</span><span class="ident" id="5713258">ClientCodec</span>&nbsp;<span class="op" id="5713270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5713273">return</span>&nbsp;<span class="op" id="5713280">&amp;</span><span class="ident" id="5713281">clientCodec</span><span class="op" id="5713292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713296">dec</span><span class="op" id="5713299">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5713305">json</span><span class="op" id="5713309">.</span><span class="ident" id="5713310">NewDecoder</span><span class="op" id="5713320">(</span><span class="ident" id="5713321">conn</span><span class="op" id="5713325">)</span><span class="op" id="5713326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713330">enc</span><span class="op" id="5713333">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5713339">json</span><span class="op" id="5713343">.</span><span class="ident" id="5713344">NewEncoder</span><span class="op" id="5713354">(</span><span class="ident" id="5713355">conn</span><span class="op" id="5713359">)</span><span class="op" id="5713360">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713364">c</span><span class="op" id="5713365">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5713373">conn</span><span class="op" id="5713377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713381">pending</span><span class="op" id="5713388">:</span>&nbsp;<span class="builtinfunc" id="5713390">make</span><span class="op" id="5713394">(</span><span class="keyword" id="5713395">map</span><span class="op" id="5713398">[</span><span class="ident" id="5713399">uint64</span><span class="op" id="5713405">]</span><span class="builtintype" id="5713406">string</span><span class="op" id="5713412">)</span><span class="op" id="5713413">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5713416">}</span><br>
<span class="lineno"></span><span class="op" id="5713418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="5713421">type</span>&nbsp;<span class="ident" id="5713426">clientRequest</span>&nbsp;<span class="keyword" id="5713440">struct</span>&nbsp;<span class="op" id="5713447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713450">Method</span>&nbsp;<span class="builtintype" id="5713457">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5713472">`json:&#34;method&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713489">Params</span>&nbsp;<span class="op" id="5713496">[</span><span class="num" id="5713497">1</span><span class="op" id="5713498">]</span><span class="keyword" id="5713499">interface</span><span class="op" id="5713508">{</span><span class="op" id="5713509">}</span>&nbsp;<span class="string" id="5713511">`json:&#34;params&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713528">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5713535">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5713550">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span><span class="op" id="5713562">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5713565">func</span>&nbsp;<span class="op" id="5713570">(</span><span class="ident" id="5713571">c</span>&nbsp;<span class="op" id="5713573">*</span><span class="ident" id="5713574">clientCodec</span><span class="op" id="5713585">)</span>&nbsp;<span class="ident" id="5713587">WriteRequest</span><span class="op" id="5713599">(</span><span class="ident" id="5713600">r</span>&nbsp;<span class="op" id="5713602">*</span><span class="ident" id="5713603">rpc</span><span class="op" id="5713606">.</span><span class="ident" id="5713607">Request</span><span class="op" id="5713614">,</span>&nbsp;<span class="ident" id="5713616">param</span>&nbsp;<span class="keyword" id="5713622">interface</span><span class="op" id="5713631">{</span><span class="op" id="5713632">}</span><span class="op" id="5713633">)</span>&nbsp;<span class="builtintype" id="5713635">error</span>&nbsp;<span class="op" id="5713641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713644">c</span><span class="op" id="5713645">.</span><span class="ident" id="5713646">mutex</span><span class="op" id="5713651">.</span><span class="ident" id="5713652">Lock</span><span class="op" id="5713656">(</span><span class="op" id="5713657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713660">c</span><span class="op" id="5713661">.</span><span class="ident" id="5713662">pending</span><span class="op" id="5713669">[</span><span class="ident" id="5713670">r</span><span class="op" id="5713671">.</span><span class="ident" id="5713672">Seq</span><span class="op" id="5713675">]</span>&nbsp;<span class="op" id="5713677">=</span>&nbsp;<span class="ident" id="5713679">r</span><span class="op" id="5713680">.</span><span class="ident" id="5713681">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713696">c</span><span class="op" id="5713697">.</span><span class="ident" id="5713698">mutex</span><span class="op" id="5713703">.</span><span class="ident" id="5713704">Unlock</span><span class="op" id="5713710">(</span><span class="op" id="5713711">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713714">c</span><span class="op" id="5713715">.</span><span class="ident" id="5713716">req</span><span class="op" id="5713719">.</span><span class="ident" id="5713720">Method</span>&nbsp;<span class="op" id="5713727">=</span>&nbsp;<span class="ident" id="5713729">r</span><span class="op" id="5713730">.</span><span class="ident" id="5713731">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713746">c</span><span class="op" id="5713747">.</span><span class="ident" id="5713748">req</span><span class="op" id="5713751">.</span><span class="ident" id="5713752">Params</span><span class="op" id="5713758">[</span><span class="num" id="5713759">0</span><span class="op" id="5713760">]</span>&nbsp;<span class="op" id="5713762">=</span>&nbsp;<span class="ident" id="5713764">param</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713771">c</span><span class="op" id="5713772">.</span><span class="ident" id="5713773">req</span><span class="op" id="5713776">.</span><span class="ident" id="5713777">Id</span>&nbsp;<span class="op" id="5713780">=</span>&nbsp;<span class="ident" id="5713782">r</span><span class="op" id="5713783">.</span><span class="ident" id="5713784">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5713789">return</span>&nbsp;<span class="ident" id="5713796">c</span><span class="op" id="5713797">.</span><span class="ident" id="5713798">enc</span><span class="op" id="5713801">.</span><span class="ident" id="5713802">Encode</span><span class="op" id="5713808">(</span><span class="op" id="5713809">&amp;</span><span class="ident" id="5713810">c</span><span class="op" id="5713811">.</span><span class="ident" id="5713812">req</span><span class="op" id="5713815">)</span><br>
<span class="lineno"></span><span class="op" id="5713817">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="5713820">type</span>&nbsp;<span class="ident" id="5713825">clientResponse</span>&nbsp;<span class="keyword" id="5713840">struct</span>&nbsp;<span class="op" id="5713847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713850">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5713857">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5713874">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713887">Result</span>&nbsp;<span class="op" id="5713894">*</span><span class="ident" id="5713895">json</span><span class="op" id="5713899">.</span><span class="ident" id="5713900">RawMessage</span>&nbsp;<span class="string" id="5713911">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713928">Error</span>&nbsp;&nbsp;<span class="keyword" id="5713935">interface</span><span class="op" id="5713944">{</span><span class="op" id="5713945">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5713952">`json:&#34;error&#34;`</span><br>
<span class="lineno">65</span><span class="op" id="5713967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5713970">func</span>&nbsp;<span class="op" id="5713975">(</span><span class="ident" id="5713976">r</span>&nbsp;<span class="op" id="5713978">*</span><span class="ident" id="5713979">clientResponse</span><span class="op" id="5713993">)</span>&nbsp;<span class="ident" id="5713995">reset</span><span class="op" id="5714000">(</span><span class="op" id="5714001">)</span>&nbsp;<span class="op" id="5714003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714006">r</span><span class="op" id="5714007">.</span><span class="ident" id="5714008">Id</span>&nbsp;<span class="op" id="5714011">=</span>&nbsp;<span class="num" id="5714013">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714016">r</span><span class="op" id="5714017">.</span><span class="ident" id="5714018">Result</span>&nbsp;<span class="op" id="5714025">=</span>&nbsp;<span class="ident" id="5714027">nil</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714032">r</span><span class="op" id="5714033">.</span><span class="ident" id="5714034">Error</span>&nbsp;<span class="op" id="5714040">=</span>&nbsp;<span class="ident" id="5714042">nil</span><br>
<span class="lineno"></span><span class="op" id="5714046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5714049">func</span>&nbsp;<span class="op" id="5714054">(</span><span class="ident" id="5714055">c</span>&nbsp;<span class="op" id="5714057">*</span><span class="ident" id="5714058">clientCodec</span><span class="op" id="5714069">)</span>&nbsp;<span class="ident" id="5714071">ReadResponseHeader</span><span class="op" id="5714089">(</span><span class="ident" id="5714090">r</span>&nbsp;<span class="op" id="5714092">*</span><span class="ident" id="5714093">rpc</span><span class="op" id="5714096">.</span><span class="ident" id="5714097">Response</span><span class="op" id="5714105">)</span>&nbsp;<span class="builtintype" id="5714107">error</span>&nbsp;<span class="op" id="5714113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714116">c</span><span class="op" id="5714117">.</span><span class="ident" id="5714118">resp</span><span class="op" id="5714122">.</span><span class="ident" id="5714123">reset</span><span class="op" id="5714128">(</span><span class="op" id="5714129">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714132">if</span>&nbsp;<span class="ident" id="5714135">err</span>&nbsp;<span class="op" id="5714139">:=</span>&nbsp;<span class="ident" id="5714142">c</span><span class="op" id="5714143">.</span><span class="ident" id="5714144">dec</span><span class="op" id="5714147">.</span><span class="ident" id="5714148">Decode</span><span class="op" id="5714154">(</span><span class="op" id="5714155">&amp;</span><span class="ident" id="5714156">c</span><span class="op" id="5714157">.</span><span class="ident" id="5714158">resp</span><span class="op" id="5714162">)</span><span class="op" id="5714163">;</span>&nbsp;<span class="ident" id="5714165">err</span>&nbsp;<span class="op" id="5714169">!=</span>&nbsp;<span class="ident" id="5714172">nil</span>&nbsp;<span class="op" id="5714176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714180">return</span>&nbsp;<span class="ident" id="5714187">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5714192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714196">c</span><span class="op" id="5714197">.</span><span class="ident" id="5714198">mutex</span><span class="op" id="5714203">.</span><span class="ident" id="5714204">Lock</span><span class="op" id="5714208">(</span><span class="op" id="5714209">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714212">r</span><span class="op" id="5714213">.</span><span class="ident" id="5714214">ServiceMethod</span>&nbsp;<span class="op" id="5714228">=</span>&nbsp;<span class="ident" id="5714230">c</span><span class="op" id="5714231">.</span><span class="ident" id="5714232">pending</span><span class="op" id="5714239">[</span><span class="ident" id="5714240">c</span><span class="op" id="5714241">.</span><span class="ident" id="5714242">resp</span><span class="op" id="5714246">.</span><span class="ident" id="5714247">Id</span><span class="op" id="5714249">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5714252">delete</span><span class="op" id="5714258">(</span><span class="ident" id="5714259">c</span><span class="op" id="5714260">.</span><span class="ident" id="5714261">pending</span><span class="op" id="5714268">,</span>&nbsp;<span class="ident" id="5714270">c</span><span class="op" id="5714271">.</span><span class="ident" id="5714272">resp</span><span class="op" id="5714276">.</span><span class="ident" id="5714277">Id</span><span class="op" id="5714279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714282">c</span><span class="op" id="5714283">.</span><span class="ident" id="5714284">mutex</span><span class="op" id="5714289">.</span><span class="ident" id="5714290">Unlock</span><span class="op" id="5714296">(</span><span class="op" id="5714297">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714301">r</span><span class="op" id="5714302">.</span><span class="ident" id="5714303">Error</span>&nbsp;<span class="op" id="5714309">=</span>&nbsp;<span class="string" id="5714311">&#34;&#34;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714315">r</span><span class="op" id="5714316">.</span><span class="ident" id="5714317">Seq</span>&nbsp;<span class="op" id="5714321">=</span>&nbsp;<span class="ident" id="5714323">c</span><span class="op" id="5714324">.</span><span class="ident" id="5714325">resp</span><span class="op" id="5714329">.</span><span class="ident" id="5714330">Id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714334">if</span>&nbsp;<span class="ident" id="5714337">c</span><span class="op" id="5714338">.</span><span class="ident" id="5714339">resp</span><span class="op" id="5714343">.</span><span class="ident" id="5714344">Error</span>&nbsp;<span class="op" id="5714350">!=</span>&nbsp;<span class="ident" id="5714353">nil</span>&nbsp;<span class="op" id="5714357">||</span>&nbsp;<span class="ident" id="5714360">c</span><span class="op" id="5714361">.</span><span class="ident" id="5714362">resp</span><span class="op" id="5714366">.</span><span class="ident" id="5714367">Result</span>&nbsp;<span class="op" id="5714374">==</span>&nbsp;<span class="ident" id="5714377">nil</span>&nbsp;<span class="op" id="5714381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714385">x</span><span class="op" id="5714386">,</span>&nbsp;<span class="ident" id="5714388">ok</span>&nbsp;<span class="op" id="5714391">:=</span>&nbsp;<span class="ident" id="5714394">c</span><span class="op" id="5714395">.</span><span class="ident" id="5714396">resp</span><span class="op" id="5714400">.</span><span class="ident" id="5714401">Error</span><span class="op" id="5714406">.</span><span class="op" id="5714407">(</span><span class="builtintype" id="5714408">string</span><span class="op" id="5714414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714418">if</span>&nbsp;<span class="op" id="5714421">!</span><span class="ident" id="5714422">ok</span>&nbsp;<span class="op" id="5714425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714430">return</span>&nbsp;<span class="ident" id="5714437">fmt</span><span class="op" id="5714440">.</span><span class="ident" id="5714441">Errorf</span><span class="op" id="5714447">(</span><span class="string" id="5714448">&#34;invalid&nbsp;error&nbsp;%v&#34;</span><span class="op" id="5714466">,</span>&nbsp;<span class="ident" id="5714468">c</span><span class="op" id="5714469">.</span><span class="ident" id="5714470">resp</span><span class="op" id="5714474">.</span><span class="ident" id="5714475">Error</span><span class="op" id="5714480">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5714484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714488">if</span>&nbsp;<span class="ident" id="5714491">x</span>&nbsp;<span class="op" id="5714493">==</span>&nbsp;<span class="string" id="5714496">&#34;&#34;</span>&nbsp;<span class="op" id="5714499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714504">x</span>&nbsp;<span class="op" id="5714506">=</span>&nbsp;<span class="string" id="5714508">&#34;unspecified&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5714530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714534">r</span><span class="op" id="5714535">.</span><span class="ident" id="5714536">Error</span>&nbsp;<span class="op" id="5714542">=</span>&nbsp;<span class="ident" id="5714544">x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5714547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714550">return</span>&nbsp;<span class="ident" id="5714557">nil</span><br>
<span class="lineno"></span><span class="op" id="5714561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5714564">func</span>&nbsp;<span class="op" id="5714569">(</span><span class="ident" id="5714570">c</span>&nbsp;<span class="op" id="5714572">*</span><span class="ident" id="5714573">clientCodec</span><span class="op" id="5714584">)</span>&nbsp;<span class="ident" id="5714586">ReadResponseBody</span><span class="op" id="5714602">(</span><span class="ident" id="5714603">x</span>&nbsp;<span class="keyword" id="5714605">interface</span><span class="op" id="5714614">{</span><span class="op" id="5714615">}</span><span class="op" id="5714616">)</span>&nbsp;<span class="builtintype" id="5714618">error</span>&nbsp;<span class="op" id="5714624">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714627">if</span>&nbsp;<span class="ident" id="5714630">x</span>&nbsp;<span class="op" id="5714632">==</span>&nbsp;<span class="ident" id="5714635">nil</span>&nbsp;<span class="op" id="5714639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714643">return</span>&nbsp;<span class="ident" id="5714650">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5714655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714658">return</span>&nbsp;<span class="ident" id="5714665">json</span><span class="op" id="5714669">.</span><span class="ident" id="5714670">Unmarshal</span><span class="op" id="5714679">(</span><span class="op" id="5714680">*</span><span class="ident" id="5714681">c</span><span class="op" id="5714682">.</span><span class="ident" id="5714683">resp</span><span class="op" id="5714687">.</span><span class="ident" id="5714688">Result</span><span class="op" id="5714694">,</span>&nbsp;<span class="ident" id="5714696">x</span><span class="op" id="5714697">)</span><br>
<span class="lineno"></span><span class="op" id="5714699">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="5714702">func</span>&nbsp;<span class="op" id="5714707">(</span><span class="ident" id="5714708">c</span>&nbsp;<span class="op" id="5714710">*</span><span class="ident" id="5714711">clientCodec</span><span class="op" id="5714722">)</span>&nbsp;<span class="ident" id="5714724">Close</span><span class="op" id="5714729">(</span><span class="op" id="5714730">)</span>&nbsp;<span class="builtintype" id="5714732">error</span>&nbsp;<span class="op" id="5714738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714741">return</span>&nbsp;<span class="ident" id="5714748">c</span><span class="op" id="5714749">.</span><span class="ident" id="5714750">c</span><span class="op" id="5714751">.</span><span class="ident" id="5714752">Close</span><span class="op" id="5714757">(</span><span class="op" id="5714758">)</span><br>
<span class="lineno"></span><span class="op" id="5714760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="5714763">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5714827">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5714882">func</span>&nbsp;<span class="ident" id="5714887">NewClient</span><span class="op" id="5714896">(</span><span class="ident" id="5714897">conn</span>&nbsp;<span class="ident" id="5714902">io</span><span class="op" id="5714904">.</span><span class="ident" id="5714905">ReadWriteCloser</span><span class="op" id="5714920">)</span>&nbsp;<span class="op" id="5714922">*</span><span class="ident" id="5714923">rpc</span><span class="op" id="5714926">.</span><span class="ident" id="5714927">Client</span>&nbsp;<span class="op" id="5714934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714937">return</span>&nbsp;<span class="ident" id="5714944">rpc</span><span class="op" id="5714947">.</span><span class="ident" id="5714948">NewClientWithCodec</span><span class="op" id="5714966">(</span><span class="ident" id="5714967">NewClientCodec</span><span class="op" id="5714981">(</span><span class="ident" id="5714982">conn</span><span class="op" id="5714986">)</span><span class="op" id="5714987">)</span><br>
<span class="lineno"></span><span class="op" id="5714989">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="5714992">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;a&nbsp;JSON-RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5715064">func</span>&nbsp;<span class="ident" id="5715069">Dial</span><span class="op" id="5715073">(</span><span class="ident" id="5715074">network</span><span class="op" id="5715081">,</span>&nbsp;<span class="ident" id="5715083">address</span>&nbsp;<span class="builtintype" id="5715091">string</span><span class="op" id="5715097">)</span>&nbsp;<span class="op" id="5715099">(</span><span class="op" id="5715100">*</span><span class="ident" id="5715101">rpc</span><span class="op" id="5715104">.</span><span class="ident" id="5715105">Client</span><span class="op" id="5715111">,</span>&nbsp;<span class="builtintype" id="5715113">error</span><span class="op" id="5715118">)</span>&nbsp;<span class="op" id="5715120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5715123">conn</span><span class="op" id="5715127">,</span>&nbsp;<span class="ident" id="5715129">err</span>&nbsp;<span class="op" id="5715133">:=</span>&nbsp;<span class="ident" id="5715136">net</span><span class="op" id="5715139">.</span><span class="ident" id="5715140">Dial</span><span class="op" id="5715144">(</span><span class="ident" id="5715145">network</span><span class="op" id="5715152">,</span>&nbsp;<span class="ident" id="5715154">address</span><span class="op" id="5715161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5715164">if</span>&nbsp;<span class="ident" id="5715167">err</span>&nbsp;<span class="op" id="5715171">!=</span>&nbsp;<span class="ident" id="5715174">nil</span>&nbsp;<span class="op" id="5715178">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5715182">return</span>&nbsp;<span class="ident" id="5715189">nil</span><span class="op" id="5715192">,</span>&nbsp;<span class="ident" id="5715194">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5715199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5715202">return</span>&nbsp;<span class="ident" id="5715209">NewClient</span><span class="op" id="5715218">(</span><span class="ident" id="5715219">conn</span><span class="op" id="5715223">)</span><span class="op" id="5715224">,</span>&nbsp;<span class="ident" id="5715226">err</span><br>
<span class="lineno"></span><span class="op" id="5715230">}</span>
</div>
</body>
</html>
