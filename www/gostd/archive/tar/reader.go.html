<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4171795">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4171850">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4171904">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4171955">package</span>&nbsp;<span class="ident" id="4171963">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4171968">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="4171987">//&nbsp;&nbsp;&nbsp;-&nbsp;pax&nbsp;extensions</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4172010">import</span>&nbsp;<span class="op" id="4172017">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4172020">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4172029">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4172039">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4172045">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4172058">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4172064">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4172075">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4172086">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4172093">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="4172096">var</span>&nbsp;<span class="op" id="4172100">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172103">ErrHeader</span>&nbsp;<span class="op" id="4172113">=</span>&nbsp;<span class="ident" id="4172115">errors</span><span class="op" id="4172121">.</span><span class="ident" id="4172122">New</span><span class="op" id="4172125">(</span><span class="string" id="4172126">&#34;archive/tar:&nbsp;invalid&nbsp;tar&nbsp;header&#34;</span><span class="op" id="4172159">)</span><br>
<span class="lineno"></span><span class="op" id="4172161">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="4172164">const</span>&nbsp;<span class="ident" id="4172170">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="4172191">=</span>&nbsp;<span class="num" id="4172193">9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4172196">//&nbsp;A&nbsp;Reader&nbsp;provides&nbsp;sequential&nbsp;access&nbsp;to&nbsp;the&nbsp;contents&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="4172269">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4172319">//&nbsp;The&nbsp;Next&nbsp;method&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;file&nbsp;in&nbsp;the&nbsp;archive&nbsp;(including&nbsp;the&nbsp;first),</span><br>
<span class="lineno">30</span><span class="comment" id="4172402">//&nbsp;and&nbsp;then&nbsp;it&nbsp;can&nbsp;be&nbsp;treated&nbsp;as&nbsp;an&nbsp;io.Reader&nbsp;to&nbsp;access&nbsp;the&nbsp;file&#39;s&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4172475">type</span>&nbsp;<span class="ident" id="4172480">Reader</span>&nbsp;<span class="keyword" id="4172487">struct</span>&nbsp;<span class="op" id="4172494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172497">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172505">io</span><span class="op" id="4172507">.</span><span class="ident" id="4172508">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172516">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4172524">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172531">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172539">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4172555">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;(ignored)&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172612">curr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172620">numBytesReader</span>&nbsp;&nbsp;<span class="comment" id="4172636">//&nbsp;reader&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172670">hdrBuff</span>&nbsp;<span class="op" id="4172678">[</span><span class="ident" id="4172679">blockSize</span><span class="op" id="4172688">]</span><span class="builtintype" id="4172689">byte</span>&nbsp;<span class="comment" id="4172694">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;readHeader</span><br>
<span class="lineno"></span><span class="op" id="4172725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4172728">//&nbsp;A&nbsp;numBytesReader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;with&nbsp;a&nbsp;numBytes&nbsp;method,&nbsp;returning&nbsp;the&nbsp;number</span><br>
<span class="lineno">40</span><span class="comment" id="4172809">//&nbsp;of&nbsp;bytes&nbsp;remaining&nbsp;in&nbsp;the&nbsp;underlying&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4172863">type</span>&nbsp;<span class="ident" id="4172868">numBytesReader</span>&nbsp;<span class="keyword" id="4172883">interface</span>&nbsp;<span class="op" id="4172893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172896">io</span><span class="op" id="4172898">.</span><span class="ident" id="4172899">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4172907">numBytes</span><span class="op" id="4172915">(</span><span class="op" id="4172916">)</span>&nbsp;<span class="ident" id="4172918">int64</span><br>
<span class="lineno"></span><span class="op" id="4172924">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="4172927">//&nbsp;A&nbsp;regFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="4173008">type</span>&nbsp;<span class="ident" id="4173013">regFileReader</span>&nbsp;<span class="keyword" id="4173027">struct</span>&nbsp;<span class="op" id="4173034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4173037">r</span>&nbsp;&nbsp;<span class="ident" id="4173040">io</span><span class="op" id="4173042">.</span><span class="ident" id="4173043">Reader</span>&nbsp;<span class="comment" id="4173050">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4173072">nb</span>&nbsp;<span class="ident" id="4173075">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4173085">//&nbsp;number&nbsp;of&nbsp;unread&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">50</span><span class="op" id="4173134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4173137">//&nbsp;A&nbsp;sparseFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;sparse&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="4173228">type</span>&nbsp;<span class="ident" id="4173233">sparseFileReader</span>&nbsp;<span class="keyword" id="4173250">struct</span>&nbsp;<span class="op" id="4173257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4173260">rfr</span>&nbsp;<span class="op" id="4173264">*</span><span class="ident" id="4173265">regFileReader</span>&nbsp;<span class="comment" id="4173279">//&nbsp;reads&nbsp;the&nbsp;sparse-encoded&nbsp;file&nbsp;data</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4173318">sp</span>&nbsp;&nbsp;<span class="op" id="4173322">[</span><span class="op" id="4173323">]</span><span class="ident" id="4173324">sparseEntry</span>&nbsp;&nbsp;<span class="comment" id="4173337">//&nbsp;the&nbsp;sparse&nbsp;map&nbsp;for&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4173369">pos</span>&nbsp;<span class="ident" id="4173373">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4173388">//&nbsp;keeps&nbsp;track&nbsp;of&nbsp;file&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4173421">tot</span>&nbsp;<span class="ident" id="4173425">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4173440">//&nbsp;total&nbsp;size&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="4173466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="4173469">//&nbsp;Keywords&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;files&nbsp;in&nbsp;a&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span><span class="keyword" id="4173527">const</span>&nbsp;<span class="op" id="4173533">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4173536">paxGNUSparseNumBlocks</span>&nbsp;<span class="op" id="4173558">=</span>&nbsp;<span class="string" id="4173560">&#34;GNU.sparse.numblocks&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4173584">paxGNUSparseOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4173606">=</span>&nbsp;<span class="string" id="4173608">&#34;GNU.sparse.offset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4173629">paxGNUSparseNumBytes</span>&nbsp;&nbsp;<span class="op" id="4173651">=</span>&nbsp;<span class="string" id="4173653">&#34;GNU.sparse.numbytes&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4173676">paxGNUSparseMap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4173698">=</span>&nbsp;<span class="string" id="4173700">&#34;GNU.sparse.map&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4173718">paxGNUSparseName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4173740">=</span>&nbsp;<span class="string" id="4173742">&#34;GNU.sparse.name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4173761">paxGNUSparseMajor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4173783">=</span>&nbsp;<span class="string" id="4173785">&#34;GNU.sparse.major&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4173805">paxGNUSparseMinor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4173827">=</span>&nbsp;<span class="string" id="4173829">&#34;GNU.sparse.minor&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4173849">paxGNUSparseSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4173871">=</span>&nbsp;<span class="string" id="4173873">&#34;GNU.sparse.size&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4173892">paxGNUSparseRealSize</span>&nbsp;&nbsp;<span class="op" id="4173914">=</span>&nbsp;<span class="string" id="4173916">&#34;GNU.sparse.realsize&#34;</span><br>
<span class="lineno"></span><span class="op" id="4173938">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4173941">//&nbsp;Keywords&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;headers</span><br>
<span class="lineno"></span><span class="keyword" id="4173980">const</span>&nbsp;<span class="op" id="4173986">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4173989">oldGNUSparseMainHeaderOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4174032">=</span>&nbsp;<span class="num" id="4174034">386</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4174039">oldGNUSparseMainHeaderIsExtendedOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4174082">=</span>&nbsp;<span class="num" id="4174084">482</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4174089">oldGNUSparseMainHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4174132">=</span>&nbsp;<span class="num" id="4174134">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4174137">oldGNUSparseExtendedHeaderIsExtendedOffset</span>&nbsp;<span class="op" id="4174180">=</span>&nbsp;<span class="num" id="4174182">504</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4174187">oldGNUSparseExtendedHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4174230">=</span>&nbsp;<span class="num" id="4174232">21</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4174236">oldGNUSparseOffsetSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4174279">=</span>&nbsp;<span class="num" id="4174281">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4174285">oldGNUSparseNumBytesSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4174328">=</span>&nbsp;<span class="num" id="4174330">12</span><br>
<span class="lineno"></span><span class="op" id="4174333">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4174336">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno">85</span><span class="keyword" id="4174386">func</span>&nbsp;<span class="ident" id="4174391">NewReader</span><span class="op" id="4174400">(</span><span class="ident" id="4174401">r</span>&nbsp;<span class="ident" id="4174403">io</span><span class="op" id="4174405">.</span><span class="ident" id="4174406">Reader</span><span class="op" id="4174412">)</span>&nbsp;<span class="op" id="4174414">*</span><span class="ident" id="4174415">Reader</span>&nbsp;<span class="op" id="4174422">{</span>&nbsp;<span class="keyword" id="4174424">return</span>&nbsp;<span class="op" id="4174431">&amp;</span><span class="ident" id="4174432">Reader</span><span class="op" id="4174438">{</span><span class="ident" id="4174439">r</span><span class="op" id="4174440">:</span>&nbsp;<span class="ident" id="4174442">r</span><span class="op" id="4174443">}</span>&nbsp;<span class="op" id="4174445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4174448">//&nbsp;Next&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="4174503">func</span>&nbsp;<span class="op" id="4174508">(</span><span class="ident" id="4174509">tr</span>&nbsp;<span class="op" id="4174512">*</span><span class="ident" id="4174513">Reader</span><span class="op" id="4174519">)</span>&nbsp;<span class="ident" id="4174521">Next</span><span class="op" id="4174525">(</span><span class="op" id="4174526">)</span>&nbsp;<span class="op" id="4174528">(</span><span class="op" id="4174529">*</span><span class="ident" id="4174530">Header</span><span class="op" id="4174536">,</span>&nbsp;<span class="builtintype" id="4174538">error</span><span class="op" id="4174543">)</span>&nbsp;<span class="op" id="4174545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4174548">var</span>&nbsp;<span class="ident" id="4174552">hdr</span>&nbsp;<span class="op" id="4174556">*</span><span class="ident" id="4174557">Header</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4174565">if</span>&nbsp;<span class="ident" id="4174568">tr</span><span class="op" id="4174570">.</span><span class="ident" id="4174571">err</span>&nbsp;<span class="op" id="4174575">==</span>&nbsp;<span class="ident" id="4174578">nil</span>&nbsp;<span class="op" id="4174582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4174586">tr</span><span class="op" id="4174588">.</span><span class="ident" id="4174589">skipUnread</span><span class="op" id="4174599">(</span><span class="op" id="4174600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4174603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4174606">if</span>&nbsp;<span class="ident" id="4174609">tr</span><span class="op" id="4174611">.</span><span class="ident" id="4174612">err</span>&nbsp;<span class="op" id="4174616">!=</span>&nbsp;<span class="ident" id="4174619">nil</span>&nbsp;<span class="op" id="4174623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4174627">return</span>&nbsp;<span class="ident" id="4174634">hdr</span><span class="op" id="4174637">,</span>&nbsp;<span class="ident" id="4174639">tr</span><span class="op" id="4174641">.</span><span class="ident" id="4174642">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4174647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4174650">hdr</span>&nbsp;<span class="op" id="4174654">=</span>&nbsp;<span class="ident" id="4174656">tr</span><span class="op" id="4174658">.</span><span class="ident" id="4174659">readHeader</span><span class="op" id="4174669">(</span><span class="op" id="4174670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4174673">if</span>&nbsp;<span class="ident" id="4174676">hdr</span>&nbsp;<span class="op" id="4174680">==</span>&nbsp;<span class="ident" id="4174683">nil</span>&nbsp;<span class="op" id="4174687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4174691">return</span>&nbsp;<span class="ident" id="4174698">hdr</span><span class="op" id="4174701">,</span>&nbsp;<span class="ident" id="4174703">tr</span><span class="op" id="4174705">.</span><span class="ident" id="4174706">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4174711">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4174714">//&nbsp;Check&nbsp;for&nbsp;PAX/GNU&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4174744">switch</span>&nbsp;<span class="ident" id="4174751">hdr</span><span class="op" id="4174754">.</span><span class="ident" id="4174755">Typeflag</span>&nbsp;<span class="op" id="4174764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4174767">case</span>&nbsp;<span class="ident" id="4174772">TypeXHeader</span><span class="op" id="4174783">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4174787">//&nbsp;&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4174813">headers</span><span class="op" id="4174820">,</span>&nbsp;<span class="ident" id="4174822">err</span>&nbsp;<span class="op" id="4174826">:=</span>&nbsp;<span class="ident" id="4174829">parsePAX</span><span class="op" id="4174837">(</span><span class="ident" id="4174838">tr</span><span class="op" id="4174840">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4174844">if</span>&nbsp;<span class="ident" id="4174847">err</span>&nbsp;<span class="op" id="4174851">!=</span>&nbsp;<span class="ident" id="4174854">nil</span>&nbsp;<span class="op" id="4174858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4174863">return</span>&nbsp;<span class="ident" id="4174870">nil</span><span class="op" id="4174873">,</span>&nbsp;<span class="ident" id="4174875">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4174881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4174885">//&nbsp;We&nbsp;actually&nbsp;read&nbsp;the&nbsp;whole&nbsp;file,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4174923">//&nbsp;but&nbsp;this&nbsp;skips&nbsp;alignment&nbsp;padding</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4174961">tr</span><span class="op" id="4174963">.</span><span class="ident" id="4174964">skipUnread</span><span class="op" id="4174974">(</span><span class="op" id="4174975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4174979">hdr</span>&nbsp;<span class="op" id="4174983">=</span>&nbsp;<span class="ident" id="4174985">tr</span><span class="op" id="4174987">.</span><span class="ident" id="4174988">readHeader</span><span class="op" id="4174998">(</span><span class="op" id="4174999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4175003">mergePAX</span><span class="op" id="4175011">(</span><span class="ident" id="4175012">hdr</span><span class="op" id="4175015">,</span>&nbsp;<span class="ident" id="4175017">headers</span><span class="op" id="4175024">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4175029">//&nbsp;Check&nbsp;for&nbsp;a&nbsp;PAX&nbsp;format&nbsp;sparse&nbsp;file</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4175069">sp</span><span class="op" id="4175071">,</span>&nbsp;<span class="ident" id="4175073">err</span>&nbsp;<span class="op" id="4175077">:=</span>&nbsp;<span class="ident" id="4175080">tr</span><span class="op" id="4175082">.</span><span class="ident" id="4175083">checkForGNUSparsePAXHeaders</span><span class="op" id="4175110">(</span><span class="ident" id="4175111">hdr</span><span class="op" id="4175114">,</span>&nbsp;<span class="ident" id="4175116">headers</span><span class="op" id="4175123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4175127">if</span>&nbsp;<span class="ident" id="4175130">err</span>&nbsp;<span class="op" id="4175134">!=</span>&nbsp;<span class="ident" id="4175137">nil</span>&nbsp;<span class="op" id="4175141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4175146">tr</span><span class="op" id="4175148">.</span><span class="ident" id="4175149">err</span>&nbsp;<span class="op" id="4175153">=</span>&nbsp;<span class="ident" id="4175155">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4175162">return</span>&nbsp;<span class="ident" id="4175169">nil</span><span class="op" id="4175172">,</span>&nbsp;<span class="ident" id="4175174">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4175180">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4175184">if</span>&nbsp;<span class="ident" id="4175187">sp</span>&nbsp;<span class="op" id="4175190">!=</span>&nbsp;<span class="ident" id="4175193">nil</span>&nbsp;<span class="op" id="4175197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4175202">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4175254">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader&nbsp;to&nbsp;a&nbsp;sparse&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4175313">tr</span><span class="op" id="4175315">.</span><span class="ident" id="4175316">curr</span>&nbsp;<span class="op" id="4175321">=</span>&nbsp;<span class="op" id="4175323">&amp;</span><span class="ident" id="4175324">sparseFileReader</span><span class="op" id="4175340">{</span><span class="ident" id="4175341">rfr</span><span class="op" id="4175344">:</span>&nbsp;<span class="ident" id="4175346">tr</span><span class="op" id="4175348">.</span><span class="ident" id="4175349">curr</span><span class="op" id="4175353">.</span><span class="op" id="4175354">(</span><span class="op" id="4175355">*</span><span class="ident" id="4175356">regFileReader</span><span class="op" id="4175369">)</span><span class="op" id="4175370">,</span>&nbsp;<span class="ident" id="4175372">sp</span><span class="op" id="4175374">:</span>&nbsp;<span class="ident" id="4175376">sp</span><span class="op" id="4175378">,</span>&nbsp;<span class="ident" id="4175380">tot</span><span class="op" id="4175383">:</span>&nbsp;<span class="ident" id="4175385">hdr</span><span class="op" id="4175388">.</span><span class="ident" id="4175389">Size</span><span class="op" id="4175393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4175397">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4175401">return</span>&nbsp;<span class="ident" id="4175408">hdr</span><span class="op" id="4175411">,</span>&nbsp;<span class="ident" id="4175413">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4175418">case</span>&nbsp;<span class="ident" id="4175423">TypeGNULongName</span><span class="op" id="4175438">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4175442">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;name&nbsp;header.&nbsp;Its&nbsp;contents&nbsp;are&nbsp;the&nbsp;real&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4175516">realname</span><span class="op" id="4175524">,</span>&nbsp;<span class="ident" id="4175526">err</span>&nbsp;<span class="op" id="4175530">:=</span>&nbsp;<span class="ident" id="4175533">ioutil</span><span class="op" id="4175539">.</span><span class="ident" id="4175540">ReadAll</span><span class="op" id="4175547">(</span><span class="ident" id="4175548">tr</span><span class="op" id="4175550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4175554">if</span>&nbsp;<span class="ident" id="4175557">err</span>&nbsp;<span class="op" id="4175561">!=</span>&nbsp;<span class="ident" id="4175564">nil</span>&nbsp;<span class="op" id="4175568">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4175573">return</span>&nbsp;<span class="ident" id="4175580">nil</span><span class="op" id="4175583">,</span>&nbsp;<span class="ident" id="4175585">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4175591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4175595">hdr</span><span class="op" id="4175598">,</span>&nbsp;<span class="ident" id="4175600">err</span>&nbsp;<span class="op" id="4175604">:=</span>&nbsp;<span class="ident" id="4175607">tr</span><span class="op" id="4175609">.</span><span class="ident" id="4175610">Next</span><span class="op" id="4175614">(</span><span class="op" id="4175615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4175619">hdr</span><span class="op" id="4175622">.</span><span class="ident" id="4175623">Name</span>&nbsp;<span class="op" id="4175628">=</span>&nbsp;<span class="ident" id="4175630">cString</span><span class="op" id="4175637">(</span><span class="ident" id="4175638">realname</span><span class="op" id="4175646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4175650">return</span>&nbsp;<span class="ident" id="4175657">hdr</span><span class="op" id="4175660">,</span>&nbsp;<span class="ident" id="4175662">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4175667">case</span>&nbsp;<span class="ident" id="4175672">TypeGNULongLink</span><span class="op" id="4175687">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4175691">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;link&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4175728">realname</span><span class="op" id="4175736">,</span>&nbsp;<span class="ident" id="4175738">err</span>&nbsp;<span class="op" id="4175742">:=</span>&nbsp;<span class="ident" id="4175745">ioutil</span><span class="op" id="4175751">.</span><span class="ident" id="4175752">ReadAll</span><span class="op" id="4175759">(</span><span class="ident" id="4175760">tr</span><span class="op" id="4175762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4175766">if</span>&nbsp;<span class="ident" id="4175769">err</span>&nbsp;<span class="op" id="4175773">!=</span>&nbsp;<span class="ident" id="4175776">nil</span>&nbsp;<span class="op" id="4175780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4175785">return</span>&nbsp;<span class="ident" id="4175792">nil</span><span class="op" id="4175795">,</span>&nbsp;<span class="ident" id="4175797">err</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4175803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4175807">hdr</span><span class="op" id="4175810">,</span>&nbsp;<span class="ident" id="4175812">err</span>&nbsp;<span class="op" id="4175816">:=</span>&nbsp;<span class="ident" id="4175819">tr</span><span class="op" id="4175821">.</span><span class="ident" id="4175822">Next</span><span class="op" id="4175826">(</span><span class="op" id="4175827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4175831">hdr</span><span class="op" id="4175834">.</span><span class="ident" id="4175835">Linkname</span>&nbsp;<span class="op" id="4175844">=</span>&nbsp;<span class="ident" id="4175846">cString</span><span class="op" id="4175853">(</span><span class="ident" id="4175854">realname</span><span class="op" id="4175862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4175866">return</span>&nbsp;<span class="ident" id="4175873">hdr</span><span class="op" id="4175876">,</span>&nbsp;<span class="ident" id="4175878">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4175883">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4175886">return</span>&nbsp;<span class="ident" id="4175893">hdr</span><span class="op" id="4175896">,</span>&nbsp;<span class="ident" id="4175898">tr</span><span class="op" id="4175900">.</span><span class="ident" id="4175901">err</span><br>
<span class="lineno"></span><span class="op" id="4175905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4175908">//&nbsp;checkForGNUSparsePAXHeaders&nbsp;checks&nbsp;the&nbsp;PAX&nbsp;headers&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;headers.&nbsp;If&nbsp;they&nbsp;are&nbsp;found,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="4176010">//&nbsp;this&nbsp;function&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;and&nbsp;returns&nbsp;it.&nbsp;Unknown&nbsp;sparse&nbsp;formats&nbsp;are&nbsp;ignored,&nbsp;causing&nbsp;the&nbsp;file&nbsp;to</span><br>
<span class="lineno">150</span><span class="comment" id="4176120">//&nbsp;be&nbsp;treated&nbsp;as&nbsp;a&nbsp;regular&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="4176153">func</span>&nbsp;<span class="op" id="4176158">(</span><span class="ident" id="4176159">tr</span>&nbsp;<span class="op" id="4176162">*</span><span class="ident" id="4176163">Reader</span><span class="op" id="4176169">)</span>&nbsp;<span class="ident" id="4176171">checkForGNUSparsePAXHeaders</span><span class="op" id="4176198">(</span><span class="ident" id="4176199">hdr</span>&nbsp;<span class="op" id="4176203">*</span><span class="ident" id="4176204">Header</span><span class="op" id="4176210">,</span>&nbsp;<span class="ident" id="4176212">headers</span>&nbsp;<span class="keyword" id="4176220">map</span><span class="op" id="4176223">[</span><span class="builtintype" id="4176224">string</span><span class="op" id="4176230">]</span><span class="builtintype" id="4176231">string</span><span class="op" id="4176237">)</span>&nbsp;<span class="op" id="4176239">(</span><span class="op" id="4176240">[</span><span class="op" id="4176241">]</span><span class="ident" id="4176242">sparseEntry</span><span class="op" id="4176253">,</span>&nbsp;<span class="builtintype" id="4176255">error</span><span class="op" id="4176260">)</span>&nbsp;<span class="op" id="4176262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4176265">var</span>&nbsp;<span class="ident" id="4176269">sparseFormat</span>&nbsp;<span class="builtintype" id="4176282">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4176291">//&nbsp;Check&nbsp;for&nbsp;sparse&nbsp;format&nbsp;indicators</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4176330">major</span><span class="op" id="4176335">,</span>&nbsp;<span class="ident" id="4176337">majorOk</span>&nbsp;<span class="op" id="4176345">:=</span>&nbsp;<span class="ident" id="4176348">headers</span><span class="op" id="4176355">[</span><span class="ident" id="4176356">paxGNUSparseMajor</span><span class="op" id="4176373">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4176376">minor</span><span class="op" id="4176381">,</span>&nbsp;<span class="ident" id="4176383">minorOk</span>&nbsp;<span class="op" id="4176391">:=</span>&nbsp;<span class="ident" id="4176394">headers</span><span class="op" id="4176401">[</span><span class="ident" id="4176402">paxGNUSparseMinor</span><span class="op" id="4176419">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4176422">sparseName</span><span class="op" id="4176432">,</span>&nbsp;<span class="ident" id="4176434">sparseNameOk</span>&nbsp;<span class="op" id="4176447">:=</span>&nbsp;<span class="ident" id="4176450">headers</span><span class="op" id="4176457">[</span><span class="ident" id="4176458">paxGNUSparseName</span><span class="op" id="4176474">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4176477">_</span><span class="op" id="4176478">,</span>&nbsp;<span class="ident" id="4176480">sparseMapOk</span>&nbsp;<span class="op" id="4176492">:=</span>&nbsp;<span class="ident" id="4176495">headers</span><span class="op" id="4176502">[</span><span class="ident" id="4176503">paxGNUSparseMap</span><span class="op" id="4176518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4176521">sparseSize</span><span class="op" id="4176531">,</span>&nbsp;<span class="ident" id="4176533">sparseSizeOk</span>&nbsp;<span class="op" id="4176546">:=</span>&nbsp;<span class="ident" id="4176549">headers</span><span class="op" id="4176556">[</span><span class="ident" id="4176557">paxGNUSparseSize</span><span class="op" id="4176573">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4176576">sparseRealSize</span><span class="op" id="4176590">,</span>&nbsp;<span class="ident" id="4176592">sparseRealSizeOk</span>&nbsp;<span class="op" id="4176609">:=</span>&nbsp;<span class="ident" id="4176612">headers</span><span class="op" id="4176619">[</span><span class="ident" id="4176620">paxGNUSparseRealSize</span><span class="op" id="4176640">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4176644">//&nbsp;Identify&nbsp;which,&nbsp;if&nbsp;any,&nbsp;sparse&nbsp;format&nbsp;applies&nbsp;from&nbsp;which&nbsp;PAX&nbsp;headers&nbsp;are&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4176725">if</span>&nbsp;<span class="ident" id="4176728">majorOk</span>&nbsp;<span class="op" id="4176736">&amp;&amp;</span>&nbsp;<span class="ident" id="4176739">minorOk</span>&nbsp;<span class="op" id="4176747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4176751">sparseFormat</span>&nbsp;<span class="op" id="4176764">=</span>&nbsp;<span class="ident" id="4176766">major</span>&nbsp;<span class="op" id="4176772">+</span>&nbsp;<span class="string" id="4176774">&#34;.&#34;</span>&nbsp;<span class="op" id="4176778">+</span>&nbsp;<span class="ident" id="4176780">minor</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4176787">}</span>&nbsp;<span class="keyword" id="4176789">else</span>&nbsp;<span class="keyword" id="4176794">if</span>&nbsp;<span class="ident" id="4176797">sparseNameOk</span>&nbsp;<span class="op" id="4176810">&amp;&amp;</span>&nbsp;<span class="ident" id="4176813">sparseMapOk</span>&nbsp;<span class="op" id="4176825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4176829">sparseFormat</span>&nbsp;<span class="op" id="4176842">=</span>&nbsp;<span class="string" id="4176844">&#34;0.1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4176851">}</span>&nbsp;<span class="keyword" id="4176853">else</span>&nbsp;<span class="keyword" id="4176858">if</span>&nbsp;<span class="ident" id="4176861">sparseSizeOk</span>&nbsp;<span class="op" id="4176874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4176878">sparseFormat</span>&nbsp;<span class="op" id="4176891">=</span>&nbsp;<span class="string" id="4176893">&#34;0.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4176900">}</span>&nbsp;<span class="keyword" id="4176902">else</span>&nbsp;<span class="op" id="4176907">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4176911">//&nbsp;Not&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4176950">return</span>&nbsp;<span class="ident" id="4176957">nil</span><span class="op" id="4176960">,</span>&nbsp;<span class="ident" id="4176962">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4176967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4176971">//&nbsp;Check&nbsp;for&nbsp;unknown&nbsp;sparse&nbsp;format</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177007">if</span>&nbsp;<span class="ident" id="4177010">sparseFormat</span>&nbsp;<span class="op" id="4177023">!=</span>&nbsp;<span class="string" id="4177026">&#34;0.0&#34;</span>&nbsp;<span class="op" id="4177032">&amp;&amp;</span>&nbsp;<span class="ident" id="4177035">sparseFormat</span>&nbsp;<span class="op" id="4177048">!=</span>&nbsp;<span class="string" id="4177051">&#34;0.1&#34;</span>&nbsp;<span class="op" id="4177057">&amp;&amp;</span>&nbsp;<span class="ident" id="4177060">sparseFormat</span>&nbsp;<span class="op" id="4177073">!=</span>&nbsp;<span class="string" id="4177076">&#34;1.0&#34;</span>&nbsp;<span class="op" id="4177082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177086">return</span>&nbsp;<span class="ident" id="4177093">nil</span><span class="op" id="4177096">,</span>&nbsp;<span class="ident" id="4177098">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4177103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4177107">//&nbsp;Update&nbsp;hdr&nbsp;from&nbsp;GNU&nbsp;sparse&nbsp;PAX&nbsp;headers</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177150">if</span>&nbsp;<span class="ident" id="4177153">sparseNameOk</span>&nbsp;<span class="op" id="4177166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4177170">hdr</span><span class="op" id="4177173">.</span><span class="ident" id="4177174">Name</span>&nbsp;<span class="op" id="4177179">=</span>&nbsp;<span class="ident" id="4177181">sparseName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4177193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177196">if</span>&nbsp;<span class="ident" id="4177199">sparseSizeOk</span>&nbsp;<span class="op" id="4177212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4177216">realSize</span><span class="op" id="4177224">,</span>&nbsp;<span class="ident" id="4177226">err</span>&nbsp;<span class="op" id="4177230">:=</span>&nbsp;<span class="ident" id="4177233">strconv</span><span class="op" id="4177240">.</span><span class="ident" id="4177241">ParseInt</span><span class="op" id="4177249">(</span><span class="ident" id="4177250">sparseSize</span><span class="op" id="4177260">,</span>&nbsp;<span class="num" id="4177262">10</span><span class="op" id="4177264">,</span>&nbsp;<span class="num" id="4177266">0</span><span class="op" id="4177267">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177271">if</span>&nbsp;<span class="ident" id="4177274">err</span>&nbsp;<span class="op" id="4177278">!=</span>&nbsp;<span class="ident" id="4177281">nil</span>&nbsp;<span class="op" id="4177285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177290">return</span>&nbsp;<span class="ident" id="4177297">nil</span><span class="op" id="4177300">,</span>&nbsp;<span class="ident" id="4177302">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4177314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4177318">hdr</span><span class="op" id="4177321">.</span><span class="ident" id="4177322">Size</span>&nbsp;<span class="op" id="4177327">=</span>&nbsp;<span class="ident" id="4177329">realSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4177339">}</span>&nbsp;<span class="keyword" id="4177341">else</span>&nbsp;<span class="keyword" id="4177346">if</span>&nbsp;<span class="ident" id="4177349">sparseRealSizeOk</span>&nbsp;<span class="op" id="4177366">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4177370">realSize</span><span class="op" id="4177378">,</span>&nbsp;<span class="ident" id="4177380">err</span>&nbsp;<span class="op" id="4177384">:=</span>&nbsp;<span class="ident" id="4177387">strconv</span><span class="op" id="4177394">.</span><span class="ident" id="4177395">ParseInt</span><span class="op" id="4177403">(</span><span class="ident" id="4177404">sparseRealSize</span><span class="op" id="4177418">,</span>&nbsp;<span class="num" id="4177420">10</span><span class="op" id="4177422">,</span>&nbsp;<span class="num" id="4177424">0</span><span class="op" id="4177425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177429">if</span>&nbsp;<span class="ident" id="4177432">err</span>&nbsp;<span class="op" id="4177436">!=</span>&nbsp;<span class="ident" id="4177439">nil</span>&nbsp;<span class="op" id="4177443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177448">return</span>&nbsp;<span class="ident" id="4177455">nil</span><span class="op" id="4177458">,</span>&nbsp;<span class="ident" id="4177460">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4177472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4177476">hdr</span><span class="op" id="4177479">.</span><span class="ident" id="4177480">Size</span>&nbsp;<span class="op" id="4177485">=</span>&nbsp;<span class="ident" id="4177487">realSize</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4177497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4177501">//&nbsp;Set&nbsp;up&nbsp;the&nbsp;sparse&nbsp;map,&nbsp;according&nbsp;to&nbsp;the&nbsp;particular&nbsp;sparse&nbsp;format&nbsp;in&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177577">var</span>&nbsp;<span class="ident" id="4177581">sp</span>&nbsp;<span class="op" id="4177584">[</span><span class="op" id="4177585">]</span><span class="ident" id="4177586">sparseEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177599">var</span>&nbsp;<span class="ident" id="4177603">err</span>&nbsp;<span class="builtintype" id="4177607">error</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177614">switch</span>&nbsp;<span class="ident" id="4177621">sparseFormat</span>&nbsp;<span class="op" id="4177634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177637">case</span>&nbsp;<span class="string" id="4177642">&#34;0.0&#34;</span><span class="op" id="4177647">,</span>&nbsp;<span class="string" id="4177649">&#34;0.1&#34;</span><span class="op" id="4177654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4177658">sp</span><span class="op" id="4177660">,</span>&nbsp;<span class="ident" id="4177662">err</span>&nbsp;<span class="op" id="4177666">=</span>&nbsp;<span class="ident" id="4177668">readGNUSparseMap0x1</span><span class="op" id="4177687">(</span><span class="ident" id="4177688">headers</span><span class="op" id="4177695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177698">case</span>&nbsp;<span class="string" id="4177703">&#34;1.0&#34;</span><span class="op" id="4177708">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4177712">sp</span><span class="op" id="4177714">,</span>&nbsp;<span class="ident" id="4177716">err</span>&nbsp;<span class="op" id="4177720">=</span>&nbsp;<span class="ident" id="4177722">readGNUSparseMap1x0</span><span class="op" id="4177741">(</span><span class="ident" id="4177742">tr</span><span class="op" id="4177744">.</span><span class="ident" id="4177745">curr</span><span class="op" id="4177749">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4177752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177755">return</span>&nbsp;<span class="ident" id="4177762">sp</span><span class="op" id="4177764">,</span>&nbsp;<span class="ident" id="4177766">err</span><br>
<span class="lineno"></span><span class="op" id="4177770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4177773">//&nbsp;mergePAX&nbsp;merges&nbsp;well&nbsp;known&nbsp;headers&nbsp;according&nbsp;to&nbsp;PAX&nbsp;standard.</span><br>
<span class="lineno">210</span><span class="comment" id="4177838">//&nbsp;In&nbsp;general&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;as&nbsp;those&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="4177894">//&nbsp;in&nbsp;the&nbsp;header&nbsp;struct&nbsp;overwrite&nbsp;those&nbsp;found&nbsp;in&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="4177954">//&nbsp;struct&nbsp;with&nbsp;higher&nbsp;precision&nbsp;or&nbsp;longer&nbsp;values.&nbsp;Esp.&nbsp;useful</span><br>
<span class="lineno"></span><span class="comment" id="4178016">//&nbsp;for&nbsp;name&nbsp;and&nbsp;linkname&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="4178049">func</span>&nbsp;<span class="ident" id="4178054">mergePAX</span><span class="op" id="4178062">(</span><span class="ident" id="4178063">hdr</span>&nbsp;<span class="op" id="4178067">*</span><span class="ident" id="4178068">Header</span><span class="op" id="4178074">,</span>&nbsp;<span class="ident" id="4178076">headers</span>&nbsp;<span class="keyword" id="4178084">map</span><span class="op" id="4178087">[</span><span class="builtintype" id="4178088">string</span><span class="op" id="4178094">]</span><span class="builtintype" id="4178095">string</span><span class="op" id="4178101">)</span>&nbsp;<span class="builtintype" id="4178103">error</span>&nbsp;<span class="op" id="4178109">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178112">for</span>&nbsp;<span class="ident" id="4178116">k</span><span class="op" id="4178117">,</span>&nbsp;<span class="ident" id="4178119">v</span>&nbsp;<span class="op" id="4178121">:=</span>&nbsp;<span class="keyword" id="4178124">range</span>&nbsp;<span class="ident" id="4178130">headers</span>&nbsp;<span class="op" id="4178138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178142">switch</span>&nbsp;<span class="ident" id="4178149">k</span>&nbsp;<span class="op" id="4178151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178155">case</span>&nbsp;<span class="ident" id="4178160">paxPath</span><span class="op" id="4178167">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178172">hdr</span><span class="op" id="4178175">.</span><span class="ident" id="4178176">Name</span>&nbsp;<span class="op" id="4178181">=</span>&nbsp;<span class="ident" id="4178183">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178187">case</span>&nbsp;<span class="ident" id="4178192">paxLinkpath</span><span class="op" id="4178203">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178208">hdr</span><span class="op" id="4178211">.</span><span class="ident" id="4178212">Linkname</span>&nbsp;<span class="op" id="4178221">=</span>&nbsp;<span class="ident" id="4178223">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178227">case</span>&nbsp;<span class="ident" id="4178232">paxGname</span><span class="op" id="4178240">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178245">hdr</span><span class="op" id="4178248">.</span><span class="ident" id="4178249">Gname</span>&nbsp;<span class="op" id="4178255">=</span>&nbsp;<span class="ident" id="4178257">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178261">case</span>&nbsp;<span class="ident" id="4178266">paxUname</span><span class="op" id="4178274">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178279">hdr</span><span class="op" id="4178282">.</span><span class="ident" id="4178283">Uname</span>&nbsp;<span class="op" id="4178289">=</span>&nbsp;<span class="ident" id="4178291">v</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178295">case</span>&nbsp;<span class="ident" id="4178300">paxUid</span><span class="op" id="4178306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178311">uid</span><span class="op" id="4178314">,</span>&nbsp;<span class="ident" id="4178316">err</span>&nbsp;<span class="op" id="4178320">:=</span>&nbsp;<span class="ident" id="4178323">strconv</span><span class="op" id="4178330">.</span><span class="ident" id="4178331">ParseInt</span><span class="op" id="4178339">(</span><span class="ident" id="4178340">v</span><span class="op" id="4178341">,</span>&nbsp;<span class="num" id="4178343">10</span><span class="op" id="4178345">,</span>&nbsp;<span class="num" id="4178347">0</span><span class="op" id="4178348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178353">if</span>&nbsp;<span class="ident" id="4178356">err</span>&nbsp;<span class="op" id="4178360">!=</span>&nbsp;<span class="ident" id="4178363">nil</span>&nbsp;<span class="op" id="4178367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178373">return</span>&nbsp;<span class="ident" id="4178380">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4178387">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178392">hdr</span><span class="op" id="4178395">.</span><span class="ident" id="4178396">Uid</span>&nbsp;<span class="op" id="4178400">=</span>&nbsp;<span class="builtintype" id="4178402">int</span><span class="op" id="4178405">(</span><span class="ident" id="4178406">uid</span><span class="op" id="4178409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178413">case</span>&nbsp;<span class="ident" id="4178418">paxGid</span><span class="op" id="4178424">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178429">gid</span><span class="op" id="4178432">,</span>&nbsp;<span class="ident" id="4178434">err</span>&nbsp;<span class="op" id="4178438">:=</span>&nbsp;<span class="ident" id="4178441">strconv</span><span class="op" id="4178448">.</span><span class="ident" id="4178449">ParseInt</span><span class="op" id="4178457">(</span><span class="ident" id="4178458">v</span><span class="op" id="4178459">,</span>&nbsp;<span class="num" id="4178461">10</span><span class="op" id="4178463">,</span>&nbsp;<span class="num" id="4178465">0</span><span class="op" id="4178466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178471">if</span>&nbsp;<span class="ident" id="4178474">err</span>&nbsp;<span class="op" id="4178478">!=</span>&nbsp;<span class="ident" id="4178481">nil</span>&nbsp;<span class="op" id="4178485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178491">return</span>&nbsp;<span class="ident" id="4178498">err</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4178505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178510">hdr</span><span class="op" id="4178513">.</span><span class="ident" id="4178514">Gid</span>&nbsp;<span class="op" id="4178518">=</span>&nbsp;<span class="builtintype" id="4178520">int</span><span class="op" id="4178523">(</span><span class="ident" id="4178524">gid</span><span class="op" id="4178527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178531">case</span>&nbsp;<span class="ident" id="4178536">paxAtime</span><span class="op" id="4178544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178549">t</span><span class="op" id="4178550">,</span>&nbsp;<span class="ident" id="4178552">err</span>&nbsp;<span class="op" id="4178556">:=</span>&nbsp;<span class="ident" id="4178559">parsePAXTime</span><span class="op" id="4178571">(</span><span class="ident" id="4178572">v</span><span class="op" id="4178573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178578">if</span>&nbsp;<span class="ident" id="4178581">err</span>&nbsp;<span class="op" id="4178585">!=</span>&nbsp;<span class="ident" id="4178588">nil</span>&nbsp;<span class="op" id="4178592">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178598">return</span>&nbsp;<span class="ident" id="4178605">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4178612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178617">hdr</span><span class="op" id="4178620">.</span><span class="ident" id="4178621">AccessTime</span>&nbsp;<span class="op" id="4178632">=</span>&nbsp;<span class="ident" id="4178634">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178638">case</span>&nbsp;<span class="ident" id="4178643">paxMtime</span><span class="op" id="4178651">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178656">t</span><span class="op" id="4178657">,</span>&nbsp;<span class="ident" id="4178659">err</span>&nbsp;<span class="op" id="4178663">:=</span>&nbsp;<span class="ident" id="4178666">parsePAXTime</span><span class="op" id="4178678">(</span><span class="ident" id="4178679">v</span><span class="op" id="4178680">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178685">if</span>&nbsp;<span class="ident" id="4178688">err</span>&nbsp;<span class="op" id="4178692">!=</span>&nbsp;<span class="ident" id="4178695">nil</span>&nbsp;<span class="op" id="4178699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178705">return</span>&nbsp;<span class="ident" id="4178712">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4178719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178724">hdr</span><span class="op" id="4178727">.</span><span class="ident" id="4178728">ModTime</span>&nbsp;<span class="op" id="4178736">=</span>&nbsp;<span class="ident" id="4178738">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178742">case</span>&nbsp;<span class="ident" id="4178747">paxCtime</span><span class="op" id="4178755">:</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178760">t</span><span class="op" id="4178761">,</span>&nbsp;<span class="ident" id="4178763">err</span>&nbsp;<span class="op" id="4178767">:=</span>&nbsp;<span class="ident" id="4178770">parsePAXTime</span><span class="op" id="4178782">(</span><span class="ident" id="4178783">v</span><span class="op" id="4178784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178789">if</span>&nbsp;<span class="ident" id="4178792">err</span>&nbsp;<span class="op" id="4178796">!=</span>&nbsp;<span class="ident" id="4178799">nil</span>&nbsp;<span class="op" id="4178803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178809">return</span>&nbsp;<span class="ident" id="4178816">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4178823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178828">hdr</span><span class="op" id="4178831">.</span><span class="ident" id="4178832">ChangeTime</span>&nbsp;<span class="op" id="4178843">=</span>&nbsp;<span class="ident" id="4178845">t</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178849">case</span>&nbsp;<span class="ident" id="4178854">paxSize</span><span class="op" id="4178861">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178866">size</span><span class="op" id="4178870">,</span>&nbsp;<span class="ident" id="4178872">err</span>&nbsp;<span class="op" id="4178876">:=</span>&nbsp;<span class="ident" id="4178879">strconv</span><span class="op" id="4178886">.</span><span class="ident" id="4178887">ParseInt</span><span class="op" id="4178895">(</span><span class="ident" id="4178896">v</span><span class="op" id="4178897">,</span>&nbsp;<span class="num" id="4178899">10</span><span class="op" id="4178901">,</span>&nbsp;<span class="num" id="4178903">0</span><span class="op" id="4178904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178909">if</span>&nbsp;<span class="ident" id="4178912">err</span>&nbsp;<span class="op" id="4178916">!=</span>&nbsp;<span class="ident" id="4178919">nil</span>&nbsp;<span class="op" id="4178923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178929">return</span>&nbsp;<span class="ident" id="4178936">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4178943">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178948">hdr</span><span class="op" id="4178951">.</span><span class="ident" id="4178952">Size</span>&nbsp;<span class="op" id="4178957">=</span>&nbsp;<span class="ident" id="4178959">int64</span><span class="op" id="4178964">(</span><span class="ident" id="4178965">size</span><span class="op" id="4178969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178973">default</span><span class="op" id="4178980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178985">if</span>&nbsp;<span class="ident" id="4178988">strings</span><span class="op" id="4178995">.</span><span class="ident" id="4178996">HasPrefix</span><span class="op" id="4179005">(</span><span class="ident" id="4179006">k</span><span class="op" id="4179007">,</span>&nbsp;<span class="ident" id="4179009">paxXattr</span><span class="op" id="4179017">)</span>&nbsp;<span class="op" id="4179019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179025">if</span>&nbsp;<span class="ident" id="4179028">hdr</span><span class="op" id="4179031">.</span><span class="ident" id="4179032">Xattrs</span>&nbsp;<span class="op" id="4179039">==</span>&nbsp;<span class="ident" id="4179042">nil</span>&nbsp;<span class="op" id="4179046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4179053">hdr</span><span class="op" id="4179056">.</span><span class="ident" id="4179057">Xattrs</span>&nbsp;<span class="op" id="4179064">=</span>&nbsp;<span class="builtinfunc" id="4179066">make</span><span class="op" id="4179070">(</span><span class="keyword" id="4179071">map</span><span class="op" id="4179074">[</span><span class="builtintype" id="4179075">string</span><span class="op" id="4179081">]</span><span class="builtintype" id="4179082">string</span><span class="op" id="4179088">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4179094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4179100">hdr</span><span class="op" id="4179103">.</span><span class="ident" id="4179104">Xattrs</span><span class="op" id="4179110">[</span><span class="ident" id="4179111">k</span><span class="op" id="4179112">[</span><span class="builtinfunc" id="4179113">len</span><span class="op" id="4179116">(</span><span class="ident" id="4179117">paxXattr</span><span class="op" id="4179125">)</span><span class="op" id="4179126">:</span><span class="op" id="4179127">]</span><span class="op" id="4179128">]</span>&nbsp;<span class="op" id="4179130">=</span>&nbsp;<span class="ident" id="4179132">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4179137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4179141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4179144">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179147">return</span>&nbsp;<span class="ident" id="4179154">nil</span><br>
<span class="lineno"></span><span class="op" id="4179158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4179161">//&nbsp;parsePAXTime&nbsp;takes&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;%d.%d&nbsp;as&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4179226">//&nbsp;the&nbsp;PAX&nbsp;specification.</span><br>
<span class="lineno">275</span><span class="keyword" id="4179252">func</span>&nbsp;<span class="ident" id="4179257">parsePAXTime</span><span class="op" id="4179269">(</span><span class="ident" id="4179270">t</span>&nbsp;<span class="builtintype" id="4179272">string</span><span class="op" id="4179278">)</span>&nbsp;<span class="op" id="4179280">(</span><span class="ident" id="4179281">time</span><span class="op" id="4179285">.</span><span class="ident" id="4179286">Time</span><span class="op" id="4179290">,</span>&nbsp;<span class="builtintype" id="4179292">error</span><span class="op" id="4179297">)</span>&nbsp;<span class="op" id="4179299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4179302">buf</span>&nbsp;<span class="op" id="4179306">:=</span>&nbsp;<span class="op" id="4179309">[</span><span class="op" id="4179310">]</span><span class="builtintype" id="4179311">byte</span><span class="op" id="4179315">(</span><span class="ident" id="4179316">t</span><span class="op" id="4179317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4179320">pos</span>&nbsp;<span class="op" id="4179324">:=</span>&nbsp;<span class="ident" id="4179327">bytes</span><span class="op" id="4179332">.</span><span class="ident" id="4179333">IndexByte</span><span class="op" id="4179342">(</span><span class="ident" id="4179343">buf</span><span class="op" id="4179346">,</span>&nbsp;<span class="string" id="4179348">&#39;.&#39;</span><span class="op" id="4179351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179354">var</span>&nbsp;<span class="ident" id="4179358">seconds</span><span class="op" id="4179365">,</span>&nbsp;<span class="ident" id="4179367">nanoseconds</span>&nbsp;<span class="ident" id="4179379">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179386">var</span>&nbsp;<span class="ident" id="4179390">err</span>&nbsp;<span class="builtintype" id="4179394">error</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179401">if</span>&nbsp;<span class="ident" id="4179404">pos</span>&nbsp;<span class="op" id="4179408">==</span>&nbsp;<span class="op" id="4179411">-</span><span class="num" id="4179412">1</span>&nbsp;<span class="op" id="4179414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4179418">seconds</span><span class="op" id="4179425">,</span>&nbsp;<span class="ident" id="4179427">err</span>&nbsp;<span class="op" id="4179431">=</span>&nbsp;<span class="ident" id="4179433">strconv</span><span class="op" id="4179440">.</span><span class="ident" id="4179441">ParseInt</span><span class="op" id="4179449">(</span><span class="ident" id="4179450">t</span><span class="op" id="4179451">,</span>&nbsp;<span class="num" id="4179453">10</span><span class="op" id="4179455">,</span>&nbsp;<span class="num" id="4179457">0</span><span class="op" id="4179458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179462">if</span>&nbsp;<span class="ident" id="4179465">err</span>&nbsp;<span class="op" id="4179469">!=</span>&nbsp;<span class="ident" id="4179472">nil</span>&nbsp;<span class="op" id="4179476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179481">return</span>&nbsp;<span class="ident" id="4179488">time</span><span class="op" id="4179492">.</span><span class="ident" id="4179493">Time</span><span class="op" id="4179497">{</span><span class="op" id="4179498">}</span><span class="op" id="4179499">,</span>&nbsp;<span class="ident" id="4179501">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4179507">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4179510">}</span>&nbsp;<span class="keyword" id="4179512">else</span>&nbsp;<span class="op" id="4179517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4179521">seconds</span><span class="op" id="4179528">,</span>&nbsp;<span class="ident" id="4179530">err</span>&nbsp;<span class="op" id="4179534">=</span>&nbsp;<span class="ident" id="4179536">strconv</span><span class="op" id="4179543">.</span><span class="ident" id="4179544">ParseInt</span><span class="op" id="4179552">(</span><span class="builtintype" id="4179553">string</span><span class="op" id="4179559">(</span><span class="ident" id="4179560">buf</span><span class="op" id="4179563">[</span><span class="op" id="4179564">:</span><span class="ident" id="4179565">pos</span><span class="op" id="4179568">]</span><span class="op" id="4179569">)</span><span class="op" id="4179570">,</span>&nbsp;<span class="num" id="4179572">10</span><span class="op" id="4179574">,</span>&nbsp;<span class="num" id="4179576">0</span><span class="op" id="4179577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179581">if</span>&nbsp;<span class="ident" id="4179584">err</span>&nbsp;<span class="op" id="4179588">!=</span>&nbsp;<span class="ident" id="4179591">nil</span>&nbsp;<span class="op" id="4179595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179600">return</span>&nbsp;<span class="ident" id="4179607">time</span><span class="op" id="4179611">.</span><span class="ident" id="4179612">Time</span><span class="op" id="4179616">{</span><span class="op" id="4179617">}</span><span class="op" id="4179618">,</span>&nbsp;<span class="ident" id="4179620">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4179626">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4179630">nano_buf</span>&nbsp;<span class="op" id="4179639">:=</span>&nbsp;<span class="builtintype" id="4179642">string</span><span class="op" id="4179648">(</span><span class="ident" id="4179649">buf</span><span class="op" id="4179652">[</span><span class="ident" id="4179653">pos</span><span class="op" id="4179656">+</span><span class="num" id="4179657">1</span><span class="op" id="4179658">:</span><span class="op" id="4179659">]</span><span class="op" id="4179660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4179664">//&nbsp;Pad&nbsp;as&nbsp;needed&nbsp;before&nbsp;converting&nbsp;to&nbsp;a&nbsp;decimal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4179715">//&nbsp;For&nbsp;example&nbsp;.030&nbsp;-&gt;&nbsp;.030000000&nbsp;-&gt;&nbsp;30000000&nbsp;nanoseconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179775">if</span>&nbsp;<span class="builtinfunc" id="4179778">len</span><span class="op" id="4179781">(</span><span class="ident" id="4179782">nano_buf</span><span class="op" id="4179790">)</span>&nbsp;<span class="op" id="4179792">&lt;</span>&nbsp;<span class="ident" id="4179794">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="4179815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4179820">//&nbsp;Right&nbsp;pad</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4179836">nano_buf</span>&nbsp;<span class="op" id="4179845">+=</span>&nbsp;<span class="ident" id="4179848">strings</span><span class="op" id="4179855">.</span><span class="ident" id="4179856">Repeat</span><span class="op" id="4179862">(</span><span class="string" id="4179863">&#34;0&#34;</span><span class="op" id="4179866">,</span>&nbsp;<span class="ident" id="4179868">maxNanoSecondIntSize</span><span class="op" id="4179888">-</span><span class="builtinfunc" id="4179889">len</span><span class="op" id="4179892">(</span><span class="ident" id="4179893">nano_buf</span><span class="op" id="4179901">)</span><span class="op" id="4179902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4179906">}</span>&nbsp;<span class="keyword" id="4179908">else</span>&nbsp;<span class="keyword" id="4179913">if</span>&nbsp;<span class="builtinfunc" id="4179916">len</span><span class="op" id="4179919">(</span><span class="ident" id="4179920">nano_buf</span><span class="op" id="4179928">)</span>&nbsp;<span class="op" id="4179930">&gt;</span>&nbsp;<span class="ident" id="4179932">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="4179953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4179958">//&nbsp;Right&nbsp;truncate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4179979">nano_buf</span>&nbsp;<span class="op" id="4179988">=</span>&nbsp;<span class="ident" id="4179990">nano_buf</span><span class="op" id="4179998">[</span><span class="op" id="4179999">:</span><span class="ident" id="4180000">maxNanoSecondIntSize</span><span class="op" id="4180020">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4180024">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4180028">nanoseconds</span><span class="op" id="4180039">,</span>&nbsp;<span class="ident" id="4180041">err</span>&nbsp;<span class="op" id="4180045">=</span>&nbsp;<span class="ident" id="4180047">strconv</span><span class="op" id="4180054">.</span><span class="ident" id="4180055">ParseInt</span><span class="op" id="4180063">(</span><span class="builtintype" id="4180064">string</span><span class="op" id="4180070">(</span><span class="ident" id="4180071">nano_buf</span><span class="op" id="4180079">)</span><span class="op" id="4180080">,</span>&nbsp;<span class="num" id="4180082">10</span><span class="op" id="4180084">,</span>&nbsp;<span class="num" id="4180086">0</span><span class="op" id="4180087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180091">if</span>&nbsp;<span class="ident" id="4180094">err</span>&nbsp;<span class="op" id="4180098">!=</span>&nbsp;<span class="ident" id="4180101">nil</span>&nbsp;<span class="op" id="4180105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180110">return</span>&nbsp;<span class="ident" id="4180117">time</span><span class="op" id="4180121">.</span><span class="ident" id="4180122">Time</span><span class="op" id="4180126">{</span><span class="op" id="4180127">}</span><span class="op" id="4180128">,</span>&nbsp;<span class="ident" id="4180130">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4180136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4180139">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4180142">ts</span>&nbsp;<span class="op" id="4180145">:=</span>&nbsp;<span class="ident" id="4180148">time</span><span class="op" id="4180152">.</span><span class="ident" id="4180153">Unix</span><span class="op" id="4180157">(</span><span class="ident" id="4180158">seconds</span><span class="op" id="4180165">,</span>&nbsp;<span class="ident" id="4180167">nanoseconds</span><span class="op" id="4180178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180181">return</span>&nbsp;<span class="ident" id="4180188">ts</span><span class="op" id="4180190">,</span>&nbsp;<span class="ident" id="4180192">nil</span><br>
<span class="lineno"></span><span class="op" id="4180196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4180199">//&nbsp;parsePAX&nbsp;parses&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno">310</span><span class="comment" id="4180231">//&nbsp;If&nbsp;an&nbsp;extended&nbsp;header&nbsp;(type&nbsp;&#39;x&#39;)&nbsp;is&nbsp;invalid,&nbsp;ErrHeader&nbsp;is&nbsp;returned</span><br>
<span class="lineno"></span><span class="keyword" id="4180301">func</span>&nbsp;<span class="ident" id="4180306">parsePAX</span><span class="op" id="4180314">(</span><span class="ident" id="4180315">r</span>&nbsp;<span class="ident" id="4180317">io</span><span class="op" id="4180319">.</span><span class="ident" id="4180320">Reader</span><span class="op" id="4180326">)</span>&nbsp;<span class="op" id="4180328">(</span><span class="keyword" id="4180329">map</span><span class="op" id="4180332">[</span><span class="builtintype" id="4180333">string</span><span class="op" id="4180339">]</span><span class="builtintype" id="4180340">string</span><span class="op" id="4180346">,</span>&nbsp;<span class="builtintype" id="4180348">error</span><span class="op" id="4180353">)</span>&nbsp;<span class="op" id="4180355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4180358">buf</span><span class="op" id="4180361">,</span>&nbsp;<span class="ident" id="4180363">err</span>&nbsp;<span class="op" id="4180367">:=</span>&nbsp;<span class="ident" id="4180370">ioutil</span><span class="op" id="4180376">.</span><span class="ident" id="4180377">ReadAll</span><span class="op" id="4180384">(</span><span class="ident" id="4180385">r</span><span class="op" id="4180386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180389">if</span>&nbsp;<span class="ident" id="4180392">err</span>&nbsp;<span class="op" id="4180396">!=</span>&nbsp;<span class="ident" id="4180399">nil</span>&nbsp;<span class="op" id="4180403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180407">return</span>&nbsp;<span class="ident" id="4180414">nil</span><span class="op" id="4180417">,</span>&nbsp;<span class="ident" id="4180419">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4180424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4180428">//&nbsp;For&nbsp;GNU&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4180471">//&nbsp;This&nbsp;function&nbsp;transforms&nbsp;the&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;headers&nbsp;into&nbsp;sparse&nbsp;format&nbsp;0.1&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180562">var</span>&nbsp;<span class="ident" id="4180566">sparseMap</span>&nbsp;<span class="ident" id="4180576">bytes</span><span class="op" id="4180581">.</span><span class="ident" id="4180582">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4180591">headers</span>&nbsp;<span class="op" id="4180599">:=</span>&nbsp;<span class="builtinfunc" id="4180602">make</span><span class="op" id="4180606">(</span><span class="keyword" id="4180607">map</span><span class="op" id="4180610">[</span><span class="builtintype" id="4180611">string</span><span class="op" id="4180617">]</span><span class="builtintype" id="4180618">string</span><span class="op" id="4180624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4180627">//&nbsp;Each&nbsp;record&nbsp;is&nbsp;constructed&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4180661">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;%d&nbsp;%s=%s\n&#34;,&nbsp;length,&nbsp;keyword,&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180706">for</span>&nbsp;<span class="builtinfunc" id="4180710">len</span><span class="op" id="4180713">(</span><span class="ident" id="4180714">buf</span><span class="op" id="4180717">)</span>&nbsp;<span class="op" id="4180719">&gt;</span>&nbsp;<span class="num" id="4180721">0</span>&nbsp;<span class="op" id="4180723">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4180727">//&nbsp;or&nbsp;the&nbsp;header&nbsp;was&nbsp;empty&nbsp;to&nbsp;start&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180771">var</span>&nbsp;<span class="ident" id="4180775">sp</span>&nbsp;<span class="builtintype" id="4180778">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4180784">//&nbsp;The&nbsp;size&nbsp;field&nbsp;ends&nbsp;at&nbsp;the&nbsp;first&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4180829">sp</span>&nbsp;<span class="op" id="4180832">=</span>&nbsp;<span class="ident" id="4180834">bytes</span><span class="op" id="4180839">.</span><span class="ident" id="4180840">IndexByte</span><span class="op" id="4180849">(</span><span class="ident" id="4180850">buf</span><span class="op" id="4180853">,</span>&nbsp;<span class="string" id="4180855">&#39;&nbsp;&#39;</span><span class="op" id="4180858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180862">if</span>&nbsp;<span class="ident" id="4180865">sp</span>&nbsp;<span class="op" id="4180868">==</span>&nbsp;<span class="op" id="4180871">-</span><span class="num" id="4180872">1</span>&nbsp;<span class="op" id="4180874">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180879">return</span>&nbsp;<span class="ident" id="4180886">nil</span><span class="op" id="4180889">,</span>&nbsp;<span class="ident" id="4180891">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4180903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4180907">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;token&nbsp;as&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4180956">n</span><span class="op" id="4180957">,</span>&nbsp;<span class="ident" id="4180959">err</span>&nbsp;<span class="op" id="4180963">:=</span>&nbsp;<span class="ident" id="4180966">strconv</span><span class="op" id="4180973">.</span><span class="ident" id="4180974">ParseInt</span><span class="op" id="4180982">(</span><span class="builtintype" id="4180983">string</span><span class="op" id="4180989">(</span><span class="ident" id="4180990">buf</span><span class="op" id="4180993">[</span><span class="op" id="4180994">:</span><span class="ident" id="4180995">sp</span><span class="op" id="4180997">]</span><span class="op" id="4180998">)</span><span class="op" id="4180999">,</span>&nbsp;<span class="num" id="4181001">10</span><span class="op" id="4181003">,</span>&nbsp;<span class="num" id="4181005">0</span><span class="op" id="4181006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181010">if</span>&nbsp;<span class="ident" id="4181013">err</span>&nbsp;<span class="op" id="4181017">!=</span>&nbsp;<span class="ident" id="4181020">nil</span>&nbsp;<span class="op" id="4181024">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181029">return</span>&nbsp;<span class="ident" id="4181036">nil</span><span class="op" id="4181039">,</span>&nbsp;<span class="ident" id="4181041">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4181053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181057">//&nbsp;Extract&nbsp;everything&nbsp;between&nbsp;the&nbsp;decimal&nbsp;and&nbsp;the&nbsp;n&nbsp;-1&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181121">//&nbsp;beginning&nbsp;to&nbsp;eat&nbsp;the&nbsp;&#39;&nbsp;&#39;,&nbsp;-1&nbsp;on&nbsp;the&nbsp;end&nbsp;to&nbsp;skip&nbsp;the&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181187">var</span>&nbsp;<span class="ident" id="4181191">record</span>&nbsp;<span class="op" id="4181198">[</span><span class="op" id="4181199">]</span><span class="builtintype" id="4181200">byte</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181207">record</span><span class="op" id="4181213">,</span>&nbsp;<span class="ident" id="4181215">buf</span>&nbsp;<span class="op" id="4181219">=</span>&nbsp;<span class="ident" id="4181221">buf</span><span class="op" id="4181224">[</span><span class="ident" id="4181225">sp</span><span class="op" id="4181227">+</span><span class="num" id="4181228">1</span><span class="op" id="4181229">:</span><span class="ident" id="4181230">n</span><span class="op" id="4181231">-</span><span class="num" id="4181232">1</span><span class="op" id="4181233">]</span><span class="op" id="4181234">,</span>&nbsp;<span class="ident" id="4181236">buf</span><span class="op" id="4181239">[</span><span class="ident" id="4181240">n</span><span class="op" id="4181241">:</span><span class="op" id="4181242">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181246">//&nbsp;The&nbsp;first&nbsp;equals&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181310">//&nbsp;Everything&nbsp;else&nbsp;is&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181341">eq</span>&nbsp;<span class="op" id="4181344">:=</span>&nbsp;<span class="ident" id="4181347">bytes</span><span class="op" id="4181352">.</span><span class="ident" id="4181353">IndexByte</span><span class="op" id="4181362">(</span><span class="ident" id="4181363">record</span><span class="op" id="4181369">,</span>&nbsp;<span class="string" id="4181371">&#39;=&#39;</span><span class="op" id="4181374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181378">if</span>&nbsp;<span class="ident" id="4181381">eq</span>&nbsp;<span class="op" id="4181384">==</span>&nbsp;<span class="op" id="4181387">-</span><span class="num" id="4181388">1</span>&nbsp;<span class="op" id="4181390">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181395">return</span>&nbsp;<span class="ident" id="4181402">nil</span><span class="op" id="4181405">,</span>&nbsp;<span class="ident" id="4181407">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4181419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181423">key</span><span class="op" id="4181426">,</span>&nbsp;<span class="ident" id="4181428">value</span>&nbsp;<span class="op" id="4181434">:=</span>&nbsp;<span class="ident" id="4181437">record</span><span class="op" id="4181443">[</span><span class="op" id="4181444">:</span><span class="ident" id="4181445">eq</span><span class="op" id="4181447">]</span><span class="op" id="4181448">,</span>&nbsp;<span class="ident" id="4181450">record</span><span class="op" id="4181456">[</span><span class="ident" id="4181457">eq</span><span class="op" id="4181459">+</span><span class="num" id="4181460">1</span><span class="op" id="4181461">:</span><span class="op" id="4181462">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181467">keyStr</span>&nbsp;<span class="op" id="4181474">:=</span>&nbsp;<span class="builtintype" id="4181477">string</span><span class="op" id="4181483">(</span><span class="ident" id="4181484">key</span><span class="op" id="4181487">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181491">if</span>&nbsp;<span class="ident" id="4181494">keyStr</span>&nbsp;<span class="op" id="4181501">==</span>&nbsp;<span class="ident" id="4181504">paxGNUSparseOffset</span>&nbsp;<span class="op" id="4181523">||</span>&nbsp;<span class="ident" id="4181526">keyStr</span>&nbsp;<span class="op" id="4181533">==</span>&nbsp;<span class="ident" id="4181536">paxGNUSparseNumBytes</span>&nbsp;<span class="op" id="4181557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181562">//&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;special&nbsp;key.&nbsp;Write&nbsp;to&nbsp;sparseMap&nbsp;instead&nbsp;of&nbsp;using&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181656">sparseMap</span><span class="op" id="4181665">.</span><span class="ident" id="4181666">Write</span><span class="op" id="4181671">(</span><span class="ident" id="4181672">value</span><span class="op" id="4181677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181682">sparseMap</span><span class="op" id="4181691">.</span><span class="ident" id="4181692">Write</span><span class="op" id="4181697">(</span><span class="op" id="4181698">[</span><span class="op" id="4181699">]</span><span class="builtintype" id="4181700">byte</span><span class="op" id="4181704">{</span><span class="string" id="4181705">&#39;,&#39;</span><span class="op" id="4181708">}</span><span class="op" id="4181709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4181713">}</span>&nbsp;<span class="keyword" id="4181715">else</span>&nbsp;<span class="op" id="4181720">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181725">//&nbsp;Normal&nbsp;key.&nbsp;Set&nbsp;the&nbsp;value&nbsp;in&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181777">headers</span><span class="op" id="4181784">[</span><span class="ident" id="4181785">keyStr</span><span class="op" id="4181791">]</span>&nbsp;<span class="op" id="4181793">=</span>&nbsp;<span class="builtintype" id="4181795">string</span><span class="op" id="4181801">(</span><span class="ident" id="4181802">value</span><span class="op" id="4181807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4181811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4181814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181817">if</span>&nbsp;<span class="ident" id="4181820">sparseMap</span><span class="op" id="4181829">.</span><span class="ident" id="4181830">Len</span><span class="op" id="4181833">(</span><span class="op" id="4181834">)</span>&nbsp;<span class="op" id="4181836">!=</span>&nbsp;<span class="num" id="4181839">0</span>&nbsp;<span class="op" id="4181841">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4181845">//&nbsp;Add&nbsp;sparse&nbsp;info&nbsp;to&nbsp;headers,&nbsp;chopping&nbsp;off&nbsp;the&nbsp;extra&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181907">sparseMap</span><span class="op" id="4181916">.</span><span class="ident" id="4181917">Truncate</span><span class="op" id="4181925">(</span><span class="ident" id="4181926">sparseMap</span><span class="op" id="4181935">.</span><span class="ident" id="4181936">Len</span><span class="op" id="4181939">(</span><span class="op" id="4181940">)</span>&nbsp;<span class="op" id="4181942">-</span>&nbsp;<span class="num" id="4181944">1</span><span class="op" id="4181945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181949">headers</span><span class="op" id="4181956">[</span><span class="ident" id="4181957">paxGNUSparseMap</span><span class="op" id="4181972">]</span>&nbsp;<span class="op" id="4181974">=</span>&nbsp;<span class="ident" id="4181976">sparseMap</span><span class="op" id="4181985">.</span><span class="ident" id="4181986">String</span><span class="op" id="4181992">(</span><span class="op" id="4181993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4181996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181999">return</span>&nbsp;<span class="ident" id="4182006">headers</span><span class="op" id="4182013">,</span>&nbsp;<span class="ident" id="4182015">nil</span><br>
<span class="lineno">365</span><span class="op" id="4182019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4182022">//&nbsp;cString&nbsp;parses&nbsp;bytes&nbsp;as&nbsp;a&nbsp;NUL-terminated&nbsp;C-style&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="4182082">//&nbsp;If&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;is&nbsp;not&nbsp;found&nbsp;then&nbsp;the&nbsp;whole&nbsp;slice&nbsp;is&nbsp;returned&nbsp;as&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4182158">func</span>&nbsp;<span class="ident" id="4182163">cString</span><span class="op" id="4182170">(</span><span class="ident" id="4182171">b</span>&nbsp;<span class="op" id="4182173">[</span><span class="op" id="4182174">]</span><span class="builtintype" id="4182175">byte</span><span class="op" id="4182179">)</span>&nbsp;<span class="builtintype" id="4182181">string</span>&nbsp;<span class="op" id="4182188">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182191">n</span>&nbsp;<span class="op" id="4182193">:=</span>&nbsp;<span class="num" id="4182196">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182199">for</span>&nbsp;<span class="ident" id="4182203">n</span>&nbsp;<span class="op" id="4182205">&lt;</span>&nbsp;<span class="builtinfunc" id="4182207">len</span><span class="op" id="4182210">(</span><span class="ident" id="4182211">b</span><span class="op" id="4182212">)</span>&nbsp;<span class="op" id="4182214">&amp;&amp;</span>&nbsp;<span class="ident" id="4182217">b</span><span class="op" id="4182218">[</span><span class="ident" id="4182219">n</span><span class="op" id="4182220">]</span>&nbsp;<span class="op" id="4182222">!=</span>&nbsp;<span class="num" id="4182225">0</span>&nbsp;<span class="op" id="4182227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182231">n</span><span class="op" id="4182232">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4182236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182239">return</span>&nbsp;<span class="builtintype" id="4182246">string</span><span class="op" id="4182252">(</span><span class="ident" id="4182253">b</span><span class="op" id="4182254">[</span><span class="num" id="4182255">0</span><span class="op" id="4182256">:</span><span class="ident" id="4182257">n</span><span class="op" id="4182258">]</span><span class="op" id="4182259">)</span><br>
<span class="lineno">375</span><span class="op" id="4182261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4182264">func</span>&nbsp;<span class="op" id="4182269">(</span><span class="ident" id="4182270">tr</span>&nbsp;<span class="op" id="4182273">*</span><span class="ident" id="4182274">Reader</span><span class="op" id="4182280">)</span>&nbsp;<span class="ident" id="4182282">octal</span><span class="op" id="4182287">(</span><span class="ident" id="4182288">b</span>&nbsp;<span class="op" id="4182290">[</span><span class="op" id="4182291">]</span><span class="builtintype" id="4182292">byte</span><span class="op" id="4182296">)</span>&nbsp;<span class="ident" id="4182298">int64</span>&nbsp;<span class="op" id="4182304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182307">//&nbsp;Check&nbsp;for&nbsp;binary&nbsp;format&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182342">if</span>&nbsp;<span class="builtinfunc" id="4182345">len</span><span class="op" id="4182348">(</span><span class="ident" id="4182349">b</span><span class="op" id="4182350">)</span>&nbsp;<span class="op" id="4182352">&gt;</span>&nbsp;<span class="num" id="4182354">0</span>&nbsp;<span class="op" id="4182356">&amp;&amp;</span>&nbsp;<span class="ident" id="4182359">b</span><span class="op" id="4182360">[</span><span class="num" id="4182361">0</span><span class="op" id="4182362">]</span><span class="op" id="4182363">&amp;</span><span class="num" id="4182364">0x80</span>&nbsp;<span class="op" id="4182369">!=</span>&nbsp;<span class="num" id="4182372">0</span>&nbsp;<span class="op" id="4182374">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182378">var</span>&nbsp;<span class="ident" id="4182382">x</span>&nbsp;<span class="ident" id="4182384">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182392">for</span>&nbsp;<span class="ident" id="4182396">i</span><span class="op" id="4182397">,</span>&nbsp;<span class="ident" id="4182399">c</span>&nbsp;<span class="op" id="4182401">:=</span>&nbsp;<span class="keyword" id="4182404">range</span>&nbsp;<span class="ident" id="4182410">b</span>&nbsp;<span class="op" id="4182412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182417">if</span>&nbsp;<span class="ident" id="4182420">i</span>&nbsp;<span class="op" id="4182422">==</span>&nbsp;<span class="num" id="4182425">0</span>&nbsp;<span class="op" id="4182427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182433">c</span>&nbsp;<span class="op" id="4182435">&amp;=</span>&nbsp;<span class="num" id="4182438">0x7f</span>&nbsp;<span class="comment" id="4182443">//&nbsp;ignore&nbsp;signal&nbsp;bit&nbsp;in&nbsp;first&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4182481">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182486">x</span>&nbsp;<span class="op" id="4182488">=</span>&nbsp;<span class="ident" id="4182490">x</span><span class="op" id="4182491">&lt;&lt;</span><span class="num" id="4182493">8</span>&nbsp;<span class="op" id="4182495">|</span>&nbsp;<span class="ident" id="4182497">int64</span><span class="op" id="4182502">(</span><span class="ident" id="4182503">c</span><span class="op" id="4182504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4182508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182512">return</span>&nbsp;<span class="ident" id="4182519">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4182522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182526">//&nbsp;Because&nbsp;unused&nbsp;fields&nbsp;are&nbsp;filled&nbsp;with&nbsp;NULs,&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182582">//&nbsp;to&nbsp;skip&nbsp;leading&nbsp;NULs.&nbsp;Fields&nbsp;may&nbsp;also&nbsp;be&nbsp;padded&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182639">//&nbsp;spaces&nbsp;or&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182659">//&nbsp;So&nbsp;we&nbsp;remove&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;NULs&nbsp;and&nbsp;spaces&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182716">//&nbsp;be&nbsp;sure.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182729">b</span>&nbsp;<span class="op" id="4182731">=</span>&nbsp;<span class="ident" id="4182733">bytes</span><span class="op" id="4182738">.</span><span class="ident" id="4182739">Trim</span><span class="op" id="4182743">(</span><span class="ident" id="4182744">b</span><span class="op" id="4182745">,</span>&nbsp;<span class="string" id="4182747">&#34;&nbsp;\x00&#34;</span><span class="op" id="4182754">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182758">if</span>&nbsp;<span class="builtinfunc" id="4182761">len</span><span class="op" id="4182764">(</span><span class="ident" id="4182765">b</span><span class="op" id="4182766">)</span>&nbsp;<span class="op" id="4182768">==</span>&nbsp;<span class="num" id="4182771">0</span>&nbsp;<span class="op" id="4182773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182777">return</span>&nbsp;<span class="num" id="4182784">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4182787">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182790">x</span><span class="op" id="4182791">,</span>&nbsp;<span class="ident" id="4182793">err</span>&nbsp;<span class="op" id="4182797">:=</span>&nbsp;<span class="ident" id="4182800">strconv</span><span class="op" id="4182807">.</span><span class="ident" id="4182808">ParseUint</span><span class="op" id="4182817">(</span><span class="ident" id="4182818">cString</span><span class="op" id="4182825">(</span><span class="ident" id="4182826">b</span><span class="op" id="4182827">)</span><span class="op" id="4182828">,</span>&nbsp;<span class="num" id="4182830">8</span><span class="op" id="4182831">,</span>&nbsp;<span class="num" id="4182833">64</span><span class="op" id="4182835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182838">if</span>&nbsp;<span class="ident" id="4182841">err</span>&nbsp;<span class="op" id="4182845">!=</span>&nbsp;<span class="ident" id="4182848">nil</span>&nbsp;<span class="op" id="4182852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182856">tr</span><span class="op" id="4182858">.</span><span class="ident" id="4182859">err</span>&nbsp;<span class="op" id="4182863">=</span>&nbsp;<span class="ident" id="4182865">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4182870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4182873">return</span>&nbsp;<span class="ident" id="4182880">int64</span><span class="op" id="4182885">(</span><span class="ident" id="4182886">x</span><span class="op" id="4182887">)</span><br>
<span class="lineno">405</span><span class="op" id="4182889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4182892">//&nbsp;skipUnread&nbsp;skips&nbsp;any&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;the&nbsp;existing&nbsp;file&nbsp;entry,&nbsp;as&nbsp;well&nbsp;as&nbsp;any&nbsp;alignment&nbsp;padding.</span><br>
<span class="lineno"></span><span class="keyword" id="4182991">func</span>&nbsp;<span class="op" id="4182996">(</span><span class="ident" id="4182997">tr</span>&nbsp;<span class="op" id="4183000">*</span><span class="ident" id="4183001">Reader</span><span class="op" id="4183007">)</span>&nbsp;<span class="ident" id="4183009">skipUnread</span><span class="op" id="4183019">(</span><span class="op" id="4183020">)</span>&nbsp;<span class="op" id="4183022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183025">nr</span>&nbsp;<span class="op" id="4183028">:=</span>&nbsp;<span class="ident" id="4183031">tr</span><span class="op" id="4183033">.</span><span class="ident" id="4183034">numBytes</span><span class="op" id="4183042">(</span><span class="op" id="4183043">)</span>&nbsp;<span class="op" id="4183045">+</span>&nbsp;<span class="ident" id="4183047">tr</span><span class="op" id="4183049">.</span><span class="ident" id="4183050">pad</span>&nbsp;<span class="comment" id="4183054">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;skip</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183082">tr</span><span class="op" id="4183084">.</span><span class="ident" id="4183085">curr</span><span class="op" id="4183089">,</span>&nbsp;<span class="ident" id="4183091">tr</span><span class="op" id="4183093">.</span><span class="ident" id="4183094">pad</span>&nbsp;<span class="op" id="4183098">=</span>&nbsp;<span class="ident" id="4183100">nil</span><span class="op" id="4183103">,</span>&nbsp;<span class="num" id="4183105">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183108">if</span>&nbsp;<span class="ident" id="4183111">sr</span><span class="op" id="4183113">,</span>&nbsp;<span class="ident" id="4183115">ok</span>&nbsp;<span class="op" id="4183118">:=</span>&nbsp;<span class="ident" id="4183121">tr</span><span class="op" id="4183123">.</span><span class="ident" id="4183124">r</span><span class="op" id="4183125">.</span><span class="op" id="4183126">(</span><span class="ident" id="4183127">io</span><span class="op" id="4183129">.</span><span class="ident" id="4183130">Seeker</span><span class="op" id="4183136">)</span><span class="op" id="4183137">;</span>&nbsp;<span class="ident" id="4183139">ok</span>&nbsp;<span class="op" id="4183142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183146">if</span>&nbsp;<span class="ident" id="4183149">_</span><span class="op" id="4183150">,</span>&nbsp;<span class="ident" id="4183152">err</span>&nbsp;<span class="op" id="4183156">:=</span>&nbsp;<span class="ident" id="4183159">sr</span><span class="op" id="4183161">.</span><span class="ident" id="4183162">Seek</span><span class="op" id="4183166">(</span><span class="ident" id="4183167">nr</span><span class="op" id="4183169">,</span>&nbsp;<span class="ident" id="4183171">os</span><span class="op" id="4183173">.</span><span class="ident" id="4183174">SEEK_CUR</span><span class="op" id="4183182">)</span><span class="op" id="4183183">;</span>&nbsp;<span class="ident" id="4183185">err</span>&nbsp;<span class="op" id="4183189">==</span>&nbsp;<span class="ident" id="4183192">nil</span>&nbsp;<span class="op" id="4183196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183201">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183210">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183216">_</span><span class="op" id="4183217">,</span>&nbsp;<span class="ident" id="4183219">tr</span><span class="op" id="4183221">.</span><span class="ident" id="4183222">err</span>&nbsp;<span class="op" id="4183226">=</span>&nbsp;<span class="ident" id="4183228">io</span><span class="op" id="4183230">.</span><span class="ident" id="4183231">CopyN</span><span class="op" id="4183236">(</span><span class="ident" id="4183237">ioutil</span><span class="op" id="4183243">.</span><span class="ident" id="4183244">Discard</span><span class="op" id="4183251">,</span>&nbsp;<span class="ident" id="4183253">tr</span><span class="op" id="4183255">.</span><span class="ident" id="4183256">r</span><span class="op" id="4183257">,</span>&nbsp;<span class="ident" id="4183259">nr</span><span class="op" id="4183261">)</span><br>
<span class="lineno"></span><span class="op" id="4183263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4183266">func</span>&nbsp;<span class="op" id="4183271">(</span><span class="ident" id="4183272">tr</span>&nbsp;<span class="op" id="4183275">*</span><span class="ident" id="4183276">Reader</span><span class="op" id="4183282">)</span>&nbsp;<span class="ident" id="4183284">verifyChecksum</span><span class="op" id="4183298">(</span><span class="ident" id="4183299">header</span>&nbsp;<span class="op" id="4183306">[</span><span class="op" id="4183307">]</span><span class="builtintype" id="4183308">byte</span><span class="op" id="4183312">)</span>&nbsp;<span class="builtintype" id="4183314">bool</span>&nbsp;<span class="op" id="4183319">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183322">if</span>&nbsp;<span class="ident" id="4183325">tr</span><span class="op" id="4183327">.</span><span class="ident" id="4183328">err</span>&nbsp;<span class="op" id="4183332">!=</span>&nbsp;<span class="ident" id="4183335">nil</span>&nbsp;<span class="op" id="4183339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183343">return</span>&nbsp;<span class="builtintype" id="4183350">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183361">given</span>&nbsp;<span class="op" id="4183367">:=</span>&nbsp;<span class="ident" id="4183370">tr</span><span class="op" id="4183372">.</span><span class="ident" id="4183373">octal</span><span class="op" id="4183378">(</span><span class="ident" id="4183379">header</span><span class="op" id="4183385">[</span><span class="num" id="4183386">148</span><span class="op" id="4183389">:</span><span class="num" id="4183390">156</span><span class="op" id="4183393">]</span><span class="op" id="4183394">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183397">unsigned</span><span class="op" id="4183405">,</span>&nbsp;<span class="ident" id="4183407">signed</span>&nbsp;<span class="op" id="4183414">:=</span>&nbsp;<span class="ident" id="4183417">checksum</span><span class="op" id="4183425">(</span><span class="ident" id="4183426">header</span><span class="op" id="4183432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183435">return</span>&nbsp;<span class="ident" id="4183442">given</span>&nbsp;<span class="op" id="4183448">==</span>&nbsp;<span class="ident" id="4183451">unsigned</span>&nbsp;<span class="op" id="4183460">||</span>&nbsp;<span class="ident" id="4183463">given</span>&nbsp;<span class="op" id="4183469">==</span>&nbsp;<span class="ident" id="4183472">signed</span><br>
<span class="lineno"></span><span class="op" id="4183479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4183482">func</span>&nbsp;<span class="op" id="4183487">(</span><span class="ident" id="4183488">tr</span>&nbsp;<span class="op" id="4183491">*</span><span class="ident" id="4183492">Reader</span><span class="op" id="4183498">)</span>&nbsp;<span class="ident" id="4183500">readHeader</span><span class="op" id="4183510">(</span><span class="op" id="4183511">)</span>&nbsp;<span class="op" id="4183513">*</span><span class="ident" id="4183514">Header</span>&nbsp;<span class="op" id="4183521">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183524">header</span>&nbsp;<span class="op" id="4183531">:=</span>&nbsp;<span class="ident" id="4183534">tr</span><span class="op" id="4183536">.</span><span class="ident" id="4183537">hdrBuff</span><span class="op" id="4183544">[</span><span class="op" id="4183545">:</span><span class="op" id="4183546">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4183549">copy</span><span class="op" id="4183553">(</span><span class="ident" id="4183554">header</span><span class="op" id="4183560">,</span>&nbsp;<span class="ident" id="4183562">zeroBlock</span><span class="op" id="4183571">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183575">if</span>&nbsp;<span class="ident" id="4183578">_</span><span class="op" id="4183579">,</span>&nbsp;<span class="ident" id="4183581">tr</span><span class="op" id="4183583">.</span><span class="ident" id="4183584">err</span>&nbsp;<span class="op" id="4183588">=</span>&nbsp;<span class="ident" id="4183590">io</span><span class="op" id="4183592">.</span><span class="ident" id="4183593">ReadFull</span><span class="op" id="4183601">(</span><span class="ident" id="4183602">tr</span><span class="op" id="4183604">.</span><span class="ident" id="4183605">r</span><span class="op" id="4183606">,</span>&nbsp;<span class="ident" id="4183608">header</span><span class="op" id="4183614">)</span><span class="op" id="4183615">;</span>&nbsp;<span class="ident" id="4183617">tr</span><span class="op" id="4183619">.</span><span class="ident" id="4183620">err</span>&nbsp;<span class="op" id="4183624">!=</span>&nbsp;<span class="ident" id="4183627">nil</span>&nbsp;<span class="op" id="4183631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183635">return</span>&nbsp;<span class="ident" id="4183642">nil</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183651">//&nbsp;Two&nbsp;blocks&nbsp;of&nbsp;zero&nbsp;bytes&nbsp;marks&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183710">if</span>&nbsp;<span class="ident" id="4183713">bytes</span><span class="op" id="4183718">.</span><span class="ident" id="4183719">Equal</span><span class="op" id="4183724">(</span><span class="ident" id="4183725">header</span><span class="op" id="4183731">,</span>&nbsp;<span class="ident" id="4183733">zeroBlock</span><span class="op" id="4183742">[</span><span class="num" id="4183743">0</span><span class="op" id="4183744">:</span><span class="ident" id="4183745">blockSize</span><span class="op" id="4183754">]</span><span class="op" id="4183755">)</span>&nbsp;<span class="op" id="4183757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183761">if</span>&nbsp;<span class="ident" id="4183764">_</span><span class="op" id="4183765">,</span>&nbsp;<span class="ident" id="4183767">tr</span><span class="op" id="4183769">.</span><span class="ident" id="4183770">err</span>&nbsp;<span class="op" id="4183774">=</span>&nbsp;<span class="ident" id="4183776">io</span><span class="op" id="4183778">.</span><span class="ident" id="4183779">ReadFull</span><span class="op" id="4183787">(</span><span class="ident" id="4183788">tr</span><span class="op" id="4183790">.</span><span class="ident" id="4183791">r</span><span class="op" id="4183792">,</span>&nbsp;<span class="ident" id="4183794">header</span><span class="op" id="4183800">)</span><span class="op" id="4183801">;</span>&nbsp;<span class="ident" id="4183803">tr</span><span class="op" id="4183805">.</span><span class="ident" id="4183806">err</span>&nbsp;<span class="op" id="4183810">!=</span>&nbsp;<span class="ident" id="4183813">nil</span>&nbsp;<span class="op" id="4183817">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183822">return</span>&nbsp;<span class="ident" id="4183829">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183839">if</span>&nbsp;<span class="ident" id="4183842">bytes</span><span class="op" id="4183847">.</span><span class="ident" id="4183848">Equal</span><span class="op" id="4183853">(</span><span class="ident" id="4183854">header</span><span class="op" id="4183860">,</span>&nbsp;<span class="ident" id="4183862">zeroBlock</span><span class="op" id="4183871">[</span><span class="num" id="4183872">0</span><span class="op" id="4183873">:</span><span class="ident" id="4183874">blockSize</span><span class="op" id="4183883">]</span><span class="op" id="4183884">)</span>&nbsp;<span class="op" id="4183886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183891">tr</span><span class="op" id="4183893">.</span><span class="ident" id="4183894">err</span>&nbsp;<span class="op" id="4183898">=</span>&nbsp;<span class="ident" id="4183900">io</span><span class="op" id="4183902">.</span><span class="ident" id="4183903">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183909">}</span>&nbsp;<span class="keyword" id="4183911">else</span>&nbsp;<span class="op" id="4183916">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183921">tr</span><span class="op" id="4183923">.</span><span class="ident" id="4183924">err</span>&nbsp;<span class="op" id="4183928">=</span>&nbsp;<span class="ident" id="4183930">ErrHeader</span>&nbsp;<span class="comment" id="4183940">//&nbsp;zero&nbsp;block&nbsp;and&nbsp;then&nbsp;non-zero&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183984">return</span>&nbsp;<span class="ident" id="4183991">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184000">if</span>&nbsp;<span class="op" id="4184003">!</span><span class="ident" id="4184004">tr</span><span class="op" id="4184006">.</span><span class="ident" id="4184007">verifyChecksum</span><span class="op" id="4184021">(</span><span class="ident" id="4184022">header</span><span class="op" id="4184028">)</span>&nbsp;<span class="op" id="4184030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184034">tr</span><span class="op" id="4184036">.</span><span class="ident" id="4184037">err</span>&nbsp;<span class="op" id="4184041">=</span>&nbsp;<span class="ident" id="4184043">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184055">return</span>&nbsp;<span class="ident" id="4184062">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4184067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184071">//&nbsp;Unpack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184082">hdr</span>&nbsp;<span class="op" id="4184086">:=</span>&nbsp;<span class="builtinfunc" id="4184089">new</span><span class="op" id="4184092">(</span><span class="ident" id="4184093">Header</span><span class="op" id="4184099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184102">s</span>&nbsp;<span class="op" id="4184104">:=</span>&nbsp;<span class="ident" id="4184107">slicer</span><span class="op" id="4184113">(</span><span class="ident" id="4184114">header</span><span class="op" id="4184120">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184124">hdr</span><span class="op" id="4184127">.</span><span class="ident" id="4184128">Name</span>&nbsp;<span class="op" id="4184133">=</span>&nbsp;<span class="ident" id="4184135">cString</span><span class="op" id="4184142">(</span><span class="ident" id="4184143">s</span><span class="op" id="4184144">.</span><span class="ident" id="4184145">next</span><span class="op" id="4184149">(</span><span class="num" id="4184150">100</span><span class="op" id="4184153">)</span><span class="op" id="4184154">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184157">hdr</span><span class="op" id="4184160">.</span><span class="ident" id="4184161">Mode</span>&nbsp;<span class="op" id="4184166">=</span>&nbsp;<span class="ident" id="4184168">tr</span><span class="op" id="4184170">.</span><span class="ident" id="4184171">octal</span><span class="op" id="4184176">(</span><span class="ident" id="4184177">s</span><span class="op" id="4184178">.</span><span class="ident" id="4184179">next</span><span class="op" id="4184183">(</span><span class="num" id="4184184">8</span><span class="op" id="4184185">)</span><span class="op" id="4184186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184189">hdr</span><span class="op" id="4184192">.</span><span class="ident" id="4184193">Uid</span>&nbsp;<span class="op" id="4184197">=</span>&nbsp;<span class="builtintype" id="4184199">int</span><span class="op" id="4184202">(</span><span class="ident" id="4184203">tr</span><span class="op" id="4184205">.</span><span class="ident" id="4184206">octal</span><span class="op" id="4184211">(</span><span class="ident" id="4184212">s</span><span class="op" id="4184213">.</span><span class="ident" id="4184214">next</span><span class="op" id="4184218">(</span><span class="num" id="4184219">8</span><span class="op" id="4184220">)</span><span class="op" id="4184221">)</span><span class="op" id="4184222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184225">hdr</span><span class="op" id="4184228">.</span><span class="ident" id="4184229">Gid</span>&nbsp;<span class="op" id="4184233">=</span>&nbsp;<span class="builtintype" id="4184235">int</span><span class="op" id="4184238">(</span><span class="ident" id="4184239">tr</span><span class="op" id="4184241">.</span><span class="ident" id="4184242">octal</span><span class="op" id="4184247">(</span><span class="ident" id="4184248">s</span><span class="op" id="4184249">.</span><span class="ident" id="4184250">next</span><span class="op" id="4184254">(</span><span class="num" id="4184255">8</span><span class="op" id="4184256">)</span><span class="op" id="4184257">)</span><span class="op" id="4184258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184261">hdr</span><span class="op" id="4184264">.</span><span class="ident" id="4184265">Size</span>&nbsp;<span class="op" id="4184270">=</span>&nbsp;<span class="ident" id="4184272">tr</span><span class="op" id="4184274">.</span><span class="ident" id="4184275">octal</span><span class="op" id="4184280">(</span><span class="ident" id="4184281">s</span><span class="op" id="4184282">.</span><span class="ident" id="4184283">next</span><span class="op" id="4184287">(</span><span class="num" id="4184288">12</span><span class="op" id="4184290">)</span><span class="op" id="4184291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184294">hdr</span><span class="op" id="4184297">.</span><span class="ident" id="4184298">ModTime</span>&nbsp;<span class="op" id="4184306">=</span>&nbsp;<span class="ident" id="4184308">time</span><span class="op" id="4184312">.</span><span class="ident" id="4184313">Unix</span><span class="op" id="4184317">(</span><span class="ident" id="4184318">tr</span><span class="op" id="4184320">.</span><span class="ident" id="4184321">octal</span><span class="op" id="4184326">(</span><span class="ident" id="4184327">s</span><span class="op" id="4184328">.</span><span class="ident" id="4184329">next</span><span class="op" id="4184333">(</span><span class="num" id="4184334">12</span><span class="op" id="4184336">)</span><span class="op" id="4184337">)</span><span class="op" id="4184338">,</span>&nbsp;<span class="num" id="4184340">0</span><span class="op" id="4184341">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184344">s</span><span class="op" id="4184345">.</span><span class="ident" id="4184346">next</span><span class="op" id="4184350">(</span><span class="num" id="4184351">8</span><span class="op" id="4184352">)</span>&nbsp;<span class="comment" id="4184354">//&nbsp;chksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184365">hdr</span><span class="op" id="4184368">.</span><span class="ident" id="4184369">Typeflag</span>&nbsp;<span class="op" id="4184378">=</span>&nbsp;<span class="ident" id="4184380">s</span><span class="op" id="4184381">.</span><span class="ident" id="4184382">next</span><span class="op" id="4184386">(</span><span class="num" id="4184387">1</span><span class="op" id="4184388">)</span><span class="op" id="4184389">[</span><span class="num" id="4184390">0</span><span class="op" id="4184391">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184394">hdr</span><span class="op" id="4184397">.</span><span class="ident" id="4184398">Linkname</span>&nbsp;<span class="op" id="4184407">=</span>&nbsp;<span class="ident" id="4184409">cString</span><span class="op" id="4184416">(</span><span class="ident" id="4184417">s</span><span class="op" id="4184418">.</span><span class="ident" id="4184419">next</span><span class="op" id="4184423">(</span><span class="num" id="4184424">100</span><span class="op" id="4184427">)</span><span class="op" id="4184428">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184432">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;header&nbsp;depends&nbsp;on&nbsp;the&nbsp;value&nbsp;of&nbsp;magic.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184495">//&nbsp;The&nbsp;original&nbsp;(v7)&nbsp;version&nbsp;of&nbsp;tar&nbsp;had&nbsp;no&nbsp;explicit&nbsp;magic&nbsp;field,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184561">//&nbsp;so&nbsp;its&nbsp;magic&nbsp;bytes,&nbsp;like&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;block,&nbsp;are&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184623">magic</span>&nbsp;<span class="op" id="4184629">:=</span>&nbsp;<span class="builtintype" id="4184632">string</span><span class="op" id="4184638">(</span><span class="ident" id="4184639">s</span><span class="op" id="4184640">.</span><span class="ident" id="4184641">next</span><span class="op" id="4184645">(</span><span class="num" id="4184646">8</span><span class="op" id="4184647">)</span><span class="op" id="4184648">)</span>&nbsp;<span class="comment" id="4184650">//&nbsp;contains&nbsp;version&nbsp;field&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184686">var</span>&nbsp;<span class="ident" id="4184690">format</span>&nbsp;<span class="builtintype" id="4184697">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184705">switch</span>&nbsp;<span class="op" id="4184712">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184715">case</span>&nbsp;<span class="ident" id="4184720">magic</span><span class="op" id="4184725">[</span><span class="op" id="4184726">:</span><span class="num" id="4184727">6</span><span class="op" id="4184728">]</span>&nbsp;<span class="op" id="4184730">==</span>&nbsp;<span class="string" id="4184733">&#34;ustar\x00&#34;</span><span class="op" id="4184744">:</span>&nbsp;<span class="comment" id="4184746">//&nbsp;POSIX&nbsp;tar&nbsp;(1003.1-1988)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184775">if</span>&nbsp;<span class="builtintype" id="4184778">string</span><span class="op" id="4184784">(</span><span class="ident" id="4184785">header</span><span class="op" id="4184791">[</span><span class="num" id="4184792">508</span><span class="op" id="4184795">:</span><span class="num" id="4184796">512</span><span class="op" id="4184799">]</span><span class="op" id="4184800">)</span>&nbsp;<span class="op" id="4184802">==</span>&nbsp;<span class="string" id="4184805">&#34;tar\x00&#34;</span>&nbsp;<span class="op" id="4184815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184820">format</span>&nbsp;<span class="op" id="4184827">=</span>&nbsp;<span class="string" id="4184829">&#34;star&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4184838">}</span>&nbsp;<span class="keyword" id="4184840">else</span>&nbsp;<span class="op" id="4184845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184850">format</span>&nbsp;<span class="op" id="4184857">=</span>&nbsp;<span class="string" id="4184859">&#34;posix&#34;</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4184869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184872">case</span>&nbsp;<span class="ident" id="4184877">magic</span>&nbsp;<span class="op" id="4184883">==</span>&nbsp;<span class="string" id="4184886">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="4184899">:</span>&nbsp;<span class="comment" id="4184901">//&nbsp;old&nbsp;GNU&nbsp;tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184918">format</span>&nbsp;<span class="op" id="4184925">=</span>&nbsp;<span class="string" id="4184927">&#34;gnu&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4184934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184938">switch</span>&nbsp;<span class="ident" id="4184945">format</span>&nbsp;<span class="op" id="4184952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184955">case</span>&nbsp;<span class="string" id="4184960">&#34;posix&#34;</span><span class="op" id="4184967">,</span>&nbsp;<span class="string" id="4184969">&#34;gnu&#34;</span><span class="op" id="4184974">,</span>&nbsp;<span class="string" id="4184976">&#34;star&#34;</span><span class="op" id="4184982">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184986">hdr</span><span class="op" id="4184989">.</span><span class="ident" id="4184990">Uname</span>&nbsp;<span class="op" id="4184996">=</span>&nbsp;<span class="ident" id="4184998">cString</span><span class="op" id="4185005">(</span><span class="ident" id="4185006">s</span><span class="op" id="4185007">.</span><span class="ident" id="4185008">next</span><span class="op" id="4185012">(</span><span class="num" id="4185013">32</span><span class="op" id="4185015">)</span><span class="op" id="4185016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185020">hdr</span><span class="op" id="4185023">.</span><span class="ident" id="4185024">Gname</span>&nbsp;<span class="op" id="4185030">=</span>&nbsp;<span class="ident" id="4185032">cString</span><span class="op" id="4185039">(</span><span class="ident" id="4185040">s</span><span class="op" id="4185041">.</span><span class="ident" id="4185042">next</span><span class="op" id="4185046">(</span><span class="num" id="4185047">32</span><span class="op" id="4185049">)</span><span class="op" id="4185050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185054">devmajor</span>&nbsp;<span class="op" id="4185063">:=</span>&nbsp;<span class="ident" id="4185066">s</span><span class="op" id="4185067">.</span><span class="ident" id="4185068">next</span><span class="op" id="4185072">(</span><span class="num" id="4185073">8</span><span class="op" id="4185074">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185078">devminor</span>&nbsp;<span class="op" id="4185087">:=</span>&nbsp;<span class="ident" id="4185090">s</span><span class="op" id="4185091">.</span><span class="ident" id="4185092">next</span><span class="op" id="4185096">(</span><span class="num" id="4185097">8</span><span class="op" id="4185098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185102">if</span>&nbsp;<span class="ident" id="4185105">hdr</span><span class="op" id="4185108">.</span><span class="ident" id="4185109">Typeflag</span>&nbsp;<span class="op" id="4185118">==</span>&nbsp;<span class="ident" id="4185121">TypeChar</span>&nbsp;<span class="op" id="4185130">||</span>&nbsp;<span class="ident" id="4185133">hdr</span><span class="op" id="4185136">.</span><span class="ident" id="4185137">Typeflag</span>&nbsp;<span class="op" id="4185146">==</span>&nbsp;<span class="ident" id="4185149">TypeBlock</span>&nbsp;<span class="op" id="4185159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185164">hdr</span><span class="op" id="4185167">.</span><span class="ident" id="4185168">Devmajor</span>&nbsp;<span class="op" id="4185177">=</span>&nbsp;<span class="ident" id="4185179">tr</span><span class="op" id="4185181">.</span><span class="ident" id="4185182">octal</span><span class="op" id="4185187">(</span><span class="ident" id="4185188">devmajor</span><span class="op" id="4185196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185201">hdr</span><span class="op" id="4185204">.</span><span class="ident" id="4185205">Devminor</span>&nbsp;<span class="op" id="4185214">=</span>&nbsp;<span class="ident" id="4185216">tr</span><span class="op" id="4185218">.</span><span class="ident" id="4185219">octal</span><span class="op" id="4185224">(</span><span class="ident" id="4185225">devminor</span><span class="op" id="4185233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4185237">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185241">var</span>&nbsp;<span class="ident" id="4185245">prefix</span>&nbsp;<span class="builtintype" id="4185252">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185261">switch</span>&nbsp;<span class="ident" id="4185268">format</span>&nbsp;<span class="op" id="4185275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185279">case</span>&nbsp;<span class="string" id="4185284">&#34;posix&#34;</span><span class="op" id="4185291">,</span>&nbsp;<span class="string" id="4185293">&#34;gnu&#34;</span><span class="op" id="4185298">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185303">prefix</span>&nbsp;<span class="op" id="4185310">=</span>&nbsp;<span class="ident" id="4185312">cString</span><span class="op" id="4185319">(</span><span class="ident" id="4185320">s</span><span class="op" id="4185321">.</span><span class="ident" id="4185322">next</span><span class="op" id="4185326">(</span><span class="num" id="4185327">155</span><span class="op" id="4185330">)</span><span class="op" id="4185331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185335">case</span>&nbsp;<span class="string" id="4185340">&#34;star&#34;</span><span class="op" id="4185346">:</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185351">prefix</span>&nbsp;<span class="op" id="4185358">=</span>&nbsp;<span class="ident" id="4185360">cString</span><span class="op" id="4185367">(</span><span class="ident" id="4185368">s</span><span class="op" id="4185369">.</span><span class="ident" id="4185370">next</span><span class="op" id="4185374">(</span><span class="num" id="4185375">131</span><span class="op" id="4185378">)</span><span class="op" id="4185379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185384">hdr</span><span class="op" id="4185387">.</span><span class="ident" id="4185388">AccessTime</span>&nbsp;<span class="op" id="4185399">=</span>&nbsp;<span class="ident" id="4185401">time</span><span class="op" id="4185405">.</span><span class="ident" id="4185406">Unix</span><span class="op" id="4185410">(</span><span class="ident" id="4185411">tr</span><span class="op" id="4185413">.</span><span class="ident" id="4185414">octal</span><span class="op" id="4185419">(</span><span class="ident" id="4185420">s</span><span class="op" id="4185421">.</span><span class="ident" id="4185422">next</span><span class="op" id="4185426">(</span><span class="num" id="4185427">12</span><span class="op" id="4185429">)</span><span class="op" id="4185430">)</span><span class="op" id="4185431">,</span>&nbsp;<span class="num" id="4185433">0</span><span class="op" id="4185434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185439">hdr</span><span class="op" id="4185442">.</span><span class="ident" id="4185443">ChangeTime</span>&nbsp;<span class="op" id="4185454">=</span>&nbsp;<span class="ident" id="4185456">time</span><span class="op" id="4185460">.</span><span class="ident" id="4185461">Unix</span><span class="op" id="4185465">(</span><span class="ident" id="4185466">tr</span><span class="op" id="4185468">.</span><span class="ident" id="4185469">octal</span><span class="op" id="4185474">(</span><span class="ident" id="4185475">s</span><span class="op" id="4185476">.</span><span class="ident" id="4185477">next</span><span class="op" id="4185481">(</span><span class="num" id="4185482">12</span><span class="op" id="4185484">)</span><span class="op" id="4185485">)</span><span class="op" id="4185486">,</span>&nbsp;<span class="num" id="4185488">0</span><span class="op" id="4185489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4185493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185497">if</span>&nbsp;<span class="builtinfunc" id="4185500">len</span><span class="op" id="4185503">(</span><span class="ident" id="4185504">prefix</span><span class="op" id="4185510">)</span>&nbsp;<span class="op" id="4185512">&gt;</span>&nbsp;<span class="num" id="4185514">0</span>&nbsp;<span class="op" id="4185516">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185521">hdr</span><span class="op" id="4185524">.</span><span class="ident" id="4185525">Name</span>&nbsp;<span class="op" id="4185530">=</span>&nbsp;<span class="ident" id="4185532">prefix</span>&nbsp;<span class="op" id="4185539">+</span>&nbsp;<span class="string" id="4185541">&#34;/&#34;</span>&nbsp;<span class="op" id="4185545">+</span>&nbsp;<span class="ident" id="4185547">hdr</span><span class="op" id="4185550">.</span><span class="ident" id="4185551">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4185558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4185561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185565">if</span>&nbsp;<span class="ident" id="4185568">tr</span><span class="op" id="4185570">.</span><span class="ident" id="4185571">err</span>&nbsp;<span class="op" id="4185575">!=</span>&nbsp;<span class="ident" id="4185578">nil</span>&nbsp;<span class="op" id="4185582">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185586">tr</span><span class="op" id="4185588">.</span><span class="ident" id="4185589">err</span>&nbsp;<span class="op" id="4185593">=</span>&nbsp;<span class="ident" id="4185595">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185607">return</span>&nbsp;<span class="ident" id="4185614">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4185619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185623">//&nbsp;Maximum&nbsp;value&nbsp;of&nbsp;hdr.Size&nbsp;is&nbsp;64&nbsp;GB&nbsp;(12&nbsp;octal&nbsp;digits),</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185681">//&nbsp;so&nbsp;there&#39;s&nbsp;no&nbsp;risk&nbsp;of&nbsp;int64&nbsp;overflowing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185726">nb</span>&nbsp;<span class="op" id="4185729">:=</span>&nbsp;<span class="ident" id="4185732">int64</span><span class="op" id="4185737">(</span><span class="ident" id="4185738">hdr</span><span class="op" id="4185741">.</span><span class="ident" id="4185742">Size</span><span class="op" id="4185746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185749">tr</span><span class="op" id="4185751">.</span><span class="ident" id="4185752">pad</span>&nbsp;<span class="op" id="4185756">=</span>&nbsp;<span class="op" id="4185758">-</span><span class="ident" id="4185759">nb</span>&nbsp;<span class="op" id="4185762">&amp;</span>&nbsp;<span class="op" id="4185764">(</span><span class="ident" id="4185765">blockSize</span>&nbsp;<span class="op" id="4185775">-</span>&nbsp;<span class="num" id="4185777">1</span><span class="op" id="4185778">)</span>&nbsp;<span class="comment" id="4185780">//&nbsp;blockSize&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;two</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185813">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185846">tr</span><span class="op" id="4185848">.</span><span class="ident" id="4185849">curr</span>&nbsp;<span class="op" id="4185854">=</span>&nbsp;<span class="op" id="4185856">&amp;</span><span class="ident" id="4185857">regFileReader</span><span class="op" id="4185870">{</span><span class="ident" id="4185871">r</span><span class="op" id="4185872">:</span>&nbsp;<span class="ident" id="4185874">tr</span><span class="op" id="4185876">.</span><span class="ident" id="4185877">r</span><span class="op" id="4185878">,</span>&nbsp;<span class="ident" id="4185880">nb</span><span class="op" id="4185882">:</span>&nbsp;<span class="ident" id="4185884">nb</span><span class="op" id="4185886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185890">//&nbsp;Check&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185933">if</span>&nbsp;<span class="ident" id="4185936">hdr</span><span class="op" id="4185939">.</span><span class="ident" id="4185940">Typeflag</span>&nbsp;<span class="op" id="4185949">==</span>&nbsp;<span class="ident" id="4185952">TypeGNUSparse</span>&nbsp;<span class="op" id="4185966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185970">//&nbsp;Get&nbsp;the&nbsp;real&nbsp;size&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4186006">hdr</span><span class="op" id="4186009">.</span><span class="ident" id="4186010">Size</span>&nbsp;<span class="op" id="4186015">=</span>&nbsp;<span class="ident" id="4186017">tr</span><span class="op" id="4186019">.</span><span class="ident" id="4186020">octal</span><span class="op" id="4186025">(</span><span class="ident" id="4186026">header</span><span class="op" id="4186032">[</span><span class="num" id="4186033">483</span><span class="op" id="4186036">:</span><span class="num" id="4186037">495</span><span class="op" id="4186040">]</span><span class="op" id="4186041">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4186046">//&nbsp;Read&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4186072">sp</span>&nbsp;<span class="op" id="4186075">:=</span>&nbsp;<span class="ident" id="4186078">tr</span><span class="op" id="4186080">.</span><span class="ident" id="4186081">readOldGNUSparseMap</span><span class="op" id="4186100">(</span><span class="ident" id="4186101">header</span><span class="op" id="4186107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186111">if</span>&nbsp;<span class="ident" id="4186114">tr</span><span class="op" id="4186116">.</span><span class="ident" id="4186117">err</span>&nbsp;<span class="op" id="4186121">!=</span>&nbsp;<span class="ident" id="4186124">nil</span>&nbsp;<span class="op" id="4186128">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186133">return</span>&nbsp;<span class="ident" id="4186140">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4186146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4186150">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;GNU&nbsp;sparse&nbsp;file.&nbsp;Update&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4186222">tr</span><span class="op" id="4186224">.</span><span class="ident" id="4186225">curr</span>&nbsp;<span class="op" id="4186230">=</span>&nbsp;<span class="op" id="4186232">&amp;</span><span class="ident" id="4186233">sparseFileReader</span><span class="op" id="4186249">{</span><span class="ident" id="4186250">rfr</span><span class="op" id="4186253">:</span>&nbsp;<span class="ident" id="4186255">tr</span><span class="op" id="4186257">.</span><span class="ident" id="4186258">curr</span><span class="op" id="4186262">.</span><span class="op" id="4186263">(</span><span class="op" id="4186264">*</span><span class="ident" id="4186265">regFileReader</span><span class="op" id="4186278">)</span><span class="op" id="4186279">,</span>&nbsp;<span class="ident" id="4186281">sp</span><span class="op" id="4186283">:</span>&nbsp;<span class="ident" id="4186285">sp</span><span class="op" id="4186287">,</span>&nbsp;<span class="ident" id="4186289">tot</span><span class="op" id="4186292">:</span>&nbsp;<span class="ident" id="4186294">hdr</span><span class="op" id="4186297">.</span><span class="ident" id="4186298">Size</span><span class="op" id="4186302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4186305">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186309">return</span>&nbsp;<span class="ident" id="4186316">hdr</span><br>
<span class="lineno"></span><span class="op" id="4186320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4186323">//&nbsp;A&nbsp;sparseEntry&nbsp;holds&nbsp;a&nbsp;single&nbsp;entry&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&#39;s&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">540</span><span class="comment" id="4186392">//&nbsp;A&nbsp;sparse&nbsp;entry&nbsp;indicates&nbsp;the&nbsp;offset&nbsp;and&nbsp;size&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4186462">//&nbsp;block&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4186480">type</span>&nbsp;<span class="ident" id="4186485">sparseEntry</span>&nbsp;<span class="keyword" id="4186497">struct</span>&nbsp;<span class="op" id="4186504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4186507">offset</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4186516">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4186523">numBytes</span>&nbsp;<span class="ident" id="4186532">int64</span><br>
<span class="lineno">545</span><span class="op" id="4186538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4186541">//&nbsp;readOldGNUSparseMap&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;the&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="4186625">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;tar&nbsp;header&nbsp;if&nbsp;it&#39;s&nbsp;small&nbsp;enough.&nbsp;If&nbsp;it&#39;s&nbsp;larger&nbsp;than&nbsp;four&nbsp;entries,</span><br>
<span class="lineno"></span><span class="comment" id="4186727">//&nbsp;then&nbsp;one&nbsp;or&nbsp;more&nbsp;extension&nbsp;headers&nbsp;are&nbsp;used&nbsp;to&nbsp;store&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">550</span><span class="keyword" id="4186811">func</span>&nbsp;<span class="op" id="4186816">(</span><span class="ident" id="4186817">tr</span>&nbsp;<span class="op" id="4186820">*</span><span class="ident" id="4186821">Reader</span><span class="op" id="4186827">)</span>&nbsp;<span class="ident" id="4186829">readOldGNUSparseMap</span><span class="op" id="4186848">(</span><span class="ident" id="4186849">header</span>&nbsp;<span class="op" id="4186856">[</span><span class="op" id="4186857">]</span><span class="builtintype" id="4186858">byte</span><span class="op" id="4186862">)</span>&nbsp;<span class="op" id="4186864">[</span><span class="op" id="4186865">]</span><span class="ident" id="4186866">sparseEntry</span>&nbsp;<span class="op" id="4186878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4186881">isExtended</span>&nbsp;<span class="op" id="4186892">:=</span>&nbsp;<span class="ident" id="4186895">header</span><span class="op" id="4186901">[</span><span class="ident" id="4186902">oldGNUSparseMainHeaderIsExtendedOffset</span><span class="op" id="4186940">]</span>&nbsp;<span class="op" id="4186942">!=</span>&nbsp;<span class="num" id="4186945">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4186948">spCap</span>&nbsp;<span class="op" id="4186954">:=</span>&nbsp;<span class="ident" id="4186957">oldGNUSparseMainHeaderNumEntries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186991">if</span>&nbsp;<span class="ident" id="4186994">isExtended</span>&nbsp;<span class="op" id="4187005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187009">spCap</span>&nbsp;<span class="op" id="4187015">+=</span>&nbsp;<span class="ident" id="4187018">oldGNUSparseExtendedHeaderNumEntries</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4187056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187059">sp</span>&nbsp;<span class="op" id="4187062">:=</span>&nbsp;<span class="builtinfunc" id="4187065">make</span><span class="op" id="4187069">(</span><span class="op" id="4187070">[</span><span class="op" id="4187071">]</span><span class="ident" id="4187072">sparseEntry</span><span class="op" id="4187083">,</span>&nbsp;<span class="num" id="4187085">0</span><span class="op" id="4187086">,</span>&nbsp;<span class="ident" id="4187088">spCap</span><span class="op" id="4187093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187096">s</span>&nbsp;<span class="op" id="4187098">:=</span>&nbsp;<span class="ident" id="4187101">slicer</span><span class="op" id="4187107">(</span><span class="ident" id="4187108">header</span><span class="op" id="4187114">[</span><span class="ident" id="4187115">oldGNUSparseMainHeaderOffset</span><span class="op" id="4187143">:</span><span class="op" id="4187144">]</span><span class="op" id="4187145">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4187149">//&nbsp;Read&nbsp;the&nbsp;four&nbsp;entries&nbsp;from&nbsp;the&nbsp;main&nbsp;tar&nbsp;header</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187200">for</span>&nbsp;<span class="ident" id="4187204">i</span>&nbsp;<span class="op" id="4187206">:=</span>&nbsp;<span class="num" id="4187209">0</span><span class="op" id="4187210">;</span>&nbsp;<span class="ident" id="4187212">i</span>&nbsp;<span class="op" id="4187214">&lt;</span>&nbsp;<span class="ident" id="4187216">oldGNUSparseMainHeaderNumEntries</span><span class="op" id="4187248">;</span>&nbsp;<span class="ident" id="4187250">i</span><span class="op" id="4187251">++</span>&nbsp;<span class="op" id="4187254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187258">offset</span>&nbsp;<span class="op" id="4187265">:=</span>&nbsp;<span class="ident" id="4187268">tr</span><span class="op" id="4187270">.</span><span class="ident" id="4187271">octal</span><span class="op" id="4187276">(</span><span class="ident" id="4187277">s</span><span class="op" id="4187278">.</span><span class="ident" id="4187279">next</span><span class="op" id="4187283">(</span><span class="ident" id="4187284">oldGNUSparseOffsetSize</span><span class="op" id="4187306">)</span><span class="op" id="4187307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187311">numBytes</span>&nbsp;<span class="op" id="4187320">:=</span>&nbsp;<span class="ident" id="4187323">tr</span><span class="op" id="4187325">.</span><span class="ident" id="4187326">octal</span><span class="op" id="4187331">(</span><span class="ident" id="4187332">s</span><span class="op" id="4187333">.</span><span class="ident" id="4187334">next</span><span class="op" id="4187338">(</span><span class="ident" id="4187339">oldGNUSparseNumBytesSize</span><span class="op" id="4187363">)</span><span class="op" id="4187364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187368">if</span>&nbsp;<span class="ident" id="4187371">tr</span><span class="op" id="4187373">.</span><span class="ident" id="4187374">err</span>&nbsp;<span class="op" id="4187378">!=</span>&nbsp;<span class="ident" id="4187381">nil</span>&nbsp;<span class="op" id="4187385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187390">tr</span><span class="op" id="4187392">.</span><span class="ident" id="4187393">err</span>&nbsp;<span class="op" id="4187397">=</span>&nbsp;<span class="ident" id="4187399">ErrHeader</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187412">return</span>&nbsp;<span class="ident" id="4187419">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4187425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187429">if</span>&nbsp;<span class="ident" id="4187432">offset</span>&nbsp;<span class="op" id="4187439">==</span>&nbsp;<span class="num" id="4187442">0</span>&nbsp;<span class="op" id="4187444">&amp;&amp;</span>&nbsp;<span class="ident" id="4187447">numBytes</span>&nbsp;<span class="op" id="4187456">==</span>&nbsp;<span class="num" id="4187459">0</span>&nbsp;<span class="op" id="4187461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187466">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4187474">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187478">sp</span>&nbsp;<span class="op" id="4187481">=</span>&nbsp;<span class="builtinfunc" id="4187483">append</span><span class="op" id="4187489">(</span><span class="ident" id="4187490">sp</span><span class="op" id="4187492">,</span>&nbsp;<span class="ident" id="4187494">sparseEntry</span><span class="op" id="4187505">{</span><span class="ident" id="4187506">offset</span><span class="op" id="4187512">:</span>&nbsp;<span class="ident" id="4187514">offset</span><span class="op" id="4187520">,</span>&nbsp;<span class="ident" id="4187522">numBytes</span><span class="op" id="4187530">:</span>&nbsp;<span class="ident" id="4187532">numBytes</span><span class="op" id="4187540">}</span><span class="op" id="4187541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4187544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187548">for</span>&nbsp;<span class="ident" id="4187552">isExtended</span>&nbsp;<span class="op" id="4187563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4187567">//&nbsp;There&nbsp;are&nbsp;more&nbsp;entries.&nbsp;Read&nbsp;an&nbsp;extension&nbsp;header&nbsp;and&nbsp;parse&nbsp;its&nbsp;entries.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187644">sparseHeader</span>&nbsp;<span class="op" id="4187657">:=</span>&nbsp;<span class="builtinfunc" id="4187660">make</span><span class="op" id="4187664">(</span><span class="op" id="4187665">[</span><span class="op" id="4187666">]</span><span class="builtintype" id="4187667">byte</span><span class="op" id="4187671">,</span>&nbsp;<span class="ident" id="4187673">blockSize</span><span class="op" id="4187682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187686">if</span>&nbsp;<span class="ident" id="4187689">_</span><span class="op" id="4187690">,</span>&nbsp;<span class="ident" id="4187692">tr</span><span class="op" id="4187694">.</span><span class="ident" id="4187695">err</span>&nbsp;<span class="op" id="4187699">=</span>&nbsp;<span class="ident" id="4187701">io</span><span class="op" id="4187703">.</span><span class="ident" id="4187704">ReadFull</span><span class="op" id="4187712">(</span><span class="ident" id="4187713">tr</span><span class="op" id="4187715">.</span><span class="ident" id="4187716">r</span><span class="op" id="4187717">,</span>&nbsp;<span class="ident" id="4187719">sparseHeader</span><span class="op" id="4187731">)</span><span class="op" id="4187732">;</span>&nbsp;<span class="ident" id="4187734">tr</span><span class="op" id="4187736">.</span><span class="ident" id="4187737">err</span>&nbsp;<span class="op" id="4187741">!=</span>&nbsp;<span class="ident" id="4187744">nil</span>&nbsp;<span class="op" id="4187748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187753">return</span>&nbsp;<span class="ident" id="4187760">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4187766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187770">isExtended</span>&nbsp;<span class="op" id="4187781">=</span>&nbsp;<span class="ident" id="4187783">sparseHeader</span><span class="op" id="4187795">[</span><span class="ident" id="4187796">oldGNUSparseExtendedHeaderIsExtendedOffset</span><span class="op" id="4187838">]</span>&nbsp;<span class="op" id="4187840">!=</span>&nbsp;<span class="num" id="4187843">0</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187847">s</span>&nbsp;<span class="op" id="4187849">=</span>&nbsp;<span class="ident" id="4187851">slicer</span><span class="op" id="4187857">(</span><span class="ident" id="4187858">sparseHeader</span><span class="op" id="4187870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187874">for</span>&nbsp;<span class="ident" id="4187878">i</span>&nbsp;<span class="op" id="4187880">:=</span>&nbsp;<span class="num" id="4187883">0</span><span class="op" id="4187884">;</span>&nbsp;<span class="ident" id="4187886">i</span>&nbsp;<span class="op" id="4187888">&lt;</span>&nbsp;<span class="ident" id="4187890">oldGNUSparseExtendedHeaderNumEntries</span><span class="op" id="4187926">;</span>&nbsp;<span class="ident" id="4187928">i</span><span class="op" id="4187929">++</span>&nbsp;<span class="op" id="4187932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187937">offset</span>&nbsp;<span class="op" id="4187944">:=</span>&nbsp;<span class="ident" id="4187947">tr</span><span class="op" id="4187949">.</span><span class="ident" id="4187950">octal</span><span class="op" id="4187955">(</span><span class="ident" id="4187956">s</span><span class="op" id="4187957">.</span><span class="ident" id="4187958">next</span><span class="op" id="4187962">(</span><span class="ident" id="4187963">oldGNUSparseOffsetSize</span><span class="op" id="4187985">)</span><span class="op" id="4187986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187991">numBytes</span>&nbsp;<span class="op" id="4188000">:=</span>&nbsp;<span class="ident" id="4188003">tr</span><span class="op" id="4188005">.</span><span class="ident" id="4188006">octal</span><span class="op" id="4188011">(</span><span class="ident" id="4188012">s</span><span class="op" id="4188013">.</span><span class="ident" id="4188014">next</span><span class="op" id="4188018">(</span><span class="ident" id="4188019">oldGNUSparseNumBytesSize</span><span class="op" id="4188043">)</span><span class="op" id="4188044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188049">if</span>&nbsp;<span class="ident" id="4188052">tr</span><span class="op" id="4188054">.</span><span class="ident" id="4188055">err</span>&nbsp;<span class="op" id="4188059">!=</span>&nbsp;<span class="ident" id="4188062">nil</span>&nbsp;<span class="op" id="4188066">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188072">tr</span><span class="op" id="4188074">.</span><span class="ident" id="4188075">err</span>&nbsp;<span class="op" id="4188079">=</span>&nbsp;<span class="ident" id="4188081">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188095">return</span>&nbsp;<span class="ident" id="4188102">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188114">if</span>&nbsp;<span class="ident" id="4188117">offset</span>&nbsp;<span class="op" id="4188124">==</span>&nbsp;<span class="num" id="4188127">0</span>&nbsp;<span class="op" id="4188129">&amp;&amp;</span>&nbsp;<span class="ident" id="4188132">numBytes</span>&nbsp;<span class="op" id="4188141">==</span>&nbsp;<span class="num" id="4188144">0</span>&nbsp;<span class="op" id="4188146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188152">break</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188166">sp</span>&nbsp;<span class="op" id="4188169">=</span>&nbsp;<span class="builtinfunc" id="4188171">append</span><span class="op" id="4188177">(</span><span class="ident" id="4188178">sp</span><span class="op" id="4188180">,</span>&nbsp;<span class="ident" id="4188182">sparseEntry</span><span class="op" id="4188193">{</span><span class="ident" id="4188194">offset</span><span class="op" id="4188200">:</span>&nbsp;<span class="ident" id="4188202">offset</span><span class="op" id="4188208">,</span>&nbsp;<span class="ident" id="4188210">numBytes</span><span class="op" id="4188218">:</span>&nbsp;<span class="ident" id="4188220">numBytes</span><span class="op" id="4188228">}</span><span class="op" id="4188229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188239">return</span>&nbsp;<span class="ident" id="4188246">sp</span><br>
<span class="lineno">595</span><span class="op" id="4188249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4188252">//&nbsp;readGNUSparseMap1x0&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;1.0.</span><br>
<span class="lineno"></span><span class="comment" id="4188346">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;just&nbsp;before&nbsp;the&nbsp;file&nbsp;data&nbsp;and&nbsp;padded&nbsp;out&nbsp;to&nbsp;the&nbsp;nearest&nbsp;block&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="4188446">func</span>&nbsp;<span class="ident" id="4188451">readGNUSparseMap1x0</span><span class="op" id="4188470">(</span><span class="ident" id="4188471">r</span>&nbsp;<span class="ident" id="4188473">io</span><span class="op" id="4188475">.</span><span class="ident" id="4188476">Reader</span><span class="op" id="4188482">)</span>&nbsp;<span class="op" id="4188484">(</span><span class="op" id="4188485">[</span><span class="op" id="4188486">]</span><span class="ident" id="4188487">sparseEntry</span><span class="op" id="4188498">,</span>&nbsp;<span class="builtintype" id="4188500">error</span><span class="op" id="4188505">)</span>&nbsp;<span class="op" id="4188507">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188510">buf</span>&nbsp;<span class="op" id="4188514">:=</span>&nbsp;<span class="builtinfunc" id="4188517">make</span><span class="op" id="4188521">(</span><span class="op" id="4188522">[</span><span class="op" id="4188523">]</span><span class="builtintype" id="4188524">byte</span><span class="op" id="4188528">,</span>&nbsp;<span class="num" id="4188530">2</span><span class="op" id="4188531">*</span><span class="ident" id="4188532">blockSize</span><span class="op" id="4188541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188544">sparseHeader</span>&nbsp;<span class="op" id="4188557">:=</span>&nbsp;<span class="ident" id="4188560">buf</span><span class="op" id="4188563">[</span><span class="op" id="4188564">:</span><span class="ident" id="4188565">blockSize</span><span class="op" id="4188574">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4188578">//&nbsp;readDecimal&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;to&nbsp;read&nbsp;a&nbsp;decimal&nbsp;integer&nbsp;from&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4188661">//&nbsp;while&nbsp;making&nbsp;sure&nbsp;to&nbsp;read&nbsp;from&nbsp;the&nbsp;file&nbsp;in&nbsp;blocks&nbsp;of&nbsp;size&nbsp;blockSize</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188733">readDecimal</span>&nbsp;<span class="op" id="4188745">:=</span>&nbsp;<span class="keyword" id="4188748">func</span><span class="op" id="4188752">(</span><span class="op" id="4188753">)</span>&nbsp;<span class="op" id="4188755">(</span><span class="ident" id="4188756">int64</span><span class="op" id="4188761">,</span>&nbsp;<span class="builtintype" id="4188763">error</span><span class="op" id="4188768">)</span>&nbsp;<span class="op" id="4188770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4188774">//&nbsp;Look&nbsp;for&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188796">nl</span>&nbsp;<span class="op" id="4188799">:=</span>&nbsp;<span class="ident" id="4188802">bytes</span><span class="op" id="4188807">.</span><span class="ident" id="4188808">IndexByte</span><span class="op" id="4188817">(</span><span class="ident" id="4188818">sparseHeader</span><span class="op" id="4188830">,</span>&nbsp;<span class="string" id="4188832">&#39;\n&#39;</span><span class="op" id="4188836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188840">if</span>&nbsp;<span class="ident" id="4188843">nl</span>&nbsp;<span class="op" id="4188846">==</span>&nbsp;<span class="op" id="4188849">-</span><span class="num" id="4188850">1</span>&nbsp;<span class="op" id="4188852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188857">if</span>&nbsp;<span class="builtinfunc" id="4188860">len</span><span class="op" id="4188863">(</span><span class="ident" id="4188864">sparseHeader</span><span class="op" id="4188876">)</span>&nbsp;<span class="op" id="4188878">&gt;=</span>&nbsp;<span class="ident" id="4188881">blockSize</span>&nbsp;<span class="op" id="4188891">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4188897">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188921">return</span>&nbsp;<span class="num" id="4188928">0</span><span class="op" id="4188929">,</span>&nbsp;<span class="ident" id="4188931">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188949">oldLen</span>&nbsp;<span class="op" id="4188956">:=</span>&nbsp;<span class="builtinfunc" id="4188959">len</span><span class="op" id="4188962">(</span><span class="ident" id="4188963">sparseHeader</span><span class="op" id="4188975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188980">newLen</span>&nbsp;<span class="op" id="4188987">:=</span>&nbsp;<span class="ident" id="4188990">oldLen</span>&nbsp;<span class="op" id="4188997">+</span>&nbsp;<span class="ident" id="4188999">blockSize</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189012">if</span>&nbsp;<span class="builtinfunc" id="4189015">cap</span><span class="op" id="4189018">(</span><span class="ident" id="4189019">sparseHeader</span><span class="op" id="4189031">)</span>&nbsp;<span class="op" id="4189033">&lt;</span>&nbsp;<span class="ident" id="4189035">newLen</span>&nbsp;<span class="op" id="4189042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4189048">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;the&nbsp;next&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4189120">copy</span><span class="op" id="4189124">(</span><span class="ident" id="4189125">buf</span><span class="op" id="4189128">,</span>&nbsp;<span class="ident" id="4189130">sparseHeader</span><span class="op" id="4189142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189148">sparseHeader</span>&nbsp;<span class="op" id="4189161">=</span>&nbsp;<span class="ident" id="4189163">buf</span><span class="op" id="4189166">[</span><span class="op" id="4189167">:</span><span class="ident" id="4189168">newLen</span><span class="op" id="4189174">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189179">}</span>&nbsp;<span class="keyword" id="4189181">else</span>&nbsp;<span class="op" id="4189186">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4189192">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;and&nbsp;we&nbsp;can&nbsp;just&nbsp;reslice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189244">sparseHeader</span>&nbsp;<span class="op" id="4189257">=</span>&nbsp;<span class="ident" id="4189259">sparseHeader</span><span class="op" id="4189271">[</span><span class="op" id="4189272">:</span><span class="ident" id="4189273">newLen</span><span class="op" id="4189279">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4189290">//&nbsp;Now&nbsp;that&nbsp;sparseHeader&nbsp;is&nbsp;large&nbsp;enough,&nbsp;read&nbsp;next&nbsp;block</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189351">if</span>&nbsp;<span class="ident" id="4189354">_</span><span class="op" id="4189355">,</span>&nbsp;<span class="ident" id="4189357">err</span>&nbsp;<span class="op" id="4189361">:=</span>&nbsp;<span class="ident" id="4189364">io</span><span class="op" id="4189366">.</span><span class="ident" id="4189367">ReadFull</span><span class="op" id="4189375">(</span><span class="ident" id="4189376">r</span><span class="op" id="4189377">,</span>&nbsp;<span class="ident" id="4189379">sparseHeader</span><span class="op" id="4189391">[</span><span class="ident" id="4189392">oldLen</span><span class="op" id="4189398">:</span><span class="ident" id="4189399">newLen</span><span class="op" id="4189405">]</span><span class="op" id="4189406">)</span><span class="op" id="4189407">;</span>&nbsp;<span class="ident" id="4189409">err</span>&nbsp;<span class="op" id="4189413">!=</span>&nbsp;<span class="ident" id="4189416">nil</span>&nbsp;<span class="op" id="4189420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189426">return</span>&nbsp;<span class="num" id="4189433">0</span><span class="op" id="4189434">,</span>&nbsp;<span class="ident" id="4189436">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4189449">//&nbsp;Look&nbsp;for&nbsp;a&nbsp;newline&nbsp;in&nbsp;the&nbsp;new&nbsp;data</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189490">nl</span>&nbsp;<span class="op" id="4189493">=</span>&nbsp;<span class="ident" id="4189495">bytes</span><span class="op" id="4189500">.</span><span class="ident" id="4189501">IndexByte</span><span class="op" id="4189510">(</span><span class="ident" id="4189511">sparseHeader</span><span class="op" id="4189523">[</span><span class="ident" id="4189524">oldLen</span><span class="op" id="4189530">:</span><span class="ident" id="4189531">newLen</span><span class="op" id="4189537">]</span><span class="op" id="4189538">,</span>&nbsp;<span class="string" id="4189540">&#39;\n&#39;</span><span class="op" id="4189544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189549">if</span>&nbsp;<span class="ident" id="4189552">nl</span>&nbsp;<span class="op" id="4189555">==</span>&nbsp;<span class="op" id="4189558">-</span><span class="num" id="4189559">1</span>&nbsp;<span class="op" id="4189561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4189567">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189591">return</span>&nbsp;<span class="num" id="4189598">0</span><span class="op" id="4189599">,</span>&nbsp;<span class="ident" id="4189601">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189614">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189619">nl</span>&nbsp;<span class="op" id="4189622">+=</span>&nbsp;<span class="ident" id="4189625">oldLen</span>&nbsp;<span class="comment" id="4189632">//&nbsp;We&nbsp;want&nbsp;the&nbsp;position&nbsp;from&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4189681">//&nbsp;Now&nbsp;that&nbsp;we&#39;ve&nbsp;found&nbsp;a&nbsp;newline,&nbsp;read&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189732">n</span><span class="op" id="4189733">,</span>&nbsp;<span class="ident" id="4189735">err</span>&nbsp;<span class="op" id="4189739">:=</span>&nbsp;<span class="ident" id="4189742">strconv</span><span class="op" id="4189749">.</span><span class="ident" id="4189750">ParseInt</span><span class="op" id="4189758">(</span><span class="builtintype" id="4189759">string</span><span class="op" id="4189765">(</span><span class="ident" id="4189766">sparseHeader</span><span class="op" id="4189778">[</span><span class="op" id="4189779">:</span><span class="ident" id="4189780">nl</span><span class="op" id="4189782">]</span><span class="op" id="4189783">)</span><span class="op" id="4189784">,</span>&nbsp;<span class="num" id="4189786">10</span><span class="op" id="4189788">,</span>&nbsp;<span class="num" id="4189790">0</span><span class="op" id="4189791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189795">if</span>&nbsp;<span class="ident" id="4189798">err</span>&nbsp;<span class="op" id="4189802">!=</span>&nbsp;<span class="ident" id="4189805">nil</span>&nbsp;<span class="op" id="4189809">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189814">return</span>&nbsp;<span class="num" id="4189821">0</span><span class="op" id="4189822">,</span>&nbsp;<span class="ident" id="4189824">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4189841">//&nbsp;Update&nbsp;sparseHeader&nbsp;to&nbsp;consume&nbsp;this&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189889">sparseHeader</span>&nbsp;<span class="op" id="4189902">=</span>&nbsp;<span class="ident" id="4189904">sparseHeader</span><span class="op" id="4189916">[</span><span class="ident" id="4189917">nl</span><span class="op" id="4189919">+</span><span class="num" id="4189920">1</span><span class="op" id="4189921">:</span><span class="op" id="4189922">]</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189926">return</span>&nbsp;<span class="ident" id="4189933">n</span><span class="op" id="4189934">,</span>&nbsp;<span class="ident" id="4189936">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4189945">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189970">if</span>&nbsp;<span class="ident" id="4189973">_</span><span class="op" id="4189974">,</span>&nbsp;<span class="ident" id="4189976">err</span>&nbsp;<span class="op" id="4189980">:=</span>&nbsp;<span class="ident" id="4189983">io</span><span class="op" id="4189985">.</span><span class="ident" id="4189986">ReadFull</span><span class="op" id="4189994">(</span><span class="ident" id="4189995">r</span><span class="op" id="4189996">,</span>&nbsp;<span class="ident" id="4189998">sparseHeader</span><span class="op" id="4190010">)</span><span class="op" id="4190011">;</span>&nbsp;<span class="ident" id="4190013">err</span>&nbsp;<span class="op" id="4190017">!=</span>&nbsp;<span class="ident" id="4190020">nil</span>&nbsp;<span class="op" id="4190024">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190028">return</span>&nbsp;<span class="ident" id="4190035">nil</span><span class="op" id="4190038">,</span>&nbsp;<span class="ident" id="4190040">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190049">//&nbsp;The&nbsp;first&nbsp;line&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190099">numEntries</span><span class="op" id="4190109">,</span>&nbsp;<span class="ident" id="4190111">err</span>&nbsp;<span class="op" id="4190115">:=</span>&nbsp;<span class="ident" id="4190118">readDecimal</span><span class="op" id="4190129">(</span><span class="op" id="4190130">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190133">if</span>&nbsp;<span class="ident" id="4190136">err</span>&nbsp;<span class="op" id="4190140">!=</span>&nbsp;<span class="ident" id="4190143">nil</span>&nbsp;<span class="op" id="4190147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190151">return</span>&nbsp;<span class="ident" id="4190158">nil</span><span class="op" id="4190161">,</span>&nbsp;<span class="ident" id="4190163">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190172">//&nbsp;Read&nbsp;all&nbsp;the&nbsp;entries</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190197">sp</span>&nbsp;<span class="op" id="4190200">:=</span>&nbsp;<span class="builtinfunc" id="4190203">make</span><span class="op" id="4190207">(</span><span class="op" id="4190208">[</span><span class="op" id="4190209">]</span><span class="ident" id="4190210">sparseEntry</span><span class="op" id="4190221">,</span>&nbsp;<span class="num" id="4190223">0</span><span class="op" id="4190224">,</span>&nbsp;<span class="ident" id="4190226">numEntries</span><span class="op" id="4190236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190239">for</span>&nbsp;<span class="ident" id="4190243">i</span>&nbsp;<span class="op" id="4190245">:=</span>&nbsp;<span class="ident" id="4190248">int64</span><span class="op" id="4190253">(</span><span class="num" id="4190254">0</span><span class="op" id="4190255">)</span><span class="op" id="4190256">;</span>&nbsp;<span class="ident" id="4190258">i</span>&nbsp;<span class="op" id="4190260">&lt;</span>&nbsp;<span class="ident" id="4190262">numEntries</span><span class="op" id="4190272">;</span>&nbsp;<span class="ident" id="4190274">i</span><span class="op" id="4190275">++</span>&nbsp;<span class="op" id="4190278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190282">//&nbsp;Read&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190303">offset</span><span class="op" id="4190309">,</span>&nbsp;<span class="ident" id="4190311">err</span>&nbsp;<span class="op" id="4190315">:=</span>&nbsp;<span class="ident" id="4190318">readDecimal</span><span class="op" id="4190329">(</span><span class="op" id="4190330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190334">if</span>&nbsp;<span class="ident" id="4190337">err</span>&nbsp;<span class="op" id="4190341">!=</span>&nbsp;<span class="ident" id="4190344">nil</span>&nbsp;<span class="op" id="4190348">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190353">return</span>&nbsp;<span class="ident" id="4190360">nil</span><span class="op" id="4190363">,</span>&nbsp;<span class="ident" id="4190365">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190375">//&nbsp;Read&nbsp;numBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190394">numBytes</span><span class="op" id="4190402">,</span>&nbsp;<span class="ident" id="4190404">err</span>&nbsp;<span class="op" id="4190408">:=</span>&nbsp;<span class="ident" id="4190411">readDecimal</span><span class="op" id="4190422">(</span><span class="op" id="4190423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190427">if</span>&nbsp;<span class="ident" id="4190430">err</span>&nbsp;<span class="op" id="4190434">!=</span>&nbsp;<span class="ident" id="4190437">nil</span>&nbsp;<span class="op" id="4190441">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190446">return</span>&nbsp;<span class="ident" id="4190453">nil</span><span class="op" id="4190456">,</span>&nbsp;<span class="ident" id="4190458">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190469">sp</span>&nbsp;<span class="op" id="4190472">=</span>&nbsp;<span class="builtinfunc" id="4190474">append</span><span class="op" id="4190480">(</span><span class="ident" id="4190481">sp</span><span class="op" id="4190483">,</span>&nbsp;<span class="ident" id="4190485">sparseEntry</span><span class="op" id="4190496">{</span><span class="ident" id="4190497">offset</span><span class="op" id="4190503">:</span>&nbsp;<span class="ident" id="4190505">offset</span><span class="op" id="4190511">,</span>&nbsp;<span class="ident" id="4190513">numBytes</span><span class="op" id="4190521">:</span>&nbsp;<span class="ident" id="4190523">numBytes</span><span class="op" id="4190531">}</span><span class="op" id="4190532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190535">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190539">return</span>&nbsp;<span class="ident" id="4190546">sp</span><span class="op" id="4190548">,</span>&nbsp;<span class="ident" id="4190550">nil</span><br>
<span class="lineno"></span><span class="op" id="4190554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4190557">//&nbsp;readGNUSparseMap0x1&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;0.1.</span><br>
<span class="lineno">680</span><span class="comment" id="4190651">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="4190699">func</span>&nbsp;<span class="ident" id="4190704">readGNUSparseMap0x1</span><span class="op" id="4190723">(</span><span class="ident" id="4190724">headers</span>&nbsp;<span class="keyword" id="4190732">map</span><span class="op" id="4190735">[</span><span class="builtintype" id="4190736">string</span><span class="op" id="4190742">]</span><span class="builtintype" id="4190743">string</span><span class="op" id="4190749">)</span>&nbsp;<span class="op" id="4190751">(</span><span class="op" id="4190752">[</span><span class="op" id="4190753">]</span><span class="ident" id="4190754">sparseEntry</span><span class="op" id="4190765">,</span>&nbsp;<span class="builtintype" id="4190767">error</span><span class="op" id="4190772">)</span>&nbsp;<span class="op" id="4190774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190777">//&nbsp;Get&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190803">numEntriesStr</span><span class="op" id="4190816">,</span>&nbsp;<span class="ident" id="4190818">ok</span>&nbsp;<span class="op" id="4190821">:=</span>&nbsp;<span class="ident" id="4190824">headers</span><span class="op" id="4190831">[</span><span class="ident" id="4190832">paxGNUSparseNumBlocks</span><span class="op" id="4190853">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190856">if</span>&nbsp;<span class="op" id="4190859">!</span><span class="ident" id="4190860">ok</span>&nbsp;<span class="op" id="4190863">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190867">return</span>&nbsp;<span class="ident" id="4190874">nil</span><span class="op" id="4190877">,</span>&nbsp;<span class="ident" id="4190879">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190893">numEntries</span><span class="op" id="4190903">,</span>&nbsp;<span class="ident" id="4190905">err</span>&nbsp;<span class="op" id="4190909">:=</span>&nbsp;<span class="ident" id="4190912">strconv</span><span class="op" id="4190919">.</span><span class="ident" id="4190920">ParseInt</span><span class="op" id="4190928">(</span><span class="ident" id="4190929">numEntriesStr</span><span class="op" id="4190942">,</span>&nbsp;<span class="num" id="4190944">10</span><span class="op" id="4190946">,</span>&nbsp;<span class="num" id="4190948">0</span><span class="op" id="4190949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190952">if</span>&nbsp;<span class="ident" id="4190955">err</span>&nbsp;<span class="op" id="4190959">!=</span>&nbsp;<span class="ident" id="4190962">nil</span>&nbsp;<span class="op" id="4190966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190970">return</span>&nbsp;<span class="ident" id="4190977">nil</span><span class="op" id="4190980">,</span>&nbsp;<span class="ident" id="4190982">ErrHeader</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190997">sparseMap</span>&nbsp;<span class="op" id="4191007">:=</span>&nbsp;<span class="ident" id="4191010">strings</span><span class="op" id="4191017">.</span><span class="ident" id="4191018">Split</span><span class="op" id="4191023">(</span><span class="ident" id="4191024">headers</span><span class="op" id="4191031">[</span><span class="ident" id="4191032">paxGNUSparseMap</span><span class="op" id="4191047">]</span><span class="op" id="4191048">,</span>&nbsp;<span class="string" id="4191050">&#34;,&#34;</span><span class="op" id="4191053">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4191057">//&nbsp;There&nbsp;should&nbsp;be&nbsp;two&nbsp;numbers&nbsp;in&nbsp;sparseMap&nbsp;for&nbsp;each&nbsp;entry</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191117">if</span>&nbsp;<span class="ident" id="4191120">int64</span><span class="op" id="4191125">(</span><span class="builtinfunc" id="4191126">len</span><span class="op" id="4191129">(</span><span class="ident" id="4191130">sparseMap</span><span class="op" id="4191139">)</span><span class="op" id="4191140">)</span>&nbsp;<span class="op" id="4191142">!=</span>&nbsp;<span class="num" id="4191145">2</span><span class="op" id="4191146">*</span><span class="ident" id="4191147">numEntries</span>&nbsp;<span class="op" id="4191158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191162">return</span>&nbsp;<span class="ident" id="4191169">nil</span><span class="op" id="4191172">,</span>&nbsp;<span class="ident" id="4191174">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4191185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4191189">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;entries&nbsp;in&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191236">sp</span>&nbsp;<span class="op" id="4191239">:=</span>&nbsp;<span class="builtinfunc" id="4191242">make</span><span class="op" id="4191246">(</span><span class="op" id="4191247">[</span><span class="op" id="4191248">]</span><span class="ident" id="4191249">sparseEntry</span><span class="op" id="4191260">,</span>&nbsp;<span class="num" id="4191262">0</span><span class="op" id="4191263">,</span>&nbsp;<span class="ident" id="4191265">numEntries</span><span class="op" id="4191275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191278">for</span>&nbsp;<span class="ident" id="4191282">i</span>&nbsp;<span class="op" id="4191284">:=</span>&nbsp;<span class="ident" id="4191287">int64</span><span class="op" id="4191292">(</span><span class="num" id="4191293">0</span><span class="op" id="4191294">)</span><span class="op" id="4191295">;</span>&nbsp;<span class="ident" id="4191297">i</span>&nbsp;<span class="op" id="4191299">&lt;</span>&nbsp;<span class="ident" id="4191301">numEntries</span><span class="op" id="4191311">;</span>&nbsp;<span class="ident" id="4191313">i</span><span class="op" id="4191314">++</span>&nbsp;<span class="op" id="4191317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191321">offset</span><span class="op" id="4191327">,</span>&nbsp;<span class="ident" id="4191329">err</span>&nbsp;<span class="op" id="4191333">:=</span>&nbsp;<span class="ident" id="4191336">strconv</span><span class="op" id="4191343">.</span><span class="ident" id="4191344">ParseInt</span><span class="op" id="4191352">(</span><span class="ident" id="4191353">sparseMap</span><span class="op" id="4191362">[</span><span class="num" id="4191363">2</span><span class="op" id="4191364">*</span><span class="ident" id="4191365">i</span><span class="op" id="4191366">]</span><span class="op" id="4191367">,</span>&nbsp;<span class="num" id="4191369">10</span><span class="op" id="4191371">,</span>&nbsp;<span class="num" id="4191373">0</span><span class="op" id="4191374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191378">if</span>&nbsp;<span class="ident" id="4191381">err</span>&nbsp;<span class="op" id="4191385">!=</span>&nbsp;<span class="ident" id="4191388">nil</span>&nbsp;<span class="op" id="4191392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191397">return</span>&nbsp;<span class="ident" id="4191404">nil</span><span class="op" id="4191407">,</span>&nbsp;<span class="ident" id="4191409">ErrHeader</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4191421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191425">numBytes</span><span class="op" id="4191433">,</span>&nbsp;<span class="ident" id="4191435">err</span>&nbsp;<span class="op" id="4191439">:=</span>&nbsp;<span class="ident" id="4191442">strconv</span><span class="op" id="4191449">.</span><span class="ident" id="4191450">ParseInt</span><span class="op" id="4191458">(</span><span class="ident" id="4191459">sparseMap</span><span class="op" id="4191468">[</span><span class="num" id="4191469">2</span><span class="op" id="4191470">*</span><span class="ident" id="4191471">i</span><span class="op" id="4191472">+</span><span class="num" id="4191473">1</span><span class="op" id="4191474">]</span><span class="op" id="4191475">,</span>&nbsp;<span class="num" id="4191477">10</span><span class="op" id="4191479">,</span>&nbsp;<span class="num" id="4191481">0</span><span class="op" id="4191482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191486">if</span>&nbsp;<span class="ident" id="4191489">err</span>&nbsp;<span class="op" id="4191493">!=</span>&nbsp;<span class="ident" id="4191496">nil</span>&nbsp;<span class="op" id="4191500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191505">return</span>&nbsp;<span class="ident" id="4191512">nil</span><span class="op" id="4191515">,</span>&nbsp;<span class="ident" id="4191517">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4191529">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191533">sp</span>&nbsp;<span class="op" id="4191536">=</span>&nbsp;<span class="builtinfunc" id="4191538">append</span><span class="op" id="4191544">(</span><span class="ident" id="4191545">sp</span><span class="op" id="4191547">,</span>&nbsp;<span class="ident" id="4191549">sparseEntry</span><span class="op" id="4191560">{</span><span class="ident" id="4191561">offset</span><span class="op" id="4191567">:</span>&nbsp;<span class="ident" id="4191569">offset</span><span class="op" id="4191575">,</span>&nbsp;<span class="ident" id="4191577">numBytes</span><span class="op" id="4191585">:</span>&nbsp;<span class="ident" id="4191587">numBytes</span><span class="op" id="4191595">}</span><span class="op" id="4191596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4191599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191603">return</span>&nbsp;<span class="ident" id="4191610">sp</span><span class="op" id="4191612">,</span>&nbsp;<span class="ident" id="4191614">nil</span><br>
<span class="lineno"></span><span class="op" id="4191618">}</span><br>
<span class="lineno">715</span><br>
<span class="lineno"></span><span class="comment" id="4191621">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;current&nbsp;file&#39;s&nbsp;entry</span><br>
<span class="lineno"></span><span class="comment" id="4191702">//&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;or&nbsp;0&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;current&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="4191759">func</span>&nbsp;<span class="op" id="4191764">(</span><span class="ident" id="4191765">tr</span>&nbsp;<span class="op" id="4191768">*</span><span class="ident" id="4191769">Reader</span><span class="op" id="4191775">)</span>&nbsp;<span class="ident" id="4191777">numBytes</span><span class="op" id="4191785">(</span><span class="op" id="4191786">)</span>&nbsp;<span class="ident" id="4191788">int64</span>&nbsp;<span class="op" id="4191794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191797">if</span>&nbsp;<span class="ident" id="4191800">tr</span><span class="op" id="4191802">.</span><span class="ident" id="4191803">curr</span>&nbsp;<span class="op" id="4191808">==</span>&nbsp;<span class="ident" id="4191811">nil</span>&nbsp;<span class="op" id="4191815">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4191819">//&nbsp;No&nbsp;current&nbsp;file,&nbsp;so&nbsp;no&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191853">return</span>&nbsp;<span class="num" id="4191860">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4191863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191866">return</span>&nbsp;<span class="ident" id="4191873">tr</span><span class="op" id="4191875">.</span><span class="ident" id="4191876">curr</span><span class="op" id="4191880">.</span><span class="ident" id="4191881">numBytes</span><span class="op" id="4191889">(</span><span class="op" id="4191890">)</span><br>
<span class="lineno"></span><span class="op" id="4191892">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="4191895">//&nbsp;Read&nbsp;reads&nbsp;from&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="4191952">//&nbsp;It&nbsp;returns&nbsp;0,&nbsp;io.EOF&nbsp;when&nbsp;it&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;that&nbsp;entry,</span><br>
<span class="lineno"></span><span class="comment" id="4192015">//&nbsp;until&nbsp;Next&nbsp;is&nbsp;called&nbsp;to&nbsp;advance&nbsp;to&nbsp;the&nbsp;next&nbsp;entry.</span><br>
<span class="lineno"></span><span class="keyword" id="4192069">func</span>&nbsp;<span class="op" id="4192074">(</span><span class="ident" id="4192075">tr</span>&nbsp;<span class="op" id="4192078">*</span><span class="ident" id="4192079">Reader</span><span class="op" id="4192085">)</span>&nbsp;<span class="ident" id="4192087">Read</span><span class="op" id="4192091">(</span><span class="ident" id="4192092">b</span>&nbsp;<span class="op" id="4192094">[</span><span class="op" id="4192095">]</span><span class="builtintype" id="4192096">byte</span><span class="op" id="4192100">)</span>&nbsp;<span class="op" id="4192102">(</span><span class="ident" id="4192103">n</span>&nbsp;<span class="builtintype" id="4192105">int</span><span class="op" id="4192108">,</span>&nbsp;<span class="ident" id="4192110">err</span>&nbsp;<span class="builtintype" id="4192114">error</span><span class="op" id="4192119">)</span>&nbsp;<span class="op" id="4192121">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192124">if</span>&nbsp;<span class="ident" id="4192127">tr</span><span class="op" id="4192129">.</span><span class="ident" id="4192130">curr</span>&nbsp;<span class="op" id="4192135">==</span>&nbsp;<span class="ident" id="4192138">nil</span>&nbsp;<span class="op" id="4192142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192146">return</span>&nbsp;<span class="num" id="4192153">0</span><span class="op" id="4192154">,</span>&nbsp;<span class="ident" id="4192156">io</span><span class="op" id="4192158">.</span><span class="ident" id="4192159">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192167">n</span><span class="op" id="4192168">,</span>&nbsp;<span class="ident" id="4192170">err</span>&nbsp;<span class="op" id="4192174">=</span>&nbsp;<span class="ident" id="4192176">tr</span><span class="op" id="4192178">.</span><span class="ident" id="4192179">curr</span><span class="op" id="4192183">.</span><span class="ident" id="4192184">Read</span><span class="op" id="4192188">(</span><span class="ident" id="4192189">b</span><span class="op" id="4192190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192193">if</span>&nbsp;<span class="ident" id="4192196">err</span>&nbsp;<span class="op" id="4192200">!=</span>&nbsp;<span class="ident" id="4192203">nil</span>&nbsp;<span class="op" id="4192207">&amp;&amp;</span>&nbsp;<span class="ident" id="4192210">err</span>&nbsp;<span class="op" id="4192214">!=</span>&nbsp;<span class="ident" id="4192217">io</span><span class="op" id="4192219">.</span><span class="ident" id="4192220">EOF</span>&nbsp;<span class="op" id="4192224">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192228">tr</span><span class="op" id="4192230">.</span><span class="ident" id="4192231">err</span>&nbsp;<span class="op" id="4192235">=</span>&nbsp;<span class="ident" id="4192237">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192245">return</span><br>
<span class="lineno"></span><span class="op" id="4192252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="keyword" id="4192255">func</span>&nbsp;<span class="op" id="4192260">(</span><span class="ident" id="4192261">rfr</span>&nbsp;<span class="op" id="4192265">*</span><span class="ident" id="4192266">regFileReader</span><span class="op" id="4192279">)</span>&nbsp;<span class="ident" id="4192281">Read</span><span class="op" id="4192285">(</span><span class="ident" id="4192286">b</span>&nbsp;<span class="op" id="4192288">[</span><span class="op" id="4192289">]</span><span class="builtintype" id="4192290">byte</span><span class="op" id="4192294">)</span>&nbsp;<span class="op" id="4192296">(</span><span class="ident" id="4192297">n</span>&nbsp;<span class="builtintype" id="4192299">int</span><span class="op" id="4192302">,</span>&nbsp;<span class="ident" id="4192304">err</span>&nbsp;<span class="builtintype" id="4192308">error</span><span class="op" id="4192313">)</span>&nbsp;<span class="op" id="4192315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192318">if</span>&nbsp;<span class="ident" id="4192321">rfr</span><span class="op" id="4192324">.</span><span class="ident" id="4192325">nb</span>&nbsp;<span class="op" id="4192328">==</span>&nbsp;<span class="num" id="4192331">0</span>&nbsp;<span class="op" id="4192333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4192337">//&nbsp;file&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192356">return</span>&nbsp;<span class="num" id="4192363">0</span><span class="op" id="4192364">,</span>&nbsp;<span class="ident" id="4192366">io</span><span class="op" id="4192368">.</span><span class="ident" id="4192369">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192374">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192377">if</span>&nbsp;<span class="ident" id="4192380">int64</span><span class="op" id="4192385">(</span><span class="builtinfunc" id="4192386">len</span><span class="op" id="4192389">(</span><span class="ident" id="4192390">b</span><span class="op" id="4192391">)</span><span class="op" id="4192392">)</span>&nbsp;<span class="op" id="4192394">&gt;</span>&nbsp;<span class="ident" id="4192396">rfr</span><span class="op" id="4192399">.</span><span class="ident" id="4192400">nb</span>&nbsp;<span class="op" id="4192403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192407">b</span>&nbsp;<span class="op" id="4192409">=</span>&nbsp;<span class="ident" id="4192411">b</span><span class="op" id="4192412">[</span><span class="num" id="4192413">0</span><span class="op" id="4192414">:</span><span class="ident" id="4192415">rfr</span><span class="op" id="4192418">.</span><span class="ident" id="4192419">nb</span><span class="op" id="4192421">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192427">n</span><span class="op" id="4192428">,</span>&nbsp;<span class="ident" id="4192430">err</span>&nbsp;<span class="op" id="4192434">=</span>&nbsp;<span class="ident" id="4192436">rfr</span><span class="op" id="4192439">.</span><span class="ident" id="4192440">r</span><span class="op" id="4192441">.</span><span class="ident" id="4192442">Read</span><span class="op" id="4192446">(</span><span class="ident" id="4192447">b</span><span class="op" id="4192448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192451">rfr</span><span class="op" id="4192454">.</span><span class="ident" id="4192455">nb</span>&nbsp;<span class="op" id="4192458">-=</span>&nbsp;<span class="ident" id="4192461">int64</span><span class="op" id="4192466">(</span><span class="ident" id="4192467">n</span><span class="op" id="4192468">)</span><br>
<span class="lineno">750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192472">if</span>&nbsp;<span class="ident" id="4192475">err</span>&nbsp;<span class="op" id="4192479">==</span>&nbsp;<span class="ident" id="4192482">io</span><span class="op" id="4192484">.</span><span class="ident" id="4192485">EOF</span>&nbsp;<span class="op" id="4192489">&amp;&amp;</span>&nbsp;<span class="ident" id="4192492">rfr</span><span class="op" id="4192495">.</span><span class="ident" id="4192496">nb</span>&nbsp;<span class="op" id="4192499">&gt;</span>&nbsp;<span class="num" id="4192501">0</span>&nbsp;<span class="op" id="4192503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192507">err</span>&nbsp;<span class="op" id="4192511">=</span>&nbsp;<span class="ident" id="4192513">io</span><span class="op" id="4192515">.</span><span class="ident" id="4192516">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192537">return</span><br>
<span class="lineno">755</span><span class="op" id="4192544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4192547">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;file&#39;s&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="4192639">func</span>&nbsp;<span class="op" id="4192644">(</span><span class="ident" id="4192645">rfr</span>&nbsp;<span class="op" id="4192649">*</span><span class="ident" id="4192650">regFileReader</span><span class="op" id="4192663">)</span>&nbsp;<span class="ident" id="4192665">numBytes</span><span class="op" id="4192673">(</span><span class="op" id="4192674">)</span>&nbsp;<span class="ident" id="4192676">int64</span>&nbsp;<span class="op" id="4192682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192685">return</span>&nbsp;<span class="ident" id="4192692">rfr</span><span class="op" id="4192695">.</span><span class="ident" id="4192696">nb</span><br>
<span class="lineno">760</span><span class="op" id="4192699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4192702">//&nbsp;readHole&nbsp;reads&nbsp;a&nbsp;sparse&nbsp;file&nbsp;hole&nbsp;ending&nbsp;at&nbsp;offset&nbsp;toOffset</span><br>
<span class="lineno"></span><span class="keyword" id="4192765">func</span>&nbsp;<span class="op" id="4192770">(</span><span class="ident" id="4192771">sfr</span>&nbsp;<span class="op" id="4192775">*</span><span class="ident" id="4192776">sparseFileReader</span><span class="op" id="4192792">)</span>&nbsp;<span class="ident" id="4192794">readHole</span><span class="op" id="4192802">(</span><span class="ident" id="4192803">b</span>&nbsp;<span class="op" id="4192805">[</span><span class="op" id="4192806">]</span><span class="builtintype" id="4192807">byte</span><span class="op" id="4192811">,</span>&nbsp;<span class="ident" id="4192813">toOffset</span>&nbsp;<span class="ident" id="4192822">int64</span><span class="op" id="4192827">)</span>&nbsp;<span class="builtintype" id="4192829">int</span>&nbsp;<span class="op" id="4192833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192836">n64</span>&nbsp;<span class="op" id="4192840">:=</span>&nbsp;<span class="ident" id="4192843">toOffset</span>&nbsp;<span class="op" id="4192852">-</span>&nbsp;<span class="ident" id="4192854">sfr</span><span class="op" id="4192857">.</span><span class="ident" id="4192858">pos</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192863">if</span>&nbsp;<span class="ident" id="4192866">n64</span>&nbsp;<span class="op" id="4192870">&gt;</span>&nbsp;<span class="ident" id="4192872">int64</span><span class="op" id="4192877">(</span><span class="builtinfunc" id="4192878">len</span><span class="op" id="4192881">(</span><span class="ident" id="4192882">b</span><span class="op" id="4192883">)</span><span class="op" id="4192884">)</span>&nbsp;<span class="op" id="4192886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192890">n64</span>&nbsp;<span class="op" id="4192894">=</span>&nbsp;<span class="ident" id="4192896">int64</span><span class="op" id="4192901">(</span><span class="builtinfunc" id="4192902">len</span><span class="op" id="4192905">(</span><span class="ident" id="4192906">b</span><span class="op" id="4192907">)</span><span class="op" id="4192908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192914">n</span>&nbsp;<span class="op" id="4192916">:=</span>&nbsp;<span class="builtintype" id="4192919">int</span><span class="op" id="4192922">(</span><span class="ident" id="4192923">n64</span><span class="op" id="4192926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192929">for</span>&nbsp;<span class="ident" id="4192933">i</span>&nbsp;<span class="op" id="4192935">:=</span>&nbsp;<span class="num" id="4192938">0</span><span class="op" id="4192939">;</span>&nbsp;<span class="ident" id="4192941">i</span>&nbsp;<span class="op" id="4192943">&lt;</span>&nbsp;<span class="ident" id="4192945">n</span><span class="op" id="4192946">;</span>&nbsp;<span class="ident" id="4192948">i</span><span class="op" id="4192949">++</span>&nbsp;<span class="op" id="4192952">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192956">b</span><span class="op" id="4192957">[</span><span class="ident" id="4192958">i</span><span class="op" id="4192959">]</span>&nbsp;<span class="op" id="4192961">=</span>&nbsp;<span class="num" id="4192963">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192969">sfr</span><span class="op" id="4192972">.</span><span class="ident" id="4192973">pos</span>&nbsp;<span class="op" id="4192977">+=</span>&nbsp;<span class="ident" id="4192980">n64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192985">return</span>&nbsp;<span class="ident" id="4192992">n</span><br>
<span class="lineno"></span><span class="op" id="4192994">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="comment" id="4192997">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;file&nbsp;data&nbsp;in&nbsp;expanded&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="4193050">func</span>&nbsp;<span class="op" id="4193055">(</span><span class="ident" id="4193056">sfr</span>&nbsp;<span class="op" id="4193060">*</span><span class="ident" id="4193061">sparseFileReader</span><span class="op" id="4193077">)</span>&nbsp;<span class="ident" id="4193079">Read</span><span class="op" id="4193083">(</span><span class="ident" id="4193084">b</span>&nbsp;<span class="op" id="4193086">[</span><span class="op" id="4193087">]</span><span class="builtintype" id="4193088">byte</span><span class="op" id="4193092">)</span>&nbsp;<span class="op" id="4193094">(</span><span class="ident" id="4193095">n</span>&nbsp;<span class="builtintype" id="4193097">int</span><span class="op" id="4193100">,</span>&nbsp;<span class="ident" id="4193102">err</span>&nbsp;<span class="builtintype" id="4193106">error</span><span class="op" id="4193111">)</span>&nbsp;<span class="op" id="4193113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193116">if</span>&nbsp;<span class="builtinfunc" id="4193119">len</span><span class="op" id="4193122">(</span><span class="ident" id="4193123">sfr</span><span class="op" id="4193126">.</span><span class="ident" id="4193127">sp</span><span class="op" id="4193129">)</span>&nbsp;<span class="op" id="4193131">==</span>&nbsp;<span class="num" id="4193134">0</span>&nbsp;<span class="op" id="4193136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4193140">//&nbsp;No&nbsp;more&nbsp;data&nbsp;fragments&nbsp;to&nbsp;read&nbsp;from.</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193182">if</span>&nbsp;<span class="ident" id="4193185">sfr</span><span class="op" id="4193188">.</span><span class="ident" id="4193189">pos</span>&nbsp;<span class="op" id="4193193">&lt;</span>&nbsp;<span class="ident" id="4193195">sfr</span><span class="op" id="4193198">.</span><span class="ident" id="4193199">tot</span>&nbsp;<span class="op" id="4193203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4193208">//&nbsp;We&#39;re&nbsp;in&nbsp;the&nbsp;last&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193237">n</span>&nbsp;<span class="op" id="4193239">=</span>&nbsp;<span class="ident" id="4193241">sfr</span><span class="op" id="4193244">.</span><span class="ident" id="4193245">readHole</span><span class="op" id="4193253">(</span><span class="ident" id="4193254">b</span><span class="op" id="4193255">,</span>&nbsp;<span class="ident" id="4193257">sfr</span><span class="op" id="4193260">.</span><span class="ident" id="4193261">tot</span><span class="op" id="4193264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193269">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193278">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4193282">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193327">return</span>&nbsp;<span class="num" id="4193334">0</span><span class="op" id="4193335">,</span>&nbsp;<span class="ident" id="4193337">io</span><span class="op" id="4193339">.</span><span class="ident" id="4193340">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193348">if</span>&nbsp;<span class="ident" id="4193351">sfr</span><span class="op" id="4193354">.</span><span class="ident" id="4193355">pos</span>&nbsp;<span class="op" id="4193359">&lt;</span>&nbsp;<span class="ident" id="4193361">sfr</span><span class="op" id="4193364">.</span><span class="ident" id="4193365">sp</span><span class="op" id="4193367">[</span><span class="num" id="4193368">0</span><span class="op" id="4193369">]</span><span class="op" id="4193370">.</span><span class="ident" id="4193371">offset</span>&nbsp;<span class="op" id="4193378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4193382">//&nbsp;We&#39;re&nbsp;in&nbsp;a&nbsp;hole</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193403">n</span>&nbsp;<span class="op" id="4193405">=</span>&nbsp;<span class="ident" id="4193407">sfr</span><span class="op" id="4193410">.</span><span class="ident" id="4193411">readHole</span><span class="op" id="4193419">(</span><span class="ident" id="4193420">b</span><span class="op" id="4193421">,</span>&nbsp;<span class="ident" id="4193423">sfr</span><span class="op" id="4193426">.</span><span class="ident" id="4193427">sp</span><span class="op" id="4193429">[</span><span class="num" id="4193430">0</span><span class="op" id="4193431">]</span><span class="op" id="4193432">.</span><span class="ident" id="4193433">offset</span><span class="op" id="4193439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193443">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4193455">//&nbsp;We&#39;re&nbsp;not&nbsp;in&nbsp;a&nbsp;hole,&nbsp;so&nbsp;we&#39;ll&nbsp;read&nbsp;from&nbsp;the&nbsp;next&nbsp;data&nbsp;fragment</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193522">posInFragment</span>&nbsp;<span class="op" id="4193536">:=</span>&nbsp;<span class="ident" id="4193539">sfr</span><span class="op" id="4193542">.</span><span class="ident" id="4193543">pos</span>&nbsp;<span class="op" id="4193547">-</span>&nbsp;<span class="ident" id="4193549">sfr</span><span class="op" id="4193552">.</span><span class="ident" id="4193553">sp</span><span class="op" id="4193555">[</span><span class="num" id="4193556">0</span><span class="op" id="4193557">]</span><span class="op" id="4193558">.</span><span class="ident" id="4193559">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193567">bytesLeft</span>&nbsp;<span class="op" id="4193577">:=</span>&nbsp;<span class="ident" id="4193580">sfr</span><span class="op" id="4193583">.</span><span class="ident" id="4193584">sp</span><span class="op" id="4193586">[</span><span class="num" id="4193587">0</span><span class="op" id="4193588">]</span><span class="op" id="4193589">.</span><span class="ident" id="4193590">numBytes</span>&nbsp;<span class="op" id="4193599">-</span>&nbsp;<span class="ident" id="4193601">posInFragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193616">if</span>&nbsp;<span class="ident" id="4193619">int64</span><span class="op" id="4193624">(</span><span class="builtinfunc" id="4193625">len</span><span class="op" id="4193628">(</span><span class="ident" id="4193629">b</span><span class="op" id="4193630">)</span><span class="op" id="4193631">)</span>&nbsp;<span class="op" id="4193633">&gt;</span>&nbsp;<span class="ident" id="4193635">bytesLeft</span>&nbsp;<span class="op" id="4193645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193649">b</span>&nbsp;<span class="op" id="4193651">=</span>&nbsp;<span class="ident" id="4193653">b</span><span class="op" id="4193654">[</span><span class="num" id="4193655">0</span><span class="op" id="4193656">:</span><span class="ident" id="4193657">bytesLeft</span><span class="op" id="4193666">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193669">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193673">n</span><span class="op" id="4193674">,</span>&nbsp;<span class="ident" id="4193676">err</span>&nbsp;<span class="op" id="4193680">=</span>&nbsp;<span class="ident" id="4193682">sfr</span><span class="op" id="4193685">.</span><span class="ident" id="4193686">rfr</span><span class="op" id="4193689">.</span><span class="ident" id="4193690">Read</span><span class="op" id="4193694">(</span><span class="ident" id="4193695">b</span><span class="op" id="4193696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193699">sfr</span><span class="op" id="4193702">.</span><span class="ident" id="4193703">pos</span>&nbsp;<span class="op" id="4193707">+=</span>&nbsp;<span class="ident" id="4193710">int64</span><span class="op" id="4193715">(</span><span class="ident" id="4193716">n</span><span class="op" id="4193717">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193721">if</span>&nbsp;<span class="ident" id="4193724">int64</span><span class="op" id="4193729">(</span><span class="ident" id="4193730">n</span><span class="op" id="4193731">)</span>&nbsp;<span class="op" id="4193733">==</span>&nbsp;<span class="ident" id="4193736">bytesLeft</span>&nbsp;<span class="op" id="4193746">{</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4193750">//&nbsp;We&#39;re&nbsp;done&nbsp;with&nbsp;this&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193785">sfr</span><span class="op" id="4193788">.</span><span class="ident" id="4193789">sp</span>&nbsp;<span class="op" id="4193792">=</span>&nbsp;<span class="ident" id="4193794">sfr</span><span class="op" id="4193797">.</span><span class="ident" id="4193798">sp</span><span class="op" id="4193800">[</span><span class="num" id="4193801">1</span><span class="op" id="4193802">:</span><span class="op" id="4193803">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193810">if</span>&nbsp;<span class="ident" id="4193813">err</span>&nbsp;<span class="op" id="4193817">==</span>&nbsp;<span class="ident" id="4193820">io</span><span class="op" id="4193822">.</span><span class="ident" id="4193823">EOF</span>&nbsp;<span class="op" id="4193827">&amp;&amp;</span>&nbsp;<span class="ident" id="4193830">sfr</span><span class="op" id="4193833">.</span><span class="ident" id="4193834">pos</span>&nbsp;<span class="op" id="4193838">&lt;</span>&nbsp;<span class="ident" id="4193840">sfr</span><span class="op" id="4193843">.</span><span class="ident" id="4193844">tot</span>&nbsp;<span class="op" id="4193848">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4193852">//&nbsp;We&nbsp;reached&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;last&nbsp;fragment&#39;s&nbsp;data,&nbsp;but&nbsp;there&#39;s&nbsp;a&nbsp;final&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193930">err</span>&nbsp;<span class="op" id="4193934">=</span>&nbsp;<span class="ident" id="4193936">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193944">return</span><br>
<span class="lineno"></span><span class="op" id="4193951">}</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="4193954">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;sparse&nbsp;file&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4194028">//&nbsp;sparse-encoded&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="4194071">func</span>&nbsp;<span class="op" id="4194076">(</span><span class="ident" id="4194077">sfr</span>&nbsp;<span class="op" id="4194081">*</span><span class="ident" id="4194082">sparseFileReader</span><span class="op" id="4194098">)</span>&nbsp;<span class="ident" id="4194100">numBytes</span><span class="op" id="4194108">(</span><span class="op" id="4194109">)</span>&nbsp;<span class="ident" id="4194111">int64</span>&nbsp;<span class="op" id="4194117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194120">return</span>&nbsp;<span class="ident" id="4194127">sfr</span><span class="op" id="4194130">.</span><span class="ident" id="4194131">rfr</span><span class="op" id="4194134">.</span><span class="ident" id="4194135">nb</span><br>
<span class="lineno">820</span><span class="op" id="4194138">}</span>
</div>
</body>
</html>
