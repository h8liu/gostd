<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4053739">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4053794">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4053848">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4053899">//&nbsp;Package&nbsp;image&nbsp;implements&nbsp;a&nbsp;basic&nbsp;2-D&nbsp;image&nbsp;library.</span><br>
<span class="lineno"></span><span class="comment" id="4053954">//</span><br>
<span class="lineno"></span><span class="comment" id="4053957">//&nbsp;The&nbsp;fundamental&nbsp;interface&nbsp;is&nbsp;called&nbsp;Image.&nbsp;An&nbsp;Image&nbsp;contains&nbsp;colors,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="4054035">//&nbsp;are&nbsp;described&nbsp;in&nbsp;the&nbsp;image/color&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="4054080">//</span><br>
<span class="lineno">10</span><span class="comment" id="4054083">//&nbsp;Values&nbsp;of&nbsp;the&nbsp;Image&nbsp;interface&nbsp;are&nbsp;created&nbsp;either&nbsp;by&nbsp;calling&nbsp;functions&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="4054161">//&nbsp;as&nbsp;NewRGBA&nbsp;and&nbsp;NewPaletted,&nbsp;or&nbsp;by&nbsp;calling&nbsp;Decode&nbsp;on&nbsp;an&nbsp;io.Reader&nbsp;containing</span><br>
<span class="lineno"></span><span class="comment" id="4054240">//&nbsp;image&nbsp;data&nbsp;in&nbsp;a&nbsp;format&nbsp;such&nbsp;as&nbsp;GIF,&nbsp;JPEG&nbsp;or&nbsp;PNG.&nbsp;Decoding&nbsp;any&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="4054316">//&nbsp;image&nbsp;format&nbsp;requires&nbsp;the&nbsp;prior&nbsp;registration&nbsp;of&nbsp;a&nbsp;decoder&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="4054387">//&nbsp;Registration&nbsp;is&nbsp;typically&nbsp;automatic&nbsp;as&nbsp;a&nbsp;side&nbsp;effect&nbsp;of&nbsp;initializing&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="4054464">//&nbsp;format&#39;s&nbsp;package&nbsp;so&nbsp;that,&nbsp;to&nbsp;decode&nbsp;a&nbsp;PNG&nbsp;image,&nbsp;it&nbsp;suffices&nbsp;to&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4054536">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;image/png&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4054560">//&nbsp;in&nbsp;a&nbsp;program&#39;s&nbsp;main&nbsp;package.&nbsp;The&nbsp;_&nbsp;means&nbsp;to&nbsp;import&nbsp;a&nbsp;package&nbsp;purely&nbsp;for&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="4054639">//&nbsp;initialization&nbsp;side&nbsp;effects.</span><br>
<span class="lineno"></span><span class="comment" id="4054671">//</span><br>
<span class="lineno">20</span><span class="comment" id="4054674">//&nbsp;See&nbsp;&#34;The&nbsp;Go&nbsp;image&nbsp;package&#34;&nbsp;for&nbsp;more&nbsp;details:</span><br>
<span class="lineno"></span><span class="comment" id="4054722">//&nbsp;http://golang.org/doc/articles/image_package.html</span><br>
<span class="lineno"></span><span class="keyword" id="4054775">package</span>&nbsp;<span class="ident" id="4054783">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4054790">import</span>&nbsp;<span class="op" id="4054797">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4054800">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="4054814">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4054817">//&nbsp;Config&nbsp;holds&nbsp;an&nbsp;image&#39;s&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions.</span><br>
<span class="lineno"></span><span class="keyword" id="4054872">type</span>&nbsp;<span class="ident" id="4054877">Config</span>&nbsp;<span class="keyword" id="4054884">struct</span>&nbsp;<span class="op" id="4054891">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4054894">ColorModel</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4054908">color</span><span class="op" id="4054913">.</span><span class="ident" id="4054914">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4054921">Width</span><span class="op" id="4054926">,</span>&nbsp;<span class="ident" id="4054928">Height</span>&nbsp;<span class="builtintype" id="4054935">int</span><br>
<span class="lineno"></span><span class="op" id="4054939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4054942">//&nbsp;Image&nbsp;is&nbsp;a&nbsp;finite&nbsp;rectangular&nbsp;grid&nbsp;of&nbsp;color.Color&nbsp;values&nbsp;taken&nbsp;from&nbsp;a&nbsp;color</span><br>
<span class="lineno">35</span><span class="comment" id="4055021">//&nbsp;model.</span><br>
<span class="lineno"></span><span class="keyword" id="4055031">type</span>&nbsp;<span class="ident" id="4055036">Image</span>&nbsp;<span class="keyword" id="4055042">interface</span>&nbsp;<span class="op" id="4055052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4055055">//&nbsp;ColorModel&nbsp;returns&nbsp;the&nbsp;Image&#39;s&nbsp;color&nbsp;model.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4055103">ColorModel</span><span class="op" id="4055113">(</span><span class="op" id="4055114">)</span>&nbsp;<span class="ident" id="4055116">color</span><span class="op" id="4055121">.</span><span class="ident" id="4055122">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4055129">//&nbsp;Bounds&nbsp;returns&nbsp;the&nbsp;domain&nbsp;for&nbsp;which&nbsp;At&nbsp;can&nbsp;return&nbsp;non-zero&nbsp;color.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4055199">//&nbsp;The&nbsp;bounds&nbsp;do&nbsp;not&nbsp;necessarily&nbsp;contain&nbsp;the&nbsp;point&nbsp;(0,&nbsp;0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4055259">Bounds</span><span class="op" id="4055265">(</span><span class="op" id="4055266">)</span>&nbsp;<span class="ident" id="4055268">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4055279">//&nbsp;At&nbsp;returns&nbsp;the&nbsp;color&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4055328">//&nbsp;At(Bounds().Min.X,&nbsp;Bounds().Min.Y)&nbsp;returns&nbsp;the&nbsp;upper-left&nbsp;pixel&nbsp;of&nbsp;the&nbsp;grid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4055409">//&nbsp;At(Bounds().Max.X-1,&nbsp;Bounds().Max.Y-1)&nbsp;returns&nbsp;the&nbsp;lower-right&nbsp;one.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4055481">At</span><span class="op" id="4055483">(</span><span class="ident" id="4055484">x</span><span class="op" id="4055485">,</span>&nbsp;<span class="ident" id="4055487">y</span>&nbsp;<span class="builtintype" id="4055489">int</span><span class="op" id="4055492">)</span>&nbsp;<span class="ident" id="4055494">color</span><span class="op" id="4055499">.</span><span class="ident" id="4055500">Color</span><br>
<span class="lineno"></span><span class="op" id="4055506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4055509">//&nbsp;PalettedImage&nbsp;is&nbsp;an&nbsp;image&nbsp;whose&nbsp;colors&nbsp;may&nbsp;come&nbsp;from&nbsp;a&nbsp;limited&nbsp;palette.</span><br>
<span class="lineno"></span><span class="comment" id="4055584">//&nbsp;If&nbsp;m&nbsp;is&nbsp;a&nbsp;PalettedImage&nbsp;and&nbsp;m.ColorModel()&nbsp;returns&nbsp;a&nbsp;PalettedColorModel&nbsp;p,</span><br>
<span class="lineno">50</span><span class="comment" id="4055662">//&nbsp;then&nbsp;m.At(x,&nbsp;y)&nbsp;should&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;p[m.ColorIndexAt(x,&nbsp;y)].&nbsp;If&nbsp;m&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4055737">//&nbsp;color&nbsp;model&nbsp;is&nbsp;not&nbsp;a&nbsp;PalettedColorModel,&nbsp;then&nbsp;ColorIndexAt&#39;s&nbsp;behavior&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4055813">//&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="keyword" id="4055827">type</span>&nbsp;<span class="ident" id="4055832">PalettedImage</span>&nbsp;<span class="keyword" id="4055846">interface</span>&nbsp;<span class="op" id="4055856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4055859">//&nbsp;ColorIndexAt&nbsp;returns&nbsp;the&nbsp;palette&nbsp;index&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4055926">ColorIndexAt</span><span class="op" id="4055938">(</span><span class="ident" id="4055939">x</span><span class="op" id="4055940">,</span>&nbsp;<span class="ident" id="4055942">y</span>&nbsp;<span class="builtintype" id="4055944">int</span><span class="op" id="4055947">)</span>&nbsp;<span class="builtintype" id="4055949">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4055956">Image</span><br>
<span class="lineno"></span><span class="op" id="4055962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4055965">//&nbsp;RGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA&nbsp;values.</span><br>
<span class="lineno">60</span><span class="keyword" id="4056038">type</span>&nbsp;<span class="ident" id="4056043">RGBA</span>&nbsp;<span class="keyword" id="4056048">struct</span>&nbsp;<span class="op" id="4056055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4056058">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4056126">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4056194">Pix</span>&nbsp;<span class="op" id="4056198">[</span><span class="op" id="4056199">]</span><span class="builtintype" id="4056200">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4056207">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4056283">Stride</span>&nbsp;<span class="builtintype" id="4056290">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4056295">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4056327">Rect</span>&nbsp;<span class="ident" id="4056332">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4056342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="4056345">func</span>&nbsp;<span class="op" id="4056350">(</span><span class="ident" id="4056351">p</span>&nbsp;<span class="op" id="4056353">*</span><span class="ident" id="4056354">RGBA</span><span class="op" id="4056358">)</span>&nbsp;<span class="ident" id="4056360">ColorModel</span><span class="op" id="4056370">(</span><span class="op" id="4056371">)</span>&nbsp;<span class="ident" id="4056373">color</span><span class="op" id="4056378">.</span><span class="ident" id="4056379">Model</span>&nbsp;<span class="op" id="4056385">{</span>&nbsp;<span class="keyword" id="4056387">return</span>&nbsp;<span class="ident" id="4056394">color</span><span class="op" id="4056399">.</span><span class="ident" id="4056400">RGBAModel</span>&nbsp;<span class="op" id="4056410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4056413">func</span>&nbsp;<span class="op" id="4056418">(</span><span class="ident" id="4056419">p</span>&nbsp;<span class="op" id="4056421">*</span><span class="ident" id="4056422">RGBA</span><span class="op" id="4056426">)</span>&nbsp;<span class="ident" id="4056428">Bounds</span><span class="op" id="4056434">(</span><span class="op" id="4056435">)</span>&nbsp;<span class="ident" id="4056437">Rectangle</span>&nbsp;<span class="op" id="4056447">{</span>&nbsp;<span class="keyword" id="4056449">return</span>&nbsp;<span class="ident" id="4056456">p</span><span class="op" id="4056457">.</span><span class="ident" id="4056458">Rect</span>&nbsp;<span class="op" id="4056463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4056466">func</span>&nbsp;<span class="op" id="4056471">(</span><span class="ident" id="4056472">p</span>&nbsp;<span class="op" id="4056474">*</span><span class="ident" id="4056475">RGBA</span><span class="op" id="4056479">)</span>&nbsp;<span class="ident" id="4056481">At</span><span class="op" id="4056483">(</span><span class="ident" id="4056484">x</span><span class="op" id="4056485">,</span>&nbsp;<span class="ident" id="4056487">y</span>&nbsp;<span class="builtintype" id="4056489">int</span><span class="op" id="4056492">)</span>&nbsp;<span class="ident" id="4056494">color</span><span class="op" id="4056499">.</span><span class="ident" id="4056500">Color</span>&nbsp;<span class="op" id="4056506">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4056509">return</span>&nbsp;<span class="ident" id="4056516">p</span><span class="op" id="4056517">.</span><span class="ident" id="4056518">RGBAAt</span><span class="op" id="4056524">(</span><span class="ident" id="4056525">x</span><span class="op" id="4056526">,</span>&nbsp;<span class="ident" id="4056528">y</span><span class="op" id="4056529">)</span><br>
<span class="lineno"></span><span class="op" id="4056531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4056534">func</span>&nbsp;<span class="op" id="4056539">(</span><span class="ident" id="4056540">p</span>&nbsp;<span class="op" id="4056542">*</span><span class="ident" id="4056543">RGBA</span><span class="op" id="4056547">)</span>&nbsp;<span class="ident" id="4056549">RGBAAt</span><span class="op" id="4056555">(</span><span class="ident" id="4056556">x</span><span class="op" id="4056557">,</span>&nbsp;<span class="ident" id="4056559">y</span>&nbsp;<span class="builtintype" id="4056561">int</span><span class="op" id="4056564">)</span>&nbsp;<span class="ident" id="4056566">color</span><span class="op" id="4056571">.</span><span class="ident" id="4056572">RGBA</span>&nbsp;<span class="op" id="4056577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4056580">if</span>&nbsp;<span class="op" id="4056583">!</span><span class="op" id="4056584">(</span><span class="ident" id="4056585">Point</span><span class="op" id="4056590">{</span><span class="ident" id="4056591">x</span><span class="op" id="4056592">,</span>&nbsp;<span class="ident" id="4056594">y</span><span class="op" id="4056595">}</span><span class="op" id="4056596">.</span><span class="ident" id="4056597">In</span><span class="op" id="4056599">(</span><span class="ident" id="4056600">p</span><span class="op" id="4056601">.</span><span class="ident" id="4056602">Rect</span><span class="op" id="4056606">)</span><span class="op" id="4056607">)</span>&nbsp;<span class="op" id="4056609">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4056613">return</span>&nbsp;<span class="ident" id="4056620">color</span><span class="op" id="4056625">.</span><span class="ident" id="4056626">RGBA</span><span class="op" id="4056630">{</span><span class="op" id="4056631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4056634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4056637">i</span>&nbsp;<span class="op" id="4056639">:=</span>&nbsp;<span class="ident" id="4056642">p</span><span class="op" id="4056643">.</span><span class="ident" id="4056644">PixOffset</span><span class="op" id="4056653">(</span><span class="ident" id="4056654">x</span><span class="op" id="4056655">,</span>&nbsp;<span class="ident" id="4056657">y</span><span class="op" id="4056658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4056661">return</span>&nbsp;<span class="ident" id="4056668">color</span><span class="op" id="4056673">.</span><span class="ident" id="4056674">RGBA</span><span class="op" id="4056678">{</span><span class="ident" id="4056679">p</span><span class="op" id="4056680">.</span><span class="ident" id="4056681">Pix</span><span class="op" id="4056684">[</span><span class="ident" id="4056685">i</span><span class="op" id="4056686">+</span><span class="num" id="4056687">0</span><span class="op" id="4056688">]</span><span class="op" id="4056689">,</span>&nbsp;<span class="ident" id="4056691">p</span><span class="op" id="4056692">.</span><span class="ident" id="4056693">Pix</span><span class="op" id="4056696">[</span><span class="ident" id="4056697">i</span><span class="op" id="4056698">+</span><span class="num" id="4056699">1</span><span class="op" id="4056700">]</span><span class="op" id="4056701">,</span>&nbsp;<span class="ident" id="4056703">p</span><span class="op" id="4056704">.</span><span class="ident" id="4056705">Pix</span><span class="op" id="4056708">[</span><span class="ident" id="4056709">i</span><span class="op" id="4056710">+</span><span class="num" id="4056711">2</span><span class="op" id="4056712">]</span><span class="op" id="4056713">,</span>&nbsp;<span class="ident" id="4056715">p</span><span class="op" id="4056716">.</span><span class="ident" id="4056717">Pix</span><span class="op" id="4056720">[</span><span class="ident" id="4056721">i</span><span class="op" id="4056722">+</span><span class="num" id="4056723">3</span><span class="op" id="4056724">]</span><span class="op" id="4056725">}</span><br>
<span class="lineno"></span><span class="op" id="4056727">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4056730">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4056809">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4056833">func</span>&nbsp;<span class="op" id="4056838">(</span><span class="ident" id="4056839">p</span>&nbsp;<span class="op" id="4056841">*</span><span class="ident" id="4056842">RGBA</span><span class="op" id="4056846">)</span>&nbsp;<span class="ident" id="4056848">PixOffset</span><span class="op" id="4056857">(</span><span class="ident" id="4056858">x</span><span class="op" id="4056859">,</span>&nbsp;<span class="ident" id="4056861">y</span>&nbsp;<span class="builtintype" id="4056863">int</span><span class="op" id="4056866">)</span>&nbsp;<span class="builtintype" id="4056868">int</span>&nbsp;<span class="op" id="4056872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4056875">return</span>&nbsp;<span class="op" id="4056882">(</span><span class="ident" id="4056883">y</span><span class="op" id="4056884">-</span><span class="ident" id="4056885">p</span><span class="op" id="4056886">.</span><span class="ident" id="4056887">Rect</span><span class="op" id="4056891">.</span><span class="ident" id="4056892">Min</span><span class="op" id="4056895">.</span><span class="ident" id="4056896">Y</span><span class="op" id="4056897">)</span><span class="op" id="4056898">*</span><span class="ident" id="4056899">p</span><span class="op" id="4056900">.</span><span class="ident" id="4056901">Stride</span>&nbsp;<span class="op" id="4056908">+</span>&nbsp;<span class="op" id="4056910">(</span><span class="ident" id="4056911">x</span><span class="op" id="4056912">-</span><span class="ident" id="4056913">p</span><span class="op" id="4056914">.</span><span class="ident" id="4056915">Rect</span><span class="op" id="4056919">.</span><span class="ident" id="4056920">Min</span><span class="op" id="4056923">.</span><span class="ident" id="4056924">X</span><span class="op" id="4056925">)</span><span class="op" id="4056926">*</span><span class="num" id="4056927">4</span><br>
<span class="lineno">90</span><span class="op" id="4056929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4056932">func</span>&nbsp;<span class="op" id="4056937">(</span><span class="ident" id="4056938">p</span>&nbsp;<span class="op" id="4056940">*</span><span class="ident" id="4056941">RGBA</span><span class="op" id="4056945">)</span>&nbsp;<span class="ident" id="4056947">Set</span><span class="op" id="4056950">(</span><span class="ident" id="4056951">x</span><span class="op" id="4056952">,</span>&nbsp;<span class="ident" id="4056954">y</span>&nbsp;<span class="builtintype" id="4056956">int</span><span class="op" id="4056959">,</span>&nbsp;<span class="ident" id="4056961">c</span>&nbsp;<span class="ident" id="4056963">color</span><span class="op" id="4056968">.</span><span class="ident" id="4056969">Color</span><span class="op" id="4056974">)</span>&nbsp;<span class="op" id="4056976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4056979">if</span>&nbsp;<span class="op" id="4056982">!</span><span class="op" id="4056983">(</span><span class="ident" id="4056984">Point</span><span class="op" id="4056989">{</span><span class="ident" id="4056990">x</span><span class="op" id="4056991">,</span>&nbsp;<span class="ident" id="4056993">y</span><span class="op" id="4056994">}</span><span class="op" id="4056995">.</span><span class="ident" id="4056996">In</span><span class="op" id="4056998">(</span><span class="ident" id="4056999">p</span><span class="op" id="4057000">.</span><span class="ident" id="4057001">Rect</span><span class="op" id="4057005">)</span><span class="op" id="4057006">)</span>&nbsp;<span class="op" id="4057008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4057012">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4057020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4057023">i</span>&nbsp;<span class="op" id="4057025">:=</span>&nbsp;<span class="ident" id="4057028">p</span><span class="op" id="4057029">.</span><span class="ident" id="4057030">PixOffset</span><span class="op" id="4057039">(</span><span class="ident" id="4057040">x</span><span class="op" id="4057041">,</span>&nbsp;<span class="ident" id="4057043">y</span><span class="op" id="4057044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4057047">c1</span>&nbsp;<span class="op" id="4057050">:=</span>&nbsp;<span class="ident" id="4057053">color</span><span class="op" id="4057058">.</span><span class="ident" id="4057059">RGBAModel</span><span class="op" id="4057068">.</span><span class="ident" id="4057069">Convert</span><span class="op" id="4057076">(</span><span class="ident" id="4057077">c</span><span class="op" id="4057078">)</span><span class="op" id="4057079">.</span><span class="op" id="4057080">(</span><span class="ident" id="4057081">color</span><span class="op" id="4057086">.</span><span class="ident" id="4057087">RGBA</span><span class="op" id="4057091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4057094">p</span><span class="op" id="4057095">.</span><span class="ident" id="4057096">Pix</span><span class="op" id="4057099">[</span><span class="ident" id="4057100">i</span><span class="op" id="4057101">+</span><span class="num" id="4057102">0</span><span class="op" id="4057103">]</span>&nbsp;<span class="op" id="4057105">=</span>&nbsp;<span class="ident" id="4057107">c1</span><span class="op" id="4057109">.</span><span class="ident" id="4057110">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4057113">p</span><span class="op" id="4057114">.</span><span class="ident" id="4057115">Pix</span><span class="op" id="4057118">[</span><span class="ident" id="4057119">i</span><span class="op" id="4057120">+</span><span class="num" id="4057121">1</span><span class="op" id="4057122">]</span>&nbsp;<span class="op" id="4057124">=</span>&nbsp;<span class="ident" id="4057126">c1</span><span class="op" id="4057128">.</span><span class="ident" id="4057129">G</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4057132">p</span><span class="op" id="4057133">.</span><span class="ident" id="4057134">Pix</span><span class="op" id="4057137">[</span><span class="ident" id="4057138">i</span><span class="op" id="4057139">+</span><span class="num" id="4057140">2</span><span class="op" id="4057141">]</span>&nbsp;<span class="op" id="4057143">=</span>&nbsp;<span class="ident" id="4057145">c1</span><span class="op" id="4057147">.</span><span class="ident" id="4057148">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4057151">p</span><span class="op" id="4057152">.</span><span class="ident" id="4057153">Pix</span><span class="op" id="4057156">[</span><span class="ident" id="4057157">i</span><span class="op" id="4057158">+</span><span class="num" id="4057159">3</span><span class="op" id="4057160">]</span>&nbsp;<span class="op" id="4057162">=</span>&nbsp;<span class="ident" id="4057164">c1</span><span class="op" id="4057166">.</span><span class="ident" id="4057167">A</span><br>
<span class="lineno"></span><span class="op" id="4057169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4057172">func</span>&nbsp;<span class="op" id="4057177">(</span><span class="ident" id="4057178">p</span>&nbsp;<span class="op" id="4057180">*</span><span class="ident" id="4057181">RGBA</span><span class="op" id="4057185">)</span>&nbsp;<span class="ident" id="4057187">SetRGBA</span><span class="op" id="4057194">(</span><span class="ident" id="4057195">x</span><span class="op" id="4057196">,</span>&nbsp;<span class="ident" id="4057198">y</span>&nbsp;<span class="builtintype" id="4057200">int</span><span class="op" id="4057203">,</span>&nbsp;<span class="ident" id="4057205">c</span>&nbsp;<span class="ident" id="4057207">color</span><span class="op" id="4057212">.</span><span class="ident" id="4057213">RGBA</span><span class="op" id="4057217">)</span>&nbsp;<span class="op" id="4057219">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4057222">if</span>&nbsp;<span class="op" id="4057225">!</span><span class="op" id="4057226">(</span><span class="ident" id="4057227">Point</span><span class="op" id="4057232">{</span><span class="ident" id="4057233">x</span><span class="op" id="4057234">,</span>&nbsp;<span class="ident" id="4057236">y</span><span class="op" id="4057237">}</span><span class="op" id="4057238">.</span><span class="ident" id="4057239">In</span><span class="op" id="4057241">(</span><span class="ident" id="4057242">p</span><span class="op" id="4057243">.</span><span class="ident" id="4057244">Rect</span><span class="op" id="4057248">)</span><span class="op" id="4057249">)</span>&nbsp;<span class="op" id="4057251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4057255">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4057263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4057266">i</span>&nbsp;<span class="op" id="4057268">:=</span>&nbsp;<span class="ident" id="4057271">p</span><span class="op" id="4057272">.</span><span class="ident" id="4057273">PixOffset</span><span class="op" id="4057282">(</span><span class="ident" id="4057283">x</span><span class="op" id="4057284">,</span>&nbsp;<span class="ident" id="4057286">y</span><span class="op" id="4057287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4057290">p</span><span class="op" id="4057291">.</span><span class="ident" id="4057292">Pix</span><span class="op" id="4057295">[</span><span class="ident" id="4057296">i</span><span class="op" id="4057297">+</span><span class="num" id="4057298">0</span><span class="op" id="4057299">]</span>&nbsp;<span class="op" id="4057301">=</span>&nbsp;<span class="ident" id="4057303">c</span><span class="op" id="4057304">.</span><span class="ident" id="4057305">R</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4057308">p</span><span class="op" id="4057309">.</span><span class="ident" id="4057310">Pix</span><span class="op" id="4057313">[</span><span class="ident" id="4057314">i</span><span class="op" id="4057315">+</span><span class="num" id="4057316">1</span><span class="op" id="4057317">]</span>&nbsp;<span class="op" id="4057319">=</span>&nbsp;<span class="ident" id="4057321">c</span><span class="op" id="4057322">.</span><span class="ident" id="4057323">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4057326">p</span><span class="op" id="4057327">.</span><span class="ident" id="4057328">Pix</span><span class="op" id="4057331">[</span><span class="ident" id="4057332">i</span><span class="op" id="4057333">+</span><span class="num" id="4057334">2</span><span class="op" id="4057335">]</span>&nbsp;<span class="op" id="4057337">=</span>&nbsp;<span class="ident" id="4057339">c</span><span class="op" id="4057340">.</span><span class="ident" id="4057341">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4057344">p</span><span class="op" id="4057345">.</span><span class="ident" id="4057346">Pix</span><span class="op" id="4057349">[</span><span class="ident" id="4057350">i</span><span class="op" id="4057351">+</span><span class="num" id="4057352">3</span><span class="op" id="4057353">]</span>&nbsp;<span class="op" id="4057355">=</span>&nbsp;<span class="ident" id="4057357">c</span><span class="op" id="4057358">.</span><span class="ident" id="4057359">A</span><br>
<span class="lineno"></span><span class="op" id="4057361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="4057364">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4057441">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4057513">func</span>&nbsp;<span class="op" id="4057518">(</span><span class="ident" id="4057519">p</span>&nbsp;<span class="op" id="4057521">*</span><span class="ident" id="4057522">RGBA</span><span class="op" id="4057526">)</span>&nbsp;<span class="ident" id="4057528">SubImage</span><span class="op" id="4057536">(</span><span class="ident" id="4057537">r</span>&nbsp;<span class="ident" id="4057539">Rectangle</span><span class="op" id="4057548">)</span>&nbsp;<span class="ident" id="4057550">Image</span>&nbsp;<span class="op" id="4057556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4057559">r</span>&nbsp;<span class="op" id="4057561">=</span>&nbsp;<span class="ident" id="4057563">r</span><span class="op" id="4057564">.</span><span class="ident" id="4057565">Intersect</span><span class="op" id="4057574">(</span><span class="ident" id="4057575">p</span><span class="op" id="4057576">.</span><span class="ident" id="4057577">Rect</span><span class="op" id="4057581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4057584">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4057665">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4057747">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4057797">if</span>&nbsp;<span class="ident" id="4057800">r</span><span class="op" id="4057801">.</span><span class="ident" id="4057802">Empty</span><span class="op" id="4057807">(</span><span class="op" id="4057808">)</span>&nbsp;<span class="op" id="4057810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4057814">return</span>&nbsp;<span class="op" id="4057821">&amp;</span><span class="ident" id="4057822">RGBA</span><span class="op" id="4057826">{</span><span class="op" id="4057827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4057830">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4057833">i</span>&nbsp;<span class="op" id="4057835">:=</span>&nbsp;<span class="ident" id="4057838">p</span><span class="op" id="4057839">.</span><span class="ident" id="4057840">PixOffset</span><span class="op" id="4057849">(</span><span class="ident" id="4057850">r</span><span class="op" id="4057851">.</span><span class="ident" id="4057852">Min</span><span class="op" id="4057855">.</span><span class="ident" id="4057856">X</span><span class="op" id="4057857">,</span>&nbsp;<span class="ident" id="4057859">r</span><span class="op" id="4057860">.</span><span class="ident" id="4057861">Min</span><span class="op" id="4057864">.</span><span class="ident" id="4057865">Y</span><span class="op" id="4057866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4057869">return</span>&nbsp;<span class="op" id="4057876">&amp;</span><span class="ident" id="4057877">RGBA</span><span class="op" id="4057881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4057885">Pix</span><span class="op" id="4057888">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4057893">p</span><span class="op" id="4057894">.</span><span class="ident" id="4057895">Pix</span><span class="op" id="4057898">[</span><span class="ident" id="4057899">i</span><span class="op" id="4057900">:</span><span class="op" id="4057901">]</span><span class="op" id="4057902">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4057906">Stride</span><span class="op" id="4057912">:</span>&nbsp;<span class="ident" id="4057914">p</span><span class="op" id="4057915">.</span><span class="ident" id="4057916">Stride</span><span class="op" id="4057922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4057926">Rect</span><span class="op" id="4057930">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4057934">r</span><span class="op" id="4057935">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4057938">}</span><br>
<span class="lineno"></span><span class="op" id="4057940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4057943">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4058016">func</span>&nbsp;<span class="op" id="4058021">(</span><span class="ident" id="4058022">p</span>&nbsp;<span class="op" id="4058024">*</span><span class="ident" id="4058025">RGBA</span><span class="op" id="4058029">)</span>&nbsp;<span class="ident" id="4058031">Opaque</span><span class="op" id="4058037">(</span><span class="op" id="4058038">)</span>&nbsp;<span class="builtintype" id="4058040">bool</span>&nbsp;<span class="op" id="4058045">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4058048">if</span>&nbsp;<span class="ident" id="4058051">p</span><span class="op" id="4058052">.</span><span class="ident" id="4058053">Rect</span><span class="op" id="4058057">.</span><span class="ident" id="4058058">Empty</span><span class="op" id="4058063">(</span><span class="op" id="4058064">)</span>&nbsp;<span class="op" id="4058066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4058070">return</span>&nbsp;<span class="builtintype" id="4058077">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4058083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4058086">i0</span><span class="op" id="4058088">,</span>&nbsp;<span class="ident" id="4058090">i1</span>&nbsp;<span class="op" id="4058093">:=</span>&nbsp;<span class="num" id="4058096">3</span><span class="op" id="4058097">,</span>&nbsp;<span class="ident" id="4058099">p</span><span class="op" id="4058100">.</span><span class="ident" id="4058101">Rect</span><span class="op" id="4058105">.</span><span class="ident" id="4058106">Dx</span><span class="op" id="4058108">(</span><span class="op" id="4058109">)</span><span class="op" id="4058110">*</span><span class="num" id="4058111">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4058114">for</span>&nbsp;<span class="ident" id="4058118">y</span>&nbsp;<span class="op" id="4058120">:=</span>&nbsp;<span class="ident" id="4058123">p</span><span class="op" id="4058124">.</span><span class="ident" id="4058125">Rect</span><span class="op" id="4058129">.</span><span class="ident" id="4058130">Min</span><span class="op" id="4058133">.</span><span class="ident" id="4058134">Y</span><span class="op" id="4058135">;</span>&nbsp;<span class="ident" id="4058137">y</span>&nbsp;<span class="op" id="4058139">&lt;</span>&nbsp;<span class="ident" id="4058141">p</span><span class="op" id="4058142">.</span><span class="ident" id="4058143">Rect</span><span class="op" id="4058147">.</span><span class="ident" id="4058148">Max</span><span class="op" id="4058151">.</span><span class="ident" id="4058152">Y</span><span class="op" id="4058153">;</span>&nbsp;<span class="ident" id="4058155">y</span><span class="op" id="4058156">++</span>&nbsp;<span class="op" id="4058159">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4058163">for</span>&nbsp;<span class="ident" id="4058167">i</span>&nbsp;<span class="op" id="4058169">:=</span>&nbsp;<span class="ident" id="4058172">i0</span><span class="op" id="4058174">;</span>&nbsp;<span class="ident" id="4058176">i</span>&nbsp;<span class="op" id="4058178">&lt;</span>&nbsp;<span class="ident" id="4058180">i1</span><span class="op" id="4058182">;</span>&nbsp;<span class="ident" id="4058184">i</span>&nbsp;<span class="op" id="4058186">+=</span>&nbsp;<span class="num" id="4058189">4</span>&nbsp;<span class="op" id="4058191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4058196">if</span>&nbsp;<span class="ident" id="4058199">p</span><span class="op" id="4058200">.</span><span class="ident" id="4058201">Pix</span><span class="op" id="4058204">[</span><span class="ident" id="4058205">i</span><span class="op" id="4058206">]</span>&nbsp;<span class="op" id="4058208">!=</span>&nbsp;<span class="num" id="4058211">0xff</span>&nbsp;<span class="op" id="4058216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4058222">return</span>&nbsp;<span class="builtintype" id="4058229">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4058238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4058242">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4058246">i0</span>&nbsp;<span class="op" id="4058249">+=</span>&nbsp;<span class="ident" id="4058252">p</span><span class="op" id="4058253">.</span><span class="ident" id="4058254">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4058263">i1</span>&nbsp;<span class="op" id="4058266">+=</span>&nbsp;<span class="ident" id="4058269">p</span><span class="op" id="4058270">.</span><span class="ident" id="4058271">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4058279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4058282">return</span>&nbsp;<span class="builtintype" id="4058289">true</span><br>
<span class="lineno"></span><span class="op" id="4058294">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="4058297">//&nbsp;NewRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4058350">func</span>&nbsp;<span class="ident" id="4058355">NewRGBA</span><span class="op" id="4058362">(</span><span class="ident" id="4058363">r</span>&nbsp;<span class="ident" id="4058365">Rectangle</span><span class="op" id="4058374">)</span>&nbsp;<span class="op" id="4058376">*</span><span class="ident" id="4058377">RGBA</span>&nbsp;<span class="op" id="4058382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4058385">w</span><span class="op" id="4058386">,</span>&nbsp;<span class="ident" id="4058388">h</span>&nbsp;<span class="op" id="4058390">:=</span>&nbsp;<span class="ident" id="4058393">r</span><span class="op" id="4058394">.</span><span class="ident" id="4058395">Dx</span><span class="op" id="4058397">(</span><span class="op" id="4058398">)</span><span class="op" id="4058399">,</span>&nbsp;<span class="ident" id="4058401">r</span><span class="op" id="4058402">.</span><span class="ident" id="4058403">Dy</span><span class="op" id="4058405">(</span><span class="op" id="4058406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4058409">buf</span>&nbsp;<span class="op" id="4058413">:=</span>&nbsp;<span class="builtinfunc" id="4058416">make</span><span class="op" id="4058420">(</span><span class="op" id="4058421">[</span><span class="op" id="4058422">]</span><span class="builtintype" id="4058423">uint8</span><span class="op" id="4058428">,</span>&nbsp;<span class="num" id="4058430">4</span><span class="op" id="4058431">*</span><span class="ident" id="4058432">w</span><span class="op" id="4058433">*</span><span class="ident" id="4058434">h</span><span class="op" id="4058435">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4058438">return</span>&nbsp;<span class="op" id="4058445">&amp;</span><span class="ident" id="4058446">RGBA</span><span class="op" id="4058450">{</span><span class="ident" id="4058451">buf</span><span class="op" id="4058454">,</span>&nbsp;<span class="num" id="4058456">4</span>&nbsp;<span class="op" id="4058458">*</span>&nbsp;<span class="ident" id="4058460">w</span><span class="op" id="4058461">,</span>&nbsp;<span class="ident" id="4058463">r</span><span class="op" id="4058464">}</span><br>
<span class="lineno"></span><span class="op" id="4058466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4058469">//&nbsp;RGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4058546">type</span>&nbsp;<span class="ident" id="4058551">RGBA64</span>&nbsp;<span class="keyword" id="4058558">struct</span>&nbsp;<span class="op" id="4058565">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4058568">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4058658">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4058726">Pix</span>&nbsp;<span class="op" id="4058730">[</span><span class="op" id="4058731">]</span><span class="builtintype" id="4058732">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4058739">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4058815">Stride</span>&nbsp;<span class="builtintype" id="4058822">int</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4058827">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4058859">Rect</span>&nbsp;<span class="ident" id="4058864">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4058874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4058877">func</span>&nbsp;<span class="op" id="4058882">(</span><span class="ident" id="4058883">p</span>&nbsp;<span class="op" id="4058885">*</span><span class="ident" id="4058886">RGBA64</span><span class="op" id="4058892">)</span>&nbsp;<span class="ident" id="4058894">ColorModel</span><span class="op" id="4058904">(</span><span class="op" id="4058905">)</span>&nbsp;<span class="ident" id="4058907">color</span><span class="op" id="4058912">.</span><span class="ident" id="4058913">Model</span>&nbsp;<span class="op" id="4058919">{</span>&nbsp;<span class="keyword" id="4058921">return</span>&nbsp;<span class="ident" id="4058928">color</span><span class="op" id="4058933">.</span><span class="ident" id="4058934">RGBA64Model</span>&nbsp;<span class="op" id="4058946">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="4058949">func</span>&nbsp;<span class="op" id="4058954">(</span><span class="ident" id="4058955">p</span>&nbsp;<span class="op" id="4058957">*</span><span class="ident" id="4058958">RGBA64</span><span class="op" id="4058964">)</span>&nbsp;<span class="ident" id="4058966">Bounds</span><span class="op" id="4058972">(</span><span class="op" id="4058973">)</span>&nbsp;<span class="ident" id="4058975">Rectangle</span>&nbsp;<span class="op" id="4058985">{</span>&nbsp;<span class="keyword" id="4058987">return</span>&nbsp;<span class="ident" id="4058994">p</span><span class="op" id="4058995">.</span><span class="ident" id="4058996">Rect</span>&nbsp;<span class="op" id="4059001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4059004">func</span>&nbsp;<span class="op" id="4059009">(</span><span class="ident" id="4059010">p</span>&nbsp;<span class="op" id="4059012">*</span><span class="ident" id="4059013">RGBA64</span><span class="op" id="4059019">)</span>&nbsp;<span class="ident" id="4059021">At</span><span class="op" id="4059023">(</span><span class="ident" id="4059024">x</span><span class="op" id="4059025">,</span>&nbsp;<span class="ident" id="4059027">y</span>&nbsp;<span class="builtintype" id="4059029">int</span><span class="op" id="4059032">)</span>&nbsp;<span class="ident" id="4059034">color</span><span class="op" id="4059039">.</span><span class="ident" id="4059040">Color</span>&nbsp;<span class="op" id="4059046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4059049">return</span>&nbsp;<span class="ident" id="4059056">p</span><span class="op" id="4059057">.</span><span class="ident" id="4059058">RGBA64At</span><span class="op" id="4059066">(</span><span class="ident" id="4059067">x</span><span class="op" id="4059068">,</span>&nbsp;<span class="ident" id="4059070">y</span><span class="op" id="4059071">)</span><br>
<span class="lineno">175</span><span class="op" id="4059073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4059076">func</span>&nbsp;<span class="op" id="4059081">(</span><span class="ident" id="4059082">p</span>&nbsp;<span class="op" id="4059084">*</span><span class="ident" id="4059085">RGBA64</span><span class="op" id="4059091">)</span>&nbsp;<span class="ident" id="4059093">RGBA64At</span><span class="op" id="4059101">(</span><span class="ident" id="4059102">x</span><span class="op" id="4059103">,</span>&nbsp;<span class="ident" id="4059105">y</span>&nbsp;<span class="builtintype" id="4059107">int</span><span class="op" id="4059110">)</span>&nbsp;<span class="ident" id="4059112">color</span><span class="op" id="4059117">.</span><span class="ident" id="4059118">RGBA64</span>&nbsp;<span class="op" id="4059125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4059128">if</span>&nbsp;<span class="op" id="4059131">!</span><span class="op" id="4059132">(</span><span class="ident" id="4059133">Point</span><span class="op" id="4059138">{</span><span class="ident" id="4059139">x</span><span class="op" id="4059140">,</span>&nbsp;<span class="ident" id="4059142">y</span><span class="op" id="4059143">}</span><span class="op" id="4059144">.</span><span class="ident" id="4059145">In</span><span class="op" id="4059147">(</span><span class="ident" id="4059148">p</span><span class="op" id="4059149">.</span><span class="ident" id="4059150">Rect</span><span class="op" id="4059154">)</span><span class="op" id="4059155">)</span>&nbsp;<span class="op" id="4059157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4059161">return</span>&nbsp;<span class="ident" id="4059168">color</span><span class="op" id="4059173">.</span><span class="ident" id="4059174">RGBA64</span><span class="op" id="4059180">{</span><span class="op" id="4059181">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4059184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4059187">i</span>&nbsp;<span class="op" id="4059189">:=</span>&nbsp;<span class="ident" id="4059192">p</span><span class="op" id="4059193">.</span><span class="ident" id="4059194">PixOffset</span><span class="op" id="4059203">(</span><span class="ident" id="4059204">x</span><span class="op" id="4059205">,</span>&nbsp;<span class="ident" id="4059207">y</span><span class="op" id="4059208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4059211">return</span>&nbsp;<span class="ident" id="4059218">color</span><span class="op" id="4059223">.</span><span class="ident" id="4059224">RGBA64</span><span class="op" id="4059230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4059234">uint16</span><span class="op" id="4059240">(</span><span class="ident" id="4059241">p</span><span class="op" id="4059242">.</span><span class="ident" id="4059243">Pix</span><span class="op" id="4059246">[</span><span class="ident" id="4059247">i</span><span class="op" id="4059248">+</span><span class="num" id="4059249">0</span><span class="op" id="4059250">]</span><span class="op" id="4059251">)</span><span class="op" id="4059252">&lt;&lt;</span><span class="num" id="4059254">8</span>&nbsp;<span class="op" id="4059256">|</span>&nbsp;<span class="builtintype" id="4059258">uint16</span><span class="op" id="4059264">(</span><span class="ident" id="4059265">p</span><span class="op" id="4059266">.</span><span class="ident" id="4059267">Pix</span><span class="op" id="4059270">[</span><span class="ident" id="4059271">i</span><span class="op" id="4059272">+</span><span class="num" id="4059273">1</span><span class="op" id="4059274">]</span><span class="op" id="4059275">)</span><span class="op" id="4059276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4059280">uint16</span><span class="op" id="4059286">(</span><span class="ident" id="4059287">p</span><span class="op" id="4059288">.</span><span class="ident" id="4059289">Pix</span><span class="op" id="4059292">[</span><span class="ident" id="4059293">i</span><span class="op" id="4059294">+</span><span class="num" id="4059295">2</span><span class="op" id="4059296">]</span><span class="op" id="4059297">)</span><span class="op" id="4059298">&lt;&lt;</span><span class="num" id="4059300">8</span>&nbsp;<span class="op" id="4059302">|</span>&nbsp;<span class="builtintype" id="4059304">uint16</span><span class="op" id="4059310">(</span><span class="ident" id="4059311">p</span><span class="op" id="4059312">.</span><span class="ident" id="4059313">Pix</span><span class="op" id="4059316">[</span><span class="ident" id="4059317">i</span><span class="op" id="4059318">+</span><span class="num" id="4059319">3</span><span class="op" id="4059320">]</span><span class="op" id="4059321">)</span><span class="op" id="4059322">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4059326">uint16</span><span class="op" id="4059332">(</span><span class="ident" id="4059333">p</span><span class="op" id="4059334">.</span><span class="ident" id="4059335">Pix</span><span class="op" id="4059338">[</span><span class="ident" id="4059339">i</span><span class="op" id="4059340">+</span><span class="num" id="4059341">4</span><span class="op" id="4059342">]</span><span class="op" id="4059343">)</span><span class="op" id="4059344">&lt;&lt;</span><span class="num" id="4059346">8</span>&nbsp;<span class="op" id="4059348">|</span>&nbsp;<span class="builtintype" id="4059350">uint16</span><span class="op" id="4059356">(</span><span class="ident" id="4059357">p</span><span class="op" id="4059358">.</span><span class="ident" id="4059359">Pix</span><span class="op" id="4059362">[</span><span class="ident" id="4059363">i</span><span class="op" id="4059364">+</span><span class="num" id="4059365">5</span><span class="op" id="4059366">]</span><span class="op" id="4059367">)</span><span class="op" id="4059368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4059372">uint16</span><span class="op" id="4059378">(</span><span class="ident" id="4059379">p</span><span class="op" id="4059380">.</span><span class="ident" id="4059381">Pix</span><span class="op" id="4059384">[</span><span class="ident" id="4059385">i</span><span class="op" id="4059386">+</span><span class="num" id="4059387">6</span><span class="op" id="4059388">]</span><span class="op" id="4059389">)</span><span class="op" id="4059390">&lt;&lt;</span><span class="num" id="4059392">8</span>&nbsp;<span class="op" id="4059394">|</span>&nbsp;<span class="builtintype" id="4059396">uint16</span><span class="op" id="4059402">(</span><span class="ident" id="4059403">p</span><span class="op" id="4059404">.</span><span class="ident" id="4059405">Pix</span><span class="op" id="4059408">[</span><span class="ident" id="4059409">i</span><span class="op" id="4059410">+</span><span class="num" id="4059411">7</span><span class="op" id="4059412">]</span><span class="op" id="4059413">)</span><span class="op" id="4059414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4059417">}</span><br>
<span class="lineno"></span><span class="op" id="4059419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4059422">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4059501">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4059525">func</span>&nbsp;<span class="op" id="4059530">(</span><span class="ident" id="4059531">p</span>&nbsp;<span class="op" id="4059533">*</span><span class="ident" id="4059534">RGBA64</span><span class="op" id="4059540">)</span>&nbsp;<span class="ident" id="4059542">PixOffset</span><span class="op" id="4059551">(</span><span class="ident" id="4059552">x</span><span class="op" id="4059553">,</span>&nbsp;<span class="ident" id="4059555">y</span>&nbsp;<span class="builtintype" id="4059557">int</span><span class="op" id="4059560">)</span>&nbsp;<span class="builtintype" id="4059562">int</span>&nbsp;<span class="op" id="4059566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4059569">return</span>&nbsp;<span class="op" id="4059576">(</span><span class="ident" id="4059577">y</span><span class="op" id="4059578">-</span><span class="ident" id="4059579">p</span><span class="op" id="4059580">.</span><span class="ident" id="4059581">Rect</span><span class="op" id="4059585">.</span><span class="ident" id="4059586">Min</span><span class="op" id="4059589">.</span><span class="ident" id="4059590">Y</span><span class="op" id="4059591">)</span><span class="op" id="4059592">*</span><span class="ident" id="4059593">p</span><span class="op" id="4059594">.</span><span class="ident" id="4059595">Stride</span>&nbsp;<span class="op" id="4059602">+</span>&nbsp;<span class="op" id="4059604">(</span><span class="ident" id="4059605">x</span><span class="op" id="4059606">-</span><span class="ident" id="4059607">p</span><span class="op" id="4059608">.</span><span class="ident" id="4059609">Rect</span><span class="op" id="4059613">.</span><span class="ident" id="4059614">Min</span><span class="op" id="4059617">.</span><span class="ident" id="4059618">X</span><span class="op" id="4059619">)</span><span class="op" id="4059620">*</span><span class="num" id="4059621">8</span><br>
<span class="lineno"></span><span class="op" id="4059623">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="4059626">func</span>&nbsp;<span class="op" id="4059631">(</span><span class="ident" id="4059632">p</span>&nbsp;<span class="op" id="4059634">*</span><span class="ident" id="4059635">RGBA64</span><span class="op" id="4059641">)</span>&nbsp;<span class="ident" id="4059643">Set</span><span class="op" id="4059646">(</span><span class="ident" id="4059647">x</span><span class="op" id="4059648">,</span>&nbsp;<span class="ident" id="4059650">y</span>&nbsp;<span class="builtintype" id="4059652">int</span><span class="op" id="4059655">,</span>&nbsp;<span class="ident" id="4059657">c</span>&nbsp;<span class="ident" id="4059659">color</span><span class="op" id="4059664">.</span><span class="ident" id="4059665">Color</span><span class="op" id="4059670">)</span>&nbsp;<span class="op" id="4059672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4059675">if</span>&nbsp;<span class="op" id="4059678">!</span><span class="op" id="4059679">(</span><span class="ident" id="4059680">Point</span><span class="op" id="4059685">{</span><span class="ident" id="4059686">x</span><span class="op" id="4059687">,</span>&nbsp;<span class="ident" id="4059689">y</span><span class="op" id="4059690">}</span><span class="op" id="4059691">.</span><span class="ident" id="4059692">In</span><span class="op" id="4059694">(</span><span class="ident" id="4059695">p</span><span class="op" id="4059696">.</span><span class="ident" id="4059697">Rect</span><span class="op" id="4059701">)</span><span class="op" id="4059702">)</span>&nbsp;<span class="op" id="4059704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4059708">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4059716">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4059719">i</span>&nbsp;<span class="op" id="4059721">:=</span>&nbsp;<span class="ident" id="4059724">p</span><span class="op" id="4059725">.</span><span class="ident" id="4059726">PixOffset</span><span class="op" id="4059735">(</span><span class="ident" id="4059736">x</span><span class="op" id="4059737">,</span>&nbsp;<span class="ident" id="4059739">y</span><span class="op" id="4059740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4059743">c1</span>&nbsp;<span class="op" id="4059746">:=</span>&nbsp;<span class="ident" id="4059749">color</span><span class="op" id="4059754">.</span><span class="ident" id="4059755">RGBA64Model</span><span class="op" id="4059766">.</span><span class="ident" id="4059767">Convert</span><span class="op" id="4059774">(</span><span class="ident" id="4059775">c</span><span class="op" id="4059776">)</span><span class="op" id="4059777">.</span><span class="op" id="4059778">(</span><span class="ident" id="4059779">color</span><span class="op" id="4059784">.</span><span class="ident" id="4059785">RGBA64</span><span class="op" id="4059791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4059794">p</span><span class="op" id="4059795">.</span><span class="ident" id="4059796">Pix</span><span class="op" id="4059799">[</span><span class="ident" id="4059800">i</span><span class="op" id="4059801">+</span><span class="num" id="4059802">0</span><span class="op" id="4059803">]</span>&nbsp;<span class="op" id="4059805">=</span>&nbsp;<span class="builtintype" id="4059807">uint8</span><span class="op" id="4059812">(</span><span class="ident" id="4059813">c1</span><span class="op" id="4059815">.</span><span class="ident" id="4059816">R</span>&nbsp;<span class="op" id="4059818">&gt;&gt;</span>&nbsp;<span class="num" id="4059821">8</span><span class="op" id="4059822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4059825">p</span><span class="op" id="4059826">.</span><span class="ident" id="4059827">Pix</span><span class="op" id="4059830">[</span><span class="ident" id="4059831">i</span><span class="op" id="4059832">+</span><span class="num" id="4059833">1</span><span class="op" id="4059834">]</span>&nbsp;<span class="op" id="4059836">=</span>&nbsp;<span class="builtintype" id="4059838">uint8</span><span class="op" id="4059843">(</span><span class="ident" id="4059844">c1</span><span class="op" id="4059846">.</span><span class="ident" id="4059847">R</span><span class="op" id="4059848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4059851">p</span><span class="op" id="4059852">.</span><span class="ident" id="4059853">Pix</span><span class="op" id="4059856">[</span><span class="ident" id="4059857">i</span><span class="op" id="4059858">+</span><span class="num" id="4059859">2</span><span class="op" id="4059860">]</span>&nbsp;<span class="op" id="4059862">=</span>&nbsp;<span class="builtintype" id="4059864">uint8</span><span class="op" id="4059869">(</span><span class="ident" id="4059870">c1</span><span class="op" id="4059872">.</span><span class="ident" id="4059873">G</span>&nbsp;<span class="op" id="4059875">&gt;&gt;</span>&nbsp;<span class="num" id="4059878">8</span><span class="op" id="4059879">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4059882">p</span><span class="op" id="4059883">.</span><span class="ident" id="4059884">Pix</span><span class="op" id="4059887">[</span><span class="ident" id="4059888">i</span><span class="op" id="4059889">+</span><span class="num" id="4059890">3</span><span class="op" id="4059891">]</span>&nbsp;<span class="op" id="4059893">=</span>&nbsp;<span class="builtintype" id="4059895">uint8</span><span class="op" id="4059900">(</span><span class="ident" id="4059901">c1</span><span class="op" id="4059903">.</span><span class="ident" id="4059904">G</span><span class="op" id="4059905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4059908">p</span><span class="op" id="4059909">.</span><span class="ident" id="4059910">Pix</span><span class="op" id="4059913">[</span><span class="ident" id="4059914">i</span><span class="op" id="4059915">+</span><span class="num" id="4059916">4</span><span class="op" id="4059917">]</span>&nbsp;<span class="op" id="4059919">=</span>&nbsp;<span class="builtintype" id="4059921">uint8</span><span class="op" id="4059926">(</span><span class="ident" id="4059927">c1</span><span class="op" id="4059929">.</span><span class="ident" id="4059930">B</span>&nbsp;<span class="op" id="4059932">&gt;&gt;</span>&nbsp;<span class="num" id="4059935">8</span><span class="op" id="4059936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4059939">p</span><span class="op" id="4059940">.</span><span class="ident" id="4059941">Pix</span><span class="op" id="4059944">[</span><span class="ident" id="4059945">i</span><span class="op" id="4059946">+</span><span class="num" id="4059947">5</span><span class="op" id="4059948">]</span>&nbsp;<span class="op" id="4059950">=</span>&nbsp;<span class="builtintype" id="4059952">uint8</span><span class="op" id="4059957">(</span><span class="ident" id="4059958">c1</span><span class="op" id="4059960">.</span><span class="ident" id="4059961">B</span><span class="op" id="4059962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4059965">p</span><span class="op" id="4059966">.</span><span class="ident" id="4059967">Pix</span><span class="op" id="4059970">[</span><span class="ident" id="4059971">i</span><span class="op" id="4059972">+</span><span class="num" id="4059973">6</span><span class="op" id="4059974">]</span>&nbsp;<span class="op" id="4059976">=</span>&nbsp;<span class="builtintype" id="4059978">uint8</span><span class="op" id="4059983">(</span><span class="ident" id="4059984">c1</span><span class="op" id="4059986">.</span><span class="ident" id="4059987">A</span>&nbsp;<span class="op" id="4059989">&gt;&gt;</span>&nbsp;<span class="num" id="4059992">8</span><span class="op" id="4059993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4059996">p</span><span class="op" id="4059997">.</span><span class="ident" id="4059998">Pix</span><span class="op" id="4060001">[</span><span class="ident" id="4060002">i</span><span class="op" id="4060003">+</span><span class="num" id="4060004">7</span><span class="op" id="4060005">]</span>&nbsp;<span class="op" id="4060007">=</span>&nbsp;<span class="builtintype" id="4060009">uint8</span><span class="op" id="4060014">(</span><span class="ident" id="4060015">c1</span><span class="op" id="4060017">.</span><span class="ident" id="4060018">A</span><span class="op" id="4060019">)</span><br>
<span class="lineno">210</span><span class="op" id="4060021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4060024">func</span>&nbsp;<span class="op" id="4060029">(</span><span class="ident" id="4060030">p</span>&nbsp;<span class="op" id="4060032">*</span><span class="ident" id="4060033">RGBA64</span><span class="op" id="4060039">)</span>&nbsp;<span class="ident" id="4060041">SetRGBA64</span><span class="op" id="4060050">(</span><span class="ident" id="4060051">x</span><span class="op" id="4060052">,</span>&nbsp;<span class="ident" id="4060054">y</span>&nbsp;<span class="builtintype" id="4060056">int</span><span class="op" id="4060059">,</span>&nbsp;<span class="ident" id="4060061">c</span>&nbsp;<span class="ident" id="4060063">color</span><span class="op" id="4060068">.</span><span class="ident" id="4060069">RGBA64</span><span class="op" id="4060075">)</span>&nbsp;<span class="op" id="4060077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060080">if</span>&nbsp;<span class="op" id="4060083">!</span><span class="op" id="4060084">(</span><span class="ident" id="4060085">Point</span><span class="op" id="4060090">{</span><span class="ident" id="4060091">x</span><span class="op" id="4060092">,</span>&nbsp;<span class="ident" id="4060094">y</span><span class="op" id="4060095">}</span><span class="op" id="4060096">.</span><span class="ident" id="4060097">In</span><span class="op" id="4060099">(</span><span class="ident" id="4060100">p</span><span class="op" id="4060101">.</span><span class="ident" id="4060102">Rect</span><span class="op" id="4060106">)</span><span class="op" id="4060107">)</span>&nbsp;<span class="op" id="4060109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060113">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4060121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060124">i</span>&nbsp;<span class="op" id="4060126">:=</span>&nbsp;<span class="ident" id="4060129">p</span><span class="op" id="4060130">.</span><span class="ident" id="4060131">PixOffset</span><span class="op" id="4060140">(</span><span class="ident" id="4060141">x</span><span class="op" id="4060142">,</span>&nbsp;<span class="ident" id="4060144">y</span><span class="op" id="4060145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060148">p</span><span class="op" id="4060149">.</span><span class="ident" id="4060150">Pix</span><span class="op" id="4060153">[</span><span class="ident" id="4060154">i</span><span class="op" id="4060155">+</span><span class="num" id="4060156">0</span><span class="op" id="4060157">]</span>&nbsp;<span class="op" id="4060159">=</span>&nbsp;<span class="builtintype" id="4060161">uint8</span><span class="op" id="4060166">(</span><span class="ident" id="4060167">c</span><span class="op" id="4060168">.</span><span class="ident" id="4060169">R</span>&nbsp;<span class="op" id="4060171">&gt;&gt;</span>&nbsp;<span class="num" id="4060174">8</span><span class="op" id="4060175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060178">p</span><span class="op" id="4060179">.</span><span class="ident" id="4060180">Pix</span><span class="op" id="4060183">[</span><span class="ident" id="4060184">i</span><span class="op" id="4060185">+</span><span class="num" id="4060186">1</span><span class="op" id="4060187">]</span>&nbsp;<span class="op" id="4060189">=</span>&nbsp;<span class="builtintype" id="4060191">uint8</span><span class="op" id="4060196">(</span><span class="ident" id="4060197">c</span><span class="op" id="4060198">.</span><span class="ident" id="4060199">R</span><span class="op" id="4060200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060203">p</span><span class="op" id="4060204">.</span><span class="ident" id="4060205">Pix</span><span class="op" id="4060208">[</span><span class="ident" id="4060209">i</span><span class="op" id="4060210">+</span><span class="num" id="4060211">2</span><span class="op" id="4060212">]</span>&nbsp;<span class="op" id="4060214">=</span>&nbsp;<span class="builtintype" id="4060216">uint8</span><span class="op" id="4060221">(</span><span class="ident" id="4060222">c</span><span class="op" id="4060223">.</span><span class="ident" id="4060224">G</span>&nbsp;<span class="op" id="4060226">&gt;&gt;</span>&nbsp;<span class="num" id="4060229">8</span><span class="op" id="4060230">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060233">p</span><span class="op" id="4060234">.</span><span class="ident" id="4060235">Pix</span><span class="op" id="4060238">[</span><span class="ident" id="4060239">i</span><span class="op" id="4060240">+</span><span class="num" id="4060241">3</span><span class="op" id="4060242">]</span>&nbsp;<span class="op" id="4060244">=</span>&nbsp;<span class="builtintype" id="4060246">uint8</span><span class="op" id="4060251">(</span><span class="ident" id="4060252">c</span><span class="op" id="4060253">.</span><span class="ident" id="4060254">G</span><span class="op" id="4060255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060258">p</span><span class="op" id="4060259">.</span><span class="ident" id="4060260">Pix</span><span class="op" id="4060263">[</span><span class="ident" id="4060264">i</span><span class="op" id="4060265">+</span><span class="num" id="4060266">4</span><span class="op" id="4060267">]</span>&nbsp;<span class="op" id="4060269">=</span>&nbsp;<span class="builtintype" id="4060271">uint8</span><span class="op" id="4060276">(</span><span class="ident" id="4060277">c</span><span class="op" id="4060278">.</span><span class="ident" id="4060279">B</span>&nbsp;<span class="op" id="4060281">&gt;&gt;</span>&nbsp;<span class="num" id="4060284">8</span><span class="op" id="4060285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060288">p</span><span class="op" id="4060289">.</span><span class="ident" id="4060290">Pix</span><span class="op" id="4060293">[</span><span class="ident" id="4060294">i</span><span class="op" id="4060295">+</span><span class="num" id="4060296">5</span><span class="op" id="4060297">]</span>&nbsp;<span class="op" id="4060299">=</span>&nbsp;<span class="builtintype" id="4060301">uint8</span><span class="op" id="4060306">(</span><span class="ident" id="4060307">c</span><span class="op" id="4060308">.</span><span class="ident" id="4060309">B</span><span class="op" id="4060310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060313">p</span><span class="op" id="4060314">.</span><span class="ident" id="4060315">Pix</span><span class="op" id="4060318">[</span><span class="ident" id="4060319">i</span><span class="op" id="4060320">+</span><span class="num" id="4060321">6</span><span class="op" id="4060322">]</span>&nbsp;<span class="op" id="4060324">=</span>&nbsp;<span class="builtintype" id="4060326">uint8</span><span class="op" id="4060331">(</span><span class="ident" id="4060332">c</span><span class="op" id="4060333">.</span><span class="ident" id="4060334">A</span>&nbsp;<span class="op" id="4060336">&gt;&gt;</span>&nbsp;<span class="num" id="4060339">8</span><span class="op" id="4060340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060343">p</span><span class="op" id="4060344">.</span><span class="ident" id="4060345">Pix</span><span class="op" id="4060348">[</span><span class="ident" id="4060349">i</span><span class="op" id="4060350">+</span><span class="num" id="4060351">7</span><span class="op" id="4060352">]</span>&nbsp;<span class="op" id="4060354">=</span>&nbsp;<span class="builtintype" id="4060356">uint8</span><span class="op" id="4060361">(</span><span class="ident" id="4060362">c</span><span class="op" id="4060363">.</span><span class="ident" id="4060364">A</span><span class="op" id="4060365">)</span><br>
<span class="lineno">225</span><span class="op" id="4060367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4060370">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4060447">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4060519">func</span>&nbsp;<span class="op" id="4060524">(</span><span class="ident" id="4060525">p</span>&nbsp;<span class="op" id="4060527">*</span><span class="ident" id="4060528">RGBA64</span><span class="op" id="4060534">)</span>&nbsp;<span class="ident" id="4060536">SubImage</span><span class="op" id="4060544">(</span><span class="ident" id="4060545">r</span>&nbsp;<span class="ident" id="4060547">Rectangle</span><span class="op" id="4060556">)</span>&nbsp;<span class="ident" id="4060558">Image</span>&nbsp;<span class="op" id="4060564">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060567">r</span>&nbsp;<span class="op" id="4060569">=</span>&nbsp;<span class="ident" id="4060571">r</span><span class="op" id="4060572">.</span><span class="ident" id="4060573">Intersect</span><span class="op" id="4060582">(</span><span class="ident" id="4060583">p</span><span class="op" id="4060584">.</span><span class="ident" id="4060585">Rect</span><span class="op" id="4060589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4060592">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4060673">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4060755">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060805">if</span>&nbsp;<span class="ident" id="4060808">r</span><span class="op" id="4060809">.</span><span class="ident" id="4060810">Empty</span><span class="op" id="4060815">(</span><span class="op" id="4060816">)</span>&nbsp;<span class="op" id="4060818">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060822">return</span>&nbsp;<span class="op" id="4060829">&amp;</span><span class="ident" id="4060830">RGBA64</span><span class="op" id="4060836">{</span><span class="op" id="4060837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4060840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060843">i</span>&nbsp;<span class="op" id="4060845">:=</span>&nbsp;<span class="ident" id="4060848">p</span><span class="op" id="4060849">.</span><span class="ident" id="4060850">PixOffset</span><span class="op" id="4060859">(</span><span class="ident" id="4060860">r</span><span class="op" id="4060861">.</span><span class="ident" id="4060862">Min</span><span class="op" id="4060865">.</span><span class="ident" id="4060866">X</span><span class="op" id="4060867">,</span>&nbsp;<span class="ident" id="4060869">r</span><span class="op" id="4060870">.</span><span class="ident" id="4060871">Min</span><span class="op" id="4060874">.</span><span class="ident" id="4060875">Y</span><span class="op" id="4060876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4060879">return</span>&nbsp;<span class="op" id="4060886">&amp;</span><span class="ident" id="4060887">RGBA64</span><span class="op" id="4060893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060897">Pix</span><span class="op" id="4060900">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4060905">p</span><span class="op" id="4060906">.</span><span class="ident" id="4060907">Pix</span><span class="op" id="4060910">[</span><span class="ident" id="4060911">i</span><span class="op" id="4060912">:</span><span class="op" id="4060913">]</span><span class="op" id="4060914">,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060918">Stride</span><span class="op" id="4060924">:</span>&nbsp;<span class="ident" id="4060926">p</span><span class="op" id="4060927">.</span><span class="ident" id="4060928">Stride</span><span class="op" id="4060934">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4060938">Rect</span><span class="op" id="4060942">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4060946">r</span><span class="op" id="4060947">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4060950">}</span><br>
<span class="lineno"></span><span class="op" id="4060952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="4060955">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4061028">func</span>&nbsp;<span class="op" id="4061033">(</span><span class="ident" id="4061034">p</span>&nbsp;<span class="op" id="4061036">*</span><span class="ident" id="4061037">RGBA64</span><span class="op" id="4061043">)</span>&nbsp;<span class="ident" id="4061045">Opaque</span><span class="op" id="4061051">(</span><span class="op" id="4061052">)</span>&nbsp;<span class="builtintype" id="4061054">bool</span>&nbsp;<span class="op" id="4061059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061062">if</span>&nbsp;<span class="ident" id="4061065">p</span><span class="op" id="4061066">.</span><span class="ident" id="4061067">Rect</span><span class="op" id="4061071">.</span><span class="ident" id="4061072">Empty</span><span class="op" id="4061077">(</span><span class="op" id="4061078">)</span>&nbsp;<span class="op" id="4061080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061084">return</span>&nbsp;<span class="builtintype" id="4061091">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4061097">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061100">i0</span><span class="op" id="4061102">,</span>&nbsp;<span class="ident" id="4061104">i1</span>&nbsp;<span class="op" id="4061107">:=</span>&nbsp;<span class="num" id="4061110">6</span><span class="op" id="4061111">,</span>&nbsp;<span class="ident" id="4061113">p</span><span class="op" id="4061114">.</span><span class="ident" id="4061115">Rect</span><span class="op" id="4061119">.</span><span class="ident" id="4061120">Dx</span><span class="op" id="4061122">(</span><span class="op" id="4061123">)</span><span class="op" id="4061124">*</span><span class="num" id="4061125">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061128">for</span>&nbsp;<span class="ident" id="4061132">y</span>&nbsp;<span class="op" id="4061134">:=</span>&nbsp;<span class="ident" id="4061137">p</span><span class="op" id="4061138">.</span><span class="ident" id="4061139">Rect</span><span class="op" id="4061143">.</span><span class="ident" id="4061144">Min</span><span class="op" id="4061147">.</span><span class="ident" id="4061148">Y</span><span class="op" id="4061149">;</span>&nbsp;<span class="ident" id="4061151">y</span>&nbsp;<span class="op" id="4061153">&lt;</span>&nbsp;<span class="ident" id="4061155">p</span><span class="op" id="4061156">.</span><span class="ident" id="4061157">Rect</span><span class="op" id="4061161">.</span><span class="ident" id="4061162">Max</span><span class="op" id="4061165">.</span><span class="ident" id="4061166">Y</span><span class="op" id="4061167">;</span>&nbsp;<span class="ident" id="4061169">y</span><span class="op" id="4061170">++</span>&nbsp;<span class="op" id="4061173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061177">for</span>&nbsp;<span class="ident" id="4061181">i</span>&nbsp;<span class="op" id="4061183">:=</span>&nbsp;<span class="ident" id="4061186">i0</span><span class="op" id="4061188">;</span>&nbsp;<span class="ident" id="4061190">i</span>&nbsp;<span class="op" id="4061192">&lt;</span>&nbsp;<span class="ident" id="4061194">i1</span><span class="op" id="4061196">;</span>&nbsp;<span class="ident" id="4061198">i</span>&nbsp;<span class="op" id="4061200">+=</span>&nbsp;<span class="num" id="4061203">8</span>&nbsp;<span class="op" id="4061205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061210">if</span>&nbsp;<span class="ident" id="4061213">p</span><span class="op" id="4061214">.</span><span class="ident" id="4061215">Pix</span><span class="op" id="4061218">[</span><span class="ident" id="4061219">i</span><span class="op" id="4061220">+</span><span class="num" id="4061221">0</span><span class="op" id="4061222">]</span>&nbsp;<span class="op" id="4061224">!=</span>&nbsp;<span class="num" id="4061227">0xff</span>&nbsp;<span class="op" id="4061232">||</span>&nbsp;<span class="ident" id="4061235">p</span><span class="op" id="4061236">.</span><span class="ident" id="4061237">Pix</span><span class="op" id="4061240">[</span><span class="ident" id="4061241">i</span><span class="op" id="4061242">+</span><span class="num" id="4061243">1</span><span class="op" id="4061244">]</span>&nbsp;<span class="op" id="4061246">!=</span>&nbsp;<span class="num" id="4061249">0xff</span>&nbsp;<span class="op" id="4061254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061260">return</span>&nbsp;<span class="builtintype" id="4061267">false</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4061276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4061280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061284">i0</span>&nbsp;<span class="op" id="4061287">+=</span>&nbsp;<span class="ident" id="4061290">p</span><span class="op" id="4061291">.</span><span class="ident" id="4061292">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061301">i1</span>&nbsp;<span class="op" id="4061304">+=</span>&nbsp;<span class="ident" id="4061307">p</span><span class="op" id="4061308">.</span><span class="ident" id="4061309">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4061317">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061320">return</span>&nbsp;<span class="builtintype" id="4061327">true</span><br>
<span class="lineno"></span><span class="op" id="4061332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4061335">//&nbsp;NewRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4061392">func</span>&nbsp;<span class="ident" id="4061397">NewRGBA64</span><span class="op" id="4061406">(</span><span class="ident" id="4061407">r</span>&nbsp;<span class="ident" id="4061409">Rectangle</span><span class="op" id="4061418">)</span>&nbsp;<span class="op" id="4061420">*</span><span class="ident" id="4061421">RGBA64</span>&nbsp;<span class="op" id="4061428">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061431">w</span><span class="op" id="4061432">,</span>&nbsp;<span class="ident" id="4061434">h</span>&nbsp;<span class="op" id="4061436">:=</span>&nbsp;<span class="ident" id="4061439">r</span><span class="op" id="4061440">.</span><span class="ident" id="4061441">Dx</span><span class="op" id="4061443">(</span><span class="op" id="4061444">)</span><span class="op" id="4061445">,</span>&nbsp;<span class="ident" id="4061447">r</span><span class="op" id="4061448">.</span><span class="ident" id="4061449">Dy</span><span class="op" id="4061451">(</span><span class="op" id="4061452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061455">pix</span>&nbsp;<span class="op" id="4061459">:=</span>&nbsp;<span class="builtinfunc" id="4061462">make</span><span class="op" id="4061466">(</span><span class="op" id="4061467">[</span><span class="op" id="4061468">]</span><span class="builtintype" id="4061469">uint8</span><span class="op" id="4061474">,</span>&nbsp;<span class="num" id="4061476">8</span><span class="op" id="4061477">*</span><span class="ident" id="4061478">w</span><span class="op" id="4061479">*</span><span class="ident" id="4061480">h</span><span class="op" id="4061481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061484">return</span>&nbsp;<span class="op" id="4061491">&amp;</span><span class="ident" id="4061492">RGBA64</span><span class="op" id="4061498">{</span><span class="ident" id="4061499">pix</span><span class="op" id="4061502">,</span>&nbsp;<span class="num" id="4061504">8</span>&nbsp;<span class="op" id="4061506">*</span>&nbsp;<span class="ident" id="4061508">w</span><span class="op" id="4061509">,</span>&nbsp;<span class="ident" id="4061511">r</span><span class="op" id="4061512">}</span><br>
<span class="lineno"></span><span class="op" id="4061514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="4061517">//&nbsp;NRGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4061592">type</span>&nbsp;<span class="ident" id="4061597">NRGBA</span>&nbsp;<span class="keyword" id="4061603">struct</span>&nbsp;<span class="op" id="4061610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061613">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061681">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061749">Pix</span>&nbsp;<span class="op" id="4061753">[</span><span class="op" id="4061754">]</span><span class="builtintype" id="4061755">uint8</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061762">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061838">Stride</span>&nbsp;<span class="builtintype" id="4061845">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4061850">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061882">Rect</span>&nbsp;<span class="ident" id="4061887">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4061897">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="4061900">func</span>&nbsp;<span class="op" id="4061905">(</span><span class="ident" id="4061906">p</span>&nbsp;<span class="op" id="4061908">*</span><span class="ident" id="4061909">NRGBA</span><span class="op" id="4061914">)</span>&nbsp;<span class="ident" id="4061916">ColorModel</span><span class="op" id="4061926">(</span><span class="op" id="4061927">)</span>&nbsp;<span class="ident" id="4061929">color</span><span class="op" id="4061934">.</span><span class="ident" id="4061935">Model</span>&nbsp;<span class="op" id="4061941">{</span>&nbsp;<span class="keyword" id="4061943">return</span>&nbsp;<span class="ident" id="4061950">color</span><span class="op" id="4061955">.</span><span class="ident" id="4061956">NRGBAModel</span>&nbsp;<span class="op" id="4061967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4061970">func</span>&nbsp;<span class="op" id="4061975">(</span><span class="ident" id="4061976">p</span>&nbsp;<span class="op" id="4061978">*</span><span class="ident" id="4061979">NRGBA</span><span class="op" id="4061984">)</span>&nbsp;<span class="ident" id="4061986">Bounds</span><span class="op" id="4061992">(</span><span class="op" id="4061993">)</span>&nbsp;<span class="ident" id="4061995">Rectangle</span>&nbsp;<span class="op" id="4062005">{</span>&nbsp;<span class="keyword" id="4062007">return</span>&nbsp;<span class="ident" id="4062014">p</span><span class="op" id="4062015">.</span><span class="ident" id="4062016">Rect</span>&nbsp;<span class="op" id="4062021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="4062024">func</span>&nbsp;<span class="op" id="4062029">(</span><span class="ident" id="4062030">p</span>&nbsp;<span class="op" id="4062032">*</span><span class="ident" id="4062033">NRGBA</span><span class="op" id="4062038">)</span>&nbsp;<span class="ident" id="4062040">At</span><span class="op" id="4062042">(</span><span class="ident" id="4062043">x</span><span class="op" id="4062044">,</span>&nbsp;<span class="ident" id="4062046">y</span>&nbsp;<span class="builtintype" id="4062048">int</span><span class="op" id="4062051">)</span>&nbsp;<span class="ident" id="4062053">color</span><span class="op" id="4062058">.</span><span class="ident" id="4062059">Color</span>&nbsp;<span class="op" id="4062065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062068">return</span>&nbsp;<span class="ident" id="4062075">p</span><span class="op" id="4062076">.</span><span class="ident" id="4062077">NRGBAAt</span><span class="op" id="4062084">(</span><span class="ident" id="4062085">x</span><span class="op" id="4062086">,</span>&nbsp;<span class="ident" id="4062088">y</span><span class="op" id="4062089">)</span><br>
<span class="lineno"></span><span class="op" id="4062091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4062094">func</span>&nbsp;<span class="op" id="4062099">(</span><span class="ident" id="4062100">p</span>&nbsp;<span class="op" id="4062102">*</span><span class="ident" id="4062103">NRGBA</span><span class="op" id="4062108">)</span>&nbsp;<span class="ident" id="4062110">NRGBAAt</span><span class="op" id="4062117">(</span><span class="ident" id="4062118">x</span><span class="op" id="4062119">,</span>&nbsp;<span class="ident" id="4062121">y</span>&nbsp;<span class="builtintype" id="4062123">int</span><span class="op" id="4062126">)</span>&nbsp;<span class="ident" id="4062128">color</span><span class="op" id="4062133">.</span><span class="ident" id="4062134">NRGBA</span>&nbsp;<span class="op" id="4062140">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062143">if</span>&nbsp;<span class="op" id="4062146">!</span><span class="op" id="4062147">(</span><span class="ident" id="4062148">Point</span><span class="op" id="4062153">{</span><span class="ident" id="4062154">x</span><span class="op" id="4062155">,</span>&nbsp;<span class="ident" id="4062157">y</span><span class="op" id="4062158">}</span><span class="op" id="4062159">.</span><span class="ident" id="4062160">In</span><span class="op" id="4062162">(</span><span class="ident" id="4062163">p</span><span class="op" id="4062164">.</span><span class="ident" id="4062165">Rect</span><span class="op" id="4062169">)</span><span class="op" id="4062170">)</span>&nbsp;<span class="op" id="4062172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062176">return</span>&nbsp;<span class="ident" id="4062183">color</span><span class="op" id="4062188">.</span><span class="ident" id="4062189">NRGBA</span><span class="op" id="4062194">{</span><span class="op" id="4062195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4062198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062201">i</span>&nbsp;<span class="op" id="4062203">:=</span>&nbsp;<span class="ident" id="4062206">p</span><span class="op" id="4062207">.</span><span class="ident" id="4062208">PixOffset</span><span class="op" id="4062217">(</span><span class="ident" id="4062218">x</span><span class="op" id="4062219">,</span>&nbsp;<span class="ident" id="4062221">y</span><span class="op" id="4062222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062225">return</span>&nbsp;<span class="ident" id="4062232">color</span><span class="op" id="4062237">.</span><span class="ident" id="4062238">NRGBA</span><span class="op" id="4062243">{</span><span class="ident" id="4062244">p</span><span class="op" id="4062245">.</span><span class="ident" id="4062246">Pix</span><span class="op" id="4062249">[</span><span class="ident" id="4062250">i</span><span class="op" id="4062251">+</span><span class="num" id="4062252">0</span><span class="op" id="4062253">]</span><span class="op" id="4062254">,</span>&nbsp;<span class="ident" id="4062256">p</span><span class="op" id="4062257">.</span><span class="ident" id="4062258">Pix</span><span class="op" id="4062261">[</span><span class="ident" id="4062262">i</span><span class="op" id="4062263">+</span><span class="num" id="4062264">1</span><span class="op" id="4062265">]</span><span class="op" id="4062266">,</span>&nbsp;<span class="ident" id="4062268">p</span><span class="op" id="4062269">.</span><span class="ident" id="4062270">Pix</span><span class="op" id="4062273">[</span><span class="ident" id="4062274">i</span><span class="op" id="4062275">+</span><span class="num" id="4062276">2</span><span class="op" id="4062277">]</span><span class="op" id="4062278">,</span>&nbsp;<span class="ident" id="4062280">p</span><span class="op" id="4062281">.</span><span class="ident" id="4062282">Pix</span><span class="op" id="4062285">[</span><span class="ident" id="4062286">i</span><span class="op" id="4062287">+</span><span class="num" id="4062288">3</span><span class="op" id="4062289">]</span><span class="op" id="4062290">}</span><br>
<span class="lineno">295</span><span class="op" id="4062292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4062295">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4062374">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4062398">func</span>&nbsp;<span class="op" id="4062403">(</span><span class="ident" id="4062404">p</span>&nbsp;<span class="op" id="4062406">*</span><span class="ident" id="4062407">NRGBA</span><span class="op" id="4062412">)</span>&nbsp;<span class="ident" id="4062414">PixOffset</span><span class="op" id="4062423">(</span><span class="ident" id="4062424">x</span><span class="op" id="4062425">,</span>&nbsp;<span class="ident" id="4062427">y</span>&nbsp;<span class="builtintype" id="4062429">int</span><span class="op" id="4062432">)</span>&nbsp;<span class="builtintype" id="4062434">int</span>&nbsp;<span class="op" id="4062438">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062441">return</span>&nbsp;<span class="op" id="4062448">(</span><span class="ident" id="4062449">y</span><span class="op" id="4062450">-</span><span class="ident" id="4062451">p</span><span class="op" id="4062452">.</span><span class="ident" id="4062453">Rect</span><span class="op" id="4062457">.</span><span class="ident" id="4062458">Min</span><span class="op" id="4062461">.</span><span class="ident" id="4062462">Y</span><span class="op" id="4062463">)</span><span class="op" id="4062464">*</span><span class="ident" id="4062465">p</span><span class="op" id="4062466">.</span><span class="ident" id="4062467">Stride</span>&nbsp;<span class="op" id="4062474">+</span>&nbsp;<span class="op" id="4062476">(</span><span class="ident" id="4062477">x</span><span class="op" id="4062478">-</span><span class="ident" id="4062479">p</span><span class="op" id="4062480">.</span><span class="ident" id="4062481">Rect</span><span class="op" id="4062485">.</span><span class="ident" id="4062486">Min</span><span class="op" id="4062489">.</span><span class="ident" id="4062490">X</span><span class="op" id="4062491">)</span><span class="op" id="4062492">*</span><span class="num" id="4062493">4</span><br>
<span class="lineno"></span><span class="op" id="4062495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4062498">func</span>&nbsp;<span class="op" id="4062503">(</span><span class="ident" id="4062504">p</span>&nbsp;<span class="op" id="4062506">*</span><span class="ident" id="4062507">NRGBA</span><span class="op" id="4062512">)</span>&nbsp;<span class="ident" id="4062514">Set</span><span class="op" id="4062517">(</span><span class="ident" id="4062518">x</span><span class="op" id="4062519">,</span>&nbsp;<span class="ident" id="4062521">y</span>&nbsp;<span class="builtintype" id="4062523">int</span><span class="op" id="4062526">,</span>&nbsp;<span class="ident" id="4062528">c</span>&nbsp;<span class="ident" id="4062530">color</span><span class="op" id="4062535">.</span><span class="ident" id="4062536">Color</span><span class="op" id="4062541">)</span>&nbsp;<span class="op" id="4062543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062546">if</span>&nbsp;<span class="op" id="4062549">!</span><span class="op" id="4062550">(</span><span class="ident" id="4062551">Point</span><span class="op" id="4062556">{</span><span class="ident" id="4062557">x</span><span class="op" id="4062558">,</span>&nbsp;<span class="ident" id="4062560">y</span><span class="op" id="4062561">}</span><span class="op" id="4062562">.</span><span class="ident" id="4062563">In</span><span class="op" id="4062565">(</span><span class="ident" id="4062566">p</span><span class="op" id="4062567">.</span><span class="ident" id="4062568">Rect</span><span class="op" id="4062572">)</span><span class="op" id="4062573">)</span>&nbsp;<span class="op" id="4062575">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062579">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4062587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062590">i</span>&nbsp;<span class="op" id="4062592">:=</span>&nbsp;<span class="ident" id="4062595">p</span><span class="op" id="4062596">.</span><span class="ident" id="4062597">PixOffset</span><span class="op" id="4062606">(</span><span class="ident" id="4062607">x</span><span class="op" id="4062608">,</span>&nbsp;<span class="ident" id="4062610">y</span><span class="op" id="4062611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062614">c1</span>&nbsp;<span class="op" id="4062617">:=</span>&nbsp;<span class="ident" id="4062620">color</span><span class="op" id="4062625">.</span><span class="ident" id="4062626">NRGBAModel</span><span class="op" id="4062636">.</span><span class="ident" id="4062637">Convert</span><span class="op" id="4062644">(</span><span class="ident" id="4062645">c</span><span class="op" id="4062646">)</span><span class="op" id="4062647">.</span><span class="op" id="4062648">(</span><span class="ident" id="4062649">color</span><span class="op" id="4062654">.</span><span class="ident" id="4062655">NRGBA</span><span class="op" id="4062660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062663">p</span><span class="op" id="4062664">.</span><span class="ident" id="4062665">Pix</span><span class="op" id="4062668">[</span><span class="ident" id="4062669">i</span><span class="op" id="4062670">+</span><span class="num" id="4062671">0</span><span class="op" id="4062672">]</span>&nbsp;<span class="op" id="4062674">=</span>&nbsp;<span class="ident" id="4062676">c1</span><span class="op" id="4062678">.</span><span class="ident" id="4062679">R</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062682">p</span><span class="op" id="4062683">.</span><span class="ident" id="4062684">Pix</span><span class="op" id="4062687">[</span><span class="ident" id="4062688">i</span><span class="op" id="4062689">+</span><span class="num" id="4062690">1</span><span class="op" id="4062691">]</span>&nbsp;<span class="op" id="4062693">=</span>&nbsp;<span class="ident" id="4062695">c1</span><span class="op" id="4062697">.</span><span class="ident" id="4062698">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062701">p</span><span class="op" id="4062702">.</span><span class="ident" id="4062703">Pix</span><span class="op" id="4062706">[</span><span class="ident" id="4062707">i</span><span class="op" id="4062708">+</span><span class="num" id="4062709">2</span><span class="op" id="4062710">]</span>&nbsp;<span class="op" id="4062712">=</span>&nbsp;<span class="ident" id="4062714">c1</span><span class="op" id="4062716">.</span><span class="ident" id="4062717">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062720">p</span><span class="op" id="4062721">.</span><span class="ident" id="4062722">Pix</span><span class="op" id="4062725">[</span><span class="ident" id="4062726">i</span><span class="op" id="4062727">+</span><span class="num" id="4062728">3</span><span class="op" id="4062729">]</span>&nbsp;<span class="op" id="4062731">=</span>&nbsp;<span class="ident" id="4062733">c1</span><span class="op" id="4062735">.</span><span class="ident" id="4062736">A</span><br>
<span class="lineno"></span><span class="op" id="4062738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="4062741">func</span>&nbsp;<span class="op" id="4062746">(</span><span class="ident" id="4062747">p</span>&nbsp;<span class="op" id="4062749">*</span><span class="ident" id="4062750">NRGBA</span><span class="op" id="4062755">)</span>&nbsp;<span class="ident" id="4062757">SetNRGBA</span><span class="op" id="4062765">(</span><span class="ident" id="4062766">x</span><span class="op" id="4062767">,</span>&nbsp;<span class="ident" id="4062769">y</span>&nbsp;<span class="builtintype" id="4062771">int</span><span class="op" id="4062774">,</span>&nbsp;<span class="ident" id="4062776">c</span>&nbsp;<span class="ident" id="4062778">color</span><span class="op" id="4062783">.</span><span class="ident" id="4062784">NRGBA</span><span class="op" id="4062789">)</span>&nbsp;<span class="op" id="4062791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062794">if</span>&nbsp;<span class="op" id="4062797">!</span><span class="op" id="4062798">(</span><span class="ident" id="4062799">Point</span><span class="op" id="4062804">{</span><span class="ident" id="4062805">x</span><span class="op" id="4062806">,</span>&nbsp;<span class="ident" id="4062808">y</span><span class="op" id="4062809">}</span><span class="op" id="4062810">.</span><span class="ident" id="4062811">In</span><span class="op" id="4062813">(</span><span class="ident" id="4062814">p</span><span class="op" id="4062815">.</span><span class="ident" id="4062816">Rect</span><span class="op" id="4062820">)</span><span class="op" id="4062821">)</span>&nbsp;<span class="op" id="4062823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062827">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4062835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062838">i</span>&nbsp;<span class="op" id="4062840">:=</span>&nbsp;<span class="ident" id="4062843">p</span><span class="op" id="4062844">.</span><span class="ident" id="4062845">PixOffset</span><span class="op" id="4062854">(</span><span class="ident" id="4062855">x</span><span class="op" id="4062856">,</span>&nbsp;<span class="ident" id="4062858">y</span><span class="op" id="4062859">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062862">p</span><span class="op" id="4062863">.</span><span class="ident" id="4062864">Pix</span><span class="op" id="4062867">[</span><span class="ident" id="4062868">i</span><span class="op" id="4062869">+</span><span class="num" id="4062870">0</span><span class="op" id="4062871">]</span>&nbsp;<span class="op" id="4062873">=</span>&nbsp;<span class="ident" id="4062875">c</span><span class="op" id="4062876">.</span><span class="ident" id="4062877">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062880">p</span><span class="op" id="4062881">.</span><span class="ident" id="4062882">Pix</span><span class="op" id="4062885">[</span><span class="ident" id="4062886">i</span><span class="op" id="4062887">+</span><span class="num" id="4062888">1</span><span class="op" id="4062889">]</span>&nbsp;<span class="op" id="4062891">=</span>&nbsp;<span class="ident" id="4062893">c</span><span class="op" id="4062894">.</span><span class="ident" id="4062895">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062898">p</span><span class="op" id="4062899">.</span><span class="ident" id="4062900">Pix</span><span class="op" id="4062903">[</span><span class="ident" id="4062904">i</span><span class="op" id="4062905">+</span><span class="num" id="4062906">2</span><span class="op" id="4062907">]</span>&nbsp;<span class="op" id="4062909">=</span>&nbsp;<span class="ident" id="4062911">c</span><span class="op" id="4062912">.</span><span class="ident" id="4062913">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062916">p</span><span class="op" id="4062917">.</span><span class="ident" id="4062918">Pix</span><span class="op" id="4062921">[</span><span class="ident" id="4062922">i</span><span class="op" id="4062923">+</span><span class="num" id="4062924">3</span><span class="op" id="4062925">]</span>&nbsp;<span class="op" id="4062927">=</span>&nbsp;<span class="ident" id="4062929">c</span><span class="op" id="4062930">.</span><span class="ident" id="4062931">A</span><br>
<span class="lineno"></span><span class="op" id="4062933">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="4062936">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4063013">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4063085">func</span>&nbsp;<span class="op" id="4063090">(</span><span class="ident" id="4063091">p</span>&nbsp;<span class="op" id="4063093">*</span><span class="ident" id="4063094">NRGBA</span><span class="op" id="4063099">)</span>&nbsp;<span class="ident" id="4063101">SubImage</span><span class="op" id="4063109">(</span><span class="ident" id="4063110">r</span>&nbsp;<span class="ident" id="4063112">Rectangle</span><span class="op" id="4063121">)</span>&nbsp;<span class="ident" id="4063123">Image</span>&nbsp;<span class="op" id="4063129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063132">r</span>&nbsp;<span class="op" id="4063134">=</span>&nbsp;<span class="ident" id="4063136">r</span><span class="op" id="4063137">.</span><span class="ident" id="4063138">Intersect</span><span class="op" id="4063147">(</span><span class="ident" id="4063148">p</span><span class="op" id="4063149">.</span><span class="ident" id="4063150">Rect</span><span class="op" id="4063154">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4063157">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4063238">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4063320">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063370">if</span>&nbsp;<span class="ident" id="4063373">r</span><span class="op" id="4063374">.</span><span class="ident" id="4063375">Empty</span><span class="op" id="4063380">(</span><span class="op" id="4063381">)</span>&nbsp;<span class="op" id="4063383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063387">return</span>&nbsp;<span class="op" id="4063394">&amp;</span><span class="ident" id="4063395">NRGBA</span><span class="op" id="4063400">{</span><span class="op" id="4063401">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4063404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063407">i</span>&nbsp;<span class="op" id="4063409">:=</span>&nbsp;<span class="ident" id="4063412">p</span><span class="op" id="4063413">.</span><span class="ident" id="4063414">PixOffset</span><span class="op" id="4063423">(</span><span class="ident" id="4063424">r</span><span class="op" id="4063425">.</span><span class="ident" id="4063426">Min</span><span class="op" id="4063429">.</span><span class="ident" id="4063430">X</span><span class="op" id="4063431">,</span>&nbsp;<span class="ident" id="4063433">r</span><span class="op" id="4063434">.</span><span class="ident" id="4063435">Min</span><span class="op" id="4063438">.</span><span class="ident" id="4063439">Y</span><span class="op" id="4063440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063443">return</span>&nbsp;<span class="op" id="4063450">&amp;</span><span class="ident" id="4063451">NRGBA</span><span class="op" id="4063456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063460">Pix</span><span class="op" id="4063463">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4063468">p</span><span class="op" id="4063469">.</span><span class="ident" id="4063470">Pix</span><span class="op" id="4063473">[</span><span class="ident" id="4063474">i</span><span class="op" id="4063475">:</span><span class="op" id="4063476">]</span><span class="op" id="4063477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063481">Stride</span><span class="op" id="4063487">:</span>&nbsp;<span class="ident" id="4063489">p</span><span class="op" id="4063490">.</span><span class="ident" id="4063491">Stride</span><span class="op" id="4063497">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063501">Rect</span><span class="op" id="4063505">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4063509">r</span><span class="op" id="4063510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4063513">}</span><br>
<span class="lineno"></span><span class="op" id="4063515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4063518">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno">345</span><span class="keyword" id="4063591">func</span>&nbsp;<span class="op" id="4063596">(</span><span class="ident" id="4063597">p</span>&nbsp;<span class="op" id="4063599">*</span><span class="ident" id="4063600">NRGBA</span><span class="op" id="4063605">)</span>&nbsp;<span class="ident" id="4063607">Opaque</span><span class="op" id="4063613">(</span><span class="op" id="4063614">)</span>&nbsp;<span class="builtintype" id="4063616">bool</span>&nbsp;<span class="op" id="4063621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063624">if</span>&nbsp;<span class="ident" id="4063627">p</span><span class="op" id="4063628">.</span><span class="ident" id="4063629">Rect</span><span class="op" id="4063633">.</span><span class="ident" id="4063634">Empty</span><span class="op" id="4063639">(</span><span class="op" id="4063640">)</span>&nbsp;<span class="op" id="4063642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063646">return</span>&nbsp;<span class="builtintype" id="4063653">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4063659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063662">i0</span><span class="op" id="4063664">,</span>&nbsp;<span class="ident" id="4063666">i1</span>&nbsp;<span class="op" id="4063669">:=</span>&nbsp;<span class="num" id="4063672">3</span><span class="op" id="4063673">,</span>&nbsp;<span class="ident" id="4063675">p</span><span class="op" id="4063676">.</span><span class="ident" id="4063677">Rect</span><span class="op" id="4063681">.</span><span class="ident" id="4063682">Dx</span><span class="op" id="4063684">(</span><span class="op" id="4063685">)</span><span class="op" id="4063686">*</span><span class="num" id="4063687">4</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063690">for</span>&nbsp;<span class="ident" id="4063694">y</span>&nbsp;<span class="op" id="4063696">:=</span>&nbsp;<span class="ident" id="4063699">p</span><span class="op" id="4063700">.</span><span class="ident" id="4063701">Rect</span><span class="op" id="4063705">.</span><span class="ident" id="4063706">Min</span><span class="op" id="4063709">.</span><span class="ident" id="4063710">Y</span><span class="op" id="4063711">;</span>&nbsp;<span class="ident" id="4063713">y</span>&nbsp;<span class="op" id="4063715">&lt;</span>&nbsp;<span class="ident" id="4063717">p</span><span class="op" id="4063718">.</span><span class="ident" id="4063719">Rect</span><span class="op" id="4063723">.</span><span class="ident" id="4063724">Max</span><span class="op" id="4063727">.</span><span class="ident" id="4063728">Y</span><span class="op" id="4063729">;</span>&nbsp;<span class="ident" id="4063731">y</span><span class="op" id="4063732">++</span>&nbsp;<span class="op" id="4063735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063739">for</span>&nbsp;<span class="ident" id="4063743">i</span>&nbsp;<span class="op" id="4063745">:=</span>&nbsp;<span class="ident" id="4063748">i0</span><span class="op" id="4063750">;</span>&nbsp;<span class="ident" id="4063752">i</span>&nbsp;<span class="op" id="4063754">&lt;</span>&nbsp;<span class="ident" id="4063756">i1</span><span class="op" id="4063758">;</span>&nbsp;<span class="ident" id="4063760">i</span>&nbsp;<span class="op" id="4063762">+=</span>&nbsp;<span class="num" id="4063765">4</span>&nbsp;<span class="op" id="4063767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063772">if</span>&nbsp;<span class="ident" id="4063775">p</span><span class="op" id="4063776">.</span><span class="ident" id="4063777">Pix</span><span class="op" id="4063780">[</span><span class="ident" id="4063781">i</span><span class="op" id="4063782">]</span>&nbsp;<span class="op" id="4063784">!=</span>&nbsp;<span class="num" id="4063787">0xff</span>&nbsp;<span class="op" id="4063792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063798">return</span>&nbsp;<span class="builtintype" id="4063805">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4063814">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4063818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063822">i0</span>&nbsp;<span class="op" id="4063825">+=</span>&nbsp;<span class="ident" id="4063828">p</span><span class="op" id="4063829">.</span><span class="ident" id="4063830">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063839">i1</span>&nbsp;<span class="op" id="4063842">+=</span>&nbsp;<span class="ident" id="4063845">p</span><span class="op" id="4063846">.</span><span class="ident" id="4063847">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4063855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063858">return</span>&nbsp;<span class="builtintype" id="4063865">true</span><br>
<span class="lineno">360</span><span class="op" id="4063870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4063873">//&nbsp;NewNRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4063928">func</span>&nbsp;<span class="ident" id="4063933">NewNRGBA</span><span class="op" id="4063941">(</span><span class="ident" id="4063942">r</span>&nbsp;<span class="ident" id="4063944">Rectangle</span><span class="op" id="4063953">)</span>&nbsp;<span class="op" id="4063955">*</span><span class="ident" id="4063956">NRGBA</span>&nbsp;<span class="op" id="4063962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063965">w</span><span class="op" id="4063966">,</span>&nbsp;<span class="ident" id="4063968">h</span>&nbsp;<span class="op" id="4063970">:=</span>&nbsp;<span class="ident" id="4063973">r</span><span class="op" id="4063974">.</span><span class="ident" id="4063975">Dx</span><span class="op" id="4063977">(</span><span class="op" id="4063978">)</span><span class="op" id="4063979">,</span>&nbsp;<span class="ident" id="4063981">r</span><span class="op" id="4063982">.</span><span class="ident" id="4063983">Dy</span><span class="op" id="4063985">(</span><span class="op" id="4063986">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063989">pix</span>&nbsp;<span class="op" id="4063993">:=</span>&nbsp;<span class="builtinfunc" id="4063996">make</span><span class="op" id="4064000">(</span><span class="op" id="4064001">[</span><span class="op" id="4064002">]</span><span class="builtintype" id="4064003">uint8</span><span class="op" id="4064008">,</span>&nbsp;<span class="num" id="4064010">4</span><span class="op" id="4064011">*</span><span class="ident" id="4064012">w</span><span class="op" id="4064013">*</span><span class="ident" id="4064014">h</span><span class="op" id="4064015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064018">return</span>&nbsp;<span class="op" id="4064025">&amp;</span><span class="ident" id="4064026">NRGBA</span><span class="op" id="4064031">{</span><span class="ident" id="4064032">pix</span><span class="op" id="4064035">,</span>&nbsp;<span class="num" id="4064037">4</span>&nbsp;<span class="op" id="4064039">*</span>&nbsp;<span class="ident" id="4064041">w</span><span class="op" id="4064042">,</span>&nbsp;<span class="ident" id="4064044">r</span><span class="op" id="4064045">}</span><br>
<span class="lineno"></span><span class="op" id="4064047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4064050">//&nbsp;NRGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA64&nbsp;values.</span><br>
<span class="lineno">370</span><span class="keyword" id="4064129">type</span>&nbsp;<span class="ident" id="4064134">NRGBA64</span>&nbsp;<span class="keyword" id="4064142">struct</span>&nbsp;<span class="op" id="4064149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4064152">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4064242">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064310">Pix</span>&nbsp;<span class="op" id="4064314">[</span><span class="op" id="4064315">]</span><span class="builtintype" id="4064316">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4064323">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064399">Stride</span>&nbsp;<span class="builtintype" id="4064406">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4064411">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064443">Rect</span>&nbsp;<span class="ident" id="4064448">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4064458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="4064461">func</span>&nbsp;<span class="op" id="4064466">(</span><span class="ident" id="4064467">p</span>&nbsp;<span class="op" id="4064469">*</span><span class="ident" id="4064470">NRGBA64</span><span class="op" id="4064477">)</span>&nbsp;<span class="ident" id="4064479">ColorModel</span><span class="op" id="4064489">(</span><span class="op" id="4064490">)</span>&nbsp;<span class="ident" id="4064492">color</span><span class="op" id="4064497">.</span><span class="ident" id="4064498">Model</span>&nbsp;<span class="op" id="4064504">{</span>&nbsp;<span class="keyword" id="4064506">return</span>&nbsp;<span class="ident" id="4064513">color</span><span class="op" id="4064518">.</span><span class="ident" id="4064519">NRGBA64Model</span>&nbsp;<span class="op" id="4064532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4064535">func</span>&nbsp;<span class="op" id="4064540">(</span><span class="ident" id="4064541">p</span>&nbsp;<span class="op" id="4064543">*</span><span class="ident" id="4064544">NRGBA64</span><span class="op" id="4064551">)</span>&nbsp;<span class="ident" id="4064553">Bounds</span><span class="op" id="4064559">(</span><span class="op" id="4064560">)</span>&nbsp;<span class="ident" id="4064562">Rectangle</span>&nbsp;<span class="op" id="4064572">{</span>&nbsp;<span class="keyword" id="4064574">return</span>&nbsp;<span class="ident" id="4064581">p</span><span class="op" id="4064582">.</span><span class="ident" id="4064583">Rect</span>&nbsp;<span class="op" id="4064588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4064591">func</span>&nbsp;<span class="op" id="4064596">(</span><span class="ident" id="4064597">p</span>&nbsp;<span class="op" id="4064599">*</span><span class="ident" id="4064600">NRGBA64</span><span class="op" id="4064607">)</span>&nbsp;<span class="ident" id="4064609">At</span><span class="op" id="4064611">(</span><span class="ident" id="4064612">x</span><span class="op" id="4064613">,</span>&nbsp;<span class="ident" id="4064615">y</span>&nbsp;<span class="builtintype" id="4064617">int</span><span class="op" id="4064620">)</span>&nbsp;<span class="ident" id="4064622">color</span><span class="op" id="4064627">.</span><span class="ident" id="4064628">Color</span>&nbsp;<span class="op" id="4064634">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064637">return</span>&nbsp;<span class="ident" id="4064644">p</span><span class="op" id="4064645">.</span><span class="ident" id="4064646">NRGBA64At</span><span class="op" id="4064655">(</span><span class="ident" id="4064656">x</span><span class="op" id="4064657">,</span>&nbsp;<span class="ident" id="4064659">y</span><span class="op" id="4064660">)</span><br>
<span class="lineno"></span><span class="op" id="4064662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4064665">func</span>&nbsp;<span class="op" id="4064670">(</span><span class="ident" id="4064671">p</span>&nbsp;<span class="op" id="4064673">*</span><span class="ident" id="4064674">NRGBA64</span><span class="op" id="4064681">)</span>&nbsp;<span class="ident" id="4064683">NRGBA64At</span><span class="op" id="4064692">(</span><span class="ident" id="4064693">x</span><span class="op" id="4064694">,</span>&nbsp;<span class="ident" id="4064696">y</span>&nbsp;<span class="builtintype" id="4064698">int</span><span class="op" id="4064701">)</span>&nbsp;<span class="ident" id="4064703">color</span><span class="op" id="4064708">.</span><span class="ident" id="4064709">NRGBA64</span>&nbsp;<span class="op" id="4064717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064720">if</span>&nbsp;<span class="op" id="4064723">!</span><span class="op" id="4064724">(</span><span class="ident" id="4064725">Point</span><span class="op" id="4064730">{</span><span class="ident" id="4064731">x</span><span class="op" id="4064732">,</span>&nbsp;<span class="ident" id="4064734">y</span><span class="op" id="4064735">}</span><span class="op" id="4064736">.</span><span class="ident" id="4064737">In</span><span class="op" id="4064739">(</span><span class="ident" id="4064740">p</span><span class="op" id="4064741">.</span><span class="ident" id="4064742">Rect</span><span class="op" id="4064746">)</span><span class="op" id="4064747">)</span>&nbsp;<span class="op" id="4064749">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064753">return</span>&nbsp;<span class="ident" id="4064760">color</span><span class="op" id="4064765">.</span><span class="ident" id="4064766">NRGBA64</span><span class="op" id="4064773">{</span><span class="op" id="4064774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4064777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064780">i</span>&nbsp;<span class="op" id="4064782">:=</span>&nbsp;<span class="ident" id="4064785">p</span><span class="op" id="4064786">.</span><span class="ident" id="4064787">PixOffset</span><span class="op" id="4064796">(</span><span class="ident" id="4064797">x</span><span class="op" id="4064798">,</span>&nbsp;<span class="ident" id="4064800">y</span><span class="op" id="4064801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064804">return</span>&nbsp;<span class="ident" id="4064811">color</span><span class="op" id="4064816">.</span><span class="ident" id="4064817">NRGBA64</span><span class="op" id="4064824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4064828">uint16</span><span class="op" id="4064834">(</span><span class="ident" id="4064835">p</span><span class="op" id="4064836">.</span><span class="ident" id="4064837">Pix</span><span class="op" id="4064840">[</span><span class="ident" id="4064841">i</span><span class="op" id="4064842">+</span><span class="num" id="4064843">0</span><span class="op" id="4064844">]</span><span class="op" id="4064845">)</span><span class="op" id="4064846">&lt;&lt;</span><span class="num" id="4064848">8</span>&nbsp;<span class="op" id="4064850">|</span>&nbsp;<span class="builtintype" id="4064852">uint16</span><span class="op" id="4064858">(</span><span class="ident" id="4064859">p</span><span class="op" id="4064860">.</span><span class="ident" id="4064861">Pix</span><span class="op" id="4064864">[</span><span class="ident" id="4064865">i</span><span class="op" id="4064866">+</span><span class="num" id="4064867">1</span><span class="op" id="4064868">]</span><span class="op" id="4064869">)</span><span class="op" id="4064870">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4064874">uint16</span><span class="op" id="4064880">(</span><span class="ident" id="4064881">p</span><span class="op" id="4064882">.</span><span class="ident" id="4064883">Pix</span><span class="op" id="4064886">[</span><span class="ident" id="4064887">i</span><span class="op" id="4064888">+</span><span class="num" id="4064889">2</span><span class="op" id="4064890">]</span><span class="op" id="4064891">)</span><span class="op" id="4064892">&lt;&lt;</span><span class="num" id="4064894">8</span>&nbsp;<span class="op" id="4064896">|</span>&nbsp;<span class="builtintype" id="4064898">uint16</span><span class="op" id="4064904">(</span><span class="ident" id="4064905">p</span><span class="op" id="4064906">.</span><span class="ident" id="4064907">Pix</span><span class="op" id="4064910">[</span><span class="ident" id="4064911">i</span><span class="op" id="4064912">+</span><span class="num" id="4064913">3</span><span class="op" id="4064914">]</span><span class="op" id="4064915">)</span><span class="op" id="4064916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4064920">uint16</span><span class="op" id="4064926">(</span><span class="ident" id="4064927">p</span><span class="op" id="4064928">.</span><span class="ident" id="4064929">Pix</span><span class="op" id="4064932">[</span><span class="ident" id="4064933">i</span><span class="op" id="4064934">+</span><span class="num" id="4064935">4</span><span class="op" id="4064936">]</span><span class="op" id="4064937">)</span><span class="op" id="4064938">&lt;&lt;</span><span class="num" id="4064940">8</span>&nbsp;<span class="op" id="4064942">|</span>&nbsp;<span class="builtintype" id="4064944">uint16</span><span class="op" id="4064950">(</span><span class="ident" id="4064951">p</span><span class="op" id="4064952">.</span><span class="ident" id="4064953">Pix</span><span class="op" id="4064956">[</span><span class="ident" id="4064957">i</span><span class="op" id="4064958">+</span><span class="num" id="4064959">5</span><span class="op" id="4064960">]</span><span class="op" id="4064961">)</span><span class="op" id="4064962">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4064966">uint16</span><span class="op" id="4064972">(</span><span class="ident" id="4064973">p</span><span class="op" id="4064974">.</span><span class="ident" id="4064975">Pix</span><span class="op" id="4064978">[</span><span class="ident" id="4064979">i</span><span class="op" id="4064980">+</span><span class="num" id="4064981">6</span><span class="op" id="4064982">]</span><span class="op" id="4064983">)</span><span class="op" id="4064984">&lt;&lt;</span><span class="num" id="4064986">8</span>&nbsp;<span class="op" id="4064988">|</span>&nbsp;<span class="builtintype" id="4064990">uint16</span><span class="op" id="4064996">(</span><span class="ident" id="4064997">p</span><span class="op" id="4064998">.</span><span class="ident" id="4064999">Pix</span><span class="op" id="4065002">[</span><span class="ident" id="4065003">i</span><span class="op" id="4065004">+</span><span class="num" id="4065005">7</span><span class="op" id="4065006">]</span><span class="op" id="4065007">)</span><span class="op" id="4065008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065011">}</span><br>
<span class="lineno"></span><span class="op" id="4065013">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="comment" id="4065016">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4065095">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4065119">func</span>&nbsp;<span class="op" id="4065124">(</span><span class="ident" id="4065125">p</span>&nbsp;<span class="op" id="4065127">*</span><span class="ident" id="4065128">NRGBA64</span><span class="op" id="4065135">)</span>&nbsp;<span class="ident" id="4065137">PixOffset</span><span class="op" id="4065146">(</span><span class="ident" id="4065147">x</span><span class="op" id="4065148">,</span>&nbsp;<span class="ident" id="4065150">y</span>&nbsp;<span class="builtintype" id="4065152">int</span><span class="op" id="4065155">)</span>&nbsp;<span class="builtintype" id="4065157">int</span>&nbsp;<span class="op" id="4065161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065164">return</span>&nbsp;<span class="op" id="4065171">(</span><span class="ident" id="4065172">y</span><span class="op" id="4065173">-</span><span class="ident" id="4065174">p</span><span class="op" id="4065175">.</span><span class="ident" id="4065176">Rect</span><span class="op" id="4065180">.</span><span class="ident" id="4065181">Min</span><span class="op" id="4065184">.</span><span class="ident" id="4065185">Y</span><span class="op" id="4065186">)</span><span class="op" id="4065187">*</span><span class="ident" id="4065188">p</span><span class="op" id="4065189">.</span><span class="ident" id="4065190">Stride</span>&nbsp;<span class="op" id="4065197">+</span>&nbsp;<span class="op" id="4065199">(</span><span class="ident" id="4065200">x</span><span class="op" id="4065201">-</span><span class="ident" id="4065202">p</span><span class="op" id="4065203">.</span><span class="ident" id="4065204">Rect</span><span class="op" id="4065208">.</span><span class="ident" id="4065209">Min</span><span class="op" id="4065212">.</span><span class="ident" id="4065213">X</span><span class="op" id="4065214">)</span><span class="op" id="4065215">*</span><span class="num" id="4065216">8</span><br>
<span class="lineno">405</span><span class="op" id="4065218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4065221">func</span>&nbsp;<span class="op" id="4065226">(</span><span class="ident" id="4065227">p</span>&nbsp;<span class="op" id="4065229">*</span><span class="ident" id="4065230">NRGBA64</span><span class="op" id="4065237">)</span>&nbsp;<span class="ident" id="4065239">Set</span><span class="op" id="4065242">(</span><span class="ident" id="4065243">x</span><span class="op" id="4065244">,</span>&nbsp;<span class="ident" id="4065246">y</span>&nbsp;<span class="builtintype" id="4065248">int</span><span class="op" id="4065251">,</span>&nbsp;<span class="ident" id="4065253">c</span>&nbsp;<span class="ident" id="4065255">color</span><span class="op" id="4065260">.</span><span class="ident" id="4065261">Color</span><span class="op" id="4065266">)</span>&nbsp;<span class="op" id="4065268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065271">if</span>&nbsp;<span class="op" id="4065274">!</span><span class="op" id="4065275">(</span><span class="ident" id="4065276">Point</span><span class="op" id="4065281">{</span><span class="ident" id="4065282">x</span><span class="op" id="4065283">,</span>&nbsp;<span class="ident" id="4065285">y</span><span class="op" id="4065286">}</span><span class="op" id="4065287">.</span><span class="ident" id="4065288">In</span><span class="op" id="4065290">(</span><span class="ident" id="4065291">p</span><span class="op" id="4065292">.</span><span class="ident" id="4065293">Rect</span><span class="op" id="4065297">)</span><span class="op" id="4065298">)</span>&nbsp;<span class="op" id="4065300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065304">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065315">i</span>&nbsp;<span class="op" id="4065317">:=</span>&nbsp;<span class="ident" id="4065320">p</span><span class="op" id="4065321">.</span><span class="ident" id="4065322">PixOffset</span><span class="op" id="4065331">(</span><span class="ident" id="4065332">x</span><span class="op" id="4065333">,</span>&nbsp;<span class="ident" id="4065335">y</span><span class="op" id="4065336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065339">c1</span>&nbsp;<span class="op" id="4065342">:=</span>&nbsp;<span class="ident" id="4065345">color</span><span class="op" id="4065350">.</span><span class="ident" id="4065351">NRGBA64Model</span><span class="op" id="4065363">.</span><span class="ident" id="4065364">Convert</span><span class="op" id="4065371">(</span><span class="ident" id="4065372">c</span><span class="op" id="4065373">)</span><span class="op" id="4065374">.</span><span class="op" id="4065375">(</span><span class="ident" id="4065376">color</span><span class="op" id="4065381">.</span><span class="ident" id="4065382">NRGBA64</span><span class="op" id="4065389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065392">p</span><span class="op" id="4065393">.</span><span class="ident" id="4065394">Pix</span><span class="op" id="4065397">[</span><span class="ident" id="4065398">i</span><span class="op" id="4065399">+</span><span class="num" id="4065400">0</span><span class="op" id="4065401">]</span>&nbsp;<span class="op" id="4065403">=</span>&nbsp;<span class="builtintype" id="4065405">uint8</span><span class="op" id="4065410">(</span><span class="ident" id="4065411">c1</span><span class="op" id="4065413">.</span><span class="ident" id="4065414">R</span>&nbsp;<span class="op" id="4065416">&gt;&gt;</span>&nbsp;<span class="num" id="4065419">8</span><span class="op" id="4065420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065423">p</span><span class="op" id="4065424">.</span><span class="ident" id="4065425">Pix</span><span class="op" id="4065428">[</span><span class="ident" id="4065429">i</span><span class="op" id="4065430">+</span><span class="num" id="4065431">1</span><span class="op" id="4065432">]</span>&nbsp;<span class="op" id="4065434">=</span>&nbsp;<span class="builtintype" id="4065436">uint8</span><span class="op" id="4065441">(</span><span class="ident" id="4065442">c1</span><span class="op" id="4065444">.</span><span class="ident" id="4065445">R</span><span class="op" id="4065446">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065449">p</span><span class="op" id="4065450">.</span><span class="ident" id="4065451">Pix</span><span class="op" id="4065454">[</span><span class="ident" id="4065455">i</span><span class="op" id="4065456">+</span><span class="num" id="4065457">2</span><span class="op" id="4065458">]</span>&nbsp;<span class="op" id="4065460">=</span>&nbsp;<span class="builtintype" id="4065462">uint8</span><span class="op" id="4065467">(</span><span class="ident" id="4065468">c1</span><span class="op" id="4065470">.</span><span class="ident" id="4065471">G</span>&nbsp;<span class="op" id="4065473">&gt;&gt;</span>&nbsp;<span class="num" id="4065476">8</span><span class="op" id="4065477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065480">p</span><span class="op" id="4065481">.</span><span class="ident" id="4065482">Pix</span><span class="op" id="4065485">[</span><span class="ident" id="4065486">i</span><span class="op" id="4065487">+</span><span class="num" id="4065488">3</span><span class="op" id="4065489">]</span>&nbsp;<span class="op" id="4065491">=</span>&nbsp;<span class="builtintype" id="4065493">uint8</span><span class="op" id="4065498">(</span><span class="ident" id="4065499">c1</span><span class="op" id="4065501">.</span><span class="ident" id="4065502">G</span><span class="op" id="4065503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065506">p</span><span class="op" id="4065507">.</span><span class="ident" id="4065508">Pix</span><span class="op" id="4065511">[</span><span class="ident" id="4065512">i</span><span class="op" id="4065513">+</span><span class="num" id="4065514">4</span><span class="op" id="4065515">]</span>&nbsp;<span class="op" id="4065517">=</span>&nbsp;<span class="builtintype" id="4065519">uint8</span><span class="op" id="4065524">(</span><span class="ident" id="4065525">c1</span><span class="op" id="4065527">.</span><span class="ident" id="4065528">B</span>&nbsp;<span class="op" id="4065530">&gt;&gt;</span>&nbsp;<span class="num" id="4065533">8</span><span class="op" id="4065534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065537">p</span><span class="op" id="4065538">.</span><span class="ident" id="4065539">Pix</span><span class="op" id="4065542">[</span><span class="ident" id="4065543">i</span><span class="op" id="4065544">+</span><span class="num" id="4065545">5</span><span class="op" id="4065546">]</span>&nbsp;<span class="op" id="4065548">=</span>&nbsp;<span class="builtintype" id="4065550">uint8</span><span class="op" id="4065555">(</span><span class="ident" id="4065556">c1</span><span class="op" id="4065558">.</span><span class="ident" id="4065559">B</span><span class="op" id="4065560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065563">p</span><span class="op" id="4065564">.</span><span class="ident" id="4065565">Pix</span><span class="op" id="4065568">[</span><span class="ident" id="4065569">i</span><span class="op" id="4065570">+</span><span class="num" id="4065571">6</span><span class="op" id="4065572">]</span>&nbsp;<span class="op" id="4065574">=</span>&nbsp;<span class="builtintype" id="4065576">uint8</span><span class="op" id="4065581">(</span><span class="ident" id="4065582">c1</span><span class="op" id="4065584">.</span><span class="ident" id="4065585">A</span>&nbsp;<span class="op" id="4065587">&gt;&gt;</span>&nbsp;<span class="num" id="4065590">8</span><span class="op" id="4065591">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065594">p</span><span class="op" id="4065595">.</span><span class="ident" id="4065596">Pix</span><span class="op" id="4065599">[</span><span class="ident" id="4065600">i</span><span class="op" id="4065601">+</span><span class="num" id="4065602">7</span><span class="op" id="4065603">]</span>&nbsp;<span class="op" id="4065605">=</span>&nbsp;<span class="builtintype" id="4065607">uint8</span><span class="op" id="4065612">(</span><span class="ident" id="4065613">c1</span><span class="op" id="4065615">.</span><span class="ident" id="4065616">A</span><span class="op" id="4065617">)</span><br>
<span class="lineno"></span><span class="op" id="4065619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4065622">func</span>&nbsp;<span class="op" id="4065627">(</span><span class="ident" id="4065628">p</span>&nbsp;<span class="op" id="4065630">*</span><span class="ident" id="4065631">NRGBA64</span><span class="op" id="4065638">)</span>&nbsp;<span class="ident" id="4065640">SetNRGBA64</span><span class="op" id="4065650">(</span><span class="ident" id="4065651">x</span><span class="op" id="4065652">,</span>&nbsp;<span class="ident" id="4065654">y</span>&nbsp;<span class="builtintype" id="4065656">int</span><span class="op" id="4065659">,</span>&nbsp;<span class="ident" id="4065661">c</span>&nbsp;<span class="ident" id="4065663">color</span><span class="op" id="4065668">.</span><span class="ident" id="4065669">NRGBA64</span><span class="op" id="4065676">)</span>&nbsp;<span class="op" id="4065678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065681">if</span>&nbsp;<span class="op" id="4065684">!</span><span class="op" id="4065685">(</span><span class="ident" id="4065686">Point</span><span class="op" id="4065691">{</span><span class="ident" id="4065692">x</span><span class="op" id="4065693">,</span>&nbsp;<span class="ident" id="4065695">y</span><span class="op" id="4065696">}</span><span class="op" id="4065697">.</span><span class="ident" id="4065698">In</span><span class="op" id="4065700">(</span><span class="ident" id="4065701">p</span><span class="op" id="4065702">.</span><span class="ident" id="4065703">Rect</span><span class="op" id="4065707">)</span><span class="op" id="4065708">)</span>&nbsp;<span class="op" id="4065710">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4065714">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4065722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065725">i</span>&nbsp;<span class="op" id="4065727">:=</span>&nbsp;<span class="ident" id="4065730">p</span><span class="op" id="4065731">.</span><span class="ident" id="4065732">PixOffset</span><span class="op" id="4065741">(</span><span class="ident" id="4065742">x</span><span class="op" id="4065743">,</span>&nbsp;<span class="ident" id="4065745">y</span><span class="op" id="4065746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065749">p</span><span class="op" id="4065750">.</span><span class="ident" id="4065751">Pix</span><span class="op" id="4065754">[</span><span class="ident" id="4065755">i</span><span class="op" id="4065756">+</span><span class="num" id="4065757">0</span><span class="op" id="4065758">]</span>&nbsp;<span class="op" id="4065760">=</span>&nbsp;<span class="builtintype" id="4065762">uint8</span><span class="op" id="4065767">(</span><span class="ident" id="4065768">c</span><span class="op" id="4065769">.</span><span class="ident" id="4065770">R</span>&nbsp;<span class="op" id="4065772">&gt;&gt;</span>&nbsp;<span class="num" id="4065775">8</span><span class="op" id="4065776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065779">p</span><span class="op" id="4065780">.</span><span class="ident" id="4065781">Pix</span><span class="op" id="4065784">[</span><span class="ident" id="4065785">i</span><span class="op" id="4065786">+</span><span class="num" id="4065787">1</span><span class="op" id="4065788">]</span>&nbsp;<span class="op" id="4065790">=</span>&nbsp;<span class="builtintype" id="4065792">uint8</span><span class="op" id="4065797">(</span><span class="ident" id="4065798">c</span><span class="op" id="4065799">.</span><span class="ident" id="4065800">R</span><span class="op" id="4065801">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065804">p</span><span class="op" id="4065805">.</span><span class="ident" id="4065806">Pix</span><span class="op" id="4065809">[</span><span class="ident" id="4065810">i</span><span class="op" id="4065811">+</span><span class="num" id="4065812">2</span><span class="op" id="4065813">]</span>&nbsp;<span class="op" id="4065815">=</span>&nbsp;<span class="builtintype" id="4065817">uint8</span><span class="op" id="4065822">(</span><span class="ident" id="4065823">c</span><span class="op" id="4065824">.</span><span class="ident" id="4065825">G</span>&nbsp;<span class="op" id="4065827">&gt;&gt;</span>&nbsp;<span class="num" id="4065830">8</span><span class="op" id="4065831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065834">p</span><span class="op" id="4065835">.</span><span class="ident" id="4065836">Pix</span><span class="op" id="4065839">[</span><span class="ident" id="4065840">i</span><span class="op" id="4065841">+</span><span class="num" id="4065842">3</span><span class="op" id="4065843">]</span>&nbsp;<span class="op" id="4065845">=</span>&nbsp;<span class="builtintype" id="4065847">uint8</span><span class="op" id="4065852">(</span><span class="ident" id="4065853">c</span><span class="op" id="4065854">.</span><span class="ident" id="4065855">G</span><span class="op" id="4065856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065859">p</span><span class="op" id="4065860">.</span><span class="ident" id="4065861">Pix</span><span class="op" id="4065864">[</span><span class="ident" id="4065865">i</span><span class="op" id="4065866">+</span><span class="num" id="4065867">4</span><span class="op" id="4065868">]</span>&nbsp;<span class="op" id="4065870">=</span>&nbsp;<span class="builtintype" id="4065872">uint8</span><span class="op" id="4065877">(</span><span class="ident" id="4065878">c</span><span class="op" id="4065879">.</span><span class="ident" id="4065880">B</span>&nbsp;<span class="op" id="4065882">&gt;&gt;</span>&nbsp;<span class="num" id="4065885">8</span><span class="op" id="4065886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065889">p</span><span class="op" id="4065890">.</span><span class="ident" id="4065891">Pix</span><span class="op" id="4065894">[</span><span class="ident" id="4065895">i</span><span class="op" id="4065896">+</span><span class="num" id="4065897">5</span><span class="op" id="4065898">]</span>&nbsp;<span class="op" id="4065900">=</span>&nbsp;<span class="builtintype" id="4065902">uint8</span><span class="op" id="4065907">(</span><span class="ident" id="4065908">c</span><span class="op" id="4065909">.</span><span class="ident" id="4065910">B</span><span class="op" id="4065911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065914">p</span><span class="op" id="4065915">.</span><span class="ident" id="4065916">Pix</span><span class="op" id="4065919">[</span><span class="ident" id="4065920">i</span><span class="op" id="4065921">+</span><span class="num" id="4065922">6</span><span class="op" id="4065923">]</span>&nbsp;<span class="op" id="4065925">=</span>&nbsp;<span class="builtintype" id="4065927">uint8</span><span class="op" id="4065932">(</span><span class="ident" id="4065933">c</span><span class="op" id="4065934">.</span><span class="ident" id="4065935">A</span>&nbsp;<span class="op" id="4065937">&gt;&gt;</span>&nbsp;<span class="num" id="4065940">8</span><span class="op" id="4065941">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4065944">p</span><span class="op" id="4065945">.</span><span class="ident" id="4065946">Pix</span><span class="op" id="4065949">[</span><span class="ident" id="4065950">i</span><span class="op" id="4065951">+</span><span class="num" id="4065952">7</span><span class="op" id="4065953">]</span>&nbsp;<span class="op" id="4065955">=</span>&nbsp;<span class="builtintype" id="4065957">uint8</span><span class="op" id="4065962">(</span><span class="ident" id="4065963">c</span><span class="op" id="4065964">.</span><span class="ident" id="4065965">A</span><span class="op" id="4065966">)</span><br>
<span class="lineno"></span><span class="op" id="4065968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4065971">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4066048">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno">440</span><span class="keyword" id="4066120">func</span>&nbsp;<span class="op" id="4066125">(</span><span class="ident" id="4066126">p</span>&nbsp;<span class="op" id="4066128">*</span><span class="ident" id="4066129">NRGBA64</span><span class="op" id="4066136">)</span>&nbsp;<span class="ident" id="4066138">SubImage</span><span class="op" id="4066146">(</span><span class="ident" id="4066147">r</span>&nbsp;<span class="ident" id="4066149">Rectangle</span><span class="op" id="4066158">)</span>&nbsp;<span class="ident" id="4066160">Image</span>&nbsp;<span class="op" id="4066166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4066169">r</span>&nbsp;<span class="op" id="4066171">=</span>&nbsp;<span class="ident" id="4066173">r</span><span class="op" id="4066174">.</span><span class="ident" id="4066175">Intersect</span><span class="op" id="4066184">(</span><span class="ident" id="4066185">p</span><span class="op" id="4066186">.</span><span class="ident" id="4066187">Rect</span><span class="op" id="4066191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4066194">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4066275">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4066357">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066407">if</span>&nbsp;<span class="ident" id="4066410">r</span><span class="op" id="4066411">.</span><span class="ident" id="4066412">Empty</span><span class="op" id="4066417">(</span><span class="op" id="4066418">)</span>&nbsp;<span class="op" id="4066420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066424">return</span>&nbsp;<span class="op" id="4066431">&amp;</span><span class="ident" id="4066432">NRGBA64</span><span class="op" id="4066439">{</span><span class="op" id="4066440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4066443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4066446">i</span>&nbsp;<span class="op" id="4066448">:=</span>&nbsp;<span class="ident" id="4066451">p</span><span class="op" id="4066452">.</span><span class="ident" id="4066453">PixOffset</span><span class="op" id="4066462">(</span><span class="ident" id="4066463">r</span><span class="op" id="4066464">.</span><span class="ident" id="4066465">Min</span><span class="op" id="4066468">.</span><span class="ident" id="4066469">X</span><span class="op" id="4066470">,</span>&nbsp;<span class="ident" id="4066472">r</span><span class="op" id="4066473">.</span><span class="ident" id="4066474">Min</span><span class="op" id="4066477">.</span><span class="ident" id="4066478">Y</span><span class="op" id="4066479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066482">return</span>&nbsp;<span class="op" id="4066489">&amp;</span><span class="ident" id="4066490">NRGBA64</span><span class="op" id="4066497">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4066501">Pix</span><span class="op" id="4066504">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4066509">p</span><span class="op" id="4066510">.</span><span class="ident" id="4066511">Pix</span><span class="op" id="4066514">[</span><span class="ident" id="4066515">i</span><span class="op" id="4066516">:</span><span class="op" id="4066517">]</span><span class="op" id="4066518">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4066522">Stride</span><span class="op" id="4066528">:</span>&nbsp;<span class="ident" id="4066530">p</span><span class="op" id="4066531">.</span><span class="ident" id="4066532">Stride</span><span class="op" id="4066538">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4066542">Rect</span><span class="op" id="4066546">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4066550">r</span><span class="op" id="4066551">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4066554">}</span><br>
<span class="lineno"></span><span class="op" id="4066556">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="4066559">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4066632">func</span>&nbsp;<span class="op" id="4066637">(</span><span class="ident" id="4066638">p</span>&nbsp;<span class="op" id="4066640">*</span><span class="ident" id="4066641">NRGBA64</span><span class="op" id="4066648">)</span>&nbsp;<span class="ident" id="4066650">Opaque</span><span class="op" id="4066656">(</span><span class="op" id="4066657">)</span>&nbsp;<span class="builtintype" id="4066659">bool</span>&nbsp;<span class="op" id="4066664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066667">if</span>&nbsp;<span class="ident" id="4066670">p</span><span class="op" id="4066671">.</span><span class="ident" id="4066672">Rect</span><span class="op" id="4066676">.</span><span class="ident" id="4066677">Empty</span><span class="op" id="4066682">(</span><span class="op" id="4066683">)</span>&nbsp;<span class="op" id="4066685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066689">return</span>&nbsp;<span class="builtintype" id="4066696">true</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4066702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4066705">i0</span><span class="op" id="4066707">,</span>&nbsp;<span class="ident" id="4066709">i1</span>&nbsp;<span class="op" id="4066712">:=</span>&nbsp;<span class="num" id="4066715">6</span><span class="op" id="4066716">,</span>&nbsp;<span class="ident" id="4066718">p</span><span class="op" id="4066719">.</span><span class="ident" id="4066720">Rect</span><span class="op" id="4066724">.</span><span class="ident" id="4066725">Dx</span><span class="op" id="4066727">(</span><span class="op" id="4066728">)</span><span class="op" id="4066729">*</span><span class="num" id="4066730">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066733">for</span>&nbsp;<span class="ident" id="4066737">y</span>&nbsp;<span class="op" id="4066739">:=</span>&nbsp;<span class="ident" id="4066742">p</span><span class="op" id="4066743">.</span><span class="ident" id="4066744">Rect</span><span class="op" id="4066748">.</span><span class="ident" id="4066749">Min</span><span class="op" id="4066752">.</span><span class="ident" id="4066753">Y</span><span class="op" id="4066754">;</span>&nbsp;<span class="ident" id="4066756">y</span>&nbsp;<span class="op" id="4066758">&lt;</span>&nbsp;<span class="ident" id="4066760">p</span><span class="op" id="4066761">.</span><span class="ident" id="4066762">Rect</span><span class="op" id="4066766">.</span><span class="ident" id="4066767">Max</span><span class="op" id="4066770">.</span><span class="ident" id="4066771">Y</span><span class="op" id="4066772">;</span>&nbsp;<span class="ident" id="4066774">y</span><span class="op" id="4066775">++</span>&nbsp;<span class="op" id="4066778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066782">for</span>&nbsp;<span class="ident" id="4066786">i</span>&nbsp;<span class="op" id="4066788">:=</span>&nbsp;<span class="ident" id="4066791">i0</span><span class="op" id="4066793">;</span>&nbsp;<span class="ident" id="4066795">i</span>&nbsp;<span class="op" id="4066797">&lt;</span>&nbsp;<span class="ident" id="4066799">i1</span><span class="op" id="4066801">;</span>&nbsp;<span class="ident" id="4066803">i</span>&nbsp;<span class="op" id="4066805">+=</span>&nbsp;<span class="num" id="4066808">8</span>&nbsp;<span class="op" id="4066810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066815">if</span>&nbsp;<span class="ident" id="4066818">p</span><span class="op" id="4066819">.</span><span class="ident" id="4066820">Pix</span><span class="op" id="4066823">[</span><span class="ident" id="4066824">i</span><span class="op" id="4066825">+</span><span class="num" id="4066826">0</span><span class="op" id="4066827">]</span>&nbsp;<span class="op" id="4066829">!=</span>&nbsp;<span class="num" id="4066832">0xff</span>&nbsp;<span class="op" id="4066837">||</span>&nbsp;<span class="ident" id="4066840">p</span><span class="op" id="4066841">.</span><span class="ident" id="4066842">Pix</span><span class="op" id="4066845">[</span><span class="ident" id="4066846">i</span><span class="op" id="4066847">+</span><span class="num" id="4066848">1</span><span class="op" id="4066849">]</span>&nbsp;<span class="op" id="4066851">!=</span>&nbsp;<span class="num" id="4066854">0xff</span>&nbsp;<span class="op" id="4066859">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066865">return</span>&nbsp;<span class="builtintype" id="4066872">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4066881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4066885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4066889">i0</span>&nbsp;<span class="op" id="4066892">+=</span>&nbsp;<span class="ident" id="4066895">p</span><span class="op" id="4066896">.</span><span class="ident" id="4066897">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4066906">i1</span>&nbsp;<span class="op" id="4066909">+=</span>&nbsp;<span class="ident" id="4066912">p</span><span class="op" id="4066913">.</span><span class="ident" id="4066914">Stride</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4066922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4066925">return</span>&nbsp;<span class="builtintype" id="4066932">true</span><br>
<span class="lineno"></span><span class="op" id="4066937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4066940">//&nbsp;NewNRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno">475</span><span class="keyword" id="4066999">func</span>&nbsp;<span class="ident" id="4067004">NewNRGBA64</span><span class="op" id="4067014">(</span><span class="ident" id="4067015">r</span>&nbsp;<span class="ident" id="4067017">Rectangle</span><span class="op" id="4067026">)</span>&nbsp;<span class="op" id="4067028">*</span><span class="ident" id="4067029">NRGBA64</span>&nbsp;<span class="op" id="4067037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067040">w</span><span class="op" id="4067041">,</span>&nbsp;<span class="ident" id="4067043">h</span>&nbsp;<span class="op" id="4067045">:=</span>&nbsp;<span class="ident" id="4067048">r</span><span class="op" id="4067049">.</span><span class="ident" id="4067050">Dx</span><span class="op" id="4067052">(</span><span class="op" id="4067053">)</span><span class="op" id="4067054">,</span>&nbsp;<span class="ident" id="4067056">r</span><span class="op" id="4067057">.</span><span class="ident" id="4067058">Dy</span><span class="op" id="4067060">(</span><span class="op" id="4067061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067064">pix</span>&nbsp;<span class="op" id="4067068">:=</span>&nbsp;<span class="builtinfunc" id="4067071">make</span><span class="op" id="4067075">(</span><span class="op" id="4067076">[</span><span class="op" id="4067077">]</span><span class="builtintype" id="4067078">uint8</span><span class="op" id="4067083">,</span>&nbsp;<span class="num" id="4067085">8</span><span class="op" id="4067086">*</span><span class="ident" id="4067087">w</span><span class="op" id="4067088">*</span><span class="ident" id="4067089">h</span><span class="op" id="4067090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067093">return</span>&nbsp;<span class="op" id="4067100">&amp;</span><span class="ident" id="4067101">NRGBA64</span><span class="op" id="4067108">{</span><span class="ident" id="4067109">pix</span><span class="op" id="4067112">,</span>&nbsp;<span class="num" id="4067114">8</span>&nbsp;<span class="op" id="4067116">*</span>&nbsp;<span class="ident" id="4067118">w</span><span class="op" id="4067119">,</span>&nbsp;<span class="ident" id="4067121">r</span><span class="op" id="4067122">}</span><br>
<span class="lineno"></span><span class="op" id="4067124">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="4067127">//&nbsp;Alpha&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4067202">type</span>&nbsp;<span class="ident" id="4067207">Alpha</span>&nbsp;<span class="keyword" id="4067213">struct</span>&nbsp;<span class="op" id="4067220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4067223">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4067287">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067355">Pix</span>&nbsp;<span class="op" id="4067359">[</span><span class="op" id="4067360">]</span><span class="builtintype" id="4067361">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4067368">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067444">Stride</span>&nbsp;<span class="builtintype" id="4067451">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4067456">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067488">Rect</span>&nbsp;<span class="ident" id="4067493">Rectangle</span><br>
<span class="lineno">490</span><span class="op" id="4067503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4067506">func</span>&nbsp;<span class="op" id="4067511">(</span><span class="ident" id="4067512">p</span>&nbsp;<span class="op" id="4067514">*</span><span class="ident" id="4067515">Alpha</span><span class="op" id="4067520">)</span>&nbsp;<span class="ident" id="4067522">ColorModel</span><span class="op" id="4067532">(</span><span class="op" id="4067533">)</span>&nbsp;<span class="ident" id="4067535">color</span><span class="op" id="4067540">.</span><span class="ident" id="4067541">Model</span>&nbsp;<span class="op" id="4067547">{</span>&nbsp;<span class="keyword" id="4067549">return</span>&nbsp;<span class="ident" id="4067556">color</span><span class="op" id="4067561">.</span><span class="ident" id="4067562">AlphaModel</span>&nbsp;<span class="op" id="4067573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4067576">func</span>&nbsp;<span class="op" id="4067581">(</span><span class="ident" id="4067582">p</span>&nbsp;<span class="op" id="4067584">*</span><span class="ident" id="4067585">Alpha</span><span class="op" id="4067590">)</span>&nbsp;<span class="ident" id="4067592">Bounds</span><span class="op" id="4067598">(</span><span class="op" id="4067599">)</span>&nbsp;<span class="ident" id="4067601">Rectangle</span>&nbsp;<span class="op" id="4067611">{</span>&nbsp;<span class="keyword" id="4067613">return</span>&nbsp;<span class="ident" id="4067620">p</span><span class="op" id="4067621">.</span><span class="ident" id="4067622">Rect</span>&nbsp;<span class="op" id="4067627">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="4067630">func</span>&nbsp;<span class="op" id="4067635">(</span><span class="ident" id="4067636">p</span>&nbsp;<span class="op" id="4067638">*</span><span class="ident" id="4067639">Alpha</span><span class="op" id="4067644">)</span>&nbsp;<span class="ident" id="4067646">At</span><span class="op" id="4067648">(</span><span class="ident" id="4067649">x</span><span class="op" id="4067650">,</span>&nbsp;<span class="ident" id="4067652">y</span>&nbsp;<span class="builtintype" id="4067654">int</span><span class="op" id="4067657">)</span>&nbsp;<span class="ident" id="4067659">color</span><span class="op" id="4067664">.</span><span class="ident" id="4067665">Color</span>&nbsp;<span class="op" id="4067671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067674">return</span>&nbsp;<span class="ident" id="4067681">p</span><span class="op" id="4067682">.</span><span class="ident" id="4067683">AlphaAt</span><span class="op" id="4067690">(</span><span class="ident" id="4067691">x</span><span class="op" id="4067692">,</span>&nbsp;<span class="ident" id="4067694">y</span><span class="op" id="4067695">)</span><br>
<span class="lineno"></span><span class="op" id="4067697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="4067700">func</span>&nbsp;<span class="op" id="4067705">(</span><span class="ident" id="4067706">p</span>&nbsp;<span class="op" id="4067708">*</span><span class="ident" id="4067709">Alpha</span><span class="op" id="4067714">)</span>&nbsp;<span class="ident" id="4067716">AlphaAt</span><span class="op" id="4067723">(</span><span class="ident" id="4067724">x</span><span class="op" id="4067725">,</span>&nbsp;<span class="ident" id="4067727">y</span>&nbsp;<span class="builtintype" id="4067729">int</span><span class="op" id="4067732">)</span>&nbsp;<span class="ident" id="4067734">color</span><span class="op" id="4067739">.</span><span class="ident" id="4067740">Alpha</span>&nbsp;<span class="op" id="4067746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067749">if</span>&nbsp;<span class="op" id="4067752">!</span><span class="op" id="4067753">(</span><span class="ident" id="4067754">Point</span><span class="op" id="4067759">{</span><span class="ident" id="4067760">x</span><span class="op" id="4067761">,</span>&nbsp;<span class="ident" id="4067763">y</span><span class="op" id="4067764">}</span><span class="op" id="4067765">.</span><span class="ident" id="4067766">In</span><span class="op" id="4067768">(</span><span class="ident" id="4067769">p</span><span class="op" id="4067770">.</span><span class="ident" id="4067771">Rect</span><span class="op" id="4067775">)</span><span class="op" id="4067776">)</span>&nbsp;<span class="op" id="4067778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067782">return</span>&nbsp;<span class="ident" id="4067789">color</span><span class="op" id="4067794">.</span><span class="ident" id="4067795">Alpha</span><span class="op" id="4067800">{</span><span class="op" id="4067801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4067804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4067807">i</span>&nbsp;<span class="op" id="4067809">:=</span>&nbsp;<span class="ident" id="4067812">p</span><span class="op" id="4067813">.</span><span class="ident" id="4067814">PixOffset</span><span class="op" id="4067823">(</span><span class="ident" id="4067824">x</span><span class="op" id="4067825">,</span>&nbsp;<span class="ident" id="4067827">y</span><span class="op" id="4067828">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4067831">return</span>&nbsp;<span class="ident" id="4067838">color</span><span class="op" id="4067843">.</span><span class="ident" id="4067844">Alpha</span><span class="op" id="4067849">{</span><span class="ident" id="4067850">p</span><span class="op" id="4067851">.</span><span class="ident" id="4067852">Pix</span><span class="op" id="4067855">[</span><span class="ident" id="4067856">i</span><span class="op" id="4067857">]</span><span class="op" id="4067858">}</span><br>
<span class="lineno"></span><span class="op" id="4067860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4067863">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4067942">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">510</span><span class="keyword" id="4067966">func</span>&nbsp;<span class="op" id="4067971">(</span><span class="ident" id="4067972">p</span>&nbsp;<span class="op" id="4067974">*</span><span class="ident" id="4067975">Alpha</span><span class="op" id="4067980">)</span>&nbsp;<span class="ident" id="4067982">PixOffset</span><span class="op" id="4067991">(</span><span class="ident" id="4067992">x</span><span class="op" id="4067993">,</span>&nbsp;<span class="ident" id="4067995">y</span>&nbsp;<span class="builtintype" id="4067997">int</span><span class="op" id="4068000">)</span>&nbsp;<span class="builtintype" id="4068002">int</span>&nbsp;<span class="op" id="4068006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068009">return</span>&nbsp;<span class="op" id="4068016">(</span><span class="ident" id="4068017">y</span><span class="op" id="4068018">-</span><span class="ident" id="4068019">p</span><span class="op" id="4068020">.</span><span class="ident" id="4068021">Rect</span><span class="op" id="4068025">.</span><span class="ident" id="4068026">Min</span><span class="op" id="4068029">.</span><span class="ident" id="4068030">Y</span><span class="op" id="4068031">)</span><span class="op" id="4068032">*</span><span class="ident" id="4068033">p</span><span class="op" id="4068034">.</span><span class="ident" id="4068035">Stride</span>&nbsp;<span class="op" id="4068042">+</span>&nbsp;<span class="op" id="4068044">(</span><span class="ident" id="4068045">x</span><span class="op" id="4068046">-</span><span class="ident" id="4068047">p</span><span class="op" id="4068048">.</span><span class="ident" id="4068049">Rect</span><span class="op" id="4068053">.</span><span class="ident" id="4068054">Min</span><span class="op" id="4068057">.</span><span class="ident" id="4068058">X</span><span class="op" id="4068059">)</span><span class="op" id="4068060">*</span><span class="num" id="4068061">1</span><br>
<span class="lineno"></span><span class="op" id="4068063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4068066">func</span>&nbsp;<span class="op" id="4068071">(</span><span class="ident" id="4068072">p</span>&nbsp;<span class="op" id="4068074">*</span><span class="ident" id="4068075">Alpha</span><span class="op" id="4068080">)</span>&nbsp;<span class="ident" id="4068082">Set</span><span class="op" id="4068085">(</span><span class="ident" id="4068086">x</span><span class="op" id="4068087">,</span>&nbsp;<span class="ident" id="4068089">y</span>&nbsp;<span class="builtintype" id="4068091">int</span><span class="op" id="4068094">,</span>&nbsp;<span class="ident" id="4068096">c</span>&nbsp;<span class="ident" id="4068098">color</span><span class="op" id="4068103">.</span><span class="ident" id="4068104">Color</span><span class="op" id="4068109">)</span>&nbsp;<span class="op" id="4068111">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068114">if</span>&nbsp;<span class="op" id="4068117">!</span><span class="op" id="4068118">(</span><span class="ident" id="4068119">Point</span><span class="op" id="4068124">{</span><span class="ident" id="4068125">x</span><span class="op" id="4068126">,</span>&nbsp;<span class="ident" id="4068128">y</span><span class="op" id="4068129">}</span><span class="op" id="4068130">.</span><span class="ident" id="4068131">In</span><span class="op" id="4068133">(</span><span class="ident" id="4068134">p</span><span class="op" id="4068135">.</span><span class="ident" id="4068136">Rect</span><span class="op" id="4068140">)</span><span class="op" id="4068141">)</span>&nbsp;<span class="op" id="4068143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068147">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4068155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068158">i</span>&nbsp;<span class="op" id="4068160">:=</span>&nbsp;<span class="ident" id="4068163">p</span><span class="op" id="4068164">.</span><span class="ident" id="4068165">PixOffset</span><span class="op" id="4068174">(</span><span class="ident" id="4068175">x</span><span class="op" id="4068176">,</span>&nbsp;<span class="ident" id="4068178">y</span><span class="op" id="4068179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068182">p</span><span class="op" id="4068183">.</span><span class="ident" id="4068184">Pix</span><span class="op" id="4068187">[</span><span class="ident" id="4068188">i</span><span class="op" id="4068189">]</span>&nbsp;<span class="op" id="4068191">=</span>&nbsp;<span class="ident" id="4068193">color</span><span class="op" id="4068198">.</span><span class="ident" id="4068199">AlphaModel</span><span class="op" id="4068209">.</span><span class="ident" id="4068210">Convert</span><span class="op" id="4068217">(</span><span class="ident" id="4068218">c</span><span class="op" id="4068219">)</span><span class="op" id="4068220">.</span><span class="op" id="4068221">(</span><span class="ident" id="4068222">color</span><span class="op" id="4068227">.</span><span class="ident" id="4068228">Alpha</span><span class="op" id="4068233">)</span><span class="op" id="4068234">.</span><span class="ident" id="4068235">A</span><br>
<span class="lineno">520</span><span class="op" id="4068237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4068240">func</span>&nbsp;<span class="op" id="4068245">(</span><span class="ident" id="4068246">p</span>&nbsp;<span class="op" id="4068248">*</span><span class="ident" id="4068249">Alpha</span><span class="op" id="4068254">)</span>&nbsp;<span class="ident" id="4068256">SetAlpha</span><span class="op" id="4068264">(</span><span class="ident" id="4068265">x</span><span class="op" id="4068266">,</span>&nbsp;<span class="ident" id="4068268">y</span>&nbsp;<span class="builtintype" id="4068270">int</span><span class="op" id="4068273">,</span>&nbsp;<span class="ident" id="4068275">c</span>&nbsp;<span class="ident" id="4068277">color</span><span class="op" id="4068282">.</span><span class="ident" id="4068283">Alpha</span><span class="op" id="4068288">)</span>&nbsp;<span class="op" id="4068290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068293">if</span>&nbsp;<span class="op" id="4068296">!</span><span class="op" id="4068297">(</span><span class="ident" id="4068298">Point</span><span class="op" id="4068303">{</span><span class="ident" id="4068304">x</span><span class="op" id="4068305">,</span>&nbsp;<span class="ident" id="4068307">y</span><span class="op" id="4068308">}</span><span class="op" id="4068309">.</span><span class="ident" id="4068310">In</span><span class="op" id="4068312">(</span><span class="ident" id="4068313">p</span><span class="op" id="4068314">.</span><span class="ident" id="4068315">Rect</span><span class="op" id="4068319">)</span><span class="op" id="4068320">)</span>&nbsp;<span class="op" id="4068322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068326">return</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4068334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068337">i</span>&nbsp;<span class="op" id="4068339">:=</span>&nbsp;<span class="ident" id="4068342">p</span><span class="op" id="4068343">.</span><span class="ident" id="4068344">PixOffset</span><span class="op" id="4068353">(</span><span class="ident" id="4068354">x</span><span class="op" id="4068355">,</span>&nbsp;<span class="ident" id="4068357">y</span><span class="op" id="4068358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068361">p</span><span class="op" id="4068362">.</span><span class="ident" id="4068363">Pix</span><span class="op" id="4068366">[</span><span class="ident" id="4068367">i</span><span class="op" id="4068368">]</span>&nbsp;<span class="op" id="4068370">=</span>&nbsp;<span class="ident" id="4068372">c</span><span class="op" id="4068373">.</span><span class="ident" id="4068374">A</span><br>
<span class="lineno"></span><span class="op" id="4068376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="4068379">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4068456">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4068528">func</span>&nbsp;<span class="op" id="4068533">(</span><span class="ident" id="4068534">p</span>&nbsp;<span class="op" id="4068536">*</span><span class="ident" id="4068537">Alpha</span><span class="op" id="4068542">)</span>&nbsp;<span class="ident" id="4068544">SubImage</span><span class="op" id="4068552">(</span><span class="ident" id="4068553">r</span>&nbsp;<span class="ident" id="4068555">Rectangle</span><span class="op" id="4068564">)</span>&nbsp;<span class="ident" id="4068566">Image</span>&nbsp;<span class="op" id="4068572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068575">r</span>&nbsp;<span class="op" id="4068577">=</span>&nbsp;<span class="ident" id="4068579">r</span><span class="op" id="4068580">.</span><span class="ident" id="4068581">Intersect</span><span class="op" id="4068590">(</span><span class="ident" id="4068591">p</span><span class="op" id="4068592">.</span><span class="ident" id="4068593">Rect</span><span class="op" id="4068597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4068600">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4068681">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4068763">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068813">if</span>&nbsp;<span class="ident" id="4068816">r</span><span class="op" id="4068817">.</span><span class="ident" id="4068818">Empty</span><span class="op" id="4068823">(</span><span class="op" id="4068824">)</span>&nbsp;<span class="op" id="4068826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068830">return</span>&nbsp;<span class="op" id="4068837">&amp;</span><span class="ident" id="4068838">Alpha</span><span class="op" id="4068843">{</span><span class="op" id="4068844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4068847">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068850">i</span>&nbsp;<span class="op" id="4068852">:=</span>&nbsp;<span class="ident" id="4068855">p</span><span class="op" id="4068856">.</span><span class="ident" id="4068857">PixOffset</span><span class="op" id="4068866">(</span><span class="ident" id="4068867">r</span><span class="op" id="4068868">.</span><span class="ident" id="4068869">Min</span><span class="op" id="4068872">.</span><span class="ident" id="4068873">X</span><span class="op" id="4068874">,</span>&nbsp;<span class="ident" id="4068876">r</span><span class="op" id="4068877">.</span><span class="ident" id="4068878">Min</span><span class="op" id="4068881">.</span><span class="ident" id="4068882">Y</span><span class="op" id="4068883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4068886">return</span>&nbsp;<span class="op" id="4068893">&amp;</span><span class="ident" id="4068894">Alpha</span><span class="op" id="4068899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068903">Pix</span><span class="op" id="4068906">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4068911">p</span><span class="op" id="4068912">.</span><span class="ident" id="4068913">Pix</span><span class="op" id="4068916">[</span><span class="ident" id="4068917">i</span><span class="op" id="4068918">:</span><span class="op" id="4068919">]</span><span class="op" id="4068920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068924">Stride</span><span class="op" id="4068930">:</span>&nbsp;<span class="ident" id="4068932">p</span><span class="op" id="4068933">.</span><span class="ident" id="4068934">Stride</span><span class="op" id="4068940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4068944">Rect</span><span class="op" id="4068948">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4068952">r</span><span class="op" id="4068953">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4068956">}</span><br>
<span class="lineno"></span><span class="op" id="4068958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4068961">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4069034">func</span>&nbsp;<span class="op" id="4069039">(</span><span class="ident" id="4069040">p</span>&nbsp;<span class="op" id="4069042">*</span><span class="ident" id="4069043">Alpha</span><span class="op" id="4069048">)</span>&nbsp;<span class="ident" id="4069050">Opaque</span><span class="op" id="4069056">(</span><span class="op" id="4069057">)</span>&nbsp;<span class="builtintype" id="4069059">bool</span>&nbsp;<span class="op" id="4069064">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4069067">if</span>&nbsp;<span class="ident" id="4069070">p</span><span class="op" id="4069071">.</span><span class="ident" id="4069072">Rect</span><span class="op" id="4069076">.</span><span class="ident" id="4069077">Empty</span><span class="op" id="4069082">(</span><span class="op" id="4069083">)</span>&nbsp;<span class="op" id="4069085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4069089">return</span>&nbsp;<span class="builtintype" id="4069096">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4069102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069105">i0</span><span class="op" id="4069107">,</span>&nbsp;<span class="ident" id="4069109">i1</span>&nbsp;<span class="op" id="4069112">:=</span>&nbsp;<span class="num" id="4069115">0</span><span class="op" id="4069116">,</span>&nbsp;<span class="ident" id="4069118">p</span><span class="op" id="4069119">.</span><span class="ident" id="4069120">Rect</span><span class="op" id="4069124">.</span><span class="ident" id="4069125">Dx</span><span class="op" id="4069127">(</span><span class="op" id="4069128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4069131">for</span>&nbsp;<span class="ident" id="4069135">y</span>&nbsp;<span class="op" id="4069137">:=</span>&nbsp;<span class="ident" id="4069140">p</span><span class="op" id="4069141">.</span><span class="ident" id="4069142">Rect</span><span class="op" id="4069146">.</span><span class="ident" id="4069147">Min</span><span class="op" id="4069150">.</span><span class="ident" id="4069151">Y</span><span class="op" id="4069152">;</span>&nbsp;<span class="ident" id="4069154">y</span>&nbsp;<span class="op" id="4069156">&lt;</span>&nbsp;<span class="ident" id="4069158">p</span><span class="op" id="4069159">.</span><span class="ident" id="4069160">Rect</span><span class="op" id="4069164">.</span><span class="ident" id="4069165">Max</span><span class="op" id="4069168">.</span><span class="ident" id="4069169">Y</span><span class="op" id="4069170">;</span>&nbsp;<span class="ident" id="4069172">y</span><span class="op" id="4069173">++</span>&nbsp;<span class="op" id="4069176">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4069180">for</span>&nbsp;<span class="ident" id="4069184">i</span>&nbsp;<span class="op" id="4069186">:=</span>&nbsp;<span class="ident" id="4069189">i0</span><span class="op" id="4069191">;</span>&nbsp;<span class="ident" id="4069193">i</span>&nbsp;<span class="op" id="4069195">&lt;</span>&nbsp;<span class="ident" id="4069197">i1</span><span class="op" id="4069199">;</span>&nbsp;<span class="ident" id="4069201">i</span><span class="op" id="4069202">++</span>&nbsp;<span class="op" id="4069205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4069210">if</span>&nbsp;<span class="ident" id="4069213">p</span><span class="op" id="4069214">.</span><span class="ident" id="4069215">Pix</span><span class="op" id="4069218">[</span><span class="ident" id="4069219">i</span><span class="op" id="4069220">]</span>&nbsp;<span class="op" id="4069222">!=</span>&nbsp;<span class="num" id="4069225">0xff</span>&nbsp;<span class="op" id="4069230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4069236">return</span>&nbsp;<span class="builtintype" id="4069243">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4069252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4069256">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069260">i0</span>&nbsp;<span class="op" id="4069263">+=</span>&nbsp;<span class="ident" id="4069266">p</span><span class="op" id="4069267">.</span><span class="ident" id="4069268">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069277">i1</span>&nbsp;<span class="op" id="4069280">+=</span>&nbsp;<span class="ident" id="4069283">p</span><span class="op" id="4069284">.</span><span class="ident" id="4069285">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4069293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4069296">return</span>&nbsp;<span class="builtintype" id="4069303">true</span><br>
<span class="lineno"></span><span class="op" id="4069308">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="4069311">//&nbsp;NewAlpha&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4069366">func</span>&nbsp;<span class="ident" id="4069371">NewAlpha</span><span class="op" id="4069379">(</span><span class="ident" id="4069380">r</span>&nbsp;<span class="ident" id="4069382">Rectangle</span><span class="op" id="4069391">)</span>&nbsp;<span class="op" id="4069393">*</span><span class="ident" id="4069394">Alpha</span>&nbsp;<span class="op" id="4069400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069403">w</span><span class="op" id="4069404">,</span>&nbsp;<span class="ident" id="4069406">h</span>&nbsp;<span class="op" id="4069408">:=</span>&nbsp;<span class="ident" id="4069411">r</span><span class="op" id="4069412">.</span><span class="ident" id="4069413">Dx</span><span class="op" id="4069415">(</span><span class="op" id="4069416">)</span><span class="op" id="4069417">,</span>&nbsp;<span class="ident" id="4069419">r</span><span class="op" id="4069420">.</span><span class="ident" id="4069421">Dy</span><span class="op" id="4069423">(</span><span class="op" id="4069424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069427">pix</span>&nbsp;<span class="op" id="4069431">:=</span>&nbsp;<span class="builtinfunc" id="4069434">make</span><span class="op" id="4069438">(</span><span class="op" id="4069439">[</span><span class="op" id="4069440">]</span><span class="builtintype" id="4069441">uint8</span><span class="op" id="4069446">,</span>&nbsp;<span class="num" id="4069448">1</span><span class="op" id="4069449">*</span><span class="ident" id="4069450">w</span><span class="op" id="4069451">*</span><span class="ident" id="4069452">h</span><span class="op" id="4069453">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4069456">return</span>&nbsp;<span class="op" id="4069463">&amp;</span><span class="ident" id="4069464">Alpha</span><span class="op" id="4069469">{</span><span class="ident" id="4069470">pix</span><span class="op" id="4069473">,</span>&nbsp;<span class="num" id="4069475">1</span>&nbsp;<span class="op" id="4069477">*</span>&nbsp;<span class="ident" id="4069479">w</span><span class="op" id="4069480">,</span>&nbsp;<span class="ident" id="4069482">r</span><span class="op" id="4069483">}</span><br>
<span class="lineno"></span><span class="op" id="4069485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4069488">//&nbsp;Alpha16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4069567">type</span>&nbsp;<span class="ident" id="4069572">Alpha16</span>&nbsp;<span class="keyword" id="4069580">struct</span>&nbsp;<span class="op" id="4069587">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4069590">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4069675">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069743">Pix</span>&nbsp;<span class="op" id="4069747">[</span><span class="op" id="4069748">]</span><span class="builtintype" id="4069749">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4069756">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069832">Stride</span>&nbsp;<span class="builtintype" id="4069839">int</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4069844">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4069876">Rect</span>&nbsp;<span class="ident" id="4069881">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4069891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4069894">func</span>&nbsp;<span class="op" id="4069899">(</span><span class="ident" id="4069900">p</span>&nbsp;<span class="op" id="4069902">*</span><span class="ident" id="4069903">Alpha16</span><span class="op" id="4069910">)</span>&nbsp;<span class="ident" id="4069912">ColorModel</span><span class="op" id="4069922">(</span><span class="op" id="4069923">)</span>&nbsp;<span class="ident" id="4069925">color</span><span class="op" id="4069930">.</span><span class="ident" id="4069931">Model</span>&nbsp;<span class="op" id="4069937">{</span>&nbsp;<span class="keyword" id="4069939">return</span>&nbsp;<span class="ident" id="4069946">color</span><span class="op" id="4069951">.</span><span class="ident" id="4069952">Alpha16Model</span>&nbsp;<span class="op" id="4069965">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="keyword" id="4069968">func</span>&nbsp;<span class="op" id="4069973">(</span><span class="ident" id="4069974">p</span>&nbsp;<span class="op" id="4069976">*</span><span class="ident" id="4069977">Alpha16</span><span class="op" id="4069984">)</span>&nbsp;<span class="ident" id="4069986">Bounds</span><span class="op" id="4069992">(</span><span class="op" id="4069993">)</span>&nbsp;<span class="ident" id="4069995">Rectangle</span>&nbsp;<span class="op" id="4070005">{</span>&nbsp;<span class="keyword" id="4070007">return</span>&nbsp;<span class="ident" id="4070014">p</span><span class="op" id="4070015">.</span><span class="ident" id="4070016">Rect</span>&nbsp;<span class="op" id="4070021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4070024">func</span>&nbsp;<span class="op" id="4070029">(</span><span class="ident" id="4070030">p</span>&nbsp;<span class="op" id="4070032">*</span><span class="ident" id="4070033">Alpha16</span><span class="op" id="4070040">)</span>&nbsp;<span class="ident" id="4070042">At</span><span class="op" id="4070044">(</span><span class="ident" id="4070045">x</span><span class="op" id="4070046">,</span>&nbsp;<span class="ident" id="4070048">y</span>&nbsp;<span class="builtintype" id="4070050">int</span><span class="op" id="4070053">)</span>&nbsp;<span class="ident" id="4070055">color</span><span class="op" id="4070060">.</span><span class="ident" id="4070061">Color</span>&nbsp;<span class="op" id="4070067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4070070">return</span>&nbsp;<span class="ident" id="4070077">p</span><span class="op" id="4070078">.</span><span class="ident" id="4070079">Alpha16At</span><span class="op" id="4070088">(</span><span class="ident" id="4070089">x</span><span class="op" id="4070090">,</span>&nbsp;<span class="ident" id="4070092">y</span><span class="op" id="4070093">)</span><br>
<span class="lineno">590</span><span class="op" id="4070095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4070098">func</span>&nbsp;<span class="op" id="4070103">(</span><span class="ident" id="4070104">p</span>&nbsp;<span class="op" id="4070106">*</span><span class="ident" id="4070107">Alpha16</span><span class="op" id="4070114">)</span>&nbsp;<span class="ident" id="4070116">Alpha16At</span><span class="op" id="4070125">(</span><span class="ident" id="4070126">x</span><span class="op" id="4070127">,</span>&nbsp;<span class="ident" id="4070129">y</span>&nbsp;<span class="builtintype" id="4070131">int</span><span class="op" id="4070134">)</span>&nbsp;<span class="ident" id="4070136">color</span><span class="op" id="4070141">.</span><span class="ident" id="4070142">Alpha16</span>&nbsp;<span class="op" id="4070150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4070153">if</span>&nbsp;<span class="op" id="4070156">!</span><span class="op" id="4070157">(</span><span class="ident" id="4070158">Point</span><span class="op" id="4070163">{</span><span class="ident" id="4070164">x</span><span class="op" id="4070165">,</span>&nbsp;<span class="ident" id="4070167">y</span><span class="op" id="4070168">}</span><span class="op" id="4070169">.</span><span class="ident" id="4070170">In</span><span class="op" id="4070172">(</span><span class="ident" id="4070173">p</span><span class="op" id="4070174">.</span><span class="ident" id="4070175">Rect</span><span class="op" id="4070179">)</span><span class="op" id="4070180">)</span>&nbsp;<span class="op" id="4070182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4070186">return</span>&nbsp;<span class="ident" id="4070193">color</span><span class="op" id="4070198">.</span><span class="ident" id="4070199">Alpha16</span><span class="op" id="4070206">{</span><span class="op" id="4070207">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4070210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070213">i</span>&nbsp;<span class="op" id="4070215">:=</span>&nbsp;<span class="ident" id="4070218">p</span><span class="op" id="4070219">.</span><span class="ident" id="4070220">PixOffset</span><span class="op" id="4070229">(</span><span class="ident" id="4070230">x</span><span class="op" id="4070231">,</span>&nbsp;<span class="ident" id="4070233">y</span><span class="op" id="4070234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4070237">return</span>&nbsp;<span class="ident" id="4070244">color</span><span class="op" id="4070249">.</span><span class="ident" id="4070250">Alpha16</span><span class="op" id="4070257">{</span><span class="builtintype" id="4070258">uint16</span><span class="op" id="4070264">(</span><span class="ident" id="4070265">p</span><span class="op" id="4070266">.</span><span class="ident" id="4070267">Pix</span><span class="op" id="4070270">[</span><span class="ident" id="4070271">i</span><span class="op" id="4070272">+</span><span class="num" id="4070273">0</span><span class="op" id="4070274">]</span><span class="op" id="4070275">)</span><span class="op" id="4070276">&lt;&lt;</span><span class="num" id="4070278">8</span>&nbsp;<span class="op" id="4070280">|</span>&nbsp;<span class="builtintype" id="4070282">uint16</span><span class="op" id="4070288">(</span><span class="ident" id="4070289">p</span><span class="op" id="4070290">.</span><span class="ident" id="4070291">Pix</span><span class="op" id="4070294">[</span><span class="ident" id="4070295">i</span><span class="op" id="4070296">+</span><span class="num" id="4070297">1</span><span class="op" id="4070298">]</span><span class="op" id="4070299">)</span><span class="op" id="4070300">}</span><br>
<span class="lineno"></span><span class="op" id="4070302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="4070305">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4070384">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4070408">func</span>&nbsp;<span class="op" id="4070413">(</span><span class="ident" id="4070414">p</span>&nbsp;<span class="op" id="4070416">*</span><span class="ident" id="4070417">Alpha16</span><span class="op" id="4070424">)</span>&nbsp;<span class="ident" id="4070426">PixOffset</span><span class="op" id="4070435">(</span><span class="ident" id="4070436">x</span><span class="op" id="4070437">,</span>&nbsp;<span class="ident" id="4070439">y</span>&nbsp;<span class="builtintype" id="4070441">int</span><span class="op" id="4070444">)</span>&nbsp;<span class="builtintype" id="4070446">int</span>&nbsp;<span class="op" id="4070450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4070453">return</span>&nbsp;<span class="op" id="4070460">(</span><span class="ident" id="4070461">y</span><span class="op" id="4070462">-</span><span class="ident" id="4070463">p</span><span class="op" id="4070464">.</span><span class="ident" id="4070465">Rect</span><span class="op" id="4070469">.</span><span class="ident" id="4070470">Min</span><span class="op" id="4070473">.</span><span class="ident" id="4070474">Y</span><span class="op" id="4070475">)</span><span class="op" id="4070476">*</span><span class="ident" id="4070477">p</span><span class="op" id="4070478">.</span><span class="ident" id="4070479">Stride</span>&nbsp;<span class="op" id="4070486">+</span>&nbsp;<span class="op" id="4070488">(</span><span class="ident" id="4070489">x</span><span class="op" id="4070490">-</span><span class="ident" id="4070491">p</span><span class="op" id="4070492">.</span><span class="ident" id="4070493">Rect</span><span class="op" id="4070497">.</span><span class="ident" id="4070498">Min</span><span class="op" id="4070501">.</span><span class="ident" id="4070502">X</span><span class="op" id="4070503">)</span><span class="op" id="4070504">*</span><span class="num" id="4070505">2</span><br>
<span class="lineno"></span><span class="op" id="4070507">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="keyword" id="4070510">func</span>&nbsp;<span class="op" id="4070515">(</span><span class="ident" id="4070516">p</span>&nbsp;<span class="op" id="4070518">*</span><span class="ident" id="4070519">Alpha16</span><span class="op" id="4070526">)</span>&nbsp;<span class="ident" id="4070528">Set</span><span class="op" id="4070531">(</span><span class="ident" id="4070532">x</span><span class="op" id="4070533">,</span>&nbsp;<span class="ident" id="4070535">y</span>&nbsp;<span class="builtintype" id="4070537">int</span><span class="op" id="4070540">,</span>&nbsp;<span class="ident" id="4070542">c</span>&nbsp;<span class="ident" id="4070544">color</span><span class="op" id="4070549">.</span><span class="ident" id="4070550">Color</span><span class="op" id="4070555">)</span>&nbsp;<span class="op" id="4070557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4070560">if</span>&nbsp;<span class="op" id="4070563">!</span><span class="op" id="4070564">(</span><span class="ident" id="4070565">Point</span><span class="op" id="4070570">{</span><span class="ident" id="4070571">x</span><span class="op" id="4070572">,</span>&nbsp;<span class="ident" id="4070574">y</span><span class="op" id="4070575">}</span><span class="op" id="4070576">.</span><span class="ident" id="4070577">In</span><span class="op" id="4070579">(</span><span class="ident" id="4070580">p</span><span class="op" id="4070581">.</span><span class="ident" id="4070582">Rect</span><span class="op" id="4070586">)</span><span class="op" id="4070587">)</span>&nbsp;<span class="op" id="4070589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4070593">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4070601">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070604">i</span>&nbsp;<span class="op" id="4070606">:=</span>&nbsp;<span class="ident" id="4070609">p</span><span class="op" id="4070610">.</span><span class="ident" id="4070611">PixOffset</span><span class="op" id="4070620">(</span><span class="ident" id="4070621">x</span><span class="op" id="4070622">,</span>&nbsp;<span class="ident" id="4070624">y</span><span class="op" id="4070625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070628">c1</span>&nbsp;<span class="op" id="4070631">:=</span>&nbsp;<span class="ident" id="4070634">color</span><span class="op" id="4070639">.</span><span class="ident" id="4070640">Alpha16Model</span><span class="op" id="4070652">.</span><span class="ident" id="4070653">Convert</span><span class="op" id="4070660">(</span><span class="ident" id="4070661">c</span><span class="op" id="4070662">)</span><span class="op" id="4070663">.</span><span class="op" id="4070664">(</span><span class="ident" id="4070665">color</span><span class="op" id="4070670">.</span><span class="ident" id="4070671">Alpha16</span><span class="op" id="4070678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070681">p</span><span class="op" id="4070682">.</span><span class="ident" id="4070683">Pix</span><span class="op" id="4070686">[</span><span class="ident" id="4070687">i</span><span class="op" id="4070688">+</span><span class="num" id="4070689">0</span><span class="op" id="4070690">]</span>&nbsp;<span class="op" id="4070692">=</span>&nbsp;<span class="builtintype" id="4070694">uint8</span><span class="op" id="4070699">(</span><span class="ident" id="4070700">c1</span><span class="op" id="4070702">.</span><span class="ident" id="4070703">A</span>&nbsp;<span class="op" id="4070705">&gt;&gt;</span>&nbsp;<span class="num" id="4070708">8</span><span class="op" id="4070709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070712">p</span><span class="op" id="4070713">.</span><span class="ident" id="4070714">Pix</span><span class="op" id="4070717">[</span><span class="ident" id="4070718">i</span><span class="op" id="4070719">+</span><span class="num" id="4070720">1</span><span class="op" id="4070721">]</span>&nbsp;<span class="op" id="4070723">=</span>&nbsp;<span class="builtintype" id="4070725">uint8</span><span class="op" id="4070730">(</span><span class="ident" id="4070731">c1</span><span class="op" id="4070733">.</span><span class="ident" id="4070734">A</span><span class="op" id="4070735">)</span><br>
<span class="lineno"></span><span class="op" id="4070737">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="4070740">func</span>&nbsp;<span class="op" id="4070745">(</span><span class="ident" id="4070746">p</span>&nbsp;<span class="op" id="4070748">*</span><span class="ident" id="4070749">Alpha16</span><span class="op" id="4070756">)</span>&nbsp;<span class="ident" id="4070758">SetAlpha16</span><span class="op" id="4070768">(</span><span class="ident" id="4070769">x</span><span class="op" id="4070770">,</span>&nbsp;<span class="ident" id="4070772">y</span>&nbsp;<span class="builtintype" id="4070774">int</span><span class="op" id="4070777">,</span>&nbsp;<span class="ident" id="4070779">c</span>&nbsp;<span class="ident" id="4070781">color</span><span class="op" id="4070786">.</span><span class="ident" id="4070787">Alpha16</span><span class="op" id="4070794">)</span>&nbsp;<span class="op" id="4070796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4070799">if</span>&nbsp;<span class="op" id="4070802">!</span><span class="op" id="4070803">(</span><span class="ident" id="4070804">Point</span><span class="op" id="4070809">{</span><span class="ident" id="4070810">x</span><span class="op" id="4070811">,</span>&nbsp;<span class="ident" id="4070813">y</span><span class="op" id="4070814">}</span><span class="op" id="4070815">.</span><span class="ident" id="4070816">In</span><span class="op" id="4070818">(</span><span class="ident" id="4070819">p</span><span class="op" id="4070820">.</span><span class="ident" id="4070821">Rect</span><span class="op" id="4070825">)</span><span class="op" id="4070826">)</span>&nbsp;<span class="op" id="4070828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4070832">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4070840">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070843">i</span>&nbsp;<span class="op" id="4070845">:=</span>&nbsp;<span class="ident" id="4070848">p</span><span class="op" id="4070849">.</span><span class="ident" id="4070850">PixOffset</span><span class="op" id="4070859">(</span><span class="ident" id="4070860">x</span><span class="op" id="4070861">,</span>&nbsp;<span class="ident" id="4070863">y</span><span class="op" id="4070864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070867">p</span><span class="op" id="4070868">.</span><span class="ident" id="4070869">Pix</span><span class="op" id="4070872">[</span><span class="ident" id="4070873">i</span><span class="op" id="4070874">+</span><span class="num" id="4070875">0</span><span class="op" id="4070876">]</span>&nbsp;<span class="op" id="4070878">=</span>&nbsp;<span class="builtintype" id="4070880">uint8</span><span class="op" id="4070885">(</span><span class="ident" id="4070886">c</span><span class="op" id="4070887">.</span><span class="ident" id="4070888">A</span>&nbsp;<span class="op" id="4070890">&gt;&gt;</span>&nbsp;<span class="num" id="4070893">8</span><span class="op" id="4070894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4070897">p</span><span class="op" id="4070898">.</span><span class="ident" id="4070899">Pix</span><span class="op" id="4070902">[</span><span class="ident" id="4070903">i</span><span class="op" id="4070904">+</span><span class="num" id="4070905">1</span><span class="op" id="4070906">]</span>&nbsp;<span class="op" id="4070908">=</span>&nbsp;<span class="builtintype" id="4070910">uint8</span><span class="op" id="4070915">(</span><span class="ident" id="4070916">c</span><span class="op" id="4070917">.</span><span class="ident" id="4070918">A</span><span class="op" id="4070919">)</span><br>
<span class="lineno"></span><span class="op" id="4070921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="4070924">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4071001">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4071073">func</span>&nbsp;<span class="op" id="4071078">(</span><span class="ident" id="4071079">p</span>&nbsp;<span class="op" id="4071081">*</span><span class="ident" id="4071082">Alpha16</span><span class="op" id="4071089">)</span>&nbsp;<span class="ident" id="4071091">SubImage</span><span class="op" id="4071099">(</span><span class="ident" id="4071100">r</span>&nbsp;<span class="ident" id="4071102">Rectangle</span><span class="op" id="4071111">)</span>&nbsp;<span class="ident" id="4071113">Image</span>&nbsp;<span class="op" id="4071119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071122">r</span>&nbsp;<span class="op" id="4071124">=</span>&nbsp;<span class="ident" id="4071126">r</span><span class="op" id="4071127">.</span><span class="ident" id="4071128">Intersect</span><span class="op" id="4071137">(</span><span class="ident" id="4071138">p</span><span class="op" id="4071139">.</span><span class="ident" id="4071140">Rect</span><span class="op" id="4071144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4071147">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4071228">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4071310">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4071360">if</span>&nbsp;<span class="ident" id="4071363">r</span><span class="op" id="4071364">.</span><span class="ident" id="4071365">Empty</span><span class="op" id="4071370">(</span><span class="op" id="4071371">)</span>&nbsp;<span class="op" id="4071373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4071377">return</span>&nbsp;<span class="op" id="4071384">&amp;</span><span class="ident" id="4071385">Alpha16</span><span class="op" id="4071392">{</span><span class="op" id="4071393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4071396">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071399">i</span>&nbsp;<span class="op" id="4071401">:=</span>&nbsp;<span class="ident" id="4071404">p</span><span class="op" id="4071405">.</span><span class="ident" id="4071406">PixOffset</span><span class="op" id="4071415">(</span><span class="ident" id="4071416">r</span><span class="op" id="4071417">.</span><span class="ident" id="4071418">Min</span><span class="op" id="4071421">.</span><span class="ident" id="4071422">X</span><span class="op" id="4071423">,</span>&nbsp;<span class="ident" id="4071425">r</span><span class="op" id="4071426">.</span><span class="ident" id="4071427">Min</span><span class="op" id="4071430">.</span><span class="ident" id="4071431">Y</span><span class="op" id="4071432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4071435">return</span>&nbsp;<span class="op" id="4071442">&amp;</span><span class="ident" id="4071443">Alpha16</span><span class="op" id="4071450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071454">Pix</span><span class="op" id="4071457">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4071462">p</span><span class="op" id="4071463">.</span><span class="ident" id="4071464">Pix</span><span class="op" id="4071467">[</span><span class="ident" id="4071468">i</span><span class="op" id="4071469">:</span><span class="op" id="4071470">]</span><span class="op" id="4071471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071475">Stride</span><span class="op" id="4071481">:</span>&nbsp;<span class="ident" id="4071483">p</span><span class="op" id="4071484">.</span><span class="ident" id="4071485">Stride</span><span class="op" id="4071491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071495">Rect</span><span class="op" id="4071499">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4071503">r</span><span class="op" id="4071504">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4071507">}</span><br>
<span class="lineno"></span><span class="op" id="4071509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4071512">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4071585">func</span>&nbsp;<span class="op" id="4071590">(</span><span class="ident" id="4071591">p</span>&nbsp;<span class="op" id="4071593">*</span><span class="ident" id="4071594">Alpha16</span><span class="op" id="4071601">)</span>&nbsp;<span class="ident" id="4071603">Opaque</span><span class="op" id="4071609">(</span><span class="op" id="4071610">)</span>&nbsp;<span class="builtintype" id="4071612">bool</span>&nbsp;<span class="op" id="4071617">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4071620">if</span>&nbsp;<span class="ident" id="4071623">p</span><span class="op" id="4071624">.</span><span class="ident" id="4071625">Rect</span><span class="op" id="4071629">.</span><span class="ident" id="4071630">Empty</span><span class="op" id="4071635">(</span><span class="op" id="4071636">)</span>&nbsp;<span class="op" id="4071638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4071642">return</span>&nbsp;<span class="builtintype" id="4071649">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4071655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071658">i0</span><span class="op" id="4071660">,</span>&nbsp;<span class="ident" id="4071662">i1</span>&nbsp;<span class="op" id="4071665">:=</span>&nbsp;<span class="num" id="4071668">0</span><span class="op" id="4071669">,</span>&nbsp;<span class="ident" id="4071671">p</span><span class="op" id="4071672">.</span><span class="ident" id="4071673">Rect</span><span class="op" id="4071677">.</span><span class="ident" id="4071678">Dx</span><span class="op" id="4071680">(</span><span class="op" id="4071681">)</span><span class="op" id="4071682">*</span><span class="num" id="4071683">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4071686">for</span>&nbsp;<span class="ident" id="4071690">y</span>&nbsp;<span class="op" id="4071692">:=</span>&nbsp;<span class="ident" id="4071695">p</span><span class="op" id="4071696">.</span><span class="ident" id="4071697">Rect</span><span class="op" id="4071701">.</span><span class="ident" id="4071702">Min</span><span class="op" id="4071705">.</span><span class="ident" id="4071706">Y</span><span class="op" id="4071707">;</span>&nbsp;<span class="ident" id="4071709">y</span>&nbsp;<span class="op" id="4071711">&lt;</span>&nbsp;<span class="ident" id="4071713">p</span><span class="op" id="4071714">.</span><span class="ident" id="4071715">Rect</span><span class="op" id="4071719">.</span><span class="ident" id="4071720">Max</span><span class="op" id="4071723">.</span><span class="ident" id="4071724">Y</span><span class="op" id="4071725">;</span>&nbsp;<span class="ident" id="4071727">y</span><span class="op" id="4071728">++</span>&nbsp;<span class="op" id="4071731">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4071735">for</span>&nbsp;<span class="ident" id="4071739">i</span>&nbsp;<span class="op" id="4071741">:=</span>&nbsp;<span class="ident" id="4071744">i0</span><span class="op" id="4071746">;</span>&nbsp;<span class="ident" id="4071748">i</span>&nbsp;<span class="op" id="4071750">&lt;</span>&nbsp;<span class="ident" id="4071752">i1</span><span class="op" id="4071754">;</span>&nbsp;<span class="ident" id="4071756">i</span>&nbsp;<span class="op" id="4071758">+=</span>&nbsp;<span class="num" id="4071761">2</span>&nbsp;<span class="op" id="4071763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4071768">if</span>&nbsp;<span class="ident" id="4071771">p</span><span class="op" id="4071772">.</span><span class="ident" id="4071773">Pix</span><span class="op" id="4071776">[</span><span class="ident" id="4071777">i</span><span class="op" id="4071778">+</span><span class="num" id="4071779">0</span><span class="op" id="4071780">]</span>&nbsp;<span class="op" id="4071782">!=</span>&nbsp;<span class="num" id="4071785">0xff</span>&nbsp;<span class="op" id="4071790">||</span>&nbsp;<span class="ident" id="4071793">p</span><span class="op" id="4071794">.</span><span class="ident" id="4071795">Pix</span><span class="op" id="4071798">[</span><span class="ident" id="4071799">i</span><span class="op" id="4071800">+</span><span class="num" id="4071801">1</span><span class="op" id="4071802">]</span>&nbsp;<span class="op" id="4071804">!=</span>&nbsp;<span class="num" id="4071807">0xff</span>&nbsp;<span class="op" id="4071812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4071818">return</span>&nbsp;<span class="builtintype" id="4071825">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4071834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4071838">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071842">i0</span>&nbsp;<span class="op" id="4071845">+=</span>&nbsp;<span class="ident" id="4071848">p</span><span class="op" id="4071849">.</span><span class="ident" id="4071850">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071859">i1</span>&nbsp;<span class="op" id="4071862">+=</span>&nbsp;<span class="ident" id="4071865">p</span><span class="op" id="4071866">.</span><span class="ident" id="4071867">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4071875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4071878">return</span>&nbsp;<span class="builtintype" id="4071885">true</span><br>
<span class="lineno"></span><span class="op" id="4071890">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="4071893">//&nbsp;NewAlpha16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4071952">func</span>&nbsp;<span class="ident" id="4071957">NewAlpha16</span><span class="op" id="4071967">(</span><span class="ident" id="4071968">r</span>&nbsp;<span class="ident" id="4071970">Rectangle</span><span class="op" id="4071979">)</span>&nbsp;<span class="op" id="4071981">*</span><span class="ident" id="4071982">Alpha16</span>&nbsp;<span class="op" id="4071990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4071993">w</span><span class="op" id="4071994">,</span>&nbsp;<span class="ident" id="4071996">h</span>&nbsp;<span class="op" id="4071998">:=</span>&nbsp;<span class="ident" id="4072001">r</span><span class="op" id="4072002">.</span><span class="ident" id="4072003">Dx</span><span class="op" id="4072005">(</span><span class="op" id="4072006">)</span><span class="op" id="4072007">,</span>&nbsp;<span class="ident" id="4072009">r</span><span class="op" id="4072010">.</span><span class="ident" id="4072011">Dy</span><span class="op" id="4072013">(</span><span class="op" id="4072014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072017">pix</span>&nbsp;<span class="op" id="4072021">:=</span>&nbsp;<span class="builtinfunc" id="4072024">make</span><span class="op" id="4072028">(</span><span class="op" id="4072029">[</span><span class="op" id="4072030">]</span><span class="builtintype" id="4072031">uint8</span><span class="op" id="4072036">,</span>&nbsp;<span class="num" id="4072038">2</span><span class="op" id="4072039">*</span><span class="ident" id="4072040">w</span><span class="op" id="4072041">*</span><span class="ident" id="4072042">h</span><span class="op" id="4072043">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072046">return</span>&nbsp;<span class="op" id="4072053">&amp;</span><span class="ident" id="4072054">Alpha16</span><span class="op" id="4072061">{</span><span class="ident" id="4072062">pix</span><span class="op" id="4072065">,</span>&nbsp;<span class="num" id="4072067">2</span>&nbsp;<span class="op" id="4072069">*</span>&nbsp;<span class="ident" id="4072071">w</span><span class="op" id="4072072">,</span>&nbsp;<span class="ident" id="4072074">r</span><span class="op" id="4072075">}</span><br>
<span class="lineno"></span><span class="op" id="4072077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4072080">//&nbsp;Gray&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4072153">type</span>&nbsp;<span class="ident" id="4072158">Gray</span>&nbsp;<span class="keyword" id="4072163">struct</span>&nbsp;<span class="op" id="4072170">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4072173">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4072236">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072304">Pix</span>&nbsp;<span class="op" id="4072308">[</span><span class="op" id="4072309">]</span><span class="builtintype" id="4072310">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4072317">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072393">Stride</span>&nbsp;<span class="builtintype" id="4072400">int</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4072405">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072437">Rect</span>&nbsp;<span class="ident" id="4072442">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4072452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4072455">func</span>&nbsp;<span class="op" id="4072460">(</span><span class="ident" id="4072461">p</span>&nbsp;<span class="op" id="4072463">*</span><span class="ident" id="4072464">Gray</span><span class="op" id="4072468">)</span>&nbsp;<span class="ident" id="4072470">ColorModel</span><span class="op" id="4072480">(</span><span class="op" id="4072481">)</span>&nbsp;<span class="ident" id="4072483">color</span><span class="op" id="4072488">.</span><span class="ident" id="4072489">Model</span>&nbsp;<span class="op" id="4072495">{</span>&nbsp;<span class="keyword" id="4072497">return</span>&nbsp;<span class="ident" id="4072504">color</span><span class="op" id="4072509">.</span><span class="ident" id="4072510">GrayModel</span>&nbsp;<span class="op" id="4072520">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="4072523">func</span>&nbsp;<span class="op" id="4072528">(</span><span class="ident" id="4072529">p</span>&nbsp;<span class="op" id="4072531">*</span><span class="ident" id="4072532">Gray</span><span class="op" id="4072536">)</span>&nbsp;<span class="ident" id="4072538">Bounds</span><span class="op" id="4072544">(</span><span class="op" id="4072545">)</span>&nbsp;<span class="ident" id="4072547">Rectangle</span>&nbsp;<span class="op" id="4072557">{</span>&nbsp;<span class="keyword" id="4072559">return</span>&nbsp;<span class="ident" id="4072566">p</span><span class="op" id="4072567">.</span><span class="ident" id="4072568">Rect</span>&nbsp;<span class="op" id="4072573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4072576">func</span>&nbsp;<span class="op" id="4072581">(</span><span class="ident" id="4072582">p</span>&nbsp;<span class="op" id="4072584">*</span><span class="ident" id="4072585">Gray</span><span class="op" id="4072589">)</span>&nbsp;<span class="ident" id="4072591">At</span><span class="op" id="4072593">(</span><span class="ident" id="4072594">x</span><span class="op" id="4072595">,</span>&nbsp;<span class="ident" id="4072597">y</span>&nbsp;<span class="builtintype" id="4072599">int</span><span class="op" id="4072602">)</span>&nbsp;<span class="ident" id="4072604">color</span><span class="op" id="4072609">.</span><span class="ident" id="4072610">Color</span>&nbsp;<span class="op" id="4072616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072619">return</span>&nbsp;<span class="ident" id="4072626">p</span><span class="op" id="4072627">.</span><span class="ident" id="4072628">GrayAt</span><span class="op" id="4072634">(</span><span class="ident" id="4072635">x</span><span class="op" id="4072636">,</span>&nbsp;<span class="ident" id="4072638">y</span><span class="op" id="4072639">)</span><br>
<span class="lineno">685</span><span class="op" id="4072641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4072644">func</span>&nbsp;<span class="op" id="4072649">(</span><span class="ident" id="4072650">p</span>&nbsp;<span class="op" id="4072652">*</span><span class="ident" id="4072653">Gray</span><span class="op" id="4072657">)</span>&nbsp;<span class="ident" id="4072659">GrayAt</span><span class="op" id="4072665">(</span><span class="ident" id="4072666">x</span><span class="op" id="4072667">,</span>&nbsp;<span class="ident" id="4072669">y</span>&nbsp;<span class="builtintype" id="4072671">int</span><span class="op" id="4072674">)</span>&nbsp;<span class="ident" id="4072676">color</span><span class="op" id="4072681">.</span><span class="ident" id="4072682">Gray</span>&nbsp;<span class="op" id="4072687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072690">if</span>&nbsp;<span class="op" id="4072693">!</span><span class="op" id="4072694">(</span><span class="ident" id="4072695">Point</span><span class="op" id="4072700">{</span><span class="ident" id="4072701">x</span><span class="op" id="4072702">,</span>&nbsp;<span class="ident" id="4072704">y</span><span class="op" id="4072705">}</span><span class="op" id="4072706">.</span><span class="ident" id="4072707">In</span><span class="op" id="4072709">(</span><span class="ident" id="4072710">p</span><span class="op" id="4072711">.</span><span class="ident" id="4072712">Rect</span><span class="op" id="4072716">)</span><span class="op" id="4072717">)</span>&nbsp;<span class="op" id="4072719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072723">return</span>&nbsp;<span class="ident" id="4072730">color</span><span class="op" id="4072735">.</span><span class="ident" id="4072736">Gray</span><span class="op" id="4072740">{</span><span class="op" id="4072741">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4072744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4072747">i</span>&nbsp;<span class="op" id="4072749">:=</span>&nbsp;<span class="ident" id="4072752">p</span><span class="op" id="4072753">.</span><span class="ident" id="4072754">PixOffset</span><span class="op" id="4072763">(</span><span class="ident" id="4072764">x</span><span class="op" id="4072765">,</span>&nbsp;<span class="ident" id="4072767">y</span><span class="op" id="4072768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072771">return</span>&nbsp;<span class="ident" id="4072778">color</span><span class="op" id="4072783">.</span><span class="ident" id="4072784">Gray</span><span class="op" id="4072788">{</span><span class="ident" id="4072789">p</span><span class="op" id="4072790">.</span><span class="ident" id="4072791">Pix</span><span class="op" id="4072794">[</span><span class="ident" id="4072795">i</span><span class="op" id="4072796">]</span><span class="op" id="4072797">}</span><br>
<span class="lineno"></span><span class="op" id="4072799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="4072802">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4072881">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4072905">func</span>&nbsp;<span class="op" id="4072910">(</span><span class="ident" id="4072911">p</span>&nbsp;<span class="op" id="4072913">*</span><span class="ident" id="4072914">Gray</span><span class="op" id="4072918">)</span>&nbsp;<span class="ident" id="4072920">PixOffset</span><span class="op" id="4072929">(</span><span class="ident" id="4072930">x</span><span class="op" id="4072931">,</span>&nbsp;<span class="ident" id="4072933">y</span>&nbsp;<span class="builtintype" id="4072935">int</span><span class="op" id="4072938">)</span>&nbsp;<span class="builtintype" id="4072940">int</span>&nbsp;<span class="op" id="4072944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4072947">return</span>&nbsp;<span class="op" id="4072954">(</span><span class="ident" id="4072955">y</span><span class="op" id="4072956">-</span><span class="ident" id="4072957">p</span><span class="op" id="4072958">.</span><span class="ident" id="4072959">Rect</span><span class="op" id="4072963">.</span><span class="ident" id="4072964">Min</span><span class="op" id="4072967">.</span><span class="ident" id="4072968">Y</span><span class="op" id="4072969">)</span><span class="op" id="4072970">*</span><span class="ident" id="4072971">p</span><span class="op" id="4072972">.</span><span class="ident" id="4072973">Stride</span>&nbsp;<span class="op" id="4072980">+</span>&nbsp;<span class="op" id="4072982">(</span><span class="ident" id="4072983">x</span><span class="op" id="4072984">-</span><span class="ident" id="4072985">p</span><span class="op" id="4072986">.</span><span class="ident" id="4072987">Rect</span><span class="op" id="4072991">.</span><span class="ident" id="4072992">Min</span><span class="op" id="4072995">.</span><span class="ident" id="4072996">X</span><span class="op" id="4072997">)</span><span class="op" id="4072998">*</span><span class="num" id="4072999">1</span><br>
<span class="lineno"></span><span class="op" id="4073001">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="4073004">func</span>&nbsp;<span class="op" id="4073009">(</span><span class="ident" id="4073010">p</span>&nbsp;<span class="op" id="4073012">*</span><span class="ident" id="4073013">Gray</span><span class="op" id="4073017">)</span>&nbsp;<span class="ident" id="4073019">Set</span><span class="op" id="4073022">(</span><span class="ident" id="4073023">x</span><span class="op" id="4073024">,</span>&nbsp;<span class="ident" id="4073026">y</span>&nbsp;<span class="builtintype" id="4073028">int</span><span class="op" id="4073031">,</span>&nbsp;<span class="ident" id="4073033">c</span>&nbsp;<span class="ident" id="4073035">color</span><span class="op" id="4073040">.</span><span class="ident" id="4073041">Color</span><span class="op" id="4073046">)</span>&nbsp;<span class="op" id="4073048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073051">if</span>&nbsp;<span class="op" id="4073054">!</span><span class="op" id="4073055">(</span><span class="ident" id="4073056">Point</span><span class="op" id="4073061">{</span><span class="ident" id="4073062">x</span><span class="op" id="4073063">,</span>&nbsp;<span class="ident" id="4073065">y</span><span class="op" id="4073066">}</span><span class="op" id="4073067">.</span><span class="ident" id="4073068">In</span><span class="op" id="4073070">(</span><span class="ident" id="4073071">p</span><span class="op" id="4073072">.</span><span class="ident" id="4073073">Rect</span><span class="op" id="4073077">)</span><span class="op" id="4073078">)</span>&nbsp;<span class="op" id="4073080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073084">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073092">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073095">i</span>&nbsp;<span class="op" id="4073097">:=</span>&nbsp;<span class="ident" id="4073100">p</span><span class="op" id="4073101">.</span><span class="ident" id="4073102">PixOffset</span><span class="op" id="4073111">(</span><span class="ident" id="4073112">x</span><span class="op" id="4073113">,</span>&nbsp;<span class="ident" id="4073115">y</span><span class="op" id="4073116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073119">p</span><span class="op" id="4073120">.</span><span class="ident" id="4073121">Pix</span><span class="op" id="4073124">[</span><span class="ident" id="4073125">i</span><span class="op" id="4073126">]</span>&nbsp;<span class="op" id="4073128">=</span>&nbsp;<span class="ident" id="4073130">color</span><span class="op" id="4073135">.</span><span class="ident" id="4073136">GrayModel</span><span class="op" id="4073145">.</span><span class="ident" id="4073146">Convert</span><span class="op" id="4073153">(</span><span class="ident" id="4073154">c</span><span class="op" id="4073155">)</span><span class="op" id="4073156">.</span><span class="op" id="4073157">(</span><span class="ident" id="4073158">color</span><span class="op" id="4073163">.</span><span class="ident" id="4073164">Gray</span><span class="op" id="4073168">)</span><span class="op" id="4073169">.</span><span class="ident" id="4073170">Y</span><br>
<span class="lineno"></span><span class="op" id="4073172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4073175">func</span>&nbsp;<span class="op" id="4073180">(</span><span class="ident" id="4073181">p</span>&nbsp;<span class="op" id="4073183">*</span><span class="ident" id="4073184">Gray</span><span class="op" id="4073188">)</span>&nbsp;<span class="ident" id="4073190">SetGray</span><span class="op" id="4073197">(</span><span class="ident" id="4073198">x</span><span class="op" id="4073199">,</span>&nbsp;<span class="ident" id="4073201">y</span>&nbsp;<span class="builtintype" id="4073203">int</span><span class="op" id="4073206">,</span>&nbsp;<span class="ident" id="4073208">c</span>&nbsp;<span class="ident" id="4073210">color</span><span class="op" id="4073215">.</span><span class="ident" id="4073216">Gray</span><span class="op" id="4073220">)</span>&nbsp;<span class="op" id="4073222">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073225">if</span>&nbsp;<span class="op" id="4073228">!</span><span class="op" id="4073229">(</span><span class="ident" id="4073230">Point</span><span class="op" id="4073235">{</span><span class="ident" id="4073236">x</span><span class="op" id="4073237">,</span>&nbsp;<span class="ident" id="4073239">y</span><span class="op" id="4073240">}</span><span class="op" id="4073241">.</span><span class="ident" id="4073242">In</span><span class="op" id="4073244">(</span><span class="ident" id="4073245">p</span><span class="op" id="4073246">.</span><span class="ident" id="4073247">Rect</span><span class="op" id="4073251">)</span><span class="op" id="4073252">)</span>&nbsp;<span class="op" id="4073254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073258">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073269">i</span>&nbsp;<span class="op" id="4073271">:=</span>&nbsp;<span class="ident" id="4073274">p</span><span class="op" id="4073275">.</span><span class="ident" id="4073276">PixOffset</span><span class="op" id="4073285">(</span><span class="ident" id="4073286">x</span><span class="op" id="4073287">,</span>&nbsp;<span class="ident" id="4073289">y</span><span class="op" id="4073290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073293">p</span><span class="op" id="4073294">.</span><span class="ident" id="4073295">Pix</span><span class="op" id="4073298">[</span><span class="ident" id="4073299">i</span><span class="op" id="4073300">]</span>&nbsp;<span class="op" id="4073302">=</span>&nbsp;<span class="ident" id="4073304">c</span><span class="op" id="4073305">.</span><span class="ident" id="4073306">Y</span><br>
<span class="lineno">715</span><span class="op" id="4073308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4073311">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4073388">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4073460">func</span>&nbsp;<span class="op" id="4073465">(</span><span class="ident" id="4073466">p</span>&nbsp;<span class="op" id="4073468">*</span><span class="ident" id="4073469">Gray</span><span class="op" id="4073473">)</span>&nbsp;<span class="ident" id="4073475">SubImage</span><span class="op" id="4073483">(</span><span class="ident" id="4073484">r</span>&nbsp;<span class="ident" id="4073486">Rectangle</span><span class="op" id="4073495">)</span>&nbsp;<span class="ident" id="4073497">Image</span>&nbsp;<span class="op" id="4073503">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073506">r</span>&nbsp;<span class="op" id="4073508">=</span>&nbsp;<span class="ident" id="4073510">r</span><span class="op" id="4073511">.</span><span class="ident" id="4073512">Intersect</span><span class="op" id="4073521">(</span><span class="ident" id="4073522">p</span><span class="op" id="4073523">.</span><span class="ident" id="4073524">Rect</span><span class="op" id="4073528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4073531">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4073612">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4073694">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073744">if</span>&nbsp;<span class="ident" id="4073747">r</span><span class="op" id="4073748">.</span><span class="ident" id="4073749">Empty</span><span class="op" id="4073754">(</span><span class="op" id="4073755">)</span>&nbsp;<span class="op" id="4073757">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073761">return</span>&nbsp;<span class="op" id="4073768">&amp;</span><span class="ident" id="4073769">Gray</span><span class="op" id="4073773">{</span><span class="op" id="4073774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073780">i</span>&nbsp;<span class="op" id="4073782">:=</span>&nbsp;<span class="ident" id="4073785">p</span><span class="op" id="4073786">.</span><span class="ident" id="4073787">PixOffset</span><span class="op" id="4073796">(</span><span class="ident" id="4073797">r</span><span class="op" id="4073798">.</span><span class="ident" id="4073799">Min</span><span class="op" id="4073802">.</span><span class="ident" id="4073803">X</span><span class="op" id="4073804">,</span>&nbsp;<span class="ident" id="4073806">r</span><span class="op" id="4073807">.</span><span class="ident" id="4073808">Min</span><span class="op" id="4073811">.</span><span class="ident" id="4073812">Y</span><span class="op" id="4073813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073816">return</span>&nbsp;<span class="op" id="4073823">&amp;</span><span class="ident" id="4073824">Gray</span><span class="op" id="4073828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073832">Pix</span><span class="op" id="4073835">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4073840">p</span><span class="op" id="4073841">.</span><span class="ident" id="4073842">Pix</span><span class="op" id="4073845">[</span><span class="ident" id="4073846">i</span><span class="op" id="4073847">:</span><span class="op" id="4073848">]</span><span class="op" id="4073849">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073853">Stride</span><span class="op" id="4073859">:</span>&nbsp;<span class="ident" id="4073861">p</span><span class="op" id="4073862">.</span><span class="ident" id="4073863">Stride</span><span class="op" id="4073869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4073873">Rect</span><span class="op" id="4073877">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4073881">r</span><span class="op" id="4073882">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4073885">}</span><br>
<span class="lineno"></span><span class="op" id="4073887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span><span class="comment" id="4073890">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4073963">func</span>&nbsp;<span class="op" id="4073968">(</span><span class="ident" id="4073969">p</span>&nbsp;<span class="op" id="4073971">*</span><span class="ident" id="4073972">Gray</span><span class="op" id="4073976">)</span>&nbsp;<span class="ident" id="4073978">Opaque</span><span class="op" id="4073984">(</span><span class="op" id="4073985">)</span>&nbsp;<span class="builtintype" id="4073987">bool</span>&nbsp;<span class="op" id="4073992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4073995">return</span>&nbsp;<span class="builtintype" id="4074002">true</span><br>
<span class="lineno"></span><span class="op" id="4074007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="4074010">//&nbsp;NewGray&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4074063">func</span>&nbsp;<span class="ident" id="4074068">NewGray</span><span class="op" id="4074075">(</span><span class="ident" id="4074076">r</span>&nbsp;<span class="ident" id="4074078">Rectangle</span><span class="op" id="4074087">)</span>&nbsp;<span class="op" id="4074089">*</span><span class="ident" id="4074090">Gray</span>&nbsp;<span class="op" id="4074095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074098">w</span><span class="op" id="4074099">,</span>&nbsp;<span class="ident" id="4074101">h</span>&nbsp;<span class="op" id="4074103">:=</span>&nbsp;<span class="ident" id="4074106">r</span><span class="op" id="4074107">.</span><span class="ident" id="4074108">Dx</span><span class="op" id="4074110">(</span><span class="op" id="4074111">)</span><span class="op" id="4074112">,</span>&nbsp;<span class="ident" id="4074114">r</span><span class="op" id="4074115">.</span><span class="ident" id="4074116">Dy</span><span class="op" id="4074118">(</span><span class="op" id="4074119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074122">pix</span>&nbsp;<span class="op" id="4074126">:=</span>&nbsp;<span class="builtinfunc" id="4074129">make</span><span class="op" id="4074133">(</span><span class="op" id="4074134">[</span><span class="op" id="4074135">]</span><span class="builtintype" id="4074136">uint8</span><span class="op" id="4074141">,</span>&nbsp;<span class="num" id="4074143">1</span><span class="op" id="4074144">*</span><span class="ident" id="4074145">w</span><span class="op" id="4074146">*</span><span class="ident" id="4074147">h</span><span class="op" id="4074148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074151">return</span>&nbsp;<span class="op" id="4074158">&amp;</span><span class="ident" id="4074159">Gray</span><span class="op" id="4074163">{</span><span class="ident" id="4074164">pix</span><span class="op" id="4074167">,</span>&nbsp;<span class="num" id="4074169">1</span>&nbsp;<span class="op" id="4074171">*</span>&nbsp;<span class="ident" id="4074173">w</span><span class="op" id="4074174">,</span>&nbsp;<span class="ident" id="4074176">r</span><span class="op" id="4074177">}</span><br>
<span class="lineno">745</span><span class="op" id="4074179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4074182">//&nbsp;Gray16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray16&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4074259">type</span>&nbsp;<span class="ident" id="4074264">Gray16</span>&nbsp;<span class="keyword" id="4074271">struct</span>&nbsp;<span class="op" id="4074278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074281">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074365">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074433">Pix</span>&nbsp;<span class="op" id="4074437">[</span><span class="op" id="4074438">]</span><span class="builtintype" id="4074439">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074446">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074522">Stride</span>&nbsp;<span class="builtintype" id="4074529">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074534">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074566">Rect</span>&nbsp;<span class="ident" id="4074571">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="4074581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4074584">func</span>&nbsp;<span class="op" id="4074589">(</span><span class="ident" id="4074590">p</span>&nbsp;<span class="op" id="4074592">*</span><span class="ident" id="4074593">Gray16</span><span class="op" id="4074599">)</span>&nbsp;<span class="ident" id="4074601">ColorModel</span><span class="op" id="4074611">(</span><span class="op" id="4074612">)</span>&nbsp;<span class="ident" id="4074614">color</span><span class="op" id="4074619">.</span><span class="ident" id="4074620">Model</span>&nbsp;<span class="op" id="4074626">{</span>&nbsp;<span class="keyword" id="4074628">return</span>&nbsp;<span class="ident" id="4074635">color</span><span class="op" id="4074640">.</span><span class="ident" id="4074641">Gray16Model</span>&nbsp;<span class="op" id="4074653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span><span class="keyword" id="4074656">func</span>&nbsp;<span class="op" id="4074661">(</span><span class="ident" id="4074662">p</span>&nbsp;<span class="op" id="4074664">*</span><span class="ident" id="4074665">Gray16</span><span class="op" id="4074671">)</span>&nbsp;<span class="ident" id="4074673">Bounds</span><span class="op" id="4074679">(</span><span class="op" id="4074680">)</span>&nbsp;<span class="ident" id="4074682">Rectangle</span>&nbsp;<span class="op" id="4074692">{</span>&nbsp;<span class="keyword" id="4074694">return</span>&nbsp;<span class="ident" id="4074701">p</span><span class="op" id="4074702">.</span><span class="ident" id="4074703">Rect</span>&nbsp;<span class="op" id="4074708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4074711">func</span>&nbsp;<span class="op" id="4074716">(</span><span class="ident" id="4074717">p</span>&nbsp;<span class="op" id="4074719">*</span><span class="ident" id="4074720">Gray16</span><span class="op" id="4074726">)</span>&nbsp;<span class="ident" id="4074728">At</span><span class="op" id="4074730">(</span><span class="ident" id="4074731">x</span><span class="op" id="4074732">,</span>&nbsp;<span class="ident" id="4074734">y</span>&nbsp;<span class="builtintype" id="4074736">int</span><span class="op" id="4074739">)</span>&nbsp;<span class="ident" id="4074741">color</span><span class="op" id="4074746">.</span><span class="ident" id="4074747">Color</span>&nbsp;<span class="op" id="4074753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074756">return</span>&nbsp;<span class="ident" id="4074763">p</span><span class="op" id="4074764">.</span><span class="ident" id="4074765">Gray16At</span><span class="op" id="4074773">(</span><span class="ident" id="4074774">x</span><span class="op" id="4074775">,</span>&nbsp;<span class="ident" id="4074777">y</span><span class="op" id="4074778">)</span><br>
<span class="lineno"></span><span class="op" id="4074780">}</span><br>
<span class="lineno">765</span><br>
<span class="lineno"></span><span class="keyword" id="4074783">func</span>&nbsp;<span class="op" id="4074788">(</span><span class="ident" id="4074789">p</span>&nbsp;<span class="op" id="4074791">*</span><span class="ident" id="4074792">Gray16</span><span class="op" id="4074798">)</span>&nbsp;<span class="ident" id="4074800">Gray16At</span><span class="op" id="4074808">(</span><span class="ident" id="4074809">x</span><span class="op" id="4074810">,</span>&nbsp;<span class="ident" id="4074812">y</span>&nbsp;<span class="builtintype" id="4074814">int</span><span class="op" id="4074817">)</span>&nbsp;<span class="ident" id="4074819">color</span><span class="op" id="4074824">.</span><span class="ident" id="4074825">Gray16</span>&nbsp;<span class="op" id="4074832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074835">if</span>&nbsp;<span class="op" id="4074838">!</span><span class="op" id="4074839">(</span><span class="ident" id="4074840">Point</span><span class="op" id="4074845">{</span><span class="ident" id="4074846">x</span><span class="op" id="4074847">,</span>&nbsp;<span class="ident" id="4074849">y</span><span class="op" id="4074850">}</span><span class="op" id="4074851">.</span><span class="ident" id="4074852">In</span><span class="op" id="4074854">(</span><span class="ident" id="4074855">p</span><span class="op" id="4074856">.</span><span class="ident" id="4074857">Rect</span><span class="op" id="4074861">)</span><span class="op" id="4074862">)</span>&nbsp;<span class="op" id="4074864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074868">return</span>&nbsp;<span class="ident" id="4074875">color</span><span class="op" id="4074880">.</span><span class="ident" id="4074881">Gray16</span><span class="op" id="4074887">{</span><span class="op" id="4074888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4074891">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074894">i</span>&nbsp;<span class="op" id="4074896">:=</span>&nbsp;<span class="ident" id="4074899">p</span><span class="op" id="4074900">.</span><span class="ident" id="4074901">PixOffset</span><span class="op" id="4074910">(</span><span class="ident" id="4074911">x</span><span class="op" id="4074912">,</span>&nbsp;<span class="ident" id="4074914">y</span><span class="op" id="4074915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074918">return</span>&nbsp;<span class="ident" id="4074925">color</span><span class="op" id="4074930">.</span><span class="ident" id="4074931">Gray16</span><span class="op" id="4074937">{</span><span class="builtintype" id="4074938">uint16</span><span class="op" id="4074944">(</span><span class="ident" id="4074945">p</span><span class="op" id="4074946">.</span><span class="ident" id="4074947">Pix</span><span class="op" id="4074950">[</span><span class="ident" id="4074951">i</span><span class="op" id="4074952">+</span><span class="num" id="4074953">0</span><span class="op" id="4074954">]</span><span class="op" id="4074955">)</span><span class="op" id="4074956">&lt;&lt;</span><span class="num" id="4074958">8</span>&nbsp;<span class="op" id="4074960">|</span>&nbsp;<span class="builtintype" id="4074962">uint16</span><span class="op" id="4074968">(</span><span class="ident" id="4074969">p</span><span class="op" id="4074970">.</span><span class="ident" id="4074971">Pix</span><span class="op" id="4074974">[</span><span class="ident" id="4074975">i</span><span class="op" id="4074976">+</span><span class="num" id="4074977">1</span><span class="op" id="4074978">]</span><span class="op" id="4074979">)</span><span class="op" id="4074980">}</span><br>
<span class="lineno"></span><span class="op" id="4074982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4074985">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">775</span><span class="comment" id="4075064">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4075088">func</span>&nbsp;<span class="op" id="4075093">(</span><span class="ident" id="4075094">p</span>&nbsp;<span class="op" id="4075096">*</span><span class="ident" id="4075097">Gray16</span><span class="op" id="4075103">)</span>&nbsp;<span class="ident" id="4075105">PixOffset</span><span class="op" id="4075114">(</span><span class="ident" id="4075115">x</span><span class="op" id="4075116">,</span>&nbsp;<span class="ident" id="4075118">y</span>&nbsp;<span class="builtintype" id="4075120">int</span><span class="op" id="4075123">)</span>&nbsp;<span class="builtintype" id="4075125">int</span>&nbsp;<span class="op" id="4075129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075132">return</span>&nbsp;<span class="op" id="4075139">(</span><span class="ident" id="4075140">y</span><span class="op" id="4075141">-</span><span class="ident" id="4075142">p</span><span class="op" id="4075143">.</span><span class="ident" id="4075144">Rect</span><span class="op" id="4075148">.</span><span class="ident" id="4075149">Min</span><span class="op" id="4075152">.</span><span class="ident" id="4075153">Y</span><span class="op" id="4075154">)</span><span class="op" id="4075155">*</span><span class="ident" id="4075156">p</span><span class="op" id="4075157">.</span><span class="ident" id="4075158">Stride</span>&nbsp;<span class="op" id="4075165">+</span>&nbsp;<span class="op" id="4075167">(</span><span class="ident" id="4075168">x</span><span class="op" id="4075169">-</span><span class="ident" id="4075170">p</span><span class="op" id="4075171">.</span><span class="ident" id="4075172">Rect</span><span class="op" id="4075176">.</span><span class="ident" id="4075177">Min</span><span class="op" id="4075180">.</span><span class="ident" id="4075181">X</span><span class="op" id="4075182">)</span><span class="op" id="4075183">*</span><span class="num" id="4075184">2</span><br>
<span class="lineno"></span><span class="op" id="4075186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">780</span><span class="keyword" id="4075189">func</span>&nbsp;<span class="op" id="4075194">(</span><span class="ident" id="4075195">p</span>&nbsp;<span class="op" id="4075197">*</span><span class="ident" id="4075198">Gray16</span><span class="op" id="4075204">)</span>&nbsp;<span class="ident" id="4075206">Set</span><span class="op" id="4075209">(</span><span class="ident" id="4075210">x</span><span class="op" id="4075211">,</span>&nbsp;<span class="ident" id="4075213">y</span>&nbsp;<span class="builtintype" id="4075215">int</span><span class="op" id="4075218">,</span>&nbsp;<span class="ident" id="4075220">c</span>&nbsp;<span class="ident" id="4075222">color</span><span class="op" id="4075227">.</span><span class="ident" id="4075228">Color</span><span class="op" id="4075233">)</span>&nbsp;<span class="op" id="4075235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075238">if</span>&nbsp;<span class="op" id="4075241">!</span><span class="op" id="4075242">(</span><span class="ident" id="4075243">Point</span><span class="op" id="4075248">{</span><span class="ident" id="4075249">x</span><span class="op" id="4075250">,</span>&nbsp;<span class="ident" id="4075252">y</span><span class="op" id="4075253">}</span><span class="op" id="4075254">.</span><span class="ident" id="4075255">In</span><span class="op" id="4075257">(</span><span class="ident" id="4075258">p</span><span class="op" id="4075259">.</span><span class="ident" id="4075260">Rect</span><span class="op" id="4075264">)</span><span class="op" id="4075265">)</span>&nbsp;<span class="op" id="4075267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075271">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075282">i</span>&nbsp;<span class="op" id="4075284">:=</span>&nbsp;<span class="ident" id="4075287">p</span><span class="op" id="4075288">.</span><span class="ident" id="4075289">PixOffset</span><span class="op" id="4075298">(</span><span class="ident" id="4075299">x</span><span class="op" id="4075300">,</span>&nbsp;<span class="ident" id="4075302">y</span><span class="op" id="4075303">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075306">c1</span>&nbsp;<span class="op" id="4075309">:=</span>&nbsp;<span class="ident" id="4075312">color</span><span class="op" id="4075317">.</span><span class="ident" id="4075318">Gray16Model</span><span class="op" id="4075329">.</span><span class="ident" id="4075330">Convert</span><span class="op" id="4075337">(</span><span class="ident" id="4075338">c</span><span class="op" id="4075339">)</span><span class="op" id="4075340">.</span><span class="op" id="4075341">(</span><span class="ident" id="4075342">color</span><span class="op" id="4075347">.</span><span class="ident" id="4075348">Gray16</span><span class="op" id="4075354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075357">p</span><span class="op" id="4075358">.</span><span class="ident" id="4075359">Pix</span><span class="op" id="4075362">[</span><span class="ident" id="4075363">i</span><span class="op" id="4075364">+</span><span class="num" id="4075365">0</span><span class="op" id="4075366">]</span>&nbsp;<span class="op" id="4075368">=</span>&nbsp;<span class="builtintype" id="4075370">uint8</span><span class="op" id="4075375">(</span><span class="ident" id="4075376">c1</span><span class="op" id="4075378">.</span><span class="ident" id="4075379">Y</span>&nbsp;<span class="op" id="4075381">&gt;&gt;</span>&nbsp;<span class="num" id="4075384">8</span><span class="op" id="4075385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075388">p</span><span class="op" id="4075389">.</span><span class="ident" id="4075390">Pix</span><span class="op" id="4075393">[</span><span class="ident" id="4075394">i</span><span class="op" id="4075395">+</span><span class="num" id="4075396">1</span><span class="op" id="4075397">]</span>&nbsp;<span class="op" id="4075399">=</span>&nbsp;<span class="builtintype" id="4075401">uint8</span><span class="op" id="4075406">(</span><span class="ident" id="4075407">c1</span><span class="op" id="4075409">.</span><span class="ident" id="4075410">Y</span><span class="op" id="4075411">)</span><br>
<span class="lineno"></span><span class="op" id="4075413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span><span class="keyword" id="4075416">func</span>&nbsp;<span class="op" id="4075421">(</span><span class="ident" id="4075422">p</span>&nbsp;<span class="op" id="4075424">*</span><span class="ident" id="4075425">Gray16</span><span class="op" id="4075431">)</span>&nbsp;<span class="ident" id="4075433">SetGray16</span><span class="op" id="4075442">(</span><span class="ident" id="4075443">x</span><span class="op" id="4075444">,</span>&nbsp;<span class="ident" id="4075446">y</span>&nbsp;<span class="builtintype" id="4075448">int</span><span class="op" id="4075451">,</span>&nbsp;<span class="ident" id="4075453">c</span>&nbsp;<span class="ident" id="4075455">color</span><span class="op" id="4075460">.</span><span class="ident" id="4075461">Gray16</span><span class="op" id="4075467">)</span>&nbsp;<span class="op" id="4075469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075472">if</span>&nbsp;<span class="op" id="4075475">!</span><span class="op" id="4075476">(</span><span class="ident" id="4075477">Point</span><span class="op" id="4075482">{</span><span class="ident" id="4075483">x</span><span class="op" id="4075484">,</span>&nbsp;<span class="ident" id="4075486">y</span><span class="op" id="4075487">}</span><span class="op" id="4075488">.</span><span class="ident" id="4075489">In</span><span class="op" id="4075491">(</span><span class="ident" id="4075492">p</span><span class="op" id="4075493">.</span><span class="ident" id="4075494">Rect</span><span class="op" id="4075498">)</span><span class="op" id="4075499">)</span>&nbsp;<span class="op" id="4075501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4075505">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4075513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075516">i</span>&nbsp;<span class="op" id="4075518">:=</span>&nbsp;<span class="ident" id="4075521">p</span><span class="op" id="4075522">.</span><span class="ident" id="4075523">PixOffset</span><span class="op" id="4075532">(</span><span class="ident" id="4075533">x</span><span class="op" id="4075534">,</span>&nbsp;<span class="ident" id="4075536">y</span><span class="op" id="4075537">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075540">p</span><span class="op" id="4075541">.</span><span class="ident" id="4075542">Pix</span><span class="op" id="4075545">[</span><span class="ident" id="4075546">i</span><span class="op" id="4075547">+</span><span class="num" id="4075548">0</span><span class="op" id="4075549">]</span>&nbsp;<span class="op" id="4075551">=</span>&nbsp;<span class="builtintype" id="4075553">uint8</span><span class="op" id="4075558">(</span><span class="ident" id="4075559">c</span><span class="op" id="4075560">.</span><span class="ident" id="4075561">Y</span>&nbsp;<span class="op" id="4075563">&gt;&gt;</span>&nbsp;<span class="num" id="4075566">8</span><span class="op" id="4075567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075570">p</span><span class="op" id="4075571">.</span><span class="ident" id="4075572">Pix</span><span class="op" id="4075575">[</span><span class="ident" id="4075576">i</span><span class="op" id="4075577">+</span><span class="num" id="4075578">1</span><span class="op" id="4075579">]</span>&nbsp;<span class="op" id="4075581">=</span>&nbsp;<span class="builtintype" id="4075583">uint8</span><span class="op" id="4075588">(</span><span class="ident" id="4075589">c</span><span class="op" id="4075590">.</span><span class="ident" id="4075591">Y</span><span class="op" id="4075592">)</span><br>
<span class="lineno"></span><span class="op" id="4075594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4075597">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno">800</span><span class="comment" id="4075674">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4075746">func</span>&nbsp;<span class="op" id="4075751">(</span><span class="ident" id="4075752">p</span>&nbsp;<span class="op" id="4075754">*</span><span class="ident" id="4075755">Gray16</span><span class="op" id="4075761">)</span>&nbsp;<span class="ident" id="4075763">SubImage</span><span class="op" id="4075771">(</span><span class="ident" id="4075772">r</span>&nbsp;<span class="ident" id="4075774">Rectangle</span><span class="op" id="4075783">)</span>&nbsp;<span class="ident" id="4075785">Image</span>&nbsp;<span class="op" id="4075791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4075794">r</span>&nbsp;<span class="op" id="4075796">=</span>&nbsp;<span class="ident" id="4075798">r</span><span class="op" id="4075799">.</span><span class="ident" id="4075800">Intersect</span><span class="op" id="4075809">(</span><span class="ident" id="4075810">p</span><span class="op" id="4075811">.</span><span class="ident" id="4075812">Rect</span><span class="op" id="4075816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075819">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075900">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4075982">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076032">if</span>&nbsp;<span class="ident" id="4076035">r</span><span class="op" id="4076036">.</span><span class="ident" id="4076037">Empty</span><span class="op" id="4076042">(</span><span class="op" id="4076043">)</span>&nbsp;<span class="op" id="4076045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076049">return</span>&nbsp;<span class="op" id="4076056">&amp;</span><span class="ident" id="4076057">Gray16</span><span class="op" id="4076063">{</span><span class="op" id="4076064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4076067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076070">i</span>&nbsp;<span class="op" id="4076072">:=</span>&nbsp;<span class="ident" id="4076075">p</span><span class="op" id="4076076">.</span><span class="ident" id="4076077">PixOffset</span><span class="op" id="4076086">(</span><span class="ident" id="4076087">r</span><span class="op" id="4076088">.</span><span class="ident" id="4076089">Min</span><span class="op" id="4076092">.</span><span class="ident" id="4076093">X</span><span class="op" id="4076094">,</span>&nbsp;<span class="ident" id="4076096">r</span><span class="op" id="4076097">.</span><span class="ident" id="4076098">Min</span><span class="op" id="4076101">.</span><span class="ident" id="4076102">Y</span><span class="op" id="4076103">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076106">return</span>&nbsp;<span class="op" id="4076113">&amp;</span><span class="ident" id="4076114">Gray16</span><span class="op" id="4076120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076124">Pix</span><span class="op" id="4076127">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4076132">p</span><span class="op" id="4076133">.</span><span class="ident" id="4076134">Pix</span><span class="op" id="4076137">[</span><span class="ident" id="4076138">i</span><span class="op" id="4076139">:</span><span class="op" id="4076140">]</span><span class="op" id="4076141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076145">Stride</span><span class="op" id="4076151">:</span>&nbsp;<span class="ident" id="4076153">p</span><span class="op" id="4076154">.</span><span class="ident" id="4076155">Stride</span><span class="op" id="4076161">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076165">Rect</span><span class="op" id="4076169">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4076173">r</span><span class="op" id="4076174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4076177">}</span><br>
<span class="lineno">815</span><span class="op" id="4076179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4076182">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4076255">func</span>&nbsp;<span class="op" id="4076260">(</span><span class="ident" id="4076261">p</span>&nbsp;<span class="op" id="4076263">*</span><span class="ident" id="4076264">Gray16</span><span class="op" id="4076270">)</span>&nbsp;<span class="ident" id="4076272">Opaque</span><span class="op" id="4076278">(</span><span class="op" id="4076279">)</span>&nbsp;<span class="builtintype" id="4076281">bool</span>&nbsp;<span class="op" id="4076286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076289">return</span>&nbsp;<span class="builtintype" id="4076296">true</span><br>
<span class="lineno">820</span><span class="op" id="4076301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4076304">//&nbsp;NewGray16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="4076361">func</span>&nbsp;<span class="ident" id="4076366">NewGray16</span><span class="op" id="4076375">(</span><span class="ident" id="4076376">r</span>&nbsp;<span class="ident" id="4076378">Rectangle</span><span class="op" id="4076387">)</span>&nbsp;<span class="op" id="4076389">*</span><span class="ident" id="4076390">Gray16</span>&nbsp;<span class="op" id="4076397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076400">w</span><span class="op" id="4076401">,</span>&nbsp;<span class="ident" id="4076403">h</span>&nbsp;<span class="op" id="4076405">:=</span>&nbsp;<span class="ident" id="4076408">r</span><span class="op" id="4076409">.</span><span class="ident" id="4076410">Dx</span><span class="op" id="4076412">(</span><span class="op" id="4076413">)</span><span class="op" id="4076414">,</span>&nbsp;<span class="ident" id="4076416">r</span><span class="op" id="4076417">.</span><span class="ident" id="4076418">Dy</span><span class="op" id="4076420">(</span><span class="op" id="4076421">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076424">pix</span>&nbsp;<span class="op" id="4076428">:=</span>&nbsp;<span class="builtinfunc" id="4076431">make</span><span class="op" id="4076435">(</span><span class="op" id="4076436">[</span><span class="op" id="4076437">]</span><span class="builtintype" id="4076438">uint8</span><span class="op" id="4076443">,</span>&nbsp;<span class="num" id="4076445">2</span><span class="op" id="4076446">*</span><span class="ident" id="4076447">w</span><span class="op" id="4076448">*</span><span class="ident" id="4076449">h</span><span class="op" id="4076450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4076453">return</span>&nbsp;<span class="op" id="4076460">&amp;</span><span class="ident" id="4076461">Gray16</span><span class="op" id="4076467">{</span><span class="ident" id="4076468">pix</span><span class="op" id="4076471">,</span>&nbsp;<span class="num" id="4076473">2</span>&nbsp;<span class="op" id="4076475">*</span>&nbsp;<span class="ident" id="4076477">w</span><span class="op" id="4076478">,</span>&nbsp;<span class="ident" id="4076480">r</span><span class="op" id="4076481">}</span><br>
<span class="lineno"></span><span class="op" id="4076483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4076486">//&nbsp;Paletted&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;uint8&nbsp;indices&nbsp;into&nbsp;a&nbsp;given&nbsp;palette.</span><br>
<span class="lineno">830</span><span class="keyword" id="4076559">type</span>&nbsp;<span class="ident" id="4076564">Paletted</span>&nbsp;<span class="keyword" id="4076573">struct</span>&nbsp;<span class="op" id="4076580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4076583">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;palette&nbsp;indices.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4076650">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076718">Pix</span>&nbsp;<span class="op" id="4076722">[</span><span class="op" id="4076723">]</span><span class="builtintype" id="4076724">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4076731">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076807">Stride</span>&nbsp;<span class="builtintype" id="4076814">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4076819">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076851">Rect</span>&nbsp;<span class="ident" id="4076856">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4076867">//&nbsp;Palette&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4076903">Palette</span>&nbsp;<span class="ident" id="4076911">color</span><span class="op" id="4076916">.</span><span class="ident" id="4076917">Palette</span><br>
<span class="lineno">840</span><span class="op" id="4076925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4076928">func</span>&nbsp;<span class="op" id="4076933">(</span><span class="ident" id="4076934">p</span>&nbsp;<span class="op" id="4076936">*</span><span class="ident" id="4076937">Paletted</span><span class="op" id="4076945">)</span>&nbsp;<span class="ident" id="4076947">ColorModel</span><span class="op" id="4076957">(</span><span class="op" id="4076958">)</span>&nbsp;<span class="ident" id="4076960">color</span><span class="op" id="4076965">.</span><span class="ident" id="4076966">Model</span>&nbsp;<span class="op" id="4076972">{</span>&nbsp;<span class="keyword" id="4076974">return</span>&nbsp;<span class="ident" id="4076981">p</span><span class="op" id="4076982">.</span><span class="ident" id="4076983">Palette</span>&nbsp;<span class="op" id="4076991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4076994">func</span>&nbsp;<span class="op" id="4076999">(</span><span class="ident" id="4077000">p</span>&nbsp;<span class="op" id="4077002">*</span><span class="ident" id="4077003">Paletted</span><span class="op" id="4077011">)</span>&nbsp;<span class="ident" id="4077013">Bounds</span><span class="op" id="4077019">(</span><span class="op" id="4077020">)</span>&nbsp;<span class="ident" id="4077022">Rectangle</span>&nbsp;<span class="op" id="4077032">{</span>&nbsp;<span class="keyword" id="4077034">return</span>&nbsp;<span class="ident" id="4077041">p</span><span class="op" id="4077042">.</span><span class="ident" id="4077043">Rect</span>&nbsp;<span class="op" id="4077048">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="4077051">func</span>&nbsp;<span class="op" id="4077056">(</span><span class="ident" id="4077057">p</span>&nbsp;<span class="op" id="4077059">*</span><span class="ident" id="4077060">Paletted</span><span class="op" id="4077068">)</span>&nbsp;<span class="ident" id="4077070">At</span><span class="op" id="4077072">(</span><span class="ident" id="4077073">x</span><span class="op" id="4077074">,</span>&nbsp;<span class="ident" id="4077076">y</span>&nbsp;<span class="builtintype" id="4077078">int</span><span class="op" id="4077081">)</span>&nbsp;<span class="ident" id="4077083">color</span><span class="op" id="4077088">.</span><span class="ident" id="4077089">Color</span>&nbsp;<span class="op" id="4077095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077098">if</span>&nbsp;<span class="builtinfunc" id="4077101">len</span><span class="op" id="4077104">(</span><span class="ident" id="4077105">p</span><span class="op" id="4077106">.</span><span class="ident" id="4077107">Palette</span><span class="op" id="4077114">)</span>&nbsp;<span class="op" id="4077116">==</span>&nbsp;<span class="num" id="4077119">0</span>&nbsp;<span class="op" id="4077121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077125">return</span>&nbsp;<span class="ident" id="4077132">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077137">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077140">if</span>&nbsp;<span class="op" id="4077143">!</span><span class="op" id="4077144">(</span><span class="ident" id="4077145">Point</span><span class="op" id="4077150">{</span><span class="ident" id="4077151">x</span><span class="op" id="4077152">,</span>&nbsp;<span class="ident" id="4077154">y</span><span class="op" id="4077155">}</span><span class="op" id="4077156">.</span><span class="ident" id="4077157">In</span><span class="op" id="4077159">(</span><span class="ident" id="4077160">p</span><span class="op" id="4077161">.</span><span class="ident" id="4077162">Rect</span><span class="op" id="4077166">)</span><span class="op" id="4077167">)</span>&nbsp;<span class="op" id="4077169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077173">return</span>&nbsp;<span class="ident" id="4077180">p</span><span class="op" id="4077181">.</span><span class="ident" id="4077182">Palette</span><span class="op" id="4077189">[</span><span class="num" id="4077190">0</span><span class="op" id="4077191">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077197">i</span>&nbsp;<span class="op" id="4077199">:=</span>&nbsp;<span class="ident" id="4077202">p</span><span class="op" id="4077203">.</span><span class="ident" id="4077204">PixOffset</span><span class="op" id="4077213">(</span><span class="ident" id="4077214">x</span><span class="op" id="4077215">,</span>&nbsp;<span class="ident" id="4077217">y</span><span class="op" id="4077218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077221">return</span>&nbsp;<span class="ident" id="4077228">p</span><span class="op" id="4077229">.</span><span class="ident" id="4077230">Palette</span><span class="op" id="4077237">[</span><span class="ident" id="4077238">p</span><span class="op" id="4077239">.</span><span class="ident" id="4077240">Pix</span><span class="op" id="4077243">[</span><span class="ident" id="4077244">i</span><span class="op" id="4077245">]</span><span class="op" id="4077246">]</span><br>
<span class="lineno">855</span><span class="op" id="4077248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4077251">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4077330">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="4077354">func</span>&nbsp;<span class="op" id="4077359">(</span><span class="ident" id="4077360">p</span>&nbsp;<span class="op" id="4077362">*</span><span class="ident" id="4077363">Paletted</span><span class="op" id="4077371">)</span>&nbsp;<span class="ident" id="4077373">PixOffset</span><span class="op" id="4077382">(</span><span class="ident" id="4077383">x</span><span class="op" id="4077384">,</span>&nbsp;<span class="ident" id="4077386">y</span>&nbsp;<span class="builtintype" id="4077388">int</span><span class="op" id="4077391">)</span>&nbsp;<span class="builtintype" id="4077393">int</span>&nbsp;<span class="op" id="4077397">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077400">return</span>&nbsp;<span class="op" id="4077407">(</span><span class="ident" id="4077408">y</span><span class="op" id="4077409">-</span><span class="ident" id="4077410">p</span><span class="op" id="4077411">.</span><span class="ident" id="4077412">Rect</span><span class="op" id="4077416">.</span><span class="ident" id="4077417">Min</span><span class="op" id="4077420">.</span><span class="ident" id="4077421">Y</span><span class="op" id="4077422">)</span><span class="op" id="4077423">*</span><span class="ident" id="4077424">p</span><span class="op" id="4077425">.</span><span class="ident" id="4077426">Stride</span>&nbsp;<span class="op" id="4077433">+</span>&nbsp;<span class="op" id="4077435">(</span><span class="ident" id="4077436">x</span><span class="op" id="4077437">-</span><span class="ident" id="4077438">p</span><span class="op" id="4077439">.</span><span class="ident" id="4077440">Rect</span><span class="op" id="4077444">.</span><span class="ident" id="4077445">Min</span><span class="op" id="4077448">.</span><span class="ident" id="4077449">X</span><span class="op" id="4077450">)</span><span class="op" id="4077451">*</span><span class="num" id="4077452">1</span><br>
<span class="lineno"></span><span class="op" id="4077454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4077457">func</span>&nbsp;<span class="op" id="4077462">(</span><span class="ident" id="4077463">p</span>&nbsp;<span class="op" id="4077465">*</span><span class="ident" id="4077466">Paletted</span><span class="op" id="4077474">)</span>&nbsp;<span class="ident" id="4077476">Set</span><span class="op" id="4077479">(</span><span class="ident" id="4077480">x</span><span class="op" id="4077481">,</span>&nbsp;<span class="ident" id="4077483">y</span>&nbsp;<span class="builtintype" id="4077485">int</span><span class="op" id="4077488">,</span>&nbsp;<span class="ident" id="4077490">c</span>&nbsp;<span class="ident" id="4077492">color</span><span class="op" id="4077497">.</span><span class="ident" id="4077498">Color</span><span class="op" id="4077503">)</span>&nbsp;<span class="op" id="4077505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077508">if</span>&nbsp;<span class="op" id="4077511">!</span><span class="op" id="4077512">(</span><span class="ident" id="4077513">Point</span><span class="op" id="4077518">{</span><span class="ident" id="4077519">x</span><span class="op" id="4077520">,</span>&nbsp;<span class="ident" id="4077522">y</span><span class="op" id="4077523">}</span><span class="op" id="4077524">.</span><span class="ident" id="4077525">In</span><span class="op" id="4077527">(</span><span class="ident" id="4077528">p</span><span class="op" id="4077529">.</span><span class="ident" id="4077530">Rect</span><span class="op" id="4077534">)</span><span class="op" id="4077535">)</span>&nbsp;<span class="op" id="4077537">{</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077541">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077552">i</span>&nbsp;<span class="op" id="4077554">:=</span>&nbsp;<span class="ident" id="4077557">p</span><span class="op" id="4077558">.</span><span class="ident" id="4077559">PixOffset</span><span class="op" id="4077568">(</span><span class="ident" id="4077569">x</span><span class="op" id="4077570">,</span>&nbsp;<span class="ident" id="4077572">y</span><span class="op" id="4077573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077576">p</span><span class="op" id="4077577">.</span><span class="ident" id="4077578">Pix</span><span class="op" id="4077581">[</span><span class="ident" id="4077582">i</span><span class="op" id="4077583">]</span>&nbsp;<span class="op" id="4077585">=</span>&nbsp;<span class="builtintype" id="4077587">uint8</span><span class="op" id="4077592">(</span><span class="ident" id="4077593">p</span><span class="op" id="4077594">.</span><span class="ident" id="4077595">Palette</span><span class="op" id="4077602">.</span><span class="ident" id="4077603">Index</span><span class="op" id="4077608">(</span><span class="ident" id="4077609">c</span><span class="op" id="4077610">)</span><span class="op" id="4077611">)</span><br>
<span class="lineno"></span><span class="op" id="4077613">}</span><br>
<span class="lineno">870</span><br>
<span class="lineno"></span><span class="keyword" id="4077616">func</span>&nbsp;<span class="op" id="4077621">(</span><span class="ident" id="4077622">p</span>&nbsp;<span class="op" id="4077624">*</span><span class="ident" id="4077625">Paletted</span><span class="op" id="4077633">)</span>&nbsp;<span class="ident" id="4077635">ColorIndexAt</span><span class="op" id="4077647">(</span><span class="ident" id="4077648">x</span><span class="op" id="4077649">,</span>&nbsp;<span class="ident" id="4077651">y</span>&nbsp;<span class="builtintype" id="4077653">int</span><span class="op" id="4077656">)</span>&nbsp;<span class="builtintype" id="4077658">uint8</span>&nbsp;<span class="op" id="4077664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077667">if</span>&nbsp;<span class="op" id="4077670">!</span><span class="op" id="4077671">(</span><span class="ident" id="4077672">Point</span><span class="op" id="4077677">{</span><span class="ident" id="4077678">x</span><span class="op" id="4077679">,</span>&nbsp;<span class="ident" id="4077681">y</span><span class="op" id="4077682">}</span><span class="op" id="4077683">.</span><span class="ident" id="4077684">In</span><span class="op" id="4077686">(</span><span class="ident" id="4077687">p</span><span class="op" id="4077688">.</span><span class="ident" id="4077689">Rect</span><span class="op" id="4077693">)</span><span class="op" id="4077694">)</span>&nbsp;<span class="op" id="4077696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077700">return</span>&nbsp;<span class="num" id="4077707">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077710">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077713">i</span>&nbsp;<span class="op" id="4077715">:=</span>&nbsp;<span class="ident" id="4077718">p</span><span class="op" id="4077719">.</span><span class="ident" id="4077720">PixOffset</span><span class="op" id="4077729">(</span><span class="ident" id="4077730">x</span><span class="op" id="4077731">,</span>&nbsp;<span class="ident" id="4077733">y</span><span class="op" id="4077734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077737">return</span>&nbsp;<span class="ident" id="4077744">p</span><span class="op" id="4077745">.</span><span class="ident" id="4077746">Pix</span><span class="op" id="4077749">[</span><span class="ident" id="4077750">i</span><span class="op" id="4077751">]</span><br>
<span class="lineno"></span><span class="op" id="4077753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4077756">func</span>&nbsp;<span class="op" id="4077761">(</span><span class="ident" id="4077762">p</span>&nbsp;<span class="op" id="4077764">*</span><span class="ident" id="4077765">Paletted</span><span class="op" id="4077773">)</span>&nbsp;<span class="ident" id="4077775">SetColorIndex</span><span class="op" id="4077788">(</span><span class="ident" id="4077789">x</span><span class="op" id="4077790">,</span>&nbsp;<span class="ident" id="4077792">y</span>&nbsp;<span class="builtintype" id="4077794">int</span><span class="op" id="4077797">,</span>&nbsp;<span class="ident" id="4077799">index</span>&nbsp;<span class="builtintype" id="4077805">uint8</span><span class="op" id="4077810">)</span>&nbsp;<span class="op" id="4077812">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077815">if</span>&nbsp;<span class="op" id="4077818">!</span><span class="op" id="4077819">(</span><span class="ident" id="4077820">Point</span><span class="op" id="4077825">{</span><span class="ident" id="4077826">x</span><span class="op" id="4077827">,</span>&nbsp;<span class="ident" id="4077829">y</span><span class="op" id="4077830">}</span><span class="op" id="4077831">.</span><span class="ident" id="4077832">In</span><span class="op" id="4077834">(</span><span class="ident" id="4077835">p</span><span class="op" id="4077836">.</span><span class="ident" id="4077837">Rect</span><span class="op" id="4077841">)</span><span class="op" id="4077842">)</span>&nbsp;<span class="op" id="4077844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4077848">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4077856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077859">i</span>&nbsp;<span class="op" id="4077861">:=</span>&nbsp;<span class="ident" id="4077864">p</span><span class="op" id="4077865">.</span><span class="ident" id="4077866">PixOffset</span><span class="op" id="4077875">(</span><span class="ident" id="4077876">x</span><span class="op" id="4077877">,</span>&nbsp;<span class="ident" id="4077879">y</span><span class="op" id="4077880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4077883">p</span><span class="op" id="4077884">.</span><span class="ident" id="4077885">Pix</span><span class="op" id="4077888">[</span><span class="ident" id="4077889">i</span><span class="op" id="4077890">]</span>&nbsp;<span class="op" id="4077892">=</span>&nbsp;<span class="ident" id="4077894">index</span><br>
<span class="lineno">885</span><span class="op" id="4077900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4077903">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="4077980">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4078052">func</span>&nbsp;<span class="op" id="4078057">(</span><span class="ident" id="4078058">p</span>&nbsp;<span class="op" id="4078060">*</span><span class="ident" id="4078061">Paletted</span><span class="op" id="4078069">)</span>&nbsp;<span class="ident" id="4078071">SubImage</span><span class="op" id="4078079">(</span><span class="ident" id="4078080">r</span>&nbsp;<span class="ident" id="4078082">Rectangle</span><span class="op" id="4078091">)</span>&nbsp;<span class="ident" id="4078093">Image</span>&nbsp;<span class="op" id="4078099">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078102">r</span>&nbsp;<span class="op" id="4078104">=</span>&nbsp;<span class="ident" id="4078106">r</span><span class="op" id="4078107">.</span><span class="ident" id="4078108">Intersect</span><span class="op" id="4078117">(</span><span class="ident" id="4078118">p</span><span class="op" id="4078119">.</span><span class="ident" id="4078120">Rect</span><span class="op" id="4078124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078127">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078208">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4078290">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078340">if</span>&nbsp;<span class="ident" id="4078343">r</span><span class="op" id="4078344">.</span><span class="ident" id="4078345">Empty</span><span class="op" id="4078350">(</span><span class="op" id="4078351">)</span>&nbsp;<span class="op" id="4078353">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078357">return</span>&nbsp;<span class="op" id="4078364">&amp;</span><span class="ident" id="4078365">Paletted</span><span class="op" id="4078373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078378">Palette</span><span class="op" id="4078385">:</span>&nbsp;<span class="ident" id="4078387">p</span><span class="op" id="4078388">.</span><span class="ident" id="4078389">Palette</span><span class="op" id="4078396">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4078400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4078403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078406">i</span>&nbsp;<span class="op" id="4078408">:=</span>&nbsp;<span class="ident" id="4078411">p</span><span class="op" id="4078412">.</span><span class="ident" id="4078413">PixOffset</span><span class="op" id="4078422">(</span><span class="ident" id="4078423">r</span><span class="op" id="4078424">.</span><span class="ident" id="4078425">Min</span><span class="op" id="4078428">.</span><span class="ident" id="4078429">X</span><span class="op" id="4078430">,</span>&nbsp;<span class="ident" id="4078432">r</span><span class="op" id="4078433">.</span><span class="ident" id="4078434">Min</span><span class="op" id="4078437">.</span><span class="ident" id="4078438">Y</span><span class="op" id="4078439">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078442">return</span>&nbsp;<span class="op" id="4078449">&amp;</span><span class="ident" id="4078450">Paletted</span><span class="op" id="4078458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078462">Pix</span><span class="op" id="4078465">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4078471">p</span><span class="op" id="4078472">.</span><span class="ident" id="4078473">Pix</span><span class="op" id="4078476">[</span><span class="ident" id="4078477">i</span><span class="op" id="4078478">:</span><span class="op" id="4078479">]</span><span class="op" id="4078480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078484">Stride</span><span class="op" id="4078490">:</span>&nbsp;&nbsp;<span class="ident" id="4078493">p</span><span class="op" id="4078494">.</span><span class="ident" id="4078495">Stride</span><span class="op" id="4078501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078505">Rect</span><span class="op" id="4078509">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4078514">p</span><span class="op" id="4078515">.</span><span class="ident" id="4078516">Rect</span><span class="op" id="4078520">.</span><span class="ident" id="4078521">Intersect</span><span class="op" id="4078530">(</span><span class="ident" id="4078531">r</span><span class="op" id="4078532">)</span><span class="op" id="4078533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078537">Palette</span><span class="op" id="4078544">:</span>&nbsp;<span class="ident" id="4078546">p</span><span class="op" id="4078547">.</span><span class="ident" id="4078548">Palette</span><span class="op" id="4078555">,</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4078558">}</span><br>
<span class="lineno"></span><span class="op" id="4078560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4078563">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="4078636">func</span>&nbsp;<span class="op" id="4078641">(</span><span class="ident" id="4078642">p</span>&nbsp;<span class="op" id="4078644">*</span><span class="ident" id="4078645">Paletted</span><span class="op" id="4078653">)</span>&nbsp;<span class="ident" id="4078655">Opaque</span><span class="op" id="4078661">(</span><span class="op" id="4078662">)</span>&nbsp;<span class="builtintype" id="4078664">bool</span>&nbsp;<span class="op" id="4078669">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078672">var</span>&nbsp;<span class="ident" id="4078676">present</span>&nbsp;<span class="op" id="4078684">[</span><span class="num" id="4078685">256</span><span class="op" id="4078688">]</span><span class="builtintype" id="4078689">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078695">i0</span><span class="op" id="4078697">,</span>&nbsp;<span class="ident" id="4078699">i1</span>&nbsp;<span class="op" id="4078702">:=</span>&nbsp;<span class="num" id="4078705">0</span><span class="op" id="4078706">,</span>&nbsp;<span class="ident" id="4078708">p</span><span class="op" id="4078709">.</span><span class="ident" id="4078710">Rect</span><span class="op" id="4078714">.</span><span class="ident" id="4078715">Dx</span><span class="op" id="4078717">(</span><span class="op" id="4078718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078721">for</span>&nbsp;<span class="ident" id="4078725">y</span>&nbsp;<span class="op" id="4078727">:=</span>&nbsp;<span class="ident" id="4078730">p</span><span class="op" id="4078731">.</span><span class="ident" id="4078732">Rect</span><span class="op" id="4078736">.</span><span class="ident" id="4078737">Min</span><span class="op" id="4078740">.</span><span class="ident" id="4078741">Y</span><span class="op" id="4078742">;</span>&nbsp;<span class="ident" id="4078744">y</span>&nbsp;<span class="op" id="4078746">&lt;</span>&nbsp;<span class="ident" id="4078748">p</span><span class="op" id="4078749">.</span><span class="ident" id="4078750">Rect</span><span class="op" id="4078754">.</span><span class="ident" id="4078755">Max</span><span class="op" id="4078758">.</span><span class="ident" id="4078759">Y</span><span class="op" id="4078760">;</span>&nbsp;<span class="ident" id="4078762">y</span><span class="op" id="4078763">++</span>&nbsp;<span class="op" id="4078766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078770">for</span>&nbsp;<span class="ident" id="4078774">_</span><span class="op" id="4078775">,</span>&nbsp;<span class="ident" id="4078777">c</span>&nbsp;<span class="op" id="4078779">:=</span>&nbsp;<span class="keyword" id="4078782">range</span>&nbsp;<span class="ident" id="4078788">p</span><span class="op" id="4078789">.</span><span class="ident" id="4078790">Pix</span><span class="op" id="4078793">[</span><span class="ident" id="4078794">i0</span><span class="op" id="4078796">:</span><span class="ident" id="4078797">i1</span><span class="op" id="4078799">]</span>&nbsp;<span class="op" id="4078801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078806">present</span><span class="op" id="4078813">[</span><span class="ident" id="4078814">c</span><span class="op" id="4078815">]</span>&nbsp;<span class="op" id="4078817">=</span>&nbsp;<span class="builtintype" id="4078819">true</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4078826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078830">i0</span>&nbsp;<span class="op" id="4078833">+=</span>&nbsp;<span class="ident" id="4078836">p</span><span class="op" id="4078837">.</span><span class="ident" id="4078838">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078847">i1</span>&nbsp;<span class="op" id="4078850">+=</span>&nbsp;<span class="ident" id="4078853">p</span><span class="op" id="4078854">.</span><span class="ident" id="4078855">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4078863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078866">for</span>&nbsp;<span class="ident" id="4078870">i</span><span class="op" id="4078871">,</span>&nbsp;<span class="ident" id="4078873">c</span>&nbsp;<span class="op" id="4078875">:=</span>&nbsp;<span class="keyword" id="4078878">range</span>&nbsp;<span class="ident" id="4078884">p</span><span class="op" id="4078885">.</span><span class="ident" id="4078886">Palette</span>&nbsp;<span class="op" id="4078894">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078898">if</span>&nbsp;<span class="op" id="4078901">!</span><span class="ident" id="4078902">present</span><span class="op" id="4078909">[</span><span class="ident" id="4078910">i</span><span class="op" id="4078911">]</span>&nbsp;<span class="op" id="4078913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078918">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4078929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4078933">_</span><span class="op" id="4078934">,</span>&nbsp;<span class="ident" id="4078936">_</span><span class="op" id="4078937">,</span>&nbsp;<span class="ident" id="4078939">_</span><span class="op" id="4078940">,</span>&nbsp;<span class="ident" id="4078942">a</span>&nbsp;<span class="op" id="4078944">:=</span>&nbsp;<span class="ident" id="4078947">c</span><span class="op" id="4078948">.</span><span class="ident" id="4078949">RGBA</span><span class="op" id="4078953">(</span><span class="op" id="4078954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078958">if</span>&nbsp;<span class="ident" id="4078961">a</span>&nbsp;<span class="op" id="4078963">!=</span>&nbsp;<span class="num" id="4078966">0xffff</span>&nbsp;<span class="op" id="4078973">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078978">return</span>&nbsp;<span class="builtintype" id="4078985">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4078993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4078996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4078999">return</span>&nbsp;<span class="builtintype" id="4079006">true</span><br>
<span class="lineno"></span><span class="op" id="4079011">}</span><br>
<span class="lineno">930</span><br>
<span class="lineno"></span><span class="comment" id="4079014">//&nbsp;NewPaletted&nbsp;returns&nbsp;a&nbsp;new&nbsp;Paletted&nbsp;with&nbsp;the&nbsp;given&nbsp;width,&nbsp;height&nbsp;and&nbsp;palette.</span><br>
<span class="lineno"></span><span class="keyword" id="4079094">func</span>&nbsp;<span class="ident" id="4079099">NewPaletted</span><span class="op" id="4079110">(</span><span class="ident" id="4079111">r</span>&nbsp;<span class="ident" id="4079113">Rectangle</span><span class="op" id="4079122">,</span>&nbsp;<span class="ident" id="4079124">p</span>&nbsp;<span class="ident" id="4079126">color</span><span class="op" id="4079131">.</span><span class="ident" id="4079132">Palette</span><span class="op" id="4079139">)</span>&nbsp;<span class="op" id="4079141">*</span><span class="ident" id="4079142">Paletted</span>&nbsp;<span class="op" id="4079151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079154">w</span><span class="op" id="4079155">,</span>&nbsp;<span class="ident" id="4079157">h</span>&nbsp;<span class="op" id="4079159">:=</span>&nbsp;<span class="ident" id="4079162">r</span><span class="op" id="4079163">.</span><span class="ident" id="4079164">Dx</span><span class="op" id="4079166">(</span><span class="op" id="4079167">)</span><span class="op" id="4079168">,</span>&nbsp;<span class="ident" id="4079170">r</span><span class="op" id="4079171">.</span><span class="ident" id="4079172">Dy</span><span class="op" id="4079174">(</span><span class="op" id="4079175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4079178">pix</span>&nbsp;<span class="op" id="4079182">:=</span>&nbsp;<span class="builtinfunc" id="4079185">make</span><span class="op" id="4079189">(</span><span class="op" id="4079190">[</span><span class="op" id="4079191">]</span><span class="builtintype" id="4079192">uint8</span><span class="op" id="4079197">,</span>&nbsp;<span class="num" id="4079199">1</span><span class="op" id="4079200">*</span><span class="ident" id="4079201">w</span><span class="op" id="4079202">*</span><span class="ident" id="4079203">h</span><span class="op" id="4079204">)</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4079207">return</span>&nbsp;<span class="op" id="4079214">&amp;</span><span class="ident" id="4079215">Paletted</span><span class="op" id="4079223">{</span><span class="ident" id="4079224">pix</span><span class="op" id="4079227">,</span>&nbsp;<span class="num" id="4079229">1</span>&nbsp;<span class="op" id="4079231">*</span>&nbsp;<span class="ident" id="4079233">w</span><span class="op" id="4079234">,</span>&nbsp;<span class="ident" id="4079236">r</span><span class="op" id="4079237">,</span>&nbsp;<span class="ident" id="4079239">p</span><span class="op" id="4079240">}</span><br>
<span class="lineno"></span><span class="op" id="4079242">}</span>
</div>
</body>
</html>
