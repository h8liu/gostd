<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2570859">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2570914">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2570968">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2571019">package</span>&nbsp;<span class="ident" id="2571027">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2571031">import</span>&nbsp;<span class="string" id="2571038">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2571049">//&nbsp;Pipe&nbsp;returns&nbsp;a&nbsp;connected&nbsp;pair&nbsp;of&nbsp;Files;&nbsp;reads&nbsp;from&nbsp;r&nbsp;return&nbsp;bytes&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">10</span><span class="comment" id="2571132">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;files&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2571178">func</span>&nbsp;<span class="ident" id="2571183">Pipe</span><span class="op" id="2571187">(</span><span class="op" id="2571188">)</span>&nbsp;<span class="op" id="2571190">(</span><span class="ident" id="2571191">r</span>&nbsp;<span class="op" id="2571193">*</span><span class="ident" id="2571194">File</span><span class="op" id="2571198">,</span>&nbsp;<span class="ident" id="2571200">w</span>&nbsp;<span class="op" id="2571202">*</span><span class="ident" id="2571203">File</span><span class="op" id="2571207">,</span>&nbsp;<span class="ident" id="2571209">err</span>&nbsp;<span class="builtintype" id="2571213">error</span><span class="op" id="2571218">)</span>&nbsp;<span class="op" id="2571220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2571223">var</span>&nbsp;<span class="ident" id="2571227">p</span>&nbsp;<span class="op" id="2571229">[</span><span class="num" id="2571230">2</span><span class="op" id="2571231">]</span><span class="builtintype" id="2571232">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2571238">e</span>&nbsp;<span class="op" id="2571240">:=</span>&nbsp;<span class="ident" id="2571243">syscall</span><span class="op" id="2571250">.</span><span class="ident" id="2571251">Pipe2</span><span class="op" id="2571256">(</span><span class="ident" id="2571257">p</span><span class="op" id="2571258">[</span><span class="num" id="2571259">0</span><span class="op" id="2571260">:</span><span class="op" id="2571261">]</span><span class="op" id="2571262">,</span>&nbsp;<span class="ident" id="2571264">syscall</span><span class="op" id="2571271">.</span><span class="ident" id="2571272">O_CLOEXEC</span><span class="op" id="2571281">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2571284">//&nbsp;pipe2&nbsp;was&nbsp;added&nbsp;in&nbsp;2.6.27&nbsp;and&nbsp;our&nbsp;minimum&nbsp;requirement&nbsp;is&nbsp;2.6.23,&nbsp;so&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2571359">//&nbsp;might&nbsp;not&nbsp;be&nbsp;implemented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2571389">if</span>&nbsp;<span class="ident" id="2571392">e</span>&nbsp;<span class="op" id="2571394">==</span>&nbsp;<span class="ident" id="2571397">syscall</span><span class="op" id="2571404">.</span><span class="ident" id="2571405">ENOSYS</span>&nbsp;<span class="op" id="2571412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2571416">//&nbsp;See&nbsp;../syscall/exec.go&nbsp;for&nbsp;description&nbsp;of&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2571469">syscall</span><span class="op" id="2571476">.</span><span class="ident" id="2571477">ForkLock</span><span class="op" id="2571485">.</span><span class="ident" id="2571486">RLock</span><span class="op" id="2571491">(</span><span class="op" id="2571492">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2571496">e</span>&nbsp;<span class="op" id="2571498">=</span>&nbsp;<span class="ident" id="2571500">syscall</span><span class="op" id="2571507">.</span><span class="ident" id="2571508">Pipe</span><span class="op" id="2571512">(</span><span class="ident" id="2571513">p</span><span class="op" id="2571514">[</span><span class="num" id="2571515">0</span><span class="op" id="2571516">:</span><span class="op" id="2571517">]</span><span class="op" id="2571518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2571522">if</span>&nbsp;<span class="ident" id="2571525">e</span>&nbsp;<span class="op" id="2571527">!=</span>&nbsp;<span class="ident" id="2571530">nil</span>&nbsp;<span class="op" id="2571534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2571539">syscall</span><span class="op" id="2571546">.</span><span class="ident" id="2571547">ForkLock</span><span class="op" id="2571555">.</span><span class="ident" id="2571556">RUnlock</span><span class="op" id="2571563">(</span><span class="op" id="2571564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2571569">return</span>&nbsp;<span class="ident" id="2571576">nil</span><span class="op" id="2571579">,</span>&nbsp;<span class="ident" id="2571581">nil</span><span class="op" id="2571584">,</span>&nbsp;<span class="ident" id="2571586">NewSyscallError</span><span class="op" id="2571601">(</span><span class="string" id="2571602">&#34;pipe&#34;</span><span class="op" id="2571608">,</span>&nbsp;<span class="ident" id="2571610">e</span><span class="op" id="2571611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2571615">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2571619">syscall</span><span class="op" id="2571626">.</span><span class="ident" id="2571627">CloseOnExec</span><span class="op" id="2571638">(</span><span class="ident" id="2571639">p</span><span class="op" id="2571640">[</span><span class="num" id="2571641">0</span><span class="op" id="2571642">]</span><span class="op" id="2571643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2571647">syscall</span><span class="op" id="2571654">.</span><span class="ident" id="2571655">CloseOnExec</span><span class="op" id="2571666">(</span><span class="ident" id="2571667">p</span><span class="op" id="2571668">[</span><span class="num" id="2571669">1</span><span class="op" id="2571670">]</span><span class="op" id="2571671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2571675">syscall</span><span class="op" id="2571682">.</span><span class="ident" id="2571683">ForkLock</span><span class="op" id="2571691">.</span><span class="ident" id="2571692">RUnlock</span><span class="op" id="2571699">(</span><span class="op" id="2571700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2571703">}</span>&nbsp;<span class="keyword" id="2571705">else</span>&nbsp;<span class="keyword" id="2571710">if</span>&nbsp;<span class="ident" id="2571713">e</span>&nbsp;<span class="op" id="2571715">!=</span>&nbsp;<span class="ident" id="2571718">nil</span>&nbsp;<span class="op" id="2571722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2571726">return</span>&nbsp;<span class="ident" id="2571733">nil</span><span class="op" id="2571736">,</span>&nbsp;<span class="ident" id="2571738">nil</span><span class="op" id="2571741">,</span>&nbsp;<span class="ident" id="2571743">NewSyscallError</span><span class="op" id="2571758">(</span><span class="string" id="2571759">&#34;pipe2&#34;</span><span class="op" id="2571766">,</span>&nbsp;<span class="ident" id="2571768">e</span><span class="op" id="2571769">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2571772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2571776">return</span>&nbsp;<span class="ident" id="2571783">NewFile</span><span class="op" id="2571790">(</span><span class="builtintype" id="2571791">uintptr</span><span class="op" id="2571798">(</span><span class="ident" id="2571799">p</span><span class="op" id="2571800">[</span><span class="num" id="2571801">0</span><span class="op" id="2571802">]</span><span class="op" id="2571803">)</span><span class="op" id="2571804">,</span>&nbsp;<span class="string" id="2571806">&#34;|0&#34;</span><span class="op" id="2571810">)</span><span class="op" id="2571811">,</span>&nbsp;<span class="ident" id="2571813">NewFile</span><span class="op" id="2571820">(</span><span class="builtintype" id="2571821">uintptr</span><span class="op" id="2571828">(</span><span class="ident" id="2571829">p</span><span class="op" id="2571830">[</span><span class="num" id="2571831">1</span><span class="op" id="2571832">]</span><span class="op" id="2571833">)</span><span class="op" id="2571834">,</span>&nbsp;<span class="string" id="2571836">&#34;|1&#34;</span><span class="op" id="2571840">)</span><span class="op" id="2571841">,</span>&nbsp;<span class="ident" id="2571843">nil</span><br>
<span class="lineno"></span><span class="op" id="2571847">}</span>
</div>
</body>
</html>
