<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5771869">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5771925">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5771979">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5772030">//&nbsp;Package&nbsp;jsonrpc&nbsp;implements&nbsp;a&nbsp;JSON-RPC&nbsp;ClientCodec&nbsp;and&nbsp;ServerCodec</span><br>
<span class="lineno"></span><span class="comment" id="5772099">//&nbsp;for&nbsp;the&nbsp;rpc&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="5772123">package</span>&nbsp;<span class="ident" id="5772131">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5772140">import</span>&nbsp;<span class="op" id="5772147">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5772150">&#34;encoding/json&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5772167">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5772174">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5772180">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5772187">&#34;net/rpc&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5772198">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5772205">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5772208">type</span>&nbsp;<span class="ident" id="5772213">clientCodec</span>&nbsp;<span class="keyword" id="5772225">struct</span>&nbsp;<span class="op" id="5772232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772235">dec</span>&nbsp;<span class="op" id="5772239">*</span><span class="ident" id="5772240"><a href="/net/rpc/jsonrpc/client.go.html#5772150">json</a></span><span class="op" id="5772244">.</span><span class="ident" id="5772245">Decoder</span>&nbsp;<span class="comment" id="5772253">//&nbsp;for&nbsp;reading&nbsp;JSON&nbsp;values</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772281">enc</span>&nbsp;<span class="op" id="5772285">*</span><span class="ident" id="5772286"><a href="/net/rpc/jsonrpc/client.go.html#5772150">json</a></span><span class="op" id="5772290">.</span><span class="ident" id="5772291">Encoder</span>&nbsp;<span class="comment" id="5772299">//&nbsp;for&nbsp;writing&nbsp;JSON&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772327">c</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5772331"><a href="/net/rpc/jsonrpc/client.go.html#5772174">io</a></span><span class="op" id="5772333">.</span><span class="ident" id="5772334">Closer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772343">//&nbsp;temporary&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772368">req</span>&nbsp;&nbsp;<span class="ident" id="5772373"><a href="/net/rpc/jsonrpc/client.go.html#5773050">clientRequest</a></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772388">resp</span>&nbsp;<span class="ident" id="5772393"><a href="/net/rpc/jsonrpc/client.go.html#5773449">clientResponse</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772410">//&nbsp;JSON-RPC&nbsp;responses&nbsp;include&nbsp;the&nbsp;request&nbsp;id&nbsp;but&nbsp;not&nbsp;the&nbsp;request&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772484">//&nbsp;Package&nbsp;rpc&nbsp;expects&nbsp;both.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772514">//&nbsp;We&nbsp;save&nbsp;the&nbsp;request&nbsp;method&nbsp;in&nbsp;pending&nbsp;when&nbsp;sending&nbsp;a&nbsp;request</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5772579">//&nbsp;and&nbsp;then&nbsp;look&nbsp;it&nbsp;up&nbsp;by&nbsp;request&nbsp;ID&nbsp;when&nbsp;filling&nbsp;out&nbsp;the&nbsp;rpc&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772652">mutex</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5772660"><a href="/net/rpc/jsonrpc/client.go.html#5772198">sync</a></span><span class="op" id="5772664">.</span><span class="ident" id="5772665">Mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5772678">//&nbsp;protects&nbsp;pending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772699">pending</span>&nbsp;<span class="keyword" id="5772707">map</span><span class="op" id="5772710">[</span><span class="ident" id="5772711">uint64</span><span class="op" id="5772717">]</span><span class="builtintype" id="5772718">string</span>&nbsp;<span class="comment" id="5772725">//&nbsp;map&nbsp;request&nbsp;id&nbsp;to&nbsp;method&nbsp;name</span><br>
<span class="lineno"></span><span class="op" id="5772758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5772761">//&nbsp;NewClientCodec&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.ClientCodec&nbsp;using&nbsp;JSON-RPC&nbsp;on&nbsp;conn.</span><br>
<span class="lineno"></span><span class="keyword" id="5772833">func</span>&nbsp;<span class="ident" id="5772838">NewClientCodec</span><span class="op" id="5772852">(</span><span class="ident" id="5772853">conn</span>&nbsp;<span class="ident" id="5772858"><a href="/net/rpc/jsonrpc/client.go.html#5772174">io</a></span><span class="op" id="5772860">.</span><span class="ident" id="5772861">ReadWriteCloser</span><span class="op" id="5772876">)</span>&nbsp;<span class="ident" id="5772878"><a href="/net/rpc/jsonrpc/client.go.html#5772187">rpc</a></span><span class="op" id="5772881">.</span><span class="ident" id="5772882">ClientCodec</span>&nbsp;<span class="op" id="5772894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5772897">return</span>&nbsp;<span class="op" id="5772904">&amp;</span><span class="ident" id="5772905"><a href="/net/rpc/jsonrpc/client.go.html#5772213">clientCodec</a></span><span class="op" id="5772916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772920">dec</span><span class="op" id="5772923">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5772929"><a href="/net/rpc/jsonrpc/client.go.html#5772150">json</a></span><span class="op" id="5772933">.</span><span class="ident" id="5772934">NewDecoder</span><span class="op" id="5772944">(</span><span class="ident" id="5772945"><a href="/net/rpc/jsonrpc/client.go.html#5772853">conn</a></span><span class="op" id="5772949">)</span><span class="op" id="5772950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772954">enc</span><span class="op" id="5772957">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5772963"><a href="/net/rpc/jsonrpc/client.go.html#5772150">json</a></span><span class="op" id="5772967">.</span><span class="ident" id="5772968">NewEncoder</span><span class="op" id="5772978">(</span><span class="ident" id="5772979"><a href="/net/rpc/jsonrpc/client.go.html#5772853">conn</a></span><span class="op" id="5772983">)</span><span class="op" id="5772984">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5772988">c</span><span class="op" id="5772989">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5772997"><a href="/net/rpc/jsonrpc/client.go.html#5772853">conn</a></span><span class="op" id="5773001">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773005">pending</span><span class="op" id="5773012">:</span>&nbsp;<span class="builtinfunc" id="5773014">make</span><span class="op" id="5773018">(</span><span class="keyword" id="5773019">map</span><span class="op" id="5773022">[</span><span class="ident" id="5773023">uint64</span><span class="op" id="5773029">]</span><span class="builtintype" id="5773030">string</span><span class="op" id="5773036">)</span><span class="op" id="5773037">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5773040">}</span><br>
<span class="lineno"></span><span class="op" id="5773042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="5773045">type</span>&nbsp;<span class="ident" id="5773050">clientRequest</span>&nbsp;<span class="keyword" id="5773064">struct</span>&nbsp;<span class="op" id="5773071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773074">Method</span>&nbsp;<span class="builtintype" id="5773081">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5773096">`json:&#34;method&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773113">Params</span>&nbsp;<span class="op" id="5773120">[</span><span class="num" id="5773121">1</span><span class="op" id="5773122">]</span><span class="keyword" id="5773123">interface</span><span class="op" id="5773132">{</span><span class="op" id="5773133">}</span>&nbsp;<span class="string" id="5773135">`json:&#34;params&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773152">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5773159">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5773174">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span><span class="op" id="5773186">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5773189">func</span>&nbsp;<span class="op" id="5773194">(</span><span class="ident" id="5773195">c</span>&nbsp;<span class="op" id="5773197">*</span><span class="ident" id="5773198"><a href="/net/rpc/jsonrpc/client.go.html#5772213">clientCodec</a></span><span class="op" id="5773209">)</span>&nbsp;<span class="ident" id="5773211">WriteRequest</span><span class="op" id="5773223">(</span><span class="ident" id="5773224">r</span>&nbsp;<span class="op" id="5773226">*</span><span class="ident" id="5773227"><a href="/net/rpc/jsonrpc/client.go.html#5772187">rpc</a></span><span class="op" id="5773230">.</span><span class="ident" id="5773231">Request</span><span class="op" id="5773238">,</span>&nbsp;<span class="ident" id="5773240">param</span>&nbsp;<span class="keyword" id="5773246">interface</span><span class="op" id="5773255">{</span><span class="op" id="5773256">}</span><span class="op" id="5773257">)</span>&nbsp;<span class="builtintype" id="5773259">error</span>&nbsp;<span class="op" id="5773265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773268"><a href="/net/rpc/jsonrpc/client.go.html#5773195">c</a></span><span class="op" id="5773269">.</span><span class="ident" id="5773270">mutex</span><span class="op" id="5773275">.</span><span class="ident" id="5773276">Lock</span><span class="op" id="5773280">(</span><span class="op" id="5773281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773284"><a href="/net/rpc/jsonrpc/client.go.html#5773195">c</a></span><span class="op" id="5773285">.</span><span class="ident" id="5773286">pending</span><span class="op" id="5773293">[</span><span class="ident" id="5773294"><a href="/net/rpc/jsonrpc/client.go.html#5773224">r</a></span><span class="op" id="5773295">.</span><span class="ident" id="5773296">Seq</span><span class="op" id="5773299">]</span>&nbsp;<span class="op" id="5773301">=</span>&nbsp;<span class="ident" id="5773303"><a href="/net/rpc/jsonrpc/client.go.html#5773224">r</a></span><span class="op" id="5773304">.</span><span class="ident" id="5773305">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773320"><a href="/net/rpc/jsonrpc/client.go.html#5773195">c</a></span><span class="op" id="5773321">.</span><span class="ident" id="5773322">mutex</span><span class="op" id="5773327">.</span><span class="ident" id="5773328">Unlock</span><span class="op" id="5773334">(</span><span class="op" id="5773335">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773338"><a href="/net/rpc/jsonrpc/client.go.html#5773195">c</a></span><span class="op" id="5773339">.</span><span class="ident" id="5773340">req</span><span class="op" id="5773343">.</span><span class="ident" id="5773344">Method</span>&nbsp;<span class="op" id="5773351">=</span>&nbsp;<span class="ident" id="5773353"><a href="/net/rpc/jsonrpc/client.go.html#5773224">r</a></span><span class="op" id="5773354">.</span><span class="ident" id="5773355">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773370"><a href="/net/rpc/jsonrpc/client.go.html#5773195">c</a></span><span class="op" id="5773371">.</span><span class="ident" id="5773372">req</span><span class="op" id="5773375">.</span><span class="ident" id="5773376">Params</span><span class="op" id="5773382">[</span><span class="num" id="5773383">0</span><span class="op" id="5773384">]</span>&nbsp;<span class="op" id="5773386">=</span>&nbsp;<span class="ident" id="5773388"><a href="/net/rpc/jsonrpc/client.go.html#5773240">param</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773395"><a href="/net/rpc/jsonrpc/client.go.html#5773195">c</a></span><span class="op" id="5773396">.</span><span class="ident" id="5773397">req</span><span class="op" id="5773400">.</span><span class="ident" id="5773401">Id</span>&nbsp;<span class="op" id="5773404">=</span>&nbsp;<span class="ident" id="5773406"><a href="/net/rpc/jsonrpc/client.go.html#5773224">r</a></span><span class="op" id="5773407">.</span><span class="ident" id="5773408">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773413">return</span>&nbsp;<span class="ident" id="5773420"><a href="/net/rpc/jsonrpc/client.go.html#5773195">c</a></span><span class="op" id="5773421">.</span><span class="ident" id="5773422">enc</span><span class="op" id="5773425">.</span><span class="ident" id="5773426">Encode</span><span class="op" id="5773432">(</span><span class="op" id="5773433">&amp;</span><span class="ident" id="5773434"><a href="/net/rpc/jsonrpc/client.go.html#5773195">c</a></span><span class="op" id="5773435">.</span><span class="ident" id="5773436">req</span><span class="op" id="5773439">)</span><br>
<span class="lineno"></span><span class="op" id="5773441">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="5773444">type</span>&nbsp;<span class="ident" id="5773449">clientResponse</span>&nbsp;<span class="keyword" id="5773464">struct</span>&nbsp;<span class="op" id="5773471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773474">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5773481">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5773498">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773511">Result</span>&nbsp;<span class="op" id="5773518">*</span><span class="ident" id="5773519"><a href="/net/rpc/jsonrpc/client.go.html#5772150">json</a></span><span class="op" id="5773523">.</span><span class="ident" id="5773524">RawMessage</span>&nbsp;<span class="string" id="5773535">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773552">Error</span>&nbsp;&nbsp;<span class="keyword" id="5773559">interface</span><span class="op" id="5773568">{</span><span class="op" id="5773569">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5773576">`json:&#34;error&#34;`</span><br>
<span class="lineno">65</span><span class="op" id="5773591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5773594">func</span>&nbsp;<span class="op" id="5773599">(</span><span class="ident" id="5773600">r</span>&nbsp;<span class="op" id="5773602">*</span><span class="ident" id="5773603"><a href="/net/rpc/jsonrpc/client.go.html#5773449">clientResponse</a></span><span class="op" id="5773617">)</span>&nbsp;<span class="ident" id="5773619">reset</span><span class="op" id="5773624">(</span><span class="op" id="5773625">)</span>&nbsp;<span class="op" id="5773627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773630"><a href="/net/rpc/jsonrpc/client.go.html#5773600">r</a></span><span class="op" id="5773631">.</span><span class="ident" id="5773632">Id</span>&nbsp;<span class="op" id="5773635">=</span>&nbsp;<span class="num" id="5773637">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773640"><a href="/net/rpc/jsonrpc/client.go.html#5773600">r</a></span><span class="op" id="5773641">.</span><span class="ident" id="5773642">Result</span>&nbsp;<span class="op" id="5773649">=</span>&nbsp;<span class="ident" id="5773651">nil</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773656"><a href="/net/rpc/jsonrpc/client.go.html#5773600">r</a></span><span class="op" id="5773657">.</span><span class="ident" id="5773658">Error</span>&nbsp;<span class="op" id="5773664">=</span>&nbsp;<span class="ident" id="5773666">nil</span><br>
<span class="lineno"></span><span class="op" id="5773670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5773673">func</span>&nbsp;<span class="op" id="5773678">(</span><span class="ident" id="5773679">c</span>&nbsp;<span class="op" id="5773681">*</span><span class="ident" id="5773682"><a href="/net/rpc/jsonrpc/client.go.html#5772213">clientCodec</a></span><span class="op" id="5773693">)</span>&nbsp;<span class="ident" id="5773695">ReadResponseHeader</span><span class="op" id="5773713">(</span><span class="ident" id="5773714">r</span>&nbsp;<span class="op" id="5773716">*</span><span class="ident" id="5773717"><a href="/net/rpc/jsonrpc/client.go.html#5772187">rpc</a></span><span class="op" id="5773720">.</span><span class="ident" id="5773721">Response</span><span class="op" id="5773729">)</span>&nbsp;<span class="builtintype" id="5773731">error</span>&nbsp;<span class="op" id="5773737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773740"><a href="/net/rpc/jsonrpc/client.go.html#5773679">c</a></span><span class="op" id="5773741">.</span><span class="ident" id="5773742">resp</span><span class="op" id="5773746">.</span><span class="ident" id="5773747">reset</span><span class="op" id="5773752">(</span><span class="op" id="5773753">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773756">if</span>&nbsp;<span class="ident" id="5773759">err</span>&nbsp;<span class="op" id="5773763">:=</span>&nbsp;<span class="ident" id="5773766"><a href="/net/rpc/jsonrpc/client.go.html#5773679">c</a></span><span class="op" id="5773767">.</span><span class="ident" id="5773768">dec</span><span class="op" id="5773771">.</span><span class="ident" id="5773772">Decode</span><span class="op" id="5773778">(</span><span class="op" id="5773779">&amp;</span><span class="ident" id="5773780"><a href="/net/rpc/jsonrpc/client.go.html#5773679">c</a></span><span class="op" id="5773781">.</span><span class="ident" id="5773782">resp</span><span class="op" id="5773786">)</span><span class="op" id="5773787">;</span>&nbsp;<span class="ident" id="5773789"><a href="/net/rpc/jsonrpc/client.go.html#5773759">err</a></span>&nbsp;<span class="op" id="5773793">!=</span>&nbsp;<span class="ident" id="5773796">nil</span>&nbsp;<span class="op" id="5773800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773804">return</span>&nbsp;<span class="ident" id="5773811"><a href="/net/rpc/jsonrpc/client.go.html#5773759">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5773816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773820"><a href="/net/rpc/jsonrpc/client.go.html#5773679">c</a></span><span class="op" id="5773821">.</span><span class="ident" id="5773822">mutex</span><span class="op" id="5773827">.</span><span class="ident" id="5773828">Lock</span><span class="op" id="5773832">(</span><span class="op" id="5773833">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773836"><a href="/net/rpc/jsonrpc/client.go.html#5773714">r</a></span><span class="op" id="5773837">.</span><span class="ident" id="5773838">ServiceMethod</span>&nbsp;<span class="op" id="5773852">=</span>&nbsp;<span class="ident" id="5773854"><a href="/net/rpc/jsonrpc/client.go.html#5773679">c</a></span><span class="op" id="5773855">.</span><span class="ident" id="5773856">pending</span><span class="op" id="5773863">[</span><span class="ident" id="5773864"><a href="/net/rpc/jsonrpc/client.go.html#5773679">c</a></span><span class="op" id="5773865">.</span><span class="ident" id="5773866">resp</span><span class="op" id="5773870">.</span><span class="ident" id="5773871">Id</span><span class="op" id="5773873">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5773876">delete</span><span class="op" id="5773882">(</span><span class="ident" id="5773883"><a href="/net/rpc/jsonrpc/client.go.html#5773679">c</a></span><span class="op" id="5773884">.</span><span class="ident" id="5773885">pending</span><span class="op" id="5773892">,</span>&nbsp;<span class="ident" id="5773894"><a href="/net/rpc/jsonrpc/client.go.html#5773679">c</a></span><span class="op" id="5773895">.</span><span class="ident" id="5773896">resp</span><span class="op" id="5773900">.</span><span class="ident" id="5773901">Id</span><span class="op" id="5773903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773906"><a href="/net/rpc/jsonrpc/client.go.html#5773679">c</a></span><span class="op" id="5773907">.</span><span class="ident" id="5773908">mutex</span><span class="op" id="5773913">.</span><span class="ident" id="5773914">Unlock</span><span class="op" id="5773920">(</span><span class="op" id="5773921">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773925"><a href="/net/rpc/jsonrpc/client.go.html#5773714">r</a></span><span class="op" id="5773926">.</span><span class="ident" id="5773927">Error</span>&nbsp;<span class="op" id="5773933">=</span>&nbsp;<span class="string" id="5773935">&#34;&#34;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5773939"><a href="/net/rpc/jsonrpc/client.go.html#5773714">r</a></span><span class="op" id="5773940">.</span><span class="ident" id="5773941">Seq</span>&nbsp;<span class="op" id="5773945">=</span>&nbsp;<span class="ident" id="5773947"><a href="/net/rpc/jsonrpc/client.go.html#5773679">c</a></span><span class="op" id="5773948">.</span><span class="ident" id="5773949">resp</span><span class="op" id="5773953">.</span><span class="ident" id="5773954">Id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5773958">if</span>&nbsp;<span class="ident" id="5773961"><a href="/net/rpc/jsonrpc/client.go.html#5773679">c</a></span><span class="op" id="5773962">.</span><span class="ident" id="5773963">resp</span><span class="op" id="5773967">.</span><span class="ident" id="5773968">Error</span>&nbsp;<span class="op" id="5773974">!=</span>&nbsp;<span class="ident" id="5773977">nil</span>&nbsp;<span class="op" id="5773981">||</span>&nbsp;<span class="ident" id="5773984"><a href="/net/rpc/jsonrpc/client.go.html#5773679">c</a></span><span class="op" id="5773985">.</span><span class="ident" id="5773986">resp</span><span class="op" id="5773990">.</span><span class="ident" id="5773991">Result</span>&nbsp;<span class="op" id="5773998">==</span>&nbsp;<span class="ident" id="5774001">nil</span>&nbsp;<span class="op" id="5774005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774009">x</span><span class="op" id="5774010">,</span>&nbsp;<span class="ident" id="5774012">ok</span>&nbsp;<span class="op" id="5774015">:=</span>&nbsp;<span class="ident" id="5774018"><a href="/net/rpc/jsonrpc/client.go.html#5773679">c</a></span><span class="op" id="5774019">.</span><span class="ident" id="5774020">resp</span><span class="op" id="5774024">.</span><span class="ident" id="5774025">Error</span><span class="op" id="5774030">.</span><span class="op" id="5774031">(</span><span class="builtintype" id="5774032">string</span><span class="op" id="5774038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774042">if</span>&nbsp;<span class="op" id="5774045">!</span><span class="ident" id="5774046"><a href="/net/rpc/jsonrpc/client.go.html#5774012">ok</a></span>&nbsp;<span class="op" id="5774049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774054">return</span>&nbsp;<span class="ident" id="5774061"><a href="/net/rpc/jsonrpc/client.go.html#5772167">fmt</a></span><span class="op" id="5774064">.</span><span class="ident" id="5774065">Errorf</span><span class="op" id="5774071">(</span><span class="string" id="5774072">&#34;invalid&nbsp;error&nbsp;%v&#34;</span><span class="op" id="5774090">,</span>&nbsp;<span class="ident" id="5774092"><a href="/net/rpc/jsonrpc/client.go.html#5773679">c</a></span><span class="op" id="5774093">.</span><span class="ident" id="5774094">resp</span><span class="op" id="5774098">.</span><span class="ident" id="5774099">Error</span><span class="op" id="5774104">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774112">if</span>&nbsp;<span class="ident" id="5774115"><a href="/net/rpc/jsonrpc/client.go.html#5774009">x</a></span>&nbsp;<span class="op" id="5774117">==</span>&nbsp;<span class="string" id="5774120">&#34;&#34;</span>&nbsp;<span class="op" id="5774123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774128"><a href="/net/rpc/jsonrpc/client.go.html#5774009">x</a></span>&nbsp;<span class="op" id="5774130">=</span>&nbsp;<span class="string" id="5774132">&#34;unspecified&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774158"><a href="/net/rpc/jsonrpc/client.go.html#5773714">r</a></span><span class="op" id="5774159">.</span><span class="ident" id="5774160">Error</span>&nbsp;<span class="op" id="5774166">=</span>&nbsp;<span class="ident" id="5774168"><a href="/net/rpc/jsonrpc/client.go.html#5774009">x</a></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774174">return</span>&nbsp;<span class="ident" id="5774181">nil</span><br>
<span class="lineno"></span><span class="op" id="5774185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5774188">func</span>&nbsp;<span class="op" id="5774193">(</span><span class="ident" id="5774194">c</span>&nbsp;<span class="op" id="5774196">*</span><span class="ident" id="5774197"><a href="/net/rpc/jsonrpc/client.go.html#5772213">clientCodec</a></span><span class="op" id="5774208">)</span>&nbsp;<span class="ident" id="5774210">ReadResponseBody</span><span class="op" id="5774226">(</span><span class="ident" id="5774227">x</span>&nbsp;<span class="keyword" id="5774229">interface</span><span class="op" id="5774238">{</span><span class="op" id="5774239">}</span><span class="op" id="5774240">)</span>&nbsp;<span class="builtintype" id="5774242">error</span>&nbsp;<span class="op" id="5774248">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774251">if</span>&nbsp;<span class="ident" id="5774254"><a href="/net/rpc/jsonrpc/client.go.html#5774227">x</a></span>&nbsp;<span class="op" id="5774256">==</span>&nbsp;<span class="ident" id="5774259">nil</span>&nbsp;<span class="op" id="5774263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774267">return</span>&nbsp;<span class="ident" id="5774274">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774282">return</span>&nbsp;<span class="ident" id="5774289"><a href="/net/rpc/jsonrpc/client.go.html#5772150">json</a></span><span class="op" id="5774293">.</span><span class="ident" id="5774294">Unmarshal</span><span class="op" id="5774303">(</span><span class="op" id="5774304">*</span><span class="ident" id="5774305"><a href="/net/rpc/jsonrpc/client.go.html#5774194">c</a></span><span class="op" id="5774306">.</span><span class="ident" id="5774307">resp</span><span class="op" id="5774311">.</span><span class="ident" id="5774312">Result</span><span class="op" id="5774318">,</span>&nbsp;<span class="ident" id="5774320"><a href="/net/rpc/jsonrpc/client.go.html#5774227">x</a></span><span class="op" id="5774321">)</span><br>
<span class="lineno"></span><span class="op" id="5774323">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="5774326">func</span>&nbsp;<span class="op" id="5774331">(</span><span class="ident" id="5774332">c</span>&nbsp;<span class="op" id="5774334">*</span><span class="ident" id="5774335"><a href="/net/rpc/jsonrpc/client.go.html#5772213">clientCodec</a></span><span class="op" id="5774346">)</span>&nbsp;<span class="ident" id="5774348">Close</span><span class="op" id="5774353">(</span><span class="op" id="5774354">)</span>&nbsp;<span class="builtintype" id="5774356">error</span>&nbsp;<span class="op" id="5774362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774365">return</span>&nbsp;<span class="ident" id="5774372"><a href="/net/rpc/jsonrpc/client.go.html#5774332">c</a></span><span class="op" id="5774373">.</span><span class="ident" id="5774374">c</span><span class="op" id="5774375">.</span><span class="ident" id="5774376">Close</span><span class="op" id="5774381">(</span><span class="op" id="5774382">)</span><br>
<span class="lineno"></span><span class="op" id="5774384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="5774387">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5774451">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5774506">func</span>&nbsp;<span class="ident" id="5774511">NewClient</span><span class="op" id="5774520">(</span><span class="ident" id="5774521">conn</span>&nbsp;<span class="ident" id="5774526"><a href="/net/rpc/jsonrpc/client.go.html#5772174">io</a></span><span class="op" id="5774528">.</span><span class="ident" id="5774529">ReadWriteCloser</span><span class="op" id="5774544">)</span>&nbsp;<span class="op" id="5774546">*</span><span class="ident" id="5774547"><a href="/net/rpc/jsonrpc/client.go.html#5772187">rpc</a></span><span class="op" id="5774550">.</span><span class="ident" id="5774551">Client</span>&nbsp;<span class="op" id="5774558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774561">return</span>&nbsp;<span class="ident" id="5774568"><a href="/net/rpc/jsonrpc/client.go.html#5772187">rpc</a></span><span class="op" id="5774571">.</span><span class="ident" id="5774572">NewClientWithCodec</span><span class="op" id="5774590">(</span><span class="ident" id="5774591"><a href="/net/rpc/jsonrpc/client.go.html#5772838">NewClientCodec</a></span><span class="op" id="5774605">(</span><span class="ident" id="5774606"><a href="/net/rpc/jsonrpc/client.go.html#5774521">conn</a></span><span class="op" id="5774610">)</span><span class="op" id="5774611">)</span><br>
<span class="lineno"></span><span class="op" id="5774613">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="5774616">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;a&nbsp;JSON-RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5774688">func</span>&nbsp;<span class="ident" id="5774693">Dial</span><span class="op" id="5774697">(</span><span class="ident" id="5774698">network</span><span class="op" id="5774705">,</span>&nbsp;<span class="ident" id="5774707">address</span>&nbsp;<span class="builtintype" id="5774715">string</span><span class="op" id="5774721">)</span>&nbsp;<span class="op" id="5774723">(</span><span class="op" id="5774724">*</span><span class="ident" id="5774725"><a href="/net/rpc/jsonrpc/client.go.html#5772187">rpc</a></span><span class="op" id="5774728">.</span><span class="ident" id="5774729">Client</span><span class="op" id="5774735">,</span>&nbsp;<span class="builtintype" id="5774737">error</span><span class="op" id="5774742">)</span>&nbsp;<span class="op" id="5774744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774747">conn</span><span class="op" id="5774751">,</span>&nbsp;<span class="ident" id="5774753">err</span>&nbsp;<span class="op" id="5774757">:=</span>&nbsp;<span class="ident" id="5774760"><a href="/net/rpc/jsonrpc/client.go.html#5772180">net</a></span><span class="op" id="5774763">.</span><span class="ident" id="5774764">Dial</span><span class="op" id="5774768">(</span><span class="ident" id="5774769"><a href="/net/rpc/jsonrpc/client.go.html#5774698">network</a></span><span class="op" id="5774776">,</span>&nbsp;<span class="ident" id="5774778"><a href="/net/rpc/jsonrpc/client.go.html#5774707">address</a></span><span class="op" id="5774785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774788">if</span>&nbsp;<span class="ident" id="5774791"><a href="/net/rpc/jsonrpc/client.go.html#5774753">err</a></span>&nbsp;<span class="op" id="5774795">!=</span>&nbsp;<span class="ident" id="5774798">nil</span>&nbsp;<span class="op" id="5774802">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774806">return</span>&nbsp;<span class="ident" id="5774813">nil</span><span class="op" id="5774816">,</span>&nbsp;<span class="ident" id="5774818"><a href="/net/rpc/jsonrpc/client.go.html#5774753">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5774823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5774826">return</span>&nbsp;<span class="ident" id="5774833"><a href="/net/rpc/jsonrpc/client.go.html#5774511">NewClient</a></span><span class="op" id="5774842">(</span><span class="ident" id="5774843"><a href="/net/rpc/jsonrpc/client.go.html#5774747">conn</a></span><span class="op" id="5774847">)</span><span class="op" id="5774848">,</span>&nbsp;<span class="ident" id="5774850"><a href="/net/rpc/jsonrpc/client.go.html#5774753">err</a></span><br>
<span class="lineno"></span><span class="op" id="5774854">}</span>
</div>
</body>
</html>
