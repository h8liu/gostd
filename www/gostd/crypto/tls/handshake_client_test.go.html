<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html" class="current">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8454602">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8454657">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8454711">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8454762">package</span>&nbsp;<span class="ident" id="8454770">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8454775">import</span>&nbsp;<span class="op" id="8454782">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454785">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454794">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454810">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454824">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454839">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454855">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454862">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454868">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454875">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454881">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454892">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454909">&#34;strconv&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454920">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8454931">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8454938">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8454941">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno">25</span><span class="comment" id="8455016">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8455032">//&nbsp;blockingSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;blocks&nbsp;a&nbsp;Read&nbsp;call&nbsp;until&nbsp;it&#39;s&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="8455109">type</span>&nbsp;<span class="ident" id="8455114">blockingSource</span>&nbsp;<span class="keyword" id="8455129">chan</span>&nbsp;<span class="builtintype" id="8455134">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8455140">func</span>&nbsp;<span class="op" id="8455145">(</span><span class="ident" id="8455146">b</span>&nbsp;<span class="ident" id="8455148">blockingSource</span><span class="op" id="8455162">)</span>&nbsp;<span class="ident" id="8455164">Read</span><span class="op" id="8455168">(</span><span class="op" id="8455169">[</span><span class="op" id="8455170">]</span><span class="builtintype" id="8455171">byte</span><span class="op" id="8455175">)</span>&nbsp;<span class="op" id="8455177">(</span><span class="ident" id="8455178">n</span>&nbsp;<span class="builtintype" id="8455180">int</span><span class="op" id="8455183">,</span>&nbsp;<span class="ident" id="8455185">err</span>&nbsp;<span class="builtintype" id="8455189">error</span><span class="op" id="8455194">)</span>&nbsp;<span class="op" id="8455196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8455199">&lt;-</span><span class="ident" id="8455201">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8455204">return</span>&nbsp;<span class="num" id="8455211">0</span><span class="op" id="8455212">,</span>&nbsp;<span class="ident" id="8455214">io</span><span class="op" id="8455216">.</span><span class="ident" id="8455217">EOF</span><br>
<span class="lineno"></span><span class="op" id="8455221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="8455224">//&nbsp;clientTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;client&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="8455304">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="8455323">type</span>&nbsp;<span class="ident" id="8455328">clientTest</span>&nbsp;<span class="keyword" id="8455339">struct</span>&nbsp;<span class="op" id="8455346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8455349">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8455422">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455463">name</span>&nbsp;<span class="builtintype" id="8455468">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8455476">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8455542">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455587">command</span>&nbsp;<span class="op" id="8455595">[</span><span class="op" id="8455596">]</span><span class="builtintype" id="8455597">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8455605">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455676">config</span>&nbsp;<span class="op" id="8455683">*</span><span class="ident" id="8455684">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8455692">//&nbsp;cert,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;DER-encoded&nbsp;certificate&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8455759">//&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455781">cert</span>&nbsp;<span class="op" id="8455786">[</span><span class="op" id="8455787">]</span><span class="builtintype" id="8455788">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8455794">//&nbsp;key,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;either&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8455852">//&nbsp;*ecdsa.PrivateKey&nbsp;which&nbsp;is&nbsp;the&nbsp;private&nbsp;key&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8455925">key</span>&nbsp;<span class="keyword" id="8455929">interface</span><span class="op" id="8455938">{</span><span class="op" id="8455939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8455942">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8456011">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;a&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8456081">//&nbsp;error&nbsp;if&nbsp;the&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456131">validate</span>&nbsp;<span class="keyword" id="8456140">func</span><span class="op" id="8456144">(</span><span class="ident" id="8456145">ConnectionState</span><span class="op" id="8456160">)</span>&nbsp;<span class="builtintype" id="8456162">error</span><br>
<span class="lineno"></span><span class="op" id="8456168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8456171">var</span>&nbsp;<span class="ident" id="8456175">defaultServerCommand</span>&nbsp;<span class="op" id="8456196">=</span>&nbsp;<span class="op" id="8456198">[</span><span class="op" id="8456199">]</span><span class="builtintype" id="8456200">string</span><span class="op" id="8456206">{</span><span class="string" id="8456207">&#34;openssl&#34;</span><span class="op" id="8456216">,</span>&nbsp;<span class="string" id="8456218">&#34;s_server&#34;</span><span class="op" id="8456228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="8456231">//&nbsp;connFromCommand&nbsp;starts&nbsp;the&nbsp;reference&nbsp;server&nbsp;process,&nbsp;connects&nbsp;to&nbsp;it&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="8456306">//&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;for&nbsp;the&nbsp;connection.&nbsp;The&nbsp;stdin&nbsp;return&nbsp;value&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="8456381">//&nbsp;blockingSource&nbsp;for&nbsp;the&nbsp;stdin&nbsp;of&nbsp;the&nbsp;child&nbsp;process.&nbsp;It&nbsp;must&nbsp;be&nbsp;closed&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="8456460">//&nbsp;Waiting&nbsp;for&nbsp;child.</span><br>
<span class="lineno"></span><span class="keyword" id="8456482">func</span>&nbsp;<span class="op" id="8456487">(</span><span class="ident" id="8456488">test</span>&nbsp;<span class="op" id="8456493">*</span><span class="ident" id="8456494">clientTest</span><span class="op" id="8456504">)</span>&nbsp;<span class="ident" id="8456506">connFromCommand</span><span class="op" id="8456521">(</span><span class="op" id="8456522">)</span>&nbsp;<span class="op" id="8456524">(</span><span class="ident" id="8456525">conn</span>&nbsp;<span class="op" id="8456530">*</span><span class="ident" id="8456531">recordingConn</span><span class="op" id="8456544">,</span>&nbsp;<span class="ident" id="8456546">child</span>&nbsp;<span class="op" id="8456552">*</span><span class="ident" id="8456553">exec</span><span class="op" id="8456557">.</span><span class="ident" id="8456558">Cmd</span><span class="op" id="8456561">,</span>&nbsp;<span class="ident" id="8456563">stdin</span>&nbsp;<span class="ident" id="8456569">blockingSource</span><span class="op" id="8456583">,</span>&nbsp;<span class="ident" id="8456585">err</span>&nbsp;<span class="builtintype" id="8456589">error</span><span class="op" id="8456594">)</span>&nbsp;<span class="op" id="8456596">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456599">cert</span>&nbsp;<span class="op" id="8456604">:=</span>&nbsp;<span class="ident" id="8456607">testRSACertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456627">if</span>&nbsp;<span class="builtinfunc" id="8456630">len</span><span class="op" id="8456633">(</span><span class="ident" id="8456634">test</span><span class="op" id="8456638">.</span><span class="ident" id="8456639">cert</span><span class="op" id="8456643">)</span>&nbsp;<span class="op" id="8456645">&gt;</span>&nbsp;<span class="num" id="8456647">0</span>&nbsp;<span class="op" id="8456649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456653">cert</span>&nbsp;<span class="op" id="8456658">=</span>&nbsp;<span class="ident" id="8456660">test</span><span class="op" id="8456664">.</span><span class="ident" id="8456665">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8456671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456674">certPath</span>&nbsp;<span class="op" id="8456683">:=</span>&nbsp;<span class="ident" id="8456686">tempFile</span><span class="op" id="8456694">(</span><span class="builtintype" id="8456695">string</span><span class="op" id="8456701">(</span><span class="ident" id="8456702">cert</span><span class="op" id="8456706">)</span><span class="op" id="8456707">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456710">defer</span>&nbsp;<span class="ident" id="8456716">os</span><span class="op" id="8456718">.</span><span class="ident" id="8456719">Remove</span><span class="op" id="8456725">(</span><span class="ident" id="8456726">certPath</span><span class="op" id="8456734">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456738">var</span>&nbsp;<span class="ident" id="8456742">key</span>&nbsp;<span class="keyword" id="8456746">interface</span><span class="op" id="8456755">{</span><span class="op" id="8456756">}</span>&nbsp;<span class="op" id="8456758">=</span>&nbsp;<span class="ident" id="8456760">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456779">if</span>&nbsp;<span class="ident" id="8456782">test</span><span class="op" id="8456786">.</span><span class="ident" id="8456787">key</span>&nbsp;<span class="op" id="8456791">!=</span>&nbsp;<span class="ident" id="8456794">nil</span>&nbsp;<span class="op" id="8456798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456802">key</span>&nbsp;<span class="op" id="8456806">=</span>&nbsp;<span class="ident" id="8456808">test</span><span class="op" id="8456812">.</span><span class="ident" id="8456813">key</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8456818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456821">var</span>&nbsp;<span class="ident" id="8456825">pemType</span>&nbsp;<span class="builtintype" id="8456833">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456841">var</span>&nbsp;<span class="ident" id="8456845">derBytes</span>&nbsp;<span class="op" id="8456854">[</span><span class="op" id="8456855">]</span><span class="builtintype" id="8456856">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456862">switch</span>&nbsp;<span class="ident" id="8456869">key</span>&nbsp;<span class="op" id="8456873">:=</span>&nbsp;<span class="ident" id="8456876">key</span><span class="op" id="8456879">.</span><span class="op" id="8456880">(</span><span class="keyword" id="8456881">type</span><span class="op" id="8456885">)</span>&nbsp;<span class="op" id="8456887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456890">case</span>&nbsp;<span class="op" id="8456895">*</span><span class="ident" id="8456896">rsa</span><span class="op" id="8456899">.</span><span class="ident" id="8456900">PrivateKey</span><span class="op" id="8456910">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456914">pemType</span>&nbsp;<span class="op" id="8456922">=</span>&nbsp;<span class="string" id="8456924">&#34;RSA&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8456932">derBytes</span>&nbsp;<span class="op" id="8456941">=</span>&nbsp;<span class="ident" id="8456943">x509</span><span class="op" id="8456947">.</span><span class="ident" id="8456948">MarshalPKCS1PrivateKey</span><span class="op" id="8456970">(</span><span class="ident" id="8456971">key</span><span class="op" id="8456974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8456977">case</span>&nbsp;<span class="op" id="8456982">*</span><span class="ident" id="8456983">ecdsa</span><span class="op" id="8456988">.</span><span class="ident" id="8456989">PrivateKey</span><span class="op" id="8456999">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457003">pemType</span>&nbsp;<span class="op" id="8457011">=</span>&nbsp;<span class="string" id="8457013">&#34;EC&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8457020">var</span>&nbsp;<span class="ident" id="8457024">err</span>&nbsp;<span class="builtintype" id="8457028">error</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457036">derBytes</span><span class="op" id="8457044">,</span>&nbsp;<span class="ident" id="8457046">err</span>&nbsp;<span class="op" id="8457050">=</span>&nbsp;<span class="ident" id="8457052">x509</span><span class="op" id="8457056">.</span><span class="ident" id="8457057">MarshalECPrivateKey</span><span class="op" id="8457076">(</span><span class="ident" id="8457077">key</span><span class="op" id="8457080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8457084">if</span>&nbsp;<span class="ident" id="8457087">err</span>&nbsp;<span class="op" id="8457091">!=</span>&nbsp;<span class="ident" id="8457094">nil</span>&nbsp;<span class="op" id="8457098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8457103">panic</span><span class="op" id="8457108">(</span><span class="ident" id="8457109">err</span><span class="op" id="8457112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8457116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8457119">default</span><span class="op" id="8457126">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8457130">panic</span><span class="op" id="8457135">(</span><span class="string" id="8457136">&#34;unknown&nbsp;key&nbsp;type&#34;</span><span class="op" id="8457154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8457157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8457161">var</span>&nbsp;<span class="ident" id="8457165">pemOut</span>&nbsp;<span class="ident" id="8457172">bytes</span><span class="op" id="8457177">.</span><span class="ident" id="8457178">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457186">pem</span><span class="op" id="8457189">.</span><span class="ident" id="8457190">Encode</span><span class="op" id="8457196">(</span><span class="op" id="8457197">&amp;</span><span class="ident" id="8457198">pemOut</span><span class="op" id="8457204">,</span>&nbsp;<span class="op" id="8457206">&amp;</span><span class="ident" id="8457207">pem</span><span class="op" id="8457210">.</span><span class="ident" id="8457211">Block</span><span class="op" id="8457216">{</span><span class="ident" id="8457217">Type</span><span class="op" id="8457221">:</span>&nbsp;<span class="ident" id="8457223">pemType</span>&nbsp;<span class="op" id="8457231">+</span>&nbsp;<span class="string" id="8457233">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="8457247">,</span>&nbsp;<span class="ident" id="8457249">Bytes</span><span class="op" id="8457254">:</span>&nbsp;<span class="ident" id="8457256">derBytes</span><span class="op" id="8457264">}</span><span class="op" id="8457265">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457269">keyPath</span>&nbsp;<span class="op" id="8457277">:=</span>&nbsp;<span class="ident" id="8457280">tempFile</span><span class="op" id="8457288">(</span><span class="builtintype" id="8457289">string</span><span class="op" id="8457295">(</span><span class="ident" id="8457296">pemOut</span><span class="op" id="8457302">.</span><span class="ident" id="8457303">Bytes</span><span class="op" id="8457308">(</span><span class="op" id="8457309">)</span><span class="op" id="8457310">)</span><span class="op" id="8457311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8457314">defer</span>&nbsp;<span class="ident" id="8457320">os</span><span class="op" id="8457322">.</span><span class="ident" id="8457323">Remove</span><span class="op" id="8457329">(</span><span class="ident" id="8457330">keyPath</span><span class="op" id="8457337">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8457341">var</span>&nbsp;<span class="ident" id="8457345">command</span>&nbsp;<span class="op" id="8457353">[</span><span class="op" id="8457354">]</span><span class="builtintype" id="8457355">string</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8457363">if</span>&nbsp;<span class="builtinfunc" id="8457366">len</span><span class="op" id="8457369">(</span><span class="ident" id="8457370">test</span><span class="op" id="8457374">.</span><span class="ident" id="8457375">command</span><span class="op" id="8457382">)</span>&nbsp;<span class="op" id="8457384">&gt;</span>&nbsp;<span class="num" id="8457386">0</span>&nbsp;<span class="op" id="8457388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457392">command</span>&nbsp;<span class="op" id="8457400">=</span>&nbsp;<span class="builtinfunc" id="8457402">append</span><span class="op" id="8457408">(</span><span class="ident" id="8457409">command</span><span class="op" id="8457416">,</span>&nbsp;<span class="ident" id="8457418">test</span><span class="op" id="8457422">.</span><span class="ident" id="8457423">command</span><span class="op" id="8457430">...</span><span class="op" id="8457433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8457436">}</span>&nbsp;<span class="keyword" id="8457438">else</span>&nbsp;<span class="op" id="8457443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457447">command</span>&nbsp;<span class="op" id="8457455">=</span>&nbsp;<span class="builtinfunc" id="8457457">append</span><span class="op" id="8457463">(</span><span class="ident" id="8457464">command</span><span class="op" id="8457471">,</span>&nbsp;<span class="ident" id="8457473">defaultServerCommand</span><span class="op" id="8457493">...</span><span class="op" id="8457496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8457499">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457502">command</span>&nbsp;<span class="op" id="8457510">=</span>&nbsp;<span class="builtinfunc" id="8457512">append</span><span class="op" id="8457518">(</span><span class="ident" id="8457519">command</span><span class="op" id="8457526">,</span>&nbsp;<span class="string" id="8457528">&#34;-cert&#34;</span><span class="op" id="8457535">,</span>&nbsp;<span class="ident" id="8457537">certPath</span><span class="op" id="8457545">,</span>&nbsp;<span class="string" id="8457547">&#34;-certform&#34;</span><span class="op" id="8457558">,</span>&nbsp;<span class="string" id="8457560">&#34;DER&#34;</span><span class="op" id="8457565">,</span>&nbsp;<span class="string" id="8457567">&#34;-key&#34;</span><span class="op" id="8457573">,</span>&nbsp;<span class="ident" id="8457575">keyPath</span><span class="op" id="8457582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8457585">//&nbsp;serverPort&nbsp;contains&nbsp;the&nbsp;port&nbsp;that&nbsp;OpenSSL&nbsp;will&nbsp;listen&nbsp;on.&nbsp;OpenSSL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8457655">//&nbsp;can&#39;t&nbsp;take&nbsp;&#34;0&#34;&nbsp;as&nbsp;an&nbsp;argument&nbsp;here&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;pick&nbsp;a&nbsp;number&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8457726">//&nbsp;hope&nbsp;that&nbsp;it&#39;s&nbsp;not&nbsp;in&nbsp;use&nbsp;on&nbsp;the&nbsp;machine.&nbsp;Since&nbsp;this&nbsp;only&nbsp;occurs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8457795">//&nbsp;when&nbsp;-update&nbsp;is&nbsp;given&nbsp;and&nbsp;thus&nbsp;when&nbsp;there&#39;s&nbsp;a&nbsp;human&nbsp;watching&nbsp;the</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8457864">//&nbsp;test,&nbsp;this&nbsp;isn&#39;t&nbsp;too&nbsp;bad.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8457894">const</span>&nbsp;<span class="ident" id="8457900">serverPort</span>&nbsp;<span class="op" id="8457911">=</span>&nbsp;<span class="num" id="8457913">24323</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457920">command</span>&nbsp;<span class="op" id="8457928">=</span>&nbsp;<span class="builtinfunc" id="8457930">append</span><span class="op" id="8457936">(</span><span class="ident" id="8457937">command</span><span class="op" id="8457944">,</span>&nbsp;<span class="string" id="8457946">&#34;-accept&#34;</span><span class="op" id="8457955">,</span>&nbsp;<span class="ident" id="8457957">strconv</span><span class="op" id="8457964">.</span><span class="ident" id="8457965">Itoa</span><span class="op" id="8457969">(</span><span class="ident" id="8457970">serverPort</span><span class="op" id="8457980">)</span><span class="op" id="8457981">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8457985">cmd</span>&nbsp;<span class="op" id="8457989">:=</span>&nbsp;<span class="ident" id="8457992">exec</span><span class="op" id="8457996">.</span><span class="ident" id="8457997">Command</span><span class="op" id="8458004">(</span><span class="ident" id="8458005">command</span><span class="op" id="8458012">[</span><span class="num" id="8458013">0</span><span class="op" id="8458014">]</span><span class="op" id="8458015">,</span>&nbsp;<span class="ident" id="8458017">command</span><span class="op" id="8458024">[</span><span class="num" id="8458025">1</span><span class="op" id="8458026">:</span><span class="op" id="8458027">]</span><span class="op" id="8458028">...</span><span class="op" id="8458031">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458034">stdin</span>&nbsp;<span class="op" id="8458040">=</span>&nbsp;<span class="ident" id="8458042">blockingSource</span><span class="op" id="8458056">(</span><span class="builtinfunc" id="8458057">make</span><span class="op" id="8458061">(</span><span class="keyword" id="8458062">chan</span>&nbsp;<span class="builtintype" id="8458067">bool</span><span class="op" id="8458071">)</span><span class="op" id="8458072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458075">cmd</span><span class="op" id="8458078">.</span><span class="ident" id="8458079">Stdin</span>&nbsp;<span class="op" id="8458085">=</span>&nbsp;<span class="ident" id="8458087">stdin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458094">var</span>&nbsp;<span class="ident" id="8458098">out</span>&nbsp;<span class="ident" id="8458102">bytes</span><span class="op" id="8458107">.</span><span class="ident" id="8458108">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458116">cmd</span><span class="op" id="8458119">.</span><span class="ident" id="8458120">Stdout</span>&nbsp;<span class="op" id="8458127">=</span>&nbsp;<span class="op" id="8458129">&amp;</span><span class="ident" id="8458130">out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458135">cmd</span><span class="op" id="8458138">.</span><span class="ident" id="8458139">Stderr</span>&nbsp;<span class="op" id="8458146">=</span>&nbsp;<span class="op" id="8458148">&amp;</span><span class="ident" id="8458149">out</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458154">if</span>&nbsp;<span class="ident" id="8458157">err</span>&nbsp;<span class="op" id="8458161">:=</span>&nbsp;<span class="ident" id="8458164">cmd</span><span class="op" id="8458167">.</span><span class="ident" id="8458168">Start</span><span class="op" id="8458173">(</span><span class="op" id="8458174">)</span><span class="op" id="8458175">;</span>&nbsp;<span class="ident" id="8458177">err</span>&nbsp;<span class="op" id="8458181">!=</span>&nbsp;<span class="ident" id="8458184">nil</span>&nbsp;<span class="op" id="8458188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458192">return</span>&nbsp;<span class="ident" id="8458199">nil</span><span class="op" id="8458202">,</span>&nbsp;<span class="ident" id="8458204">nil</span><span class="op" id="8458207">,</span>&nbsp;<span class="ident" id="8458209">nil</span><span class="op" id="8458212">,</span>&nbsp;<span class="ident" id="8458214">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8458219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8458223">//&nbsp;OpenSSL&nbsp;does&nbsp;print&nbsp;an&nbsp;&#34;ACCEPT&#34;&nbsp;banner,&nbsp;but&nbsp;it&nbsp;does&nbsp;so&nbsp;*before*</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8458290">//&nbsp;opening&nbsp;the&nbsp;listening&nbsp;socket,&nbsp;so&nbsp;we&nbsp;can&#39;t&nbsp;use&nbsp;that&nbsp;to&nbsp;wait&nbsp;until&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8458362">//&nbsp;has&nbsp;started&nbsp;listening.&nbsp;Thus&nbsp;we&nbsp;are&nbsp;forced&nbsp;to&nbsp;poll&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8458431">//&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458447">var</span>&nbsp;<span class="ident" id="8458451">tcpConn</span>&nbsp;<span class="ident" id="8458459">net</span><span class="op" id="8458462">.</span><span class="ident" id="8458463">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458469">for</span>&nbsp;<span class="ident" id="8458473">i</span>&nbsp;<span class="op" id="8458475">:=</span>&nbsp;<span class="builtintype" id="8458478">uint</span><span class="op" id="8458482">(</span><span class="num" id="8458483">0</span><span class="op" id="8458484">)</span><span class="op" id="8458485">;</span>&nbsp;<span class="ident" id="8458487">i</span>&nbsp;<span class="op" id="8458489">&lt;</span>&nbsp;<span class="num" id="8458491">5</span><span class="op" id="8458492">;</span>&nbsp;<span class="ident" id="8458494">i</span><span class="op" id="8458495">++</span>&nbsp;<span class="op" id="8458498">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458502">var</span>&nbsp;<span class="ident" id="8458506">err</span>&nbsp;<span class="builtintype" id="8458510">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458518">tcpConn</span><span class="op" id="8458525">,</span>&nbsp;<span class="ident" id="8458527">err</span>&nbsp;<span class="op" id="8458531">=</span>&nbsp;<span class="ident" id="8458533">net</span><span class="op" id="8458536">.</span><span class="ident" id="8458537">DialTCP</span><span class="op" id="8458544">(</span><span class="string" id="8458545">&#34;tcp&#34;</span><span class="op" id="8458550">,</span>&nbsp;<span class="ident" id="8458552">nil</span><span class="op" id="8458555">,</span>&nbsp;<span class="op" id="8458557">&amp;</span><span class="ident" id="8458558">net</span><span class="op" id="8458561">.</span><span class="ident" id="8458562">TCPAddr</span><span class="op" id="8458569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458574">IP</span><span class="op" id="8458576">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8458580">net</span><span class="op" id="8458583">.</span><span class="ident" id="8458584">IPv4</span><span class="op" id="8458588">(</span><span class="num" id="8458589">127</span><span class="op" id="8458592">,</span>&nbsp;<span class="num" id="8458594">0</span><span class="op" id="8458595">,</span>&nbsp;<span class="num" id="8458597">0</span><span class="op" id="8458598">,</span>&nbsp;<span class="num" id="8458600">1</span><span class="op" id="8458601">)</span><span class="op" id="8458602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458607">Port</span><span class="op" id="8458611">:</span>&nbsp;<span class="ident" id="8458613">serverPort</span><span class="op" id="8458623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8458627">}</span><span class="op" id="8458628">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458632">if</span>&nbsp;<span class="ident" id="8458635">err</span>&nbsp;<span class="op" id="8458639">==</span>&nbsp;<span class="ident" id="8458642">nil</span>&nbsp;<span class="op" id="8458646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458651">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8458659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458663">time</span><span class="op" id="8458667">.</span><span class="ident" id="8458668">Sleep</span><span class="op" id="8458673">(</span><span class="op" id="8458674">(</span><span class="num" id="8458675">1</span>&nbsp;<span class="op" id="8458677">&lt;&lt;</span>&nbsp;<span class="ident" id="8458680">i</span><span class="op" id="8458681">)</span>&nbsp;<span class="op" id="8458683">*</span>&nbsp;<span class="num" id="8458685">5</span>&nbsp;<span class="op" id="8458687">*</span>&nbsp;<span class="ident" id="8458689">time</span><span class="op" id="8458693">.</span><span class="ident" id="8458694">Millisecond</span><span class="op" id="8458705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8458708">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458711">if</span>&nbsp;<span class="ident" id="8458714">tcpConn</span>&nbsp;<span class="op" id="8458722">==</span>&nbsp;<span class="ident" id="8458725">nil</span>&nbsp;<span class="op" id="8458729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8458733">close</span><span class="op" id="8458738">(</span><span class="ident" id="8458739">stdin</span><span class="op" id="8458744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458748">out</span><span class="op" id="8458751">.</span><span class="ident" id="8458752">WriteTo</span><span class="op" id="8458759">(</span><span class="ident" id="8458760">os</span><span class="op" id="8458762">.</span><span class="ident" id="8458763">Stdout</span><span class="op" id="8458769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458773">cmd</span><span class="op" id="8458776">.</span><span class="ident" id="8458777">Process</span><span class="op" id="8458784">.</span><span class="ident" id="8458785">Kill</span><span class="op" id="8458789">(</span><span class="op" id="8458790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458794">return</span>&nbsp;<span class="ident" id="8458801">nil</span><span class="op" id="8458804">,</span>&nbsp;<span class="ident" id="8458806">nil</span><span class="op" id="8458809">,</span>&nbsp;<span class="ident" id="8458811">nil</span><span class="op" id="8458814">,</span>&nbsp;<span class="ident" id="8458816">cmd</span><span class="op" id="8458819">.</span><span class="ident" id="8458820">Wait</span><span class="op" id="8458824">(</span><span class="op" id="8458825">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8458828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458832">record</span>&nbsp;<span class="op" id="8458839">:=</span>&nbsp;<span class="op" id="8458842">&amp;</span><span class="ident" id="8458843">recordingConn</span><span class="op" id="8458856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8458860">Conn</span><span class="op" id="8458864">:</span>&nbsp;<span class="ident" id="8458866">tcpConn</span><span class="op" id="8458873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8458876">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458880">return</span>&nbsp;<span class="ident" id="8458887">record</span><span class="op" id="8458893">,</span>&nbsp;<span class="ident" id="8458895">cmd</span><span class="op" id="8458898">,</span>&nbsp;<span class="ident" id="8458900">stdin</span><span class="op" id="8458905">,</span>&nbsp;<span class="ident" id="8458907">nil</span><br>
<span class="lineno"></span><span class="op" id="8458911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8458914">func</span>&nbsp;<span class="op" id="8458919">(</span><span class="ident" id="8458920">test</span>&nbsp;<span class="op" id="8458925">*</span><span class="ident" id="8458926">clientTest</span><span class="op" id="8458936">)</span>&nbsp;<span class="ident" id="8458938">dataPath</span><span class="op" id="8458946">(</span><span class="op" id="8458947">)</span>&nbsp;<span class="builtintype" id="8458949">string</span>&nbsp;<span class="op" id="8458956">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8458959">return</span>&nbsp;<span class="ident" id="8458966">filepath</span><span class="op" id="8458974">.</span><span class="ident" id="8458975">Join</span><span class="op" id="8458979">(</span><span class="string" id="8458980">&#34;testdata&#34;</span><span class="op" id="8458990">,</span>&nbsp;<span class="string" id="8458992">&#34;Client-&#34;</span><span class="op" id="8459001">+</span><span class="ident" id="8459002">test</span><span class="op" id="8459006">.</span><span class="ident" id="8459007">name</span><span class="op" id="8459011">)</span><br>
<span class="lineno"></span><span class="op" id="8459013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8459016">func</span>&nbsp;<span class="op" id="8459021">(</span><span class="ident" id="8459022">test</span>&nbsp;<span class="op" id="8459027">*</span><span class="ident" id="8459028">clientTest</span><span class="op" id="8459038">)</span>&nbsp;<span class="ident" id="8459040">loadData</span><span class="op" id="8459048">(</span><span class="op" id="8459049">)</span>&nbsp;<span class="op" id="8459051">(</span><span class="ident" id="8459052">flows</span>&nbsp;<span class="op" id="8459058">[</span><span class="op" id="8459059">]</span><span class="op" id="8459060">[</span><span class="op" id="8459061">]</span><span class="builtintype" id="8459062">byte</span><span class="op" id="8459066">,</span>&nbsp;<span class="ident" id="8459068">err</span>&nbsp;<span class="builtintype" id="8459072">error</span><span class="op" id="8459077">)</span>&nbsp;<span class="op" id="8459079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459082">in</span><span class="op" id="8459084">,</span>&nbsp;<span class="ident" id="8459086">err</span>&nbsp;<span class="op" id="8459090">:=</span>&nbsp;<span class="ident" id="8459093">os</span><span class="op" id="8459095">.</span><span class="ident" id="8459096">Open</span><span class="op" id="8459100">(</span><span class="ident" id="8459101">test</span><span class="op" id="8459105">.</span><span class="ident" id="8459106">dataPath</span><span class="op" id="8459114">(</span><span class="op" id="8459115">)</span><span class="op" id="8459116">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459119">if</span>&nbsp;<span class="ident" id="8459122">err</span>&nbsp;<span class="op" id="8459126">!=</span>&nbsp;<span class="ident" id="8459129">nil</span>&nbsp;<span class="op" id="8459133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459137">return</span>&nbsp;<span class="ident" id="8459144">nil</span><span class="op" id="8459147">,</span>&nbsp;<span class="ident" id="8459149">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459157">defer</span>&nbsp;<span class="ident" id="8459163">in</span><span class="op" id="8459165">.</span><span class="ident" id="8459166">Close</span><span class="op" id="8459171">(</span><span class="op" id="8459172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459175">return</span>&nbsp;<span class="ident" id="8459182">parseTestData</span><span class="op" id="8459195">(</span><span class="ident" id="8459196">in</span><span class="op" id="8459198">)</span><br>
<span class="lineno">165</span><span class="op" id="8459200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8459203">func</span>&nbsp;<span class="op" id="8459208">(</span><span class="ident" id="8459209">test</span>&nbsp;<span class="op" id="8459214">*</span><span class="ident" id="8459215">clientTest</span><span class="op" id="8459225">)</span>&nbsp;<span class="ident" id="8459227">run</span><span class="op" id="8459230">(</span><span class="ident" id="8459231">t</span>&nbsp;<span class="op" id="8459233">*</span><span class="ident" id="8459234">testing</span><span class="op" id="8459241">.</span><span class="ident" id="8459242">T</span><span class="op" id="8459243">,</span>&nbsp;<span class="ident" id="8459245">write</span>&nbsp;<span class="builtintype" id="8459251">bool</span><span class="op" id="8459255">)</span>&nbsp;<span class="op" id="8459257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459260">var</span>&nbsp;<span class="ident" id="8459264">clientConn</span><span class="op" id="8459274">,</span>&nbsp;<span class="ident" id="8459276">serverConn</span>&nbsp;<span class="ident" id="8459287">net</span><span class="op" id="8459290">.</span><span class="ident" id="8459291">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459297">var</span>&nbsp;<span class="ident" id="8459301">recordingConn</span>&nbsp;<span class="op" id="8459315">*</span><span class="ident" id="8459316">recordingConn</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459331">var</span>&nbsp;<span class="ident" id="8459335">childProcess</span>&nbsp;<span class="op" id="8459348">*</span><span class="ident" id="8459349">exec</span><span class="op" id="8459353">.</span><span class="ident" id="8459354">Cmd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459359">var</span>&nbsp;<span class="ident" id="8459363">stdin</span>&nbsp;<span class="ident" id="8459369">blockingSource</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459386">if</span>&nbsp;<span class="ident" id="8459389">write</span>&nbsp;<span class="op" id="8459395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459399">var</span>&nbsp;<span class="ident" id="8459403">err</span>&nbsp;<span class="builtintype" id="8459407">error</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459415">recordingConn</span><span class="op" id="8459428">,</span>&nbsp;<span class="ident" id="8459430">childProcess</span><span class="op" id="8459442">,</span>&nbsp;<span class="ident" id="8459444">stdin</span><span class="op" id="8459449">,</span>&nbsp;<span class="ident" id="8459451">err</span>&nbsp;<span class="op" id="8459455">=</span>&nbsp;<span class="ident" id="8459457">test</span><span class="op" id="8459461">.</span><span class="ident" id="8459462">connFromCommand</span><span class="op" id="8459477">(</span><span class="op" id="8459478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459482">if</span>&nbsp;<span class="ident" id="8459485">err</span>&nbsp;<span class="op" id="8459489">!=</span>&nbsp;<span class="ident" id="8459492">nil</span>&nbsp;<span class="op" id="8459496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459501">t</span><span class="op" id="8459502">.</span><span class="ident" id="8459503">Fatalf</span><span class="op" id="8459509">(</span><span class="string" id="8459510">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="8459542">,</span>&nbsp;<span class="ident" id="8459544">err</span><span class="op" id="8459547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459555">clientConn</span>&nbsp;<span class="op" id="8459566">=</span>&nbsp;<span class="ident" id="8459568">recordingConn</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459583">}</span>&nbsp;<span class="keyword" id="8459585">else</span>&nbsp;<span class="op" id="8459590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459594">clientConn</span><span class="op" id="8459604">,</span>&nbsp;<span class="ident" id="8459606">serverConn</span>&nbsp;<span class="op" id="8459617">=</span>&nbsp;<span class="ident" id="8459619">net</span><span class="op" id="8459622">.</span><span class="ident" id="8459623">Pipe</span><span class="op" id="8459627">(</span><span class="op" id="8459628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459635">config</span>&nbsp;<span class="op" id="8459642">:=</span>&nbsp;<span class="ident" id="8459645">test</span><span class="op" id="8459649">.</span><span class="ident" id="8459650">config</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459658">if</span>&nbsp;<span class="ident" id="8459661">config</span>&nbsp;<span class="op" id="8459668">==</span>&nbsp;<span class="ident" id="8459671">nil</span>&nbsp;<span class="op" id="8459675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459679">config</span>&nbsp;<span class="op" id="8459686">=</span>&nbsp;<span class="ident" id="8459688">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459703">client</span>&nbsp;<span class="op" id="8459710">:=</span>&nbsp;<span class="ident" id="8459713">Client</span><span class="op" id="8459719">(</span><span class="ident" id="8459720">clientConn</span><span class="op" id="8459730">,</span>&nbsp;<span class="ident" id="8459732">config</span><span class="op" id="8459738">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459742">doneChan</span>&nbsp;<span class="op" id="8459751">:=</span>&nbsp;<span class="builtinfunc" id="8459754">make</span><span class="op" id="8459758">(</span><span class="keyword" id="8459759">chan</span>&nbsp;<span class="builtintype" id="8459764">bool</span><span class="op" id="8459768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459771">go</span>&nbsp;<span class="keyword" id="8459774">func</span><span class="op" id="8459778">(</span><span class="op" id="8459779">)</span>&nbsp;<span class="op" id="8459781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459785">if</span>&nbsp;<span class="ident" id="8459788">_</span><span class="op" id="8459789">,</span>&nbsp;<span class="ident" id="8459791">err</span>&nbsp;<span class="op" id="8459795">:=</span>&nbsp;<span class="ident" id="8459798">client</span><span class="op" id="8459804">.</span><span class="ident" id="8459805">Write</span><span class="op" id="8459810">(</span><span class="op" id="8459811">[</span><span class="op" id="8459812">]</span><span class="builtintype" id="8459813">byte</span><span class="op" id="8459817">(</span><span class="string" id="8459818">&#34;hello\n&#34;</span><span class="op" id="8459827">)</span><span class="op" id="8459828">)</span><span class="op" id="8459829">;</span>&nbsp;<span class="ident" id="8459831">err</span>&nbsp;<span class="op" id="8459835">!=</span>&nbsp;<span class="ident" id="8459838">nil</span>&nbsp;<span class="op" id="8459842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459847">t</span><span class="op" id="8459848">.</span><span class="ident" id="8459849">Logf</span><span class="op" id="8459853">(</span><span class="string" id="8459854">&#34;Client.Write&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8459879">,</span>&nbsp;<span class="ident" id="8459881">err</span><span class="op" id="8459884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8459888">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459892">if</span>&nbsp;<span class="ident" id="8459895">test</span><span class="op" id="8459899">.</span><span class="ident" id="8459900">validate</span>&nbsp;<span class="op" id="8459909">!=</span>&nbsp;<span class="ident" id="8459912">nil</span>&nbsp;<span class="op" id="8459916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8459921">if</span>&nbsp;<span class="ident" id="8459924">err</span>&nbsp;<span class="op" id="8459928">:=</span>&nbsp;<span class="ident" id="8459931">test</span><span class="op" id="8459935">.</span><span class="ident" id="8459936">validate</span><span class="op" id="8459944">(</span><span class="ident" id="8459945">client</span><span class="op" id="8459951">.</span><span class="ident" id="8459952">ConnectionState</span><span class="op" id="8459967">(</span><span class="op" id="8459968">)</span><span class="op" id="8459969">)</span><span class="op" id="8459970">;</span>&nbsp;<span class="ident" id="8459972">err</span>&nbsp;<span class="op" id="8459976">!=</span>&nbsp;<span class="ident" id="8459979">nil</span>&nbsp;<span class="op" id="8459983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8459989">t</span><span class="op" id="8459990">.</span><span class="ident" id="8459991">Logf</span><span class="op" id="8459995">(</span><span class="string" id="8459996">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8460034">,</span>&nbsp;<span class="ident" id="8460036">err</span><span class="op" id="8460039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460048">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460052">client</span><span class="op" id="8460058">.</span><span class="ident" id="8460059">Close</span><span class="op" id="8460064">(</span><span class="op" id="8460065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460069">clientConn</span><span class="op" id="8460079">.</span><span class="ident" id="8460080">Close</span><span class="op" id="8460085">(</span><span class="op" id="8460086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460090">doneChan</span>&nbsp;<span class="op" id="8460099">&lt;-</span>&nbsp;<span class="builtintype" id="8460102">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460108">}</span><span class="op" id="8460109">(</span><span class="op" id="8460110">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460114">if</span>&nbsp;<span class="op" id="8460117">!</span><span class="ident" id="8460118">write</span>&nbsp;<span class="op" id="8460124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460128">flows</span><span class="op" id="8460133">,</span>&nbsp;<span class="ident" id="8460135">err</span>&nbsp;<span class="op" id="8460139">:=</span>&nbsp;<span class="ident" id="8460142">test</span><span class="op" id="8460146">.</span><span class="ident" id="8460147">loadData</span><span class="op" id="8460155">(</span><span class="op" id="8460156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460160">if</span>&nbsp;<span class="ident" id="8460163">err</span>&nbsp;<span class="op" id="8460167">!=</span>&nbsp;<span class="ident" id="8460170">nil</span>&nbsp;<span class="op" id="8460174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460179">t</span><span class="op" id="8460180">.</span><span class="ident" id="8460181">Fatalf</span><span class="op" id="8460187">(</span><span class="string" id="8460188">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="8460225">,</span>&nbsp;<span class="ident" id="8460227">test</span><span class="op" id="8460231">.</span><span class="ident" id="8460232">name</span><span class="op" id="8460236">,</span>&nbsp;<span class="ident" id="8460238">test</span><span class="op" id="8460242">.</span><span class="ident" id="8460243">dataPath</span><span class="op" id="8460251">(</span><span class="op" id="8460252">)</span><span class="op" id="8460253">,</span>&nbsp;<span class="ident" id="8460255">err</span><span class="op" id="8460258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460262">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460266">for</span>&nbsp;<span class="ident" id="8460270">i</span><span class="op" id="8460271">,</span>&nbsp;<span class="ident" id="8460273">b</span>&nbsp;<span class="op" id="8460275">:=</span>&nbsp;<span class="keyword" id="8460278">range</span>&nbsp;<span class="ident" id="8460284">flows</span>&nbsp;<span class="op" id="8460290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460295">if</span>&nbsp;<span class="ident" id="8460298">i</span><span class="op" id="8460299">%</span><span class="num" id="8460300">2</span>&nbsp;<span class="op" id="8460302">==</span>&nbsp;<span class="num" id="8460305">1</span>&nbsp;<span class="op" id="8460307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460313">serverConn</span><span class="op" id="8460323">.</span><span class="ident" id="8460324">Write</span><span class="op" id="8460329">(</span><span class="ident" id="8460330">b</span><span class="op" id="8460331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460337">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460349">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460354">bb</span>&nbsp;<span class="op" id="8460357">:=</span>&nbsp;<span class="builtinfunc" id="8460360">make</span><span class="op" id="8460364">(</span><span class="op" id="8460365">[</span><span class="op" id="8460366">]</span><span class="builtintype" id="8460367">byte</span><span class="op" id="8460371">,</span>&nbsp;<span class="builtinfunc" id="8460373">len</span><span class="op" id="8460376">(</span><span class="ident" id="8460377">b</span><span class="op" id="8460378">)</span><span class="op" id="8460379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460384">_</span><span class="op" id="8460385">,</span>&nbsp;<span class="ident" id="8460387">err</span>&nbsp;<span class="op" id="8460391">:=</span>&nbsp;<span class="ident" id="8460394">io</span><span class="op" id="8460396">.</span><span class="ident" id="8460397">ReadFull</span><span class="op" id="8460405">(</span><span class="ident" id="8460406">serverConn</span><span class="op" id="8460416">,</span>&nbsp;<span class="ident" id="8460418">bb</span><span class="op" id="8460420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460425">if</span>&nbsp;<span class="ident" id="8460428">err</span>&nbsp;<span class="op" id="8460432">!=</span>&nbsp;<span class="ident" id="8460435">nil</span>&nbsp;<span class="op" id="8460439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460445">t</span><span class="op" id="8460446">.</span><span class="ident" id="8460447">Fatalf</span><span class="op" id="8460453">(</span><span class="string" id="8460454">&#34;%s&nbsp;#%d:&nbsp;%s&#34;</span><span class="op" id="8460466">,</span>&nbsp;<span class="ident" id="8460468">test</span><span class="op" id="8460472">.</span><span class="ident" id="8460473">name</span><span class="op" id="8460477">,</span>&nbsp;<span class="ident" id="8460479">i</span><span class="op" id="8460480">,</span>&nbsp;<span class="ident" id="8460482">err</span><span class="op" id="8460485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460490">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460495">if</span>&nbsp;<span class="op" id="8460498">!</span><span class="ident" id="8460499">bytes</span><span class="op" id="8460504">.</span><span class="ident" id="8460505">Equal</span><span class="op" id="8460510">(</span><span class="ident" id="8460511">b</span><span class="op" id="8460512">,</span>&nbsp;<span class="ident" id="8460514">bb</span><span class="op" id="8460516">)</span>&nbsp;<span class="op" id="8460518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460524">t</span><span class="op" id="8460525">.</span><span class="ident" id="8460526">Fatalf</span><span class="op" id="8460532">(</span><span class="string" id="8460533">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="8460575">,</span>&nbsp;<span class="ident" id="8460577">test</span><span class="op" id="8460581">.</span><span class="ident" id="8460582">name</span><span class="op" id="8460586">,</span>&nbsp;<span class="ident" id="8460588">i</span><span class="op" id="8460589">,</span>&nbsp;<span class="ident" id="8460591">bb</span><span class="op" id="8460593">,</span>&nbsp;<span class="ident" id="8460595">b</span><span class="op" id="8460596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460609">serverConn</span><span class="op" id="8460619">.</span><span class="ident" id="8460620">Close</span><span class="op" id="8460625">(</span><span class="op" id="8460626">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460633">&lt;-</span><span class="ident" id="8460635">doneChan</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460646">if</span>&nbsp;<span class="ident" id="8460649">write</span>&nbsp;<span class="op" id="8460655">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460659">path</span>&nbsp;<span class="op" id="8460664">:=</span>&nbsp;<span class="ident" id="8460667">test</span><span class="op" id="8460671">.</span><span class="ident" id="8460672">dataPath</span><span class="op" id="8460680">(</span><span class="op" id="8460681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460685">out</span><span class="op" id="8460688">,</span>&nbsp;<span class="ident" id="8460690">err</span>&nbsp;<span class="op" id="8460694">:=</span>&nbsp;<span class="ident" id="8460697">os</span><span class="op" id="8460699">.</span><span class="ident" id="8460700">OpenFile</span><span class="op" id="8460708">(</span><span class="ident" id="8460709">path</span><span class="op" id="8460713">,</span>&nbsp;<span class="ident" id="8460715">os</span><span class="op" id="8460717">.</span><span class="ident" id="8460718">O_WRONLY</span><span class="op" id="8460726">|</span><span class="ident" id="8460727">os</span><span class="op" id="8460729">.</span><span class="ident" id="8460730">O_CREATE</span><span class="op" id="8460738">|</span><span class="ident" id="8460739">os</span><span class="op" id="8460741">.</span><span class="ident" id="8460742">O_TRUNC</span><span class="op" id="8460749">,</span>&nbsp;<span class="num" id="8460751">0644</span><span class="op" id="8460755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460759">if</span>&nbsp;<span class="ident" id="8460762">err</span>&nbsp;<span class="op" id="8460766">!=</span>&nbsp;<span class="ident" id="8460769">nil</span>&nbsp;<span class="op" id="8460773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460778">t</span><span class="op" id="8460779">.</span><span class="ident" id="8460780">Fatalf</span><span class="op" id="8460786">(</span><span class="string" id="8460787">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="8460821">,</span>&nbsp;<span class="ident" id="8460823">err</span><span class="op" id="8460826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8460830">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460834">defer</span>&nbsp;<span class="ident" id="8460840">out</span><span class="op" id="8460843">.</span><span class="ident" id="8460844">Close</span><span class="op" id="8460849">(</span><span class="op" id="8460850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460854">recordingConn</span><span class="op" id="8460867">.</span><span class="ident" id="8460868">Close</span><span class="op" id="8460873">(</span><span class="op" id="8460874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8460878">close</span><span class="op" id="8460883">(</span><span class="ident" id="8460884">stdin</span><span class="op" id="8460889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460893">childProcess</span><span class="op" id="8460905">.</span><span class="ident" id="8460906">Process</span><span class="op" id="8460913">.</span><span class="ident" id="8460914">Kill</span><span class="op" id="8460918">(</span><span class="op" id="8460919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460923">childProcess</span><span class="op" id="8460935">.</span><span class="ident" id="8460936">Wait</span><span class="op" id="8460940">(</span><span class="op" id="8460941">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8460945">if</span>&nbsp;<span class="builtinfunc" id="8460948">len</span><span class="op" id="8460951">(</span><span class="ident" id="8460952">recordingConn</span><span class="op" id="8460965">.</span><span class="ident" id="8460966">flows</span><span class="op" id="8460971">)</span>&nbsp;<span class="op" id="8460973">&lt;</span>&nbsp;<span class="num" id="8460975">3</span>&nbsp;<span class="op" id="8460977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8460982">childProcess</span><span class="op" id="8460994">.</span><span class="ident" id="8460995">Stdout</span><span class="op" id="8461001">.</span><span class="op" id="8461002">(</span><span class="op" id="8461003">*</span><span class="ident" id="8461004">bytes</span><span class="op" id="8461009">.</span><span class="ident" id="8461010">Buffer</span><span class="op" id="8461016">)</span><span class="op" id="8461017">.</span><span class="ident" id="8461018">WriteTo</span><span class="op" id="8461025">(</span><span class="ident" id="8461026">os</span><span class="op" id="8461028">.</span><span class="ident" id="8461029">Stdout</span><span class="op" id="8461035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461040">t</span><span class="op" id="8461041">.</span><span class="ident" id="8461042">Fatalf</span><span class="op" id="8461048">(</span><span class="string" id="8461049">&#34;Client&nbsp;connection&nbsp;didn&#39;t&nbsp;work&#34;</span><span class="op" id="8461080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461088">recordingConn</span><span class="op" id="8461101">.</span><span class="ident" id="8461102">WriteTo</span><span class="op" id="8461109">(</span><span class="ident" id="8461110">out</span><span class="op" id="8461113">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461117">fmt</span><span class="op" id="8461120">.</span><span class="ident" id="8461121">Printf</span><span class="op" id="8461127">(</span><span class="string" id="8461128">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="8461140">,</span>&nbsp;<span class="ident" id="8461142">path</span><span class="op" id="8461146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461149">}</span><br>
<span class="lineno"></span><span class="op" id="8461151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8461154">func</span>&nbsp;<span class="ident" id="8461159">runClientTestForVersion</span><span class="op" id="8461182">(</span><span class="ident" id="8461183">t</span>&nbsp;<span class="op" id="8461185">*</span><span class="ident" id="8461186">testing</span><span class="op" id="8461193">.</span><span class="ident" id="8461194">T</span><span class="op" id="8461195">,</span>&nbsp;<span class="ident" id="8461197">template</span>&nbsp;<span class="op" id="8461206">*</span><span class="ident" id="8461207">clientTest</span><span class="op" id="8461217">,</span>&nbsp;<span class="ident" id="8461219">prefix</span><span class="op" id="8461225">,</span>&nbsp;<span class="ident" id="8461227">option</span>&nbsp;<span class="builtintype" id="8461234">string</span><span class="op" id="8461240">)</span>&nbsp;<span class="op" id="8461242">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461245">test</span>&nbsp;<span class="op" id="8461250">:=</span>&nbsp;<span class="op" id="8461253">*</span><span class="ident" id="8461254">template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461264">test</span><span class="op" id="8461268">.</span><span class="ident" id="8461269">name</span>&nbsp;<span class="op" id="8461274">=</span>&nbsp;<span class="ident" id="8461276">prefix</span>&nbsp;<span class="op" id="8461283">+</span>&nbsp;<span class="ident" id="8461285">test</span><span class="op" id="8461289">.</span><span class="ident" id="8461290">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8461296">if</span>&nbsp;<span class="builtinfunc" id="8461299">len</span><span class="op" id="8461302">(</span><span class="ident" id="8461303">test</span><span class="op" id="8461307">.</span><span class="ident" id="8461308">command</span><span class="op" id="8461315">)</span>&nbsp;<span class="op" id="8461317">==</span>&nbsp;<span class="num" id="8461320">0</span>&nbsp;<span class="op" id="8461322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461326">test</span><span class="op" id="8461330">.</span><span class="ident" id="8461331">command</span>&nbsp;<span class="op" id="8461339">=</span>&nbsp;<span class="ident" id="8461341">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8461363">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461366">test</span><span class="op" id="8461370">.</span><span class="ident" id="8461371">command</span>&nbsp;<span class="op" id="8461379">=</span>&nbsp;<span class="builtinfunc" id="8461381">append</span><span class="op" id="8461387">(</span><span class="op" id="8461388">[</span><span class="op" id="8461389">]</span><span class="builtintype" id="8461390">string</span><span class="op" id="8461396">(</span><span class="ident" id="8461397">nil</span><span class="op" id="8461400">)</span><span class="op" id="8461401">,</span>&nbsp;<span class="ident" id="8461403">test</span><span class="op" id="8461407">.</span><span class="ident" id="8461408">command</span><span class="op" id="8461415">...</span><span class="op" id="8461418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461421">test</span><span class="op" id="8461425">.</span><span class="ident" id="8461426">command</span>&nbsp;<span class="op" id="8461434">=</span>&nbsp;<span class="builtinfunc" id="8461436">append</span><span class="op" id="8461442">(</span><span class="ident" id="8461443">test</span><span class="op" id="8461447">.</span><span class="ident" id="8461448">command</span><span class="op" id="8461455">,</span>&nbsp;<span class="ident" id="8461457">option</span><span class="op" id="8461463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461466">test</span><span class="op" id="8461470">.</span><span class="ident" id="8461471">run</span><span class="op" id="8461474">(</span><span class="ident" id="8461475">t</span><span class="op" id="8461476">,</span>&nbsp;<span class="op" id="8461478">*</span><span class="ident" id="8461479">update</span><span class="op" id="8461485">)</span><br>
<span class="lineno"></span><span class="op" id="8461487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="8461490">func</span>&nbsp;<span class="ident" id="8461495">runClientTestTLS10</span><span class="op" id="8461513">(</span><span class="ident" id="8461514">t</span>&nbsp;<span class="op" id="8461516">*</span><span class="ident" id="8461517">testing</span><span class="op" id="8461524">.</span><span class="ident" id="8461525">T</span><span class="op" id="8461526">,</span>&nbsp;<span class="ident" id="8461528">template</span>&nbsp;<span class="op" id="8461537">*</span><span class="ident" id="8461538">clientTest</span><span class="op" id="8461548">)</span>&nbsp;<span class="op" id="8461550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461553">runClientTestForVersion</span><span class="op" id="8461576">(</span><span class="ident" id="8461577">t</span><span class="op" id="8461578">,</span>&nbsp;<span class="ident" id="8461580">template</span><span class="op" id="8461588">,</span>&nbsp;<span class="string" id="8461590">&#34;TLSv10-&#34;</span><span class="op" id="8461599">,</span>&nbsp;<span class="string" id="8461601">&#34;-tls1&#34;</span><span class="op" id="8461608">)</span><br>
<span class="lineno"></span><span class="op" id="8461610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8461613">func</span>&nbsp;<span class="ident" id="8461618">runClientTestTLS11</span><span class="op" id="8461636">(</span><span class="ident" id="8461637">t</span>&nbsp;<span class="op" id="8461639">*</span><span class="ident" id="8461640">testing</span><span class="op" id="8461647">.</span><span class="ident" id="8461648">T</span><span class="op" id="8461649">,</span>&nbsp;<span class="ident" id="8461651">template</span>&nbsp;<span class="op" id="8461660">*</span><span class="ident" id="8461661">clientTest</span><span class="op" id="8461671">)</span>&nbsp;<span class="op" id="8461673">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461676">runClientTestForVersion</span><span class="op" id="8461699">(</span><span class="ident" id="8461700">t</span><span class="op" id="8461701">,</span>&nbsp;<span class="ident" id="8461703">template</span><span class="op" id="8461711">,</span>&nbsp;<span class="string" id="8461713">&#34;TLSv11-&#34;</span><span class="op" id="8461722">,</span>&nbsp;<span class="string" id="8461724">&#34;-tls1_1&#34;</span><span class="op" id="8461733">)</span><br>
<span class="lineno"></span><span class="op" id="8461735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8461738">func</span>&nbsp;<span class="ident" id="8461743">runClientTestTLS12</span><span class="op" id="8461761">(</span><span class="ident" id="8461762">t</span>&nbsp;<span class="op" id="8461764">*</span><span class="ident" id="8461765">testing</span><span class="op" id="8461772">.</span><span class="ident" id="8461773">T</span><span class="op" id="8461774">,</span>&nbsp;<span class="ident" id="8461776">template</span>&nbsp;<span class="op" id="8461785">*</span><span class="ident" id="8461786">clientTest</span><span class="op" id="8461796">)</span>&nbsp;<span class="op" id="8461798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461801">runClientTestForVersion</span><span class="op" id="8461824">(</span><span class="ident" id="8461825">t</span><span class="op" id="8461826">,</span>&nbsp;<span class="ident" id="8461828">template</span><span class="op" id="8461836">,</span>&nbsp;<span class="string" id="8461838">&#34;TLSv12-&#34;</span><span class="op" id="8461847">,</span>&nbsp;<span class="string" id="8461849">&#34;-tls1_2&#34;</span><span class="op" id="8461858">)</span><br>
<span class="lineno">270</span><span class="op" id="8461860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8461863">func</span>&nbsp;<span class="ident" id="8461868">TestHandshakeClientRSARC4</span><span class="op" id="8461893">(</span><span class="ident" id="8461894">t</span>&nbsp;<span class="op" id="8461896">*</span><span class="ident" id="8461897">testing</span><span class="op" id="8461904">.</span><span class="ident" id="8461905">T</span><span class="op" id="8461906">)</span>&nbsp;<span class="op" id="8461908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461911">test</span>&nbsp;<span class="op" id="8461916">:=</span>&nbsp;<span class="op" id="8461919">&amp;</span><span class="ident" id="8461920">clientTest</span><span class="op" id="8461930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461934">name</span><span class="op" id="8461938">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8461943">&#34;RSA-RC4&#34;</span><span class="op" id="8461952">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8461956">command</span><span class="op" id="8461963">:</span>&nbsp;<span class="op" id="8461965">[</span><span class="op" id="8461966">]</span><span class="builtintype" id="8461967">string</span><span class="op" id="8461973">{</span><span class="string" id="8461974">&#34;openssl&#34;</span><span class="op" id="8461983">,</span>&nbsp;<span class="string" id="8461985">&#34;s_server&#34;</span><span class="op" id="8461995">,</span>&nbsp;<span class="string" id="8461997">&#34;-cipher&#34;</span><span class="op" id="8462006">,</span>&nbsp;<span class="string" id="8462008">&#34;RC4-SHA&#34;</span><span class="op" id="8462017">}</span><span class="op" id="8462018">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462024">runClientTestTLS10</span><span class="op" id="8462042">(</span><span class="ident" id="8462043">t</span><span class="op" id="8462044">,</span>&nbsp;<span class="ident" id="8462046">test</span><span class="op" id="8462050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462053">runClientTestTLS11</span><span class="op" id="8462071">(</span><span class="ident" id="8462072">t</span><span class="op" id="8462073">,</span>&nbsp;<span class="ident" id="8462075">test</span><span class="op" id="8462079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462082">runClientTestTLS12</span><span class="op" id="8462100">(</span><span class="ident" id="8462101">t</span><span class="op" id="8462102">,</span>&nbsp;<span class="ident" id="8462104">test</span><span class="op" id="8462108">)</span><br>
<span class="lineno">280</span><span class="op" id="8462110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8462113">func</span>&nbsp;<span class="ident" id="8462118">TestHandshakeClientECDHERSAAES</span><span class="op" id="8462148">(</span><span class="ident" id="8462149">t</span>&nbsp;<span class="op" id="8462151">*</span><span class="ident" id="8462152">testing</span><span class="op" id="8462159">.</span><span class="ident" id="8462160">T</span><span class="op" id="8462161">)</span>&nbsp;<span class="op" id="8462163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462166">test</span>&nbsp;<span class="op" id="8462171">:=</span>&nbsp;<span class="op" id="8462174">&amp;</span><span class="ident" id="8462175">clientTest</span><span class="op" id="8462185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462189">name</span><span class="op" id="8462193">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8462198">&#34;ECDHE-RSA-AES&#34;</span><span class="op" id="8462213">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462217">command</span><span class="op" id="8462224">:</span>&nbsp;<span class="op" id="8462226">[</span><span class="op" id="8462227">]</span><span class="builtintype" id="8462228">string</span><span class="op" id="8462234">{</span><span class="string" id="8462235">&#34;openssl&#34;</span><span class="op" id="8462244">,</span>&nbsp;<span class="string" id="8462246">&#34;s_server&#34;</span><span class="op" id="8462256">,</span>&nbsp;<span class="string" id="8462258">&#34;-cipher&#34;</span><span class="op" id="8462267">,</span>&nbsp;<span class="string" id="8462269">&#34;ECDHE-RSA-AES128-SHA&#34;</span><span class="op" id="8462291">}</span><span class="op" id="8462292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462298">runClientTestTLS10</span><span class="op" id="8462316">(</span><span class="ident" id="8462317">t</span><span class="op" id="8462318">,</span>&nbsp;<span class="ident" id="8462320">test</span><span class="op" id="8462324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462327">runClientTestTLS11</span><span class="op" id="8462345">(</span><span class="ident" id="8462346">t</span><span class="op" id="8462347">,</span>&nbsp;<span class="ident" id="8462349">test</span><span class="op" id="8462353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462356">runClientTestTLS12</span><span class="op" id="8462374">(</span><span class="ident" id="8462375">t</span><span class="op" id="8462376">,</span>&nbsp;<span class="ident" id="8462378">test</span><span class="op" id="8462382">)</span><br>
<span class="lineno">290</span><span class="op" id="8462384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8462387">func</span>&nbsp;<span class="ident" id="8462392">TestHandshakeClientECDHEECDSAAES</span><span class="op" id="8462424">(</span><span class="ident" id="8462425">t</span>&nbsp;<span class="op" id="8462427">*</span><span class="ident" id="8462428">testing</span><span class="op" id="8462435">.</span><span class="ident" id="8462436">T</span><span class="op" id="8462437">)</span>&nbsp;<span class="op" id="8462439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462442">test</span>&nbsp;<span class="op" id="8462447">:=</span>&nbsp;<span class="op" id="8462450">&amp;</span><span class="ident" id="8462451">clientTest</span><span class="op" id="8462461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462465">name</span><span class="op" id="8462469">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8462474">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="8462491">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462495">command</span><span class="op" id="8462502">:</span>&nbsp;<span class="op" id="8462504">[</span><span class="op" id="8462505">]</span><span class="builtintype" id="8462506">string</span><span class="op" id="8462512">{</span><span class="string" id="8462513">&#34;openssl&#34;</span><span class="op" id="8462522">,</span>&nbsp;<span class="string" id="8462524">&#34;s_server&#34;</span><span class="op" id="8462534">,</span>&nbsp;<span class="string" id="8462536">&#34;-cipher&#34;</span><span class="op" id="8462545">,</span>&nbsp;<span class="string" id="8462547">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="8462571">}</span><span class="op" id="8462572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462576">cert</span><span class="op" id="8462580">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8462585">testECDSACertificate</span><span class="op" id="8462605">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462609">key</span><span class="op" id="8462612">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8462618">testECDSAPrivateKey</span><span class="op" id="8462637">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462643">runClientTestTLS10</span><span class="op" id="8462661">(</span><span class="ident" id="8462662">t</span><span class="op" id="8462663">,</span>&nbsp;<span class="ident" id="8462665">test</span><span class="op" id="8462669">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462672">runClientTestTLS11</span><span class="op" id="8462690">(</span><span class="ident" id="8462691">t</span><span class="op" id="8462692">,</span>&nbsp;<span class="ident" id="8462694">test</span><span class="op" id="8462698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462701">runClientTestTLS12</span><span class="op" id="8462719">(</span><span class="ident" id="8462720">t</span><span class="op" id="8462721">,</span>&nbsp;<span class="ident" id="8462723">test</span><span class="op" id="8462727">)</span><br>
<span class="lineno"></span><span class="op" id="8462729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8462732">func</span>&nbsp;<span class="ident" id="8462737">TestHandshakeClientECDHEECDSAAESGCM</span><span class="op" id="8462772">(</span><span class="ident" id="8462773">t</span>&nbsp;<span class="op" id="8462775">*</span><span class="ident" id="8462776">testing</span><span class="op" id="8462783">.</span><span class="ident" id="8462784">T</span><span class="op" id="8462785">)</span>&nbsp;<span class="op" id="8462787">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462790">test</span>&nbsp;<span class="op" id="8462795">:=</span>&nbsp;<span class="op" id="8462798">&amp;</span><span class="ident" id="8462799">clientTest</span><span class="op" id="8462809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462813">name</span><span class="op" id="8462817">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8462822">&#34;ECDHE-ECDSA-AES-GCM&#34;</span><span class="op" id="8462843">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462847">command</span><span class="op" id="8462854">:</span>&nbsp;<span class="op" id="8462856">[</span><span class="op" id="8462857">]</span><span class="builtintype" id="8462858">string</span><span class="op" id="8462864">{</span><span class="string" id="8462865">&#34;openssl&#34;</span><span class="op" id="8462874">,</span>&nbsp;<span class="string" id="8462876">&#34;s_server&#34;</span><span class="op" id="8462886">,</span>&nbsp;<span class="string" id="8462888">&#34;-cipher&#34;</span><span class="op" id="8462897">,</span>&nbsp;<span class="string" id="8462899">&#34;ECDHE-ECDSA-AES128-GCM-SHA256&#34;</span><span class="op" id="8462930">}</span><span class="op" id="8462931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462935">cert</span><span class="op" id="8462939">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8462944">testECDSACertificate</span><span class="op" id="8462964">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8462968">key</span><span class="op" id="8462971">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8462977">testECDSAPrivateKey</span><span class="op" id="8462996">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8462999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463002">runClientTestTLS12</span><span class="op" id="8463020">(</span><span class="ident" id="8463021">t</span><span class="op" id="8463022">,</span>&nbsp;<span class="ident" id="8463024">test</span><span class="op" id="8463028">)</span><br>
<span class="lineno"></span><span class="op" id="8463030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8463033">func</span>&nbsp;<span class="ident" id="8463038">TestHandshakeClientCertRSA</span><span class="op" id="8463064">(</span><span class="ident" id="8463065">t</span>&nbsp;<span class="op" id="8463067">*</span><span class="ident" id="8463068">testing</span><span class="op" id="8463075">.</span><span class="ident" id="8463076">T</span><span class="op" id="8463077">)</span>&nbsp;<span class="op" id="8463079">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463082">config</span>&nbsp;<span class="op" id="8463089">:=</span>&nbsp;<span class="op" id="8463092">*</span><span class="ident" id="8463093">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463105">cert</span><span class="op" id="8463109">,</span>&nbsp;<span class="ident" id="8463111">_</span>&nbsp;<span class="op" id="8463113">:=</span>&nbsp;<span class="ident" id="8463116">X509KeyPair</span><span class="op" id="8463127">(</span><span class="op" id="8463128">[</span><span class="op" id="8463129">]</span><span class="builtintype" id="8463130">byte</span><span class="op" id="8463134">(</span><span class="ident" id="8463135">clientCertificatePEM</span><span class="op" id="8463155">)</span><span class="op" id="8463156">,</span>&nbsp;<span class="op" id="8463158">[</span><span class="op" id="8463159">]</span><span class="builtintype" id="8463160">byte</span><span class="op" id="8463164">(</span><span class="ident" id="8463165">clientKeyPEM</span><span class="op" id="8463177">)</span><span class="op" id="8463178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463181">config</span><span class="op" id="8463187">.</span><span class="ident" id="8463188">Certificates</span>&nbsp;<span class="op" id="8463201">=</span>&nbsp;<span class="op" id="8463203">[</span><span class="op" id="8463204">]</span><span class="ident" id="8463205">Certificate</span><span class="op" id="8463216">{</span><span class="ident" id="8463217">cert</span><span class="op" id="8463221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463225">test</span>&nbsp;<span class="op" id="8463230">:=</span>&nbsp;<span class="op" id="8463233">&amp;</span><span class="ident" id="8463234">clientTest</span><span class="op" id="8463244">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463248">name</span><span class="op" id="8463252">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8463257">&#34;ClientCert-RSA-RSA&#34;</span><span class="op" id="8463277">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463281">command</span><span class="op" id="8463288">:</span>&nbsp;<span class="op" id="8463290">[</span><span class="op" id="8463291">]</span><span class="builtintype" id="8463292">string</span><span class="op" id="8463298">{</span><span class="string" id="8463299">&#34;openssl&#34;</span><span class="op" id="8463308">,</span>&nbsp;<span class="string" id="8463310">&#34;s_server&#34;</span><span class="op" id="8463320">,</span>&nbsp;<span class="string" id="8463322">&#34;-cipher&#34;</span><span class="op" id="8463331">,</span>&nbsp;<span class="string" id="8463333">&#34;RC4-SHA&#34;</span><span class="op" id="8463342">,</span>&nbsp;<span class="string" id="8463344">&#34;-verify&#34;</span><span class="op" id="8463353">,</span>&nbsp;<span class="string" id="8463355">&#34;1&#34;</span><span class="op" id="8463358">}</span><span class="op" id="8463359">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463363">config</span><span class="op" id="8463369">:</span>&nbsp;&nbsp;<span class="op" id="8463372">&amp;</span><span class="ident" id="8463373">config</span><span class="op" id="8463379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463386">runClientTestTLS10</span><span class="op" id="8463404">(</span><span class="ident" id="8463405">t</span><span class="op" id="8463406">,</span>&nbsp;<span class="ident" id="8463408">test</span><span class="op" id="8463412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463415">runClientTestTLS12</span><span class="op" id="8463433">(</span><span class="ident" id="8463434">t</span><span class="op" id="8463435">,</span>&nbsp;<span class="ident" id="8463437">test</span><span class="op" id="8463441">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463445">test</span>&nbsp;<span class="op" id="8463450">=</span>&nbsp;<span class="op" id="8463452">&amp;</span><span class="ident" id="8463453">clientTest</span><span class="op" id="8463463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463467">name</span><span class="op" id="8463471">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8463476">&#34;ClientCert-RSA-ECDSA&#34;</span><span class="op" id="8463498">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463502">command</span><span class="op" id="8463509">:</span>&nbsp;<span class="op" id="8463511">[</span><span class="op" id="8463512">]</span><span class="builtintype" id="8463513">string</span><span class="op" id="8463519">{</span><span class="string" id="8463520">&#34;openssl&#34;</span><span class="op" id="8463529">,</span>&nbsp;<span class="string" id="8463531">&#34;s_server&#34;</span><span class="op" id="8463541">,</span>&nbsp;<span class="string" id="8463543">&#34;-cipher&#34;</span><span class="op" id="8463552">,</span>&nbsp;<span class="string" id="8463554">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="8463578">,</span>&nbsp;<span class="string" id="8463580">&#34;-verify&#34;</span><span class="op" id="8463589">,</span>&nbsp;<span class="string" id="8463591">&#34;1&#34;</span><span class="op" id="8463594">}</span><span class="op" id="8463595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463599">config</span><span class="op" id="8463605">:</span>&nbsp;&nbsp;<span class="op" id="8463608">&amp;</span><span class="ident" id="8463609">config</span><span class="op" id="8463615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463619">cert</span><span class="op" id="8463623">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8463628">testECDSACertificate</span><span class="op" id="8463648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463652">key</span><span class="op" id="8463655">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8463661">testECDSAPrivateKey</span><span class="op" id="8463680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8463683">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463687">runClientTestTLS10</span><span class="op" id="8463705">(</span><span class="ident" id="8463706">t</span><span class="op" id="8463707">,</span>&nbsp;<span class="ident" id="8463709">test</span><span class="op" id="8463713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463716">runClientTestTLS12</span><span class="op" id="8463734">(</span><span class="ident" id="8463735">t</span><span class="op" id="8463736">,</span>&nbsp;<span class="ident" id="8463738">test</span><span class="op" id="8463742">)</span><br>
<span class="lineno"></span><span class="op" id="8463744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="8463747">func</span>&nbsp;<span class="ident" id="8463752">TestHandshakeClientCertECDSA</span><span class="op" id="8463780">(</span><span class="ident" id="8463781">t</span>&nbsp;<span class="op" id="8463783">*</span><span class="ident" id="8463784">testing</span><span class="op" id="8463791">.</span><span class="ident" id="8463792">T</span><span class="op" id="8463793">)</span>&nbsp;<span class="op" id="8463795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463798">config</span>&nbsp;<span class="op" id="8463805">:=</span>&nbsp;<span class="op" id="8463808">*</span><span class="ident" id="8463809">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463821">cert</span><span class="op" id="8463825">,</span>&nbsp;<span class="ident" id="8463827">_</span>&nbsp;<span class="op" id="8463829">:=</span>&nbsp;<span class="ident" id="8463832">X509KeyPair</span><span class="op" id="8463843">(</span><span class="op" id="8463844">[</span><span class="op" id="8463845">]</span><span class="builtintype" id="8463846">byte</span><span class="op" id="8463850">(</span><span class="ident" id="8463851">clientECDSACertificatePEM</span><span class="op" id="8463876">)</span><span class="op" id="8463877">,</span>&nbsp;<span class="op" id="8463879">[</span><span class="op" id="8463880">]</span><span class="builtintype" id="8463881">byte</span><span class="op" id="8463885">(</span><span class="ident" id="8463886">clientECDSAKeyPEM</span><span class="op" id="8463903">)</span><span class="op" id="8463904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463907">config</span><span class="op" id="8463913">.</span><span class="ident" id="8463914">Certificates</span>&nbsp;<span class="op" id="8463927">=</span>&nbsp;<span class="op" id="8463929">[</span><span class="op" id="8463930">]</span><span class="ident" id="8463931">Certificate</span><span class="op" id="8463942">{</span><span class="ident" id="8463943">cert</span><span class="op" id="8463947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463951">test</span>&nbsp;<span class="op" id="8463956">:=</span>&nbsp;<span class="op" id="8463959">&amp;</span><span class="ident" id="8463960">clientTest</span><span class="op" id="8463970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8463974">name</span><span class="op" id="8463978">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8463983">&#34;ClientCert-ECDSA-RSA&#34;</span><span class="op" id="8464005">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464009">command</span><span class="op" id="8464016">:</span>&nbsp;<span class="op" id="8464018">[</span><span class="op" id="8464019">]</span><span class="builtintype" id="8464020">string</span><span class="op" id="8464026">{</span><span class="string" id="8464027">&#34;openssl&#34;</span><span class="op" id="8464036">,</span>&nbsp;<span class="string" id="8464038">&#34;s_server&#34;</span><span class="op" id="8464048">,</span>&nbsp;<span class="string" id="8464050">&#34;-cipher&#34;</span><span class="op" id="8464059">,</span>&nbsp;<span class="string" id="8464061">&#34;RC4-SHA&#34;</span><span class="op" id="8464070">,</span>&nbsp;<span class="string" id="8464072">&#34;-verify&#34;</span><span class="op" id="8464081">,</span>&nbsp;<span class="string" id="8464083">&#34;1&#34;</span><span class="op" id="8464086">}</span><span class="op" id="8464087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464091">config</span><span class="op" id="8464097">:</span>&nbsp;&nbsp;<span class="op" id="8464100">&amp;</span><span class="ident" id="8464101">config</span><span class="op" id="8464107">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464110">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464114">runClientTestTLS10</span><span class="op" id="8464132">(</span><span class="ident" id="8464133">t</span><span class="op" id="8464134">,</span>&nbsp;<span class="ident" id="8464136">test</span><span class="op" id="8464140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464143">runClientTestTLS12</span><span class="op" id="8464161">(</span><span class="ident" id="8464162">t</span><span class="op" id="8464163">,</span>&nbsp;<span class="ident" id="8464165">test</span><span class="op" id="8464169">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464173">test</span>&nbsp;<span class="op" id="8464178">=</span>&nbsp;<span class="op" id="8464180">&amp;</span><span class="ident" id="8464181">clientTest</span><span class="op" id="8464191">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464195">name</span><span class="op" id="8464199">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8464204">&#34;ClientCert-ECDSA-ECDSA&#34;</span><span class="op" id="8464228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464232">command</span><span class="op" id="8464239">:</span>&nbsp;<span class="op" id="8464241">[</span><span class="op" id="8464242">]</span><span class="builtintype" id="8464243">string</span><span class="op" id="8464249">{</span><span class="string" id="8464250">&#34;openssl&#34;</span><span class="op" id="8464259">,</span>&nbsp;<span class="string" id="8464261">&#34;s_server&#34;</span><span class="op" id="8464271">,</span>&nbsp;<span class="string" id="8464273">&#34;-cipher&#34;</span><span class="op" id="8464282">,</span>&nbsp;<span class="string" id="8464284">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="8464308">,</span>&nbsp;<span class="string" id="8464310">&#34;-verify&#34;</span><span class="op" id="8464319">,</span>&nbsp;<span class="string" id="8464321">&#34;1&#34;</span><span class="op" id="8464324">}</span><span class="op" id="8464325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464329">config</span><span class="op" id="8464335">:</span>&nbsp;&nbsp;<span class="op" id="8464338">&amp;</span><span class="ident" id="8464339">config</span><span class="op" id="8464345">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464349">cert</span><span class="op" id="8464353">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8464358">testECDSACertificate</span><span class="op" id="8464378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464382">key</span><span class="op" id="8464385">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8464391">testECDSAPrivateKey</span><span class="op" id="8464410">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464417">runClientTestTLS10</span><span class="op" id="8464435">(</span><span class="ident" id="8464436">t</span><span class="op" id="8464437">,</span>&nbsp;<span class="ident" id="8464439">test</span><span class="op" id="8464443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464446">runClientTestTLS12</span><span class="op" id="8464464">(</span><span class="ident" id="8464465">t</span><span class="op" id="8464466">,</span>&nbsp;<span class="ident" id="8464468">test</span><span class="op" id="8464472">)</span><br>
<span class="lineno"></span><span class="op" id="8464474">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="8464477">func</span>&nbsp;<span class="ident" id="8464482">TestClientResumption</span><span class="op" id="8464502">(</span><span class="ident" id="8464503">t</span>&nbsp;<span class="op" id="8464505">*</span><span class="ident" id="8464506">testing</span><span class="op" id="8464513">.</span><span class="ident" id="8464514">T</span><span class="op" id="8464515">)</span>&nbsp;<span class="op" id="8464517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464520">serverConfig</span>&nbsp;<span class="op" id="8464533">:=</span>&nbsp;<span class="op" id="8464536">&amp;</span><span class="ident" id="8464537">Config</span><span class="op" id="8464543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464547">CipherSuites</span><span class="op" id="8464559">:</span>&nbsp;<span class="op" id="8464561">[</span><span class="op" id="8464562">]</span><span class="builtintype" id="8464563">uint16</span><span class="op" id="8464569">{</span><span class="ident" id="8464570">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8464594">,</span>&nbsp;<span class="ident" id="8464596">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="8464626">}</span><span class="op" id="8464627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464631">Certificates</span><span class="op" id="8464643">:</span>&nbsp;<span class="ident" id="8464645">testConfig</span><span class="op" id="8464655">.</span><span class="ident" id="8464656">Certificates</span><span class="op" id="8464668">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464674">clientConfig</span>&nbsp;<span class="op" id="8464687">:=</span>&nbsp;<span class="op" id="8464690">&amp;</span><span class="ident" id="8464691">Config</span><span class="op" id="8464697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464701">CipherSuites</span><span class="op" id="8464713">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8464721">[</span><span class="op" id="8464722">]</span><span class="builtintype" id="8464723">uint16</span><span class="op" id="8464729">{</span><span class="ident" id="8464730">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8464754">}</span><span class="op" id="8464755">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464759">InsecureSkipVerify</span><span class="op" id="8464777">:</span>&nbsp;<span class="builtintype" id="8464779">true</span><span class="op" id="8464783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464787">ClientSessionCache</span><span class="op" id="8464805">:</span>&nbsp;<span class="ident" id="8464807">NewLRUClientSessionCache</span><span class="op" id="8464831">(</span><span class="num" id="8464832">32</span><span class="op" id="8464834">)</span><span class="op" id="8464835">,</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8464838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464842">testResumeState</span>&nbsp;<span class="op" id="8464858">:=</span>&nbsp;<span class="keyword" id="8464861">func</span><span class="op" id="8464865">(</span><span class="ident" id="8464866">test</span>&nbsp;<span class="builtintype" id="8464871">string</span><span class="op" id="8464877">,</span>&nbsp;<span class="ident" id="8464879">didResume</span>&nbsp;<span class="builtintype" id="8464889">bool</span><span class="op" id="8464893">)</span>&nbsp;<span class="op" id="8464895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464899">hs</span><span class="op" id="8464901">,</span>&nbsp;<span class="ident" id="8464903">err</span>&nbsp;<span class="op" id="8464907">:=</span>&nbsp;<span class="ident" id="8464910">testHandshake</span><span class="op" id="8464923">(</span><span class="ident" id="8464924">clientConfig</span><span class="op" id="8464936">,</span>&nbsp;<span class="ident" id="8464938">serverConfig</span><span class="op" id="8464950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8464954">if</span>&nbsp;<span class="ident" id="8464957">err</span>&nbsp;<span class="op" id="8464961">!=</span>&nbsp;<span class="ident" id="8464964">nil</span>&nbsp;<span class="op" id="8464968">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8464973">t</span><span class="op" id="8464974">.</span><span class="ident" id="8464975">Fatalf</span><span class="op" id="8464981">(</span><span class="string" id="8464982">&#34;%s:&nbsp;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8465008">,</span>&nbsp;<span class="ident" id="8465010">test</span><span class="op" id="8465014">,</span>&nbsp;<span class="ident" id="8465016">err</span><span class="op" id="8465019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465027">if</span>&nbsp;<span class="ident" id="8465030">hs</span><span class="op" id="8465032">.</span><span class="ident" id="8465033">DidResume</span>&nbsp;<span class="op" id="8465043">!=</span>&nbsp;<span class="ident" id="8465046">didResume</span>&nbsp;<span class="op" id="8465056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465061">t</span><span class="op" id="8465062">.</span><span class="ident" id="8465063">Fatalf</span><span class="op" id="8465069">(</span><span class="string" id="8465070">&#34;%s&nbsp;resumed:&nbsp;%v,&nbsp;expected:&nbsp;%v&#34;</span><span class="op" id="8465100">,</span>&nbsp;<span class="ident" id="8465102">test</span><span class="op" id="8465106">,</span>&nbsp;<span class="ident" id="8465108">hs</span><span class="op" id="8465110">.</span><span class="ident" id="8465111">DidResume</span><span class="op" id="8465120">,</span>&nbsp;<span class="ident" id="8465122">didResume</span><span class="op" id="8465131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465135">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465142">testResumeState</span><span class="op" id="8465157">(</span><span class="string" id="8465158">&#34;Handshake&#34;</span><span class="op" id="8465169">,</span>&nbsp;<span class="builtintype" id="8465171">false</span><span class="op" id="8465176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465179">testResumeState</span><span class="op" id="8465194">(</span><span class="string" id="8465195">&#34;Resume&#34;</span><span class="op" id="8465203">,</span>&nbsp;<span class="builtintype" id="8465205">true</span><span class="op" id="8465209">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8465213">if</span>&nbsp;<span class="ident" id="8465216">_</span><span class="op" id="8465217">,</span>&nbsp;<span class="ident" id="8465219">err</span>&nbsp;<span class="op" id="8465223">:=</span>&nbsp;<span class="ident" id="8465226">io</span><span class="op" id="8465228">.</span><span class="ident" id="8465229">ReadFull</span><span class="op" id="8465237">(</span><span class="ident" id="8465238">serverConfig</span><span class="op" id="8465250">.</span><span class="ident" id="8465251">rand</span><span class="op" id="8465255">(</span><span class="op" id="8465256">)</span><span class="op" id="8465257">,</span>&nbsp;<span class="ident" id="8465259">serverConfig</span><span class="op" id="8465271">.</span><span class="ident" id="8465272">SessionTicketKey</span><span class="op" id="8465288">[</span><span class="op" id="8465289">:</span><span class="op" id="8465290">]</span><span class="op" id="8465291">)</span><span class="op" id="8465292">;</span>&nbsp;<span class="ident" id="8465294">err</span>&nbsp;<span class="op" id="8465298">!=</span>&nbsp;<span class="ident" id="8465301">nil</span>&nbsp;<span class="op" id="8465305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465309">t</span><span class="op" id="8465310">.</span><span class="ident" id="8465311">Fatalf</span><span class="op" id="8465317">(</span><span class="string" id="8465318">&#34;Failed&nbsp;to&nbsp;invalidate&nbsp;SessionTicketKey&#34;</span><span class="op" id="8465357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8465360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465363">testResumeState</span><span class="op" id="8465378">(</span><span class="string" id="8465379">&#34;InvalidSessionTicketKey&#34;</span><span class="op" id="8465404">,</span>&nbsp;<span class="builtintype" id="8465406">false</span><span class="op" id="8465411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465414">testResumeState</span><span class="op" id="8465429">(</span><span class="string" id="8465430">&#34;ResumeAfterInvalidSessionTicketKey&#34;</span><span class="op" id="8465466">,</span>&nbsp;<span class="builtintype" id="8465468">true</span><span class="op" id="8465472">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465476">clientConfig</span><span class="op" id="8465488">.</span><span class="ident" id="8465489">CipherSuites</span>&nbsp;<span class="op" id="8465502">=</span>&nbsp;<span class="op" id="8465504">[</span><span class="op" id="8465505">]</span><span class="builtintype" id="8465506">uint16</span><span class="op" id="8465512">{</span><span class="ident" id="8465513">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="8465543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465546">testResumeState</span><span class="op" id="8465561">(</span><span class="string" id="8465562">&#34;DifferentCipherSuite&#34;</span><span class="op" id="8465584">,</span>&nbsp;<span class="builtintype" id="8465586">false</span><span class="op" id="8465591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465594">testResumeState</span><span class="op" id="8465609">(</span><span class="string" id="8465610">&#34;DifferentCipherSuiteRecovers&#34;</span><span class="op" id="8465640">,</span>&nbsp;<span class="builtintype" id="8465642">true</span><span class="op" id="8465646">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465650">clientConfig</span><span class="op" id="8465662">.</span><span class="ident" id="8465663">ClientSessionCache</span>&nbsp;<span class="op" id="8465682">=</span>&nbsp;<span class="ident" id="8465684">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465689">testResumeState</span><span class="op" id="8465704">(</span><span class="string" id="8465705">&#34;WithoutSessionCache&#34;</span><span class="op" id="8465726">,</span>&nbsp;<span class="builtintype" id="8465728">false</span><span class="op" id="8465733">)</span><br>
<span class="lineno"></span><span class="op" id="8465735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8465738">func</span>&nbsp;<span class="ident" id="8465743">TestLRUClientSessionCache</span><span class="op" id="8465768">(</span><span class="ident" id="8465769">t</span>&nbsp;<span class="op" id="8465771">*</span><span class="ident" id="8465772">testing</span><span class="op" id="8465779">.</span><span class="ident" id="8465780">T</span><span class="op" id="8465781">)</span>&nbsp;<span class="op" id="8465783">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8465786">//&nbsp;Initialize&nbsp;cache&nbsp;of&nbsp;capacity&nbsp;4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465822">cache</span>&nbsp;<span class="op" id="8465828">:=</span>&nbsp;<span class="ident" id="8465831">NewLRUClientSessionCache</span><span class="op" id="8465855">(</span><span class="num" id="8465856">4</span><span class="op" id="8465857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465860">cs</span>&nbsp;<span class="op" id="8465863">:=</span>&nbsp;<span class="builtinfunc" id="8465866">make</span><span class="op" id="8465870">(</span><span class="op" id="8465871">[</span><span class="op" id="8465872">]</span><span class="ident" id="8465873">ClientSessionState</span><span class="op" id="8465891">,</span>&nbsp;<span class="num" id="8465893">6</span><span class="op" id="8465894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8465897">keys</span>&nbsp;<span class="op" id="8465902">:=</span>&nbsp;<span class="op" id="8465905">[</span><span class="op" id="8465906">]</span><span class="builtintype" id="8465907">string</span><span class="op" id="8465913">{</span><span class="string" id="8465914">&#34;0&#34;</span><span class="op" id="8465917">,</span>&nbsp;<span class="string" id="8465919">&#34;1&#34;</span><span class="op" id="8465922">,</span>&nbsp;<span class="string" id="8465924">&#34;2&#34;</span><span class="op" id="8465927">,</span>&nbsp;<span class="string" id="8465929">&#34;3&#34;</span><span class="op" id="8465932">,</span>&nbsp;<span class="string" id="8465934">&#34;4&#34;</span><span class="op" id="8465937">,</span>&nbsp;<span class="string" id="8465939">&#34;5&#34;</span><span class="op" id="8465942">,</span>&nbsp;<span class="string" id="8465944">&#34;6&#34;</span><span class="op" id="8465947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8465951">//&nbsp;Add&nbsp;4&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache&nbsp;and&nbsp;look&nbsp;them&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466000">for</span>&nbsp;<span class="ident" id="8466004">i</span>&nbsp;<span class="op" id="8466006">:=</span>&nbsp;<span class="num" id="8466009">0</span><span class="op" id="8466010">;</span>&nbsp;<span class="ident" id="8466012">i</span>&nbsp;<span class="op" id="8466014">&lt;</span>&nbsp;<span class="num" id="8466016">4</span><span class="op" id="8466017">;</span>&nbsp;<span class="ident" id="8466019">i</span><span class="op" id="8466020">++</span>&nbsp;<span class="op" id="8466023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466027">cache</span><span class="op" id="8466032">.</span><span class="ident" id="8466033">Put</span><span class="op" id="8466036">(</span><span class="ident" id="8466037">keys</span><span class="op" id="8466041">[</span><span class="ident" id="8466042">i</span><span class="op" id="8466043">]</span><span class="op" id="8466044">,</span>&nbsp;<span class="op" id="8466046">&amp;</span><span class="ident" id="8466047">cs</span><span class="op" id="8466049">[</span><span class="ident" id="8466050">i</span><span class="op" id="8466051">]</span><span class="op" id="8466052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466058">for</span>&nbsp;<span class="ident" id="8466062">i</span>&nbsp;<span class="op" id="8466064">:=</span>&nbsp;<span class="num" id="8466067">0</span><span class="op" id="8466068">;</span>&nbsp;<span class="ident" id="8466070">i</span>&nbsp;<span class="op" id="8466072">&lt;</span>&nbsp;<span class="num" id="8466074">4</span><span class="op" id="8466075">;</span>&nbsp;<span class="ident" id="8466077">i</span><span class="op" id="8466078">++</span>&nbsp;<span class="op" id="8466081">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466085">if</span>&nbsp;<span class="ident" id="8466088">s</span><span class="op" id="8466089">,</span>&nbsp;<span class="ident" id="8466091">ok</span>&nbsp;<span class="op" id="8466094">:=</span>&nbsp;<span class="ident" id="8466097">cache</span><span class="op" id="8466102">.</span><span class="ident" id="8466103">Get</span><span class="op" id="8466106">(</span><span class="ident" id="8466107">keys</span><span class="op" id="8466111">[</span><span class="ident" id="8466112">i</span><span class="op" id="8466113">]</span><span class="op" id="8466114">)</span><span class="op" id="8466115">;</span>&nbsp;<span class="op" id="8466117">!</span><span class="ident" id="8466118">ok</span>&nbsp;<span class="op" id="8466121">||</span>&nbsp;<span class="ident" id="8466124">s</span>&nbsp;<span class="op" id="8466126">!=</span>&nbsp;<span class="op" id="8466129">&amp;</span><span class="ident" id="8466130">cs</span><span class="op" id="8466132">[</span><span class="ident" id="8466133">i</span><span class="op" id="8466134">]</span>&nbsp;<span class="op" id="8466136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466141">t</span><span class="op" id="8466142">.</span><span class="ident" id="8466143">Fatalf</span><span class="op" id="8466149">(</span><span class="string" id="8466150">&#34;session&nbsp;cache&nbsp;failed&nbsp;lookup&nbsp;for&nbsp;added&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="8466197">,</span>&nbsp;<span class="ident" id="8466199">keys</span><span class="op" id="8466203">[</span><span class="ident" id="8466204">i</span><span class="op" id="8466205">]</span><span class="op" id="8466206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8466217">//&nbsp;Add&nbsp;2&nbsp;more&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache.&nbsp;First&nbsp;2&nbsp;should&nbsp;be&nbsp;evicted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466281">for</span>&nbsp;<span class="ident" id="8466285">i</span>&nbsp;<span class="op" id="8466287">:=</span>&nbsp;<span class="num" id="8466290">4</span><span class="op" id="8466291">;</span>&nbsp;<span class="ident" id="8466293">i</span>&nbsp;<span class="op" id="8466295">&lt;</span>&nbsp;<span class="num" id="8466297">6</span><span class="op" id="8466298">;</span>&nbsp;<span class="ident" id="8466300">i</span><span class="op" id="8466301">++</span>&nbsp;<span class="op" id="8466304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466308">cache</span><span class="op" id="8466313">.</span><span class="ident" id="8466314">Put</span><span class="op" id="8466317">(</span><span class="ident" id="8466318">keys</span><span class="op" id="8466322">[</span><span class="ident" id="8466323">i</span><span class="op" id="8466324">]</span><span class="op" id="8466325">,</span>&nbsp;<span class="op" id="8466327">&amp;</span><span class="ident" id="8466328">cs</span><span class="op" id="8466330">[</span><span class="ident" id="8466331">i</span><span class="op" id="8466332">]</span><span class="op" id="8466333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466339">for</span>&nbsp;<span class="ident" id="8466343">i</span>&nbsp;<span class="op" id="8466345">:=</span>&nbsp;<span class="num" id="8466348">0</span><span class="op" id="8466349">;</span>&nbsp;<span class="ident" id="8466351">i</span>&nbsp;<span class="op" id="8466353">&lt;</span>&nbsp;<span class="num" id="8466355">2</span><span class="op" id="8466356">;</span>&nbsp;<span class="ident" id="8466358">i</span><span class="op" id="8466359">++</span>&nbsp;<span class="op" id="8466362">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466366">if</span>&nbsp;<span class="ident" id="8466369">s</span><span class="op" id="8466370">,</span>&nbsp;<span class="ident" id="8466372">ok</span>&nbsp;<span class="op" id="8466375">:=</span>&nbsp;<span class="ident" id="8466378">cache</span><span class="op" id="8466383">.</span><span class="ident" id="8466384">Get</span><span class="op" id="8466387">(</span><span class="ident" id="8466388">keys</span><span class="op" id="8466392">[</span><span class="ident" id="8466393">i</span><span class="op" id="8466394">]</span><span class="op" id="8466395">)</span><span class="op" id="8466396">;</span>&nbsp;<span class="ident" id="8466398">ok</span>&nbsp;<span class="op" id="8466401">||</span>&nbsp;<span class="ident" id="8466404">s</span>&nbsp;<span class="op" id="8466406">!=</span>&nbsp;<span class="ident" id="8466409">nil</span>&nbsp;<span class="op" id="8466413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466418">t</span><span class="op" id="8466419">.</span><span class="ident" id="8466420">Fatalf</span><span class="op" id="8466426">(</span><span class="string" id="8466427">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="8466470">,</span>&nbsp;<span class="ident" id="8466472">keys</span><span class="op" id="8466476">[</span><span class="ident" id="8466477">i</span><span class="op" id="8466478">]</span><span class="op" id="8466479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8466490">//&nbsp;Touch&nbsp;entry&nbsp;2.&nbsp;LRU&nbsp;should&nbsp;evict&nbsp;3&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466534">cache</span><span class="op" id="8466539">.</span><span class="ident" id="8466540">Get</span><span class="op" id="8466543">(</span><span class="ident" id="8466544">keys</span><span class="op" id="8466548">[</span><span class="num" id="8466549">2</span><span class="op" id="8466550">]</span><span class="op" id="8466551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466554">cache</span><span class="op" id="8466559">.</span><span class="ident" id="8466560">Put</span><span class="op" id="8466563">(</span><span class="ident" id="8466564">keys</span><span class="op" id="8466568">[</span><span class="num" id="8466569">0</span><span class="op" id="8466570">]</span><span class="op" id="8466571">,</span>&nbsp;<span class="op" id="8466573">&amp;</span><span class="ident" id="8466574">cs</span><span class="op" id="8466576">[</span><span class="num" id="8466577">0</span><span class="op" id="8466578">]</span><span class="op" id="8466579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466582">if</span>&nbsp;<span class="ident" id="8466585">s</span><span class="op" id="8466586">,</span>&nbsp;<span class="ident" id="8466588">ok</span>&nbsp;<span class="op" id="8466591">:=</span>&nbsp;<span class="ident" id="8466594">cache</span><span class="op" id="8466599">.</span><span class="ident" id="8466600">Get</span><span class="op" id="8466603">(</span><span class="ident" id="8466604">keys</span><span class="op" id="8466608">[</span><span class="num" id="8466609">3</span><span class="op" id="8466610">]</span><span class="op" id="8466611">)</span><span class="op" id="8466612">;</span>&nbsp;<span class="ident" id="8466614">ok</span>&nbsp;<span class="op" id="8466617">||</span>&nbsp;<span class="ident" id="8466620">s</span>&nbsp;<span class="op" id="8466622">!=</span>&nbsp;<span class="ident" id="8466625">nil</span>&nbsp;<span class="op" id="8466629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466633">t</span><span class="op" id="8466634">.</span><span class="ident" id="8466635">Fatalf</span><span class="op" id="8466641">(</span><span class="string" id="8466642">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key&nbsp;3&#34;</span><span class="op" id="8466683">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8466690">//&nbsp;Update&nbsp;entry&nbsp;0&nbsp;in&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466719">cache</span><span class="op" id="8466724">.</span><span class="ident" id="8466725">Put</span><span class="op" id="8466728">(</span><span class="ident" id="8466729">keys</span><span class="op" id="8466733">[</span><span class="num" id="8466734">0</span><span class="op" id="8466735">]</span><span class="op" id="8466736">,</span>&nbsp;<span class="op" id="8466738">&amp;</span><span class="ident" id="8466739">cs</span><span class="op" id="8466741">[</span><span class="num" id="8466742">3</span><span class="op" id="8466743">]</span><span class="op" id="8466744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466747">if</span>&nbsp;<span class="ident" id="8466750">s</span><span class="op" id="8466751">,</span>&nbsp;<span class="ident" id="8466753">ok</span>&nbsp;<span class="op" id="8466756">:=</span>&nbsp;<span class="ident" id="8466759">cache</span><span class="op" id="8466764">.</span><span class="ident" id="8466765">Get</span><span class="op" id="8466768">(</span><span class="ident" id="8466769">keys</span><span class="op" id="8466773">[</span><span class="num" id="8466774">0</span><span class="op" id="8466775">]</span><span class="op" id="8466776">)</span><span class="op" id="8466777">;</span>&nbsp;<span class="op" id="8466779">!</span><span class="ident" id="8466780">ok</span>&nbsp;<span class="op" id="8466783">||</span>&nbsp;<span class="ident" id="8466786">s</span>&nbsp;<span class="op" id="8466788">!=</span>&nbsp;<span class="op" id="8466791">&amp;</span><span class="ident" id="8466792">cs</span><span class="op" id="8466794">[</span><span class="num" id="8466795">3</span><span class="op" id="8466796">]</span>&nbsp;<span class="op" id="8466798">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466802">t</span><span class="op" id="8466803">.</span><span class="ident" id="8466804">Fatalf</span><span class="op" id="8466810">(</span><span class="string" id="8466811">&#34;session&nbsp;cache&nbsp;failed&nbsp;update&nbsp;for&nbsp;key&nbsp;0&#34;</span><span class="op" id="8466850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8466853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8466857">//&nbsp;Adding&nbsp;a&nbsp;nil&nbsp;entry&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466890">cache</span><span class="op" id="8466895">.</span><span class="ident" id="8466896">Put</span><span class="op" id="8466899">(</span><span class="ident" id="8466900">keys</span><span class="op" id="8466904">[</span><span class="num" id="8466905">0</span><span class="op" id="8466906">]</span><span class="op" id="8466907">,</span>&nbsp;<span class="ident" id="8466909">nil</span><span class="op" id="8466912">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8466915">if</span>&nbsp;<span class="ident" id="8466918">s</span><span class="op" id="8466919">,</span>&nbsp;<span class="ident" id="8466921">ok</span>&nbsp;<span class="op" id="8466924">:=</span>&nbsp;<span class="ident" id="8466927">cache</span><span class="op" id="8466932">.</span><span class="ident" id="8466933">Get</span><span class="op" id="8466936">(</span><span class="ident" id="8466937">keys</span><span class="op" id="8466941">[</span><span class="num" id="8466942">0</span><span class="op" id="8466943">]</span><span class="op" id="8466944">)</span><span class="op" id="8466945">;</span>&nbsp;<span class="op" id="8466947">!</span><span class="ident" id="8466948">ok</span>&nbsp;<span class="op" id="8466951">||</span>&nbsp;<span class="ident" id="8466954">s</span>&nbsp;<span class="op" id="8466956">!=</span>&nbsp;<span class="ident" id="8466959">nil</span>&nbsp;<span class="op" id="8466963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8466967">t</span><span class="op" id="8466968">.</span><span class="ident" id="8466969">Fatalf</span><span class="op" id="8466975">(</span><span class="string" id="8466976">&#34;failed&nbsp;to&nbsp;add&nbsp;nil&nbsp;entry&nbsp;to&nbsp;cache&#34;</span><span class="op" id="8467010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467013">}</span><br>
<span class="lineno"></span><span class="op" id="8467015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="8467018">func</span>&nbsp;<span class="ident" id="8467023">TestHandshakeClientALPNMatch</span><span class="op" id="8467051">(</span><span class="ident" id="8467052">t</span>&nbsp;<span class="op" id="8467054">*</span><span class="ident" id="8467055">testing</span><span class="op" id="8467062">.</span><span class="ident" id="8467063">T</span><span class="op" id="8467064">)</span>&nbsp;<span class="op" id="8467066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467069">config</span>&nbsp;<span class="op" id="8467076">:=</span>&nbsp;<span class="op" id="8467079">*</span><span class="ident" id="8467080">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467092">config</span><span class="op" id="8467098">.</span><span class="ident" id="8467099">NextProtos</span>&nbsp;<span class="op" id="8467110">=</span>&nbsp;<span class="op" id="8467112">[</span><span class="op" id="8467113">]</span><span class="builtintype" id="8467114">string</span><span class="op" id="8467120">{</span><span class="string" id="8467121">&#34;proto2&#34;</span><span class="op" id="8467129">,</span>&nbsp;<span class="string" id="8467131">&#34;proto1&#34;</span><span class="op" id="8467139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467143">test</span>&nbsp;<span class="op" id="8467148">:=</span>&nbsp;<span class="op" id="8467151">&amp;</span><span class="ident" id="8467152">clientTest</span><span class="op" id="8467162">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467166">name</span><span class="op" id="8467170">:</span>&nbsp;<span class="string" id="8467172">&#34;ALPN&#34;</span><span class="op" id="8467178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8467182">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8467248">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467291">command</span><span class="op" id="8467298">:</span>&nbsp;<span class="op" id="8467300">[</span><span class="op" id="8467301">]</span><span class="builtintype" id="8467302">string</span><span class="op" id="8467308">{</span><span class="string" id="8467309">&#34;openssl&#34;</span><span class="op" id="8467318">,</span>&nbsp;<span class="string" id="8467320">&#34;s_server&#34;</span><span class="op" id="8467330">,</span>&nbsp;<span class="string" id="8467332">&#34;-alpn&#34;</span><span class="op" id="8467339">,</span>&nbsp;<span class="string" id="8467341">&#34;proto1,proto2&#34;</span><span class="op" id="8467356">}</span><span class="op" id="8467357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467361">config</span><span class="op" id="8467367">:</span>&nbsp;&nbsp;<span class="op" id="8467370">&amp;</span><span class="ident" id="8467371">config</span><span class="op" id="8467377">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467381">validate</span><span class="op" id="8467389">:</span>&nbsp;<span class="keyword" id="8467391">func</span><span class="op" id="8467395">(</span><span class="ident" id="8467396">state</span>&nbsp;<span class="ident" id="8467402">ConnectionState</span><span class="op" id="8467417">)</span>&nbsp;<span class="builtintype" id="8467419">error</span>&nbsp;<span class="op" id="8467425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8467430">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467489">if</span>&nbsp;<span class="ident" id="8467492">state</span><span class="op" id="8467497">.</span><span class="ident" id="8467498">NegotiatedProtocol</span>&nbsp;<span class="op" id="8467517">!=</span>&nbsp;<span class="string" id="8467520">&#34;proto1&#34;</span>&nbsp;<span class="op" id="8467529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467535">return</span>&nbsp;<span class="ident" id="8467542">fmt</span><span class="op" id="8467545">.</span><span class="ident" id="8467546">Errorf</span><span class="op" id="8467552">(</span><span class="string" id="8467553">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="8467585">,</span>&nbsp;<span class="ident" id="8467587">state</span><span class="op" id="8467592">.</span><span class="ident" id="8467593">NegotiatedProtocol</span><span class="op" id="8467611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467616">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8467621">return</span>&nbsp;<span class="ident" id="8467628">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467634">}</span><span class="op" id="8467635">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8467638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467641">runClientTestTLS12</span><span class="op" id="8467659">(</span><span class="ident" id="8467660">t</span><span class="op" id="8467661">,</span>&nbsp;<span class="ident" id="8467663">test</span><span class="op" id="8467667">)</span><br>
<span class="lineno"></span><span class="op" id="8467669">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="8467672">func</span>&nbsp;<span class="ident" id="8467677">TestHandshakeClientALPNNoMatch</span><span class="op" id="8467707">(</span><span class="ident" id="8467708">t</span>&nbsp;<span class="op" id="8467710">*</span><span class="ident" id="8467711">testing</span><span class="op" id="8467718">.</span><span class="ident" id="8467719">T</span><span class="op" id="8467720">)</span>&nbsp;<span class="op" id="8467722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467725">config</span>&nbsp;<span class="op" id="8467732">:=</span>&nbsp;<span class="op" id="8467735">*</span><span class="ident" id="8467736">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467748">config</span><span class="op" id="8467754">.</span><span class="ident" id="8467755">NextProtos</span>&nbsp;<span class="op" id="8467766">=</span>&nbsp;<span class="op" id="8467768">[</span><span class="op" id="8467769">]</span><span class="builtintype" id="8467770">string</span><span class="op" id="8467776">{</span><span class="string" id="8467777">&#34;proto3&#34;</span><span class="op" id="8467785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467789">test</span>&nbsp;<span class="op" id="8467794">:=</span>&nbsp;<span class="op" id="8467797">&amp;</span><span class="ident" id="8467798">clientTest</span><span class="op" id="8467808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467812">name</span><span class="op" id="8467816">:</span>&nbsp;<span class="string" id="8467818">&#34;ALPN-NoMatch&#34;</span><span class="op" id="8467832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8467836">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8467902">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8467945">command</span><span class="op" id="8467952">:</span>&nbsp;<span class="op" id="8467954">[</span><span class="op" id="8467955">]</span><span class="builtintype" id="8467956">string</span><span class="op" id="8467962">{</span><span class="string" id="8467963">&#34;openssl&#34;</span><span class="op" id="8467972">,</span>&nbsp;<span class="string" id="8467974">&#34;s_server&#34;</span><span class="op" id="8467984">,</span>&nbsp;<span class="string" id="8467986">&#34;-alpn&#34;</span><span class="op" id="8467993">,</span>&nbsp;<span class="string" id="8467995">&#34;proto1,proto2&#34;</span><span class="op" id="8468010">}</span><span class="op" id="8468011">,</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468015">config</span><span class="op" id="8468021">:</span>&nbsp;&nbsp;<span class="op" id="8468024">&amp;</span><span class="ident" id="8468025">config</span><span class="op" id="8468031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468035">validate</span><span class="op" id="8468043">:</span>&nbsp;<span class="keyword" id="8468045">func</span><span class="op" id="8468049">(</span><span class="ident" id="8468050">state</span>&nbsp;<span class="ident" id="8468056">ConnectionState</span><span class="op" id="8468071">)</span>&nbsp;<span class="builtintype" id="8468073">error</span>&nbsp;<span class="op" id="8468079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8468084">//&nbsp;There&#39;s&nbsp;no&nbsp;overlap&nbsp;so&nbsp;OpenSSL&nbsp;will&nbsp;not&nbsp;select&nbsp;a&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468148">if</span>&nbsp;<span class="ident" id="8468151">state</span><span class="op" id="8468156">.</span><span class="ident" id="8468157">NegotiatedProtocol</span>&nbsp;<span class="op" id="8468176">!=</span>&nbsp;<span class="string" id="8468179">&#34;&#34;</span>&nbsp;<span class="op" id="8468182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468188">return</span>&nbsp;<span class="ident" id="8468195">fmt</span><span class="op" id="8468198">.</span><span class="ident" id="8468199">Errorf</span><span class="op" id="8468205">(</span><span class="string" id="8468206">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="8468234">,</span>&nbsp;<span class="ident" id="8468236">state</span><span class="op" id="8468241">.</span><span class="ident" id="8468242">NegotiatedProtocol</span><span class="op" id="8468260">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8468270">return</span>&nbsp;<span class="ident" id="8468277">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468283">}</span><span class="op" id="8468284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8468287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8468290">runClientTestTLS12</span><span class="op" id="8468308">(</span><span class="ident" id="8468309">t</span><span class="op" id="8468310">,</span>&nbsp;<span class="ident" id="8468312">test</span><span class="op" id="8468316">)</span><br>
<span class="lineno">490</span><span class="op" id="8468318">}</span>
</div>
</body>
</html>
