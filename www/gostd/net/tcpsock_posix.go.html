<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html" class="current">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4177686">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4177742">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4177796">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4177847">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4177925">package</span>&nbsp;<span class="ident" id="4177933">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4177938">import</span>&nbsp;<span class="op" id="4177945">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4177948">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4177954">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4177960">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4177971">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4177978">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4177981">//&nbsp;BUG(rsc):&nbsp;On&nbsp;OpenBSD,&nbsp;listening&nbsp;on&nbsp;the&nbsp;&#34;tcp&#34;&nbsp;network&nbsp;does&nbsp;not&nbsp;listen&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4178057">//&nbsp;both&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections.&nbsp;This&nbsp;is&nbsp;due&nbsp;to&nbsp;the&nbsp;fact&nbsp;that&nbsp;IPv4&nbsp;traffic</span><br>
<span class="lineno"></span><span class="comment" id="4178134">//&nbsp;will&nbsp;not&nbsp;be&nbsp;routed&nbsp;to&nbsp;an&nbsp;IPv6&nbsp;socket&nbsp;-&nbsp;two&nbsp;separate&nbsp;sockets&nbsp;are&nbsp;required</span><br>
<span class="lineno"></span><span class="comment" id="4178210">//&nbsp;if&nbsp;both&nbsp;AFs&nbsp;are&nbsp;to&nbsp;be&nbsp;supported.&nbsp;See&nbsp;inet6(4)&nbsp;on&nbsp;OpenBSD&nbsp;for&nbsp;details.</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="4178284">func</span>&nbsp;<span class="ident" id="4178289">sockaddrToTCP</span><span class="op" id="4178302">(</span><span class="ident" id="4178303">sa</span>&nbsp;<span class="ident" id="4178306">syscall</span><span class="op" id="4178313">.</span><span class="ident" id="4178314">Sockaddr</span><span class="op" id="4178322">)</span>&nbsp;<span class="ident" id="4178324">Addr</span>&nbsp;<span class="op" id="4178329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178332">switch</span>&nbsp;<span class="ident" id="4178339">sa</span>&nbsp;<span class="op" id="4178342">:=</span>&nbsp;<span class="ident" id="4178345">sa</span><span class="op" id="4178347">.</span><span class="op" id="4178348">(</span><span class="keyword" id="4178349">type</span><span class="op" id="4178353">)</span>&nbsp;<span class="op" id="4178355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178358">case</span>&nbsp;<span class="op" id="4178363">*</span><span class="ident" id="4178364">syscall</span><span class="op" id="4178371">.</span><span class="ident" id="4178372">SockaddrInet4</span><span class="op" id="4178385">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178389">return</span>&nbsp;<span class="op" id="4178396">&amp;</span><span class="ident" id="4178397">TCPAddr</span><span class="op" id="4178404">{</span><span class="ident" id="4178405">IP</span><span class="op" id="4178407">:</span>&nbsp;<span class="ident" id="4178409">sa</span><span class="op" id="4178411">.</span><span class="ident" id="4178412">Addr</span><span class="op" id="4178416">[</span><span class="num" id="4178417">0</span><span class="op" id="4178418">:</span><span class="op" id="4178419">]</span><span class="op" id="4178420">,</span>&nbsp;<span class="ident" id="4178422">Port</span><span class="op" id="4178426">:</span>&nbsp;<span class="ident" id="4178428">sa</span><span class="op" id="4178430">.</span><span class="ident" id="4178431">Port</span><span class="op" id="4178435">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178438">case</span>&nbsp;<span class="op" id="4178443">*</span><span class="ident" id="4178444">syscall</span><span class="op" id="4178451">.</span><span class="ident" id="4178452">SockaddrInet6</span><span class="op" id="4178465">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178469">return</span>&nbsp;<span class="op" id="4178476">&amp;</span><span class="ident" id="4178477">TCPAddr</span><span class="op" id="4178484">{</span><span class="ident" id="4178485">IP</span><span class="op" id="4178487">:</span>&nbsp;<span class="ident" id="4178489">sa</span><span class="op" id="4178491">.</span><span class="ident" id="4178492">Addr</span><span class="op" id="4178496">[</span><span class="num" id="4178497">0</span><span class="op" id="4178498">:</span><span class="op" id="4178499">]</span><span class="op" id="4178500">,</span>&nbsp;<span class="ident" id="4178502">Port</span><span class="op" id="4178506">:</span>&nbsp;<span class="ident" id="4178508">sa</span><span class="op" id="4178510">.</span><span class="ident" id="4178511">Port</span><span class="op" id="4178515">,</span>&nbsp;<span class="ident" id="4178517">Zone</span><span class="op" id="4178521">:</span>&nbsp;<span class="ident" id="4178523">zoneToString</span><span class="op" id="4178535">(</span><span class="builtintype" id="4178536">int</span><span class="op" id="4178539">(</span><span class="ident" id="4178540">sa</span><span class="op" id="4178542">.</span><span class="ident" id="4178543">ZoneId</span><span class="op" id="4178549">)</span><span class="op" id="4178550">)</span><span class="op" id="4178551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4178554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178557">return</span>&nbsp;<span class="ident" id="4178564">nil</span><br>
<span class="lineno"></span><span class="op" id="4178568">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="4178571">func</span>&nbsp;<span class="op" id="4178576">(</span><span class="ident" id="4178577">a</span>&nbsp;<span class="op" id="4178579">*</span><span class="ident" id="4178580">TCPAddr</span><span class="op" id="4178587">)</span>&nbsp;<span class="ident" id="4178589">family</span><span class="op" id="4178595">(</span><span class="op" id="4178596">)</span>&nbsp;<span class="builtintype" id="4178598">int</span>&nbsp;<span class="op" id="4178602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178605">if</span>&nbsp;<span class="ident" id="4178608">a</span>&nbsp;<span class="op" id="4178610">==</span>&nbsp;<span class="ident" id="4178613">nil</span>&nbsp;<span class="op" id="4178617">||</span>&nbsp;<span class="builtinfunc" id="4178620">len</span><span class="op" id="4178623">(</span><span class="ident" id="4178624">a</span><span class="op" id="4178625">.</span><span class="ident" id="4178626">IP</span><span class="op" id="4178628">)</span>&nbsp;<span class="op" id="4178630">&lt;=</span>&nbsp;<span class="ident" id="4178633">IPv4len</span>&nbsp;<span class="op" id="4178641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178645">return</span>&nbsp;<span class="ident" id="4178652">syscall</span><span class="op" id="4178659">.</span><span class="ident" id="4178660">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4178669">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178672">if</span>&nbsp;<span class="ident" id="4178675">a</span><span class="op" id="4178676">.</span><span class="ident" id="4178677">IP</span><span class="op" id="4178679">.</span><span class="ident" id="4178680">To4</span><span class="op" id="4178683">(</span><span class="op" id="4178684">)</span>&nbsp;<span class="op" id="4178686">!=</span>&nbsp;<span class="ident" id="4178689">nil</span>&nbsp;<span class="op" id="4178693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178697">return</span>&nbsp;<span class="ident" id="4178704">syscall</span><span class="op" id="4178711">.</span><span class="ident" id="4178712">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4178721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178724">return</span>&nbsp;<span class="ident" id="4178731">syscall</span><span class="op" id="4178738">.</span><span class="ident" id="4178739">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="4178748">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="4178751">func</span>&nbsp;<span class="op" id="4178756">(</span><span class="ident" id="4178757">a</span>&nbsp;<span class="op" id="4178759">*</span><span class="ident" id="4178760">TCPAddr</span><span class="op" id="4178767">)</span>&nbsp;<span class="ident" id="4178769">isWildcard</span><span class="op" id="4178779">(</span><span class="op" id="4178780">)</span>&nbsp;<span class="builtintype" id="4178782">bool</span>&nbsp;<span class="op" id="4178787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178790">if</span>&nbsp;<span class="ident" id="4178793">a</span>&nbsp;<span class="op" id="4178795">==</span>&nbsp;<span class="ident" id="4178798">nil</span>&nbsp;<span class="op" id="4178802">||</span>&nbsp;<span class="ident" id="4178805">a</span><span class="op" id="4178806">.</span><span class="ident" id="4178807">IP</span>&nbsp;<span class="op" id="4178810">==</span>&nbsp;<span class="ident" id="4178813">nil</span>&nbsp;<span class="op" id="4178817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178821">return</span>&nbsp;<span class="builtintype" id="4178828">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4178834">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178837">return</span>&nbsp;<span class="ident" id="4178844">a</span><span class="op" id="4178845">.</span><span class="ident" id="4178846">IP</span><span class="op" id="4178848">.</span><span class="ident" id="4178849">IsUnspecified</span><span class="op" id="4178862">(</span><span class="op" id="4178863">)</span><br>
<span class="lineno"></span><span class="op" id="4178865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4178868">func</span>&nbsp;<span class="op" id="4178873">(</span><span class="ident" id="4178874">a</span>&nbsp;<span class="op" id="4178876">*</span><span class="ident" id="4178877">TCPAddr</span><span class="op" id="4178884">)</span>&nbsp;<span class="ident" id="4178886">sockaddr</span><span class="op" id="4178894">(</span><span class="ident" id="4178895">family</span>&nbsp;<span class="builtintype" id="4178902">int</span><span class="op" id="4178905">)</span>&nbsp;<span class="op" id="4178907">(</span><span class="ident" id="4178908">syscall</span><span class="op" id="4178915">.</span><span class="ident" id="4178916">Sockaddr</span><span class="op" id="4178924">,</span>&nbsp;<span class="builtintype" id="4178926">error</span><span class="op" id="4178931">)</span>&nbsp;<span class="op" id="4178933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178936">if</span>&nbsp;<span class="ident" id="4178939">a</span>&nbsp;<span class="op" id="4178941">==</span>&nbsp;<span class="ident" id="4178944">nil</span>&nbsp;<span class="op" id="4178948">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178952">return</span>&nbsp;<span class="ident" id="4178959">nil</span><span class="op" id="4178962">,</span>&nbsp;<span class="ident" id="4178964">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4178969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178972">return</span>&nbsp;<span class="ident" id="4178979">ipToSockaddr</span><span class="op" id="4178991">(</span><span class="ident" id="4178992">family</span><span class="op" id="4178998">,</span>&nbsp;<span class="ident" id="4179000">a</span><span class="op" id="4179001">.</span><span class="ident" id="4179002">IP</span><span class="op" id="4179004">,</span>&nbsp;<span class="ident" id="4179006">a</span><span class="op" id="4179007">.</span><span class="ident" id="4179008">Port</span><span class="op" id="4179012">,</span>&nbsp;<span class="ident" id="4179014">a</span><span class="op" id="4179015">.</span><span class="ident" id="4179016">Zone</span><span class="op" id="4179020">)</span><br>
<span class="lineno"></span><span class="op" id="4179022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="4179025">//&nbsp;TCPConn&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;interface&nbsp;for&nbsp;TCP&nbsp;network</span><br>
<span class="lineno"></span><span class="comment" id="4179095">//&nbsp;connections.</span><br>
<span class="lineno"></span><span class="keyword" id="4179111">type</span>&nbsp;<span class="ident" id="4179116">TCPConn</span>&nbsp;<span class="keyword" id="4179124">struct</span>&nbsp;<span class="op" id="4179131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4179134">conn</span><br>
<span class="lineno"></span><span class="op" id="4179139">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="4179142">func</span>&nbsp;<span class="ident" id="4179147">newTCPConn</span><span class="op" id="4179157">(</span><span class="ident" id="4179158">fd</span>&nbsp;<span class="op" id="4179161">*</span><span class="ident" id="4179162">netFD</span><span class="op" id="4179167">)</span>&nbsp;<span class="op" id="4179169">*</span><span class="ident" id="4179170">TCPConn</span>&nbsp;<span class="op" id="4179178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4179181">c</span>&nbsp;<span class="op" id="4179183">:=</span>&nbsp;<span class="op" id="4179186">&amp;</span><span class="ident" id="4179187">TCPConn</span><span class="op" id="4179194">{</span><span class="ident" id="4179195">conn</span><span class="op" id="4179199">{</span><span class="ident" id="4179200">fd</span><span class="op" id="4179202">}</span><span class="op" id="4179203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4179206">c</span><span class="op" id="4179207">.</span><span class="ident" id="4179208">SetNoDelay</span><span class="op" id="4179218">(</span><span class="builtintype" id="4179219">true</span><span class="op" id="4179223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179226">return</span>&nbsp;<span class="ident" id="4179233">c</span><br>
<span class="lineno">65</span><span class="op" id="4179235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4179238">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;io.ReaderFrom&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="4179296">func</span>&nbsp;<span class="op" id="4179301">(</span><span class="ident" id="4179302">c</span>&nbsp;<span class="op" id="4179304">*</span><span class="ident" id="4179305">TCPConn</span><span class="op" id="4179312">)</span>&nbsp;<span class="ident" id="4179314">ReadFrom</span><span class="op" id="4179322">(</span><span class="ident" id="4179323">r</span>&nbsp;<span class="ident" id="4179325">io</span><span class="op" id="4179327">.</span><span class="ident" id="4179328">Reader</span><span class="op" id="4179334">)</span>&nbsp;<span class="op" id="4179336">(</span><span class="ident" id="4179337">int64</span><span class="op" id="4179342">,</span>&nbsp;<span class="builtintype" id="4179344">error</span><span class="op" id="4179349">)</span>&nbsp;<span class="op" id="4179351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179354">if</span>&nbsp;<span class="ident" id="4179357">n</span><span class="op" id="4179358">,</span>&nbsp;<span class="ident" id="4179360">err</span><span class="op" id="4179363">,</span>&nbsp;<span class="ident" id="4179365">handled</span>&nbsp;<span class="op" id="4179373">:=</span>&nbsp;<span class="ident" id="4179376">sendFile</span><span class="op" id="4179384">(</span><span class="ident" id="4179385">c</span><span class="op" id="4179386">.</span><span class="ident" id="4179387">fd</span><span class="op" id="4179389">,</span>&nbsp;<span class="ident" id="4179391">r</span><span class="op" id="4179392">)</span><span class="op" id="4179393">;</span>&nbsp;<span class="ident" id="4179395">handled</span>&nbsp;<span class="op" id="4179403">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179407">return</span>&nbsp;<span class="ident" id="4179414">n</span><span class="op" id="4179415">,</span>&nbsp;<span class="ident" id="4179417">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4179422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179425">return</span>&nbsp;<span class="ident" id="4179432">genericReadFrom</span><span class="op" id="4179447">(</span><span class="ident" id="4179448">c</span><span class="op" id="4179449">,</span>&nbsp;<span class="ident" id="4179451">r</span><span class="op" id="4179452">)</span><br>
<span class="lineno"></span><span class="op" id="4179454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="4179457">//&nbsp;CloseRead&nbsp;shuts&nbsp;down&nbsp;the&nbsp;reading&nbsp;side&nbsp;of&nbsp;the&nbsp;TCP&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4179521">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="4179560">func</span>&nbsp;<span class="op" id="4179565">(</span><span class="ident" id="4179566">c</span>&nbsp;<span class="op" id="4179568">*</span><span class="ident" id="4179569">TCPConn</span><span class="op" id="4179576">)</span>&nbsp;<span class="ident" id="4179578">CloseRead</span><span class="op" id="4179587">(</span><span class="op" id="4179588">)</span>&nbsp;<span class="builtintype" id="4179590">error</span>&nbsp;<span class="op" id="4179596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179599">if</span>&nbsp;<span class="op" id="4179602">!</span><span class="ident" id="4179603">c</span><span class="op" id="4179604">.</span><span class="ident" id="4179605">ok</span><span class="op" id="4179607">(</span><span class="op" id="4179608">)</span>&nbsp;<span class="op" id="4179610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179614">return</span>&nbsp;<span class="ident" id="4179621">syscall</span><span class="op" id="4179628">.</span><span class="ident" id="4179629">EINVAL</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4179637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179640">return</span>&nbsp;<span class="ident" id="4179647">c</span><span class="op" id="4179648">.</span><span class="ident" id="4179649">fd</span><span class="op" id="4179651">.</span><span class="ident" id="4179652">closeRead</span><span class="op" id="4179661">(</span><span class="op" id="4179662">)</span><br>
<span class="lineno"></span><span class="op" id="4179664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4179667">//&nbsp;CloseWrite&nbsp;shuts&nbsp;down&nbsp;the&nbsp;writing&nbsp;side&nbsp;of&nbsp;the&nbsp;TCP&nbsp;connection.</span><br>
<span class="lineno">85</span><span class="comment" id="4179732">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="4179771">func</span>&nbsp;<span class="op" id="4179776">(</span><span class="ident" id="4179777">c</span>&nbsp;<span class="op" id="4179779">*</span><span class="ident" id="4179780">TCPConn</span><span class="op" id="4179787">)</span>&nbsp;<span class="ident" id="4179789">CloseWrite</span><span class="op" id="4179799">(</span><span class="op" id="4179800">)</span>&nbsp;<span class="builtintype" id="4179802">error</span>&nbsp;<span class="op" id="4179808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179811">if</span>&nbsp;<span class="op" id="4179814">!</span><span class="ident" id="4179815">c</span><span class="op" id="4179816">.</span><span class="ident" id="4179817">ok</span><span class="op" id="4179819">(</span><span class="op" id="4179820">)</span>&nbsp;<span class="op" id="4179822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179826">return</span>&nbsp;<span class="ident" id="4179833">syscall</span><span class="op" id="4179840">.</span><span class="ident" id="4179841">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4179849">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4179852">return</span>&nbsp;<span class="ident" id="4179859">c</span><span class="op" id="4179860">.</span><span class="ident" id="4179861">fd</span><span class="op" id="4179863">.</span><span class="ident" id="4179864">closeWrite</span><span class="op" id="4179874">(</span><span class="op" id="4179875">)</span><br>
<span class="lineno"></span><span class="op" id="4179877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4179880">//&nbsp;SetLinger&nbsp;sets&nbsp;the&nbsp;behavior&nbsp;of&nbsp;Close&nbsp;on&nbsp;a&nbsp;connection&nbsp;which&nbsp;still</span><br>
<span class="lineno"></span><span class="comment" id="4179948">//&nbsp;has&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;sent&nbsp;or&nbsp;to&nbsp;be&nbsp;acknowledged.</span><br>
<span class="lineno">95</span><span class="comment" id="4180002">//</span><br>
<span class="lineno"></span><span class="comment" id="4180005">//&nbsp;If&nbsp;sec&nbsp;&lt;&nbsp;0&nbsp;(the&nbsp;default),&nbsp;the&nbsp;operating&nbsp;system&nbsp;finishes&nbsp;sending&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4180076">//&nbsp;data&nbsp;in&nbsp;the&nbsp;background.</span><br>
<span class="lineno"></span><span class="comment" id="4180103">//</span><br>
<span class="lineno"></span><span class="comment" id="4180106">//&nbsp;If&nbsp;sec&nbsp;==&nbsp;0,&nbsp;the&nbsp;operating&nbsp;system&nbsp;discards&nbsp;any&nbsp;unsent&nbsp;or</span><br>
<span class="lineno">100</span><span class="comment" id="4180166">//&nbsp;unacknowledged&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4180190">//</span><br>
<span class="lineno"></span><span class="comment" id="4180193">//&nbsp;If&nbsp;sec&nbsp;&gt;&nbsp;0,&nbsp;the&nbsp;data&nbsp;is&nbsp;sent&nbsp;in&nbsp;the&nbsp;background&nbsp;as&nbsp;with&nbsp;sec&nbsp;&lt;&nbsp;0.&nbsp;On</span><br>
<span class="lineno"></span><span class="comment" id="4180263">//&nbsp;some&nbsp;operating&nbsp;systems&nbsp;after&nbsp;sec&nbsp;seconds&nbsp;have&nbsp;elapsed&nbsp;any&nbsp;remaining</span><br>
<span class="lineno"></span><span class="comment" id="4180334">//&nbsp;unsent&nbsp;data&nbsp;may&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno">105</span><span class="keyword" id="4180367">func</span>&nbsp;<span class="op" id="4180372">(</span><span class="ident" id="4180373">c</span>&nbsp;<span class="op" id="4180375">*</span><span class="ident" id="4180376">TCPConn</span><span class="op" id="4180383">)</span>&nbsp;<span class="ident" id="4180385">SetLinger</span><span class="op" id="4180394">(</span><span class="ident" id="4180395">sec</span>&nbsp;<span class="builtintype" id="4180399">int</span><span class="op" id="4180402">)</span>&nbsp;<span class="builtintype" id="4180404">error</span>&nbsp;<span class="op" id="4180410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180413">if</span>&nbsp;<span class="op" id="4180416">!</span><span class="ident" id="4180417">c</span><span class="op" id="4180418">.</span><span class="ident" id="4180419">ok</span><span class="op" id="4180421">(</span><span class="op" id="4180422">)</span>&nbsp;<span class="op" id="4180424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180428">return</span>&nbsp;<span class="ident" id="4180435">syscall</span><span class="op" id="4180442">.</span><span class="ident" id="4180443">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4180451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180454">return</span>&nbsp;<span class="ident" id="4180461">setLinger</span><span class="op" id="4180470">(</span><span class="ident" id="4180471">c</span><span class="op" id="4180472">.</span><span class="ident" id="4180473">fd</span><span class="op" id="4180475">,</span>&nbsp;<span class="ident" id="4180477">sec</span><span class="op" id="4180480">)</span><br>
<span class="lineno">110</span><span class="op" id="4180482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4180485">//&nbsp;SetKeepAlive&nbsp;sets&nbsp;whether&nbsp;the&nbsp;operating&nbsp;system&nbsp;should&nbsp;send</span><br>
<span class="lineno"></span><span class="comment" id="4180547">//&nbsp;keepalive&nbsp;messages&nbsp;on&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4180588">func</span>&nbsp;<span class="op" id="4180593">(</span><span class="ident" id="4180594">c</span>&nbsp;<span class="op" id="4180596">*</span><span class="ident" id="4180597">TCPConn</span><span class="op" id="4180604">)</span>&nbsp;<span class="ident" id="4180606">SetKeepAlive</span><span class="op" id="4180618">(</span><span class="ident" id="4180619">keepalive</span>&nbsp;<span class="builtintype" id="4180629">bool</span><span class="op" id="4180633">)</span>&nbsp;<span class="builtintype" id="4180635">error</span>&nbsp;<span class="op" id="4180641">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180644">if</span>&nbsp;<span class="op" id="4180647">!</span><span class="ident" id="4180648">c</span><span class="op" id="4180649">.</span><span class="ident" id="4180650">ok</span><span class="op" id="4180652">(</span><span class="op" id="4180653">)</span>&nbsp;<span class="op" id="4180655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180659">return</span>&nbsp;<span class="ident" id="4180666">syscall</span><span class="op" id="4180673">.</span><span class="ident" id="4180674">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4180682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180685">return</span>&nbsp;<span class="ident" id="4180692">setKeepAlive</span><span class="op" id="4180704">(</span><span class="ident" id="4180705">c</span><span class="op" id="4180706">.</span><span class="ident" id="4180707">fd</span><span class="op" id="4180709">,</span>&nbsp;<span class="ident" id="4180711">keepalive</span><span class="op" id="4180720">)</span><br>
<span class="lineno"></span><span class="op" id="4180722">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="4180725">//&nbsp;SetKeepAlivePeriod&nbsp;sets&nbsp;period&nbsp;between&nbsp;keep&nbsp;alives.</span><br>
<span class="lineno"></span><span class="keyword" id="4180780">func</span>&nbsp;<span class="op" id="4180785">(</span><span class="ident" id="4180786">c</span>&nbsp;<span class="op" id="4180788">*</span><span class="ident" id="4180789">TCPConn</span><span class="op" id="4180796">)</span>&nbsp;<span class="ident" id="4180798">SetKeepAlivePeriod</span><span class="op" id="4180816">(</span><span class="ident" id="4180817">d</span>&nbsp;<span class="ident" id="4180819">time</span><span class="op" id="4180823">.</span><span class="ident" id="4180824">Duration</span><span class="op" id="4180832">)</span>&nbsp;<span class="builtintype" id="4180834">error</span>&nbsp;<span class="op" id="4180840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180843">if</span>&nbsp;<span class="op" id="4180846">!</span><span class="ident" id="4180847">c</span><span class="op" id="4180848">.</span><span class="ident" id="4180849">ok</span><span class="op" id="4180851">(</span><span class="op" id="4180852">)</span>&nbsp;<span class="op" id="4180854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180858">return</span>&nbsp;<span class="ident" id="4180865">syscall</span><span class="op" id="4180872">.</span><span class="ident" id="4180873">EINVAL</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4180881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4180884">return</span>&nbsp;<span class="ident" id="4180891">setKeepAlivePeriod</span><span class="op" id="4180909">(</span><span class="ident" id="4180910">c</span><span class="op" id="4180911">.</span><span class="ident" id="4180912">fd</span><span class="op" id="4180914">,</span>&nbsp;<span class="ident" id="4180916">d</span><span class="op" id="4180917">)</span><br>
<span class="lineno"></span><span class="op" id="4180919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4180922">//&nbsp;SetNoDelay&nbsp;controls&nbsp;whether&nbsp;the&nbsp;operating&nbsp;system&nbsp;should&nbsp;delay</span><br>
<span class="lineno">130</span><span class="comment" id="4180987">//&nbsp;packet&nbsp;transmission&nbsp;in&nbsp;hopes&nbsp;of&nbsp;sending&nbsp;fewer&nbsp;packets&nbsp;(Nagle&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4181053">//&nbsp;algorithm).&nbsp;&nbsp;The&nbsp;default&nbsp;is&nbsp;true&nbsp;(no&nbsp;delay),&nbsp;meaning&nbsp;that&nbsp;data&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4181122">//&nbsp;sent&nbsp;as&nbsp;soon&nbsp;as&nbsp;possible&nbsp;after&nbsp;a&nbsp;Write.</span><br>
<span class="lineno"></span><span class="keyword" id="4181165">func</span>&nbsp;<span class="op" id="4181170">(</span><span class="ident" id="4181171">c</span>&nbsp;<span class="op" id="4181173">*</span><span class="ident" id="4181174">TCPConn</span><span class="op" id="4181181">)</span>&nbsp;<span class="ident" id="4181183">SetNoDelay</span><span class="op" id="4181193">(</span><span class="ident" id="4181194">noDelay</span>&nbsp;<span class="builtintype" id="4181202">bool</span><span class="op" id="4181206">)</span>&nbsp;<span class="builtintype" id="4181208">error</span>&nbsp;<span class="op" id="4181214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181217">if</span>&nbsp;<span class="op" id="4181220">!</span><span class="ident" id="4181221">c</span><span class="op" id="4181222">.</span><span class="ident" id="4181223">ok</span><span class="op" id="4181225">(</span><span class="op" id="4181226">)</span>&nbsp;<span class="op" id="4181228">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181232">return</span>&nbsp;<span class="ident" id="4181239">syscall</span><span class="op" id="4181246">.</span><span class="ident" id="4181247">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4181255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181258">return</span>&nbsp;<span class="ident" id="4181265">setNoDelay</span><span class="op" id="4181275">(</span><span class="ident" id="4181276">c</span><span class="op" id="4181277">.</span><span class="ident" id="4181278">fd</span><span class="op" id="4181280">,</span>&nbsp;<span class="ident" id="4181282">noDelay</span><span class="op" id="4181289">)</span><br>
<span class="lineno"></span><span class="op" id="4181291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="4181294">//&nbsp;DialTCP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="4181362">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,&nbsp;or&nbsp;&#34;tcp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil,&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4181433">//&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4181482">func</span>&nbsp;<span class="ident" id="4181487">DialTCP</span><span class="op" id="4181494">(</span><span class="ident" id="4181495">net</span>&nbsp;<span class="builtintype" id="4181499">string</span><span class="op" id="4181505">,</span>&nbsp;<span class="ident" id="4181507">laddr</span><span class="op" id="4181512">,</span>&nbsp;<span class="ident" id="4181514">raddr</span>&nbsp;<span class="op" id="4181520">*</span><span class="ident" id="4181521">TCPAddr</span><span class="op" id="4181528">)</span>&nbsp;<span class="op" id="4181530">(</span><span class="op" id="4181531">*</span><span class="ident" id="4181532">TCPConn</span><span class="op" id="4181539">,</span>&nbsp;<span class="builtintype" id="4181541">error</span><span class="op" id="4181546">)</span>&nbsp;<span class="op" id="4181548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181551">switch</span>&nbsp;<span class="ident" id="4181558">net</span>&nbsp;<span class="op" id="4181562">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181565">case</span>&nbsp;<span class="string" id="4181570">&#34;tcp&#34;</span><span class="op" id="4181575">,</span>&nbsp;<span class="string" id="4181577">&#34;tcp4&#34;</span><span class="op" id="4181583">,</span>&nbsp;<span class="string" id="4181585">&#34;tcp6&#34;</span><span class="op" id="4181591">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181594">default</span><span class="op" id="4181601">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181605">return</span>&nbsp;<span class="ident" id="4181612">nil</span><span class="op" id="4181615">,</span>&nbsp;<span class="op" id="4181617">&amp;</span><span class="ident" id="4181618">OpError</span><span class="op" id="4181625">{</span><span class="ident" id="4181626">Op</span><span class="op" id="4181628">:</span>&nbsp;<span class="string" id="4181630">&#34;dial&#34;</span><span class="op" id="4181636">,</span>&nbsp;<span class="ident" id="4181638">Net</span><span class="op" id="4181641">:</span>&nbsp;<span class="ident" id="4181643">net</span><span class="op" id="4181646">,</span>&nbsp;<span class="ident" id="4181648">Addr</span><span class="op" id="4181652">:</span>&nbsp;<span class="ident" id="4181654">raddr</span><span class="op" id="4181659">,</span>&nbsp;<span class="ident" id="4181661">Err</span><span class="op" id="4181664">:</span>&nbsp;<span class="ident" id="4181666">UnknownNetworkError</span><span class="op" id="4181685">(</span><span class="ident" id="4181686">net</span><span class="op" id="4181689">)</span><span class="op" id="4181690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4181693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181696">if</span>&nbsp;<span class="ident" id="4181699">raddr</span>&nbsp;<span class="op" id="4181705">==</span>&nbsp;<span class="ident" id="4181708">nil</span>&nbsp;<span class="op" id="4181712">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181716">return</span>&nbsp;<span class="ident" id="4181723">nil</span><span class="op" id="4181726">,</span>&nbsp;<span class="op" id="4181728">&amp;</span><span class="ident" id="4181729">OpError</span><span class="op" id="4181736">{</span><span class="ident" id="4181737">Op</span><span class="op" id="4181739">:</span>&nbsp;<span class="string" id="4181741">&#34;dial&#34;</span><span class="op" id="4181747">,</span>&nbsp;<span class="ident" id="4181749">Net</span><span class="op" id="4181752">:</span>&nbsp;<span class="ident" id="4181754">net</span><span class="op" id="4181757">,</span>&nbsp;<span class="ident" id="4181759">Addr</span><span class="op" id="4181763">:</span>&nbsp;<span class="ident" id="4181765">nil</span><span class="op" id="4181768">,</span>&nbsp;<span class="ident" id="4181770">Err</span><span class="op" id="4181773">:</span>&nbsp;<span class="ident" id="4181775">errMissingAddress</span><span class="op" id="4181792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4181795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4181798">return</span>&nbsp;<span class="ident" id="4181805">dialTCP</span><span class="op" id="4181812">(</span><span class="ident" id="4181813">net</span><span class="op" id="4181816">,</span>&nbsp;<span class="ident" id="4181818">laddr</span><span class="op" id="4181823">,</span>&nbsp;<span class="ident" id="4181825">raddr</span><span class="op" id="4181830">,</span>&nbsp;<span class="ident" id="4181832">noDeadline</span><span class="op" id="4181842">)</span><br>
<span class="lineno"></span><span class="op" id="4181844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="4181847">func</span>&nbsp;<span class="ident" id="4181852">dialTCP</span><span class="op" id="4181859">(</span><span class="ident" id="4181860">net</span>&nbsp;<span class="builtintype" id="4181864">string</span><span class="op" id="4181870">,</span>&nbsp;<span class="ident" id="4181872">laddr</span><span class="op" id="4181877">,</span>&nbsp;<span class="ident" id="4181879">raddr</span>&nbsp;<span class="op" id="4181885">*</span><span class="ident" id="4181886">TCPAddr</span><span class="op" id="4181893">,</span>&nbsp;<span class="ident" id="4181895">deadline</span>&nbsp;<span class="ident" id="4181904">time</span><span class="op" id="4181908">.</span><span class="ident" id="4181909">Time</span><span class="op" id="4181913">)</span>&nbsp;<span class="op" id="4181915">(</span><span class="op" id="4181916">*</span><span class="ident" id="4181917">TCPConn</span><span class="op" id="4181924">,</span>&nbsp;<span class="builtintype" id="4181926">error</span><span class="op" id="4181931">)</span>&nbsp;<span class="op" id="4181933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4181936">fd</span><span class="op" id="4181938">,</span>&nbsp;<span class="ident" id="4181940">err</span>&nbsp;<span class="op" id="4181944">:=</span>&nbsp;<span class="ident" id="4181947">internetSocket</span><span class="op" id="4181961">(</span><span class="ident" id="4181962">net</span><span class="op" id="4181965">,</span>&nbsp;<span class="ident" id="4181967">laddr</span><span class="op" id="4181972">,</span>&nbsp;<span class="ident" id="4181974">raddr</span><span class="op" id="4181979">,</span>&nbsp;<span class="ident" id="4181981">deadline</span><span class="op" id="4181989">,</span>&nbsp;<span class="ident" id="4181991">syscall</span><span class="op" id="4181998">.</span><span class="ident" id="4181999">SOCK_STREAM</span><span class="op" id="4182010">,</span>&nbsp;<span class="num" id="4182012">0</span><span class="op" id="4182013">,</span>&nbsp;<span class="string" id="4182015">&#34;dial&#34;</span><span class="op" id="4182021">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182025">//&nbsp;TCP&nbsp;has&nbsp;a&nbsp;rarely&nbsp;used&nbsp;mechanism&nbsp;called&nbsp;a&nbsp;&#39;simultaneous&nbsp;connection&#39;&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182099">//&nbsp;which&nbsp;Dial(&#34;tcp&#34;,&nbsp;addr1,&nbsp;addr2)&nbsp;run&nbsp;on&nbsp;the&nbsp;machine&nbsp;at&nbsp;addr1&nbsp;can</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182167">//&nbsp;connect&nbsp;to&nbsp;a&nbsp;simultaneous&nbsp;Dial(&#34;tcp&#34;,&nbsp;addr2,&nbsp;addr1)&nbsp;run&nbsp;on&nbsp;the&nbsp;machine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182242">//&nbsp;at&nbsp;addr2,&nbsp;without&nbsp;either&nbsp;machine&nbsp;executing&nbsp;Listen.&nbsp;&nbsp;If&nbsp;laddr&nbsp;==&nbsp;nil,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182315">//&nbsp;it&nbsp;means&nbsp;we&nbsp;want&nbsp;the&nbsp;kernel&nbsp;to&nbsp;pick&nbsp;an&nbsp;appropriate&nbsp;originating&nbsp;local</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182388">//&nbsp;address.&nbsp;&nbsp;Some&nbsp;Linux&nbsp;kernels&nbsp;cycle&nbsp;blindly&nbsp;through&nbsp;a&nbsp;fixed&nbsp;range&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182460">//&nbsp;local&nbsp;ports,&nbsp;regardless&nbsp;of&nbsp;destination&nbsp;port.&nbsp;&nbsp;If&nbsp;a&nbsp;kernel&nbsp;happens&nbsp;to</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182533">//&nbsp;pick&nbsp;local&nbsp;port&nbsp;50001&nbsp;as&nbsp;the&nbsp;source&nbsp;for&nbsp;a&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;&#34;,&nbsp;&#34;localhost:50001&#34;),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182615">//&nbsp;then&nbsp;the&nbsp;Dial&nbsp;will&nbsp;succeed,&nbsp;having&nbsp;simultaneously&nbsp;connected&nbsp;to&nbsp;itself.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182690">//&nbsp;This&nbsp;can&nbsp;only&nbsp;happen&nbsp;when&nbsp;we&nbsp;are&nbsp;letting&nbsp;the&nbsp;kernel&nbsp;pick&nbsp;a&nbsp;port&nbsp;(laddr&nbsp;==&nbsp;nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182773">//&nbsp;and&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;listener&nbsp;for&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182836">//&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;argue&nbsp;this&nbsp;is&nbsp;anything&nbsp;other&nbsp;than&nbsp;a&nbsp;kernel&nbsp;bug.&nbsp;&nbsp;If&nbsp;we</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182908">//&nbsp;see&nbsp;this&nbsp;happen,&nbsp;rather&nbsp;than&nbsp;expose&nbsp;the&nbsp;buggy&nbsp;effect&nbsp;to&nbsp;users,&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182978">//&nbsp;close&nbsp;the&nbsp;fd&nbsp;and&nbsp;try&nbsp;again.&nbsp;&nbsp;If&nbsp;it&nbsp;happens&nbsp;twice&nbsp;more,&nbsp;we&nbsp;relent&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183051">//&nbsp;use&nbsp;the&nbsp;result.&nbsp;&nbsp;See&nbsp;also:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183082">//&nbsp;&nbsp;&nbsp;&nbsphttp://golang.org/issue/2690</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183115">//&nbsp;&nbsp;&nbsp;&nbsphttp://stackoverflow.com/questions/4949858/</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183163">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183167">//&nbsp;The&nbsp;opposite&nbsp;can&nbsp;also&nbsp;happen:&nbsp;if&nbsp;we&nbsp;ask&nbsp;the&nbsp;kernel&nbsp;to&nbsp;pick&nbsp;an&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183245">//&nbsp;originating&nbsp;local&nbsp;address,&nbsp;sometimes&nbsp;it&nbsp;picks&nbsp;one&nbsp;that&nbsp;is&nbsp;already&nbsp;in&nbsp;use.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183323">//&nbsp;So&nbsp;if&nbsp;the&nbsp;error&nbsp;is&nbsp;EADDRNOTAVAIL,&nbsp;we&nbsp;have&nbsp;to&nbsp;try&nbsp;again&nbsp;too,&nbsp;just&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183396">//&nbsp;a&nbsp;different&nbsp;reason.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183420">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183424">//&nbsp;The&nbsp;kernel&nbsp;socket&nbsp;code&nbsp;is&nbsp;no&nbsp;doubt&nbsp;enjoying&nbsp;watching&nbsp;us&nbsp;squirm.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183492">for</span>&nbsp;<span class="ident" id="4183496">i</span>&nbsp;<span class="op" id="4183498">:=</span>&nbsp;<span class="num" id="4183501">0</span><span class="op" id="4183502">;</span>&nbsp;<span class="ident" id="4183504">i</span>&nbsp;<span class="op" id="4183506">&lt;</span>&nbsp;<span class="num" id="4183508">2</span>&nbsp;<span class="op" id="4183510">&amp;&amp;</span>&nbsp;<span class="op" id="4183513">(</span><span class="ident" id="4183514">laddr</span>&nbsp;<span class="op" id="4183520">==</span>&nbsp;<span class="ident" id="4183523">nil</span>&nbsp;<span class="op" id="4183527">||</span>&nbsp;<span class="ident" id="4183530">laddr</span><span class="op" id="4183535">.</span><span class="ident" id="4183536">Port</span>&nbsp;<span class="op" id="4183541">==</span>&nbsp;<span class="num" id="4183544">0</span><span class="op" id="4183545">)</span>&nbsp;<span class="op" id="4183547">&amp;&amp;</span>&nbsp;<span class="op" id="4183550">(</span><span class="ident" id="4183551">selfConnect</span><span class="op" id="4183562">(</span><span class="ident" id="4183563">fd</span><span class="op" id="4183565">,</span>&nbsp;<span class="ident" id="4183567">err</span><span class="op" id="4183570">)</span>&nbsp;<span class="op" id="4183572">||</span>&nbsp;<span class="ident" id="4183575">spuriousENOTAVAIL</span><span class="op" id="4183592">(</span><span class="ident" id="4183593">err</span><span class="op" id="4183596">)</span><span class="op" id="4183597">)</span><span class="op" id="4183598">;</span>&nbsp;<span class="ident" id="4183600">i</span><span class="op" id="4183601">++</span>&nbsp;<span class="op" id="4183604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183608">if</span>&nbsp;<span class="ident" id="4183611">err</span>&nbsp;<span class="op" id="4183615">==</span>&nbsp;<span class="ident" id="4183618">nil</span>&nbsp;<span class="op" id="4183622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183627">fd</span><span class="op" id="4183629">.</span><span class="ident" id="4183630">Close</span><span class="op" id="4183635">(</span><span class="op" id="4183636">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183644">fd</span><span class="op" id="4183646">,</span>&nbsp;<span class="ident" id="4183648">err</span>&nbsp;<span class="op" id="4183652">=</span>&nbsp;<span class="ident" id="4183654">internetSocket</span><span class="op" id="4183668">(</span><span class="ident" id="4183669">net</span><span class="op" id="4183672">,</span>&nbsp;<span class="ident" id="4183674">laddr</span><span class="op" id="4183679">,</span>&nbsp;<span class="ident" id="4183681">raddr</span><span class="op" id="4183686">,</span>&nbsp;<span class="ident" id="4183688">deadline</span><span class="op" id="4183696">,</span>&nbsp;<span class="ident" id="4183698">syscall</span><span class="op" id="4183705">.</span><span class="ident" id="4183706">SOCK_STREAM</span><span class="op" id="4183717">,</span>&nbsp;<span class="num" id="4183719">0</span><span class="op" id="4183720">,</span>&nbsp;<span class="string" id="4183722">&#34;dial&#34;</span><span class="op" id="4183728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183735">if</span>&nbsp;<span class="ident" id="4183738">err</span>&nbsp;<span class="op" id="4183742">!=</span>&nbsp;<span class="ident" id="4183745">nil</span>&nbsp;<span class="op" id="4183749">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183753">return</span>&nbsp;<span class="ident" id="4183760">nil</span><span class="op" id="4183763">,</span>&nbsp;<span class="op" id="4183765">&amp;</span><span class="ident" id="4183766">OpError</span><span class="op" id="4183773">{</span><span class="ident" id="4183774">Op</span><span class="op" id="4183776">:</span>&nbsp;<span class="string" id="4183778">&#34;dial&#34;</span><span class="op" id="4183784">,</span>&nbsp;<span class="ident" id="4183786">Net</span><span class="op" id="4183789">:</span>&nbsp;<span class="ident" id="4183791">net</span><span class="op" id="4183794">,</span>&nbsp;<span class="ident" id="4183796">Addr</span><span class="op" id="4183800">:</span>&nbsp;<span class="ident" id="4183802">raddr</span><span class="op" id="4183807">,</span>&nbsp;<span class="ident" id="4183809">Err</span><span class="op" id="4183812">:</span>&nbsp;<span class="ident" id="4183814">err</span><span class="op" id="4183817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183823">return</span>&nbsp;<span class="ident" id="4183830">newTCPConn</span><span class="op" id="4183840">(</span><span class="ident" id="4183841">fd</span><span class="op" id="4183843">)</span><span class="op" id="4183844">,</span>&nbsp;<span class="ident" id="4183846">nil</span><br>
<span class="lineno"></span><span class="op" id="4183850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="keyword" id="4183853">func</span>&nbsp;<span class="ident" id="4183858">selfConnect</span><span class="op" id="4183869">(</span><span class="ident" id="4183870">fd</span>&nbsp;<span class="op" id="4183873">*</span><span class="ident" id="4183874">netFD</span><span class="op" id="4183879">,</span>&nbsp;<span class="ident" id="4183881">err</span>&nbsp;<span class="builtintype" id="4183885">error</span><span class="op" id="4183890">)</span>&nbsp;<span class="builtintype" id="4183892">bool</span>&nbsp;<span class="op" id="4183897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4183900">//&nbsp;If&nbsp;the&nbsp;connect&nbsp;failed,&nbsp;we&nbsp;clearly&nbsp;didn&#39;t&nbsp;connect&nbsp;to&nbsp;ourselves.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183967">if</span>&nbsp;<span class="ident" id="4183970">err</span>&nbsp;<span class="op" id="4183974">!=</span>&nbsp;<span class="ident" id="4183977">nil</span>&nbsp;<span class="op" id="4183981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4183985">return</span>&nbsp;<span class="builtintype" id="4183992">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4183999">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184003">//&nbsp;The&nbsp;socket&nbsp;constructor&nbsp;can&nbsp;return&nbsp;an&nbsp;fd&nbsp;with&nbsp;raddr&nbsp;nil&nbsp;under&nbsp;certain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184076">//&nbsp;unknown&nbsp;conditions.&nbsp;The&nbsp;errors&nbsp;in&nbsp;the&nbsp;calls&nbsp;there&nbsp;to&nbsp;Getpeername</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184145">//&nbsp;are&nbsp;discarded,&nbsp;but&nbsp;we&nbsp;can&#39;t&nbsp;catch&nbsp;the&nbsp;problem&nbsp;there&nbsp;because&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184215">//&nbsp;calls&nbsp;are&nbsp;sometimes&nbsp;legally&nbsp;erroneous&nbsp;with&nbsp;a&nbsp;&#34;socket&nbsp;not&nbsp;connected&#34;.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184288">//&nbsp;Since&nbsp;this&nbsp;code&nbsp;(selfConnect)&nbsp;is&nbsp;already&nbsp;trying&nbsp;to&nbsp;work&nbsp;around</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184355">//&nbsp;a&nbsp;problem,&nbsp;we&nbsp;make&nbsp;sure&nbsp;if&nbsp;this&nbsp;happens&nbsp;we&nbsp;recognize&nbsp;trouble&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184424">//&nbsp;ask&nbsp;the&nbsp;DialTCP&nbsp;routine&nbsp;to&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4184466">//&nbsp;TODO:&nbsp;try&nbsp;to&nbsp;understand&nbsp;what&#39;s&nbsp;really&nbsp;going&nbsp;on.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184518">if</span>&nbsp;<span class="ident" id="4184521">fd</span><span class="op" id="4184523">.</span><span class="ident" id="4184524">laddr</span>&nbsp;<span class="op" id="4184530">==</span>&nbsp;<span class="ident" id="4184533">nil</span>&nbsp;<span class="op" id="4184537">||</span>&nbsp;<span class="ident" id="4184540">fd</span><span class="op" id="4184542">.</span><span class="ident" id="4184543">raddr</span>&nbsp;<span class="op" id="4184549">==</span>&nbsp;<span class="ident" id="4184552">nil</span>&nbsp;<span class="op" id="4184556">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184560">return</span>&nbsp;<span class="builtintype" id="4184567">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4184573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184576">l</span>&nbsp;<span class="op" id="4184578">:=</span>&nbsp;<span class="ident" id="4184581">fd</span><span class="op" id="4184583">.</span><span class="ident" id="4184584">laddr</span><span class="op" id="4184589">.</span><span class="op" id="4184590">(</span><span class="op" id="4184591">*</span><span class="ident" id="4184592">TCPAddr</span><span class="op" id="4184599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184602">r</span>&nbsp;<span class="op" id="4184604">:=</span>&nbsp;<span class="ident" id="4184607">fd</span><span class="op" id="4184609">.</span><span class="ident" id="4184610">raddr</span><span class="op" id="4184615">.</span><span class="op" id="4184616">(</span><span class="op" id="4184617">*</span><span class="ident" id="4184618">TCPAddr</span><span class="op" id="4184625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184628">return</span>&nbsp;<span class="ident" id="4184635">l</span><span class="op" id="4184636">.</span><span class="ident" id="4184637">Port</span>&nbsp;<span class="op" id="4184642">==</span>&nbsp;<span class="ident" id="4184645">r</span><span class="op" id="4184646">.</span><span class="ident" id="4184647">Port</span>&nbsp;<span class="op" id="4184652">&amp;&amp;</span>&nbsp;<span class="ident" id="4184655">l</span><span class="op" id="4184656">.</span><span class="ident" id="4184657">IP</span><span class="op" id="4184659">.</span><span class="ident" id="4184660">Equal</span><span class="op" id="4184665">(</span><span class="ident" id="4184666">r</span><span class="op" id="4184667">.</span><span class="ident" id="4184668">IP</span><span class="op" id="4184670">)</span><br>
<span class="lineno">215</span><span class="op" id="4184672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4184675">func</span>&nbsp;<span class="ident" id="4184680">spuriousENOTAVAIL</span><span class="op" id="4184697">(</span><span class="ident" id="4184698">err</span>&nbsp;<span class="builtintype" id="4184702">error</span><span class="op" id="4184707">)</span>&nbsp;<span class="builtintype" id="4184709">bool</span>&nbsp;<span class="op" id="4184714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184717">e</span><span class="op" id="4184718">,</span>&nbsp;<span class="ident" id="4184720">ok</span>&nbsp;<span class="op" id="4184723">:=</span>&nbsp;<span class="ident" id="4184726">err</span><span class="op" id="4184729">.</span><span class="op" id="4184730">(</span><span class="op" id="4184731">*</span><span class="ident" id="4184732">OpError</span><span class="op" id="4184739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4184742">return</span>&nbsp;<span class="ident" id="4184749">ok</span>&nbsp;<span class="op" id="4184752">&amp;&amp;</span>&nbsp;<span class="ident" id="4184755">e</span><span class="op" id="4184756">.</span><span class="ident" id="4184757">Err</span>&nbsp;<span class="op" id="4184761">==</span>&nbsp;<span class="ident" id="4184764">syscall</span><span class="op" id="4184771">.</span><span class="ident" id="4184772">EADDRNOTAVAIL</span><br>
<span class="lineno">220</span><span class="op" id="4184786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4184789">//&nbsp;TCPListener&nbsp;is&nbsp;a&nbsp;TCP&nbsp;network&nbsp;listener.&nbsp;&nbsp;Clients&nbsp;should&nbsp;typically</span><br>
<span class="lineno"></span><span class="comment" id="4184857">//&nbsp;use&nbsp;variables&nbsp;of&nbsp;type&nbsp;Listener&nbsp;instead&nbsp;of&nbsp;assuming&nbsp;TCP.</span><br>
<span class="lineno"></span><span class="keyword" id="4184916">type</span>&nbsp;<span class="ident" id="4184921">TCPListener</span>&nbsp;<span class="keyword" id="4184933">struct</span>&nbsp;<span class="op" id="4184940">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4184943">fd</span>&nbsp;<span class="op" id="4184946">*</span><span class="ident" id="4184947">netFD</span><br>
<span class="lineno"></span><span class="op" id="4184953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4184956">//&nbsp;AcceptTCP&nbsp;accepts&nbsp;the&nbsp;next&nbsp;incoming&nbsp;call&nbsp;and&nbsp;returns&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="4185020">//&nbsp;connection.</span><br>
<span class="lineno">230</span><span class="keyword" id="4185035">func</span>&nbsp;<span class="op" id="4185040">(</span><span class="ident" id="4185041">l</span>&nbsp;<span class="op" id="4185043">*</span><span class="ident" id="4185044">TCPListener</span><span class="op" id="4185055">)</span>&nbsp;<span class="ident" id="4185057">AcceptTCP</span><span class="op" id="4185066">(</span><span class="op" id="4185067">)</span>&nbsp;<span class="op" id="4185069">(</span><span class="op" id="4185070">*</span><span class="ident" id="4185071">TCPConn</span><span class="op" id="4185078">,</span>&nbsp;<span class="builtintype" id="4185080">error</span><span class="op" id="4185085">)</span>&nbsp;<span class="op" id="4185087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185090">if</span>&nbsp;<span class="ident" id="4185093">l</span>&nbsp;<span class="op" id="4185095">==</span>&nbsp;<span class="ident" id="4185098">nil</span>&nbsp;<span class="op" id="4185102">||</span>&nbsp;<span class="ident" id="4185105">l</span><span class="op" id="4185106">.</span><span class="ident" id="4185107">fd</span>&nbsp;<span class="op" id="4185110">==</span>&nbsp;<span class="ident" id="4185113">nil</span>&nbsp;<span class="op" id="4185117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185121">return</span>&nbsp;<span class="ident" id="4185128">nil</span><span class="op" id="4185131">,</span>&nbsp;<span class="ident" id="4185133">syscall</span><span class="op" id="4185140">.</span><span class="ident" id="4185141">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4185149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185152">fd</span><span class="op" id="4185154">,</span>&nbsp;<span class="ident" id="4185156">err</span>&nbsp;<span class="op" id="4185160">:=</span>&nbsp;<span class="ident" id="4185163">l</span><span class="op" id="4185164">.</span><span class="ident" id="4185165">fd</span><span class="op" id="4185167">.</span><span class="ident" id="4185168">accept</span><span class="op" id="4185174">(</span><span class="op" id="4185175">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185178">if</span>&nbsp;<span class="ident" id="4185181">err</span>&nbsp;<span class="op" id="4185185">!=</span>&nbsp;<span class="ident" id="4185188">nil</span>&nbsp;<span class="op" id="4185192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185196">return</span>&nbsp;<span class="ident" id="4185203">nil</span><span class="op" id="4185206">,</span>&nbsp;<span class="ident" id="4185208">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4185213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185216">return</span>&nbsp;<span class="ident" id="4185223">newTCPConn</span><span class="op" id="4185233">(</span><span class="ident" id="4185234">fd</span><span class="op" id="4185236">)</span><span class="op" id="4185237">,</span>&nbsp;<span class="ident" id="4185239">nil</span><br>
<span class="lineno"></span><span class="op" id="4185243">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="4185246">//&nbsp;Accept&nbsp;implements&nbsp;the&nbsp;Accept&nbsp;method&nbsp;in&nbsp;the&nbsp;Listener&nbsp;interface;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4185315">//&nbsp;waits&nbsp;for&nbsp;the&nbsp;next&nbsp;call&nbsp;and&nbsp;returns&nbsp;a&nbsp;generic&nbsp;Conn.</span><br>
<span class="lineno"></span><span class="keyword" id="4185370">func</span>&nbsp;<span class="op" id="4185375">(</span><span class="ident" id="4185376">l</span>&nbsp;<span class="op" id="4185378">*</span><span class="ident" id="4185379">TCPListener</span><span class="op" id="4185390">)</span>&nbsp;<span class="ident" id="4185392">Accept</span><span class="op" id="4185398">(</span><span class="op" id="4185399">)</span>&nbsp;<span class="op" id="4185401">(</span><span class="ident" id="4185402">Conn</span><span class="op" id="4185406">,</span>&nbsp;<span class="builtintype" id="4185408">error</span><span class="op" id="4185413">)</span>&nbsp;<span class="op" id="4185415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185418">c</span><span class="op" id="4185419">,</span>&nbsp;<span class="ident" id="4185421">err</span>&nbsp;<span class="op" id="4185425">:=</span>&nbsp;<span class="ident" id="4185428">l</span><span class="op" id="4185429">.</span><span class="ident" id="4185430">AcceptTCP</span><span class="op" id="4185439">(</span><span class="op" id="4185440">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185443">if</span>&nbsp;<span class="ident" id="4185446">err</span>&nbsp;<span class="op" id="4185450">!=</span>&nbsp;<span class="ident" id="4185453">nil</span>&nbsp;<span class="op" id="4185457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185461">return</span>&nbsp;<span class="ident" id="4185468">nil</span><span class="op" id="4185471">,</span>&nbsp;<span class="ident" id="4185473">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4185478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185481">return</span>&nbsp;<span class="ident" id="4185488">c</span><span class="op" id="4185489">,</span>&nbsp;<span class="ident" id="4185491">nil</span><br>
<span class="lineno"></span><span class="op" id="4185495">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="comment" id="4185498">//&nbsp;Close&nbsp;stops&nbsp;listening&nbsp;on&nbsp;the&nbsp;TCP&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="4185543">//&nbsp;Already&nbsp;Accepted&nbsp;connections&nbsp;are&nbsp;not&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="4185591">func</span>&nbsp;<span class="op" id="4185596">(</span><span class="ident" id="4185597">l</span>&nbsp;<span class="op" id="4185599">*</span><span class="ident" id="4185600">TCPListener</span><span class="op" id="4185611">)</span>&nbsp;<span class="ident" id="4185613">Close</span><span class="op" id="4185618">(</span><span class="op" id="4185619">)</span>&nbsp;<span class="builtintype" id="4185621">error</span>&nbsp;<span class="op" id="4185627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185630">if</span>&nbsp;<span class="ident" id="4185633">l</span>&nbsp;<span class="op" id="4185635">==</span>&nbsp;<span class="ident" id="4185638">nil</span>&nbsp;<span class="op" id="4185642">||</span>&nbsp;<span class="ident" id="4185645">l</span><span class="op" id="4185646">.</span><span class="ident" id="4185647">fd</span>&nbsp;<span class="op" id="4185650">==</span>&nbsp;<span class="ident" id="4185653">nil</span>&nbsp;<span class="op" id="4185657">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185661">return</span>&nbsp;<span class="ident" id="4185668">syscall</span><span class="op" id="4185675">.</span><span class="ident" id="4185676">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4185684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185687">return</span>&nbsp;<span class="ident" id="4185694">l</span><span class="op" id="4185695">.</span><span class="ident" id="4185696">fd</span><span class="op" id="4185698">.</span><span class="ident" id="4185699">Close</span><span class="op" id="4185704">(</span><span class="op" id="4185705">)</span><br>
<span class="lineno"></span><span class="op" id="4185707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="4185710">//&nbsp;Addr&nbsp;returns&nbsp;the&nbsp;listener&#39;s&nbsp;network&nbsp;address,&nbsp;a&nbsp;*TCPAddr.</span><br>
<span class="lineno"></span><span class="keyword" id="4185770">func</span>&nbsp;<span class="op" id="4185775">(</span><span class="ident" id="4185776">l</span>&nbsp;<span class="op" id="4185778">*</span><span class="ident" id="4185779">TCPListener</span><span class="op" id="4185790">)</span>&nbsp;<span class="ident" id="4185792">Addr</span><span class="op" id="4185796">(</span><span class="op" id="4185797">)</span>&nbsp;<span class="ident" id="4185799">Addr</span>&nbsp;<span class="op" id="4185804">{</span>&nbsp;<span class="keyword" id="4185806">return</span>&nbsp;<span class="ident" id="4185813">l</span><span class="op" id="4185814">.</span><span class="ident" id="4185815">fd</span><span class="op" id="4185817">.</span><span class="ident" id="4185818">laddr</span>&nbsp;<span class="op" id="4185824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4185827">//&nbsp;SetDeadline&nbsp;sets&nbsp;the&nbsp;deadline&nbsp;associated&nbsp;with&nbsp;the&nbsp;listener.</span><br>
<span class="lineno"></span><span class="comment" id="4185890">//&nbsp;A&nbsp;zero&nbsp;time&nbsp;value&nbsp;disables&nbsp;the&nbsp;deadline.</span><br>
<span class="lineno">265</span><span class="keyword" id="4185934">func</span>&nbsp;<span class="op" id="4185939">(</span><span class="ident" id="4185940">l</span>&nbsp;<span class="op" id="4185942">*</span><span class="ident" id="4185943">TCPListener</span><span class="op" id="4185954">)</span>&nbsp;<span class="ident" id="4185956">SetDeadline</span><span class="op" id="4185967">(</span><span class="ident" id="4185968">t</span>&nbsp;<span class="ident" id="4185970">time</span><span class="op" id="4185974">.</span><span class="ident" id="4185975">Time</span><span class="op" id="4185979">)</span>&nbsp;<span class="builtintype" id="4185981">error</span>&nbsp;<span class="op" id="4185987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4185990">if</span>&nbsp;<span class="ident" id="4185993">l</span>&nbsp;<span class="op" id="4185995">==</span>&nbsp;<span class="ident" id="4185998">nil</span>&nbsp;<span class="op" id="4186002">||</span>&nbsp;<span class="ident" id="4186005">l</span><span class="op" id="4186006">.</span><span class="ident" id="4186007">fd</span>&nbsp;<span class="op" id="4186010">==</span>&nbsp;<span class="ident" id="4186013">nil</span>&nbsp;<span class="op" id="4186017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186021">return</span>&nbsp;<span class="ident" id="4186028">syscall</span><span class="op" id="4186035">.</span><span class="ident" id="4186036">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4186044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186047">return</span>&nbsp;<span class="ident" id="4186054">l</span><span class="op" id="4186055">.</span><span class="ident" id="4186056">fd</span><span class="op" id="4186058">.</span><span class="ident" id="4186059">setDeadline</span><span class="op" id="4186070">(</span><span class="ident" id="4186071">t</span><span class="op" id="4186072">)</span><br>
<span class="lineno">270</span><span class="op" id="4186074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4186077">//&nbsp;File&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;underlying&nbsp;os.File,&nbsp;set&nbsp;to&nbsp;blocking</span><br>
<span class="lineno"></span><span class="comment" id="4186143">//&nbsp;mode.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="4186213">//&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;l.</span><br>
<span class="lineno">275</span><span class="comment" id="4186278">//</span><br>
<span class="lineno"></span><span class="comment" id="4186281">//&nbsp;The&nbsp;returned&nbsp;os.File&#39;s&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;different&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4186345">//&nbsp;connection&#39;s.&nbsp;&nbsp;Attempting&nbsp;to&nbsp;change&nbsp;properties&nbsp;of&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span><span class="comment" id="4186411">//&nbsp;using&nbsp;this&nbsp;duplicate&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;have&nbsp;the&nbsp;desired&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="4186475">func</span>&nbsp;<span class="op" id="4186480">(</span><span class="ident" id="4186481">l</span>&nbsp;<span class="op" id="4186483">*</span><span class="ident" id="4186484">TCPListener</span><span class="op" id="4186495">)</span>&nbsp;<span class="ident" id="4186497">File</span><span class="op" id="4186501">(</span><span class="op" id="4186502">)</span>&nbsp;<span class="op" id="4186504">(</span><span class="ident" id="4186505">f</span>&nbsp;<span class="op" id="4186507">*</span><span class="ident" id="4186508">os</span><span class="op" id="4186510">.</span><span class="ident" id="4186511">File</span><span class="op" id="4186515">,</span>&nbsp;<span class="ident" id="4186517">err</span>&nbsp;<span class="builtintype" id="4186521">error</span><span class="op" id="4186526">)</span>&nbsp;<span class="op" id="4186528">{</span>&nbsp;<span class="keyword" id="4186530">return</span>&nbsp;<span class="ident" id="4186537">l</span><span class="op" id="4186538">.</span><span class="ident" id="4186539">fd</span><span class="op" id="4186541">.</span><span class="ident" id="4186542">dup</span><span class="op" id="4186545">(</span><span class="op" id="4186546">)</span>&nbsp;<span class="op" id="4186548">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="4186551">//&nbsp;ListenTCP&nbsp;announces&nbsp;on&nbsp;the&nbsp;TCP&nbsp;address&nbsp;laddr&nbsp;and&nbsp;returns&nbsp;a&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="4186617">//&nbsp;listener.&nbsp;&nbsp;Net&nbsp;must&nbsp;be&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,&nbsp;or&nbsp;&#34;tcp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;has&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4186685">//&nbsp;port&nbsp;of&nbsp;0,&nbsp;ListenTCP&nbsp;will&nbsp;choose&nbsp;an&nbsp;available&nbsp;port.&nbsp;&nbsp;The&nbsp;caller&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="4186756">//&nbsp;use&nbsp;the&nbsp;Addr&nbsp;method&nbsp;of&nbsp;TCPListener&nbsp;to&nbsp;retrieve&nbsp;the&nbsp;chosen&nbsp;address.</span><br>
<span class="lineno">285</span><span class="keyword" id="4186826">func</span>&nbsp;<span class="ident" id="4186831">ListenTCP</span><span class="op" id="4186840">(</span><span class="ident" id="4186841">net</span>&nbsp;<span class="builtintype" id="4186845">string</span><span class="op" id="4186851">,</span>&nbsp;<span class="ident" id="4186853">laddr</span>&nbsp;<span class="op" id="4186859">*</span><span class="ident" id="4186860">TCPAddr</span><span class="op" id="4186867">)</span>&nbsp;<span class="op" id="4186869">(</span><span class="op" id="4186870">*</span><span class="ident" id="4186871">TCPListener</span><span class="op" id="4186882">,</span>&nbsp;<span class="builtintype" id="4186884">error</span><span class="op" id="4186889">)</span>&nbsp;<span class="op" id="4186891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186894">switch</span>&nbsp;<span class="ident" id="4186901">net</span>&nbsp;<span class="op" id="4186905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186908">case</span>&nbsp;<span class="string" id="4186913">&#34;tcp&#34;</span><span class="op" id="4186918">,</span>&nbsp;<span class="string" id="4186920">&#34;tcp4&#34;</span><span class="op" id="4186926">,</span>&nbsp;<span class="string" id="4186928">&#34;tcp6&#34;</span><span class="op" id="4186934">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186937">default</span><span class="op" id="4186944">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186948">return</span>&nbsp;<span class="ident" id="4186955">nil</span><span class="op" id="4186958">,</span>&nbsp;<span class="op" id="4186960">&amp;</span><span class="ident" id="4186961">OpError</span><span class="op" id="4186968">{</span><span class="ident" id="4186969">Op</span><span class="op" id="4186971">:</span>&nbsp;<span class="string" id="4186973">&#34;listen&#34;</span><span class="op" id="4186981">,</span>&nbsp;<span class="ident" id="4186983">Net</span><span class="op" id="4186986">:</span>&nbsp;<span class="ident" id="4186988">net</span><span class="op" id="4186991">,</span>&nbsp;<span class="ident" id="4186993">Addr</span><span class="op" id="4186997">:</span>&nbsp;<span class="ident" id="4186999">laddr</span><span class="op" id="4187004">,</span>&nbsp;<span class="ident" id="4187006">Err</span><span class="op" id="4187009">:</span>&nbsp;<span class="ident" id="4187011">UnknownNetworkError</span><span class="op" id="4187030">(</span><span class="ident" id="4187031">net</span><span class="op" id="4187034">)</span><span class="op" id="4187035">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4187038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187041">if</span>&nbsp;<span class="ident" id="4187044">laddr</span>&nbsp;<span class="op" id="4187050">==</span>&nbsp;<span class="ident" id="4187053">nil</span>&nbsp;<span class="op" id="4187057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187061">laddr</span>&nbsp;<span class="op" id="4187067">=</span>&nbsp;<span class="op" id="4187069">&amp;</span><span class="ident" id="4187070">TCPAddr</span><span class="op" id="4187077">{</span><span class="op" id="4187078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4187081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187084">fd</span><span class="op" id="4187086">,</span>&nbsp;<span class="ident" id="4187088">err</span>&nbsp;<span class="op" id="4187092">:=</span>&nbsp;<span class="ident" id="4187095">internetSocket</span><span class="op" id="4187109">(</span><span class="ident" id="4187110">net</span><span class="op" id="4187113">,</span>&nbsp;<span class="ident" id="4187115">laddr</span><span class="op" id="4187120">,</span>&nbsp;<span class="ident" id="4187122">nil</span><span class="op" id="4187125">,</span>&nbsp;<span class="ident" id="4187127">noDeadline</span><span class="op" id="4187137">,</span>&nbsp;<span class="ident" id="4187139">syscall</span><span class="op" id="4187146">.</span><span class="ident" id="4187147">SOCK_STREAM</span><span class="op" id="4187158">,</span>&nbsp;<span class="num" id="4187160">0</span><span class="op" id="4187161">,</span>&nbsp;<span class="string" id="4187163">&#34;listen&#34;</span><span class="op" id="4187171">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187174">if</span>&nbsp;<span class="ident" id="4187177">err</span>&nbsp;<span class="op" id="4187181">!=</span>&nbsp;<span class="ident" id="4187184">nil</span>&nbsp;<span class="op" id="4187188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187192">return</span>&nbsp;<span class="ident" id="4187199">nil</span><span class="op" id="4187202">,</span>&nbsp;<span class="op" id="4187204">&amp;</span><span class="ident" id="4187205">OpError</span><span class="op" id="4187212">{</span><span class="ident" id="4187213">Op</span><span class="op" id="4187215">:</span>&nbsp;<span class="string" id="4187217">&#34;listen&#34;</span><span class="op" id="4187225">,</span>&nbsp;<span class="ident" id="4187227">Net</span><span class="op" id="4187230">:</span>&nbsp;<span class="ident" id="4187232">net</span><span class="op" id="4187235">,</span>&nbsp;<span class="ident" id="4187237">Addr</span><span class="op" id="4187241">:</span>&nbsp;<span class="ident" id="4187243">laddr</span><span class="op" id="4187248">,</span>&nbsp;<span class="ident" id="4187250">Err</span><span class="op" id="4187253">:</span>&nbsp;<span class="ident" id="4187255">err</span><span class="op" id="4187258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4187261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187264">return</span>&nbsp;<span class="op" id="4187271">&amp;</span><span class="ident" id="4187272">TCPListener</span><span class="op" id="4187283">{</span><span class="ident" id="4187284">fd</span><span class="op" id="4187286">}</span><span class="op" id="4187287">,</span>&nbsp;<span class="ident" id="4187289">nil</span><br>
<span class="lineno"></span><span class="op" id="4187293">}</span>
</div>
</body>
</html>
