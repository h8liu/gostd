<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1752586">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1752641">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1752695">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1752746">package</span>&nbsp;<span class="ident" id="1752754">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1752763">import</span>&nbsp;<span class="string" id="1752770">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1752780">//&nbsp;The&nbsp;code&nbsp;in&nbsp;this&nbsp;file&nbsp;implements&nbsp;stack&nbsp;trace&nbsp;walking&nbsp;for&nbsp;all&nbsp;architectures.</span><br>
<span class="lineno">10</span><span class="comment" id="1752859">//&nbsp;The&nbsp;most&nbsp;important&nbsp;fact&nbsp;about&nbsp;a&nbsp;given&nbsp;architecture&nbsp;is&nbsp;whether&nbsp;it&nbsp;uses&nbsp;a&nbsp;link&nbsp;register.</span><br>
<span class="lineno"></span><span class="comment" id="1752949">//&nbsp;On&nbsp;systems&nbsp;with&nbsp;link&nbsp;registers,&nbsp;the&nbsp;prologue&nbsp;for&nbsp;a&nbsp;non-leaf&nbsp;function&nbsp;stores&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1753032">//&nbsp;incoming&nbsp;value&nbsp;of&nbsp;LR&nbsp;at&nbsp;the&nbsp;bottom&nbsp;of&nbsp;the&nbsp;newly&nbsp;allocated&nbsp;stack&nbsp;frame.</span><br>
<span class="lineno"></span><span class="comment" id="1753106">//&nbsp;On&nbsp;systems&nbsp;without&nbsp;link&nbsp;registers,&nbsp;the&nbsp;architecture&nbsp;pushes&nbsp;a&nbsp;return&nbsp;PC&nbsp;during</span><br>
<span class="lineno"></span><span class="comment" id="1753187">//&nbsp;the&nbsp;call&nbsp;instruction,&nbsp;so&nbsp;the&nbsp;return&nbsp;PC&nbsp;ends&nbsp;up&nbsp;above&nbsp;the&nbsp;stack&nbsp;frame.</span><br>
<span class="lineno">15</span><span class="comment" id="1753260">//&nbsp;In&nbsp;this&nbsp;file,&nbsp;the&nbsp;return&nbsp;PC&nbsp;is&nbsp;always&nbsp;called&nbsp;LR,&nbsp;no&nbsp;matter&nbsp;how&nbsp;it&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="1753340">//</span><br>
<span class="lineno"></span><span class="comment" id="1753343">//&nbsp;To&nbsp;date,&nbsp;the&nbsp;opposite&nbsp;of&nbsp;a&nbsp;link&nbsp;register&nbsp;architecture&nbsp;is&nbsp;an&nbsp;x86&nbsp;architecture.</span><br>
<span class="lineno"></span><span class="comment" id="1753424">//&nbsp;This&nbsp;code&nbsp;may&nbsp;need&nbsp;to&nbsp;change&nbsp;if&nbsp;some&nbsp;other&nbsp;kind&nbsp;of&nbsp;non-link-register</span><br>
<span class="lineno"></span><span class="comment" id="1753496">//&nbsp;architecture&nbsp;comes&nbsp;along.</span><br>
<span class="lineno">20</span><span class="comment" id="1753525">//</span><br>
<span class="lineno"></span><span class="comment" id="1753528">//&nbsp;The&nbsp;other&nbsp;important&nbsp;fact&nbsp;is&nbsp;the&nbsp;size&nbsp;of&nbsp;a&nbsp;pointer:&nbsp;on&nbsp;32-bit&nbsp;systems&nbsp;the&nbsp;LR</span><br>
<span class="lineno"></span><span class="comment" id="1753607">//&nbsp;takes&nbsp;up&nbsp;only&nbsp;4&nbsp;bytes&nbsp;on&nbsp;the&nbsp;stack,&nbsp;while&nbsp;on&nbsp;64-bit&nbsp;systems&nbsp;it&nbsp;takes&nbsp;up&nbsp;8&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1753691">//&nbsp;Typically&nbsp;this&nbsp;is&nbsp;ptrSize.</span><br>
<span class="lineno"></span><span class="comment" id="1753721">//</span><br>
<span class="lineno">25</span><span class="comment" id="1753724">//&nbsp;As&nbsp;an&nbsp;exception,&nbsp;amd64p32&nbsp;has&nbsp;ptrSize&nbsp;==&nbsp;4&nbsp;but&nbsp;the&nbsp;CALL&nbsp;instruction&nbsp;still</span><br>
<span class="lineno"></span><span class="comment" id="1753801">//&nbsp;stores&nbsp;an&nbsp;8-byte&nbsp;return&nbsp;PC&nbsp;onto&nbsp;the&nbsp;stack.&nbsp;To&nbsp;accommodate&nbsp;this,&nbsp;we&nbsp;use&nbsp;regSize</span><br>
<span class="lineno"></span><span class="comment" id="1753883">//&nbsp;as&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;architecture-pushed&nbsp;return&nbsp;PC.</span><br>
<span class="lineno"></span><span class="comment" id="1753936">//</span><br>
<span class="lineno"></span><span class="comment" id="1753939">//&nbsp;usesLR&nbsp;is&nbsp;defined&nbsp;below.&nbsp;ptrSize&nbsp;and&nbsp;regSize&nbsp;are&nbsp;defined&nbsp;in&nbsp;stubs.go.</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="1754013">const</span>&nbsp;<span class="ident" id="1754019">usesLR</span>&nbsp;<span class="op" id="1754026">=</span>&nbsp;<span class="ident" id="1754028">GOARCH</span>&nbsp;<span class="op" id="1754035">!=</span>&nbsp;<span class="string" id="1754038">&#34;amd64&#34;</span>&nbsp;<span class="op" id="1754046">&amp;&amp;</span>&nbsp;<span class="ident" id="1754049">GOARCH</span>&nbsp;<span class="op" id="1754056">!=</span>&nbsp;<span class="string" id="1754059">&#34;amd64p32&#34;</span>&nbsp;<span class="op" id="1754070">&amp;&amp;</span>&nbsp;<span class="ident" id="1754073">GOARCH</span>&nbsp;<span class="op" id="1754080">!=</span>&nbsp;<span class="string" id="1754083">&#34;386&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1754090">var</span>&nbsp;<span class="op" id="1754094">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1754097">//&nbsp;initialized&nbsp;in&nbsp;tracebackinit</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754130">deferprocPC</span>&nbsp;<span class="builtintype" id="1754142">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754151">goexitPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1754163">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754172">jmpdeferPC</span>&nbsp;&nbsp;<span class="builtintype" id="1754184">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754193">mcallPC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1754205">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754214">morestackPC</span>&nbsp;<span class="builtintype" id="1754226">uintptr</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754235">mstartPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1754247">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754256">newprocPC</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1754268">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754277">rt0_goPC</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1754289">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754298">sigpanicPC</span>&nbsp;&nbsp;<span class="builtintype" id="1754310">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754320">externalthreadhandlerp</span>&nbsp;<span class="builtintype" id="1754343">uintptr</span>&nbsp;<span class="comment" id="1754351">//&nbsp;initialized&nbsp;elsewhere</span><br>
<span class="lineno"></span><span class="op" id="1754376">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1754379">func</span>&nbsp;<span class="ident" id="1754384">tracebackinit</span><span class="op" id="1754397">(</span><span class="op" id="1754398">)</span>&nbsp;<span class="op" id="1754400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1754403">//&nbsp;Go&nbsp;variable&nbsp;initialization&nbsp;happens&nbsp;late&nbsp;during&nbsp;runtime&nbsp;startup.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1754471">//&nbsp;Instead&nbsp;of&nbsp;initializing&nbsp;the&nbsp;variables&nbsp;above&nbsp;in&nbsp;the&nbsp;declarations,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1754540">//&nbsp;schedinit&nbsp;calls&nbsp;this&nbsp;function&nbsp;so&nbsp;that&nbsp;the&nbsp;variables&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1754600">//&nbsp;initialized&nbsp;and&nbsp;available&nbsp;earlier&nbsp;in&nbsp;the&nbsp;startup&nbsp;sequence.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754663">deferprocPC</span>&nbsp;<span class="op" id="1754675">=</span>&nbsp;<span class="ident" id="1754677">funcPC</span><span class="op" id="1754683">(</span><span class="ident" id="1754684">deferproc</span><span class="op" id="1754693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754696">goexitPC</span>&nbsp;<span class="op" id="1754705">=</span>&nbsp;<span class="ident" id="1754707">funcPC</span><span class="op" id="1754713">(</span><span class="ident" id="1754714">goexit</span><span class="op" id="1754720">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754723">jmpdeferPC</span>&nbsp;<span class="op" id="1754734">=</span>&nbsp;<span class="ident" id="1754736">funcPC</span><span class="op" id="1754742">(</span><span class="ident" id="1754743">jmpdefer</span><span class="op" id="1754751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754754">mcallPC</span>&nbsp;<span class="op" id="1754762">=</span>&nbsp;<span class="ident" id="1754764">funcPC</span><span class="op" id="1754770">(</span><span class="ident" id="1754771">mcall</span><span class="op" id="1754776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754779">morestackPC</span>&nbsp;<span class="op" id="1754791">=</span>&nbsp;<span class="ident" id="1754793">funcPC</span><span class="op" id="1754799">(</span><span class="ident" id="1754800">morestack</span><span class="op" id="1754809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754812">mstartPC</span>&nbsp;<span class="op" id="1754821">=</span>&nbsp;<span class="ident" id="1754823">funcPC</span><span class="op" id="1754829">(</span><span class="ident" id="1754830">mstart</span><span class="op" id="1754836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754839">newprocPC</span>&nbsp;<span class="op" id="1754849">=</span>&nbsp;<span class="ident" id="1754851">funcPC</span><span class="op" id="1754857">(</span><span class="ident" id="1754858">newproc</span><span class="op" id="1754865">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754868">rt0_goPC</span>&nbsp;<span class="op" id="1754877">=</span>&nbsp;<span class="ident" id="1754879">funcPC</span><span class="op" id="1754885">(</span><span class="ident" id="1754886">rt0_go</span><span class="op" id="1754892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1754895">sigpanicPC</span>&nbsp;<span class="op" id="1754906">=</span>&nbsp;<span class="ident" id="1754908">funcPC</span><span class="op" id="1754914">(</span><span class="ident" id="1754915">sigpanic</span><span class="op" id="1754923">)</span><br>
<span class="lineno"></span><span class="op" id="1754925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1754928">//&nbsp;Traceback&nbsp;over&nbsp;the&nbsp;deferred&nbsp;function&nbsp;calls.</span><br>
<span class="lineno">65</span><span class="comment" id="1754975">//&nbsp;Report&nbsp;them&nbsp;like&nbsp;calls&nbsp;that&nbsp;have&nbsp;been&nbsp;invoked&nbsp;but&nbsp;not&nbsp;started&nbsp;executing&nbsp;yet.</span><br>
<span class="lineno"></span><span class="keyword" id="1755055">func</span>&nbsp;<span class="ident" id="1755060">tracebackdefers</span><span class="op" id="1755075">(</span><span class="ident" id="1755076">gp</span>&nbsp;<span class="op" id="1755079">*</span><span class="ident" id="1755080">g</span><span class="op" id="1755081">,</span>&nbsp;<span class="ident" id="1755083">callback</span>&nbsp;<span class="keyword" id="1755092">func</span><span class="op" id="1755096">(</span><span class="op" id="1755097">*</span><span class="ident" id="1755098">stkframe</span><span class="op" id="1755106">,</span>&nbsp;<span class="ident" id="1755108">unsafe</span><span class="op" id="1755114">.</span><span class="ident" id="1755115">Pointer</span><span class="op" id="1755122">)</span>&nbsp;<span class="builtintype" id="1755124">bool</span><span class="op" id="1755128">,</span>&nbsp;<span class="ident" id="1755130">v</span>&nbsp;<span class="ident" id="1755132">unsafe</span><span class="op" id="1755138">.</span><span class="ident" id="1755139">Pointer</span><span class="op" id="1755146">)</span>&nbsp;<span class="op" id="1755148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1755151">var</span>&nbsp;<span class="ident" id="1755155">frame</span>&nbsp;<span class="ident" id="1755161">stkframe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1755171">for</span>&nbsp;<span class="ident" id="1755175">d</span>&nbsp;<span class="op" id="1755177">:=</span>&nbsp;<span class="ident" id="1755180">gp</span><span class="op" id="1755182">.</span><span class="ident" id="1755183">_defer</span><span class="op" id="1755189">;</span>&nbsp;<span class="ident" id="1755191">d</span>&nbsp;<span class="op" id="1755193">!=</span>&nbsp;<span class="ident" id="1755196">nil</span><span class="op" id="1755199">;</span>&nbsp;<span class="ident" id="1755201">d</span>&nbsp;<span class="op" id="1755203">=</span>&nbsp;<span class="ident" id="1755205">d</span><span class="op" id="1755206">.</span><span class="ident" id="1755207">link</span>&nbsp;<span class="op" id="1755212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755216">fn</span>&nbsp;<span class="op" id="1755219">:=</span>&nbsp;<span class="ident" id="1755222">d</span><span class="op" id="1755223">.</span><span class="ident" id="1755224">fn</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1755229">if</span>&nbsp;<span class="ident" id="1755232">fn</span>&nbsp;<span class="op" id="1755235">==</span>&nbsp;<span class="ident" id="1755238">nil</span>&nbsp;<span class="op" id="1755242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1755247">//&nbsp;Defer&nbsp;of&nbsp;nil&nbsp;function.&nbsp;Args&nbsp;don&#39;t&nbsp;matter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755295">frame</span><span class="op" id="1755300">.</span><span class="ident" id="1755301">pc</span>&nbsp;<span class="op" id="1755304">=</span>&nbsp;<span class="num" id="1755306">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755311">frame</span><span class="op" id="1755316">.</span><span class="ident" id="1755317">fn</span>&nbsp;<span class="op" id="1755320">=</span>&nbsp;<span class="ident" id="1755322">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755329">frame</span><span class="op" id="1755334">.</span><span class="ident" id="1755335">argp</span>&nbsp;<span class="op" id="1755340">=</span>&nbsp;<span class="num" id="1755342">0</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755347">frame</span><span class="op" id="1755352">.</span><span class="ident" id="1755353">arglen</span>&nbsp;<span class="op" id="1755360">=</span>&nbsp;<span class="num" id="1755362">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755367">frame</span><span class="op" id="1755372">.</span><span class="ident" id="1755373">argmap</span>&nbsp;<span class="op" id="1755380">=</span>&nbsp;<span class="ident" id="1755382">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1755388">}</span>&nbsp;<span class="keyword" id="1755390">else</span>&nbsp;<span class="op" id="1755395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755400">frame</span><span class="op" id="1755405">.</span><span class="ident" id="1755406">pc</span>&nbsp;<span class="op" id="1755409">=</span>&nbsp;<span class="builtintype" id="1755411">uintptr</span><span class="op" id="1755418">(</span><span class="ident" id="1755419">fn</span><span class="op" id="1755421">.</span><span class="ident" id="1755422">fn</span><span class="op" id="1755424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755429">f</span>&nbsp;<span class="op" id="1755431">:=</span>&nbsp;<span class="ident" id="1755434">findfunc</span><span class="op" id="1755442">(</span><span class="ident" id="1755443">frame</span><span class="op" id="1755448">.</span><span class="ident" id="1755449">pc</span><span class="op" id="1755451">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1755456">if</span>&nbsp;<span class="ident" id="1755459">f</span>&nbsp;<span class="op" id="1755461">==</span>&nbsp;<span class="ident" id="1755464">nil</span>&nbsp;<span class="op" id="1755468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1755474">print</span><span class="op" id="1755479">(</span><span class="string" id="1755480">&#34;runtime:&nbsp;unknown&nbsp;pc&nbsp;in&nbsp;defer&nbsp;&#34;</span><span class="op" id="1755511">,</span>&nbsp;<span class="ident" id="1755513">hex</span><span class="op" id="1755516">(</span><span class="ident" id="1755517">frame</span><span class="op" id="1755522">.</span><span class="ident" id="1755523">pc</span><span class="op" id="1755525">)</span><span class="op" id="1755526">,</span>&nbsp;<span class="string" id="1755528">&#34;\n&#34;</span><span class="op" id="1755532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755538">gothrow</span><span class="op" id="1755545">(</span><span class="string" id="1755546">&#34;unknown&nbsp;pc&#34;</span><span class="op" id="1755558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1755563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755568">frame</span><span class="op" id="1755573">.</span><span class="ident" id="1755574">fn</span>&nbsp;<span class="op" id="1755577">=</span>&nbsp;<span class="ident" id="1755579">f</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755584">frame</span><span class="op" id="1755589">.</span><span class="ident" id="1755590">argp</span>&nbsp;<span class="op" id="1755595">=</span>&nbsp;<span class="builtintype" id="1755597">uintptr</span><span class="op" id="1755604">(</span><span class="ident" id="1755605">deferArgs</span><span class="op" id="1755614">(</span><span class="ident" id="1755615">d</span><span class="op" id="1755616">)</span><span class="op" id="1755617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755622">setArgInfo</span><span class="op" id="1755632">(</span><span class="op" id="1755633">&amp;</span><span class="ident" id="1755634">frame</span><span class="op" id="1755639">,</span>&nbsp;<span class="ident" id="1755641">f</span><span class="op" id="1755642">,</span>&nbsp;<span class="builtintype" id="1755644">true</span><span class="op" id="1755648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1755652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1755656">frame</span><span class="op" id="1755661">.</span><span class="ident" id="1755662">continpc</span>&nbsp;<span class="op" id="1755671">=</span>&nbsp;<span class="ident" id="1755673">frame</span><span class="op" id="1755678">.</span><span class="ident" id="1755679">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1755684">if</span>&nbsp;<span class="op" id="1755687">!</span><span class="ident" id="1755688">callback</span><span class="op" id="1755696">(</span><span class="op" id="1755697">(</span><span class="op" id="1755698">*</span><span class="ident" id="1755699">stkframe</span><span class="op" id="1755707">)</span><span class="op" id="1755708">(</span><span class="ident" id="1755709">noescape</span><span class="op" id="1755717">(</span><span class="ident" id="1755718">unsafe</span><span class="op" id="1755724">.</span><span class="ident" id="1755725">Pointer</span><span class="op" id="1755732">(</span><span class="op" id="1755733">&amp;</span><span class="ident" id="1755734">frame</span><span class="op" id="1755739">)</span><span class="op" id="1755740">)</span><span class="op" id="1755741">)</span><span class="op" id="1755742">,</span>&nbsp;<span class="ident" id="1755744">v</span><span class="op" id="1755745">)</span>&nbsp;<span class="op" id="1755747">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1755752">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1755761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1755764">}</span><br>
<span class="lineno"></span><span class="op" id="1755766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="1755769">//&nbsp;Generic&nbsp;traceback.&nbsp;&nbsp;Handles&nbsp;runtime&nbsp;stack&nbsp;prints&nbsp;(pcbuf&nbsp;==&nbsp;nil),</span><br>
<span class="lineno"></span><span class="comment" id="1755837">//&nbsp;the&nbsp;runtime.Callers&nbsp;function&nbsp;(pcbuf&nbsp;!=&nbsp;nil),&nbsp;as&nbsp;well&nbsp;as&nbsp;the&nbsp;garbage</span><br>
<span class="lineno"></span><span class="comment" id="1755908">//&nbsp;collector&nbsp;(callback&nbsp;!=&nbsp;nil).&nbsp;&nbsp;A&nbsp;little&nbsp;clunky&nbsp;to&nbsp;merge&nbsp;these,&nbsp;but&nbsp;avoids</span><br>
<span class="lineno"></span><span class="comment" id="1755984">//&nbsp;duplicating&nbsp;the&nbsp;code&nbsp;and&nbsp;all&nbsp;its&nbsp;subtlety.</span><br>
<span class="lineno"></span><span class="keyword" id="1756030">func</span>&nbsp;<span class="ident" id="1756035">gentraceback</span><span class="op" id="1756047">(</span><span class="ident" id="1756048">pc0</span>&nbsp;<span class="builtintype" id="1756052">uintptr</span><span class="op" id="1756059">,</span>&nbsp;<span class="ident" id="1756061">sp0</span>&nbsp;<span class="builtintype" id="1756065">uintptr</span><span class="op" id="1756072">,</span>&nbsp;<span class="ident" id="1756074">lr0</span>&nbsp;<span class="builtintype" id="1756078">uintptr</span><span class="op" id="1756085">,</span>&nbsp;<span class="ident" id="1756087">gp</span>&nbsp;<span class="op" id="1756090">*</span><span class="ident" id="1756091">g</span><span class="op" id="1756092">,</span>&nbsp;<span class="ident" id="1756094">skip</span>&nbsp;<span class="builtintype" id="1756099">int</span><span class="op" id="1756102">,</span>&nbsp;<span class="ident" id="1756104">pcbuf</span>&nbsp;<span class="op" id="1756110">*</span><span class="builtintype" id="1756111">uintptr</span><span class="op" id="1756118">,</span>&nbsp;<span class="ident" id="1756120">max</span>&nbsp;<span class="builtintype" id="1756124">int</span><span class="op" id="1756127">,</span>&nbsp;<span class="ident" id="1756129">callback</span>&nbsp;<span class="keyword" id="1756138">func</span><span class="op" id="1756142">(</span><span class="op" id="1756143">*</span><span class="ident" id="1756144">stkframe</span><span class="op" id="1756152">,</span>&nbsp;<span class="ident" id="1756154">unsafe</span><span class="op" id="1756160">.</span><span class="ident" id="1756161">Pointer</span><span class="op" id="1756168">)</span>&nbsp;<span class="builtintype" id="1756170">bool</span><span class="op" id="1756174">,</span>&nbsp;<span class="ident" id="1756176">v</span>&nbsp;<span class="ident" id="1756178">unsafe</span><span class="op" id="1756184">.</span><span class="ident" id="1756185">Pointer</span><span class="op" id="1756192">,</span>&nbsp;<span class="ident" id="1756194">flags</span>&nbsp;<span class="builtintype" id="1756200">uint</span><span class="op" id="1756204">)</span>&nbsp;<span class="builtintype" id="1756206">int</span>&nbsp;<span class="op" id="1756210">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1756213">if</span>&nbsp;<span class="ident" id="1756216">goexitPC</span>&nbsp;<span class="op" id="1756225">==</span>&nbsp;<span class="num" id="1756228">0</span>&nbsp;<span class="op" id="1756230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1756234">gothrow</span><span class="op" id="1756241">(</span><span class="string" id="1756242">&#34;gentraceback&nbsp;before&nbsp;goexitPC&nbsp;initialization&#34;</span><span class="op" id="1756287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1756290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1756293">g</span>&nbsp;<span class="op" id="1756295">:=</span>&nbsp;<span class="ident" id="1756298">getg</span><span class="op" id="1756302">(</span><span class="op" id="1756303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1756306">if</span>&nbsp;<span class="ident" id="1756309">g</span>&nbsp;<span class="op" id="1756311">==</span>&nbsp;<span class="ident" id="1756314">gp</span>&nbsp;<span class="op" id="1756317">&amp;&amp;</span>&nbsp;<span class="ident" id="1756320">g</span>&nbsp;<span class="op" id="1756322">==</span>&nbsp;<span class="ident" id="1756325">g</span><span class="op" id="1756326">.</span><span class="ident" id="1756327">m</span><span class="op" id="1756328">.</span><span class="ident" id="1756329">curg</span>&nbsp;<span class="op" id="1756334">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756338">//&nbsp;The&nbsp;starting&nbsp;sp&nbsp;has&nbsp;been&nbsp;passed&nbsp;in&nbsp;as&nbsp;a&nbsp;uintptr,&nbsp;and&nbsp;the&nbsp;caller&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756411">//&nbsp;have&nbsp;other&nbsp;uintptr-typed&nbsp;stack&nbsp;references&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756467">//&nbsp;If&nbsp;during&nbsp;one&nbsp;of&nbsp;the&nbsp;calls&nbsp;that&nbsp;got&nbsp;us&nbsp;here&nbsp;or&nbsp;during&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756537">//&nbsp;callbacks&nbsp;below&nbsp;the&nbsp;stack&nbsp;must&nbsp;be&nbsp;grown,&nbsp;all&nbsp;these&nbsp;uintptr&nbsp;references</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756612">//&nbsp;to&nbsp;the&nbsp;stack&nbsp;will&nbsp;not&nbsp;be&nbsp;updated,&nbsp;and&nbsp;gentraceback&nbsp;will&nbsp;continue</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756682">//&nbsp;to&nbsp;inspect&nbsp;the&nbsp;old&nbsp;stack&nbsp;memory,&nbsp;which&nbsp;may&nbsp;no&nbsp;longer&nbsp;be&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756750">//&nbsp;Even&nbsp;if&nbsp;all&nbsp;the&nbsp;variables&nbsp;were&nbsp;updated&nbsp;correctly,&nbsp;it&nbsp;is&nbsp;not&nbsp;clear&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756826">//&nbsp;we&nbsp;want&nbsp;to&nbsp;expose&nbsp;a&nbsp;traceback&nbsp;that&nbsp;begins&nbsp;on&nbsp;one&nbsp;stack&nbsp;and&nbsp;ends</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756895">//&nbsp;on&nbsp;another&nbsp;stack.&nbsp;That&nbsp;could&nbsp;confuse&nbsp;callers&nbsp;quite&nbsp;a&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1756958">//&nbsp;Instead,&nbsp;we&nbsp;require&nbsp;that&nbsp;gentraceback&nbsp;and&nbsp;any&nbsp;other&nbsp;function&nbsp;that</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1757029">//&nbsp;accepts&nbsp;an&nbsp;sp&nbsp;for&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;(typically&nbsp;obtained&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1757097">//&nbsp;calling&nbsp;getcallersp)&nbsp;must&nbsp;not&nbsp;run&nbsp;on&nbsp;that&nbsp;goroutine&#39;s&nbsp;stack&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1757166">//&nbsp;instead&nbsp;on&nbsp;the&nbsp;g0&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757196">gothrow</span><span class="op" id="1757203">(</span><span class="string" id="1757204">&#34;gentraceback&nbsp;cannot&nbsp;trace&nbsp;user&nbsp;goroutine&nbsp;on&nbsp;its&nbsp;own&nbsp;stack&#34;</span><span class="op" id="1757263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1757266">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757269">gotraceback</span>&nbsp;<span class="op" id="1757281">:=</span>&nbsp;<span class="ident" id="1757284">gotraceback</span><span class="op" id="1757295">(</span><span class="ident" id="1757296">nil</span><span class="op" id="1757299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1757302">if</span>&nbsp;<span class="ident" id="1757305">pc0</span>&nbsp;<span class="op" id="1757309">==</span>&nbsp;<span class="op" id="1757312">^</span><span class="builtintype" id="1757313">uintptr</span><span class="op" id="1757320">(</span><span class="num" id="1757321">0</span><span class="op" id="1757322">)</span>&nbsp;<span class="op" id="1757324">&amp;&amp;</span>&nbsp;<span class="ident" id="1757327">sp0</span>&nbsp;<span class="op" id="1757331">==</span>&nbsp;<span class="op" id="1757334">^</span><span class="builtintype" id="1757335">uintptr</span><span class="op" id="1757342">(</span><span class="num" id="1757343">0</span><span class="op" id="1757344">)</span>&nbsp;<span class="op" id="1757346">{</span>&nbsp;<span class="comment" id="1757348">//&nbsp;Signal&nbsp;to&nbsp;fetch&nbsp;saved&nbsp;values&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1757391">if</span>&nbsp;<span class="ident" id="1757394">gp</span><span class="op" id="1757396">.</span><span class="ident" id="1757397">syscallsp</span>&nbsp;<span class="op" id="1757407">!=</span>&nbsp;<span class="num" id="1757410">0</span>&nbsp;<span class="op" id="1757412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757417">pc0</span>&nbsp;<span class="op" id="1757421">=</span>&nbsp;<span class="ident" id="1757423">gp</span><span class="op" id="1757425">.</span><span class="ident" id="1757426">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757439">sp0</span>&nbsp;<span class="op" id="1757443">=</span>&nbsp;<span class="ident" id="1757445">gp</span><span class="op" id="1757447">.</span><span class="ident" id="1757448">syscallsp</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1757461">if</span>&nbsp;<span class="ident" id="1757464">usesLR</span>&nbsp;<span class="op" id="1757471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757477">lr0</span>&nbsp;<span class="op" id="1757481">=</span>&nbsp;<span class="num" id="1757483">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1757488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1757492">}</span>&nbsp;<span class="keyword" id="1757494">else</span>&nbsp;<span class="op" id="1757499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757504">pc0</span>&nbsp;<span class="op" id="1757508">=</span>&nbsp;<span class="ident" id="1757510">gp</span><span class="op" id="1757512">.</span><span class="ident" id="1757513">sched</span><span class="op" id="1757518">.</span><span class="ident" id="1757519">pc</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757525">sp0</span>&nbsp;<span class="op" id="1757529">=</span>&nbsp;<span class="ident" id="1757531">gp</span><span class="op" id="1757533">.</span><span class="ident" id="1757534">sched</span><span class="op" id="1757539">.</span><span class="ident" id="1757540">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1757546">if</span>&nbsp;<span class="ident" id="1757549">usesLR</span>&nbsp;<span class="op" id="1757556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757562">lr0</span>&nbsp;<span class="op" id="1757566">=</span>&nbsp;<span class="ident" id="1757568">gp</span><span class="op" id="1757570">.</span><span class="ident" id="1757571">sched</span><span class="op" id="1757576">.</span><span class="ident" id="1757577">lr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1757583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1757587">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1757590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757594">nprint</span>&nbsp;<span class="op" id="1757601">:=</span>&nbsp;<span class="num" id="1757604">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1757607">var</span>&nbsp;<span class="ident" id="1757611">frame</span>&nbsp;<span class="ident" id="1757617">stkframe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757627">frame</span><span class="op" id="1757632">.</span><span class="ident" id="1757633">pc</span>&nbsp;<span class="op" id="1757636">=</span>&nbsp;<span class="ident" id="1757638">pc0</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757643">frame</span><span class="op" id="1757648">.</span><span class="ident" id="1757649">sp</span>&nbsp;<span class="op" id="1757652">=</span>&nbsp;<span class="ident" id="1757654">sp0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1757659">if</span>&nbsp;<span class="ident" id="1757662">usesLR</span>&nbsp;<span class="op" id="1757669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757673">frame</span><span class="op" id="1757678">.</span><span class="ident" id="1757679">lr</span>&nbsp;<span class="op" id="1757682">=</span>&nbsp;<span class="ident" id="1757684">lr0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1757689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757692">waspanic</span>&nbsp;<span class="op" id="1757701">:=</span>&nbsp;<span class="builtintype" id="1757704">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757711">wasnewproc</span>&nbsp;<span class="op" id="1757722">:=</span>&nbsp;<span class="builtintype" id="1757725">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757732">printing</span>&nbsp;<span class="op" id="1757741">:=</span>&nbsp;<span class="ident" id="1757744">pcbuf</span>&nbsp;<span class="op" id="1757750">==</span>&nbsp;<span class="ident" id="1757753">nil</span>&nbsp;<span class="op" id="1757757">&amp;&amp;</span>&nbsp;<span class="ident" id="1757760">callback</span>&nbsp;<span class="op" id="1757769">==</span>&nbsp;<span class="ident" id="1757772">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757777">_defer</span>&nbsp;<span class="op" id="1757784">:=</span>&nbsp;<span class="ident" id="1757787">gp</span><span class="op" id="1757789">.</span><span class="ident" id="1757790">_defer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1757799">for</span>&nbsp;<span class="ident" id="1757803">_defer</span>&nbsp;<span class="op" id="1757810">!=</span>&nbsp;<span class="ident" id="1757813">nil</span>&nbsp;<span class="op" id="1757817">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1757820">uintptr</span><span class="op" id="1757827">(</span><span class="ident" id="1757828">_defer</span><span class="op" id="1757834">.</span><span class="ident" id="1757835">argp</span><span class="op" id="1757839">)</span>&nbsp;<span class="op" id="1757841">==</span>&nbsp;<span class="ident" id="1757844">_NoArgs</span>&nbsp;<span class="op" id="1757852">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1757856">_defer</span>&nbsp;<span class="op" id="1757863">=</span>&nbsp;<span class="ident" id="1757865">_defer</span><span class="op" id="1757871">.</span><span class="ident" id="1757872">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1757878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1757882">//&nbsp;If&nbsp;the&nbsp;PC&nbsp;is&nbsp;zero,&nbsp;it&#39;s&nbsp;likely&nbsp;a&nbsp;nil&nbsp;function&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1757938">//&nbsp;Start&nbsp;in&nbsp;the&nbsp;caller&#39;s&nbsp;frame.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1757971">if</span>&nbsp;<span class="ident" id="1757974">frame</span><span class="op" id="1757979">.</span><span class="ident" id="1757980">pc</span>&nbsp;<span class="op" id="1757983">==</span>&nbsp;<span class="num" id="1757986">0</span>&nbsp;<span class="op" id="1757988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1757992">if</span>&nbsp;<span class="ident" id="1757995">usesLR</span>&nbsp;<span class="op" id="1758002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1758007">frame</span><span class="op" id="1758012">.</span><span class="ident" id="1758013">pc</span>&nbsp;<span class="op" id="1758016">=</span>&nbsp;<span class="op" id="1758018">*</span><span class="op" id="1758019">(</span><span class="op" id="1758020">*</span><span class="builtintype" id="1758021">uintptr</span><span class="op" id="1758028">)</span><span class="op" id="1758029">(</span><span class="ident" id="1758030">unsafe</span><span class="op" id="1758036">.</span><span class="ident" id="1758037">Pointer</span><span class="op" id="1758044">(</span><span class="ident" id="1758045">frame</span><span class="op" id="1758050">.</span><span class="ident" id="1758051">sp</span><span class="op" id="1758053">)</span><span class="op" id="1758054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1758059">frame</span><span class="op" id="1758064">.</span><span class="ident" id="1758065">lr</span>&nbsp;<span class="op" id="1758068">=</span>&nbsp;<span class="num" id="1758070">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1758074">}</span>&nbsp;<span class="keyword" id="1758076">else</span>&nbsp;<span class="op" id="1758081">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1758086">frame</span><span class="op" id="1758091">.</span><span class="ident" id="1758092">pc</span>&nbsp;<span class="op" id="1758095">=</span>&nbsp;<span class="builtintype" id="1758097">uintptr</span><span class="op" id="1758104">(</span><span class="op" id="1758105">*</span><span class="op" id="1758106">(</span><span class="op" id="1758107">*</span><span class="ident" id="1758108">uintreg</span><span class="op" id="1758115">)</span><span class="op" id="1758116">(</span><span class="ident" id="1758117">unsafe</span><span class="op" id="1758123">.</span><span class="ident" id="1758124">Pointer</span><span class="op" id="1758131">(</span><span class="ident" id="1758132">frame</span><span class="op" id="1758137">.</span><span class="ident" id="1758138">sp</span><span class="op" id="1758140">)</span><span class="op" id="1758141">)</span><span class="op" id="1758142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1758147">frame</span><span class="op" id="1758152">.</span><span class="ident" id="1758153">sp</span>&nbsp;<span class="op" id="1758156">+=</span>&nbsp;<span class="ident" id="1758159">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1758169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1758172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1758176">f</span>&nbsp;<span class="op" id="1758178">:=</span>&nbsp;<span class="ident" id="1758181">findfunc</span><span class="op" id="1758189">(</span><span class="ident" id="1758190">frame</span><span class="op" id="1758195">.</span><span class="ident" id="1758196">pc</span><span class="op" id="1758198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1758201">if</span>&nbsp;<span class="ident" id="1758204">f</span>&nbsp;<span class="op" id="1758206">==</span>&nbsp;<span class="ident" id="1758209">nil</span>&nbsp;<span class="op" id="1758213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1758217">if</span>&nbsp;<span class="ident" id="1758220">callback</span>&nbsp;<span class="op" id="1758229">!=</span>&nbsp;<span class="ident" id="1758232">nil</span>&nbsp;<span class="op" id="1758236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1758241">print</span><span class="op" id="1758246">(</span><span class="string" id="1758247">&#34;runtime:&nbsp;unknown&nbsp;pc&nbsp;&#34;</span><span class="op" id="1758269">,</span>&nbsp;<span class="ident" id="1758271">hex</span><span class="op" id="1758274">(</span><span class="ident" id="1758275">frame</span><span class="op" id="1758280">.</span><span class="ident" id="1758281">pc</span><span class="op" id="1758283">)</span><span class="op" id="1758284">,</span>&nbsp;<span class="string" id="1758286">&#34;\n&#34;</span><span class="op" id="1758290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1758295">gothrow</span><span class="op" id="1758302">(</span><span class="string" id="1758303">&#34;unknown&nbsp;pc&#34;</span><span class="op" id="1758315">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1758319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1758323">return</span>&nbsp;<span class="num" id="1758330">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1758333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1758336">frame</span><span class="op" id="1758341">.</span><span class="ident" id="1758342">fn</span>&nbsp;<span class="op" id="1758345">=</span>&nbsp;<span class="ident" id="1758347">f</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1758351">n</span>&nbsp;<span class="op" id="1758353">:=</span>&nbsp;<span class="num" id="1758356">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1758359">for</span>&nbsp;<span class="ident" id="1758363">n</span>&nbsp;<span class="op" id="1758365">&lt;</span>&nbsp;<span class="ident" id="1758367">max</span>&nbsp;<span class="op" id="1758371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758375">//&nbsp;Typically:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758391">//&nbsp;&nbsp;&nbsp;&nbsppc&nbsp;is&nbsp;the&nbsp;PC&nbsp;of&nbsp;the&nbsp;running&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758434">//&nbsp;&nbsp;&nbsp;&nbspsp&nbsp;is&nbsp;the&nbsp;stack&nbsp;pointer&nbsp;at&nbsp;that&nbsp;program&nbsp;counter.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758488">//&nbsp;&nbsp;&nbsp;&nbspfp&nbsp;is&nbsp;the&nbsp;frame&nbsp;pointer&nbsp;(caller&#39;s&nbsp;stack&nbsp;pointer)&nbsp;at&nbsp;that&nbsp;program&nbsp;counter,&nbsp;or&nbsp;nil&nbsp;if&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758586">//&nbsp;&nbsp;&nbsp;&nbspstk&nbsp;is&nbsp;the&nbsp;stack&nbsp;containing&nbsp;sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758623">//&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;caller&#39;s&nbsp;program&nbsp;counter&nbsp;is&nbsp;lr,&nbsp;unless&nbsp;lr&nbsp;is&nbsp;zero,&nbsp;in&nbsp;which&nbsp;case&nbsp;it&nbsp;is&nbsp;*(uintptr*)sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1758718">f</span>&nbsp;<span class="op" id="1758720">=</span>&nbsp;<span class="ident" id="1758722">frame</span><span class="op" id="1758727">.</span><span class="ident" id="1758728">fn</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758734">//&nbsp;Found&nbsp;an&nbsp;actual&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758765">//&nbsp;Derive&nbsp;frame&nbsp;pointer&nbsp;and&nbsp;link&nbsp;register.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1758810">if</span>&nbsp;<span class="ident" id="1758813">frame</span><span class="op" id="1758818">.</span><span class="ident" id="1758819">fp</span>&nbsp;<span class="op" id="1758822">==</span>&nbsp;<span class="num" id="1758825">0</span>&nbsp;<span class="op" id="1758827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1758832">frame</span><span class="op" id="1758837">.</span><span class="ident" id="1758838">fp</span>&nbsp;<span class="op" id="1758841">=</span>&nbsp;<span class="ident" id="1758843">frame</span><span class="op" id="1758848">.</span><span class="ident" id="1758849">sp</span>&nbsp;<span class="op" id="1758852">+</span>&nbsp;<span class="builtintype" id="1758854">uintptr</span><span class="op" id="1758861">(</span><span class="ident" id="1758862">funcspdelta</span><span class="op" id="1758873">(</span><span class="ident" id="1758874">f</span><span class="op" id="1758875">,</span>&nbsp;<span class="ident" id="1758877">frame</span><span class="op" id="1758882">.</span><span class="ident" id="1758883">pc</span><span class="op" id="1758885">)</span><span class="op" id="1758886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1758891">if</span>&nbsp;<span class="op" id="1758894">!</span><span class="ident" id="1758895">usesLR</span>&nbsp;<span class="op" id="1758902">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1758908">//&nbsp;On&nbsp;x86,&nbsp;call&nbsp;instruction&nbsp;pushes&nbsp;return&nbsp;PC&nbsp;before&nbsp;entering&nbsp;new&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1758987">frame</span><span class="op" id="1758992">.</span><span class="ident" id="1758993">fp</span>&nbsp;<span class="op" id="1758996">+=</span>&nbsp;<span class="ident" id="1758999">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1759010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1759014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1759018">var</span>&nbsp;<span class="ident" id="1759022">flr</span>&nbsp;<span class="op" id="1759026">*</span><span class="ident" id="1759027">_func</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1759035">if</span>&nbsp;<span class="ident" id="1759038">topofstack</span><span class="op" id="1759048">(</span><span class="ident" id="1759049">f</span><span class="op" id="1759050">)</span>&nbsp;<span class="op" id="1759052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1759057">frame</span><span class="op" id="1759062">.</span><span class="ident" id="1759063">lr</span>&nbsp;<span class="op" id="1759066">=</span>&nbsp;<span class="num" id="1759068">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1759073">flr</span>&nbsp;<span class="op" id="1759077">=</span>&nbsp;<span class="ident" id="1759079">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1759085">}</span>&nbsp;<span class="keyword" id="1759087">else</span>&nbsp;<span class="keyword" id="1759092">if</span>&nbsp;<span class="ident" id="1759095">usesLR</span>&nbsp;<span class="op" id="1759102">&amp;&amp;</span>&nbsp;<span class="ident" id="1759105">f</span><span class="op" id="1759106">.</span><span class="ident" id="1759107">entry</span>&nbsp;<span class="op" id="1759113">==</span>&nbsp;<span class="ident" id="1759116">jmpdeferPC</span>&nbsp;<span class="op" id="1759127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759132">//&nbsp;jmpdefer&nbsp;modifies&nbsp;SP/LR/PC&nbsp;non-atomically.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759181">//&nbsp;If&nbsp;a&nbsp;profiling&nbsp;interrupt&nbsp;arrives&nbsp;during&nbsp;jmpdefer,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759237">//&nbsp;the&nbsp;stack&nbsp;unwind&nbsp;may&nbsp;see&nbsp;a&nbsp;mismatched&nbsp;register&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759294">//&nbsp;and&nbsp;get&nbsp;confused.&nbsp;Stop&nbsp;if&nbsp;we&nbsp;see&nbsp;PC&nbsp;within&nbsp;jmpdefer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759352">//&nbsp;to&nbsp;avoid&nbsp;that&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759383">//&nbsp;See&nbsp;golang.org/issue/8153.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1759416">if</span>&nbsp;<span class="ident" id="1759419">callback</span>&nbsp;<span class="op" id="1759428">!=</span>&nbsp;<span class="ident" id="1759431">nil</span>&nbsp;<span class="op" id="1759435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1759441">gothrow</span><span class="op" id="1759448">(</span><span class="string" id="1759449">&#34;traceback_arm:&nbsp;found&nbsp;jmpdefer&nbsp;when&nbsp;tracing&nbsp;with&nbsp;callback&#34;</span><span class="op" id="1759507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1759512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1759517">frame</span><span class="op" id="1759522">.</span><span class="ident" id="1759523">lr</span>&nbsp;<span class="op" id="1759526">=</span>&nbsp;<span class="num" id="1759528">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1759532">}</span>&nbsp;<span class="keyword" id="1759534">else</span>&nbsp;<span class="op" id="1759539">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1759544">if</span>&nbsp;<span class="ident" id="1759547">usesLR</span>&nbsp;<span class="op" id="1759554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1759560">if</span>&nbsp;<span class="ident" id="1759563">n</span>&nbsp;<span class="op" id="1759565">==</span>&nbsp;<span class="num" id="1759568">0</span>&nbsp;<span class="op" id="1759570">&amp;&amp;</span>&nbsp;<span class="ident" id="1759573">frame</span><span class="op" id="1759578">.</span><span class="ident" id="1759579">sp</span>&nbsp;<span class="op" id="1759582">&lt;</span>&nbsp;<span class="ident" id="1759584">frame</span><span class="op" id="1759589">.</span><span class="ident" id="1759590">fp</span>&nbsp;<span class="op" id="1759593">||</span>&nbsp;<span class="ident" id="1759596">frame</span><span class="op" id="1759601">.</span><span class="ident" id="1759602">lr</span>&nbsp;<span class="op" id="1759605">==</span>&nbsp;<span class="num" id="1759608">0</span>&nbsp;<span class="op" id="1759610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1759617">frame</span><span class="op" id="1759622">.</span><span class="ident" id="1759623">lr</span>&nbsp;<span class="op" id="1759626">=</span>&nbsp;<span class="op" id="1759628">*</span><span class="op" id="1759629">(</span><span class="op" id="1759630">*</span><span class="builtintype" id="1759631">uintptr</span><span class="op" id="1759638">)</span><span class="op" id="1759639">(</span><span class="ident" id="1759640">unsafe</span><span class="op" id="1759646">.</span><span class="ident" id="1759647">Pointer</span><span class="op" id="1759654">(</span><span class="ident" id="1759655">frame</span><span class="op" id="1759660">.</span><span class="ident" id="1759661">sp</span><span class="op" id="1759663">)</span><span class="op" id="1759664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1759670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1759675">}</span>&nbsp;<span class="keyword" id="1759677">else</span>&nbsp;<span class="op" id="1759682">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1759688">if</span>&nbsp;<span class="ident" id="1759691">frame</span><span class="op" id="1759696">.</span><span class="ident" id="1759697">lr</span>&nbsp;<span class="op" id="1759700">==</span>&nbsp;<span class="num" id="1759703">0</span>&nbsp;<span class="op" id="1759705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1759712">frame</span><span class="op" id="1759717">.</span><span class="ident" id="1759718">lr</span>&nbsp;<span class="op" id="1759721">=</span>&nbsp;<span class="builtintype" id="1759723">uintptr</span><span class="op" id="1759730">(</span><span class="op" id="1759731">*</span><span class="op" id="1759732">(</span><span class="op" id="1759733">*</span><span class="ident" id="1759734">uintreg</span><span class="op" id="1759741">)</span><span class="op" id="1759742">(</span><span class="ident" id="1759743">unsafe</span><span class="op" id="1759749">.</span><span class="ident" id="1759750">Pointer</span><span class="op" id="1759757">(</span><span class="ident" id="1759758">frame</span><span class="op" id="1759763">.</span><span class="ident" id="1759764">fp</span>&nbsp;<span class="op" id="1759767">-</span>&nbsp;<span class="ident" id="1759769">regSize</span><span class="op" id="1759776">)</span><span class="op" id="1759777">)</span><span class="op" id="1759778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1759784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1759789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1759794">flr</span>&nbsp;<span class="op" id="1759798">=</span>&nbsp;<span class="ident" id="1759800">findfunc</span><span class="op" id="1759808">(</span><span class="ident" id="1759809">frame</span><span class="op" id="1759814">.</span><span class="ident" id="1759815">lr</span><span class="op" id="1759817">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1759822">if</span>&nbsp;<span class="ident" id="1759825">flr</span>&nbsp;<span class="op" id="1759829">==</span>&nbsp;<span class="ident" id="1759832">nil</span>&nbsp;<span class="op" id="1759836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759842">//&nbsp;This&nbsp;happens&nbsp;if&nbsp;you&nbsp;get&nbsp;a&nbsp;profiling&nbsp;interrupt&nbsp;at&nbsp;just&nbsp;the&nbsp;wrong&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759919">//&nbsp;In&nbsp;that&nbsp;context&nbsp;it&nbsp;is&nbsp;okay&nbsp;to&nbsp;stop&nbsp;early.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1759968">//&nbsp;But&nbsp;if&nbsp;callback&nbsp;is&nbsp;set,&nbsp;we&#39;re&nbsp;doing&nbsp;a&nbsp;garbage&nbsp;collection&nbsp;and&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1760041">//&nbsp;get&nbsp;everything,&nbsp;so&nbsp;crash&nbsp;loudly.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1760081">if</span>&nbsp;<span class="ident" id="1760084">callback</span>&nbsp;<span class="op" id="1760093">!=</span>&nbsp;<span class="ident" id="1760096">nil</span>&nbsp;<span class="op" id="1760100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1760107">print</span><span class="op" id="1760112">(</span><span class="string" id="1760113">&#34;runtime:&nbsp;unexpected&nbsp;return&nbsp;pc&nbsp;for&nbsp;&#34;</span><span class="op" id="1760149">,</span>&nbsp;<span class="ident" id="1760151">gofuncname</span><span class="op" id="1760161">(</span><span class="ident" id="1760162">f</span><span class="op" id="1760163">)</span><span class="op" id="1760164">,</span>&nbsp;<span class="string" id="1760166">&#34;&nbsp;called&nbsp;from&nbsp;&#34;</span><span class="op" id="1760181">,</span>&nbsp;<span class="ident" id="1760183">hex</span><span class="op" id="1760186">(</span><span class="ident" id="1760187">frame</span><span class="op" id="1760192">.</span><span class="ident" id="1760193">lr</span><span class="op" id="1760195">)</span><span class="op" id="1760196">,</span>&nbsp;<span class="string" id="1760198">&#34;\n&#34;</span><span class="op" id="1760202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1760209">gothrow</span><span class="op" id="1760216">(</span><span class="string" id="1760217">&#34;unknown&nbsp;caller&nbsp;pc&#34;</span><span class="op" id="1760236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1760242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1760247">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1760251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1760256">frame</span><span class="op" id="1760261">.</span><span class="ident" id="1760262">varp</span>&nbsp;<span class="op" id="1760267">=</span>&nbsp;<span class="ident" id="1760269">frame</span><span class="op" id="1760274">.</span><span class="ident" id="1760275">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1760280">if</span>&nbsp;<span class="op" id="1760283">!</span><span class="ident" id="1760284">usesLR</span>&nbsp;<span class="op" id="1760291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1760296">//&nbsp;On&nbsp;x86,&nbsp;call&nbsp;instruction&nbsp;pushes&nbsp;return&nbsp;PC&nbsp;before&nbsp;entering&nbsp;new&nbsp;function.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1760374">frame</span><span class="op" id="1760379">.</span><span class="ident" id="1760380">varp</span>&nbsp;<span class="op" id="1760385">-=</span>&nbsp;<span class="ident" id="1760388">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1760398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1760403">//&nbsp;Derive&nbsp;size&nbsp;of&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1760434">//&nbsp;Most&nbsp;functions&nbsp;have&nbsp;a&nbsp;fixed-size&nbsp;argument&nbsp;block,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1760488">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;metadata&nbsp;about&nbsp;the&nbsp;function&nbsp;f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1760538">//&nbsp;Not&nbsp;all,&nbsp;though:&nbsp;there&nbsp;are&nbsp;some&nbsp;variadic&nbsp;functions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1760594">//&nbsp;in&nbsp;package&nbsp;runtime&nbsp;and&nbsp;reflect,&nbsp;and&nbsp;for&nbsp;those&nbsp;we&nbsp;use&nbsp;call-specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1760666">//&nbsp;metadata&nbsp;recorded&nbsp;by&nbsp;f&#39;s&nbsp;caller.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1760704">if</span>&nbsp;<span class="ident" id="1760707">callback</span>&nbsp;<span class="op" id="1760716">!=</span>&nbsp;<span class="ident" id="1760719">nil</span>&nbsp;<span class="op" id="1760723">||</span>&nbsp;<span class="ident" id="1760726">printing</span>&nbsp;<span class="op" id="1760735">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1760740">frame</span><span class="op" id="1760745">.</span><span class="ident" id="1760746">argp</span>&nbsp;<span class="op" id="1760751">=</span>&nbsp;<span class="ident" id="1760753">frame</span><span class="op" id="1760758">.</span><span class="ident" id="1760759">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1760765">if</span>&nbsp;<span class="ident" id="1760768">usesLR</span>&nbsp;<span class="op" id="1760775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1760781">frame</span><span class="op" id="1760786">.</span><span class="ident" id="1760787">argp</span>&nbsp;<span class="op" id="1760792">+=</span>&nbsp;<span class="ident" id="1760795">ptrSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1760806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1760811">setArgInfo</span><span class="op" id="1760821">(</span><span class="op" id="1760822">&amp;</span><span class="ident" id="1760823">frame</span><span class="op" id="1760828">,</span>&nbsp;<span class="ident" id="1760830">f</span><span class="op" id="1760831">,</span>&nbsp;<span class="ident" id="1760833">callback</span>&nbsp;<span class="op" id="1760842">!=</span>&nbsp;<span class="ident" id="1760845">nil</span><span class="op" id="1760848">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1760852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1760857">//&nbsp;Determine&nbsp;function&nbsp;SP&nbsp;where&nbsp;deferproc&nbsp;would&nbsp;find&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1760926">var</span>&nbsp;<span class="ident" id="1760930">sparg</span>&nbsp;<span class="builtintype" id="1760936">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1760946">if</span>&nbsp;<span class="ident" id="1760949">usesLR</span>&nbsp;<span class="op" id="1760956">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1760961">//&nbsp;On&nbsp;link&nbsp;register&nbsp;architectures,&nbsp;that&#39;s&nbsp;the&nbsp;standard&nbsp;bottom-of-stack&nbsp;plus&nbsp;1&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761047">//&nbsp;for&nbsp;the&nbsp;saved&nbsp;LR.&nbsp;If&nbsp;the&nbsp;previous&nbsp;frame&nbsp;was&nbsp;a&nbsp;direct&nbsp;call&nbsp;to&nbsp;newproc/deferproc,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761133">//&nbsp;however,&nbsp;the&nbsp;SP&nbsp;is&nbsp;three&nbsp;words&nbsp;lower&nbsp;than&nbsp;normal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761189">//&nbsp;If&nbsp;the&nbsp;function&nbsp;has&nbsp;no&nbsp;frame&nbsp;at&nbsp;all&nbsp;-&nbsp;perhaps&nbsp;it&nbsp;just&nbsp;started,&nbsp;or&nbsp;perhaps</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761269">//&nbsp;it&nbsp;is&nbsp;a&nbsp;leaf&nbsp;with&nbsp;no&nbsp;local&nbsp;variables&nbsp;-&nbsp;then&nbsp;we&nbsp;cannot&nbsp;possibly&nbsp;find&nbsp;its</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761347">//&nbsp;SP&nbsp;in&nbsp;a&nbsp;defer,&nbsp;and&nbsp;we&nbsp;might&nbsp;confuse&nbsp;its&nbsp;SP&nbsp;for&nbsp;its&nbsp;caller&#39;s&nbsp;SP,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761420">//&nbsp;leave&nbsp;sparg=0&nbsp;in&nbsp;that&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1761454">if</span>&nbsp;<span class="ident" id="1761457">frame</span><span class="op" id="1761462">.</span><span class="ident" id="1761463">fp</span>&nbsp;<span class="op" id="1761466">!=</span>&nbsp;<span class="ident" id="1761469">frame</span><span class="op" id="1761474">.</span><span class="ident" id="1761475">sp</span>&nbsp;<span class="op" id="1761478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761484">sparg</span>&nbsp;<span class="op" id="1761490">=</span>&nbsp;<span class="ident" id="1761492">frame</span><span class="op" id="1761497">.</span><span class="ident" id="1761498">sp</span>&nbsp;<span class="op" id="1761501">+</span>&nbsp;<span class="ident" id="1761503">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1761515">if</span>&nbsp;<span class="ident" id="1761518">wasnewproc</span>&nbsp;<span class="op" id="1761529">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761536">sparg</span>&nbsp;<span class="op" id="1761542">+=</span>&nbsp;<span class="num" id="1761545">3</span>&nbsp;<span class="op" id="1761547">*</span>&nbsp;<span class="ident" id="1761549">regSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1761561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1761566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1761570">}</span>&nbsp;<span class="keyword" id="1761572">else</span>&nbsp;<span class="op" id="1761577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761582">//&nbsp;On&nbsp;x86&nbsp;that&#39;s&nbsp;the&nbsp;standard&nbsp;bottom-of-stack,&nbsp;so&nbsp;SP&nbsp;exactly.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761647">//&nbsp;If&nbsp;the&nbsp;previous&nbsp;frame&nbsp;was&nbsp;a&nbsp;direct&nbsp;call&nbsp;to&nbsp;newproc/deferproc,&nbsp;however,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761724">//&nbsp;the&nbsp;SP&nbsp;is&nbsp;two&nbsp;words&nbsp;lower&nbsp;than&nbsp;normal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761769">sparg</span>&nbsp;<span class="op" id="1761775">=</span>&nbsp;<span class="ident" id="1761777">frame</span><span class="op" id="1761782">.</span><span class="ident" id="1761783">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1761789">if</span>&nbsp;<span class="ident" id="1761792">wasnewproc</span>&nbsp;<span class="op" id="1761803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1761809">sparg</span>&nbsp;<span class="op" id="1761815">+=</span>&nbsp;<span class="num" id="1761818">2</span>&nbsp;<span class="op" id="1761820">*</span>&nbsp;<span class="ident" id="1761822">ptrSize</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1761833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1761837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761842">//&nbsp;Determine&nbsp;frame&#39;s&nbsp;&#39;continuation&nbsp;PC&#39;,&nbsp;where&nbsp;it&nbsp;can&nbsp;continue.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761907">//&nbsp;Normally&nbsp;this&nbsp;is&nbsp;the&nbsp;return&nbsp;address&nbsp;on&nbsp;the&nbsp;stack,&nbsp;but&nbsp;if&nbsp;sigpanic</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1761978">//&nbsp;is&nbsp;immediately&nbsp;below&nbsp;this&nbsp;function&nbsp;on&nbsp;the&nbsp;stack,&nbsp;then&nbsp;the&nbsp;frame</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762047">//&nbsp;stopped&nbsp;executing&nbsp;due&nbsp;to&nbsp;a&nbsp;trap,&nbsp;and&nbsp;frame.pc&nbsp;is&nbsp;probably&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762114">//&nbsp;a&nbsp;safe&nbsp;point&nbsp;for&nbsp;looking&nbsp;up&nbsp;liveness&nbsp;information.&nbsp;In&nbsp;this&nbsp;panicking&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762193">//&nbsp;the&nbsp;function&nbsp;either&nbsp;doesn&#39;t&nbsp;return&nbsp;at&nbsp;all&nbsp;(if&nbsp;it&nbsp;has&nbsp;no&nbsp;defers&nbsp;or&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762271">//&nbsp;defers&nbsp;do&nbsp;not&nbsp;recover)&nbsp;or&nbsp;it&nbsp;returns&nbsp;from&nbsp;one&nbsp;of&nbsp;the&nbsp;calls&nbsp;to</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762338">//&nbsp;deferproc&nbsp;a&nbsp;second&nbsp;time&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;deferred&nbsp;func&nbsp;recovers).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762414">//&nbsp;It&nbsp;suffices&nbsp;to&nbsp;assume&nbsp;that&nbsp;the&nbsp;most&nbsp;recent&nbsp;deferproc&nbsp;is&nbsp;the&nbsp;one&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762488">//&nbsp;returns;&nbsp;everything&nbsp;live&nbsp;at&nbsp;earlier&nbsp;deferprocs&nbsp;is&nbsp;still&nbsp;live&nbsp;at&nbsp;that&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762567">frame</span><span class="op" id="1762572">.</span><span class="ident" id="1762573">continpc</span>&nbsp;<span class="op" id="1762582">=</span>&nbsp;<span class="ident" id="1762584">frame</span><span class="op" id="1762589">.</span><span class="ident" id="1762590">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762595">if</span>&nbsp;<span class="ident" id="1762598">waspanic</span>&nbsp;<span class="op" id="1762607">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762612">if</span>&nbsp;<span class="ident" id="1762615">_defer</span>&nbsp;<span class="op" id="1762622">!=</span>&nbsp;<span class="ident" id="1762625">nil</span>&nbsp;<span class="op" id="1762629">&amp;&amp;</span>&nbsp;<span class="ident" id="1762632">_defer</span><span class="op" id="1762638">.</span><span class="ident" id="1762639">argp</span>&nbsp;<span class="op" id="1762644">==</span>&nbsp;<span class="ident" id="1762647">sparg</span>&nbsp;<span class="op" id="1762653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762659">frame</span><span class="op" id="1762664">.</span><span class="ident" id="1762665">continpc</span>&nbsp;<span class="op" id="1762674">=</span>&nbsp;<span class="ident" id="1762676">_defer</span><span class="op" id="1762682">.</span><span class="ident" id="1762683">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762689">}</span>&nbsp;<span class="keyword" id="1762691">else</span>&nbsp;<span class="op" id="1762696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762702">frame</span><span class="op" id="1762707">.</span><span class="ident" id="1762708">continpc</span>&nbsp;<span class="op" id="1762717">=</span>&nbsp;<span class="num" id="1762719">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762724">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1762733">//&nbsp;Unwind&nbsp;our&nbsp;local&nbsp;defer&nbsp;stack&nbsp;past&nbsp;this&nbsp;frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762784">for</span>&nbsp;<span class="ident" id="1762788">_defer</span>&nbsp;<span class="op" id="1762795">!=</span>&nbsp;<span class="ident" id="1762798">nil</span>&nbsp;<span class="op" id="1762802">&amp;&amp;</span>&nbsp;<span class="op" id="1762805">(</span><span class="ident" id="1762806">_defer</span><span class="op" id="1762812">.</span><span class="ident" id="1762813">argp</span>&nbsp;<span class="op" id="1762818">==</span>&nbsp;<span class="ident" id="1762821">sparg</span>&nbsp;<span class="op" id="1762827">||</span>&nbsp;<span class="ident" id="1762830">_defer</span><span class="op" id="1762836">.</span><span class="ident" id="1762837">argp</span>&nbsp;<span class="op" id="1762842">==</span>&nbsp;<span class="ident" id="1762845">_NoArgs</span><span class="op" id="1762852">)</span>&nbsp;<span class="op" id="1762854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762859">_defer</span>&nbsp;<span class="op" id="1762866">=</span>&nbsp;<span class="ident" id="1762868">_defer</span><span class="op" id="1762874">.</span><span class="ident" id="1762875">link</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762887">if</span>&nbsp;<span class="ident" id="1762890">skip</span>&nbsp;<span class="op" id="1762895">&gt;</span>&nbsp;<span class="num" id="1762897">0</span>&nbsp;<span class="op" id="1762899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1762904">skip</span><span class="op" id="1762908">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762914">goto</span>&nbsp;<span class="ident" id="1762919">skipped</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1762934">if</span>&nbsp;<span class="ident" id="1762937">pcbuf</span>&nbsp;<span class="op" id="1762943">!=</span>&nbsp;<span class="ident" id="1762946">nil</span>&nbsp;<span class="op" id="1762950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1762955">(</span><span class="op" id="1762956">*</span><span class="op" id="1762957">[</span><span class="num" id="1762958">1</span>&nbsp;<span class="op" id="1762960">&lt;&lt;</span>&nbsp;<span class="num" id="1762963">20</span><span class="op" id="1762965">]</span><span class="builtintype" id="1762966">uintptr</span><span class="op" id="1762973">)</span><span class="op" id="1762974">(</span><span class="ident" id="1762975">unsafe</span><span class="op" id="1762981">.</span><span class="ident" id="1762982">Pointer</span><span class="op" id="1762989">(</span><span class="ident" id="1762990">pcbuf</span><span class="op" id="1762995">)</span><span class="op" id="1762996">)</span><span class="op" id="1762997">[</span><span class="ident" id="1762998">n</span><span class="op" id="1762999">]</span>&nbsp;<span class="op" id="1763001">=</span>&nbsp;<span class="ident" id="1763003">frame</span><span class="op" id="1763008">.</span><span class="ident" id="1763009">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763014">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763018">if</span>&nbsp;<span class="ident" id="1763021">callback</span>&nbsp;<span class="op" id="1763030">!=</span>&nbsp;<span class="ident" id="1763033">nil</span>&nbsp;<span class="op" id="1763037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763042">if</span>&nbsp;<span class="op" id="1763045">!</span><span class="ident" id="1763046">callback</span><span class="op" id="1763054">(</span><span class="op" id="1763055">(</span><span class="op" id="1763056">*</span><span class="ident" id="1763057">stkframe</span><span class="op" id="1763065">)</span><span class="op" id="1763066">(</span><span class="ident" id="1763067">noescape</span><span class="op" id="1763075">(</span><span class="ident" id="1763076">unsafe</span><span class="op" id="1763082">.</span><span class="ident" id="1763083">Pointer</span><span class="op" id="1763090">(</span><span class="op" id="1763091">&amp;</span><span class="ident" id="1763092">frame</span><span class="op" id="1763097">)</span><span class="op" id="1763098">)</span><span class="op" id="1763099">)</span><span class="op" id="1763100">,</span>&nbsp;<span class="ident" id="1763102">v</span><span class="op" id="1763103">)</span>&nbsp;<span class="op" id="1763105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763111">return</span>&nbsp;<span class="ident" id="1763118">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763127">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763131">if</span>&nbsp;<span class="ident" id="1763134">printing</span>&nbsp;<span class="op" id="1763143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763148">if</span>&nbsp;<span class="op" id="1763151">(</span><span class="ident" id="1763152">flags</span><span class="op" id="1763157">&amp;</span><span class="ident" id="1763158">_TraceRuntimeFrames</span><span class="op" id="1763177">)</span>&nbsp;<span class="op" id="1763179">!=</span>&nbsp;<span class="num" id="1763182">0</span>&nbsp;<span class="op" id="1763184">||</span>&nbsp;<span class="ident" id="1763187">showframe</span><span class="op" id="1763196">(</span><span class="ident" id="1763197">f</span><span class="op" id="1763198">,</span>&nbsp;<span class="ident" id="1763200">gp</span><span class="op" id="1763202">)</span>&nbsp;<span class="op" id="1763204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763210">//&nbsp;Print&nbsp;during&nbsp;crash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763237">//&nbsp;&nbsp;&nbsp;&nbspmain(0x1,&nbsp;0x2,&nbsp;0x3)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763264">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/home/rsc/go/src/runtime/x.go:23&nbsp;+0xf</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1763310">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1763317">tracepc</span>&nbsp;<span class="op" id="1763325">:=</span>&nbsp;<span class="ident" id="1763328">frame</span><span class="op" id="1763333">.</span><span class="ident" id="1763334">pc</span>&nbsp;<span class="comment" id="1763337">//&nbsp;back&nbsp;up&nbsp;to&nbsp;CALL&nbsp;instruction&nbsp;for&nbsp;funcline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763386">if</span>&nbsp;<span class="op" id="1763389">(</span><span class="ident" id="1763390">n</span>&nbsp;<span class="op" id="1763392">&gt;</span>&nbsp;<span class="num" id="1763394">0</span>&nbsp;<span class="op" id="1763396">||</span>&nbsp;<span class="ident" id="1763399">flags</span><span class="op" id="1763404">&amp;</span><span class="ident" id="1763405">_TraceTrap</span>&nbsp;<span class="op" id="1763416">==</span>&nbsp;<span class="num" id="1763419">0</span><span class="op" id="1763420">)</span>&nbsp;<span class="op" id="1763422">&amp;&amp;</span>&nbsp;<span class="ident" id="1763425">frame</span><span class="op" id="1763430">.</span><span class="ident" id="1763431">pc</span>&nbsp;<span class="op" id="1763434">&gt;</span>&nbsp;<span class="ident" id="1763436">f</span><span class="op" id="1763437">.</span><span class="ident" id="1763438">entry</span>&nbsp;<span class="op" id="1763444">&amp;&amp;</span>&nbsp;<span class="op" id="1763447">!</span><span class="ident" id="1763448">waspanic</span>&nbsp;<span class="op" id="1763457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1763464">tracepc</span><span class="op" id="1763471">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763478">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1763484">print</span><span class="op" id="1763489">(</span><span class="ident" id="1763490">gofuncname</span><span class="op" id="1763500">(</span><span class="ident" id="1763501">f</span><span class="op" id="1763502">)</span><span class="op" id="1763503">,</span>&nbsp;<span class="string" id="1763505">&#34;(&#34;</span><span class="op" id="1763508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1763514">argp</span>&nbsp;<span class="op" id="1763519">:=</span>&nbsp;<span class="op" id="1763522">(</span><span class="op" id="1763523">*</span><span class="op" id="1763524">[</span><span class="num" id="1763525">100</span><span class="op" id="1763528">]</span><span class="builtintype" id="1763529">uintptr</span><span class="op" id="1763536">)</span><span class="op" id="1763537">(</span><span class="ident" id="1763538">unsafe</span><span class="op" id="1763544">.</span><span class="ident" id="1763545">Pointer</span><span class="op" id="1763552">(</span><span class="ident" id="1763553">frame</span><span class="op" id="1763558">.</span><span class="ident" id="1763559">argp</span><span class="op" id="1763563">)</span><span class="op" id="1763564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763570">for</span>&nbsp;<span class="ident" id="1763574">i</span>&nbsp;<span class="op" id="1763576">:=</span>&nbsp;<span class="builtintype" id="1763579">uintptr</span><span class="op" id="1763586">(</span><span class="num" id="1763587">0</span><span class="op" id="1763588">)</span><span class="op" id="1763589">;</span>&nbsp;<span class="ident" id="1763591">i</span>&nbsp;<span class="op" id="1763593">&lt;</span>&nbsp;<span class="ident" id="1763595">frame</span><span class="op" id="1763600">.</span><span class="ident" id="1763601">arglen</span><span class="op" id="1763607">/</span><span class="ident" id="1763608">ptrSize</span><span class="op" id="1763615">;</span>&nbsp;<span class="ident" id="1763617">i</span><span class="op" id="1763618">++</span>&nbsp;<span class="op" id="1763621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763628">if</span>&nbsp;<span class="ident" id="1763631">i</span>&nbsp;<span class="op" id="1763633">&gt;=</span>&nbsp;<span class="num" id="1763636">10</span>&nbsp;<span class="op" id="1763639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1763647">print</span><span class="op" id="1763652">(</span><span class="string" id="1763653">&#34;,&nbsp;...&#34;</span><span class="op" id="1763660">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763668">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763686">if</span>&nbsp;<span class="ident" id="1763689">i</span>&nbsp;<span class="op" id="1763691">!=</span>&nbsp;<span class="num" id="1763694">0</span>&nbsp;<span class="op" id="1763696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1763704">print</span><span class="op" id="1763709">(</span><span class="string" id="1763710">&#34;,&nbsp;&#34;</span><span class="op" id="1763714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763721">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1763728">print</span><span class="op" id="1763733">(</span><span class="ident" id="1763734">hex</span><span class="op" id="1763737">(</span><span class="ident" id="1763738">argp</span><span class="op" id="1763742">[</span><span class="ident" id="1763743">i</span><span class="op" id="1763744">]</span><span class="op" id="1763745">)</span><span class="op" id="1763746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1763758">print</span><span class="op" id="1763763">(</span><span class="string" id="1763764">&#34;)\n&#34;</span><span class="op" id="1763769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763775">var</span>&nbsp;<span class="ident" id="1763779">file</span>&nbsp;<span class="builtintype" id="1763784">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1763795">line</span>&nbsp;<span class="op" id="1763800">:=</span>&nbsp;<span class="ident" id="1763803">funcline</span><span class="op" id="1763811">(</span><span class="ident" id="1763812">f</span><span class="op" id="1763813">,</span>&nbsp;<span class="ident" id="1763815">tracepc</span><span class="op" id="1763822">,</span>&nbsp;<span class="op" id="1763824">&amp;</span><span class="ident" id="1763825">file</span><span class="op" id="1763829">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1763835">print</span><span class="op" id="1763840">(</span><span class="string" id="1763841">&#34;\t&#34;</span><span class="op" id="1763845">,</span>&nbsp;<span class="ident" id="1763847">file</span><span class="op" id="1763851">,</span>&nbsp;<span class="string" id="1763853">&#34;:&#34;</span><span class="op" id="1763856">,</span>&nbsp;<span class="ident" id="1763858">line</span><span class="op" id="1763862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763868">if</span>&nbsp;<span class="ident" id="1763871">frame</span><span class="op" id="1763876">.</span><span class="ident" id="1763877">pc</span>&nbsp;<span class="op" id="1763880">&gt;</span>&nbsp;<span class="ident" id="1763882">f</span><span class="op" id="1763883">.</span><span class="ident" id="1763884">entry</span>&nbsp;<span class="op" id="1763890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1763897">print</span><span class="op" id="1763902">(</span><span class="string" id="1763903">&#34;&nbsp;+&#34;</span><span class="op" id="1763907">,</span>&nbsp;<span class="ident" id="1763909">hex</span><span class="op" id="1763912">(</span><span class="ident" id="1763913">frame</span><span class="op" id="1763918">.</span><span class="ident" id="1763919">pc</span><span class="op" id="1763921">-</span><span class="ident" id="1763922">f</span><span class="op" id="1763923">.</span><span class="ident" id="1763924">entry</span><span class="op" id="1763929">)</span><span class="op" id="1763930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1763936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1763942">if</span>&nbsp;<span class="ident" id="1763945">g</span><span class="op" id="1763946">.</span><span class="ident" id="1763947">m</span><span class="op" id="1763948">.</span><span class="ident" id="1763949">throwing</span>&nbsp;<span class="op" id="1763958">&gt;</span>&nbsp;<span class="num" id="1763960">0</span>&nbsp;<span class="op" id="1763962">&amp;&amp;</span>&nbsp;<span class="ident" id="1763965">gp</span>&nbsp;<span class="op" id="1763968">==</span>&nbsp;<span class="ident" id="1763971">g</span><span class="op" id="1763972">.</span><span class="ident" id="1763973">m</span><span class="op" id="1763974">.</span><span class="ident" id="1763975">curg</span>&nbsp;<span class="op" id="1763980">||</span>&nbsp;<span class="ident" id="1763983">gotraceback</span>&nbsp;<span class="op" id="1763995">&gt;=</span>&nbsp;<span class="num" id="1763998">2</span>&nbsp;<span class="op" id="1764000">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1764007">print</span><span class="op" id="1764012">(</span><span class="string" id="1764013">&#34;&nbsp;fp=&#34;</span><span class="op" id="1764019">,</span>&nbsp;<span class="ident" id="1764021">hex</span><span class="op" id="1764024">(</span><span class="ident" id="1764025">frame</span><span class="op" id="1764030">.</span><span class="ident" id="1764031">fp</span><span class="op" id="1764033">)</span><span class="op" id="1764034">,</span>&nbsp;<span class="string" id="1764036">&#34;&nbsp;sp=&#34;</span><span class="op" id="1764042">,</span>&nbsp;<span class="ident" id="1764044">hex</span><span class="op" id="1764047">(</span><span class="ident" id="1764048">frame</span><span class="op" id="1764053">.</span><span class="ident" id="1764054">sp</span><span class="op" id="1764056">)</span><span class="op" id="1764057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1764069">print</span><span class="op" id="1764074">(</span><span class="string" id="1764075">&#34;\n&#34;</span><span class="op" id="1764079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764085">nprint</span><span class="op" id="1764091">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764097">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764105">n</span><span class="op" id="1764106">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764111">skipped</span><span class="op" id="1764118">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764122">waspanic</span>&nbsp;<span class="op" id="1764131">=</span>&nbsp;<span class="ident" id="1764133">f</span><span class="op" id="1764134">.</span><span class="ident" id="1764135">entry</span>&nbsp;<span class="op" id="1764141">==</span>&nbsp;<span class="ident" id="1764144">sigpanicPC</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764157">wasnewproc</span>&nbsp;<span class="op" id="1764168">=</span>&nbsp;<span class="ident" id="1764170">f</span><span class="op" id="1764171">.</span><span class="ident" id="1764172">entry</span>&nbsp;<span class="op" id="1764178">==</span>&nbsp;<span class="ident" id="1764181">newprocPC</span>&nbsp;<span class="op" id="1764191">||</span>&nbsp;<span class="ident" id="1764194">f</span><span class="op" id="1764195">.</span><span class="ident" id="1764196">entry</span>&nbsp;<span class="op" id="1764202">==</span>&nbsp;<span class="ident" id="1764205">deferprocPC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764220">//&nbsp;Do&nbsp;not&nbsp;unwind&nbsp;past&nbsp;the&nbsp;bottom&nbsp;of&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764269">if</span>&nbsp;<span class="ident" id="1764272">flr</span>&nbsp;<span class="op" id="1764276">==</span>&nbsp;<span class="ident" id="1764279">nil</span>&nbsp;<span class="op" id="1764283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764288">break</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764301">//&nbsp;Unwind&nbsp;to&nbsp;next&nbsp;frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764328">frame</span><span class="op" id="1764333">.</span><span class="ident" id="1764334">fn</span>&nbsp;<span class="op" id="1764337">=</span>&nbsp;<span class="ident" id="1764339">flr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764345">frame</span><span class="op" id="1764350">.</span><span class="ident" id="1764351">pc</span>&nbsp;<span class="op" id="1764354">=</span>&nbsp;<span class="ident" id="1764356">frame</span><span class="op" id="1764361">.</span><span class="ident" id="1764362">lr</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764367">frame</span><span class="op" id="1764372">.</span><span class="ident" id="1764373">lr</span>&nbsp;<span class="op" id="1764376">=</span>&nbsp;<span class="num" id="1764378">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764382">frame</span><span class="op" id="1764387">.</span><span class="ident" id="1764388">sp</span>&nbsp;<span class="op" id="1764391">=</span>&nbsp;<span class="ident" id="1764393">frame</span><span class="op" id="1764398">.</span><span class="ident" id="1764399">fp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764404">frame</span><span class="op" id="1764409">.</span><span class="ident" id="1764410">fp</span>&nbsp;<span class="op" id="1764413">=</span>&nbsp;<span class="num" id="1764415">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764419">frame</span><span class="op" id="1764424">.</span><span class="ident" id="1764425">argmap</span>&nbsp;<span class="op" id="1764432">=</span>&nbsp;<span class="ident" id="1764434">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764441">//&nbsp;On&nbsp;link&nbsp;register&nbsp;architectures,&nbsp;sighandler&nbsp;saves&nbsp;the&nbsp;LR&nbsp;on&nbsp;stack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764511">//&nbsp;before&nbsp;faking&nbsp;a&nbsp;call&nbsp;to&nbsp;sigpanic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764550">if</span>&nbsp;<span class="ident" id="1764553">usesLR</span>&nbsp;<span class="op" id="1764560">&amp;&amp;</span>&nbsp;<span class="ident" id="1764563">waspanic</span>&nbsp;<span class="op" id="1764572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764577">x</span>&nbsp;<span class="op" id="1764579">:=</span>&nbsp;<span class="op" id="1764582">*</span><span class="op" id="1764583">(</span><span class="op" id="1764584">*</span><span class="builtintype" id="1764585">uintptr</span><span class="op" id="1764592">)</span><span class="op" id="1764593">(</span><span class="ident" id="1764594">unsafe</span><span class="op" id="1764600">.</span><span class="ident" id="1764601">Pointer</span><span class="op" id="1764608">(</span><span class="ident" id="1764609">frame</span><span class="op" id="1764614">.</span><span class="ident" id="1764615">sp</span><span class="op" id="1764617">)</span><span class="op" id="1764618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764623">frame</span><span class="op" id="1764628">.</span><span class="ident" id="1764629">sp</span>&nbsp;<span class="op" id="1764632">+=</span>&nbsp;<span class="ident" id="1764635">ptrSize</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764646">f</span>&nbsp;<span class="op" id="1764648">=</span>&nbsp;<span class="ident" id="1764650">findfunc</span><span class="op" id="1764658">(</span><span class="ident" id="1764659">frame</span><span class="op" id="1764664">.</span><span class="ident" id="1764665">pc</span><span class="op" id="1764667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764672">frame</span><span class="op" id="1764677">.</span><span class="ident" id="1764678">fn</span>&nbsp;<span class="op" id="1764681">=</span>&nbsp;<span class="ident" id="1764683">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764688">if</span>&nbsp;<span class="ident" id="1764691">f</span>&nbsp;<span class="op" id="1764693">==</span>&nbsp;<span class="ident" id="1764696">nil</span>&nbsp;<span class="op" id="1764700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764706">frame</span><span class="op" id="1764711">.</span><span class="ident" id="1764712">pc</span>&nbsp;<span class="op" id="1764715">=</span>&nbsp;<span class="ident" id="1764717">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764722">}</span>&nbsp;<span class="keyword" id="1764724">else</span>&nbsp;<span class="keyword" id="1764729">if</span>&nbsp;<span class="ident" id="1764732">f</span><span class="op" id="1764733">.</span><span class="ident" id="1764734">frame</span>&nbsp;<span class="op" id="1764740">==</span>&nbsp;<span class="num" id="1764743">0</span>&nbsp;<span class="op" id="1764745">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764751">frame</span><span class="op" id="1764756">.</span><span class="ident" id="1764757">lr</span>&nbsp;<span class="op" id="1764760">=</span>&nbsp;<span class="ident" id="1764762">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1764778">if</span>&nbsp;<span class="ident" id="1764781">pcbuf</span>&nbsp;<span class="op" id="1764787">==</span>&nbsp;<span class="ident" id="1764790">nil</span>&nbsp;<span class="op" id="1764794">&amp;&amp;</span>&nbsp;<span class="ident" id="1764797">callback</span>&nbsp;<span class="op" id="1764806">==</span>&nbsp;<span class="ident" id="1764809">nil</span>&nbsp;<span class="op" id="1764813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1764817">n</span>&nbsp;<span class="op" id="1764819">=</span>&nbsp;<span class="ident" id="1764821">nprint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1764829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764833">//&nbsp;If&nbsp;callback&nbsp;!=&nbsp;nil,&nbsp;we&#39;re&nbsp;being&nbsp;called&nbsp;to&nbsp;gather&nbsp;stack&nbsp;information&nbsp;during</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764911">//&nbsp;garbage&nbsp;collection&nbsp;or&nbsp;stack&nbsp;growth.&nbsp;In&nbsp;that&nbsp;context,&nbsp;require&nbsp;that&nbsp;we&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1764989">//&nbsp;up&nbsp;the&nbsp;entire&nbsp;defer&nbsp;stack.&nbsp;If&nbsp;not,&nbsp;then&nbsp;there&nbsp;is&nbsp;a&nbsp;bug&nbsp;somewhere&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765066">//&nbsp;garbage&nbsp;collection&nbsp;or&nbsp;stack&nbsp;growth&nbsp;may&nbsp;not&nbsp;have&nbsp;seen&nbsp;the&nbsp;correct&nbsp;picture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765143">//&nbsp;of&nbsp;the&nbsp;stack.&nbsp;Crash&nbsp;now&nbsp;instead&nbsp;of&nbsp;silently&nbsp;executing&nbsp;the&nbsp;garbage&nbsp;collection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765224">//&nbsp;or&nbsp;stack&nbsp;copy&nbsp;incorrectly&nbsp;and&nbsp;setting&nbsp;up&nbsp;for&nbsp;a&nbsp;mysterious&nbsp;crash&nbsp;later.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765299">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765303">//&nbsp;Note&nbsp;that&nbsp;panic&nbsp;!=&nbsp;nil&nbsp;is&nbsp;okay&nbsp;here:&nbsp;there&nbsp;can&nbsp;be&nbsp;leftover&nbsp;panics,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765374">//&nbsp;because&nbsp;the&nbsp;defers&nbsp;on&nbsp;the&nbsp;panic&nbsp;stack&nbsp;do&nbsp;not&nbsp;nest&nbsp;in&nbsp;frame&nbsp;order&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765446">//&nbsp;they&nbsp;do&nbsp;on&nbsp;the&nbsp;defer&nbsp;stack.&nbsp;If&nbsp;you&nbsp;have:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765491">//</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765495">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;1&nbsp;defers&nbsp;d1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765517">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;2&nbsp;defers&nbsp;d2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765539">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;3&nbsp;defers&nbsp;d3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765561">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;4&nbsp;panics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765580">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;4&#39;s&nbsp;panic&nbsp;starts&nbsp;running&nbsp;defers</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765622">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;5,&nbsp;running&nbsp;d3,&nbsp;defers&nbsp;d4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765657">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;5&nbsp;panics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765676">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;5&#39;s&nbsp;panic&nbsp;starts&nbsp;running&nbsp;defers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765718">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;6,&nbsp;running&nbsp;d4,&nbsp;garbage&nbsp;collects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765760">//&nbsp;&nbsp;&nbsp;&nbspframe&nbsp;6,&nbsp;running&nbsp;d2,&nbsp;garbage&nbsp;collects</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765802">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765806">//&nbsp;During&nbsp;the&nbsp;execution&nbsp;of&nbsp;d4,&nbsp;the&nbsp;panic&nbsp;stack&nbsp;is&nbsp;d4&nbsp;-&gt;&nbsp;d3,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765873">//&nbsp;is&nbsp;nested&nbsp;properly,&nbsp;and&nbsp;we&#39;ll&nbsp;treat&nbsp;frame&nbsp;3&nbsp;as&nbsp;resumable,&nbsp;because&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1765946">//&nbsp;can&nbsp;find&nbsp;d3.&nbsp;(And&nbsp;in&nbsp;fact&nbsp;frame&nbsp;3&nbsp;is&nbsp;resumable.&nbsp;If&nbsp;d4&nbsp;recovers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766013">//&nbsp;and&nbsp;frame&nbsp;5&nbsp;continues&nbsp;running,&nbsp;d3,&nbsp;d3&nbsp;can&nbsp;recover&nbsp;and&nbsp;we&#39;ll</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766077">//&nbsp;resume&nbsp;execution&nbsp;in&nbsp;(returning&nbsp;from)&nbsp;frame&nbsp;3.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766128">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766132">//&nbsp;During&nbsp;the&nbsp;execution&nbsp;of&nbsp;d2,&nbsp;however,&nbsp;the&nbsp;panic&nbsp;stack&nbsp;is&nbsp;d2&nbsp;-&gt;&nbsp;d3,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766202">//&nbsp;which&nbsp;is&nbsp;inverted.&nbsp;The&nbsp;scan&nbsp;will&nbsp;match&nbsp;d2&nbsp;to&nbsp;frame&nbsp;2&nbsp;but&nbsp;having</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766270">//&nbsp;d2&nbsp;on&nbsp;the&nbsp;stack&nbsp;until&nbsp;then&nbsp;means&nbsp;it&nbsp;will&nbsp;not&nbsp;match&nbsp;d3&nbsp;to&nbsp;frame&nbsp;3.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766340">//&nbsp;This&nbsp;is&nbsp;okay:&nbsp;if&nbsp;we&#39;re&nbsp;running&nbsp;d2,&nbsp;then&nbsp;all&nbsp;the&nbsp;defers&nbsp;after&nbsp;d2&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766413">//&nbsp;completed&nbsp;and&nbsp;their&nbsp;corresponding&nbsp;frames&nbsp;are&nbsp;dead.&nbsp;Not&nbsp;finding&nbsp;d3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766483">//&nbsp;for&nbsp;frame&nbsp;3&nbsp;means&nbsp;we&#39;ll&nbsp;set&nbsp;frame&nbsp;3&#39;s&nbsp;continpc&nbsp;==&nbsp;0,&nbsp;which&nbsp;is&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766557">//&nbsp;(frame&nbsp;3&nbsp;is&nbsp;dead).&nbsp;At&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;walk&nbsp;the&nbsp;panic&nbsp;stack&nbsp;can&nbsp;thus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766628">//&nbsp;contain&nbsp;defers&nbsp;(d3&nbsp;in&nbsp;this&nbsp;case)&nbsp;for&nbsp;dead&nbsp;frames.&nbsp;The&nbsp;inversion&nbsp;here</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766701">//&nbsp;always&nbsp;indicates&nbsp;a&nbsp;dead&nbsp;frame,&nbsp;and&nbsp;the&nbsp;effect&nbsp;of&nbsp;the&nbsp;inversion&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766775">//&nbsp;scan&nbsp;is&nbsp;to&nbsp;hide&nbsp;those&nbsp;dead&nbsp;frames,&nbsp;so&nbsp;the&nbsp;scan&nbsp;is&nbsp;still&nbsp;okay:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766841">//&nbsp;what&#39;s&nbsp;left&nbsp;on&nbsp;the&nbsp;panic&nbsp;stack&nbsp;are&nbsp;exactly&nbsp;(and&nbsp;only)&nbsp;the&nbsp;dead&nbsp;frames.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766916">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766920">//&nbsp;We&nbsp;require&nbsp;callback&nbsp;!=&nbsp;nil&nbsp;here&nbsp;because&nbsp;only&nbsp;when&nbsp;callback&nbsp;!=&nbsp;nil</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1766990">//&nbsp;do&nbsp;we&nbsp;know&nbsp;that&nbsp;gentraceback&nbsp;is&nbsp;being&nbsp;called&nbsp;in&nbsp;a&nbsp;&#34;must&nbsp;be&nbsp;correct&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767062">//&nbsp;context&nbsp;as&nbsp;opposed&nbsp;to&nbsp;a&nbsp;&#34;best&nbsp;effort&#34;&nbsp;context.&nbsp;The&nbsp;tracebacks&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767133">//&nbsp;callbacks&nbsp;only&nbsp;happen&nbsp;when&nbsp;everything&nbsp;is&nbsp;stopped&nbsp;nicely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767194">//&nbsp;At&nbsp;other&nbsp;times,&nbsp;such&nbsp;as&nbsp;when&nbsp;gathering&nbsp;a&nbsp;stack&nbsp;for&nbsp;a&nbsp;profiling&nbsp;signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767268">//&nbsp;or&nbsp;when&nbsp;printing&nbsp;a&nbsp;traceback&nbsp;during&nbsp;a&nbsp;crash,&nbsp;everything&nbsp;may&nbsp;not&nbsp;be</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767339">//&nbsp;stopped&nbsp;nicely,&nbsp;and&nbsp;the&nbsp;stack&nbsp;walk&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;complete.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767407">//&nbsp;It&#39;s&nbsp;okay&nbsp;in&nbsp;those&nbsp;situations&nbsp;not&nbsp;to&nbsp;use&nbsp;up&nbsp;the&nbsp;entire&nbsp;defer&nbsp;stack:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1767479">//&nbsp;incomplete&nbsp;information&nbsp;then&nbsp;is&nbsp;still&nbsp;better&nbsp;than&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767541">if</span>&nbsp;<span class="ident" id="1767544">callback</span>&nbsp;<span class="op" id="1767553">!=</span>&nbsp;<span class="ident" id="1767556">nil</span>&nbsp;<span class="op" id="1767560">&amp;&amp;</span>&nbsp;<span class="ident" id="1767563">n</span>&nbsp;<span class="op" id="1767565">&lt;</span>&nbsp;<span class="ident" id="1767567">max</span>&nbsp;<span class="op" id="1767571">&amp;&amp;</span>&nbsp;<span class="ident" id="1767574">_defer</span>&nbsp;<span class="op" id="1767581">!=</span>&nbsp;<span class="ident" id="1767584">nil</span>&nbsp;<span class="op" id="1767588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767592">if</span>&nbsp;<span class="ident" id="1767595">_defer</span>&nbsp;<span class="op" id="1767602">!=</span>&nbsp;<span class="ident" id="1767605">nil</span>&nbsp;<span class="op" id="1767609">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1767614">print</span><span class="op" id="1767619">(</span><span class="string" id="1767620">&#34;runtime:&nbsp;g&#34;</span><span class="op" id="1767632">,</span>&nbsp;<span class="ident" id="1767634">gp</span><span class="op" id="1767636">.</span><span class="ident" id="1767637">goid</span><span class="op" id="1767641">,</span>&nbsp;<span class="string" id="1767643">&#34;:&nbsp;leftover&nbsp;defer&nbsp;argp=&#34;</span><span class="op" id="1767667">,</span>&nbsp;<span class="ident" id="1767669">hex</span><span class="op" id="1767672">(</span><span class="ident" id="1767673">_defer</span><span class="op" id="1767679">.</span><span class="ident" id="1767680">argp</span><span class="op" id="1767684">)</span><span class="op" id="1767685">,</span>&nbsp;<span class="string" id="1767687">&#34;&nbsp;pc=&#34;</span><span class="op" id="1767693">,</span>&nbsp;<span class="ident" id="1767695">hex</span><span class="op" id="1767698">(</span><span class="ident" id="1767699">_defer</span><span class="op" id="1767705">.</span><span class="ident" id="1767706">pc</span><span class="op" id="1767708">)</span><span class="op" id="1767709">,</span>&nbsp;<span class="string" id="1767711">&#34;\n&#34;</span><span class="op" id="1767715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767723">for</span>&nbsp;<span class="ident" id="1767727">_defer</span>&nbsp;<span class="op" id="1767734">=</span>&nbsp;<span class="ident" id="1767736">gp</span><span class="op" id="1767738">.</span><span class="ident" id="1767739">_defer</span><span class="op" id="1767745">;</span>&nbsp;<span class="ident" id="1767747">_defer</span>&nbsp;<span class="op" id="1767754">!=</span>&nbsp;<span class="ident" id="1767757">nil</span><span class="op" id="1767760">;</span>&nbsp;<span class="ident" id="1767762">_defer</span>&nbsp;<span class="op" id="1767769">=</span>&nbsp;<span class="ident" id="1767771">_defer</span><span class="op" id="1767777">.</span><span class="ident" id="1767778">link</span>&nbsp;<span class="op" id="1767783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1767788">print</span><span class="op" id="1767793">(</span><span class="string" id="1767794">&#34;\tdefer&nbsp;&#34;</span><span class="op" id="1767804">,</span>&nbsp;<span class="ident" id="1767806">_defer</span><span class="op" id="1767812">,</span>&nbsp;<span class="string" id="1767814">&#34;&nbsp;argp=&#34;</span><span class="op" id="1767822">,</span>&nbsp;<span class="ident" id="1767824">hex</span><span class="op" id="1767827">(</span><span class="ident" id="1767828">_defer</span><span class="op" id="1767834">.</span><span class="ident" id="1767835">argp</span><span class="op" id="1767839">)</span><span class="op" id="1767840">,</span>&nbsp;<span class="string" id="1767842">&#34;&nbsp;pc=&#34;</span><span class="op" id="1767848">,</span>&nbsp;<span class="ident" id="1767850">hex</span><span class="op" id="1767853">(</span><span class="ident" id="1767854">_defer</span><span class="op" id="1767860">.</span><span class="ident" id="1767861">pc</span><span class="op" id="1767863">)</span><span class="op" id="1767864">,</span>&nbsp;<span class="string" id="1767866">&#34;\n&#34;</span><span class="op" id="1767870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767874">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767878">gothrow</span><span class="op" id="1767885">(</span><span class="string" id="1767886">&#34;traceback&nbsp;has&nbsp;leftover&nbsp;defers&#34;</span><span class="op" id="1767917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1767920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1767924">return</span>&nbsp;<span class="ident" id="1767931">n</span><br>
<span class="lineno"></span><span class="op" id="1767933">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="keyword" id="1767936">func</span>&nbsp;<span class="ident" id="1767941">setArgInfo</span><span class="op" id="1767951">(</span><span class="ident" id="1767952">frame</span>&nbsp;<span class="op" id="1767958">*</span><span class="ident" id="1767959">stkframe</span><span class="op" id="1767967">,</span>&nbsp;<span class="ident" id="1767969">f</span>&nbsp;<span class="op" id="1767971">*</span><span class="ident" id="1767972">_func</span><span class="op" id="1767977">,</span>&nbsp;<span class="ident" id="1767979">needArgMap</span>&nbsp;<span class="builtintype" id="1767990">bool</span><span class="op" id="1767994">)</span>&nbsp;<span class="op" id="1767996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1767999">frame</span><span class="op" id="1768004">.</span><span class="ident" id="1768005">arglen</span>&nbsp;<span class="op" id="1768012">=</span>&nbsp;<span class="builtintype" id="1768014">uintptr</span><span class="op" id="1768021">(</span><span class="ident" id="1768022">f</span><span class="op" id="1768023">.</span><span class="ident" id="1768024">args</span><span class="op" id="1768028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768031">if</span>&nbsp;<span class="ident" id="1768034">needArgMap</span>&nbsp;<span class="op" id="1768045">&amp;&amp;</span>&nbsp;<span class="ident" id="1768048">f</span><span class="op" id="1768049">.</span><span class="ident" id="1768050">args</span>&nbsp;<span class="op" id="1768055">==</span>&nbsp;<span class="ident" id="1768058">_ArgsSizeUnknown</span>&nbsp;<span class="op" id="1768075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768079">//&nbsp;Extract&nbsp;argument&nbsp;bitmaps&nbsp;for&nbsp;reflect&nbsp;stubs&nbsp;from&nbsp;the&nbsp;calls&nbsp;they&nbsp;made&nbsp;to&nbsp;reflect.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768164">switch</span>&nbsp;<span class="ident" id="1768171">gofuncname</span><span class="op" id="1768181">(</span><span class="ident" id="1768182">f</span><span class="op" id="1768183">)</span>&nbsp;<span class="op" id="1768185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768189">case</span>&nbsp;<span class="string" id="1768194">&#34;reflect.makeFuncStub&#34;</span><span class="op" id="1768216">,</span>&nbsp;<span class="string" id="1768218">&#34;reflect.methodValueCall&#34;</span><span class="op" id="1768243">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768248">arg0</span>&nbsp;<span class="op" id="1768253">:=</span>&nbsp;<span class="ident" id="1768256">frame</span><span class="op" id="1768261">.</span><span class="ident" id="1768262">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768268">if</span>&nbsp;<span class="ident" id="1768271">usesLR</span>&nbsp;<span class="op" id="1768278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768284">arg0</span>&nbsp;<span class="op" id="1768289">+=</span>&nbsp;<span class="ident" id="1768292">ptrSize</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768308">fn</span>&nbsp;<span class="op" id="1768311">:=</span>&nbsp;<span class="op" id="1768314">*</span><span class="op" id="1768315">(</span><span class="op" id="1768316">*</span><span class="op" id="1768317">*</span><span class="op" id="1768318">[</span><span class="num" id="1768319">2</span><span class="op" id="1768320">]</span><span class="builtintype" id="1768321">uintptr</span><span class="op" id="1768328">)</span><span class="op" id="1768329">(</span><span class="ident" id="1768330">unsafe</span><span class="op" id="1768336">.</span><span class="ident" id="1768337">Pointer</span><span class="op" id="1768344">(</span><span class="ident" id="1768345">arg0</span><span class="op" id="1768349">)</span><span class="op" id="1768350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768355">if</span>&nbsp;<span class="ident" id="1768358">fn</span><span class="op" id="1768360">[</span><span class="num" id="1768361">0</span><span class="op" id="1768362">]</span>&nbsp;<span class="op" id="1768364">!=</span>&nbsp;<span class="ident" id="1768367">f</span><span class="op" id="1768368">.</span><span class="ident" id="1768369">entry</span>&nbsp;<span class="op" id="1768375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1768381">print</span><span class="op" id="1768386">(</span><span class="string" id="1768387">&#34;runtime:&nbsp;confused&nbsp;by&nbsp;&#34;</span><span class="op" id="1768410">,</span>&nbsp;<span class="ident" id="1768412">gofuncname</span><span class="op" id="1768422">(</span><span class="ident" id="1768423">f</span><span class="op" id="1768424">)</span><span class="op" id="1768425">,</span>&nbsp;<span class="string" id="1768427">&#34;\n&#34;</span><span class="op" id="1768431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768437">gothrow</span><span class="op" id="1768444">(</span><span class="string" id="1768445">&#34;reflect&nbsp;mismatch&#34;</span><span class="op" id="1768463">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768473">bv</span>&nbsp;<span class="op" id="1768476">:=</span>&nbsp;<span class="op" id="1768479">(</span><span class="op" id="1768480">*</span><span class="ident" id="1768481">bitvector</span><span class="op" id="1768490">)</span><span class="op" id="1768491">(</span><span class="ident" id="1768492">unsafe</span><span class="op" id="1768498">.</span><span class="ident" id="1768499">Pointer</span><span class="op" id="1768506">(</span><span class="ident" id="1768507">fn</span><span class="op" id="1768509">[</span><span class="num" id="1768510">1</span><span class="op" id="1768511">]</span><span class="op" id="1768512">)</span><span class="op" id="1768513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768518">frame</span><span class="op" id="1768523">.</span><span class="ident" id="1768524">arglen</span>&nbsp;<span class="op" id="1768531">=</span>&nbsp;<span class="builtintype" id="1768533">uintptr</span><span class="op" id="1768540">(</span><span class="ident" id="1768541">bv</span><span class="op" id="1768543">.</span><span class="ident" id="1768544">n</span>&nbsp;<span class="op" id="1768546">/</span>&nbsp;<span class="num" id="1768548">2</span>&nbsp;<span class="op" id="1768550">*</span>&nbsp;<span class="ident" id="1768552">ptrSize</span><span class="op" id="1768559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768564">frame</span><span class="op" id="1768569">.</span><span class="ident" id="1768570">argmap</span>&nbsp;<span class="op" id="1768577">=</span>&nbsp;<span class="ident" id="1768579">bv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768584">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768587">}</span><br>
<span class="lineno"></span><span class="op" id="1768589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1768592">func</span>&nbsp;<span class="ident" id="1768597">printcreatedby</span><span class="op" id="1768611">(</span><span class="ident" id="1768612">gp</span>&nbsp;<span class="op" id="1768615">*</span><span class="ident" id="1768616">g</span><span class="op" id="1768617">)</span>&nbsp;<span class="op" id="1768619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1768622">//&nbsp;Show&nbsp;what&nbsp;created&nbsp;goroutine,&nbsp;except&nbsp;main&nbsp;goroutine&nbsp;(goid&nbsp;1).</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768687">pc</span>&nbsp;<span class="op" id="1768690">:=</span>&nbsp;<span class="ident" id="1768693">gp</span><span class="op" id="1768695">.</span><span class="ident" id="1768696">gopc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768702">f</span>&nbsp;<span class="op" id="1768704">:=</span>&nbsp;<span class="ident" id="1768707">findfunc</span><span class="op" id="1768715">(</span><span class="ident" id="1768716">pc</span><span class="op" id="1768718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768721">if</span>&nbsp;<span class="ident" id="1768724">f</span>&nbsp;<span class="op" id="1768726">!=</span>&nbsp;<span class="ident" id="1768729">nil</span>&nbsp;<span class="op" id="1768733">&amp;&amp;</span>&nbsp;<span class="ident" id="1768736">showframe</span><span class="op" id="1768745">(</span><span class="ident" id="1768746">f</span><span class="op" id="1768747">,</span>&nbsp;<span class="ident" id="1768749">gp</span><span class="op" id="1768751">)</span>&nbsp;<span class="op" id="1768753">&amp;&amp;</span>&nbsp;<span class="ident" id="1768756">gp</span><span class="op" id="1768758">.</span><span class="ident" id="1768759">goid</span>&nbsp;<span class="op" id="1768764">!=</span>&nbsp;<span class="num" id="1768767">1</span>&nbsp;<span class="op" id="1768769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1768773">print</span><span class="op" id="1768778">(</span><span class="string" id="1768779">&#34;created&nbsp;by&nbsp;&#34;</span><span class="op" id="1768792">,</span>&nbsp;<span class="ident" id="1768794">gofuncname</span><span class="op" id="1768804">(</span><span class="ident" id="1768805">f</span><span class="op" id="1768806">)</span><span class="op" id="1768807">,</span>&nbsp;<span class="string" id="1768809">&#34;\n&#34;</span><span class="op" id="1768813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768817">tracepc</span>&nbsp;<span class="op" id="1768825">:=</span>&nbsp;<span class="ident" id="1768828">pc</span>&nbsp;<span class="comment" id="1768831">//&nbsp;back&nbsp;up&nbsp;to&nbsp;CALL&nbsp;instruction&nbsp;for&nbsp;funcline.</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768878">if</span>&nbsp;<span class="ident" id="1768881">pc</span>&nbsp;<span class="op" id="1768884">&gt;</span>&nbsp;<span class="ident" id="1768886">f</span><span class="op" id="1768887">.</span><span class="ident" id="1768888">entry</span>&nbsp;<span class="op" id="1768894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768899">tracepc</span>&nbsp;<span class="op" id="1768907">-=</span>&nbsp;<span class="ident" id="1768910">_PCQuantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1768923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1768927">var</span>&nbsp;<span class="ident" id="1768931">file</span>&nbsp;<span class="builtintype" id="1768936">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1768945">line</span>&nbsp;<span class="op" id="1768950">:=</span>&nbsp;<span class="ident" id="1768953">funcline</span><span class="op" id="1768961">(</span><span class="ident" id="1768962">f</span><span class="op" id="1768963">,</span>&nbsp;<span class="ident" id="1768965">tracepc</span><span class="op" id="1768972">,</span>&nbsp;<span class="op" id="1768974">&amp;</span><span class="ident" id="1768975">file</span><span class="op" id="1768979">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1768983">print</span><span class="op" id="1768988">(</span><span class="string" id="1768989">&#34;\t&#34;</span><span class="op" id="1768993">,</span>&nbsp;<span class="ident" id="1768995">file</span><span class="op" id="1768999">,</span>&nbsp;<span class="string" id="1769001">&#34;:&#34;</span><span class="op" id="1769004">,</span>&nbsp;<span class="ident" id="1769006">line</span><span class="op" id="1769010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769014">if</span>&nbsp;<span class="ident" id="1769017">pc</span>&nbsp;<span class="op" id="1769020">&gt;</span>&nbsp;<span class="ident" id="1769022">f</span><span class="op" id="1769023">.</span><span class="ident" id="1769024">entry</span>&nbsp;<span class="op" id="1769030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1769035">print</span><span class="op" id="1769040">(</span><span class="string" id="1769041">&#34;&nbsp;+&#34;</span><span class="op" id="1769045">,</span>&nbsp;<span class="ident" id="1769047">hex</span><span class="op" id="1769050">(</span><span class="ident" id="1769051">pc</span><span class="op" id="1769053">-</span><span class="ident" id="1769054">f</span><span class="op" id="1769055">.</span><span class="ident" id="1769056">entry</span><span class="op" id="1769061">)</span><span class="op" id="1769062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1769070">print</span><span class="op" id="1769075">(</span><span class="string" id="1769076">&#34;\n&#34;</span><span class="op" id="1769080">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769083">}</span><br>
<span class="lineno"></span><span class="op" id="1769085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1769088">func</span>&nbsp;<span class="ident" id="1769093">traceback</span><span class="op" id="1769102">(</span><span class="ident" id="1769103">pc</span>&nbsp;<span class="builtintype" id="1769106">uintptr</span><span class="op" id="1769113">,</span>&nbsp;<span class="ident" id="1769115">sp</span>&nbsp;<span class="builtintype" id="1769118">uintptr</span><span class="op" id="1769125">,</span>&nbsp;<span class="ident" id="1769127">lr</span>&nbsp;<span class="builtintype" id="1769130">uintptr</span><span class="op" id="1769137">,</span>&nbsp;<span class="ident" id="1769139">gp</span>&nbsp;<span class="op" id="1769142">*</span><span class="ident" id="1769143">g</span><span class="op" id="1769144">)</span>&nbsp;<span class="op" id="1769146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769149">traceback1</span><span class="op" id="1769159">(</span><span class="ident" id="1769160">pc</span><span class="op" id="1769162">,</span>&nbsp;<span class="ident" id="1769164">sp</span><span class="op" id="1769166">,</span>&nbsp;<span class="ident" id="1769168">lr</span><span class="op" id="1769170">,</span>&nbsp;<span class="ident" id="1769172">gp</span><span class="op" id="1769174">,</span>&nbsp;<span class="num" id="1769176">0</span><span class="op" id="1769177">)</span><br>
<span class="lineno">495</span><span class="op" id="1769179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1769182">//&nbsp;tracebacktrap&nbsp;is&nbsp;like&nbsp;traceback&nbsp;but&nbsp;expects&nbsp;that&nbsp;the&nbsp;PC&nbsp;and&nbsp;SP&nbsp;were&nbsp;obtained</span><br>
<span class="lineno"></span><span class="comment" id="1769262">//&nbsp;from&nbsp;a&nbsp;trap,&nbsp;not&nbsp;from&nbsp;gp-&gt;sched&nbsp;or&nbsp;gp-&gt;syscallpc/gp-&gt;syscallsp&nbsp;or&nbsp;getcallerpc/getcallersp.</span><br>
<span class="lineno"></span><span class="comment" id="1769356">//&nbsp;Because&nbsp;they&nbsp;are&nbsp;from&nbsp;a&nbsp;trap&nbsp;instead&nbsp;of&nbsp;from&nbsp;a&nbsp;saved&nbsp;pair,</span><br>
<span class="lineno">500</span><span class="comment" id="1769418">//&nbsp;the&nbsp;initial&nbsp;PC&nbsp;must&nbsp;not&nbsp;be&nbsp;rewound&nbsp;to&nbsp;the&nbsp;previous&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="1769485">//&nbsp;(All&nbsp;the&nbsp;saved&nbsp;pairs&nbsp;record&nbsp;a&nbsp;PC&nbsp;that&nbsp;is&nbsp;a&nbsp;return&nbsp;address,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="1769553">//&nbsp;rewind&nbsp;it&nbsp;into&nbsp;the&nbsp;CALL&nbsp;instruction.)</span><br>
<span class="lineno"></span><span class="keyword" id="1769594">func</span>&nbsp;<span class="ident" id="1769599">tracebacktrap</span><span class="op" id="1769612">(</span><span class="ident" id="1769613">pc</span>&nbsp;<span class="builtintype" id="1769616">uintptr</span><span class="op" id="1769623">,</span>&nbsp;<span class="ident" id="1769625">sp</span>&nbsp;<span class="builtintype" id="1769628">uintptr</span><span class="op" id="1769635">,</span>&nbsp;<span class="ident" id="1769637">lr</span>&nbsp;<span class="builtintype" id="1769640">uintptr</span><span class="op" id="1769647">,</span>&nbsp;<span class="ident" id="1769649">gp</span>&nbsp;<span class="op" id="1769652">*</span><span class="ident" id="1769653">g</span><span class="op" id="1769654">)</span>&nbsp;<span class="op" id="1769656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769659">traceback1</span><span class="op" id="1769669">(</span><span class="ident" id="1769670">pc</span><span class="op" id="1769672">,</span>&nbsp;<span class="ident" id="1769674">sp</span><span class="op" id="1769676">,</span>&nbsp;<span class="ident" id="1769678">lr</span><span class="op" id="1769680">,</span>&nbsp;<span class="ident" id="1769682">gp</span><span class="op" id="1769684">,</span>&nbsp;<span class="ident" id="1769686">_TraceTrap</span><span class="op" id="1769696">)</span><br>
<span class="lineno">505</span><span class="op" id="1769698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1769701">func</span>&nbsp;<span class="ident" id="1769706">traceback1</span><span class="op" id="1769716">(</span><span class="ident" id="1769717">pc</span>&nbsp;<span class="builtintype" id="1769720">uintptr</span><span class="op" id="1769727">,</span>&nbsp;<span class="ident" id="1769729">sp</span>&nbsp;<span class="builtintype" id="1769732">uintptr</span><span class="op" id="1769739">,</span>&nbsp;<span class="ident" id="1769741">lr</span>&nbsp;<span class="builtintype" id="1769744">uintptr</span><span class="op" id="1769751">,</span>&nbsp;<span class="ident" id="1769753">gp</span>&nbsp;<span class="op" id="1769756">*</span><span class="ident" id="1769757">g</span><span class="op" id="1769758">,</span>&nbsp;<span class="ident" id="1769760">flags</span>&nbsp;<span class="builtintype" id="1769766">uint</span><span class="op" id="1769770">)</span>&nbsp;<span class="op" id="1769772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769775">var</span>&nbsp;<span class="ident" id="1769779">n</span>&nbsp;<span class="builtintype" id="1769781">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1769786">if</span>&nbsp;<span class="ident" id="1769789">readgstatus</span><span class="op" id="1769800">(</span><span class="ident" id="1769801">gp</span><span class="op" id="1769803">)</span><span class="op" id="1769804">&amp;^</span><span class="ident" id="1769806">_Gscan</span>&nbsp;<span class="op" id="1769813">==</span>&nbsp;<span class="ident" id="1769816">_Gsyscall</span>&nbsp;<span class="op" id="1769826">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1769830">//&nbsp;Override&nbsp;registers&nbsp;if&nbsp;blocked&nbsp;in&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769881">pc</span>&nbsp;<span class="op" id="1769884">=</span>&nbsp;<span class="ident" id="1769886">gp</span><span class="op" id="1769888">.</span><span class="ident" id="1769889">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769901">sp</span>&nbsp;<span class="op" id="1769904">=</span>&nbsp;<span class="ident" id="1769906">gp</span><span class="op" id="1769908">.</span><span class="ident" id="1769909">syscallsp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1769921">flags</span>&nbsp;<span class="op" id="1769927">&amp;^=</span>&nbsp;<span class="ident" id="1769931">_TraceTrap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1769943">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1769946">//&nbsp;Print&nbsp;traceback.&nbsp;By&nbsp;default,&nbsp;omits&nbsp;runtime&nbsp;frames.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1770001">//&nbsp;If&nbsp;that&nbsp;means&nbsp;we&nbsp;print&nbsp;nothing&nbsp;at&nbsp;all,&nbsp;repeat&nbsp;forcing&nbsp;all&nbsp;frames&nbsp;printed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770079">n</span>&nbsp;<span class="op" id="1770081">=</span>&nbsp;<span class="ident" id="1770083">gentraceback</span><span class="op" id="1770095">(</span><span class="ident" id="1770096">pc</span><span class="op" id="1770098">,</span>&nbsp;<span class="ident" id="1770100">sp</span><span class="op" id="1770102">,</span>&nbsp;<span class="ident" id="1770104">lr</span><span class="op" id="1770106">,</span>&nbsp;<span class="ident" id="1770108">gp</span><span class="op" id="1770110">,</span>&nbsp;<span class="num" id="1770112">0</span><span class="op" id="1770113">,</span>&nbsp;<span class="ident" id="1770115">nil</span><span class="op" id="1770118">,</span>&nbsp;<span class="ident" id="1770120">_TracebackMaxFrames</span><span class="op" id="1770139">,</span>&nbsp;<span class="ident" id="1770141">nil</span><span class="op" id="1770144">,</span>&nbsp;<span class="ident" id="1770146">nil</span><span class="op" id="1770149">,</span>&nbsp;<span class="ident" id="1770151">flags</span><span class="op" id="1770156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770159">if</span>&nbsp;<span class="ident" id="1770162">n</span>&nbsp;<span class="op" id="1770164">==</span>&nbsp;<span class="num" id="1770167">0</span>&nbsp;<span class="op" id="1770169">&amp;&amp;</span>&nbsp;<span class="op" id="1770172">(</span><span class="ident" id="1770173">flags</span><span class="op" id="1770178">&amp;</span><span class="ident" id="1770179">_TraceRuntimeFrames</span><span class="op" id="1770198">)</span>&nbsp;<span class="op" id="1770200">==</span>&nbsp;<span class="num" id="1770203">0</span>&nbsp;<span class="op" id="1770205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770209">n</span>&nbsp;<span class="op" id="1770211">=</span>&nbsp;<span class="ident" id="1770213">gentraceback</span><span class="op" id="1770225">(</span><span class="ident" id="1770226">pc</span><span class="op" id="1770228">,</span>&nbsp;<span class="ident" id="1770230">sp</span><span class="op" id="1770232">,</span>&nbsp;<span class="ident" id="1770234">lr</span><span class="op" id="1770236">,</span>&nbsp;<span class="ident" id="1770238">gp</span><span class="op" id="1770240">,</span>&nbsp;<span class="num" id="1770242">0</span><span class="op" id="1770243">,</span>&nbsp;<span class="ident" id="1770245">nil</span><span class="op" id="1770248">,</span>&nbsp;<span class="ident" id="1770250">_TracebackMaxFrames</span><span class="op" id="1770269">,</span>&nbsp;<span class="ident" id="1770271">nil</span><span class="op" id="1770274">,</span>&nbsp;<span class="ident" id="1770276">nil</span><span class="op" id="1770279">,</span>&nbsp;<span class="ident" id="1770281">flags</span><span class="op" id="1770286">|</span><span class="ident" id="1770287">_TraceRuntimeFrames</span><span class="op" id="1770306">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770312">if</span>&nbsp;<span class="ident" id="1770315">n</span>&nbsp;<span class="op" id="1770317">==</span>&nbsp;<span class="ident" id="1770320">_TracebackMaxFrames</span>&nbsp;<span class="op" id="1770340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1770344">print</span><span class="op" id="1770349">(</span><span class="string" id="1770350">&#34;...additional&nbsp;frames&nbsp;elided...\n&#34;</span><span class="op" id="1770384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770390">printcreatedby</span><span class="op" id="1770404">(</span><span class="ident" id="1770405">gp</span><span class="op" id="1770407">)</span><br>
<span class="lineno">525</span><span class="op" id="1770409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1770412">func</span>&nbsp;<span class="ident" id="1770417">callers</span><span class="op" id="1770424">(</span><span class="ident" id="1770425">skip</span>&nbsp;<span class="builtintype" id="1770430">int</span><span class="op" id="1770433">,</span>&nbsp;<span class="ident" id="1770435">pcbuf</span>&nbsp;<span class="op" id="1770441">*</span><span class="builtintype" id="1770442">uintptr</span><span class="op" id="1770449">,</span>&nbsp;<span class="ident" id="1770451">m</span>&nbsp;<span class="builtintype" id="1770453">int</span><span class="op" id="1770456">)</span>&nbsp;<span class="builtintype" id="1770458">int</span>&nbsp;<span class="op" id="1770462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770465">sp</span>&nbsp;<span class="op" id="1770468">:=</span>&nbsp;<span class="ident" id="1770471">getcallersp</span><span class="op" id="1770482">(</span><span class="ident" id="1770483">unsafe</span><span class="op" id="1770489">.</span><span class="ident" id="1770490">Pointer</span><span class="op" id="1770497">(</span><span class="op" id="1770498">&amp;</span><span class="ident" id="1770499">skip</span><span class="op" id="1770503">)</span><span class="op" id="1770504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770507">pc</span>&nbsp;<span class="op" id="1770510">:=</span>&nbsp;<span class="builtintype" id="1770513">uintptr</span><span class="op" id="1770520">(</span><span class="ident" id="1770521">getcallerpc</span><span class="op" id="1770532">(</span><span class="ident" id="1770533">unsafe</span><span class="op" id="1770539">.</span><span class="ident" id="1770540">Pointer</span><span class="op" id="1770547">(</span><span class="op" id="1770548">&amp;</span><span class="ident" id="1770549">skip</span><span class="op" id="1770553">)</span><span class="op" id="1770554">)</span><span class="op" id="1770555">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770558">var</span>&nbsp;<span class="ident" id="1770562">n</span>&nbsp;<span class="builtintype" id="1770564">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770569">onM</span><span class="op" id="1770572">(</span><span class="keyword" id="1770573">func</span><span class="op" id="1770577">(</span><span class="op" id="1770578">)</span>&nbsp;<span class="op" id="1770580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770584">n</span>&nbsp;<span class="op" id="1770586">=</span>&nbsp;<span class="ident" id="1770588">gentraceback</span><span class="op" id="1770600">(</span><span class="ident" id="1770601">pc</span><span class="op" id="1770603">,</span>&nbsp;<span class="ident" id="1770605">sp</span><span class="op" id="1770607">,</span>&nbsp;<span class="num" id="1770609">0</span><span class="op" id="1770610">,</span>&nbsp;<span class="ident" id="1770612">getg</span><span class="op" id="1770616">(</span><span class="op" id="1770617">)</span><span class="op" id="1770618">,</span>&nbsp;<span class="ident" id="1770620">skip</span><span class="op" id="1770624">,</span>&nbsp;<span class="ident" id="1770626">pcbuf</span><span class="op" id="1770631">,</span>&nbsp;<span class="ident" id="1770633">m</span><span class="op" id="1770634">,</span>&nbsp;<span class="ident" id="1770636">nil</span><span class="op" id="1770639">,</span>&nbsp;<span class="ident" id="1770641">nil</span><span class="op" id="1770644">,</span>&nbsp;<span class="num" id="1770646">0</span><span class="op" id="1770647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770650">}</span><span class="op" id="1770651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770654">return</span>&nbsp;<span class="ident" id="1770661">n</span><br>
<span class="lineno">535</span><span class="op" id="1770663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1770666">func</span>&nbsp;<span class="ident" id="1770671">gcallers</span><span class="op" id="1770679">(</span><span class="ident" id="1770680">gp</span>&nbsp;<span class="op" id="1770683">*</span><span class="ident" id="1770684">g</span><span class="op" id="1770685">,</span>&nbsp;<span class="ident" id="1770687">skip</span>&nbsp;<span class="builtintype" id="1770692">int</span><span class="op" id="1770695">,</span>&nbsp;<span class="ident" id="1770697">pcbuf</span>&nbsp;<span class="op" id="1770703">*</span><span class="builtintype" id="1770704">uintptr</span><span class="op" id="1770711">,</span>&nbsp;<span class="ident" id="1770713">m</span>&nbsp;<span class="builtintype" id="1770715">int</span><span class="op" id="1770718">)</span>&nbsp;<span class="builtintype" id="1770720">int</span>&nbsp;<span class="op" id="1770724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770727">return</span>&nbsp;<span class="ident" id="1770734">gentraceback</span><span class="op" id="1770746">(</span><span class="op" id="1770747">^</span><span class="builtintype" id="1770748">uintptr</span><span class="op" id="1770755">(</span><span class="num" id="1770756">0</span><span class="op" id="1770757">)</span><span class="op" id="1770758">,</span>&nbsp;<span class="op" id="1770760">^</span><span class="builtintype" id="1770761">uintptr</span><span class="op" id="1770768">(</span><span class="num" id="1770769">0</span><span class="op" id="1770770">)</span><span class="op" id="1770771">,</span>&nbsp;<span class="num" id="1770773">0</span><span class="op" id="1770774">,</span>&nbsp;<span class="ident" id="1770776">gp</span><span class="op" id="1770778">,</span>&nbsp;<span class="ident" id="1770780">skip</span><span class="op" id="1770784">,</span>&nbsp;<span class="ident" id="1770786">pcbuf</span><span class="op" id="1770791">,</span>&nbsp;<span class="ident" id="1770793">m</span><span class="op" id="1770794">,</span>&nbsp;<span class="ident" id="1770796">nil</span><span class="op" id="1770799">,</span>&nbsp;<span class="ident" id="1770801">nil</span><span class="op" id="1770804">,</span>&nbsp;<span class="num" id="1770806">0</span><span class="op" id="1770807">)</span><br>
<span class="lineno"></span><span class="op" id="1770809">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span><span class="keyword" id="1770812">func</span>&nbsp;<span class="ident" id="1770817">showframe</span><span class="op" id="1770826">(</span><span class="ident" id="1770827">f</span>&nbsp;<span class="op" id="1770829">*</span><span class="ident" id="1770830">_func</span><span class="op" id="1770835">,</span>&nbsp;<span class="ident" id="1770837">gp</span>&nbsp;<span class="op" id="1770840">*</span><span class="ident" id="1770841">g</span><span class="op" id="1770842">)</span>&nbsp;<span class="builtintype" id="1770844">bool</span>&nbsp;<span class="op" id="1770849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770852">g</span>&nbsp;<span class="op" id="1770854">:=</span>&nbsp;<span class="ident" id="1770857">getg</span><span class="op" id="1770861">(</span><span class="op" id="1770862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770865">if</span>&nbsp;<span class="ident" id="1770868">g</span><span class="op" id="1770869">.</span><span class="ident" id="1770870">m</span><span class="op" id="1770871">.</span><span class="ident" id="1770872">throwing</span>&nbsp;<span class="op" id="1770881">&gt;</span>&nbsp;<span class="num" id="1770883">0</span>&nbsp;<span class="op" id="1770885">&amp;&amp;</span>&nbsp;<span class="ident" id="1770888">gp</span>&nbsp;<span class="op" id="1770891">!=</span>&nbsp;<span class="ident" id="1770894">nil</span>&nbsp;<span class="op" id="1770898">&amp;&amp;</span>&nbsp;<span class="op" id="1770901">(</span><span class="ident" id="1770902">gp</span>&nbsp;<span class="op" id="1770905">==</span>&nbsp;<span class="ident" id="1770908">g</span><span class="op" id="1770909">.</span><span class="ident" id="1770910">m</span><span class="op" id="1770911">.</span><span class="ident" id="1770912">curg</span>&nbsp;<span class="op" id="1770917">||</span>&nbsp;<span class="ident" id="1770920">gp</span>&nbsp;<span class="op" id="1770923">==</span>&nbsp;<span class="ident" id="1770926">g</span><span class="op" id="1770927">.</span><span class="ident" id="1770928">m</span><span class="op" id="1770929">.</span><span class="ident" id="1770930">caughtsig</span><span class="op" id="1770939">)</span>&nbsp;<span class="op" id="1770941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1770945">return</span>&nbsp;<span class="builtintype" id="1770952">true</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1770958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770961">traceback</span>&nbsp;<span class="op" id="1770971">:=</span>&nbsp;<span class="ident" id="1770974">gotraceback</span><span class="op" id="1770985">(</span><span class="ident" id="1770986">nil</span><span class="op" id="1770989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1770992">name</span>&nbsp;<span class="op" id="1770997">:=</span>&nbsp;<span class="ident" id="1771000">gostringnocopy</span><span class="op" id="1771014">(</span><span class="ident" id="1771015">funcname</span><span class="op" id="1771023">(</span><span class="ident" id="1771024">f</span><span class="op" id="1771025">)</span><span class="op" id="1771026">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1771030">//&nbsp;Special&nbsp;case:&nbsp;always&nbsp;show&nbsp;runtime.panic&nbsp;frame,&nbsp;so&nbsp;that&nbsp;we&nbsp;can</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1771096">//&nbsp;see&nbsp;where&nbsp;a&nbsp;panic&nbsp;started&nbsp;in&nbsp;the&nbsp;middle&nbsp;of&nbsp;a&nbsp;stack&nbsp;trace.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1771158">//&nbsp;See&nbsp;golang.org/issue/5832.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771189">if</span>&nbsp;<span class="ident" id="1771192">name</span>&nbsp;<span class="op" id="1771197">==</span>&nbsp;<span class="string" id="1771200">&#34;runtime.panic&#34;</span>&nbsp;<span class="op" id="1771216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771220">return</span>&nbsp;<span class="builtintype" id="1771227">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1771233">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771237">return</span>&nbsp;<span class="ident" id="1771244">traceback</span>&nbsp;<span class="op" id="1771254">&gt;</span>&nbsp;<span class="num" id="1771256">1</span>&nbsp;<span class="op" id="1771258">||</span>&nbsp;<span class="ident" id="1771261">f</span>&nbsp;<span class="op" id="1771263">!=</span>&nbsp;<span class="ident" id="1771266">nil</span>&nbsp;<span class="op" id="1771270">&amp;&amp;</span>&nbsp;<span class="ident" id="1771273">contains</span><span class="op" id="1771281">(</span><span class="ident" id="1771282">name</span><span class="op" id="1771286">,</span>&nbsp;<span class="string" id="1771288">&#34;.&#34;</span><span class="op" id="1771291">)</span>&nbsp;<span class="op" id="1771293">&amp;&amp;</span>&nbsp;<span class="op" id="1771296">(</span><span class="op" id="1771297">!</span><span class="ident" id="1771298">hasprefix</span><span class="op" id="1771307">(</span><span class="ident" id="1771308">name</span><span class="op" id="1771312">,</span>&nbsp;<span class="string" id="1771314">&#34;runtime.&#34;</span><span class="op" id="1771324">)</span>&nbsp;<span class="op" id="1771326">||</span>&nbsp;<span class="ident" id="1771329">isExportedRuntime</span><span class="op" id="1771346">(</span><span class="ident" id="1771347">name</span><span class="op" id="1771351">)</span><span class="op" id="1771352">)</span><br>
<span class="lineno"></span><span class="op" id="1771354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1771357">//&nbsp;isExportedRuntime&nbsp;reports&nbsp;whether&nbsp;name&nbsp;is&nbsp;an&nbsp;exported&nbsp;runtime&nbsp;function.</span><br>
<span class="lineno">560</span><span class="comment" id="1771432">//&nbsp;It&nbsp;is&nbsp;only&nbsp;for&nbsp;runtime&nbsp;functions,&nbsp;so&nbsp;ASCII&nbsp;A-Z&nbsp;is&nbsp;fine.</span><br>
<span class="lineno"></span><span class="keyword" id="1771491">func</span>&nbsp;<span class="ident" id="1771496">isExportedRuntime</span><span class="op" id="1771513">(</span><span class="ident" id="1771514">name</span>&nbsp;<span class="builtintype" id="1771519">string</span><span class="op" id="1771525">)</span>&nbsp;<span class="builtintype" id="1771527">bool</span>&nbsp;<span class="op" id="1771532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771535">const</span>&nbsp;<span class="ident" id="1771541">n</span>&nbsp;<span class="op" id="1771543">=</span>&nbsp;<span class="builtinfunc" id="1771545">len</span><span class="op" id="1771548">(</span><span class="string" id="1771549">&#34;runtime.&#34;</span><span class="op" id="1771559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1771562">return</span>&nbsp;<span class="builtinfunc" id="1771569">len</span><span class="op" id="1771572">(</span><span class="ident" id="1771573">name</span><span class="op" id="1771577">)</span>&nbsp;<span class="op" id="1771579">&gt;</span>&nbsp;<span class="ident" id="1771581">n</span>&nbsp;<span class="op" id="1771583">&amp;&amp;</span>&nbsp;<span class="ident" id="1771586">name</span><span class="op" id="1771590">[</span><span class="op" id="1771591">:</span><span class="ident" id="1771592">n</span><span class="op" id="1771593">]</span>&nbsp;<span class="op" id="1771595">==</span>&nbsp;<span class="string" id="1771598">&#34;runtime.&#34;</span>&nbsp;<span class="op" id="1771609">&amp;&amp;</span>&nbsp;<span class="string" id="1771612">&#39;A&#39;</span>&nbsp;<span class="op" id="1771616">&lt;=</span>&nbsp;<span class="ident" id="1771619">name</span><span class="op" id="1771623">[</span><span class="ident" id="1771624">n</span><span class="op" id="1771625">]</span>&nbsp;<span class="op" id="1771627">&amp;&amp;</span>&nbsp;<span class="ident" id="1771630">name</span><span class="op" id="1771634">[</span><span class="ident" id="1771635">n</span><span class="op" id="1771636">]</span>&nbsp;<span class="op" id="1771638">&lt;=</span>&nbsp;<span class="string" id="1771641">&#39;Z&#39;</span><br>
<span class="lineno"></span><span class="op" id="1771645">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="keyword" id="1771648">var</span>&nbsp;<span class="ident" id="1771652">gStatusStrings</span>&nbsp;<span class="op" id="1771667">=</span>&nbsp;<span class="op" id="1771669">[</span><span class="op" id="1771670">...</span><span class="op" id="1771673">]</span><span class="builtintype" id="1771674">string</span><span class="op" id="1771680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771683">_Gidle</span><span class="op" id="1771689">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1771696">&#34;idle&#34;</span><span class="op" id="1771702">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771705">_Grunnable</span><span class="op" id="1771715">:</span>&nbsp;&nbsp;<span class="string" id="1771718">&#34;runnable&#34;</span><span class="op" id="1771728">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771731">_Grunning</span><span class="op" id="1771740">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1771744">&#34;running&#34;</span><span class="op" id="1771753">,</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771756">_Gsyscall</span><span class="op" id="1771765">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1771769">&#34;syscall&#34;</span><span class="op" id="1771778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771781">_Gwaiting</span><span class="op" id="1771790">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1771794">&#34;waiting&#34;</span><span class="op" id="1771803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771806">_Gdead</span><span class="op" id="1771812">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1771819">&#34;dead&#34;</span><span class="op" id="1771825">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771828">_Genqueue</span><span class="op" id="1771837">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="1771841">&#34;enqueue&#34;</span><span class="op" id="1771850">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771853">_Gcopystack</span><span class="op" id="1771864">:</span>&nbsp;<span class="string" id="1771866">&#34;copystack&#34;</span><span class="op" id="1771877">,</span><br>
<span class="lineno">575</span><span class="op" id="1771879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1771882">var</span>&nbsp;<span class="ident" id="1771886">gScanStatusStrings</span>&nbsp;<span class="op" id="1771905">=</span>&nbsp;<span class="op" id="1771907">[</span><span class="op" id="1771908">...</span><span class="op" id="1771911">]</span><span class="builtintype" id="1771912">string</span><span class="op" id="1771918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="1771921">0</span><span class="op" id="1771922">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1771933">&#34;scan&#34;</span><span class="op" id="1771939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771942">_Grunnable</span><span class="op" id="1771952">:</span>&nbsp;<span class="string" id="1771954">&#34;scanrunnable&#34;</span><span class="op" id="1771968">,</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771971">_Grunning</span><span class="op" id="1771980">:</span>&nbsp;&nbsp;<span class="string" id="1771983">&#34;scanrunning&#34;</span><span class="op" id="1771996">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771999">_Gsyscall</span><span class="op" id="1772008">:</span>&nbsp;&nbsp;<span class="string" id="1772011">&#34;scansyscall&#34;</span><span class="op" id="1772024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1772027">_Gwaiting</span><span class="op" id="1772036">:</span>&nbsp;&nbsp;<span class="string" id="1772039">&#34;scanwaiting&#34;</span><span class="op" id="1772052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1772055">_Gdead</span><span class="op" id="1772061">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1772067">&#34;scandead&#34;</span><span class="op" id="1772077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1772080">_Genqueue</span><span class="op" id="1772089">:</span>&nbsp;&nbsp;<span class="string" id="1772092">&#34;scanenqueue&#34;</span><span class="op" id="1772105">,</span><br>
<span class="lineno">585</span><span class="op" id="1772107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1772110">func</span>&nbsp;<span class="ident" id="1772115">goroutineheader</span><span class="op" id="1772130">(</span><span class="ident" id="1772131">gp</span>&nbsp;<span class="op" id="1772134">*</span><span class="ident" id="1772135">g</span><span class="op" id="1772136">)</span>&nbsp;<span class="op" id="1772138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1772141">gpstatus</span>&nbsp;<span class="op" id="1772150">:=</span>&nbsp;<span class="ident" id="1772153">readgstatus</span><span class="op" id="1772164">(</span><span class="ident" id="1772165">gp</span><span class="op" id="1772167">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772171">//&nbsp;Basic&nbsp;string&nbsp;status</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1772195">var</span>&nbsp;<span class="ident" id="1772199">status</span>&nbsp;<span class="builtintype" id="1772206">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1772214">if</span>&nbsp;<span class="num" id="1772217">0</span>&nbsp;<span class="op" id="1772219">&lt;=</span>&nbsp;<span class="ident" id="1772222">gpstatus</span>&nbsp;<span class="op" id="1772231">&amp;&amp;</span>&nbsp;<span class="ident" id="1772234">gpstatus</span>&nbsp;<span class="op" id="1772243">&lt;</span>&nbsp;<span class="builtintype" id="1772245">uint32</span><span class="op" id="1772251">(</span><span class="builtinfunc" id="1772252">len</span><span class="op" id="1772255">(</span><span class="ident" id="1772256">gStatusStrings</span><span class="op" id="1772270">)</span><span class="op" id="1772271">)</span>&nbsp;<span class="op" id="1772273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1772277">status</span>&nbsp;<span class="op" id="1772284">=</span>&nbsp;<span class="ident" id="1772286">gStatusStrings</span><span class="op" id="1772300">[</span><span class="ident" id="1772301">gpstatus</span><span class="op" id="1772309">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1772312">}</span>&nbsp;<span class="keyword" id="1772314">else</span>&nbsp;<span class="keyword" id="1772319">if</span>&nbsp;<span class="ident" id="1772322">gpstatus</span><span class="op" id="1772330">&amp;</span><span class="ident" id="1772331">_Gscan</span>&nbsp;<span class="op" id="1772338">!=</span>&nbsp;<span class="num" id="1772341">0</span>&nbsp;<span class="op" id="1772343">&amp;&amp;</span>&nbsp;<span class="num" id="1772346">0</span>&nbsp;<span class="op" id="1772348">&lt;=</span>&nbsp;<span class="ident" id="1772351">gpstatus</span><span class="op" id="1772359">&amp;^</span><span class="ident" id="1772361">_Gscan</span>&nbsp;<span class="op" id="1772368">&amp;&amp;</span>&nbsp;<span class="ident" id="1772371">gpstatus</span><span class="op" id="1772379">&amp;^</span><span class="ident" id="1772381">_Gscan</span>&nbsp;<span class="op" id="1772388">&lt;</span>&nbsp;<span class="builtintype" id="1772390">uint32</span><span class="op" id="1772396">(</span><span class="builtinfunc" id="1772397">len</span><span class="op" id="1772400">(</span><span class="ident" id="1772401">gStatusStrings</span><span class="op" id="1772415">)</span><span class="op" id="1772416">)</span>&nbsp;<span class="op" id="1772418">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1772422">status</span>&nbsp;<span class="op" id="1772429">=</span>&nbsp;<span class="ident" id="1772431">gStatusStrings</span><span class="op" id="1772445">[</span><span class="ident" id="1772446">gpstatus</span><span class="op" id="1772454">&amp;^</span><span class="ident" id="1772456">_Gscan</span><span class="op" id="1772462">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1772465">}</span>&nbsp;<span class="keyword" id="1772467">else</span>&nbsp;<span class="op" id="1772472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1772476">status</span>&nbsp;<span class="op" id="1772483">=</span>&nbsp;<span class="string" id="1772485">&#34;???&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1772492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772496">//&nbsp;Override.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1772510">if</span>&nbsp;<span class="op" id="1772513">(</span><span class="ident" id="1772514">gpstatus</span>&nbsp;<span class="op" id="1772523">==</span>&nbsp;<span class="ident" id="1772526">_Gwaiting</span>&nbsp;<span class="op" id="1772536">||</span>&nbsp;<span class="ident" id="1772539">gpstatus</span>&nbsp;<span class="op" id="1772548">==</span>&nbsp;<span class="ident" id="1772551">_Gscanwaiting</span><span class="op" id="1772564">)</span>&nbsp;<span class="op" id="1772566">&amp;&amp;</span>&nbsp;<span class="ident" id="1772569">gp</span><span class="op" id="1772571">.</span><span class="ident" id="1772572">waitreason</span>&nbsp;<span class="op" id="1772583">!=</span>&nbsp;<span class="string" id="1772586">&#34;&#34;</span>&nbsp;<span class="op" id="1772589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1772593">status</span>&nbsp;<span class="op" id="1772600">=</span>&nbsp;<span class="ident" id="1772602">gp</span><span class="op" id="1772604">.</span><span class="ident" id="1772605">waitreason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1772617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1772621">//&nbsp;approx&nbsp;time&nbsp;the&nbsp;G&nbsp;is&nbsp;blocked,&nbsp;in&nbsp;minutes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1772666">var</span>&nbsp;<span class="ident" id="1772670">waitfor</span>&nbsp;<span class="ident" id="1772678">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1772685">gpstatus</span>&nbsp;<span class="op" id="1772694">&amp;^=</span>&nbsp;<span class="ident" id="1772698">_Gscan</span>&nbsp;<span class="comment" id="1772705">//&nbsp;drop&nbsp;the&nbsp;scan&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1772727">if</span>&nbsp;<span class="op" id="1772730">(</span><span class="ident" id="1772731">gpstatus</span>&nbsp;<span class="op" id="1772740">==</span>&nbsp;<span class="ident" id="1772743">_Gwaiting</span>&nbsp;<span class="op" id="1772753">||</span>&nbsp;<span class="ident" id="1772756">gpstatus</span>&nbsp;<span class="op" id="1772765">==</span>&nbsp;<span class="ident" id="1772768">_Gsyscall</span><span class="op" id="1772777">)</span>&nbsp;<span class="op" id="1772779">&amp;&amp;</span>&nbsp;<span class="ident" id="1772782">gp</span><span class="op" id="1772784">.</span><span class="ident" id="1772785">waitsince</span>&nbsp;<span class="op" id="1772795">!=</span>&nbsp;<span class="num" id="1772798">0</span>&nbsp;<span class="op" id="1772800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1772804">waitfor</span>&nbsp;<span class="op" id="1772812">=</span>&nbsp;<span class="op" id="1772814">(</span><span class="ident" id="1772815">nanotime</span><span class="op" id="1772823">(</span><span class="op" id="1772824">)</span>&nbsp;<span class="op" id="1772826">-</span>&nbsp;<span class="ident" id="1772828">gp</span><span class="op" id="1772830">.</span><span class="ident" id="1772831">waitsince</span><span class="op" id="1772840">)</span>&nbsp;<span class="op" id="1772842">/</span>&nbsp;<span class="num" id="1772844">60e9</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1772850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1772853">print</span><span class="op" id="1772858">(</span><span class="string" id="1772859">&#34;goroutine&nbsp;&#34;</span><span class="op" id="1772871">,</span>&nbsp;<span class="ident" id="1772873">gp</span><span class="op" id="1772875">.</span><span class="ident" id="1772876">goid</span><span class="op" id="1772880">,</span>&nbsp;<span class="string" id="1772882">&#34;&nbsp;[&#34;</span><span class="op" id="1772886">,</span>&nbsp;<span class="ident" id="1772888">status</span><span class="op" id="1772894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1772897">if</span>&nbsp;<span class="ident" id="1772900">waitfor</span>&nbsp;<span class="op" id="1772908">&gt;=</span>&nbsp;<span class="num" id="1772911">1</span>&nbsp;<span class="op" id="1772913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1772917">print</span><span class="op" id="1772922">(</span><span class="string" id="1772923">&#34;,&nbsp;&#34;</span><span class="op" id="1772927">,</span>&nbsp;<span class="ident" id="1772929">waitfor</span><span class="op" id="1772936">,</span>&nbsp;<span class="string" id="1772938">&#34;&nbsp;minutes&#34;</span><span class="op" id="1772948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1772951">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1772954">if</span>&nbsp;<span class="ident" id="1772957">gp</span><span class="op" id="1772959">.</span><span class="ident" id="1772960">lockedm</span>&nbsp;<span class="op" id="1772968">!=</span>&nbsp;<span class="ident" id="1772971">nil</span>&nbsp;<span class="op" id="1772975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1772979">print</span><span class="op" id="1772984">(</span><span class="string" id="1772985">&#34;,&nbsp;locked&nbsp;to&nbsp;thread&#34;</span><span class="op" id="1773005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1773008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1773011">print</span><span class="op" id="1773016">(</span><span class="string" id="1773017">&#34;]:\n&#34;</span><span class="op" id="1773023">)</span><br>
<span class="lineno"></span><span class="op" id="1773025">}</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span><span class="keyword" id="1773028">func</span>&nbsp;<span class="ident" id="1773033">tracebackothers</span><span class="op" id="1773048">(</span><span class="ident" id="1773049">me</span>&nbsp;<span class="op" id="1773052">*</span><span class="ident" id="1773053">g</span><span class="op" id="1773054">)</span>&nbsp;<span class="op" id="1773056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773059">level</span>&nbsp;<span class="op" id="1773065">:=</span>&nbsp;<span class="ident" id="1773068">gotraceback</span><span class="op" id="1773079">(</span><span class="ident" id="1773080">nil</span><span class="op" id="1773083">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773087">//&nbsp;Show&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;first,&nbsp;if&nbsp;we&nbsp;haven&#39;t&nbsp;already.</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773148">g</span>&nbsp;<span class="op" id="1773150">:=</span>&nbsp;<span class="ident" id="1773153">getg</span><span class="op" id="1773157">(</span><span class="op" id="1773158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773161">gp</span>&nbsp;<span class="op" id="1773164">:=</span>&nbsp;<span class="ident" id="1773167">g</span><span class="op" id="1773168">.</span><span class="ident" id="1773169">m</span><span class="op" id="1773170">.</span><span class="ident" id="1773171">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773177">if</span>&nbsp;<span class="ident" id="1773180">gp</span>&nbsp;<span class="op" id="1773183">!=</span>&nbsp;<span class="ident" id="1773186">nil</span>&nbsp;<span class="op" id="1773190">&amp;&amp;</span>&nbsp;<span class="ident" id="1773193">gp</span>&nbsp;<span class="op" id="1773196">!=</span>&nbsp;<span class="ident" id="1773199">me</span>&nbsp;<span class="op" id="1773202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1773206">print</span><span class="op" id="1773211">(</span><span class="string" id="1773212">&#34;\n&#34;</span><span class="op" id="1773216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773220">goroutineheader</span><span class="op" id="1773235">(</span><span class="ident" id="1773236">gp</span><span class="op" id="1773238">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773242">traceback</span><span class="op" id="1773251">(</span><span class="op" id="1773252">^</span><span class="builtintype" id="1773253">uintptr</span><span class="op" id="1773260">(</span><span class="num" id="1773261">0</span><span class="op" id="1773262">)</span><span class="op" id="1773263">,</span>&nbsp;<span class="op" id="1773265">^</span><span class="builtintype" id="1773266">uintptr</span><span class="op" id="1773273">(</span><span class="num" id="1773274">0</span><span class="op" id="1773275">)</span><span class="op" id="1773276">,</span>&nbsp;<span class="num" id="1773278">0</span><span class="op" id="1773279">,</span>&nbsp;<span class="ident" id="1773281">gp</span><span class="op" id="1773283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1773286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773290">lock</span><span class="op" id="1773294">(</span><span class="op" id="1773295">&amp;</span><span class="ident" id="1773296">allglock</span><span class="op" id="1773304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773307">for</span>&nbsp;<span class="ident" id="1773311">_</span><span class="op" id="1773312">,</span>&nbsp;<span class="ident" id="1773314">gp</span>&nbsp;<span class="op" id="1773317">:=</span>&nbsp;<span class="keyword" id="1773320">range</span>&nbsp;<span class="ident" id="1773326">allgs</span>&nbsp;<span class="op" id="1773332">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773336">if</span>&nbsp;<span class="ident" id="1773339">gp</span>&nbsp;<span class="op" id="1773342">==</span>&nbsp;<span class="ident" id="1773345">me</span>&nbsp;<span class="op" id="1773348">||</span>&nbsp;<span class="ident" id="1773351">gp</span>&nbsp;<span class="op" id="1773354">==</span>&nbsp;<span class="ident" id="1773357">g</span><span class="op" id="1773358">.</span><span class="ident" id="1773359">m</span><span class="op" id="1773360">.</span><span class="ident" id="1773361">curg</span>&nbsp;<span class="op" id="1773366">||</span>&nbsp;<span class="ident" id="1773369">readgstatus</span><span class="op" id="1773380">(</span><span class="ident" id="1773381">gp</span><span class="op" id="1773383">)</span>&nbsp;<span class="op" id="1773385">==</span>&nbsp;<span class="ident" id="1773388">_Gdead</span>&nbsp;<span class="op" id="1773395">||</span>&nbsp;<span class="ident" id="1773398">gp</span><span class="op" id="1773400">.</span><span class="ident" id="1773401">issystem</span>&nbsp;<span class="op" id="1773410">&amp;&amp;</span>&nbsp;<span class="ident" id="1773413">level</span>&nbsp;<span class="op" id="1773419">&lt;</span>&nbsp;<span class="num" id="1773421">2</span>&nbsp;<span class="op" id="1773423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773428">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1773439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1773443">print</span><span class="op" id="1773448">(</span><span class="string" id="1773449">&#34;\n&#34;</span><span class="op" id="1773453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773457">goroutineheader</span><span class="op" id="1773472">(</span><span class="ident" id="1773473">gp</span><span class="op" id="1773475">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773479">if</span>&nbsp;<span class="ident" id="1773482">readgstatus</span><span class="op" id="1773493">(</span><span class="ident" id="1773494">gp</span><span class="op" id="1773496">)</span><span class="op" id="1773497">&amp;^</span><span class="ident" id="1773499">_Gscan</span>&nbsp;<span class="op" id="1773506">==</span>&nbsp;<span class="ident" id="1773509">_Grunning</span>&nbsp;<span class="op" id="1773519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1773524">print</span><span class="op" id="1773529">(</span><span class="string" id="1773530">&#34;\tgoroutine&nbsp;running&nbsp;on&nbsp;other&nbsp;thread;&nbsp;stack&nbsp;unavailable\n&#34;</span><span class="op" id="1773588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773593">printcreatedby</span><span class="op" id="1773607">(</span><span class="ident" id="1773608">gp</span><span class="op" id="1773610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1773614">}</span>&nbsp;<span class="keyword" id="1773616">else</span>&nbsp;<span class="op" id="1773621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773626">traceback</span><span class="op" id="1773635">(</span><span class="op" id="1773636">^</span><span class="builtintype" id="1773637">uintptr</span><span class="op" id="1773644">(</span><span class="num" id="1773645">0</span><span class="op" id="1773646">)</span><span class="op" id="1773647">,</span>&nbsp;<span class="op" id="1773649">^</span><span class="builtintype" id="1773650">uintptr</span><span class="op" id="1773657">(</span><span class="num" id="1773658">0</span><span class="op" id="1773659">)</span><span class="op" id="1773660">,</span>&nbsp;<span class="num" id="1773662">0</span><span class="op" id="1773663">,</span>&nbsp;<span class="ident" id="1773665">gp</span><span class="op" id="1773667">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1773671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1773674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773677">unlock</span><span class="op" id="1773683">(</span><span class="op" id="1773684">&amp;</span><span class="ident" id="1773685">allglock</span><span class="op" id="1773693">)</span><br>
<span class="lineno"></span><span class="op" id="1773695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span><span class="comment" id="1773698">//&nbsp;Does&nbsp;f&nbsp;mark&nbsp;the&nbsp;top&nbsp;of&nbsp;a&nbsp;goroutine&nbsp;stack?</span><br>
<span class="lineno"></span><span class="keyword" id="1773743">func</span>&nbsp;<span class="ident" id="1773748">topofstack</span><span class="op" id="1773758">(</span><span class="ident" id="1773759">f</span>&nbsp;<span class="op" id="1773761">*</span><span class="ident" id="1773762">_func</span><span class="op" id="1773767">)</span>&nbsp;<span class="builtintype" id="1773769">bool</span>&nbsp;<span class="op" id="1773774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773777">pc</span>&nbsp;<span class="op" id="1773780">:=</span>&nbsp;<span class="ident" id="1773783">f</span><span class="op" id="1773784">.</span><span class="ident" id="1773785">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773792">return</span>&nbsp;<span class="ident" id="1773799">pc</span>&nbsp;<span class="op" id="1773802">==</span>&nbsp;<span class="ident" id="1773805">goexitPC</span>&nbsp;<span class="op" id="1773814">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773819">pc</span>&nbsp;<span class="op" id="1773822">==</span>&nbsp;<span class="ident" id="1773825">mstartPC</span>&nbsp;<span class="op" id="1773834">||</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773839">pc</span>&nbsp;<span class="op" id="1773842">==</span>&nbsp;<span class="ident" id="1773845">mcallPC</span>&nbsp;<span class="op" id="1773853">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773858">pc</span>&nbsp;<span class="op" id="1773861">==</span>&nbsp;<span class="ident" id="1773864">morestackPC</span>&nbsp;<span class="op" id="1773876">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773881">pc</span>&nbsp;<span class="op" id="1773884">==</span>&nbsp;<span class="ident" id="1773887">rt0_goPC</span>&nbsp;<span class="op" id="1773896">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773901">externalthreadhandlerp</span>&nbsp;<span class="op" id="1773924">!=</span>&nbsp;<span class="num" id="1773927">0</span>&nbsp;<span class="op" id="1773929">&amp;&amp;</span>&nbsp;<span class="ident" id="1773932">pc</span>&nbsp;<span class="op" id="1773935">==</span>&nbsp;<span class="ident" id="1773938">externalthreadhandlerp</span><br>
<span class="lineno"></span><span class="op" id="1773961">}</span>
</div>
</body>
</html>
