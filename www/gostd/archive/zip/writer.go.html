<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5440694">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5440749">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5440803">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5440854">package</span>&nbsp;<span class="ident" id="5440862">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5440867">import</span>&nbsp;<span class="op" id="5440874">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5440877">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5440886">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5440905">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5440915">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5440923">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5440937">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5440942">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5440945">//&nbsp;TODO(adg):&nbsp;support&nbsp;zip&nbsp;file&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="5440985">//&nbsp;TODO(adg):&nbsp;support&nbsp;specifying&nbsp;deflate&nbsp;level</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5441033">//&nbsp;Writer&nbsp;implements&nbsp;a&nbsp;zip&nbsp;file&nbsp;writer.</span><br>
<span class="lineno">20</span><span class="keyword" id="5441073">type</span>&nbsp;<span class="ident" id="5441078">Writer</span>&nbsp;<span class="keyword" id="5441085">struct</span>&nbsp;<span class="op" id="5441092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441095">cw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5441102">*</span><span class="ident" id="5441103">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441116">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5441123">[</span><span class="op" id="5441124">]</span><span class="op" id="5441125">*</span><span class="ident" id="5441126">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441134">last</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5441141">*</span><span class="ident" id="5441142">fileWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441154">closed</span>&nbsp;<span class="builtintype" id="5441161">bool</span><br>
<span class="lineno">25</span><span class="op" id="5441166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5441169">type</span>&nbsp;<span class="ident" id="5441174">header</span>&nbsp;<span class="keyword" id="5441181">struct</span>&nbsp;<span class="op" id="5441188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5441191">*</span><span class="ident" id="5441192">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441204">offset</span>&nbsp;<span class="ident" id="5441211">uint64</span><br>
<span class="lineno">30</span><span class="op" id="5441218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5441221">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;a&nbsp;zip&nbsp;file&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5441280">func</span>&nbsp;<span class="ident" id="5441285">NewWriter</span><span class="op" id="5441294">(</span><span class="ident" id="5441295">w</span>&nbsp;<span class="ident" id="5441297">io</span><span class="op" id="5441299">.</span><span class="ident" id="5441300">Writer</span><span class="op" id="5441306">)</span>&nbsp;<span class="op" id="5441308">*</span><span class="ident" id="5441309">Writer</span>&nbsp;<span class="op" id="5441316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5441319">return</span>&nbsp;<span class="op" id="5441326">&amp;</span><span class="ident" id="5441327">Writer</span><span class="op" id="5441333">{</span><span class="ident" id="5441334">cw</span><span class="op" id="5441336">:</span>&nbsp;<span class="op" id="5441338">&amp;</span><span class="ident" id="5441339">countWriter</span><span class="op" id="5441350">{</span><span class="ident" id="5441351">w</span><span class="op" id="5441352">:</span>&nbsp;<span class="ident" id="5441354">bufio</span><span class="op" id="5441359">.</span><span class="ident" id="5441360">NewWriter</span><span class="op" id="5441369">(</span><span class="ident" id="5441370">w</span><span class="op" id="5441371">)</span><span class="op" id="5441372">}</span><span class="op" id="5441373">}</span><br>
<span class="lineno">35</span><span class="op" id="5441375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5441378">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="5441439">//&nbsp;Calling&nbsp;Flush&nbsp;is&nbsp;not&nbsp;normally&nbsp;necessary;&nbsp;calling&nbsp;Close&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="keyword" id="5441512">func</span>&nbsp;<span class="op" id="5441517">(</span><span class="ident" id="5441518">w</span>&nbsp;<span class="op" id="5441520">*</span><span class="ident" id="5441521">Writer</span><span class="op" id="5441527">)</span>&nbsp;<span class="ident" id="5441529">Flush</span><span class="op" id="5441534">(</span><span class="op" id="5441535">)</span>&nbsp;<span class="builtintype" id="5441537">error</span>&nbsp;<span class="op" id="5441543">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5441546">return</span>&nbsp;<span class="ident" id="5441553">w</span><span class="op" id="5441554">.</span><span class="ident" id="5441555">cw</span><span class="op" id="5441557">.</span><span class="ident" id="5441558">w</span><span class="op" id="5441559">.</span><span class="op" id="5441560">(</span><span class="op" id="5441561">*</span><span class="ident" id="5441562">bufio</span><span class="op" id="5441567">.</span><span class="ident" id="5441568">Writer</span><span class="op" id="5441574">)</span><span class="op" id="5441575">.</span><span class="ident" id="5441576">Flush</span><span class="op" id="5441581">(</span><span class="op" id="5441582">)</span><br>
<span class="lineno"></span><span class="op" id="5441584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5441587">//&nbsp;Close&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;zip&nbsp;file&nbsp;by&nbsp;writing&nbsp;the&nbsp;central&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="5441660">//&nbsp;It&nbsp;does&nbsp;not&nbsp;(and&nbsp;can&nbsp;not)&nbsp;close&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">45</span><span class="keyword" id="5441718">func</span>&nbsp;<span class="op" id="5441723">(</span><span class="ident" id="5441724">w</span>&nbsp;<span class="op" id="5441726">*</span><span class="ident" id="5441727">Writer</span><span class="op" id="5441733">)</span>&nbsp;<span class="ident" id="5441735">Close</span><span class="op" id="5441740">(</span><span class="op" id="5441741">)</span>&nbsp;<span class="builtintype" id="5441743">error</span>&nbsp;<span class="op" id="5441749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5441752">if</span>&nbsp;<span class="ident" id="5441755">w</span><span class="op" id="5441756">.</span><span class="ident" id="5441757">last</span>&nbsp;<span class="op" id="5441762">!=</span>&nbsp;<span class="builtintype" id="5441765">nil</span>&nbsp;<span class="op" id="5441769">&amp;&amp;</span>&nbsp;<span class="op" id="5441772">!</span><span class="ident" id="5441773">w</span><span class="op" id="5441774">.</span><span class="ident" id="5441775">last</span><span class="op" id="5441779">.</span><span class="ident" id="5441780">closed</span>&nbsp;<span class="op" id="5441787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5441791">if</span>&nbsp;<span class="ident" id="5441794">err</span>&nbsp;<span class="op" id="5441798">:=</span>&nbsp;<span class="ident" id="5441801">w</span><span class="op" id="5441802">.</span><span class="ident" id="5441803">last</span><span class="op" id="5441807">.</span><span class="builtinfunc" id="5441808">close</span><span class="op" id="5441813">(</span><span class="op" id="5441814">)</span><span class="op" id="5441815">;</span>&nbsp;<span class="ident" id="5441817">err</span>&nbsp;<span class="op" id="5441821">!=</span>&nbsp;<span class="builtintype" id="5441824">nil</span>&nbsp;<span class="op" id="5441828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5441833">return</span>&nbsp;<span class="ident" id="5441840">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5441846">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441850">w</span><span class="op" id="5441851">.</span><span class="ident" id="5441852">last</span>&nbsp;<span class="op" id="5441857">=</span>&nbsp;<span class="builtintype" id="5441859">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5441864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5441867">if</span>&nbsp;<span class="ident" id="5441870">w</span><span class="op" id="5441871">.</span><span class="ident" id="5441872">closed</span>&nbsp;<span class="op" id="5441879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5441883">return</span>&nbsp;<span class="ident" id="5441890">errors</span><span class="op" id="5441896">.</span><span class="ident" id="5441897">New</span><span class="op" id="5441900">(</span><span class="string" id="5441901">&#34;zip:&nbsp;writer&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="5441927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5441930">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441933">w</span><span class="op" id="5441934">.</span><span class="ident" id="5441935">closed</span>&nbsp;<span class="op" id="5441942">=</span>&nbsp;<span class="builtintype" id="5441944">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5441951">//&nbsp;write&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441979">start</span>&nbsp;<span class="op" id="5441985">:=</span>&nbsp;<span class="ident" id="5441988">w</span><span class="op" id="5441989">.</span><span class="ident" id="5441990">cw</span><span class="op" id="5441992">.</span><span class="ident" id="5441993">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5442000">for</span>&nbsp;<span class="ident" id="5442004">_</span><span class="op" id="5442005">,</span>&nbsp;<span class="ident" id="5442007">h</span>&nbsp;<span class="op" id="5442009">:=</span>&nbsp;<span class="keyword" id="5442012">range</span>&nbsp;<span class="ident" id="5442018">w</span><span class="op" id="5442019">.</span><span class="ident" id="5442020">dir</span>&nbsp;<span class="op" id="5442024">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5442028">var</span>&nbsp;<span class="ident" id="5442032">buf</span>&nbsp;<span class="op" id="5442036">[</span><span class="ident" id="5442037">directoryHeaderLen</span><span class="op" id="5442055">]</span><span class="builtintype" id="5442056">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442063">b</span>&nbsp;<span class="op" id="5442065">:=</span>&nbsp;<span class="ident" id="5442068">writeBuf</span><span class="op" id="5442076">(</span><span class="ident" id="5442077">buf</span><span class="op" id="5442080">[</span><span class="op" id="5442081">:</span><span class="op" id="5442082">]</span><span class="op" id="5442083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442087">b</span><span class="op" id="5442088">.</span><span class="builtintype" id="5442089">uint32</span><span class="op" id="5442095">(</span><span class="builtintype" id="5442096">uint32</span><span class="op" id="5442102">(</span><span class="ident" id="5442103">directoryHeaderSignature</span><span class="op" id="5442127">)</span><span class="op" id="5442128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442132">b</span><span class="op" id="5442133">.</span><span class="builtintype" id="5442134">uint16</span><span class="op" id="5442140">(</span><span class="ident" id="5442141">h</span><span class="op" id="5442142">.</span><span class="ident" id="5442143">CreatorVersion</span><span class="op" id="5442157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442161">b</span><span class="op" id="5442162">.</span><span class="builtintype" id="5442163">uint16</span><span class="op" id="5442169">(</span><span class="ident" id="5442170">h</span><span class="op" id="5442171">.</span><span class="ident" id="5442172">ReaderVersion</span><span class="op" id="5442185">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442189">b</span><span class="op" id="5442190">.</span><span class="builtintype" id="5442191">uint16</span><span class="op" id="5442197">(</span><span class="ident" id="5442198">h</span><span class="op" id="5442199">.</span><span class="ident" id="5442200">Flags</span><span class="op" id="5442205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442209">b</span><span class="op" id="5442210">.</span><span class="builtintype" id="5442211">uint16</span><span class="op" id="5442217">(</span><span class="ident" id="5442218">h</span><span class="op" id="5442219">.</span><span class="ident" id="5442220">Method</span><span class="op" id="5442226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442230">b</span><span class="op" id="5442231">.</span><span class="builtintype" id="5442232">uint16</span><span class="op" id="5442238">(</span><span class="ident" id="5442239">h</span><span class="op" id="5442240">.</span><span class="ident" id="5442241">ModifiedTime</span><span class="op" id="5442253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442257">b</span><span class="op" id="5442258">.</span><span class="builtintype" id="5442259">uint16</span><span class="op" id="5442265">(</span><span class="ident" id="5442266">h</span><span class="op" id="5442267">.</span><span class="ident" id="5442268">ModifiedDate</span><span class="op" id="5442280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442284">b</span><span class="op" id="5442285">.</span><span class="builtintype" id="5442286">uint32</span><span class="op" id="5442292">(</span><span class="ident" id="5442293">h</span><span class="op" id="5442294">.</span><span class="ident" id="5442295">CRC32</span><span class="op" id="5442300">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5442304">if</span>&nbsp;<span class="ident" id="5442307">h</span><span class="op" id="5442308">.</span><span class="ident" id="5442309">isZip64</span><span class="op" id="5442316">(</span><span class="op" id="5442317">)</span>&nbsp;<span class="op" id="5442319">||</span>&nbsp;<span class="ident" id="5442322">h</span><span class="op" id="5442323">.</span><span class="ident" id="5442324">offset</span>&nbsp;<span class="op" id="5442331">&gt;</span>&nbsp;<span class="ident" id="5442333">uint32max</span>&nbsp;<span class="op" id="5442343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442348">//&nbsp;the&nbsp;file&nbsp;needs&nbsp;a&nbsp;zip64&nbsp;header.&nbsp;store&nbsp;maxint&nbsp;in&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442406">//&nbsp;32&nbsp;bit&nbsp;size&nbsp;fields&nbsp;(and&nbsp;offset&nbsp;later)&nbsp;to&nbsp;signal&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442469">//&nbsp;zip64&nbsp;extra&nbsp;header&nbsp;should&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442510">b</span><span class="op" id="5442511">.</span><span class="builtintype" id="5442512">uint32</span><span class="op" id="5442518">(</span><span class="ident" id="5442519">uint32max</span><span class="op" id="5442528">)</span>&nbsp;<span class="comment" id="5442530">//&nbsp;compressed&nbsp;size</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442552">b</span><span class="op" id="5442553">.</span><span class="builtintype" id="5442554">uint32</span><span class="op" id="5442560">(</span><span class="ident" id="5442561">uint32max</span><span class="op" id="5442570">)</span>&nbsp;<span class="comment" id="5442572">//&nbsp;uncompressed&nbsp;size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442597">//&nbsp;append&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;block&nbsp;to&nbsp;Extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5442639">var</span>&nbsp;<span class="ident" id="5442643">buf</span>&nbsp;<span class="op" id="5442647">[</span><span class="num" id="5442648">28</span><span class="op" id="5442650">]</span><span class="builtintype" id="5442651">byte</span>&nbsp;<span class="comment" id="5442656">//&nbsp;2x&nbsp;uint16&nbsp;+&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442684">eb</span>&nbsp;<span class="op" id="5442687">:=</span>&nbsp;<span class="ident" id="5442690">writeBuf</span><span class="op" id="5442698">(</span><span class="ident" id="5442699">buf</span><span class="op" id="5442702">[</span><span class="op" id="5442703">:</span><span class="op" id="5442704">]</span><span class="op" id="5442705">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442710">eb</span><span class="op" id="5442712">.</span><span class="builtintype" id="5442713">uint16</span><span class="op" id="5442719">(</span><span class="ident" id="5442720">zip64ExtraId</span><span class="op" id="5442732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442737">eb</span><span class="op" id="5442739">.</span><span class="builtintype" id="5442740">uint16</span><span class="op" id="5442746">(</span><span class="num" id="5442747">24</span><span class="op" id="5442749">)</span>&nbsp;<span class="comment" id="5442751">//&nbsp;size&nbsp;=&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442774">eb</span><span class="op" id="5442776">.</span><span class="ident" id="5442777">uint64</span><span class="op" id="5442783">(</span><span class="ident" id="5442784">h</span><span class="op" id="5442785">.</span><span class="ident" id="5442786">UncompressedSize64</span><span class="op" id="5442804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442809">eb</span><span class="op" id="5442811">.</span><span class="ident" id="5442812">uint64</span><span class="op" id="5442818">(</span><span class="ident" id="5442819">h</span><span class="op" id="5442820">.</span><span class="ident" id="5442821">CompressedSize64</span><span class="op" id="5442837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442842">eb</span><span class="op" id="5442844">.</span><span class="ident" id="5442845">uint64</span><span class="op" id="5442851">(</span><span class="ident" id="5442852">h</span><span class="op" id="5442853">.</span><span class="ident" id="5442854">offset</span><span class="op" id="5442860">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442865">h</span><span class="op" id="5442866">.</span><span class="ident" id="5442867">Extra</span>&nbsp;<span class="op" id="5442873">=</span>&nbsp;<span class="builtinfunc" id="5442875">append</span><span class="op" id="5442881">(</span><span class="ident" id="5442882">h</span><span class="op" id="5442883">.</span><span class="ident" id="5442884">Extra</span><span class="op" id="5442889">,</span>&nbsp;<span class="ident" id="5442891">buf</span><span class="op" id="5442894">[</span><span class="op" id="5442895">:</span><span class="op" id="5442896">]</span><span class="op" id="5442897">...</span><span class="op" id="5442900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5442904">}</span>&nbsp;<span class="keyword" id="5442906">else</span>&nbsp;<span class="op" id="5442911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442916">b</span><span class="op" id="5442917">.</span><span class="builtintype" id="5442918">uint32</span><span class="op" id="5442924">(</span><span class="ident" id="5442925">h</span><span class="op" id="5442926">.</span><span class="ident" id="5442927">CompressedSize</span><span class="op" id="5442941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442946">b</span><span class="op" id="5442947">.</span><span class="builtintype" id="5442948">uint32</span><span class="op" id="5442954">(</span><span class="ident" id="5442955">h</span><span class="op" id="5442956">.</span><span class="ident" id="5442957">UncompressedSize</span><span class="op" id="5442973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5442977">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442981">b</span><span class="op" id="5442982">.</span><span class="builtintype" id="5442983">uint16</span><span class="op" id="5442989">(</span><span class="builtintype" id="5442990">uint16</span><span class="op" id="5442996">(</span><span class="builtinfunc" id="5442997">len</span><span class="op" id="5443000">(</span><span class="ident" id="5443001">h</span><span class="op" id="5443002">.</span><span class="ident" id="5443003">Name</span><span class="op" id="5443007">)</span><span class="op" id="5443008">)</span><span class="op" id="5443009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443013">b</span><span class="op" id="5443014">.</span><span class="builtintype" id="5443015">uint16</span><span class="op" id="5443021">(</span><span class="builtintype" id="5443022">uint16</span><span class="op" id="5443028">(</span><span class="builtinfunc" id="5443029">len</span><span class="op" id="5443032">(</span><span class="ident" id="5443033">h</span><span class="op" id="5443034">.</span><span class="ident" id="5443035">Extra</span><span class="op" id="5443040">)</span><span class="op" id="5443041">)</span><span class="op" id="5443042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443046">b</span><span class="op" id="5443047">.</span><span class="builtintype" id="5443048">uint16</span><span class="op" id="5443054">(</span><span class="builtintype" id="5443055">uint16</span><span class="op" id="5443061">(</span><span class="builtinfunc" id="5443062">len</span><span class="op" id="5443065">(</span><span class="ident" id="5443066">h</span><span class="op" id="5443067">.</span><span class="ident" id="5443068">Comment</span><span class="op" id="5443075">)</span><span class="op" id="5443076">)</span><span class="op" id="5443077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443081">b</span>&nbsp;<span class="op" id="5443083">=</span>&nbsp;<span class="ident" id="5443085">b</span><span class="op" id="5443086">[</span><span class="num" id="5443087">4</span><span class="op" id="5443088">:</span><span class="op" id="5443089">]</span>&nbsp;<span class="comment" id="5443091">//&nbsp;skip&nbsp;disk&nbsp;number&nbsp;start&nbsp;and&nbsp;internal&nbsp;file&nbsp;attr&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443154">b</span><span class="op" id="5443155">.</span><span class="builtintype" id="5443156">uint32</span><span class="op" id="5443162">(</span><span class="ident" id="5443163">h</span><span class="op" id="5443164">.</span><span class="ident" id="5443165">ExternalAttrs</span><span class="op" id="5443178">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443182">if</span>&nbsp;<span class="ident" id="5443185">h</span><span class="op" id="5443186">.</span><span class="ident" id="5443187">offset</span>&nbsp;<span class="op" id="5443194">&gt;</span>&nbsp;<span class="ident" id="5443196">uint32max</span>&nbsp;<span class="op" id="5443206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443211">b</span><span class="op" id="5443212">.</span><span class="builtintype" id="5443213">uint32</span><span class="op" id="5443219">(</span><span class="ident" id="5443220">uint32max</span><span class="op" id="5443229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5443233">}</span>&nbsp;<span class="keyword" id="5443235">else</span>&nbsp;<span class="op" id="5443240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443245">b</span><span class="op" id="5443246">.</span><span class="builtintype" id="5443247">uint32</span><span class="op" id="5443253">(</span><span class="builtintype" id="5443254">uint32</span><span class="op" id="5443260">(</span><span class="ident" id="5443261">h</span><span class="op" id="5443262">.</span><span class="ident" id="5443263">offset</span><span class="op" id="5443269">)</span><span class="op" id="5443270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5443274">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443278">if</span>&nbsp;<span class="ident" id="5443281">_</span><span class="op" id="5443282">,</span>&nbsp;<span class="ident" id="5443284">err</span>&nbsp;<span class="op" id="5443288">:=</span>&nbsp;<span class="ident" id="5443291">w</span><span class="op" id="5443292">.</span><span class="ident" id="5443293">cw</span><span class="op" id="5443295">.</span><span class="ident" id="5443296">Write</span><span class="op" id="5443301">(</span><span class="ident" id="5443302">buf</span><span class="op" id="5443305">[</span><span class="op" id="5443306">:</span><span class="op" id="5443307">]</span><span class="op" id="5443308">)</span><span class="op" id="5443309">;</span>&nbsp;<span class="ident" id="5443311">err</span>&nbsp;<span class="op" id="5443315">!=</span>&nbsp;<span class="builtintype" id="5443318">nil</span>&nbsp;<span class="op" id="5443322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443327">return</span>&nbsp;<span class="ident" id="5443334">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5443340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443344">if</span>&nbsp;<span class="ident" id="5443347">_</span><span class="op" id="5443348">,</span>&nbsp;<span class="ident" id="5443350">err</span>&nbsp;<span class="op" id="5443354">:=</span>&nbsp;<span class="ident" id="5443357">io</span><span class="op" id="5443359">.</span><span class="ident" id="5443360">WriteString</span><span class="op" id="5443371">(</span><span class="ident" id="5443372">w</span><span class="op" id="5443373">.</span><span class="ident" id="5443374">cw</span><span class="op" id="5443376">,</span>&nbsp;<span class="ident" id="5443378">h</span><span class="op" id="5443379">.</span><span class="ident" id="5443380">Name</span><span class="op" id="5443384">)</span><span class="op" id="5443385">;</span>&nbsp;<span class="ident" id="5443387">err</span>&nbsp;<span class="op" id="5443391">!=</span>&nbsp;<span class="builtintype" id="5443394">nil</span>&nbsp;<span class="op" id="5443398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443403">return</span>&nbsp;<span class="ident" id="5443410">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5443416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443420">if</span>&nbsp;<span class="ident" id="5443423">_</span><span class="op" id="5443424">,</span>&nbsp;<span class="ident" id="5443426">err</span>&nbsp;<span class="op" id="5443430">:=</span>&nbsp;<span class="ident" id="5443433">w</span><span class="op" id="5443434">.</span><span class="ident" id="5443435">cw</span><span class="op" id="5443437">.</span><span class="ident" id="5443438">Write</span><span class="op" id="5443443">(</span><span class="ident" id="5443444">h</span><span class="op" id="5443445">.</span><span class="ident" id="5443446">Extra</span><span class="op" id="5443451">)</span><span class="op" id="5443452">;</span>&nbsp;<span class="ident" id="5443454">err</span>&nbsp;<span class="op" id="5443458">!=</span>&nbsp;<span class="builtintype" id="5443461">nil</span>&nbsp;<span class="op" id="5443465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443470">return</span>&nbsp;<span class="ident" id="5443477">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5443483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443487">if</span>&nbsp;<span class="ident" id="5443490">_</span><span class="op" id="5443491">,</span>&nbsp;<span class="ident" id="5443493">err</span>&nbsp;<span class="op" id="5443497">:=</span>&nbsp;<span class="ident" id="5443500">io</span><span class="op" id="5443502">.</span><span class="ident" id="5443503">WriteString</span><span class="op" id="5443514">(</span><span class="ident" id="5443515">w</span><span class="op" id="5443516">.</span><span class="ident" id="5443517">cw</span><span class="op" id="5443519">,</span>&nbsp;<span class="ident" id="5443521">h</span><span class="op" id="5443522">.</span><span class="ident" id="5443523">Comment</span><span class="op" id="5443530">)</span><span class="op" id="5443531">;</span>&nbsp;<span class="ident" id="5443533">err</span>&nbsp;<span class="op" id="5443537">!=</span>&nbsp;<span class="builtintype" id="5443540">nil</span>&nbsp;<span class="op" id="5443544">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443549">return</span>&nbsp;<span class="ident" id="5443556">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5443562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5443565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443568">end</span>&nbsp;<span class="op" id="5443572">:=</span>&nbsp;<span class="ident" id="5443575">w</span><span class="op" id="5443576">.</span><span class="ident" id="5443577">cw</span><span class="op" id="5443579">.</span><span class="ident" id="5443580">count</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443588">records</span>&nbsp;<span class="op" id="5443596">:=</span>&nbsp;<span class="ident" id="5443599">uint64</span><span class="op" id="5443605">(</span><span class="builtinfunc" id="5443606">len</span><span class="op" id="5443609">(</span><span class="ident" id="5443610">w</span><span class="op" id="5443611">.</span><span class="ident" id="5443612">dir</span><span class="op" id="5443615">)</span><span class="op" id="5443616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443619">size</span>&nbsp;<span class="op" id="5443624">:=</span>&nbsp;<span class="ident" id="5443627">uint64</span><span class="op" id="5443633">(</span><span class="ident" id="5443634">end</span>&nbsp;<span class="op" id="5443638">-</span>&nbsp;<span class="ident" id="5443640">start</span><span class="op" id="5443645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443648">offset</span>&nbsp;<span class="op" id="5443655">:=</span>&nbsp;<span class="ident" id="5443658">uint64</span><span class="op" id="5443664">(</span><span class="ident" id="5443665">start</span><span class="op" id="5443670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443674">if</span>&nbsp;<span class="ident" id="5443677">records</span>&nbsp;<span class="op" id="5443685">&gt;</span>&nbsp;<span class="ident" id="5443687">uint16max</span>&nbsp;<span class="op" id="5443697">||</span>&nbsp;<span class="ident" id="5443700">size</span>&nbsp;<span class="op" id="5443705">&gt;</span>&nbsp;<span class="ident" id="5443707">uint32max</span>&nbsp;<span class="op" id="5443717">||</span>&nbsp;<span class="ident" id="5443720">offset</span>&nbsp;<span class="op" id="5443727">&gt;</span>&nbsp;<span class="ident" id="5443729">uint32max</span>&nbsp;<span class="op" id="5443739">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443743">var</span>&nbsp;<span class="ident" id="5443747">buf</span>&nbsp;<span class="op" id="5443751">[</span><span class="ident" id="5443752">directory64EndLen</span>&nbsp;<span class="op" id="5443770">+</span>&nbsp;<span class="ident" id="5443772">directory64LocLen</span><span class="op" id="5443789">]</span><span class="builtintype" id="5443790">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443797">b</span>&nbsp;<span class="op" id="5443799">:=</span>&nbsp;<span class="ident" id="5443802">writeBuf</span><span class="op" id="5443810">(</span><span class="ident" id="5443811">buf</span><span class="op" id="5443814">[</span><span class="op" id="5443815">:</span><span class="op" id="5443816">]</span><span class="op" id="5443817">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5443822">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443865">b</span><span class="op" id="5443866">.</span><span class="builtintype" id="5443867">uint32</span><span class="op" id="5443873">(</span><span class="ident" id="5443874">directory64EndSignature</span><span class="op" id="5443897">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443901">b</span><span class="op" id="5443902">.</span><span class="ident" id="5443903">uint64</span><span class="op" id="5443909">(</span><span class="ident" id="5443910">directory64EndLen</span><span class="op" id="5443927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443931">b</span><span class="op" id="5443932">.</span><span class="builtintype" id="5443933">uint16</span><span class="op" id="5443939">(</span><span class="ident" id="5443940">zipVersion45</span><span class="op" id="5443952">)</span>&nbsp;<span class="comment" id="5443954">//&nbsp;version&nbsp;made&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443975">b</span><span class="op" id="5443976">.</span><span class="builtintype" id="5443977">uint16</span><span class="op" id="5443983">(</span><span class="ident" id="5443984">zipVersion45</span><span class="op" id="5443996">)</span>&nbsp;<span class="comment" id="5443998">//&nbsp;version&nbsp;needed&nbsp;to&nbsp;extract</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444029">b</span><span class="op" id="5444030">.</span><span class="builtintype" id="5444031">uint32</span><span class="op" id="5444037">(</span><span class="num" id="5444038">0</span><span class="op" id="5444039">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5444052">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444077">b</span><span class="op" id="5444078">.</span><span class="builtintype" id="5444079">uint32</span><span class="op" id="5444085">(</span><span class="num" id="5444086">0</span><span class="op" id="5444087">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5444100">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444164">b</span><span class="op" id="5444165">.</span><span class="ident" id="5444166">uint64</span><span class="op" id="5444172">(</span><span class="ident" id="5444173">records</span><span class="op" id="5444180">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5444187">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444254">b</span><span class="op" id="5444255">.</span><span class="ident" id="5444256">uint64</span><span class="op" id="5444262">(</span><span class="ident" id="5444263">records</span><span class="op" id="5444270">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5444277">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444331">b</span><span class="op" id="5444332">.</span><span class="ident" id="5444333">uint64</span><span class="op" id="5444339">(</span><span class="ident" id="5444340">size</span><span class="op" id="5444344">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5444354">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444389">b</span><span class="op" id="5444390">.</span><span class="ident" id="5444391">uint64</span><span class="op" id="5444397">(</span><span class="ident" id="5444398">offset</span><span class="op" id="5444404">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5444412">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5444496">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;locator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444540">b</span><span class="op" id="5444541">.</span><span class="builtintype" id="5444542">uint32</span><span class="op" id="5444548">(</span><span class="ident" id="5444549">directory64LocSignature</span><span class="op" id="5444572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444576">b</span><span class="op" id="5444577">.</span><span class="builtintype" id="5444578">uint32</span><span class="op" id="5444584">(</span><span class="num" id="5444585">0</span><span class="op" id="5444586">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5444598">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444675">b</span><span class="op" id="5444676">.</span><span class="ident" id="5444677">uint64</span><span class="op" id="5444683">(</span><span class="ident" id="5444684">uint64</span><span class="op" id="5444690">(</span><span class="ident" id="5444691">end</span><span class="op" id="5444694">)</span><span class="op" id="5444695">)</span>&nbsp;<span class="comment" id="5444697">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444763">b</span><span class="op" id="5444764">.</span><span class="builtintype" id="5444765">uint32</span><span class="op" id="5444771">(</span><span class="num" id="5444772">1</span><span class="op" id="5444773">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5444785">//&nbsp;total&nbsp;number&nbsp;of&nbsp;disks</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5444813">if</span>&nbsp;<span class="ident" id="5444816">_</span><span class="op" id="5444817">,</span>&nbsp;<span class="ident" id="5444819">err</span>&nbsp;<span class="op" id="5444823">:=</span>&nbsp;<span class="ident" id="5444826">w</span><span class="op" id="5444827">.</span><span class="ident" id="5444828">cw</span><span class="op" id="5444830">.</span><span class="ident" id="5444831">Write</span><span class="op" id="5444836">(</span><span class="ident" id="5444837">buf</span><span class="op" id="5444840">[</span><span class="op" id="5444841">:</span><span class="op" id="5444842">]</span><span class="op" id="5444843">)</span><span class="op" id="5444844">;</span>&nbsp;<span class="ident" id="5444846">err</span>&nbsp;<span class="op" id="5444850">!=</span>&nbsp;<span class="builtintype" id="5444853">nil</span>&nbsp;<span class="op" id="5444857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5444862">return</span>&nbsp;<span class="ident" id="5444869">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5444875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5444880">//&nbsp;store&nbsp;max&nbsp;values&nbsp;in&nbsp;the&nbsp;regular&nbsp;end&nbsp;record&nbsp;to&nbsp;signal&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5444943">//&nbsp;that&nbsp;the&nbsp;zip64&nbsp;values&nbsp;should&nbsp;be&nbsp;used&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444993">records</span>&nbsp;<span class="op" id="5445001">=</span>&nbsp;<span class="ident" id="5445003">uint16max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445015">size</span>&nbsp;<span class="op" id="5445020">=</span>&nbsp;<span class="ident" id="5445022">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445034">offset</span>&nbsp;<span class="op" id="5445041">=</span>&nbsp;<span class="ident" id="5445043">uint32max</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5445054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5445058">//&nbsp;write&nbsp;end&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445079">var</span>&nbsp;<span class="ident" id="5445083">buf</span>&nbsp;<span class="op" id="5445087">[</span><span class="ident" id="5445088">directoryEndLen</span><span class="op" id="5445103">]</span><span class="builtintype" id="5445104">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445110">b</span>&nbsp;<span class="op" id="5445112">:=</span>&nbsp;<span class="ident" id="5445115">writeBuf</span><span class="op" id="5445123">(</span><span class="ident" id="5445124">buf</span><span class="op" id="5445127">[</span><span class="op" id="5445128">:</span><span class="op" id="5445129">]</span><span class="op" id="5445130">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445133">b</span><span class="op" id="5445134">.</span><span class="builtintype" id="5445135">uint32</span><span class="op" id="5445141">(</span><span class="builtintype" id="5445142">uint32</span><span class="op" id="5445148">(</span><span class="ident" id="5445149">directoryEndSignature</span><span class="op" id="5445170">)</span><span class="op" id="5445171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445174">b</span>&nbsp;<span class="op" id="5445176">=</span>&nbsp;<span class="ident" id="5445178">b</span><span class="op" id="5445179">[</span><span class="num" id="5445180">4</span><span class="op" id="5445181">:</span><span class="op" id="5445182">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5445200">//&nbsp;skip&nbsp;over&nbsp;disk&nbsp;number&nbsp;and&nbsp;first&nbsp;disk&nbsp;number&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445260">b</span><span class="op" id="5445261">.</span><span class="builtintype" id="5445262">uint16</span><span class="op" id="5445268">(</span><span class="builtintype" id="5445269">uint16</span><span class="op" id="5445275">(</span><span class="ident" id="5445276">records</span><span class="op" id="5445283">)</span><span class="op" id="5445284">)</span>&nbsp;<span class="comment" id="5445286">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445318">b</span><span class="op" id="5445319">.</span><span class="builtintype" id="5445320">uint16</span><span class="op" id="5445326">(</span><span class="builtintype" id="5445327">uint16</span><span class="op" id="5445333">(</span><span class="ident" id="5445334">records</span><span class="op" id="5445341">)</span><span class="op" id="5445342">)</span>&nbsp;<span class="comment" id="5445344">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;total</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445372">b</span><span class="op" id="5445373">.</span><span class="builtintype" id="5445374">uint32</span><span class="op" id="5445380">(</span><span class="builtintype" id="5445381">uint32</span><span class="op" id="5445387">(</span><span class="ident" id="5445388">size</span><span class="op" id="5445392">)</span><span class="op" id="5445393">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5445398">//&nbsp;size&nbsp;of&nbsp;directory</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445420">b</span><span class="op" id="5445421">.</span><span class="builtintype" id="5445422">uint32</span><span class="op" id="5445428">(</span><span class="builtintype" id="5445429">uint32</span><span class="op" id="5445435">(</span><span class="ident" id="5445436">offset</span><span class="op" id="5445442">)</span><span class="op" id="5445443">)</span>&nbsp;&nbsp;<span class="comment" id="5445446">//&nbsp;start&nbsp;of&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5445469">//&nbsp;skipped&nbsp;size&nbsp;of&nbsp;comment&nbsp;(always&nbsp;zero)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445511">if</span>&nbsp;<span class="ident" id="5445514">_</span><span class="op" id="5445515">,</span>&nbsp;<span class="ident" id="5445517">err</span>&nbsp;<span class="op" id="5445521">:=</span>&nbsp;<span class="ident" id="5445524">w</span><span class="op" id="5445525">.</span><span class="ident" id="5445526">cw</span><span class="op" id="5445528">.</span><span class="ident" id="5445529">Write</span><span class="op" id="5445534">(</span><span class="ident" id="5445535">buf</span><span class="op" id="5445538">[</span><span class="op" id="5445539">:</span><span class="op" id="5445540">]</span><span class="op" id="5445541">)</span><span class="op" id="5445542">;</span>&nbsp;<span class="ident" id="5445544">err</span>&nbsp;<span class="op" id="5445548">!=</span>&nbsp;<span class="builtintype" id="5445551">nil</span>&nbsp;<span class="op" id="5445555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445559">return</span>&nbsp;<span class="ident" id="5445566">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5445571">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445575">return</span>&nbsp;<span class="ident" id="5445582">w</span><span class="op" id="5445583">.</span><span class="ident" id="5445584">cw</span><span class="op" id="5445586">.</span><span class="ident" id="5445587">w</span><span class="op" id="5445588">.</span><span class="op" id="5445589">(</span><span class="op" id="5445590">*</span><span class="ident" id="5445591">bufio</span><span class="op" id="5445596">.</span><span class="ident" id="5445597">Writer</span><span class="op" id="5445603">)</span><span class="op" id="5445604">.</span><span class="ident" id="5445605">Flush</span><span class="op" id="5445610">(</span><span class="op" id="5445611">)</span><br>
<span class="lineno"></span><span class="op" id="5445613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5445616">//&nbsp;Create&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;name.</span><br>
<span class="lineno">170</span><span class="comment" id="5445679">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="5445748">//&nbsp;The&nbsp;name&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span><span class="comment" id="5445816">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5445883">//&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="5445895">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno">175</span><span class="comment" id="5445967">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5446010">func</span>&nbsp;<span class="op" id="5446015">(</span><span class="ident" id="5446016">w</span>&nbsp;<span class="op" id="5446018">*</span><span class="ident" id="5446019">Writer</span><span class="op" id="5446025">)</span>&nbsp;<span class="ident" id="5446027">Create</span><span class="op" id="5446033">(</span><span class="ident" id="5446034">name</span>&nbsp;<span class="builtintype" id="5446039">string</span><span class="op" id="5446045">)</span>&nbsp;<span class="op" id="5446047">(</span><span class="ident" id="5446048">io</span><span class="op" id="5446050">.</span><span class="ident" id="5446051">Writer</span><span class="op" id="5446057">,</span>&nbsp;<span class="builtintype" id="5446059">error</span><span class="op" id="5446064">)</span>&nbsp;<span class="op" id="5446066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446069">header</span>&nbsp;<span class="op" id="5446076">:=</span>&nbsp;<span class="op" id="5446079">&amp;</span><span class="ident" id="5446080">FileHeader</span><span class="op" id="5446090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446094">Name</span><span class="op" id="5446098">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5446102">name</span><span class="op" id="5446106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446110">Method</span><span class="op" id="5446116">:</span>&nbsp;<span class="ident" id="5446118">Deflate</span><span class="op" id="5446125">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5446128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446131">return</span>&nbsp;<span class="ident" id="5446138">w</span><span class="op" id="5446139">.</span><span class="ident" id="5446140">CreateHeader</span><span class="op" id="5446152">(</span><span class="ident" id="5446153">header</span><span class="op" id="5446159">)</span><br>
<span class="lineno"></span><span class="op" id="5446161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5446164">//&nbsp;CreateHeader&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;FileHeader</span><br>
<span class="lineno">185</span><span class="comment" id="5446238">//&nbsp;for&nbsp;the&nbsp;file&nbsp;metadata.</span><br>
<span class="lineno"></span><span class="comment" id="5446264">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="5446333">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="5446405">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5446448">func</span>&nbsp;<span class="op" id="5446453">(</span><span class="ident" id="5446454">w</span>&nbsp;<span class="op" id="5446456">*</span><span class="ident" id="5446457">Writer</span><span class="op" id="5446463">)</span>&nbsp;<span class="ident" id="5446465">CreateHeader</span><span class="op" id="5446477">(</span><span class="ident" id="5446478">fh</span>&nbsp;<span class="op" id="5446481">*</span><span class="ident" id="5446482">FileHeader</span><span class="op" id="5446492">)</span>&nbsp;<span class="op" id="5446494">(</span><span class="ident" id="5446495">io</span><span class="op" id="5446497">.</span><span class="ident" id="5446498">Writer</span><span class="op" id="5446504">,</span>&nbsp;<span class="builtintype" id="5446506">error</span><span class="op" id="5446511">)</span>&nbsp;<span class="op" id="5446513">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446516">if</span>&nbsp;<span class="ident" id="5446519">w</span><span class="op" id="5446520">.</span><span class="ident" id="5446521">last</span>&nbsp;<span class="op" id="5446526">!=</span>&nbsp;<span class="builtintype" id="5446529">nil</span>&nbsp;<span class="op" id="5446533">&amp;&amp;</span>&nbsp;<span class="op" id="5446536">!</span><span class="ident" id="5446537">w</span><span class="op" id="5446538">.</span><span class="ident" id="5446539">last</span><span class="op" id="5446543">.</span><span class="ident" id="5446544">closed</span>&nbsp;<span class="op" id="5446551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446555">if</span>&nbsp;<span class="ident" id="5446558">err</span>&nbsp;<span class="op" id="5446562">:=</span>&nbsp;<span class="ident" id="5446565">w</span><span class="op" id="5446566">.</span><span class="ident" id="5446567">last</span><span class="op" id="5446571">.</span><span class="builtinfunc" id="5446572">close</span><span class="op" id="5446577">(</span><span class="op" id="5446578">)</span><span class="op" id="5446579">;</span>&nbsp;<span class="ident" id="5446581">err</span>&nbsp;<span class="op" id="5446585">!=</span>&nbsp;<span class="builtintype" id="5446588">nil</span>&nbsp;<span class="op" id="5446592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446597">return</span>&nbsp;<span class="builtintype" id="5446604">nil</span><span class="op" id="5446607">,</span>&nbsp;<span class="ident" id="5446609">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5446615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5446618">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446622">fh</span><span class="op" id="5446624">.</span><span class="ident" id="5446625">Flags</span>&nbsp;<span class="op" id="5446631">|=</span>&nbsp;<span class="num" id="5446634">0x8</span>&nbsp;<span class="comment" id="5446638">//&nbsp;we&nbsp;will&nbsp;write&nbsp;a&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446675">fh</span><span class="op" id="5446677">.</span><span class="ident" id="5446678">CreatorVersion</span>&nbsp;<span class="op" id="5446693">=</span>&nbsp;<span class="ident" id="5446695">fh</span><span class="op" id="5446697">.</span><span class="ident" id="5446698">CreatorVersion</span><span class="op" id="5446712">&amp;</span><span class="num" id="5446713">0xff00</span>&nbsp;<span class="op" id="5446720">|</span>&nbsp;<span class="ident" id="5446722">zipVersion20</span>&nbsp;<span class="comment" id="5446735">//&nbsp;preserve&nbsp;compatibility&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446767">fh</span><span class="op" id="5446769">.</span><span class="ident" id="5446770">ReaderVersion</span>&nbsp;<span class="op" id="5446784">=</span>&nbsp;<span class="ident" id="5446786">zipVersion20</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446801">fw</span>&nbsp;<span class="op" id="5446804">:=</span>&nbsp;<span class="op" id="5446807">&amp;</span><span class="ident" id="5446808">fileWriter</span><span class="op" id="5446818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446822">zipw</span><span class="op" id="5446826">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446833">w</span><span class="op" id="5446834">.</span><span class="ident" id="5446835">cw</span><span class="op" id="5446837">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446841">compCount</span><span class="op" id="5446850">:</span>&nbsp;<span class="op" id="5446852">&amp;</span><span class="ident" id="5446853">countWriter</span><span class="op" id="5446864">{</span><span class="ident" id="5446865">w</span><span class="op" id="5446866">:</span>&nbsp;<span class="ident" id="5446868">w</span><span class="op" id="5446869">.</span><span class="ident" id="5446870">cw</span><span class="op" id="5446872">}</span><span class="op" id="5446873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446877">crc32</span><span class="op" id="5446882">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446888">crc32</span><span class="op" id="5446893">.</span><span class="ident" id="5446894">NewIEEE</span><span class="op" id="5446901">(</span><span class="op" id="5446902">)</span><span class="op" id="5446903">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5446906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446909">comp</span>&nbsp;<span class="op" id="5446914">:=</span>&nbsp;<span class="ident" id="5446917">compressor</span><span class="op" id="5446927">(</span><span class="ident" id="5446928">fh</span><span class="op" id="5446930">.</span><span class="ident" id="5446931">Method</span><span class="op" id="5446937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446940">if</span>&nbsp;<span class="ident" id="5446943">comp</span>&nbsp;<span class="op" id="5446948">==</span>&nbsp;<span class="builtintype" id="5446951">nil</span>&nbsp;<span class="op" id="5446955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446959">return</span>&nbsp;<span class="builtintype" id="5446966">nil</span><span class="op" id="5446969">,</span>&nbsp;<span class="ident" id="5446971">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5446985">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446988">var</span>&nbsp;<span class="ident" id="5446992">err</span>&nbsp;<span class="builtintype" id="5446996">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447003">fw</span><span class="op" id="5447005">.</span><span class="ident" id="5447006">comp</span><span class="op" id="5447010">,</span>&nbsp;<span class="ident" id="5447012">err</span>&nbsp;<span class="op" id="5447016">=</span>&nbsp;<span class="ident" id="5447018">comp</span><span class="op" id="5447022">(</span><span class="ident" id="5447023">fw</span><span class="op" id="5447025">.</span><span class="ident" id="5447026">compCount</span><span class="op" id="5447035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447038">if</span>&nbsp;<span class="ident" id="5447041">err</span>&nbsp;<span class="op" id="5447045">!=</span>&nbsp;<span class="builtintype" id="5447048">nil</span>&nbsp;<span class="op" id="5447052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447056">return</span>&nbsp;<span class="builtintype" id="5447063">nil</span><span class="op" id="5447066">,</span>&nbsp;<span class="ident" id="5447068">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5447073">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447076">fw</span><span class="op" id="5447078">.</span><span class="ident" id="5447079">rawCount</span>&nbsp;<span class="op" id="5447088">=</span>&nbsp;<span class="op" id="5447090">&amp;</span><span class="ident" id="5447091">countWriter</span><span class="op" id="5447102">{</span><span class="ident" id="5447103">w</span><span class="op" id="5447104">:</span>&nbsp;<span class="ident" id="5447106">fw</span><span class="op" id="5447108">.</span><span class="ident" id="5447109">comp</span><span class="op" id="5447113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447117">h</span>&nbsp;<span class="op" id="5447119">:=</span>&nbsp;<span class="op" id="5447122">&amp;</span><span class="ident" id="5447123">header</span><span class="op" id="5447129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447133">FileHeader</span><span class="op" id="5447143">:</span>&nbsp;<span class="ident" id="5447145">fh</span><span class="op" id="5447147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447151">offset</span><span class="op" id="5447157">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447163">uint64</span><span class="op" id="5447169">(</span><span class="ident" id="5447170">w</span><span class="op" id="5447171">.</span><span class="ident" id="5447172">cw</span><span class="op" id="5447174">.</span><span class="ident" id="5447175">count</span><span class="op" id="5447180">)</span><span class="op" id="5447181">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5447184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447187">w</span><span class="op" id="5447188">.</span><span class="ident" id="5447189">dir</span>&nbsp;<span class="op" id="5447193">=</span>&nbsp;<span class="builtinfunc" id="5447195">append</span><span class="op" id="5447201">(</span><span class="ident" id="5447202">w</span><span class="op" id="5447203">.</span><span class="ident" id="5447204">dir</span><span class="op" id="5447207">,</span>&nbsp;<span class="ident" id="5447209">h</span><span class="op" id="5447210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447213">fw</span><span class="op" id="5447215">.</span><span class="ident" id="5447216">header</span>&nbsp;<span class="op" id="5447223">=</span>&nbsp;<span class="ident" id="5447225">h</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447229">if</span>&nbsp;<span class="ident" id="5447232">err</span>&nbsp;<span class="op" id="5447236">:=</span>&nbsp;<span class="ident" id="5447239">writeHeader</span><span class="op" id="5447250">(</span><span class="ident" id="5447251">w</span><span class="op" id="5447252">.</span><span class="ident" id="5447253">cw</span><span class="op" id="5447255">,</span>&nbsp;<span class="ident" id="5447257">fh</span><span class="op" id="5447259">)</span><span class="op" id="5447260">;</span>&nbsp;<span class="ident" id="5447262">err</span>&nbsp;<span class="op" id="5447266">!=</span>&nbsp;<span class="builtintype" id="5447269">nil</span>&nbsp;<span class="op" id="5447273">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447277">return</span>&nbsp;<span class="builtintype" id="5447284">nil</span><span class="op" id="5447287">,</span>&nbsp;<span class="ident" id="5447289">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5447294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447298">w</span><span class="op" id="5447299">.</span><span class="ident" id="5447300">last</span>&nbsp;<span class="op" id="5447305">=</span>&nbsp;<span class="ident" id="5447307">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447311">return</span>&nbsp;<span class="ident" id="5447318">fw</span><span class="op" id="5447320">,</span>&nbsp;<span class="builtintype" id="5447322">nil</span><br>
<span class="lineno">230</span><span class="op" id="5447326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5447329">func</span>&nbsp;<span class="ident" id="5447334">writeHeader</span><span class="op" id="5447345">(</span><span class="ident" id="5447346">w</span>&nbsp;<span class="ident" id="5447348">io</span><span class="op" id="5447350">.</span><span class="ident" id="5447351">Writer</span><span class="op" id="5447357">,</span>&nbsp;<span class="ident" id="5447359">h</span>&nbsp;<span class="op" id="5447361">*</span><span class="ident" id="5447362">FileHeader</span><span class="op" id="5447372">)</span>&nbsp;<span class="builtintype" id="5447374">error</span>&nbsp;<span class="op" id="5447380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447383">var</span>&nbsp;<span class="ident" id="5447387">buf</span>&nbsp;<span class="op" id="5447391">[</span><span class="ident" id="5447392">fileHeaderLen</span><span class="op" id="5447405">]</span><span class="builtintype" id="5447406">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447412">b</span>&nbsp;<span class="op" id="5447414">:=</span>&nbsp;<span class="ident" id="5447417">writeBuf</span><span class="op" id="5447425">(</span><span class="ident" id="5447426">buf</span><span class="op" id="5447429">[</span><span class="op" id="5447430">:</span><span class="op" id="5447431">]</span><span class="op" id="5447432">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447435">b</span><span class="op" id="5447436">.</span><span class="builtintype" id="5447437">uint32</span><span class="op" id="5447443">(</span><span class="builtintype" id="5447444">uint32</span><span class="op" id="5447450">(</span><span class="ident" id="5447451">fileHeaderSignature</span><span class="op" id="5447470">)</span><span class="op" id="5447471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447474">b</span><span class="op" id="5447475">.</span><span class="builtintype" id="5447476">uint16</span><span class="op" id="5447482">(</span><span class="ident" id="5447483">h</span><span class="op" id="5447484">.</span><span class="ident" id="5447485">ReaderVersion</span><span class="op" id="5447498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447501">b</span><span class="op" id="5447502">.</span><span class="builtintype" id="5447503">uint16</span><span class="op" id="5447509">(</span><span class="ident" id="5447510">h</span><span class="op" id="5447511">.</span><span class="ident" id="5447512">Flags</span><span class="op" id="5447517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447520">b</span><span class="op" id="5447521">.</span><span class="builtintype" id="5447522">uint16</span><span class="op" id="5447528">(</span><span class="ident" id="5447529">h</span><span class="op" id="5447530">.</span><span class="ident" id="5447531">Method</span><span class="op" id="5447537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447540">b</span><span class="op" id="5447541">.</span><span class="builtintype" id="5447542">uint16</span><span class="op" id="5447548">(</span><span class="ident" id="5447549">h</span><span class="op" id="5447550">.</span><span class="ident" id="5447551">ModifiedTime</span><span class="op" id="5447563">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447566">b</span><span class="op" id="5447567">.</span><span class="builtintype" id="5447568">uint16</span><span class="op" id="5447574">(</span><span class="ident" id="5447575">h</span><span class="op" id="5447576">.</span><span class="ident" id="5447577">ModifiedDate</span><span class="op" id="5447589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447592">b</span><span class="op" id="5447593">.</span><span class="builtintype" id="5447594">uint32</span><span class="op" id="5447600">(</span><span class="num" id="5447601">0</span><span class="op" id="5447602">)</span>&nbsp;<span class="comment" id="5447604">//&nbsp;since&nbsp;we&nbsp;are&nbsp;writing&nbsp;a&nbsp;data&nbsp;descriptor&nbsp;crc32,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447654">b</span><span class="op" id="5447655">.</span><span class="builtintype" id="5447656">uint32</span><span class="op" id="5447662">(</span><span class="num" id="5447663">0</span><span class="op" id="5447664">)</span>&nbsp;<span class="comment" id="5447666">//&nbsp;compressed&nbsp;size,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447687">b</span><span class="op" id="5447688">.</span><span class="builtintype" id="5447689">uint32</span><span class="op" id="5447695">(</span><span class="num" id="5447696">0</span><span class="op" id="5447697">)</span>&nbsp;<span class="comment" id="5447699">//&nbsp;and&nbsp;uncompressed&nbsp;size&nbsp;should&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447740">b</span><span class="op" id="5447741">.</span><span class="builtintype" id="5447742">uint16</span><span class="op" id="5447748">(</span><span class="builtintype" id="5447749">uint16</span><span class="op" id="5447755">(</span><span class="builtinfunc" id="5447756">len</span><span class="op" id="5447759">(</span><span class="ident" id="5447760">h</span><span class="op" id="5447761">.</span><span class="ident" id="5447762">Name</span><span class="op" id="5447766">)</span><span class="op" id="5447767">)</span><span class="op" id="5447768">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447771">b</span><span class="op" id="5447772">.</span><span class="builtintype" id="5447773">uint16</span><span class="op" id="5447779">(</span><span class="builtintype" id="5447780">uint16</span><span class="op" id="5447786">(</span><span class="builtinfunc" id="5447787">len</span><span class="op" id="5447790">(</span><span class="ident" id="5447791">h</span><span class="op" id="5447792">.</span><span class="ident" id="5447793">Extra</span><span class="op" id="5447798">)</span><span class="op" id="5447799">)</span><span class="op" id="5447800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447803">if</span>&nbsp;<span class="ident" id="5447806">_</span><span class="op" id="5447807">,</span>&nbsp;<span class="ident" id="5447809">err</span>&nbsp;<span class="op" id="5447813">:=</span>&nbsp;<span class="ident" id="5447816">w</span><span class="op" id="5447817">.</span><span class="ident" id="5447818">Write</span><span class="op" id="5447823">(</span><span class="ident" id="5447824">buf</span><span class="op" id="5447827">[</span><span class="op" id="5447828">:</span><span class="op" id="5447829">]</span><span class="op" id="5447830">)</span><span class="op" id="5447831">;</span>&nbsp;<span class="ident" id="5447833">err</span>&nbsp;<span class="op" id="5447837">!=</span>&nbsp;<span class="builtintype" id="5447840">nil</span>&nbsp;<span class="op" id="5447844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447848">return</span>&nbsp;<span class="ident" id="5447855">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5447860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447863">if</span>&nbsp;<span class="ident" id="5447866">_</span><span class="op" id="5447867">,</span>&nbsp;<span class="ident" id="5447869">err</span>&nbsp;<span class="op" id="5447873">:=</span>&nbsp;<span class="ident" id="5447876">io</span><span class="op" id="5447878">.</span><span class="ident" id="5447879">WriteString</span><span class="op" id="5447890">(</span><span class="ident" id="5447891">w</span><span class="op" id="5447892">,</span>&nbsp;<span class="ident" id="5447894">h</span><span class="op" id="5447895">.</span><span class="ident" id="5447896">Name</span><span class="op" id="5447900">)</span><span class="op" id="5447901">;</span>&nbsp;<span class="ident" id="5447903">err</span>&nbsp;<span class="op" id="5447907">!=</span>&nbsp;<span class="builtintype" id="5447910">nil</span>&nbsp;<span class="op" id="5447914">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447918">return</span>&nbsp;<span class="ident" id="5447925">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5447930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447933">_</span><span class="op" id="5447934">,</span>&nbsp;<span class="ident" id="5447936">err</span>&nbsp;<span class="op" id="5447940">:=</span>&nbsp;<span class="ident" id="5447943">w</span><span class="op" id="5447944">.</span><span class="ident" id="5447945">Write</span><span class="op" id="5447950">(</span><span class="ident" id="5447951">h</span><span class="op" id="5447952">.</span><span class="ident" id="5447953">Extra</span><span class="op" id="5447958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447961">return</span>&nbsp;<span class="ident" id="5447968">err</span><br>
<span class="lineno"></span><span class="op" id="5447972">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="5447975">type</span>&nbsp;<span class="ident" id="5447980">fileWriter</span>&nbsp;<span class="keyword" id="5447991">struct</span>&nbsp;<span class="op" id="5447998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5448001">*</span><span class="ident" id="5448002">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448010">zipw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448020">io</span><span class="op" id="5448022">.</span><span class="ident" id="5448023">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448031">rawCount</span>&nbsp;&nbsp;<span class="op" id="5448041">*</span><span class="ident" id="5448042">countWriter</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448055">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448065">io</span><span class="op" id="5448067">.</span><span class="ident" id="5448068">WriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448081">compCount</span>&nbsp;<span class="op" id="5448091">*</span><span class="ident" id="5448092">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448105">crc32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448115">hash</span><span class="op" id="5448119">.</span><span class="ident" id="5448120">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448128">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5448138">bool</span><br>
<span class="lineno"></span><span class="op" id="5448143">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="5448146">func</span>&nbsp;<span class="op" id="5448151">(</span><span class="ident" id="5448152">w</span>&nbsp;<span class="op" id="5448154">*</span><span class="ident" id="5448155">fileWriter</span><span class="op" id="5448165">)</span>&nbsp;<span class="ident" id="5448167">Write</span><span class="op" id="5448172">(</span><span class="ident" id="5448173">p</span>&nbsp;<span class="op" id="5448175">[</span><span class="op" id="5448176">]</span><span class="builtintype" id="5448177">byte</span><span class="op" id="5448181">)</span>&nbsp;<span class="op" id="5448183">(</span><span class="builtintype" id="5448184">int</span><span class="op" id="5448187">,</span>&nbsp;<span class="builtintype" id="5448189">error</span><span class="op" id="5448194">)</span>&nbsp;<span class="op" id="5448196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448199">if</span>&nbsp;<span class="ident" id="5448202">w</span><span class="op" id="5448203">.</span><span class="ident" id="5448204">closed</span>&nbsp;<span class="op" id="5448211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448215">return</span>&nbsp;<span class="num" id="5448222">0</span><span class="op" id="5448223">,</span>&nbsp;<span class="ident" id="5448225">errors</span><span class="op" id="5448231">.</span><span class="ident" id="5448232">New</span><span class="op" id="5448235">(</span><span class="string" id="5448236">&#34;zip:&nbsp;write&nbsp;to&nbsp;closed&nbsp;file&#34;</span><span class="op" id="5448263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5448266">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448269">w</span><span class="op" id="5448270">.</span><span class="ident" id="5448271">crc32</span><span class="op" id="5448276">.</span><span class="ident" id="5448277">Write</span><span class="op" id="5448282">(</span><span class="ident" id="5448283">p</span><span class="op" id="5448284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448287">return</span>&nbsp;<span class="ident" id="5448294">w</span><span class="op" id="5448295">.</span><span class="ident" id="5448296">rawCount</span><span class="op" id="5448304">.</span><span class="ident" id="5448305">Write</span><span class="op" id="5448310">(</span><span class="ident" id="5448311">p</span><span class="op" id="5448312">)</span><br>
<span class="lineno"></span><span class="op" id="5448314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5448317">func</span>&nbsp;<span class="op" id="5448322">(</span><span class="ident" id="5448323">w</span>&nbsp;<span class="op" id="5448325">*</span><span class="ident" id="5448326">fileWriter</span><span class="op" id="5448336">)</span>&nbsp;<span class="builtinfunc" id="5448338">close</span><span class="op" id="5448343">(</span><span class="op" id="5448344">)</span>&nbsp;<span class="builtintype" id="5448346">error</span>&nbsp;<span class="op" id="5448352">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448355">if</span>&nbsp;<span class="ident" id="5448358">w</span><span class="op" id="5448359">.</span><span class="ident" id="5448360">closed</span>&nbsp;<span class="op" id="5448367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448371">return</span>&nbsp;<span class="ident" id="5448378">errors</span><span class="op" id="5448384">.</span><span class="ident" id="5448385">New</span><span class="op" id="5448388">(</span><span class="string" id="5448389">&#34;zip:&nbsp;file&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="5448413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5448416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448419">w</span><span class="op" id="5448420">.</span><span class="ident" id="5448421">closed</span>&nbsp;<span class="op" id="5448428">=</span>&nbsp;<span class="builtintype" id="5448430">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448436">if</span>&nbsp;<span class="ident" id="5448439">err</span>&nbsp;<span class="op" id="5448443">:=</span>&nbsp;<span class="ident" id="5448446">w</span><span class="op" id="5448447">.</span><span class="ident" id="5448448">comp</span><span class="op" id="5448452">.</span><span class="ident" id="5448453">Close</span><span class="op" id="5448458">(</span><span class="op" id="5448459">)</span><span class="op" id="5448460">;</span>&nbsp;<span class="ident" id="5448462">err</span>&nbsp;<span class="op" id="5448466">!=</span>&nbsp;<span class="builtintype" id="5448469">nil</span>&nbsp;<span class="op" id="5448473">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448477">return</span>&nbsp;<span class="ident" id="5448484">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5448489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5448493">//&nbsp;update&nbsp;FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448515">fh</span>&nbsp;<span class="op" id="5448518">:=</span>&nbsp;<span class="ident" id="5448521">w</span><span class="op" id="5448522">.</span><span class="ident" id="5448523">header</span><span class="op" id="5448529">.</span><span class="ident" id="5448530">FileHeader</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448542">fh</span><span class="op" id="5448544">.</span><span class="ident" id="5448545">CRC32</span>&nbsp;<span class="op" id="5448551">=</span>&nbsp;<span class="ident" id="5448553">w</span><span class="op" id="5448554">.</span><span class="ident" id="5448555">crc32</span><span class="op" id="5448560">.</span><span class="ident" id="5448561">Sum32</span><span class="op" id="5448566">(</span><span class="op" id="5448567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448570">fh</span><span class="op" id="5448572">.</span><span class="ident" id="5448573">CompressedSize64</span>&nbsp;<span class="op" id="5448590">=</span>&nbsp;<span class="ident" id="5448592">uint64</span><span class="op" id="5448598">(</span><span class="ident" id="5448599">w</span><span class="op" id="5448600">.</span><span class="ident" id="5448601">compCount</span><span class="op" id="5448610">.</span><span class="ident" id="5448611">count</span><span class="op" id="5448616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448619">fh</span><span class="op" id="5448621">.</span><span class="ident" id="5448622">UncompressedSize64</span>&nbsp;<span class="op" id="5448641">=</span>&nbsp;<span class="ident" id="5448643">uint64</span><span class="op" id="5448649">(</span><span class="ident" id="5448650">w</span><span class="op" id="5448651">.</span><span class="ident" id="5448652">rawCount</span><span class="op" id="5448660">.</span><span class="ident" id="5448661">count</span><span class="op" id="5448666">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448670">if</span>&nbsp;<span class="ident" id="5448673">fh</span><span class="op" id="5448675">.</span><span class="ident" id="5448676">isZip64</span><span class="op" id="5448683">(</span><span class="op" id="5448684">)</span>&nbsp;<span class="op" id="5448686">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448690">fh</span><span class="op" id="5448692">.</span><span class="ident" id="5448693">CompressedSize</span>&nbsp;<span class="op" id="5448708">=</span>&nbsp;<span class="ident" id="5448710">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448722">fh</span><span class="op" id="5448724">.</span><span class="ident" id="5448725">UncompressedSize</span>&nbsp;<span class="op" id="5448742">=</span>&nbsp;<span class="ident" id="5448744">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448756">fh</span><span class="op" id="5448758">.</span><span class="ident" id="5448759">ReaderVersion</span>&nbsp;<span class="op" id="5448773">=</span>&nbsp;<span class="ident" id="5448775">zipVersion45</span>&nbsp;<span class="comment" id="5448788">//&nbsp;requires&nbsp;4.5&nbsp;-&nbsp;File&nbsp;uses&nbsp;ZIP64&nbsp;format&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5448841">}</span>&nbsp;<span class="keyword" id="5448843">else</span>&nbsp;<span class="op" id="5448848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448852">fh</span><span class="op" id="5448854">.</span><span class="ident" id="5448855">CompressedSize</span>&nbsp;<span class="op" id="5448870">=</span>&nbsp;<span class="builtintype" id="5448872">uint32</span><span class="op" id="5448878">(</span><span class="ident" id="5448879">fh</span><span class="op" id="5448881">.</span><span class="ident" id="5448882">CompressedSize64</span><span class="op" id="5448898">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448902">fh</span><span class="op" id="5448904">.</span><span class="ident" id="5448905">UncompressedSize</span>&nbsp;<span class="op" id="5448922">=</span>&nbsp;<span class="builtintype" id="5448924">uint32</span><span class="op" id="5448930">(</span><span class="ident" id="5448931">fh</span><span class="op" id="5448933">.</span><span class="ident" id="5448934">UncompressedSize64</span><span class="op" id="5448952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5448955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5448959">//&nbsp;Write&nbsp;data&nbsp;descriptor.&nbsp;This&nbsp;is&nbsp;more&nbsp;complicated&nbsp;than&nbsp;one&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5449026">//&nbsp;think,&nbsp;see&nbsp;e.g.&nbsp;comments&nbsp;in&nbsp;zipfile.c:putextended()&nbsp;and</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5449086">//&nbsp;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7073588.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5449150">//&nbsp;The&nbsp;approach&nbsp;here&nbsp;is&nbsp;to&nbsp;write&nbsp;8&nbsp;byte&nbsp;sizes&nbsp;if&nbsp;needed&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5449215">//&nbsp;adding&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;in&nbsp;the&nbsp;local&nbsp;header&nbsp;(too&nbsp;late&nbsp;anyway).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449279">var</span>&nbsp;<span class="ident" id="5449283">buf</span>&nbsp;<span class="op" id="5449287">[</span><span class="op" id="5449288">]</span><span class="builtintype" id="5449289">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449295">if</span>&nbsp;<span class="ident" id="5449298">fh</span><span class="op" id="5449300">.</span><span class="ident" id="5449301">isZip64</span><span class="op" id="5449308">(</span><span class="op" id="5449309">)</span>&nbsp;<span class="op" id="5449311">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449315">buf</span>&nbsp;<span class="op" id="5449319">=</span>&nbsp;<span class="builtinfunc" id="5449321">make</span><span class="op" id="5449325">(</span><span class="op" id="5449326">[</span><span class="op" id="5449327">]</span><span class="builtintype" id="5449328">byte</span><span class="op" id="5449332">,</span>&nbsp;<span class="ident" id="5449334">dataDescriptor64Len</span><span class="op" id="5449353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449356">}</span>&nbsp;<span class="keyword" id="5449358">else</span>&nbsp;<span class="op" id="5449363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449367">buf</span>&nbsp;<span class="op" id="5449371">=</span>&nbsp;<span class="builtinfunc" id="5449373">make</span><span class="op" id="5449377">(</span><span class="op" id="5449378">[</span><span class="op" id="5449379">]</span><span class="builtintype" id="5449380">byte</span><span class="op" id="5449384">,</span>&nbsp;<span class="ident" id="5449386">dataDescriptorLen</span><span class="op" id="5449403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449409">b</span>&nbsp;<span class="op" id="5449411">:=</span>&nbsp;<span class="ident" id="5449414">writeBuf</span><span class="op" id="5449422">(</span><span class="ident" id="5449423">buf</span><span class="op" id="5449426">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449429">b</span><span class="op" id="5449430">.</span><span class="builtintype" id="5449431">uint32</span><span class="op" id="5449437">(</span><span class="ident" id="5449438">dataDescriptorSignature</span><span class="op" id="5449461">)</span>&nbsp;<span class="comment" id="5449463">//&nbsp;de-facto&nbsp;standard,&nbsp;required&nbsp;by&nbsp;OS&nbsp;X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449503">b</span><span class="op" id="5449504">.</span><span class="builtintype" id="5449505">uint32</span><span class="op" id="5449511">(</span><span class="ident" id="5449512">fh</span><span class="op" id="5449514">.</span><span class="ident" id="5449515">CRC32</span><span class="op" id="5449520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449523">if</span>&nbsp;<span class="ident" id="5449526">fh</span><span class="op" id="5449528">.</span><span class="ident" id="5449529">isZip64</span><span class="op" id="5449536">(</span><span class="op" id="5449537">)</span>&nbsp;<span class="op" id="5449539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449543">b</span><span class="op" id="5449544">.</span><span class="ident" id="5449545">uint64</span><span class="op" id="5449551">(</span><span class="ident" id="5449552">fh</span><span class="op" id="5449554">.</span><span class="ident" id="5449555">CompressedSize64</span><span class="op" id="5449571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449575">b</span><span class="op" id="5449576">.</span><span class="ident" id="5449577">uint64</span><span class="op" id="5449583">(</span><span class="ident" id="5449584">fh</span><span class="op" id="5449586">.</span><span class="ident" id="5449587">UncompressedSize64</span><span class="op" id="5449605">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449608">}</span>&nbsp;<span class="keyword" id="5449610">else</span>&nbsp;<span class="op" id="5449615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449619">b</span><span class="op" id="5449620">.</span><span class="builtintype" id="5449621">uint32</span><span class="op" id="5449627">(</span><span class="ident" id="5449628">fh</span><span class="op" id="5449630">.</span><span class="ident" id="5449631">CompressedSize</span><span class="op" id="5449645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449649">b</span><span class="op" id="5449650">.</span><span class="builtintype" id="5449651">uint32</span><span class="op" id="5449657">(</span><span class="ident" id="5449658">fh</span><span class="op" id="5449660">.</span><span class="ident" id="5449661">UncompressedSize</span><span class="op" id="5449677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449683">_</span><span class="op" id="5449684">,</span>&nbsp;<span class="ident" id="5449686">err</span>&nbsp;<span class="op" id="5449690">:=</span>&nbsp;<span class="ident" id="5449693">w</span><span class="op" id="5449694">.</span><span class="ident" id="5449695">zipw</span><span class="op" id="5449699">.</span><span class="ident" id="5449700">Write</span><span class="op" id="5449705">(</span><span class="ident" id="5449706">buf</span><span class="op" id="5449709">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449712">return</span>&nbsp;<span class="ident" id="5449719">err</span><br>
<span class="lineno"></span><span class="op" id="5449723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5449726">type</span>&nbsp;<span class="ident" id="5449731">countWriter</span>&nbsp;<span class="keyword" id="5449743">struct</span>&nbsp;<span class="op" id="5449750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449753">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449759">io</span><span class="op" id="5449761">.</span><span class="ident" id="5449762">Writer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449770">count</span>&nbsp;<span class="ident" id="5449776">int64</span><br>
<span class="lineno"></span><span class="op" id="5449782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5449785">func</span>&nbsp;<span class="op" id="5449790">(</span><span class="ident" id="5449791">w</span>&nbsp;<span class="op" id="5449793">*</span><span class="ident" id="5449794">countWriter</span><span class="op" id="5449805">)</span>&nbsp;<span class="ident" id="5449807">Write</span><span class="op" id="5449812">(</span><span class="ident" id="5449813">p</span>&nbsp;<span class="op" id="5449815">[</span><span class="op" id="5449816">]</span><span class="builtintype" id="5449817">byte</span><span class="op" id="5449821">)</span>&nbsp;<span class="op" id="5449823">(</span><span class="builtintype" id="5449824">int</span><span class="op" id="5449827">,</span>&nbsp;<span class="builtintype" id="5449829">error</span><span class="op" id="5449834">)</span>&nbsp;<span class="op" id="5449836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449839">n</span><span class="op" id="5449840">,</span>&nbsp;<span class="ident" id="5449842">err</span>&nbsp;<span class="op" id="5449846">:=</span>&nbsp;<span class="ident" id="5449849">w</span><span class="op" id="5449850">.</span><span class="ident" id="5449851">w</span><span class="op" id="5449852">.</span><span class="ident" id="5449853">Write</span><span class="op" id="5449858">(</span><span class="ident" id="5449859">p</span><span class="op" id="5449860">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449863">w</span><span class="op" id="5449864">.</span><span class="ident" id="5449865">count</span>&nbsp;<span class="op" id="5449871">+=</span>&nbsp;<span class="ident" id="5449874">int64</span><span class="op" id="5449879">(</span><span class="ident" id="5449880">n</span><span class="op" id="5449881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449884">return</span>&nbsp;<span class="ident" id="5449891">n</span><span class="op" id="5449892">,</span>&nbsp;<span class="ident" id="5449894">err</span><br>
<span class="lineno"></span><span class="op" id="5449898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5449901">type</span>&nbsp;<span class="ident" id="5449906">nopCloser</span>&nbsp;<span class="keyword" id="5449916">struct</span>&nbsp;<span class="op" id="5449923">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449926">io</span><span class="op" id="5449928">.</span><span class="ident" id="5449929">Writer</span><br>
<span class="lineno"></span><span class="op" id="5449936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5449939">func</span>&nbsp;<span class="op" id="5449944">(</span><span class="ident" id="5449945">w</span>&nbsp;<span class="ident" id="5449947">nopCloser</span><span class="op" id="5449956">)</span>&nbsp;<span class="ident" id="5449958">Close</span><span class="op" id="5449963">(</span><span class="op" id="5449964">)</span>&nbsp;<span class="builtintype" id="5449966">error</span>&nbsp;<span class="op" id="5449972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449975">return</span>&nbsp;<span class="builtintype" id="5449982">nil</span><br>
<span class="lineno">340</span><span class="op" id="5449986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5449989">type</span>&nbsp;<span class="ident" id="5449994">writeBuf</span>&nbsp;<span class="op" id="5450003">[</span><span class="op" id="5450004">]</span><span class="builtintype" id="5450005">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5450011">func</span>&nbsp;<span class="op" id="5450016">(</span><span class="ident" id="5450017">b</span>&nbsp;<span class="op" id="5450019">*</span><span class="ident" id="5450020">writeBuf</span><span class="op" id="5450028">)</span>&nbsp;<span class="builtintype" id="5450030">uint16</span><span class="op" id="5450036">(</span><span class="ident" id="5450037">v</span>&nbsp;<span class="builtintype" id="5450039">uint16</span><span class="op" id="5450045">)</span>&nbsp;<span class="op" id="5450047">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450050">binary</span><span class="op" id="5450056">.</span><span class="ident" id="5450057">LittleEndian</span><span class="op" id="5450069">.</span><span class="ident" id="5450070">PutUint16</span><span class="op" id="5450079">(</span><span class="op" id="5450080">*</span><span class="ident" id="5450081">b</span><span class="op" id="5450082">,</span>&nbsp;<span class="ident" id="5450084">v</span><span class="op" id="5450085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450088">*</span><span class="ident" id="5450089">b</span>&nbsp;<span class="op" id="5450091">=</span>&nbsp;<span class="op" id="5450093">(</span><span class="op" id="5450094">*</span><span class="ident" id="5450095">b</span><span class="op" id="5450096">)</span><span class="op" id="5450097">[</span><span class="num" id="5450098">2</span><span class="op" id="5450099">:</span><span class="op" id="5450100">]</span><br>
<span class="lineno"></span><span class="op" id="5450102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5450105">func</span>&nbsp;<span class="op" id="5450110">(</span><span class="ident" id="5450111">b</span>&nbsp;<span class="op" id="5450113">*</span><span class="ident" id="5450114">writeBuf</span><span class="op" id="5450122">)</span>&nbsp;<span class="builtintype" id="5450124">uint32</span><span class="op" id="5450130">(</span><span class="ident" id="5450131">v</span>&nbsp;<span class="builtintype" id="5450133">uint32</span><span class="op" id="5450139">)</span>&nbsp;<span class="op" id="5450141">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450144">binary</span><span class="op" id="5450150">.</span><span class="ident" id="5450151">LittleEndian</span><span class="op" id="5450163">.</span><span class="ident" id="5450164">PutUint32</span><span class="op" id="5450173">(</span><span class="op" id="5450174">*</span><span class="ident" id="5450175">b</span><span class="op" id="5450176">,</span>&nbsp;<span class="ident" id="5450178">v</span><span class="op" id="5450179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450182">*</span><span class="ident" id="5450183">b</span>&nbsp;<span class="op" id="5450185">=</span>&nbsp;<span class="op" id="5450187">(</span><span class="op" id="5450188">*</span><span class="ident" id="5450189">b</span><span class="op" id="5450190">)</span><span class="op" id="5450191">[</span><span class="num" id="5450192">4</span><span class="op" id="5450193">:</span><span class="op" id="5450194">]</span><br>
<span class="lineno"></span><span class="op" id="5450196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5450199">func</span>&nbsp;<span class="op" id="5450204">(</span><span class="ident" id="5450205">b</span>&nbsp;<span class="op" id="5450207">*</span><span class="ident" id="5450208">writeBuf</span><span class="op" id="5450216">)</span>&nbsp;<span class="ident" id="5450218">uint64</span><span class="op" id="5450224">(</span><span class="ident" id="5450225">v</span>&nbsp;<span class="ident" id="5450227">uint64</span><span class="op" id="5450233">)</span>&nbsp;<span class="op" id="5450235">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450238">binary</span><span class="op" id="5450244">.</span><span class="ident" id="5450245">LittleEndian</span><span class="op" id="5450257">.</span><span class="ident" id="5450258">PutUint64</span><span class="op" id="5450267">(</span><span class="op" id="5450268">*</span><span class="ident" id="5450269">b</span><span class="op" id="5450270">,</span>&nbsp;<span class="ident" id="5450272">v</span><span class="op" id="5450273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450276">*</span><span class="ident" id="5450277">b</span>&nbsp;<span class="op" id="5450279">=</span>&nbsp;<span class="op" id="5450281">(</span><span class="op" id="5450282">*</span><span class="ident" id="5450283">b</span><span class="op" id="5450284">)</span><span class="op" id="5450285">[</span><span class="num" id="5450286">8</span><span class="op" id="5450287">:</span><span class="op" id="5450288">]</span><br>
<span class="lineno"></span><span class="op" id="5450290">}</span>
</div>
</body>
</html>
