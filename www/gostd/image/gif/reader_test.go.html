<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7550231">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7550286">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7550340">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7550391">package</span>&nbsp;<span class="ident" id="7550399">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7550404">import</span>&nbsp;<span class="op" id="7550411">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7550414">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7550423">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7550439">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7550448">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7550463">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7550474">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7550484">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7550487">//&nbsp;header,&nbsp;palette&nbsp;and&nbsp;trailer&nbsp;are&nbsp;parts&nbsp;of&nbsp;a&nbsp;valid&nbsp;2x1&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="7550554">const</span>&nbsp;<span class="op" id="7550560">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7550563">headerStr</span>&nbsp;<span class="op" id="7550573">=</span>&nbsp;<span class="string" id="7550575">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="7550584">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7550588">&#34;\x02\x00\x01\x00&#34;</span>&nbsp;<span class="op" id="7550607">+</span>&nbsp;<span class="comment" id="7550609">//&nbsp;width=2,&nbsp;height=1</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7550632">&#34;\x80\x00\x00&#34;</span>&nbsp;<span class="comment" id="7550647">//&nbsp;headerFields=(a&nbsp;color&nbsp;map&nbsp;of&nbsp;2&nbsp;pixels),&nbsp;backgroundIndex,&nbsp;aspect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7550715">paletteStr</span>&nbsp;<span class="op" id="7550726">=</span>&nbsp;<span class="string" id="7550728">&#34;\x10\x20\x30\x40\x50\x60&#34;</span>&nbsp;<span class="comment" id="7550755">//&nbsp;the&nbsp;color&nbsp;map,&nbsp;also&nbsp;known&nbsp;as&nbsp;a&nbsp;palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7550798">trailerStr</span>&nbsp;<span class="op" id="7550809">=</span>&nbsp;<span class="string" id="7550811">&#34;\x3b&#34;</span><br>
<span class="lineno"></span><span class="op" id="7550818">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="7550821">//&nbsp;lzwEncode&nbsp;returns&nbsp;an&nbsp;LZW&nbsp;encoding&nbsp;(with&nbsp;2-bit&nbsp;literals)&nbsp;of&nbsp;n&nbsp;zeroes.</span><br>
<span class="lineno"></span><span class="keyword" id="7550893">func</span>&nbsp;<span class="ident" id="7550898">lzwEncode</span><span class="op" id="7550907">(</span><span class="ident" id="7550908">n</span>&nbsp;<span class="builtintype" id="7550910">int</span><span class="op" id="7550913">)</span>&nbsp;<span class="op" id="7550915">[</span><span class="op" id="7550916">]</span><span class="builtintype" id="7550917">byte</span>&nbsp;<span class="op" id="7550922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7550925">b</span>&nbsp;<span class="op" id="7550927">:=</span>&nbsp;<span class="op" id="7550930">&amp;</span><span class="ident" id="7550931">bytes</span><span class="op" id="7550936">.</span><span class="ident" id="7550937">Buffer</span><span class="op" id="7550943">{</span><span class="op" id="7550944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7550947">w</span>&nbsp;<span class="op" id="7550949">:=</span>&nbsp;<span class="ident" id="7550952">lzw</span><span class="op" id="7550955">.</span><span class="ident" id="7550956">NewWriter</span><span class="op" id="7550965">(</span><span class="ident" id="7550966">b</span><span class="op" id="7550967">,</span>&nbsp;<span class="ident" id="7550969">lzw</span><span class="op" id="7550972">.</span><span class="ident" id="7550973">LSB</span><span class="op" id="7550976">,</span>&nbsp;<span class="num" id="7550978">2</span><span class="op" id="7550979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7550982">w</span><span class="op" id="7550983">.</span><span class="ident" id="7550984">Write</span><span class="op" id="7550989">(</span><span class="builtinfunc" id="7550990">make</span><span class="op" id="7550994">(</span><span class="op" id="7550995">[</span><span class="op" id="7550996">]</span><span class="builtintype" id="7550997">byte</span><span class="op" id="7551001">,</span>&nbsp;<span class="ident" id="7551003">n</span><span class="op" id="7551004">)</span><span class="op" id="7551005">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7551008">w</span><span class="op" id="7551009">.</span><span class="ident" id="7551010">Close</span><span class="op" id="7551015">(</span><span class="op" id="7551016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7551019">return</span>&nbsp;<span class="ident" id="7551026">b</span><span class="op" id="7551027">.</span><span class="ident" id="7551028">Bytes</span><span class="op" id="7551033">(</span><span class="op" id="7551034">)</span><br>
<span class="lineno"></span><span class="op" id="7551036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7551039">func</span>&nbsp;<span class="ident" id="7551044">TestDecode</span><span class="op" id="7551054">(</span><span class="ident" id="7551055">t</span>&nbsp;<span class="op" id="7551057">*</span><span class="ident" id="7551058">testing</span><span class="op" id="7551065">.</span><span class="ident" id="7551066">T</span><span class="op" id="7551067">)</span>&nbsp;<span class="op" id="7551069">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7551072">testCases</span>&nbsp;<span class="op" id="7551082">:=</span>&nbsp;<span class="op" id="7551085">[</span><span class="op" id="7551086">]</span><span class="keyword" id="7551087">struct</span>&nbsp;<span class="op" id="7551094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7551098">nPix</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7551106">int</span>&nbsp;&nbsp;<span class="comment" id="7551111">//&nbsp;The&nbsp;number&nbsp;of&nbsp;pixels&nbsp;in&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7551156">extra</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7551164">bool</span>&nbsp;<span class="comment" id="7551169">//&nbsp;Whether&nbsp;to&nbsp;write&nbsp;an&nbsp;extra&nbsp;block&nbsp;after&nbsp;the&nbsp;LZW-encoded&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7551234">wantErr</span>&nbsp;<span class="builtintype" id="7551242">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7551249">}</span><span class="op" id="7551250">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7551254">{</span><span class="num" id="7551255">0</span><span class="op" id="7551256">,</span>&nbsp;<span class="builtintype" id="7551258">false</span><span class="op" id="7551263">,</span>&nbsp;<span class="ident" id="7551265">errNotEnough</span><span class="op" id="7551277">}</span><span class="op" id="7551278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7551282">{</span><span class="num" id="7551283">1</span><span class="op" id="7551284">,</span>&nbsp;<span class="builtintype" id="7551286">false</span><span class="op" id="7551291">,</span>&nbsp;<span class="ident" id="7551293">errNotEnough</span><span class="op" id="7551305">}</span><span class="op" id="7551306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7551310">{</span><span class="num" id="7551311">2</span><span class="op" id="7551312">,</span>&nbsp;<span class="builtintype" id="7551314">false</span><span class="op" id="7551319">,</span>&nbsp;<span class="ident" id="7551321">nil</span><span class="op" id="7551324">}</span><span class="op" id="7551325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7551329">{</span><span class="num" id="7551330">2</span><span class="op" id="7551331">,</span>&nbsp;<span class="builtintype" id="7551333">true</span><span class="op" id="7551337">,</span>&nbsp;<span class="ident" id="7551339">errTooMuch</span><span class="op" id="7551349">}</span><span class="op" id="7551350">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7551354">{</span><span class="num" id="7551355">3</span><span class="op" id="7551356">,</span>&nbsp;<span class="builtintype" id="7551358">false</span><span class="op" id="7551363">,</span>&nbsp;<span class="ident" id="7551365">errTooMuch</span><span class="op" id="7551375">}</span><span class="op" id="7551376">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7551379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7551382">for</span>&nbsp;<span class="ident" id="7551386">_</span><span class="op" id="7551387">,</span>&nbsp;<span class="ident" id="7551389">tc</span>&nbsp;<span class="op" id="7551392">:=</span>&nbsp;<span class="keyword" id="7551395">range</span>&nbsp;<span class="ident" id="7551401">testCases</span>&nbsp;<span class="op" id="7551411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7551415">b</span>&nbsp;<span class="op" id="7551417">:=</span>&nbsp;<span class="op" id="7551420">&amp;</span><span class="ident" id="7551421">bytes</span><span class="op" id="7551426">.</span><span class="ident" id="7551427">Buffer</span><span class="op" id="7551433">{</span><span class="op" id="7551434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7551438">b</span><span class="op" id="7551439">.</span><span class="ident" id="7551440">WriteString</span><span class="op" id="7551451">(</span><span class="ident" id="7551452">headerStr</span><span class="op" id="7551461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7551465">b</span><span class="op" id="7551466">.</span><span class="ident" id="7551467">WriteString</span><span class="op" id="7551478">(</span><span class="ident" id="7551479">paletteStr</span><span class="op" id="7551489">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7551493">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1&nbsp;but&nbsp;tc.nPix&nbsp;pixels.&nbsp;If&nbsp;tc.nPix&nbsp;!=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7551565">//&nbsp;then&nbsp;this&nbsp;should&nbsp;result&nbsp;in&nbsp;an&nbsp;invalid&nbsp;GIF&nbsp;image.&nbsp;First,&nbsp;write&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7551634">//&nbsp;magic&nbsp;0x2c&nbsp;(image&nbsp;descriptor)&nbsp;byte,&nbsp;bounds=(0,0)-(2,1),&nbsp;a&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7551703">//&nbsp;byte,&nbsp;and&nbsp;2-bit&nbsp;LZW&nbsp;literals.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7551738">b</span><span class="op" id="7551739">.</span><span class="ident" id="7551740">WriteString</span><span class="op" id="7551751">(</span><span class="string" id="7551752">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7551798">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7551802">if</span>&nbsp;<span class="ident" id="7551805">tc</span><span class="op" id="7551807">.</span><span class="ident" id="7551808">nPix</span>&nbsp;<span class="op" id="7551813">&gt;</span>&nbsp;<span class="num" id="7551815">0</span>&nbsp;<span class="op" id="7551817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7551822">enc</span>&nbsp;<span class="op" id="7551826">:=</span>&nbsp;<span class="ident" id="7551829">lzwEncode</span><span class="op" id="7551838">(</span><span class="ident" id="7551839">tc</span><span class="op" id="7551841">.</span><span class="ident" id="7551842">nPix</span><span class="op" id="7551846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7551851">if</span>&nbsp;<span class="builtinfunc" id="7551854">len</span><span class="op" id="7551857">(</span><span class="ident" id="7551858">enc</span><span class="op" id="7551861">)</span>&nbsp;<span class="op" id="7551863">&gt;</span>&nbsp;<span class="num" id="7551865">0xff</span>&nbsp;<span class="op" id="7551870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7551876">t</span><span class="op" id="7551877">.</span><span class="ident" id="7551878">Errorf</span><span class="op" id="7551884">(</span><span class="string" id="7551885">&#34;nPix=%d,&nbsp;extra=%t:&nbsp;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="7551939">,</span>&nbsp;<span class="ident" id="7551941">tc</span><span class="op" id="7551943">.</span><span class="ident" id="7551944">nPix</span><span class="op" id="7551948">,</span>&nbsp;<span class="ident" id="7551950">tc</span><span class="op" id="7551952">.</span><span class="ident" id="7551953">extra</span><span class="op" id="7551958">,</span>&nbsp;<span class="builtinfunc" id="7551960">len</span><span class="op" id="7551963">(</span><span class="ident" id="7551964">enc</span><span class="op" id="7551967">)</span><span class="op" id="7551968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7551974">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7551986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7551991">b</span><span class="op" id="7551992">.</span><span class="ident" id="7551993">WriteByte</span><span class="op" id="7552002">(</span><span class="builtintype" id="7552003">byte</span><span class="op" id="7552007">(</span><span class="builtinfunc" id="7552008">len</span><span class="op" id="7552011">(</span><span class="ident" id="7552012">enc</span><span class="op" id="7552015">)</span><span class="op" id="7552016">)</span><span class="op" id="7552017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7552022">b</span><span class="op" id="7552023">.</span><span class="ident" id="7552024">Write</span><span class="op" id="7552029">(</span><span class="ident" id="7552030">enc</span><span class="op" id="7552033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7552037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7552041">if</span>&nbsp;<span class="ident" id="7552044">tc</span><span class="op" id="7552046">.</span><span class="ident" id="7552047">extra</span>&nbsp;<span class="op" id="7552053">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7552058">b</span><span class="op" id="7552059">.</span><span class="ident" id="7552060">WriteString</span><span class="op" id="7552071">(</span><span class="string" id="7552072">&#34;\x01\x02&#34;</span><span class="op" id="7552082">)</span>&nbsp;<span class="comment" id="7552084">//&nbsp;A&nbsp;1-byte&nbsp;payload&nbsp;with&nbsp;an&nbsp;0x02&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7552125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7552129">b</span><span class="op" id="7552130">.</span><span class="ident" id="7552131">WriteByte</span><span class="op" id="7552140">(</span><span class="num" id="7552141">0x00</span><span class="op" id="7552145">)</span>&nbsp;<span class="comment" id="7552147">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7552204">b</span><span class="op" id="7552205">.</span><span class="ident" id="7552206">WriteString</span><span class="op" id="7552217">(</span><span class="ident" id="7552218">trailerStr</span><span class="op" id="7552228">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7552233">got</span><span class="op" id="7552236">,</span>&nbsp;<span class="ident" id="7552238">err</span>&nbsp;<span class="op" id="7552242">:=</span>&nbsp;<span class="ident" id="7552245">Decode</span><span class="op" id="7552251">(</span><span class="ident" id="7552252">b</span><span class="op" id="7552253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7552257">if</span>&nbsp;<span class="ident" id="7552260">err</span>&nbsp;<span class="op" id="7552264">!=</span>&nbsp;<span class="ident" id="7552267">tc</span><span class="op" id="7552269">.</span><span class="ident" id="7552270">wantErr</span>&nbsp;<span class="op" id="7552278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7552283">t</span><span class="op" id="7552284">.</span><span class="ident" id="7552285">Errorf</span><span class="op" id="7552291">(</span><span class="string" id="7552292">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7552329">,</span>&nbsp;<span class="ident" id="7552331">tc</span><span class="op" id="7552333">.</span><span class="ident" id="7552334">nPix</span><span class="op" id="7552338">,</span>&nbsp;<span class="ident" id="7552340">tc</span><span class="op" id="7552342">.</span><span class="ident" id="7552343">extra</span><span class="op" id="7552348">,</span>&nbsp;<span class="ident" id="7552350">err</span><span class="op" id="7552353">,</span>&nbsp;<span class="ident" id="7552355">tc</span><span class="op" id="7552357">.</span><span class="ident" id="7552358">wantErr</span><span class="op" id="7552365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7552369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7552374">if</span>&nbsp;<span class="ident" id="7552377">tc</span><span class="op" id="7552379">.</span><span class="ident" id="7552380">wantErr</span>&nbsp;<span class="op" id="7552388">!=</span>&nbsp;<span class="ident" id="7552391">nil</span>&nbsp;<span class="op" id="7552395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7552400">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7552411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7552415">want</span>&nbsp;<span class="op" id="7552420">:=</span>&nbsp;<span class="op" id="7552423">&amp;</span><span class="ident" id="7552424">image</span><span class="op" id="7552429">.</span><span class="ident" id="7552430">Paletted</span><span class="op" id="7552438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7552443">Pix</span><span class="op" id="7552446">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7552451">[</span><span class="op" id="7552452">]</span><span class="builtintype" id="7552453">uint8</span><span class="op" id="7552458">{</span><span class="num" id="7552459">0</span><span class="op" id="7552460">,</span>&nbsp;<span class="num" id="7552462">0</span><span class="op" id="7552463">}</span><span class="op" id="7552464">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7552469">Stride</span><span class="op" id="7552475">:</span>&nbsp;<span class="num" id="7552477">2</span><span class="op" id="7552478">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7552483">Rect</span><span class="op" id="7552487">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7552491">image</span><span class="op" id="7552496">.</span><span class="ident" id="7552497">Rect</span><span class="op" id="7552501">(</span><span class="num" id="7552502">0</span><span class="op" id="7552503">,</span>&nbsp;<span class="num" id="7552505">0</span><span class="op" id="7552506">,</span>&nbsp;<span class="num" id="7552508">2</span><span class="op" id="7552509">,</span>&nbsp;<span class="num" id="7552511">1</span><span class="op" id="7552512">)</span><span class="op" id="7552513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7552518">Palette</span><span class="op" id="7552525">:</span>&nbsp;<span class="ident" id="7552527">color</span><span class="op" id="7552532">.</span><span class="ident" id="7552533">Palette</span><span class="op" id="7552540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7552546">color</span><span class="op" id="7552551">.</span><span class="ident" id="7552552">RGBA</span><span class="op" id="7552556">{</span><span class="num" id="7552557">0x10</span><span class="op" id="7552561">,</span>&nbsp;<span class="num" id="7552563">0x20</span><span class="op" id="7552567">,</span>&nbsp;<span class="num" id="7552569">0x30</span><span class="op" id="7552573">,</span>&nbsp;<span class="num" id="7552575">0xff</span><span class="op" id="7552579">}</span><span class="op" id="7552580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7552586">color</span><span class="op" id="7552591">.</span><span class="ident" id="7552592">RGBA</span><span class="op" id="7552596">{</span><span class="num" id="7552597">0x40</span><span class="op" id="7552601">,</span>&nbsp;<span class="num" id="7552603">0x50</span><span class="op" id="7552607">,</span>&nbsp;<span class="num" id="7552609">0x60</span><span class="op" id="7552613">,</span>&nbsp;<span class="num" id="7552615">0xff</span><span class="op" id="7552619">}</span><span class="op" id="7552620">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7552625">}</span><span class="op" id="7552626">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7552630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7552634">if</span>&nbsp;<span class="op" id="7552637">!</span><span class="ident" id="7552638">reflect</span><span class="op" id="7552645">.</span><span class="ident" id="7552646">DeepEqual</span><span class="op" id="7552655">(</span><span class="ident" id="7552656">got</span><span class="op" id="7552659">,</span>&nbsp;<span class="ident" id="7552661">want</span><span class="op" id="7552665">)</span>&nbsp;<span class="op" id="7552667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7552672">t</span><span class="op" id="7552673">.</span><span class="ident" id="7552674">Errorf</span><span class="op" id="7552680">(</span><span class="string" id="7552681">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7552718">,</span>&nbsp;<span class="ident" id="7552720">tc</span><span class="op" id="7552722">.</span><span class="ident" id="7552723">nPix</span><span class="op" id="7552727">,</span>&nbsp;<span class="ident" id="7552729">tc</span><span class="op" id="7552731">.</span><span class="ident" id="7552732">extra</span><span class="op" id="7552737">,</span>&nbsp;<span class="ident" id="7552739">got</span><span class="op" id="7552742">,</span>&nbsp;<span class="ident" id="7552744">want</span><span class="op" id="7552748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7552752">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7552755">}</span><br>
<span class="lineno"></span><span class="op" id="7552757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7552760">func</span>&nbsp;<span class="ident" id="7552765">TestTransparentIndex</span><span class="op" id="7552785">(</span><span class="ident" id="7552786">t</span>&nbsp;<span class="op" id="7552788">*</span><span class="ident" id="7552789">testing</span><span class="op" id="7552796">.</span><span class="ident" id="7552797">T</span><span class="op" id="7552798">)</span>&nbsp;<span class="op" id="7552800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7552803">b</span>&nbsp;<span class="op" id="7552805">:=</span>&nbsp;<span class="op" id="7552808">&amp;</span><span class="ident" id="7552809">bytes</span><span class="op" id="7552814">.</span><span class="ident" id="7552815">Buffer</span><span class="op" id="7552821">{</span><span class="op" id="7552822">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7552825">b</span><span class="op" id="7552826">.</span><span class="ident" id="7552827">WriteString</span><span class="op" id="7552838">(</span><span class="ident" id="7552839">headerStr</span><span class="op" id="7552848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7552851">b</span><span class="op" id="7552852">.</span><span class="ident" id="7552853">WriteString</span><span class="op" id="7552864">(</span><span class="ident" id="7552865">paletteStr</span><span class="op" id="7552875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7552878">for</span>&nbsp;<span class="ident" id="7552882">transparentIndex</span>&nbsp;<span class="op" id="7552899">:=</span>&nbsp;<span class="num" id="7552902">0</span><span class="op" id="7552903">;</span>&nbsp;<span class="ident" id="7552905">transparentIndex</span>&nbsp;<span class="op" id="7552922">&lt;</span>&nbsp;<span class="num" id="7552924">3</span><span class="op" id="7552925">;</span>&nbsp;<span class="ident" id="7552927">transparentIndex</span><span class="op" id="7552943">++</span>&nbsp;<span class="op" id="7552946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7552950">if</span>&nbsp;<span class="ident" id="7552953">transparentIndex</span>&nbsp;<span class="op" id="7552970">&lt;</span>&nbsp;<span class="num" id="7552972">2</span>&nbsp;<span class="op" id="7552974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7552979">//&nbsp;Write&nbsp;the&nbsp;graphic&nbsp;control&nbsp;for&nbsp;the&nbsp;transparent&nbsp;index.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553038">b</span><span class="op" id="7553039">.</span><span class="ident" id="7553040">WriteString</span><span class="op" id="7553051">(</span><span class="string" id="7553052">&#34;\x21\xf9\x00\x01\x00\x00&#34;</span><span class="op" id="7553078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553083">b</span><span class="op" id="7553084">.</span><span class="ident" id="7553085">WriteByte</span><span class="op" id="7553094">(</span><span class="builtintype" id="7553095">byte</span><span class="op" id="7553099">(</span><span class="ident" id="7553100">transparentIndex</span><span class="op" id="7553116">)</span><span class="op" id="7553117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553122">b</span><span class="op" id="7553123">.</span><span class="ident" id="7553124">WriteByte</span><span class="op" id="7553133">(</span><span class="num" id="7553134">0</span><span class="op" id="7553135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7553139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7553143">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1,&nbsp;as&nbsp;per&nbsp;TestDecode.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553199">b</span><span class="op" id="7553200">.</span><span class="ident" id="7553201">WriteString</span><span class="op" id="7553212">(</span><span class="string" id="7553213">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7553259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553263">enc</span>&nbsp;<span class="op" id="7553267">:=</span>&nbsp;<span class="ident" id="7553270">lzwEncode</span><span class="op" id="7553279">(</span><span class="num" id="7553280">2</span><span class="op" id="7553281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7553285">if</span>&nbsp;<span class="builtinfunc" id="7553288">len</span><span class="op" id="7553291">(</span><span class="ident" id="7553292">enc</span><span class="op" id="7553295">)</span>&nbsp;<span class="op" id="7553297">&gt;</span>&nbsp;<span class="num" id="7553299">0xff</span>&nbsp;<span class="op" id="7553304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553309">t</span><span class="op" id="7553310">.</span><span class="ident" id="7553311">Fatalf</span><span class="op" id="7553317">(</span><span class="string" id="7553318">&#34;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="7553353">,</span>&nbsp;<span class="builtinfunc" id="7553355">len</span><span class="op" id="7553358">(</span><span class="ident" id="7553359">enc</span><span class="op" id="7553362">)</span><span class="op" id="7553363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7553367">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553371">b</span><span class="op" id="7553372">.</span><span class="ident" id="7553373">WriteByte</span><span class="op" id="7553382">(</span><span class="builtintype" id="7553383">byte</span><span class="op" id="7553387">(</span><span class="builtinfunc" id="7553388">len</span><span class="op" id="7553391">(</span><span class="ident" id="7553392">enc</span><span class="op" id="7553395">)</span><span class="op" id="7553396">)</span><span class="op" id="7553397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553401">b</span><span class="op" id="7553402">.</span><span class="ident" id="7553403">Write</span><span class="op" id="7553408">(</span><span class="ident" id="7553409">enc</span><span class="op" id="7553412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553416">b</span><span class="op" id="7553417">.</span><span class="ident" id="7553418">WriteByte</span><span class="op" id="7553427">(</span><span class="num" id="7553428">0x00</span><span class="op" id="7553432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7553435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553438">b</span><span class="op" id="7553439">.</span><span class="ident" id="7553440">WriteString</span><span class="op" id="7553451">(</span><span class="ident" id="7553452">trailerStr</span><span class="op" id="7553462">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553466">g</span><span class="op" id="7553467">,</span>&nbsp;<span class="ident" id="7553469">err</span>&nbsp;<span class="op" id="7553473">:=</span>&nbsp;<span class="ident" id="7553476">DecodeAll</span><span class="op" id="7553485">(</span><span class="ident" id="7553486">b</span><span class="op" id="7553487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7553490">if</span>&nbsp;<span class="ident" id="7553493">err</span>&nbsp;<span class="op" id="7553497">!=</span>&nbsp;<span class="ident" id="7553500">nil</span>&nbsp;<span class="op" id="7553504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553508">t</span><span class="op" id="7553509">.</span><span class="ident" id="7553510">Fatalf</span><span class="op" id="7553516">(</span><span class="string" id="7553517">&#34;DecodeAll:&nbsp;%v&#34;</span><span class="op" id="7553532">,</span>&nbsp;<span class="ident" id="7553534">err</span><span class="op" id="7553537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7553540">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553543">c0</span>&nbsp;<span class="op" id="7553546">:=</span>&nbsp;<span class="ident" id="7553549">color</span><span class="op" id="7553554">.</span><span class="ident" id="7553555">RGBA</span><span class="op" id="7553559">{</span><span class="ident" id="7553560">paletteStr</span><span class="op" id="7553570">[</span><span class="num" id="7553571">0</span><span class="op" id="7553572">]</span><span class="op" id="7553573">,</span>&nbsp;<span class="ident" id="7553575">paletteStr</span><span class="op" id="7553585">[</span><span class="num" id="7553586">1</span><span class="op" id="7553587">]</span><span class="op" id="7553588">,</span>&nbsp;<span class="ident" id="7553590">paletteStr</span><span class="op" id="7553600">[</span><span class="num" id="7553601">2</span><span class="op" id="7553602">]</span><span class="op" id="7553603">,</span>&nbsp;<span class="num" id="7553605">0xff</span><span class="op" id="7553609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553612">c1</span>&nbsp;<span class="op" id="7553615">:=</span>&nbsp;<span class="ident" id="7553618">color</span><span class="op" id="7553623">.</span><span class="ident" id="7553624">RGBA</span><span class="op" id="7553628">{</span><span class="ident" id="7553629">paletteStr</span><span class="op" id="7553639">[</span><span class="num" id="7553640">3</span><span class="op" id="7553641">]</span><span class="op" id="7553642">,</span>&nbsp;<span class="ident" id="7553644">paletteStr</span><span class="op" id="7553654">[</span><span class="num" id="7553655">4</span><span class="op" id="7553656">]</span><span class="op" id="7553657">,</span>&nbsp;<span class="ident" id="7553659">paletteStr</span><span class="op" id="7553669">[</span><span class="num" id="7553670">5</span><span class="op" id="7553671">]</span><span class="op" id="7553672">,</span>&nbsp;<span class="num" id="7553674">0xff</span><span class="op" id="7553678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553681">cz</span>&nbsp;<span class="op" id="7553684">:=</span>&nbsp;<span class="ident" id="7553687">color</span><span class="op" id="7553692">.</span><span class="ident" id="7553693">RGBA</span><span class="op" id="7553697">{</span><span class="op" id="7553698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553701">wants</span>&nbsp;<span class="op" id="7553707">:=</span>&nbsp;<span class="op" id="7553710">[</span><span class="op" id="7553711">]</span><span class="ident" id="7553712">color</span><span class="op" id="7553717">.</span><span class="ident" id="7553718">Palette</span><span class="op" id="7553725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7553729">{</span><span class="ident" id="7553730">cz</span><span class="op" id="7553732">,</span>&nbsp;<span class="ident" id="7553734">c1</span><span class="op" id="7553736">}</span><span class="op" id="7553737">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7553741">{</span><span class="ident" id="7553742">c0</span><span class="op" id="7553744">,</span>&nbsp;<span class="ident" id="7553746">cz</span><span class="op" id="7553748">}</span><span class="op" id="7553749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7553753">{</span><span class="ident" id="7553754">c0</span><span class="op" id="7553756">,</span>&nbsp;<span class="ident" id="7553758">c1</span><span class="op" id="7553760">}</span><span class="op" id="7553761">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7553764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7553767">if</span>&nbsp;<span class="builtinfunc" id="7553770">len</span><span class="op" id="7553773">(</span><span class="ident" id="7553774">g</span><span class="op" id="7553775">.</span><span class="ident" id="7553776">Image</span><span class="op" id="7553781">)</span>&nbsp;<span class="op" id="7553783">!=</span>&nbsp;<span class="builtinfunc" id="7553786">len</span><span class="op" id="7553789">(</span><span class="ident" id="7553790">wants</span><span class="op" id="7553795">)</span>&nbsp;<span class="op" id="7553797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553801">t</span><span class="op" id="7553802">.</span><span class="ident" id="7553803">Fatalf</span><span class="op" id="7553809">(</span><span class="string" id="7553810">&#34;got&nbsp;%d&nbsp;images,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7553834">,</span>&nbsp;<span class="builtinfunc" id="7553836">len</span><span class="op" id="7553839">(</span><span class="ident" id="7553840">g</span><span class="op" id="7553841">.</span><span class="ident" id="7553842">Image</span><span class="op" id="7553847">)</span><span class="op" id="7553848">,</span>&nbsp;<span class="builtinfunc" id="7553850">len</span><span class="op" id="7553853">(</span><span class="ident" id="7553854">wants</span><span class="op" id="7553859">)</span><span class="op" id="7553860">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7553863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7553866">for</span>&nbsp;<span class="ident" id="7553870">i</span><span class="op" id="7553871">,</span>&nbsp;<span class="ident" id="7553873">want</span>&nbsp;<span class="op" id="7553878">:=</span>&nbsp;<span class="keyword" id="7553881">range</span>&nbsp;<span class="ident" id="7553887">wants</span>&nbsp;<span class="op" id="7553893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553897">got</span>&nbsp;<span class="op" id="7553901">:=</span>&nbsp;<span class="ident" id="7553904">g</span><span class="op" id="7553905">.</span><span class="ident" id="7553906">Image</span><span class="op" id="7553911">[</span><span class="ident" id="7553912">i</span><span class="op" id="7553913">]</span><span class="op" id="7553914">.</span><span class="ident" id="7553915">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7553925">if</span>&nbsp;<span class="op" id="7553928">!</span><span class="ident" id="7553929">reflect</span><span class="op" id="7553936">.</span><span class="ident" id="7553937">DeepEqual</span><span class="op" id="7553946">(</span><span class="ident" id="7553947">got</span><span class="op" id="7553950">,</span>&nbsp;<span class="ident" id="7553952">want</span><span class="op" id="7553956">)</span>&nbsp;<span class="op" id="7553958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7553963">t</span><span class="op" id="7553964">.</span><span class="ident" id="7553965">Errorf</span><span class="op" id="7553971">(</span><span class="string" id="7553972">&#34;palette&nbsp;#%d:\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7554004">,</span>&nbsp;<span class="ident" id="7554006">i</span><span class="op" id="7554007">,</span>&nbsp;<span class="ident" id="7554009">got</span><span class="op" id="7554012">,</span>&nbsp;<span class="ident" id="7554014">want</span><span class="op" id="7554018">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7554022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7554025">}</span><br>
<span class="lineno"></span><span class="op" id="7554027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7554030">//&nbsp;testGIF&nbsp;is&nbsp;a&nbsp;simple&nbsp;GIF&nbsp;that&nbsp;we&nbsp;can&nbsp;modify&nbsp;to&nbsp;test&nbsp;different&nbsp;scenarios.</span><br>
<span class="lineno">140</span><span class="keyword" id="7554105">var</span>&nbsp;<span class="ident" id="7554109">testGIF</span>&nbsp;<span class="op" id="7554117">=</span>&nbsp;<span class="op" id="7554119">[</span><span class="op" id="7554120">]</span><span class="builtintype" id="7554121">byte</span><span class="op" id="7554125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7554128">&#39;G&#39;</span><span class="op" id="7554131">,</span>&nbsp;<span class="string" id="7554133">&#39;I&#39;</span><span class="op" id="7554136">,</span>&nbsp;<span class="string" id="7554138">&#39;F&#39;</span><span class="op" id="7554141">,</span>&nbsp;<span class="string" id="7554143">&#39;8&#39;</span><span class="op" id="7554146">,</span>&nbsp;<span class="string" id="7554148">&#39;9&#39;</span><span class="op" id="7554151">,</span>&nbsp;<span class="string" id="7554153">&#39;a&#39;</span><span class="op" id="7554156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7554159">1</span><span class="op" id="7554160">,</span>&nbsp;<span class="num" id="7554162">0</span><span class="op" id="7554163">,</span>&nbsp;<span class="num" id="7554165">1</span><span class="op" id="7554166">,</span>&nbsp;<span class="num" id="7554168">0</span><span class="op" id="7554169">,</span>&nbsp;<span class="comment" id="7554171">//&nbsp;w=1,&nbsp;h=1&nbsp;(6)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7554188">128</span><span class="op" id="7554191">,</span>&nbsp;<span class="num" id="7554193">0</span><span class="op" id="7554194">,</span>&nbsp;<span class="num" id="7554196">0</span><span class="op" id="7554197">,</span>&nbsp;<span class="comment" id="7554199">//&nbsp;headerFields,&nbsp;bg,&nbsp;aspect&nbsp;(10)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7554233">0</span><span class="op" id="7554234">,</span>&nbsp;<span class="num" id="7554236">0</span><span class="op" id="7554237">,</span>&nbsp;<span class="num" id="7554239">0</span><span class="op" id="7554240">,</span>&nbsp;<span class="num" id="7554242">1</span><span class="op" id="7554243">,</span>&nbsp;<span class="num" id="7554245">1</span><span class="op" id="7554246">,</span>&nbsp;<span class="num" id="7554248">1</span><span class="op" id="7554249">,</span>&nbsp;<span class="comment" id="7554251">//&nbsp;color&nbsp;map&nbsp;and&nbsp;graphics&nbsp;control&nbsp;(13)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7554291">0x21</span><span class="op" id="7554295">,</span>&nbsp;<span class="num" id="7554297">0xf9</span><span class="op" id="7554301">,</span>&nbsp;<span class="num" id="7554303">0x04</span><span class="op" id="7554307">,</span>&nbsp;<span class="num" id="7554309">0x00</span><span class="op" id="7554313">,</span>&nbsp;<span class="num" id="7554315">0x00</span><span class="op" id="7554319">,</span>&nbsp;<span class="num" id="7554321">0x00</span><span class="op" id="7554325">,</span>&nbsp;<span class="num" id="7554327">0xff</span><span class="op" id="7554331">,</span>&nbsp;<span class="num" id="7554333">0x00</span><span class="op" id="7554337">,</span>&nbsp;<span class="comment" id="7554339">//&nbsp;(19)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7554348">//&nbsp;frame&nbsp;1&nbsp;(0,0&nbsp;-&nbsp;1,1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7554372">0x2c</span><span class="op" id="7554376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7554379">0x00</span><span class="op" id="7554383">,</span>&nbsp;<span class="num" id="7554385">0x00</span><span class="op" id="7554389">,</span>&nbsp;<span class="num" id="7554391">0x00</span><span class="op" id="7554395">,</span>&nbsp;<span class="num" id="7554397">0x00</span><span class="op" id="7554401">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7554404">0x01</span><span class="op" id="7554408">,</span>&nbsp;<span class="num" id="7554410">0x00</span><span class="op" id="7554414">,</span>&nbsp;<span class="num" id="7554416">0x01</span><span class="op" id="7554420">,</span>&nbsp;<span class="num" id="7554422">0x00</span><span class="op" id="7554426">,</span>&nbsp;<span class="comment" id="7554428">//&nbsp;(32)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7554437">0x00</span><span class="op" id="7554441">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7554444">0x02</span><span class="op" id="7554448">,</span>&nbsp;<span class="num" id="7554450">0x02</span><span class="op" id="7554454">,</span>&nbsp;<span class="num" id="7554456">0x4c</span><span class="op" id="7554460">,</span>&nbsp;<span class="num" id="7554462">0x01</span><span class="op" id="7554466">,</span>&nbsp;<span class="num" id="7554468">0x00</span><span class="op" id="7554472">,</span>&nbsp;<span class="comment" id="7554474">//&nbsp;lzw&nbsp;pixels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7554489">//&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7554501">0x3b</span><span class="op" id="7554505">,</span><br>
<span class="lineno"></span><span class="op" id="7554507">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="7554510">func</span>&nbsp;<span class="ident" id="7554515">try</span><span class="op" id="7554518">(</span><span class="ident" id="7554519">t</span>&nbsp;<span class="op" id="7554521">*</span><span class="ident" id="7554522">testing</span><span class="op" id="7554529">.</span><span class="ident" id="7554530">T</span><span class="op" id="7554531">,</span>&nbsp;<span class="ident" id="7554533">b</span>&nbsp;<span class="op" id="7554535">[</span><span class="op" id="7554536">]</span><span class="builtintype" id="7554537">byte</span><span class="op" id="7554541">,</span>&nbsp;<span class="ident" id="7554543">want</span>&nbsp;<span class="builtintype" id="7554548">string</span><span class="op" id="7554554">)</span>&nbsp;<span class="op" id="7554556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7554559">_</span><span class="op" id="7554560">,</span>&nbsp;<span class="ident" id="7554562">err</span>&nbsp;<span class="op" id="7554566">:=</span>&nbsp;<span class="ident" id="7554569">DecodeAll</span><span class="op" id="7554578">(</span><span class="ident" id="7554579">bytes</span><span class="op" id="7554584">.</span><span class="ident" id="7554585">NewReader</span><span class="op" id="7554594">(</span><span class="ident" id="7554595">b</span><span class="op" id="7554596">)</span><span class="op" id="7554597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7554600">var</span>&nbsp;<span class="ident" id="7554604">got</span>&nbsp;<span class="builtintype" id="7554608">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7554616">if</span>&nbsp;<span class="ident" id="7554619">err</span>&nbsp;<span class="op" id="7554623">!=</span>&nbsp;<span class="ident" id="7554626">nil</span>&nbsp;<span class="op" id="7554630">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7554634">got</span>&nbsp;<span class="op" id="7554638">=</span>&nbsp;<span class="ident" id="7554640">err</span><span class="op" id="7554643">.</span><span class="ident" id="7554644">Error</span><span class="op" id="7554649">(</span><span class="op" id="7554650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7554653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7554656">if</span>&nbsp;<span class="ident" id="7554659">got</span>&nbsp;<span class="op" id="7554663">!=</span>&nbsp;<span class="ident" id="7554666">want</span>&nbsp;<span class="op" id="7554671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7554675">t</span><span class="op" id="7554676">.</span><span class="ident" id="7554677">Fatalf</span><span class="op" id="7554683">(</span><span class="string" id="7554684">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7554701">,</span>&nbsp;<span class="ident" id="7554703">got</span><span class="op" id="7554706">,</span>&nbsp;<span class="ident" id="7554708">want</span><span class="op" id="7554712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7554715">}</span><br>
<span class="lineno">165</span><span class="op" id="7554717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7554720">func</span>&nbsp;<span class="ident" id="7554725">TestBounds</span><span class="op" id="7554735">(</span><span class="ident" id="7554736">t</span>&nbsp;<span class="op" id="7554738">*</span><span class="ident" id="7554739">testing</span><span class="op" id="7554746">.</span><span class="ident" id="7554747">T</span><span class="op" id="7554748">)</span>&nbsp;<span class="op" id="7554750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7554753">//&nbsp;Make&nbsp;a&nbsp;local&nbsp;copy&nbsp;of&nbsp;testGIF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7554787">gif</span>&nbsp;<span class="op" id="7554791">:=</span>&nbsp;<span class="builtinfunc" id="7554794">make</span><span class="op" id="7554798">(</span><span class="op" id="7554799">[</span><span class="op" id="7554800">]</span><span class="builtintype" id="7554801">byte</span><span class="op" id="7554805">,</span>&nbsp;<span class="builtinfunc" id="7554807">len</span><span class="op" id="7554810">(</span><span class="ident" id="7554811">testGIF</span><span class="op" id="7554818">)</span><span class="op" id="7554819">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7554822">copy</span><span class="op" id="7554826">(</span><span class="ident" id="7554827">gif</span><span class="op" id="7554830">,</span>&nbsp;<span class="ident" id="7554832">testGIF</span><span class="op" id="7554839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7554842">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;big,&nbsp;just&nbsp;by&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7554884">gif</span><span class="op" id="7554887">[</span><span class="num" id="7554888">32</span><span class="op" id="7554890">]</span>&nbsp;<span class="op" id="7554892">=</span>&nbsp;<span class="num" id="7554894">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7554897">want</span>&nbsp;<span class="op" id="7554902">:=</span>&nbsp;<span class="string" id="7554905">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7554951">try</span><span class="op" id="7554954">(</span><span class="ident" id="7554955">t</span><span class="op" id="7554956">,</span>&nbsp;<span class="ident" id="7554958">gif</span><span class="op" id="7554961">,</span>&nbsp;<span class="ident" id="7554963">want</span><span class="op" id="7554967">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7554971">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;small;&nbsp;does&nbsp;not&nbsp;trigger&nbsp;bounds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7555026">//&nbsp;check,&nbsp;but&nbsp;now&nbsp;there&#39;s&nbsp;too&nbsp;much&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555068">gif</span><span class="op" id="7555071">[</span><span class="num" id="7555072">32</span><span class="op" id="7555074">]</span>&nbsp;<span class="op" id="7555076">=</span>&nbsp;<span class="num" id="7555078">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555081">want</span>&nbsp;<span class="op" id="7555086">=</span>&nbsp;<span class="string" id="7555088">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555116">try</span><span class="op" id="7555119">(</span><span class="ident" id="7555120">t</span><span class="op" id="7555121">,</span>&nbsp;<span class="ident" id="7555123">gif</span><span class="op" id="7555126">,</span>&nbsp;<span class="ident" id="7555128">want</span><span class="op" id="7555132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555135">gif</span><span class="op" id="7555138">[</span><span class="num" id="7555139">32</span><span class="op" id="7555141">]</span>&nbsp;<span class="op" id="7555143">=</span>&nbsp;<span class="num" id="7555145">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7555149">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;really&nbsp;big,&nbsp;expect&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555198">want</span>&nbsp;<span class="op" id="7555203">=</span>&nbsp;<span class="string" id="7555205">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7555251">for</span>&nbsp;<span class="ident" id="7555255">i</span>&nbsp;<span class="op" id="7555257">:=</span>&nbsp;<span class="num" id="7555260">0</span><span class="op" id="7555261">;</span>&nbsp;<span class="ident" id="7555263">i</span>&nbsp;<span class="op" id="7555265">&lt;</span>&nbsp;<span class="num" id="7555267">4</span><span class="op" id="7555268">;</span>&nbsp;<span class="ident" id="7555270">i</span><span class="op" id="7555271">++</span>&nbsp;<span class="op" id="7555274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555278">gif</span><span class="op" id="7555281">[</span><span class="num" id="7555282">32</span><span class="op" id="7555284">+</span><span class="ident" id="7555285">i</span><span class="op" id="7555286">]</span>&nbsp;<span class="op" id="7555288">=</span>&nbsp;<span class="num" id="7555290">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7555296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555299">try</span><span class="op" id="7555302">(</span><span class="ident" id="7555303">t</span><span class="op" id="7555304">,</span>&nbsp;<span class="ident" id="7555306">gif</span><span class="op" id="7555309">,</span>&nbsp;<span class="ident" id="7555311">want</span><span class="op" id="7555315">)</span><br>
<span class="lineno"></span><span class="op" id="7555317">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="7555320">func</span>&nbsp;<span class="ident" id="7555325">TestNoPalette</span><span class="op" id="7555338">(</span><span class="ident" id="7555339">t</span>&nbsp;<span class="op" id="7555341">*</span><span class="ident" id="7555342">testing</span><span class="op" id="7555349">.</span><span class="ident" id="7555350">T</span><span class="op" id="7555351">)</span>&nbsp;<span class="op" id="7555353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555356">b</span>&nbsp;<span class="op" id="7555358">:=</span>&nbsp;<span class="op" id="7555361">&amp;</span><span class="ident" id="7555362">bytes</span><span class="op" id="7555367">.</span><span class="ident" id="7555368">Buffer</span><span class="op" id="7555374">{</span><span class="op" id="7555375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7555379">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;no&nbsp;palette,&nbsp;so&nbsp;any&nbsp;pixel&nbsp;at&nbsp;all</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7555438">//&nbsp;will&nbsp;be&nbsp;invalid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555459">b</span><span class="op" id="7555460">.</span><span class="ident" id="7555461">WriteString</span><span class="op" id="7555472">(</span><span class="ident" id="7555473">headerStr</span><span class="op" id="7555482">[</span><span class="op" id="7555483">:</span><span class="builtinfunc" id="7555484">len</span><span class="op" id="7555487">(</span><span class="ident" id="7555488">headerStr</span><span class="op" id="7555497">)</span><span class="op" id="7555498">-</span><span class="num" id="7555499">3</span><span class="op" id="7555500">]</span><span class="op" id="7555501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555504">b</span><span class="op" id="7555505">.</span><span class="ident" id="7555506">WriteString</span><span class="op" id="7555517">(</span><span class="string" id="7555518">&#34;\x00\x00\x00&#34;</span><span class="op" id="7555532">)</span>&nbsp;<span class="comment" id="7555534">//&nbsp;No&nbsp;global&nbsp;palette.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7555558">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555603">b</span><span class="op" id="7555604">.</span><span class="ident" id="7555605">WriteString</span><span class="op" id="7555616">(</span><span class="string" id="7555617">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7555663">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7555667">//&nbsp;Encode&nbsp;the&nbsp;pixels:&nbsp;neither&nbsp;is&nbsp;in&nbsp;range,&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555740">pix</span>&nbsp;<span class="op" id="7555744">:=</span>&nbsp;<span class="op" id="7555747">[</span><span class="op" id="7555748">]</span><span class="builtintype" id="7555749">byte</span><span class="op" id="7555753">{</span><span class="num" id="7555754">0</span><span class="op" id="7555755">,</span>&nbsp;<span class="num" id="7555757">128</span><span class="op" id="7555760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555763">enc</span>&nbsp;<span class="op" id="7555767">:=</span>&nbsp;<span class="op" id="7555770">&amp;</span><span class="ident" id="7555771">bytes</span><span class="op" id="7555776">.</span><span class="ident" id="7555777">Buffer</span><span class="op" id="7555783">{</span><span class="op" id="7555784">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555787">w</span>&nbsp;<span class="op" id="7555789">:=</span>&nbsp;<span class="ident" id="7555792">lzw</span><span class="op" id="7555795">.</span><span class="ident" id="7555796">NewWriter</span><span class="op" id="7555805">(</span><span class="ident" id="7555806">enc</span><span class="op" id="7555809">,</span>&nbsp;<span class="ident" id="7555811">lzw</span><span class="op" id="7555814">.</span><span class="ident" id="7555815">LSB</span><span class="op" id="7555818">,</span>&nbsp;<span class="num" id="7555820">2</span><span class="op" id="7555821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555824">w</span><span class="op" id="7555825">.</span><span class="ident" id="7555826">Write</span><span class="op" id="7555831">(</span><span class="ident" id="7555832">pix</span><span class="op" id="7555835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555838">w</span><span class="op" id="7555839">.</span><span class="ident" id="7555840">Close</span><span class="op" id="7555845">(</span><span class="op" id="7555846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555849">b</span><span class="op" id="7555850">.</span><span class="ident" id="7555851">WriteByte</span><span class="op" id="7555860">(</span><span class="builtintype" id="7555861">byte</span><span class="op" id="7555865">(</span><span class="builtinfunc" id="7555866">len</span><span class="op" id="7555869">(</span><span class="ident" id="7555870">enc</span><span class="op" id="7555873">.</span><span class="ident" id="7555874">Bytes</span><span class="op" id="7555879">(</span><span class="op" id="7555880">)</span><span class="op" id="7555881">)</span><span class="op" id="7555882">)</span><span class="op" id="7555883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555886">b</span><span class="op" id="7555887">.</span><span class="ident" id="7555888">Write</span><span class="op" id="7555893">(</span><span class="ident" id="7555894">enc</span><span class="op" id="7555897">.</span><span class="ident" id="7555898">Bytes</span><span class="op" id="7555903">(</span><span class="op" id="7555904">)</span><span class="op" id="7555905">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555908">b</span><span class="op" id="7555909">.</span><span class="ident" id="7555910">WriteByte</span><span class="op" id="7555919">(</span><span class="num" id="7555920">0x00</span><span class="op" id="7555924">)</span>&nbsp;<span class="comment" id="7555926">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7555983">b</span><span class="op" id="7555984">.</span><span class="ident" id="7555985">WriteString</span><span class="op" id="7555996">(</span><span class="ident" id="7555997">trailerStr</span><span class="op" id="7556007">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7556011">try</span><span class="op" id="7556014">(</span><span class="ident" id="7556015">t</span><span class="op" id="7556016">,</span>&nbsp;<span class="ident" id="7556018">b</span><span class="op" id="7556019">.</span><span class="ident" id="7556020">Bytes</span><span class="op" id="7556025">(</span><span class="op" id="7556026">)</span><span class="op" id="7556027">,</span>&nbsp;<span class="string" id="7556029">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="7556055">)</span><br>
<span class="lineno">215</span><span class="op" id="7556057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7556060">func</span>&nbsp;<span class="ident" id="7556065">TestPixelOutsidePaletteRange</span><span class="op" id="7556093">(</span><span class="ident" id="7556094">t</span>&nbsp;<span class="op" id="7556096">*</span><span class="ident" id="7556097">testing</span><span class="op" id="7556104">.</span><span class="ident" id="7556105">T</span><span class="op" id="7556106">)</span>&nbsp;<span class="op" id="7556108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7556111">for</span>&nbsp;<span class="ident" id="7556115">_</span><span class="op" id="7556116">,</span>&nbsp;<span class="ident" id="7556118">pval</span>&nbsp;<span class="op" id="7556123">:=</span>&nbsp;<span class="keyword" id="7556126">range</span>&nbsp;<span class="op" id="7556132">[</span><span class="op" id="7556133">]</span><span class="builtintype" id="7556134">byte</span><span class="op" id="7556138">{</span><span class="num" id="7556139">0</span><span class="op" id="7556140">,</span>&nbsp;<span class="num" id="7556142">1</span><span class="op" id="7556143">,</span>&nbsp;<span class="num" id="7556145">2</span><span class="op" id="7556146">,</span>&nbsp;<span class="num" id="7556148">3</span><span class="op" id="7556149">,</span>&nbsp;<span class="num" id="7556151">255</span><span class="op" id="7556154">}</span>&nbsp;<span class="op" id="7556156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7556160">b</span>&nbsp;<span class="op" id="7556162">:=</span>&nbsp;<span class="op" id="7556165">&amp;</span><span class="ident" id="7556166">bytes</span><span class="op" id="7556171">.</span><span class="ident" id="7556172">Buffer</span><span class="op" id="7556178">{</span><span class="op" id="7556179">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7556184">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;a&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7556231">b</span><span class="op" id="7556232">.</span><span class="ident" id="7556233">WriteString</span><span class="op" id="7556244">(</span><span class="ident" id="7556245">headerStr</span><span class="op" id="7556254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7556258">b</span><span class="op" id="7556259">.</span><span class="ident" id="7556260">WriteString</span><span class="op" id="7556271">(</span><span class="ident" id="7556272">paletteStr</span><span class="op" id="7556282">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7556287">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7556333">b</span><span class="op" id="7556334">.</span><span class="ident" id="7556335">WriteString</span><span class="op" id="7556346">(</span><span class="string" id="7556347">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7556393">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7556398">//&nbsp;Encode&nbsp;the&nbsp;pixels;&nbsp;some&nbsp;pvals&nbsp;trigger&nbsp;the&nbsp;expected&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7556461">pix</span>&nbsp;<span class="op" id="7556465">:=</span>&nbsp;<span class="op" id="7556468">[</span><span class="op" id="7556469">]</span><span class="builtintype" id="7556470">byte</span><span class="op" id="7556474">{</span><span class="ident" id="7556475">pval</span><span class="op" id="7556479">,</span>&nbsp;<span class="ident" id="7556481">pval</span><span class="op" id="7556485">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7556489">enc</span>&nbsp;<span class="op" id="7556493">:=</span>&nbsp;<span class="op" id="7556496">&amp;</span><span class="ident" id="7556497">bytes</span><span class="op" id="7556502">.</span><span class="ident" id="7556503">Buffer</span><span class="op" id="7556509">{</span><span class="op" id="7556510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7556514">w</span>&nbsp;<span class="op" id="7556516">:=</span>&nbsp;<span class="ident" id="7556519">lzw</span><span class="op" id="7556522">.</span><span class="ident" id="7556523">NewWriter</span><span class="op" id="7556532">(</span><span class="ident" id="7556533">enc</span><span class="op" id="7556536">,</span>&nbsp;<span class="ident" id="7556538">lzw</span><span class="op" id="7556541">.</span><span class="ident" id="7556542">LSB</span><span class="op" id="7556545">,</span>&nbsp;<span class="num" id="7556547">2</span><span class="op" id="7556548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7556552">w</span><span class="op" id="7556553">.</span><span class="ident" id="7556554">Write</span><span class="op" id="7556559">(</span><span class="ident" id="7556560">pix</span><span class="op" id="7556563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7556567">w</span><span class="op" id="7556568">.</span><span class="ident" id="7556569">Close</span><span class="op" id="7556574">(</span><span class="op" id="7556575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7556579">b</span><span class="op" id="7556580">.</span><span class="ident" id="7556581">WriteByte</span><span class="op" id="7556590">(</span><span class="builtintype" id="7556591">byte</span><span class="op" id="7556595">(</span><span class="builtinfunc" id="7556596">len</span><span class="op" id="7556599">(</span><span class="ident" id="7556600">enc</span><span class="op" id="7556603">.</span><span class="ident" id="7556604">Bytes</span><span class="op" id="7556609">(</span><span class="op" id="7556610">)</span><span class="op" id="7556611">)</span><span class="op" id="7556612">)</span><span class="op" id="7556613">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7556617">b</span><span class="op" id="7556618">.</span><span class="ident" id="7556619">Write</span><span class="op" id="7556624">(</span><span class="ident" id="7556625">enc</span><span class="op" id="7556628">.</span><span class="ident" id="7556629">Bytes</span><span class="op" id="7556634">(</span><span class="op" id="7556635">)</span><span class="op" id="7556636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7556640">b</span><span class="op" id="7556641">.</span><span class="ident" id="7556642">WriteByte</span><span class="op" id="7556651">(</span><span class="num" id="7556652">0x00</span><span class="op" id="7556656">)</span>&nbsp;<span class="comment" id="7556658">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7556716">b</span><span class="op" id="7556717">.</span><span class="ident" id="7556718">WriteString</span><span class="op" id="7556729">(</span><span class="ident" id="7556730">trailerStr</span><span class="op" id="7556740">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7556745">//&nbsp;No&nbsp;error&nbsp;expected,&nbsp;unless&nbsp;the&nbsp;pixels&nbsp;are&nbsp;beyond&nbsp;the&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7556819">want</span>&nbsp;<span class="op" id="7556824">:=</span>&nbsp;<span class="string" id="7556827">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7556832">if</span>&nbsp;<span class="ident" id="7556835">pval</span>&nbsp;<span class="op" id="7556840">&gt;=</span>&nbsp;<span class="num" id="7556843">2</span>&nbsp;<span class="op" id="7556845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7556850">want</span>&nbsp;<span class="op" id="7556855">=</span>&nbsp;<span class="string" id="7556857">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7556886">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7556890">try</span><span class="op" id="7556893">(</span><span class="ident" id="7556894">t</span><span class="op" id="7556895">,</span>&nbsp;<span class="ident" id="7556897">b</span><span class="op" id="7556898">.</span><span class="ident" id="7556899">Bytes</span><span class="op" id="7556904">(</span><span class="op" id="7556905">)</span><span class="op" id="7556906">,</span>&nbsp;<span class="ident" id="7556908">want</span><span class="op" id="7556912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7556915">}</span><br>
<span class="lineno"></span><span class="op" id="7556917">}</span>
</div>
</body>
</html>
