<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html" class="current">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3354592">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3354648">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3354702">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3354753">package</span>&nbsp;<span class="ident" id="3354761">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3354766">import</span>&nbsp;<span class="string" id="3354773">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3354781">//&nbsp;call&nbsp;is&nbsp;an&nbsp;in-flight&nbsp;or&nbsp;completed&nbsp;singleflight.Do&nbsp;call</span><br>
<span class="lineno">10</span><span class="keyword" id="3354839">type</span>&nbsp;<span class="ident" id="3354844">call</span>&nbsp;<span class="keyword" id="3354849">struct</span>&nbsp;<span class="op" id="3354856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3354859">wg</span>&nbsp;<span class="ident" id="3354862"><a href="/gostd/net/singleflight.go.html#3354773">sync</a></span><span class="op" id="3354866">.</span><span class="ident" id="3354867"><a href="/gostd/sync/waitgroup.go.html#1459933">WaitGroup</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3354879">//&nbsp;These&nbsp;fields&nbsp;are&nbsp;written&nbsp;once&nbsp;before&nbsp;the&nbsp;WaitGroup&nbsp;is&nbsp;done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3354942">//&nbsp;and&nbsp;are&nbsp;only&nbsp;read&nbsp;after&nbsp;the&nbsp;WaitGroup&nbsp;is&nbsp;done.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3354993">val</span>&nbsp;<span class="keyword" id="3354997">interface</span><span class="op" id="3355006">{</span><span class="op" id="3355007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3355010">err</span>&nbsp;<span class="builtintype" id="3355014">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3355022">//&nbsp;These&nbsp;fields&nbsp;are&nbsp;read&nbsp;and&nbsp;written&nbsp;with&nbsp;the&nbsp;singleflight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3355082">//&nbsp;mutex&nbsp;held&nbsp;before&nbsp;the&nbsp;WaitGroup&nbsp;is&nbsp;done,&nbsp;and&nbsp;are&nbsp;read&nbsp;but</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3355144">//&nbsp;not&nbsp;written&nbsp;after&nbsp;the&nbsp;WaitGroup&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3355189">dups</span>&nbsp;&nbsp;<span class="builtintype" id="3355195">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3355200">chans</span>&nbsp;<span class="op" id="3355206">[</span><span class="op" id="3355207">]</span><span class="keyword" id="3355208">chan</span><span class="op" id="3355212">&lt;-</span>&nbsp;<span class="ident" id="3355215"><a href="/gostd/net/singleflight.go.html#3355571">singleflightResult</a></span><br>
<span class="lineno"></span><span class="op" id="3355234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3355237">//&nbsp;singleflight&nbsp;represents&nbsp;a&nbsp;class&nbsp;of&nbsp;work&nbsp;and&nbsp;forms&nbsp;a&nbsp;namespace&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3355305">//&nbsp;which&nbsp;units&nbsp;of&nbsp;work&nbsp;can&nbsp;be&nbsp;executed&nbsp;with&nbsp;duplicate&nbsp;suppression.</span><br>
<span class="lineno"></span><span class="keyword" id="3355372">type</span>&nbsp;<span class="ident" id="3355377">singleflight</span>&nbsp;<span class="keyword" id="3355390">struct</span>&nbsp;<span class="op" id="3355397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3355400">mu</span>&nbsp;<span class="ident" id="3355403"><a href="/gostd/net/singleflight.go.html#3354773">sync</a></span><span class="op" id="3355407">.</span><span class="ident" id="3355408"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3355420">//&nbsp;protects&nbsp;m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3355435">m</span>&nbsp;&nbsp;<span class="keyword" id="3355438">map</span><span class="op" id="3355441">[</span><span class="builtintype" id="3355442">string</span><span class="op" id="3355448">]</span><span class="op" id="3355449">*</span><span class="ident" id="3355450"><a href="/gostd/net/singleflight.go.html#3354844">call</a></span>&nbsp;<span class="comment" id="3355455">//&nbsp;lazily&nbsp;initialized</span><br>
<span class="lineno">30</span><span class="op" id="3355477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3355480">//&nbsp;singleflightResult&nbsp;holds&nbsp;the&nbsp;results&nbsp;of&nbsp;Do,&nbsp;so&nbsp;they&nbsp;can&nbsp;be&nbsp;passed</span><br>
<span class="lineno"></span><span class="comment" id="3355549">//&nbsp;on&nbsp;a&nbsp;channel.</span><br>
<span class="lineno"></span><span class="keyword" id="3355566">type</span>&nbsp;<span class="ident" id="3355571">singleflightResult</span>&nbsp;<span class="keyword" id="3355590">struct</span>&nbsp;<span class="op" id="3355597">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3355600">v</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355607">interface</span><span class="op" id="3355616">{</span><span class="op" id="3355617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3355620">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3355627">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3355634">shared</span>&nbsp;<span class="builtintype" id="3355641">bool</span><br>
<span class="lineno"></span><span class="op" id="3355646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="3355649">//&nbsp;Do&nbsp;executes&nbsp;and&nbsp;returns&nbsp;the&nbsp;results&nbsp;of&nbsp;the&nbsp;given&nbsp;function,&nbsp;making</span><br>
<span class="lineno"></span><span class="comment" id="3355718">//&nbsp;sure&nbsp;that&nbsp;only&nbsp;one&nbsp;execution&nbsp;is&nbsp;in-flight&nbsp;for&nbsp;a&nbsp;given&nbsp;key&nbsp;at&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3355784">//&nbsp;time.&nbsp;If&nbsp;a&nbsp;duplicate&nbsp;comes&nbsp;in,&nbsp;the&nbsp;duplicate&nbsp;caller&nbsp;waits&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3355853">//&nbsp;original&nbsp;to&nbsp;complete&nbsp;and&nbsp;receives&nbsp;the&nbsp;same&nbsp;results.</span><br>
<span class="lineno"></span><span class="comment" id="3355908">//&nbsp;The&nbsp;return&nbsp;value&nbsp;shared&nbsp;indicates&nbsp;whether&nbsp;v&nbsp;was&nbsp;given&nbsp;to&nbsp;multiple&nbsp;callers.</span><br>
<span class="lineno">45</span><span class="keyword" id="3355986">func</span>&nbsp;<span class="op" id="3355991">(</span><span class="ident" id="3355992">g</span>&nbsp;<span class="op" id="3355994">*</span><span class="ident" id="3355995"><a href="/gostd/net/singleflight.go.html#3355377">singleflight</a></span><span class="op" id="3356007">)</span>&nbsp;<span class="ident" id="3356009">Do</span><span class="op" id="3356011">(</span><span class="ident" id="3356012">key</span>&nbsp;<span class="builtintype" id="3356016">string</span><span class="op" id="3356022">,</span>&nbsp;<span class="ident" id="3356024">fn</span>&nbsp;<span class="keyword" id="3356027">func</span><span class="op" id="3356031">(</span><span class="op" id="3356032">)</span>&nbsp;<span class="op" id="3356034">(</span><span class="keyword" id="3356035">interface</span><span class="op" id="3356044">{</span><span class="op" id="3356045">}</span><span class="op" id="3356046">,</span>&nbsp;<span class="builtintype" id="3356048">error</span><span class="op" id="3356053">)</span><span class="op" id="3356054">)</span>&nbsp;<span class="op" id="3356056">(</span><span class="ident" id="3356057">v</span>&nbsp;<span class="keyword" id="3356059">interface</span><span class="op" id="3356068">{</span><span class="op" id="3356069">}</span><span class="op" id="3356070">,</span>&nbsp;<span class="ident" id="3356072">err</span>&nbsp;<span class="builtintype" id="3356076">error</span><span class="op" id="3356081">,</span>&nbsp;<span class="ident" id="3356083">shared</span>&nbsp;<span class="builtintype" id="3356090">bool</span><span class="op" id="3356094">)</span>&nbsp;<span class="op" id="3356096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356099"><a href="/gostd/net/singleflight.go.html#3355992">g</a></span><span class="op" id="3356100">.</span><span class="ident" id="3356101"><a href="/gostd/net/singleflight.go.html#3355400">mu</a></span><span class="op" id="3356103">.</span><span class="ident" id="3356104"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="3356108">(</span><span class="op" id="3356109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356112">if</span>&nbsp;<span class="ident" id="3356115"><a href="/gostd/net/singleflight.go.html#3355992">g</a></span><span class="op" id="3356116">.</span><span class="ident" id="3356117"><a href="/gostd/net/singleflight.go.html#3355435">m</a></span>&nbsp;<span class="op" id="3356119">==</span>&nbsp;<span class="builtintype" id="3356122">nil</span>&nbsp;<span class="op" id="3356126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356130"><a href="/gostd/net/singleflight.go.html#3355992">g</a></span><span class="op" id="3356131">.</span><span class="ident" id="3356132"><a href="/gostd/net/singleflight.go.html#3355435">m</a></span>&nbsp;<span class="op" id="3356134">=</span>&nbsp;<span class="builtinfunc" id="3356136">make</span><span class="op" id="3356140">(</span><span class="keyword" id="3356141">map</span><span class="op" id="3356144">[</span><span class="builtintype" id="3356145">string</span><span class="op" id="3356151">]</span><span class="op" id="3356152">*</span><span class="ident" id="3356153"><a href="/gostd/net/singleflight.go.html#3354844">call</a></span><span class="op" id="3356157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356160">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356163">if</span>&nbsp;<span class="ident" id="3356166">c</span><span class="op" id="3356167">,</span>&nbsp;<span class="ident" id="3356169">ok</span>&nbsp;<span class="op" id="3356172">:=</span>&nbsp;<span class="ident" id="3356175"><a href="/gostd/net/singleflight.go.html#3355992">g</a></span><span class="op" id="3356176">.</span><span class="ident" id="3356177"><a href="/gostd/net/singleflight.go.html#3355435">m</a></span><span class="op" id="3356178">[</span><span class="ident" id="3356179"><a href="/gostd/net/singleflight.go.html#3356012">key</a></span><span class="op" id="3356182">]</span><span class="op" id="3356183">;</span>&nbsp;<span class="ident" id="3356185"><a href="/gostd/net/singleflight.go.html#3356169">ok</a></span>&nbsp;<span class="op" id="3356188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356192"><a href="/gostd/net/singleflight.go.html#3356166">c</a></span><span class="op" id="3356193">.</span><span class="ident" id="3356194"><a href="/gostd/net/singleflight.go.html#3355189">dups</a></span><span class="op" id="3356198">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356203"><a href="/gostd/net/singleflight.go.html#3355992">g</a></span><span class="op" id="3356204">.</span><span class="ident" id="3356205"><a href="/gostd/net/singleflight.go.html#3355400">mu</a></span><span class="op" id="3356207">.</span><span class="ident" id="3356208"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="3356214">(</span><span class="op" id="3356215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356219"><a href="/gostd/net/singleflight.go.html#3356166">c</a></span><span class="op" id="3356220">.</span><span class="ident" id="3356221"><a href="/gostd/net/singleflight.go.html#3354859">wg</a></span><span class="op" id="3356223">.</span><span class="ident" id="3356224"><a href="/gostd/sync/waitgroup.go.html#1462162">Wait</a></span><span class="op" id="3356228">(</span><span class="op" id="3356229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356233">return</span>&nbsp;<span class="ident" id="3356240"><a href="/gostd/net/singleflight.go.html#3356166">c</a></span><span class="op" id="3356241">.</span><span class="ident" id="3356242"><a href="/gostd/net/singleflight.go.html#3354993">val</a></span><span class="op" id="3356245">,</span>&nbsp;<span class="ident" id="3356247"><a href="/gostd/net/singleflight.go.html#3356166">c</a></span><span class="op" id="3356248">.</span><span class="ident" id="3356249"><a href="/gostd/net/singleflight.go.html#3355010">err</a></span><span class="op" id="3356252">,</span>&nbsp;<span class="builtintype" id="3356254">true</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356263">c</span>&nbsp;<span class="op" id="3356265">:=</span>&nbsp;<span class="builtinfunc" id="3356268">new</span><span class="op" id="3356271">(</span><span class="ident" id="3356272"><a href="/gostd/net/singleflight.go.html#3354844">call</a></span><span class="op" id="3356276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356279"><a href="/gostd/net/singleflight.go.html#3356263">c</a></span><span class="op" id="3356280">.</span><span class="ident" id="3356281"><a href="/gostd/net/singleflight.go.html#3354859">wg</a></span><span class="op" id="3356283">.</span><span class="ident" id="3356284"><a href="/gostd/sync/waitgroup.go.html#1461154">Add</a></span><span class="op" id="3356287">(</span><span class="num" id="3356288">1</span><span class="op" id="3356289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356292"><a href="/gostd/net/singleflight.go.html#3355992">g</a></span><span class="op" id="3356293">.</span><span class="ident" id="3356294"><a href="/gostd/net/singleflight.go.html#3355435">m</a></span><span class="op" id="3356295">[</span><span class="ident" id="3356296"><a href="/gostd/net/singleflight.go.html#3356012">key</a></span><span class="op" id="3356299">]</span>&nbsp;<span class="op" id="3356301">=</span>&nbsp;<span class="ident" id="3356303"><a href="/gostd/net/singleflight.go.html#3356263">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356306"><a href="/gostd/net/singleflight.go.html#3355992">g</a></span><span class="op" id="3356307">.</span><span class="ident" id="3356308"><a href="/gostd/net/singleflight.go.html#3355400">mu</a></span><span class="op" id="3356310">.</span><span class="ident" id="3356311"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="3356317">(</span><span class="op" id="3356318">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356322"><a href="/gostd/net/singleflight.go.html#3355992">g</a></span><span class="op" id="3356323">.</span><span class="ident" id="3356324"><a href="/gostd/net/singleflight.go.html#3356987">doCall</a></span><span class="op" id="3356330">(</span><span class="ident" id="3356331"><a href="/gostd/net/singleflight.go.html#3356263">c</a></span><span class="op" id="3356332">,</span>&nbsp;<span class="ident" id="3356334"><a href="/gostd/net/singleflight.go.html#3356012">key</a></span><span class="op" id="3356337">,</span>&nbsp;<span class="ident" id="3356339"><a href="/gostd/net/singleflight.go.html#3356024">fn</a></span><span class="op" id="3356341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356344">return</span>&nbsp;<span class="ident" id="3356351"><a href="/gostd/net/singleflight.go.html#3356263">c</a></span><span class="op" id="3356352">.</span><span class="ident" id="3356353"><a href="/gostd/net/singleflight.go.html#3354993">val</a></span><span class="op" id="3356356">,</span>&nbsp;<span class="ident" id="3356358"><a href="/gostd/net/singleflight.go.html#3356263">c</a></span><span class="op" id="3356359">.</span><span class="ident" id="3356360"><a href="/gostd/net/singleflight.go.html#3355010">err</a></span><span class="op" id="3356363">,</span>&nbsp;<span class="ident" id="3356365"><a href="/gostd/net/singleflight.go.html#3356263">c</a></span><span class="op" id="3356366">.</span><span class="ident" id="3356367"><a href="/gostd/net/singleflight.go.html#3355189">dups</a></span>&nbsp;<span class="op" id="3356372">&gt;</span>&nbsp;<span class="num" id="3356374">0</span><br>
<span class="lineno"></span><span class="op" id="3356376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3356379">//&nbsp;DoChan&nbsp;is&nbsp;like&nbsp;Do&nbsp;but&nbsp;returns&nbsp;a&nbsp;channel&nbsp;that&nbsp;will&nbsp;receive&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3356444">//&nbsp;results&nbsp;when&nbsp;they&nbsp;are&nbsp;ready.</span><br>
<span class="lineno"></span><span class="keyword" id="3356476">func</span>&nbsp;<span class="op" id="3356481">(</span><span class="ident" id="3356482">g</span>&nbsp;<span class="op" id="3356484">*</span><span class="ident" id="3356485"><a href="/gostd/net/singleflight.go.html#3355377">singleflight</a></span><span class="op" id="3356497">)</span>&nbsp;<span class="ident" id="3356499">DoChan</span><span class="op" id="3356505">(</span><span class="ident" id="3356506">key</span>&nbsp;<span class="builtintype" id="3356510">string</span><span class="op" id="3356516">,</span>&nbsp;<span class="ident" id="3356518">fn</span>&nbsp;<span class="keyword" id="3356521">func</span><span class="op" id="3356525">(</span><span class="op" id="3356526">)</span>&nbsp;<span class="op" id="3356528">(</span><span class="keyword" id="3356529">interface</span><span class="op" id="3356538">{</span><span class="op" id="3356539">}</span><span class="op" id="3356540">,</span>&nbsp;<span class="builtintype" id="3356542">error</span><span class="op" id="3356547">)</span><span class="op" id="3356548">)</span>&nbsp;<span class="op" id="3356550">&lt;-</span><span class="keyword" id="3356552">chan</span>&nbsp;<span class="ident" id="3356557"><a href="/gostd/net/singleflight.go.html#3355571">singleflightResult</a></span>&nbsp;<span class="op" id="3356576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356579">ch</span>&nbsp;<span class="op" id="3356582">:=</span>&nbsp;<span class="builtinfunc" id="3356585">make</span><span class="op" id="3356589">(</span><span class="keyword" id="3356590">chan</span>&nbsp;<span class="ident" id="3356595"><a href="/gostd/net/singleflight.go.html#3355571">singleflightResult</a></span><span class="op" id="3356613">,</span>&nbsp;<span class="num" id="3356615">1</span><span class="op" id="3356616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356619"><a href="/gostd/net/singleflight.go.html#3356482">g</a></span><span class="op" id="3356620">.</span><span class="ident" id="3356621"><a href="/gostd/net/singleflight.go.html#3355400">mu</a></span><span class="op" id="3356623">.</span><span class="ident" id="3356624"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="3356628">(</span><span class="op" id="3356629">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356632">if</span>&nbsp;<span class="ident" id="3356635"><a href="/gostd/net/singleflight.go.html#3356482">g</a></span><span class="op" id="3356636">.</span><span class="ident" id="3356637"><a href="/gostd/net/singleflight.go.html#3355435">m</a></span>&nbsp;<span class="op" id="3356639">==</span>&nbsp;<span class="builtintype" id="3356642">nil</span>&nbsp;<span class="op" id="3356646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356650"><a href="/gostd/net/singleflight.go.html#3356482">g</a></span><span class="op" id="3356651">.</span><span class="ident" id="3356652"><a href="/gostd/net/singleflight.go.html#3355435">m</a></span>&nbsp;<span class="op" id="3356654">=</span>&nbsp;<span class="builtinfunc" id="3356656">make</span><span class="op" id="3356660">(</span><span class="keyword" id="3356661">map</span><span class="op" id="3356664">[</span><span class="builtintype" id="3356665">string</span><span class="op" id="3356671">]</span><span class="op" id="3356672">*</span><span class="ident" id="3356673"><a href="/gostd/net/singleflight.go.html#3354844">call</a></span><span class="op" id="3356677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356683">if</span>&nbsp;<span class="ident" id="3356686">c</span><span class="op" id="3356687">,</span>&nbsp;<span class="ident" id="3356689">ok</span>&nbsp;<span class="op" id="3356692">:=</span>&nbsp;<span class="ident" id="3356695"><a href="/gostd/net/singleflight.go.html#3356482">g</a></span><span class="op" id="3356696">.</span><span class="ident" id="3356697"><a href="/gostd/net/singleflight.go.html#3355435">m</a></span><span class="op" id="3356698">[</span><span class="ident" id="3356699"><a href="/gostd/net/singleflight.go.html#3356506">key</a></span><span class="op" id="3356702">]</span><span class="op" id="3356703">;</span>&nbsp;<span class="ident" id="3356705"><a href="/gostd/net/singleflight.go.html#3356689">ok</a></span>&nbsp;<span class="op" id="3356708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356712"><a href="/gostd/net/singleflight.go.html#3356686">c</a></span><span class="op" id="3356713">.</span><span class="ident" id="3356714"><a href="/gostd/net/singleflight.go.html#3355189">dups</a></span><span class="op" id="3356718">++</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356723"><a href="/gostd/net/singleflight.go.html#3356686">c</a></span><span class="op" id="3356724">.</span><span class="ident" id="3356725"><a href="/gostd/net/singleflight.go.html#3355200">chans</a></span>&nbsp;<span class="op" id="3356731">=</span>&nbsp;<span class="builtinfunc" id="3356733">append</span><span class="op" id="3356739">(</span><span class="ident" id="3356740"><a href="/gostd/net/singleflight.go.html#3356686">c</a></span><span class="op" id="3356741">.</span><span class="ident" id="3356742"><a href="/gostd/net/singleflight.go.html#3355200">chans</a></span><span class="op" id="3356747">,</span>&nbsp;<span class="ident" id="3356749"><a href="/gostd/net/singleflight.go.html#3356579">ch</a></span><span class="op" id="3356751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356755"><a href="/gostd/net/singleflight.go.html#3356482">g</a></span><span class="op" id="3356756">.</span><span class="ident" id="3356757"><a href="/gostd/net/singleflight.go.html#3355400">mu</a></span><span class="op" id="3356759">.</span><span class="ident" id="3356760"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="3356766">(</span><span class="op" id="3356767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356771">return</span>&nbsp;<span class="ident" id="3356778"><a href="/gostd/net/singleflight.go.html#3356579">ch</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356785">c</span>&nbsp;<span class="op" id="3356787">:=</span>&nbsp;<span class="op" id="3356790">&amp;</span><span class="ident" id="3356791"><a href="/gostd/net/singleflight.go.html#3354844">call</a></span><span class="op" id="3356795">{</span><span class="ident" id="3356796"><a href="/gostd/net/singleflight.go.html#3355200">chans</a></span><span class="op" id="3356801">:</span>&nbsp;<span class="op" id="3356803">[</span><span class="op" id="3356804">]</span><span class="keyword" id="3356805">chan</span><span class="op" id="3356809">&lt;-</span>&nbsp;<span class="ident" id="3356812"><a href="/gostd/net/singleflight.go.html#3355571">singleflightResult</a></span><span class="op" id="3356830">{</span><span class="ident" id="3356831"><a href="/gostd/net/singleflight.go.html#3356579">ch</a></span><span class="op" id="3356833">}</span><span class="op" id="3356834">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356837"><a href="/gostd/net/singleflight.go.html#3356785">c</a></span><span class="op" id="3356838">.</span><span class="ident" id="3356839"><a href="/gostd/net/singleflight.go.html#3354859">wg</a></span><span class="op" id="3356841">.</span><span class="ident" id="3356842"><a href="/gostd/sync/waitgroup.go.html#1461154">Add</a></span><span class="op" id="3356845">(</span><span class="num" id="3356846">1</span><span class="op" id="3356847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356850"><a href="/gostd/net/singleflight.go.html#3356482">g</a></span><span class="op" id="3356851">.</span><span class="ident" id="3356852"><a href="/gostd/net/singleflight.go.html#3355435">m</a></span><span class="op" id="3356853">[</span><span class="ident" id="3356854"><a href="/gostd/net/singleflight.go.html#3356506">key</a></span><span class="op" id="3356857">]</span>&nbsp;<span class="op" id="3356859">=</span>&nbsp;<span class="ident" id="3356861"><a href="/gostd/net/singleflight.go.html#3356785">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356864"><a href="/gostd/net/singleflight.go.html#3356482">g</a></span><span class="op" id="3356865">.</span><span class="ident" id="3356866"><a href="/gostd/net/singleflight.go.html#3355400">mu</a></span><span class="op" id="3356868">.</span><span class="ident" id="3356869"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="3356875">(</span><span class="op" id="3356876">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356880">go</span>&nbsp;<span class="ident" id="3356883"><a href="/gostd/net/singleflight.go.html#3356482">g</a></span><span class="op" id="3356884">.</span><span class="ident" id="3356885"><a href="/gostd/net/singleflight.go.html#3356987">doCall</a></span><span class="op" id="3356891">(</span><span class="ident" id="3356892"><a href="/gostd/net/singleflight.go.html#3356785">c</a></span><span class="op" id="3356893">,</span>&nbsp;<span class="ident" id="3356895"><a href="/gostd/net/singleflight.go.html#3356506">key</a></span><span class="op" id="3356898">,</span>&nbsp;<span class="ident" id="3356900"><a href="/gostd/net/singleflight.go.html#3356518">fn</a></span><span class="op" id="3356902">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356906">return</span>&nbsp;<span class="ident" id="3356913"><a href="/gostd/net/singleflight.go.html#3356579">ch</a></span><br>
<span class="lineno"></span><span class="op" id="3356916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3356919">//&nbsp;doCall&nbsp;handles&nbsp;the&nbsp;single&nbsp;call&nbsp;for&nbsp;a&nbsp;key.</span><br>
<span class="lineno">90</span><span class="keyword" id="3356964">func</span>&nbsp;<span class="op" id="3356969">(</span><span class="ident" id="3356970">g</span>&nbsp;<span class="op" id="3356972">*</span><span class="ident" id="3356973"><a href="/gostd/net/singleflight.go.html#3355377">singleflight</a></span><span class="op" id="3356985">)</span>&nbsp;<span class="ident" id="3356987">doCall</span><span class="op" id="3356993">(</span><span class="ident" id="3356994">c</span>&nbsp;<span class="op" id="3356996">*</span><span class="ident" id="3356997"><a href="/gostd/net/singleflight.go.html#3354844">call</a></span><span class="op" id="3357001">,</span>&nbsp;<span class="ident" id="3357003">key</span>&nbsp;<span class="builtintype" id="3357007">string</span><span class="op" id="3357013">,</span>&nbsp;<span class="ident" id="3357015">fn</span>&nbsp;<span class="keyword" id="3357018">func</span><span class="op" id="3357022">(</span><span class="op" id="3357023">)</span>&nbsp;<span class="op" id="3357025">(</span><span class="keyword" id="3357026">interface</span><span class="op" id="3357035">{</span><span class="op" id="3357036">}</span><span class="op" id="3357037">,</span>&nbsp;<span class="builtintype" id="3357039">error</span><span class="op" id="3357044">)</span><span class="op" id="3357045">)</span>&nbsp;<span class="op" id="3357047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3357050"><a href="/gostd/net/singleflight.go.html#3356994">c</a></span><span class="op" id="3357051">.</span><span class="ident" id="3357052"><a href="/gostd/net/singleflight.go.html#3354993">val</a></span><span class="op" id="3357055">,</span>&nbsp;<span class="ident" id="3357057"><a href="/gostd/net/singleflight.go.html#3356994">c</a></span><span class="op" id="3357058">.</span><span class="ident" id="3357059"><a href="/gostd/net/singleflight.go.html#3355010">err</a></span>&nbsp;<span class="op" id="3357063">=</span>&nbsp;<span class="ident" id="3357065"><a href="/gostd/net/singleflight.go.html#3357015">fn</a></span><span class="op" id="3357067">(</span><span class="op" id="3357068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3357071"><a href="/gostd/net/singleflight.go.html#3356994">c</a></span><span class="op" id="3357072">.</span><span class="ident" id="3357073"><a href="/gostd/net/singleflight.go.html#3354859">wg</a></span><span class="op" id="3357075">.</span><span class="ident" id="3357076"><a href="/gostd/sync/waitgroup.go.html#1462065">Done</a></span><span class="op" id="3357080">(</span><span class="op" id="3357081">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3357085"><a href="/gostd/net/singleflight.go.html#3356970">g</a></span><span class="op" id="3357086">.</span><span class="ident" id="3357087"><a href="/gostd/net/singleflight.go.html#3355400">mu</a></span><span class="op" id="3357089">.</span><span class="ident" id="3357090"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="3357094">(</span><span class="op" id="3357095">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3357098">delete</span><span class="op" id="3357104">(</span><span class="ident" id="3357105"><a href="/gostd/net/singleflight.go.html#3356970">g</a></span><span class="op" id="3357106">.</span><span class="ident" id="3357107"><a href="/gostd/net/singleflight.go.html#3355435">m</a></span><span class="op" id="3357108">,</span>&nbsp;<span class="ident" id="3357110"><a href="/gostd/net/singleflight.go.html#3357003">key</a></span><span class="op" id="3357113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357116">for</span>&nbsp;<span class="ident" id="3357120">_</span><span class="op" id="3357121">,</span>&nbsp;<span class="ident" id="3357123">ch</span>&nbsp;<span class="op" id="3357126">:=</span>&nbsp;<span class="keyword" id="3357129">range</span>&nbsp;<span class="ident" id="3357135"><a href="/gostd/net/singleflight.go.html#3356994">c</a></span><span class="op" id="3357136">.</span><span class="ident" id="3357137"><a href="/gostd/net/singleflight.go.html#3355200">chans</a></span>&nbsp;<span class="op" id="3357143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3357147"><a href="/gostd/net/singleflight.go.html#3357123">ch</a></span>&nbsp;<span class="op" id="3357150">&lt;-</span>&nbsp;<span class="ident" id="3357153"><a href="/gostd/net/singleflight.go.html#3355571">singleflightResult</a></span><span class="op" id="3357171">{</span><span class="ident" id="3357172"><a href="/gostd/net/singleflight.go.html#3356994">c</a></span><span class="op" id="3357173">.</span><span class="ident" id="3357174"><a href="/gostd/net/singleflight.go.html#3354993">val</a></span><span class="op" id="3357177">,</span>&nbsp;<span class="ident" id="3357179"><a href="/gostd/net/singleflight.go.html#3356994">c</a></span><span class="op" id="3357180">.</span><span class="ident" id="3357181"><a href="/gostd/net/singleflight.go.html#3355010">err</a></span><span class="op" id="3357184">,</span>&nbsp;<span class="ident" id="3357186"><a href="/gostd/net/singleflight.go.html#3356994">c</a></span><span class="op" id="3357187">.</span><span class="ident" id="3357188"><a href="/gostd/net/singleflight.go.html#3355189">dups</a></span>&nbsp;<span class="op" id="3357193">&gt;</span>&nbsp;<span class="num" id="3357195">0</span><span class="op" id="3357196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3357199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3357202"><a href="/gostd/net/singleflight.go.html#3356970">g</a></span><span class="op" id="3357203">.</span><span class="ident" id="3357204"><a href="/gostd/net/singleflight.go.html#3355400">mu</a></span><span class="op" id="3357206">.</span><span class="ident" id="3357207"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="3357213">(</span><span class="op" id="3357214">)</span><br>
<span class="lineno">100</span><span class="op" id="3357216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3357219">//&nbsp;Forget&nbsp;tells&nbsp;the&nbsp;singleflight&nbsp;to&nbsp;forget&nbsp;about&nbsp;a&nbsp;key.&nbsp;&nbsp;Future&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="3357289">//&nbsp;to&nbsp;Do&nbsp;for&nbsp;this&nbsp;key&nbsp;will&nbsp;call&nbsp;the&nbsp;function&nbsp;rather&nbsp;than&nbsp;waiting&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3357358">//&nbsp;an&nbsp;earlier&nbsp;call&nbsp;to&nbsp;complete.</span><br>
<span class="lineno">105</span><span class="keyword" id="3357390">func</span>&nbsp;<span class="op" id="3357395">(</span><span class="ident" id="3357396">g</span>&nbsp;<span class="op" id="3357398">*</span><span class="ident" id="3357399"><a href="/gostd/net/singleflight.go.html#3355377">singleflight</a></span><span class="op" id="3357411">)</span>&nbsp;<span class="ident" id="3357413">Forget</span><span class="op" id="3357419">(</span><span class="ident" id="3357420">key</span>&nbsp;<span class="builtintype" id="3357424">string</span><span class="op" id="3357430">)</span>&nbsp;<span class="op" id="3357432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3357435"><a href="/gostd/net/singleflight.go.html#3357396">g</a></span><span class="op" id="3357436">.</span><span class="ident" id="3357437"><a href="/gostd/net/singleflight.go.html#3355400">mu</a></span><span class="op" id="3357439">.</span><span class="ident" id="3357440"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="3357444">(</span><span class="op" id="3357445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3357448">delete</span><span class="op" id="3357454">(</span><span class="ident" id="3357455"><a href="/gostd/net/singleflight.go.html#3357396">g</a></span><span class="op" id="3357456">.</span><span class="ident" id="3357457"><a href="/gostd/net/singleflight.go.html#3355435">m</a></span><span class="op" id="3357458">,</span>&nbsp;<span class="ident" id="3357460"><a href="/gostd/net/singleflight.go.html#3357420">key</a></span><span class="op" id="3357463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3357466"><a href="/gostd/net/singleflight.go.html#3357396">g</a></span><span class="op" id="3357467">.</span><span class="ident" id="3357468"><a href="/gostd/net/singleflight.go.html#3355400">mu</a></span><span class="op" id="3357470">.</span><span class="ident" id="3357471"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="3357477">(</span><span class="op" id="3357478">)</span><br>
<span class="lineno"></span><span class="op" id="3357480">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
