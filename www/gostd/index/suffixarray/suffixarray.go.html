<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6373748">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6373803">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6373857">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6373908">//&nbsp;Package&nbsp;suffixarray&nbsp;implements&nbsp;substring&nbsp;search&nbsp;in&nbsp;logarithmic&nbsp;time&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="6373985">//&nbsp;an&nbsp;in-memory&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="6374015">//</span><br>
<span class="lineno"></span><span class="comment" id="6374018">//&nbsp;Example&nbsp;use:</span><br>
<span class="lineno"></span><span class="comment" id="6374034">//</span><br>
<span class="lineno">10</span><span class="comment" id="6374037">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;create&nbsp;index&nbsp;for&nbsp;some&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6374070">//&nbsp;&nbsp;&nbsp;&nbspindex&nbsp;:=&nbsp;suffixarray.New(data)</span><br>
<span class="lineno"></span><span class="comment" id="6374104">//</span><br>
<span class="lineno"></span><span class="comment" id="6374107">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;lookup&nbsp;byte&nbsp;slice&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="6374133">//&nbsp;&nbsp;&nbsp;&nbspoffsets1&nbsp;:=&nbsp;index.Lookup(s,&nbsp;-1)&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;all&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno">15</span><span class="comment" id="6374218">//&nbsp;&nbsp;&nbsp;&nbspoffsets2&nbsp;:=&nbsp;index.Lookup(s,&nbsp;3)&nbsp;&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;3&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6374309">//</span><br>
<span class="lineno"></span><span class="keyword" id="6374312">package</span>&nbsp;<span class="ident" id="6374320">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6374333">import</span>&nbsp;<span class="op" id="6374340">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6374343">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6374352">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6374371">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6374377">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6374387">&#34;sort&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6374394">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6374397">//&nbsp;Index&nbsp;implements&nbsp;a&nbsp;suffix&nbsp;array&nbsp;for&nbsp;fast&nbsp;substring&nbsp;search.</span><br>
<span class="lineno"></span><span class="keyword" id="6374459">type</span>&nbsp;<span class="ident" id="6374464">Index</span>&nbsp;<span class="keyword" id="6374470">struct</span>&nbsp;<span class="op" id="6374477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374480">data</span>&nbsp;<span class="op" id="6374485">[</span><span class="op" id="6374486">]</span><span class="builtintype" id="6374487">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374493">sa</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6374498">[</span><span class="op" id="6374499">]</span><span class="builtintype" id="6374500">int</span>&nbsp;<span class="comment" id="6374504">//&nbsp;suffix&nbsp;array&nbsp;for&nbsp;data;&nbsp;len(sa)&nbsp;==&nbsp;len(data)</span><br>
<span class="lineno"></span><span class="op" id="6374551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6374554">//&nbsp;New&nbsp;creates&nbsp;a&nbsp;new&nbsp;Index&nbsp;for&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="6374591">//&nbsp;Index&nbsp;creation&nbsp;time&nbsp;is&nbsp;O(N*log(N))&nbsp;for&nbsp;N&nbsp;=&nbsp;len(data).</span><br>
<span class="lineno">35</span><span class="keyword" id="6374648">func</span>&nbsp;<span class="ident" id="6374653">New</span><span class="op" id="6374656">(</span><span class="ident" id="6374657">data</span>&nbsp;<span class="op" id="6374662">[</span><span class="op" id="6374663">]</span><span class="builtintype" id="6374664">byte</span><span class="op" id="6374668">)</span>&nbsp;<span class="op" id="6374670">*</span><span class="ident" id="6374671">Index</span>&nbsp;<span class="op" id="6374677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374680">return</span>&nbsp;<span class="op" id="6374687">&amp;</span><span class="ident" id="6374688">Index</span><span class="op" id="6374693">{</span><span class="ident" id="6374694">data</span><span class="op" id="6374698">,</span>&nbsp;<span class="ident" id="6374700">qsufsort</span><span class="op" id="6374708">(</span><span class="ident" id="6374709">data</span><span class="op" id="6374713">)</span><span class="op" id="6374714">}</span><br>
<span class="lineno"></span><span class="op" id="6374716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6374719">//&nbsp;writeInt&nbsp;writes&nbsp;an&nbsp;int&nbsp;x&nbsp;to&nbsp;w&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">40</span><span class="keyword" id="6374783">func</span>&nbsp;<span class="ident" id="6374788">writeInt</span><span class="op" id="6374796">(</span><span class="ident" id="6374797">w</span>&nbsp;<span class="ident" id="6374799">io</span><span class="op" id="6374801">.</span><span class="ident" id="6374802">Writer</span><span class="op" id="6374808">,</span>&nbsp;<span class="ident" id="6374810">buf</span>&nbsp;<span class="op" id="6374814">[</span><span class="op" id="6374815">]</span><span class="builtintype" id="6374816">byte</span><span class="op" id="6374820">,</span>&nbsp;<span class="ident" id="6374822">x</span>&nbsp;<span class="builtintype" id="6374824">int</span><span class="op" id="6374827">)</span>&nbsp;<span class="builtintype" id="6374829">error</span>&nbsp;<span class="op" id="6374835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374838">binary</span><span class="op" id="6374844">.</span><span class="ident" id="6374845">PutVarint</span><span class="op" id="6374854">(</span><span class="ident" id="6374855">buf</span><span class="op" id="6374858">,</span>&nbsp;<span class="ident" id="6374860">int64</span><span class="op" id="6374865">(</span><span class="ident" id="6374866">x</span><span class="op" id="6374867">)</span><span class="op" id="6374868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374871">_</span><span class="op" id="6374872">,</span>&nbsp;<span class="ident" id="6374874">err</span>&nbsp;<span class="op" id="6374878">:=</span>&nbsp;<span class="ident" id="6374881">w</span><span class="op" id="6374882">.</span><span class="ident" id="6374883">Write</span><span class="op" id="6374888">(</span><span class="ident" id="6374889">buf</span><span class="op" id="6374892">[</span><span class="num" id="6374893">0</span><span class="op" id="6374894">:</span><span class="ident" id="6374895">binary</span><span class="op" id="6374901">.</span><span class="ident" id="6374902">MaxVarintLen64</span><span class="op" id="6374916">]</span><span class="op" id="6374917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374920">return</span>&nbsp;<span class="ident" id="6374927">err</span><br>
<span class="lineno"></span><span class="op" id="6374931">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6374934">//&nbsp;readInt&nbsp;reads&nbsp;an&nbsp;int&nbsp;x&nbsp;from&nbsp;r&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read&nbsp;and&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="6375011">func</span>&nbsp;<span class="ident" id="6375016">readInt</span><span class="op" id="6375023">(</span><span class="ident" id="6375024">r</span>&nbsp;<span class="ident" id="6375026">io</span><span class="op" id="6375028">.</span><span class="ident" id="6375029">Reader</span><span class="op" id="6375035">,</span>&nbsp;<span class="ident" id="6375037">buf</span>&nbsp;<span class="op" id="6375041">[</span><span class="op" id="6375042">]</span><span class="builtintype" id="6375043">byte</span><span class="op" id="6375047">)</span>&nbsp;<span class="op" id="6375049">(</span><span class="builtintype" id="6375050">int</span><span class="op" id="6375053">,</span>&nbsp;<span class="builtintype" id="6375055">error</span><span class="op" id="6375060">)</span>&nbsp;<span class="op" id="6375062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375065">_</span><span class="op" id="6375066">,</span>&nbsp;<span class="ident" id="6375068">err</span>&nbsp;<span class="op" id="6375072">:=</span>&nbsp;<span class="ident" id="6375075">io</span><span class="op" id="6375077">.</span><span class="ident" id="6375078">ReadFull</span><span class="op" id="6375086">(</span><span class="ident" id="6375087">r</span><span class="op" id="6375088">,</span>&nbsp;<span class="ident" id="6375090">buf</span><span class="op" id="6375093">[</span><span class="num" id="6375094">0</span><span class="op" id="6375095">:</span><span class="ident" id="6375096">binary</span><span class="op" id="6375102">.</span><span class="ident" id="6375103">MaxVarintLen64</span><span class="op" id="6375117">]</span><span class="op" id="6375118">)</span>&nbsp;<span class="comment" id="6375120">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;with&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375150">x</span><span class="op" id="6375151">,</span>&nbsp;<span class="ident" id="6375153">_</span>&nbsp;<span class="op" id="6375155">:=</span>&nbsp;<span class="ident" id="6375158">binary</span><span class="op" id="6375164">.</span><span class="ident" id="6375165">Varint</span><span class="op" id="6375171">(</span><span class="ident" id="6375172">buf</span><span class="op" id="6375175">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375178">return</span>&nbsp;<span class="builtintype" id="6375185">int</span><span class="op" id="6375188">(</span><span class="ident" id="6375189">x</span><span class="op" id="6375190">)</span><span class="op" id="6375191">,</span>&nbsp;<span class="ident" id="6375193">err</span><br>
<span class="lineno"></span><span class="op" id="6375197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6375200">//&nbsp;writeSlice&nbsp;writes&nbsp;data[:n]&nbsp;to&nbsp;w&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="6375250">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">55</span><span class="keyword" id="6375286">func</span>&nbsp;<span class="ident" id="6375291">writeSlice</span><span class="op" id="6375301">(</span><span class="ident" id="6375302">w</span>&nbsp;<span class="ident" id="6375304">io</span><span class="op" id="6375306">.</span><span class="ident" id="6375307">Writer</span><span class="op" id="6375313">,</span>&nbsp;<span class="ident" id="6375315">buf</span>&nbsp;<span class="op" id="6375319">[</span><span class="op" id="6375320">]</span><span class="builtintype" id="6375321">byte</span><span class="op" id="6375325">,</span>&nbsp;<span class="ident" id="6375327">data</span>&nbsp;<span class="op" id="6375332">[</span><span class="op" id="6375333">]</span><span class="builtintype" id="6375334">int</span><span class="op" id="6375337">)</span>&nbsp;<span class="op" id="6375339">(</span><span class="ident" id="6375340">n</span>&nbsp;<span class="builtintype" id="6375342">int</span><span class="op" id="6375345">,</span>&nbsp;<span class="ident" id="6375347">err</span>&nbsp;<span class="builtintype" id="6375351">error</span><span class="op" id="6375356">)</span>&nbsp;<span class="op" id="6375358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6375361">//&nbsp;encode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;fit&nbsp;into&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375405">p</span>&nbsp;<span class="op" id="6375407">:=</span>&nbsp;<span class="ident" id="6375410">binary</span><span class="op" id="6375416">.</span><span class="ident" id="6375417">MaxVarintLen64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375433">for</span>&nbsp;<span class="op" id="6375437">;</span>&nbsp;<span class="ident" id="6375439">n</span>&nbsp;<span class="op" id="6375441">&lt;</span>&nbsp;<span class="builtinfunc" id="6375443">len</span><span class="op" id="6375446">(</span><span class="ident" id="6375447">data</span><span class="op" id="6375451">)</span>&nbsp;<span class="op" id="6375453">&amp;&amp;</span>&nbsp;<span class="ident" id="6375456">p</span><span class="op" id="6375457">+</span><span class="ident" id="6375458">binary</span><span class="op" id="6375464">.</span><span class="ident" id="6375465">MaxVarintLen64</span>&nbsp;<span class="op" id="6375480">&lt;=</span>&nbsp;<span class="builtinfunc" id="6375483">len</span><span class="op" id="6375486">(</span><span class="ident" id="6375487">buf</span><span class="op" id="6375490">)</span><span class="op" id="6375491">;</span>&nbsp;<span class="ident" id="6375493">n</span><span class="op" id="6375494">++</span>&nbsp;<span class="op" id="6375497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375501">p</span>&nbsp;<span class="op" id="6375503">+=</span>&nbsp;<span class="ident" id="6375506">binary</span><span class="op" id="6375512">.</span><span class="ident" id="6375513">PutUvarint</span><span class="op" id="6375523">(</span><span class="ident" id="6375524">buf</span><span class="op" id="6375527">[</span><span class="ident" id="6375528">p</span><span class="op" id="6375529">:</span><span class="op" id="6375530">]</span><span class="op" id="6375531">,</span>&nbsp;<span class="ident" id="6375533">uint64</span><span class="op" id="6375539">(</span><span class="ident" id="6375540">data</span><span class="op" id="6375544">[</span><span class="ident" id="6375545">n</span><span class="op" id="6375546">]</span><span class="op" id="6375547">)</span><span class="op" id="6375548">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6375551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6375555">//&nbsp;update&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375578">binary</span><span class="op" id="6375584">.</span><span class="ident" id="6375585">PutVarint</span><span class="op" id="6375594">(</span><span class="ident" id="6375595">buf</span><span class="op" id="6375598">,</span>&nbsp;<span class="ident" id="6375600">int64</span><span class="op" id="6375605">(</span><span class="ident" id="6375606">p</span><span class="op" id="6375607">)</span><span class="op" id="6375608">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6375612">//&nbsp;write&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375629">_</span><span class="op" id="6375630">,</span>&nbsp;<span class="ident" id="6375632">err</span>&nbsp;<span class="op" id="6375636">=</span>&nbsp;<span class="ident" id="6375638">w</span><span class="op" id="6375639">.</span><span class="ident" id="6375640">Write</span><span class="op" id="6375645">(</span><span class="ident" id="6375646">buf</span><span class="op" id="6375649">[</span><span class="num" id="6375650">0</span><span class="op" id="6375651">:</span><span class="ident" id="6375652">p</span><span class="op" id="6375653">]</span><span class="op" id="6375654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375657">return</span><br>
<span class="lineno"></span><span class="op" id="6375664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="6375667">//&nbsp;readSlice&nbsp;reads&nbsp;data[:n]&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="6375717">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="6375752">func</span>&nbsp;<span class="ident" id="6375757">readSlice</span><span class="op" id="6375766">(</span><span class="ident" id="6375767">r</span>&nbsp;<span class="ident" id="6375769">io</span><span class="op" id="6375771">.</span><span class="ident" id="6375772">Reader</span><span class="op" id="6375778">,</span>&nbsp;<span class="ident" id="6375780">buf</span>&nbsp;<span class="op" id="6375784">[</span><span class="op" id="6375785">]</span><span class="builtintype" id="6375786">byte</span><span class="op" id="6375790">,</span>&nbsp;<span class="ident" id="6375792">data</span>&nbsp;<span class="op" id="6375797">[</span><span class="op" id="6375798">]</span><span class="builtintype" id="6375799">int</span><span class="op" id="6375802">)</span>&nbsp;<span class="op" id="6375804">(</span><span class="ident" id="6375805">n</span>&nbsp;<span class="builtintype" id="6375807">int</span><span class="op" id="6375810">,</span>&nbsp;<span class="ident" id="6375812">err</span>&nbsp;<span class="builtintype" id="6375816">error</span><span class="op" id="6375821">)</span>&nbsp;<span class="op" id="6375823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6375826">//&nbsp;read&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375847">var</span>&nbsp;<span class="ident" id="6375851">size</span>&nbsp;<span class="builtintype" id="6375856">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375861">size</span><span class="op" id="6375865">,</span>&nbsp;<span class="ident" id="6375867">err</span>&nbsp;<span class="op" id="6375871">=</span>&nbsp;<span class="ident" id="6375873">readInt</span><span class="op" id="6375880">(</span><span class="ident" id="6375881">r</span><span class="op" id="6375882">,</span>&nbsp;<span class="ident" id="6375884">buf</span><span class="op" id="6375887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375890">if</span>&nbsp;<span class="ident" id="6375893">err</span>&nbsp;<span class="op" id="6375897">!=</span>&nbsp;<span class="ident" id="6375900">nil</span>&nbsp;<span class="op" id="6375904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375908">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6375916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6375920">//&nbsp;read&nbsp;buffer&nbsp;w/o&nbsp;the&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375949">if</span>&nbsp;<span class="ident" id="6375952">_</span><span class="op" id="6375953">,</span>&nbsp;<span class="ident" id="6375955">err</span>&nbsp;<span class="op" id="6375959">=</span>&nbsp;<span class="ident" id="6375961">io</span><span class="op" id="6375963">.</span><span class="ident" id="6375964">ReadFull</span><span class="op" id="6375972">(</span><span class="ident" id="6375973">r</span><span class="op" id="6375974">,</span>&nbsp;<span class="ident" id="6375976">buf</span><span class="op" id="6375979">[</span><span class="ident" id="6375980">binary</span><span class="op" id="6375986">.</span><span class="ident" id="6375987">MaxVarintLen64</span><span class="op" id="6376001">:</span><span class="ident" id="6376002">size</span><span class="op" id="6376006">]</span><span class="op" id="6376007">)</span><span class="op" id="6376008">;</span>&nbsp;<span class="ident" id="6376010">err</span>&nbsp;<span class="op" id="6376014">!=</span>&nbsp;<span class="ident" id="6376017">nil</span>&nbsp;<span class="op" id="6376021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376025">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6376037">//&nbsp;decode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;present&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376083">for</span>&nbsp;<span class="ident" id="6376087">p</span>&nbsp;<span class="op" id="6376089">:=</span>&nbsp;<span class="ident" id="6376092">binary</span><span class="op" id="6376098">.</span><span class="ident" id="6376099">MaxVarintLen64</span><span class="op" id="6376113">;</span>&nbsp;<span class="ident" id="6376115">p</span>&nbsp;<span class="op" id="6376117">&lt;</span>&nbsp;<span class="ident" id="6376119">size</span><span class="op" id="6376123">;</span>&nbsp;<span class="ident" id="6376125">n</span><span class="op" id="6376126">++</span>&nbsp;<span class="op" id="6376129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376133">x</span><span class="op" id="6376134">,</span>&nbsp;<span class="ident" id="6376136">w</span>&nbsp;<span class="op" id="6376138">:=</span>&nbsp;<span class="ident" id="6376141">binary</span><span class="op" id="6376147">.</span><span class="ident" id="6376148">Uvarint</span><span class="op" id="6376155">(</span><span class="ident" id="6376156">buf</span><span class="op" id="6376159">[</span><span class="ident" id="6376160">p</span><span class="op" id="6376161">:</span><span class="op" id="6376162">]</span><span class="op" id="6376163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376167">data</span><span class="op" id="6376171">[</span><span class="ident" id="6376172">n</span><span class="op" id="6376173">]</span>&nbsp;<span class="op" id="6376175">=</span>&nbsp;<span class="builtintype" id="6376177">int</span><span class="op" id="6376180">(</span><span class="ident" id="6376181">x</span><span class="op" id="6376182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376186">p</span>&nbsp;<span class="op" id="6376188">+=</span>&nbsp;<span class="ident" id="6376191">w</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376198">return</span><br>
<span class="lineno"></span><span class="op" id="6376205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6376208">const</span>&nbsp;<span class="ident" id="6376214">bufSize</span>&nbsp;<span class="op" id="6376222">=</span>&nbsp;<span class="num" id="6376224">16</span>&nbsp;<span class="op" id="6376227">&lt;&lt;</span>&nbsp;<span class="num" id="6376230">10</span>&nbsp;<span class="comment" id="6376233">//&nbsp;reasonable&nbsp;for&nbsp;BenchmarkSaveRestore</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6376273">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;index&nbsp;from&nbsp;r&nbsp;into&nbsp;x;&nbsp;x&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="6376331">func</span>&nbsp;<span class="op" id="6376336">(</span><span class="ident" id="6376337">x</span>&nbsp;<span class="op" id="6376339">*</span><span class="ident" id="6376340">Index</span><span class="op" id="6376345">)</span>&nbsp;<span class="ident" id="6376347">Read</span><span class="op" id="6376351">(</span><span class="ident" id="6376352">r</span>&nbsp;<span class="ident" id="6376354">io</span><span class="op" id="6376356">.</span><span class="ident" id="6376357">Reader</span><span class="op" id="6376363">)</span>&nbsp;<span class="builtintype" id="6376365">error</span>&nbsp;<span class="op" id="6376371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6376374">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;reads</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376399">buf</span>&nbsp;<span class="op" id="6376403">:=</span>&nbsp;<span class="builtinfunc" id="6376406">make</span><span class="op" id="6376410">(</span><span class="op" id="6376411">[</span><span class="op" id="6376412">]</span><span class="builtintype" id="6376413">byte</span><span class="op" id="6376417">,</span>&nbsp;<span class="ident" id="6376419">bufSize</span><span class="op" id="6376426">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6376430">//&nbsp;read&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376446">n</span><span class="op" id="6376447">,</span>&nbsp;<span class="ident" id="6376449">err</span>&nbsp;<span class="op" id="6376453">:=</span>&nbsp;<span class="ident" id="6376456">readInt</span><span class="op" id="6376463">(</span><span class="ident" id="6376464">r</span><span class="op" id="6376465">,</span>&nbsp;<span class="ident" id="6376467">buf</span><span class="op" id="6376470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376473">if</span>&nbsp;<span class="ident" id="6376476">err</span>&nbsp;<span class="op" id="6376480">!=</span>&nbsp;<span class="ident" id="6376483">nil</span>&nbsp;<span class="op" id="6376487">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376491">return</span>&nbsp;<span class="ident" id="6376498">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6376507">//&nbsp;allocate&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376526">if</span>&nbsp;<span class="num" id="6376529">2</span><span class="op" id="6376530">*</span><span class="ident" id="6376531">n</span>&nbsp;<span class="op" id="6376533">&lt;</span>&nbsp;<span class="builtinfunc" id="6376535">cap</span><span class="op" id="6376538">(</span><span class="ident" id="6376539">x</span><span class="op" id="6376540">.</span><span class="ident" id="6376541">data</span><span class="op" id="6376545">)</span>&nbsp;<span class="op" id="6376547">||</span>&nbsp;<span class="builtinfunc" id="6376550">cap</span><span class="op" id="6376553">(</span><span class="ident" id="6376554">x</span><span class="op" id="6376555">.</span><span class="ident" id="6376556">data</span><span class="op" id="6376560">)</span>&nbsp;<span class="op" id="6376562">&lt;</span>&nbsp;<span class="ident" id="6376564">n</span>&nbsp;<span class="op" id="6376566">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6376570">//&nbsp;new&nbsp;data&nbsp;is&nbsp;significantly&nbsp;smaller&nbsp;or&nbsp;larger&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6376624">//&nbsp;existing&nbsp;buffers&nbsp;-&nbsp;allocate&nbsp;new&nbsp;ones</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376666">x</span><span class="op" id="6376667">.</span><span class="ident" id="6376668">data</span>&nbsp;<span class="op" id="6376673">=</span>&nbsp;<span class="builtinfunc" id="6376675">make</span><span class="op" id="6376679">(</span><span class="op" id="6376680">[</span><span class="op" id="6376681">]</span><span class="builtintype" id="6376682">byte</span><span class="op" id="6376686">,</span>&nbsp;<span class="ident" id="6376688">n</span><span class="op" id="6376689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376693">x</span><span class="op" id="6376694">.</span><span class="ident" id="6376695">sa</span>&nbsp;<span class="op" id="6376698">=</span>&nbsp;<span class="builtinfunc" id="6376700">make</span><span class="op" id="6376704">(</span><span class="op" id="6376705">[</span><span class="op" id="6376706">]</span><span class="builtintype" id="6376707">int</span><span class="op" id="6376710">,</span>&nbsp;<span class="ident" id="6376712">n</span><span class="op" id="6376713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376716">}</span>&nbsp;<span class="keyword" id="6376718">else</span>&nbsp;<span class="op" id="6376723">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6376727">//&nbsp;re-use&nbsp;existing&nbsp;buffers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376756">x</span><span class="op" id="6376757">.</span><span class="ident" id="6376758">data</span>&nbsp;<span class="op" id="6376763">=</span>&nbsp;<span class="ident" id="6376765">x</span><span class="op" id="6376766">.</span><span class="ident" id="6376767">data</span><span class="op" id="6376771">[</span><span class="num" id="6376772">0</span><span class="op" id="6376773">:</span><span class="ident" id="6376774">n</span><span class="op" id="6376775">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376779">x</span><span class="op" id="6376780">.</span><span class="ident" id="6376781">sa</span>&nbsp;<span class="op" id="6376784">=</span>&nbsp;<span class="ident" id="6376786">x</span><span class="op" id="6376787">.</span><span class="ident" id="6376788">sa</span><span class="op" id="6376790">[</span><span class="num" id="6376791">0</span><span class="op" id="6376792">:</span><span class="ident" id="6376793">n</span><span class="op" id="6376794">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6376801">//&nbsp;read&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376815">if</span>&nbsp;<span class="ident" id="6376818">_</span><span class="op" id="6376819">,</span>&nbsp;<span class="ident" id="6376821">err</span>&nbsp;<span class="op" id="6376825">:=</span>&nbsp;<span class="ident" id="6376828">io</span><span class="op" id="6376830">.</span><span class="ident" id="6376831">ReadFull</span><span class="op" id="6376839">(</span><span class="ident" id="6376840">r</span><span class="op" id="6376841">,</span>&nbsp;<span class="ident" id="6376843">x</span><span class="op" id="6376844">.</span><span class="ident" id="6376845">data</span><span class="op" id="6376849">)</span><span class="op" id="6376850">;</span>&nbsp;<span class="ident" id="6376852">err</span>&nbsp;<span class="op" id="6376856">!=</span>&nbsp;<span class="ident" id="6376859">nil</span>&nbsp;<span class="op" id="6376863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376867">return</span>&nbsp;<span class="ident" id="6376874">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6376883">//&nbsp;read&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376898">for</span>&nbsp;<span class="ident" id="6376902">sa</span>&nbsp;<span class="op" id="6376905">:=</span>&nbsp;<span class="ident" id="6376908">x</span><span class="op" id="6376909">.</span><span class="ident" id="6376910">sa</span><span class="op" id="6376912">;</span>&nbsp;<span class="builtinfunc" id="6376914">len</span><span class="op" id="6376917">(</span><span class="ident" id="6376918">sa</span><span class="op" id="6376920">)</span>&nbsp;<span class="op" id="6376922">&gt;</span>&nbsp;<span class="num" id="6376924">0</span><span class="op" id="6376925">;</span>&nbsp;<span class="op" id="6376927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376931">n</span><span class="op" id="6376932">,</span>&nbsp;<span class="ident" id="6376934">err</span>&nbsp;<span class="op" id="6376938">:=</span>&nbsp;<span class="ident" id="6376941">readSlice</span><span class="op" id="6376950">(</span><span class="ident" id="6376951">r</span><span class="op" id="6376952">,</span>&nbsp;<span class="ident" id="6376954">buf</span><span class="op" id="6376957">,</span>&nbsp;<span class="ident" id="6376959">sa</span><span class="op" id="6376961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376965">if</span>&nbsp;<span class="ident" id="6376968">err</span>&nbsp;<span class="op" id="6376972">!=</span>&nbsp;<span class="ident" id="6376975">nil</span>&nbsp;<span class="op" id="6376979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376984">return</span>&nbsp;<span class="ident" id="6376991">err</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377001">sa</span>&nbsp;<span class="op" id="6377004">=</span>&nbsp;<span class="ident" id="6377006">sa</span><span class="op" id="6377008">[</span><span class="ident" id="6377009">n</span><span class="op" id="6377010">:</span><span class="op" id="6377011">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6377014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377017">return</span>&nbsp;<span class="ident" id="6377024">nil</span><br>
<span class="lineno"></span><span class="op" id="6377028">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="6377031">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;index&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6377065">func</span>&nbsp;<span class="op" id="6377070">(</span><span class="ident" id="6377071">x</span>&nbsp;<span class="op" id="6377073">*</span><span class="ident" id="6377074">Index</span><span class="op" id="6377079">)</span>&nbsp;<span class="ident" id="6377081">Write</span><span class="op" id="6377086">(</span><span class="ident" id="6377087">w</span>&nbsp;<span class="ident" id="6377089">io</span><span class="op" id="6377091">.</span><span class="ident" id="6377092">Writer</span><span class="op" id="6377098">)</span>&nbsp;<span class="builtintype" id="6377100">error</span>&nbsp;<span class="op" id="6377106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377109">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377135">buf</span>&nbsp;<span class="op" id="6377139">:=</span>&nbsp;<span class="builtinfunc" id="6377142">make</span><span class="op" id="6377146">(</span><span class="op" id="6377147">[</span><span class="op" id="6377148">]</span><span class="builtintype" id="6377149">byte</span><span class="op" id="6377153">,</span>&nbsp;<span class="ident" id="6377155">bufSize</span><span class="op" id="6377162">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377166">//&nbsp;write&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377183">if</span>&nbsp;<span class="ident" id="6377186">err</span>&nbsp;<span class="op" id="6377190">:=</span>&nbsp;<span class="ident" id="6377193">writeInt</span><span class="op" id="6377201">(</span><span class="ident" id="6377202">w</span><span class="op" id="6377203">,</span>&nbsp;<span class="ident" id="6377205">buf</span><span class="op" id="6377208">,</span>&nbsp;<span class="builtinfunc" id="6377210">len</span><span class="op" id="6377213">(</span><span class="ident" id="6377214">x</span><span class="op" id="6377215">.</span><span class="ident" id="6377216">data</span><span class="op" id="6377220">)</span><span class="op" id="6377221">)</span><span class="op" id="6377222">;</span>&nbsp;<span class="ident" id="6377224">err</span>&nbsp;<span class="op" id="6377228">!=</span>&nbsp;<span class="ident" id="6377231">nil</span>&nbsp;<span class="op" id="6377235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377239">return</span>&nbsp;<span class="ident" id="6377246">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6377251">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377255">//&nbsp;write&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377270">if</span>&nbsp;<span class="ident" id="6377273">_</span><span class="op" id="6377274">,</span>&nbsp;<span class="ident" id="6377276">err</span>&nbsp;<span class="op" id="6377280">:=</span>&nbsp;<span class="ident" id="6377283">w</span><span class="op" id="6377284">.</span><span class="ident" id="6377285">Write</span><span class="op" id="6377290">(</span><span class="ident" id="6377291">x</span><span class="op" id="6377292">.</span><span class="ident" id="6377293">data</span><span class="op" id="6377297">)</span><span class="op" id="6377298">;</span>&nbsp;<span class="ident" id="6377300">err</span>&nbsp;<span class="op" id="6377304">!=</span>&nbsp;<span class="ident" id="6377307">nil</span>&nbsp;<span class="op" id="6377311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377315">return</span>&nbsp;<span class="ident" id="6377322">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6377327">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377331">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377347">for</span>&nbsp;<span class="ident" id="6377351">sa</span>&nbsp;<span class="op" id="6377354">:=</span>&nbsp;<span class="ident" id="6377357">x</span><span class="op" id="6377358">.</span><span class="ident" id="6377359">sa</span><span class="op" id="6377361">;</span>&nbsp;<span class="builtinfunc" id="6377363">len</span><span class="op" id="6377366">(</span><span class="ident" id="6377367">sa</span><span class="op" id="6377369">)</span>&nbsp;<span class="op" id="6377371">&gt;</span>&nbsp;<span class="num" id="6377373">0</span><span class="op" id="6377374">;</span>&nbsp;<span class="op" id="6377376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377380">n</span><span class="op" id="6377381">,</span>&nbsp;<span class="ident" id="6377383">err</span>&nbsp;<span class="op" id="6377387">:=</span>&nbsp;<span class="ident" id="6377390">writeSlice</span><span class="op" id="6377400">(</span><span class="ident" id="6377401">w</span><span class="op" id="6377402">,</span>&nbsp;<span class="ident" id="6377404">buf</span><span class="op" id="6377407">,</span>&nbsp;<span class="ident" id="6377409">sa</span><span class="op" id="6377411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377415">if</span>&nbsp;<span class="ident" id="6377418">err</span>&nbsp;<span class="op" id="6377422">!=</span>&nbsp;<span class="ident" id="6377425">nil</span>&nbsp;<span class="op" id="6377429">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377434">return</span>&nbsp;<span class="ident" id="6377441">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6377447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377451">sa</span>&nbsp;<span class="op" id="6377454">=</span>&nbsp;<span class="ident" id="6377456">sa</span><span class="op" id="6377458">[</span><span class="ident" id="6377459">n</span><span class="op" id="6377460">:</span><span class="op" id="6377461">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6377464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377467">return</span>&nbsp;<span class="ident" id="6377474">nil</span><br>
<span class="lineno">160</span><span class="op" id="6377478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6377481">//&nbsp;Bytes&nbsp;returns&nbsp;the&nbsp;data&nbsp;over&nbsp;which&nbsp;the&nbsp;index&nbsp;was&nbsp;created.</span><br>
<span class="lineno"></span><span class="comment" id="6377541">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="comment" id="6377569">//</span><br>
<span class="lineno">165</span><span class="keyword" id="6377572">func</span>&nbsp;<span class="op" id="6377577">(</span><span class="ident" id="6377578">x</span>&nbsp;<span class="op" id="6377580">*</span><span class="ident" id="6377581">Index</span><span class="op" id="6377586">)</span>&nbsp;<span class="ident" id="6377588">Bytes</span><span class="op" id="6377593">(</span><span class="op" id="6377594">)</span>&nbsp;<span class="op" id="6377596">[</span><span class="op" id="6377597">]</span><span class="builtintype" id="6377598">byte</span>&nbsp;<span class="op" id="6377603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377606">return</span>&nbsp;<span class="ident" id="6377613">x</span><span class="op" id="6377614">.</span><span class="ident" id="6377615">data</span><br>
<span class="lineno"></span><span class="op" id="6377620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6377623">func</span>&nbsp;<span class="op" id="6377628">(</span><span class="ident" id="6377629">x</span>&nbsp;<span class="op" id="6377631">*</span><span class="ident" id="6377632">Index</span><span class="op" id="6377637">)</span>&nbsp;<span class="ident" id="6377639">at</span><span class="op" id="6377641">(</span><span class="ident" id="6377642">i</span>&nbsp;<span class="builtintype" id="6377644">int</span><span class="op" id="6377647">)</span>&nbsp;<span class="op" id="6377649">[</span><span class="op" id="6377650">]</span><span class="builtintype" id="6377651">byte</span>&nbsp;<span class="op" id="6377656">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377659">return</span>&nbsp;<span class="ident" id="6377666">x</span><span class="op" id="6377667">.</span><span class="ident" id="6377668">data</span><span class="op" id="6377672">[</span><span class="ident" id="6377673">x</span><span class="op" id="6377674">.</span><span class="ident" id="6377675">sa</span><span class="op" id="6377677">[</span><span class="ident" id="6377678">i</span><span class="op" id="6377679">]</span><span class="op" id="6377680">:</span><span class="op" id="6377681">]</span><br>
<span class="lineno"></span><span class="op" id="6377683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6377686">//&nbsp;lookupAll&nbsp;returns&nbsp;a&nbsp;slice&nbsp;into&nbsp;the&nbsp;matching&nbsp;region&nbsp;of&nbsp;the&nbsp;index.</span><br>
<span class="lineno"></span><span class="comment" id="6377754">//&nbsp;The&nbsp;runtime&nbsp;is&nbsp;O(log(N)*len(s)).</span><br>
<span class="lineno">175</span><span class="keyword" id="6377790">func</span>&nbsp;<span class="op" id="6377795">(</span><span class="ident" id="6377796">x</span>&nbsp;<span class="op" id="6377798">*</span><span class="ident" id="6377799">Index</span><span class="op" id="6377804">)</span>&nbsp;<span class="ident" id="6377806">lookupAll</span><span class="op" id="6377815">(</span><span class="ident" id="6377816">s</span>&nbsp;<span class="op" id="6377818">[</span><span class="op" id="6377819">]</span><span class="builtintype" id="6377820">byte</span><span class="op" id="6377824">)</span>&nbsp;<span class="op" id="6377826">[</span><span class="op" id="6377827">]</span><span class="builtintype" id="6377828">int</span>&nbsp;<span class="op" id="6377832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377835">//&nbsp;find&nbsp;matching&nbsp;suffix&nbsp;index&nbsp;range&nbsp;[i:j]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377878">//&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;where&nbsp;s&nbsp;would&nbsp;be&nbsp;the&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377931">i</span>&nbsp;<span class="op" id="6377933">:=</span>&nbsp;<span class="ident" id="6377936">sort</span><span class="op" id="6377940">.</span><span class="ident" id="6377941">Search</span><span class="op" id="6377947">(</span><span class="builtinfunc" id="6377948">len</span><span class="op" id="6377951">(</span><span class="ident" id="6377952">x</span><span class="op" id="6377953">.</span><span class="ident" id="6377954">sa</span><span class="op" id="6377956">)</span><span class="op" id="6377957">,</span>&nbsp;<span class="keyword" id="6377959">func</span><span class="op" id="6377963">(</span><span class="ident" id="6377964">i</span>&nbsp;<span class="builtintype" id="6377966">int</span><span class="op" id="6377969">)</span>&nbsp;<span class="builtintype" id="6377971">bool</span>&nbsp;<span class="op" id="6377976">{</span>&nbsp;<span class="keyword" id="6377978">return</span>&nbsp;<span class="ident" id="6377985">bytes</span><span class="op" id="6377990">.</span><span class="ident" id="6377991">Compare</span><span class="op" id="6377998">(</span><span class="ident" id="6377999">x</span><span class="op" id="6378000">.</span><span class="ident" id="6378001">at</span><span class="op" id="6378003">(</span><span class="ident" id="6378004">i</span><span class="op" id="6378005">)</span><span class="op" id="6378006">,</span>&nbsp;<span class="ident" id="6378008">s</span><span class="op" id="6378009">)</span>&nbsp;<span class="op" id="6378011">&gt;=</span>&nbsp;<span class="num" id="6378014">0</span>&nbsp;<span class="op" id="6378016">}</span><span class="op" id="6378017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6378020">//&nbsp;starting&nbsp;at&nbsp;i,&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;at&nbsp;which&nbsp;s&nbsp;is&nbsp;not&nbsp;a&nbsp;prefix</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378087">j</span>&nbsp;<span class="op" id="6378089">:=</span>&nbsp;<span class="ident" id="6378092">i</span>&nbsp;<span class="op" id="6378094">+</span>&nbsp;<span class="ident" id="6378096">sort</span><span class="op" id="6378100">.</span><span class="ident" id="6378101">Search</span><span class="op" id="6378107">(</span><span class="builtinfunc" id="6378108">len</span><span class="op" id="6378111">(</span><span class="ident" id="6378112">x</span><span class="op" id="6378113">.</span><span class="ident" id="6378114">sa</span><span class="op" id="6378116">)</span><span class="op" id="6378117">-</span><span class="ident" id="6378118">i</span><span class="op" id="6378119">,</span>&nbsp;<span class="keyword" id="6378121">func</span><span class="op" id="6378125">(</span><span class="ident" id="6378126">j</span>&nbsp;<span class="builtintype" id="6378128">int</span><span class="op" id="6378131">)</span>&nbsp;<span class="builtintype" id="6378133">bool</span>&nbsp;<span class="op" id="6378138">{</span>&nbsp;<span class="keyword" id="6378140">return</span>&nbsp;<span class="op" id="6378147">!</span><span class="ident" id="6378148">bytes</span><span class="op" id="6378153">.</span><span class="ident" id="6378154">HasPrefix</span><span class="op" id="6378163">(</span><span class="ident" id="6378164">x</span><span class="op" id="6378165">.</span><span class="ident" id="6378166">at</span><span class="op" id="6378168">(</span><span class="ident" id="6378169">j</span><span class="op" id="6378170">+</span><span class="ident" id="6378171">i</span><span class="op" id="6378172">)</span><span class="op" id="6378173">,</span>&nbsp;<span class="ident" id="6378175">s</span><span class="op" id="6378176">)</span>&nbsp;<span class="op" id="6378178">}</span><span class="op" id="6378179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378182">return</span>&nbsp;<span class="ident" id="6378189">x</span><span class="op" id="6378190">.</span><span class="ident" id="6378191">sa</span><span class="op" id="6378193">[</span><span class="ident" id="6378194">i</span><span class="op" id="6378195">:</span><span class="ident" id="6378196">j</span><span class="op" id="6378197">]</span><br>
<span class="lineno"></span><span class="op" id="6378199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6378202">//&nbsp;Lookup&nbsp;returns&nbsp;an&nbsp;unsorted&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;n&nbsp;indices&nbsp;where&nbsp;the&nbsp;byte&nbsp;string&nbsp;s</span><br>
<span class="lineno">185</span><span class="comment" id="6378282">//&nbsp;occurs&nbsp;in&nbsp;the&nbsp;indexed&nbsp;data.&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;occurrences&nbsp;are&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="6378353">//&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;s&nbsp;is&nbsp;empty,&nbsp;s&nbsp;is&nbsp;not&nbsp;found,&nbsp;or&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="6378416">//&nbsp;Lookup&nbsp;time&nbsp;is&nbsp;O(log(N)*len(s)&nbsp;+&nbsp;len(result))&nbsp;where&nbsp;N&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6378480">//&nbsp;size&nbsp;of&nbsp;the&nbsp;indexed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="6378509">//</span><br>
<span class="lineno">190</span><span class="keyword" id="6378512">func</span>&nbsp;<span class="op" id="6378517">(</span><span class="ident" id="6378518">x</span>&nbsp;<span class="op" id="6378520">*</span><span class="ident" id="6378521">Index</span><span class="op" id="6378526">)</span>&nbsp;<span class="ident" id="6378528">Lookup</span><span class="op" id="6378534">(</span><span class="ident" id="6378535">s</span>&nbsp;<span class="op" id="6378537">[</span><span class="op" id="6378538">]</span><span class="builtintype" id="6378539">byte</span><span class="op" id="6378543">,</span>&nbsp;<span class="ident" id="6378545">n</span>&nbsp;<span class="builtintype" id="6378547">int</span><span class="op" id="6378550">)</span>&nbsp;<span class="op" id="6378552">(</span><span class="ident" id="6378553">result</span>&nbsp;<span class="op" id="6378560">[</span><span class="op" id="6378561">]</span><span class="builtintype" id="6378562">int</span><span class="op" id="6378565">)</span>&nbsp;<span class="op" id="6378567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378570">if</span>&nbsp;<span class="builtinfunc" id="6378573">len</span><span class="op" id="6378576">(</span><span class="ident" id="6378577">s</span><span class="op" id="6378578">)</span>&nbsp;<span class="op" id="6378580">&gt;</span>&nbsp;<span class="num" id="6378582">0</span>&nbsp;<span class="op" id="6378584">&amp;&amp;</span>&nbsp;<span class="ident" id="6378587">n</span>&nbsp;<span class="op" id="6378589">!=</span>&nbsp;<span class="num" id="6378592">0</span>&nbsp;<span class="op" id="6378594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378598">matches</span>&nbsp;<span class="op" id="6378606">:=</span>&nbsp;<span class="ident" id="6378609">x</span><span class="op" id="6378610">.</span><span class="ident" id="6378611">lookupAll</span><span class="op" id="6378620">(</span><span class="ident" id="6378621">s</span><span class="op" id="6378622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378626">if</span>&nbsp;<span class="ident" id="6378629">n</span>&nbsp;<span class="op" id="6378631">&lt;</span>&nbsp;<span class="num" id="6378633">0</span>&nbsp;<span class="op" id="6378635">||</span>&nbsp;<span class="builtinfunc" id="6378638">len</span><span class="op" id="6378641">(</span><span class="ident" id="6378642">matches</span><span class="op" id="6378649">)</span>&nbsp;<span class="op" id="6378651">&lt;</span>&nbsp;<span class="ident" id="6378653">n</span>&nbsp;<span class="op" id="6378655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378660">n</span>&nbsp;<span class="op" id="6378662">=</span>&nbsp;<span class="builtinfunc" id="6378664">len</span><span class="op" id="6378667">(</span><span class="ident" id="6378668">matches</span><span class="op" id="6378675">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6378679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6378683">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(matches)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378711">if</span>&nbsp;<span class="ident" id="6378714">n</span>&nbsp;<span class="op" id="6378716">&gt;</span>&nbsp;<span class="num" id="6378718">0</span>&nbsp;<span class="op" id="6378720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378725">result</span>&nbsp;<span class="op" id="6378732">=</span>&nbsp;<span class="builtinfunc" id="6378734">make</span><span class="op" id="6378738">(</span><span class="op" id="6378739">[</span><span class="op" id="6378740">]</span><span class="builtintype" id="6378741">int</span><span class="op" id="6378744">,</span>&nbsp;<span class="ident" id="6378746">n</span><span class="op" id="6378747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6378752">copy</span><span class="op" id="6378756">(</span><span class="ident" id="6378757">result</span><span class="op" id="6378763">,</span>&nbsp;<span class="ident" id="6378765">matches</span><span class="op" id="6378772">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6378776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6378779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378782">return</span><br>
<span class="lineno"></span><span class="op" id="6378789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="6378792">//&nbsp;FindAllIndex&nbsp;returns&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;non-overlapping&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6378864">//&nbsp;regular&nbsp;expression&nbsp;r,&nbsp;where&nbsp;a&nbsp;match&nbsp;is&nbsp;a&nbsp;pair&nbsp;of&nbsp;indices&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="6378935">//&nbsp;the&nbsp;matched&nbsp;slice&nbsp;of&nbsp;x.Bytes().&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;matches&nbsp;are&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="6379005">//&nbsp;in&nbsp;successive&nbsp;order.&nbsp;Otherwise,&nbsp;at&nbsp;most&nbsp;n&nbsp;matches&nbsp;are&nbsp;returned&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6379075">//&nbsp;they&nbsp;may&nbsp;not&nbsp;be&nbsp;successive.&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;matches,</span><br>
<span class="lineno">210</span><span class="comment" id="6379149">//&nbsp;or&nbsp;if&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="6379166">//</span><br>
<span class="lineno"></span><span class="keyword" id="6379169">func</span>&nbsp;<span class="op" id="6379174">(</span><span class="ident" id="6379175">x</span>&nbsp;<span class="op" id="6379177">*</span><span class="ident" id="6379178">Index</span><span class="op" id="6379183">)</span>&nbsp;<span class="ident" id="6379185">FindAllIndex</span><span class="op" id="6379197">(</span><span class="ident" id="6379198">r</span>&nbsp;<span class="op" id="6379200">*</span><span class="ident" id="6379201">regexp</span><span class="op" id="6379207">.</span><span class="ident" id="6379208">Regexp</span><span class="op" id="6379214">,</span>&nbsp;<span class="ident" id="6379216">n</span>&nbsp;<span class="builtintype" id="6379218">int</span><span class="op" id="6379221">)</span>&nbsp;<span class="op" id="6379223">(</span><span class="ident" id="6379224">result</span>&nbsp;<span class="op" id="6379231">[</span><span class="op" id="6379232">]</span><span class="op" id="6379233">[</span><span class="op" id="6379234">]</span><span class="builtintype" id="6379235">int</span><span class="op" id="6379238">)</span>&nbsp;<span class="op" id="6379240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379243">//&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix&nbsp;is&nbsp;used&nbsp;to&nbsp;determine&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379304">//&nbsp;match&nbsp;start&nbsp;indices&nbsp;with&nbsp;Lookup</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379340">prefix</span><span class="op" id="6379346">,</span>&nbsp;<span class="ident" id="6379348">complete</span>&nbsp;<span class="op" id="6379357">:=</span>&nbsp;<span class="ident" id="6379360">r</span><span class="op" id="6379361">.</span><span class="ident" id="6379362">LiteralPrefix</span><span class="op" id="6379375">(</span><span class="op" id="6379376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379379">lit</span>&nbsp;<span class="op" id="6379383">:=</span>&nbsp;<span class="op" id="6379386">[</span><span class="op" id="6379387">]</span><span class="builtintype" id="6379388">byte</span><span class="op" id="6379392">(</span><span class="ident" id="6379393">prefix</span><span class="op" id="6379399">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379403">//&nbsp;worst-case&nbsp;scenario:&nbsp;no&nbsp;literal&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379446">if</span>&nbsp;<span class="ident" id="6379449">prefix</span>&nbsp;<span class="op" id="6379456">==</span>&nbsp;<span class="string" id="6379459">&#34;&#34;</span>&nbsp;<span class="op" id="6379462">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379466">return</span>&nbsp;<span class="ident" id="6379473">r</span><span class="op" id="6379474">.</span><span class="ident" id="6379475">FindAllIndex</span><span class="op" id="6379487">(</span><span class="ident" id="6379488">x</span><span class="op" id="6379489">.</span><span class="ident" id="6379490">data</span><span class="op" id="6379494">,</span>&nbsp;<span class="ident" id="6379496">n</span><span class="op" id="6379497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6379500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379504">//&nbsp;if&nbsp;regexp&nbsp;is&nbsp;a&nbsp;literal&nbsp;just&nbsp;use&nbsp;Lookup&nbsp;and&nbsp;convert&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379563">//&nbsp;result&nbsp;into&nbsp;match&nbsp;pairs</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379591">if</span>&nbsp;<span class="ident" id="6379594">complete</span>&nbsp;<span class="op" id="6379603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379607">//&nbsp;Lookup&nbsp;returns&nbsp;indices&nbsp;that&nbsp;may&nbsp;belong&nbsp;to&nbsp;overlapping&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379675">//&nbsp;After&nbsp;eliminating&nbsp;them,&nbsp;we&nbsp;may&nbsp;end&nbsp;up&nbsp;with&nbsp;fewer&nbsp;than&nbsp;n&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379745">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;enough&nbsp;at&nbsp;the&nbsp;end,&nbsp;redo&nbsp;the&nbsp;search&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379810">//&nbsp;increased&nbsp;value&nbsp;n1,&nbsp;but&nbsp;only&nbsp;if&nbsp;Lookup&nbsp;returned&nbsp;all&nbsp;the&nbsp;requested</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379881">//&nbsp;indices&nbsp;in&nbsp;the&nbsp;first&nbsp;place&nbsp;(if&nbsp;it&nbsp;returned&nbsp;fewer&nbsp;than&nbsp;that&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379950">//&nbsp;there&nbsp;cannot&nbsp;be&nbsp;more).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379978">for</span>&nbsp;<span class="ident" id="6379982">n1</span>&nbsp;<span class="op" id="6379985">:=</span>&nbsp;<span class="ident" id="6379988">n</span><span class="op" id="6379989">;</span>&nbsp;<span class="op" id="6379991">;</span>&nbsp;<span class="ident" id="6379993">n1</span>&nbsp;<span class="op" id="6379996">+=</span>&nbsp;<span class="num" id="6379999">2</span>&nbsp;<span class="op" id="6380001">*</span>&nbsp;<span class="op" id="6380003">(</span><span class="ident" id="6380004">n</span>&nbsp;<span class="op" id="6380006">-</span>&nbsp;<span class="builtinfunc" id="6380008">len</span><span class="op" id="6380011">(</span><span class="ident" id="6380012">result</span><span class="op" id="6380018">)</span><span class="op" id="6380019">)</span>&nbsp;<span class="comment" id="6380021">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="6380039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380044">indices</span>&nbsp;<span class="op" id="6380052">:=</span>&nbsp;<span class="ident" id="6380055">x</span><span class="op" id="6380056">.</span><span class="ident" id="6380057">Lookup</span><span class="op" id="6380063">(</span><span class="ident" id="6380064">lit</span><span class="op" id="6380067">,</span>&nbsp;<span class="ident" id="6380069">n1</span><span class="op" id="6380071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380076">if</span>&nbsp;<span class="builtinfunc" id="6380079">len</span><span class="op" id="6380082">(</span><span class="ident" id="6380083">indices</span><span class="op" id="6380090">)</span>&nbsp;<span class="op" id="6380092">==</span>&nbsp;<span class="num" id="6380095">0</span>&nbsp;<span class="op" id="6380097">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380103">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380118">sort</span><span class="op" id="6380122">.</span><span class="ident" id="6380123">Ints</span><span class="op" id="6380127">(</span><span class="ident" id="6380128">indices</span><span class="op" id="6380135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380140">pairs</span>&nbsp;<span class="op" id="6380146">:=</span>&nbsp;<span class="builtinfunc" id="6380149">make</span><span class="op" id="6380153">(</span><span class="op" id="6380154">[</span><span class="op" id="6380155">]</span><span class="builtintype" id="6380156">int</span><span class="op" id="6380159">,</span>&nbsp;<span class="num" id="6380161">2</span><span class="op" id="6380162">*</span><span class="builtinfunc" id="6380163">len</span><span class="op" id="6380166">(</span><span class="ident" id="6380167">indices</span><span class="op" id="6380174">)</span><span class="op" id="6380175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380180">result</span>&nbsp;<span class="op" id="6380187">=</span>&nbsp;<span class="builtinfunc" id="6380189">make</span><span class="op" id="6380193">(</span><span class="op" id="6380194">[</span><span class="op" id="6380195">]</span><span class="op" id="6380196">[</span><span class="op" id="6380197">]</span><span class="builtintype" id="6380198">int</span><span class="op" id="6380201">,</span>&nbsp;<span class="builtinfunc" id="6380203">len</span><span class="op" id="6380206">(</span><span class="ident" id="6380207">indices</span><span class="op" id="6380214">)</span><span class="op" id="6380215">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380220">count</span>&nbsp;<span class="op" id="6380226">:=</span>&nbsp;<span class="num" id="6380229">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380234">prev</span>&nbsp;<span class="op" id="6380239">:=</span>&nbsp;<span class="num" id="6380242">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380247">for</span>&nbsp;<span class="ident" id="6380251">_</span><span class="op" id="6380252">,</span>&nbsp;<span class="ident" id="6380254">i</span>&nbsp;<span class="op" id="6380256">:=</span>&nbsp;<span class="keyword" id="6380259">range</span>&nbsp;<span class="ident" id="6380265">indices</span>&nbsp;<span class="op" id="6380273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380279">if</span>&nbsp;<span class="ident" id="6380282">count</span>&nbsp;<span class="op" id="6380288">==</span>&nbsp;<span class="ident" id="6380291">n</span>&nbsp;<span class="op" id="6380293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380300">break</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380316">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380369">if</span>&nbsp;<span class="ident" id="6380372">prev</span>&nbsp;<span class="op" id="6380377">&lt;=</span>&nbsp;<span class="ident" id="6380380">i</span>&nbsp;<span class="op" id="6380382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380389">j</span>&nbsp;<span class="op" id="6380391">:=</span>&nbsp;<span class="num" id="6380394">2</span>&nbsp;<span class="op" id="6380396">*</span>&nbsp;<span class="ident" id="6380398">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380409">pairs</span><span class="op" id="6380414">[</span><span class="ident" id="6380415">j</span><span class="op" id="6380416">+</span><span class="num" id="6380417">0</span><span class="op" id="6380418">]</span>&nbsp;<span class="op" id="6380420">=</span>&nbsp;<span class="ident" id="6380422">i</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380429">pairs</span><span class="op" id="6380434">[</span><span class="ident" id="6380435">j</span><span class="op" id="6380436">+</span><span class="num" id="6380437">1</span><span class="op" id="6380438">]</span>&nbsp;<span class="op" id="6380440">=</span>&nbsp;<span class="ident" id="6380442">i</span>&nbsp;<span class="op" id="6380444">+</span>&nbsp;<span class="builtinfunc" id="6380446">len</span><span class="op" id="6380449">(</span><span class="ident" id="6380450">lit</span><span class="op" id="6380453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380460">result</span><span class="op" id="6380466">[</span><span class="ident" id="6380467">count</span><span class="op" id="6380472">]</span>&nbsp;<span class="op" id="6380474">=</span>&nbsp;<span class="ident" id="6380476">pairs</span><span class="op" id="6380481">[</span><span class="ident" id="6380482">j</span>&nbsp;<span class="op" id="6380484">:</span>&nbsp;<span class="ident" id="6380486">j</span><span class="op" id="6380487">+</span><span class="num" id="6380488">2</span><span class="op" id="6380489">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380496">count</span><span class="op" id="6380501">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380509">prev</span>&nbsp;<span class="op" id="6380514">=</span>&nbsp;<span class="ident" id="6380516">i</span>&nbsp;<span class="op" id="6380518">+</span>&nbsp;<span class="builtinfunc" id="6380520">len</span><span class="op" id="6380523">(</span><span class="ident" id="6380524">lit</span><span class="op" id="6380527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380533">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380543">result</span>&nbsp;<span class="op" id="6380550">=</span>&nbsp;<span class="ident" id="6380552">result</span><span class="op" id="6380558">[</span><span class="num" id="6380559">0</span><span class="op" id="6380560">:</span><span class="ident" id="6380561">count</span><span class="op" id="6380566">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380571">if</span>&nbsp;<span class="builtinfunc" id="6380574">len</span><span class="op" id="6380577">(</span><span class="ident" id="6380578">result</span><span class="op" id="6380584">)</span>&nbsp;<span class="op" id="6380586">&gt;=</span>&nbsp;<span class="ident" id="6380589">n</span>&nbsp;<span class="op" id="6380591">||</span>&nbsp;<span class="builtinfunc" id="6380594">len</span><span class="op" id="6380597">(</span><span class="ident" id="6380598">indices</span><span class="op" id="6380605">)</span>&nbsp;<span class="op" id="6380607">!=</span>&nbsp;<span class="ident" id="6380610">n1</span>&nbsp;<span class="op" id="6380613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380619">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380678">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380712">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380729">if</span>&nbsp;<span class="builtinfunc" id="6380732">len</span><span class="op" id="6380735">(</span><span class="ident" id="6380736">result</span><span class="op" id="6380742">)</span>&nbsp;<span class="op" id="6380744">==</span>&nbsp;<span class="num" id="6380747">0</span>&nbsp;<span class="op" id="6380749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380754">result</span>&nbsp;<span class="op" id="6380761">=</span>&nbsp;<span class="ident" id="6380763">nil</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380773">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380785">//&nbsp;regexp&nbsp;has&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix;&nbsp;Lookup(lit)&nbsp;computes</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380849">//&nbsp;the&nbsp;indices&nbsp;of&nbsp;possible&nbsp;complete&nbsp;matches;&nbsp;use&nbsp;these&nbsp;as&nbsp;starting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380917">//&nbsp;points&nbsp;for&nbsp;anchored&nbsp;searches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6380950">//&nbsp;(regexp&nbsp;&#34;^&#34;&nbsp;matches&nbsp;beginning&nbsp;of&nbsp;input,&nbsp;not&nbsp;beginning&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381017">r</span>&nbsp;<span class="op" id="6381019">=</span>&nbsp;<span class="ident" id="6381021">regexp</span><span class="op" id="6381027">.</span><span class="ident" id="6381028">MustCompile</span><span class="op" id="6381039">(</span><span class="string" id="6381040">&#34;^&#34;</span>&nbsp;<span class="op" id="6381044">+</span>&nbsp;<span class="ident" id="6381046">r</span><span class="op" id="6381047">.</span><span class="ident" id="6381048">String</span><span class="op" id="6381054">(</span><span class="op" id="6381055">)</span><span class="op" id="6381056">)</span>&nbsp;<span class="comment" id="6381058">//&nbsp;compiles&nbsp;because&nbsp;r&nbsp;compiled</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381091">//&nbsp;same&nbsp;comment&nbsp;about&nbsp;Lookup&nbsp;applies&nbsp;here&nbsp;as&nbsp;in&nbsp;the&nbsp;loop&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381155">for</span>&nbsp;<span class="ident" id="6381159">n1</span>&nbsp;<span class="op" id="6381162">:=</span>&nbsp;<span class="ident" id="6381165">n</span><span class="op" id="6381166">;</span>&nbsp;<span class="op" id="6381168">;</span>&nbsp;<span class="ident" id="6381170">n1</span>&nbsp;<span class="op" id="6381173">+=</span>&nbsp;<span class="num" id="6381176">2</span>&nbsp;<span class="op" id="6381178">*</span>&nbsp;<span class="op" id="6381180">(</span><span class="ident" id="6381181">n</span>&nbsp;<span class="op" id="6381183">-</span>&nbsp;<span class="builtinfunc" id="6381185">len</span><span class="op" id="6381188">(</span><span class="ident" id="6381189">result</span><span class="op" id="6381195">)</span><span class="op" id="6381196">)</span>&nbsp;<span class="comment" id="6381198">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="6381216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381220">indices</span>&nbsp;<span class="op" id="6381228">:=</span>&nbsp;<span class="ident" id="6381231">x</span><span class="op" id="6381232">.</span><span class="ident" id="6381233">Lookup</span><span class="op" id="6381239">(</span><span class="ident" id="6381240">lit</span><span class="op" id="6381243">,</span>&nbsp;<span class="ident" id="6381245">n1</span><span class="op" id="6381247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381251">if</span>&nbsp;<span class="builtinfunc" id="6381254">len</span><span class="op" id="6381257">(</span><span class="ident" id="6381258">indices</span><span class="op" id="6381265">)</span>&nbsp;<span class="op" id="6381267">==</span>&nbsp;<span class="num" id="6381270">0</span>&nbsp;<span class="op" id="6381272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381277">return</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6381286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381290">sort</span><span class="op" id="6381294">.</span><span class="ident" id="6381295">Ints</span><span class="op" id="6381299">(</span><span class="ident" id="6381300">indices</span><span class="op" id="6381307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381311">result</span>&nbsp;<span class="op" id="6381318">=</span>&nbsp;<span class="ident" id="6381320">result</span><span class="op" id="6381326">[</span><span class="num" id="6381327">0</span><span class="op" id="6381328">:</span><span class="num" id="6381329">0</span><span class="op" id="6381330">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381334">prev</span>&nbsp;<span class="op" id="6381339">:=</span>&nbsp;<span class="num" id="6381342">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381346">for</span>&nbsp;<span class="ident" id="6381350">_</span><span class="op" id="6381351">,</span>&nbsp;<span class="ident" id="6381353">i</span>&nbsp;<span class="op" id="6381355">:=</span>&nbsp;<span class="keyword" id="6381358">range</span>&nbsp;<span class="ident" id="6381364">indices</span>&nbsp;<span class="op" id="6381372">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381377">if</span>&nbsp;<span class="builtinfunc" id="6381380">len</span><span class="op" id="6381383">(</span><span class="ident" id="6381384">result</span><span class="op" id="6381390">)</span>&nbsp;<span class="op" id="6381392">==</span>&nbsp;<span class="ident" id="6381395">n</span>&nbsp;<span class="op" id="6381397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381403">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6381412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381417">m</span>&nbsp;<span class="op" id="6381419">:=</span>&nbsp;<span class="ident" id="6381422">r</span><span class="op" id="6381423">.</span><span class="ident" id="6381424">FindIndex</span><span class="op" id="6381433">(</span><span class="ident" id="6381434">x</span><span class="op" id="6381435">.</span><span class="ident" id="6381436">data</span><span class="op" id="6381440">[</span><span class="ident" id="6381441">i</span><span class="op" id="6381442">:</span><span class="op" id="6381443">]</span><span class="op" id="6381444">)</span>&nbsp;<span class="comment" id="6381446">//&nbsp;anchored&nbsp;search&nbsp;-&nbsp;will&nbsp;not&nbsp;run&nbsp;off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381487">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381539">if</span>&nbsp;<span class="ident" id="6381542">m</span>&nbsp;<span class="op" id="6381544">!=</span>&nbsp;<span class="ident" id="6381547">nil</span>&nbsp;<span class="op" id="6381551">&amp;&amp;</span>&nbsp;<span class="ident" id="6381554">prev</span>&nbsp;<span class="op" id="6381559">&lt;=</span>&nbsp;<span class="ident" id="6381562">i</span>&nbsp;<span class="op" id="6381564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381570">m</span><span class="op" id="6381571">[</span><span class="num" id="6381572">0</span><span class="op" id="6381573">]</span>&nbsp;<span class="op" id="6381575">=</span>&nbsp;<span class="ident" id="6381577">i</span>&nbsp;<span class="comment" id="6381579">//&nbsp;correct&nbsp;m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381596">m</span><span class="op" id="6381597">[</span><span class="num" id="6381598">1</span><span class="op" id="6381599">]</span>&nbsp;<span class="op" id="6381601">+=</span>&nbsp;<span class="ident" id="6381604">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381610">result</span>&nbsp;<span class="op" id="6381617">=</span>&nbsp;<span class="builtinfunc" id="6381619">append</span><span class="op" id="6381625">(</span><span class="ident" id="6381626">result</span><span class="op" id="6381632">,</span>&nbsp;<span class="ident" id="6381634">m</span><span class="op" id="6381635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381641">prev</span>&nbsp;<span class="op" id="6381646">=</span>&nbsp;<span class="ident" id="6381648">m</span><span class="op" id="6381649">[</span><span class="num" id="6381650">1</span><span class="op" id="6381651">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6381656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6381660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381664">if</span>&nbsp;<span class="builtinfunc" id="6381667">len</span><span class="op" id="6381670">(</span><span class="ident" id="6381671">result</span><span class="op" id="6381677">)</span>&nbsp;<span class="op" id="6381679">&gt;=</span>&nbsp;<span class="ident" id="6381682">n</span>&nbsp;<span class="op" id="6381684">||</span>&nbsp;<span class="builtinfunc" id="6381687">len</span><span class="op" id="6381690">(</span><span class="ident" id="6381691">indices</span><span class="op" id="6381698">)</span>&nbsp;<span class="op" id="6381700">!=</span>&nbsp;<span class="ident" id="6381703">n1</span>&nbsp;<span class="op" id="6381706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381711">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381769">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381802">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6381810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6381813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381816">if</span>&nbsp;<span class="builtinfunc" id="6381819">len</span><span class="op" id="6381822">(</span><span class="ident" id="6381823">result</span><span class="op" id="6381829">)</span>&nbsp;<span class="op" id="6381831">==</span>&nbsp;<span class="num" id="6381834">0</span>&nbsp;<span class="op" id="6381836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381840">result</span>&nbsp;<span class="op" id="6381847">=</span>&nbsp;<span class="ident" id="6381849">nil</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6381854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381857">return</span><br>
<span class="lineno"></span><span class="op" id="6381864">}</span>
</div>
</body>
</html>
