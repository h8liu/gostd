<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html" class="current">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3461211">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3461267">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3461321">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3461372">package</span>&nbsp;<span class="ident" id="3461380">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3461386">import</span>&nbsp;<span class="op" id="3461393">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3461396">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3461402">&#34;net/textproto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3461419">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3461427">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3461438">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3461446">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3461453">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3461456">var</span>&nbsp;<span class="ident" id="3461460">raceEnabled</span>&nbsp;<span class="op" id="3461472">=</span>&nbsp;<span class="builtintype" id="3461474">false</span>&nbsp;<span class="comment" id="3461480">//&nbsp;set&nbsp;by&nbsp;race.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3461499">//&nbsp;A&nbsp;Header&nbsp;represents&nbsp;the&nbsp;key-value&nbsp;pairs&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="3461561">type</span>&nbsp;<span class="ident" id="3461566">Header</span>&nbsp;<span class="keyword" id="3461573">map</span><span class="op" id="3461576">[</span><span class="builtintype" id="3461577">string</span><span class="op" id="3461583">]</span><span class="op" id="3461584">[</span><span class="op" id="3461585">]</span><span class="builtintype" id="3461586">string</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="3461594">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;key,&nbsp;value&nbsp;pair&nbsp;to&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span><span class="comment" id="3461641">//&nbsp;It&nbsp;appends&nbsp;to&nbsp;any&nbsp;existing&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3461699">func</span>&nbsp;<span class="op" id="3461704">(</span><span class="ident" id="3461705">h</span>&nbsp;<span class="ident" id="3461707">Header</span><span class="op" id="3461713">)</span>&nbsp;<span class="ident" id="3461715">Add</span><span class="op" id="3461718">(</span><span class="ident" id="3461719">key</span><span class="op" id="3461722">,</span>&nbsp;<span class="ident" id="3461724">value</span>&nbsp;<span class="builtintype" id="3461730">string</span><span class="op" id="3461736">)</span>&nbsp;<span class="op" id="3461738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3461741">textproto</span><span class="op" id="3461750">.</span><span class="ident" id="3461751">MIMEHeader</span><span class="op" id="3461761">(</span><span class="ident" id="3461762">h</span><span class="op" id="3461763">)</span><span class="op" id="3461764">.</span><span class="ident" id="3461765">Add</span><span class="op" id="3461768">(</span><span class="ident" id="3461769">key</span><span class="op" id="3461772">,</span>&nbsp;<span class="ident" id="3461774">value</span><span class="op" id="3461779">)</span><br>
<span class="lineno">25</span><span class="op" id="3461781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3461784">//&nbsp;Set&nbsp;sets&nbsp;the&nbsp;header&nbsp;entries&nbsp;associated&nbsp;with&nbsp;key&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3461838">//&nbsp;the&nbsp;single&nbsp;element&nbsp;value.&nbsp;&nbsp;It&nbsp;replaces&nbsp;any&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="3461893">//&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno">30</span><span class="keyword" id="3461924">func</span>&nbsp;<span class="op" id="3461929">(</span><span class="ident" id="3461930">h</span>&nbsp;<span class="ident" id="3461932">Header</span><span class="op" id="3461938">)</span>&nbsp;<span class="ident" id="3461940">Set</span><span class="op" id="3461943">(</span><span class="ident" id="3461944">key</span><span class="op" id="3461947">,</span>&nbsp;<span class="ident" id="3461949">value</span>&nbsp;<span class="builtintype" id="3461955">string</span><span class="op" id="3461961">)</span>&nbsp;<span class="op" id="3461963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3461966">textproto</span><span class="op" id="3461975">.</span><span class="ident" id="3461976">MIMEHeader</span><span class="op" id="3461986">(</span><span class="ident" id="3461987">h</span><span class="op" id="3461988">)</span><span class="op" id="3461989">.</span><span class="ident" id="3461990">Set</span><span class="op" id="3461993">(</span><span class="ident" id="3461994">key</span><span class="op" id="3461997">,</span>&nbsp;<span class="ident" id="3461999">value</span><span class="op" id="3462004">)</span><br>
<span class="lineno"></span><span class="op" id="3462006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3462009">//&nbsp;Get&nbsp;gets&nbsp;the&nbsp;first&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno">35</span><span class="comment" id="3462068">//&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;values&nbsp;associated&nbsp;with&nbsp;the&nbsp;key,&nbsp;Get&nbsp;returns&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3462135">//&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values&nbsp;of&nbsp;a&nbsp;key,&nbsp;access&nbsp;the&nbsp;map&nbsp;directly</span><br>
<span class="lineno"></span><span class="comment" id="3462198">//&nbsp;with&nbsp;CanonicalHeaderKey.</span><br>
<span class="lineno"></span><span class="keyword" id="3462226">func</span>&nbsp;<span class="op" id="3462231">(</span><span class="ident" id="3462232">h</span>&nbsp;<span class="ident" id="3462234">Header</span><span class="op" id="3462240">)</span>&nbsp;<span class="ident" id="3462242">Get</span><span class="op" id="3462245">(</span><span class="ident" id="3462246">key</span>&nbsp;<span class="builtintype" id="3462250">string</span><span class="op" id="3462256">)</span>&nbsp;<span class="builtintype" id="3462258">string</span>&nbsp;<span class="op" id="3462265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3462268">return</span>&nbsp;<span class="ident" id="3462275">textproto</span><span class="op" id="3462284">.</span><span class="ident" id="3462285">MIMEHeader</span><span class="op" id="3462295">(</span><span class="ident" id="3462296">h</span><span class="op" id="3462297">)</span><span class="op" id="3462298">.</span><span class="ident" id="3462299">Get</span><span class="op" id="3462302">(</span><span class="ident" id="3462303">key</span><span class="op" id="3462306">)</span><br>
<span class="lineno">40</span><span class="op" id="3462308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3462311">//&nbsp;get&nbsp;is&nbsp;like&nbsp;Get,&nbsp;but&nbsp;key&nbsp;must&nbsp;already&nbsp;be&nbsp;in&nbsp;CanonicalHeaderKey&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="3462383">func</span>&nbsp;<span class="op" id="3462388">(</span><span class="ident" id="3462389">h</span>&nbsp;<span class="ident" id="3462391">Header</span><span class="op" id="3462397">)</span>&nbsp;<span class="ident" id="3462399">get</span><span class="op" id="3462402">(</span><span class="ident" id="3462403">key</span>&nbsp;<span class="builtintype" id="3462407">string</span><span class="op" id="3462413">)</span>&nbsp;<span class="builtintype" id="3462415">string</span>&nbsp;<span class="op" id="3462422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3462425">if</span>&nbsp;<span class="ident" id="3462428">v</span>&nbsp;<span class="op" id="3462430">:=</span>&nbsp;<span class="ident" id="3462433">h</span><span class="op" id="3462434">[</span><span class="ident" id="3462435">key</span><span class="op" id="3462438">]</span><span class="op" id="3462439">;</span>&nbsp;<span class="builtinfunc" id="3462441">len</span><span class="op" id="3462444">(</span><span class="ident" id="3462445">v</span><span class="op" id="3462446">)</span>&nbsp;<span class="op" id="3462448">&gt;</span>&nbsp;<span class="num" id="3462450">0</span>&nbsp;<span class="op" id="3462452">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3462456">return</span>&nbsp;<span class="ident" id="3462463">v</span><span class="op" id="3462464">[</span><span class="num" id="3462465">0</span><span class="op" id="3462466">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3462469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3462472">return</span>&nbsp;<span class="string" id="3462479">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3462482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3462485">//&nbsp;Del&nbsp;deletes&nbsp;the&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3462532">func</span>&nbsp;<span class="op" id="3462537">(</span><span class="ident" id="3462538">h</span>&nbsp;<span class="ident" id="3462540">Header</span><span class="op" id="3462546">)</span>&nbsp;<span class="ident" id="3462548">Del</span><span class="op" id="3462551">(</span><span class="ident" id="3462552">key</span>&nbsp;<span class="builtintype" id="3462556">string</span><span class="op" id="3462562">)</span>&nbsp;<span class="op" id="3462564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462567">textproto</span><span class="op" id="3462576">.</span><span class="ident" id="3462577">MIMEHeader</span><span class="op" id="3462587">(</span><span class="ident" id="3462588">h</span><span class="op" id="3462589">)</span><span class="op" id="3462590">.</span><span class="ident" id="3462591">Del</span><span class="op" id="3462594">(</span><span class="ident" id="3462595">key</span><span class="op" id="3462598">)</span><br>
<span class="lineno"></span><span class="op" id="3462600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3462603">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;header&nbsp;in&nbsp;wire&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="3462644">func</span>&nbsp;<span class="op" id="3462649">(</span><span class="ident" id="3462650">h</span>&nbsp;<span class="ident" id="3462652">Header</span><span class="op" id="3462658">)</span>&nbsp;<span class="ident" id="3462660">Write</span><span class="op" id="3462665">(</span><span class="ident" id="3462666">w</span>&nbsp;<span class="ident" id="3462668">io</span><span class="op" id="3462670">.</span><span class="ident" id="3462671">Writer</span><span class="op" id="3462677">)</span>&nbsp;<span class="builtintype" id="3462679">error</span>&nbsp;<span class="op" id="3462685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3462688">return</span>&nbsp;<span class="ident" id="3462695">h</span><span class="op" id="3462696">.</span><span class="ident" id="3462697">WriteSubset</span><span class="op" id="3462708">(</span><span class="ident" id="3462709">w</span><span class="op" id="3462710">,</span>&nbsp;<span class="ident" id="3462712">nil</span><span class="op" id="3462715">)</span><br>
<span class="lineno"></span><span class="op" id="3462717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="3462720">func</span>&nbsp;<span class="op" id="3462725">(</span><span class="ident" id="3462726">h</span>&nbsp;<span class="ident" id="3462728">Header</span><span class="op" id="3462734">)</span>&nbsp;<span class="ident" id="3462736">clone</span><span class="op" id="3462741">(</span><span class="op" id="3462742">)</span>&nbsp;<span class="ident" id="3462744">Header</span>&nbsp;<span class="op" id="3462751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462754">h2</span>&nbsp;<span class="op" id="3462757">:=</span>&nbsp;<span class="builtinfunc" id="3462760">make</span><span class="op" id="3462764">(</span><span class="ident" id="3462765">Header</span><span class="op" id="3462771">,</span>&nbsp;<span class="builtinfunc" id="3462773">len</span><span class="op" id="3462776">(</span><span class="ident" id="3462777">h</span><span class="op" id="3462778">)</span><span class="op" id="3462779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3462782">for</span>&nbsp;<span class="ident" id="3462786">k</span><span class="op" id="3462787">,</span>&nbsp;<span class="ident" id="3462789">vv</span>&nbsp;<span class="op" id="3462792">:=</span>&nbsp;<span class="keyword" id="3462795">range</span>&nbsp;<span class="ident" id="3462801">h</span>&nbsp;<span class="op" id="3462803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462807">vv2</span>&nbsp;<span class="op" id="3462811">:=</span>&nbsp;<span class="builtinfunc" id="3462814">make</span><span class="op" id="3462818">(</span><span class="op" id="3462819">[</span><span class="op" id="3462820">]</span><span class="builtintype" id="3462821">string</span><span class="op" id="3462827">,</span>&nbsp;<span class="builtinfunc" id="3462829">len</span><span class="op" id="3462832">(</span><span class="ident" id="3462833">vv</span><span class="op" id="3462835">)</span><span class="op" id="3462836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3462840">copy</span><span class="op" id="3462844">(</span><span class="ident" id="3462845">vv2</span><span class="op" id="3462848">,</span>&nbsp;<span class="ident" id="3462850">vv</span><span class="op" id="3462852">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462856">h2</span><span class="op" id="3462858">[</span><span class="ident" id="3462859">k</span><span class="op" id="3462860">]</span>&nbsp;<span class="op" id="3462862">=</span>&nbsp;<span class="ident" id="3462864">vv2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3462869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3462872">return</span>&nbsp;<span class="ident" id="3462879">h2</span><br>
<span class="lineno"></span><span class="op" id="3462882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="3462885">var</span>&nbsp;<span class="ident" id="3462889">timeFormats</span>&nbsp;<span class="op" id="3462901">=</span>&nbsp;<span class="op" id="3462903">[</span><span class="op" id="3462904">]</span><span class="builtintype" id="3462905">string</span><span class="op" id="3462911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462914">TimeFormat</span><span class="op" id="3462924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462927">time</span><span class="op" id="3462931">.</span><span class="ident" id="3462932">RFC850</span><span class="op" id="3462938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462941">time</span><span class="op" id="3462945">.</span><span class="ident" id="3462946">ANSIC</span><span class="op" id="3462951">,</span><br>
<span class="lineno"></span><span class="op" id="3462953">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="3462956">//&nbsp;ParseTime&nbsp;parses&nbsp;a&nbsp;time&nbsp;header&nbsp;(such&nbsp;as&nbsp;the&nbsp;Date:&nbsp;header),</span><br>
<span class="lineno"></span><span class="comment" id="3463018">//&nbsp;trying&nbsp;each&nbsp;of&nbsp;the&nbsp;three&nbsp;formats&nbsp;allowed&nbsp;by&nbsp;HTTP/1.1:</span><br>
<span class="lineno"></span><span class="comment" id="3463075">//&nbsp;TimeFormat,&nbsp;time.RFC850,&nbsp;and&nbsp;time.ANSIC.</span><br>
<span class="lineno"></span><span class="keyword" id="3463119">func</span>&nbsp;<span class="ident" id="3463124">ParseTime</span><span class="op" id="3463133">(</span><span class="ident" id="3463134">text</span>&nbsp;<span class="builtintype" id="3463139">string</span><span class="op" id="3463145">)</span>&nbsp;<span class="op" id="3463147">(</span><span class="ident" id="3463148">t</span>&nbsp;<span class="ident" id="3463150">time</span><span class="op" id="3463154">.</span><span class="ident" id="3463155">Time</span><span class="op" id="3463159">,</span>&nbsp;<span class="ident" id="3463161">err</span>&nbsp;<span class="builtintype" id="3463165">error</span><span class="op" id="3463170">)</span>&nbsp;<span class="op" id="3463172">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3463175">for</span>&nbsp;<span class="ident" id="3463179">_</span><span class="op" id="3463180">,</span>&nbsp;<span class="ident" id="3463182">layout</span>&nbsp;<span class="op" id="3463189">:=</span>&nbsp;<span class="keyword" id="3463192">range</span>&nbsp;<span class="ident" id="3463198">timeFormats</span>&nbsp;<span class="op" id="3463210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3463214">t</span><span class="op" id="3463215">,</span>&nbsp;<span class="ident" id="3463217">err</span>&nbsp;<span class="op" id="3463221">=</span>&nbsp;<span class="ident" id="3463223">time</span><span class="op" id="3463227">.</span><span class="ident" id="3463228">Parse</span><span class="op" id="3463233">(</span><span class="ident" id="3463234">layout</span><span class="op" id="3463240">,</span>&nbsp;<span class="ident" id="3463242">text</span><span class="op" id="3463246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3463250">if</span>&nbsp;<span class="ident" id="3463253">err</span>&nbsp;<span class="op" id="3463257">==</span>&nbsp;<span class="ident" id="3463260">nil</span>&nbsp;<span class="op" id="3463264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3463269">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3463278">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3463281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3463284">return</span><br>
<span class="lineno"></span><span class="op" id="3463291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3463294">var</span>&nbsp;<span class="ident" id="3463298">headerNewlineToSpace</span>&nbsp;<span class="op" id="3463319">=</span>&nbsp;<span class="ident" id="3463321">strings</span><span class="op" id="3463328">.</span><span class="ident" id="3463329">NewReplacer</span><span class="op" id="3463340">(</span><span class="string" id="3463341">&#34;\n&#34;</span><span class="op" id="3463345">,</span>&nbsp;<span class="string" id="3463347">&#34;&nbsp;&#34;</span><span class="op" id="3463350">,</span>&nbsp;<span class="string" id="3463352">&#34;\r&#34;</span><span class="op" id="3463356">,</span>&nbsp;<span class="string" id="3463358">&#34;&nbsp;&#34;</span><span class="op" id="3463361">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="3463364">type</span>&nbsp;<span class="ident" id="3463369">writeStringer</span>&nbsp;<span class="keyword" id="3463383">interface</span>&nbsp;<span class="op" id="3463393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3463396">WriteString</span><span class="op" id="3463407">(</span><span class="builtintype" id="3463408">string</span><span class="op" id="3463414">)</span>&nbsp;<span class="op" id="3463416">(</span><span class="builtintype" id="3463417">int</span><span class="op" id="3463420">,</span>&nbsp;<span class="builtintype" id="3463422">error</span><span class="op" id="3463427">)</span><br>
<span class="lineno"></span><span class="op" id="3463429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3463432">//&nbsp;stringWriter&nbsp;implements&nbsp;WriteString&nbsp;on&nbsp;a&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3463484">type</span>&nbsp;<span class="ident" id="3463489">stringWriter</span>&nbsp;<span class="keyword" id="3463502">struct</span>&nbsp;<span class="op" id="3463509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3463512">w</span>&nbsp;<span class="ident" id="3463514">io</span><span class="op" id="3463516">.</span><span class="ident" id="3463517">Writer</span><br>
<span class="lineno"></span><span class="op" id="3463524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="3463527">func</span>&nbsp;<span class="op" id="3463532">(</span><span class="ident" id="3463533">w</span>&nbsp;<span class="ident" id="3463535">stringWriter</span><span class="op" id="3463547">)</span>&nbsp;<span class="ident" id="3463549">WriteString</span><span class="op" id="3463560">(</span><span class="ident" id="3463561">s</span>&nbsp;<span class="builtintype" id="3463563">string</span><span class="op" id="3463569">)</span>&nbsp;<span class="op" id="3463571">(</span><span class="ident" id="3463572">n</span>&nbsp;<span class="builtintype" id="3463574">int</span><span class="op" id="3463577">,</span>&nbsp;<span class="ident" id="3463579">err</span>&nbsp;<span class="builtintype" id="3463583">error</span><span class="op" id="3463588">)</span>&nbsp;<span class="op" id="3463590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3463593">return</span>&nbsp;<span class="ident" id="3463600">w</span><span class="op" id="3463601">.</span><span class="ident" id="3463602">w</span><span class="op" id="3463603">.</span><span class="ident" id="3463604">Write</span><span class="op" id="3463609">(</span><span class="op" id="3463610">[</span><span class="op" id="3463611">]</span><span class="builtintype" id="3463612">byte</span><span class="op" id="3463616">(</span><span class="ident" id="3463617">s</span><span class="op" id="3463618">)</span><span class="op" id="3463619">)</span><br>
<span class="lineno"></span><span class="op" id="3463621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3463624">type</span>&nbsp;<span class="ident" id="3463629">keyValues</span>&nbsp;<span class="keyword" id="3463639">struct</span>&nbsp;<span class="op" id="3463646">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3463649">key</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3463656">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3463664">values</span>&nbsp;<span class="op" id="3463671">[</span><span class="op" id="3463672">]</span><span class="builtintype" id="3463673">string</span><br>
<span class="lineno"></span><span class="op" id="3463680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3463683">//&nbsp;A&nbsp;headerSorter&nbsp;implements&nbsp;sort.Interface&nbsp;by&nbsp;sorting&nbsp;a&nbsp;[]keyValues</span><br>
<span class="lineno">110</span><span class="comment" id="3463752">//&nbsp;by&nbsp;key.&nbsp;It&#39;s&nbsp;used&nbsp;as&nbsp;a&nbsp;pointer,&nbsp;so&nbsp;it&nbsp;can&nbsp;fit&nbsp;in&nbsp;a&nbsp;sort.Interface</span><br>
<span class="lineno"></span><span class="comment" id="3463821">//&nbsp;interface&nbsp;value&nbsp;without&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="3463860">type</span>&nbsp;<span class="ident" id="3463865">headerSorter</span>&nbsp;<span class="keyword" id="3463878">struct</span>&nbsp;<span class="op" id="3463885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3463888">kvs</span>&nbsp;<span class="op" id="3463892">[</span><span class="op" id="3463893">]</span><span class="ident" id="3463894">keyValues</span><br>
<span class="lineno"></span><span class="op" id="3463904">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="3463907">func</span>&nbsp;<span class="op" id="3463912">(</span><span class="ident" id="3463913">s</span>&nbsp;<span class="op" id="3463915">*</span><span class="ident" id="3463916">headerSorter</span><span class="op" id="3463928">)</span>&nbsp;<span class="ident" id="3463930">Len</span><span class="op" id="3463933">(</span><span class="op" id="3463934">)</span>&nbsp;<span class="builtintype" id="3463936">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3463950">{</span>&nbsp;<span class="keyword" id="3463952">return</span>&nbsp;<span class="builtinfunc" id="3463959">len</span><span class="op" id="3463962">(</span><span class="ident" id="3463963">s</span><span class="op" id="3463964">.</span><span class="ident" id="3463965">kvs</span><span class="op" id="3463968">)</span>&nbsp;<span class="op" id="3463970">}</span><br>
<span class="lineno"></span><span class="keyword" id="3463972">func</span>&nbsp;<span class="op" id="3463977">(</span><span class="ident" id="3463978">s</span>&nbsp;<span class="op" id="3463980">*</span><span class="ident" id="3463981">headerSorter</span><span class="op" id="3463993">)</span>&nbsp;<span class="ident" id="3463995">Swap</span><span class="op" id="3463999">(</span><span class="ident" id="3464000">i</span><span class="op" id="3464001">,</span>&nbsp;<span class="ident" id="3464003">j</span>&nbsp;<span class="builtintype" id="3464005">int</span><span class="op" id="3464008">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3464015">{</span>&nbsp;<span class="ident" id="3464017">s</span><span class="op" id="3464018">.</span><span class="ident" id="3464019">kvs</span><span class="op" id="3464022">[</span><span class="ident" id="3464023">i</span><span class="op" id="3464024">]</span><span class="op" id="3464025">,</span>&nbsp;<span class="ident" id="3464027">s</span><span class="op" id="3464028">.</span><span class="ident" id="3464029">kvs</span><span class="op" id="3464032">[</span><span class="ident" id="3464033">j</span><span class="op" id="3464034">]</span>&nbsp;<span class="op" id="3464036">=</span>&nbsp;<span class="ident" id="3464038">s</span><span class="op" id="3464039">.</span><span class="ident" id="3464040">kvs</span><span class="op" id="3464043">[</span><span class="ident" id="3464044">j</span><span class="op" id="3464045">]</span><span class="op" id="3464046">,</span>&nbsp;<span class="ident" id="3464048">s</span><span class="op" id="3464049">.</span><span class="ident" id="3464050">kvs</span><span class="op" id="3464053">[</span><span class="ident" id="3464054">i</span><span class="op" id="3464055">]</span>&nbsp;<span class="op" id="3464057">}</span><br>
<span class="lineno"></span><span class="keyword" id="3464059">func</span>&nbsp;<span class="op" id="3464064">(</span><span class="ident" id="3464065">s</span>&nbsp;<span class="op" id="3464067">*</span><span class="ident" id="3464068">headerSorter</span><span class="op" id="3464080">)</span>&nbsp;<span class="ident" id="3464082">Less</span><span class="op" id="3464086">(</span><span class="ident" id="3464087">i</span><span class="op" id="3464088">,</span>&nbsp;<span class="ident" id="3464090">j</span>&nbsp;<span class="builtintype" id="3464092">int</span><span class="op" id="3464095">)</span>&nbsp;<span class="builtintype" id="3464097">bool</span>&nbsp;<span class="op" id="3464102">{</span>&nbsp;<span class="keyword" id="3464104">return</span>&nbsp;<span class="ident" id="3464111">s</span><span class="op" id="3464112">.</span><span class="ident" id="3464113">kvs</span><span class="op" id="3464116">[</span><span class="ident" id="3464117">i</span><span class="op" id="3464118">]</span><span class="op" id="3464119">.</span><span class="ident" id="3464120">key</span>&nbsp;<span class="op" id="3464124">&lt;</span>&nbsp;<span class="ident" id="3464126">s</span><span class="op" id="3464127">.</span><span class="ident" id="3464128">kvs</span><span class="op" id="3464131">[</span><span class="ident" id="3464132">j</span><span class="op" id="3464133">]</span><span class="op" id="3464134">.</span><span class="ident" id="3464135">key</span>&nbsp;<span class="op" id="3464139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="3464142">var</span>&nbsp;<span class="ident" id="3464146">headerSorterPool</span>&nbsp;<span class="op" id="3464163">=</span>&nbsp;<span class="ident" id="3464165">sync</span><span class="op" id="3464169">.</span><span class="ident" id="3464170">Pool</span><span class="op" id="3464174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464177">New</span><span class="op" id="3464180">:</span>&nbsp;<span class="keyword" id="3464182">func</span><span class="op" id="3464186">(</span><span class="op" id="3464187">)</span>&nbsp;<span class="keyword" id="3464189">interface</span><span class="op" id="3464198">{</span><span class="op" id="3464199">}</span>&nbsp;<span class="op" id="3464201">{</span>&nbsp;<span class="keyword" id="3464203">return</span>&nbsp;<span class="builtinfunc" id="3464210">new</span><span class="op" id="3464213">(</span><span class="ident" id="3464214">headerSorter</span><span class="op" id="3464226">)</span>&nbsp;<span class="op" id="3464228">}</span><span class="op" id="3464229">,</span><br>
<span class="lineno"></span><span class="op" id="3464231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3464234">//&nbsp;sortedKeyValues&nbsp;returns&nbsp;h&#39;s&nbsp;keys&nbsp;sorted&nbsp;in&nbsp;the&nbsp;returned&nbsp;kvs</span><br>
<span class="lineno">125</span><span class="comment" id="3464297">//&nbsp;slice.&nbsp;The&nbsp;headerSorter&nbsp;used&nbsp;to&nbsp;sort&nbsp;is&nbsp;also&nbsp;returned,&nbsp;for&nbsp;possible</span><br>
<span class="lineno"></span><span class="comment" id="3464368">//&nbsp;return&nbsp;to&nbsp;headerSorterCache.</span><br>
<span class="lineno"></span><span class="keyword" id="3464400">func</span>&nbsp;<span class="op" id="3464405">(</span><span class="ident" id="3464406">h</span>&nbsp;<span class="ident" id="3464408">Header</span><span class="op" id="3464414">)</span>&nbsp;<span class="ident" id="3464416">sortedKeyValues</span><span class="op" id="3464431">(</span><span class="ident" id="3464432">exclude</span>&nbsp;<span class="keyword" id="3464440">map</span><span class="op" id="3464443">[</span><span class="builtintype" id="3464444">string</span><span class="op" id="3464450">]</span><span class="builtintype" id="3464451">bool</span><span class="op" id="3464455">)</span>&nbsp;<span class="op" id="3464457">(</span><span class="ident" id="3464458">kvs</span>&nbsp;<span class="op" id="3464462">[</span><span class="op" id="3464463">]</span><span class="ident" id="3464464">keyValues</span><span class="op" id="3464473">,</span>&nbsp;<span class="ident" id="3464475">hs</span>&nbsp;<span class="op" id="3464478">*</span><span class="ident" id="3464479">headerSorter</span><span class="op" id="3464491">)</span>&nbsp;<span class="op" id="3464493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464496">hs</span>&nbsp;<span class="op" id="3464499">=</span>&nbsp;<span class="ident" id="3464501">headerSorterPool</span><span class="op" id="3464517">.</span><span class="ident" id="3464518">Get</span><span class="op" id="3464521">(</span><span class="op" id="3464522">)</span><span class="op" id="3464523">.</span><span class="op" id="3464524">(</span><span class="op" id="3464525">*</span><span class="ident" id="3464526">headerSorter</span><span class="op" id="3464538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464541">if</span>&nbsp;<span class="builtinfunc" id="3464544">cap</span><span class="op" id="3464547">(</span><span class="ident" id="3464548">hs</span><span class="op" id="3464550">.</span><span class="ident" id="3464551">kvs</span><span class="op" id="3464554">)</span>&nbsp;<span class="op" id="3464556">&lt;</span>&nbsp;<span class="builtinfunc" id="3464558">len</span><span class="op" id="3464561">(</span><span class="ident" id="3464562">h</span><span class="op" id="3464563">)</span>&nbsp;<span class="op" id="3464565">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464569">hs</span><span class="op" id="3464571">.</span><span class="ident" id="3464572">kvs</span>&nbsp;<span class="op" id="3464576">=</span>&nbsp;<span class="builtinfunc" id="3464578">make</span><span class="op" id="3464582">(</span><span class="op" id="3464583">[</span><span class="op" id="3464584">]</span><span class="ident" id="3464585">keyValues</span><span class="op" id="3464594">,</span>&nbsp;<span class="num" id="3464596">0</span><span class="op" id="3464597">,</span>&nbsp;<span class="builtinfunc" id="3464599">len</span><span class="op" id="3464602">(</span><span class="ident" id="3464603">h</span><span class="op" id="3464604">)</span><span class="op" id="3464605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3464608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464611">kvs</span>&nbsp;<span class="op" id="3464615">=</span>&nbsp;<span class="ident" id="3464617">hs</span><span class="op" id="3464619">.</span><span class="ident" id="3464620">kvs</span><span class="op" id="3464623">[</span><span class="op" id="3464624">:</span><span class="num" id="3464625">0</span><span class="op" id="3464626">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464629">for</span>&nbsp;<span class="ident" id="3464633">k</span><span class="op" id="3464634">,</span>&nbsp;<span class="ident" id="3464636">vv</span>&nbsp;<span class="op" id="3464639">:=</span>&nbsp;<span class="keyword" id="3464642">range</span>&nbsp;<span class="ident" id="3464648">h</span>&nbsp;<span class="op" id="3464650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464654">if</span>&nbsp;<span class="op" id="3464657">!</span><span class="ident" id="3464658">exclude</span><span class="op" id="3464665">[</span><span class="ident" id="3464666">k</span><span class="op" id="3464667">]</span>&nbsp;<span class="op" id="3464669">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464674">kvs</span>&nbsp;<span class="op" id="3464678">=</span>&nbsp;<span class="builtinfunc" id="3464680">append</span><span class="op" id="3464686">(</span><span class="ident" id="3464687">kvs</span><span class="op" id="3464690">,</span>&nbsp;<span class="ident" id="3464692">keyValues</span><span class="op" id="3464701">{</span><span class="ident" id="3464702">k</span><span class="op" id="3464703">,</span>&nbsp;<span class="ident" id="3464705">vv</span><span class="op" id="3464707">}</span><span class="op" id="3464708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3464712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3464715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464718">hs</span><span class="op" id="3464720">.</span><span class="ident" id="3464721">kvs</span>&nbsp;<span class="op" id="3464725">=</span>&nbsp;<span class="ident" id="3464727">kvs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464732">sort</span><span class="op" id="3464736">.</span><span class="ident" id="3464737">Sort</span><span class="op" id="3464741">(</span><span class="ident" id="3464742">hs</span><span class="op" id="3464744">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464747">return</span>&nbsp;<span class="ident" id="3464754">kvs</span><span class="op" id="3464757">,</span>&nbsp;<span class="ident" id="3464759">hs</span><br>
<span class="lineno"></span><span class="op" id="3464762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3464765">//&nbsp;WriteSubset&nbsp;writes&nbsp;a&nbsp;header&nbsp;in&nbsp;wire&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="3464812">//&nbsp;If&nbsp;exclude&nbsp;is&nbsp;not&nbsp;nil,&nbsp;keys&nbsp;where&nbsp;exclude[key]&nbsp;==&nbsp;true&nbsp;are&nbsp;not&nbsp;written.</span><br>
<span class="lineno">145</span><span class="keyword" id="3464887">func</span>&nbsp;<span class="op" id="3464892">(</span><span class="ident" id="3464893">h</span>&nbsp;<span class="ident" id="3464895">Header</span><span class="op" id="3464901">)</span>&nbsp;<span class="ident" id="3464903">WriteSubset</span><span class="op" id="3464914">(</span><span class="ident" id="3464915">w</span>&nbsp;<span class="ident" id="3464917">io</span><span class="op" id="3464919">.</span><span class="ident" id="3464920">Writer</span><span class="op" id="3464926">,</span>&nbsp;<span class="ident" id="3464928">exclude</span>&nbsp;<span class="keyword" id="3464936">map</span><span class="op" id="3464939">[</span><span class="builtintype" id="3464940">string</span><span class="op" id="3464946">]</span><span class="builtintype" id="3464947">bool</span><span class="op" id="3464951">)</span>&nbsp;<span class="builtintype" id="3464953">error</span>&nbsp;<span class="op" id="3464959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464962">ws</span><span class="op" id="3464964">,</span>&nbsp;<span class="ident" id="3464966">ok</span>&nbsp;<span class="op" id="3464969">:=</span>&nbsp;<span class="ident" id="3464972">w</span><span class="op" id="3464973">.</span><span class="op" id="3464974">(</span><span class="ident" id="3464975">writeStringer</span><span class="op" id="3464988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464991">if</span>&nbsp;<span class="op" id="3464994">!</span><span class="ident" id="3464995">ok</span>&nbsp;<span class="op" id="3464998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465002">ws</span>&nbsp;<span class="op" id="3465005">=</span>&nbsp;<span class="ident" id="3465007">stringWriter</span><span class="op" id="3465019">{</span><span class="ident" id="3465020">w</span><span class="op" id="3465021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3465024">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465027">kvs</span><span class="op" id="3465030">,</span>&nbsp;<span class="ident" id="3465032">sorter</span>&nbsp;<span class="op" id="3465039">:=</span>&nbsp;<span class="ident" id="3465042">h</span><span class="op" id="3465043">.</span><span class="ident" id="3465044">sortedKeyValues</span><span class="op" id="3465059">(</span><span class="ident" id="3465060">exclude</span><span class="op" id="3465067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465070">for</span>&nbsp;<span class="ident" id="3465074">_</span><span class="op" id="3465075">,</span>&nbsp;<span class="ident" id="3465077">kv</span>&nbsp;<span class="op" id="3465080">:=</span>&nbsp;<span class="keyword" id="3465083">range</span>&nbsp;<span class="ident" id="3465089">kvs</span>&nbsp;<span class="op" id="3465093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465097">for</span>&nbsp;<span class="ident" id="3465101">_</span><span class="op" id="3465102">,</span>&nbsp;<span class="ident" id="3465104">v</span>&nbsp;<span class="op" id="3465106">:=</span>&nbsp;<span class="keyword" id="3465109">range</span>&nbsp;<span class="ident" id="3465115">kv</span><span class="op" id="3465117">.</span><span class="ident" id="3465118">values</span>&nbsp;<span class="op" id="3465125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465130">v</span>&nbsp;<span class="op" id="3465132">=</span>&nbsp;<span class="ident" id="3465134">headerNewlineToSpace</span><span class="op" id="3465154">.</span><span class="ident" id="3465155">Replace</span><span class="op" id="3465162">(</span><span class="ident" id="3465163">v</span><span class="op" id="3465164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465169">v</span>&nbsp;<span class="op" id="3465171">=</span>&nbsp;<span class="ident" id="3465173">textproto</span><span class="op" id="3465182">.</span><span class="ident" id="3465183">TrimString</span><span class="op" id="3465193">(</span><span class="ident" id="3465194">v</span><span class="op" id="3465195">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465200">for</span>&nbsp;<span class="ident" id="3465204">_</span><span class="op" id="3465205">,</span>&nbsp;<span class="ident" id="3465207">s</span>&nbsp;<span class="op" id="3465209">:=</span>&nbsp;<span class="keyword" id="3465212">range</span>&nbsp;<span class="op" id="3465218">[</span><span class="op" id="3465219">]</span><span class="builtintype" id="3465220">string</span><span class="op" id="3465226">{</span><span class="ident" id="3465227">kv</span><span class="op" id="3465229">.</span><span class="ident" id="3465230">key</span><span class="op" id="3465233">,</span>&nbsp;<span class="string" id="3465235">&#34;:&nbsp;&#34;</span><span class="op" id="3465239">,</span>&nbsp;<span class="ident" id="3465241">v</span><span class="op" id="3465242">,</span>&nbsp;<span class="string" id="3465244">&#34;\r\n&#34;</span><span class="op" id="3465250">}</span>&nbsp;<span class="op" id="3465252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465258">if</span>&nbsp;<span class="ident" id="3465261">_</span><span class="op" id="3465262">,</span>&nbsp;<span class="ident" id="3465264">err</span>&nbsp;<span class="op" id="3465268">:=</span>&nbsp;<span class="ident" id="3465271">ws</span><span class="op" id="3465273">.</span><span class="ident" id="3465274">WriteString</span><span class="op" id="3465285">(</span><span class="ident" id="3465286">s</span><span class="op" id="3465287">)</span><span class="op" id="3465288">;</span>&nbsp;<span class="ident" id="3465290">err</span>&nbsp;<span class="op" id="3465294">!=</span>&nbsp;<span class="ident" id="3465297">nil</span>&nbsp;<span class="op" id="3465301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465308">return</span>&nbsp;<span class="ident" id="3465315">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3465323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3465328">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3465332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3465335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465338">headerSorterPool</span><span class="op" id="3465354">.</span><span class="ident" id="3465355">Put</span><span class="op" id="3465358">(</span><span class="ident" id="3465359">sorter</span><span class="op" id="3465365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465368">return</span>&nbsp;<span class="ident" id="3465375">nil</span><br>
<span class="lineno"></span><span class="op" id="3465379">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="3465382">//&nbsp;CanonicalHeaderKey&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;format&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3465440">//&nbsp;header&nbsp;key&nbsp;s.&nbsp;&nbsp;The&nbsp;canonicalization&nbsp;converts&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="3465498">//&nbsp;letter&nbsp;and&nbsp;any&nbsp;letter&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;to&nbsp;upper&nbsp;case;</span><br>
<span class="lineno"></span><span class="comment" id="3465557">//&nbsp;the&nbsp;rest&nbsp;are&nbsp;converted&nbsp;to&nbsp;lowercase.&nbsp;&nbsp;For&nbsp;example,&nbsp;the</span><br>
<span class="lineno">170</span><span class="comment" id="3465615">//&nbsp;canonical&nbsp;key&nbsp;for&nbsp;&#34;accept-encoding&#34;&nbsp;is&nbsp;&#34;Accept-Encoding&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3465676">func</span>&nbsp;<span class="ident" id="3465681">CanonicalHeaderKey</span><span class="op" id="3465699">(</span><span class="ident" id="3465700">s</span>&nbsp;<span class="builtintype" id="3465702">string</span><span class="op" id="3465708">)</span>&nbsp;<span class="builtintype" id="3465710">string</span>&nbsp;<span class="op" id="3465717">{</span>&nbsp;<span class="keyword" id="3465719">return</span>&nbsp;<span class="ident" id="3465726">textproto</span><span class="op" id="3465735">.</span><span class="ident" id="3465736">CanonicalMIMEHeaderKey</span><span class="op" id="3465758">(</span><span class="ident" id="3465759">s</span><span class="op" id="3465760">)</span>&nbsp;<span class="op" id="3465762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3465765">//&nbsp;hasToken&nbsp;reports&nbsp;whether&nbsp;token&nbsp;appears&nbsp;with&nbsp;v,&nbsp;ASCII</span><br>
<span class="lineno"></span><span class="comment" id="3465821">//&nbsp;case-insensitive,&nbsp;with&nbsp;space&nbsp;or&nbsp;comma&nbsp;boundaries.</span><br>
<span class="lineno">175</span><span class="comment" id="3465874">//&nbsp;token&nbsp;must&nbsp;be&nbsp;all&nbsp;lowercase.</span><br>
<span class="lineno"></span><span class="comment" id="3465906">//&nbsp;v&nbsp;may&nbsp;contain&nbsp;mixed&nbsp;cased.</span><br>
<span class="lineno"></span><span class="keyword" id="3465936">func</span>&nbsp;<span class="ident" id="3465941">hasToken</span><span class="op" id="3465949">(</span><span class="ident" id="3465950">v</span><span class="op" id="3465951">,</span>&nbsp;<span class="ident" id="3465953">token</span>&nbsp;<span class="builtintype" id="3465959">string</span><span class="op" id="3465965">)</span>&nbsp;<span class="builtintype" id="3465967">bool</span>&nbsp;<span class="op" id="3465972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465975">if</span>&nbsp;<span class="builtinfunc" id="3465978">len</span><span class="op" id="3465981">(</span><span class="ident" id="3465982">token</span><span class="op" id="3465987">)</span>&nbsp;<span class="op" id="3465989">&gt;</span>&nbsp;<span class="builtinfunc" id="3465991">len</span><span class="op" id="3465994">(</span><span class="ident" id="3465995">v</span><span class="op" id="3465996">)</span>&nbsp;<span class="op" id="3465998">||</span>&nbsp;<span class="ident" id="3466001">token</span>&nbsp;<span class="op" id="3466007">==</span>&nbsp;<span class="string" id="3466010">&#34;&#34;</span>&nbsp;<span class="op" id="3466013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466017">return</span>&nbsp;<span class="builtintype" id="3466024">false</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466034">if</span>&nbsp;<span class="ident" id="3466037">v</span>&nbsp;<span class="op" id="3466039">==</span>&nbsp;<span class="ident" id="3466042">token</span>&nbsp;<span class="op" id="3466048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466052">return</span>&nbsp;<span class="builtintype" id="3466059">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466068">for</span>&nbsp;<span class="ident" id="3466072">sp</span>&nbsp;<span class="op" id="3466075">:=</span>&nbsp;<span class="num" id="3466078">0</span><span class="op" id="3466079">;</span>&nbsp;<span class="ident" id="3466081">sp</span>&nbsp;<span class="op" id="3466084">&lt;=</span>&nbsp;<span class="builtinfunc" id="3466087">len</span><span class="op" id="3466090">(</span><span class="ident" id="3466091">v</span><span class="op" id="3466092">)</span><span class="op" id="3466093">-</span><span class="builtinfunc" id="3466094">len</span><span class="op" id="3466097">(</span><span class="ident" id="3466098">token</span><span class="op" id="3466103">)</span><span class="op" id="3466104">;</span>&nbsp;<span class="ident" id="3466106">sp</span><span class="op" id="3466108">++</span>&nbsp;<span class="op" id="3466111">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466115">//&nbsp;Check&nbsp;that&nbsp;first&nbsp;character&nbsp;is&nbsp;good.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466156">//&nbsp;The&nbsp;token&nbsp;is&nbsp;ASCII,&nbsp;so&nbsp;checking&nbsp;only&nbsp;a&nbsp;single&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466212">//&nbsp;is&nbsp;sufficient.&nbsp;&nbsp;We&nbsp;skip&nbsp;this&nbsp;potential&nbsp;starting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466265">//&nbsp;position&nbsp;if&nbsp;both&nbsp;the&nbsp;first&nbsp;byte&nbsp;and&nbsp;its&nbsp;potential</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466320">//&nbsp;ASCII&nbsp;uppercase&nbsp;equivalent&nbsp;(b|0x20)&nbsp;don&#39;t&nbsp;match.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466374">//&nbsp;False&nbsp;positives&nbsp;(&#39;^&#39;&nbsp;=&gt;&nbsp;&#39;~&#39;)&nbsp;are&nbsp;caught&nbsp;by&nbsp;EqualFold.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466433">if</span>&nbsp;<span class="ident" id="3466436">b</span>&nbsp;<span class="op" id="3466438">:=</span>&nbsp;<span class="ident" id="3466441">v</span><span class="op" id="3466442">[</span><span class="ident" id="3466443">sp</span><span class="op" id="3466445">]</span><span class="op" id="3466446">;</span>&nbsp;<span class="ident" id="3466448">b</span>&nbsp;<span class="op" id="3466450">!=</span>&nbsp;<span class="ident" id="3466453">token</span><span class="op" id="3466458">[</span><span class="num" id="3466459">0</span><span class="op" id="3466460">]</span>&nbsp;<span class="op" id="3466462">&amp;&amp;</span>&nbsp;<span class="ident" id="3466465">b</span><span class="op" id="3466466">|</span><span class="num" id="3466467">0x20</span>&nbsp;<span class="op" id="3466472">!=</span>&nbsp;<span class="ident" id="3466475">token</span><span class="op" id="3466480">[</span><span class="num" id="3466481">0</span><span class="op" id="3466482">]</span>&nbsp;<span class="op" id="3466484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466489">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466504">//&nbsp;Check&nbsp;that&nbsp;start&nbsp;pos&nbsp;is&nbsp;on&nbsp;a&nbsp;valid&nbsp;token&nbsp;boundary.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466560">if</span>&nbsp;<span class="ident" id="3466563">sp</span>&nbsp;<span class="op" id="3466566">&gt;</span>&nbsp;<span class="num" id="3466568">0</span>&nbsp;<span class="op" id="3466570">&amp;&amp;</span>&nbsp;<span class="op" id="3466573">!</span><span class="ident" id="3466574">isTokenBoundary</span><span class="op" id="3466589">(</span><span class="ident" id="3466590">v</span><span class="op" id="3466591">[</span><span class="ident" id="3466592">sp</span><span class="op" id="3466594">-</span><span class="num" id="3466595">1</span><span class="op" id="3466596">]</span><span class="op" id="3466597">)</span>&nbsp;<span class="op" id="3466599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466604">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466619">//&nbsp;Check&nbsp;that&nbsp;end&nbsp;pos&nbsp;is&nbsp;on&nbsp;a&nbsp;valid&nbsp;token&nbsp;boundary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466673">if</span>&nbsp;<span class="ident" id="3466676">endPos</span>&nbsp;<span class="op" id="3466683">:=</span>&nbsp;<span class="ident" id="3466686">sp</span>&nbsp;<span class="op" id="3466689">+</span>&nbsp;<span class="builtinfunc" id="3466691">len</span><span class="op" id="3466694">(</span><span class="ident" id="3466695">token</span><span class="op" id="3466700">)</span><span class="op" id="3466701">;</span>&nbsp;<span class="ident" id="3466703">endPos</span>&nbsp;<span class="op" id="3466710">!=</span>&nbsp;<span class="builtinfunc" id="3466713">len</span><span class="op" id="3466716">(</span><span class="ident" id="3466717">v</span><span class="op" id="3466718">)</span>&nbsp;<span class="op" id="3466720">&amp;&amp;</span>&nbsp;<span class="op" id="3466723">!</span><span class="ident" id="3466724">isTokenBoundary</span><span class="op" id="3466739">(</span><span class="ident" id="3466740">v</span><span class="op" id="3466741">[</span><span class="ident" id="3466742">endPos</span><span class="op" id="3466748">]</span><span class="op" id="3466749">)</span>&nbsp;<span class="op" id="3466751">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466756">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466771">if</span>&nbsp;<span class="ident" id="3466774">strings</span><span class="op" id="3466781">.</span><span class="ident" id="3466782">EqualFold</span><span class="op" id="3466791">(</span><span class="ident" id="3466792">v</span><span class="op" id="3466793">[</span><span class="ident" id="3466794">sp</span><span class="op" id="3466796">:</span><span class="ident" id="3466797">sp</span><span class="op" id="3466799">+</span><span class="builtinfunc" id="3466800">len</span><span class="op" id="3466803">(</span><span class="ident" id="3466804">token</span><span class="op" id="3466809">)</span><span class="op" id="3466810">]</span><span class="op" id="3466811">,</span>&nbsp;<span class="ident" id="3466813">token</span><span class="op" id="3466818">)</span>&nbsp;<span class="op" id="3466820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466825">return</span>&nbsp;<span class="builtintype" id="3466832">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466839">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466845">return</span>&nbsp;<span class="builtintype" id="3466852">false</span><br>
<span class="lineno"></span><span class="op" id="3466858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3466861">func</span>&nbsp;<span class="ident" id="3466866">isTokenBoundary</span><span class="op" id="3466881">(</span><span class="ident" id="3466882">b</span>&nbsp;<span class="builtintype" id="3466884">byte</span><span class="op" id="3466888">)</span>&nbsp;<span class="builtintype" id="3466890">bool</span>&nbsp;<span class="op" id="3466895">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466898">return</span>&nbsp;<span class="ident" id="3466905">b</span>&nbsp;<span class="op" id="3466907">==</span>&nbsp;<span class="string" id="3466910">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3466914">||</span>&nbsp;<span class="ident" id="3466917">b</span>&nbsp;<span class="op" id="3466919">==</span>&nbsp;<span class="string" id="3466922">&#39;,&#39;</span>&nbsp;<span class="op" id="3466926">||</span>&nbsp;<span class="ident" id="3466929">b</span>&nbsp;<span class="op" id="3466931">==</span>&nbsp;<span class="string" id="3466934">&#39;\t&#39;</span><br>
<span class="lineno"></span><span class="op" id="3466939">}</span>
</div>
</body>
</html>
