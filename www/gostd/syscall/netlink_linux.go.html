<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2602303">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2602359">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2602413">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2602464">//&nbsp;Netlink&nbsp;sockets&nbsp;and&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2602497">package</span>&nbsp;<span class="ident" id="2602505">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2602514">import</span>&nbsp;<span class="string" id="2602521">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2602531">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;message&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2602597">func</span>&nbsp;<span class="ident" id="2602602">nlmAlignOf</span><span class="op" id="2602612">(</span><span class="ident" id="2602613">msglen</span>&nbsp;<span class="builtintype" id="2602620">int</span><span class="op" id="2602623">)</span>&nbsp;<span class="builtintype" id="2602625">int</span>&nbsp;<span class="op" id="2602629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2602632">return</span>&nbsp;<span class="op" id="2602639">(</span><span class="ident" id="2602640">msglen</span>&nbsp;<span class="op" id="2602647">+</span>&nbsp;<span class="ident" id="2602649">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2602663">-</span>&nbsp;<span class="num" id="2602665">1</span><span class="op" id="2602666">)</span>&nbsp;<span class="op" id="2602668">&amp;</span>&nbsp;<span class="op" id="2602670">^</span><span class="op" id="2602671">(</span><span class="ident" id="2602672">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2602686">-</span>&nbsp;<span class="num" id="2602688">1</span><span class="op" id="2602689">)</span><br>
<span class="lineno"></span><span class="op" id="2602691">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2602694">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute&nbsp;up&nbsp;to&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2602758">//&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2602771">func</span>&nbsp;<span class="ident" id="2602776">rtaAlignOf</span><span class="op" id="2602786">(</span><span class="ident" id="2602787">attrlen</span>&nbsp;<span class="builtintype" id="2602795">int</span><span class="op" id="2602798">)</span>&nbsp;<span class="builtintype" id="2602800">int</span>&nbsp;<span class="op" id="2602804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2602807">return</span>&nbsp;<span class="op" id="2602814">(</span><span class="ident" id="2602815">attrlen</span>&nbsp;<span class="op" id="2602823">+</span>&nbsp;<span class="ident" id="2602825">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2602837">-</span>&nbsp;<span class="num" id="2602839">1</span><span class="op" id="2602840">)</span>&nbsp;<span class="op" id="2602842">&amp;</span>&nbsp;<span class="op" id="2602844">^</span><span class="op" id="2602845">(</span><span class="ident" id="2602846">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2602858">-</span>&nbsp;<span class="num" id="2602860">1</span><span class="op" id="2602861">)</span><br>
<span class="lineno">20</span><span class="op" id="2602863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2602866">//&nbsp;NetlinkRouteRequest&nbsp;represents&nbsp;a&nbsp;request&nbsp;message&nbsp;to&nbsp;receive&nbsp;routing</span><br>
<span class="lineno"></span><span class="comment" id="2602937">//&nbsp;and&nbsp;link&nbsp;states&nbsp;from&nbsp;the&nbsp;kernel.</span><br>
<span class="lineno"></span><span class="keyword" id="2602973">type</span>&nbsp;<span class="ident" id="2602978">NetlinkRouteRequest</span>&nbsp;<span class="keyword" id="2602998">struct</span>&nbsp;<span class="op" id="2603005">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2603008">Header</span>&nbsp;<span class="ident" id="2603015">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2603025">Data</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2603032">RtGenmsg</span><br>
<span class="lineno"></span><span class="op" id="2603041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2603044">func</span>&nbsp;<span class="op" id="2603049">(</span><span class="ident" id="2603050">rr</span>&nbsp;<span class="op" id="2603053">*</span><span class="ident" id="2603054">NetlinkRouteRequest</span><span class="op" id="2603073">)</span>&nbsp;<span class="ident" id="2603075">toWireFormat</span><span class="op" id="2603087">(</span><span class="op" id="2603088">)</span>&nbsp;<span class="op" id="2603090">[</span><span class="op" id="2603091">]</span><span class="builtintype" id="2603092">byte</span>&nbsp;<span class="op" id="2603097">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2603100">b</span>&nbsp;<span class="op" id="2603102">:=</span>&nbsp;<span class="builtinfunc" id="2603105">make</span><span class="op" id="2603109">(</span><span class="op" id="2603110">[</span><span class="op" id="2603111">]</span><span class="builtintype" id="2603112">byte</span><span class="op" id="2603116">,</span>&nbsp;<span class="ident" id="2603118">rr</span><span class="op" id="2603120">.</span><span class="ident" id="2603121">Header</span><span class="op" id="2603127">.</span><span class="ident" id="2603128">Len</span><span class="op" id="2603131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2603134">*</span><span class="op" id="2603135">(</span><span class="op" id="2603136">*</span><span class="builtintype" id="2603137">uint32</span><span class="op" id="2603143">)</span><span class="op" id="2603144">(</span><span class="ident" id="2603145">unsafe</span><span class="op" id="2603151">.</span><span class="ident" id="2603152">Pointer</span><span class="op" id="2603159">(</span><span class="op" id="2603160">&amp;</span><span class="ident" id="2603161">b</span><span class="op" id="2603162">[</span><span class="num" id="2603163">0</span><span class="op" id="2603164">:</span><span class="num" id="2603165">4</span><span class="op" id="2603166">]</span><span class="op" id="2603167">[</span><span class="num" id="2603168">0</span><span class="op" id="2603169">]</span><span class="op" id="2603170">)</span><span class="op" id="2603171">)</span>&nbsp;<span class="op" id="2603173">=</span>&nbsp;<span class="ident" id="2603175">rr</span><span class="op" id="2603177">.</span><span class="ident" id="2603178">Header</span><span class="op" id="2603184">.</span><span class="ident" id="2603185">Len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2603190">*</span><span class="op" id="2603191">(</span><span class="op" id="2603192">*</span><span class="builtintype" id="2603193">uint16</span><span class="op" id="2603199">)</span><span class="op" id="2603200">(</span><span class="ident" id="2603201">unsafe</span><span class="op" id="2603207">.</span><span class="ident" id="2603208">Pointer</span><span class="op" id="2603215">(</span><span class="op" id="2603216">&amp;</span><span class="ident" id="2603217">b</span><span class="op" id="2603218">[</span><span class="num" id="2603219">4</span><span class="op" id="2603220">:</span><span class="num" id="2603221">6</span><span class="op" id="2603222">]</span><span class="op" id="2603223">[</span><span class="num" id="2603224">0</span><span class="op" id="2603225">]</span><span class="op" id="2603226">)</span><span class="op" id="2603227">)</span>&nbsp;<span class="op" id="2603229">=</span>&nbsp;<span class="ident" id="2603231">rr</span><span class="op" id="2603233">.</span><span class="ident" id="2603234">Header</span><span class="op" id="2603240">.</span><span class="ident" id="2603241">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2603247">*</span><span class="op" id="2603248">(</span><span class="op" id="2603249">*</span><span class="builtintype" id="2603250">uint16</span><span class="op" id="2603256">)</span><span class="op" id="2603257">(</span><span class="ident" id="2603258">unsafe</span><span class="op" id="2603264">.</span><span class="ident" id="2603265">Pointer</span><span class="op" id="2603272">(</span><span class="op" id="2603273">&amp;</span><span class="ident" id="2603274">b</span><span class="op" id="2603275">[</span><span class="num" id="2603276">6</span><span class="op" id="2603277">:</span><span class="num" id="2603278">8</span><span class="op" id="2603279">]</span><span class="op" id="2603280">[</span><span class="num" id="2603281">0</span><span class="op" id="2603282">]</span><span class="op" id="2603283">)</span><span class="op" id="2603284">)</span>&nbsp;<span class="op" id="2603286">=</span>&nbsp;<span class="ident" id="2603288">rr</span><span class="op" id="2603290">.</span><span class="ident" id="2603291">Header</span><span class="op" id="2603297">.</span><span class="ident" id="2603298">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2603305">*</span><span class="op" id="2603306">(</span><span class="op" id="2603307">*</span><span class="builtintype" id="2603308">uint32</span><span class="op" id="2603314">)</span><span class="op" id="2603315">(</span><span class="ident" id="2603316">unsafe</span><span class="op" id="2603322">.</span><span class="ident" id="2603323">Pointer</span><span class="op" id="2603330">(</span><span class="op" id="2603331">&amp;</span><span class="ident" id="2603332">b</span><span class="op" id="2603333">[</span><span class="num" id="2603334">8</span><span class="op" id="2603335">:</span><span class="num" id="2603336">12</span><span class="op" id="2603338">]</span><span class="op" id="2603339">[</span><span class="num" id="2603340">0</span><span class="op" id="2603341">]</span><span class="op" id="2603342">)</span><span class="op" id="2603343">)</span>&nbsp;<span class="op" id="2603345">=</span>&nbsp;<span class="ident" id="2603347">rr</span><span class="op" id="2603349">.</span><span class="ident" id="2603350">Header</span><span class="op" id="2603356">.</span><span class="ident" id="2603357">Seq</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2603362">*</span><span class="op" id="2603363">(</span><span class="op" id="2603364">*</span><span class="builtintype" id="2603365">uint32</span><span class="op" id="2603371">)</span><span class="op" id="2603372">(</span><span class="ident" id="2603373">unsafe</span><span class="op" id="2603379">.</span><span class="ident" id="2603380">Pointer</span><span class="op" id="2603387">(</span><span class="op" id="2603388">&amp;</span><span class="ident" id="2603389">b</span><span class="op" id="2603390">[</span><span class="num" id="2603391">12</span><span class="op" id="2603393">:</span><span class="num" id="2603394">16</span><span class="op" id="2603396">]</span><span class="op" id="2603397">[</span><span class="num" id="2603398">0</span><span class="op" id="2603399">]</span><span class="op" id="2603400">)</span><span class="op" id="2603401">)</span>&nbsp;<span class="op" id="2603403">=</span>&nbsp;<span class="ident" id="2603405">rr</span><span class="op" id="2603407">.</span><span class="ident" id="2603408">Header</span><span class="op" id="2603414">.</span><span class="ident" id="2603415">Pid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2603420">b</span><span class="op" id="2603421">[</span><span class="num" id="2603422">16</span><span class="op" id="2603424">]</span>&nbsp;<span class="op" id="2603426">=</span>&nbsp;<span class="builtintype" id="2603428">byte</span><span class="op" id="2603432">(</span><span class="ident" id="2603433">rr</span><span class="op" id="2603435">.</span><span class="ident" id="2603436">Data</span><span class="op" id="2603440">.</span><span class="ident" id="2603441">Family</span><span class="op" id="2603447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2603450">return</span>&nbsp;<span class="ident" id="2603457">b</span><br>
<span class="lineno"></span><span class="op" id="2603459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2603462">func</span>&nbsp;<span class="ident" id="2603467">newNetlinkRouteRequest</span><span class="op" id="2603489">(</span><span class="ident" id="2603490">proto</span><span class="op" id="2603495">,</span>&nbsp;<span class="ident" id="2603497">seq</span><span class="op" id="2603500">,</span>&nbsp;<span class="ident" id="2603502">family</span>&nbsp;<span class="builtintype" id="2603509">int</span><span class="op" id="2603512">)</span>&nbsp;<span class="op" id="2603514">[</span><span class="op" id="2603515">]</span><span class="builtintype" id="2603516">byte</span>&nbsp;<span class="op" id="2603521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2603524">rr</span>&nbsp;<span class="op" id="2603527">:=</span>&nbsp;<span class="op" id="2603530">&amp;</span><span class="ident" id="2603531">NetlinkRouteRequest</span><span class="op" id="2603550">{</span><span class="op" id="2603551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2603554">rr</span><span class="op" id="2603556">.</span><span class="ident" id="2603557">Header</span><span class="op" id="2603563">.</span><span class="ident" id="2603564">Len</span>&nbsp;<span class="op" id="2603568">=</span>&nbsp;<span class="builtintype" id="2603570">uint32</span><span class="op" id="2603576">(</span><span class="ident" id="2603577">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2603590">+</span>&nbsp;<span class="ident" id="2603592">SizeofRtGenmsg</span><span class="op" id="2603606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2603609">rr</span><span class="op" id="2603611">.</span><span class="ident" id="2603612">Header</span><span class="op" id="2603618">.</span><span class="ident" id="2603619">Type</span>&nbsp;<span class="op" id="2603624">=</span>&nbsp;<span class="builtintype" id="2603626">uint16</span><span class="op" id="2603632">(</span><span class="ident" id="2603633">proto</span><span class="op" id="2603638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2603641">rr</span><span class="op" id="2603643">.</span><span class="ident" id="2603644">Header</span><span class="op" id="2603650">.</span><span class="ident" id="2603651">Flags</span>&nbsp;<span class="op" id="2603657">=</span>&nbsp;<span class="ident" id="2603659">NLM_F_DUMP</span>&nbsp;<span class="op" id="2603670">|</span>&nbsp;<span class="ident" id="2603672">NLM_F_REQUEST</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2603687">rr</span><span class="op" id="2603689">.</span><span class="ident" id="2603690">Header</span><span class="op" id="2603696">.</span><span class="ident" id="2603697">Seq</span>&nbsp;<span class="op" id="2603701">=</span>&nbsp;<span class="builtintype" id="2603703">uint32</span><span class="op" id="2603709">(</span><span class="ident" id="2603710">seq</span><span class="op" id="2603713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2603716">rr</span><span class="op" id="2603718">.</span><span class="ident" id="2603719">Data</span><span class="op" id="2603723">.</span><span class="ident" id="2603724">Family</span>&nbsp;<span class="op" id="2603731">=</span>&nbsp;<span class="builtintype" id="2603733">uint8</span><span class="op" id="2603738">(</span><span class="ident" id="2603739">family</span><span class="op" id="2603745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2603748">return</span>&nbsp;<span class="ident" id="2603755">rr</span><span class="op" id="2603757">.</span><span class="ident" id="2603758">toWireFormat</span><span class="op" id="2603770">(</span><span class="op" id="2603771">)</span><br>
<span class="lineno"></span><span class="op" id="2603773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="2603776">//&nbsp;NetlinkRIB&nbsp;returns&nbsp;routing&nbsp;information&nbsp;base,&nbsp;as&nbsp;known&nbsp;as&nbsp;RIB,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="2603847">//&nbsp;consists&nbsp;of&nbsp;network&nbsp;facility&nbsp;information,&nbsp;states&nbsp;and&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="2603915">func</span>&nbsp;<span class="ident" id="2603920">NetlinkRIB</span><span class="op" id="2603930">(</span><span class="ident" id="2603931">proto</span><span class="op" id="2603936">,</span>&nbsp;<span class="ident" id="2603938">family</span>&nbsp;<span class="builtintype" id="2603945">int</span><span class="op" id="2603948">)</span>&nbsp;<span class="op" id="2603950">(</span><span class="op" id="2603951">[</span><span class="op" id="2603952">]</span><span class="builtintype" id="2603953">byte</span><span class="op" id="2603957">,</span>&nbsp;<span class="builtintype" id="2603959">error</span><span class="op" id="2603964">)</span>&nbsp;<span class="op" id="2603966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2603969">s</span><span class="op" id="2603970">,</span>&nbsp;<span class="ident" id="2603972">err</span>&nbsp;<span class="op" id="2603976">:=</span>&nbsp;<span class="ident" id="2603979">Socket</span><span class="op" id="2603985">(</span><span class="ident" id="2603986">AF_NETLINK</span><span class="op" id="2603996">,</span>&nbsp;<span class="ident" id="2603998">SOCK_RAW</span><span class="op" id="2604006">,</span>&nbsp;<span class="ident" id="2604008">NETLINK_ROUTE</span><span class="op" id="2604021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604024">if</span>&nbsp;<span class="ident" id="2604027">err</span>&nbsp;<span class="op" id="2604031">!=</span>&nbsp;<span class="ident" id="2604034">nil</span>&nbsp;<span class="op" id="2604038">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604042">return</span>&nbsp;<span class="ident" id="2604049">nil</span><span class="op" id="2604052">,</span>&nbsp;<span class="ident" id="2604054">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2604059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604062">defer</span>&nbsp;<span class="ident" id="2604068">Close</span><span class="op" id="2604073">(</span><span class="ident" id="2604074">s</span><span class="op" id="2604075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2604078">lsa</span>&nbsp;<span class="op" id="2604082">:=</span>&nbsp;<span class="op" id="2604085">&amp;</span><span class="ident" id="2604086">SockaddrNetlink</span><span class="op" id="2604101">{</span><span class="ident" id="2604102">Family</span><span class="op" id="2604108">:</span>&nbsp;<span class="ident" id="2604110">AF_NETLINK</span><span class="op" id="2604120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604123">if</span>&nbsp;<span class="ident" id="2604126">err</span>&nbsp;<span class="op" id="2604130">:=</span>&nbsp;<span class="ident" id="2604133">Bind</span><span class="op" id="2604137">(</span><span class="ident" id="2604138">s</span><span class="op" id="2604139">,</span>&nbsp;<span class="ident" id="2604141">lsa</span><span class="op" id="2604144">)</span><span class="op" id="2604145">;</span>&nbsp;<span class="ident" id="2604147">err</span>&nbsp;<span class="op" id="2604151">!=</span>&nbsp;<span class="ident" id="2604154">nil</span>&nbsp;<span class="op" id="2604158">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604162">return</span>&nbsp;<span class="ident" id="2604169">nil</span><span class="op" id="2604172">,</span>&nbsp;<span class="ident" id="2604174">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2604179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2604182">wb</span>&nbsp;<span class="op" id="2604185">:=</span>&nbsp;<span class="ident" id="2604188">newNetlinkRouteRequest</span><span class="op" id="2604210">(</span><span class="ident" id="2604211">proto</span><span class="op" id="2604216">,</span>&nbsp;<span class="num" id="2604218">1</span><span class="op" id="2604219">,</span>&nbsp;<span class="ident" id="2604221">family</span><span class="op" id="2604227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604230">if</span>&nbsp;<span class="ident" id="2604233">err</span>&nbsp;<span class="op" id="2604237">:=</span>&nbsp;<span class="ident" id="2604240">Sendto</span><span class="op" id="2604246">(</span><span class="ident" id="2604247">s</span><span class="op" id="2604248">,</span>&nbsp;<span class="ident" id="2604250">wb</span><span class="op" id="2604252">,</span>&nbsp;<span class="num" id="2604254">0</span><span class="op" id="2604255">,</span>&nbsp;<span class="ident" id="2604257">lsa</span><span class="op" id="2604260">)</span><span class="op" id="2604261">;</span>&nbsp;<span class="ident" id="2604263">err</span>&nbsp;<span class="op" id="2604267">!=</span>&nbsp;<span class="ident" id="2604270">nil</span>&nbsp;<span class="op" id="2604274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604278">return</span>&nbsp;<span class="ident" id="2604285">nil</span><span class="op" id="2604288">,</span>&nbsp;<span class="ident" id="2604290">err</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2604295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604298">var</span>&nbsp;<span class="ident" id="2604302">tab</span>&nbsp;<span class="op" id="2604306">[</span><span class="op" id="2604307">]</span><span class="builtintype" id="2604308">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2604314">rbNew</span>&nbsp;<span class="op" id="2604320">:=</span>&nbsp;<span class="builtinfunc" id="2604323">make</span><span class="op" id="2604327">(</span><span class="op" id="2604328">[</span><span class="op" id="2604329">]</span><span class="builtintype" id="2604330">byte</span><span class="op" id="2604334">,</span>&nbsp;<span class="ident" id="2604336">Getpagesize</span><span class="op" id="2604347">(</span><span class="op" id="2604348">)</span><span class="op" id="2604349">)</span><br>
<span class="lineno"></span><span class="ident" id="2604351">done</span><span class="op" id="2604355">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604358">for</span>&nbsp;<span class="op" id="2604362">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2604366">rb</span>&nbsp;<span class="op" id="2604369">:=</span>&nbsp;<span class="ident" id="2604372">rbNew</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2604380">nr</span><span class="op" id="2604382">,</span>&nbsp;<span class="ident" id="2604384">_</span><span class="op" id="2604385">,</span>&nbsp;<span class="ident" id="2604387">err</span>&nbsp;<span class="op" id="2604391">:=</span>&nbsp;<span class="ident" id="2604394">Recvfrom</span><span class="op" id="2604402">(</span><span class="ident" id="2604403">s</span><span class="op" id="2604404">,</span>&nbsp;<span class="ident" id="2604406">rb</span><span class="op" id="2604408">,</span>&nbsp;<span class="num" id="2604410">0</span><span class="op" id="2604411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604415">if</span>&nbsp;<span class="ident" id="2604418">err</span>&nbsp;<span class="op" id="2604422">!=</span>&nbsp;<span class="ident" id="2604425">nil</span>&nbsp;<span class="op" id="2604429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604434">return</span>&nbsp;<span class="ident" id="2604441">nil</span><span class="op" id="2604444">,</span>&nbsp;<span class="ident" id="2604446">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2604452">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604456">if</span>&nbsp;<span class="ident" id="2604459">nr</span>&nbsp;<span class="op" id="2604462">&lt;</span>&nbsp;<span class="ident" id="2604464">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2604477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604482">return</span>&nbsp;<span class="ident" id="2604489">nil</span><span class="op" id="2604492">,</span>&nbsp;<span class="ident" id="2604494">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2604503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2604507">rb</span>&nbsp;<span class="op" id="2604510">=</span>&nbsp;<span class="ident" id="2604512">rb</span><span class="op" id="2604514">[</span><span class="op" id="2604515">:</span><span class="ident" id="2604516">nr</span><span class="op" id="2604518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2604522">tab</span>&nbsp;<span class="op" id="2604526">=</span>&nbsp;<span class="builtinfunc" id="2604528">append</span><span class="op" id="2604534">(</span><span class="ident" id="2604535">tab</span><span class="op" id="2604538">,</span>&nbsp;<span class="ident" id="2604540">rb</span><span class="op" id="2604542">...</span><span class="op" id="2604545">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2604549">msgs</span><span class="op" id="2604553">,</span>&nbsp;<span class="ident" id="2604555">err</span>&nbsp;<span class="op" id="2604559">:=</span>&nbsp;<span class="ident" id="2604562">ParseNetlinkMessage</span><span class="op" id="2604581">(</span><span class="ident" id="2604582">rb</span><span class="op" id="2604584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604588">if</span>&nbsp;<span class="ident" id="2604591">err</span>&nbsp;<span class="op" id="2604595">!=</span>&nbsp;<span class="ident" id="2604598">nil</span>&nbsp;<span class="op" id="2604602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604607">return</span>&nbsp;<span class="ident" id="2604614">nil</span><span class="op" id="2604617">,</span>&nbsp;<span class="ident" id="2604619">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2604625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604629">for</span>&nbsp;<span class="ident" id="2604633">_</span><span class="op" id="2604634">,</span>&nbsp;<span class="ident" id="2604636">m</span>&nbsp;<span class="op" id="2604638">:=</span>&nbsp;<span class="keyword" id="2604641">range</span>&nbsp;<span class="ident" id="2604647">msgs</span>&nbsp;<span class="op" id="2604652">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2604657">lsa</span><span class="op" id="2604660">,</span>&nbsp;<span class="ident" id="2604662">err</span>&nbsp;<span class="op" id="2604666">:=</span>&nbsp;<span class="ident" id="2604669">Getsockname</span><span class="op" id="2604680">(</span><span class="ident" id="2604681">s</span><span class="op" id="2604682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604687">if</span>&nbsp;<span class="ident" id="2604690">err</span>&nbsp;<span class="op" id="2604694">!=</span>&nbsp;<span class="ident" id="2604697">nil</span>&nbsp;<span class="op" id="2604701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604707">return</span>&nbsp;<span class="ident" id="2604714">nil</span><span class="op" id="2604717">,</span>&nbsp;<span class="ident" id="2604719">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2604726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604731">switch</span>&nbsp;<span class="ident" id="2604738">v</span>&nbsp;<span class="op" id="2604740">:=</span>&nbsp;<span class="ident" id="2604743">lsa</span><span class="op" id="2604746">.</span><span class="op" id="2604747">(</span><span class="keyword" id="2604748">type</span><span class="op" id="2604752">)</span>&nbsp;<span class="op" id="2604754">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604759">case</span>&nbsp;<span class="op" id="2604764">*</span><span class="ident" id="2604765">SockaddrNetlink</span><span class="op" id="2604780">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604786">if</span>&nbsp;<span class="ident" id="2604789">m</span><span class="op" id="2604790">.</span><span class="ident" id="2604791">Header</span><span class="op" id="2604797">.</span><span class="ident" id="2604798">Seq</span>&nbsp;<span class="op" id="2604802">!=</span>&nbsp;<span class="num" id="2604805">1</span>&nbsp;<span class="op" id="2604807">||</span>&nbsp;<span class="ident" id="2604810">m</span><span class="op" id="2604811">.</span><span class="ident" id="2604812">Header</span><span class="op" id="2604818">.</span><span class="ident" id="2604819">Pid</span>&nbsp;<span class="op" id="2604823">!=</span>&nbsp;<span class="ident" id="2604826">v</span><span class="op" id="2604827">.</span><span class="ident" id="2604828">Pid</span>&nbsp;<span class="op" id="2604832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604839">return</span>&nbsp;<span class="ident" id="2604846">nil</span><span class="op" id="2604849">,</span>&nbsp;<span class="ident" id="2604851">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2604862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604867">default</span><span class="op" id="2604874">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604880">return</span>&nbsp;<span class="ident" id="2604887">nil</span><span class="op" id="2604890">,</span>&nbsp;<span class="ident" id="2604892">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2604902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604907">if</span>&nbsp;<span class="ident" id="2604910">m</span><span class="op" id="2604911">.</span><span class="ident" id="2604912">Header</span><span class="op" id="2604918">.</span><span class="ident" id="2604919">Type</span>&nbsp;<span class="op" id="2604924">==</span>&nbsp;<span class="ident" id="2604927">NLMSG_DONE</span>&nbsp;<span class="op" id="2604938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604944">break</span>&nbsp;<span class="ident" id="2604950">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2604958">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2604963">if</span>&nbsp;<span class="ident" id="2604966">m</span><span class="op" id="2604967">.</span><span class="ident" id="2604968">Header</span><span class="op" id="2604974">.</span><span class="ident" id="2604975">Type</span>&nbsp;<span class="op" id="2604980">==</span>&nbsp;<span class="ident" id="2604983">NLMSG_ERROR</span>&nbsp;<span class="op" id="2604995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2605001">return</span>&nbsp;<span class="ident" id="2605008">nil</span><span class="op" id="2605011">,</span>&nbsp;<span class="ident" id="2605013">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2605023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2605027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2605030">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2605033">return</span>&nbsp;<span class="ident" id="2605040">tab</span><span class="op" id="2605043">,</span>&nbsp;<span class="ident" id="2605045">nil</span><br>
<span class="lineno"></span><span class="op" id="2605049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2605052">//&nbsp;NetlinkMessage&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2605100">type</span>&nbsp;<span class="ident" id="2605105">NetlinkMessage</span>&nbsp;<span class="keyword" id="2605120">struct</span>&nbsp;<span class="op" id="2605127">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2605130">Header</span>&nbsp;<span class="ident" id="2605137">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2605147">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2605154">[</span><span class="op" id="2605155">]</span><span class="builtintype" id="2605156">byte</span><br>
<span class="lineno"></span><span class="op" id="2605161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2605164">//&nbsp;ParseNetlinkMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink&nbsp;messages&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="2605232">//&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the&nbsp;NetlinkMessage&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2605295">func</span>&nbsp;<span class="ident" id="2605300">ParseNetlinkMessage</span><span class="op" id="2605319">(</span><span class="ident" id="2605320">b</span>&nbsp;<span class="op" id="2605322">[</span><span class="op" id="2605323">]</span><span class="builtintype" id="2605324">byte</span><span class="op" id="2605328">)</span>&nbsp;<span class="op" id="2605330">(</span><span class="op" id="2605331">[</span><span class="op" id="2605332">]</span><span class="ident" id="2605333">NetlinkMessage</span><span class="op" id="2605347">,</span>&nbsp;<span class="builtintype" id="2605349">error</span><span class="op" id="2605354">)</span>&nbsp;<span class="op" id="2605356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2605359">var</span>&nbsp;<span class="ident" id="2605363">msgs</span>&nbsp;<span class="op" id="2605368">[</span><span class="op" id="2605369">]</span><span class="ident" id="2605370">NetlinkMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2605386">for</span>&nbsp;<span class="builtinfunc" id="2605390">len</span><span class="op" id="2605393">(</span><span class="ident" id="2605394">b</span><span class="op" id="2605395">)</span>&nbsp;<span class="op" id="2605397">&gt;=</span>&nbsp;<span class="ident" id="2605400">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2605413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2605417">h</span><span class="op" id="2605418">,</span>&nbsp;<span class="ident" id="2605420">dbuf</span><span class="op" id="2605424">,</span>&nbsp;<span class="ident" id="2605426">dlen</span><span class="op" id="2605430">,</span>&nbsp;<span class="ident" id="2605432">err</span>&nbsp;<span class="op" id="2605436">:=</span>&nbsp;<span class="ident" id="2605439">netlinkMessageHeaderAndData</span><span class="op" id="2605466">(</span><span class="ident" id="2605467">b</span><span class="op" id="2605468">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2605472">if</span>&nbsp;<span class="ident" id="2605475">err</span>&nbsp;<span class="op" id="2605479">!=</span>&nbsp;<span class="ident" id="2605482">nil</span>&nbsp;<span class="op" id="2605486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2605491">return</span>&nbsp;<span class="ident" id="2605498">nil</span><span class="op" id="2605501">,</span>&nbsp;<span class="ident" id="2605503">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2605509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2605513">m</span>&nbsp;<span class="op" id="2605515">:=</span>&nbsp;<span class="ident" id="2605518">NetlinkMessage</span><span class="op" id="2605532">{</span><span class="ident" id="2605533">Header</span><span class="op" id="2605539">:</span>&nbsp;<span class="op" id="2605541">*</span><span class="ident" id="2605542">h</span><span class="op" id="2605543">,</span>&nbsp;<span class="ident" id="2605545">Data</span><span class="op" id="2605549">:</span>&nbsp;<span class="ident" id="2605551">dbuf</span><span class="op" id="2605555">[</span><span class="op" id="2605556">:</span><span class="builtintype" id="2605557">int</span><span class="op" id="2605560">(</span><span class="ident" id="2605561">h</span><span class="op" id="2605562">.</span><span class="ident" id="2605563">Len</span><span class="op" id="2605566">)</span><span class="op" id="2605567">-</span><span class="ident" id="2605568">NLMSG_HDRLEN</span><span class="op" id="2605580">]</span><span class="op" id="2605581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2605585">msgs</span>&nbsp;<span class="op" id="2605590">=</span>&nbsp;<span class="builtinfunc" id="2605592">append</span><span class="op" id="2605598">(</span><span class="ident" id="2605599">msgs</span><span class="op" id="2605603">,</span>&nbsp;<span class="ident" id="2605605">m</span><span class="op" id="2605606">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2605610">b</span>&nbsp;<span class="op" id="2605612">=</span>&nbsp;<span class="ident" id="2605614">b</span><span class="op" id="2605615">[</span><span class="ident" id="2605616">dlen</span><span class="op" id="2605620">:</span><span class="op" id="2605621">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2605624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2605627">return</span>&nbsp;<span class="ident" id="2605634">msgs</span><span class="op" id="2605638">,</span>&nbsp;<span class="ident" id="2605640">nil</span><br>
<span class="lineno"></span><span class="op" id="2605644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2605647">func</span>&nbsp;<span class="ident" id="2605652">netlinkMessageHeaderAndData</span><span class="op" id="2605679">(</span><span class="ident" id="2605680">b</span>&nbsp;<span class="op" id="2605682">[</span><span class="op" id="2605683">]</span><span class="builtintype" id="2605684">byte</span><span class="op" id="2605688">)</span>&nbsp;<span class="op" id="2605690">(</span><span class="op" id="2605691">*</span><span class="ident" id="2605692">NlMsghdr</span><span class="op" id="2605700">,</span>&nbsp;<span class="op" id="2605702">[</span><span class="op" id="2605703">]</span><span class="builtintype" id="2605704">byte</span><span class="op" id="2605708">,</span>&nbsp;<span class="builtintype" id="2605710">int</span><span class="op" id="2605713">,</span>&nbsp;<span class="builtintype" id="2605715">error</span><span class="op" id="2605720">)</span>&nbsp;<span class="op" id="2605722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2605725">h</span>&nbsp;<span class="op" id="2605727">:=</span>&nbsp;<span class="op" id="2605730">(</span><span class="op" id="2605731">*</span><span class="ident" id="2605732">NlMsghdr</span><span class="op" id="2605740">)</span><span class="op" id="2605741">(</span><span class="ident" id="2605742">unsafe</span><span class="op" id="2605748">.</span><span class="ident" id="2605749">Pointer</span><span class="op" id="2605756">(</span><span class="op" id="2605757">&amp;</span><span class="ident" id="2605758">b</span><span class="op" id="2605759">[</span><span class="num" id="2605760">0</span><span class="op" id="2605761">]</span><span class="op" id="2605762">)</span><span class="op" id="2605763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2605766">if</span>&nbsp;<span class="builtintype" id="2605769">int</span><span class="op" id="2605772">(</span><span class="ident" id="2605773">h</span><span class="op" id="2605774">.</span><span class="ident" id="2605775">Len</span><span class="op" id="2605778">)</span>&nbsp;<span class="op" id="2605780">&lt;</span>&nbsp;<span class="ident" id="2605782">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2605795">||</span>&nbsp;<span class="builtintype" id="2605798">int</span><span class="op" id="2605801">(</span><span class="ident" id="2605802">h</span><span class="op" id="2605803">.</span><span class="ident" id="2605804">Len</span><span class="op" id="2605807">)</span>&nbsp;<span class="op" id="2605809">&gt;</span>&nbsp;<span class="builtinfunc" id="2605811">len</span><span class="op" id="2605814">(</span><span class="ident" id="2605815">b</span><span class="op" id="2605816">)</span>&nbsp;<span class="op" id="2605818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2605822">return</span>&nbsp;<span class="ident" id="2605829">nil</span><span class="op" id="2605832">,</span>&nbsp;<span class="ident" id="2605834">nil</span><span class="op" id="2605837">,</span>&nbsp;<span class="num" id="2605839">0</span><span class="op" id="2605840">,</span>&nbsp;<span class="ident" id="2605842">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2605850">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2605853">return</span>&nbsp;<span class="ident" id="2605860">h</span><span class="op" id="2605861">,</span>&nbsp;<span class="ident" id="2605863">b</span><span class="op" id="2605864">[</span><span class="ident" id="2605865">NLMSG_HDRLEN</span><span class="op" id="2605877">:</span><span class="op" id="2605878">]</span><span class="op" id="2605879">,</span>&nbsp;<span class="ident" id="2605881">nlmAlignOf</span><span class="op" id="2605891">(</span><span class="builtintype" id="2605892">int</span><span class="op" id="2605895">(</span><span class="ident" id="2605896">h</span><span class="op" id="2605897">.</span><span class="ident" id="2605898">Len</span><span class="op" id="2605901">)</span><span class="op" id="2605902">)</span><span class="op" id="2605903">,</span>&nbsp;<span class="ident" id="2605905">nil</span><br>
<span class="lineno"></span><span class="op" id="2605909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2605912">//&nbsp;NetlinkRouteAttr&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="2605970">type</span>&nbsp;<span class="ident" id="2605975">NetlinkRouteAttr</span>&nbsp;<span class="keyword" id="2605992">struct</span>&nbsp;<span class="op" id="2605999">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2606002">Attr</span>&nbsp;&nbsp;<span class="ident" id="2606008">RtAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2606016">Value</span>&nbsp;<span class="op" id="2606022">[</span><span class="op" id="2606023">]</span><span class="builtintype" id="2606024">byte</span><br>
<span class="lineno"></span><span class="op" id="2606029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2606032">//&nbsp;ParseNetlinkRouteAttr&nbsp;parses&nbsp;m&#39;s&nbsp;payload&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink</span><br>
<span class="lineno">145</span><span class="comment" id="2606099">//&nbsp;route&nbsp;attributes&nbsp;and&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2606156">//&nbsp;NetlinkRouteAttr&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2606188">func</span>&nbsp;<span class="ident" id="2606193">ParseNetlinkRouteAttr</span><span class="op" id="2606214">(</span><span class="ident" id="2606215">m</span>&nbsp;<span class="op" id="2606217">*</span><span class="ident" id="2606218">NetlinkMessage</span><span class="op" id="2606232">)</span>&nbsp;<span class="op" id="2606234">(</span><span class="op" id="2606235">[</span><span class="op" id="2606236">]</span><span class="ident" id="2606237">NetlinkRouteAttr</span><span class="op" id="2606253">,</span>&nbsp;<span class="builtintype" id="2606255">error</span><span class="op" id="2606260">)</span>&nbsp;<span class="op" id="2606262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2606265">var</span>&nbsp;<span class="ident" id="2606269">b</span>&nbsp;<span class="op" id="2606271">[</span><span class="op" id="2606272">]</span><span class="builtintype" id="2606273">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2606279">switch</span>&nbsp;<span class="ident" id="2606286">m</span><span class="op" id="2606287">.</span><span class="ident" id="2606288">Header</span><span class="op" id="2606294">.</span><span class="ident" id="2606295">Type</span>&nbsp;<span class="op" id="2606300">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2606303">case</span>&nbsp;<span class="ident" id="2606308">RTM_NEWLINK</span><span class="op" id="2606319">,</span>&nbsp;<span class="ident" id="2606321">RTM_DELLINK</span><span class="op" id="2606332">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2606336">b</span>&nbsp;<span class="op" id="2606338">=</span>&nbsp;<span class="ident" id="2606340">m</span><span class="op" id="2606341">.</span><span class="ident" id="2606342">Data</span><span class="op" id="2606346">[</span><span class="ident" id="2606347">SizeofIfInfomsg</span><span class="op" id="2606362">:</span><span class="op" id="2606363">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2606366">case</span>&nbsp;<span class="ident" id="2606371">RTM_NEWADDR</span><span class="op" id="2606382">,</span>&nbsp;<span class="ident" id="2606384">RTM_DELADDR</span><span class="op" id="2606395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2606399">b</span>&nbsp;<span class="op" id="2606401">=</span>&nbsp;<span class="ident" id="2606403">m</span><span class="op" id="2606404">.</span><span class="ident" id="2606405">Data</span><span class="op" id="2606409">[</span><span class="ident" id="2606410">SizeofIfAddrmsg</span><span class="op" id="2606425">:</span><span class="op" id="2606426">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2606429">case</span>&nbsp;<span class="ident" id="2606434">RTM_NEWROUTE</span><span class="op" id="2606446">,</span>&nbsp;<span class="ident" id="2606448">RTM_DELROUTE</span><span class="op" id="2606460">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2606464">b</span>&nbsp;<span class="op" id="2606466">=</span>&nbsp;<span class="ident" id="2606468">m</span><span class="op" id="2606469">.</span><span class="ident" id="2606470">Data</span><span class="op" id="2606474">[</span><span class="ident" id="2606475">SizeofRtMsg</span><span class="op" id="2606486">:</span><span class="op" id="2606487">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2606490">default</span><span class="op" id="2606497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2606501">return</span>&nbsp;<span class="ident" id="2606508">nil</span><span class="op" id="2606511">,</span>&nbsp;<span class="ident" id="2606513">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2606521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2606524">var</span>&nbsp;<span class="ident" id="2606528">attrs</span>&nbsp;<span class="op" id="2606534">[</span><span class="op" id="2606535">]</span><span class="ident" id="2606536">NetlinkRouteAttr</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2606554">for</span>&nbsp;<span class="builtinfunc" id="2606558">len</span><span class="op" id="2606561">(</span><span class="ident" id="2606562">b</span><span class="op" id="2606563">)</span>&nbsp;<span class="op" id="2606565">&gt;=</span>&nbsp;<span class="ident" id="2606568">SizeofRtAttr</span>&nbsp;<span class="op" id="2606581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2606585">a</span><span class="op" id="2606586">,</span>&nbsp;<span class="ident" id="2606588">vbuf</span><span class="op" id="2606592">,</span>&nbsp;<span class="ident" id="2606594">alen</span><span class="op" id="2606598">,</span>&nbsp;<span class="ident" id="2606600">err</span>&nbsp;<span class="op" id="2606604">:=</span>&nbsp;<span class="ident" id="2606607">netlinkRouteAttrAndValue</span><span class="op" id="2606631">(</span><span class="ident" id="2606632">b</span><span class="op" id="2606633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2606637">if</span>&nbsp;<span class="ident" id="2606640">err</span>&nbsp;<span class="op" id="2606644">!=</span>&nbsp;<span class="ident" id="2606647">nil</span>&nbsp;<span class="op" id="2606651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2606656">return</span>&nbsp;<span class="ident" id="2606663">nil</span><span class="op" id="2606666">,</span>&nbsp;<span class="ident" id="2606668">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2606674">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2606678">ra</span>&nbsp;<span class="op" id="2606681">:=</span>&nbsp;<span class="ident" id="2606684">NetlinkRouteAttr</span><span class="op" id="2606700">{</span><span class="ident" id="2606701">Attr</span><span class="op" id="2606705">:</span>&nbsp;<span class="op" id="2606707">*</span><span class="ident" id="2606708">a</span><span class="op" id="2606709">,</span>&nbsp;<span class="ident" id="2606711">Value</span><span class="op" id="2606716">:</span>&nbsp;<span class="ident" id="2606718">vbuf</span><span class="op" id="2606722">[</span><span class="op" id="2606723">:</span><span class="builtintype" id="2606724">int</span><span class="op" id="2606727">(</span><span class="ident" id="2606728">a</span><span class="op" id="2606729">.</span><span class="ident" id="2606730">Len</span><span class="op" id="2606733">)</span><span class="op" id="2606734">-</span><span class="ident" id="2606735">SizeofRtAttr</span><span class="op" id="2606747">]</span><span class="op" id="2606748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2606752">attrs</span>&nbsp;<span class="op" id="2606758">=</span>&nbsp;<span class="builtinfunc" id="2606760">append</span><span class="op" id="2606766">(</span><span class="ident" id="2606767">attrs</span><span class="op" id="2606772">,</span>&nbsp;<span class="ident" id="2606774">ra</span><span class="op" id="2606776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2606780">b</span>&nbsp;<span class="op" id="2606782">=</span>&nbsp;<span class="ident" id="2606784">b</span><span class="op" id="2606785">[</span><span class="ident" id="2606786">alen</span><span class="op" id="2606790">:</span><span class="op" id="2606791">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2606794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2606797">return</span>&nbsp;<span class="ident" id="2606804">attrs</span><span class="op" id="2606809">,</span>&nbsp;<span class="ident" id="2606811">nil</span><br>
<span class="lineno">170</span><span class="op" id="2606815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2606818">func</span>&nbsp;<span class="ident" id="2606823">netlinkRouteAttrAndValue</span><span class="op" id="2606847">(</span><span class="ident" id="2606848">b</span>&nbsp;<span class="op" id="2606850">[</span><span class="op" id="2606851">]</span><span class="builtintype" id="2606852">byte</span><span class="op" id="2606856">)</span>&nbsp;<span class="op" id="2606858">(</span><span class="op" id="2606859">*</span><span class="ident" id="2606860">RtAttr</span><span class="op" id="2606866">,</span>&nbsp;<span class="op" id="2606868">[</span><span class="op" id="2606869">]</span><span class="builtintype" id="2606870">byte</span><span class="op" id="2606874">,</span>&nbsp;<span class="builtintype" id="2606876">int</span><span class="op" id="2606879">,</span>&nbsp;<span class="builtintype" id="2606881">error</span><span class="op" id="2606886">)</span>&nbsp;<span class="op" id="2606888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2606891">a</span>&nbsp;<span class="op" id="2606893">:=</span>&nbsp;<span class="op" id="2606896">(</span><span class="op" id="2606897">*</span><span class="ident" id="2606898">RtAttr</span><span class="op" id="2606904">)</span><span class="op" id="2606905">(</span><span class="ident" id="2606906">unsafe</span><span class="op" id="2606912">.</span><span class="ident" id="2606913">Pointer</span><span class="op" id="2606920">(</span><span class="op" id="2606921">&amp;</span><span class="ident" id="2606922">b</span><span class="op" id="2606923">[</span><span class="num" id="2606924">0</span><span class="op" id="2606925">]</span><span class="op" id="2606926">)</span><span class="op" id="2606927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2606930">if</span>&nbsp;<span class="builtintype" id="2606933">int</span><span class="op" id="2606936">(</span><span class="ident" id="2606937">a</span><span class="op" id="2606938">.</span><span class="ident" id="2606939">Len</span><span class="op" id="2606942">)</span>&nbsp;<span class="op" id="2606944">&lt;</span>&nbsp;<span class="ident" id="2606946">SizeofRtAttr</span>&nbsp;<span class="op" id="2606959">||</span>&nbsp;<span class="builtintype" id="2606962">int</span><span class="op" id="2606965">(</span><span class="ident" id="2606966">a</span><span class="op" id="2606967">.</span><span class="ident" id="2606968">Len</span><span class="op" id="2606971">)</span>&nbsp;<span class="op" id="2606973">&gt;</span>&nbsp;<span class="builtinfunc" id="2606975">len</span><span class="op" id="2606978">(</span><span class="ident" id="2606979">b</span><span class="op" id="2606980">)</span>&nbsp;<span class="op" id="2606982">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2606986">return</span>&nbsp;<span class="ident" id="2606993">nil</span><span class="op" id="2606996">,</span>&nbsp;<span class="ident" id="2606998">nil</span><span class="op" id="2607001">,</span>&nbsp;<span class="num" id="2607003">0</span><span class="op" id="2607004">,</span>&nbsp;<span class="ident" id="2607006">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2607014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2607017">return</span>&nbsp;<span class="ident" id="2607024">a</span><span class="op" id="2607025">,</span>&nbsp;<span class="ident" id="2607027">b</span><span class="op" id="2607028">[</span><span class="ident" id="2607029">SizeofRtAttr</span><span class="op" id="2607041">:</span><span class="op" id="2607042">]</span><span class="op" id="2607043">,</span>&nbsp;<span class="ident" id="2607045">rtaAlignOf</span><span class="op" id="2607055">(</span><span class="builtintype" id="2607056">int</span><span class="op" id="2607059">(</span><span class="ident" id="2607060">a</span><span class="op" id="2607061">.</span><span class="ident" id="2607062">Len</span><span class="op" id="2607065">)</span><span class="op" id="2607066">)</span><span class="op" id="2607067">,</span>&nbsp;<span class="ident" id="2607069">nil</span><br>
<span class="lineno"></span><span class="op" id="2607073">}</span>
</div>
</body>
</html>
