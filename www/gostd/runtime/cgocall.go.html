<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1471610">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1471666">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1471720">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1471771">//&nbsp;Cgo&nbsp;call&nbsp;and&nbsp;callback&nbsp;support.</span><br>
<span class="lineno"></span><span class="comment" id="1471805">//</span><br>
<span class="lineno"></span><span class="comment" id="1471808">//&nbsp;To&nbsp;call&nbsp;into&nbsp;the&nbsp;C&nbsp;function&nbsp;f&nbsp;from&nbsp;Go,&nbsp;the&nbsp;cgo-generated&nbsp;code&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1471879">//&nbsp;runtime.cgocall(_cgo_Cfunc_f,&nbsp;frame),&nbsp;where&nbsp;_cgo_Cfunc_f&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1471944">//&nbsp;gcc-compiled&nbsp;function&nbsp;written&nbsp;by&nbsp;cgo.</span><br>
<span class="lineno">10</span><span class="comment" id="1471985">//</span><br>
<span class="lineno"></span><span class="comment" id="1471988">//&nbsp;runtime.cgocall&nbsp;(below)&nbsp;locks&nbsp;g&nbsp;to&nbsp;m,&nbsp;calls&nbsp;entersyscall</span><br>
<span class="lineno"></span><span class="comment" id="1472048">//&nbsp;so&nbsp;as&nbsp;not&nbsp;to&nbsp;block&nbsp;other&nbsp;goroutines&nbsp;or&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span><span class="comment" id="1472113">//&nbsp;and&nbsp;then&nbsp;calls&nbsp;runtime.asmcgocall(_cgo_Cfunc_f,&nbsp;frame).</span><br>
<span class="lineno"></span><span class="comment" id="1472172">//</span><br>
<span class="lineno">15</span><span class="comment" id="1472175">//&nbsp;runtime.asmcgocall&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;to&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1472244">//&nbsp;(assumed&nbsp;to&nbsp;be&nbsp;an&nbsp;operating&nbsp;system-allocated&nbsp;stack,&nbsp;so&nbsp;safe&nbsp;to&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="1472314">//&nbsp;gcc-compiled&nbsp;code&nbsp;on)&nbsp;and&nbsp;calls&nbsp;_cgo_Cfunc_f(frame).</span><br>
<span class="lineno"></span><span class="comment" id="1472370">//</span><br>
<span class="lineno"></span><span class="comment" id="1472373">//&nbsp;_cgo_Cfunc_f&nbsp;invokes&nbsp;the&nbsp;actual&nbsp;C&nbsp;function&nbsp;f&nbsp;with&nbsp;arguments</span><br>
<span class="lineno">20</span><span class="comment" id="1472436">//&nbsp;taken&nbsp;from&nbsp;the&nbsp;frame&nbsp;structure,&nbsp;records&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;frame,</span><br>
<span class="lineno"></span><span class="comment" id="1472505">//&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.asmcgocall.</span><br>
<span class="lineno"></span><span class="comment" id="1472543">//</span><br>
<span class="lineno"></span><span class="comment" id="1472546">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.asmcgocall&nbsp;switches&nbsp;back&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1472615">//&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocall.</span><br>
<span class="lineno">25</span><span class="comment" id="1472679">//</span><br>
<span class="lineno"></span><span class="comment" id="1472682">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocall&nbsp;calls&nbsp;exitsyscall,&nbsp;which&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="1472759">//&nbsp;until&nbsp;this&nbsp;m&nbsp;can&nbsp;run&nbsp;Go&nbsp;code&nbsp;without&nbsp;violating&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit,</span><br>
<span class="lineno"></span><span class="comment" id="1472832">//&nbsp;and&nbsp;then&nbsp;unlocks&nbsp;g&nbsp;from&nbsp;m.</span><br>
<span class="lineno"></span><span class="comment" id="1472862">//</span><br>
<span class="lineno">30</span><span class="comment" id="1472865">//&nbsp;The&nbsp;above&nbsp;description&nbsp;skipped&nbsp;over&nbsp;the&nbsp;possibility&nbsp;of&nbsp;the&nbsp;gcc-compiled</span><br>
<span class="lineno"></span><span class="comment" id="1472939">//&nbsp;function&nbsp;f&nbsp;calling&nbsp;back&nbsp;into&nbsp;Go.&nbsp;&nbsp;If&nbsp;that&nbsp;happens,&nbsp;we&nbsp;continue&nbsp;down</span><br>
<span class="lineno"></span><span class="comment" id="1473010">//&nbsp;the&nbsp;rabbit&nbsp;hole&nbsp;during&nbsp;the&nbsp;execution&nbsp;of&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="1473056">//</span><br>
<span class="lineno"></span><span class="comment" id="1473059">//&nbsp;To&nbsp;make&nbsp;it&nbsp;possible&nbsp;for&nbsp;gcc-compiled&nbsp;C&nbsp;code&nbsp;to&nbsp;call&nbsp;a&nbsp;Go&nbsp;function&nbsp;p.GoF,</span><br>
<span class="lineno">35</span><span class="comment" id="1473135">//&nbsp;cgo&nbsp;writes&nbsp;a&nbsp;gcc-compiled&nbsp;function&nbsp;named&nbsp;GoF&nbsp;(not&nbsp;p.GoF,&nbsp;since&nbsp;gcc&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="1473213">//&nbsp;know&nbsp;about&nbsp;packages).&nbsp;&nbsp;The&nbsp;gcc-compiled&nbsp;C&nbsp;function&nbsp;f&nbsp;calls&nbsp;GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1473280">//</span><br>
<span class="lineno"></span><span class="comment" id="1473283">//&nbsp;GoF&nbsp;calls&nbsp;crosscall2(_cgoexp_GoF,&nbsp;frame,&nbsp;framesize).&nbsp;&nbsp;Crosscall2</span><br>
<span class="lineno"></span><span class="comment" id="1473351">//&nbsp;(in&nbsp;cgo/gcc_$GOARCH.S,&nbsp;a&nbsp;gcc-compiled&nbsp;assembly&nbsp;file)&nbsp;is&nbsp;a&nbsp;two-argument</span><br>
<span class="lineno">40</span><span class="comment" id="1473425">//&nbsp;adapter&nbsp;from&nbsp;the&nbsp;gcc&nbsp;function&nbsp;call&nbsp;ABI&nbsp;to&nbsp;the&nbsp;6c&nbsp;function&nbsp;call&nbsp;ABI.</span><br>
<span class="lineno"></span><span class="comment" id="1473496">//&nbsp;It&nbsp;is&nbsp;called&nbsp;from&nbsp;gcc&nbsp;to&nbsp;call&nbsp;6c&nbsp;functions.&nbsp;&nbsp;In&nbsp;this&nbsp;case&nbsp;it&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1473566">//&nbsp;_cgoexp_GoF(frame,&nbsp;framesize),&nbsp;still&nbsp;running&nbsp;on&nbsp;m-&gt;g0&#39;s&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1473631">//&nbsp;and&nbsp;outside&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit.&nbsp;&nbsp;Thus,&nbsp;this&nbsp;code&nbsp;cannot&nbsp;yet</span><br>
<span class="lineno"></span><span class="comment" id="1473697">//&nbsp;call&nbsp;arbitrary&nbsp;Go&nbsp;code&nbsp;directly&nbsp;and&nbsp;must&nbsp;be&nbsp;careful&nbsp;not&nbsp;to&nbsp;allocate</span><br>
<span class="lineno">45</span><span class="comment" id="1473768">//&nbsp;memory&nbsp;or&nbsp;use&nbsp;up&nbsp;m-&gt;g0&#39;s&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1473803">//</span><br>
<span class="lineno"></span><span class="comment" id="1473806">//&nbsp;_cgoexp_GoF&nbsp;calls&nbsp;runtime.cgocallback(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1473873">//&nbsp;(The&nbsp;reason&nbsp;for&nbsp;having&nbsp;_cgoexp_GoF&nbsp;instead&nbsp;of&nbsp;writing&nbsp;a&nbsp;crosscall3</span><br>
<span class="lineno"></span><span class="comment" id="1473943">//&nbsp;to&nbsp;make&nbsp;this&nbsp;call&nbsp;directly&nbsp;is&nbsp;that&nbsp;_cgoexp_GoF,&nbsp;because&nbsp;it&nbsp;is&nbsp;compiled</span><br>
<span class="lineno">50</span><span class="comment" id="1474017">//&nbsp;with&nbsp;6c&nbsp;instead&nbsp;of&nbsp;gcc,&nbsp;can&nbsp;refer&nbsp;to&nbsp;dotted&nbsp;names&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="1474075">//&nbsp;runtime.cgocallback&nbsp;and&nbsp;p.GoF.)</span><br>
<span class="lineno"></span><span class="comment" id="1474110">//</span><br>
<span class="lineno"></span><span class="comment" id="1474113">//&nbsp;runtime.cgocallback&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;from&nbsp;m-&gt;g0&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1474177">//&nbsp;stack&nbsp;to&nbsp;the&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack,&nbsp;on&nbsp;which&nbsp;it&nbsp;calls</span><br>
<span class="lineno">55</span><span class="comment" id="1474241">//&nbsp;runtime.cgocallbackg(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1474291">//&nbsp;As&nbsp;part&nbsp;of&nbsp;the&nbsp;stack&nbsp;switch,&nbsp;runtime.cgocallback&nbsp;saves&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="1474361">//&nbsp;SP&nbsp;as&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;so&nbsp;that&nbsp;any&nbsp;use&nbsp;of&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1474431">//&nbsp;execution&nbsp;of&nbsp;the&nbsp;callback&nbsp;will&nbsp;be&nbsp;done&nbsp;below&nbsp;the&nbsp;existing&nbsp;stack&nbsp;frames.</span><br>
<span class="lineno"></span><span class="comment" id="1474506">//&nbsp;Before&nbsp;overwriting&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;it&nbsp;pushes&nbsp;the&nbsp;old&nbsp;value&nbsp;on&nbsp;the</span><br>
<span class="lineno">60</span><span class="comment" id="1474576">//&nbsp;m-&gt;g0&nbsp;stack,&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;restored&nbsp;later.</span><br>
<span class="lineno"></span><span class="comment" id="1474626">//</span><br>
<span class="lineno"></span><span class="comment" id="1474629">//&nbsp;runtime.cgocallbackg&nbsp;(below)&nbsp;is&nbsp;now&nbsp;running&nbsp;on&nbsp;a&nbsp;real&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1474696">//&nbsp;stack&nbsp;(not&nbsp;an&nbsp;m-&gt;g0&nbsp;stack).&nbsp;&nbsp;First&nbsp;it&nbsp;calls&nbsp;runtime.exitsyscall,&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="1474775">//&nbsp;block&nbsp;until&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit&nbsp;allows&nbsp;running&nbsp;this&nbsp;goroutine.</span><br>
<span class="lineno">65</span><span class="comment" id="1474843">//&nbsp;Once&nbsp;exitsyscall&nbsp;has&nbsp;returned,&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;do&nbsp;things&nbsp;like&nbsp;call&nbsp;the&nbsp;memory</span><br>
<span class="lineno"></span><span class="comment" id="1474922">//&nbsp;allocator&nbsp;or&nbsp;invoke&nbsp;the&nbsp;Go&nbsp;callback&nbsp;function&nbsp;p.GoF.&nbsp;&nbsp;runtime.cgocallbackg</span><br>
<span class="lineno"></span><span class="comment" id="1474999">//&nbsp;first&nbsp;defers&nbsp;a&nbsp;function&nbsp;to&nbsp;unwind&nbsp;m-&gt;g0.sched.sp,&nbsp;so&nbsp;that&nbsp;if&nbsp;p.GoF</span><br>
<span class="lineno"></span><span class="comment" id="1475069">//&nbsp;panics,&nbsp;m-&gt;g0.sched.sp&nbsp;will&nbsp;be&nbsp;restored&nbsp;to&nbsp;its&nbsp;old&nbsp;value:&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1475146">//&nbsp;and&nbsp;the&nbsp;m-&gt;curg&nbsp;stack&nbsp;will&nbsp;be&nbsp;unwound&nbsp;in&nbsp;lock&nbsp;step.</span><br>
<span class="lineno">70</span><span class="comment" id="1475201">//&nbsp;Then&nbsp;it&nbsp;calls&nbsp;p.GoF.&nbsp;&nbsp;Finally&nbsp;it&nbsp;pops&nbsp;but&nbsp;does&nbsp;not&nbsp;execute&nbsp;the&nbsp;deferred</span><br>
<span class="lineno"></span><span class="comment" id="1475276">//&nbsp;function,&nbsp;calls&nbsp;runtime.entersyscall,&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocallback.</span><br>
<span class="lineno"></span><span class="comment" id="1475353">//</span><br>
<span class="lineno"></span><span class="comment" id="1475356">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocallback&nbsp;switches&nbsp;back&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1475422">//&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;(the&nbsp;pointer&nbsp;is&nbsp;still&nbsp;in&nbsp;m-&gt;g0.sched.sp),&nbsp;restores&nbsp;the&nbsp;old</span><br>
<span class="lineno">75</span><span class="comment" id="1475498">//&nbsp;m-&gt;g0.sched.sp&nbsp;value&nbsp;from&nbsp;the&nbsp;stack,&nbsp;and&nbsp;returns&nbsp;to&nbsp;_cgoexp_GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1475566">//</span><br>
<span class="lineno"></span><span class="comment" id="1475569">//&nbsp;_cgoexp_GoF&nbsp;immediately&nbsp;returns&nbsp;to&nbsp;crosscall2,&nbsp;which&nbsp;restores&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1475638">//&nbsp;callee-save&nbsp;registers&nbsp;for&nbsp;gcc&nbsp;and&nbsp;returns&nbsp;to&nbsp;GoF,&nbsp;which&nbsp;returns&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="1475712">package</span>&nbsp;<span class="ident" id="1475720">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1475729">import</span>&nbsp;<span class="string" id="1475736">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1475746">//&nbsp;Call&nbsp;from&nbsp;Go&nbsp;to&nbsp;C.</span><br>
<span class="lineno">85</span><span class="comment" id="1475768">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1475781">func</span>&nbsp;<span class="ident" id="1475786">cgocall</span><span class="op" id="1475793">(</span><span class="ident" id="1475794">fn</span><span class="op" id="1475796">,</span>&nbsp;<span class="ident" id="1475798">arg</span>&nbsp;<span class="ident" id="1475802">unsafe</span><span class="op" id="1475808">.</span><span class="ident" id="1475809">Pointer</span><span class="op" id="1475816">)</span>&nbsp;<span class="op" id="1475818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1475821">cgocall_errno</span><span class="op" id="1475834">(</span><span class="ident" id="1475835">fn</span><span class="op" id="1475837">,</span>&nbsp;<span class="ident" id="1475839">arg</span><span class="op" id="1475842">)</span><br>
<span class="lineno"></span><span class="op" id="1475844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="1475847">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1475860">func</span>&nbsp;<span class="ident" id="1475865">cgocall_errno</span><span class="op" id="1475878">(</span><span class="ident" id="1475879">fn</span><span class="op" id="1475881">,</span>&nbsp;<span class="ident" id="1475883">arg</span>&nbsp;<span class="ident" id="1475887">unsafe</span><span class="op" id="1475893">.</span><span class="ident" id="1475894">Pointer</span><span class="op" id="1475901">)</span>&nbsp;<span class="builtintype" id="1475903">int32</span>&nbsp;<span class="op" id="1475909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1475912">if</span>&nbsp;<span class="op" id="1475915">!</span><span class="ident" id="1475916">iscgo</span>&nbsp;<span class="op" id="1475922">&amp;&amp;</span>&nbsp;<span class="ident" id="1475925">GOOS</span>&nbsp;<span class="op" id="1475930">!=</span>&nbsp;<span class="string" id="1475933">&#34;solaris&#34;</span>&nbsp;<span class="op" id="1475943">&amp;&amp;</span>&nbsp;<span class="ident" id="1475946">GOOS</span>&nbsp;<span class="op" id="1475951">!=</span>&nbsp;<span class="string" id="1475954">&#34;windows&#34;</span>&nbsp;<span class="op" id="1475964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1475968">gothrow</span><span class="op" id="1475975">(</span><span class="string" id="1475976">&#34;cgocall&nbsp;unavailable&#34;</span><span class="op" id="1475997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1476000">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1476004">if</span>&nbsp;<span class="ident" id="1476007">fn</span>&nbsp;<span class="op" id="1476010">==</span>&nbsp;<span class="ident" id="1476013">nil</span>&nbsp;<span class="op" id="1476017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1476021">gothrow</span><span class="op" id="1476028">(</span><span class="string" id="1476029">&#34;cgocall&nbsp;nil&#34;</span><span class="op" id="1476042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1476045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1476049">if</span>&nbsp;<span class="ident" id="1476052">raceenabled</span>&nbsp;<span class="op" id="1476064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1476068">racereleasemerge</span><span class="op" id="1476084">(</span><span class="ident" id="1476085">unsafe</span><span class="op" id="1476091">.</span><span class="ident" id="1476092">Pointer</span><span class="op" id="1476099">(</span><span class="op" id="1476100">&amp;</span><span class="ident" id="1476101">racecgosync</span><span class="op" id="1476112">)</span><span class="op" id="1476113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1476116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1476120">//&nbsp;Create&nbsp;an&nbsp;extra&nbsp;M&nbsp;for&nbsp;callbacks&nbsp;on&nbsp;threads&nbsp;not&nbsp;created&nbsp;by&nbsp;Go&nbsp;on&nbsp;first&nbsp;cgo&nbsp;call.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1476204">if</span>&nbsp;<span class="ident" id="1476207">needextram</span>&nbsp;<span class="op" id="1476218">==</span>&nbsp;<span class="num" id="1476221">1</span>&nbsp;<span class="op" id="1476223">&amp;&amp;</span>&nbsp;<span class="ident" id="1476226">cas</span><span class="op" id="1476229">(</span><span class="op" id="1476230">&amp;</span><span class="ident" id="1476231">needextram</span><span class="op" id="1476241">,</span>&nbsp;<span class="num" id="1476243">1</span><span class="op" id="1476244">,</span>&nbsp;<span class="num" id="1476246">0</span><span class="op" id="1476247">)</span>&nbsp;<span class="op" id="1476249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1476253">onM</span><span class="op" id="1476256">(</span><span class="ident" id="1476257">newextram</span><span class="op" id="1476266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1476269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1476273">/*<br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Lock&nbsp;g&nbsp;to&nbsp;m&nbsp;to&nbsp;ensure&nbsp;we&nbsp;stay&nbsp;on&nbsp;the&nbsp;same&nbsp;stack&nbsp;if&nbsp;we&nbsp;do&nbsp;a<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;cgo&nbsp;callback.&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1476406">lockOSThread</span><span class="op" id="1476418">(</span><span class="op" id="1476419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1476422">mp</span>&nbsp;<span class="op" id="1476425">:=</span>&nbsp;<span class="ident" id="1476428">getg</span><span class="op" id="1476432">(</span><span class="op" id="1476433">)</span><span class="op" id="1476434">.</span><span class="ident" id="1476435">m</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1476438">mp</span><span class="op" id="1476440">.</span><span class="ident" id="1476441">ncgocall</span><span class="op" id="1476449">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1476453">mp</span><span class="op" id="1476455">.</span><span class="ident" id="1476456">ncgo</span><span class="op" id="1476460">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1476464">defer</span>&nbsp;<span class="ident" id="1476470">endcgo</span><span class="op" id="1476476">(</span><span class="ident" id="1476477">mp</span><span class="op" id="1476479">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1476483">/*<br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Announce&nbsp;we&nbsp;are&nbsp;entering&nbsp;a&nbsp;system&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;so&nbsp;that&nbsp;the&nbsp;scheduler&nbsp;knows&nbsp;to&nbsp;create&nbsp;another<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;M&nbsp;to&nbsp;run&nbsp;goroutines&nbsp;while&nbsp;we&nbsp;are&nbsp;in&nbsp;the<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;foreign&nbsp;code.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;The&nbsp;call&nbsp;to&nbsp;asmcgocall&nbsp;is&nbsp;guaranteed&nbsp;not&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;split&nbsp;the&nbsp;stack&nbsp;and&nbsp;does&nbsp;not&nbsp;allocate&nbsp;memory,<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;so&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;while&nbsp;&#34;in&nbsp;a&nbsp;system&nbsp;call&#34;,&nbsp;outside<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;the&nbsp;$GOMAXPROCS&nbsp;accounting.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1476841">entersyscall</span><span class="op" id="1476853">(</span><span class="op" id="1476854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1476857">errno</span>&nbsp;<span class="op" id="1476863">:=</span>&nbsp;<span class="ident" id="1476866">asmcgocall_errno</span><span class="op" id="1476882">(</span><span class="ident" id="1476883">fn</span><span class="op" id="1476885">,</span>&nbsp;<span class="ident" id="1476887">arg</span><span class="op" id="1476890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1476893">exitsyscall</span><span class="op" id="1476904">(</span><span class="op" id="1476905">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1476909">return</span>&nbsp;<span class="ident" id="1476916">errno</span><br>
<span class="lineno">135</span><span class="op" id="1476922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1476925">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1476938">func</span>&nbsp;<span class="ident" id="1476943">endcgo</span><span class="op" id="1476949">(</span><span class="ident" id="1476950">mp</span>&nbsp;<span class="op" id="1476953">*</span><span class="ident" id="1476954">m</span><span class="op" id="1476955">)</span>&nbsp;<span class="op" id="1476957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1476960">mp</span><span class="op" id="1476962">.</span><span class="ident" id="1476963">ncgo</span><span class="op" id="1476967">--</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1476971">if</span>&nbsp;<span class="ident" id="1476974">mp</span><span class="op" id="1476976">.</span><span class="ident" id="1476977">ncgo</span>&nbsp;<span class="op" id="1476982">==</span>&nbsp;<span class="num" id="1476985">0</span>&nbsp;<span class="op" id="1476987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1476991">//&nbsp;We&nbsp;are&nbsp;going&nbsp;back&nbsp;to&nbsp;Go&nbsp;and&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;recursive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1477047">//&nbsp;call.&nbsp;&nbsp;Let&nbsp;the&nbsp;GC&nbsp;collect&nbsp;any&nbsp;memory&nbsp;allocated&nbsp;via</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1477103">//&nbsp;_cgo_allocate&nbsp;that&nbsp;is&nbsp;no&nbsp;longer&nbsp;referenced.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1477152">mp</span><span class="op" id="1477154">.</span><span class="ident" id="1477155">cgomal</span>&nbsp;<span class="op" id="1477162">=</span>&nbsp;<span class="ident" id="1477164">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1477169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1477173">if</span>&nbsp;<span class="ident" id="1477176">raceenabled</span>&nbsp;<span class="op" id="1477188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1477192">raceacquire</span><span class="op" id="1477203">(</span><span class="ident" id="1477204">unsafe</span><span class="op" id="1477210">.</span><span class="ident" id="1477211">Pointer</span><span class="op" id="1477218">(</span><span class="op" id="1477219">&amp;</span><span class="ident" id="1477220">racecgosync</span><span class="op" id="1477231">)</span><span class="op" id="1477232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1477235">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1477239">unlockOSThread</span><span class="op" id="1477253">(</span><span class="op" id="1477254">)</span>&nbsp;<span class="comment" id="1477256">//&nbsp;invalidates&nbsp;mp</span><br>
<span class="lineno"></span><span class="op" id="1477274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1477277">//&nbsp;Helper&nbsp;functions&nbsp;for&nbsp;cgo&nbsp;code.</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="1477312">//&nbsp;Filled&nbsp;by&nbsp;schedinit&nbsp;from&nbsp;corresponding&nbsp;C&nbsp;variables,</span><br>
<span class="lineno"></span><span class="comment" id="1477367">//&nbsp;which&nbsp;are&nbsp;in&nbsp;turn&nbsp;filled&nbsp;in&nbsp;by&nbsp;dynamic&nbsp;linker&nbsp;when&nbsp;Cgo&nbsp;is&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="1477439">var</span>&nbsp;<span class="ident" id="1477443">cgoMalloc</span><span class="op" id="1477452">,</span>&nbsp;<span class="ident" id="1477454">cgoFree</span>&nbsp;<span class="ident" id="1477462">unsafe</span><span class="op" id="1477468">.</span><span class="ident" id="1477469">Pointer</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="keyword" id="1477478">func</span>&nbsp;<span class="ident" id="1477483">cmalloc</span><span class="op" id="1477490">(</span><span class="ident" id="1477491">n</span>&nbsp;<span class="builtintype" id="1477493">uintptr</span><span class="op" id="1477500">)</span>&nbsp;<span class="ident" id="1477502">unsafe</span><span class="op" id="1477508">.</span><span class="ident" id="1477509">Pointer</span>&nbsp;<span class="op" id="1477517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1477520">var</span>&nbsp;<span class="ident" id="1477524">args</span>&nbsp;<span class="keyword" id="1477529">struct</span>&nbsp;<span class="op" id="1477536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1477540">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1477544">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1477553">ret</span>&nbsp;<span class="ident" id="1477557">unsafe</span><span class="op" id="1477563">.</span><span class="ident" id="1477564">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1477573">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1477576">args</span><span class="op" id="1477580">.</span><span class="ident" id="1477581">n</span>&nbsp;<span class="op" id="1477583">=</span>&nbsp;<span class="ident" id="1477585">uint64</span><span class="op" id="1477591">(</span><span class="ident" id="1477592">n</span><span class="op" id="1477593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1477596">cgocall</span><span class="op" id="1477603">(</span><span class="ident" id="1477604">cgoMalloc</span><span class="op" id="1477613">,</span>&nbsp;<span class="ident" id="1477615">unsafe</span><span class="op" id="1477621">.</span><span class="ident" id="1477622">Pointer</span><span class="op" id="1477629">(</span><span class="op" id="1477630">&amp;</span><span class="ident" id="1477631">args</span><span class="op" id="1477635">)</span><span class="op" id="1477636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1477639">if</span>&nbsp;<span class="ident" id="1477642">args</span><span class="op" id="1477646">.</span><span class="ident" id="1477647">ret</span>&nbsp;<span class="op" id="1477651">==</span>&nbsp;<span class="ident" id="1477654">nil</span>&nbsp;<span class="op" id="1477658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1477662">gothrow</span><span class="op" id="1477669">(</span><span class="string" id="1477670">&#34;C&nbsp;malloc&nbsp;failed&#34;</span><span class="op" id="1477687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1477690">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1477693">return</span>&nbsp;<span class="ident" id="1477700">args</span><span class="op" id="1477704">.</span><span class="ident" id="1477705">ret</span><br>
<span class="lineno"></span><span class="op" id="1477709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1477712">func</span>&nbsp;<span class="ident" id="1477717">cfree</span><span class="op" id="1477722">(</span><span class="ident" id="1477723">p</span>&nbsp;<span class="ident" id="1477725">unsafe</span><span class="op" id="1477731">.</span><span class="ident" id="1477732">Pointer</span><span class="op" id="1477739">)</span>&nbsp;<span class="op" id="1477741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1477744">cgocall</span><span class="op" id="1477751">(</span><span class="ident" id="1477752">cgoFree</span><span class="op" id="1477759">,</span>&nbsp;<span class="ident" id="1477761">p</span><span class="op" id="1477762">)</span><br>
<span class="lineno">175</span><span class="op" id="1477764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1477767">//&nbsp;Call&nbsp;from&nbsp;C&nbsp;back&nbsp;to&nbsp;Go.</span><br>
<span class="lineno"></span><span class="comment" id="1477794">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1477807">func</span>&nbsp;<span class="ident" id="1477812">cgocallbackg</span><span class="op" id="1477824">(</span><span class="op" id="1477825">)</span>&nbsp;<span class="op" id="1477827">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1477830">gp</span>&nbsp;<span class="op" id="1477833">:=</span>&nbsp;<span class="ident" id="1477836">getg</span><span class="op" id="1477840">(</span><span class="op" id="1477841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1477844">if</span>&nbsp;<span class="ident" id="1477847">gp</span>&nbsp;<span class="op" id="1477850">!=</span>&nbsp;<span class="ident" id="1477853">gp</span><span class="op" id="1477855">.</span><span class="ident" id="1477856">m</span><span class="op" id="1477857">.</span><span class="ident" id="1477858">curg</span>&nbsp;<span class="op" id="1477863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1477867">println</span><span class="op" id="1477874">(</span><span class="string" id="1477875">&#34;runtime:&nbsp;bad&nbsp;g&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1477906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1477910">exit</span><span class="op" id="1477914">(</span><span class="num" id="1477915">2</span><span class="op" id="1477916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1477919">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1477923">//&nbsp;entersyscall&nbsp;saves&nbsp;the&nbsp;caller&#39;s&nbsp;SP&nbsp;to&nbsp;allow&nbsp;the&nbsp;GC&nbsp;to&nbsp;trace&nbsp;the&nbsp;Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1477994">//&nbsp;stack.&nbsp;However,&nbsp;since&nbsp;we&#39;re&nbsp;returning&nbsp;to&nbsp;an&nbsp;earlier&nbsp;stack&nbsp;frame&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1478066">//&nbsp;need&nbsp;to&nbsp;pair&nbsp;with&nbsp;the&nbsp;entersyscall()&nbsp;call&nbsp;made&nbsp;by&nbsp;cgocall,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1478137">//&nbsp;save&nbsp;syscall*&nbsp;and&nbsp;let&nbsp;reentersyscall&nbsp;restore&nbsp;them.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1478192">savedsp</span>&nbsp;<span class="op" id="1478200">:=</span>&nbsp;<span class="ident" id="1478203">unsafe</span><span class="op" id="1478209">.</span><span class="ident" id="1478210">Pointer</span><span class="op" id="1478217">(</span><span class="ident" id="1478218">gp</span><span class="op" id="1478220">.</span><span class="ident" id="1478221">syscallsp</span><span class="op" id="1478230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1478233">savedpc</span>&nbsp;<span class="op" id="1478241">:=</span>&nbsp;<span class="ident" id="1478244">gp</span><span class="op" id="1478246">.</span><span class="ident" id="1478247">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1478258">exitsyscall</span><span class="op" id="1478269">(</span><span class="op" id="1478270">)</span>&nbsp;<span class="comment" id="1478272">//&nbsp;coming&nbsp;out&nbsp;of&nbsp;cgo&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1478299">cgocallbackg1</span><span class="op" id="1478312">(</span><span class="op" id="1478313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1478316">//&nbsp;going&nbsp;back&nbsp;to&nbsp;cgo&nbsp;call</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1478343">reentersyscall</span><span class="op" id="1478357">(</span><span class="ident" id="1478358">savedpc</span><span class="op" id="1478365">,</span>&nbsp;<span class="ident" id="1478367">savedsp</span><span class="op" id="1478374">)</span><br>
<span class="lineno"></span><span class="op" id="1478376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1478379">func</span>&nbsp;<span class="ident" id="1478384">cgocallbackg1</span><span class="op" id="1478397">(</span><span class="op" id="1478398">)</span>&nbsp;<span class="op" id="1478400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1478403">gp</span>&nbsp;<span class="op" id="1478406">:=</span>&nbsp;<span class="ident" id="1478409">getg</span><span class="op" id="1478413">(</span><span class="op" id="1478414">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1478417">if</span>&nbsp;<span class="ident" id="1478420">gp</span><span class="op" id="1478422">.</span><span class="ident" id="1478423">m</span><span class="op" id="1478424">.</span><span class="ident" id="1478425">needextram</span>&nbsp;<span class="op" id="1478436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1478440">gp</span><span class="op" id="1478442">.</span><span class="ident" id="1478443">m</span><span class="op" id="1478444">.</span><span class="ident" id="1478445">needextram</span>&nbsp;<span class="op" id="1478456">=</span>&nbsp;<span class="builtintype" id="1478458">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1478466">onM</span><span class="op" id="1478469">(</span><span class="ident" id="1478470">newextram</span><span class="op" id="1478479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1478482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1478486">//&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1478533">restore</span>&nbsp;<span class="op" id="1478541">:=</span>&nbsp;<span class="builtintype" id="1478544">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1478550">defer</span>&nbsp;<span class="ident" id="1478556">unwindm</span><span class="op" id="1478563">(</span><span class="op" id="1478564">&amp;</span><span class="ident" id="1478565">restore</span><span class="op" id="1478572">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1478576">if</span>&nbsp;<span class="ident" id="1478579">raceenabled</span>&nbsp;<span class="op" id="1478591">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1478595">raceacquire</span><span class="op" id="1478606">(</span><span class="ident" id="1478607">unsafe</span><span class="op" id="1478613">.</span><span class="ident" id="1478614">Pointer</span><span class="op" id="1478621">(</span><span class="op" id="1478622">&amp;</span><span class="ident" id="1478623">racecgosync</span><span class="op" id="1478634">)</span><span class="op" id="1478635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1478638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1478642">type</span>&nbsp;<span class="ident" id="1478647">args</span>&nbsp;<span class="keyword" id="1478652">struct</span>&nbsp;<span class="op" id="1478659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1478663">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1478671">*</span><span class="ident" id="1478672">funcval</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1478682">arg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1478690">unsafe</span><span class="op" id="1478696">.</span><span class="ident" id="1478697">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1478707">argsize</span>&nbsp;<span class="builtintype" id="1478715">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1478724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1478727">var</span>&nbsp;<span class="ident" id="1478731">cb</span>&nbsp;<span class="op" id="1478734">*</span><span class="ident" id="1478735">args</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1478742">//&nbsp;Location&nbsp;of&nbsp;callback&nbsp;arguments&nbsp;depends&nbsp;on&nbsp;stack&nbsp;frame&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1478807">//&nbsp;and&nbsp;size&nbsp;of&nbsp;stack&nbsp;frame&nbsp;of&nbsp;cgocallback_gofunc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1478858">sp</span>&nbsp;<span class="op" id="1478861">:=</span>&nbsp;<span class="ident" id="1478864">gp</span><span class="op" id="1478866">.</span><span class="ident" id="1478867">m</span><span class="op" id="1478868">.</span><span class="ident" id="1478869">g0</span><span class="op" id="1478871">.</span><span class="ident" id="1478872">sched</span><span class="op" id="1478877">.</span><span class="ident" id="1478878">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1478882">switch</span>&nbsp;<span class="ident" id="1478889">GOARCH</span>&nbsp;<span class="op" id="1478896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1478899">default</span><span class="op" id="1478906">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1478910">gothrow</span><span class="op" id="1478917">(</span><span class="string" id="1478918">&#34;cgocallbackg&nbsp;is&nbsp;unimplemented&nbsp;on&nbsp;arch&#34;</span><span class="op" id="1478957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1478960">case</span>&nbsp;<span class="string" id="1478965">&#34;arm&#34;</span><span class="op" id="1478970">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1478974">//&nbsp;On&nbsp;arm,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;two&nbsp;words&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;saved&nbsp;LR&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1479043">//&nbsp;SP&nbsp;and&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;between&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;the&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1479118">cb</span>&nbsp;<span class="op" id="1479121">=</span>&nbsp;<span class="op" id="1479123">(</span><span class="op" id="1479124">*</span><span class="ident" id="1479125">args</span><span class="op" id="1479129">)</span><span class="op" id="1479130">(</span><span class="ident" id="1479131">unsafe</span><span class="op" id="1479137">.</span><span class="ident" id="1479138">Pointer</span><span class="op" id="1479145">(</span><span class="ident" id="1479146">sp</span>&nbsp;<span class="op" id="1479149">+</span>&nbsp;<span class="num" id="1479151">4</span><span class="op" id="1479152">*</span><span class="ident" id="1479153">ptrSize</span><span class="op" id="1479160">)</span><span class="op" id="1479161">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1479164">case</span>&nbsp;<span class="string" id="1479169">&#34;amd64&#34;</span><span class="op" id="1479176">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1479180">//&nbsp;On&nbsp;amd64,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;one&nbsp;word,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1479236">cb</span>&nbsp;<span class="op" id="1479239">=</span>&nbsp;<span class="op" id="1479241">(</span><span class="op" id="1479242">*</span><span class="ident" id="1479243">args</span><span class="op" id="1479247">)</span><span class="op" id="1479248">(</span><span class="ident" id="1479249">unsafe</span><span class="op" id="1479255">.</span><span class="ident" id="1479256">Pointer</span><span class="op" id="1479263">(</span><span class="ident" id="1479264">sp</span>&nbsp;<span class="op" id="1479267">+</span>&nbsp;<span class="num" id="1479269">2</span><span class="op" id="1479270">*</span><span class="ident" id="1479271">ptrSize</span><span class="op" id="1479278">)</span><span class="op" id="1479279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1479282">case</span>&nbsp;<span class="string" id="1479287">&#34;386&#34;</span><span class="op" id="1479292">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1479296">//&nbsp;On&nbsp;386,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;three&nbsp;words,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1479353">cb</span>&nbsp;<span class="op" id="1479356">=</span>&nbsp;<span class="op" id="1479358">(</span><span class="op" id="1479359">*</span><span class="ident" id="1479360">args</span><span class="op" id="1479364">)</span><span class="op" id="1479365">(</span><span class="ident" id="1479366">unsafe</span><span class="op" id="1479372">.</span><span class="ident" id="1479373">Pointer</span><span class="op" id="1479380">(</span><span class="ident" id="1479381">sp</span>&nbsp;<span class="op" id="1479384">+</span>&nbsp;<span class="num" id="1479386">4</span><span class="op" id="1479387">*</span><span class="ident" id="1479388">ptrSize</span><span class="op" id="1479395">)</span><span class="op" id="1479396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1479399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1479403">//&nbsp;Invoke&nbsp;callback.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1479424">reflectcall</span><span class="op" id="1479435">(</span><span class="ident" id="1479436">unsafe</span><span class="op" id="1479442">.</span><span class="ident" id="1479443">Pointer</span><span class="op" id="1479450">(</span><span class="ident" id="1479451">cb</span><span class="op" id="1479453">.</span><span class="ident" id="1479454">fn</span><span class="op" id="1479456">)</span><span class="op" id="1479457">,</span>&nbsp;<span class="ident" id="1479459">unsafe</span><span class="op" id="1479465">.</span><span class="ident" id="1479466">Pointer</span><span class="op" id="1479473">(</span><span class="ident" id="1479474">cb</span><span class="op" id="1479476">.</span><span class="ident" id="1479477">arg</span><span class="op" id="1479480">)</span><span class="op" id="1479481">,</span>&nbsp;<span class="builtintype" id="1479483">uint32</span><span class="op" id="1479489">(</span><span class="ident" id="1479490">cb</span><span class="op" id="1479492">.</span><span class="ident" id="1479493">argsize</span><span class="op" id="1479500">)</span><span class="op" id="1479501">,</span>&nbsp;<span class="num" id="1479503">0</span><span class="op" id="1479504">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1479508">if</span>&nbsp;<span class="ident" id="1479511">raceenabled</span>&nbsp;<span class="op" id="1479523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1479527">racereleasemerge</span><span class="op" id="1479543">(</span><span class="ident" id="1479544">unsafe</span><span class="op" id="1479550">.</span><span class="ident" id="1479551">Pointer</span><span class="op" id="1479558">(</span><span class="op" id="1479559">&amp;</span><span class="ident" id="1479560">racecgosync</span><span class="op" id="1479571">)</span><span class="op" id="1479572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1479575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1479579">//&nbsp;Do&nbsp;not&nbsp;unwind&nbsp;m-&gt;g0-&gt;sched.sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1479614">//&nbsp;Our&nbsp;caller,&nbsp;cgocallback,&nbsp;will&nbsp;do&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1479657">restore</span>&nbsp;<span class="op" id="1479665">=</span>&nbsp;<span class="builtintype" id="1479667">false</span><br>
<span class="lineno"></span><span class="op" id="1479673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="1479676">func</span>&nbsp;<span class="ident" id="1479681">unwindm</span><span class="op" id="1479688">(</span><span class="ident" id="1479689">restore</span>&nbsp;<span class="op" id="1479697">*</span><span class="builtintype" id="1479698">bool</span><span class="op" id="1479702">)</span>&nbsp;<span class="op" id="1479704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1479707">if</span>&nbsp;<span class="op" id="1479710">!</span><span class="op" id="1479711">*</span><span class="ident" id="1479712">restore</span>&nbsp;<span class="op" id="1479720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1479724">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1479732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1479735">//&nbsp;Restore&nbsp;sp&nbsp;saved&nbsp;by&nbsp;cgocallback&nbsp;during</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1479778">//&nbsp;unwind&nbsp;of&nbsp;g&#39;s&nbsp;stack&nbsp;(see&nbsp;comment&nbsp;at&nbsp;top&nbsp;of&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1479832">mp</span>&nbsp;<span class="op" id="1479835">:=</span>&nbsp;<span class="ident" id="1479838">acquirem</span><span class="op" id="1479846">(</span><span class="op" id="1479847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1479850">sched</span>&nbsp;<span class="op" id="1479856">:=</span>&nbsp;<span class="op" id="1479859">&amp;</span><span class="ident" id="1479860">mp</span><span class="op" id="1479862">.</span><span class="ident" id="1479863">g0</span><span class="op" id="1479865">.</span><span class="ident" id="1479866">sched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1479873">switch</span>&nbsp;<span class="ident" id="1479880">GOARCH</span>&nbsp;<span class="op" id="1479887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1479890">default</span><span class="op" id="1479897">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1479901">gothrow</span><span class="op" id="1479908">(</span><span class="string" id="1479909">&#34;unwindm&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1479934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1479937">case</span>&nbsp;<span class="string" id="1479942">&#34;386&#34;</span><span class="op" id="1479947">,</span>&nbsp;<span class="string" id="1479949">&#34;amd64&#34;</span><span class="op" id="1479956">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1479960">sched</span><span class="op" id="1479965">.</span><span class="ident" id="1479966">sp</span>&nbsp;<span class="op" id="1479969">=</span>&nbsp;<span class="op" id="1479971">*</span><span class="op" id="1479972">(</span><span class="op" id="1479973">*</span><span class="builtintype" id="1479974">uintptr</span><span class="op" id="1479981">)</span><span class="op" id="1479982">(</span><span class="ident" id="1479983">unsafe</span><span class="op" id="1479989">.</span><span class="ident" id="1479990">Pointer</span><span class="op" id="1479997">(</span><span class="ident" id="1479998">sched</span><span class="op" id="1480003">.</span><span class="ident" id="1480004">sp</span><span class="op" id="1480006">)</span><span class="op" id="1480007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1480010">case</span>&nbsp;<span class="string" id="1480015">&#34;arm&#34;</span><span class="op" id="1480020">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1480024">sched</span><span class="op" id="1480029">.</span><span class="ident" id="1480030">sp</span>&nbsp;<span class="op" id="1480033">=</span>&nbsp;<span class="op" id="1480035">*</span><span class="op" id="1480036">(</span><span class="op" id="1480037">*</span><span class="builtintype" id="1480038">uintptr</span><span class="op" id="1480045">)</span><span class="op" id="1480046">(</span><span class="ident" id="1480047">unsafe</span><span class="op" id="1480053">.</span><span class="ident" id="1480054">Pointer</span><span class="op" id="1480061">(</span><span class="ident" id="1480062">sched</span><span class="op" id="1480067">.</span><span class="ident" id="1480068">sp</span>&nbsp;<span class="op" id="1480071">+</span>&nbsp;<span class="num" id="1480073">4</span><span class="op" id="1480074">)</span><span class="op" id="1480075">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1480078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1480081">releasem</span><span class="op" id="1480089">(</span><span class="ident" id="1480090">mp</span><span class="op" id="1480092">)</span><br>
<span class="lineno"></span><span class="op" id="1480094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1480097">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno">270</span><span class="keyword" id="1480121">func</span>&nbsp;<span class="ident" id="1480126">badcgocallback</span><span class="op" id="1480140">(</span><span class="op" id="1480141">)</span>&nbsp;<span class="op" id="1480143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1480146">gothrow</span><span class="op" id="1480153">(</span><span class="string" id="1480154">&#34;misaligned&nbsp;stack&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1480187">)</span><br>
<span class="lineno"></span><span class="op" id="1480189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1480192">//&nbsp;called&nbsp;from&nbsp;(incomplete)&nbsp;assembly</span><br>
<span class="lineno">275</span><span class="keyword" id="1480229">func</span>&nbsp;<span class="ident" id="1480234">cgounimpl</span><span class="op" id="1480243">(</span><span class="op" id="1480244">)</span>&nbsp;<span class="op" id="1480246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1480249">gothrow</span><span class="op" id="1480256">(</span><span class="string" id="1480257">&#34;cgo&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1480278">)</span><br>
<span class="lineno"></span><span class="op" id="1480280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1480283">var</span>&nbsp;<span class="ident" id="1480287">racecgosync</span>&nbsp;<span class="ident" id="1480299">uint64</span>&nbsp;<span class="comment" id="1480306">//&nbsp;represents&nbsp;possible&nbsp;synchronization&nbsp;in&nbsp;C&nbsp;code</span>
</div>
</body>
</html>
