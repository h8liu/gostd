<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/zlib</h2>
<ul>
<li><a href="/gostd/compress/zlib/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/compress/zlib/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/zlib/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/zlib/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/compress/zlib/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5978379">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5978434">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5978488">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5978539">package</span>&nbsp;<span class="ident" id="5978547">zlib</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5978553">import</span>&nbsp;<span class="op" id="5978560">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5978563">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5978581">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5978588">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5978596">&#34;hash/adler32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5978612">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5978617">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5978620">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="5978700">//&nbsp;&#34;compress/zlib&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5978766">const</span>&nbsp;<span class="op" id="5978772">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978775">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5978794">=</span>&nbsp;<span class="ident" id="5978796">flate</span><span class="op" id="5978801">.</span><span class="ident" id="5978802">NoCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978817">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5978836">=</span>&nbsp;<span class="ident" id="5978838">flate</span><span class="op" id="5978843">.</span><span class="ident" id="5978844">BestSpeed</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978855">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5978874">=</span>&nbsp;<span class="ident" id="5978876">flate</span><span class="op" id="5978881">.</span><span class="ident" id="5978882">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978899">DefaultCompression</span>&nbsp;<span class="op" id="5978918">=</span>&nbsp;<span class="ident" id="5978920">flate</span><span class="op" id="5978925">.</span><span class="ident" id="5978926">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="5978945">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5978948">//&nbsp;A&nbsp;Writer&nbsp;takes&nbsp;data&nbsp;written&nbsp;to&nbsp;it&nbsp;and&nbsp;writes&nbsp;the&nbsp;compressed</span><br>
<span class="lineno">25</span><span class="comment" id="5979011">//&nbsp;form&nbsp;of&nbsp;that&nbsp;data&nbsp;to&nbsp;an&nbsp;underlying&nbsp;writer&nbsp;(see&nbsp;NewWriter).</span><br>
<span class="lineno"></span><span class="keyword" id="5979073">type</span>&nbsp;<span class="ident" id="5979078">Writer</span>&nbsp;<span class="keyword" id="5979085">struct</span>&nbsp;<span class="op" id="5979092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979095">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979107">io</span><span class="op" id="5979109">.</span><span class="ident" id="5979110">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979118">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5979130">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979135">dict</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5979147">[</span><span class="op" id="5979148">]</span><span class="builtintype" id="5979149">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979155">compressor</span>&nbsp;&nbsp;<span class="op" id="5979167">*</span><span class="ident" id="5979168">flate</span><span class="op" id="5979173">.</span><span class="ident" id="5979174">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979182">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979194">hash</span><span class="op" id="5979198">.</span><span class="ident" id="5979199">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979207">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5979219">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979226">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5979238">[</span><span class="num" id="5979239">4</span><span class="op" id="5979240">]</span><span class="builtintype" id="5979241">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979247">wroteHeader</span>&nbsp;<span class="builtintype" id="5979259">bool</span><br>
<span class="lineno">35</span><span class="op" id="5979264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5979267">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="5979302">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="5979368">//</span><br>
<span class="lineno">40</span><span class="comment" id="5979371">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="5979452">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5979507">func</span>&nbsp;<span class="ident" id="5979512">NewWriter</span><span class="op" id="5979521">(</span><span class="ident" id="5979522">w</span>&nbsp;<span class="ident" id="5979524">io</span><span class="op" id="5979526">.</span><span class="ident" id="5979527">Writer</span><span class="op" id="5979533">)</span>&nbsp;<span class="op" id="5979535">*</span><span class="ident" id="5979536">Writer</span>&nbsp;<span class="op" id="5979543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5979546">z</span><span class="op" id="5979547">,</span>&nbsp;<span class="ident" id="5979549">_</span>&nbsp;<span class="op" id="5979551">:=</span>&nbsp;<span class="ident" id="5979554">NewWriterLevelDict</span><span class="op" id="5979572">(</span><span class="ident" id="5979573">w</span><span class="op" id="5979574">,</span>&nbsp;<span class="ident" id="5979576">DefaultCompression</span><span class="op" id="5979594">,</span>&nbsp;<span class="builtintype" id="5979596">nil</span><span class="op" id="5979599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5979602">return</span>&nbsp;<span class="ident" id="5979609">z</span><br>
<span class="lineno">45</span><span class="op" id="5979611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5979614">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="5979694">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="5979729">//</span><br>
<span class="lineno">50</span><span class="comment" id="5979732">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5979806">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5979882">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5979929">func</span>&nbsp;<span class="ident" id="5979934">NewWriterLevel</span><span class="op" id="5979948">(</span><span class="ident" id="5979949">w</span>&nbsp;<span class="ident" id="5979951">io</span><span class="op" id="5979953">.</span><span class="ident" id="5979954">Writer</span><span class="op" id="5979960">,</span>&nbsp;<span class="ident" id="5979962">level</span>&nbsp;<span class="builtintype" id="5979968">int</span><span class="op" id="5979971">)</span>&nbsp;<span class="op" id="5979973">(</span><span class="op" id="5979974">*</span><span class="ident" id="5979975">Writer</span><span class="op" id="5979981">,</span>&nbsp;<span class="builtintype" id="5979983">error</span><span class="op" id="5979988">)</span>&nbsp;<span class="op" id="5979990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5979993">return</span>&nbsp;<span class="ident" id="5980000">NewWriterLevelDict</span><span class="op" id="5980018">(</span><span class="ident" id="5980019">w</span><span class="op" id="5980020">,</span>&nbsp;<span class="ident" id="5980022">level</span><span class="op" id="5980027">,</span>&nbsp;<span class="builtintype" id="5980029">nil</span><span class="op" id="5980032">)</span><br>
<span class="lineno">55</span><span class="op" id="5980034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5980037">//&nbsp;NewWriterLevelDict&nbsp;is&nbsp;like&nbsp;NewWriterLevel&nbsp;but&nbsp;specifies&nbsp;a&nbsp;dictionary&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5980112">//&nbsp;compress&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5980130">//</span><br>
<span class="lineno">60</span><span class="comment" id="5980133">//&nbsp;The&nbsp;dictionary&nbsp;may&nbsp;be&nbsp;nil.&nbsp;If&nbsp;not,&nbsp;its&nbsp;contents&nbsp;should&nbsp;not&nbsp;be&nbsp;modified&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="5980213">//&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="5980238">func</span>&nbsp;<span class="ident" id="5980243">NewWriterLevelDict</span><span class="op" id="5980261">(</span><span class="ident" id="5980262">w</span>&nbsp;<span class="ident" id="5980264">io</span><span class="op" id="5980266">.</span><span class="ident" id="5980267">Writer</span><span class="op" id="5980273">,</span>&nbsp;<span class="ident" id="5980275">level</span>&nbsp;<span class="builtintype" id="5980281">int</span><span class="op" id="5980284">,</span>&nbsp;<span class="ident" id="5980286">dict</span>&nbsp;<span class="op" id="5980291">[</span><span class="op" id="5980292">]</span><span class="builtintype" id="5980293">byte</span><span class="op" id="5980297">)</span>&nbsp;<span class="op" id="5980299">(</span><span class="op" id="5980300">*</span><span class="ident" id="5980301">Writer</span><span class="op" id="5980307">,</span>&nbsp;<span class="builtintype" id="5980309">error</span><span class="op" id="5980314">)</span>&nbsp;<span class="op" id="5980316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5980319">if</span>&nbsp;<span class="ident" id="5980322">level</span>&nbsp;<span class="op" id="5980328">&lt;</span>&nbsp;<span class="ident" id="5980330">DefaultCompression</span>&nbsp;<span class="op" id="5980349">||</span>&nbsp;<span class="ident" id="5980352">level</span>&nbsp;<span class="op" id="5980358">&gt;</span>&nbsp;<span class="ident" id="5980360">BestCompression</span>&nbsp;<span class="op" id="5980376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5980380">return</span>&nbsp;<span class="builtintype" id="5980387">nil</span><span class="op" id="5980390">,</span>&nbsp;<span class="ident" id="5980392">fmt</span><span class="op" id="5980395">.</span><span class="ident" id="5980396">Errorf</span><span class="op" id="5980402">(</span><span class="string" id="5980403">&#34;zlib:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="5980440">,</span>&nbsp;<span class="ident" id="5980442">level</span><span class="op" id="5980447">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5980450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5980453">return</span>&nbsp;<span class="op" id="5980460">&amp;</span><span class="ident" id="5980461">Writer</span><span class="op" id="5980467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980471">w</span><span class="op" id="5980472">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980478">w</span><span class="op" id="5980479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980483">level</span><span class="op" id="5980488">:</span>&nbsp;<span class="ident" id="5980490">level</span><span class="op" id="5980495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980499">dict</span><span class="op" id="5980503">:</span>&nbsp;&nbsp;<span class="ident" id="5980506">dict</span><span class="op" id="5980510">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5980513">}</span><span class="op" id="5980514">,</span>&nbsp;<span class="builtintype" id="5980516">nil</span><br>
<span class="lineno"></span><span class="op" id="5980520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5980523">//&nbsp;Reset&nbsp;clears&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;Writer&nbsp;z&nbsp;such&nbsp;that&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5980599">//&nbsp;initial&nbsp;state&nbsp;from&nbsp;NewWriterLevel&nbsp;or&nbsp;NewWriterLevelDict,&nbsp;but&nbsp;instead&nbsp;writing</span><br>
<span class="lineno">75</span><span class="comment" id="5980679">//&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5980688">func</span>&nbsp;<span class="op" id="5980693">(</span><span class="ident" id="5980694">z</span>&nbsp;<span class="op" id="5980696">*</span><span class="ident" id="5980697">Writer</span><span class="op" id="5980703">)</span>&nbsp;<span class="ident" id="5980705">Reset</span><span class="op" id="5980710">(</span><span class="ident" id="5980711">w</span>&nbsp;<span class="ident" id="5980713">io</span><span class="op" id="5980715">.</span><span class="ident" id="5980716">Writer</span><span class="op" id="5980722">)</span>&nbsp;<span class="op" id="5980724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980727">z</span><span class="op" id="5980728">.</span><span class="ident" id="5980729">w</span>&nbsp;<span class="op" id="5980731">=</span>&nbsp;<span class="ident" id="5980733">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5980736">//&nbsp;z.level&nbsp;and&nbsp;z.dict&nbsp;left&nbsp;unchanged.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5980775">if</span>&nbsp;<span class="ident" id="5980778">z</span><span class="op" id="5980779">.</span><span class="ident" id="5980780">compressor</span>&nbsp;<span class="op" id="5980791">!=</span>&nbsp;<span class="builtintype" id="5980794">nil</span>&nbsp;<span class="op" id="5980798">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980802">z</span><span class="op" id="5980803">.</span><span class="ident" id="5980804">compressor</span><span class="op" id="5980814">.</span><span class="ident" id="5980815">Reset</span><span class="op" id="5980820">(</span><span class="ident" id="5980821">w</span><span class="op" id="5980822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5980825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5980828">if</span>&nbsp;<span class="ident" id="5980831">z</span><span class="op" id="5980832">.</span><span class="ident" id="5980833">digest</span>&nbsp;<span class="op" id="5980840">!=</span>&nbsp;<span class="builtintype" id="5980843">nil</span>&nbsp;<span class="op" id="5980847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980851">z</span><span class="op" id="5980852">.</span><span class="ident" id="5980853">digest</span><span class="op" id="5980859">.</span><span class="ident" id="5980860">Reset</span><span class="op" id="5980865">(</span><span class="op" id="5980866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5980869">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980872">z</span><span class="op" id="5980873">.</span><span class="ident" id="5980874">err</span>&nbsp;<span class="op" id="5980878">=</span>&nbsp;<span class="builtintype" id="5980880">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980885">z</span><span class="op" id="5980886">.</span><span class="ident" id="5980887">scratch</span>&nbsp;<span class="op" id="5980895">=</span>&nbsp;<span class="op" id="5980897">[</span><span class="num" id="5980898">4</span><span class="op" id="5980899">]</span><span class="builtintype" id="5980900">byte</span><span class="op" id="5980904">{</span><span class="op" id="5980905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980908">z</span><span class="op" id="5980909">.</span><span class="ident" id="5980910">wroteHeader</span>&nbsp;<span class="op" id="5980922">=</span>&nbsp;<span class="builtintype" id="5980924">false</span><br>
<span class="lineno"></span><span class="op" id="5980930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5980933">//&nbsp;writeHeader&nbsp;writes&nbsp;the&nbsp;ZLIB&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="5980972">func</span>&nbsp;<span class="op" id="5980977">(</span><span class="ident" id="5980978">z</span>&nbsp;<span class="op" id="5980980">*</span><span class="ident" id="5980981">Writer</span><span class="op" id="5980987">)</span>&nbsp;<span class="ident" id="5980989">writeHeader</span><span class="op" id="5981000">(</span><span class="op" id="5981001">)</span>&nbsp;<span class="op" id="5981003">(</span><span class="ident" id="5981004">err</span>&nbsp;<span class="builtintype" id="5981008">error</span><span class="op" id="5981013">)</span>&nbsp;<span class="op" id="5981015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981018">z</span><span class="op" id="5981019">.</span><span class="ident" id="5981020">wroteHeader</span>&nbsp;<span class="op" id="5981032">=</span>&nbsp;<span class="builtintype" id="5981034">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5981040">//&nbsp;ZLIB&nbsp;has&nbsp;a&nbsp;two-byte&nbsp;header&nbsp;(as&nbsp;documented&nbsp;in&nbsp;RFC&nbsp;1950).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5981100">//&nbsp;The&nbsp;first&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CINFO&nbsp;(compression&nbsp;info),&nbsp;which&nbsp;is&nbsp;7&nbsp;for&nbsp;the&nbsp;default&nbsp;deflate&nbsp;window&nbsp;size.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5981205">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CM&nbsp;(compression&nbsp;method),&nbsp;which&nbsp;is&nbsp;8&nbsp;for&nbsp;deflate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981284">z</span><span class="op" id="5981285">.</span><span class="ident" id="5981286">scratch</span><span class="op" id="5981293">[</span><span class="num" id="5981294">0</span><span class="op" id="5981295">]</span>&nbsp;<span class="op" id="5981297">=</span>&nbsp;<span class="num" id="5981299">0x78</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5981305">//&nbsp;The&nbsp;next&nbsp;two&nbsp;bits&nbsp;is&nbsp;the&nbsp;FLEVEL&nbsp;(compression&nbsp;level).&nbsp;The&nbsp;four&nbsp;values&nbsp;are:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5981383">//&nbsp;0=fastest,&nbsp;1=fast,&nbsp;2=default,&nbsp;3=best.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5981425">//&nbsp;The&nbsp;next&nbsp;bit,&nbsp;FDICT,&nbsp;is&nbsp;set&nbsp;if&nbsp;a&nbsp;dictionary&nbsp;is&nbsp;given.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5981483">//&nbsp;The&nbsp;final&nbsp;five&nbsp;FCHECK&nbsp;bits&nbsp;form&nbsp;a&nbsp;mod-31&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5981538">switch</span>&nbsp;<span class="ident" id="5981545">z</span><span class="op" id="5981546">.</span><span class="ident" id="5981547">level</span>&nbsp;<span class="op" id="5981553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5981556">case</span>&nbsp;<span class="num" id="5981561">0</span><span class="op" id="5981562">,</span>&nbsp;<span class="num" id="5981564">1</span><span class="op" id="5981565">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981569">z</span><span class="op" id="5981570">.</span><span class="ident" id="5981571">scratch</span><span class="op" id="5981578">[</span><span class="num" id="5981579">1</span><span class="op" id="5981580">]</span>&nbsp;<span class="op" id="5981582">=</span>&nbsp;<span class="num" id="5981584">0</span>&nbsp;<span class="op" id="5981586">&lt;&lt;</span>&nbsp;<span class="num" id="5981589">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5981592">case</span>&nbsp;<span class="num" id="5981597">2</span><span class="op" id="5981598">,</span>&nbsp;<span class="num" id="5981600">3</span><span class="op" id="5981601">,</span>&nbsp;<span class="num" id="5981603">4</span><span class="op" id="5981604">,</span>&nbsp;<span class="num" id="5981606">5</span><span class="op" id="5981607">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981611">z</span><span class="op" id="5981612">.</span><span class="ident" id="5981613">scratch</span><span class="op" id="5981620">[</span><span class="num" id="5981621">1</span><span class="op" id="5981622">]</span>&nbsp;<span class="op" id="5981624">=</span>&nbsp;<span class="num" id="5981626">1</span>&nbsp;<span class="op" id="5981628">&lt;&lt;</span>&nbsp;<span class="num" id="5981631">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5981634">case</span>&nbsp;<span class="num" id="5981639">6</span><span class="op" id="5981640">,</span>&nbsp;<span class="op" id="5981642">-</span><span class="num" id="5981643">1</span><span class="op" id="5981644">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981648">z</span><span class="op" id="5981649">.</span><span class="ident" id="5981650">scratch</span><span class="op" id="5981657">[</span><span class="num" id="5981658">1</span><span class="op" id="5981659">]</span>&nbsp;<span class="op" id="5981661">=</span>&nbsp;<span class="num" id="5981663">2</span>&nbsp;<span class="op" id="5981665">&lt;&lt;</span>&nbsp;<span class="num" id="5981668">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5981671">case</span>&nbsp;<span class="num" id="5981676">7</span><span class="op" id="5981677">,</span>&nbsp;<span class="num" id="5981679">8</span><span class="op" id="5981680">,</span>&nbsp;<span class="num" id="5981682">9</span><span class="op" id="5981683">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981687">z</span><span class="op" id="5981688">.</span><span class="ident" id="5981689">scratch</span><span class="op" id="5981696">[</span><span class="num" id="5981697">1</span><span class="op" id="5981698">]</span>&nbsp;<span class="op" id="5981700">=</span>&nbsp;<span class="num" id="5981702">3</span>&nbsp;<span class="op" id="5981704">&lt;&lt;</span>&nbsp;<span class="num" id="5981707">6</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5981710">default</span><span class="op" id="5981717">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5981721">panic</span><span class="op" id="5981726">(</span><span class="string" id="5981727">&#34;unreachable&#34;</span><span class="op" id="5981740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5981743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5981746">if</span>&nbsp;<span class="ident" id="5981749">z</span><span class="op" id="5981750">.</span><span class="ident" id="5981751">dict</span>&nbsp;<span class="op" id="5981756">!=</span>&nbsp;<span class="builtintype" id="5981759">nil</span>&nbsp;<span class="op" id="5981763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981767">z</span><span class="op" id="5981768">.</span><span class="ident" id="5981769">scratch</span><span class="op" id="5981776">[</span><span class="num" id="5981777">1</span><span class="op" id="5981778">]</span>&nbsp;<span class="op" id="5981780">|=</span>&nbsp;<span class="num" id="5981783">1</span>&nbsp;<span class="op" id="5981785">&lt;&lt;</span>&nbsp;<span class="num" id="5981788">5</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5981791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5981794">z</span><span class="op" id="5981795">.</span><span class="ident" id="5981796">scratch</span><span class="op" id="5981803">[</span><span class="num" id="5981804">1</span><span class="op" id="5981805">]</span>&nbsp;<span class="op" id="5981807">+=</span>&nbsp;<span class="builtintype" id="5981810">uint8</span><span class="op" id="5981815">(</span><span class="num" id="5981816">31</span>&nbsp;<span class="op" id="5981819">-</span>&nbsp;<span class="op" id="5981821">(</span><span class="builtintype" id="5981822">uint16</span><span class="op" id="5981828">(</span><span class="ident" id="5981829">z</span><span class="op" id="5981830">.</span><span class="ident" id="5981831">scratch</span><span class="op" id="5981838">[</span><span class="num" id="5981839">0</span><span class="op" id="5981840">]</span><span class="op" id="5981841">)</span><span class="op" id="5981842">&lt;&lt;</span><span class="num" id="5981844">8</span><span class="op" id="5981845">+</span><span class="builtintype" id="5981846">uint16</span><span class="op" id="5981852">(</span><span class="ident" id="5981853">z</span><span class="op" id="5981854">.</span><span class="ident" id="5981855">scratch</span><span class="op" id="5981862">[</span><span class="num" id="5981863">1</span><span class="op" id="5981864">]</span><span class="op" id="5981865">)</span><span class="op" id="5981866">)</span><span class="op" id="5981867">%</span><span class="num" id="5981868">31</span><span class="op" id="5981870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5981873">if</span>&nbsp;<span class="ident" id="5981876">_</span><span class="op" id="5981877">,</span>&nbsp;<span class="ident" id="5981879">err</span>&nbsp;<span class="op" id="5981883">=</span>&nbsp;<span class="ident" id="5981885">z</span><span class="op" id="5981886">.</span><span class="ident" id="5981887">w</span><span class="op" id="5981888">.</span><span class="ident" id="5981889">Write</span><span class="op" id="5981894">(</span><span class="ident" id="5981895">z</span><span class="op" id="5981896">.</span><span class="ident" id="5981897">scratch</span><span class="op" id="5981904">[</span><span class="num" id="5981905">0</span><span class="op" id="5981906">:</span><span class="num" id="5981907">2</span><span class="op" id="5981908">]</span><span class="op" id="5981909">)</span><span class="op" id="5981910">;</span>&nbsp;<span class="ident" id="5981912">err</span>&nbsp;<span class="op" id="5981916">!=</span>&nbsp;<span class="builtintype" id="5981919">nil</span>&nbsp;<span class="op" id="5981923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5981927">return</span>&nbsp;<span class="ident" id="5981934">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5981939">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5981942">if</span>&nbsp;<span class="ident" id="5981945">z</span><span class="op" id="5981946">.</span><span class="ident" id="5981947">dict</span>&nbsp;<span class="op" id="5981952">!=</span>&nbsp;<span class="builtintype" id="5981955">nil</span>&nbsp;<span class="op" id="5981959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5981963">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bytes&nbsp;are&nbsp;the&nbsp;Adler-32&nbsp;checksum&nbsp;of&nbsp;the&nbsp;dictionary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982033">checksum</span>&nbsp;<span class="op" id="5982042">:=</span>&nbsp;<span class="ident" id="5982045">adler32</span><span class="op" id="5982052">.</span><span class="ident" id="5982053">Checksum</span><span class="op" id="5982061">(</span><span class="ident" id="5982062">z</span><span class="op" id="5982063">.</span><span class="ident" id="5982064">dict</span><span class="op" id="5982068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982072">z</span><span class="op" id="5982073">.</span><span class="ident" id="5982074">scratch</span><span class="op" id="5982081">[</span><span class="num" id="5982082">0</span><span class="op" id="5982083">]</span>&nbsp;<span class="op" id="5982085">=</span>&nbsp;<span class="builtintype" id="5982087">uint8</span><span class="op" id="5982092">(</span><span class="ident" id="5982093">checksum</span>&nbsp;<span class="op" id="5982102">&gt;&gt;</span>&nbsp;<span class="num" id="5982105">24</span><span class="op" id="5982107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982111">z</span><span class="op" id="5982112">.</span><span class="ident" id="5982113">scratch</span><span class="op" id="5982120">[</span><span class="num" id="5982121">1</span><span class="op" id="5982122">]</span>&nbsp;<span class="op" id="5982124">=</span>&nbsp;<span class="builtintype" id="5982126">uint8</span><span class="op" id="5982131">(</span><span class="ident" id="5982132">checksum</span>&nbsp;<span class="op" id="5982141">&gt;&gt;</span>&nbsp;<span class="num" id="5982144">16</span><span class="op" id="5982146">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982150">z</span><span class="op" id="5982151">.</span><span class="ident" id="5982152">scratch</span><span class="op" id="5982159">[</span><span class="num" id="5982160">2</span><span class="op" id="5982161">]</span>&nbsp;<span class="op" id="5982163">=</span>&nbsp;<span class="builtintype" id="5982165">uint8</span><span class="op" id="5982170">(</span><span class="ident" id="5982171">checksum</span>&nbsp;<span class="op" id="5982180">&gt;&gt;</span>&nbsp;<span class="num" id="5982183">8</span><span class="op" id="5982184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982188">z</span><span class="op" id="5982189">.</span><span class="ident" id="5982190">scratch</span><span class="op" id="5982197">[</span><span class="num" id="5982198">3</span><span class="op" id="5982199">]</span>&nbsp;<span class="op" id="5982201">=</span>&nbsp;<span class="builtintype" id="5982203">uint8</span><span class="op" id="5982208">(</span><span class="ident" id="5982209">checksum</span>&nbsp;<span class="op" id="5982218">&gt;&gt;</span>&nbsp;<span class="num" id="5982221">0</span><span class="op" id="5982222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982226">if</span>&nbsp;<span class="ident" id="5982229">_</span><span class="op" id="5982230">,</span>&nbsp;<span class="ident" id="5982232">err</span>&nbsp;<span class="op" id="5982236">=</span>&nbsp;<span class="ident" id="5982238">z</span><span class="op" id="5982239">.</span><span class="ident" id="5982240">w</span><span class="op" id="5982241">.</span><span class="ident" id="5982242">Write</span><span class="op" id="5982247">(</span><span class="ident" id="5982248">z</span><span class="op" id="5982249">.</span><span class="ident" id="5982250">scratch</span><span class="op" id="5982257">[</span><span class="num" id="5982258">0</span><span class="op" id="5982259">:</span><span class="num" id="5982260">4</span><span class="op" id="5982261">]</span><span class="op" id="5982262">)</span><span class="op" id="5982263">;</span>&nbsp;<span class="ident" id="5982265">err</span>&nbsp;<span class="op" id="5982269">!=</span>&nbsp;<span class="builtintype" id="5982272">nil</span>&nbsp;<span class="op" id="5982276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982281">return</span>&nbsp;<span class="ident" id="5982288">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982294">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982300">if</span>&nbsp;<span class="ident" id="5982303">z</span><span class="op" id="5982304">.</span><span class="ident" id="5982305">compressor</span>&nbsp;<span class="op" id="5982316">==</span>&nbsp;<span class="builtintype" id="5982319">nil</span>&nbsp;<span class="op" id="5982323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982327">//&nbsp;Initialize&nbsp;deflater&nbsp;unless&nbsp;the&nbsp;Writer&nbsp;is&nbsp;being&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5982386">//&nbsp;after&nbsp;a&nbsp;Reset&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982411">z</span><span class="op" id="5982412">.</span><span class="ident" id="5982413">compressor</span><span class="op" id="5982423">,</span>&nbsp;<span class="ident" id="5982425">err</span>&nbsp;<span class="op" id="5982429">=</span>&nbsp;<span class="ident" id="5982431">flate</span><span class="op" id="5982436">.</span><span class="ident" id="5982437">NewWriterDict</span><span class="op" id="5982450">(</span><span class="ident" id="5982451">z</span><span class="op" id="5982452">.</span><span class="ident" id="5982453">w</span><span class="op" id="5982454">,</span>&nbsp;<span class="ident" id="5982456">z</span><span class="op" id="5982457">.</span><span class="ident" id="5982458">level</span><span class="op" id="5982463">,</span>&nbsp;<span class="ident" id="5982465">z</span><span class="op" id="5982466">.</span><span class="ident" id="5982467">dict</span><span class="op" id="5982471">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982475">if</span>&nbsp;<span class="ident" id="5982478">err</span>&nbsp;<span class="op" id="5982482">!=</span>&nbsp;<span class="builtintype" id="5982485">nil</span>&nbsp;<span class="op" id="5982489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982494">return</span>&nbsp;<span class="ident" id="5982501">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982511">z</span><span class="op" id="5982512">.</span><span class="ident" id="5982513">digest</span>&nbsp;<span class="op" id="5982520">=</span>&nbsp;<span class="ident" id="5982522">adler32</span><span class="op" id="5982529">.</span><span class="ident" id="5982530">New</span><span class="op" id="5982533">(</span><span class="op" id="5982534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982537">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982540">return</span>&nbsp;<span class="builtintype" id="5982547">nil</span><br>
<span class="lineno"></span><span class="op" id="5982551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5982554">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5982626">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed&nbsp;or</span><br>
<span class="lineno">145</span><span class="comment" id="5982704">//&nbsp;explicitly&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5982727">func</span>&nbsp;<span class="op" id="5982732">(</span><span class="ident" id="5982733">z</span>&nbsp;<span class="op" id="5982735">*</span><span class="ident" id="5982736">Writer</span><span class="op" id="5982742">)</span>&nbsp;<span class="ident" id="5982744">Write</span><span class="op" id="5982749">(</span><span class="ident" id="5982750">p</span>&nbsp;<span class="op" id="5982752">[</span><span class="op" id="5982753">]</span><span class="builtintype" id="5982754">byte</span><span class="op" id="5982758">)</span>&nbsp;<span class="op" id="5982760">(</span><span class="ident" id="5982761">n</span>&nbsp;<span class="builtintype" id="5982763">int</span><span class="op" id="5982766">,</span>&nbsp;<span class="ident" id="5982768">err</span>&nbsp;<span class="builtintype" id="5982772">error</span><span class="op" id="5982777">)</span>&nbsp;<span class="op" id="5982779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982782">if</span>&nbsp;<span class="op" id="5982785">!</span><span class="ident" id="5982786">z</span><span class="op" id="5982787">.</span><span class="ident" id="5982788">wroteHeader</span>&nbsp;<span class="op" id="5982800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982804">z</span><span class="op" id="5982805">.</span><span class="ident" id="5982806">err</span>&nbsp;<span class="op" id="5982810">=</span>&nbsp;<span class="ident" id="5982812">z</span><span class="op" id="5982813">.</span><span class="ident" id="5982814">writeHeader</span><span class="op" id="5982825">(</span><span class="op" id="5982826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982829">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982832">if</span>&nbsp;<span class="ident" id="5982835">z</span><span class="op" id="5982836">.</span><span class="ident" id="5982837">err</span>&nbsp;<span class="op" id="5982841">!=</span>&nbsp;<span class="builtintype" id="5982844">nil</span>&nbsp;<span class="op" id="5982848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982852">return</span>&nbsp;<span class="num" id="5982859">0</span><span class="op" id="5982860">,</span>&nbsp;<span class="ident" id="5982862">z</span><span class="op" id="5982863">.</span><span class="ident" id="5982864">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982872">if</span>&nbsp;<span class="builtinfunc" id="5982875">len</span><span class="op" id="5982878">(</span><span class="ident" id="5982879">p</span><span class="op" id="5982880">)</span>&nbsp;<span class="op" id="5982882">==</span>&nbsp;<span class="num" id="5982885">0</span>&nbsp;<span class="op" id="5982887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982891">return</span>&nbsp;<span class="num" id="5982898">0</span><span class="op" id="5982899">,</span>&nbsp;<span class="builtintype" id="5982901">nil</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982909">n</span><span class="op" id="5982910">,</span>&nbsp;<span class="ident" id="5982912">err</span>&nbsp;<span class="op" id="5982916">=</span>&nbsp;<span class="ident" id="5982918">z</span><span class="op" id="5982919">.</span><span class="ident" id="5982920">compressor</span><span class="op" id="5982930">.</span><span class="ident" id="5982931">Write</span><span class="op" id="5982936">(</span><span class="ident" id="5982937">p</span><span class="op" id="5982938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982941">if</span>&nbsp;<span class="ident" id="5982944">err</span>&nbsp;<span class="op" id="5982948">!=</span>&nbsp;<span class="builtintype" id="5982951">nil</span>&nbsp;<span class="op" id="5982955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982959">z</span><span class="op" id="5982960">.</span><span class="ident" id="5982961">err</span>&nbsp;<span class="op" id="5982965">=</span>&nbsp;<span class="ident" id="5982967">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5982973">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982984">z</span><span class="op" id="5982985">.</span><span class="ident" id="5982986">digest</span><span class="op" id="5982992">.</span><span class="ident" id="5982993">Write</span><span class="op" id="5982998">(</span><span class="ident" id="5982999">p</span><span class="op" id="5983000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5983003">return</span><br>
<span class="lineno"></span><span class="op" id="5983010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5983013">//&nbsp;Flush&nbsp;flushes&nbsp;the&nbsp;Writer&nbsp;to&nbsp;its&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5983070">func</span>&nbsp;<span class="op" id="5983075">(</span><span class="ident" id="5983076">z</span>&nbsp;<span class="op" id="5983078">*</span><span class="ident" id="5983079">Writer</span><span class="op" id="5983085">)</span>&nbsp;<span class="ident" id="5983087">Flush</span><span class="op" id="5983092">(</span><span class="op" id="5983093">)</span>&nbsp;<span class="builtintype" id="5983095">error</span>&nbsp;<span class="op" id="5983101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5983104">if</span>&nbsp;<span class="op" id="5983107">!</span><span class="ident" id="5983108">z</span><span class="op" id="5983109">.</span><span class="ident" id="5983110">wroteHeader</span>&nbsp;<span class="op" id="5983122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983126">z</span><span class="op" id="5983127">.</span><span class="ident" id="5983128">err</span>&nbsp;<span class="op" id="5983132">=</span>&nbsp;<span class="ident" id="5983134">z</span><span class="op" id="5983135">.</span><span class="ident" id="5983136">writeHeader</span><span class="op" id="5983147">(</span><span class="op" id="5983148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5983151">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5983154">if</span>&nbsp;<span class="ident" id="5983157">z</span><span class="op" id="5983158">.</span><span class="ident" id="5983159">err</span>&nbsp;<span class="op" id="5983163">!=</span>&nbsp;<span class="builtintype" id="5983166">nil</span>&nbsp;<span class="op" id="5983170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5983174">return</span>&nbsp;<span class="ident" id="5983181">z</span><span class="op" id="5983182">.</span><span class="ident" id="5983183">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5983188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983191">z</span><span class="op" id="5983192">.</span><span class="ident" id="5983193">err</span>&nbsp;<span class="op" id="5983197">=</span>&nbsp;<span class="ident" id="5983199">z</span><span class="op" id="5983200">.</span><span class="ident" id="5983201">compressor</span><span class="op" id="5983211">.</span><span class="ident" id="5983212">Flush</span><span class="op" id="5983217">(</span><span class="op" id="5983218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5983221">return</span>&nbsp;<span class="ident" id="5983228">z</span><span class="op" id="5983229">.</span><span class="ident" id="5983230">err</span><br>
<span class="lineno">175</span><span class="op" id="5983234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5983237">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="5983311">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5983370">func</span>&nbsp;<span class="op" id="5983375">(</span><span class="ident" id="5983376">z</span>&nbsp;<span class="op" id="5983378">*</span><span class="ident" id="5983379">Writer</span><span class="op" id="5983385">)</span>&nbsp;<span class="ident" id="5983387">Close</span><span class="op" id="5983392">(</span><span class="op" id="5983393">)</span>&nbsp;<span class="builtintype" id="5983395">error</span>&nbsp;<span class="op" id="5983401">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5983404">if</span>&nbsp;<span class="op" id="5983407">!</span><span class="ident" id="5983408">z</span><span class="op" id="5983409">.</span><span class="ident" id="5983410">wroteHeader</span>&nbsp;<span class="op" id="5983422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983426">z</span><span class="op" id="5983427">.</span><span class="ident" id="5983428">err</span>&nbsp;<span class="op" id="5983432">=</span>&nbsp;<span class="ident" id="5983434">z</span><span class="op" id="5983435">.</span><span class="ident" id="5983436">writeHeader</span><span class="op" id="5983447">(</span><span class="op" id="5983448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5983451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5983454">if</span>&nbsp;<span class="ident" id="5983457">z</span><span class="op" id="5983458">.</span><span class="ident" id="5983459">err</span>&nbsp;<span class="op" id="5983463">!=</span>&nbsp;<span class="builtintype" id="5983466">nil</span>&nbsp;<span class="op" id="5983470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5983474">return</span>&nbsp;<span class="ident" id="5983481">z</span><span class="op" id="5983482">.</span><span class="ident" id="5983483">err</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5983488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983491">z</span><span class="op" id="5983492">.</span><span class="ident" id="5983493">err</span>&nbsp;<span class="op" id="5983497">=</span>&nbsp;<span class="ident" id="5983499">z</span><span class="op" id="5983500">.</span><span class="ident" id="5983501">compressor</span><span class="op" id="5983511">.</span><span class="ident" id="5983512">Close</span><span class="op" id="5983517">(</span><span class="op" id="5983518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5983521">if</span>&nbsp;<span class="ident" id="5983524">z</span><span class="op" id="5983525">.</span><span class="ident" id="5983526">err</span>&nbsp;<span class="op" id="5983530">!=</span>&nbsp;<span class="builtintype" id="5983533">nil</span>&nbsp;<span class="op" id="5983537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5983541">return</span>&nbsp;<span class="ident" id="5983548">z</span><span class="op" id="5983549">.</span><span class="ident" id="5983550">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5983555">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983558">checksum</span>&nbsp;<span class="op" id="5983567">:=</span>&nbsp;<span class="ident" id="5983570">z</span><span class="op" id="5983571">.</span><span class="ident" id="5983572">digest</span><span class="op" id="5983578">.</span><span class="ident" id="5983579">Sum32</span><span class="op" id="5983584">(</span><span class="op" id="5983585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5983588">//&nbsp;ZLIB&nbsp;(RFC&nbsp;1950)&nbsp;is&nbsp;big-endian,&nbsp;unlike&nbsp;GZIP&nbsp;(RFC&nbsp;1952).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983647">z</span><span class="op" id="5983648">.</span><span class="ident" id="5983649">scratch</span><span class="op" id="5983656">[</span><span class="num" id="5983657">0</span><span class="op" id="5983658">]</span>&nbsp;<span class="op" id="5983660">=</span>&nbsp;<span class="builtintype" id="5983662">uint8</span><span class="op" id="5983667">(</span><span class="ident" id="5983668">checksum</span>&nbsp;<span class="op" id="5983677">&gt;&gt;</span>&nbsp;<span class="num" id="5983680">24</span><span class="op" id="5983682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983685">z</span><span class="op" id="5983686">.</span><span class="ident" id="5983687">scratch</span><span class="op" id="5983694">[</span><span class="num" id="5983695">1</span><span class="op" id="5983696">]</span>&nbsp;<span class="op" id="5983698">=</span>&nbsp;<span class="builtintype" id="5983700">uint8</span><span class="op" id="5983705">(</span><span class="ident" id="5983706">checksum</span>&nbsp;<span class="op" id="5983715">&gt;&gt;</span>&nbsp;<span class="num" id="5983718">16</span><span class="op" id="5983720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983723">z</span><span class="op" id="5983724">.</span><span class="ident" id="5983725">scratch</span><span class="op" id="5983732">[</span><span class="num" id="5983733">2</span><span class="op" id="5983734">]</span>&nbsp;<span class="op" id="5983736">=</span>&nbsp;<span class="builtintype" id="5983738">uint8</span><span class="op" id="5983743">(</span><span class="ident" id="5983744">checksum</span>&nbsp;<span class="op" id="5983753">&gt;&gt;</span>&nbsp;<span class="num" id="5983756">8</span><span class="op" id="5983757">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983760">z</span><span class="op" id="5983761">.</span><span class="ident" id="5983762">scratch</span><span class="op" id="5983769">[</span><span class="num" id="5983770">3</span><span class="op" id="5983771">]</span>&nbsp;<span class="op" id="5983773">=</span>&nbsp;<span class="builtintype" id="5983775">uint8</span><span class="op" id="5983780">(</span><span class="ident" id="5983781">checksum</span>&nbsp;<span class="op" id="5983790">&gt;&gt;</span>&nbsp;<span class="num" id="5983793">0</span><span class="op" id="5983794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5983797">_</span><span class="op" id="5983798">,</span>&nbsp;<span class="ident" id="5983800">z</span><span class="op" id="5983801">.</span><span class="ident" id="5983802">err</span>&nbsp;<span class="op" id="5983806">=</span>&nbsp;<span class="ident" id="5983808">z</span><span class="op" id="5983809">.</span><span class="ident" id="5983810">w</span><span class="op" id="5983811">.</span><span class="ident" id="5983812">Write</span><span class="op" id="5983817">(</span><span class="ident" id="5983818">z</span><span class="op" id="5983819">.</span><span class="ident" id="5983820">scratch</span><span class="op" id="5983827">[</span><span class="num" id="5983828">0</span><span class="op" id="5983829">:</span><span class="num" id="5983830">4</span><span class="op" id="5983831">]</span><span class="op" id="5983832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5983835">return</span>&nbsp;<span class="ident" id="5983842">z</span><span class="op" id="5983843">.</span><span class="ident" id="5983844">err</span><br>
<span class="lineno"></span><span class="op" id="5983848">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
