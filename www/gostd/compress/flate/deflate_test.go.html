<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6860441">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6860496">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6860550">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6860601">package</span>&nbsp;<span class="ident" id="6860609">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6860616">import</span>&nbsp;<span class="op" id="6860623">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6860626">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6860635">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6860642">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6860648">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6860661">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6860672">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6860680">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6860690">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6860693">type</span>&nbsp;<span class="ident" id="6860698">deflateTest</span>&nbsp;<span class="keyword" id="6860710">struct</span>&nbsp;<span class="op" id="6860717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6860720">in</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6860726">[</span><span class="op" id="6860727">]</span><span class="builtintype" id="6860728">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6860734">level</span>&nbsp;<span class="builtintype" id="6860740">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6860745">out</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6860751">[</span><span class="op" id="6860752">]</span><span class="builtintype" id="6860753">byte</span><br>
<span class="lineno"></span><span class="op" id="6860758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6860761">type</span>&nbsp;<span class="ident" id="6860766">deflateInflateTest</span>&nbsp;<span class="keyword" id="6860785">struct</span>&nbsp;<span class="op" id="6860792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6860795">in</span>&nbsp;<span class="op" id="6860798">[</span><span class="op" id="6860799">]</span><span class="builtintype" id="6860800">byte</span><br>
<span class="lineno">25</span><span class="op" id="6860805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6860808">type</span>&nbsp;<span class="ident" id="6860813">reverseBitsTest</span>&nbsp;<span class="keyword" id="6860829">struct</span>&nbsp;<span class="op" id="6860836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6860839">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6860848">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6860856">bitCount</span>&nbsp;<span class="builtintype" id="6860865">uint8</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6860872">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6860881">uint16</span><br>
<span class="lineno"></span><span class="op" id="6860888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6860891">var</span>&nbsp;<span class="ident" id="6860895">deflateTests</span>&nbsp;<span class="op" id="6860908">=</span>&nbsp;<span class="op" id="6860910">[</span><span class="op" id="6860911">]</span><span class="op" id="6860912">*</span><span class="ident" id="6860913">deflateTest</span><span class="op" id="6860924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6860927">{</span><span class="op" id="6860928">[</span><span class="op" id="6860929">]</span><span class="builtintype" id="6860930">byte</span><span class="op" id="6860934">{</span><span class="op" id="6860935">}</span><span class="op" id="6860936">,</span>&nbsp;<span class="num" id="6860938">0</span><span class="op" id="6860939">,</span>&nbsp;<span class="op" id="6860941">[</span><span class="op" id="6860942">]</span><span class="builtintype" id="6860943">byte</span><span class="op" id="6860947">{</span><span class="num" id="6860948">1</span><span class="op" id="6860949">,</span>&nbsp;<span class="num" id="6860951">0</span><span class="op" id="6860952">,</span>&nbsp;<span class="num" id="6860954">0</span><span class="op" id="6860955">,</span>&nbsp;<span class="num" id="6860957">255</span><span class="op" id="6860960">,</span>&nbsp;<span class="num" id="6860962">255</span><span class="op" id="6860965">}</span><span class="op" id="6860966">}</span><span class="op" id="6860967">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6860970">{</span><span class="op" id="6860971">[</span><span class="op" id="6860972">]</span><span class="builtintype" id="6860973">byte</span><span class="op" id="6860977">{</span><span class="num" id="6860978">0x11</span><span class="op" id="6860982">}</span><span class="op" id="6860983">,</span>&nbsp;<span class="op" id="6860985">-</span><span class="num" id="6860986">1</span><span class="op" id="6860987">,</span>&nbsp;<span class="op" id="6860989">[</span><span class="op" id="6860990">]</span><span class="builtintype" id="6860991">byte</span><span class="op" id="6860995">{</span><span class="num" id="6860996">18</span><span class="op" id="6860998">,</span>&nbsp;<span class="num" id="6861000">4</span><span class="op" id="6861001">,</span>&nbsp;<span class="num" id="6861003">4</span><span class="op" id="6861004">,</span>&nbsp;<span class="num" id="6861006">0</span><span class="op" id="6861007">,</span>&nbsp;<span class="num" id="6861009">0</span><span class="op" id="6861010">,</span>&nbsp;<span class="num" id="6861012">255</span><span class="op" id="6861015">,</span>&nbsp;<span class="num" id="6861017">255</span><span class="op" id="6861020">}</span><span class="op" id="6861021">}</span><span class="op" id="6861022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6861025">{</span><span class="op" id="6861026">[</span><span class="op" id="6861027">]</span><span class="builtintype" id="6861028">byte</span><span class="op" id="6861032">{</span><span class="num" id="6861033">0x11</span><span class="op" id="6861037">}</span><span class="op" id="6861038">,</span>&nbsp;<span class="ident" id="6861040">DefaultCompression</span><span class="op" id="6861058">,</span>&nbsp;<span class="op" id="6861060">[</span><span class="op" id="6861061">]</span><span class="builtintype" id="6861062">byte</span><span class="op" id="6861066">{</span><span class="num" id="6861067">18</span><span class="op" id="6861069">,</span>&nbsp;<span class="num" id="6861071">4</span><span class="op" id="6861072">,</span>&nbsp;<span class="num" id="6861074">4</span><span class="op" id="6861075">,</span>&nbsp;<span class="num" id="6861077">0</span><span class="op" id="6861078">,</span>&nbsp;<span class="num" id="6861080">0</span><span class="op" id="6861081">,</span>&nbsp;<span class="num" id="6861083">255</span><span class="op" id="6861086">,</span>&nbsp;<span class="num" id="6861088">255</span><span class="op" id="6861091">}</span><span class="op" id="6861092">}</span><span class="op" id="6861093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6861096">{</span><span class="op" id="6861097">[</span><span class="op" id="6861098">]</span><span class="builtintype" id="6861099">byte</span><span class="op" id="6861103">{</span><span class="num" id="6861104">0x11</span><span class="op" id="6861108">}</span><span class="op" id="6861109">,</span>&nbsp;<span class="num" id="6861111">4</span><span class="op" id="6861112">,</span>&nbsp;<span class="op" id="6861114">[</span><span class="op" id="6861115">]</span><span class="builtintype" id="6861116">byte</span><span class="op" id="6861120">{</span><span class="num" id="6861121">18</span><span class="op" id="6861123">,</span>&nbsp;<span class="num" id="6861125">4</span><span class="op" id="6861126">,</span>&nbsp;<span class="num" id="6861128">4</span><span class="op" id="6861129">,</span>&nbsp;<span class="num" id="6861131">0</span><span class="op" id="6861132">,</span>&nbsp;<span class="num" id="6861134">0</span><span class="op" id="6861135">,</span>&nbsp;<span class="num" id="6861137">255</span><span class="op" id="6861140">,</span>&nbsp;<span class="num" id="6861142">255</span><span class="op" id="6861145">}</span><span class="op" id="6861146">}</span><span class="op" id="6861147">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6861151">{</span><span class="op" id="6861152">[</span><span class="op" id="6861153">]</span><span class="builtintype" id="6861154">byte</span><span class="op" id="6861158">{</span><span class="num" id="6861159">0x11</span><span class="op" id="6861163">}</span><span class="op" id="6861164">,</span>&nbsp;<span class="num" id="6861166">0</span><span class="op" id="6861167">,</span>&nbsp;<span class="op" id="6861169">[</span><span class="op" id="6861170">]</span><span class="builtintype" id="6861171">byte</span><span class="op" id="6861175">{</span><span class="num" id="6861176">0</span><span class="op" id="6861177">,</span>&nbsp;<span class="num" id="6861179">1</span><span class="op" id="6861180">,</span>&nbsp;<span class="num" id="6861182">0</span><span class="op" id="6861183">,</span>&nbsp;<span class="num" id="6861185">254</span><span class="op" id="6861188">,</span>&nbsp;<span class="num" id="6861190">255</span><span class="op" id="6861193">,</span>&nbsp;<span class="num" id="6861195">17</span><span class="op" id="6861197">,</span>&nbsp;<span class="num" id="6861199">1</span><span class="op" id="6861200">,</span>&nbsp;<span class="num" id="6861202">0</span><span class="op" id="6861203">,</span>&nbsp;<span class="num" id="6861205">0</span><span class="op" id="6861206">,</span>&nbsp;<span class="num" id="6861208">255</span><span class="op" id="6861211">,</span>&nbsp;<span class="num" id="6861213">255</span><span class="op" id="6861216">}</span><span class="op" id="6861217">}</span><span class="op" id="6861218">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6861221">{</span><span class="op" id="6861222">[</span><span class="op" id="6861223">]</span><span class="builtintype" id="6861224">byte</span><span class="op" id="6861228">{</span><span class="num" id="6861229">0x11</span><span class="op" id="6861233">,</span>&nbsp;<span class="num" id="6861235">0x12</span><span class="op" id="6861239">}</span><span class="op" id="6861240">,</span>&nbsp;<span class="num" id="6861242">0</span><span class="op" id="6861243">,</span>&nbsp;<span class="op" id="6861245">[</span><span class="op" id="6861246">]</span><span class="builtintype" id="6861247">byte</span><span class="op" id="6861251">{</span><span class="num" id="6861252">0</span><span class="op" id="6861253">,</span>&nbsp;<span class="num" id="6861255">2</span><span class="op" id="6861256">,</span>&nbsp;<span class="num" id="6861258">0</span><span class="op" id="6861259">,</span>&nbsp;<span class="num" id="6861261">253</span><span class="op" id="6861264">,</span>&nbsp;<span class="num" id="6861266">255</span><span class="op" id="6861269">,</span>&nbsp;<span class="num" id="6861271">17</span><span class="op" id="6861273">,</span>&nbsp;<span class="num" id="6861275">18</span><span class="op" id="6861277">,</span>&nbsp;<span class="num" id="6861279">1</span><span class="op" id="6861280">,</span>&nbsp;<span class="num" id="6861282">0</span><span class="op" id="6861283">,</span>&nbsp;<span class="num" id="6861285">0</span><span class="op" id="6861286">,</span>&nbsp;<span class="num" id="6861288">255</span><span class="op" id="6861291">,</span>&nbsp;<span class="num" id="6861293">255</span><span class="op" id="6861296">}</span><span class="op" id="6861297">}</span><span class="op" id="6861298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6861301">{</span><span class="op" id="6861302">[</span><span class="op" id="6861303">]</span><span class="builtintype" id="6861304">byte</span><span class="op" id="6861308">{</span><span class="num" id="6861309">0x11</span><span class="op" id="6861313">,</span>&nbsp;<span class="num" id="6861315">0x11</span><span class="op" id="6861319">,</span>&nbsp;<span class="num" id="6861321">0x11</span><span class="op" id="6861325">,</span>&nbsp;<span class="num" id="6861327">0x11</span><span class="op" id="6861331">,</span>&nbsp;<span class="num" id="6861333">0x11</span><span class="op" id="6861337">,</span>&nbsp;<span class="num" id="6861339">0x11</span><span class="op" id="6861343">,</span>&nbsp;<span class="num" id="6861345">0x11</span><span class="op" id="6861349">,</span>&nbsp;<span class="num" id="6861351">0x11</span><span class="op" id="6861355">}</span><span class="op" id="6861356">,</span>&nbsp;<span class="num" id="6861358">0</span><span class="op" id="6861359">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6861363">[</span><span class="op" id="6861364">]</span><span class="builtintype" id="6861365">byte</span><span class="op" id="6861369">{</span><span class="num" id="6861370">0</span><span class="op" id="6861371">,</span>&nbsp;<span class="num" id="6861373">8</span><span class="op" id="6861374">,</span>&nbsp;<span class="num" id="6861376">0</span><span class="op" id="6861377">,</span>&nbsp;<span class="num" id="6861379">247</span><span class="op" id="6861382">,</span>&nbsp;<span class="num" id="6861384">255</span><span class="op" id="6861387">,</span>&nbsp;<span class="num" id="6861389">17</span><span class="op" id="6861391">,</span>&nbsp;<span class="num" id="6861393">17</span><span class="op" id="6861395">,</span>&nbsp;<span class="num" id="6861397">17</span><span class="op" id="6861399">,</span>&nbsp;<span class="num" id="6861401">17</span><span class="op" id="6861403">,</span>&nbsp;<span class="num" id="6861405">17</span><span class="op" id="6861407">,</span>&nbsp;<span class="num" id="6861409">17</span><span class="op" id="6861411">,</span>&nbsp;<span class="num" id="6861413">17</span><span class="op" id="6861415">,</span>&nbsp;<span class="num" id="6861417">17</span><span class="op" id="6861419">,</span>&nbsp;<span class="num" id="6861421">1</span><span class="op" id="6861422">,</span>&nbsp;<span class="num" id="6861424">0</span><span class="op" id="6861425">,</span>&nbsp;<span class="num" id="6861427">0</span><span class="op" id="6861428">,</span>&nbsp;<span class="num" id="6861430">255</span><span class="op" id="6861433">,</span>&nbsp;<span class="num" id="6861435">255</span><span class="op" id="6861438">}</span><span class="op" id="6861439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6861442">}</span><span class="op" id="6861443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6861446">{</span><span class="op" id="6861447">[</span><span class="op" id="6861448">]</span><span class="builtintype" id="6861449">byte</span><span class="op" id="6861453">{</span><span class="op" id="6861454">}</span><span class="op" id="6861455">,</span>&nbsp;<span class="num" id="6861457">1</span><span class="op" id="6861458">,</span>&nbsp;<span class="op" id="6861460">[</span><span class="op" id="6861461">]</span><span class="builtintype" id="6861462">byte</span><span class="op" id="6861466">{</span><span class="num" id="6861467">1</span><span class="op" id="6861468">,</span>&nbsp;<span class="num" id="6861470">0</span><span class="op" id="6861471">,</span>&nbsp;<span class="num" id="6861473">0</span><span class="op" id="6861474">,</span>&nbsp;<span class="num" id="6861476">255</span><span class="op" id="6861479">,</span>&nbsp;<span class="num" id="6861481">255</span><span class="op" id="6861484">}</span><span class="op" id="6861485">}</span><span class="op" id="6861486">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6861489">{</span><span class="op" id="6861490">[</span><span class="op" id="6861491">]</span><span class="builtintype" id="6861492">byte</span><span class="op" id="6861496">{</span><span class="num" id="6861497">0x11</span><span class="op" id="6861501">}</span><span class="op" id="6861502">,</span>&nbsp;<span class="num" id="6861504">1</span><span class="op" id="6861505">,</span>&nbsp;<span class="op" id="6861507">[</span><span class="op" id="6861508">]</span><span class="builtintype" id="6861509">byte</span><span class="op" id="6861513">{</span><span class="num" id="6861514">18</span><span class="op" id="6861516">,</span>&nbsp;<span class="num" id="6861518">4</span><span class="op" id="6861519">,</span>&nbsp;<span class="num" id="6861521">4</span><span class="op" id="6861522">,</span>&nbsp;<span class="num" id="6861524">0</span><span class="op" id="6861525">,</span>&nbsp;<span class="num" id="6861527">0</span><span class="op" id="6861528">,</span>&nbsp;<span class="num" id="6861530">255</span><span class="op" id="6861533">,</span>&nbsp;<span class="num" id="6861535">255</span><span class="op" id="6861538">}</span><span class="op" id="6861539">}</span><span class="op" id="6861540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6861543">{</span><span class="op" id="6861544">[</span><span class="op" id="6861545">]</span><span class="builtintype" id="6861546">byte</span><span class="op" id="6861550">{</span><span class="num" id="6861551">0x11</span><span class="op" id="6861555">,</span>&nbsp;<span class="num" id="6861557">0x12</span><span class="op" id="6861561">}</span><span class="op" id="6861562">,</span>&nbsp;<span class="num" id="6861564">1</span><span class="op" id="6861565">,</span>&nbsp;<span class="op" id="6861567">[</span><span class="op" id="6861568">]</span><span class="builtintype" id="6861569">byte</span><span class="op" id="6861573">{</span><span class="num" id="6861574">18</span><span class="op" id="6861576">,</span>&nbsp;<span class="num" id="6861578">20</span><span class="op" id="6861580">,</span>&nbsp;<span class="num" id="6861582">2</span><span class="op" id="6861583">,</span>&nbsp;<span class="num" id="6861585">4</span><span class="op" id="6861586">,</span>&nbsp;<span class="num" id="6861588">0</span><span class="op" id="6861589">,</span>&nbsp;<span class="num" id="6861591">0</span><span class="op" id="6861592">,</span>&nbsp;<span class="num" id="6861594">255</span><span class="op" id="6861597">,</span>&nbsp;<span class="num" id="6861599">255</span><span class="op" id="6861602">}</span><span class="op" id="6861603">}</span><span class="op" id="6861604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6861607">{</span><span class="op" id="6861608">[</span><span class="op" id="6861609">]</span><span class="builtintype" id="6861610">byte</span><span class="op" id="6861614">{</span><span class="num" id="6861615">0x11</span><span class="op" id="6861619">,</span>&nbsp;<span class="num" id="6861621">0x11</span><span class="op" id="6861625">,</span>&nbsp;<span class="num" id="6861627">0x11</span><span class="op" id="6861631">,</span>&nbsp;<span class="num" id="6861633">0x11</span><span class="op" id="6861637">,</span>&nbsp;<span class="num" id="6861639">0x11</span><span class="op" id="6861643">,</span>&nbsp;<span class="num" id="6861645">0x11</span><span class="op" id="6861649">,</span>&nbsp;<span class="num" id="6861651">0x11</span><span class="op" id="6861655">,</span>&nbsp;<span class="num" id="6861657">0x11</span><span class="op" id="6861661">}</span><span class="op" id="6861662">,</span>&nbsp;<span class="num" id="6861664">1</span><span class="op" id="6861665">,</span>&nbsp;<span class="op" id="6861667">[</span><span class="op" id="6861668">]</span><span class="builtintype" id="6861669">byte</span><span class="op" id="6861673">{</span><span class="num" id="6861674">18</span><span class="op" id="6861676">,</span>&nbsp;<span class="num" id="6861678">132</span><span class="op" id="6861681">,</span>&nbsp;<span class="num" id="6861683">2</span><span class="op" id="6861684">,</span>&nbsp;<span class="num" id="6861686">64</span><span class="op" id="6861688">,</span>&nbsp;<span class="num" id="6861690">0</span><span class="op" id="6861691">,</span>&nbsp;<span class="num" id="6861693">0</span><span class="op" id="6861694">,</span>&nbsp;<span class="num" id="6861696">0</span><span class="op" id="6861697">,</span>&nbsp;<span class="num" id="6861699">255</span><span class="op" id="6861702">,</span>&nbsp;<span class="num" id="6861704">255</span><span class="op" id="6861707">}</span><span class="op" id="6861708">}</span><span class="op" id="6861709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6861712">{</span><span class="op" id="6861713">[</span><span class="op" id="6861714">]</span><span class="builtintype" id="6861715">byte</span><span class="op" id="6861719">{</span><span class="op" id="6861720">}</span><span class="op" id="6861721">,</span>&nbsp;<span class="num" id="6861723">9</span><span class="op" id="6861724">,</span>&nbsp;<span class="op" id="6861726">[</span><span class="op" id="6861727">]</span><span class="builtintype" id="6861728">byte</span><span class="op" id="6861732">{</span><span class="num" id="6861733">1</span><span class="op" id="6861734">,</span>&nbsp;<span class="num" id="6861736">0</span><span class="op" id="6861737">,</span>&nbsp;<span class="num" id="6861739">0</span><span class="op" id="6861740">,</span>&nbsp;<span class="num" id="6861742">255</span><span class="op" id="6861745">,</span>&nbsp;<span class="num" id="6861747">255</span><span class="op" id="6861750">}</span><span class="op" id="6861751">}</span><span class="op" id="6861752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6861755">{</span><span class="op" id="6861756">[</span><span class="op" id="6861757">]</span><span class="builtintype" id="6861758">byte</span><span class="op" id="6861762">{</span><span class="num" id="6861763">0x11</span><span class="op" id="6861767">}</span><span class="op" id="6861768">,</span>&nbsp;<span class="num" id="6861770">9</span><span class="op" id="6861771">,</span>&nbsp;<span class="op" id="6861773">[</span><span class="op" id="6861774">]</span><span class="builtintype" id="6861775">byte</span><span class="op" id="6861779">{</span><span class="num" id="6861780">18</span><span class="op" id="6861782">,</span>&nbsp;<span class="num" id="6861784">4</span><span class="op" id="6861785">,</span>&nbsp;<span class="num" id="6861787">4</span><span class="op" id="6861788">,</span>&nbsp;<span class="num" id="6861790">0</span><span class="op" id="6861791">,</span>&nbsp;<span class="num" id="6861793">0</span><span class="op" id="6861794">,</span>&nbsp;<span class="num" id="6861796">255</span><span class="op" id="6861799">,</span>&nbsp;<span class="num" id="6861801">255</span><span class="op" id="6861804">}</span><span class="op" id="6861805">}</span><span class="op" id="6861806">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6861809">{</span><span class="op" id="6861810">[</span><span class="op" id="6861811">]</span><span class="builtintype" id="6861812">byte</span><span class="op" id="6861816">{</span><span class="num" id="6861817">0x11</span><span class="op" id="6861821">,</span>&nbsp;<span class="num" id="6861823">0x12</span><span class="op" id="6861827">}</span><span class="op" id="6861828">,</span>&nbsp;<span class="num" id="6861830">9</span><span class="op" id="6861831">,</span>&nbsp;<span class="op" id="6861833">[</span><span class="op" id="6861834">]</span><span class="builtintype" id="6861835">byte</span><span class="op" id="6861839">{</span><span class="num" id="6861840">18</span><span class="op" id="6861842">,</span>&nbsp;<span class="num" id="6861844">20</span><span class="op" id="6861846">,</span>&nbsp;<span class="num" id="6861848">2</span><span class="op" id="6861849">,</span>&nbsp;<span class="num" id="6861851">4</span><span class="op" id="6861852">,</span>&nbsp;<span class="num" id="6861854">0</span><span class="op" id="6861855">,</span>&nbsp;<span class="num" id="6861857">0</span><span class="op" id="6861858">,</span>&nbsp;<span class="num" id="6861860">255</span><span class="op" id="6861863">,</span>&nbsp;<span class="num" id="6861865">255</span><span class="op" id="6861868">}</span><span class="op" id="6861869">}</span><span class="op" id="6861870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6861873">{</span><span class="op" id="6861874">[</span><span class="op" id="6861875">]</span><span class="builtintype" id="6861876">byte</span><span class="op" id="6861880">{</span><span class="num" id="6861881">0x11</span><span class="op" id="6861885">,</span>&nbsp;<span class="num" id="6861887">0x11</span><span class="op" id="6861891">,</span>&nbsp;<span class="num" id="6861893">0x11</span><span class="op" id="6861897">,</span>&nbsp;<span class="num" id="6861899">0x11</span><span class="op" id="6861903">,</span>&nbsp;<span class="num" id="6861905">0x11</span><span class="op" id="6861909">,</span>&nbsp;<span class="num" id="6861911">0x11</span><span class="op" id="6861915">,</span>&nbsp;<span class="num" id="6861917">0x11</span><span class="op" id="6861921">,</span>&nbsp;<span class="num" id="6861923">0x11</span><span class="op" id="6861927">}</span><span class="op" id="6861928">,</span>&nbsp;<span class="num" id="6861930">9</span><span class="op" id="6861931">,</span>&nbsp;<span class="op" id="6861933">[</span><span class="op" id="6861934">]</span><span class="builtintype" id="6861935">byte</span><span class="op" id="6861939">{</span><span class="num" id="6861940">18</span><span class="op" id="6861942">,</span>&nbsp;<span class="num" id="6861944">132</span><span class="op" id="6861947">,</span>&nbsp;<span class="num" id="6861949">2</span><span class="op" id="6861950">,</span>&nbsp;<span class="num" id="6861952">64</span><span class="op" id="6861954">,</span>&nbsp;<span class="num" id="6861956">0</span><span class="op" id="6861957">,</span>&nbsp;<span class="num" id="6861959">0</span><span class="op" id="6861960">,</span>&nbsp;<span class="num" id="6861962">0</span><span class="op" id="6861963">,</span>&nbsp;<span class="num" id="6861965">255</span><span class="op" id="6861968">,</span>&nbsp;<span class="num" id="6861970">255</span><span class="op" id="6861973">}</span><span class="op" id="6861974">}</span><span class="op" id="6861975">,</span><br>
<span class="lineno"></span><span class="op" id="6861977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6861980">var</span>&nbsp;<span class="ident" id="6861984">deflateInflateTests</span>&nbsp;<span class="op" id="6862004">=</span>&nbsp;<span class="op" id="6862006">[</span><span class="op" id="6862007">]</span><span class="op" id="6862008">*</span><span class="ident" id="6862009">deflateInflateTest</span><span class="op" id="6862027">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862030">{</span><span class="op" id="6862031">[</span><span class="op" id="6862032">]</span><span class="builtintype" id="6862033">byte</span><span class="op" id="6862037">{</span><span class="op" id="6862038">}</span><span class="op" id="6862039">}</span><span class="op" id="6862040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862043">{</span><span class="op" id="6862044">[</span><span class="op" id="6862045">]</span><span class="builtintype" id="6862046">byte</span><span class="op" id="6862050">{</span><span class="num" id="6862051">0x11</span><span class="op" id="6862055">}</span><span class="op" id="6862056">}</span><span class="op" id="6862057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862060">{</span><span class="op" id="6862061">[</span><span class="op" id="6862062">]</span><span class="builtintype" id="6862063">byte</span><span class="op" id="6862067">{</span><span class="num" id="6862068">0x11</span><span class="op" id="6862072">,</span>&nbsp;<span class="num" id="6862074">0x12</span><span class="op" id="6862078">}</span><span class="op" id="6862079">}</span><span class="op" id="6862080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862083">{</span><span class="op" id="6862084">[</span><span class="op" id="6862085">]</span><span class="builtintype" id="6862086">byte</span><span class="op" id="6862090">{</span><span class="num" id="6862091">0x11</span><span class="op" id="6862095">,</span>&nbsp;<span class="num" id="6862097">0x11</span><span class="op" id="6862101">,</span>&nbsp;<span class="num" id="6862103">0x11</span><span class="op" id="6862107">,</span>&nbsp;<span class="num" id="6862109">0x11</span><span class="op" id="6862113">,</span>&nbsp;<span class="num" id="6862115">0x11</span><span class="op" id="6862119">,</span>&nbsp;<span class="num" id="6862121">0x11</span><span class="op" id="6862125">,</span>&nbsp;<span class="num" id="6862127">0x11</span><span class="op" id="6862131">,</span>&nbsp;<span class="num" id="6862133">0x11</span><span class="op" id="6862137">}</span><span class="op" id="6862138">}</span><span class="op" id="6862139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862142">{</span><span class="op" id="6862143">[</span><span class="op" id="6862144">]</span><span class="builtintype" id="6862145">byte</span><span class="op" id="6862149">{</span><span class="num" id="6862150">0x11</span><span class="op" id="6862154">,</span>&nbsp;<span class="num" id="6862156">0x10</span><span class="op" id="6862160">,</span>&nbsp;<span class="num" id="6862162">0x13</span><span class="op" id="6862166">,</span>&nbsp;<span class="num" id="6862168">0x41</span><span class="op" id="6862172">,</span>&nbsp;<span class="num" id="6862174">0x21</span><span class="op" id="6862178">,</span>&nbsp;<span class="num" id="6862180">0x21</span><span class="op" id="6862184">,</span>&nbsp;<span class="num" id="6862186">0x41</span><span class="op" id="6862190">,</span>&nbsp;<span class="num" id="6862192">0x13</span><span class="op" id="6862196">,</span>&nbsp;<span class="num" id="6862198">0x87</span><span class="op" id="6862202">,</span>&nbsp;<span class="num" id="6862204">0x78</span><span class="op" id="6862208">,</span>&nbsp;<span class="num" id="6862210">0x13</span><span class="op" id="6862214">}</span><span class="op" id="6862215">}</span><span class="op" id="6862216">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862219">{</span><span class="ident" id="6862220">largeDataChunk</span><span class="op" id="6862234">(</span><span class="op" id="6862235">)</span><span class="op" id="6862236">}</span><span class="op" id="6862237">,</span><br>
<span class="lineno"></span><span class="op" id="6862239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6862242">var</span>&nbsp;<span class="ident" id="6862246">reverseBitsTests</span>&nbsp;<span class="op" id="6862263">=</span>&nbsp;<span class="op" id="6862265">[</span><span class="op" id="6862266">]</span><span class="op" id="6862267">*</span><span class="ident" id="6862268">reverseBitsTest</span><span class="op" id="6862283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862286">{</span><span class="num" id="6862287">1</span><span class="op" id="6862288">,</span>&nbsp;<span class="num" id="6862290">1</span><span class="op" id="6862291">,</span>&nbsp;<span class="num" id="6862293">1</span><span class="op" id="6862294">}</span><span class="op" id="6862295">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862298">{</span><span class="num" id="6862299">1</span><span class="op" id="6862300">,</span>&nbsp;<span class="num" id="6862302">2</span><span class="op" id="6862303">,</span>&nbsp;<span class="num" id="6862305">2</span><span class="op" id="6862306">}</span><span class="op" id="6862307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862310">{</span><span class="num" id="6862311">1</span><span class="op" id="6862312">,</span>&nbsp;<span class="num" id="6862314">3</span><span class="op" id="6862315">,</span>&nbsp;<span class="num" id="6862317">4</span><span class="op" id="6862318">}</span><span class="op" id="6862319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862322">{</span><span class="num" id="6862323">1</span><span class="op" id="6862324">,</span>&nbsp;<span class="num" id="6862326">4</span><span class="op" id="6862327">,</span>&nbsp;<span class="num" id="6862329">8</span><span class="op" id="6862330">}</span><span class="op" id="6862331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862334">{</span><span class="num" id="6862335">1</span><span class="op" id="6862336">,</span>&nbsp;<span class="num" id="6862338">5</span><span class="op" id="6862339">,</span>&nbsp;<span class="num" id="6862341">16</span><span class="op" id="6862343">}</span><span class="op" id="6862344">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862347">{</span><span class="num" id="6862348">17</span><span class="op" id="6862350">,</span>&nbsp;<span class="num" id="6862352">5</span><span class="op" id="6862353">,</span>&nbsp;<span class="num" id="6862355">17</span><span class="op" id="6862357">}</span><span class="op" id="6862358">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862361">{</span><span class="num" id="6862362">257</span><span class="op" id="6862365">,</span>&nbsp;<span class="num" id="6862367">9</span><span class="op" id="6862368">,</span>&nbsp;<span class="num" id="6862370">257</span><span class="op" id="6862373">}</span><span class="op" id="6862374">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862377">{</span><span class="num" id="6862378">29</span><span class="op" id="6862380">,</span>&nbsp;<span class="num" id="6862382">5</span><span class="op" id="6862383">,</span>&nbsp;<span class="num" id="6862385">23</span><span class="op" id="6862387">}</span><span class="op" id="6862388">,</span><br>
<span class="lineno"></span><span class="op" id="6862390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6862393">func</span>&nbsp;<span class="ident" id="6862398">largeDataChunk</span><span class="op" id="6862412">(</span><span class="op" id="6862413">)</span>&nbsp;<span class="op" id="6862415">[</span><span class="op" id="6862416">]</span><span class="builtintype" id="6862417">byte</span>&nbsp;<span class="op" id="6862422">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6862425">result</span>&nbsp;<span class="op" id="6862432">:=</span>&nbsp;<span class="builtinfunc" id="6862435">make</span><span class="op" id="6862439">(</span><span class="op" id="6862440">[</span><span class="op" id="6862441">]</span><span class="builtintype" id="6862442">byte</span><span class="op" id="6862446">,</span>&nbsp;<span class="num" id="6862448">100000</span><span class="op" id="6862454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6862457">for</span>&nbsp;<span class="ident" id="6862461">i</span>&nbsp;<span class="op" id="6862463">:=</span>&nbsp;<span class="keyword" id="6862466">range</span>&nbsp;<span class="ident" id="6862472">result</span>&nbsp;<span class="op" id="6862479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6862483">result</span><span class="op" id="6862489">[</span><span class="ident" id="6862490">i</span><span class="op" id="6862491">]</span>&nbsp;<span class="op" id="6862493">=</span>&nbsp;<span class="builtintype" id="6862495">byte</span><span class="op" id="6862499">(</span><span class="ident" id="6862500">i</span>&nbsp;<span class="op" id="6862502">*</span>&nbsp;<span class="ident" id="6862504">i</span>&nbsp;<span class="op" id="6862506">&amp;</span>&nbsp;<span class="num" id="6862508">0xFF</span><span class="op" id="6862512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6862518">return</span>&nbsp;<span class="ident" id="6862525">result</span><br>
<span class="lineno">80</span><span class="op" id="6862532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6862535">func</span>&nbsp;<span class="ident" id="6862540">TestDeflate</span><span class="op" id="6862551">(</span><span class="ident" id="6862552">t</span>&nbsp;<span class="op" id="6862554">*</span><span class="ident" id="6862555">testing</span><span class="op" id="6862562">.</span><span class="ident" id="6862563">T</span><span class="op" id="6862564">)</span>&nbsp;<span class="op" id="6862566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6862569">for</span>&nbsp;<span class="ident" id="6862573">_</span><span class="op" id="6862574">,</span>&nbsp;<span class="ident" id="6862576">h</span>&nbsp;<span class="op" id="6862578">:=</span>&nbsp;<span class="keyword" id="6862581">range</span>&nbsp;<span class="ident" id="6862587">deflateTests</span>&nbsp;<span class="op" id="6862600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6862604">var</span>&nbsp;<span class="ident" id="6862608">buf</span>&nbsp;<span class="ident" id="6862612">bytes</span><span class="op" id="6862617">.</span><span class="ident" id="6862618">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6862627">w</span><span class="op" id="6862628">,</span>&nbsp;<span class="ident" id="6862630">err</span>&nbsp;<span class="op" id="6862634">:=</span>&nbsp;<span class="ident" id="6862637">NewWriter</span><span class="op" id="6862646">(</span><span class="op" id="6862647">&amp;</span><span class="ident" id="6862648">buf</span><span class="op" id="6862651">,</span>&nbsp;<span class="ident" id="6862653">h</span><span class="op" id="6862654">.</span><span class="ident" id="6862655">level</span><span class="op" id="6862660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6862664">if</span>&nbsp;<span class="ident" id="6862667">err</span>&nbsp;<span class="op" id="6862671">!=</span>&nbsp;<span class="ident" id="6862674">nil</span>&nbsp;<span class="op" id="6862678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6862683">t</span><span class="op" id="6862684">.</span><span class="ident" id="6862685">Errorf</span><span class="op" id="6862691">(</span><span class="string" id="6862692">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6862707">,</span>&nbsp;<span class="ident" id="6862709">err</span><span class="op" id="6862712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6862717">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862728">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6862732">w</span><span class="op" id="6862733">.</span><span class="ident" id="6862734">Write</span><span class="op" id="6862739">(</span><span class="ident" id="6862740">h</span><span class="op" id="6862741">.</span><span class="ident" id="6862742">in</span><span class="op" id="6862744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6862748">w</span><span class="op" id="6862749">.</span><span class="ident" id="6862750">Close</span><span class="op" id="6862755">(</span><span class="op" id="6862756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6862760">if</span>&nbsp;<span class="op" id="6862763">!</span><span class="ident" id="6862764">bytes</span><span class="op" id="6862769">.</span><span class="ident" id="6862770">Equal</span><span class="op" id="6862775">(</span><span class="ident" id="6862776">buf</span><span class="op" id="6862779">.</span><span class="ident" id="6862780">Bytes</span><span class="op" id="6862785">(</span><span class="op" id="6862786">)</span><span class="op" id="6862787">,</span>&nbsp;<span class="ident" id="6862789">h</span><span class="op" id="6862790">.</span><span class="ident" id="6862791">out</span><span class="op" id="6862794">)</span>&nbsp;<span class="op" id="6862796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6862801">t</span><span class="op" id="6862802">.</span><span class="ident" id="6862803">Errorf</span><span class="op" id="6862809">(</span><span class="string" id="6862810">&#34;Deflate(%d,&nbsp;%x)&nbsp;=&nbsp;%x,&nbsp;want&nbsp;%x&#34;</span><span class="op" id="6862841">,</span>&nbsp;<span class="ident" id="6862843">h</span><span class="op" id="6862844">.</span><span class="ident" id="6862845">level</span><span class="op" id="6862850">,</span>&nbsp;<span class="ident" id="6862852">h</span><span class="op" id="6862853">.</span><span class="ident" id="6862854">in</span><span class="op" id="6862856">,</span>&nbsp;<span class="ident" id="6862858">buf</span><span class="op" id="6862861">.</span><span class="ident" id="6862862">Bytes</span><span class="op" id="6862867">(</span><span class="op" id="6862868">)</span><span class="op" id="6862869">,</span>&nbsp;<span class="ident" id="6862871">h</span><span class="op" id="6862872">.</span><span class="ident" id="6862873">out</span><span class="op" id="6862876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862880">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6862883">}</span><br>
<span class="lineno"></span><span class="op" id="6862885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6862888">//&nbsp;A&nbsp;sparseReader&nbsp;returns&nbsp;a&nbsp;stream&nbsp;consisting&nbsp;of&nbsp;0s&nbsp;followed&nbsp;by&nbsp;1&lt;&lt;16&nbsp;1s.</span><br>
<span class="lineno"></span><span class="comment" id="6862962">//&nbsp;This&nbsp;tests&nbsp;missing&nbsp;hash&nbsp;references&nbsp;in&nbsp;a&nbsp;very&nbsp;large&nbsp;input.</span><br>
<span class="lineno">100</span><span class="keyword" id="6863023">type</span>&nbsp;<span class="ident" id="6863028">sparseReader</span>&nbsp;<span class="keyword" id="6863041">struct</span>&nbsp;<span class="op" id="6863048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863051">l</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6863055">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863062">cur</span>&nbsp;<span class="ident" id="6863066">int64</span><br>
<span class="lineno"></span><span class="op" id="6863072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6863075">func</span>&nbsp;<span class="op" id="6863080">(</span><span class="ident" id="6863081">r</span>&nbsp;<span class="op" id="6863083">*</span><span class="ident" id="6863084">sparseReader</span><span class="op" id="6863096">)</span>&nbsp;<span class="ident" id="6863098">Read</span><span class="op" id="6863102">(</span><span class="ident" id="6863103">b</span>&nbsp;<span class="op" id="6863105">[</span><span class="op" id="6863106">]</span><span class="builtintype" id="6863107">byte</span><span class="op" id="6863111">)</span>&nbsp;<span class="op" id="6863113">(</span><span class="ident" id="6863114">n</span>&nbsp;<span class="builtintype" id="6863116">int</span><span class="op" id="6863119">,</span>&nbsp;<span class="ident" id="6863121">err</span>&nbsp;<span class="builtintype" id="6863125">error</span><span class="op" id="6863130">)</span>&nbsp;<span class="op" id="6863132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6863135">if</span>&nbsp;<span class="ident" id="6863138">r</span><span class="op" id="6863139">.</span><span class="ident" id="6863140">cur</span>&nbsp;<span class="op" id="6863144">&gt;=</span>&nbsp;<span class="ident" id="6863147">r</span><span class="op" id="6863148">.</span><span class="ident" id="6863149">l</span>&nbsp;<span class="op" id="6863151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6863155">return</span>&nbsp;<span class="num" id="6863162">0</span><span class="op" id="6863163">,</span>&nbsp;<span class="ident" id="6863165">io</span><span class="op" id="6863167">.</span><span class="ident" id="6863168">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6863173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863176">n</span>&nbsp;<span class="op" id="6863178">=</span>&nbsp;<span class="builtinfunc" id="6863180">len</span><span class="op" id="6863183">(</span><span class="ident" id="6863184">b</span><span class="op" id="6863185">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863188">cur</span>&nbsp;<span class="op" id="6863192">:=</span>&nbsp;<span class="ident" id="6863195">r</span><span class="op" id="6863196">.</span><span class="ident" id="6863197">cur</span>&nbsp;<span class="op" id="6863201">+</span>&nbsp;<span class="ident" id="6863203">int64</span><span class="op" id="6863208">(</span><span class="ident" id="6863209">n</span><span class="op" id="6863210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6863213">if</span>&nbsp;<span class="ident" id="6863216">cur</span>&nbsp;<span class="op" id="6863220">&gt;</span>&nbsp;<span class="ident" id="6863222">r</span><span class="op" id="6863223">.</span><span class="ident" id="6863224">l</span>&nbsp;<span class="op" id="6863226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863230">n</span>&nbsp;<span class="op" id="6863232">-=</span>&nbsp;<span class="builtintype" id="6863235">int</span><span class="op" id="6863238">(</span><span class="ident" id="6863239">cur</span>&nbsp;<span class="op" id="6863243">-</span>&nbsp;<span class="ident" id="6863245">r</span><span class="op" id="6863246">.</span><span class="ident" id="6863247">l</span><span class="op" id="6863248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863252">cur</span>&nbsp;<span class="op" id="6863256">=</span>&nbsp;<span class="ident" id="6863258">r</span><span class="op" id="6863259">.</span><span class="ident" id="6863260">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6863263">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6863266">for</span>&nbsp;<span class="ident" id="6863270">i</span>&nbsp;<span class="op" id="6863272">:=</span>&nbsp;<span class="keyword" id="6863275">range</span>&nbsp;<span class="ident" id="6863281">b</span><span class="op" id="6863282">[</span><span class="num" id="6863283">0</span><span class="op" id="6863284">:</span><span class="ident" id="6863285">n</span><span class="op" id="6863286">]</span>&nbsp;<span class="op" id="6863288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6863292">if</span>&nbsp;<span class="ident" id="6863295">r</span><span class="op" id="6863296">.</span><span class="ident" id="6863297">cur</span><span class="op" id="6863300">+</span><span class="ident" id="6863301">int64</span><span class="op" id="6863306">(</span><span class="ident" id="6863307">i</span><span class="op" id="6863308">)</span>&nbsp;<span class="op" id="6863310">&gt;=</span>&nbsp;<span class="ident" id="6863313">r</span><span class="op" id="6863314">.</span><span class="ident" id="6863315">l</span><span class="op" id="6863316">-</span><span class="num" id="6863317">1</span><span class="op" id="6863318">&lt;&lt;</span><span class="num" id="6863320">16</span>&nbsp;<span class="op" id="6863323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863328">b</span><span class="op" id="6863329">[</span><span class="ident" id="6863330">i</span><span class="op" id="6863331">]</span>&nbsp;<span class="op" id="6863333">=</span>&nbsp;<span class="num" id="6863335">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6863339">}</span>&nbsp;<span class="keyword" id="6863341">else</span>&nbsp;<span class="op" id="6863346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863351">b</span><span class="op" id="6863352">[</span><span class="ident" id="6863353">i</span><span class="op" id="6863354">]</span>&nbsp;<span class="op" id="6863356">=</span>&nbsp;<span class="num" id="6863358">0</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6863362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6863365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863368">r</span><span class="op" id="6863369">.</span><span class="ident" id="6863370">cur</span>&nbsp;<span class="op" id="6863374">=</span>&nbsp;<span class="ident" id="6863376">cur</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6863381">return</span><br>
<span class="lineno"></span><span class="op" id="6863388">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="6863391">func</span>&nbsp;<span class="ident" id="6863396">TestVeryLongSparseChunk</span><span class="op" id="6863419">(</span><span class="ident" id="6863420">t</span>&nbsp;<span class="op" id="6863422">*</span><span class="ident" id="6863423">testing</span><span class="op" id="6863430">.</span><span class="ident" id="6863431">T</span><span class="op" id="6863432">)</span>&nbsp;<span class="op" id="6863434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6863437">if</span>&nbsp;<span class="ident" id="6863440">testing</span><span class="op" id="6863447">.</span><span class="ident" id="6863448">Short</span><span class="op" id="6863453">(</span><span class="op" id="6863454">)</span>&nbsp;<span class="op" id="6863456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863460">t</span><span class="op" id="6863461">.</span><span class="ident" id="6863462">Skip</span><span class="op" id="6863466">(</span><span class="string" id="6863467">&#34;skipping&nbsp;sparse&nbsp;chunk&nbsp;during&nbsp;short&nbsp;test&#34;</span><span class="op" id="6863508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6863511">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863514">w</span><span class="op" id="6863515">,</span>&nbsp;<span class="ident" id="6863517">err</span>&nbsp;<span class="op" id="6863521">:=</span>&nbsp;<span class="ident" id="6863524">NewWriter</span><span class="op" id="6863533">(</span><span class="ident" id="6863534">ioutil</span><span class="op" id="6863540">.</span><span class="ident" id="6863541">Discard</span><span class="op" id="6863548">,</span>&nbsp;<span class="num" id="6863550">1</span><span class="op" id="6863551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6863554">if</span>&nbsp;<span class="ident" id="6863557">err</span>&nbsp;<span class="op" id="6863561">!=</span>&nbsp;<span class="ident" id="6863564">nil</span>&nbsp;<span class="op" id="6863568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863572">t</span><span class="op" id="6863573">.</span><span class="ident" id="6863574">Errorf</span><span class="op" id="6863580">(</span><span class="string" id="6863581">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6863596">,</span>&nbsp;<span class="ident" id="6863598">err</span><span class="op" id="6863601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6863605">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6863613">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6863616">if</span>&nbsp;<span class="ident" id="6863619">_</span><span class="op" id="6863620">,</span>&nbsp;<span class="ident" id="6863622">err</span>&nbsp;<span class="op" id="6863626">=</span>&nbsp;<span class="ident" id="6863628">io</span><span class="op" id="6863630">.</span><span class="ident" id="6863631">Copy</span><span class="op" id="6863635">(</span><span class="ident" id="6863636">w</span><span class="op" id="6863637">,</span>&nbsp;<span class="op" id="6863639">&amp;</span><span class="ident" id="6863640">sparseReader</span><span class="op" id="6863652">{</span><span class="ident" id="6863653">l</span><span class="op" id="6863654">:</span>&nbsp;<span class="num" id="6863656">23E8</span><span class="op" id="6863660">}</span><span class="op" id="6863661">)</span><span class="op" id="6863662">;</span>&nbsp;<span class="ident" id="6863664">err</span>&nbsp;<span class="op" id="6863668">!=</span>&nbsp;<span class="ident" id="6863671">nil</span>&nbsp;<span class="op" id="6863675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863679">t</span><span class="op" id="6863680">.</span><span class="ident" id="6863681">Errorf</span><span class="op" id="6863687">(</span><span class="string" id="6863688">&#34;Compress&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6863709">,</span>&nbsp;<span class="ident" id="6863711">err</span><span class="op" id="6863714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6863718">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6863726">}</span><br>
<span class="lineno"></span><span class="op" id="6863728">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="6863731">type</span>&nbsp;<span class="ident" id="6863736">syncBuffer</span>&nbsp;<span class="keyword" id="6863747">struct</span>&nbsp;<span class="op" id="6863754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863757">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6863764">bytes</span><span class="op" id="6863769">.</span><span class="ident" id="6863770">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863778">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6863785">sync</span><span class="op" id="6863789">.</span><span class="ident" id="6863790">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863799">closed</span>&nbsp;<span class="builtintype" id="6863806">bool</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863812">ready</span>&nbsp;&nbsp;<span class="keyword" id="6863819">chan</span>&nbsp;<span class="builtintype" id="6863824">bool</span><br>
<span class="lineno"></span><span class="op" id="6863829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6863832">func</span>&nbsp;<span class="ident" id="6863837">newSyncBuffer</span><span class="op" id="6863850">(</span><span class="op" id="6863851">)</span>&nbsp;<span class="op" id="6863853">*</span><span class="ident" id="6863854">syncBuffer</span>&nbsp;<span class="op" id="6863865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6863868">return</span>&nbsp;<span class="op" id="6863875">&amp;</span><span class="ident" id="6863876">syncBuffer</span><span class="op" id="6863886">{</span><span class="ident" id="6863887">ready</span><span class="op" id="6863892">:</span>&nbsp;<span class="builtinfunc" id="6863894">make</span><span class="op" id="6863898">(</span><span class="keyword" id="6863899">chan</span>&nbsp;<span class="builtintype" id="6863904">bool</span><span class="op" id="6863908">,</span>&nbsp;<span class="num" id="6863910">1</span><span class="op" id="6863911">)</span><span class="op" id="6863912">}</span><br>
<span class="lineno">150</span><span class="op" id="6863914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6863917">func</span>&nbsp;<span class="op" id="6863922">(</span><span class="ident" id="6863923">b</span>&nbsp;<span class="op" id="6863925">*</span><span class="ident" id="6863926">syncBuffer</span><span class="op" id="6863936">)</span>&nbsp;<span class="ident" id="6863938">Read</span><span class="op" id="6863942">(</span><span class="ident" id="6863943">p</span>&nbsp;<span class="op" id="6863945">[</span><span class="op" id="6863946">]</span><span class="builtintype" id="6863947">byte</span><span class="op" id="6863951">)</span>&nbsp;<span class="op" id="6863953">(</span><span class="ident" id="6863954">n</span>&nbsp;<span class="builtintype" id="6863956">int</span><span class="op" id="6863959">,</span>&nbsp;<span class="ident" id="6863961">err</span>&nbsp;<span class="builtintype" id="6863965">error</span><span class="op" id="6863970">)</span>&nbsp;<span class="op" id="6863972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6863975">for</span>&nbsp;<span class="op" id="6863979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863983">b</span><span class="op" id="6863984">.</span><span class="ident" id="6863985">mu</span><span class="op" id="6863987">.</span><span class="ident" id="6863988">RLock</span><span class="op" id="6863993">(</span><span class="op" id="6863994">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6863998">n</span><span class="op" id="6863999">,</span>&nbsp;<span class="ident" id="6864001">err</span>&nbsp;<span class="op" id="6864005">=</span>&nbsp;<span class="ident" id="6864007">b</span><span class="op" id="6864008">.</span><span class="ident" id="6864009">buf</span><span class="op" id="6864012">.</span><span class="ident" id="6864013">Read</span><span class="op" id="6864017">(</span><span class="ident" id="6864018">p</span><span class="op" id="6864019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864023">b</span><span class="op" id="6864024">.</span><span class="ident" id="6864025">mu</span><span class="op" id="6864027">.</span><span class="ident" id="6864028">RUnlock</span><span class="op" id="6864035">(</span><span class="op" id="6864036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864040">if</span>&nbsp;<span class="ident" id="6864043">n</span>&nbsp;<span class="op" id="6864045">&gt;</span>&nbsp;<span class="num" id="6864047">0</span>&nbsp;<span class="op" id="6864049">||</span>&nbsp;<span class="ident" id="6864052">b</span><span class="op" id="6864053">.</span><span class="ident" id="6864054">closed</span>&nbsp;<span class="op" id="6864061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864066">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6864075">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6864079">&lt;-</span><span class="ident" id="6864081">b</span><span class="op" id="6864082">.</span><span class="ident" id="6864083">ready</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6864090">}</span><br>
<span class="lineno"></span><span class="op" id="6864092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6864095">func</span>&nbsp;<span class="op" id="6864100">(</span><span class="ident" id="6864101">b</span>&nbsp;<span class="op" id="6864103">*</span><span class="ident" id="6864104">syncBuffer</span><span class="op" id="6864114">)</span>&nbsp;<span class="ident" id="6864116">signal</span><span class="op" id="6864122">(</span><span class="op" id="6864123">)</span>&nbsp;<span class="op" id="6864125">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864128">select</span>&nbsp;<span class="op" id="6864135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864138">case</span>&nbsp;<span class="ident" id="6864143">b</span><span class="op" id="6864144">.</span><span class="ident" id="6864145">ready</span>&nbsp;<span class="op" id="6864151">&lt;-</span>&nbsp;<span class="builtintype" id="6864154">true</span><span class="op" id="6864158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864161">default</span><span class="op" id="6864168">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6864171">}</span><br>
<span class="lineno"></span><span class="op" id="6864173">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6864176">func</span>&nbsp;<span class="op" id="6864181">(</span><span class="ident" id="6864182">b</span>&nbsp;<span class="op" id="6864184">*</span><span class="ident" id="6864185">syncBuffer</span><span class="op" id="6864195">)</span>&nbsp;<span class="ident" id="6864197">Write</span><span class="op" id="6864202">(</span><span class="ident" id="6864203">p</span>&nbsp;<span class="op" id="6864205">[</span><span class="op" id="6864206">]</span><span class="builtintype" id="6864207">byte</span><span class="op" id="6864211">)</span>&nbsp;<span class="op" id="6864213">(</span><span class="ident" id="6864214">n</span>&nbsp;<span class="builtintype" id="6864216">int</span><span class="op" id="6864219">,</span>&nbsp;<span class="ident" id="6864221">err</span>&nbsp;<span class="builtintype" id="6864225">error</span><span class="op" id="6864230">)</span>&nbsp;<span class="op" id="6864232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864235">n</span><span class="op" id="6864236">,</span>&nbsp;<span class="ident" id="6864238">err</span>&nbsp;<span class="op" id="6864242">=</span>&nbsp;<span class="ident" id="6864244">b</span><span class="op" id="6864245">.</span><span class="ident" id="6864246">buf</span><span class="op" id="6864249">.</span><span class="ident" id="6864250">Write</span><span class="op" id="6864255">(</span><span class="ident" id="6864256">p</span><span class="op" id="6864257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864260">b</span><span class="op" id="6864261">.</span><span class="ident" id="6864262">signal</span><span class="op" id="6864268">(</span><span class="op" id="6864269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864272">return</span><br>
<span class="lineno">175</span><span class="op" id="6864279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6864282">func</span>&nbsp;<span class="op" id="6864287">(</span><span class="ident" id="6864288">b</span>&nbsp;<span class="op" id="6864290">*</span><span class="ident" id="6864291">syncBuffer</span><span class="op" id="6864301">)</span>&nbsp;<span class="ident" id="6864303">WriteMode</span><span class="op" id="6864312">(</span><span class="op" id="6864313">)</span>&nbsp;<span class="op" id="6864315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864318">b</span><span class="op" id="6864319">.</span><span class="ident" id="6864320">mu</span><span class="op" id="6864322">.</span><span class="ident" id="6864323">Lock</span><span class="op" id="6864327">(</span><span class="op" id="6864328">)</span><br>
<span class="lineno"></span><span class="op" id="6864330">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="6864333">func</span>&nbsp;<span class="op" id="6864338">(</span><span class="ident" id="6864339">b</span>&nbsp;<span class="op" id="6864341">*</span><span class="ident" id="6864342">syncBuffer</span><span class="op" id="6864352">)</span>&nbsp;<span class="ident" id="6864354">ReadMode</span><span class="op" id="6864362">(</span><span class="op" id="6864363">)</span>&nbsp;<span class="op" id="6864365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864368">b</span><span class="op" id="6864369">.</span><span class="ident" id="6864370">mu</span><span class="op" id="6864372">.</span><span class="ident" id="6864373">Unlock</span><span class="op" id="6864379">(</span><span class="op" id="6864380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864383">b</span><span class="op" id="6864384">.</span><span class="ident" id="6864385">signal</span><span class="op" id="6864391">(</span><span class="op" id="6864392">)</span><br>
<span class="lineno"></span><span class="op" id="6864394">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="6864397">func</span>&nbsp;<span class="op" id="6864402">(</span><span class="ident" id="6864403">b</span>&nbsp;<span class="op" id="6864405">*</span><span class="ident" id="6864406">syncBuffer</span><span class="op" id="6864416">)</span>&nbsp;<span class="ident" id="6864418">Close</span><span class="op" id="6864423">(</span><span class="op" id="6864424">)</span>&nbsp;<span class="builtintype" id="6864426">error</span>&nbsp;<span class="op" id="6864432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864435">b</span><span class="op" id="6864436">.</span><span class="ident" id="6864437">closed</span>&nbsp;<span class="op" id="6864444">=</span>&nbsp;<span class="builtintype" id="6864446">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864452">b</span><span class="op" id="6864453">.</span><span class="ident" id="6864454">signal</span><span class="op" id="6864460">(</span><span class="op" id="6864461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864464">return</span>&nbsp;<span class="ident" id="6864471">nil</span><br>
<span class="lineno">190</span><span class="op" id="6864475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6864478">func</span>&nbsp;<span class="ident" id="6864483">testSync</span><span class="op" id="6864491">(</span><span class="ident" id="6864492">t</span>&nbsp;<span class="op" id="6864494">*</span><span class="ident" id="6864495">testing</span><span class="op" id="6864502">.</span><span class="ident" id="6864503">T</span><span class="op" id="6864504">,</span>&nbsp;<span class="ident" id="6864506">level</span>&nbsp;<span class="builtintype" id="6864512">int</span><span class="op" id="6864515">,</span>&nbsp;<span class="ident" id="6864517">input</span>&nbsp;<span class="op" id="6864523">[</span><span class="op" id="6864524">]</span><span class="builtintype" id="6864525">byte</span><span class="op" id="6864529">,</span>&nbsp;<span class="ident" id="6864531">name</span>&nbsp;<span class="builtintype" id="6864536">string</span><span class="op" id="6864542">)</span>&nbsp;<span class="op" id="6864544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864547">if</span>&nbsp;<span class="builtinfunc" id="6864550">len</span><span class="op" id="6864553">(</span><span class="ident" id="6864554">input</span><span class="op" id="6864559">)</span>&nbsp;<span class="op" id="6864561">==</span>&nbsp;<span class="num" id="6864564">0</span>&nbsp;<span class="op" id="6864566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864570">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6864578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864582">t</span><span class="op" id="6864583">.</span><span class="ident" id="6864584">Logf</span><span class="op" id="6864588">(</span><span class="string" id="6864589">&#34;--testSync&nbsp;%d,&nbsp;%d,&nbsp;%s&#34;</span><span class="op" id="6864612">,</span>&nbsp;<span class="ident" id="6864614">level</span><span class="op" id="6864619">,</span>&nbsp;<span class="builtinfunc" id="6864621">len</span><span class="op" id="6864624">(</span><span class="ident" id="6864625">input</span><span class="op" id="6864630">)</span><span class="op" id="6864631">,</span>&nbsp;<span class="ident" id="6864633">name</span><span class="op" id="6864637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864640">buf</span>&nbsp;<span class="op" id="6864644">:=</span>&nbsp;<span class="ident" id="6864647">newSyncBuffer</span><span class="op" id="6864660">(</span><span class="op" id="6864661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864664">buf1</span>&nbsp;<span class="op" id="6864669">:=</span>&nbsp;<span class="builtinfunc" id="6864672">new</span><span class="op" id="6864675">(</span><span class="ident" id="6864676">bytes</span><span class="op" id="6864681">.</span><span class="ident" id="6864682">Buffer</span><span class="op" id="6864688">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864691">buf</span><span class="op" id="6864694">.</span><span class="ident" id="6864695">WriteMode</span><span class="op" id="6864704">(</span><span class="op" id="6864705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864708">w</span><span class="op" id="6864709">,</span>&nbsp;<span class="ident" id="6864711">err</span>&nbsp;<span class="op" id="6864715">:=</span>&nbsp;<span class="ident" id="6864718">NewWriter</span><span class="op" id="6864727">(</span><span class="ident" id="6864728">io</span><span class="op" id="6864730">.</span><span class="ident" id="6864731">MultiWriter</span><span class="op" id="6864742">(</span><span class="ident" id="6864743">buf</span><span class="op" id="6864746">,</span>&nbsp;<span class="ident" id="6864748">buf1</span><span class="op" id="6864752">)</span><span class="op" id="6864753">,</span>&nbsp;<span class="ident" id="6864755">level</span><span class="op" id="6864760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864763">if</span>&nbsp;<span class="ident" id="6864766">err</span>&nbsp;<span class="op" id="6864770">!=</span>&nbsp;<span class="ident" id="6864773">nil</span>&nbsp;<span class="op" id="6864777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864781">t</span><span class="op" id="6864782">.</span><span class="ident" id="6864783">Errorf</span><span class="op" id="6864789">(</span><span class="string" id="6864790">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6864805">,</span>&nbsp;<span class="ident" id="6864807">err</span><span class="op" id="6864810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864814">return</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6864822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864825">r</span>&nbsp;<span class="op" id="6864827">:=</span>&nbsp;<span class="ident" id="6864830">NewReader</span><span class="op" id="6864839">(</span><span class="ident" id="6864840">buf</span><span class="op" id="6864843">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6864847">//&nbsp;Write&nbsp;half&nbsp;the&nbsp;input&nbsp;and&nbsp;read&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864887">for</span>&nbsp;<span class="ident" id="6864891">i</span>&nbsp;<span class="op" id="6864893">:=</span>&nbsp;<span class="num" id="6864896">0</span><span class="op" id="6864897">;</span>&nbsp;<span class="ident" id="6864899">i</span>&nbsp;<span class="op" id="6864901">&lt;</span>&nbsp;<span class="num" id="6864903">2</span><span class="op" id="6864904">;</span>&nbsp;<span class="ident" id="6864906">i</span><span class="op" id="6864907">++</span>&nbsp;<span class="op" id="6864910">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864914">var</span>&nbsp;<span class="ident" id="6864918">lo</span><span class="op" id="6864920">,</span>&nbsp;<span class="ident" id="6864922">hi</span>&nbsp;<span class="builtintype" id="6864925">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6864931">if</span>&nbsp;<span class="ident" id="6864934">i</span>&nbsp;<span class="op" id="6864936">==</span>&nbsp;<span class="num" id="6864939">0</span>&nbsp;<span class="op" id="6864941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864946">lo</span><span class="op" id="6864948">,</span>&nbsp;<span class="ident" id="6864950">hi</span>&nbsp;<span class="op" id="6864953">=</span>&nbsp;<span class="num" id="6864955">0</span><span class="op" id="6864956">,</span>&nbsp;<span class="op" id="6864958">(</span><span class="builtinfunc" id="6864959">len</span><span class="op" id="6864962">(</span><span class="ident" id="6864963">input</span><span class="op" id="6864968">)</span><span class="op" id="6864969">+</span><span class="num" id="6864970">1</span><span class="op" id="6864971">)</span><span class="op" id="6864972">/</span><span class="num" id="6864973">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6864977">}</span>&nbsp;<span class="keyword" id="6864979">else</span>&nbsp;<span class="op" id="6864984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6864989">lo</span><span class="op" id="6864991">,</span>&nbsp;<span class="ident" id="6864993">hi</span>&nbsp;<span class="op" id="6864996">=</span>&nbsp;<span class="op" id="6864998">(</span><span class="builtinfunc" id="6864999">len</span><span class="op" id="6865002">(</span><span class="ident" id="6865003">input</span><span class="op" id="6865008">)</span><span class="op" id="6865009">+</span><span class="num" id="6865010">1</span><span class="op" id="6865011">)</span><span class="op" id="6865012">/</span><span class="num" id="6865013">2</span><span class="op" id="6865014">,</span>&nbsp;<span class="builtinfunc" id="6865016">len</span><span class="op" id="6865019">(</span><span class="ident" id="6865020">input</span><span class="op" id="6865025">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6865029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865033">t</span><span class="op" id="6865034">.</span><span class="ident" id="6865035">Logf</span><span class="op" id="6865039">(</span><span class="string" id="6865040">&#34;#%d:&nbsp;write&nbsp;%d-%d&#34;</span><span class="op" id="6865058">,</span>&nbsp;<span class="ident" id="6865060">i</span><span class="op" id="6865061">,</span>&nbsp;<span class="ident" id="6865063">lo</span><span class="op" id="6865065">,</span>&nbsp;<span class="ident" id="6865067">hi</span><span class="op" id="6865069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865073">if</span>&nbsp;<span class="ident" id="6865076">_</span><span class="op" id="6865077">,</span>&nbsp;<span class="ident" id="6865079">err</span>&nbsp;<span class="op" id="6865083">:=</span>&nbsp;<span class="ident" id="6865086">w</span><span class="op" id="6865087">.</span><span class="ident" id="6865088">Write</span><span class="op" id="6865093">(</span><span class="ident" id="6865094">input</span><span class="op" id="6865099">[</span><span class="ident" id="6865100">lo</span><span class="op" id="6865102">:</span><span class="ident" id="6865103">hi</span><span class="op" id="6865105">]</span><span class="op" id="6865106">)</span><span class="op" id="6865107">;</span>&nbsp;<span class="ident" id="6865109">err</span>&nbsp;<span class="op" id="6865113">!=</span>&nbsp;<span class="ident" id="6865116">nil</span>&nbsp;<span class="op" id="6865120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865125">t</span><span class="op" id="6865126">.</span><span class="ident" id="6865127">Errorf</span><span class="op" id="6865133">(</span><span class="string" id="6865134">&#34;testSync:&nbsp;write:&nbsp;%v&#34;</span><span class="op" id="6865155">,</span>&nbsp;<span class="ident" id="6865157">err</span><span class="op" id="6865160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865165">return</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6865174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865178">if</span>&nbsp;<span class="ident" id="6865181">i</span>&nbsp;<span class="op" id="6865183">==</span>&nbsp;<span class="num" id="6865186">0</span>&nbsp;<span class="op" id="6865188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865193">if</span>&nbsp;<span class="ident" id="6865196">err</span>&nbsp;<span class="op" id="6865200">:=</span>&nbsp;<span class="ident" id="6865203">w</span><span class="op" id="6865204">.</span><span class="ident" id="6865205">Flush</span><span class="op" id="6865210">(</span><span class="op" id="6865211">)</span><span class="op" id="6865212">;</span>&nbsp;<span class="ident" id="6865214">err</span>&nbsp;<span class="op" id="6865218">!=</span>&nbsp;<span class="ident" id="6865221">nil</span>&nbsp;<span class="op" id="6865225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865231">t</span><span class="op" id="6865232">.</span><span class="ident" id="6865233">Errorf</span><span class="op" id="6865239">(</span><span class="string" id="6865240">&#34;testSync:&nbsp;flush:&nbsp;%v&#34;</span><span class="op" id="6865261">,</span>&nbsp;<span class="ident" id="6865263">err</span><span class="op" id="6865266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865272">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6865282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6865286">}</span>&nbsp;<span class="keyword" id="6865288">else</span>&nbsp;<span class="op" id="6865293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865298">if</span>&nbsp;<span class="ident" id="6865301">err</span>&nbsp;<span class="op" id="6865305">:=</span>&nbsp;<span class="ident" id="6865308">w</span><span class="op" id="6865309">.</span><span class="ident" id="6865310">Close</span><span class="op" id="6865315">(</span><span class="op" id="6865316">)</span><span class="op" id="6865317">;</span>&nbsp;<span class="ident" id="6865319">err</span>&nbsp;<span class="op" id="6865323">!=</span>&nbsp;<span class="ident" id="6865326">nil</span>&nbsp;<span class="op" id="6865330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865336">t</span><span class="op" id="6865337">.</span><span class="ident" id="6865338">Errorf</span><span class="op" id="6865344">(</span><span class="string" id="6865345">&#34;testSync:&nbsp;close:&nbsp;%v&#34;</span><span class="op" id="6865366">,</span>&nbsp;<span class="ident" id="6865368">err</span><span class="op" id="6865371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6865376">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6865380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865384">buf</span><span class="op" id="6865387">.</span><span class="ident" id="6865388">ReadMode</span><span class="op" id="6865396">(</span><span class="op" id="6865397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865401">out</span>&nbsp;<span class="op" id="6865405">:=</span>&nbsp;<span class="builtinfunc" id="6865408">make</span><span class="op" id="6865412">(</span><span class="op" id="6865413">[</span><span class="op" id="6865414">]</span><span class="builtintype" id="6865415">byte</span><span class="op" id="6865419">,</span>&nbsp;<span class="ident" id="6865421">hi</span><span class="op" id="6865423">-</span><span class="ident" id="6865424">lo</span><span class="op" id="6865426">+</span><span class="num" id="6865427">1</span><span class="op" id="6865428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865432">m</span><span class="op" id="6865433">,</span>&nbsp;<span class="ident" id="6865435">err</span>&nbsp;<span class="op" id="6865439">:=</span>&nbsp;<span class="ident" id="6865442">io</span><span class="op" id="6865444">.</span><span class="ident" id="6865445">ReadAtLeast</span><span class="op" id="6865456">(</span><span class="ident" id="6865457">r</span><span class="op" id="6865458">,</span>&nbsp;<span class="ident" id="6865460">out</span><span class="op" id="6865463">,</span>&nbsp;<span class="ident" id="6865465">hi</span><span class="op" id="6865467">-</span><span class="ident" id="6865468">lo</span><span class="op" id="6865470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865474">t</span><span class="op" id="6865475">.</span><span class="ident" id="6865476">Logf</span><span class="op" id="6865480">(</span><span class="string" id="6865481">&#34;#%d:&nbsp;read&nbsp;%d&#34;</span><span class="op" id="6865495">,</span>&nbsp;<span class="ident" id="6865497">i</span><span class="op" id="6865498">,</span>&nbsp;<span class="ident" id="6865500">m</span><span class="op" id="6865501">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865505">if</span>&nbsp;<span class="ident" id="6865508">m</span>&nbsp;<span class="op" id="6865510">!=</span>&nbsp;<span class="ident" id="6865513">hi</span><span class="op" id="6865515">-</span><span class="ident" id="6865516">lo</span>&nbsp;<span class="op" id="6865519">||</span>&nbsp;<span class="ident" id="6865522">err</span>&nbsp;<span class="op" id="6865526">!=</span>&nbsp;<span class="ident" id="6865529">nil</span>&nbsp;<span class="op" id="6865533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865538">t</span><span class="op" id="6865539">.</span><span class="ident" id="6865540">Errorf</span><span class="op" id="6865546">(</span><span class="string" id="6865547">&#34;testSync/%d&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;read&nbsp;%d:&nbsp;%d,&nbsp;%v&nbsp;(%d&nbsp;left)&#34;</span><span class="op" id="6865600">,</span>&nbsp;<span class="ident" id="6865602">i</span><span class="op" id="6865603">,</span>&nbsp;<span class="ident" id="6865605">level</span><span class="op" id="6865610">,</span>&nbsp;<span class="builtinfunc" id="6865612">len</span><span class="op" id="6865615">(</span><span class="ident" id="6865616">input</span><span class="op" id="6865621">)</span><span class="op" id="6865622">,</span>&nbsp;<span class="ident" id="6865624">name</span><span class="op" id="6865628">,</span>&nbsp;<span class="ident" id="6865630">hi</span><span class="op" id="6865632">-</span><span class="ident" id="6865633">lo</span><span class="op" id="6865635">,</span>&nbsp;<span class="ident" id="6865637">m</span><span class="op" id="6865638">,</span>&nbsp;<span class="ident" id="6865640">err</span><span class="op" id="6865643">,</span>&nbsp;<span class="ident" id="6865645">buf</span><span class="op" id="6865648">.</span><span class="ident" id="6865649">buf</span><span class="op" id="6865652">.</span><span class="ident" id="6865653">Len</span><span class="op" id="6865656">(</span><span class="op" id="6865657">)</span><span class="op" id="6865658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865663">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6865672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865676">if</span>&nbsp;<span class="op" id="6865679">!</span><span class="ident" id="6865680">bytes</span><span class="op" id="6865685">.</span><span class="ident" id="6865686">Equal</span><span class="op" id="6865691">(</span><span class="ident" id="6865692">input</span><span class="op" id="6865697">[</span><span class="ident" id="6865698">lo</span><span class="op" id="6865700">:</span><span class="ident" id="6865701">hi</span><span class="op" id="6865703">]</span><span class="op" id="6865704">,</span>&nbsp;<span class="ident" id="6865706">out</span><span class="op" id="6865709">[</span><span class="op" id="6865710">:</span><span class="ident" id="6865711">hi</span><span class="op" id="6865713">-</span><span class="ident" id="6865714">lo</span><span class="op" id="6865716">]</span><span class="op" id="6865717">)</span>&nbsp;<span class="op" id="6865719">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6865724">t</span><span class="op" id="6865725">.</span><span class="ident" id="6865726">Errorf</span><span class="op" id="6865732">(</span><span class="string" id="6865733">&#34;testSync/%d:&nbsp;read&nbsp;wrong&nbsp;bytes:&nbsp;%x&nbsp;vs&nbsp;%x&#34;</span><span class="op" id="6865774">,</span>&nbsp;<span class="ident" id="6865776">i</span><span class="op" id="6865777">,</span>&nbsp;<span class="ident" id="6865779">input</span><span class="op" id="6865784">[</span><span class="ident" id="6865785">lo</span><span class="op" id="6865787">:</span><span class="ident" id="6865788">hi</span><span class="op" id="6865790">]</span><span class="op" id="6865791">,</span>&nbsp;<span class="ident" id="6865793">out</span><span class="op" id="6865796">[</span><span class="op" id="6865797">:</span><span class="ident" id="6865798">hi</span><span class="op" id="6865800">-</span><span class="ident" id="6865801">lo</span><span class="op" id="6865803">]</span><span class="op" id="6865804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6865809">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6865818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6865822">//&nbsp;This&nbsp;test&nbsp;originally&nbsp;checked&nbsp;that&nbsp;after&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6865875">//&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;input,&nbsp;there&nbsp;was&nbsp;nothing&nbsp;left</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6865932">//&nbsp;in&nbsp;the&nbsp;read&nbsp;buffer&nbsp;(buf.buf.Len()&nbsp;!=&nbsp;0)&nbsp;but&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6865989">//&nbsp;not&nbsp;necessarily&nbsp;the&nbsp;case:&nbsp;the&nbsp;write&nbsp;Flush&nbsp;may&nbsp;emit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6866045">//&nbsp;some&nbsp;extra&nbsp;framing&nbsp;bits&nbsp;that&nbsp;are&nbsp;not&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6866097">//&nbsp;to&nbsp;process&nbsp;to&nbsp;obtain&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;uncompressed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6866158">//&nbsp;data.&nbsp;&nbsp;The&nbsp;test&nbsp;ran&nbsp;correctly&nbsp;most&nbsp;of&nbsp;the&nbsp;time,&nbsp;because</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6866219">//&nbsp;the&nbsp;background&nbsp;goroutine&nbsp;had&nbsp;usually&nbsp;read&nbsp;even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6866271">//&nbsp;those&nbsp;extra&nbsp;bits&nbsp;by&nbsp;now,&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;useful&nbsp;thing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6866332">//&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6866344">buf</span><span class="op" id="6866347">.</span><span class="ident" id="6866348">WriteMode</span><span class="op" id="6866357">(</span><span class="op" id="6866358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6866361">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6866364">buf</span><span class="op" id="6866367">.</span><span class="ident" id="6866368">ReadMode</span><span class="op" id="6866376">(</span><span class="op" id="6866377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6866380">out</span>&nbsp;<span class="op" id="6866384">:=</span>&nbsp;<span class="builtinfunc" id="6866387">make</span><span class="op" id="6866391">(</span><span class="op" id="6866392">[</span><span class="op" id="6866393">]</span><span class="builtintype" id="6866394">byte</span><span class="op" id="6866398">,</span>&nbsp;<span class="num" id="6866400">10</span><span class="op" id="6866402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6866405">if</span>&nbsp;<span class="ident" id="6866408">n</span><span class="op" id="6866409">,</span>&nbsp;<span class="ident" id="6866411">err</span>&nbsp;<span class="op" id="6866415">:=</span>&nbsp;<span class="ident" id="6866418">r</span><span class="op" id="6866419">.</span><span class="ident" id="6866420">Read</span><span class="op" id="6866424">(</span><span class="ident" id="6866425">out</span><span class="op" id="6866428">)</span><span class="op" id="6866429">;</span>&nbsp;<span class="ident" id="6866431">n</span>&nbsp;<span class="op" id="6866433">&gt;</span>&nbsp;<span class="num" id="6866435">0</span>&nbsp;<span class="op" id="6866437">||</span>&nbsp;<span class="ident" id="6866440">err</span>&nbsp;<span class="op" id="6866444">!=</span>&nbsp;<span class="ident" id="6866447">io</span><span class="op" id="6866449">.</span><span class="ident" id="6866450">EOF</span>&nbsp;<span class="op" id="6866454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6866458">t</span><span class="op" id="6866459">.</span><span class="ident" id="6866460">Errorf</span><span class="op" id="6866466">(</span><span class="string" id="6866467">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;final&nbsp;Read:&nbsp;%d,&nbsp;%v&nbsp;(hex:&nbsp;%x)&#34;</span><span class="op" id="6866520">,</span>&nbsp;<span class="ident" id="6866522">level</span><span class="op" id="6866527">,</span>&nbsp;<span class="builtinfunc" id="6866529">len</span><span class="op" id="6866532">(</span><span class="ident" id="6866533">input</span><span class="op" id="6866538">)</span><span class="op" id="6866539">,</span>&nbsp;<span class="ident" id="6866541">name</span><span class="op" id="6866545">,</span>&nbsp;<span class="ident" id="6866547">n</span><span class="op" id="6866548">,</span>&nbsp;<span class="ident" id="6866550">err</span><span class="op" id="6866553">,</span>&nbsp;<span class="ident" id="6866555">out</span><span class="op" id="6866558">[</span><span class="num" id="6866559">0</span><span class="op" id="6866560">:</span><span class="ident" id="6866561">n</span><span class="op" id="6866562">]</span><span class="op" id="6866563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6866566">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6866569">if</span>&nbsp;<span class="ident" id="6866572">buf</span><span class="op" id="6866575">.</span><span class="ident" id="6866576">buf</span><span class="op" id="6866579">.</span><span class="ident" id="6866580">Len</span><span class="op" id="6866583">(</span><span class="op" id="6866584">)</span>&nbsp;<span class="op" id="6866586">!=</span>&nbsp;<span class="num" id="6866589">0</span>&nbsp;<span class="op" id="6866591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6866595">t</span><span class="op" id="6866596">.</span><span class="ident" id="6866597">Errorf</span><span class="op" id="6866603">(</span><span class="string" id="6866604">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;extra&nbsp;data&nbsp;at&nbsp;end&#34;</span><span class="op" id="6866646">,</span>&nbsp;<span class="ident" id="6866648">level</span><span class="op" id="6866653">,</span>&nbsp;<span class="builtinfunc" id="6866655">len</span><span class="op" id="6866658">(</span><span class="ident" id="6866659">input</span><span class="op" id="6866664">)</span><span class="op" id="6866665">,</span>&nbsp;<span class="ident" id="6866667">name</span><span class="op" id="6866671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6866674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6866677">r</span><span class="op" id="6866678">.</span><span class="ident" id="6866679">Close</span><span class="op" id="6866684">(</span><span class="op" id="6866685">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6866689">//&nbsp;stream&nbsp;should&nbsp;work&nbsp;for&nbsp;ordinary&nbsp;reader&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6866736">r</span>&nbsp;<span class="op" id="6866738">=</span>&nbsp;<span class="ident" id="6866740">NewReader</span><span class="op" id="6866749">(</span><span class="ident" id="6866750">buf1</span><span class="op" id="6866754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6866757">out</span><span class="op" id="6866760">,</span>&nbsp;<span class="ident" id="6866762">err</span>&nbsp;<span class="op" id="6866766">=</span>&nbsp;<span class="ident" id="6866768">ioutil</span><span class="op" id="6866774">.</span><span class="ident" id="6866775">ReadAll</span><span class="op" id="6866782">(</span><span class="ident" id="6866783">r</span><span class="op" id="6866784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6866787">if</span>&nbsp;<span class="ident" id="6866790">err</span>&nbsp;<span class="op" id="6866794">!=</span>&nbsp;<span class="ident" id="6866797">nil</span>&nbsp;<span class="op" id="6866801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6866805">t</span><span class="op" id="6866806">.</span><span class="ident" id="6866807">Errorf</span><span class="op" id="6866813">(</span><span class="string" id="6866814">&#34;testSync:&nbsp;read:&nbsp;%s&#34;</span><span class="op" id="6866834">,</span>&nbsp;<span class="ident" id="6866836">err</span><span class="op" id="6866839">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6866843">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6866851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6866854">r</span><span class="op" id="6866855">.</span><span class="ident" id="6866856">Close</span><span class="op" id="6866861">(</span><span class="op" id="6866862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6866865">if</span>&nbsp;<span class="op" id="6866868">!</span><span class="ident" id="6866869">bytes</span><span class="op" id="6866874">.</span><span class="ident" id="6866875">Equal</span><span class="op" id="6866880">(</span><span class="ident" id="6866881">input</span><span class="op" id="6866886">,</span>&nbsp;<span class="ident" id="6866888">out</span><span class="op" id="6866891">)</span>&nbsp;<span class="op" id="6866893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6866897">t</span><span class="op" id="6866898">.</span><span class="ident" id="6866899">Errorf</span><span class="op" id="6866905">(</span><span class="string" id="6866906">&#34;testSync:&nbsp;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="6866971">,</span>&nbsp;<span class="ident" id="6866973">level</span><span class="op" id="6866978">,</span>&nbsp;<span class="ident" id="6866980">name</span><span class="op" id="6866984">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6866987">}</span><br>
<span class="lineno"></span><span class="op" id="6866989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6866992">func</span>&nbsp;<span class="ident" id="6866997">testToFromWithLevelAndLimit</span><span class="op" id="6867024">(</span><span class="ident" id="6867025">t</span>&nbsp;<span class="op" id="6867027">*</span><span class="ident" id="6867028">testing</span><span class="op" id="6867035">.</span><span class="ident" id="6867036">T</span><span class="op" id="6867037">,</span>&nbsp;<span class="ident" id="6867039">level</span>&nbsp;<span class="builtintype" id="6867045">int</span><span class="op" id="6867048">,</span>&nbsp;<span class="ident" id="6867050">input</span>&nbsp;<span class="op" id="6867056">[</span><span class="op" id="6867057">]</span><span class="builtintype" id="6867058">byte</span><span class="op" id="6867062">,</span>&nbsp;<span class="ident" id="6867064">name</span>&nbsp;<span class="builtintype" id="6867069">string</span><span class="op" id="6867075">,</span>&nbsp;<span class="ident" id="6867077">limit</span>&nbsp;<span class="builtintype" id="6867083">int</span><span class="op" id="6867086">)</span>&nbsp;<span class="op" id="6867088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6867091">var</span>&nbsp;<span class="ident" id="6867095">buffer</span>&nbsp;<span class="ident" id="6867102">bytes</span><span class="op" id="6867107">.</span><span class="ident" id="6867108">Buffer</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6867116">w</span><span class="op" id="6867117">,</span>&nbsp;<span class="ident" id="6867119">err</span>&nbsp;<span class="op" id="6867123">:=</span>&nbsp;<span class="ident" id="6867126">NewWriter</span><span class="op" id="6867135">(</span><span class="op" id="6867136">&amp;</span><span class="ident" id="6867137">buffer</span><span class="op" id="6867143">,</span>&nbsp;<span class="ident" id="6867145">level</span><span class="op" id="6867150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6867153">if</span>&nbsp;<span class="ident" id="6867156">err</span>&nbsp;<span class="op" id="6867160">!=</span>&nbsp;<span class="ident" id="6867163">nil</span>&nbsp;<span class="op" id="6867167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6867171">t</span><span class="op" id="6867172">.</span><span class="ident" id="6867173">Errorf</span><span class="op" id="6867179">(</span><span class="string" id="6867180">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6867195">,</span>&nbsp;<span class="ident" id="6867197">err</span><span class="op" id="6867200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6867204">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6867212">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6867215">w</span><span class="op" id="6867216">.</span><span class="ident" id="6867217">Write</span><span class="op" id="6867222">(</span><span class="ident" id="6867223">input</span><span class="op" id="6867228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6867231">w</span><span class="op" id="6867232">.</span><span class="ident" id="6867233">Close</span><span class="op" id="6867238">(</span><span class="op" id="6867239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6867242">if</span>&nbsp;<span class="ident" id="6867245">limit</span>&nbsp;<span class="op" id="6867251">&gt;</span>&nbsp;<span class="num" id="6867253">0</span>&nbsp;<span class="op" id="6867255">&amp;&amp;</span>&nbsp;<span class="ident" id="6867258">buffer</span><span class="op" id="6867264">.</span><span class="ident" id="6867265">Len</span><span class="op" id="6867268">(</span><span class="op" id="6867269">)</span>&nbsp;<span class="op" id="6867271">&gt;</span>&nbsp;<span class="ident" id="6867273">limit</span>&nbsp;<span class="op" id="6867279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6867283">t</span><span class="op" id="6867284">.</span><span class="ident" id="6867285">Errorf</span><span class="op" id="6867291">(</span><span class="string" id="6867292">&#34;level:&nbsp;%d,&nbsp;len(compress(data))&nbsp;=&nbsp;%d&nbsp;&gt;&nbsp;limit&nbsp;=&nbsp;%d&#34;</span><span class="op" id="6867342">,</span>&nbsp;<span class="ident" id="6867344">level</span><span class="op" id="6867349">,</span>&nbsp;<span class="ident" id="6867351">buffer</span><span class="op" id="6867357">.</span><span class="ident" id="6867358">Len</span><span class="op" id="6867361">(</span><span class="op" id="6867362">)</span><span class="op" id="6867363">,</span>&nbsp;<span class="ident" id="6867365">limit</span><span class="op" id="6867370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6867374">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6867382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6867385">r</span>&nbsp;<span class="op" id="6867387">:=</span>&nbsp;<span class="ident" id="6867390">NewReader</span><span class="op" id="6867399">(</span><span class="op" id="6867400">&amp;</span><span class="ident" id="6867401">buffer</span><span class="op" id="6867407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6867410">out</span><span class="op" id="6867413">,</span>&nbsp;<span class="ident" id="6867415">err</span>&nbsp;<span class="op" id="6867419">:=</span>&nbsp;<span class="ident" id="6867422">ioutil</span><span class="op" id="6867428">.</span><span class="ident" id="6867429">ReadAll</span><span class="op" id="6867436">(</span><span class="ident" id="6867437">r</span><span class="op" id="6867438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6867441">if</span>&nbsp;<span class="ident" id="6867444">err</span>&nbsp;<span class="op" id="6867448">!=</span>&nbsp;<span class="ident" id="6867451">nil</span>&nbsp;<span class="op" id="6867455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6867459">t</span><span class="op" id="6867460">.</span><span class="ident" id="6867461">Errorf</span><span class="op" id="6867467">(</span><span class="string" id="6867468">&#34;read:&nbsp;%s&#34;</span><span class="op" id="6867478">,</span>&nbsp;<span class="ident" id="6867480">err</span><span class="op" id="6867483">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6867487">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6867495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6867498">r</span><span class="op" id="6867499">.</span><span class="ident" id="6867500">Close</span><span class="op" id="6867505">(</span><span class="op" id="6867506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6867509">if</span>&nbsp;<span class="op" id="6867512">!</span><span class="ident" id="6867513">bytes</span><span class="op" id="6867518">.</span><span class="ident" id="6867519">Equal</span><span class="op" id="6867524">(</span><span class="ident" id="6867525">input</span><span class="op" id="6867530">,</span>&nbsp;<span class="ident" id="6867532">out</span><span class="op" id="6867535">)</span>&nbsp;<span class="op" id="6867537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6867541">t</span><span class="op" id="6867542">.</span><span class="ident" id="6867543">Errorf</span><span class="op" id="6867549">(</span><span class="string" id="6867550">&#34;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="6867605">,</span>&nbsp;<span class="ident" id="6867607">level</span><span class="op" id="6867612">,</span>&nbsp;<span class="ident" id="6867614">name</span><span class="op" id="6867618">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6867622">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6867630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6867633">testSync</span><span class="op" id="6867641">(</span><span class="ident" id="6867642">t</span><span class="op" id="6867643">,</span>&nbsp;<span class="ident" id="6867645">level</span><span class="op" id="6867650">,</span>&nbsp;<span class="ident" id="6867652">input</span><span class="op" id="6867657">,</span>&nbsp;<span class="ident" id="6867659">name</span><span class="op" id="6867663">)</span><br>
<span class="lineno"></span><span class="op" id="6867665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="6867668">func</span>&nbsp;<span class="ident" id="6867673">testToFromWithLimit</span><span class="op" id="6867692">(</span><span class="ident" id="6867693">t</span>&nbsp;<span class="op" id="6867695">*</span><span class="ident" id="6867696">testing</span><span class="op" id="6867703">.</span><span class="ident" id="6867704">T</span><span class="op" id="6867705">,</span>&nbsp;<span class="ident" id="6867707">input</span>&nbsp;<span class="op" id="6867713">[</span><span class="op" id="6867714">]</span><span class="builtintype" id="6867715">byte</span><span class="op" id="6867719">,</span>&nbsp;<span class="ident" id="6867721">name</span>&nbsp;<span class="builtintype" id="6867726">string</span><span class="op" id="6867732">,</span>&nbsp;<span class="ident" id="6867734">limit</span>&nbsp;<span class="op" id="6867740">[</span><span class="num" id="6867741">10</span><span class="op" id="6867743">]</span><span class="builtintype" id="6867744">int</span><span class="op" id="6867747">)</span>&nbsp;<span class="op" id="6867749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6867752">for</span>&nbsp;<span class="ident" id="6867756">i</span>&nbsp;<span class="op" id="6867758">:=</span>&nbsp;<span class="num" id="6867761">0</span><span class="op" id="6867762">;</span>&nbsp;<span class="ident" id="6867764">i</span>&nbsp;<span class="op" id="6867766">&lt;</span>&nbsp;<span class="num" id="6867768">10</span><span class="op" id="6867770">;</span>&nbsp;<span class="ident" id="6867772">i</span><span class="op" id="6867773">++</span>&nbsp;<span class="op" id="6867776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6867780">testToFromWithLevelAndLimit</span><span class="op" id="6867807">(</span><span class="ident" id="6867808">t</span><span class="op" id="6867809">,</span>&nbsp;<span class="ident" id="6867811">i</span><span class="op" id="6867812">,</span>&nbsp;<span class="ident" id="6867814">input</span><span class="op" id="6867819">,</span>&nbsp;<span class="ident" id="6867821">name</span><span class="op" id="6867825">,</span>&nbsp;<span class="ident" id="6867827">limit</span><span class="op" id="6867832">[</span><span class="ident" id="6867833">i</span><span class="op" id="6867834">]</span><span class="op" id="6867835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6867838">}</span><br>
<span class="lineno"></span><span class="op" id="6867840">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="6867843">func</span>&nbsp;<span class="ident" id="6867848">TestDeflateInflate</span><span class="op" id="6867866">(</span><span class="ident" id="6867867">t</span>&nbsp;<span class="op" id="6867869">*</span><span class="ident" id="6867870">testing</span><span class="op" id="6867877">.</span><span class="ident" id="6867878">T</span><span class="op" id="6867879">)</span>&nbsp;<span class="op" id="6867881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6867884">for</span>&nbsp;<span class="ident" id="6867888">i</span><span class="op" id="6867889">,</span>&nbsp;<span class="ident" id="6867891">h</span>&nbsp;<span class="op" id="6867893">:=</span>&nbsp;<span class="keyword" id="6867896">range</span>&nbsp;<span class="ident" id="6867902">deflateInflateTests</span>&nbsp;<span class="op" id="6867922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6867926">testToFromWithLimit</span><span class="op" id="6867945">(</span><span class="ident" id="6867946">t</span><span class="op" id="6867947">,</span>&nbsp;<span class="ident" id="6867949">h</span><span class="op" id="6867950">.</span><span class="ident" id="6867951">in</span><span class="op" id="6867953">,</span>&nbsp;<span class="ident" id="6867955">fmt</span><span class="op" id="6867958">.</span><span class="ident" id="6867959">Sprintf</span><span class="op" id="6867966">(</span><span class="string" id="6867967">&#34;#%d&#34;</span><span class="op" id="6867972">,</span>&nbsp;<span class="ident" id="6867974">i</span><span class="op" id="6867975">)</span><span class="op" id="6867976">,</span>&nbsp;<span class="op" id="6867978">[</span><span class="num" id="6867979">10</span><span class="op" id="6867981">]</span><span class="builtintype" id="6867982">int</span><span class="op" id="6867985">{</span><span class="op" id="6867986">}</span><span class="op" id="6867987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6867990">}</span><br>
<span class="lineno">315</span><span class="op" id="6867992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6867995">func</span>&nbsp;<span class="ident" id="6868000">TestReverseBits</span><span class="op" id="6868015">(</span><span class="ident" id="6868016">t</span>&nbsp;<span class="op" id="6868018">*</span><span class="ident" id="6868019">testing</span><span class="op" id="6868026">.</span><span class="ident" id="6868027">T</span><span class="op" id="6868028">)</span>&nbsp;<span class="op" id="6868030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6868033">for</span>&nbsp;<span class="ident" id="6868037">_</span><span class="op" id="6868038">,</span>&nbsp;<span class="ident" id="6868040">h</span>&nbsp;<span class="op" id="6868042">:=</span>&nbsp;<span class="keyword" id="6868045">range</span>&nbsp;<span class="ident" id="6868051">reverseBitsTests</span>&nbsp;<span class="op" id="6868068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6868072">if</span>&nbsp;<span class="ident" id="6868075">v</span>&nbsp;<span class="op" id="6868077">:=</span>&nbsp;<span class="ident" id="6868080">reverseBits</span><span class="op" id="6868091">(</span><span class="ident" id="6868092">h</span><span class="op" id="6868093">.</span><span class="ident" id="6868094">in</span><span class="op" id="6868096">,</span>&nbsp;<span class="ident" id="6868098">h</span><span class="op" id="6868099">.</span><span class="ident" id="6868100">bitCount</span><span class="op" id="6868108">)</span><span class="op" id="6868109">;</span>&nbsp;<span class="ident" id="6868111">v</span>&nbsp;<span class="op" id="6868113">!=</span>&nbsp;<span class="ident" id="6868116">h</span><span class="op" id="6868117">.</span><span class="ident" id="6868118">out</span>&nbsp;<span class="op" id="6868122">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6868127">t</span><span class="op" id="6868128">.</span><span class="ident" id="6868129">Errorf</span><span class="op" id="6868135">(</span><span class="string" id="6868136">&#34;reverseBits(%v,%v)&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6868170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6868176">h</span><span class="op" id="6868177">.</span><span class="ident" id="6868178">in</span><span class="op" id="6868180">,</span>&nbsp;<span class="ident" id="6868182">h</span><span class="op" id="6868183">.</span><span class="ident" id="6868184">bitCount</span><span class="op" id="6868192">,</span>&nbsp;<span class="ident" id="6868194">v</span><span class="op" id="6868195">,</span>&nbsp;<span class="ident" id="6868197">h</span><span class="op" id="6868198">.</span><span class="ident" id="6868199">out</span><span class="op" id="6868202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6868206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6868209">}</span><br>
<span class="lineno"></span><span class="op" id="6868211">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="6868214">type</span>&nbsp;<span class="ident" id="6868219">deflateInflateStringTest</span>&nbsp;<span class="keyword" id="6868244">struct</span>&nbsp;<span class="op" id="6868251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6868254">filename</span>&nbsp;<span class="builtintype" id="6868263">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6868271">label</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6868280">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6868288">limit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6868297">[</span><span class="num" id="6868298">10</span><span class="op" id="6868300">]</span><span class="builtintype" id="6868301">int</span><br>
<span class="lineno">330</span><span class="op" id="6868305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6868308">var</span>&nbsp;<span class="ident" id="6868312">deflateInflateStringTests</span>&nbsp;<span class="op" id="6868338">=</span>&nbsp;<span class="op" id="6868340">[</span><span class="op" id="6868341">]</span><span class="ident" id="6868342">deflateInflateStringTest</span><span class="op" id="6868366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6868369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6868373">&#34;../testdata/e.txt&#34;</span><span class="op" id="6868392">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6868396">&#34;2.718281828...&#34;</span><span class="op" id="6868412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6868416">[</span><span class="op" id="6868417">...</span><span class="op" id="6868420">]</span><span class="builtintype" id="6868421">int</span><span class="op" id="6868424">{</span><span class="num" id="6868425">100018</span><span class="op" id="6868431">,</span>&nbsp;<span class="num" id="6868433">50650</span><span class="op" id="6868438">,</span>&nbsp;<span class="num" id="6868440">50960</span><span class="op" id="6868445">,</span>&nbsp;<span class="num" id="6868447">51150</span><span class="op" id="6868452">,</span>&nbsp;<span class="num" id="6868454">50930</span><span class="op" id="6868459">,</span>&nbsp;<span class="num" id="6868461">50790</span><span class="op" id="6868466">,</span>&nbsp;<span class="num" id="6868468">50790</span><span class="op" id="6868473">,</span>&nbsp;<span class="num" id="6868475">50790</span><span class="op" id="6868480">,</span>&nbsp;<span class="num" id="6868482">50790</span><span class="op" id="6868487">,</span>&nbsp;<span class="num" id="6868489">50790</span><span class="op" id="6868494">}</span><span class="op" id="6868495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6868498">}</span><span class="op" id="6868499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6868502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6868506">&#34;../testdata/Mark.Twain-Tom.Sawyer.txt&#34;</span><span class="op" id="6868545">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6868549">&#34;Mark.Twain-Tom.Sawyer&#34;</span><span class="op" id="6868572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6868576">[</span><span class="op" id="6868577">...</span><span class="op" id="6868580">]</span><span class="builtintype" id="6868581">int</span><span class="op" id="6868584">{</span><span class="num" id="6868585">407330</span><span class="op" id="6868591">,</span>&nbsp;<span class="num" id="6868593">187598</span><span class="op" id="6868599">,</span>&nbsp;<span class="num" id="6868601">180361</span><span class="op" id="6868607">,</span>&nbsp;<span class="num" id="6868609">172974</span><span class="op" id="6868615">,</span>&nbsp;<span class="num" id="6868617">169160</span><span class="op" id="6868623">,</span>&nbsp;<span class="num" id="6868625">163476</span><span class="op" id="6868631">,</span>&nbsp;<span class="num" id="6868633">160936</span><span class="op" id="6868639">,</span>&nbsp;<span class="num" id="6868641">160506</span><span class="op" id="6868647">,</span>&nbsp;<span class="num" id="6868649">160295</span><span class="op" id="6868655">,</span>&nbsp;<span class="num" id="6868657">160295</span><span class="op" id="6868663">}</span><span class="op" id="6868664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6868667">}</span><span class="op" id="6868668">,</span><br>
<span class="lineno"></span><span class="op" id="6868670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="6868673">func</span>&nbsp;<span class="ident" id="6868678">TestDeflateInflateString</span><span class="op" id="6868702">(</span><span class="ident" id="6868703">t</span>&nbsp;<span class="op" id="6868705">*</span><span class="ident" id="6868706">testing</span><span class="op" id="6868713">.</span><span class="ident" id="6868714">T</span><span class="op" id="6868715">)</span>&nbsp;<span class="op" id="6868717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6868720">for</span>&nbsp;<span class="ident" id="6868724">_</span><span class="op" id="6868725">,</span>&nbsp;<span class="ident" id="6868727">test</span>&nbsp;<span class="op" id="6868732">:=</span>&nbsp;<span class="keyword" id="6868735">range</span>&nbsp;<span class="ident" id="6868741">deflateInflateStringTests</span>&nbsp;<span class="op" id="6868767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6868771">gold</span><span class="op" id="6868775">,</span>&nbsp;<span class="ident" id="6868777">err</span>&nbsp;<span class="op" id="6868781">:=</span>&nbsp;<span class="ident" id="6868784">ioutil</span><span class="op" id="6868790">.</span><span class="ident" id="6868791">ReadFile</span><span class="op" id="6868799">(</span><span class="ident" id="6868800">test</span><span class="op" id="6868804">.</span><span class="ident" id="6868805">filename</span><span class="op" id="6868813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6868817">if</span>&nbsp;<span class="ident" id="6868820">err</span>&nbsp;<span class="op" id="6868824">!=</span>&nbsp;<span class="ident" id="6868827">nil</span>&nbsp;<span class="op" id="6868831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6868836">t</span><span class="op" id="6868837">.</span><span class="ident" id="6868838">Error</span><span class="op" id="6868843">(</span><span class="ident" id="6868844">err</span><span class="op" id="6868847">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6868851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6868855">testToFromWithLimit</span><span class="op" id="6868874">(</span><span class="ident" id="6868875">t</span><span class="op" id="6868876">,</span>&nbsp;<span class="ident" id="6868878">gold</span><span class="op" id="6868882">,</span>&nbsp;<span class="ident" id="6868884">test</span><span class="op" id="6868888">.</span><span class="ident" id="6868889">label</span><span class="op" id="6868894">,</span>&nbsp;<span class="ident" id="6868896">test</span><span class="op" id="6868900">.</span><span class="ident" id="6868901">limit</span><span class="op" id="6868906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6868910">if</span>&nbsp;<span class="ident" id="6868913">testing</span><span class="op" id="6868920">.</span><span class="ident" id="6868921">Short</span><span class="op" id="6868926">(</span><span class="op" id="6868927">)</span>&nbsp;<span class="op" id="6868929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6868934">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6868942">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6868945">}</span><br>
<span class="lineno"></span><span class="op" id="6868947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6868950">func</span>&nbsp;<span class="ident" id="6868955">TestReaderDict</span><span class="op" id="6868969">(</span><span class="ident" id="6868970">t</span>&nbsp;<span class="op" id="6868972">*</span><span class="ident" id="6868973">testing</span><span class="op" id="6868980">.</span><span class="ident" id="6868981">T</span><span class="op" id="6868982">)</span>&nbsp;<span class="op" id="6868984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6868987">const</span>&nbsp;<span class="op" id="6868993">(</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6868997">dict</span>&nbsp;<span class="op" id="6869002">=</span>&nbsp;<span class="string" id="6869004">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869020">text</span>&nbsp;<span class="op" id="6869025">=</span>&nbsp;<span class="string" id="6869027">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6869048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6869051">var</span>&nbsp;<span class="ident" id="6869055">b</span>&nbsp;<span class="ident" id="6869057">bytes</span><span class="op" id="6869062">.</span><span class="ident" id="6869063">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869071">w</span><span class="op" id="6869072">,</span>&nbsp;<span class="ident" id="6869074">err</span>&nbsp;<span class="op" id="6869078">:=</span>&nbsp;<span class="ident" id="6869081">NewWriter</span><span class="op" id="6869090">(</span><span class="op" id="6869091">&amp;</span><span class="ident" id="6869092">b</span><span class="op" id="6869093">,</span>&nbsp;<span class="num" id="6869095">5</span><span class="op" id="6869096">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6869099">if</span>&nbsp;<span class="ident" id="6869102">err</span>&nbsp;<span class="op" id="6869106">!=</span>&nbsp;<span class="ident" id="6869109">nil</span>&nbsp;<span class="op" id="6869113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869117">t</span><span class="op" id="6869118">.</span><span class="ident" id="6869119">Fatalf</span><span class="op" id="6869125">(</span><span class="string" id="6869126">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6869141">,</span>&nbsp;<span class="ident" id="6869143">err</span><span class="op" id="6869146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6869149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869152">w</span><span class="op" id="6869153">.</span><span class="ident" id="6869154">Write</span><span class="op" id="6869159">(</span><span class="op" id="6869160">[</span><span class="op" id="6869161">]</span><span class="builtintype" id="6869162">byte</span><span class="op" id="6869166">(</span><span class="ident" id="6869167">dict</span><span class="op" id="6869171">)</span><span class="op" id="6869172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869175">w</span><span class="op" id="6869176">.</span><span class="ident" id="6869177">Flush</span><span class="op" id="6869182">(</span><span class="op" id="6869183">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869186">b</span><span class="op" id="6869187">.</span><span class="ident" id="6869188">Reset</span><span class="op" id="6869193">(</span><span class="op" id="6869194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869197">w</span><span class="op" id="6869198">.</span><span class="ident" id="6869199">Write</span><span class="op" id="6869204">(</span><span class="op" id="6869205">[</span><span class="op" id="6869206">]</span><span class="builtintype" id="6869207">byte</span><span class="op" id="6869211">(</span><span class="ident" id="6869212">text</span><span class="op" id="6869216">)</span><span class="op" id="6869217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869220">w</span><span class="op" id="6869221">.</span><span class="ident" id="6869222">Close</span><span class="op" id="6869227">(</span><span class="op" id="6869228">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869232">r</span>&nbsp;<span class="op" id="6869234">:=</span>&nbsp;<span class="ident" id="6869237">NewReaderDict</span><span class="op" id="6869250">(</span><span class="op" id="6869251">&amp;</span><span class="ident" id="6869252">b</span><span class="op" id="6869253">,</span>&nbsp;<span class="op" id="6869255">[</span><span class="op" id="6869256">]</span><span class="builtintype" id="6869257">byte</span><span class="op" id="6869261">(</span><span class="ident" id="6869262">dict</span><span class="op" id="6869266">)</span><span class="op" id="6869267">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869270">data</span><span class="op" id="6869274">,</span>&nbsp;<span class="ident" id="6869276">err</span>&nbsp;<span class="op" id="6869280">:=</span>&nbsp;<span class="ident" id="6869283">ioutil</span><span class="op" id="6869289">.</span><span class="ident" id="6869290">ReadAll</span><span class="op" id="6869297">(</span><span class="ident" id="6869298">r</span><span class="op" id="6869299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6869302">if</span>&nbsp;<span class="ident" id="6869305">err</span>&nbsp;<span class="op" id="6869309">!=</span>&nbsp;<span class="ident" id="6869312">nil</span>&nbsp;<span class="op" id="6869316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869320">t</span><span class="op" id="6869321">.</span><span class="ident" id="6869322">Fatal</span><span class="op" id="6869327">(</span><span class="ident" id="6869328">err</span><span class="op" id="6869331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6869334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6869337">if</span>&nbsp;<span class="builtintype" id="6869340">string</span><span class="op" id="6869346">(</span><span class="ident" id="6869347">data</span><span class="op" id="6869351">)</span>&nbsp;<span class="op" id="6869353">!=</span>&nbsp;<span class="string" id="6869356">&#34;hello&nbsp;again&nbsp;world&#34;</span>&nbsp;<span class="op" id="6869376">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869380">t</span><span class="op" id="6869381">.</span><span class="ident" id="6869382">Fatalf</span><span class="op" id="6869388">(</span><span class="string" id="6869389">&#34;read&nbsp;returned&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6869415">,</span>&nbsp;<span class="builtintype" id="6869417">string</span><span class="op" id="6869423">(</span><span class="ident" id="6869424">data</span><span class="op" id="6869428">)</span><span class="op" id="6869429">,</span>&nbsp;<span class="ident" id="6869431">text</span><span class="op" id="6869435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6869438">}</span><br>
<span class="lineno"></span><span class="op" id="6869440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6869443">func</span>&nbsp;<span class="ident" id="6869448">TestWriterDict</span><span class="op" id="6869462">(</span><span class="ident" id="6869463">t</span>&nbsp;<span class="op" id="6869465">*</span><span class="ident" id="6869466">testing</span><span class="op" id="6869473">.</span><span class="ident" id="6869474">T</span><span class="op" id="6869475">)</span>&nbsp;<span class="op" id="6869477">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6869480">const</span>&nbsp;<span class="op" id="6869486">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869490">dict</span>&nbsp;<span class="op" id="6869495">=</span>&nbsp;<span class="string" id="6869497">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869513">text</span>&nbsp;<span class="op" id="6869518">=</span>&nbsp;<span class="string" id="6869520">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6869541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6869544">var</span>&nbsp;<span class="ident" id="6869548">b</span>&nbsp;<span class="ident" id="6869550">bytes</span><span class="op" id="6869555">.</span><span class="ident" id="6869556">Buffer</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869564">w</span><span class="op" id="6869565">,</span>&nbsp;<span class="ident" id="6869567">err</span>&nbsp;<span class="op" id="6869571">:=</span>&nbsp;<span class="ident" id="6869574">NewWriter</span><span class="op" id="6869583">(</span><span class="op" id="6869584">&amp;</span><span class="ident" id="6869585">b</span><span class="op" id="6869586">,</span>&nbsp;<span class="num" id="6869588">5</span><span class="op" id="6869589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6869592">if</span>&nbsp;<span class="ident" id="6869595">err</span>&nbsp;<span class="op" id="6869599">!=</span>&nbsp;<span class="ident" id="6869602">nil</span>&nbsp;<span class="op" id="6869606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869610">t</span><span class="op" id="6869611">.</span><span class="ident" id="6869612">Fatalf</span><span class="op" id="6869618">(</span><span class="string" id="6869619">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6869634">,</span>&nbsp;<span class="ident" id="6869636">err</span><span class="op" id="6869639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6869642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869645">w</span><span class="op" id="6869646">.</span><span class="ident" id="6869647">Write</span><span class="op" id="6869652">(</span><span class="op" id="6869653">[</span><span class="op" id="6869654">]</span><span class="builtintype" id="6869655">byte</span><span class="op" id="6869659">(</span><span class="ident" id="6869660">dict</span><span class="op" id="6869664">)</span><span class="op" id="6869665">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869668">w</span><span class="op" id="6869669">.</span><span class="ident" id="6869670">Flush</span><span class="op" id="6869675">(</span><span class="op" id="6869676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869679">b</span><span class="op" id="6869680">.</span><span class="ident" id="6869681">Reset</span><span class="op" id="6869686">(</span><span class="op" id="6869687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869690">w</span><span class="op" id="6869691">.</span><span class="ident" id="6869692">Write</span><span class="op" id="6869697">(</span><span class="op" id="6869698">[</span><span class="op" id="6869699">]</span><span class="builtintype" id="6869700">byte</span><span class="op" id="6869704">(</span><span class="ident" id="6869705">text</span><span class="op" id="6869709">)</span><span class="op" id="6869710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869713">w</span><span class="op" id="6869714">.</span><span class="ident" id="6869715">Close</span><span class="op" id="6869720">(</span><span class="op" id="6869721">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6869725">var</span>&nbsp;<span class="ident" id="6869729">b1</span>&nbsp;<span class="ident" id="6869732">bytes</span><span class="op" id="6869737">.</span><span class="ident" id="6869738">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869746">w</span><span class="op" id="6869747">,</span>&nbsp;<span class="ident" id="6869749">_</span>&nbsp;<span class="op" id="6869751">=</span>&nbsp;<span class="ident" id="6869753">NewWriterDict</span><span class="op" id="6869766">(</span><span class="op" id="6869767">&amp;</span><span class="ident" id="6869768">b1</span><span class="op" id="6869770">,</span>&nbsp;<span class="num" id="6869772">5</span><span class="op" id="6869773">,</span>&nbsp;<span class="op" id="6869775">[</span><span class="op" id="6869776">]</span><span class="builtintype" id="6869777">byte</span><span class="op" id="6869781">(</span><span class="ident" id="6869782">dict</span><span class="op" id="6869786">)</span><span class="op" id="6869787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869790">w</span><span class="op" id="6869791">.</span><span class="ident" id="6869792">Write</span><span class="op" id="6869797">(</span><span class="op" id="6869798">[</span><span class="op" id="6869799">]</span><span class="builtintype" id="6869800">byte</span><span class="op" id="6869804">(</span><span class="ident" id="6869805">text</span><span class="op" id="6869809">)</span><span class="op" id="6869810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869813">w</span><span class="op" id="6869814">.</span><span class="ident" id="6869815">Close</span><span class="op" id="6869820">(</span><span class="op" id="6869821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6869825">if</span>&nbsp;<span class="op" id="6869828">!</span><span class="ident" id="6869829">bytes</span><span class="op" id="6869834">.</span><span class="ident" id="6869835">Equal</span><span class="op" id="6869840">(</span><span class="ident" id="6869841">b1</span><span class="op" id="6869843">.</span><span class="ident" id="6869844">Bytes</span><span class="op" id="6869849">(</span><span class="op" id="6869850">)</span><span class="op" id="6869851">,</span>&nbsp;<span class="ident" id="6869853">b</span><span class="op" id="6869854">.</span><span class="ident" id="6869855">Bytes</span><span class="op" id="6869860">(</span><span class="op" id="6869861">)</span><span class="op" id="6869862">)</span>&nbsp;<span class="op" id="6869864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6869868">t</span><span class="op" id="6869869">.</span><span class="ident" id="6869870">Fatalf</span><span class="op" id="6869876">(</span><span class="string" id="6869877">&#34;writer&nbsp;wrote&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6869902">,</span>&nbsp;<span class="ident" id="6869904">b1</span><span class="op" id="6869906">.</span><span class="ident" id="6869907">Bytes</span><span class="op" id="6869912">(</span><span class="op" id="6869913">)</span><span class="op" id="6869914">,</span>&nbsp;<span class="ident" id="6869916">b</span><span class="op" id="6869917">.</span><span class="ident" id="6869918">Bytes</span><span class="op" id="6869923">(</span><span class="op" id="6869924">)</span><span class="op" id="6869925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6869928">}</span><br>
<span class="lineno"></span><span class="op" id="6869930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="6869933">//&nbsp;See&nbsp;http://code.google.com/p/go/issues/detail?id=2508</span><br>
<span class="lineno"></span><span class="keyword" id="6869990">func</span>&nbsp;<span class="ident" id="6869995">TestRegression2508</span><span class="op" id="6870013">(</span><span class="ident" id="6870014">t</span>&nbsp;<span class="op" id="6870016">*</span><span class="ident" id="6870017">testing</span><span class="op" id="6870024">.</span><span class="ident" id="6870025">T</span><span class="op" id="6870026">)</span>&nbsp;<span class="op" id="6870028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6870031">if</span>&nbsp;<span class="ident" id="6870034">testing</span><span class="op" id="6870041">.</span><span class="ident" id="6870042">Short</span><span class="op" id="6870047">(</span><span class="op" id="6870048">)</span>&nbsp;<span class="op" id="6870050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6870054">t</span><span class="op" id="6870055">.</span><span class="ident" id="6870056">Logf</span><span class="op" id="6870060">(</span><span class="string" id="6870061">&#34;test&nbsp;disabled&nbsp;with&nbsp;-short&#34;</span><span class="op" id="6870088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6870092">return</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6870100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6870103">w</span><span class="op" id="6870104">,</span>&nbsp;<span class="ident" id="6870106">err</span>&nbsp;<span class="op" id="6870110">:=</span>&nbsp;<span class="ident" id="6870113">NewWriter</span><span class="op" id="6870122">(</span><span class="ident" id="6870123">ioutil</span><span class="op" id="6870129">.</span><span class="ident" id="6870130">Discard</span><span class="op" id="6870137">,</span>&nbsp;<span class="num" id="6870139">1</span><span class="op" id="6870140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6870143">if</span>&nbsp;<span class="ident" id="6870146">err</span>&nbsp;<span class="op" id="6870150">!=</span>&nbsp;<span class="ident" id="6870153">nil</span>&nbsp;<span class="op" id="6870157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6870161">t</span><span class="op" id="6870162">.</span><span class="ident" id="6870163">Fatalf</span><span class="op" id="6870169">(</span><span class="string" id="6870170">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6870185">,</span>&nbsp;<span class="ident" id="6870187">err</span><span class="op" id="6870190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6870193">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6870196">buf</span>&nbsp;<span class="op" id="6870200">:=</span>&nbsp;<span class="builtinfunc" id="6870203">make</span><span class="op" id="6870207">(</span><span class="op" id="6870208">[</span><span class="op" id="6870209">]</span><span class="builtintype" id="6870210">byte</span><span class="op" id="6870214">,</span>&nbsp;<span class="num" id="6870216">1024</span><span class="op" id="6870220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6870223">for</span>&nbsp;<span class="ident" id="6870227">i</span>&nbsp;<span class="op" id="6870229">:=</span>&nbsp;<span class="num" id="6870232">0</span><span class="op" id="6870233">;</span>&nbsp;<span class="ident" id="6870235">i</span>&nbsp;<span class="op" id="6870237">&lt;</span>&nbsp;<span class="num" id="6870239">131072</span><span class="op" id="6870245">;</span>&nbsp;<span class="ident" id="6870247">i</span><span class="op" id="6870248">++</span>&nbsp;<span class="op" id="6870251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6870255">if</span>&nbsp;<span class="ident" id="6870258">_</span><span class="op" id="6870259">,</span>&nbsp;<span class="ident" id="6870261">err</span>&nbsp;<span class="op" id="6870265">:=</span>&nbsp;<span class="ident" id="6870268">w</span><span class="op" id="6870269">.</span><span class="ident" id="6870270">Write</span><span class="op" id="6870275">(</span><span class="ident" id="6870276">buf</span><span class="op" id="6870279">)</span><span class="op" id="6870280">;</span>&nbsp;<span class="ident" id="6870282">err</span>&nbsp;<span class="op" id="6870286">!=</span>&nbsp;<span class="ident" id="6870289">nil</span>&nbsp;<span class="op" id="6870293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6870298">t</span><span class="op" id="6870299">.</span><span class="ident" id="6870300">Fatalf</span><span class="op" id="6870306">(</span><span class="string" id="6870307">&#34;writer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6870326">,</span>&nbsp;<span class="ident" id="6870328">err</span><span class="op" id="6870331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6870335">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6870338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6870341">w</span><span class="op" id="6870342">.</span><span class="ident" id="6870343">Close</span><span class="op" id="6870348">(</span><span class="op" id="6870349">)</span><br>
<span class="lineno"></span><span class="op" id="6870351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6870354">func</span>&nbsp;<span class="ident" id="6870359">TestWriterReset</span><span class="op" id="6870374">(</span><span class="ident" id="6870375">t</span>&nbsp;<span class="op" id="6870377">*</span><span class="ident" id="6870378">testing</span><span class="op" id="6870385">.</span><span class="ident" id="6870386">T</span><span class="op" id="6870387">)</span>&nbsp;<span class="op" id="6870389">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6870392">for</span>&nbsp;<span class="ident" id="6870396">level</span>&nbsp;<span class="op" id="6870402">:=</span>&nbsp;<span class="num" id="6870405">0</span><span class="op" id="6870406">;</span>&nbsp;<span class="ident" id="6870408">level</span>&nbsp;<span class="op" id="6870414">&lt;=</span>&nbsp;<span class="num" id="6870417">9</span><span class="op" id="6870418">;</span>&nbsp;<span class="ident" id="6870420">level</span><span class="op" id="6870425">++</span>&nbsp;<span class="op" id="6870428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6870432">if</span>&nbsp;<span class="ident" id="6870435">testing</span><span class="op" id="6870442">.</span><span class="ident" id="6870443">Short</span><span class="op" id="6870448">(</span><span class="op" id="6870449">)</span>&nbsp;<span class="op" id="6870451">&amp;&amp;</span>&nbsp;<span class="ident" id="6870454">level</span>&nbsp;<span class="op" id="6870460">&gt;</span>&nbsp;<span class="num" id="6870462">1</span>&nbsp;<span class="op" id="6870464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6870469">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6870477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6870481">w</span><span class="op" id="6870482">,</span>&nbsp;<span class="ident" id="6870484">err</span>&nbsp;<span class="op" id="6870488">:=</span>&nbsp;<span class="ident" id="6870491">NewWriter</span><span class="op" id="6870500">(</span><span class="ident" id="6870501">ioutil</span><span class="op" id="6870507">.</span><span class="ident" id="6870508">Discard</span><span class="op" id="6870515">,</span>&nbsp;<span class="ident" id="6870517">level</span><span class="op" id="6870522">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6870526">if</span>&nbsp;<span class="ident" id="6870529">err</span>&nbsp;<span class="op" id="6870533">!=</span>&nbsp;<span class="ident" id="6870536">nil</span>&nbsp;<span class="op" id="6870540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6870545">t</span><span class="op" id="6870546">.</span><span class="ident" id="6870547">Fatalf</span><span class="op" id="6870553">(</span><span class="string" id="6870554">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6870569">,</span>&nbsp;<span class="ident" id="6870571">err</span><span class="op" id="6870574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6870578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6870582">buf</span>&nbsp;<span class="op" id="6870586">:=</span>&nbsp;<span class="op" id="6870589">[</span><span class="op" id="6870590">]</span><span class="builtintype" id="6870591">byte</span><span class="op" id="6870595">(</span><span class="string" id="6870596">&#34;hello&nbsp;world&#34;</span><span class="op" id="6870609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6870613">for</span>&nbsp;<span class="ident" id="6870617">i</span>&nbsp;<span class="op" id="6870619">:=</span>&nbsp;<span class="num" id="6870622">0</span><span class="op" id="6870623">;</span>&nbsp;<span class="ident" id="6870625">i</span>&nbsp;<span class="op" id="6870627">&lt;</span>&nbsp;<span class="num" id="6870629">1024</span><span class="op" id="6870633">;</span>&nbsp;<span class="ident" id="6870635">i</span><span class="op" id="6870636">++</span>&nbsp;<span class="op" id="6870639">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6870644">w</span><span class="op" id="6870645">.</span><span class="ident" id="6870646">Write</span><span class="op" id="6870651">(</span><span class="ident" id="6870652">buf</span><span class="op" id="6870655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6870659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6870663">w</span><span class="op" id="6870664">.</span><span class="ident" id="6870665">Reset</span><span class="op" id="6870670">(</span><span class="ident" id="6870671">ioutil</span><span class="op" id="6870677">.</span><span class="ident" id="6870678">Discard</span><span class="op" id="6870685">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6870690">wref</span><span class="op" id="6870694">,</span>&nbsp;<span class="ident" id="6870696">err</span>&nbsp;<span class="op" id="6870700">:=</span>&nbsp;<span class="ident" id="6870703">NewWriter</span><span class="op" id="6870712">(</span><span class="ident" id="6870713">ioutil</span><span class="op" id="6870719">.</span><span class="ident" id="6870720">Discard</span><span class="op" id="6870727">,</span>&nbsp;<span class="ident" id="6870729">level</span><span class="op" id="6870734">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6870738">if</span>&nbsp;<span class="ident" id="6870741">err</span>&nbsp;<span class="op" id="6870745">!=</span>&nbsp;<span class="ident" id="6870748">nil</span>&nbsp;<span class="op" id="6870752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6870757">t</span><span class="op" id="6870758">.</span><span class="ident" id="6870759">Fatalf</span><span class="op" id="6870765">(</span><span class="string" id="6870766">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6870781">,</span>&nbsp;<span class="ident" id="6870783">err</span><span class="op" id="6870786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6870790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6870795">//&nbsp;DeepEqual&nbsp;doesn&#39;t&nbsp;compare&nbsp;functions.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6870837">w</span><span class="op" id="6870838">.</span><span class="ident" id="6870839">d</span><span class="op" id="6870840">.</span><span class="ident" id="6870841">fill</span><span class="op" id="6870845">,</span>&nbsp;<span class="ident" id="6870847">wref</span><span class="op" id="6870851">.</span><span class="ident" id="6870852">d</span><span class="op" id="6870853">.</span><span class="ident" id="6870854">fill</span>&nbsp;<span class="op" id="6870859">=</span>&nbsp;<span class="ident" id="6870861">nil</span><span class="op" id="6870864">,</span>&nbsp;<span class="ident" id="6870866">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6870872">w</span><span class="op" id="6870873">.</span><span class="ident" id="6870874">d</span><span class="op" id="6870875">.</span><span class="ident" id="6870876">step</span><span class="op" id="6870880">,</span>&nbsp;<span class="ident" id="6870882">wref</span><span class="op" id="6870886">.</span><span class="ident" id="6870887">d</span><span class="op" id="6870888">.</span><span class="ident" id="6870889">step</span>&nbsp;<span class="op" id="6870894">=</span>&nbsp;<span class="ident" id="6870896">nil</span><span class="op" id="6870899">,</span>&nbsp;<span class="ident" id="6870901">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6870907">if</span>&nbsp;<span class="op" id="6870910">!</span><span class="ident" id="6870911">reflect</span><span class="op" id="6870918">.</span><span class="ident" id="6870919">DeepEqual</span><span class="op" id="6870928">(</span><span class="ident" id="6870929">w</span><span class="op" id="6870930">,</span>&nbsp;<span class="ident" id="6870932">wref</span><span class="op" id="6870936">)</span>&nbsp;<span class="op" id="6870938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6870943">t</span><span class="op" id="6870944">.</span><span class="ident" id="6870945">Errorf</span><span class="op" id="6870951">(</span><span class="string" id="6870952">&#34;level&nbsp;%d&nbsp;Writer&nbsp;not&nbsp;reset&nbsp;after&nbsp;Reset&#34;</span><span class="op" id="6870991">,</span>&nbsp;<span class="ident" id="6870993">level</span><span class="op" id="6870998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6871002">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6871005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6871008">testResetOutput</span><span class="op" id="6871023">(</span><span class="ident" id="6871024">t</span><span class="op" id="6871025">,</span>&nbsp;<span class="keyword" id="6871027">func</span><span class="op" id="6871031">(</span><span class="ident" id="6871032">w</span>&nbsp;<span class="ident" id="6871034">io</span><span class="op" id="6871036">.</span><span class="ident" id="6871037">Writer</span><span class="op" id="6871043">)</span>&nbsp;<span class="op" id="6871045">(</span><span class="op" id="6871046">*</span><span class="ident" id="6871047">Writer</span><span class="op" id="6871053">,</span>&nbsp;<span class="builtintype" id="6871055">error</span><span class="op" id="6871060">)</span>&nbsp;<span class="op" id="6871062">{</span>&nbsp;<span class="keyword" id="6871064">return</span>&nbsp;<span class="ident" id="6871071">NewWriter</span><span class="op" id="6871080">(</span><span class="ident" id="6871081">w</span><span class="op" id="6871082">,</span>&nbsp;<span class="ident" id="6871084">NoCompression</span><span class="op" id="6871097">)</span>&nbsp;<span class="op" id="6871099">}</span><span class="op" id="6871100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6871103">testResetOutput</span><span class="op" id="6871118">(</span><span class="ident" id="6871119">t</span><span class="op" id="6871120">,</span>&nbsp;<span class="keyword" id="6871122">func</span><span class="op" id="6871126">(</span><span class="ident" id="6871127">w</span>&nbsp;<span class="ident" id="6871129">io</span><span class="op" id="6871131">.</span><span class="ident" id="6871132">Writer</span><span class="op" id="6871138">)</span>&nbsp;<span class="op" id="6871140">(</span><span class="op" id="6871141">*</span><span class="ident" id="6871142">Writer</span><span class="op" id="6871148">,</span>&nbsp;<span class="builtintype" id="6871150">error</span><span class="op" id="6871155">)</span>&nbsp;<span class="op" id="6871157">{</span>&nbsp;<span class="keyword" id="6871159">return</span>&nbsp;<span class="ident" id="6871166">NewWriter</span><span class="op" id="6871175">(</span><span class="ident" id="6871176">w</span><span class="op" id="6871177">,</span>&nbsp;<span class="ident" id="6871179">DefaultCompression</span><span class="op" id="6871197">)</span>&nbsp;<span class="op" id="6871199">}</span><span class="op" id="6871200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6871203">testResetOutput</span><span class="op" id="6871218">(</span><span class="ident" id="6871219">t</span><span class="op" id="6871220">,</span>&nbsp;<span class="keyword" id="6871222">func</span><span class="op" id="6871226">(</span><span class="ident" id="6871227">w</span>&nbsp;<span class="ident" id="6871229">io</span><span class="op" id="6871231">.</span><span class="ident" id="6871232">Writer</span><span class="op" id="6871238">)</span>&nbsp;<span class="op" id="6871240">(</span><span class="op" id="6871241">*</span><span class="ident" id="6871242">Writer</span><span class="op" id="6871248">,</span>&nbsp;<span class="builtintype" id="6871250">error</span><span class="op" id="6871255">)</span>&nbsp;<span class="op" id="6871257">{</span>&nbsp;<span class="keyword" id="6871259">return</span>&nbsp;<span class="ident" id="6871266">NewWriter</span><span class="op" id="6871275">(</span><span class="ident" id="6871276">w</span><span class="op" id="6871277">,</span>&nbsp;<span class="ident" id="6871279">BestCompression</span><span class="op" id="6871294">)</span>&nbsp;<span class="op" id="6871296">}</span><span class="op" id="6871297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6871300">dict</span>&nbsp;<span class="op" id="6871305">:=</span>&nbsp;<span class="op" id="6871308">[</span><span class="op" id="6871309">]</span><span class="builtintype" id="6871310">byte</span><span class="op" id="6871314">(</span><span class="string" id="6871315">&#34;we&nbsp;are&nbsp;the&nbsp;world&#34;</span><span class="op" id="6871333">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6871336">testResetOutput</span><span class="op" id="6871351">(</span><span class="ident" id="6871352">t</span><span class="op" id="6871353">,</span>&nbsp;<span class="keyword" id="6871355">func</span><span class="op" id="6871359">(</span><span class="ident" id="6871360">w</span>&nbsp;<span class="ident" id="6871362">io</span><span class="op" id="6871364">.</span><span class="ident" id="6871365">Writer</span><span class="op" id="6871371">)</span>&nbsp;<span class="op" id="6871373">(</span><span class="op" id="6871374">*</span><span class="ident" id="6871375">Writer</span><span class="op" id="6871381">,</span>&nbsp;<span class="builtintype" id="6871383">error</span><span class="op" id="6871388">)</span>&nbsp;<span class="op" id="6871390">{</span>&nbsp;<span class="keyword" id="6871392">return</span>&nbsp;<span class="ident" id="6871399">NewWriterDict</span><span class="op" id="6871412">(</span><span class="ident" id="6871413">w</span><span class="op" id="6871414">,</span>&nbsp;<span class="ident" id="6871416">NoCompression</span><span class="op" id="6871429">,</span>&nbsp;<span class="ident" id="6871431">dict</span><span class="op" id="6871435">)</span>&nbsp;<span class="op" id="6871437">}</span><span class="op" id="6871438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6871441">testResetOutput</span><span class="op" id="6871456">(</span><span class="ident" id="6871457">t</span><span class="op" id="6871458">,</span>&nbsp;<span class="keyword" id="6871460">func</span><span class="op" id="6871464">(</span><span class="ident" id="6871465">w</span>&nbsp;<span class="ident" id="6871467">io</span><span class="op" id="6871469">.</span><span class="ident" id="6871470">Writer</span><span class="op" id="6871476">)</span>&nbsp;<span class="op" id="6871478">(</span><span class="op" id="6871479">*</span><span class="ident" id="6871480">Writer</span><span class="op" id="6871486">,</span>&nbsp;<span class="builtintype" id="6871488">error</span><span class="op" id="6871493">)</span>&nbsp;<span class="op" id="6871495">{</span>&nbsp;<span class="keyword" id="6871497">return</span>&nbsp;<span class="ident" id="6871504">NewWriterDict</span><span class="op" id="6871517">(</span><span class="ident" id="6871518">w</span><span class="op" id="6871519">,</span>&nbsp;<span class="ident" id="6871521">DefaultCompression</span><span class="op" id="6871539">,</span>&nbsp;<span class="ident" id="6871541">dict</span><span class="op" id="6871545">)</span>&nbsp;<span class="op" id="6871547">}</span><span class="op" id="6871548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6871551">testResetOutput</span><span class="op" id="6871566">(</span><span class="ident" id="6871567">t</span><span class="op" id="6871568">,</span>&nbsp;<span class="keyword" id="6871570">func</span><span class="op" id="6871574">(</span><span class="ident" id="6871575">w</span>&nbsp;<span class="ident" id="6871577">io</span><span class="op" id="6871579">.</span><span class="ident" id="6871580">Writer</span><span class="op" id="6871586">)</span>&nbsp;<span class="op" id="6871588">(</span><span class="op" id="6871589">*</span><span class="ident" id="6871590">Writer</span><span class="op" id="6871596">,</span>&nbsp;<span class="builtintype" id="6871598">error</span><span class="op" id="6871603">)</span>&nbsp;<span class="op" id="6871605">{</span>&nbsp;<span class="keyword" id="6871607">return</span>&nbsp;<span class="ident" id="6871614">NewWriterDict</span><span class="op" id="6871627">(</span><span class="ident" id="6871628">w</span><span class="op" id="6871629">,</span>&nbsp;<span class="ident" id="6871631">BestCompression</span><span class="op" id="6871646">,</span>&nbsp;<span class="ident" id="6871648">dict</span><span class="op" id="6871652">)</span>&nbsp;<span class="op" id="6871654">}</span><span class="op" id="6871655">)</span><br>
<span class="lineno"></span><span class="op" id="6871657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="keyword" id="6871660">func</span>&nbsp;<span class="ident" id="6871665">testResetOutput</span><span class="op" id="6871680">(</span><span class="ident" id="6871681">t</span>&nbsp;<span class="op" id="6871683">*</span><span class="ident" id="6871684">testing</span><span class="op" id="6871691">.</span><span class="ident" id="6871692">T</span><span class="op" id="6871693">,</span>&nbsp;<span class="ident" id="6871695">newWriter</span>&nbsp;<span class="keyword" id="6871705">func</span><span class="op" id="6871709">(</span><span class="ident" id="6871710">w</span>&nbsp;<span class="ident" id="6871712">io</span><span class="op" id="6871714">.</span><span class="ident" id="6871715">Writer</span><span class="op" id="6871721">)</span>&nbsp;<span class="op" id="6871723">(</span><span class="op" id="6871724">*</span><span class="ident" id="6871725">Writer</span><span class="op" id="6871731">,</span>&nbsp;<span class="builtintype" id="6871733">error</span><span class="op" id="6871738">)</span><span class="op" id="6871739">)</span>&nbsp;<span class="op" id="6871741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6871744">buf</span>&nbsp;<span class="op" id="6871748">:=</span>&nbsp;<span class="builtinfunc" id="6871751">new</span><span class="op" id="6871754">(</span><span class="ident" id="6871755">bytes</span><span class="op" id="6871760">.</span><span class="ident" id="6871761">Buffer</span><span class="op" id="6871767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6871770">w</span><span class="op" id="6871771">,</span>&nbsp;<span class="ident" id="6871773">err</span>&nbsp;<span class="op" id="6871777">:=</span>&nbsp;<span class="ident" id="6871780">newWriter</span><span class="op" id="6871789">(</span><span class="ident" id="6871790">buf</span><span class="op" id="6871793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6871796">if</span>&nbsp;<span class="ident" id="6871799">err</span>&nbsp;<span class="op" id="6871803">!=</span>&nbsp;<span class="ident" id="6871806">nil</span>&nbsp;<span class="op" id="6871810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6871814">t</span><span class="op" id="6871815">.</span><span class="ident" id="6871816">Fatalf</span><span class="op" id="6871822">(</span><span class="string" id="6871823">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6871838">,</span>&nbsp;<span class="ident" id="6871840">err</span><span class="op" id="6871843">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6871846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6871849">b</span>&nbsp;<span class="op" id="6871851">:=</span>&nbsp;<span class="op" id="6871854">[</span><span class="op" id="6871855">]</span><span class="builtintype" id="6871856">byte</span><span class="op" id="6871860">(</span><span class="string" id="6871861">&#34;hello&nbsp;world&#34;</span><span class="op" id="6871874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6871877">for</span>&nbsp;<span class="ident" id="6871881">i</span>&nbsp;<span class="op" id="6871883">:=</span>&nbsp;<span class="num" id="6871886">0</span><span class="op" id="6871887">;</span>&nbsp;<span class="ident" id="6871889">i</span>&nbsp;<span class="op" id="6871891">&lt;</span>&nbsp;<span class="num" id="6871893">1024</span><span class="op" id="6871897">;</span>&nbsp;<span class="ident" id="6871899">i</span><span class="op" id="6871900">++</span>&nbsp;<span class="op" id="6871903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6871907">w</span><span class="op" id="6871908">.</span><span class="ident" id="6871909">Write</span><span class="op" id="6871914">(</span><span class="ident" id="6871915">b</span><span class="op" id="6871916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6871919">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6871922">w</span><span class="op" id="6871923">.</span><span class="ident" id="6871924">Close</span><span class="op" id="6871929">(</span><span class="op" id="6871930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6871933">out1</span>&nbsp;<span class="op" id="6871938">:=</span>&nbsp;<span class="ident" id="6871941">buf</span><span class="op" id="6871944">.</span><span class="ident" id="6871945">String</span><span class="op" id="6871951">(</span><span class="op" id="6871952">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6871956">buf2</span>&nbsp;<span class="op" id="6871961">:=</span>&nbsp;<span class="builtinfunc" id="6871964">new</span><span class="op" id="6871967">(</span><span class="ident" id="6871968">bytes</span><span class="op" id="6871973">.</span><span class="ident" id="6871974">Buffer</span><span class="op" id="6871980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6871983">w</span><span class="op" id="6871984">.</span><span class="ident" id="6871985">Reset</span><span class="op" id="6871990">(</span><span class="ident" id="6871991">buf2</span><span class="op" id="6871995">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6871998">for</span>&nbsp;<span class="ident" id="6872002">i</span>&nbsp;<span class="op" id="6872004">:=</span>&nbsp;<span class="num" id="6872007">0</span><span class="op" id="6872008">;</span>&nbsp;<span class="ident" id="6872010">i</span>&nbsp;<span class="op" id="6872012">&lt;</span>&nbsp;<span class="num" id="6872014">1024</span><span class="op" id="6872018">;</span>&nbsp;<span class="ident" id="6872020">i</span><span class="op" id="6872021">++</span>&nbsp;<span class="op" id="6872024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6872028">w</span><span class="op" id="6872029">.</span><span class="ident" id="6872030">Write</span><span class="op" id="6872035">(</span><span class="ident" id="6872036">b</span><span class="op" id="6872037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6872040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6872043">w</span><span class="op" id="6872044">.</span><span class="ident" id="6872045">Close</span><span class="op" id="6872050">(</span><span class="op" id="6872051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6872054">out2</span>&nbsp;<span class="op" id="6872059">:=</span>&nbsp;<span class="ident" id="6872062">buf2</span><span class="op" id="6872066">.</span><span class="ident" id="6872067">String</span><span class="op" id="6872073">(</span><span class="op" id="6872074">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6872078">if</span>&nbsp;<span class="ident" id="6872081">out1</span>&nbsp;<span class="op" id="6872086">!=</span>&nbsp;<span class="ident" id="6872089">out2</span>&nbsp;<span class="op" id="6872094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6872098">t</span><span class="op" id="6872099">.</span><span class="ident" id="6872100">Errorf</span><span class="op" id="6872106">(</span><span class="string" id="6872107">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="6872128">,</span>&nbsp;<span class="ident" id="6872130">out2</span><span class="op" id="6872134">,</span>&nbsp;<span class="ident" id="6872136">out1</span><span class="op" id="6872140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6872143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6872146">t</span><span class="op" id="6872147">.</span><span class="ident" id="6872148">Logf</span><span class="op" id="6872152">(</span><span class="string" id="6872153">&#34;got&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="6872167">,</span>&nbsp;<span class="builtinfunc" id="6872169">len</span><span class="op" id="6872172">(</span><span class="ident" id="6872173">out1</span><span class="op" id="6872177">)</span><span class="op" id="6872178">)</span><br>
<span class="lineno">490</span><span class="op" id="6872180">}</span>
</div>
</body>
</html>
