<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7530272">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7530327">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7530381">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7530432">package</span>&nbsp;<span class="ident" id="7530440">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7530445">import</span>&nbsp;<span class="op" id="7530452">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7530455">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7530464">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7530471">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7530477">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7530490">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7530496">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7530507">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7530518">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7530529">&#34;testing/iotest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7530547">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7530554">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7530557">type</span>&nbsp;<span class="ident" id="7530562">writerTestEntry</span>&nbsp;<span class="keyword" id="7530578">struct</span>&nbsp;<span class="op" id="7530585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530588">header</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7530597">*</span><span class="ident" id="7530598">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530606">contents</span>&nbsp;<span class="builtintype" id="7530615">string</span><br>
<span class="lineno"></span><span class="op" id="7530622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7530625">type</span>&nbsp;<span class="ident" id="7530630">writerTest</span>&nbsp;<span class="keyword" id="7530641">struct</span>&nbsp;<span class="op" id="7530648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530651">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7530659">string</span>&nbsp;<span class="comment" id="7530666">//&nbsp;filename&nbsp;of&nbsp;expected&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530698">entries</span>&nbsp;<span class="op" id="7530706">[</span><span class="op" id="7530707">]</span><span class="op" id="7530708">*</span><span class="ident" id="7530709">writerTestEntry</span><br>
<span class="lineno"></span><span class="op" id="7530725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7530728">var</span>&nbsp;<span class="ident" id="7530732">writerTests</span>&nbsp;<span class="op" id="7530744">=</span>&nbsp;<span class="op" id="7530746">[</span><span class="op" id="7530747">]</span><span class="op" id="7530748">*</span><span class="ident" id="7530749">writerTest</span><span class="op" id="7530759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7530762">//&nbsp;The&nbsp;writer&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;with&nbsp;this&nbsp;command:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7530819">//&nbsp;tar&nbsp;(GNU&nbsp;tar)&nbsp;1.26</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7530842">//&nbsp;&nbsp;&nbsp;ln&nbsp;-s&nbsp;small.txt&nbsp;link.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7530873">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;--format=ustar&nbsp;-c&nbsp;-f&nbsp;writer.tar&nbsp;small.txt&nbsp;small2.txt&nbsp;link.txt</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530954">file</span><span class="op" id="7530958">:</span>&nbsp;<span class="string" id="7530960">&#34;testdata/writer.tar&#34;</span><span class="op" id="7530981">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7530985">entries</span><span class="op" id="7530992">:</span>&nbsp;<span class="op" id="7530994">[</span><span class="op" id="7530995">]</span><span class="op" id="7530996">*</span><span class="ident" id="7530997">writerTestEntry</span><span class="op" id="7531012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531023">header</span><span class="op" id="7531029">:</span>&nbsp;<span class="op" id="7531031">&amp;</span><span class="ident" id="7531032">Header</span><span class="op" id="7531038">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531045">Name</span><span class="op" id="7531049">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7531055">&#34;small.txt&#34;</span><span class="op" id="7531066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531073">Mode</span><span class="op" id="7531077">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7531083">0640</span><span class="op" id="7531087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531094">Uid</span><span class="op" id="7531097">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7531104">73025</span><span class="op" id="7531109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531116">Gid</span><span class="op" id="7531119">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7531126">5000</span><span class="op" id="7531130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531137">Size</span><span class="op" id="7531141">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7531147">5</span><span class="op" id="7531148">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531155">ModTime</span><span class="op" id="7531162">:</span>&nbsp;&nbsp;<span class="ident" id="7531165">time</span><span class="op" id="7531169">.</span><span class="ident" id="7531170">Unix</span><span class="op" id="7531174">(</span><span class="num" id="7531175">1246508266</span><span class="op" id="7531185">,</span>&nbsp;<span class="num" id="7531187">0</span><span class="op" id="7531188">)</span><span class="op" id="7531189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531196">Typeflag</span><span class="op" id="7531204">:</span>&nbsp;<span class="string" id="7531206">&#39;0&#39;</span><span class="op" id="7531209">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531216">Uname</span><span class="op" id="7531221">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7531226">&#34;dsymonds&#34;</span><span class="op" id="7531236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531243">Gname</span><span class="op" id="7531248">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7531253">&#34;eng&#34;</span><span class="op" id="7531258">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531264">}</span><span class="op" id="7531265">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531271">contents</span><span class="op" id="7531279">:</span>&nbsp;<span class="string" id="7531281">&#34;Kilts&#34;</span><span class="op" id="7531288">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531293">}</span><span class="op" id="7531294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531305">header</span><span class="op" id="7531311">:</span>&nbsp;<span class="op" id="7531313">&amp;</span><span class="ident" id="7531314">Header</span><span class="op" id="7531320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531327">Name</span><span class="op" id="7531331">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7531337">&#34;small2.txt&#34;</span><span class="op" id="7531349">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531356">Mode</span><span class="op" id="7531360">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7531366">0640</span><span class="op" id="7531370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531377">Uid</span><span class="op" id="7531380">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7531387">73025</span><span class="op" id="7531392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531399">Gid</span><span class="op" id="7531402">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7531409">5000</span><span class="op" id="7531413">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531420">Size</span><span class="op" id="7531424">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7531430">11</span><span class="op" id="7531432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531439">ModTime</span><span class="op" id="7531446">:</span>&nbsp;&nbsp;<span class="ident" id="7531449">time</span><span class="op" id="7531453">.</span><span class="ident" id="7531454">Unix</span><span class="op" id="7531458">(</span><span class="num" id="7531459">1245217492</span><span class="op" id="7531469">,</span>&nbsp;<span class="num" id="7531471">0</span><span class="op" id="7531472">)</span><span class="op" id="7531473">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531480">Typeflag</span><span class="op" id="7531488">:</span>&nbsp;<span class="string" id="7531490">&#39;0&#39;</span><span class="op" id="7531493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531500">Uname</span><span class="op" id="7531505">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7531510">&#34;dsymonds&#34;</span><span class="op" id="7531520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531527">Gname</span><span class="op" id="7531532">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7531537">&#34;eng&#34;</span><span class="op" id="7531542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531548">}</span><span class="op" id="7531549">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531555">contents</span><span class="op" id="7531563">:</span>&nbsp;<span class="string" id="7531565">&#34;Google.com\n&#34;</span><span class="op" id="7531579">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531584">}</span><span class="op" id="7531585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531596">header</span><span class="op" id="7531602">:</span>&nbsp;<span class="op" id="7531604">&amp;</span><span class="ident" id="7531605">Header</span><span class="op" id="7531611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531618">Name</span><span class="op" id="7531622">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7531628">&#34;link.txt&#34;</span><span class="op" id="7531638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531645">Mode</span><span class="op" id="7531649">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7531655">0777</span><span class="op" id="7531659">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531666">Uid</span><span class="op" id="7531669">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7531676">1000</span><span class="op" id="7531680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531687">Gid</span><span class="op" id="7531690">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7531697">1000</span><span class="op" id="7531701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531708">Size</span><span class="op" id="7531712">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7531718">0</span><span class="op" id="7531719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531726">ModTime</span><span class="op" id="7531733">:</span>&nbsp;&nbsp;<span class="ident" id="7531736">time</span><span class="op" id="7531740">.</span><span class="ident" id="7531741">Unix</span><span class="op" id="7531745">(</span><span class="num" id="7531746">1314603082</span><span class="op" id="7531756">,</span>&nbsp;<span class="num" id="7531758">0</span><span class="op" id="7531759">)</span><span class="op" id="7531760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531767">Typeflag</span><span class="op" id="7531775">:</span>&nbsp;<span class="string" id="7531777">&#39;2&#39;</span><span class="op" id="7531780">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531787">Linkname</span><span class="op" id="7531795">:</span>&nbsp;<span class="string" id="7531797">&#34;small.txt&#34;</span><span class="op" id="7531808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531815">Uname</span><span class="op" id="7531820">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7531825">&#34;strings&#34;</span><span class="op" id="7531834">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531841">Gname</span><span class="op" id="7531846">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7531851">&#34;strings&#34;</span><span class="op" id="7531860">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531866">}</span><span class="op" id="7531867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7531873">//&nbsp;no&nbsp;contents</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531891">}</span><span class="op" id="7531892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531896">}</span><span class="op" id="7531897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531900">}</span><span class="op" id="7531901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7531904">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7531967">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;/tmp/16gig.txt</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7532029">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;/tmp/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532107">file</span><span class="op" id="7532111">:</span>&nbsp;<span class="string" id="7532113">&#34;testdata/writer-big.tar&#34;</span><span class="op" id="7532138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532142">entries</span><span class="op" id="7532149">:</span>&nbsp;<span class="op" id="7532151">[</span><span class="op" id="7532152">]</span><span class="op" id="7532153">*</span><span class="ident" id="7532154">writerTestEntry</span><span class="op" id="7532169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532174">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532180">header</span><span class="op" id="7532186">:</span>&nbsp;<span class="op" id="7532188">&amp;</span><span class="ident" id="7532189">Header</span><span class="op" id="7532195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532202">Name</span><span class="op" id="7532206">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7532212">&#34;tmp/16gig.txt&#34;</span><span class="op" id="7532227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532234">Mode</span><span class="op" id="7532238">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7532244">0640</span><span class="op" id="7532248">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532255">Uid</span><span class="op" id="7532258">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7532265">73025</span><span class="op" id="7532270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532277">Gid</span><span class="op" id="7532280">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7532287">5000</span><span class="op" id="7532291">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532298">Size</span><span class="op" id="7532302">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7532308">16</span>&nbsp;<span class="op" id="7532311">&lt;&lt;</span>&nbsp;<span class="num" id="7532314">30</span><span class="op" id="7532316">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532323">ModTime</span><span class="op" id="7532330">:</span>&nbsp;&nbsp;<span class="ident" id="7532333">time</span><span class="op" id="7532337">.</span><span class="ident" id="7532338">Unix</span><span class="op" id="7532342">(</span><span class="num" id="7532343">1254699560</span><span class="op" id="7532353">,</span>&nbsp;<span class="num" id="7532355">0</span><span class="op" id="7532356">)</span><span class="op" id="7532357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532364">Typeflag</span><span class="op" id="7532372">:</span>&nbsp;<span class="string" id="7532374">&#39;0&#39;</span><span class="op" id="7532377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532384">Uname</span><span class="op" id="7532389">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7532394">&#34;dsymonds&#34;</span><span class="op" id="7532404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532411">Gname</span><span class="op" id="7532416">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7532421">&#34;eng&#34;</span><span class="op" id="7532426">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532432">}</span><span class="op" id="7532433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7532439">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532460">contents</span><span class="op" id="7532468">:</span>&nbsp;<span class="ident" id="7532470">strings</span><span class="op" id="7532477">.</span><span class="ident" id="7532478">Repeat</span><span class="op" id="7532484">(</span><span class="string" id="7532485">&#34;\x00&#34;</span><span class="op" id="7532491">,</span>&nbsp;<span class="num" id="7532493">4</span><span class="op" id="7532494">&lt;&lt;</span><span class="num" id="7532496">10</span><span class="op" id="7532498">)</span><span class="op" id="7532499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532504">}</span><span class="op" id="7532505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532509">}</span><span class="op" id="7532510">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532513">}</span><span class="op" id="7532514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7532517">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7532580">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;(longname/)*15&nbsp;/16gig.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7532653">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;(longname/)*15&nbsp;/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big-long.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532743">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532747">file</span><span class="op" id="7532751">:</span>&nbsp;<span class="string" id="7532753">&#34;testdata/writer-big-long.tar&#34;</span><span class="op" id="7532783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532787">entries</span><span class="op" id="7532794">:</span>&nbsp;<span class="op" id="7532796">[</span><span class="op" id="7532797">]</span><span class="op" id="7532798">*</span><span class="ident" id="7532799">writerTestEntry</span><span class="op" id="7532814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532825">header</span><span class="op" id="7532831">:</span>&nbsp;<span class="op" id="7532833">&amp;</span><span class="ident" id="7532834">Header</span><span class="op" id="7532840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532847">Name</span><span class="op" id="7532851">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7532857">strings</span><span class="op" id="7532864">.</span><span class="ident" id="7532865">Repeat</span><span class="op" id="7532871">(</span><span class="string" id="7532872">&#34;longname/&#34;</span><span class="op" id="7532883">,</span>&nbsp;<span class="num" id="7532885">15</span><span class="op" id="7532887">)</span>&nbsp;<span class="op" id="7532889">+</span>&nbsp;<span class="string" id="7532891">&#34;16gig.txt&#34;</span><span class="op" id="7532902">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532909">Mode</span><span class="op" id="7532913">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7532919">0644</span><span class="op" id="7532923">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532930">Uid</span><span class="op" id="7532933">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7532940">1000</span><span class="op" id="7532944">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532951">Gid</span><span class="op" id="7532954">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7532961">1000</span><span class="op" id="7532965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532972">Size</span><span class="op" id="7532976">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7532982">16</span>&nbsp;<span class="op" id="7532985">&lt;&lt;</span>&nbsp;<span class="num" id="7532988">30</span><span class="op" id="7532990">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532997">ModTime</span><span class="op" id="7533004">:</span>&nbsp;&nbsp;<span class="ident" id="7533007">time</span><span class="op" id="7533011">.</span><span class="ident" id="7533012">Unix</span><span class="op" id="7533016">(</span><span class="num" id="7533017">1399583047</span><span class="op" id="7533027">,</span>&nbsp;<span class="num" id="7533029">0</span><span class="op" id="7533030">)</span><span class="op" id="7533031">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533038">Typeflag</span><span class="op" id="7533046">:</span>&nbsp;<span class="string" id="7533048">&#39;0&#39;</span><span class="op" id="7533051">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533058">Uname</span><span class="op" id="7533063">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7533068">&#34;guillaume&#34;</span><span class="op" id="7533079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533086">Gname</span><span class="op" id="7533091">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7533096">&#34;guillaume&#34;</span><span class="op" id="7533107">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533113">}</span><span class="op" id="7533114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7533120">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533141">contents</span><span class="op" id="7533149">:</span>&nbsp;<span class="ident" id="7533151">strings</span><span class="op" id="7533158">.</span><span class="ident" id="7533159">Repeat</span><span class="op" id="7533165">(</span><span class="string" id="7533166">&#34;\x00&#34;</span><span class="op" id="7533172">,</span>&nbsp;<span class="num" id="7533174">4</span><span class="op" id="7533175">&lt;&lt;</span><span class="num" id="7533177">10</span><span class="op" id="7533179">)</span><span class="op" id="7533180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533185">}</span><span class="op" id="7533186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533190">}</span><span class="op" id="7533191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533194">}</span><span class="op" id="7533195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7533198">//&nbsp;This&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;gnu&nbsp;tar&nbsp;1.17</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7533244">//&nbsp;gnutar&nbsp;&nbsp;-b&nbsp;4&nbsp;--format=ustar&nbsp;(longname/)*15&nbsp;+&nbsp;file.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533306">file</span><span class="op" id="7533310">:</span>&nbsp;<span class="string" id="7533312">&#34;testdata/ustar.tar&#34;</span><span class="op" id="7533332">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533336">entries</span><span class="op" id="7533343">:</span>&nbsp;<span class="op" id="7533345">[</span><span class="op" id="7533346">]</span><span class="op" id="7533347">*</span><span class="ident" id="7533348">writerTestEntry</span><span class="op" id="7533363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533368">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533374">header</span><span class="op" id="7533380">:</span>&nbsp;<span class="op" id="7533382">&amp;</span><span class="ident" id="7533383">Header</span><span class="op" id="7533389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533396">Name</span><span class="op" id="7533400">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7533406">strings</span><span class="op" id="7533413">.</span><span class="ident" id="7533414">Repeat</span><span class="op" id="7533420">(</span><span class="string" id="7533421">&#34;longname/&#34;</span><span class="op" id="7533432">,</span>&nbsp;<span class="num" id="7533434">15</span><span class="op" id="7533436">)</span>&nbsp;<span class="op" id="7533438">+</span>&nbsp;<span class="string" id="7533440">&#34;file.txt&#34;</span><span class="op" id="7533450">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533457">Mode</span><span class="op" id="7533461">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7533467">0644</span><span class="op" id="7533471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533478">Uid</span><span class="op" id="7533481">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7533488">0765</span><span class="op" id="7533492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533499">Gid</span><span class="op" id="7533502">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7533509">024</span><span class="op" id="7533512">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533519">Size</span><span class="op" id="7533523">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7533529">06</span><span class="op" id="7533531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533538">ModTime</span><span class="op" id="7533545">:</span>&nbsp;&nbsp;<span class="ident" id="7533548">time</span><span class="op" id="7533552">.</span><span class="ident" id="7533553">Unix</span><span class="op" id="7533557">(</span><span class="num" id="7533558">1360135598</span><span class="op" id="7533568">,</span>&nbsp;<span class="num" id="7533570">0</span><span class="op" id="7533571">)</span><span class="op" id="7533572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533579">Typeflag</span><span class="op" id="7533587">:</span>&nbsp;<span class="string" id="7533589">&#39;0&#39;</span><span class="op" id="7533592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533599">Uname</span><span class="op" id="7533604">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7533609">&#34;shane&#34;</span><span class="op" id="7533616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533623">Gname</span><span class="op" id="7533628">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7533633">&#34;staff&#34;</span><span class="op" id="7533640">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533646">}</span><span class="op" id="7533647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533653">contents</span><span class="op" id="7533661">:</span>&nbsp;<span class="string" id="7533663">&#34;hello\n&#34;</span><span class="op" id="7533672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533677">}</span><span class="op" id="7533678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533682">}</span><span class="op" id="7533683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533686">}</span><span class="op" id="7533687">,</span><br>
<span class="lineno">150</span><span class="op" id="7533689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7533692">//&nbsp;Render&nbsp;byte&nbsp;array&nbsp;in&nbsp;a&nbsp;two-character&nbsp;hexadecimal&nbsp;string,&nbsp;spaced&nbsp;for&nbsp;easy&nbsp;visual&nbsp;inspection.</span><br>
<span class="lineno"></span><span class="keyword" id="7533787">func</span>&nbsp;<span class="ident" id="7533792">bytestr</span><span class="op" id="7533799">(</span><span class="ident" id="7533800">offset</span>&nbsp;<span class="builtintype" id="7533807">int</span><span class="op" id="7533810">,</span>&nbsp;<span class="ident" id="7533812">b</span>&nbsp;<span class="op" id="7533814">[</span><span class="op" id="7533815">]</span><span class="builtintype" id="7533816">byte</span><span class="op" id="7533820">)</span>&nbsp;<span class="builtintype" id="7533822">string</span>&nbsp;<span class="op" id="7533829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7533832">const</span>&nbsp;<span class="ident" id="7533838">rowLen</span>&nbsp;<span class="op" id="7533845">=</span>&nbsp;<span class="num" id="7533847">32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533851">s</span>&nbsp;<span class="op" id="7533853">:=</span>&nbsp;<span class="ident" id="7533856">fmt</span><span class="op" id="7533859">.</span><span class="ident" id="7533860">Sprintf</span><span class="op" id="7533867">(</span><span class="string" id="7533868">&#34;%04x&nbsp;&#34;</span><span class="op" id="7533875">,</span>&nbsp;<span class="ident" id="7533877">offset</span><span class="op" id="7533883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7533886">for</span>&nbsp;<span class="ident" id="7533890">_</span><span class="op" id="7533891">,</span>&nbsp;<span class="ident" id="7533893">ch</span>&nbsp;<span class="op" id="7533896">:=</span>&nbsp;<span class="keyword" id="7533899">range</span>&nbsp;<span class="ident" id="7533905">b</span>&nbsp;<span class="op" id="7533907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7533911">switch</span>&nbsp;<span class="op" id="7533918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7533922">case</span>&nbsp;<span class="string" id="7533927">&#39;0&#39;</span>&nbsp;<span class="op" id="7533931">&lt;=</span>&nbsp;<span class="ident" id="7533934">ch</span>&nbsp;<span class="op" id="7533937">&amp;&amp;</span>&nbsp;<span class="ident" id="7533940">ch</span>&nbsp;<span class="op" id="7533943">&lt;=</span>&nbsp;<span class="string" id="7533946">&#39;9&#39;</span><span class="op" id="7533949">,</span>&nbsp;<span class="string" id="7533951">&#39;A&#39;</span>&nbsp;<span class="op" id="7533955">&lt;=</span>&nbsp;<span class="ident" id="7533958">ch</span>&nbsp;<span class="op" id="7533961">&amp;&amp;</span>&nbsp;<span class="ident" id="7533964">ch</span>&nbsp;<span class="op" id="7533967">&lt;=</span>&nbsp;<span class="string" id="7533970">&#39;Z&#39;</span><span class="op" id="7533973">,</span>&nbsp;<span class="string" id="7533975">&#39;a&#39;</span>&nbsp;<span class="op" id="7533979">&lt;=</span>&nbsp;<span class="ident" id="7533982">ch</span>&nbsp;<span class="op" id="7533985">&amp;&amp;</span>&nbsp;<span class="ident" id="7533988">ch</span>&nbsp;<span class="op" id="7533991">&lt;=</span>&nbsp;<span class="string" id="7533994">&#39;z&#39;</span><span class="op" id="7533997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534002">s</span>&nbsp;<span class="op" id="7534004">+=</span>&nbsp;<span class="ident" id="7534007">fmt</span><span class="op" id="7534010">.</span><span class="ident" id="7534011">Sprintf</span><span class="op" id="7534018">(</span><span class="string" id="7534019">&#34;&nbsp;&nbsp;%c&#34;</span><span class="op" id="7534025">,</span>&nbsp;<span class="ident" id="7534027">ch</span><span class="op" id="7534029">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534033">default</span><span class="op" id="7534040">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534045">s</span>&nbsp;<span class="op" id="7534047">+=</span>&nbsp;<span class="ident" id="7534050">fmt</span><span class="op" id="7534053">.</span><span class="ident" id="7534054">Sprintf</span><span class="op" id="7534061">(</span><span class="string" id="7534062">&#34;&nbsp;%02x&#34;</span><span class="op" id="7534069">,</span>&nbsp;<span class="ident" id="7534071">ch</span><span class="op" id="7534073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534083">return</span>&nbsp;<span class="ident" id="7534090">s</span><br>
<span class="lineno">165</span><span class="op" id="7534092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7534095">//&nbsp;Render&nbsp;a&nbsp;pseudo-diff&nbsp;between&nbsp;two&nbsp;blocks&nbsp;of&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="7534148">func</span>&nbsp;<span class="ident" id="7534153">bytediff</span><span class="op" id="7534161">(</span><span class="ident" id="7534162">a</span>&nbsp;<span class="op" id="7534164">[</span><span class="op" id="7534165">]</span><span class="builtintype" id="7534166">byte</span><span class="op" id="7534170">,</span>&nbsp;<span class="ident" id="7534172">b</span>&nbsp;<span class="op" id="7534174">[</span><span class="op" id="7534175">]</span><span class="builtintype" id="7534176">byte</span><span class="op" id="7534180">)</span>&nbsp;<span class="builtintype" id="7534182">string</span>&nbsp;<span class="op" id="7534189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534192">const</span>&nbsp;<span class="ident" id="7534198">rowLen</span>&nbsp;<span class="op" id="7534205">=</span>&nbsp;<span class="num" id="7534207">32</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534211">s</span>&nbsp;<span class="op" id="7534213">:=</span>&nbsp;<span class="ident" id="7534216">fmt</span><span class="op" id="7534219">.</span><span class="ident" id="7534220">Sprintf</span><span class="op" id="7534227">(</span><span class="string" id="7534228">&#34;(%d&nbsp;bytes&nbsp;vs.&nbsp;%d&nbsp;bytes)\n&#34;</span><span class="op" id="7534255">,</span>&nbsp;<span class="builtinfunc" id="7534257">len</span><span class="op" id="7534260">(</span><span class="ident" id="7534261">a</span><span class="op" id="7534262">)</span><span class="op" id="7534263">,</span>&nbsp;<span class="builtinfunc" id="7534265">len</span><span class="op" id="7534268">(</span><span class="ident" id="7534269">b</span><span class="op" id="7534270">)</span><span class="op" id="7534271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534274">for</span>&nbsp;<span class="ident" id="7534278">offset</span>&nbsp;<span class="op" id="7534285">:=</span>&nbsp;<span class="num" id="7534288">0</span><span class="op" id="7534289">;</span>&nbsp;<span class="builtinfunc" id="7534291">len</span><span class="op" id="7534294">(</span><span class="ident" id="7534295">a</span><span class="op" id="7534296">)</span><span class="op" id="7534297">+</span><span class="builtinfunc" id="7534298">len</span><span class="op" id="7534301">(</span><span class="ident" id="7534302">b</span><span class="op" id="7534303">)</span>&nbsp;<span class="op" id="7534305">&gt;</span>&nbsp;<span class="num" id="7534307">0</span><span class="op" id="7534308">;</span>&nbsp;<span class="ident" id="7534310">offset</span>&nbsp;<span class="op" id="7534317">+=</span>&nbsp;<span class="ident" id="7534320">rowLen</span>&nbsp;<span class="op" id="7534327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534331">na</span><span class="op" id="7534333">,</span>&nbsp;<span class="ident" id="7534335">nb</span>&nbsp;<span class="op" id="7534338">:=</span>&nbsp;<span class="ident" id="7534341">rowLen</span><span class="op" id="7534347">,</span>&nbsp;<span class="ident" id="7534349">rowLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534358">if</span>&nbsp;<span class="ident" id="7534361">na</span>&nbsp;<span class="op" id="7534364">&gt;</span>&nbsp;<span class="builtinfunc" id="7534366">len</span><span class="op" id="7534369">(</span><span class="ident" id="7534370">a</span><span class="op" id="7534371">)</span>&nbsp;<span class="op" id="7534373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534378">na</span>&nbsp;<span class="op" id="7534381">=</span>&nbsp;<span class="builtinfunc" id="7534383">len</span><span class="op" id="7534386">(</span><span class="ident" id="7534387">a</span><span class="op" id="7534388">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534396">if</span>&nbsp;<span class="ident" id="7534399">nb</span>&nbsp;<span class="op" id="7534402">&gt;</span>&nbsp;<span class="builtinfunc" id="7534404">len</span><span class="op" id="7534407">(</span><span class="ident" id="7534408">b</span><span class="op" id="7534409">)</span>&nbsp;<span class="op" id="7534411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534416">nb</span>&nbsp;<span class="op" id="7534419">=</span>&nbsp;<span class="builtinfunc" id="7534421">len</span><span class="op" id="7534424">(</span><span class="ident" id="7534425">b</span><span class="op" id="7534426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534434">sa</span>&nbsp;<span class="op" id="7534437">:=</span>&nbsp;<span class="ident" id="7534440">bytestr</span><span class="op" id="7534447">(</span><span class="ident" id="7534448">offset</span><span class="op" id="7534454">,</span>&nbsp;<span class="ident" id="7534456">a</span><span class="op" id="7534457">[</span><span class="num" id="7534458">0</span><span class="op" id="7534459">:</span><span class="ident" id="7534460">na</span><span class="op" id="7534462">]</span><span class="op" id="7534463">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534467">sb</span>&nbsp;<span class="op" id="7534470">:=</span>&nbsp;<span class="ident" id="7534473">bytestr</span><span class="op" id="7534480">(</span><span class="ident" id="7534481">offset</span><span class="op" id="7534487">,</span>&nbsp;<span class="ident" id="7534489">b</span><span class="op" id="7534490">[</span><span class="num" id="7534491">0</span><span class="op" id="7534492">:</span><span class="ident" id="7534493">nb</span><span class="op" id="7534495">]</span><span class="op" id="7534496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534500">if</span>&nbsp;<span class="ident" id="7534503">sa</span>&nbsp;<span class="op" id="7534506">!=</span>&nbsp;<span class="ident" id="7534509">sb</span>&nbsp;<span class="op" id="7534512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534517">s</span>&nbsp;<span class="op" id="7534519">+=</span>&nbsp;<span class="ident" id="7534522">fmt</span><span class="op" id="7534525">.</span><span class="ident" id="7534526">Sprintf</span><span class="op" id="7534533">(</span><span class="string" id="7534534">&#34;-%v\n+%v\n&#34;</span><span class="op" id="7534546">,</span>&nbsp;<span class="ident" id="7534548">sa</span><span class="op" id="7534550">,</span>&nbsp;<span class="ident" id="7534552">sb</span><span class="op" id="7534554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534562">a</span>&nbsp;<span class="op" id="7534564">=</span>&nbsp;<span class="ident" id="7534566">a</span><span class="op" id="7534567">[</span><span class="ident" id="7534568">na</span><span class="op" id="7534570">:</span><span class="op" id="7534571">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534575">b</span>&nbsp;<span class="op" id="7534577">=</span>&nbsp;<span class="ident" id="7534579">b</span><span class="op" id="7534580">[</span><span class="ident" id="7534581">nb</span><span class="op" id="7534583">:</span><span class="op" id="7534584">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534590">return</span>&nbsp;<span class="ident" id="7534597">s</span><br>
<span class="lineno"></span><span class="op" id="7534599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="7534602">func</span>&nbsp;<span class="ident" id="7534607">TestWriter</span><span class="op" id="7534617">(</span><span class="ident" id="7534618">t</span>&nbsp;<span class="op" id="7534620">*</span><span class="ident" id="7534621">testing</span><span class="op" id="7534628">.</span><span class="ident" id="7534629">T</span><span class="op" id="7534630">)</span>&nbsp;<span class="op" id="7534632">{</span><br>
<span class="lineno"></span><span class="ident" id="7534634">testLoop</span><span class="op" id="7534642">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534645">for</span>&nbsp;<span class="ident" id="7534649">i</span><span class="op" id="7534650">,</span>&nbsp;<span class="ident" id="7534652">test</span>&nbsp;<span class="op" id="7534657">:=</span>&nbsp;<span class="keyword" id="7534660">range</span>&nbsp;<span class="ident" id="7534666">writerTests</span>&nbsp;<span class="op" id="7534678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534682">expected</span><span class="op" id="7534690">,</span>&nbsp;<span class="ident" id="7534692">err</span>&nbsp;<span class="op" id="7534696">:=</span>&nbsp;<span class="ident" id="7534699">ioutil</span><span class="op" id="7534705">.</span><span class="ident" id="7534706">ReadFile</span><span class="op" id="7534714">(</span><span class="ident" id="7534715">test</span><span class="op" id="7534719">.</span><span class="ident" id="7534720">file</span><span class="op" id="7534724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534728">if</span>&nbsp;<span class="ident" id="7534731">err</span>&nbsp;<span class="op" id="7534735">!=</span>&nbsp;<span class="ident" id="7534738">nil</span>&nbsp;<span class="op" id="7534742">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534747">t</span><span class="op" id="7534748">.</span><span class="ident" id="7534749">Errorf</span><span class="op" id="7534755">(</span><span class="string" id="7534756">&#34;test&nbsp;%d:&nbsp;Unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7534787">,</span>&nbsp;<span class="ident" id="7534789">i</span><span class="op" id="7534790">,</span>&nbsp;<span class="ident" id="7534792">err</span><span class="op" id="7534795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534800">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534816">buf</span>&nbsp;<span class="op" id="7534820">:=</span>&nbsp;<span class="builtinfunc" id="7534823">new</span><span class="op" id="7534826">(</span><span class="ident" id="7534827">bytes</span><span class="op" id="7534832">.</span><span class="ident" id="7534833">Buffer</span><span class="op" id="7534839">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534843">tw</span>&nbsp;<span class="op" id="7534846">:=</span>&nbsp;<span class="ident" id="7534849">NewWriter</span><span class="op" id="7534858">(</span><span class="ident" id="7534859">iotest</span><span class="op" id="7534865">.</span><span class="ident" id="7534866">TruncateWriter</span><span class="op" id="7534880">(</span><span class="ident" id="7534881">buf</span><span class="op" id="7534884">,</span>&nbsp;<span class="num" id="7534886">4</span><span class="op" id="7534887">&lt;&lt;</span><span class="num" id="7534889">10</span><span class="op" id="7534891">)</span><span class="op" id="7534892">)</span>&nbsp;<span class="comment" id="7534894">//&nbsp;only&nbsp;catch&nbsp;the&nbsp;first&nbsp;4&nbsp;KB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534925">big</span>&nbsp;<span class="op" id="7534929">:=</span>&nbsp;<span class="builtintype" id="7534932">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534940">for</span>&nbsp;<span class="ident" id="7534944">j</span><span class="op" id="7534945">,</span>&nbsp;<span class="ident" id="7534947">entry</span>&nbsp;<span class="op" id="7534953">:=</span>&nbsp;<span class="keyword" id="7534956">range</span>&nbsp;<span class="ident" id="7534962">test</span><span class="op" id="7534966">.</span><span class="ident" id="7534967">entries</span>&nbsp;<span class="op" id="7534975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534980">big</span>&nbsp;<span class="op" id="7534984">=</span>&nbsp;<span class="ident" id="7534986">big</span>&nbsp;<span class="op" id="7534990">||</span>&nbsp;<span class="ident" id="7534993">entry</span><span class="op" id="7534998">.</span><span class="ident" id="7534999">header</span><span class="op" id="7535005">.</span><span class="ident" id="7535006">Size</span>&nbsp;<span class="op" id="7535011">&gt;</span>&nbsp;<span class="num" id="7535013">1</span><span class="op" id="7535014">&lt;&lt;</span><span class="num" id="7535016">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535022">if</span>&nbsp;<span class="ident" id="7535025">err</span>&nbsp;<span class="op" id="7535029">:=</span>&nbsp;<span class="ident" id="7535032">tw</span><span class="op" id="7535034">.</span><span class="ident" id="7535035">WriteHeader</span><span class="op" id="7535046">(</span><span class="ident" id="7535047">entry</span><span class="op" id="7535052">.</span><span class="ident" id="7535053">header</span><span class="op" id="7535059">)</span><span class="op" id="7535060">;</span>&nbsp;<span class="ident" id="7535062">err</span>&nbsp;<span class="op" id="7535066">!=</span>&nbsp;<span class="ident" id="7535069">nil</span>&nbsp;<span class="op" id="7535073">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535079">t</span><span class="op" id="7535080">.</span><span class="ident" id="7535081">Errorf</span><span class="op" id="7535087">(</span><span class="string" id="7535088">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7535134">,</span>&nbsp;<span class="ident" id="7535136">i</span><span class="op" id="7535137">,</span>&nbsp;<span class="ident" id="7535139">j</span><span class="op" id="7535140">,</span>&nbsp;<span class="ident" id="7535142">err</span><span class="op" id="7535145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535151">continue</span>&nbsp;<span class="ident" id="7535160">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7535172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535177">if</span>&nbsp;<span class="ident" id="7535180">_</span><span class="op" id="7535181">,</span>&nbsp;<span class="ident" id="7535183">err</span>&nbsp;<span class="op" id="7535187">:=</span>&nbsp;<span class="ident" id="7535190">io</span><span class="op" id="7535192">.</span><span class="ident" id="7535193">WriteString</span><span class="op" id="7535204">(</span><span class="ident" id="7535205">tw</span><span class="op" id="7535207">,</span>&nbsp;<span class="ident" id="7535209">entry</span><span class="op" id="7535214">.</span><span class="ident" id="7535215">contents</span><span class="op" id="7535223">)</span><span class="op" id="7535224">;</span>&nbsp;<span class="ident" id="7535226">err</span>&nbsp;<span class="op" id="7535230">!=</span>&nbsp;<span class="ident" id="7535233">nil</span>&nbsp;<span class="op" id="7535237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535243">t</span><span class="op" id="7535244">.</span><span class="ident" id="7535245">Errorf</span><span class="op" id="7535251">(</span><span class="string" id="7535252">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;contents:&nbsp;%v&#34;</span><span class="op" id="7535300">,</span>&nbsp;<span class="ident" id="7535302">i</span><span class="op" id="7535303">,</span>&nbsp;<span class="ident" id="7535305">j</span><span class="op" id="7535306">,</span>&nbsp;<span class="ident" id="7535308">err</span><span class="op" id="7535311">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535317">continue</span>&nbsp;<span class="ident" id="7535326">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7535338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7535342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7535346">//&nbsp;Only&nbsp;interested&nbsp;in&nbsp;Close&nbsp;failures&nbsp;for&nbsp;the&nbsp;small&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535406">if</span>&nbsp;<span class="ident" id="7535409">err</span>&nbsp;<span class="op" id="7535413">:=</span>&nbsp;<span class="ident" id="7535416">tw</span><span class="op" id="7535418">.</span><span class="ident" id="7535419">Close</span><span class="op" id="7535424">(</span><span class="op" id="7535425">)</span><span class="op" id="7535426">;</span>&nbsp;<span class="ident" id="7535428">err</span>&nbsp;<span class="op" id="7535432">!=</span>&nbsp;<span class="ident" id="7535435">nil</span>&nbsp;<span class="op" id="7535439">&amp;&amp;</span>&nbsp;<span class="op" id="7535442">!</span><span class="ident" id="7535443">big</span>&nbsp;<span class="op" id="7535447">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535452">t</span><span class="op" id="7535453">.</span><span class="ident" id="7535454">Errorf</span><span class="op" id="7535460">(</span><span class="string" id="7535461">&#34;test&nbsp;%d:&nbsp;Failed&nbsp;closing&nbsp;archive:&nbsp;%v&#34;</span><span class="op" id="7535498">,</span>&nbsp;<span class="ident" id="7535500">i</span><span class="op" id="7535501">,</span>&nbsp;<span class="ident" id="7535503">err</span><span class="op" id="7535506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535511">continue</span>&nbsp;<span class="ident" id="7535520">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7535531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535536">actual</span>&nbsp;<span class="op" id="7535543">:=</span>&nbsp;<span class="ident" id="7535546">buf</span><span class="op" id="7535549">.</span><span class="ident" id="7535550">Bytes</span><span class="op" id="7535555">(</span><span class="op" id="7535556">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535560">if</span>&nbsp;<span class="op" id="7535563">!</span><span class="ident" id="7535564">bytes</span><span class="op" id="7535569">.</span><span class="ident" id="7535570">Equal</span><span class="op" id="7535575">(</span><span class="ident" id="7535576">expected</span><span class="op" id="7535584">,</span>&nbsp;<span class="ident" id="7535586">actual</span><span class="op" id="7535592">)</span>&nbsp;<span class="op" id="7535594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535599">t</span><span class="op" id="7535600">.</span><span class="ident" id="7535601">Errorf</span><span class="op" id="7535607">(</span><span class="string" id="7535608">&#34;test&nbsp;%d:&nbsp;Incorrect&nbsp;result:&nbsp;(-=expected,&nbsp;+=actual)\n%v&#34;</span><span class="op" id="7535663">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535669">i</span><span class="op" id="7535670">,</span>&nbsp;<span class="ident" id="7535672">bytediff</span><span class="op" id="7535680">(</span><span class="ident" id="7535681">expected</span><span class="op" id="7535689">,</span>&nbsp;<span class="ident" id="7535691">actual</span><span class="op" id="7535697">)</span><span class="op" id="7535698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7535702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535706">if</span>&nbsp;<span class="ident" id="7535709">testing</span><span class="op" id="7535716">.</span><span class="ident" id="7535717">Short</span><span class="op" id="7535722">(</span><span class="op" id="7535723">)</span>&nbsp;<span class="op" id="7535725">{</span>&nbsp;<span class="comment" id="7535727">//&nbsp;The&nbsp;second&nbsp;test&nbsp;is&nbsp;expensive.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535763">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7535771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7535774">}</span><br>
<span class="lineno"></span><span class="op" id="7535776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="7535779">func</span>&nbsp;<span class="ident" id="7535784">TestPax</span><span class="op" id="7535791">(</span><span class="ident" id="7535792">t</span>&nbsp;<span class="op" id="7535794">*</span><span class="ident" id="7535795">testing</span><span class="op" id="7535802">.</span><span class="ident" id="7535803">T</span><span class="op" id="7535804">)</span>&nbsp;<span class="op" id="7535806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7535809">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535849">fileinfo</span><span class="op" id="7535857">,</span>&nbsp;<span class="ident" id="7535859">err</span>&nbsp;<span class="op" id="7535863">:=</span>&nbsp;<span class="ident" id="7535866">os</span><span class="op" id="7535868">.</span><span class="ident" id="7535869">Stat</span><span class="op" id="7535873">(</span><span class="string" id="7535874">&#34;testdata/small.txt&#34;</span><span class="op" id="7535894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535897">if</span>&nbsp;<span class="ident" id="7535900">err</span>&nbsp;<span class="op" id="7535904">!=</span>&nbsp;<span class="ident" id="7535907">nil</span>&nbsp;<span class="op" id="7535911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535915">t</span><span class="op" id="7535916">.</span><span class="ident" id="7535917">Fatal</span><span class="op" id="7535922">(</span><span class="ident" id="7535923">err</span><span class="op" id="7535926">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7535929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535932">hdr</span><span class="op" id="7535935">,</span>&nbsp;<span class="ident" id="7535937">err</span>&nbsp;<span class="op" id="7535941">:=</span>&nbsp;<span class="ident" id="7535944">FileInfoHeader</span><span class="op" id="7535958">(</span><span class="ident" id="7535959">fileinfo</span><span class="op" id="7535967">,</span>&nbsp;<span class="string" id="7535969">&#34;&#34;</span><span class="op" id="7535971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535974">if</span>&nbsp;<span class="ident" id="7535977">err</span>&nbsp;<span class="op" id="7535981">!=</span>&nbsp;<span class="ident" id="7535984">nil</span>&nbsp;<span class="op" id="7535988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535992">t</span><span class="op" id="7535993">.</span><span class="ident" id="7535994">Fatalf</span><span class="op" id="7536000">(</span><span class="string" id="7536001">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="7536014">,</span>&nbsp;<span class="ident" id="7536016">err</span><span class="op" id="7536019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7536022">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7536025">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536065">longName</span>&nbsp;<span class="op" id="7536074">:=</span>&nbsp;<span class="ident" id="7536077">strings</span><span class="op" id="7536084">.</span><span class="ident" id="7536085">Repeat</span><span class="op" id="7536091">(</span><span class="string" id="7536092">&#34;ab&#34;</span><span class="op" id="7536096">,</span>&nbsp;<span class="num" id="7536098">100</span><span class="op" id="7536101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536104">contents</span>&nbsp;<span class="op" id="7536113">:=</span>&nbsp;<span class="ident" id="7536116">strings</span><span class="op" id="7536123">.</span><span class="ident" id="7536124">Repeat</span><span class="op" id="7536130">(</span><span class="string" id="7536131">&#34;&nbsp;&#34;</span><span class="op" id="7536134">,</span>&nbsp;<span class="builtintype" id="7536136">int</span><span class="op" id="7536139">(</span><span class="ident" id="7536140">hdr</span><span class="op" id="7536143">.</span><span class="ident" id="7536144">Size</span><span class="op" id="7536148">)</span><span class="op" id="7536149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536152">hdr</span><span class="op" id="7536155">.</span><span class="ident" id="7536156">Name</span>&nbsp;<span class="op" id="7536161">=</span>&nbsp;<span class="ident" id="7536163">longName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536173">var</span>&nbsp;<span class="ident" id="7536177">buf</span>&nbsp;<span class="ident" id="7536181">bytes</span><span class="op" id="7536186">.</span><span class="ident" id="7536187">Buffer</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536195">writer</span>&nbsp;<span class="op" id="7536202">:=</span>&nbsp;<span class="ident" id="7536205">NewWriter</span><span class="op" id="7536214">(</span><span class="op" id="7536215">&amp;</span><span class="ident" id="7536216">buf</span><span class="op" id="7536219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536222">if</span>&nbsp;<span class="ident" id="7536225">err</span>&nbsp;<span class="op" id="7536229">:=</span>&nbsp;<span class="ident" id="7536232">writer</span><span class="op" id="7536238">.</span><span class="ident" id="7536239">WriteHeader</span><span class="op" id="7536250">(</span><span class="ident" id="7536251">hdr</span><span class="op" id="7536254">)</span><span class="op" id="7536255">;</span>&nbsp;<span class="ident" id="7536257">err</span>&nbsp;<span class="op" id="7536261">!=</span>&nbsp;<span class="ident" id="7536264">nil</span>&nbsp;<span class="op" id="7536268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536272">t</span><span class="op" id="7536273">.</span><span class="ident" id="7536274">Fatal</span><span class="op" id="7536279">(</span><span class="ident" id="7536280">err</span><span class="op" id="7536283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7536286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536289">if</span>&nbsp;<span class="ident" id="7536292">_</span><span class="op" id="7536293">,</span>&nbsp;<span class="ident" id="7536295">err</span>&nbsp;<span class="op" id="7536299">=</span>&nbsp;<span class="ident" id="7536301">writer</span><span class="op" id="7536307">.</span><span class="ident" id="7536308">Write</span><span class="op" id="7536313">(</span><span class="op" id="7536314">[</span><span class="op" id="7536315">]</span><span class="builtintype" id="7536316">byte</span><span class="op" id="7536320">(</span><span class="ident" id="7536321">contents</span><span class="op" id="7536329">)</span><span class="op" id="7536330">)</span><span class="op" id="7536331">;</span>&nbsp;<span class="ident" id="7536333">err</span>&nbsp;<span class="op" id="7536337">!=</span>&nbsp;<span class="ident" id="7536340">nil</span>&nbsp;<span class="op" id="7536344">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536348">t</span><span class="op" id="7536349">.</span><span class="ident" id="7536350">Fatal</span><span class="op" id="7536355">(</span><span class="ident" id="7536356">err</span><span class="op" id="7536359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7536362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536365">if</span>&nbsp;<span class="ident" id="7536368">err</span>&nbsp;<span class="op" id="7536372">:=</span>&nbsp;<span class="ident" id="7536375">writer</span><span class="op" id="7536381">.</span><span class="ident" id="7536382">Close</span><span class="op" id="7536387">(</span><span class="op" id="7536388">)</span><span class="op" id="7536389">;</span>&nbsp;<span class="ident" id="7536391">err</span>&nbsp;<span class="op" id="7536395">!=</span>&nbsp;<span class="ident" id="7536398">nil</span>&nbsp;<span class="op" id="7536402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536406">t</span><span class="op" id="7536407">.</span><span class="ident" id="7536408">Fatal</span><span class="op" id="7536413">(</span><span class="ident" id="7536414">err</span><span class="op" id="7536417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7536420">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7536423">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536481">if</span>&nbsp;<span class="op" id="7536484">!</span><span class="ident" id="7536485">bytes</span><span class="op" id="7536490">.</span><span class="ident" id="7536491">Contains</span><span class="op" id="7536499">(</span><span class="ident" id="7536500">buf</span><span class="op" id="7536503">.</span><span class="ident" id="7536504">Bytes</span><span class="op" id="7536509">(</span><span class="op" id="7536510">)</span><span class="op" id="7536511">,</span>&nbsp;<span class="op" id="7536513">[</span><span class="op" id="7536514">]</span><span class="builtintype" id="7536515">byte</span><span class="op" id="7536519">(</span><span class="string" id="7536520">&#34;PaxHeaders.&#34;</span><span class="op" id="7536533">)</span><span class="op" id="7536534">)</span>&nbsp;<span class="op" id="7536536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536540">t</span><span class="op" id="7536541">.</span><span class="ident" id="7536542">Fatal</span><span class="op" id="7536547">(</span><span class="string" id="7536548">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7536597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7536600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7536603">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536665">reader</span>&nbsp;<span class="op" id="7536672">:=</span>&nbsp;<span class="ident" id="7536675">NewReader</span><span class="op" id="7536684">(</span><span class="op" id="7536685">&amp;</span><span class="ident" id="7536686">buf</span><span class="op" id="7536689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536692">hdr</span><span class="op" id="7536695">,</span>&nbsp;<span class="ident" id="7536697">err</span>&nbsp;<span class="op" id="7536701">=</span>&nbsp;<span class="ident" id="7536703">reader</span><span class="op" id="7536709">.</span><span class="ident" id="7536710">Next</span><span class="op" id="7536714">(</span><span class="op" id="7536715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536718">if</span>&nbsp;<span class="ident" id="7536721">err</span>&nbsp;<span class="op" id="7536725">!=</span>&nbsp;<span class="ident" id="7536728">nil</span>&nbsp;<span class="op" id="7536732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536736">t</span><span class="op" id="7536737">.</span><span class="ident" id="7536738">Fatal</span><span class="op" id="7536743">(</span><span class="ident" id="7536744">err</span><span class="op" id="7536747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7536750">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536753">if</span>&nbsp;<span class="ident" id="7536756">hdr</span><span class="op" id="7536759">.</span><span class="ident" id="7536760">Name</span>&nbsp;<span class="op" id="7536765">!=</span>&nbsp;<span class="ident" id="7536768">longName</span>&nbsp;<span class="op" id="7536777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536781">t</span><span class="op" id="7536782">.</span><span class="ident" id="7536783">Fatal</span><span class="op" id="7536788">(</span><span class="string" id="7536789">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;file&nbsp;name&#34;</span><span class="op" id="7536822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7536825">}</span><br>
<span class="lineno"></span><span class="op" id="7536827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="7536830">func</span>&nbsp;<span class="ident" id="7536835">TestPaxSymlink</span><span class="op" id="7536849">(</span><span class="ident" id="7536850">t</span>&nbsp;<span class="op" id="7536852">*</span><span class="ident" id="7536853">testing</span><span class="op" id="7536860">.</span><span class="ident" id="7536861">T</span><span class="op" id="7536862">)</span>&nbsp;<span class="op" id="7536864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7536867">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;linkname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536911">fileinfo</span><span class="op" id="7536919">,</span>&nbsp;<span class="ident" id="7536921">err</span>&nbsp;<span class="op" id="7536925">:=</span>&nbsp;<span class="ident" id="7536928">os</span><span class="op" id="7536930">.</span><span class="ident" id="7536931">Stat</span><span class="op" id="7536935">(</span><span class="string" id="7536936">&#34;testdata/small.txt&#34;</span><span class="op" id="7536956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536959">if</span>&nbsp;<span class="ident" id="7536962">err</span>&nbsp;<span class="op" id="7536966">!=</span>&nbsp;<span class="ident" id="7536969">nil</span>&nbsp;<span class="op" id="7536973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536977">t</span><span class="op" id="7536978">.</span><span class="ident" id="7536979">Fatal</span><span class="op" id="7536984">(</span><span class="ident" id="7536985">err</span><span class="op" id="7536988">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7536991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536994">hdr</span><span class="op" id="7536997">,</span>&nbsp;<span class="ident" id="7536999">err</span>&nbsp;<span class="op" id="7537003">:=</span>&nbsp;<span class="ident" id="7537006">FileInfoHeader</span><span class="op" id="7537020">(</span><span class="ident" id="7537021">fileinfo</span><span class="op" id="7537029">,</span>&nbsp;<span class="string" id="7537031">&#34;&#34;</span><span class="op" id="7537033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537036">hdr</span><span class="op" id="7537039">.</span><span class="ident" id="7537040">Typeflag</span>&nbsp;<span class="op" id="7537049">=</span>&nbsp;<span class="ident" id="7537051">TypeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537064">if</span>&nbsp;<span class="ident" id="7537067">err</span>&nbsp;<span class="op" id="7537071">!=</span>&nbsp;<span class="ident" id="7537074">nil</span>&nbsp;<span class="op" id="7537078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537082">t</span><span class="op" id="7537083">.</span><span class="ident" id="7537084">Fatalf</span><span class="op" id="7537090">(</span><span class="string" id="7537091">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7537105">,</span>&nbsp;<span class="ident" id="7537107">err</span><span class="op" id="7537110">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7537113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7537116">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;linkname&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537160">longLinkname</span>&nbsp;<span class="op" id="7537173">:=</span>&nbsp;<span class="ident" id="7537176">strings</span><span class="op" id="7537183">.</span><span class="ident" id="7537184">Repeat</span><span class="op" id="7537190">(</span><span class="string" id="7537191">&#34;1234567890/1234567890&#34;</span><span class="op" id="7537214">,</span>&nbsp;<span class="num" id="7537216">10</span><span class="op" id="7537218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537221">hdr</span><span class="op" id="7537224">.</span><span class="ident" id="7537225">Linkname</span>&nbsp;<span class="op" id="7537234">=</span>&nbsp;<span class="ident" id="7537236">longLinkname</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537251">hdr</span><span class="op" id="7537254">.</span><span class="ident" id="7537255">Size</span>&nbsp;<span class="op" id="7537260">=</span>&nbsp;<span class="num" id="7537262">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537265">var</span>&nbsp;<span class="ident" id="7537269">buf</span>&nbsp;<span class="ident" id="7537273">bytes</span><span class="op" id="7537278">.</span><span class="ident" id="7537279">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537287">writer</span>&nbsp;<span class="op" id="7537294">:=</span>&nbsp;<span class="ident" id="7537297">NewWriter</span><span class="op" id="7537306">(</span><span class="op" id="7537307">&amp;</span><span class="ident" id="7537308">buf</span><span class="op" id="7537311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537314">if</span>&nbsp;<span class="ident" id="7537317">err</span>&nbsp;<span class="op" id="7537321">:=</span>&nbsp;<span class="ident" id="7537324">writer</span><span class="op" id="7537330">.</span><span class="ident" id="7537331">WriteHeader</span><span class="op" id="7537342">(</span><span class="ident" id="7537343">hdr</span><span class="op" id="7537346">)</span><span class="op" id="7537347">;</span>&nbsp;<span class="ident" id="7537349">err</span>&nbsp;<span class="op" id="7537353">!=</span>&nbsp;<span class="ident" id="7537356">nil</span>&nbsp;<span class="op" id="7537360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537364">t</span><span class="op" id="7537365">.</span><span class="ident" id="7537366">Fatal</span><span class="op" id="7537371">(</span><span class="ident" id="7537372">err</span><span class="op" id="7537375">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7537378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537381">if</span>&nbsp;<span class="ident" id="7537384">err</span>&nbsp;<span class="op" id="7537388">:=</span>&nbsp;<span class="ident" id="7537391">writer</span><span class="op" id="7537397">.</span><span class="ident" id="7537398">Close</span><span class="op" id="7537403">(</span><span class="op" id="7537404">)</span><span class="op" id="7537405">;</span>&nbsp;<span class="ident" id="7537407">err</span>&nbsp;<span class="op" id="7537411">!=</span>&nbsp;<span class="ident" id="7537414">nil</span>&nbsp;<span class="op" id="7537418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537422">t</span><span class="op" id="7537423">.</span><span class="ident" id="7537424">Fatal</span><span class="op" id="7537429">(</span><span class="ident" id="7537430">err</span><span class="op" id="7537433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7537436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7537439">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537497">if</span>&nbsp;<span class="op" id="7537500">!</span><span class="ident" id="7537501">bytes</span><span class="op" id="7537506">.</span><span class="ident" id="7537507">Contains</span><span class="op" id="7537515">(</span><span class="ident" id="7537516">buf</span><span class="op" id="7537519">.</span><span class="ident" id="7537520">Bytes</span><span class="op" id="7537525">(</span><span class="op" id="7537526">)</span><span class="op" id="7537527">,</span>&nbsp;<span class="op" id="7537529">[</span><span class="op" id="7537530">]</span><span class="builtintype" id="7537531">byte</span><span class="op" id="7537535">(</span><span class="string" id="7537536">&#34;PaxHeaders.&#34;</span><span class="op" id="7537549">)</span><span class="op" id="7537550">)</span>&nbsp;<span class="op" id="7537552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537556">t</span><span class="op" id="7537557">.</span><span class="ident" id="7537558">Fatal</span><span class="op" id="7537563">(</span><span class="string" id="7537564">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7537613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7537616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7537619">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537681">reader</span>&nbsp;<span class="op" id="7537688">:=</span>&nbsp;<span class="ident" id="7537691">NewReader</span><span class="op" id="7537700">(</span><span class="op" id="7537701">&amp;</span><span class="ident" id="7537702">buf</span><span class="op" id="7537705">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537708">hdr</span><span class="op" id="7537711">,</span>&nbsp;<span class="ident" id="7537713">err</span>&nbsp;<span class="op" id="7537717">=</span>&nbsp;<span class="ident" id="7537719">reader</span><span class="op" id="7537725">.</span><span class="ident" id="7537726">Next</span><span class="op" id="7537730">(</span><span class="op" id="7537731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537734">if</span>&nbsp;<span class="ident" id="7537737">err</span>&nbsp;<span class="op" id="7537741">!=</span>&nbsp;<span class="ident" id="7537744">nil</span>&nbsp;<span class="op" id="7537748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537752">t</span><span class="op" id="7537753">.</span><span class="ident" id="7537754">Fatal</span><span class="op" id="7537759">(</span><span class="ident" id="7537760">err</span><span class="op" id="7537763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7537766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537769">if</span>&nbsp;<span class="ident" id="7537772">hdr</span><span class="op" id="7537775">.</span><span class="ident" id="7537776">Linkname</span>&nbsp;<span class="op" id="7537785">!=</span>&nbsp;<span class="ident" id="7537788">longLinkname</span>&nbsp;<span class="op" id="7537801">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537805">t</span><span class="op" id="7537806">.</span><span class="ident" id="7537807">Fatal</span><span class="op" id="7537812">(</span><span class="string" id="7537813">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;link&nbsp;name&#34;</span><span class="op" id="7537846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7537849">}</span><br>
<span class="lineno"></span><span class="op" id="7537851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7537854">func</span>&nbsp;<span class="ident" id="7537859">TestPaxNonAscii</span><span class="op" id="7537874">(</span><span class="ident" id="7537875">t</span>&nbsp;<span class="op" id="7537877">*</span><span class="ident" id="7537878">testing</span><span class="op" id="7537885">.</span><span class="ident" id="7537886">T</span><span class="op" id="7537887">)</span>&nbsp;<span class="op" id="7537889">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7537892">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;non&nbsp;ascii.&nbsp;These&nbsp;should&nbsp;trigger&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7537964">//&nbsp;because&nbsp;pax&nbsp;headers&nbsp;have&nbsp;a&nbsp;defined&nbsp;utf-8&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538019">fileinfo</span><span class="op" id="7538027">,</span>&nbsp;<span class="ident" id="7538029">err</span>&nbsp;<span class="op" id="7538033">:=</span>&nbsp;<span class="ident" id="7538036">os</span><span class="op" id="7538038">.</span><span class="ident" id="7538039">Stat</span><span class="op" id="7538043">(</span><span class="string" id="7538044">&#34;testdata/small.txt&#34;</span><span class="op" id="7538064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538067">if</span>&nbsp;<span class="ident" id="7538070">err</span>&nbsp;<span class="op" id="7538074">!=</span>&nbsp;<span class="ident" id="7538077">nil</span>&nbsp;<span class="op" id="7538081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538085">t</span><span class="op" id="7538086">.</span><span class="ident" id="7538087">Fatal</span><span class="op" id="7538092">(</span><span class="ident" id="7538093">err</span><span class="op" id="7538096">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538103">hdr</span><span class="op" id="7538106">,</span>&nbsp;<span class="ident" id="7538108">err</span>&nbsp;<span class="op" id="7538112">:=</span>&nbsp;<span class="ident" id="7538115">FileInfoHeader</span><span class="op" id="7538129">(</span><span class="ident" id="7538130">fileinfo</span><span class="op" id="7538138">,</span>&nbsp;<span class="string" id="7538140">&#34;&#34;</span><span class="op" id="7538142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538145">if</span>&nbsp;<span class="ident" id="7538148">err</span>&nbsp;<span class="op" id="7538152">!=</span>&nbsp;<span class="ident" id="7538155">nil</span>&nbsp;<span class="op" id="7538159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538163">t</span><span class="op" id="7538164">.</span><span class="ident" id="7538165">Fatalf</span><span class="op" id="7538171">(</span><span class="string" id="7538172">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7538186">,</span>&nbsp;<span class="ident" id="7538188">err</span><span class="op" id="7538191">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7538198">//&nbsp;some&nbsp;sample&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538219">chineseFilename</span>&nbsp;<span class="op" id="7538235">:=</span>&nbsp;<span class="string" id="7538238">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538251">chineseGroupname</span>&nbsp;<span class="op" id="7538268">:=</span>&nbsp;<span class="string" id="7538271">&#34;&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538278">chineseUsername</span>&nbsp;<span class="op" id="7538294">:=</span>&nbsp;<span class="string" id="7538297">&#34;&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538311">hdr</span><span class="op" id="7538314">.</span><span class="ident" id="7538315">Name</span>&nbsp;<span class="op" id="7538320">=</span>&nbsp;<span class="ident" id="7538322">chineseFilename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538339">hdr</span><span class="op" id="7538342">.</span><span class="ident" id="7538343">Gname</span>&nbsp;<span class="op" id="7538349">=</span>&nbsp;<span class="ident" id="7538351">chineseGroupname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538369">hdr</span><span class="op" id="7538372">.</span><span class="ident" id="7538373">Uname</span>&nbsp;<span class="op" id="7538379">=</span>&nbsp;<span class="ident" id="7538381">chineseUsername</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538399">contents</span>&nbsp;<span class="op" id="7538408">:=</span>&nbsp;<span class="ident" id="7538411">strings</span><span class="op" id="7538418">.</span><span class="ident" id="7538419">Repeat</span><span class="op" id="7538425">(</span><span class="string" id="7538426">&#34;&nbsp;&#34;</span><span class="op" id="7538429">,</span>&nbsp;<span class="builtintype" id="7538431">int</span><span class="op" id="7538434">(</span><span class="ident" id="7538435">hdr</span><span class="op" id="7538438">.</span><span class="ident" id="7538439">Size</span><span class="op" id="7538443">)</span><span class="op" id="7538444">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538448">var</span>&nbsp;<span class="ident" id="7538452">buf</span>&nbsp;<span class="ident" id="7538456">bytes</span><span class="op" id="7538461">.</span><span class="ident" id="7538462">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538470">writer</span>&nbsp;<span class="op" id="7538477">:=</span>&nbsp;<span class="ident" id="7538480">NewWriter</span><span class="op" id="7538489">(</span><span class="op" id="7538490">&amp;</span><span class="ident" id="7538491">buf</span><span class="op" id="7538494">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538497">if</span>&nbsp;<span class="ident" id="7538500">err</span>&nbsp;<span class="op" id="7538504">:=</span>&nbsp;<span class="ident" id="7538507">writer</span><span class="op" id="7538513">.</span><span class="ident" id="7538514">WriteHeader</span><span class="op" id="7538525">(</span><span class="ident" id="7538526">hdr</span><span class="op" id="7538529">)</span><span class="op" id="7538530">;</span>&nbsp;<span class="ident" id="7538532">err</span>&nbsp;<span class="op" id="7538536">!=</span>&nbsp;<span class="ident" id="7538539">nil</span>&nbsp;<span class="op" id="7538543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538547">t</span><span class="op" id="7538548">.</span><span class="ident" id="7538549">Fatal</span><span class="op" id="7538554">(</span><span class="ident" id="7538555">err</span><span class="op" id="7538558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538564">if</span>&nbsp;<span class="ident" id="7538567">_</span><span class="op" id="7538568">,</span>&nbsp;<span class="ident" id="7538570">err</span>&nbsp;<span class="op" id="7538574">=</span>&nbsp;<span class="ident" id="7538576">writer</span><span class="op" id="7538582">.</span><span class="ident" id="7538583">Write</span><span class="op" id="7538588">(</span><span class="op" id="7538589">[</span><span class="op" id="7538590">]</span><span class="builtintype" id="7538591">byte</span><span class="op" id="7538595">(</span><span class="ident" id="7538596">contents</span><span class="op" id="7538604">)</span><span class="op" id="7538605">)</span><span class="op" id="7538606">;</span>&nbsp;<span class="ident" id="7538608">err</span>&nbsp;<span class="op" id="7538612">!=</span>&nbsp;<span class="ident" id="7538615">nil</span>&nbsp;<span class="op" id="7538619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538623">t</span><span class="op" id="7538624">.</span><span class="ident" id="7538625">Fatal</span><span class="op" id="7538630">(</span><span class="ident" id="7538631">err</span><span class="op" id="7538634">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538640">if</span>&nbsp;<span class="ident" id="7538643">err</span>&nbsp;<span class="op" id="7538647">:=</span>&nbsp;<span class="ident" id="7538650">writer</span><span class="op" id="7538656">.</span><span class="ident" id="7538657">Close</span><span class="op" id="7538662">(</span><span class="op" id="7538663">)</span><span class="op" id="7538664">;</span>&nbsp;<span class="ident" id="7538666">err</span>&nbsp;<span class="op" id="7538670">!=</span>&nbsp;<span class="ident" id="7538673">nil</span>&nbsp;<span class="op" id="7538677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538681">t</span><span class="op" id="7538682">.</span><span class="ident" id="7538683">Fatal</span><span class="op" id="7538688">(</span><span class="ident" id="7538689">err</span><span class="op" id="7538692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7538698">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538756">if</span>&nbsp;<span class="op" id="7538759">!</span><span class="ident" id="7538760">bytes</span><span class="op" id="7538765">.</span><span class="ident" id="7538766">Contains</span><span class="op" id="7538774">(</span><span class="ident" id="7538775">buf</span><span class="op" id="7538778">.</span><span class="ident" id="7538779">Bytes</span><span class="op" id="7538784">(</span><span class="op" id="7538785">)</span><span class="op" id="7538786">,</span>&nbsp;<span class="op" id="7538788">[</span><span class="op" id="7538789">]</span><span class="builtintype" id="7538790">byte</span><span class="op" id="7538794">(</span><span class="string" id="7538795">&#34;PaxHeaders.&#34;</span><span class="op" id="7538808">)</span><span class="op" id="7538809">)</span>&nbsp;<span class="op" id="7538811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538815">t</span><span class="op" id="7538816">.</span><span class="ident" id="7538817">Fatal</span><span class="op" id="7538822">(</span><span class="string" id="7538823">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7538872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7538878">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538940">reader</span>&nbsp;<span class="op" id="7538947">:=</span>&nbsp;<span class="ident" id="7538950">NewReader</span><span class="op" id="7538959">(</span><span class="op" id="7538960">&amp;</span><span class="ident" id="7538961">buf</span><span class="op" id="7538964">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538967">hdr</span><span class="op" id="7538970">,</span>&nbsp;<span class="ident" id="7538972">err</span>&nbsp;<span class="op" id="7538976">=</span>&nbsp;<span class="ident" id="7538978">reader</span><span class="op" id="7538984">.</span><span class="ident" id="7538985">Next</span><span class="op" id="7538989">(</span><span class="op" id="7538990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538993">if</span>&nbsp;<span class="ident" id="7538996">err</span>&nbsp;<span class="op" id="7539000">!=</span>&nbsp;<span class="ident" id="7539003">nil</span>&nbsp;<span class="op" id="7539007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539011">t</span><span class="op" id="7539012">.</span><span class="ident" id="7539013">Fatal</span><span class="op" id="7539018">(</span><span class="ident" id="7539019">err</span><span class="op" id="7539022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7539028">if</span>&nbsp;<span class="ident" id="7539031">hdr</span><span class="op" id="7539034">.</span><span class="ident" id="7539035">Name</span>&nbsp;<span class="op" id="7539040">!=</span>&nbsp;<span class="ident" id="7539043">chineseFilename</span>&nbsp;<span class="op" id="7539059">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539063">t</span><span class="op" id="7539064">.</span><span class="ident" id="7539065">Fatal</span><span class="op" id="7539070">(</span><span class="string" id="7539071">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;name&#34;</span><span class="op" id="7539102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7539108">if</span>&nbsp;<span class="ident" id="7539111">hdr</span><span class="op" id="7539114">.</span><span class="ident" id="7539115">Gname</span>&nbsp;<span class="op" id="7539121">!=</span>&nbsp;<span class="ident" id="7539124">chineseGroupname</span>&nbsp;<span class="op" id="7539141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539145">t</span><span class="op" id="7539146">.</span><span class="ident" id="7539147">Fatal</span><span class="op" id="7539152">(</span><span class="string" id="7539153">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;group&#34;</span><span class="op" id="7539185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539188">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7539191">if</span>&nbsp;<span class="ident" id="7539194">hdr</span><span class="op" id="7539197">.</span><span class="ident" id="7539198">Uname</span>&nbsp;<span class="op" id="7539204">!=</span>&nbsp;<span class="ident" id="7539207">chineseUsername</span>&nbsp;<span class="op" id="7539223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539227">t</span><span class="op" id="7539228">.</span><span class="ident" id="7539229">Fatal</span><span class="op" id="7539234">(</span><span class="string" id="7539235">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;user&#34;</span><span class="op" id="7539266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539269">}</span><br>
<span class="lineno"></span><span class="op" id="7539271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="7539274">func</span>&nbsp;<span class="ident" id="7539279">TestPaxXattrs</span><span class="op" id="7539292">(</span><span class="ident" id="7539293">t</span>&nbsp;<span class="op" id="7539295">*</span><span class="ident" id="7539296">testing</span><span class="op" id="7539303">.</span><span class="ident" id="7539304">T</span><span class="op" id="7539305">)</span>&nbsp;<span class="op" id="7539307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539310">xattrs</span>&nbsp;<span class="op" id="7539317">:=</span>&nbsp;<span class="keyword" id="7539320">map</span><span class="op" id="7539323">[</span><span class="builtintype" id="7539324">string</span><span class="op" id="7539330">]</span><span class="builtintype" id="7539331">string</span><span class="op" id="7539337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7539341">&#34;user.key&#34;</span><span class="op" id="7539351">:</span>&nbsp;<span class="string" id="7539353">&#34;value&#34;</span><span class="op" id="7539360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7539367">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;an&nbsp;xattr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539403">fileinfo</span><span class="op" id="7539411">,</span>&nbsp;<span class="ident" id="7539413">err</span>&nbsp;<span class="op" id="7539417">:=</span>&nbsp;<span class="ident" id="7539420">os</span><span class="op" id="7539422">.</span><span class="ident" id="7539423">Stat</span><span class="op" id="7539427">(</span><span class="string" id="7539428">&#34;testdata/small.txt&#34;</span><span class="op" id="7539448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7539451">if</span>&nbsp;<span class="ident" id="7539454">err</span>&nbsp;<span class="op" id="7539458">!=</span>&nbsp;<span class="ident" id="7539461">nil</span>&nbsp;<span class="op" id="7539465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539469">t</span><span class="op" id="7539470">.</span><span class="ident" id="7539471">Fatal</span><span class="op" id="7539476">(</span><span class="ident" id="7539477">err</span><span class="op" id="7539480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539483">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539486">hdr</span><span class="op" id="7539489">,</span>&nbsp;<span class="ident" id="7539491">err</span>&nbsp;<span class="op" id="7539495">:=</span>&nbsp;<span class="ident" id="7539498">FileInfoHeader</span><span class="op" id="7539512">(</span><span class="ident" id="7539513">fileinfo</span><span class="op" id="7539521">,</span>&nbsp;<span class="string" id="7539523">&#34;&#34;</span><span class="op" id="7539525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7539528">if</span>&nbsp;<span class="ident" id="7539531">err</span>&nbsp;<span class="op" id="7539535">!=</span>&nbsp;<span class="ident" id="7539538">nil</span>&nbsp;<span class="op" id="7539542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539546">t</span><span class="op" id="7539547">.</span><span class="ident" id="7539548">Fatalf</span><span class="op" id="7539554">(</span><span class="string" id="7539555">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="7539568">,</span>&nbsp;<span class="ident" id="7539570">err</span><span class="op" id="7539573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539579">contents</span>&nbsp;<span class="op" id="7539588">:=</span>&nbsp;<span class="string" id="7539591">&#34;Kilts&#34;</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539600">hdr</span><span class="op" id="7539603">.</span><span class="ident" id="7539604">Xattrs</span>&nbsp;<span class="op" id="7539611">=</span>&nbsp;<span class="ident" id="7539613">xattrs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7539621">var</span>&nbsp;<span class="ident" id="7539625">buf</span>&nbsp;<span class="ident" id="7539629">bytes</span><span class="op" id="7539634">.</span><span class="ident" id="7539635">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539643">writer</span>&nbsp;<span class="op" id="7539650">:=</span>&nbsp;<span class="ident" id="7539653">NewWriter</span><span class="op" id="7539662">(</span><span class="op" id="7539663">&amp;</span><span class="ident" id="7539664">buf</span><span class="op" id="7539667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7539670">if</span>&nbsp;<span class="ident" id="7539673">err</span>&nbsp;<span class="op" id="7539677">:=</span>&nbsp;<span class="ident" id="7539680">writer</span><span class="op" id="7539686">.</span><span class="ident" id="7539687">WriteHeader</span><span class="op" id="7539698">(</span><span class="ident" id="7539699">hdr</span><span class="op" id="7539702">)</span><span class="op" id="7539703">;</span>&nbsp;<span class="ident" id="7539705">err</span>&nbsp;<span class="op" id="7539709">!=</span>&nbsp;<span class="ident" id="7539712">nil</span>&nbsp;<span class="op" id="7539716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539720">t</span><span class="op" id="7539721">.</span><span class="ident" id="7539722">Fatal</span><span class="op" id="7539727">(</span><span class="ident" id="7539728">err</span><span class="op" id="7539731">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7539737">if</span>&nbsp;<span class="ident" id="7539740">_</span><span class="op" id="7539741">,</span>&nbsp;<span class="ident" id="7539743">err</span>&nbsp;<span class="op" id="7539747">=</span>&nbsp;<span class="ident" id="7539749">writer</span><span class="op" id="7539755">.</span><span class="ident" id="7539756">Write</span><span class="op" id="7539761">(</span><span class="op" id="7539762">[</span><span class="op" id="7539763">]</span><span class="builtintype" id="7539764">byte</span><span class="op" id="7539768">(</span><span class="ident" id="7539769">contents</span><span class="op" id="7539777">)</span><span class="op" id="7539778">)</span><span class="op" id="7539779">;</span>&nbsp;<span class="ident" id="7539781">err</span>&nbsp;<span class="op" id="7539785">!=</span>&nbsp;<span class="ident" id="7539788">nil</span>&nbsp;<span class="op" id="7539792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539796">t</span><span class="op" id="7539797">.</span><span class="ident" id="7539798">Fatal</span><span class="op" id="7539803">(</span><span class="ident" id="7539804">err</span><span class="op" id="7539807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7539813">if</span>&nbsp;<span class="ident" id="7539816">err</span>&nbsp;<span class="op" id="7539820">:=</span>&nbsp;<span class="ident" id="7539823">writer</span><span class="op" id="7539829">.</span><span class="ident" id="7539830">Close</span><span class="op" id="7539835">(</span><span class="op" id="7539836">)</span><span class="op" id="7539837">;</span>&nbsp;<span class="ident" id="7539839">err</span>&nbsp;<span class="op" id="7539843">!=</span>&nbsp;<span class="ident" id="7539846">nil</span>&nbsp;<span class="op" id="7539850">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539854">t</span><span class="op" id="7539855">.</span><span class="ident" id="7539856">Fatal</span><span class="op" id="7539861">(</span><span class="ident" id="7539862">err</span><span class="op" id="7539865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7539868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7539871">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;the&nbsp;xattrs&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539932">reader</span>&nbsp;<span class="op" id="7539939">:=</span>&nbsp;<span class="ident" id="7539942">NewReader</span><span class="op" id="7539951">(</span><span class="op" id="7539952">&amp;</span><span class="ident" id="7539953">buf</span><span class="op" id="7539956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7539959">hdr</span><span class="op" id="7539962">,</span>&nbsp;<span class="ident" id="7539964">err</span>&nbsp;<span class="op" id="7539968">=</span>&nbsp;<span class="ident" id="7539970">reader</span><span class="op" id="7539976">.</span><span class="ident" id="7539977">Next</span><span class="op" id="7539981">(</span><span class="op" id="7539982">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7539985">if</span>&nbsp;<span class="ident" id="7539988">err</span>&nbsp;<span class="op" id="7539992">!=</span>&nbsp;<span class="ident" id="7539995">nil</span>&nbsp;<span class="op" id="7539999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7540003">t</span><span class="op" id="7540004">.</span><span class="ident" id="7540005">Fatal</span><span class="op" id="7540010">(</span><span class="ident" id="7540011">err</span><span class="op" id="7540014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7540017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7540020">if</span>&nbsp;<span class="op" id="7540023">!</span><span class="ident" id="7540024">reflect</span><span class="op" id="7540031">.</span><span class="ident" id="7540032">DeepEqual</span><span class="op" id="7540041">(</span><span class="ident" id="7540042">hdr</span><span class="op" id="7540045">.</span><span class="ident" id="7540046">Xattrs</span><span class="op" id="7540052">,</span>&nbsp;<span class="ident" id="7540054">xattrs</span><span class="op" id="7540060">)</span>&nbsp;<span class="op" id="7540062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7540066">t</span><span class="op" id="7540067">.</span><span class="ident" id="7540068">Fatalf</span><span class="op" id="7540074">(</span><span class="string" id="7540075">&#34;xattrs&nbsp;did&nbsp;not&nbsp;survive&nbsp;round&nbsp;trip:&nbsp;got&nbsp;%+v,&nbsp;want&nbsp;%+v&#34;</span><span class="op" id="7540129">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7540134">hdr</span><span class="op" id="7540137">.</span><span class="ident" id="7540138">Xattrs</span><span class="op" id="7540144">,</span>&nbsp;<span class="ident" id="7540146">xattrs</span><span class="op" id="7540152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7540155">}</span><br>
<span class="lineno"></span><span class="op" id="7540157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7540160">func</span>&nbsp;<span class="ident" id="7540165">TestPAXHeader</span><span class="op" id="7540178">(</span><span class="ident" id="7540179">t</span>&nbsp;<span class="op" id="7540181">*</span><span class="ident" id="7540182">testing</span><span class="op" id="7540189">.</span><span class="ident" id="7540190">T</span><span class="op" id="7540191">)</span>&nbsp;<span class="op" id="7540193">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7540196">medName</span>&nbsp;<span class="op" id="7540204">:=</span>&nbsp;<span class="ident" id="7540207">strings</span><span class="op" id="7540214">.</span><span class="ident" id="7540215">Repeat</span><span class="op" id="7540221">(</span><span class="string" id="7540222">&#34;CD&#34;</span><span class="op" id="7540226">,</span>&nbsp;<span class="num" id="7540228">50</span><span class="op" id="7540230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7540233">longName</span>&nbsp;<span class="op" id="7540242">:=</span>&nbsp;<span class="ident" id="7540245">strings</span><span class="op" id="7540252">.</span><span class="ident" id="7540253">Repeat</span><span class="op" id="7540259">(</span><span class="string" id="7540260">&#34;AB&#34;</span><span class="op" id="7540264">,</span>&nbsp;<span class="num" id="7540266">100</span><span class="op" id="7540269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7540272">paxTests</span>&nbsp;<span class="op" id="7540281">:=</span>&nbsp;<span class="op" id="7540284">[</span><span class="op" id="7540285">]</span><span class="op" id="7540286">[</span><span class="num" id="7540287">2</span><span class="op" id="7540288">]</span><span class="builtintype" id="7540289">string</span><span class="op" id="7540295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7540299">{</span><span class="ident" id="7540300">paxPath</span>&nbsp;<span class="op" id="7540308">+</span>&nbsp;<span class="string" id="7540310">&#34;=/etc/hosts&#34;</span><span class="op" id="7540323">,</span>&nbsp;<span class="string" id="7540325">&#34;19&nbsp;path=/etc/hosts\n&#34;</span><span class="op" id="7540347">}</span><span class="op" id="7540348">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7540352">{</span><span class="string" id="7540353">&#34;a=b&#34;</span><span class="op" id="7540358">,</span>&nbsp;<span class="string" id="7540360">&#34;6&nbsp;a=b\n&#34;</span><span class="op" id="7540369">}</span><span class="op" id="7540370">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7540381">//&nbsp;Single&nbsp;digit&nbsp;length</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7540406">{</span><span class="string" id="7540407">&#34;a=names&#34;</span><span class="op" id="7540416">,</span>&nbsp;<span class="string" id="7540418">&#34;11&nbsp;a=names\n&#34;</span><span class="op" id="7540432">}</span><span class="op" id="7540433">,</span>&nbsp;<span class="comment" id="7540435">//&nbsp;Test&nbsp;case&nbsp;involving&nbsp;carries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7540468">{</span><span class="ident" id="7540469">paxPath</span>&nbsp;<span class="op" id="7540477">+</span>&nbsp;<span class="string" id="7540479">&#34;=&#34;</span>&nbsp;<span class="op" id="7540483">+</span>&nbsp;<span class="ident" id="7540485">longName</span><span class="op" id="7540493">,</span>&nbsp;<span class="ident" id="7540495">fmt</span><span class="op" id="7540498">.</span><span class="ident" id="7540499">Sprintf</span><span class="op" id="7540506">(</span><span class="string" id="7540507">&#34;210&nbsp;path=%s\n&#34;</span><span class="op" id="7540522">,</span>&nbsp;<span class="ident" id="7540524">longName</span><span class="op" id="7540532">)</span><span class="op" id="7540533">}</span><span class="op" id="7540534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7540538">{</span><span class="ident" id="7540539">paxPath</span>&nbsp;<span class="op" id="7540547">+</span>&nbsp;<span class="string" id="7540549">&#34;=&#34;</span>&nbsp;<span class="op" id="7540553">+</span>&nbsp;<span class="ident" id="7540555">medName</span><span class="op" id="7540562">,</span>&nbsp;<span class="ident" id="7540564">fmt</span><span class="op" id="7540567">.</span><span class="ident" id="7540568">Sprintf</span><span class="op" id="7540575">(</span><span class="string" id="7540576">&#34;110&nbsp;path=%s\n&#34;</span><span class="op" id="7540591">,</span>&nbsp;<span class="ident" id="7540593">medName</span><span class="op" id="7540600">)</span><span class="op" id="7540601">}</span><span class="op" id="7540602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7540606">for</span>&nbsp;<span class="ident" id="7540610">_</span><span class="op" id="7540611">,</span>&nbsp;<span class="ident" id="7540613">test</span>&nbsp;<span class="op" id="7540618">:=</span>&nbsp;<span class="keyword" id="7540621">range</span>&nbsp;<span class="ident" id="7540627">paxTests</span>&nbsp;<span class="op" id="7540636">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7540640">key</span><span class="op" id="7540643">,</span>&nbsp;<span class="ident" id="7540645">expected</span>&nbsp;<span class="op" id="7540654">:=</span>&nbsp;<span class="ident" id="7540657">test</span><span class="op" id="7540661">[</span><span class="num" id="7540662">0</span><span class="op" id="7540663">]</span><span class="op" id="7540664">,</span>&nbsp;<span class="ident" id="7540666">test</span><span class="op" id="7540670">[</span><span class="num" id="7540671">1</span><span class="op" id="7540672">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7540676">if</span>&nbsp;<span class="ident" id="7540679">result</span>&nbsp;<span class="op" id="7540686">:=</span>&nbsp;<span class="ident" id="7540689">paxHeader</span><span class="op" id="7540698">(</span><span class="ident" id="7540699">key</span><span class="op" id="7540702">)</span><span class="op" id="7540703">;</span>&nbsp;<span class="ident" id="7540705">result</span>&nbsp;<span class="op" id="7540712">!=</span>&nbsp;<span class="ident" id="7540715">expected</span>&nbsp;<span class="op" id="7540724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7540729">t</span><span class="op" id="7540730">.</span><span class="ident" id="7540731">Fatalf</span><span class="op" id="7540737">(</span><span class="string" id="7540738">&#34;paxHeader:&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="7540770">,</span>&nbsp;<span class="ident" id="7540772">result</span><span class="op" id="7540778">,</span>&nbsp;<span class="ident" id="7540780">expected</span><span class="op" id="7540788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7540792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7540795">}</span><br>
<span class="lineno">420</span><span class="op" id="7540797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7540800">func</span>&nbsp;<span class="ident" id="7540805">TestUSTARLongName</span><span class="op" id="7540822">(</span><span class="ident" id="7540823">t</span>&nbsp;<span class="op" id="7540825">*</span><span class="ident" id="7540826">testing</span><span class="op" id="7540833">.</span><span class="ident" id="7540834">T</span><span class="op" id="7540835">)</span>&nbsp;<span class="op" id="7540837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7540840">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;path&nbsp;that&nbsp;failed&nbsp;to&nbsp;split&nbsp;with&nbsp;USTAR&nbsp;extension&nbsp;in&nbsp;previous&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7540938">fileinfo</span><span class="op" id="7540946">,</span>&nbsp;<span class="ident" id="7540948">err</span>&nbsp;<span class="op" id="7540952">:=</span>&nbsp;<span class="ident" id="7540955">os</span><span class="op" id="7540957">.</span><span class="ident" id="7540958">Stat</span><span class="op" id="7540962">(</span><span class="string" id="7540963">&#34;testdata/small.txt&#34;</span><span class="op" id="7540983">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7540986">if</span>&nbsp;<span class="ident" id="7540989">err</span>&nbsp;<span class="op" id="7540993">!=</span>&nbsp;<span class="ident" id="7540996">nil</span>&nbsp;<span class="op" id="7541000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541004">t</span><span class="op" id="7541005">.</span><span class="ident" id="7541006">Fatal</span><span class="op" id="7541011">(</span><span class="ident" id="7541012">err</span><span class="op" id="7541015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7541018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541021">hdr</span><span class="op" id="7541024">,</span>&nbsp;<span class="ident" id="7541026">err</span>&nbsp;<span class="op" id="7541030">:=</span>&nbsp;<span class="ident" id="7541033">FileInfoHeader</span><span class="op" id="7541047">(</span><span class="ident" id="7541048">fileinfo</span><span class="op" id="7541056">,</span>&nbsp;<span class="string" id="7541058">&#34;&#34;</span><span class="op" id="7541060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541063">hdr</span><span class="op" id="7541066">.</span><span class="ident" id="7541067">Typeflag</span>&nbsp;<span class="op" id="7541076">=</span>&nbsp;<span class="ident" id="7541078">TypeDir</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7541087">if</span>&nbsp;<span class="ident" id="7541090">err</span>&nbsp;<span class="op" id="7541094">!=</span>&nbsp;<span class="ident" id="7541097">nil</span>&nbsp;<span class="op" id="7541101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541105">t</span><span class="op" id="7541106">.</span><span class="ident" id="7541107">Fatalf</span><span class="op" id="7541113">(</span><span class="string" id="7541114">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7541128">,</span>&nbsp;<span class="ident" id="7541130">err</span><span class="op" id="7541133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7541136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7541139">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written.&nbsp;The&nbsp;name&nbsp;was&nbsp;taken&nbsp;from&nbsp;a&nbsp;practical&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7541224">//&nbsp;that&nbsp;fails&nbsp;and&nbsp;replaced&nbsp;ever&nbsp;char&nbsp;through&nbsp;numbers&nbsp;to&nbsp;anonymize&nbsp;the&nbsp;sample.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541303">longName</span>&nbsp;<span class="op" id="7541312">:=</span>&nbsp;<span class="string" id="7541315">&#34;/0000_0000000/00000-000000000/0000_0000000/00000-0000000000000/0000_0000000/00000-0000000-00000000/0000_0000000/00000000/0000_0000000/000/0000_0000000/00000000v00/0000_0000000/000000/0000_0000000/0000000/0000_0000000/00000y-00/0000/0000/00000000/0x000000/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541574">hdr</span><span class="op" id="7541577">.</span><span class="ident" id="7541578">Name</span>&nbsp;<span class="op" id="7541583">=</span>&nbsp;<span class="ident" id="7541585">longName</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541596">hdr</span><span class="op" id="7541599">.</span><span class="ident" id="7541600">Size</span>&nbsp;<span class="op" id="7541605">=</span>&nbsp;<span class="num" id="7541607">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7541610">var</span>&nbsp;<span class="ident" id="7541614">buf</span>&nbsp;<span class="ident" id="7541618">bytes</span><span class="op" id="7541623">.</span><span class="ident" id="7541624">Buffer</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541632">writer</span>&nbsp;<span class="op" id="7541639">:=</span>&nbsp;<span class="ident" id="7541642">NewWriter</span><span class="op" id="7541651">(</span><span class="op" id="7541652">&amp;</span><span class="ident" id="7541653">buf</span><span class="op" id="7541656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7541659">if</span>&nbsp;<span class="ident" id="7541662">err</span>&nbsp;<span class="op" id="7541666">:=</span>&nbsp;<span class="ident" id="7541669">writer</span><span class="op" id="7541675">.</span><span class="ident" id="7541676">WriteHeader</span><span class="op" id="7541687">(</span><span class="ident" id="7541688">hdr</span><span class="op" id="7541691">)</span><span class="op" id="7541692">;</span>&nbsp;<span class="ident" id="7541694">err</span>&nbsp;<span class="op" id="7541698">!=</span>&nbsp;<span class="ident" id="7541701">nil</span>&nbsp;<span class="op" id="7541705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541709">t</span><span class="op" id="7541710">.</span><span class="ident" id="7541711">Fatal</span><span class="op" id="7541716">(</span><span class="ident" id="7541717">err</span><span class="op" id="7541720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7541723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7541726">if</span>&nbsp;<span class="ident" id="7541729">err</span>&nbsp;<span class="op" id="7541733">:=</span>&nbsp;<span class="ident" id="7541736">writer</span><span class="op" id="7541742">.</span><span class="ident" id="7541743">Close</span><span class="op" id="7541748">(</span><span class="op" id="7541749">)</span><span class="op" id="7541750">;</span>&nbsp;<span class="ident" id="7541752">err</span>&nbsp;<span class="op" id="7541756">!=</span>&nbsp;<span class="ident" id="7541759">nil</span>&nbsp;<span class="op" id="7541763">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541767">t</span><span class="op" id="7541768">.</span><span class="ident" id="7541769">Fatal</span><span class="op" id="7541774">(</span><span class="ident" id="7541775">err</span><span class="op" id="7541778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7541781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7541784">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541846">reader</span>&nbsp;<span class="op" id="7541853">:=</span>&nbsp;<span class="ident" id="7541856">NewReader</span><span class="op" id="7541865">(</span><span class="op" id="7541866">&amp;</span><span class="ident" id="7541867">buf</span><span class="op" id="7541870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541873">hdr</span><span class="op" id="7541876">,</span>&nbsp;<span class="ident" id="7541878">err</span>&nbsp;<span class="op" id="7541882">=</span>&nbsp;<span class="ident" id="7541884">reader</span><span class="op" id="7541890">.</span><span class="ident" id="7541891">Next</span><span class="op" id="7541895">(</span><span class="op" id="7541896">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7541899">if</span>&nbsp;<span class="ident" id="7541902">err</span>&nbsp;<span class="op" id="7541906">!=</span>&nbsp;<span class="ident" id="7541909">nil</span>&nbsp;<span class="op" id="7541913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541917">t</span><span class="op" id="7541918">.</span><span class="ident" id="7541919">Fatal</span><span class="op" id="7541924">(</span><span class="ident" id="7541925">err</span><span class="op" id="7541928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7541931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7541934">if</span>&nbsp;<span class="ident" id="7541937">hdr</span><span class="op" id="7541940">.</span><span class="ident" id="7541941">Name</span>&nbsp;<span class="op" id="7541946">!=</span>&nbsp;<span class="ident" id="7541949">longName</span>&nbsp;<span class="op" id="7541958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7541962">t</span><span class="op" id="7541963">.</span><span class="ident" id="7541964">Fatal</span><span class="op" id="7541969">(</span><span class="string" id="7541970">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;name&#34;</span><span class="op" id="7541998">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7542001">}</span><br>
<span class="lineno"></span><span class="op" id="7542003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7542006">func</span>&nbsp;<span class="ident" id="7542011">TestValidTypeflagWithPAXHeader</span><span class="op" id="7542041">(</span><span class="ident" id="7542042">t</span>&nbsp;<span class="op" id="7542044">*</span><span class="ident" id="7542045">testing</span><span class="op" id="7542052">.</span><span class="ident" id="7542053">T</span><span class="op" id="7542054">)</span>&nbsp;<span class="op" id="7542056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7542059">var</span>&nbsp;<span class="ident" id="7542063">buffer</span>&nbsp;<span class="ident" id="7542070">bytes</span><span class="op" id="7542075">.</span><span class="ident" id="7542076">Buffer</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542084">tw</span>&nbsp;<span class="op" id="7542087">:=</span>&nbsp;<span class="ident" id="7542090">NewWriter</span><span class="op" id="7542099">(</span><span class="op" id="7542100">&amp;</span><span class="ident" id="7542101">buffer</span><span class="op" id="7542107">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542111">fileName</span>&nbsp;<span class="op" id="7542120">:=</span>&nbsp;<span class="ident" id="7542123">strings</span><span class="op" id="7542130">.</span><span class="ident" id="7542131">Repeat</span><span class="op" id="7542137">(</span><span class="string" id="7542138">&#34;ab&#34;</span><span class="op" id="7542142">,</span>&nbsp;<span class="num" id="7542144">100</span><span class="op" id="7542147">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542151">hdr</span>&nbsp;<span class="op" id="7542155">:=</span>&nbsp;<span class="op" id="7542158">&amp;</span><span class="ident" id="7542159">Header</span><span class="op" id="7542165">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542169">Name</span><span class="op" id="7542173">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7542179">fileName</span><span class="op" id="7542187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542191">Size</span><span class="op" id="7542195">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7542201">4</span><span class="op" id="7542202">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542206">Typeflag</span><span class="op" id="7542214">:</span>&nbsp;<span class="num" id="7542216">0</span><span class="op" id="7542217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7542220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7542223">if</span>&nbsp;<span class="ident" id="7542226">err</span>&nbsp;<span class="op" id="7542230">:=</span>&nbsp;<span class="ident" id="7542233">tw</span><span class="op" id="7542235">.</span><span class="ident" id="7542236">WriteHeader</span><span class="op" id="7542247">(</span><span class="ident" id="7542248">hdr</span><span class="op" id="7542251">)</span><span class="op" id="7542252">;</span>&nbsp;<span class="ident" id="7542254">err</span>&nbsp;<span class="op" id="7542258">!=</span>&nbsp;<span class="ident" id="7542261">nil</span>&nbsp;<span class="op" id="7542265">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542269">t</span><span class="op" id="7542270">.</span><span class="ident" id="7542271">Fatalf</span><span class="op" id="7542277">(</span><span class="string" id="7542278">&#34;Failed&nbsp;to&nbsp;write&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="7542306">,</span>&nbsp;<span class="ident" id="7542308">err</span><span class="op" id="7542311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7542314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7542317">if</span>&nbsp;<span class="ident" id="7542320">_</span><span class="op" id="7542321">,</span>&nbsp;<span class="ident" id="7542323">err</span>&nbsp;<span class="op" id="7542327">:=</span>&nbsp;<span class="ident" id="7542330">tw</span><span class="op" id="7542332">.</span><span class="ident" id="7542333">Write</span><span class="op" id="7542338">(</span><span class="op" id="7542339">[</span><span class="op" id="7542340">]</span><span class="builtintype" id="7542341">byte</span><span class="op" id="7542345">(</span><span class="string" id="7542346">&#34;fooo&#34;</span><span class="op" id="7542352">)</span><span class="op" id="7542353">)</span><span class="op" id="7542354">;</span>&nbsp;<span class="ident" id="7542356">err</span>&nbsp;<span class="op" id="7542360">!=</span>&nbsp;<span class="ident" id="7542363">nil</span>&nbsp;<span class="op" id="7542367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542371">t</span><span class="op" id="7542372">.</span><span class="ident" id="7542373">Fatalf</span><span class="op" id="7542379">(</span><span class="string" id="7542380">&#34;Failed&nbsp;to&nbsp;write&nbsp;the&nbsp;file&#39;s&nbsp;data:&nbsp;%s&#34;</span><span class="op" id="7542417">,</span>&nbsp;<span class="ident" id="7542419">err</span><span class="op" id="7542422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7542425">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542428">tw</span><span class="op" id="7542430">.</span><span class="ident" id="7542431">Close</span><span class="op" id="7542436">(</span><span class="op" id="7542437">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542441">tr</span>&nbsp;<span class="op" id="7542444">:=</span>&nbsp;<span class="ident" id="7542447">NewReader</span><span class="op" id="7542456">(</span><span class="op" id="7542457">&amp;</span><span class="ident" id="7542458">buffer</span><span class="op" id="7542464">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7542468">for</span>&nbsp;<span class="op" id="7542472">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542476">header</span><span class="op" id="7542482">,</span>&nbsp;<span class="ident" id="7542484">err</span>&nbsp;<span class="op" id="7542488">:=</span>&nbsp;<span class="ident" id="7542491">tr</span><span class="op" id="7542493">.</span><span class="ident" id="7542494">Next</span><span class="op" id="7542498">(</span><span class="op" id="7542499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7542503">if</span>&nbsp;<span class="ident" id="7542506">err</span>&nbsp;<span class="op" id="7542510">==</span>&nbsp;<span class="ident" id="7542513">io</span><span class="op" id="7542515">.</span><span class="ident" id="7542516">EOF</span>&nbsp;<span class="op" id="7542520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7542525">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7542533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7542537">if</span>&nbsp;<span class="ident" id="7542540">err</span>&nbsp;<span class="op" id="7542544">!=</span>&nbsp;<span class="ident" id="7542547">nil</span>&nbsp;<span class="op" id="7542551">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542556">t</span><span class="op" id="7542557">.</span><span class="ident" id="7542558">Fatalf</span><span class="op" id="7542564">(</span><span class="string" id="7542565">&#34;Failed&nbsp;to&nbsp;read&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="7542592">,</span>&nbsp;<span class="ident" id="7542594">err</span><span class="op" id="7542597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7542601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7542605">if</span>&nbsp;<span class="ident" id="7542608">header</span><span class="op" id="7542614">.</span><span class="ident" id="7542615">Typeflag</span>&nbsp;<span class="op" id="7542624">!=</span>&nbsp;<span class="num" id="7542627">0</span>&nbsp;<span class="op" id="7542629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7542634">t</span><span class="op" id="7542635">.</span><span class="ident" id="7542636">Fatalf</span><span class="op" id="7542642">(</span><span class="string" id="7542643">&#34;Typeflag&nbsp;should&#39;ve&nbsp;been&nbsp;0,&nbsp;found&nbsp;%d&#34;</span><span class="op" id="7542680">,</span>&nbsp;<span class="ident" id="7542682">header</span><span class="op" id="7542688">.</span><span class="ident" id="7542689">Typeflag</span><span class="op" id="7542697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7542701">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7542704">}</span><br>
<span class="lineno"></span><span class="op" id="7542706">}</span>
</div>
</body>
</html>
