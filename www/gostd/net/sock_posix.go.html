<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3720940">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3720996">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3721050">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3721101">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3721179">package</span>&nbsp;<span class="ident" id="3721187">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3721192">import</span>&nbsp;<span class="op" id="3721199">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3721202">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3721208">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3721219">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3721226">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3721229">//&nbsp;A&nbsp;sockaddr&nbsp;represents&nbsp;a&nbsp;TCP,&nbsp;UDP,&nbsp;IP&nbsp;or&nbsp;Unix&nbsp;network&nbsp;endpoint</span><br>
<span class="lineno"></span><span class="comment" id="3721294">//&nbsp;address&nbsp;that&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall.Sockaddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3721352">type</span>&nbsp;<span class="ident" id="3721357">sockaddr</span>&nbsp;<span class="keyword" id="3721366">interface</span>&nbsp;<span class="op" id="3721376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721379">Addr</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721386">netaddr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3721396">//&nbsp;family&nbsp;returns&nbsp;the&nbsp;platform-dependent&nbsp;address&nbsp;family</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3721453">//&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721469">family</span><span class="op" id="3721475">(</span><span class="op" id="3721476">)</span>&nbsp;<span class="builtintype" id="3721478">int</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3721484">//&nbsp;isWildcard&nbsp;reports&nbsp;whether&nbsp;the&nbsp;address&nbsp;is&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3721541">//&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721554">isWildcard</span><span class="op" id="3721564">(</span><span class="op" id="3721565">)</span>&nbsp;<span class="builtintype" id="3721567">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3721574">//&nbsp;sockaddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3721632">//&nbsp;sockaddr&nbsp;type&nbsp;that&nbsp;implements&nbsp;syscall.Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3721683">//&nbsp;interface.&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3721745">//&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721754">sockaddr</span><span class="op" id="3721762">(</span><span class="ident" id="3721763">family</span>&nbsp;<span class="builtintype" id="3721770">int</span><span class="op" id="3721773">)</span>&nbsp;<span class="op" id="3721775">(</span><span class="ident" id="3721776">syscall</span><span class="op" id="3721783">.</span><span class="ident" id="3721784">Sockaddr</span><span class="op" id="3721792">,</span>&nbsp;<span class="builtintype" id="3721794">error</span><span class="op" id="3721799">)</span><br>
<span class="lineno">35</span><span class="op" id="3721801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3721804">//&nbsp;socket&nbsp;returns&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;that&nbsp;is&nbsp;ready&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3721866">//&nbsp;asynchronous&nbsp;I/O&nbsp;using&nbsp;the&nbsp;network&nbsp;poller.</span><br>
<span class="lineno"></span><span class="keyword" id="3721912">func</span>&nbsp;<span class="ident" id="3721917">socket</span><span class="op" id="3721923">(</span><span class="ident" id="3721924">net</span>&nbsp;<span class="builtintype" id="3721928">string</span><span class="op" id="3721934">,</span>&nbsp;<span class="ident" id="3721936">family</span><span class="op" id="3721942">,</span>&nbsp;<span class="ident" id="3721944">sotype</span><span class="op" id="3721950">,</span>&nbsp;<span class="ident" id="3721952">proto</span>&nbsp;<span class="builtintype" id="3721958">int</span><span class="op" id="3721961">,</span>&nbsp;<span class="ident" id="3721963">ipv6only</span>&nbsp;<span class="builtintype" id="3721972">bool</span><span class="op" id="3721976">,</span>&nbsp;<span class="ident" id="3721978">laddr</span><span class="op" id="3721983">,</span>&nbsp;<span class="ident" id="3721985">raddr</span>&nbsp;<span class="ident" id="3721991">sockaddr</span><span class="op" id="3721999">,</span>&nbsp;<span class="ident" id="3722001">deadline</span>&nbsp;<span class="ident" id="3722010">time</span><span class="op" id="3722014">.</span><span class="ident" id="3722015">Time</span><span class="op" id="3722019">)</span>&nbsp;<span class="op" id="3722021">(</span><span class="ident" id="3722022">fd</span>&nbsp;<span class="op" id="3722025">*</span><span class="ident" id="3722026">netFD</span><span class="op" id="3722031">,</span>&nbsp;<span class="ident" id="3722033">err</span>&nbsp;<span class="builtintype" id="3722037">error</span><span class="op" id="3722042">)</span>&nbsp;<span class="op" id="3722044">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722047">s</span><span class="op" id="3722048">,</span>&nbsp;<span class="ident" id="3722050">err</span>&nbsp;<span class="op" id="3722054">:=</span>&nbsp;<span class="ident" id="3722057">sysSocket</span><span class="op" id="3722066">(</span><span class="ident" id="3722067">family</span><span class="op" id="3722073">,</span>&nbsp;<span class="ident" id="3722075">sotype</span><span class="op" id="3722081">,</span>&nbsp;<span class="ident" id="3722083">proto</span><span class="op" id="3722088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722091">if</span>&nbsp;<span class="ident" id="3722094">err</span>&nbsp;<span class="op" id="3722098">!=</span>&nbsp;<span class="ident" id="3722101">nil</span>&nbsp;<span class="op" id="3722105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722109">return</span>&nbsp;<span class="ident" id="3722116">nil</span><span class="op" id="3722119">,</span>&nbsp;<span class="ident" id="3722121">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3722126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722129">if</span>&nbsp;<span class="ident" id="3722132">err</span>&nbsp;<span class="op" id="3722136">=</span>&nbsp;<span class="ident" id="3722138">setDefaultSockopts</span><span class="op" id="3722156">(</span><span class="ident" id="3722157">s</span><span class="op" id="3722158">,</span>&nbsp;<span class="ident" id="3722160">family</span><span class="op" id="3722166">,</span>&nbsp;<span class="ident" id="3722168">sotype</span><span class="op" id="3722174">,</span>&nbsp;<span class="ident" id="3722176">ipv6only</span><span class="op" id="3722184">)</span><span class="op" id="3722185">;</span>&nbsp;<span class="ident" id="3722187">err</span>&nbsp;<span class="op" id="3722191">!=</span>&nbsp;<span class="ident" id="3722194">nil</span>&nbsp;<span class="op" id="3722198">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722202">closesocket</span><span class="op" id="3722213">(</span><span class="ident" id="3722214">s</span><span class="op" id="3722215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722219">return</span>&nbsp;<span class="ident" id="3722226">nil</span><span class="op" id="3722229">,</span>&nbsp;<span class="ident" id="3722231">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3722236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722239">if</span>&nbsp;<span class="ident" id="3722242">fd</span><span class="op" id="3722244">,</span>&nbsp;<span class="ident" id="3722246">err</span>&nbsp;<span class="op" id="3722250">=</span>&nbsp;<span class="ident" id="3722252">newFD</span><span class="op" id="3722257">(</span><span class="ident" id="3722258">s</span><span class="op" id="3722259">,</span>&nbsp;<span class="ident" id="3722261">family</span><span class="op" id="3722267">,</span>&nbsp;<span class="ident" id="3722269">sotype</span><span class="op" id="3722275">,</span>&nbsp;<span class="ident" id="3722277">net</span><span class="op" id="3722280">)</span><span class="op" id="3722281">;</span>&nbsp;<span class="ident" id="3722283">err</span>&nbsp;<span class="op" id="3722287">!=</span>&nbsp;<span class="ident" id="3722290">nil</span>&nbsp;<span class="op" id="3722294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722298">closesocket</span><span class="op" id="3722309">(</span><span class="ident" id="3722310">s</span><span class="op" id="3722311">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722315">return</span>&nbsp;<span class="ident" id="3722322">nil</span><span class="op" id="3722325">,</span>&nbsp;<span class="ident" id="3722327">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3722332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722336">//&nbsp;This&nbsp;function&nbsp;makes&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722394">//&nbsp;following&nbsp;applications:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722422">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722426">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;passive&nbsp;stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722479">//&nbsp;&nbsp;&nbsp;connenction,&nbsp;known&nbsp;as&nbsp;a&nbsp;stream&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722525">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722529">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;destination-unspecific</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722590">//&nbsp;&nbsp;&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a&nbsp;datagram&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722646">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722650">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;an&nbsp;active&nbsp;stream&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722708">//&nbsp;&nbsp;&nbsp;destination-specific&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722767">//&nbsp;&nbsp;&nbsp;dialer</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722780">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722784">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;the&nbsp;other&nbsp;connection,&nbsp;such</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722847">//&nbsp;&nbsp;&nbsp;as&nbsp;talking&nbsp;to&nbsp;the&nbsp;protocol&nbsp;stack&nbsp;inside&nbsp;the&nbsp;kernel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722904">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722908">//&nbsp;For&nbsp;stream&nbsp;and&nbsp;datagram&nbsp;listeners,&nbsp;they&nbsp;will&nbsp;only&nbsp;require</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722970">//&nbsp;named&nbsp;sockets,&nbsp;so&nbsp;we&nbsp;can&nbsp;assume&nbsp;that&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723031">//&nbsp;from&nbsp;stream&nbsp;or&nbsp;datagram&nbsp;listeners&nbsp;when&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723095">//&nbsp;raddr&nbsp;is&nbsp;nil.&nbsp;Otherwise&nbsp;we&nbsp;assume&nbsp;it&#39;s&nbsp;just&nbsp;for&nbsp;dialers&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723158">//&nbsp;the&nbsp;other&nbsp;connection&nbsp;holders.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723193">if</span>&nbsp;<span class="ident" id="3723196">laddr</span>&nbsp;<span class="op" id="3723202">!=</span>&nbsp;<span class="ident" id="3723205">nil</span>&nbsp;<span class="op" id="3723209">&amp;&amp;</span>&nbsp;<span class="ident" id="3723212">raddr</span>&nbsp;<span class="op" id="3723218">==</span>&nbsp;<span class="ident" id="3723221">nil</span>&nbsp;<span class="op" id="3723225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723229">switch</span>&nbsp;<span class="ident" id="3723236">sotype</span>&nbsp;<span class="op" id="3723243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723247">case</span>&nbsp;<span class="ident" id="3723252">syscall</span><span class="op" id="3723259">.</span><span class="ident" id="3723260">SOCK_STREAM</span><span class="op" id="3723271">,</span>&nbsp;<span class="ident" id="3723273">syscall</span><span class="op" id="3723280">.</span><span class="ident" id="3723281">SOCK_SEQPACKET</span><span class="op" id="3723295">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723300">if</span>&nbsp;<span class="ident" id="3723303">err</span>&nbsp;<span class="op" id="3723307">:=</span>&nbsp;<span class="ident" id="3723310">fd</span><span class="op" id="3723312">.</span><span class="ident" id="3723313">listenStream</span><span class="op" id="3723325">(</span><span class="ident" id="3723326">laddr</span><span class="op" id="3723331">,</span>&nbsp;<span class="ident" id="3723333">listenerBacklog</span><span class="op" id="3723348">)</span><span class="op" id="3723349">;</span>&nbsp;<span class="ident" id="3723351">err</span>&nbsp;<span class="op" id="3723355">!=</span>&nbsp;<span class="ident" id="3723358">nil</span>&nbsp;<span class="op" id="3723362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723368">fd</span><span class="op" id="3723370">.</span><span class="ident" id="3723371">Close</span><span class="op" id="3723376">(</span><span class="op" id="3723377">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723383">return</span>&nbsp;<span class="ident" id="3723390">nil</span><span class="op" id="3723393">,</span>&nbsp;<span class="ident" id="3723395">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723407">return</span>&nbsp;<span class="ident" id="3723414">fd</span><span class="op" id="3723416">,</span>&nbsp;<span class="ident" id="3723418">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723424">case</span>&nbsp;<span class="ident" id="3723429">syscall</span><span class="op" id="3723436">.</span><span class="ident" id="3723437">SOCK_DGRAM</span><span class="op" id="3723447">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723452">if</span>&nbsp;<span class="ident" id="3723455">err</span>&nbsp;<span class="op" id="3723459">:=</span>&nbsp;<span class="ident" id="3723462">fd</span><span class="op" id="3723464">.</span><span class="ident" id="3723465">listenDatagram</span><span class="op" id="3723479">(</span><span class="ident" id="3723480">laddr</span><span class="op" id="3723485">)</span><span class="op" id="3723486">;</span>&nbsp;<span class="ident" id="3723488">err</span>&nbsp;<span class="op" id="3723492">!=</span>&nbsp;<span class="ident" id="3723495">nil</span>&nbsp;<span class="op" id="3723499">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723505">fd</span><span class="op" id="3723507">.</span><span class="ident" id="3723508">Close</span><span class="op" id="3723513">(</span><span class="op" id="3723514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723520">return</span>&nbsp;<span class="ident" id="3723527">nil</span><span class="op" id="3723530">,</span>&nbsp;<span class="ident" id="3723532">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723544">return</span>&nbsp;<span class="ident" id="3723551">fd</span><span class="op" id="3723553">,</span>&nbsp;<span class="ident" id="3723555">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723561">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723567">if</span>&nbsp;<span class="ident" id="3723570">err</span>&nbsp;<span class="op" id="3723574">:=</span>&nbsp;<span class="ident" id="3723577">fd</span><span class="op" id="3723579">.</span><span class="ident" id="3723580">dial</span><span class="op" id="3723584">(</span><span class="ident" id="3723585">laddr</span><span class="op" id="3723590">,</span>&nbsp;<span class="ident" id="3723592">raddr</span><span class="op" id="3723597">,</span>&nbsp;<span class="ident" id="3723599">deadline</span><span class="op" id="3723607">)</span><span class="op" id="3723608">;</span>&nbsp;<span class="ident" id="3723610">err</span>&nbsp;<span class="op" id="3723614">!=</span>&nbsp;<span class="ident" id="3723617">nil</span>&nbsp;<span class="op" id="3723621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723625">fd</span><span class="op" id="3723627">.</span><span class="ident" id="3723628">Close</span><span class="op" id="3723633">(</span><span class="op" id="3723634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723638">return</span>&nbsp;<span class="ident" id="3723645">nil</span><span class="op" id="3723648">,</span>&nbsp;<span class="ident" id="3723650">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723655">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723658">return</span>&nbsp;<span class="ident" id="3723665">fd</span><span class="op" id="3723667">,</span>&nbsp;<span class="ident" id="3723669">nil</span><br>
<span class="lineno"></span><span class="op" id="3723673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3723676">func</span>&nbsp;<span class="op" id="3723681">(</span><span class="ident" id="3723682">fd</span>&nbsp;<span class="op" id="3723685">*</span><span class="ident" id="3723686">netFD</span><span class="op" id="3723691">)</span>&nbsp;<span class="ident" id="3723693">addrFunc</span><span class="op" id="3723701">(</span><span class="op" id="3723702">)</span>&nbsp;<span class="keyword" id="3723704">func</span><span class="op" id="3723708">(</span><span class="ident" id="3723709">syscall</span><span class="op" id="3723716">.</span><span class="ident" id="3723717">Sockaddr</span><span class="op" id="3723725">)</span>&nbsp;<span class="ident" id="3723727">Addr</span>&nbsp;<span class="op" id="3723732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723735">switch</span>&nbsp;<span class="ident" id="3723742">fd</span><span class="op" id="3723744">.</span><span class="ident" id="3723745">family</span>&nbsp;<span class="op" id="3723752">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723755">case</span>&nbsp;<span class="ident" id="3723760">syscall</span><span class="op" id="3723767">.</span><span class="ident" id="3723768">AF_INET</span><span class="op" id="3723775">,</span>&nbsp;<span class="ident" id="3723777">syscall</span><span class="op" id="3723784">.</span><span class="ident" id="3723785">AF_INET6</span><span class="op" id="3723793">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723797">switch</span>&nbsp;<span class="ident" id="3723804">fd</span><span class="op" id="3723806">.</span><span class="ident" id="3723807">sotype</span>&nbsp;<span class="op" id="3723814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723818">case</span>&nbsp;<span class="ident" id="3723823">syscall</span><span class="op" id="3723830">.</span><span class="ident" id="3723831">SOCK_STREAM</span><span class="op" id="3723842">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723847">return</span>&nbsp;<span class="ident" id="3723854">sockaddrToTCP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723870">case</span>&nbsp;<span class="ident" id="3723875">syscall</span><span class="op" id="3723882">.</span><span class="ident" id="3723883">SOCK_DGRAM</span><span class="op" id="3723893">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723898">return</span>&nbsp;<span class="ident" id="3723905">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723921">case</span>&nbsp;<span class="ident" id="3723926">syscall</span><span class="op" id="3723933">.</span><span class="ident" id="3723934">SOCK_RAW</span><span class="op" id="3723942">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723947">return</span>&nbsp;<span class="ident" id="3723954">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723972">case</span>&nbsp;<span class="ident" id="3723977">syscall</span><span class="op" id="3723984">.</span><span class="ident" id="3723985">AF_UNIX</span><span class="op" id="3723992">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723996">switch</span>&nbsp;<span class="ident" id="3724003">fd</span><span class="op" id="3724005">.</span><span class="ident" id="3724006">sotype</span>&nbsp;<span class="op" id="3724013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724017">case</span>&nbsp;<span class="ident" id="3724022">syscall</span><span class="op" id="3724029">.</span><span class="ident" id="3724030">SOCK_STREAM</span><span class="op" id="3724041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724046">return</span>&nbsp;<span class="ident" id="3724053">sockaddrToUnix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724070">case</span>&nbsp;<span class="ident" id="3724075">syscall</span><span class="op" id="3724082">.</span><span class="ident" id="3724083">SOCK_DGRAM</span><span class="op" id="3724093">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724098">return</span>&nbsp;<span class="ident" id="3724105">sockaddrToUnixgram</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724126">case</span>&nbsp;<span class="ident" id="3724131">syscall</span><span class="op" id="3724138">.</span><span class="ident" id="3724139">SOCK_SEQPACKET</span><span class="op" id="3724153">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724158">return</span>&nbsp;<span class="ident" id="3724165">sockaddrToUnixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724194">return</span>&nbsp;<span class="keyword" id="3724201">func</span><span class="op" id="3724205">(</span><span class="ident" id="3724206">syscall</span><span class="op" id="3724213">.</span><span class="ident" id="3724214">Sockaddr</span><span class="op" id="3724222">)</span>&nbsp;<span class="ident" id="3724224">Addr</span>&nbsp;<span class="op" id="3724229">{</span>&nbsp;<span class="keyword" id="3724231">return</span>&nbsp;<span class="ident" id="3724238">nil</span>&nbsp;<span class="op" id="3724242">}</span><br>
<span class="lineno">120</span><span class="op" id="3724244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3724247">func</span>&nbsp;<span class="op" id="3724252">(</span><span class="ident" id="3724253">fd</span>&nbsp;<span class="op" id="3724256">*</span><span class="ident" id="3724257">netFD</span><span class="op" id="3724262">)</span>&nbsp;<span class="ident" id="3724264">dial</span><span class="op" id="3724268">(</span><span class="ident" id="3724269">laddr</span><span class="op" id="3724274">,</span>&nbsp;<span class="ident" id="3724276">raddr</span>&nbsp;<span class="ident" id="3724282">sockaddr</span><span class="op" id="3724290">,</span>&nbsp;<span class="ident" id="3724292">deadline</span>&nbsp;<span class="ident" id="3724301">time</span><span class="op" id="3724305">.</span><span class="ident" id="3724306">Time</span><span class="op" id="3724310">)</span>&nbsp;<span class="builtintype" id="3724312">error</span>&nbsp;<span class="op" id="3724318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724321">var</span>&nbsp;<span class="ident" id="3724325">err</span>&nbsp;<span class="builtintype" id="3724329">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724336">var</span>&nbsp;<span class="ident" id="3724340">lsa</span>&nbsp;<span class="ident" id="3724344">syscall</span><span class="op" id="3724351">.</span><span class="ident" id="3724352">Sockaddr</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724362">if</span>&nbsp;<span class="ident" id="3724365">laddr</span>&nbsp;<span class="op" id="3724371">!=</span>&nbsp;<span class="ident" id="3724374">nil</span>&nbsp;<span class="op" id="3724378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724382">if</span>&nbsp;<span class="ident" id="3724385">lsa</span><span class="op" id="3724388">,</span>&nbsp;<span class="ident" id="3724390">err</span>&nbsp;<span class="op" id="3724394">=</span>&nbsp;<span class="ident" id="3724396">laddr</span><span class="op" id="3724401">.</span><span class="ident" id="3724402">sockaddr</span><span class="op" id="3724410">(</span><span class="ident" id="3724411">fd</span><span class="op" id="3724413">.</span><span class="ident" id="3724414">family</span><span class="op" id="3724420">)</span><span class="op" id="3724421">;</span>&nbsp;<span class="ident" id="3724423">err</span>&nbsp;<span class="op" id="3724427">!=</span>&nbsp;<span class="ident" id="3724430">nil</span>&nbsp;<span class="op" id="3724434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724439">return</span>&nbsp;<span class="ident" id="3724446">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724452">}</span>&nbsp;<span class="keyword" id="3724454">else</span>&nbsp;<span class="keyword" id="3724459">if</span>&nbsp;<span class="ident" id="3724462">lsa</span>&nbsp;<span class="op" id="3724466">!=</span>&nbsp;<span class="ident" id="3724469">nil</span>&nbsp;<span class="op" id="3724473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724478">if</span>&nbsp;<span class="ident" id="3724481">err</span>&nbsp;<span class="op" id="3724485">:=</span>&nbsp;<span class="ident" id="3724488">syscall</span><span class="op" id="3724495">.</span><span class="ident" id="3724496">Bind</span><span class="op" id="3724500">(</span><span class="ident" id="3724501">fd</span><span class="op" id="3724503">.</span><span class="ident" id="3724504">sysfd</span><span class="op" id="3724509">,</span>&nbsp;<span class="ident" id="3724511">lsa</span><span class="op" id="3724514">)</span><span class="op" id="3724515">;</span>&nbsp;<span class="ident" id="3724517">err</span>&nbsp;<span class="op" id="3724521">!=</span>&nbsp;<span class="ident" id="3724524">nil</span>&nbsp;<span class="op" id="3724528">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724534">return</span>&nbsp;<span class="ident" id="3724541">os</span><span class="op" id="3724543">.</span><span class="ident" id="3724544">NewSyscallError</span><span class="op" id="3724559">(</span><span class="string" id="3724560">&#34;bind&#34;</span><span class="op" id="3724566">,</span>&nbsp;<span class="ident" id="3724568">err</span><span class="op" id="3724571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724586">var</span>&nbsp;<span class="ident" id="3724590">rsa</span>&nbsp;<span class="ident" id="3724594">syscall</span><span class="op" id="3724601">.</span><span class="ident" id="3724602">Sockaddr</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724612">if</span>&nbsp;<span class="ident" id="3724615">raddr</span>&nbsp;<span class="op" id="3724621">!=</span>&nbsp;<span class="ident" id="3724624">nil</span>&nbsp;<span class="op" id="3724628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724632">if</span>&nbsp;<span class="ident" id="3724635">rsa</span><span class="op" id="3724638">,</span>&nbsp;<span class="ident" id="3724640">err</span>&nbsp;<span class="op" id="3724644">=</span>&nbsp;<span class="ident" id="3724646">raddr</span><span class="op" id="3724651">.</span><span class="ident" id="3724652">sockaddr</span><span class="op" id="3724660">(</span><span class="ident" id="3724661">fd</span><span class="op" id="3724663">.</span><span class="ident" id="3724664">family</span><span class="op" id="3724670">)</span><span class="op" id="3724671">;</span>&nbsp;<span class="ident" id="3724673">err</span>&nbsp;<span class="op" id="3724677">!=</span>&nbsp;<span class="ident" id="3724680">nil</span>&nbsp;<span class="op" id="3724684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724689">return</span>&nbsp;<span class="ident" id="3724696">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724706">if</span>&nbsp;<span class="ident" id="3724709">err</span>&nbsp;<span class="op" id="3724713">:=</span>&nbsp;<span class="ident" id="3724716">fd</span><span class="op" id="3724718">.</span><span class="ident" id="3724719">connect</span><span class="op" id="3724726">(</span><span class="ident" id="3724727">lsa</span><span class="op" id="3724730">,</span>&nbsp;<span class="ident" id="3724732">rsa</span><span class="op" id="3724735">,</span>&nbsp;<span class="ident" id="3724737">deadline</span><span class="op" id="3724745">)</span><span class="op" id="3724746">;</span>&nbsp;<span class="ident" id="3724748">err</span>&nbsp;<span class="op" id="3724752">!=</span>&nbsp;<span class="ident" id="3724755">nil</span>&nbsp;<span class="op" id="3724759">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724764">return</span>&nbsp;<span class="ident" id="3724771">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724781">fd</span><span class="op" id="3724783">.</span><span class="ident" id="3724784">isConnected</span>&nbsp;<span class="op" id="3724796">=</span>&nbsp;<span class="builtintype" id="3724798">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724804">}</span>&nbsp;<span class="keyword" id="3724806">else</span>&nbsp;<span class="op" id="3724811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724815">if</span>&nbsp;<span class="ident" id="3724818">err</span>&nbsp;<span class="op" id="3724822">:=</span>&nbsp;<span class="ident" id="3724825">fd</span><span class="op" id="3724827">.</span><span class="ident" id="3724828">init</span><span class="op" id="3724832">(</span><span class="op" id="3724833">)</span><span class="op" id="3724834">;</span>&nbsp;<span class="ident" id="3724836">err</span>&nbsp;<span class="op" id="3724840">!=</span>&nbsp;<span class="ident" id="3724843">nil</span>&nbsp;<span class="op" id="3724847">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724852">return</span>&nbsp;<span class="ident" id="3724859">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724871">lsa</span><span class="op" id="3724874">,</span>&nbsp;<span class="ident" id="3724876">_</span>&nbsp;<span class="op" id="3724878">=</span>&nbsp;<span class="ident" id="3724880">syscall</span><span class="op" id="3724887">.</span><span class="ident" id="3724888">Getsockname</span><span class="op" id="3724899">(</span><span class="ident" id="3724900">fd</span><span class="op" id="3724902">.</span><span class="ident" id="3724903">sysfd</span><span class="op" id="3724908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724911">if</span>&nbsp;<span class="ident" id="3724914">rsa</span><span class="op" id="3724917">,</span>&nbsp;<span class="ident" id="3724919">_</span>&nbsp;<span class="op" id="3724921">=</span>&nbsp;<span class="ident" id="3724923">syscall</span><span class="op" id="3724930">.</span><span class="ident" id="3724931">Getpeername</span><span class="op" id="3724942">(</span><span class="ident" id="3724943">fd</span><span class="op" id="3724945">.</span><span class="ident" id="3724946">sysfd</span><span class="op" id="3724951">)</span><span class="op" id="3724952">;</span>&nbsp;<span class="ident" id="3724954">rsa</span>&nbsp;<span class="op" id="3724958">!=</span>&nbsp;<span class="ident" id="3724961">nil</span>&nbsp;<span class="op" id="3724965">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724969">fd</span><span class="op" id="3724971">.</span><span class="ident" id="3724972">setAddr</span><span class="op" id="3724979">(</span><span class="ident" id="3724980">fd</span><span class="op" id="3724982">.</span><span class="ident" id="3724983">addrFunc</span><span class="op" id="3724991">(</span><span class="op" id="3724992">)</span><span class="op" id="3724993">(</span><span class="ident" id="3724994">lsa</span><span class="op" id="3724997">)</span><span class="op" id="3724998">,</span>&nbsp;<span class="ident" id="3725000">fd</span><span class="op" id="3725002">.</span><span class="ident" id="3725003">addrFunc</span><span class="op" id="3725011">(</span><span class="op" id="3725012">)</span><span class="op" id="3725013">(</span><span class="ident" id="3725014">rsa</span><span class="op" id="3725017">)</span><span class="op" id="3725018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725021">}</span>&nbsp;<span class="keyword" id="3725023">else</span>&nbsp;<span class="op" id="3725028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725032">fd</span><span class="op" id="3725034">.</span><span class="ident" id="3725035">setAddr</span><span class="op" id="3725042">(</span><span class="ident" id="3725043">fd</span><span class="op" id="3725045">.</span><span class="ident" id="3725046">addrFunc</span><span class="op" id="3725054">(</span><span class="op" id="3725055">)</span><span class="op" id="3725056">(</span><span class="ident" id="3725057">lsa</span><span class="op" id="3725060">)</span><span class="op" id="3725061">,</span>&nbsp;<span class="ident" id="3725063">raddr</span><span class="op" id="3725068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725074">return</span>&nbsp;<span class="ident" id="3725081">nil</span><br>
<span class="lineno">155</span><span class="op" id="3725085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3725088">func</span>&nbsp;<span class="op" id="3725093">(</span><span class="ident" id="3725094">fd</span>&nbsp;<span class="op" id="3725097">*</span><span class="ident" id="3725098">netFD</span><span class="op" id="3725103">)</span>&nbsp;<span class="ident" id="3725105">listenStream</span><span class="op" id="3725117">(</span><span class="ident" id="3725118">laddr</span>&nbsp;<span class="ident" id="3725124">sockaddr</span><span class="op" id="3725132">,</span>&nbsp;<span class="ident" id="3725134">backlog</span>&nbsp;<span class="builtintype" id="3725142">int</span><span class="op" id="3725145">)</span>&nbsp;<span class="builtintype" id="3725147">error</span>&nbsp;<span class="op" id="3725153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725156">if</span>&nbsp;<span class="ident" id="3725159">err</span>&nbsp;<span class="op" id="3725163">:=</span>&nbsp;<span class="ident" id="3725166">setDefaultListenerSockopts</span><span class="op" id="3725192">(</span><span class="ident" id="3725193">fd</span><span class="op" id="3725195">.</span><span class="ident" id="3725196">sysfd</span><span class="op" id="3725201">)</span><span class="op" id="3725202">;</span>&nbsp;<span class="ident" id="3725204">err</span>&nbsp;<span class="op" id="3725208">!=</span>&nbsp;<span class="ident" id="3725211">nil</span>&nbsp;<span class="op" id="3725215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725219">return</span>&nbsp;<span class="ident" id="3725226">err</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725234">if</span>&nbsp;<span class="ident" id="3725237">lsa</span><span class="op" id="3725240">,</span>&nbsp;<span class="ident" id="3725242">err</span>&nbsp;<span class="op" id="3725246">:=</span>&nbsp;<span class="ident" id="3725249">laddr</span><span class="op" id="3725254">.</span><span class="ident" id="3725255">sockaddr</span><span class="op" id="3725263">(</span><span class="ident" id="3725264">fd</span><span class="op" id="3725266">.</span><span class="ident" id="3725267">family</span><span class="op" id="3725273">)</span><span class="op" id="3725274">;</span>&nbsp;<span class="ident" id="3725276">err</span>&nbsp;<span class="op" id="3725280">!=</span>&nbsp;<span class="ident" id="3725283">nil</span>&nbsp;<span class="op" id="3725287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725291">return</span>&nbsp;<span class="ident" id="3725298">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725303">}</span>&nbsp;<span class="keyword" id="3725305">else</span>&nbsp;<span class="keyword" id="3725310">if</span>&nbsp;<span class="ident" id="3725313">lsa</span>&nbsp;<span class="op" id="3725317">!=</span>&nbsp;<span class="ident" id="3725320">nil</span>&nbsp;<span class="op" id="3725324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725328">if</span>&nbsp;<span class="ident" id="3725331">err</span>&nbsp;<span class="op" id="3725335">:=</span>&nbsp;<span class="ident" id="3725338">syscall</span><span class="op" id="3725345">.</span><span class="ident" id="3725346">Bind</span><span class="op" id="3725350">(</span><span class="ident" id="3725351">fd</span><span class="op" id="3725353">.</span><span class="ident" id="3725354">sysfd</span><span class="op" id="3725359">,</span>&nbsp;<span class="ident" id="3725361">lsa</span><span class="op" id="3725364">)</span><span class="op" id="3725365">;</span>&nbsp;<span class="ident" id="3725367">err</span>&nbsp;<span class="op" id="3725371">!=</span>&nbsp;<span class="ident" id="3725374">nil</span>&nbsp;<span class="op" id="3725378">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725383">return</span>&nbsp;<span class="ident" id="3725390">os</span><span class="op" id="3725392">.</span><span class="ident" id="3725393">NewSyscallError</span><span class="op" id="3725408">(</span><span class="string" id="3725409">&#34;bind&#34;</span><span class="op" id="3725415">,</span>&nbsp;<span class="ident" id="3725417">err</span><span class="op" id="3725420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725430">if</span>&nbsp;<span class="ident" id="3725433">err</span>&nbsp;<span class="op" id="3725437">:=</span>&nbsp;<span class="ident" id="3725440">syscall</span><span class="op" id="3725447">.</span><span class="ident" id="3725448">Listen</span><span class="op" id="3725454">(</span><span class="ident" id="3725455">fd</span><span class="op" id="3725457">.</span><span class="ident" id="3725458">sysfd</span><span class="op" id="3725463">,</span>&nbsp;<span class="ident" id="3725465">backlog</span><span class="op" id="3725472">)</span><span class="op" id="3725473">;</span>&nbsp;<span class="ident" id="3725475">err</span>&nbsp;<span class="op" id="3725479">!=</span>&nbsp;<span class="ident" id="3725482">nil</span>&nbsp;<span class="op" id="3725486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725490">return</span>&nbsp;<span class="ident" id="3725497">os</span><span class="op" id="3725499">.</span><span class="ident" id="3725500">NewSyscallError</span><span class="op" id="3725515">(</span><span class="string" id="3725516">&#34;listen&#34;</span><span class="op" id="3725524">,</span>&nbsp;<span class="ident" id="3725526">err</span><span class="op" id="3725529">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725535">if</span>&nbsp;<span class="ident" id="3725538">err</span>&nbsp;<span class="op" id="3725542">:=</span>&nbsp;<span class="ident" id="3725545">fd</span><span class="op" id="3725547">.</span><span class="ident" id="3725548">init</span><span class="op" id="3725552">(</span><span class="op" id="3725553">)</span><span class="op" id="3725554">;</span>&nbsp;<span class="ident" id="3725556">err</span>&nbsp;<span class="op" id="3725560">!=</span>&nbsp;<span class="ident" id="3725563">nil</span>&nbsp;<span class="op" id="3725567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725571">return</span>&nbsp;<span class="ident" id="3725578">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725586">lsa</span><span class="op" id="3725589">,</span>&nbsp;<span class="ident" id="3725591">_</span>&nbsp;<span class="op" id="3725593">:=</span>&nbsp;<span class="ident" id="3725596">syscall</span><span class="op" id="3725603">.</span><span class="ident" id="3725604">Getsockname</span><span class="op" id="3725615">(</span><span class="ident" id="3725616">fd</span><span class="op" id="3725618">.</span><span class="ident" id="3725619">sysfd</span><span class="op" id="3725624">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725627">fd</span><span class="op" id="3725629">.</span><span class="ident" id="3725630">setAddr</span><span class="op" id="3725637">(</span><span class="ident" id="3725638">fd</span><span class="op" id="3725640">.</span><span class="ident" id="3725641">addrFunc</span><span class="op" id="3725649">(</span><span class="op" id="3725650">)</span><span class="op" id="3725651">(</span><span class="ident" id="3725652">lsa</span><span class="op" id="3725655">)</span><span class="op" id="3725656">,</span>&nbsp;<span class="ident" id="3725658">nil</span><span class="op" id="3725661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725664">return</span>&nbsp;<span class="ident" id="3725671">nil</span><br>
<span class="lineno"></span><span class="op" id="3725675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3725678">func</span>&nbsp;<span class="op" id="3725683">(</span><span class="ident" id="3725684">fd</span>&nbsp;<span class="op" id="3725687">*</span><span class="ident" id="3725688">netFD</span><span class="op" id="3725693">)</span>&nbsp;<span class="ident" id="3725695">listenDatagram</span><span class="op" id="3725709">(</span><span class="ident" id="3725710">laddr</span>&nbsp;<span class="ident" id="3725716">sockaddr</span><span class="op" id="3725724">)</span>&nbsp;<span class="builtintype" id="3725726">error</span>&nbsp;<span class="op" id="3725732">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725735">switch</span>&nbsp;<span class="ident" id="3725742">addr</span>&nbsp;<span class="op" id="3725747">:=</span>&nbsp;<span class="ident" id="3725750">laddr</span><span class="op" id="3725755">.</span><span class="op" id="3725756">(</span><span class="keyword" id="3725757">type</span><span class="op" id="3725761">)</span>&nbsp;<span class="op" id="3725763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725766">case</span>&nbsp;<span class="op" id="3725771">*</span><span class="ident" id="3725772">UDPAddr</span><span class="op" id="3725779">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3725783">//&nbsp;We&nbsp;provide&nbsp;a&nbsp;socket&nbsp;that&nbsp;listens&nbsp;to&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3725835">//&nbsp;address&nbsp;with&nbsp;reusable&nbsp;UDP&nbsp;port&nbsp;when&nbsp;the&nbsp;given&nbsp;laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3725892">//&nbsp;is&nbsp;an&nbsp;appropriate&nbsp;UDP&nbsp;multicast&nbsp;address&nbsp;prefix.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3725945">//&nbsp;This&nbsp;makes&nbsp;it&nbsp;possible&nbsp;for&nbsp;a&nbsp;single&nbsp;UDP&nbsp;listener&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3726002">//&nbsp;join&nbsp;multiple&nbsp;different&nbsp;group&nbsp;addresses,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3726052">//&nbsp;multiple&nbsp;UDP&nbsp;listeners&nbsp;that&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;UDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3726108">//&nbsp;port&nbsp;to&nbsp;join&nbsp;the&nbsp;same&nbsp;group&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726150">if</span>&nbsp;<span class="ident" id="3726153">addr</span><span class="op" id="3726157">.</span><span class="ident" id="3726158">IP</span>&nbsp;<span class="op" id="3726161">!=</span>&nbsp;<span class="ident" id="3726164">nil</span>&nbsp;<span class="op" id="3726168">&amp;&amp;</span>&nbsp;<span class="ident" id="3726171">addr</span><span class="op" id="3726175">.</span><span class="ident" id="3726176">IP</span><span class="op" id="3726178">.</span><span class="ident" id="3726179">IsMulticast</span><span class="op" id="3726190">(</span><span class="op" id="3726191">)</span>&nbsp;<span class="op" id="3726193">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726198">if</span>&nbsp;<span class="ident" id="3726201">err</span>&nbsp;<span class="op" id="3726205">:=</span>&nbsp;<span class="ident" id="3726208">setDefaultMulticastSockopts</span><span class="op" id="3726235">(</span><span class="ident" id="3726236">fd</span><span class="op" id="3726238">.</span><span class="ident" id="3726239">sysfd</span><span class="op" id="3726244">)</span><span class="op" id="3726245">;</span>&nbsp;<span class="ident" id="3726247">err</span>&nbsp;<span class="op" id="3726251">!=</span>&nbsp;<span class="ident" id="3726254">nil</span>&nbsp;<span class="op" id="3726258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726264">return</span>&nbsp;<span class="ident" id="3726271">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3726278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726283">addr</span>&nbsp;<span class="op" id="3726288">:=</span>&nbsp;<span class="op" id="3726291">*</span><span class="ident" id="3726292">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726300">switch</span>&nbsp;<span class="ident" id="3726307">fd</span><span class="op" id="3726309">.</span><span class="ident" id="3726310">family</span>&nbsp;<span class="op" id="3726317">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726322">case</span>&nbsp;<span class="ident" id="3726327">syscall</span><span class="op" id="3726334">.</span><span class="ident" id="3726335">AF_INET</span><span class="op" id="3726342">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726348">addr</span><span class="op" id="3726352">.</span><span class="ident" id="3726353">IP</span>&nbsp;<span class="op" id="3726356">=</span>&nbsp;<span class="ident" id="3726358">IPv4zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726370">case</span>&nbsp;<span class="ident" id="3726375">syscall</span><span class="op" id="3726382">.</span><span class="ident" id="3726383">AF_INET6</span><span class="op" id="3726391">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726397">addr</span><span class="op" id="3726401">.</span><span class="ident" id="3726402">IP</span>&nbsp;<span class="op" id="3726405">=</span>&nbsp;<span class="ident" id="3726407">IPv6unspecified</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3726426">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726431">laddr</span>&nbsp;<span class="op" id="3726437">=</span>&nbsp;<span class="op" id="3726439">&amp;</span><span class="ident" id="3726440">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3726447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3726450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726453">if</span>&nbsp;<span class="ident" id="3726456">lsa</span><span class="op" id="3726459">,</span>&nbsp;<span class="ident" id="3726461">err</span>&nbsp;<span class="op" id="3726465">:=</span>&nbsp;<span class="ident" id="3726468">laddr</span><span class="op" id="3726473">.</span><span class="ident" id="3726474">sockaddr</span><span class="op" id="3726482">(</span><span class="ident" id="3726483">fd</span><span class="op" id="3726485">.</span><span class="ident" id="3726486">family</span><span class="op" id="3726492">)</span><span class="op" id="3726493">;</span>&nbsp;<span class="ident" id="3726495">err</span>&nbsp;<span class="op" id="3726499">!=</span>&nbsp;<span class="ident" id="3726502">nil</span>&nbsp;<span class="op" id="3726506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726510">return</span>&nbsp;<span class="ident" id="3726517">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3726522">}</span>&nbsp;<span class="keyword" id="3726524">else</span>&nbsp;<span class="keyword" id="3726529">if</span>&nbsp;<span class="ident" id="3726532">lsa</span>&nbsp;<span class="op" id="3726536">!=</span>&nbsp;<span class="ident" id="3726539">nil</span>&nbsp;<span class="op" id="3726543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726547">if</span>&nbsp;<span class="ident" id="3726550">err</span>&nbsp;<span class="op" id="3726554">:=</span>&nbsp;<span class="ident" id="3726557">syscall</span><span class="op" id="3726564">.</span><span class="ident" id="3726565">Bind</span><span class="op" id="3726569">(</span><span class="ident" id="3726570">fd</span><span class="op" id="3726572">.</span><span class="ident" id="3726573">sysfd</span><span class="op" id="3726578">,</span>&nbsp;<span class="ident" id="3726580">lsa</span><span class="op" id="3726583">)</span><span class="op" id="3726584">;</span>&nbsp;<span class="ident" id="3726586">err</span>&nbsp;<span class="op" id="3726590">!=</span>&nbsp;<span class="ident" id="3726593">nil</span>&nbsp;<span class="op" id="3726597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726602">return</span>&nbsp;<span class="ident" id="3726609">os</span><span class="op" id="3726611">.</span><span class="ident" id="3726612">NewSyscallError</span><span class="op" id="3726627">(</span><span class="string" id="3726628">&#34;bind&#34;</span><span class="op" id="3726634">,</span>&nbsp;<span class="ident" id="3726636">err</span><span class="op" id="3726639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3726643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3726646">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726649">if</span>&nbsp;<span class="ident" id="3726652">err</span>&nbsp;<span class="op" id="3726656">:=</span>&nbsp;<span class="ident" id="3726659">fd</span><span class="op" id="3726661">.</span><span class="ident" id="3726662">init</span><span class="op" id="3726666">(</span><span class="op" id="3726667">)</span><span class="op" id="3726668">;</span>&nbsp;<span class="ident" id="3726670">err</span>&nbsp;<span class="op" id="3726674">!=</span>&nbsp;<span class="ident" id="3726677">nil</span>&nbsp;<span class="op" id="3726681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726685">return</span>&nbsp;<span class="ident" id="3726692">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3726697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726700">lsa</span><span class="op" id="3726703">,</span>&nbsp;<span class="ident" id="3726705">_</span>&nbsp;<span class="op" id="3726707">:=</span>&nbsp;<span class="ident" id="3726710">syscall</span><span class="op" id="3726717">.</span><span class="ident" id="3726718">Getsockname</span><span class="op" id="3726729">(</span><span class="ident" id="3726730">fd</span><span class="op" id="3726732">.</span><span class="ident" id="3726733">sysfd</span><span class="op" id="3726738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726741">fd</span><span class="op" id="3726743">.</span><span class="ident" id="3726744">setAddr</span><span class="op" id="3726751">(</span><span class="ident" id="3726752">fd</span><span class="op" id="3726754">.</span><span class="ident" id="3726755">addrFunc</span><span class="op" id="3726763">(</span><span class="op" id="3726764">)</span><span class="op" id="3726765">(</span><span class="ident" id="3726766">lsa</span><span class="op" id="3726769">)</span><span class="op" id="3726770">,</span>&nbsp;<span class="ident" id="3726772">nil</span><span class="op" id="3726775">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726778">return</span>&nbsp;<span class="ident" id="3726785">nil</span><br>
<span class="lineno"></span><span class="op" id="3726789">}</span>
</div>
</body>
</html>
