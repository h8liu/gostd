<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7469267">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7469322">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7469376">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7469427">package</span>&nbsp;<span class="ident" id="7469435">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7469440">import</span>&nbsp;<span class="op" id="7469447">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7469450">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7469459">&#34;image&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7469468">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469483">_</span>&nbsp;<span class="string" id="7469485">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7469498">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7469511">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7469524">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7469530">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7469540">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7469543">func</span>&nbsp;<span class="ident" id="7469548">readImg</span><span class="op" id="7469555">(</span><span class="ident" id="7469556">filename</span>&nbsp;<span class="builtintype" id="7469565">string</span><span class="op" id="7469571">)</span>&nbsp;<span class="op" id="7469573">(</span><span class="ident" id="7469574">image</span><span class="op" id="7469579">.</span><span class="ident" id="7469580">Image</span><span class="op" id="7469585">,</span>&nbsp;<span class="builtintype" id="7469587">error</span><span class="op" id="7469592">)</span>&nbsp;<span class="op" id="7469594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469597">f</span><span class="op" id="7469598">,</span>&nbsp;<span class="ident" id="7469600">err</span>&nbsp;<span class="op" id="7469604">:=</span>&nbsp;<span class="ident" id="7469607">os</span><span class="op" id="7469609">.</span><span class="ident" id="7469610">Open</span><span class="op" id="7469614">(</span><span class="ident" id="7469615">filename</span><span class="op" id="7469623">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7469626">if</span>&nbsp;<span class="ident" id="7469629">err</span>&nbsp;<span class="op" id="7469633">!=</span>&nbsp;<span class="ident" id="7469636">nil</span>&nbsp;<span class="op" id="7469640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7469644">return</span>&nbsp;<span class="ident" id="7469651">nil</span><span class="op" id="7469654">,</span>&nbsp;<span class="ident" id="7469656">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7469664">defer</span>&nbsp;<span class="ident" id="7469670">f</span><span class="op" id="7469671">.</span><span class="ident" id="7469672">Close</span><span class="op" id="7469677">(</span><span class="op" id="7469678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469681">m</span><span class="op" id="7469682">,</span>&nbsp;<span class="ident" id="7469684">_</span><span class="op" id="7469685">,</span>&nbsp;<span class="ident" id="7469687">err</span>&nbsp;<span class="op" id="7469691">:=</span>&nbsp;<span class="ident" id="7469694">image</span><span class="op" id="7469699">.</span><span class="ident" id="7469700">Decode</span><span class="op" id="7469706">(</span><span class="ident" id="7469707">f</span><span class="op" id="7469708">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7469711">return</span>&nbsp;<span class="ident" id="7469718">m</span><span class="op" id="7469719">,</span>&nbsp;<span class="ident" id="7469721">err</span><br>
<span class="lineno"></span><span class="op" id="7469725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7469728">func</span>&nbsp;<span class="ident" id="7469733">readGIF</span><span class="op" id="7469740">(</span><span class="ident" id="7469741">filename</span>&nbsp;<span class="builtintype" id="7469750">string</span><span class="op" id="7469756">)</span>&nbsp;<span class="op" id="7469758">(</span><span class="op" id="7469759">*</span><span class="ident" id="7469760">GIF</span><span class="op" id="7469763">,</span>&nbsp;<span class="builtintype" id="7469765">error</span><span class="op" id="7469770">)</span>&nbsp;<span class="op" id="7469772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469775">f</span><span class="op" id="7469776">,</span>&nbsp;<span class="ident" id="7469778">err</span>&nbsp;<span class="op" id="7469782">:=</span>&nbsp;<span class="ident" id="7469785">os</span><span class="op" id="7469787">.</span><span class="ident" id="7469788">Open</span><span class="op" id="7469792">(</span><span class="ident" id="7469793">filename</span><span class="op" id="7469801">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7469804">if</span>&nbsp;<span class="ident" id="7469807">err</span>&nbsp;<span class="op" id="7469811">!=</span>&nbsp;<span class="ident" id="7469814">nil</span>&nbsp;<span class="op" id="7469818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7469822">return</span>&nbsp;<span class="ident" id="7469829">nil</span><span class="op" id="7469832">,</span>&nbsp;<span class="ident" id="7469834">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7469842">defer</span>&nbsp;<span class="ident" id="7469848">f</span><span class="op" id="7469849">.</span><span class="ident" id="7469850">Close</span><span class="op" id="7469855">(</span><span class="op" id="7469856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7469859">return</span>&nbsp;<span class="ident" id="7469866">DecodeAll</span><span class="op" id="7469875">(</span><span class="ident" id="7469876">f</span><span class="op" id="7469877">)</span><br>
<span class="lineno">35</span><span class="op" id="7469879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7469882">func</span>&nbsp;<span class="ident" id="7469887">delta</span><span class="op" id="7469892">(</span><span class="ident" id="7469893">u0</span><span class="op" id="7469895">,</span>&nbsp;<span class="ident" id="7469897">u1</span>&nbsp;<span class="builtintype" id="7469900">uint32</span><span class="op" id="7469906">)</span>&nbsp;<span class="ident" id="7469908">int64</span>&nbsp;<span class="op" id="7469914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469917">d</span>&nbsp;<span class="op" id="7469919">:=</span>&nbsp;<span class="ident" id="7469922">int64</span><span class="op" id="7469927">(</span><span class="ident" id="7469928">u0</span><span class="op" id="7469930">)</span>&nbsp;<span class="op" id="7469932">-</span>&nbsp;<span class="ident" id="7469934">int64</span><span class="op" id="7469939">(</span><span class="ident" id="7469940">u1</span><span class="op" id="7469942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7469945">if</span>&nbsp;<span class="ident" id="7469948">d</span>&nbsp;<span class="op" id="7469950">&lt;</span>&nbsp;<span class="num" id="7469952">0</span>&nbsp;<span class="op" id="7469954">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7469958">return</span>&nbsp;<span class="op" id="7469965">-</span><span class="ident" id="7469966">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7469972">return</span>&nbsp;<span class="ident" id="7469979">d</span><br>
<span class="lineno"></span><span class="op" id="7469981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="7469984">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="7470060">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="7470085">func</span>&nbsp;<span class="ident" id="7470090">averageDelta</span><span class="op" id="7470102">(</span><span class="ident" id="7470103">m0</span><span class="op" id="7470105">,</span>&nbsp;<span class="ident" id="7470107">m1</span>&nbsp;<span class="ident" id="7470110">image</span><span class="op" id="7470115">.</span><span class="ident" id="7470116">Image</span><span class="op" id="7470121">)</span>&nbsp;<span class="ident" id="7470123">int64</span>&nbsp;<span class="op" id="7470129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470132">b</span>&nbsp;<span class="op" id="7470134">:=</span>&nbsp;<span class="ident" id="7470137">m0</span><span class="op" id="7470139">.</span><span class="ident" id="7470140">Bounds</span><span class="op" id="7470146">(</span><span class="op" id="7470147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470150">var</span>&nbsp;<span class="ident" id="7470154">sum</span><span class="op" id="7470157">,</span>&nbsp;<span class="ident" id="7470159">n</span>&nbsp;<span class="ident" id="7470161">int64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470168">for</span>&nbsp;<span class="ident" id="7470172">y</span>&nbsp;<span class="op" id="7470174">:=</span>&nbsp;<span class="ident" id="7470177">b</span><span class="op" id="7470178">.</span><span class="ident" id="7470179">Min</span><span class="op" id="7470182">.</span><span class="ident" id="7470183">Y</span><span class="op" id="7470184">;</span>&nbsp;<span class="ident" id="7470186">y</span>&nbsp;<span class="op" id="7470188">&lt;</span>&nbsp;<span class="ident" id="7470190">b</span><span class="op" id="7470191">.</span><span class="ident" id="7470192">Max</span><span class="op" id="7470195">.</span><span class="ident" id="7470196">Y</span><span class="op" id="7470197">;</span>&nbsp;<span class="ident" id="7470199">y</span><span class="op" id="7470200">++</span>&nbsp;<span class="op" id="7470203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470207">for</span>&nbsp;<span class="ident" id="7470211">x</span>&nbsp;<span class="op" id="7470213">:=</span>&nbsp;<span class="ident" id="7470216">b</span><span class="op" id="7470217">.</span><span class="ident" id="7470218">Min</span><span class="op" id="7470221">.</span><span class="ident" id="7470222">X</span><span class="op" id="7470223">;</span>&nbsp;<span class="ident" id="7470225">x</span>&nbsp;<span class="op" id="7470227">&lt;</span>&nbsp;<span class="ident" id="7470229">b</span><span class="op" id="7470230">.</span><span class="ident" id="7470231">Max</span><span class="op" id="7470234">.</span><span class="ident" id="7470235">X</span><span class="op" id="7470236">;</span>&nbsp;<span class="ident" id="7470238">x</span><span class="op" id="7470239">++</span>&nbsp;<span class="op" id="7470242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470247">c0</span>&nbsp;<span class="op" id="7470250">:=</span>&nbsp;<span class="ident" id="7470253">m0</span><span class="op" id="7470255">.</span><span class="ident" id="7470256">At</span><span class="op" id="7470258">(</span><span class="ident" id="7470259">x</span><span class="op" id="7470260">,</span>&nbsp;<span class="ident" id="7470262">y</span><span class="op" id="7470263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470268">c1</span>&nbsp;<span class="op" id="7470271">:=</span>&nbsp;<span class="ident" id="7470274">m1</span><span class="op" id="7470276">.</span><span class="ident" id="7470277">At</span><span class="op" id="7470279">(</span><span class="ident" id="7470280">x</span><span class="op" id="7470281">,</span>&nbsp;<span class="ident" id="7470283">y</span><span class="op" id="7470284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470289">r0</span><span class="op" id="7470291">,</span>&nbsp;<span class="ident" id="7470293">g0</span><span class="op" id="7470295">,</span>&nbsp;<span class="ident" id="7470297">b0</span><span class="op" id="7470299">,</span>&nbsp;<span class="ident" id="7470301">_</span>&nbsp;<span class="op" id="7470303">:=</span>&nbsp;<span class="ident" id="7470306">c0</span><span class="op" id="7470308">.</span><span class="ident" id="7470309">RGBA</span><span class="op" id="7470313">(</span><span class="op" id="7470314">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470319">r1</span><span class="op" id="7470321">,</span>&nbsp;<span class="ident" id="7470323">g1</span><span class="op" id="7470325">,</span>&nbsp;<span class="ident" id="7470327">b1</span><span class="op" id="7470329">,</span>&nbsp;<span class="ident" id="7470331">_</span>&nbsp;<span class="op" id="7470333">:=</span>&nbsp;<span class="ident" id="7470336">c1</span><span class="op" id="7470338">.</span><span class="ident" id="7470339">RGBA</span><span class="op" id="7470343">(</span><span class="op" id="7470344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470349">sum</span>&nbsp;<span class="op" id="7470353">+=</span>&nbsp;<span class="ident" id="7470356">delta</span><span class="op" id="7470361">(</span><span class="ident" id="7470362">r0</span><span class="op" id="7470364">,</span>&nbsp;<span class="ident" id="7470366">r1</span><span class="op" id="7470368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470373">sum</span>&nbsp;<span class="op" id="7470377">+=</span>&nbsp;<span class="ident" id="7470380">delta</span><span class="op" id="7470385">(</span><span class="ident" id="7470386">g0</span><span class="op" id="7470388">,</span>&nbsp;<span class="ident" id="7470390">g1</span><span class="op" id="7470392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470397">sum</span>&nbsp;<span class="op" id="7470401">+=</span>&nbsp;<span class="ident" id="7470404">delta</span><span class="op" id="7470409">(</span><span class="ident" id="7470410">b0</span><span class="op" id="7470412">,</span>&nbsp;<span class="ident" id="7470414">b1</span><span class="op" id="7470416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470421">n</span>&nbsp;<span class="op" id="7470423">+=</span>&nbsp;<span class="num" id="7470426">3</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7470430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7470433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470436">return</span>&nbsp;<span class="ident" id="7470443">sum</span>&nbsp;<span class="op" id="7470447">/</span>&nbsp;<span class="ident" id="7470449">n</span><br>
<span class="lineno"></span><span class="op" id="7470451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7470454">var</span>&nbsp;<span class="ident" id="7470458">testCase</span>&nbsp;<span class="op" id="7470467">=</span>&nbsp;<span class="op" id="7470469">[</span><span class="op" id="7470470">]</span><span class="keyword" id="7470471">struct</span>&nbsp;<span class="op" id="7470478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470481">filename</span>&nbsp;&nbsp;<span class="builtintype" id="7470491">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470499">tolerance</span>&nbsp;<span class="ident" id="7470509">int64</span><br>
<span class="lineno"></span><span class="op" id="7470515">}</span><span class="op" id="7470516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7470519">{</span><span class="string" id="7470520">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7470547">,</span>&nbsp;<span class="num" id="7470549">1</span>&nbsp;<span class="op" id="7470551">&lt;&lt;</span>&nbsp;<span class="num" id="7470554">12</span><span class="op" id="7470556">}</span><span class="op" id="7470557">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7470560">{</span><span class="string" id="7470561">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7470588">,</span>&nbsp;<span class="num" id="7470590">0</span><span class="op" id="7470591">}</span><span class="op" id="7470592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7470595">{</span><span class="string" id="7470596">&#34;../testdata/video-001.interlaced.gif&#34;</span><span class="op" id="7470634">,</span>&nbsp;<span class="num" id="7470636">0</span><span class="op" id="7470637">}</span><span class="op" id="7470638">,</span><br>
<span class="lineno"></span><span class="op" id="7470640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7470643">func</span>&nbsp;<span class="ident" id="7470648">TestWriter</span><span class="op" id="7470658">(</span><span class="ident" id="7470659">t</span>&nbsp;<span class="op" id="7470661">*</span><span class="ident" id="7470662">testing</span><span class="op" id="7470669">.</span><span class="ident" id="7470670">T</span><span class="op" id="7470671">)</span>&nbsp;<span class="op" id="7470673">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470676">for</span>&nbsp;<span class="ident" id="7470680">_</span><span class="op" id="7470681">,</span>&nbsp;<span class="ident" id="7470683">tc</span>&nbsp;<span class="op" id="7470686">:=</span>&nbsp;<span class="keyword" id="7470689">range</span>&nbsp;<span class="ident" id="7470695">testCase</span>&nbsp;<span class="op" id="7470704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470708">m0</span><span class="op" id="7470710">,</span>&nbsp;<span class="ident" id="7470712">err</span>&nbsp;<span class="op" id="7470716">:=</span>&nbsp;<span class="ident" id="7470719">readImg</span><span class="op" id="7470726">(</span><span class="ident" id="7470727">tc</span><span class="op" id="7470729">.</span><span class="ident" id="7470730">filename</span><span class="op" id="7470738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470742">if</span>&nbsp;<span class="ident" id="7470745">err</span>&nbsp;<span class="op" id="7470749">!=</span>&nbsp;<span class="ident" id="7470752">nil</span>&nbsp;<span class="op" id="7470756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470761">t</span><span class="op" id="7470762">.</span><span class="ident" id="7470763">Error</span><span class="op" id="7470768">(</span><span class="ident" id="7470769">tc</span><span class="op" id="7470771">.</span><span class="ident" id="7470772">filename</span><span class="op" id="7470780">,</span>&nbsp;<span class="ident" id="7470782">err</span><span class="op" id="7470785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470790">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7470801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470805">var</span>&nbsp;<span class="ident" id="7470809">buf</span>&nbsp;<span class="ident" id="7470813">bytes</span><span class="op" id="7470818">.</span><span class="ident" id="7470819">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470828">err</span>&nbsp;<span class="op" id="7470832">=</span>&nbsp;<span class="ident" id="7470834">Encode</span><span class="op" id="7470840">(</span><span class="op" id="7470841">&amp;</span><span class="ident" id="7470842">buf</span><span class="op" id="7470845">,</span>&nbsp;<span class="ident" id="7470847">m0</span><span class="op" id="7470849">,</span>&nbsp;<span class="ident" id="7470851">nil</span><span class="op" id="7470854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470858">if</span>&nbsp;<span class="ident" id="7470861">err</span>&nbsp;<span class="op" id="7470865">!=</span>&nbsp;<span class="ident" id="7470868">nil</span>&nbsp;<span class="op" id="7470872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470877">t</span><span class="op" id="7470878">.</span><span class="ident" id="7470879">Error</span><span class="op" id="7470884">(</span><span class="ident" id="7470885">tc</span><span class="op" id="7470887">.</span><span class="ident" id="7470888">filename</span><span class="op" id="7470896">,</span>&nbsp;<span class="ident" id="7470898">err</span><span class="op" id="7470901">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470906">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7470917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470921">m1</span><span class="op" id="7470923">,</span>&nbsp;<span class="ident" id="7470925">err</span>&nbsp;<span class="op" id="7470929">:=</span>&nbsp;<span class="ident" id="7470932">Decode</span><span class="op" id="7470938">(</span><span class="op" id="7470939">&amp;</span><span class="ident" id="7470940">buf</span><span class="op" id="7470943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470947">if</span>&nbsp;<span class="ident" id="7470950">err</span>&nbsp;<span class="op" id="7470954">!=</span>&nbsp;<span class="ident" id="7470957">nil</span>&nbsp;<span class="op" id="7470961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470966">t</span><span class="op" id="7470967">.</span><span class="ident" id="7470968">Error</span><span class="op" id="7470973">(</span><span class="ident" id="7470974">tc</span><span class="op" id="7470976">.</span><span class="ident" id="7470977">filename</span><span class="op" id="7470985">,</span>&nbsp;<span class="ident" id="7470987">err</span><span class="op" id="7470990">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470995">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471010">if</span>&nbsp;<span class="ident" id="7471013">m0</span><span class="op" id="7471015">.</span><span class="ident" id="7471016">Bounds</span><span class="op" id="7471022">(</span><span class="op" id="7471023">)</span>&nbsp;<span class="op" id="7471025">!=</span>&nbsp;<span class="ident" id="7471028">m1</span><span class="op" id="7471030">.</span><span class="ident" id="7471031">Bounds</span><span class="op" id="7471037">(</span><span class="op" id="7471038">)</span>&nbsp;<span class="op" id="7471040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471045">t</span><span class="op" id="7471046">.</span><span class="ident" id="7471047">Errorf</span><span class="op" id="7471053">(</span><span class="string" id="7471054">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7471084">,</span>&nbsp;<span class="ident" id="7471086">tc</span><span class="op" id="7471088">.</span><span class="ident" id="7471089">filename</span><span class="op" id="7471097">,</span>&nbsp;<span class="ident" id="7471099">m0</span><span class="op" id="7471101">.</span><span class="ident" id="7471102">Bounds</span><span class="op" id="7471108">(</span><span class="op" id="7471109">)</span><span class="op" id="7471110">,</span>&nbsp;<span class="ident" id="7471112">m1</span><span class="op" id="7471114">.</span><span class="ident" id="7471115">Bounds</span><span class="op" id="7471121">(</span><span class="op" id="7471122">)</span><span class="op" id="7471123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471128">continue</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7471143">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471198">avgDelta</span>&nbsp;<span class="op" id="7471207">:=</span>&nbsp;<span class="ident" id="7471210">averageDelta</span><span class="op" id="7471222">(</span><span class="ident" id="7471223">m0</span><span class="op" id="7471225">,</span>&nbsp;<span class="ident" id="7471227">m1</span><span class="op" id="7471229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471233">if</span>&nbsp;<span class="ident" id="7471236">avgDelta</span>&nbsp;<span class="op" id="7471245">&gt;</span>&nbsp;<span class="ident" id="7471247">tc</span><span class="op" id="7471249">.</span><span class="ident" id="7471250">tolerance</span>&nbsp;<span class="op" id="7471260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471265">t</span><span class="op" id="7471266">.</span><span class="ident" id="7471267">Errorf</span><span class="op" id="7471273">(</span><span class="string" id="7471274">&#34;%s:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high.&nbsp;expected:&nbsp;%d,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7471327">,</span>&nbsp;<span class="ident" id="7471329">tc</span><span class="op" id="7471331">.</span><span class="ident" id="7471332">filename</span><span class="op" id="7471340">,</span>&nbsp;<span class="ident" id="7471342">tc</span><span class="op" id="7471344">.</span><span class="ident" id="7471345">tolerance</span><span class="op" id="7471354">,</span>&nbsp;<span class="ident" id="7471356">avgDelta</span><span class="op" id="7471364">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471369">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471383">}</span><br>
<span class="lineno"></span><span class="op" id="7471385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7471388">func</span>&nbsp;<span class="ident" id="7471393">TestSubImage</span><span class="op" id="7471405">(</span><span class="ident" id="7471406">t</span>&nbsp;<span class="op" id="7471408">*</span><span class="ident" id="7471409">testing</span><span class="op" id="7471416">.</span><span class="ident" id="7471417">T</span><span class="op" id="7471418">)</span>&nbsp;<span class="op" id="7471420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471423">m0</span><span class="op" id="7471425">,</span>&nbsp;<span class="ident" id="7471427">err</span>&nbsp;<span class="op" id="7471431">:=</span>&nbsp;<span class="ident" id="7471434">readImg</span><span class="op" id="7471441">(</span><span class="string" id="7471442">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7471469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471472">if</span>&nbsp;<span class="ident" id="7471475">err</span>&nbsp;<span class="op" id="7471479">!=</span>&nbsp;<span class="ident" id="7471482">nil</span>&nbsp;<span class="op" id="7471486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471490">t</span><span class="op" id="7471491">.</span><span class="ident" id="7471492">Fatalf</span><span class="op" id="7471498">(</span><span class="string" id="7471499">&#34;readImg:&nbsp;%v&#34;</span><span class="op" id="7471512">,</span>&nbsp;<span class="ident" id="7471514">err</span><span class="op" id="7471517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471520">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471523">m0</span>&nbsp;<span class="op" id="7471526">=</span>&nbsp;<span class="ident" id="7471528">m0</span><span class="op" id="7471530">.</span><span class="op" id="7471531">(</span><span class="op" id="7471532">*</span><span class="ident" id="7471533">image</span><span class="op" id="7471538">.</span><span class="ident" id="7471539">Paletted</span><span class="op" id="7471547">)</span><span class="op" id="7471548">.</span><span class="ident" id="7471549">SubImage</span><span class="op" id="7471557">(</span><span class="ident" id="7471558">image</span><span class="op" id="7471563">.</span><span class="ident" id="7471564">Rect</span><span class="op" id="7471568">(</span><span class="num" id="7471569">0</span><span class="op" id="7471570">,</span>&nbsp;<span class="num" id="7471572">0</span><span class="op" id="7471573">,</span>&nbsp;<span class="num" id="7471575">50</span><span class="op" id="7471577">,</span>&nbsp;<span class="num" id="7471579">30</span><span class="op" id="7471581">)</span><span class="op" id="7471582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471585">var</span>&nbsp;<span class="ident" id="7471589">buf</span>&nbsp;<span class="ident" id="7471593">bytes</span><span class="op" id="7471598">.</span><span class="ident" id="7471599">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471607">err</span>&nbsp;<span class="op" id="7471611">=</span>&nbsp;<span class="ident" id="7471613">Encode</span><span class="op" id="7471619">(</span><span class="op" id="7471620">&amp;</span><span class="ident" id="7471621">buf</span><span class="op" id="7471624">,</span>&nbsp;<span class="ident" id="7471626">m0</span><span class="op" id="7471628">,</span>&nbsp;<span class="ident" id="7471630">nil</span><span class="op" id="7471633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471636">if</span>&nbsp;<span class="ident" id="7471639">err</span>&nbsp;<span class="op" id="7471643">!=</span>&nbsp;<span class="ident" id="7471646">nil</span>&nbsp;<span class="op" id="7471650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471654">t</span><span class="op" id="7471655">.</span><span class="ident" id="7471656">Fatalf</span><span class="op" id="7471662">(</span><span class="string" id="7471663">&#34;Encode:&nbsp;%v&#34;</span><span class="op" id="7471675">,</span>&nbsp;<span class="ident" id="7471677">err</span><span class="op" id="7471680">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471686">m1</span><span class="op" id="7471688">,</span>&nbsp;<span class="ident" id="7471690">err</span>&nbsp;<span class="op" id="7471694">:=</span>&nbsp;<span class="ident" id="7471697">Decode</span><span class="op" id="7471703">(</span><span class="op" id="7471704">&amp;</span><span class="ident" id="7471705">buf</span><span class="op" id="7471708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471711">if</span>&nbsp;<span class="ident" id="7471714">err</span>&nbsp;<span class="op" id="7471718">!=</span>&nbsp;<span class="ident" id="7471721">nil</span>&nbsp;<span class="op" id="7471725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471729">t</span><span class="op" id="7471730">.</span><span class="ident" id="7471731">Fatalf</span><span class="op" id="7471737">(</span><span class="string" id="7471738">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="7471750">,</span>&nbsp;<span class="ident" id="7471752">err</span><span class="op" id="7471755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471758">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471761">if</span>&nbsp;<span class="ident" id="7471764">m0</span><span class="op" id="7471766">.</span><span class="ident" id="7471767">Bounds</span><span class="op" id="7471773">(</span><span class="op" id="7471774">)</span>&nbsp;<span class="op" id="7471776">!=</span>&nbsp;<span class="ident" id="7471779">m1</span><span class="op" id="7471781">.</span><span class="ident" id="7471782">Bounds</span><span class="op" id="7471788">(</span><span class="op" id="7471789">)</span>&nbsp;<span class="op" id="7471791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471795">t</span><span class="op" id="7471796">.</span><span class="ident" id="7471797">Fatalf</span><span class="op" id="7471803">(</span><span class="string" id="7471804">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7471830">,</span>&nbsp;<span class="ident" id="7471832">m0</span><span class="op" id="7471834">.</span><span class="ident" id="7471835">Bounds</span><span class="op" id="7471841">(</span><span class="op" id="7471842">)</span><span class="op" id="7471843">,</span>&nbsp;<span class="ident" id="7471845">m1</span><span class="op" id="7471847">.</span><span class="ident" id="7471848">Bounds</span><span class="op" id="7471854">(</span><span class="op" id="7471855">)</span><span class="op" id="7471856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471862">if</span>&nbsp;<span class="ident" id="7471865">averageDelta</span><span class="op" id="7471877">(</span><span class="ident" id="7471878">m0</span><span class="op" id="7471880">,</span>&nbsp;<span class="ident" id="7471882">m1</span><span class="op" id="7471884">)</span>&nbsp;<span class="op" id="7471886">!=</span>&nbsp;<span class="num" id="7471889">0</span>&nbsp;<span class="op" id="7471891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471895">t</span><span class="op" id="7471896">.</span><span class="ident" id="7471897">Fatalf</span><span class="op" id="7471903">(</span><span class="string" id="7471904">&#34;images&nbsp;differ&#34;</span><span class="op" id="7471919">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471922">}</span><br>
<span class="lineno"></span><span class="op" id="7471924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7471927">var</span>&nbsp;<span class="ident" id="7471931">frames</span>&nbsp;<span class="op" id="7471938">=</span>&nbsp;<span class="op" id="7471940">[</span><span class="op" id="7471941">]</span><span class="builtintype" id="7471942">string</span><span class="op" id="7471948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7471951">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7471978">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7471981">&#34;../testdata/video-005.gray.gif&#34;</span><span class="op" id="7472013">,</span><br>
<span class="lineno"></span><span class="op" id="7472015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7472018">func</span>&nbsp;<span class="ident" id="7472023">TestEncodeAll</span><span class="op" id="7472036">(</span><span class="ident" id="7472037">t</span>&nbsp;<span class="op" id="7472039">*</span><span class="ident" id="7472040">testing</span><span class="op" id="7472047">.</span><span class="ident" id="7472048">T</span><span class="op" id="7472049">)</span>&nbsp;<span class="op" id="7472051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472054">g0</span>&nbsp;<span class="op" id="7472057">:=</span>&nbsp;<span class="op" id="7472060">&amp;</span><span class="ident" id="7472061">GIF</span><span class="op" id="7472064">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472068">Image</span><span class="op" id="7472073">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7472079">make</span><span class="op" id="7472083">(</span><span class="op" id="7472084">[</span><span class="op" id="7472085">]</span><span class="op" id="7472086">*</span><span class="ident" id="7472087">image</span><span class="op" id="7472092">.</span><span class="ident" id="7472093">Paletted</span><span class="op" id="7472101">,</span>&nbsp;<span class="builtinfunc" id="7472103">len</span><span class="op" id="7472106">(</span><span class="ident" id="7472107">frames</span><span class="op" id="7472113">)</span><span class="op" id="7472114">)</span><span class="op" id="7472115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472119">Delay</span><span class="op" id="7472124">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7472130">make</span><span class="op" id="7472134">(</span><span class="op" id="7472135">[</span><span class="op" id="7472136">]</span><span class="builtintype" id="7472137">int</span><span class="op" id="7472140">,</span>&nbsp;<span class="builtinfunc" id="7472142">len</span><span class="op" id="7472145">(</span><span class="ident" id="7472146">frames</span><span class="op" id="7472152">)</span><span class="op" id="7472153">)</span><span class="op" id="7472154">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472158">LoopCount</span><span class="op" id="7472167">:</span>&nbsp;<span class="num" id="7472169">5</span><span class="op" id="7472170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472176">for</span>&nbsp;<span class="ident" id="7472180">i</span><span class="op" id="7472181">,</span>&nbsp;<span class="ident" id="7472183">f</span>&nbsp;<span class="op" id="7472185">:=</span>&nbsp;<span class="keyword" id="7472188">range</span>&nbsp;<span class="ident" id="7472194">frames</span>&nbsp;<span class="op" id="7472201">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472205">m</span><span class="op" id="7472206">,</span>&nbsp;<span class="ident" id="7472208">err</span>&nbsp;<span class="op" id="7472212">:=</span>&nbsp;<span class="ident" id="7472215">readGIF</span><span class="op" id="7472222">(</span><span class="ident" id="7472223">f</span><span class="op" id="7472224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472228">if</span>&nbsp;<span class="ident" id="7472231">err</span>&nbsp;<span class="op" id="7472235">!=</span>&nbsp;<span class="ident" id="7472238">nil</span>&nbsp;<span class="op" id="7472242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472247">t</span><span class="op" id="7472248">.</span><span class="ident" id="7472249">Fatal</span><span class="op" id="7472254">(</span><span class="ident" id="7472255">f</span><span class="op" id="7472256">,</span>&nbsp;<span class="ident" id="7472258">err</span><span class="op" id="7472261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472269">g0</span><span class="op" id="7472271">.</span><span class="ident" id="7472272">Image</span><span class="op" id="7472277">[</span><span class="ident" id="7472278">i</span><span class="op" id="7472279">]</span>&nbsp;<span class="op" id="7472281">=</span>&nbsp;<span class="ident" id="7472283">m</span><span class="op" id="7472284">.</span><span class="ident" id="7472285">Image</span><span class="op" id="7472290">[</span><span class="num" id="7472291">0</span><span class="op" id="7472292">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472298">var</span>&nbsp;<span class="ident" id="7472302">buf</span>&nbsp;<span class="ident" id="7472306">bytes</span><span class="op" id="7472311">.</span><span class="ident" id="7472312">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472320">if</span>&nbsp;<span class="ident" id="7472323">err</span>&nbsp;<span class="op" id="7472327">:=</span>&nbsp;<span class="ident" id="7472330">EncodeAll</span><span class="op" id="7472339">(</span><span class="op" id="7472340">&amp;</span><span class="ident" id="7472341">buf</span><span class="op" id="7472344">,</span>&nbsp;<span class="ident" id="7472346">g0</span><span class="op" id="7472348">)</span><span class="op" id="7472349">;</span>&nbsp;<span class="ident" id="7472351">err</span>&nbsp;<span class="op" id="7472355">!=</span>&nbsp;<span class="ident" id="7472358">nil</span>&nbsp;<span class="op" id="7472362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472366">t</span><span class="op" id="7472367">.</span><span class="ident" id="7472368">Fatal</span><span class="op" id="7472373">(</span><span class="string" id="7472374">&#34;EncodeAll:&#34;</span><span class="op" id="7472386">,</span>&nbsp;<span class="ident" id="7472388">err</span><span class="op" id="7472391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472394">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472397">g1</span><span class="op" id="7472399">,</span>&nbsp;<span class="ident" id="7472401">err</span>&nbsp;<span class="op" id="7472405">:=</span>&nbsp;<span class="ident" id="7472408">DecodeAll</span><span class="op" id="7472417">(</span><span class="op" id="7472418">&amp;</span><span class="ident" id="7472419">buf</span><span class="op" id="7472422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472425">if</span>&nbsp;<span class="ident" id="7472428">err</span>&nbsp;<span class="op" id="7472432">!=</span>&nbsp;<span class="ident" id="7472435">nil</span>&nbsp;<span class="op" id="7472439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472443">t</span><span class="op" id="7472444">.</span><span class="ident" id="7472445">Fatal</span><span class="op" id="7472450">(</span><span class="string" id="7472451">&#34;DecodeAll:&#34;</span><span class="op" id="7472463">,</span>&nbsp;<span class="ident" id="7472465">err</span><span class="op" id="7472468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472474">if</span>&nbsp;<span class="ident" id="7472477">g0</span><span class="op" id="7472479">.</span><span class="ident" id="7472480">LoopCount</span>&nbsp;<span class="op" id="7472490">!=</span>&nbsp;<span class="ident" id="7472493">g1</span><span class="op" id="7472495">.</span><span class="ident" id="7472496">LoopCount</span>&nbsp;<span class="op" id="7472506">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472510">t</span><span class="op" id="7472511">.</span><span class="ident" id="7472512">Errorf</span><span class="op" id="7472518">(</span><span class="string" id="7472519">&#34;loop&nbsp;counts&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="7472550">,</span>&nbsp;<span class="ident" id="7472552">g0</span><span class="op" id="7472554">.</span><span class="ident" id="7472555">LoopCount</span><span class="op" id="7472564">,</span>&nbsp;<span class="ident" id="7472566">g1</span><span class="op" id="7472568">.</span><span class="ident" id="7472569">LoopCount</span><span class="op" id="7472578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472584">for</span>&nbsp;<span class="ident" id="7472588">i</span>&nbsp;<span class="op" id="7472590">:=</span>&nbsp;<span class="keyword" id="7472593">range</span>&nbsp;<span class="ident" id="7472599">g0</span><span class="op" id="7472601">.</span><span class="ident" id="7472602">Image</span>&nbsp;<span class="op" id="7472608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472612">m0</span><span class="op" id="7472614">,</span>&nbsp;<span class="ident" id="7472616">m1</span>&nbsp;<span class="op" id="7472619">:=</span>&nbsp;<span class="ident" id="7472622">g0</span><span class="op" id="7472624">.</span><span class="ident" id="7472625">Image</span><span class="op" id="7472630">[</span><span class="ident" id="7472631">i</span><span class="op" id="7472632">]</span><span class="op" id="7472633">,</span>&nbsp;<span class="ident" id="7472635">g1</span><span class="op" id="7472637">.</span><span class="ident" id="7472638">Image</span><span class="op" id="7472643">[</span><span class="ident" id="7472644">i</span><span class="op" id="7472645">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472649">if</span>&nbsp;<span class="ident" id="7472652">m0</span><span class="op" id="7472654">.</span><span class="ident" id="7472655">Bounds</span><span class="op" id="7472661">(</span><span class="op" id="7472662">)</span>&nbsp;<span class="op" id="7472664">!=</span>&nbsp;<span class="ident" id="7472667">m1</span><span class="op" id="7472669">.</span><span class="ident" id="7472670">Bounds</span><span class="op" id="7472676">(</span><span class="op" id="7472677">)</span>&nbsp;<span class="op" id="7472679">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472684">t</span><span class="op" id="7472685">.</span><span class="ident" id="7472686">Errorf</span><span class="op" id="7472692">(</span><span class="string" id="7472693">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7472723">,</span>&nbsp;<span class="ident" id="7472725">frames</span><span class="op" id="7472731">[</span><span class="ident" id="7472732">i</span><span class="op" id="7472733">]</span><span class="op" id="7472734">,</span>&nbsp;<span class="ident" id="7472736">m0</span><span class="op" id="7472738">.</span><span class="ident" id="7472739">Bounds</span><span class="op" id="7472745">(</span><span class="op" id="7472746">)</span><span class="op" id="7472747">,</span>&nbsp;<span class="ident" id="7472749">m1</span><span class="op" id="7472751">.</span><span class="ident" id="7472752">Bounds</span><span class="op" id="7472758">(</span><span class="op" id="7472759">)</span><span class="op" id="7472760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472768">d0</span><span class="op" id="7472770">,</span>&nbsp;<span class="ident" id="7472772">d1</span>&nbsp;<span class="op" id="7472775">:=</span>&nbsp;<span class="ident" id="7472778">g0</span><span class="op" id="7472780">.</span><span class="ident" id="7472781">Delay</span><span class="op" id="7472786">[</span><span class="ident" id="7472787">i</span><span class="op" id="7472788">]</span><span class="op" id="7472789">,</span>&nbsp;<span class="ident" id="7472791">g1</span><span class="op" id="7472793">.</span><span class="ident" id="7472794">Delay</span><span class="op" id="7472799">[</span><span class="ident" id="7472800">i</span><span class="op" id="7472801">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472805">if</span>&nbsp;<span class="ident" id="7472808">d0</span>&nbsp;<span class="op" id="7472811">!=</span>&nbsp;<span class="ident" id="7472814">d1</span>&nbsp;<span class="op" id="7472817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472822">t</span><span class="op" id="7472823">.</span><span class="ident" id="7472824">Errorf</span><span class="op" id="7472830">(</span><span class="string" id="7472831">&#34;%s:&nbsp;delay&nbsp;values&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="7472867">,</span>&nbsp;<span class="ident" id="7472869">frames</span><span class="op" id="7472875">[</span><span class="ident" id="7472876">i</span><span class="op" id="7472877">]</span><span class="op" id="7472878">,</span>&nbsp;<span class="ident" id="7472880">d0</span><span class="op" id="7472882">,</span>&nbsp;<span class="ident" id="7472884">d1</span><span class="op" id="7472886">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472897">g1</span><span class="op" id="7472899">.</span><span class="ident" id="7472900">Delay</span>&nbsp;<span class="op" id="7472906">=</span>&nbsp;<span class="builtinfunc" id="7472908">make</span><span class="op" id="7472912">(</span><span class="op" id="7472913">[</span><span class="op" id="7472914">]</span><span class="builtintype" id="7472915">int</span><span class="op" id="7472918">,</span>&nbsp;<span class="num" id="7472920">1</span><span class="op" id="7472921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472924">if</span>&nbsp;<span class="ident" id="7472927">err</span>&nbsp;<span class="op" id="7472931">:=</span>&nbsp;<span class="ident" id="7472934">EncodeAll</span><span class="op" id="7472943">(</span><span class="ident" id="7472944">ioutil</span><span class="op" id="7472950">.</span><span class="ident" id="7472951">Discard</span><span class="op" id="7472958">,</span>&nbsp;<span class="ident" id="7472960">g1</span><span class="op" id="7472962">)</span><span class="op" id="7472963">;</span>&nbsp;<span class="ident" id="7472965">err</span>&nbsp;<span class="op" id="7472969">==</span>&nbsp;<span class="ident" id="7472972">nil</span>&nbsp;<span class="op" id="7472976">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472980">t</span><span class="op" id="7472981">.</span><span class="ident" id="7472982">Error</span><span class="op" id="7472987">(</span><span class="string" id="7472988">&#34;expected&nbsp;error&nbsp;from&nbsp;mismatched&nbsp;delay&nbsp;and&nbsp;image&nbsp;slice&nbsp;lengths&#34;</span><span class="op" id="7473050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7473053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473056">if</span>&nbsp;<span class="ident" id="7473059">err</span>&nbsp;<span class="op" id="7473063">:=</span>&nbsp;<span class="ident" id="7473066">EncodeAll</span><span class="op" id="7473075">(</span><span class="ident" id="7473076">ioutil</span><span class="op" id="7473082">.</span><span class="ident" id="7473083">Discard</span><span class="op" id="7473090">,</span>&nbsp;<span class="op" id="7473092">&amp;</span><span class="ident" id="7473093">GIF</span><span class="op" id="7473096">{</span><span class="op" id="7473097">}</span><span class="op" id="7473098">)</span><span class="op" id="7473099">;</span>&nbsp;<span class="ident" id="7473101">err</span>&nbsp;<span class="op" id="7473105">==</span>&nbsp;<span class="ident" id="7473108">nil</span>&nbsp;<span class="op" id="7473112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473116">t</span><span class="op" id="7473117">.</span><span class="ident" id="7473118">Error</span><span class="op" id="7473123">(</span><span class="string" id="7473124">&#34;expected&nbsp;error&nbsp;from&nbsp;providing&nbsp;empty&nbsp;gif&#34;</span><span class="op" id="7473165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7473168">}</span><br>
<span class="lineno">175</span><span class="op" id="7473170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7473173">func</span>&nbsp;<span class="ident" id="7473178">BenchmarkEncode</span><span class="op" id="7473193">(</span><span class="ident" id="7473194">b</span>&nbsp;<span class="op" id="7473196">*</span><span class="ident" id="7473197">testing</span><span class="op" id="7473204">.</span><span class="ident" id="7473205">B</span><span class="op" id="7473206">)</span>&nbsp;<span class="op" id="7473208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473211">b</span><span class="op" id="7473212">.</span><span class="ident" id="7473213">StopTimer</span><span class="op" id="7473222">(</span><span class="op" id="7473223">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473227">bo</span>&nbsp;<span class="op" id="7473230">:=</span>&nbsp;<span class="ident" id="7473233">image</span><span class="op" id="7473238">.</span><span class="ident" id="7473239">Rect</span><span class="op" id="7473243">(</span><span class="num" id="7473244">0</span><span class="op" id="7473245">,</span>&nbsp;<span class="num" id="7473247">0</span><span class="op" id="7473248">,</span>&nbsp;<span class="num" id="7473250">640</span><span class="op" id="7473253">,</span>&nbsp;<span class="num" id="7473255">480</span><span class="op" id="7473258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473261">rnd</span>&nbsp;<span class="op" id="7473265">:=</span>&nbsp;<span class="ident" id="7473268">rand</span><span class="op" id="7473272">.</span><span class="ident" id="7473273">New</span><span class="op" id="7473276">(</span><span class="ident" id="7473277">rand</span><span class="op" id="7473281">.</span><span class="ident" id="7473282">NewSource</span><span class="op" id="7473291">(</span><span class="num" id="7473292">123</span><span class="op" id="7473295">)</span><span class="op" id="7473296">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7473300">//&nbsp;Restrict&nbsp;to&nbsp;a&nbsp;256-color&nbsp;paletted&nbsp;image&nbsp;to&nbsp;avoid&nbsp;quantization&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473371">palette</span>&nbsp;<span class="op" id="7473379">:=</span>&nbsp;<span class="builtinfunc" id="7473382">make</span><span class="op" id="7473386">(</span><span class="ident" id="7473387">color</span><span class="op" id="7473392">.</span><span class="ident" id="7473393">Palette</span><span class="op" id="7473400">,</span>&nbsp;<span class="num" id="7473402">256</span><span class="op" id="7473405">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473408">for</span>&nbsp;<span class="ident" id="7473412">i</span>&nbsp;<span class="op" id="7473414">:=</span>&nbsp;<span class="keyword" id="7473417">range</span>&nbsp;<span class="ident" id="7473423">palette</span>&nbsp;<span class="op" id="7473431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473435">palette</span><span class="op" id="7473442">[</span><span class="ident" id="7473443">i</span><span class="op" id="7473444">]</span>&nbsp;<span class="op" id="7473446">=</span>&nbsp;<span class="ident" id="7473448">color</span><span class="op" id="7473453">.</span><span class="ident" id="7473454">RGBA</span><span class="op" id="7473458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7473463">uint8</span><span class="op" id="7473468">(</span><span class="ident" id="7473469">rnd</span><span class="op" id="7473472">.</span><span class="ident" id="7473473">Intn</span><span class="op" id="7473477">(</span><span class="num" id="7473478">256</span><span class="op" id="7473481">)</span><span class="op" id="7473482">)</span><span class="op" id="7473483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7473488">uint8</span><span class="op" id="7473493">(</span><span class="ident" id="7473494">rnd</span><span class="op" id="7473497">.</span><span class="ident" id="7473498">Intn</span><span class="op" id="7473502">(</span><span class="num" id="7473503">256</span><span class="op" id="7473506">)</span><span class="op" id="7473507">)</span><span class="op" id="7473508">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7473513">uint8</span><span class="op" id="7473518">(</span><span class="ident" id="7473519">rnd</span><span class="op" id="7473522">.</span><span class="ident" id="7473523">Intn</span><span class="op" id="7473527">(</span><span class="num" id="7473528">256</span><span class="op" id="7473531">)</span><span class="op" id="7473532">)</span><span class="op" id="7473533">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7473538">255</span><span class="op" id="7473541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7473545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7473548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473551">img</span>&nbsp;<span class="op" id="7473555">:=</span>&nbsp;<span class="ident" id="7473558">image</span><span class="op" id="7473563">.</span><span class="ident" id="7473564">NewPaletted</span><span class="op" id="7473575">(</span><span class="ident" id="7473576">image</span><span class="op" id="7473581">.</span><span class="ident" id="7473582">Rect</span><span class="op" id="7473586">(</span><span class="num" id="7473587">0</span><span class="op" id="7473588">,</span>&nbsp;<span class="num" id="7473590">0</span><span class="op" id="7473591">,</span>&nbsp;<span class="num" id="7473593">640</span><span class="op" id="7473596">,</span>&nbsp;<span class="num" id="7473598">480</span><span class="op" id="7473601">)</span><span class="op" id="7473602">,</span>&nbsp;<span class="ident" id="7473604">palette</span><span class="op" id="7473611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473614">for</span>&nbsp;<span class="ident" id="7473618">y</span>&nbsp;<span class="op" id="7473620">:=</span>&nbsp;<span class="ident" id="7473623">bo</span><span class="op" id="7473625">.</span><span class="ident" id="7473626">Min</span><span class="op" id="7473629">.</span><span class="ident" id="7473630">Y</span><span class="op" id="7473631">;</span>&nbsp;<span class="ident" id="7473633">y</span>&nbsp;<span class="op" id="7473635">&lt;</span>&nbsp;<span class="ident" id="7473637">bo</span><span class="op" id="7473639">.</span><span class="ident" id="7473640">Max</span><span class="op" id="7473643">.</span><span class="ident" id="7473644">Y</span><span class="op" id="7473645">;</span>&nbsp;<span class="ident" id="7473647">y</span><span class="op" id="7473648">++</span>&nbsp;<span class="op" id="7473651">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473655">for</span>&nbsp;<span class="ident" id="7473659">x</span>&nbsp;<span class="op" id="7473661">:=</span>&nbsp;<span class="ident" id="7473664">bo</span><span class="op" id="7473666">.</span><span class="ident" id="7473667">Min</span><span class="op" id="7473670">.</span><span class="ident" id="7473671">X</span><span class="op" id="7473672">;</span>&nbsp;<span class="ident" id="7473674">x</span>&nbsp;<span class="op" id="7473676">&lt;</span>&nbsp;<span class="ident" id="7473678">bo</span><span class="op" id="7473680">.</span><span class="ident" id="7473681">Max</span><span class="op" id="7473684">.</span><span class="ident" id="7473685">X</span><span class="op" id="7473686">;</span>&nbsp;<span class="ident" id="7473688">x</span><span class="op" id="7473689">++</span>&nbsp;<span class="op" id="7473692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473697">img</span><span class="op" id="7473700">.</span><span class="ident" id="7473701">Set</span><span class="op" id="7473704">(</span><span class="ident" id="7473705">x</span><span class="op" id="7473706">,</span>&nbsp;<span class="ident" id="7473708">y</span><span class="op" id="7473709">,</span>&nbsp;<span class="ident" id="7473711">palette</span><span class="op" id="7473718">[</span><span class="ident" id="7473719">rnd</span><span class="op" id="7473722">.</span><span class="ident" id="7473723">Intn</span><span class="op" id="7473727">(</span><span class="num" id="7473728">256</span><span class="op" id="7473731">)</span><span class="op" id="7473732">]</span><span class="op" id="7473733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7473737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7473740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473744">b</span><span class="op" id="7473745">.</span><span class="ident" id="7473746">SetBytes</span><span class="op" id="7473754">(</span><span class="num" id="7473755">640</span>&nbsp;<span class="op" id="7473759">*</span>&nbsp;<span class="num" id="7473761">480</span>&nbsp;<span class="op" id="7473765">*</span>&nbsp;<span class="num" id="7473767">4</span><span class="op" id="7473768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473771">b</span><span class="op" id="7473772">.</span><span class="ident" id="7473773">StartTimer</span><span class="op" id="7473783">(</span><span class="op" id="7473784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473787">for</span>&nbsp;<span class="ident" id="7473791">i</span>&nbsp;<span class="op" id="7473793">:=</span>&nbsp;<span class="num" id="7473796">0</span><span class="op" id="7473797">;</span>&nbsp;<span class="ident" id="7473799">i</span>&nbsp;<span class="op" id="7473801">&lt;</span>&nbsp;<span class="ident" id="7473803">b</span><span class="op" id="7473804">.</span><span class="ident" id="7473805">N</span><span class="op" id="7473806">;</span>&nbsp;<span class="ident" id="7473808">i</span><span class="op" id="7473809">++</span>&nbsp;<span class="op" id="7473812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473816">Encode</span><span class="op" id="7473822">(</span><span class="ident" id="7473823">ioutil</span><span class="op" id="7473829">.</span><span class="ident" id="7473830">Discard</span><span class="op" id="7473837">,</span>&nbsp;<span class="ident" id="7473839">img</span><span class="op" id="7473842">,</span>&nbsp;<span class="ident" id="7473844">nil</span><span class="op" id="7473847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7473850">}</span><br>
<span class="lineno">205</span><span class="op" id="7473852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7473855">func</span>&nbsp;<span class="ident" id="7473860">BenchmarkQuantizedEncode</span><span class="op" id="7473884">(</span><span class="ident" id="7473885">b</span>&nbsp;<span class="op" id="7473887">*</span><span class="ident" id="7473888">testing</span><span class="op" id="7473895">.</span><span class="ident" id="7473896">B</span><span class="op" id="7473897">)</span>&nbsp;<span class="op" id="7473899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473902">b</span><span class="op" id="7473903">.</span><span class="ident" id="7473904">StopTimer</span><span class="op" id="7473913">(</span><span class="op" id="7473914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473917">img</span>&nbsp;<span class="op" id="7473921">:=</span>&nbsp;<span class="ident" id="7473924">image</span><span class="op" id="7473929">.</span><span class="ident" id="7473930">NewRGBA</span><span class="op" id="7473937">(</span><span class="ident" id="7473938">image</span><span class="op" id="7473943">.</span><span class="ident" id="7473944">Rect</span><span class="op" id="7473948">(</span><span class="num" id="7473949">0</span><span class="op" id="7473950">,</span>&nbsp;<span class="num" id="7473952">0</span><span class="op" id="7473953">,</span>&nbsp;<span class="num" id="7473955">640</span><span class="op" id="7473958">,</span>&nbsp;<span class="num" id="7473960">480</span><span class="op" id="7473963">)</span><span class="op" id="7473964">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473967">bo</span>&nbsp;<span class="op" id="7473970">:=</span>&nbsp;<span class="ident" id="7473973">img</span><span class="op" id="7473976">.</span><span class="ident" id="7473977">Bounds</span><span class="op" id="7473983">(</span><span class="op" id="7473984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473987">rnd</span>&nbsp;<span class="op" id="7473991">:=</span>&nbsp;<span class="ident" id="7473994">rand</span><span class="op" id="7473998">.</span><span class="ident" id="7473999">New</span><span class="op" id="7474002">(</span><span class="ident" id="7474003">rand</span><span class="op" id="7474007">.</span><span class="ident" id="7474008">NewSource</span><span class="op" id="7474017">(</span><span class="num" id="7474018">123</span><span class="op" id="7474021">)</span><span class="op" id="7474022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7474025">for</span>&nbsp;<span class="ident" id="7474029">y</span>&nbsp;<span class="op" id="7474031">:=</span>&nbsp;<span class="ident" id="7474034">bo</span><span class="op" id="7474036">.</span><span class="ident" id="7474037">Min</span><span class="op" id="7474040">.</span><span class="ident" id="7474041">Y</span><span class="op" id="7474042">;</span>&nbsp;<span class="ident" id="7474044">y</span>&nbsp;<span class="op" id="7474046">&lt;</span>&nbsp;<span class="ident" id="7474048">bo</span><span class="op" id="7474050">.</span><span class="ident" id="7474051">Max</span><span class="op" id="7474054">.</span><span class="ident" id="7474055">Y</span><span class="op" id="7474056">;</span>&nbsp;<span class="ident" id="7474058">y</span><span class="op" id="7474059">++</span>&nbsp;<span class="op" id="7474062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7474066">for</span>&nbsp;<span class="ident" id="7474070">x</span>&nbsp;<span class="op" id="7474072">:=</span>&nbsp;<span class="ident" id="7474075">bo</span><span class="op" id="7474077">.</span><span class="ident" id="7474078">Min</span><span class="op" id="7474081">.</span><span class="ident" id="7474082">X</span><span class="op" id="7474083">;</span>&nbsp;<span class="ident" id="7474085">x</span>&nbsp;<span class="op" id="7474087">&lt;</span>&nbsp;<span class="ident" id="7474089">bo</span><span class="op" id="7474091">.</span><span class="ident" id="7474092">Max</span><span class="op" id="7474095">.</span><span class="ident" id="7474096">X</span><span class="op" id="7474097">;</span>&nbsp;<span class="ident" id="7474099">x</span><span class="op" id="7474100">++</span>&nbsp;<span class="op" id="7474103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474108">img</span><span class="op" id="7474111">.</span><span class="ident" id="7474112">SetRGBA</span><span class="op" id="7474119">(</span><span class="ident" id="7474120">x</span><span class="op" id="7474121">,</span>&nbsp;<span class="ident" id="7474123">y</span><span class="op" id="7474124">,</span>&nbsp;<span class="ident" id="7474126">color</span><span class="op" id="7474131">.</span><span class="ident" id="7474132">RGBA</span><span class="op" id="7474136">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7474142">uint8</span><span class="op" id="7474147">(</span><span class="ident" id="7474148">rnd</span><span class="op" id="7474151">.</span><span class="ident" id="7474152">Intn</span><span class="op" id="7474156">(</span><span class="num" id="7474157">256</span><span class="op" id="7474160">)</span><span class="op" id="7474161">)</span><span class="op" id="7474162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7474168">uint8</span><span class="op" id="7474173">(</span><span class="ident" id="7474174">rnd</span><span class="op" id="7474177">.</span><span class="ident" id="7474178">Intn</span><span class="op" id="7474182">(</span><span class="num" id="7474183">256</span><span class="op" id="7474186">)</span><span class="op" id="7474187">)</span><span class="op" id="7474188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7474194">uint8</span><span class="op" id="7474199">(</span><span class="ident" id="7474200">rnd</span><span class="op" id="7474203">.</span><span class="ident" id="7474204">Intn</span><span class="op" id="7474208">(</span><span class="num" id="7474209">256</span><span class="op" id="7474212">)</span><span class="op" id="7474213">)</span><span class="op" id="7474214">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7474220">255</span><span class="op" id="7474223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474228">}</span><span class="op" id="7474229">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474239">b</span><span class="op" id="7474240">.</span><span class="ident" id="7474241">SetBytes</span><span class="op" id="7474249">(</span><span class="num" id="7474250">640</span>&nbsp;<span class="op" id="7474254">*</span>&nbsp;<span class="num" id="7474256">480</span>&nbsp;<span class="op" id="7474260">*</span>&nbsp;<span class="num" id="7474262">4</span><span class="op" id="7474263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474266">b</span><span class="op" id="7474267">.</span><span class="ident" id="7474268">StartTimer</span><span class="op" id="7474278">(</span><span class="op" id="7474279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7474282">for</span>&nbsp;<span class="ident" id="7474286">i</span>&nbsp;<span class="op" id="7474288">:=</span>&nbsp;<span class="num" id="7474291">0</span><span class="op" id="7474292">;</span>&nbsp;<span class="ident" id="7474294">i</span>&nbsp;<span class="op" id="7474296">&lt;</span>&nbsp;<span class="ident" id="7474298">b</span><span class="op" id="7474299">.</span><span class="ident" id="7474300">N</span><span class="op" id="7474301">;</span>&nbsp;<span class="ident" id="7474303">i</span><span class="op" id="7474304">++</span>&nbsp;<span class="op" id="7474307">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474311">Encode</span><span class="op" id="7474317">(</span><span class="ident" id="7474318">ioutil</span><span class="op" id="7474324">.</span><span class="ident" id="7474325">Discard</span><span class="op" id="7474332">,</span>&nbsp;<span class="ident" id="7474334">img</span><span class="op" id="7474337">,</span>&nbsp;<span class="ident" id="7474339">nil</span><span class="op" id="7474342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474345">}</span><br>
<span class="lineno"></span><span class="op" id="7474347">}</span>
</div>
</body>
</html>
