<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html" class="current">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5976908">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5976963">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5977017">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5977068">//&nbsp;Package&nbsp;tar&nbsp;implements&nbsp;access&nbsp;to&nbsp;tar&nbsp;archives.</span><br>
<span class="lineno"></span><span class="comment" id="5977118">//&nbsp;It&nbsp;aims&nbsp;to&nbsp;cover&nbsp;most&nbsp;of&nbsp;the&nbsp;variations,&nbsp;including&nbsp;those&nbsp;produced</span><br>
<span class="lineno"></span><span class="comment" id="5977187">//&nbsp;by&nbsp;GNU&nbsp;and&nbsp;BSD&nbsp;tars.</span><br>
<span class="lineno"></span><span class="comment" id="5977211">//</span><br>
<span class="lineno"></span><span class="comment" id="5977214">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="5977229">//&nbsp;&nbsp;&nbsp;http://www.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=5</span><br>
<span class="lineno"></span><span class="comment" id="5977289">//&nbsp;&nbsp;&nbsp;http://www.gnu.org/software/tar/manual/html_node/Standard.html</span><br>
<span class="lineno"></span><span class="comment" id="5977357">//&nbsp;&nbsp;&nbsp;http://pubs.opengroup.org/onlinepubs/9699919799/utilities/pax.html</span><br>
<span class="lineno"></span><span class="keyword" id="5977429">package</span>&nbsp;<span class="ident" id="5977437">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5977442">import</span>&nbsp;<span class="op" id="5977449">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5977452">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5977461">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5977471">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5977478">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5977484">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5977492">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5977499">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5977502">const</span>&nbsp;<span class="op" id="5977508">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977511">blockSize</span>&nbsp;<span class="op" id="5977521">=</span>&nbsp;<span class="num" id="5977523">512</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5977529">//&nbsp;Types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977539">TypeReg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5977557">=</span>&nbsp;<span class="string" id="5977559">&#39;0&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5977566">//&nbsp;regular&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977583">TypeRegA</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5977601">=</span>&nbsp;<span class="string" id="5977603">&#39;\x00&#39;</span>&nbsp;<span class="comment" id="5977610">//&nbsp;regular&nbsp;file</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977627">TypeLink</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5977645">=</span>&nbsp;<span class="string" id="5977647">&#39;1&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5977654">//&nbsp;hard&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977668">TypeSymlink</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5977686">=</span>&nbsp;<span class="string" id="5977688">&#39;2&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5977695">//&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977713">TypeChar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5977731">=</span>&nbsp;<span class="string" id="5977733">&#39;3&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5977740">//&nbsp;character&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977766">TypeBlock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5977784">=</span>&nbsp;<span class="string" id="5977786">&#39;4&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5977793">//&nbsp;block&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977815">TypeDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5977833">=</span>&nbsp;<span class="string" id="5977835">&#39;5&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5977842">//&nbsp;directory</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977856">TypeFifo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5977874">=</span>&nbsp;<span class="string" id="5977876">&#39;6&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5977883">//&nbsp;fifo&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977897">TypeCont</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5977915">=</span>&nbsp;<span class="string" id="5977917">&#39;7&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5977924">//&nbsp;reserved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977937">TypeXHeader</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5977955">=</span>&nbsp;<span class="string" id="5977957">&#39;x&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5977964">//&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977984">TypeXGlobalHeader</span>&nbsp;<span class="op" id="5978002">=</span>&nbsp;<span class="string" id="5978004">&#39;g&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5978011">//&nbsp;global&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978038">TypeGNULongName</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5978056">=</span>&nbsp;<span class="string" id="5978058">&#39;L&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5978065">//&nbsp;Next&nbsp;file&nbsp;has&nbsp;a&nbsp;long&nbsp;name</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978095">TypeGNULongLink</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5978113">=</span>&nbsp;<span class="string" id="5978115">&#39;K&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5978122">//&nbsp;Next&nbsp;file&nbsp;symlinks&nbsp;to&nbsp;a&nbsp;file&nbsp;w/&nbsp;a&nbsp;long&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978170">TypeGNUSparse</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5978188">=</span>&nbsp;<span class="string" id="5978190">&#39;S&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5978197">//&nbsp;sparse&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="5978212">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5978215">//&nbsp;A&nbsp;Header&nbsp;represents&nbsp;a&nbsp;single&nbsp;header&nbsp;in&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno">45</span><span class="comment" id="5978272">//&nbsp;Some&nbsp;fields&nbsp;may&nbsp;not&nbsp;be&nbsp;populated.</span><br>
<span class="lineno"></span><span class="keyword" id="5978309">type</span>&nbsp;<span class="ident" id="5978314">Header</span>&nbsp;<span class="keyword" id="5978321">struct</span>&nbsp;<span class="op" id="5978328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978331">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5978342">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5978352">//&nbsp;name&nbsp;of&nbsp;header&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978382">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978393">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5978403">//&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978432">Uid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5978443">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5978453">//&nbsp;user&nbsp;id&nbsp;of&nbsp;owner</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978474">Gid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5978485">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5978495">//&nbsp;group&nbsp;id&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978517">Size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978528">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5978538">//&nbsp;length&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978558">ModTime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5978569">time</span><span class="op" id="5978573">.</span><span class="ident" id="5978574">Time</span>&nbsp;<span class="comment" id="5978579">//&nbsp;modified&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978597">Typeflag</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5978608">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5978618">//&nbsp;type&nbsp;of&nbsp;header&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978643">Linkname</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5978654">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5978664">//&nbsp;target&nbsp;name&nbsp;of&nbsp;link</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978688">Uname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5978699">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5978709">//&nbsp;user&nbsp;name&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978732">Gname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5978743">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5978753">//&nbsp;group&nbsp;name&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978777">Devmajor</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5978788">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5978798">//&nbsp;major&nbsp;number&nbsp;of&nbsp;character&nbsp;or&nbsp;block&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978844">Devminor</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5978855">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5978865">//&nbsp;minor&nbsp;number&nbsp;of&nbsp;character&nbsp;or&nbsp;block&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978911">AccessTime</span>&nbsp;<span class="ident" id="5978922">time</span><span class="op" id="5978926">.</span><span class="ident" id="5978927">Time</span>&nbsp;<span class="comment" id="5978932">//&nbsp;access&nbsp;time</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978948">ChangeTime</span>&nbsp;<span class="ident" id="5978959">time</span><span class="op" id="5978963">.</span><span class="ident" id="5978964">Time</span>&nbsp;<span class="comment" id="5978969">//&nbsp;status&nbsp;change&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978992">Xattrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5979003">map</span><span class="op" id="5979006">[</span><span class="builtintype" id="5979007">string</span><span class="op" id="5979013">]</span><span class="builtintype" id="5979014">string</span><br>
<span class="lineno"></span><span class="op" id="5979021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5979024">//&nbsp;File&nbsp;name&nbsp;constants&nbsp;from&nbsp;the&nbsp;tar&nbsp;spec.</span><br>
<span class="lineno">65</span><span class="keyword" id="5979066">const</span>&nbsp;<span class="op" id="5979072">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979075">fileNameSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5979094">=</span>&nbsp;<span class="num" id="5979096">100</span>&nbsp;<span class="comment" id="5979100">//&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;a&nbsp;standard&nbsp;tar&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979152">fileNamePrefixSize</span>&nbsp;<span class="op" id="5979171">=</span>&nbsp;<span class="num" id="5979173">155</span>&nbsp;<span class="comment" id="5979177">//&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;ustar&nbsp;extension&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="op" id="5979221">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="5979224">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;Header.</span><br>
<span class="lineno"></span><span class="keyword" id="5979275">func</span>&nbsp;<span class="op" id="5979280">(</span><span class="ident" id="5979281">h</span>&nbsp;<span class="op" id="5979283">*</span><span class="ident" id="5979284">Header</span><span class="op" id="5979290">)</span>&nbsp;<span class="ident" id="5979292">FileInfo</span><span class="op" id="5979300">(</span><span class="op" id="5979301">)</span>&nbsp;<span class="ident" id="5979303">os</span><span class="op" id="5979305">.</span><span class="ident" id="5979306">FileInfo</span>&nbsp;<span class="op" id="5979315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979318">return</span>&nbsp;<span class="ident" id="5979325">headerFileInfo</span><span class="op" id="5979339">{</span><span class="ident" id="5979340">h</span><span class="op" id="5979341">}</span><br>
<span class="lineno"></span><span class="op" id="5979343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="5979346">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="5979388">type</span>&nbsp;<span class="ident" id="5979393">headerFileInfo</span>&nbsp;<span class="keyword" id="5979408">struct</span>&nbsp;<span class="op" id="5979415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979418">h</span>&nbsp;<span class="op" id="5979420">*</span><span class="ident" id="5979421">Header</span><br>
<span class="lineno"></span><span class="op" id="5979428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="5979431">func</span>&nbsp;<span class="op" id="5979436">(</span><span class="ident" id="5979437">fi</span>&nbsp;<span class="ident" id="5979440">headerFileInfo</span><span class="op" id="5979454">)</span>&nbsp;<span class="ident" id="5979456">Size</span><span class="op" id="5979460">(</span><span class="op" id="5979461">)</span>&nbsp;<span class="ident" id="5979463">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5979476">{</span>&nbsp;<span class="keyword" id="5979478">return</span>&nbsp;<span class="ident" id="5979485">fi</span><span class="op" id="5979487">.</span><span class="ident" id="5979488">h</span><span class="op" id="5979489">.</span><span class="ident" id="5979490">Size</span>&nbsp;<span class="op" id="5979495">}</span><br>
<span class="lineno"></span><span class="keyword" id="5979497">func</span>&nbsp;<span class="op" id="5979502">(</span><span class="ident" id="5979503">fi</span>&nbsp;<span class="ident" id="5979506">headerFileInfo</span><span class="op" id="5979520">)</span>&nbsp;<span class="ident" id="5979522">IsDir</span><span class="op" id="5979527">(</span><span class="op" id="5979528">)</span>&nbsp;<span class="builtintype" id="5979530">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5979542">{</span>&nbsp;<span class="keyword" id="5979544">return</span>&nbsp;<span class="ident" id="5979551">fi</span><span class="op" id="5979553">.</span><span class="ident" id="5979554">Mode</span><span class="op" id="5979558">(</span><span class="op" id="5979559">)</span><span class="op" id="5979560">.</span><span class="ident" id="5979561">IsDir</span><span class="op" id="5979566">(</span><span class="op" id="5979567">)</span>&nbsp;<span class="op" id="5979569">}</span><br>
<span class="lineno"></span><span class="keyword" id="5979571">func</span>&nbsp;<span class="op" id="5979576">(</span><span class="ident" id="5979577">fi</span>&nbsp;<span class="ident" id="5979580">headerFileInfo</span><span class="op" id="5979594">)</span>&nbsp;<span class="ident" id="5979596">ModTime</span><span class="op" id="5979603">(</span><span class="op" id="5979604">)</span>&nbsp;<span class="ident" id="5979606">time</span><span class="op" id="5979610">.</span><span class="ident" id="5979611">Time</span>&nbsp;<span class="op" id="5979616">{</span>&nbsp;<span class="keyword" id="5979618">return</span>&nbsp;<span class="ident" id="5979625">fi</span><span class="op" id="5979627">.</span><span class="ident" id="5979628">h</span><span class="op" id="5979629">.</span><span class="ident" id="5979630">ModTime</span>&nbsp;<span class="op" id="5979638">}</span><br>
<span class="lineno"></span><span class="keyword" id="5979640">func</span>&nbsp;<span class="op" id="5979645">(</span><span class="ident" id="5979646">fi</span>&nbsp;<span class="ident" id="5979649">headerFileInfo</span><span class="op" id="5979663">)</span>&nbsp;<span class="ident" id="5979665">Sys</span><span class="op" id="5979668">(</span><span class="op" id="5979669">)</span>&nbsp;<span class="keyword" id="5979671">interface</span><span class="op" id="5979680">{</span><span class="op" id="5979681">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5979685">{</span>&nbsp;<span class="keyword" id="5979687">return</span>&nbsp;<span class="ident" id="5979694">fi</span><span class="op" id="5979696">.</span><span class="ident" id="5979697">h</span>&nbsp;<span class="op" id="5979699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5979702">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;base&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5979745">func</span>&nbsp;<span class="op" id="5979750">(</span><span class="ident" id="5979751">fi</span>&nbsp;<span class="ident" id="5979754">headerFileInfo</span><span class="op" id="5979768">)</span>&nbsp;<span class="ident" id="5979770">Name</span><span class="op" id="5979774">(</span><span class="op" id="5979775">)</span>&nbsp;<span class="builtintype" id="5979777">string</span>&nbsp;<span class="op" id="5979784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979787">if</span>&nbsp;<span class="ident" id="5979790">fi</span><span class="op" id="5979792">.</span><span class="ident" id="5979793">IsDir</span><span class="op" id="5979798">(</span><span class="op" id="5979799">)</span>&nbsp;<span class="op" id="5979801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979805">return</span>&nbsp;<span class="ident" id="5979812">path</span><span class="op" id="5979816">.</span><span class="ident" id="5979817">Base</span><span class="op" id="5979821">(</span><span class="ident" id="5979822">path</span><span class="op" id="5979826">.</span><span class="ident" id="5979827">Clean</span><span class="op" id="5979832">(</span><span class="ident" id="5979833">fi</span><span class="op" id="5979835">.</span><span class="ident" id="5979836">h</span><span class="op" id="5979837">.</span><span class="ident" id="5979838">Name</span><span class="op" id="5979842">)</span><span class="op" id="5979843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5979846">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979849">return</span>&nbsp;<span class="ident" id="5979856">path</span><span class="op" id="5979860">.</span><span class="ident" id="5979861">Base</span><span class="op" id="5979865">(</span><span class="ident" id="5979866">fi</span><span class="op" id="5979868">.</span><span class="ident" id="5979869">h</span><span class="op" id="5979870">.</span><span class="ident" id="5979871">Name</span><span class="op" id="5979875">)</span><br>
<span class="lineno"></span><span class="op" id="5979877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5979880">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;headerFileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="5979949">func</span>&nbsp;<span class="op" id="5979954">(</span><span class="ident" id="5979955">fi</span>&nbsp;<span class="ident" id="5979958">headerFileInfo</span><span class="op" id="5979972">)</span>&nbsp;<span class="ident" id="5979974">Mode</span><span class="op" id="5979978">(</span><span class="op" id="5979979">)</span>&nbsp;<span class="op" id="5979981">(</span><span class="ident" id="5979982">mode</span>&nbsp;<span class="ident" id="5979987">os</span><span class="op" id="5979989">.</span><span class="ident" id="5979990">FileMode</span><span class="op" id="5979998">)</span>&nbsp;<span class="op" id="5980000">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980003">//&nbsp;Set&nbsp;file&nbsp;permission&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980033">mode</span>&nbsp;<span class="op" id="5980038">=</span>&nbsp;<span class="ident" id="5980040">os</span><span class="op" id="5980042">.</span><span class="ident" id="5980043">FileMode</span><span class="op" id="5980051">(</span><span class="ident" id="5980052">fi</span><span class="op" id="5980054">.</span><span class="ident" id="5980055">h</span><span class="op" id="5980056">.</span><span class="ident" id="5980057">Mode</span><span class="op" id="5980061">)</span><span class="op" id="5980062">.</span><span class="ident" id="5980063">Perm</span><span class="op" id="5980067">(</span><span class="op" id="5980068">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980072">//&nbsp;Set&nbsp;setuid,&nbsp;setgid&nbsp;and&nbsp;sticky&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980112">if</span>&nbsp;<span class="ident" id="5980115">fi</span><span class="op" id="5980117">.</span><span class="ident" id="5980118">h</span><span class="op" id="5980119">.</span><span class="ident" id="5980120">Mode</span><span class="op" id="5980124">&amp;</span><span class="ident" id="5980125">c_ISUID</span>&nbsp;<span class="op" id="5980133">!=</span>&nbsp;<span class="num" id="5980136">0</span>&nbsp;<span class="op" id="5980138">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980142">//&nbsp;setuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980154">mode</span>&nbsp;<span class="op" id="5980159">|=</span>&nbsp;<span class="ident" id="5980162">os</span><span class="op" id="5980164">.</span><span class="ident" id="5980165">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980180">if</span>&nbsp;<span class="ident" id="5980183">fi</span><span class="op" id="5980185">.</span><span class="ident" id="5980186">h</span><span class="op" id="5980187">.</span><span class="ident" id="5980188">Mode</span><span class="op" id="5980192">&amp;</span><span class="ident" id="5980193">c_ISGID</span>&nbsp;<span class="op" id="5980201">!=</span>&nbsp;<span class="num" id="5980204">0</span>&nbsp;<span class="op" id="5980206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980210">//&nbsp;setgid</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980222">mode</span>&nbsp;<span class="op" id="5980227">|=</span>&nbsp;<span class="ident" id="5980230">os</span><span class="op" id="5980232">.</span><span class="ident" id="5980233">ModeSetgid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980248">if</span>&nbsp;<span class="ident" id="5980251">fi</span><span class="op" id="5980253">.</span><span class="ident" id="5980254">h</span><span class="op" id="5980255">.</span><span class="ident" id="5980256">Mode</span><span class="op" id="5980260">&amp;</span><span class="ident" id="5980261">c_ISVTX</span>&nbsp;<span class="op" id="5980269">!=</span>&nbsp;<span class="num" id="5980272">0</span>&nbsp;<span class="op" id="5980274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980278">//&nbsp;sticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980290">mode</span>&nbsp;<span class="op" id="5980295">|=</span>&nbsp;<span class="ident" id="5980298">os</span><span class="op" id="5980300">.</span><span class="ident" id="5980301">ModeSticky</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980317">//&nbsp;Set&nbsp;file&nbsp;mode&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980341">//&nbsp;clear&nbsp;perm,&nbsp;setuid,&nbsp;setgid&nbsp;and&nbsp;sticky&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980389">m</span>&nbsp;<span class="op" id="5980391">:=</span>&nbsp;<span class="ident" id="5980394">os</span><span class="op" id="5980396">.</span><span class="ident" id="5980397">FileMode</span><span class="op" id="5980405">(</span><span class="ident" id="5980406">fi</span><span class="op" id="5980408">.</span><span class="ident" id="5980409">h</span><span class="op" id="5980410">.</span><span class="ident" id="5980411">Mode</span><span class="op" id="5980415">)</span>&nbsp;<span class="op" id="5980417">&amp;^</span>&nbsp;<span class="num" id="5980420">07777</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980427">if</span>&nbsp;<span class="ident" id="5980430">m</span>&nbsp;<span class="op" id="5980432">==</span>&nbsp;<span class="ident" id="5980435">c_ISDIR</span>&nbsp;<span class="op" id="5980443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980447">//&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980462">mode</span>&nbsp;<span class="op" id="5980467">|=</span>&nbsp;<span class="ident" id="5980470">os</span><span class="op" id="5980472">.</span><span class="ident" id="5980473">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980485">if</span>&nbsp;<span class="ident" id="5980488">m</span>&nbsp;<span class="op" id="5980490">==</span>&nbsp;<span class="ident" id="5980493">c_ISFIFO</span>&nbsp;<span class="op" id="5980502">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980506">//&nbsp;named&nbsp;pipe&nbsp;(FIFO)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980529">mode</span>&nbsp;<span class="op" id="5980534">|=</span>&nbsp;<span class="ident" id="5980537">os</span><span class="op" id="5980539">.</span><span class="ident" id="5980540">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980558">if</span>&nbsp;<span class="ident" id="5980561">m</span>&nbsp;<span class="op" id="5980563">==</span>&nbsp;<span class="ident" id="5980566">c_ISLNK</span>&nbsp;<span class="op" id="5980574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980578">//&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980597">mode</span>&nbsp;<span class="op" id="5980602">|=</span>&nbsp;<span class="ident" id="5980605">os</span><span class="op" id="5980607">.</span><span class="ident" id="5980608">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980624">if</span>&nbsp;<span class="ident" id="5980627">m</span>&nbsp;<span class="op" id="5980629">==</span>&nbsp;<span class="ident" id="5980632">c_ISBLK</span>&nbsp;<span class="op" id="5980640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980644">//&nbsp;device&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980661">mode</span>&nbsp;<span class="op" id="5980666">|=</span>&nbsp;<span class="ident" id="5980669">os</span><span class="op" id="5980671">.</span><span class="ident" id="5980672">ModeDevice</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980687">if</span>&nbsp;<span class="ident" id="5980690">m</span>&nbsp;<span class="op" id="5980692">==</span>&nbsp;<span class="ident" id="5980695">c_ISCHR</span>&nbsp;<span class="op" id="5980703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980707">//&nbsp;Unix&nbsp;character&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980734">mode</span>&nbsp;<span class="op" id="5980739">|=</span>&nbsp;<span class="ident" id="5980742">os</span><span class="op" id="5980744">.</span><span class="ident" id="5980745">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980758">mode</span>&nbsp;<span class="op" id="5980763">|=</span>&nbsp;<span class="ident" id="5980766">os</span><span class="op" id="5980768">.</span><span class="ident" id="5980769">ModeCharDevice</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980788">if</span>&nbsp;<span class="ident" id="5980791">m</span>&nbsp;<span class="op" id="5980793">==</span>&nbsp;<span class="ident" id="5980796">c_ISSOCK</span>&nbsp;<span class="op" id="5980805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980809">//&nbsp;Unix&nbsp;domain&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980833">mode</span>&nbsp;<span class="op" id="5980838">|=</span>&nbsp;<span class="ident" id="5980841">os</span><span class="op" id="5980843">.</span><span class="ident" id="5980844">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980856">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980860">switch</span>&nbsp;<span class="ident" id="5980867">fi</span><span class="op" id="5980869">.</span><span class="ident" id="5980870">h</span><span class="op" id="5980871">.</span><span class="ident" id="5980872">Typeflag</span>&nbsp;<span class="op" id="5980881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980884">case</span>&nbsp;<span class="ident" id="5980889">TypeLink</span><span class="op" id="5980897">,</span>&nbsp;<span class="ident" id="5980899">TypeSymlink</span><span class="op" id="5980910">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980914">//&nbsp;hard&nbsp;link,&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980944">mode</span>&nbsp;<span class="op" id="5980949">|=</span>&nbsp;<span class="ident" id="5980952">os</span><span class="op" id="5980954">.</span><span class="ident" id="5980955">ModeSymlink</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980968">case</span>&nbsp;<span class="ident" id="5980973">TypeChar</span><span class="op" id="5980981">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980985">//&nbsp;character&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981012">mode</span>&nbsp;<span class="op" id="5981017">|=</span>&nbsp;<span class="ident" id="5981020">os</span><span class="op" id="5981022">.</span><span class="ident" id="5981023">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981036">mode</span>&nbsp;<span class="op" id="5981041">|=</span>&nbsp;<span class="ident" id="5981044">os</span><span class="op" id="5981046">.</span><span class="ident" id="5981047">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981063">case</span>&nbsp;<span class="ident" id="5981068">TypeBlock</span><span class="op" id="5981077">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5981081">//&nbsp;block&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981104">mode</span>&nbsp;<span class="op" id="5981109">|=</span>&nbsp;<span class="ident" id="5981112">os</span><span class="op" id="5981114">.</span><span class="ident" id="5981115">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981127">case</span>&nbsp;<span class="ident" id="5981132">TypeDir</span><span class="op" id="5981139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5981143">//&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981158">mode</span>&nbsp;<span class="op" id="5981163">|=</span>&nbsp;<span class="ident" id="5981166">os</span><span class="op" id="5981168">.</span><span class="ident" id="5981169">ModeDir</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981178">case</span>&nbsp;<span class="ident" id="5981183">TypeFifo</span><span class="op" id="5981191">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5981195">//&nbsp;fifo&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981210">mode</span>&nbsp;<span class="op" id="5981215">|=</span>&nbsp;<span class="ident" id="5981218">os</span><span class="op" id="5981220">.</span><span class="ident" id="5981221">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981240">return</span>&nbsp;<span class="ident" id="5981247">mode</span><br>
<span class="lineno"></span><span class="op" id="5981252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5981255">//&nbsp;sysStat,&nbsp;if&nbsp;non-nil,&nbsp;populates&nbsp;h&nbsp;from&nbsp;system-dependent&nbsp;fields&nbsp;of&nbsp;fi.</span><br>
<span class="lineno"></span><span class="keyword" id="5981327">var</span>&nbsp;<span class="ident" id="5981331">sysStat</span>&nbsp;<span class="keyword" id="5981339">func</span><span class="op" id="5981343">(</span><span class="ident" id="5981344">fi</span>&nbsp;<span class="ident" id="5981347">os</span><span class="op" id="5981349">.</span><span class="ident" id="5981350">FileInfo</span><span class="op" id="5981358">,</span>&nbsp;<span class="ident" id="5981360">h</span>&nbsp;<span class="op" id="5981362">*</span><span class="ident" id="5981363">Header</span><span class="op" id="5981369">)</span>&nbsp;<span class="builtintype" id="5981371">error</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="5981378">//&nbsp;Mode&nbsp;constants&nbsp;from&nbsp;the&nbsp;tar&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5981415">const</span>&nbsp;<span class="op" id="5981421">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981424">c_ISUID</span>&nbsp;&nbsp;<span class="op" id="5981433">=</span>&nbsp;<span class="num" id="5981435">04000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5981443">//&nbsp;Set&nbsp;uid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981455">c_ISGID</span>&nbsp;&nbsp;<span class="op" id="5981464">=</span>&nbsp;<span class="num" id="5981466">02000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5981474">//&nbsp;Set&nbsp;gid</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981486">c_ISVTX</span>&nbsp;&nbsp;<span class="op" id="5981495">=</span>&nbsp;<span class="num" id="5981497">01000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5981505">//&nbsp;Save&nbsp;text&nbsp;(sticky&nbsp;bit)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981532">c_ISDIR</span>&nbsp;&nbsp;<span class="op" id="5981541">=</span>&nbsp;<span class="num" id="5981543">040000</span>&nbsp;&nbsp;<span class="comment" id="5981551">//&nbsp;Directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981565">c_ISFIFO</span>&nbsp;<span class="op" id="5981574">=</span>&nbsp;<span class="num" id="5981576">010000</span>&nbsp;&nbsp;<span class="comment" id="5981584">//&nbsp;FIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981593">c_ISREG</span>&nbsp;&nbsp;<span class="op" id="5981602">=</span>&nbsp;<span class="num" id="5981604">0100000</span>&nbsp;<span class="comment" id="5981612">//&nbsp;Regular&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981629">c_ISLNK</span>&nbsp;&nbsp;<span class="op" id="5981638">=</span>&nbsp;<span class="num" id="5981640">0120000</span>&nbsp;<span class="comment" id="5981648">//&nbsp;Symbolic&nbsp;link</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981666">c_ISBLK</span>&nbsp;&nbsp;<span class="op" id="5981675">=</span>&nbsp;<span class="num" id="5981677">060000</span>&nbsp;&nbsp;<span class="comment" id="5981685">//&nbsp;Block&nbsp;special&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981708">c_ISCHR</span>&nbsp;&nbsp;<span class="op" id="5981717">=</span>&nbsp;<span class="num" id="5981719">020000</span>&nbsp;&nbsp;<span class="comment" id="5981727">//&nbsp;Character&nbsp;special&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981754">c_ISSOCK</span>&nbsp;<span class="op" id="5981763">=</span>&nbsp;<span class="num" id="5981765">0140000</span>&nbsp;<span class="comment" id="5981773">//&nbsp;Socket</span><br>
<span class="lineno"></span><span class="op" id="5981783">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="5981786">//&nbsp;Keywords&nbsp;for&nbsp;the&nbsp;PAX&nbsp;Extended&nbsp;Header</span><br>
<span class="lineno"></span><span class="keyword" id="5981826">const</span>&nbsp;<span class="op" id="5981832">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981835">paxAtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5981847">=</span>&nbsp;<span class="string" id="5981849">&#34;atime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981858">paxCharset</span>&nbsp;&nbsp;<span class="op" id="5981870">=</span>&nbsp;<span class="string" id="5981872">&#34;charset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981883">paxComment</span>&nbsp;&nbsp;<span class="op" id="5981895">=</span>&nbsp;<span class="string" id="5981897">&#34;comment&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981908">paxCtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5981920">=</span>&nbsp;<span class="string" id="5981922">&#34;ctime&#34;</span>&nbsp;<span class="comment" id="5981930">//&nbsp;please&nbsp;note&nbsp;that&nbsp;ctime&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;pax&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981984">paxGid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5981996">=</span>&nbsp;<span class="string" id="5981998">&#34;gid&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982005">paxGname</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982017">=</span>&nbsp;<span class="string" id="5982019">&#34;gname&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982028">paxLinkpath</span>&nbsp;<span class="op" id="5982040">=</span>&nbsp;<span class="string" id="5982042">&#34;linkpath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982054">paxMtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982066">=</span>&nbsp;<span class="string" id="5982068">&#34;mtime&#34;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982077">paxPath</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982089">=</span>&nbsp;<span class="string" id="5982091">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982099">paxSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982111">=</span>&nbsp;<span class="string" id="5982113">&#34;size&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982121">paxUid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982133">=</span>&nbsp;<span class="string" id="5982135">&#34;uid&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982142">paxUname</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982154">=</span>&nbsp;<span class="string" id="5982156">&#34;uname&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982165">paxXattr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982177">=</span>&nbsp;<span class="string" id="5982179">&#34;SCHILY.xattr.&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982196">paxNone</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5982208">=</span>&nbsp;<span class="string" id="5982210">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="5982213">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5982216">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;Header&nbsp;from&nbsp;fi.</span><br>
<span class="lineno"></span><span class="comment" id="5982280">//&nbsp;If&nbsp;fi&nbsp;describes&nbsp;a&nbsp;symlink,&nbsp;FileInfoHeader&nbsp;records&nbsp;link&nbsp;as&nbsp;the&nbsp;link&nbsp;target.</span><br>
<span class="lineno">200</span><span class="comment" id="5982358">//&nbsp;If&nbsp;fi&nbsp;describes&nbsp;a&nbsp;directory,&nbsp;a&nbsp;slash&nbsp;is&nbsp;appended&nbsp;to&nbsp;the&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="5982423">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5982490">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5982561">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5982630">func</span>&nbsp;<span class="ident" id="5982635">FileInfoHeader</span><span class="op" id="5982649">(</span><span class="ident" id="5982650">fi</span>&nbsp;<span class="ident" id="5982653">os</span><span class="op" id="5982655">.</span><span class="ident" id="5982656">FileInfo</span><span class="op" id="5982664">,</span>&nbsp;<span class="ident" id="5982666">link</span>&nbsp;<span class="builtintype" id="5982671">string</span><span class="op" id="5982677">)</span>&nbsp;<span class="op" id="5982679">(</span><span class="op" id="5982680">*</span><span class="ident" id="5982681">Header</span><span class="op" id="5982687">,</span>&nbsp;<span class="builtintype" id="5982689">error</span><span class="op" id="5982694">)</span>&nbsp;<span class="op" id="5982696">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982699">if</span>&nbsp;<span class="ident" id="5982702">fi</span>&nbsp;<span class="op" id="5982705">==</span>&nbsp;<span class="ident" id="5982708">nil</span>&nbsp;<span class="op" id="5982712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982716">return</span>&nbsp;<span class="ident" id="5982723">nil</span><span class="op" id="5982726">,</span>&nbsp;<span class="ident" id="5982728">errors</span><span class="op" id="5982734">.</span><span class="ident" id="5982735">New</span><span class="op" id="5982738">(</span><span class="string" id="5982739">&#34;tar:&nbsp;FileInfo&nbsp;is&nbsp;nil&#34;</span><span class="op" id="5982761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982767">fm</span>&nbsp;<span class="op" id="5982770">:=</span>&nbsp;<span class="ident" id="5982773">fi</span><span class="op" id="5982775">.</span><span class="ident" id="5982776">Mode</span><span class="op" id="5982780">(</span><span class="op" id="5982781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982784">h</span>&nbsp;<span class="op" id="5982786">:=</span>&nbsp;<span class="op" id="5982789">&amp;</span><span class="ident" id="5982790">Header</span><span class="op" id="5982796">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982800">Name</span><span class="op" id="5982804">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982809">fi</span><span class="op" id="5982811">.</span><span class="ident" id="5982812">Name</span><span class="op" id="5982816">(</span><span class="op" id="5982817">)</span><span class="op" id="5982818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982822">ModTime</span><span class="op" id="5982829">:</span>&nbsp;<span class="ident" id="5982831">fi</span><span class="op" id="5982833">.</span><span class="ident" id="5982834">ModTime</span><span class="op" id="5982841">(</span><span class="op" id="5982842">)</span><span class="op" id="5982843">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982847">Mode</span><span class="op" id="5982851">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5982856">int64</span><span class="op" id="5982861">(</span><span class="ident" id="5982862">fm</span><span class="op" id="5982864">.</span><span class="ident" id="5982865">Perm</span><span class="op" id="5982869">(</span><span class="op" id="5982870">)</span><span class="op" id="5982871">)</span><span class="op" id="5982872">,</span>&nbsp;<span class="comment" id="5982874">//&nbsp;or&#39;d&nbsp;with&nbsp;c_IS*&nbsp;constants&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982913">switch</span>&nbsp;<span class="op" id="5982920">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982923">case</span>&nbsp;<span class="ident" id="5982928">fm</span><span class="op" id="5982930">.</span><span class="ident" id="5982931">IsRegular</span><span class="op" id="5982940">(</span><span class="op" id="5982941">)</span><span class="op" id="5982942">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982946">h</span><span class="op" id="5982947">.</span><span class="ident" id="5982948">Mode</span>&nbsp;<span class="op" id="5982953">|=</span>&nbsp;<span class="ident" id="5982956">c_ISREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982966">h</span><span class="op" id="5982967">.</span><span class="ident" id="5982968">Typeflag</span>&nbsp;<span class="op" id="5982977">=</span>&nbsp;<span class="ident" id="5982979">TypeReg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982989">h</span><span class="op" id="5982990">.</span><span class="ident" id="5982991">Size</span>&nbsp;<span class="op" id="5982996">=</span>&nbsp;<span class="ident" id="5982998">fi</span><span class="op" id="5983000">.</span><span class="ident" id="5983001">Size</span><span class="op" id="5983005">(</span><span class="op" id="5983006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983009">case</span>&nbsp;<span class="ident" id="5983014">fi</span><span class="op" id="5983016">.</span><span class="ident" id="5983017">IsDir</span><span class="op" id="5983022">(</span><span class="op" id="5983023">)</span><span class="op" id="5983024">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983028">h</span><span class="op" id="5983029">.</span><span class="ident" id="5983030">Typeflag</span>&nbsp;<span class="op" id="5983039">=</span>&nbsp;<span class="ident" id="5983041">TypeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983051">h</span><span class="op" id="5983052">.</span><span class="ident" id="5983053">Mode</span>&nbsp;<span class="op" id="5983058">|=</span>&nbsp;<span class="ident" id="5983061">c_ISDIR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983071">h</span><span class="op" id="5983072">.</span><span class="ident" id="5983073">Name</span>&nbsp;<span class="op" id="5983078">+=</span>&nbsp;<span class="string" id="5983081">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983086">case</span>&nbsp;<span class="ident" id="5983091">fm</span><span class="op" id="5983093">&amp;</span><span class="ident" id="5983094">os</span><span class="op" id="5983096">.</span><span class="ident" id="5983097">ModeSymlink</span>&nbsp;<span class="op" id="5983109">!=</span>&nbsp;<span class="num" id="5983112">0</span><span class="op" id="5983113">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983117">h</span><span class="op" id="5983118">.</span><span class="ident" id="5983119">Typeflag</span>&nbsp;<span class="op" id="5983128">=</span>&nbsp;<span class="ident" id="5983130">TypeSymlink</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983144">h</span><span class="op" id="5983145">.</span><span class="ident" id="5983146">Mode</span>&nbsp;<span class="op" id="5983151">|=</span>&nbsp;<span class="ident" id="5983154">c_ISLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983164">h</span><span class="op" id="5983165">.</span><span class="ident" id="5983166">Linkname</span>&nbsp;<span class="op" id="5983175">=</span>&nbsp;<span class="ident" id="5983177">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983183">case</span>&nbsp;<span class="ident" id="5983188">fm</span><span class="op" id="5983190">&amp;</span><span class="ident" id="5983191">os</span><span class="op" id="5983193">.</span><span class="ident" id="5983194">ModeDevice</span>&nbsp;<span class="op" id="5983205">!=</span>&nbsp;<span class="num" id="5983208">0</span><span class="op" id="5983209">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983213">if</span>&nbsp;<span class="ident" id="5983216">fm</span><span class="op" id="5983218">&amp;</span><span class="ident" id="5983219">os</span><span class="op" id="5983221">.</span><span class="ident" id="5983222">ModeCharDevice</span>&nbsp;<span class="op" id="5983237">!=</span>&nbsp;<span class="num" id="5983240">0</span>&nbsp;<span class="op" id="5983242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983247">h</span><span class="op" id="5983248">.</span><span class="ident" id="5983249">Mode</span>&nbsp;<span class="op" id="5983254">|=</span>&nbsp;<span class="ident" id="5983257">c_ISCHR</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983268">h</span><span class="op" id="5983269">.</span><span class="ident" id="5983270">Typeflag</span>&nbsp;<span class="op" id="5983279">=</span>&nbsp;<span class="ident" id="5983281">TypeChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983292">}</span>&nbsp;<span class="keyword" id="5983294">else</span>&nbsp;<span class="op" id="5983299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983304">h</span><span class="op" id="5983305">.</span><span class="ident" id="5983306">Mode</span>&nbsp;<span class="op" id="5983311">|=</span>&nbsp;<span class="ident" id="5983314">c_ISBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983325">h</span><span class="op" id="5983326">.</span><span class="ident" id="5983327">Typeflag</span>&nbsp;<span class="op" id="5983336">=</span>&nbsp;<span class="ident" id="5983338">TypeBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983350">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983353">case</span>&nbsp;<span class="ident" id="5983358">fm</span><span class="op" id="5983360">&amp;</span><span class="ident" id="5983361">os</span><span class="op" id="5983363">.</span><span class="ident" id="5983364">ModeNamedPipe</span>&nbsp;<span class="op" id="5983378">!=</span>&nbsp;<span class="num" id="5983381">0</span><span class="op" id="5983382">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983386">h</span><span class="op" id="5983387">.</span><span class="ident" id="5983388">Typeflag</span>&nbsp;<span class="op" id="5983397">=</span>&nbsp;<span class="ident" id="5983399">TypeFifo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983410">h</span><span class="op" id="5983411">.</span><span class="ident" id="5983412">Mode</span>&nbsp;<span class="op" id="5983417">|=</span>&nbsp;<span class="ident" id="5983420">c_ISFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983430">case</span>&nbsp;<span class="ident" id="5983435">fm</span><span class="op" id="5983437">&amp;</span><span class="ident" id="5983438">os</span><span class="op" id="5983440">.</span><span class="ident" id="5983441">ModeSocket</span>&nbsp;<span class="op" id="5983452">!=</span>&nbsp;<span class="num" id="5983455">0</span><span class="op" id="5983456">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983460">h</span><span class="op" id="5983461">.</span><span class="ident" id="5983462">Mode</span>&nbsp;<span class="op" id="5983467">|=</span>&nbsp;<span class="ident" id="5983470">c_ISSOCK</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983480">default</span><span class="op" id="5983487">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983491">return</span>&nbsp;<span class="ident" id="5983498">nil</span><span class="op" id="5983501">,</span>&nbsp;<span class="ident" id="5983503">fmt</span><span class="op" id="5983506">.</span><span class="ident" id="5983507">Errorf</span><span class="op" id="5983513">(</span><span class="string" id="5983514">&#34;archive/tar:&nbsp;unknown&nbsp;file&nbsp;mode&nbsp;%v&#34;</span><span class="op" id="5983549">,</span>&nbsp;<span class="ident" id="5983551">fm</span><span class="op" id="5983553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983559">if</span>&nbsp;<span class="ident" id="5983562">fm</span><span class="op" id="5983564">&amp;</span><span class="ident" id="5983565">os</span><span class="op" id="5983567">.</span><span class="ident" id="5983568">ModeSetuid</span>&nbsp;<span class="op" id="5983579">!=</span>&nbsp;<span class="num" id="5983582">0</span>&nbsp;<span class="op" id="5983584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983588">h</span><span class="op" id="5983589">.</span><span class="ident" id="5983590">Mode</span>&nbsp;<span class="op" id="5983595">|=</span>&nbsp;<span class="ident" id="5983598">c_ISUID</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983610">if</span>&nbsp;<span class="ident" id="5983613">fm</span><span class="op" id="5983615">&amp;</span><span class="ident" id="5983616">os</span><span class="op" id="5983618">.</span><span class="ident" id="5983619">ModeSetgid</span>&nbsp;<span class="op" id="5983630">!=</span>&nbsp;<span class="num" id="5983633">0</span>&nbsp;<span class="op" id="5983635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983639">h</span><span class="op" id="5983640">.</span><span class="ident" id="5983641">Mode</span>&nbsp;<span class="op" id="5983646">|=</span>&nbsp;<span class="ident" id="5983649">c_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983661">if</span>&nbsp;<span class="ident" id="5983664">fm</span><span class="op" id="5983666">&amp;</span><span class="ident" id="5983667">os</span><span class="op" id="5983669">.</span><span class="ident" id="5983670">ModeSticky</span>&nbsp;<span class="op" id="5983681">!=</span>&nbsp;<span class="num" id="5983684">0</span>&nbsp;<span class="op" id="5983686">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5983690">h</span><span class="op" id="5983691">.</span><span class="ident" id="5983692">Mode</span>&nbsp;<span class="op" id="5983697">|=</span>&nbsp;<span class="ident" id="5983700">c_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983712">if</span>&nbsp;<span class="ident" id="5983715">sysStat</span>&nbsp;<span class="op" id="5983723">!=</span>&nbsp;<span class="ident" id="5983726">nil</span>&nbsp;<span class="op" id="5983730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983734">return</span>&nbsp;<span class="ident" id="5983741">h</span><span class="op" id="5983742">,</span>&nbsp;<span class="ident" id="5983744">sysStat</span><span class="op" id="5983751">(</span><span class="ident" id="5983752">fi</span><span class="op" id="5983754">,</span>&nbsp;<span class="ident" id="5983756">h</span><span class="op" id="5983757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5983760">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5983763">return</span>&nbsp;<span class="ident" id="5983770">h</span><span class="op" id="5983771">,</span>&nbsp;<span class="ident" id="5983773">nil</span><br>
<span class="lineno"></span><span class="op" id="5983777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5983780">var</span>&nbsp;<span class="ident" id="5983784">zeroBlock</span>&nbsp;<span class="op" id="5983794">=</span>&nbsp;<span class="builtinfunc" id="5983796">make</span><span class="op" id="5983800">(</span><span class="op" id="5983801">[</span><span class="op" id="5983802">]</span><span class="builtintype" id="5983803">byte</span><span class="op" id="5983807">,</span>&nbsp;<span class="ident" id="5983809">blockSize</span><span class="op" id="5983818">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="5983821">//&nbsp;POSIX&nbsp;specifies&nbsp;a&nbsp;sum&nbsp;of&nbsp;the&nbsp;unsigned&nbsp;byte&nbsp;values,&nbsp;but&nbsp;the&nbsp;Sun&nbsp;tar&nbsp;uses&nbsp;signed&nbsp;byte&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="5983916">//&nbsp;We&nbsp;compute&nbsp;and&nbsp;return&nbsp;both.</span><br>
<span class="lineno"></span><span class="keyword" id="5983947">func</span>&nbsp;<span class="ident" id="5983952">checksum</span><span class="op" id="5983960">(</span><span class="ident" id="5983961">header</span>&nbsp;<span class="op" id="5983968">[</span><span class="op" id="5983969">]</span><span class="builtintype" id="5983970">byte</span><span class="op" id="5983974">)</span>&nbsp;<span class="op" id="5983976">(</span><span class="ident" id="5983977">unsigned</span>&nbsp;<span class="ident" id="5983986">int64</span><span class="op" id="5983991">,</span>&nbsp;<span class="ident" id="5983993">signed</span>&nbsp;<span class="ident" id="5984000">int64</span><span class="op" id="5984005">)</span>&nbsp;<span class="op" id="5984007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984010">for</span>&nbsp;<span class="ident" id="5984014">i</span>&nbsp;<span class="op" id="5984016">:=</span>&nbsp;<span class="num" id="5984019">0</span><span class="op" id="5984020">;</span>&nbsp;<span class="ident" id="5984022">i</span>&nbsp;<span class="op" id="5984024">&lt;</span>&nbsp;<span class="builtinfunc" id="5984026">len</span><span class="op" id="5984029">(</span><span class="ident" id="5984030">header</span><span class="op" id="5984036">)</span><span class="op" id="5984037">;</span>&nbsp;<span class="ident" id="5984039">i</span><span class="op" id="5984040">++</span>&nbsp;<span class="op" id="5984043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984047">if</span>&nbsp;<span class="ident" id="5984050">i</span>&nbsp;<span class="op" id="5984052">==</span>&nbsp;<span class="num" id="5984055">148</span>&nbsp;<span class="op" id="5984059">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5984064">//&nbsp;The&nbsp;chksum&nbsp;field&nbsp;(header[148:156])&nbsp;is&nbsp;special:&nbsp;it&nbsp;should&nbsp;be&nbsp;treated&nbsp;as&nbsp;space&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984154">unsigned</span>&nbsp;<span class="op" id="5984163">+=</span>&nbsp;<span class="string" id="5984166">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5984170">*</span>&nbsp;<span class="num" id="5984172">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984177">signed</span>&nbsp;<span class="op" id="5984184">+=</span>&nbsp;<span class="string" id="5984187">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5984191">*</span>&nbsp;<span class="num" id="5984193">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984198">i</span>&nbsp;<span class="op" id="5984200">+=</span>&nbsp;<span class="num" id="5984203">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984208">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984223">unsigned</span>&nbsp;<span class="op" id="5984232">+=</span>&nbsp;<span class="ident" id="5984235">int64</span><span class="op" id="5984240">(</span><span class="ident" id="5984241">header</span><span class="op" id="5984247">[</span><span class="ident" id="5984248">i</span><span class="op" id="5984249">]</span><span class="op" id="5984250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984254">signed</span>&nbsp;<span class="op" id="5984261">+=</span>&nbsp;<span class="ident" id="5984264">int64</span><span class="op" id="5984269">(</span><span class="builtintype" id="5984270">int8</span><span class="op" id="5984274">(</span><span class="ident" id="5984275">header</span><span class="op" id="5984281">[</span><span class="ident" id="5984282">i</span><span class="op" id="5984283">]</span><span class="op" id="5984284">)</span><span class="op" id="5984285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984291">return</span><br>
<span class="lineno">275</span><span class="op" id="5984298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5984301">type</span>&nbsp;<span class="ident" id="5984306">slicer</span>&nbsp;<span class="op" id="5984313">[</span><span class="op" id="5984314">]</span><span class="builtintype" id="5984315">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5984321">func</span>&nbsp;<span class="op" id="5984326">(</span><span class="ident" id="5984327">sp</span>&nbsp;<span class="op" id="5984330">*</span><span class="ident" id="5984331">slicer</span><span class="op" id="5984337">)</span>&nbsp;<span class="ident" id="5984339">next</span><span class="op" id="5984343">(</span><span class="ident" id="5984344">n</span>&nbsp;<span class="builtintype" id="5984346">int</span><span class="op" id="5984349">)</span>&nbsp;<span class="op" id="5984351">(</span><span class="ident" id="5984352">b</span>&nbsp;<span class="op" id="5984354">[</span><span class="op" id="5984355">]</span><span class="builtintype" id="5984356">byte</span><span class="op" id="5984360">)</span>&nbsp;<span class="op" id="5984362">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984365">s</span>&nbsp;<span class="op" id="5984367">:=</span>&nbsp;<span class="op" id="5984370">*</span><span class="ident" id="5984371">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984375">b</span><span class="op" id="5984376">,</span>&nbsp;<span class="op" id="5984378">*</span><span class="ident" id="5984379">sp</span>&nbsp;<span class="op" id="5984382">=</span>&nbsp;<span class="ident" id="5984384">s</span><span class="op" id="5984385">[</span><span class="num" id="5984386">0</span><span class="op" id="5984387">:</span><span class="ident" id="5984388">n</span><span class="op" id="5984389">]</span><span class="op" id="5984390">,</span>&nbsp;<span class="ident" id="5984392">s</span><span class="op" id="5984393">[</span><span class="ident" id="5984394">n</span><span class="op" id="5984395">:</span><span class="op" id="5984396">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984399">return</span><br>
<span class="lineno"></span><span class="op" id="5984406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5984409">func</span>&nbsp;<span class="ident" id="5984414">isASCII</span><span class="op" id="5984421">(</span><span class="ident" id="5984422">s</span>&nbsp;<span class="builtintype" id="5984424">string</span><span class="op" id="5984430">)</span>&nbsp;<span class="builtintype" id="5984432">bool</span>&nbsp;<span class="op" id="5984437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984440">for</span>&nbsp;<span class="ident" id="5984444">_</span><span class="op" id="5984445">,</span>&nbsp;<span class="ident" id="5984447">c</span>&nbsp;<span class="op" id="5984449">:=</span>&nbsp;<span class="keyword" id="5984452">range</span>&nbsp;<span class="ident" id="5984458">s</span>&nbsp;<span class="op" id="5984460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984464">if</span>&nbsp;<span class="ident" id="5984467">c</span>&nbsp;<span class="op" id="5984469">&gt;=</span>&nbsp;<span class="num" id="5984472">0x80</span>&nbsp;<span class="op" id="5984477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984482">return</span>&nbsp;<span class="builtintype" id="5984489">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984497">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984503">return</span>&nbsp;<span class="builtintype" id="5984510">true</span><br>
<span class="lineno"></span><span class="op" id="5984515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5984518">func</span>&nbsp;<span class="ident" id="5984523">toASCII</span><span class="op" id="5984530">(</span><span class="ident" id="5984531">s</span>&nbsp;<span class="builtintype" id="5984533">string</span><span class="op" id="5984539">)</span>&nbsp;<span class="builtintype" id="5984541">string</span>&nbsp;<span class="op" id="5984548">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984551">if</span>&nbsp;<span class="ident" id="5984554">isASCII</span><span class="op" id="5984561">(</span><span class="ident" id="5984562">s</span><span class="op" id="5984563">)</span>&nbsp;<span class="op" id="5984565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984569">return</span>&nbsp;<span class="ident" id="5984576">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984582">var</span>&nbsp;<span class="ident" id="5984586">buf</span>&nbsp;<span class="ident" id="5984590">bytes</span><span class="op" id="5984595">.</span><span class="ident" id="5984596">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984604">for</span>&nbsp;<span class="ident" id="5984608">_</span><span class="op" id="5984609">,</span>&nbsp;<span class="ident" id="5984611">c</span>&nbsp;<span class="op" id="5984613">:=</span>&nbsp;<span class="keyword" id="5984616">range</span>&nbsp;<span class="ident" id="5984622">s</span>&nbsp;<span class="op" id="5984624">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984628">if</span>&nbsp;<span class="ident" id="5984631">c</span>&nbsp;<span class="op" id="5984633">&lt;</span>&nbsp;<span class="num" id="5984635">0x80</span>&nbsp;<span class="op" id="5984640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984645">buf</span><span class="op" id="5984648">.</span><span class="ident" id="5984649">WriteByte</span><span class="op" id="5984658">(</span><span class="builtintype" id="5984659">byte</span><span class="op" id="5984663">(</span><span class="ident" id="5984664">c</span><span class="op" id="5984665">)</span><span class="op" id="5984666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5984673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5984676">return</span>&nbsp;<span class="ident" id="5984683">buf</span><span class="op" id="5984686">.</span><span class="ident" id="5984687">String</span><span class="op" id="5984693">(</span><span class="op" id="5984694">)</span><br>
<span class="lineno">305</span><span class="op" id="5984696">}</span>
</div>
</body>
</html>
