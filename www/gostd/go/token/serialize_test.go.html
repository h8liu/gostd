<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html" class="current">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8551734">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8551789">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8551843">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8551894">package</span>&nbsp;<span class="ident" id="8551902">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8551909">import</span>&nbsp;<span class="op" id="8551916">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8551919">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8551928">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8551944">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8551951">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8551961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8551964">//&nbsp;equal&nbsp;returns&nbsp;nil&nbsp;if&nbsp;p&nbsp;and&nbsp;q&nbsp;describe&nbsp;the&nbsp;same&nbsp;file&nbsp;set;</span><br>
<span class="lineno">15</span><span class="comment" id="8552024">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;discrepancy.</span><br>
<span class="lineno"></span><span class="keyword" id="8552085">func</span>&nbsp;<span class="ident" id="8552090">equal</span><span class="op" id="8552095">(</span><span class="ident" id="8552096">p</span><span class="op" id="8552097">,</span>&nbsp;<span class="ident" id="8552099">q</span>&nbsp;<span class="op" id="8552101">*</span><span class="ident" id="8552102">FileSet</span><span class="op" id="8552109">)</span>&nbsp;<span class="builtintype" id="8552111">error</span>&nbsp;<span class="op" id="8552117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552120">if</span>&nbsp;<span class="ident" id="8552123">p</span>&nbsp;<span class="op" id="8552125">==</span>&nbsp;<span class="ident" id="8552128">q</span>&nbsp;<span class="op" id="8552130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8552134">//&nbsp;avoid&nbsp;deadlock&nbsp;if&nbsp;p&nbsp;==&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552164">return</span>&nbsp;<span class="ident" id="8552171">nil</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8552176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8552180">//&nbsp;not&nbsp;strictly&nbsp;needed&nbsp;for&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8552217">p</span><span class="op" id="8552218">.</span><span class="ident" id="8552219">mutex</span><span class="op" id="8552224">.</span><span class="ident" id="8552225">Lock</span><span class="op" id="8552229">(</span><span class="op" id="8552230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8552233">q</span><span class="op" id="8552234">.</span><span class="ident" id="8552235">mutex</span><span class="op" id="8552240">.</span><span class="ident" id="8552241">Lock</span><span class="op" id="8552245">(</span><span class="op" id="8552246">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552249">defer</span>&nbsp;<span class="ident" id="8552255">q</span><span class="op" id="8552256">.</span><span class="ident" id="8552257">mutex</span><span class="op" id="8552262">.</span><span class="ident" id="8552263">Unlock</span><span class="op" id="8552269">(</span><span class="op" id="8552270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552273">defer</span>&nbsp;<span class="ident" id="8552279">p</span><span class="op" id="8552280">.</span><span class="ident" id="8552281">mutex</span><span class="op" id="8552286">.</span><span class="ident" id="8552287">Unlock</span><span class="op" id="8552293">(</span><span class="op" id="8552294">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552298">if</span>&nbsp;<span class="ident" id="8552301">p</span><span class="op" id="8552302">.</span><span class="ident" id="8552303">base</span>&nbsp;<span class="op" id="8552308">!=</span>&nbsp;<span class="ident" id="8552311">q</span><span class="op" id="8552312">.</span><span class="ident" id="8552313">base</span>&nbsp;<span class="op" id="8552318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552322">return</span>&nbsp;<span class="ident" id="8552329">fmt</span><span class="op" id="8552332">.</span><span class="ident" id="8552333">Errorf</span><span class="op" id="8552339">(</span><span class="string" id="8552340">&#34;different&nbsp;bases:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="8552367">,</span>&nbsp;<span class="ident" id="8552369">p</span><span class="op" id="8552370">.</span><span class="ident" id="8552371">base</span><span class="op" id="8552375">,</span>&nbsp;<span class="ident" id="8552377">q</span><span class="op" id="8552378">.</span><span class="ident" id="8552379">base</span><span class="op" id="8552383">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8552386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552390">if</span>&nbsp;<span class="builtinfunc" id="8552393">len</span><span class="op" id="8552396">(</span><span class="ident" id="8552397">p</span><span class="op" id="8552398">.</span><span class="ident" id="8552399">files</span><span class="op" id="8552404">)</span>&nbsp;<span class="op" id="8552406">!=</span>&nbsp;<span class="builtinfunc" id="8552409">len</span><span class="op" id="8552412">(</span><span class="ident" id="8552413">q</span><span class="op" id="8552414">.</span><span class="ident" id="8552415">files</span><span class="op" id="8552420">)</span>&nbsp;<span class="op" id="8552422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552426">return</span>&nbsp;<span class="ident" id="8552433">fmt</span><span class="op" id="8552436">.</span><span class="ident" id="8552437">Errorf</span><span class="op" id="8552443">(</span><span class="string" id="8552444">&#34;different&nbsp;number&nbsp;of&nbsp;files:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="8552481">,</span>&nbsp;<span class="builtinfunc" id="8552483">len</span><span class="op" id="8552486">(</span><span class="ident" id="8552487">p</span><span class="op" id="8552488">.</span><span class="ident" id="8552489">files</span><span class="op" id="8552494">)</span><span class="op" id="8552495">,</span>&nbsp;<span class="builtinfunc" id="8552497">len</span><span class="op" id="8552500">(</span><span class="ident" id="8552501">q</span><span class="op" id="8552502">.</span><span class="ident" id="8552503">files</span><span class="op" id="8552508">)</span><span class="op" id="8552509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8552512">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552516">for</span>&nbsp;<span class="ident" id="8552520">i</span><span class="op" id="8552521">,</span>&nbsp;<span class="ident" id="8552523">f</span>&nbsp;<span class="op" id="8552525">:=</span>&nbsp;<span class="keyword" id="8552528">range</span>&nbsp;<span class="ident" id="8552534">p</span><span class="op" id="8552535">.</span><span class="ident" id="8552536">files</span>&nbsp;<span class="op" id="8552542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8552546">g</span>&nbsp;<span class="op" id="8552548">:=</span>&nbsp;<span class="ident" id="8552551">q</span><span class="op" id="8552552">.</span><span class="ident" id="8552553">files</span><span class="op" id="8552558">[</span><span class="ident" id="8552559">i</span><span class="op" id="8552560">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552564">if</span>&nbsp;<span class="ident" id="8552567">f</span><span class="op" id="8552568">.</span><span class="ident" id="8552569">set</span>&nbsp;<span class="op" id="8552573">!=</span>&nbsp;<span class="ident" id="8552576">p</span>&nbsp;<span class="op" id="8552578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552583">return</span>&nbsp;<span class="ident" id="8552590">fmt</span><span class="op" id="8552593">.</span><span class="ident" id="8552594">Errorf</span><span class="op" id="8552600">(</span><span class="string" id="8552601">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="8552623">,</span>&nbsp;<span class="ident" id="8552625">f</span><span class="op" id="8552626">.</span><span class="ident" id="8552627">name</span><span class="op" id="8552631">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8552635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552639">if</span>&nbsp;<span class="ident" id="8552642">g</span><span class="op" id="8552643">.</span><span class="ident" id="8552644">set</span>&nbsp;<span class="op" id="8552648">!=</span>&nbsp;<span class="ident" id="8552651">q</span>&nbsp;<span class="op" id="8552653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552658">return</span>&nbsp;<span class="ident" id="8552665">fmt</span><span class="op" id="8552668">.</span><span class="ident" id="8552669">Errorf</span><span class="op" id="8552675">(</span><span class="string" id="8552676">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="8552698">,</span>&nbsp;<span class="ident" id="8552700">g</span><span class="op" id="8552701">.</span><span class="ident" id="8552702">name</span><span class="op" id="8552706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8552710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552714">if</span>&nbsp;<span class="ident" id="8552717">f</span><span class="op" id="8552718">.</span><span class="ident" id="8552719">name</span>&nbsp;<span class="op" id="8552724">!=</span>&nbsp;<span class="ident" id="8552727">g</span><span class="op" id="8552728">.</span><span class="ident" id="8552729">name</span>&nbsp;<span class="op" id="8552734">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552739">return</span>&nbsp;<span class="ident" id="8552746">fmt</span><span class="op" id="8552749">.</span><span class="ident" id="8552750">Errorf</span><span class="op" id="8552756">(</span><span class="string" id="8552757">&#34;different&nbsp;filenames:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="8552788">,</span>&nbsp;<span class="ident" id="8552790">f</span><span class="op" id="8552791">.</span><span class="ident" id="8552792">name</span><span class="op" id="8552796">,</span>&nbsp;<span class="ident" id="8552798">g</span><span class="op" id="8552799">.</span><span class="ident" id="8552800">name</span><span class="op" id="8552804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8552808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552812">if</span>&nbsp;<span class="ident" id="8552815">f</span><span class="op" id="8552816">.</span><span class="ident" id="8552817">base</span>&nbsp;<span class="op" id="8552822">!=</span>&nbsp;<span class="ident" id="8552825">g</span><span class="op" id="8552826">.</span><span class="ident" id="8552827">base</span>&nbsp;<span class="op" id="8552832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552837">return</span>&nbsp;<span class="ident" id="8552844">fmt</span><span class="op" id="8552847">.</span><span class="ident" id="8552848">Errorf</span><span class="op" id="8552854">(</span><span class="string" id="8552855">&#34;different&nbsp;base&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="8552888">,</span>&nbsp;<span class="ident" id="8552890">f</span><span class="op" id="8552891">.</span><span class="ident" id="8552892">name</span><span class="op" id="8552896">,</span>&nbsp;<span class="ident" id="8552898">f</span><span class="op" id="8552899">.</span><span class="ident" id="8552900">base</span><span class="op" id="8552904">,</span>&nbsp;<span class="ident" id="8552906">g</span><span class="op" id="8552907">.</span><span class="ident" id="8552908">base</span><span class="op" id="8552912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8552916">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552920">if</span>&nbsp;<span class="ident" id="8552923">f</span><span class="op" id="8552924">.</span><span class="ident" id="8552925">size</span>&nbsp;<span class="op" id="8552930">!=</span>&nbsp;<span class="ident" id="8552933">g</span><span class="op" id="8552934">.</span><span class="ident" id="8552935">size</span>&nbsp;<span class="op" id="8552940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8552945">return</span>&nbsp;<span class="ident" id="8552952">fmt</span><span class="op" id="8552955">.</span><span class="ident" id="8552956">Errorf</span><span class="op" id="8552962">(</span><span class="string" id="8552963">&#34;different&nbsp;size&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="8552996">,</span>&nbsp;<span class="ident" id="8552998">f</span><span class="op" id="8552999">.</span><span class="ident" id="8553000">name</span><span class="op" id="8553004">,</span>&nbsp;<span class="ident" id="8553006">f</span><span class="op" id="8553007">.</span><span class="ident" id="8553008">size</span><span class="op" id="8553012">,</span>&nbsp;<span class="ident" id="8553014">g</span><span class="op" id="8553015">.</span><span class="ident" id="8553016">size</span><span class="op" id="8553020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8553024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8553028">for</span>&nbsp;<span class="ident" id="8553032">j</span><span class="op" id="8553033">,</span>&nbsp;<span class="ident" id="8553035">l</span>&nbsp;<span class="op" id="8553037">:=</span>&nbsp;<span class="keyword" id="8553040">range</span>&nbsp;<span class="ident" id="8553046">f</span><span class="op" id="8553047">.</span><span class="ident" id="8553048">lines</span>&nbsp;<span class="op" id="8553054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8553059">m</span>&nbsp;<span class="op" id="8553061">:=</span>&nbsp;<span class="ident" id="8553064">g</span><span class="op" id="8553065">.</span><span class="ident" id="8553066">lines</span><span class="op" id="8553071">[</span><span class="ident" id="8553072">j</span><span class="op" id="8553073">]</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8553078">if</span>&nbsp;<span class="ident" id="8553081">l</span>&nbsp;<span class="op" id="8553083">!=</span>&nbsp;<span class="ident" id="8553086">m</span>&nbsp;<span class="op" id="8553088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8553094">return</span>&nbsp;<span class="ident" id="8553101">fmt</span><span class="op" id="8553104">.</span><span class="ident" id="8553105">Errorf</span><span class="op" id="8553111">(</span><span class="string" id="8553112">&#34;different&nbsp;offsets&nbsp;for&nbsp;%q&#34;</span><span class="op" id="8553138">,</span>&nbsp;<span class="ident" id="8553140">f</span><span class="op" id="8553141">.</span><span class="ident" id="8553142">name</span><span class="op" id="8553146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8553151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8553155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8553159">for</span>&nbsp;<span class="ident" id="8553163">j</span><span class="op" id="8553164">,</span>&nbsp;<span class="ident" id="8553166">l</span>&nbsp;<span class="op" id="8553168">:=</span>&nbsp;<span class="keyword" id="8553171">range</span>&nbsp;<span class="ident" id="8553177">f</span><span class="op" id="8553178">.</span><span class="ident" id="8553179">infos</span>&nbsp;<span class="op" id="8553185">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8553190">m</span>&nbsp;<span class="op" id="8553192">:=</span>&nbsp;<span class="ident" id="8553195">g</span><span class="op" id="8553196">.</span><span class="ident" id="8553197">infos</span><span class="op" id="8553202">[</span><span class="ident" id="8553203">j</span><span class="op" id="8553204">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8553209">if</span>&nbsp;<span class="ident" id="8553212">l</span><span class="op" id="8553213">.</span><span class="ident" id="8553214">Offset</span>&nbsp;<span class="op" id="8553221">!=</span>&nbsp;<span class="ident" id="8553224">m</span><span class="op" id="8553225">.</span><span class="ident" id="8553226">Offset</span>&nbsp;<span class="op" id="8553233">||</span>&nbsp;<span class="ident" id="8553236">l</span><span class="op" id="8553237">.</span><span class="ident" id="8553238">Filename</span>&nbsp;<span class="op" id="8553247">!=</span>&nbsp;<span class="ident" id="8553250">m</span><span class="op" id="8553251">.</span><span class="ident" id="8553252">Filename</span>&nbsp;<span class="op" id="8553261">||</span>&nbsp;<span class="ident" id="8553264">l</span><span class="op" id="8553265">.</span><span class="ident" id="8553266">Line</span>&nbsp;<span class="op" id="8553271">!=</span>&nbsp;<span class="ident" id="8553274">m</span><span class="op" id="8553275">.</span><span class="ident" id="8553276">Line</span>&nbsp;<span class="op" id="8553281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8553287">return</span>&nbsp;<span class="ident" id="8553294">fmt</span><span class="op" id="8553297">.</span><span class="ident" id="8553298">Errorf</span><span class="op" id="8553304">(</span><span class="string" id="8553305">&#34;different&nbsp;infos&nbsp;for&nbsp;%q&#34;</span><span class="op" id="8553329">,</span>&nbsp;<span class="ident" id="8553331">f</span><span class="op" id="8553332">.</span><span class="ident" id="8553333">name</span><span class="op" id="8553337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8553342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8553346">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8553349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8553353">//&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;about&nbsp;.last&nbsp;-&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8553403">return</span>&nbsp;<span class="ident" id="8553410">nil</span><br>
<span class="lineno"></span><span class="op" id="8553414">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="8553417">func</span>&nbsp;<span class="ident" id="8553422">checkSerialize</span><span class="op" id="8553436">(</span><span class="ident" id="8553437">t</span>&nbsp;<span class="op" id="8553439">*</span><span class="ident" id="8553440">testing</span><span class="op" id="8553447">.</span><span class="ident" id="8553448">T</span><span class="op" id="8553449">,</span>&nbsp;<span class="ident" id="8553451">p</span>&nbsp;<span class="op" id="8553453">*</span><span class="ident" id="8553454">FileSet</span><span class="op" id="8553461">)</span>&nbsp;<span class="op" id="8553463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8553466">var</span>&nbsp;<span class="ident" id="8553470">buf</span>&nbsp;<span class="ident" id="8553474">bytes</span><span class="op" id="8553479">.</span><span class="ident" id="8553480">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8553488">encode</span>&nbsp;<span class="op" id="8553495">:=</span>&nbsp;<span class="keyword" id="8553498">func</span><span class="op" id="8553502">(</span><span class="ident" id="8553503">x</span>&nbsp;<span class="keyword" id="8553505">interface</span><span class="op" id="8553514">{</span><span class="op" id="8553515">}</span><span class="op" id="8553516">)</span>&nbsp;<span class="builtintype" id="8553518">error</span>&nbsp;<span class="op" id="8553524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8553528">return</span>&nbsp;<span class="ident" id="8553535">gob</span><span class="op" id="8553538">.</span><span class="ident" id="8553539">NewEncoder</span><span class="op" id="8553549">(</span><span class="op" id="8553550">&amp;</span><span class="ident" id="8553551">buf</span><span class="op" id="8553554">)</span><span class="op" id="8553555">.</span><span class="ident" id="8553556">Encode</span><span class="op" id="8553562">(</span><span class="ident" id="8553563">x</span><span class="op" id="8553564">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8553567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8553570">if</span>&nbsp;<span class="ident" id="8553573">err</span>&nbsp;<span class="op" id="8553577">:=</span>&nbsp;<span class="ident" id="8553580">p</span><span class="op" id="8553581">.</span><span class="ident" id="8553582">Write</span><span class="op" id="8553587">(</span><span class="ident" id="8553588">encode</span><span class="op" id="8553594">)</span><span class="op" id="8553595">;</span>&nbsp;<span class="ident" id="8553597">err</span>&nbsp;<span class="op" id="8553601">!=</span>&nbsp;<span class="ident" id="8553604">nil</span>&nbsp;<span class="op" id="8553608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8553612">t</span><span class="op" id="8553613">.</span><span class="ident" id="8553614">Errorf</span><span class="op" id="8553620">(</span><span class="string" id="8553621">&#34;writing&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8553649">,</span>&nbsp;<span class="ident" id="8553651">err</span><span class="op" id="8553654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8553658">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8553666">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8553669">q</span>&nbsp;<span class="op" id="8553671">:=</span>&nbsp;<span class="ident" id="8553674">NewFileSet</span><span class="op" id="8553684">(</span><span class="op" id="8553685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8553688">decode</span>&nbsp;<span class="op" id="8553695">:=</span>&nbsp;<span class="keyword" id="8553698">func</span><span class="op" id="8553702">(</span><span class="ident" id="8553703">x</span>&nbsp;<span class="keyword" id="8553705">interface</span><span class="op" id="8553714">{</span><span class="op" id="8553715">}</span><span class="op" id="8553716">)</span>&nbsp;<span class="builtintype" id="8553718">error</span>&nbsp;<span class="op" id="8553724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8553728">return</span>&nbsp;<span class="ident" id="8553735">gob</span><span class="op" id="8553738">.</span><span class="ident" id="8553739">NewDecoder</span><span class="op" id="8553749">(</span><span class="op" id="8553750">&amp;</span><span class="ident" id="8553751">buf</span><span class="op" id="8553754">)</span><span class="op" id="8553755">.</span><span class="ident" id="8553756">Decode</span><span class="op" id="8553762">(</span><span class="ident" id="8553763">x</span><span class="op" id="8553764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8553767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8553770">if</span>&nbsp;<span class="ident" id="8553773">err</span>&nbsp;<span class="op" id="8553777">:=</span>&nbsp;<span class="ident" id="8553780">q</span><span class="op" id="8553781">.</span><span class="ident" id="8553782">Read</span><span class="op" id="8553786">(</span><span class="ident" id="8553787">decode</span><span class="op" id="8553793">)</span><span class="op" id="8553794">;</span>&nbsp;<span class="ident" id="8553796">err</span>&nbsp;<span class="op" id="8553800">!=</span>&nbsp;<span class="ident" id="8553803">nil</span>&nbsp;<span class="op" id="8553807">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8553811">t</span><span class="op" id="8553812">.</span><span class="ident" id="8553813">Errorf</span><span class="op" id="8553819">(</span><span class="string" id="8553820">&#34;reading&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8553848">,</span>&nbsp;<span class="ident" id="8553850">err</span><span class="op" id="8553853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8553857">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8553865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8553868">if</span>&nbsp;<span class="ident" id="8553871">err</span>&nbsp;<span class="op" id="8553875">:=</span>&nbsp;<span class="ident" id="8553878">equal</span><span class="op" id="8553883">(</span><span class="ident" id="8553884">p</span><span class="op" id="8553885">,</span>&nbsp;<span class="ident" id="8553887">q</span><span class="op" id="8553888">)</span><span class="op" id="8553889">;</span>&nbsp;<span class="ident" id="8553891">err</span>&nbsp;<span class="op" id="8553895">!=</span>&nbsp;<span class="ident" id="8553898">nil</span>&nbsp;<span class="op" id="8553902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8553906">t</span><span class="op" id="8553907">.</span><span class="ident" id="8553908">Errorf</span><span class="op" id="8553914">(</span><span class="string" id="8553915">&#34;filesets&nbsp;not&nbsp;identical:&nbsp;%s&#34;</span><span class="op" id="8553943">,</span>&nbsp;<span class="ident" id="8553945">err</span><span class="op" id="8553948">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8553951">}</span><br>
<span class="lineno"></span><span class="op" id="8553953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8553956">func</span>&nbsp;<span class="ident" id="8553961">TestSerialization</span><span class="op" id="8553978">(</span><span class="ident" id="8553979">t</span>&nbsp;<span class="op" id="8553981">*</span><span class="ident" id="8553982">testing</span><span class="op" id="8553989">.</span><span class="ident" id="8553990">T</span><span class="op" id="8553991">)</span>&nbsp;<span class="op" id="8553993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8553996">p</span>&nbsp;<span class="op" id="8553998">:=</span>&nbsp;<span class="ident" id="8554001">NewFileSet</span><span class="op" id="8554011">(</span><span class="op" id="8554012">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8554015">checkSerialize</span><span class="op" id="8554029">(</span><span class="ident" id="8554030">t</span><span class="op" id="8554031">,</span>&nbsp;<span class="ident" id="8554033">p</span><span class="op" id="8554034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8554037">//&nbsp;add&nbsp;some&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8554056">for</span>&nbsp;<span class="ident" id="8554060">i</span>&nbsp;<span class="op" id="8554062">:=</span>&nbsp;<span class="num" id="8554065">0</span><span class="op" id="8554066">;</span>&nbsp;<span class="ident" id="8554068">i</span>&nbsp;<span class="op" id="8554070">&lt;</span>&nbsp;<span class="num" id="8554072">10</span><span class="op" id="8554074">;</span>&nbsp;<span class="ident" id="8554076">i</span><span class="op" id="8554077">++</span>&nbsp;<span class="op" id="8554080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8554084">f</span>&nbsp;<span class="op" id="8554086">:=</span>&nbsp;<span class="ident" id="8554089">p</span><span class="op" id="8554090">.</span><span class="ident" id="8554091">AddFile</span><span class="op" id="8554098">(</span><span class="ident" id="8554099">fmt</span><span class="op" id="8554102">.</span><span class="ident" id="8554103">Sprintf</span><span class="op" id="8554110">(</span><span class="string" id="8554111">&#34;file%d&#34;</span><span class="op" id="8554119">,</span>&nbsp;<span class="ident" id="8554121">i</span><span class="op" id="8554122">)</span><span class="op" id="8554123">,</span>&nbsp;<span class="ident" id="8554125">p</span><span class="op" id="8554126">.</span><span class="ident" id="8554127">Base</span><span class="op" id="8554131">(</span><span class="op" id="8554132">)</span><span class="op" id="8554133">+</span><span class="ident" id="8554134">i</span><span class="op" id="8554135">,</span>&nbsp;<span class="ident" id="8554137">i</span><span class="op" id="8554138">*</span><span class="num" id="8554139">100</span><span class="op" id="8554142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8554146">checkSerialize</span><span class="op" id="8554160">(</span><span class="ident" id="8554161">t</span><span class="op" id="8554162">,</span>&nbsp;<span class="ident" id="8554164">p</span><span class="op" id="8554165">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8554169">//&nbsp;add&nbsp;some&nbsp;lines&nbsp;and&nbsp;alternative&nbsp;file&nbsp;infos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8554216">line</span>&nbsp;<span class="op" id="8554221">:=</span>&nbsp;<span class="num" id="8554224">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8554231">for</span>&nbsp;<span class="ident" id="8554235">offs</span>&nbsp;<span class="op" id="8554240">:=</span>&nbsp;<span class="num" id="8554243">0</span><span class="op" id="8554244">;</span>&nbsp;<span class="ident" id="8554246">offs</span>&nbsp;<span class="op" id="8554251">&lt;</span>&nbsp;<span class="ident" id="8554253">f</span><span class="op" id="8554254">.</span><span class="ident" id="8554255">Size</span><span class="op" id="8554259">(</span><span class="op" id="8554260">)</span><span class="op" id="8554261">;</span>&nbsp;<span class="ident" id="8554263">offs</span>&nbsp;<span class="op" id="8554268">+=</span>&nbsp;<span class="num" id="8554271">40</span>&nbsp;<span class="op" id="8554274">+</span>&nbsp;<span class="ident" id="8554276">i</span>&nbsp;<span class="op" id="8554278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8554283">f</span><span class="op" id="8554284">.</span><span class="ident" id="8554285">AddLine</span><span class="op" id="8554292">(</span><span class="ident" id="8554293">offs</span><span class="op" id="8554297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8554302">if</span>&nbsp;<span class="ident" id="8554305">offs</span><span class="op" id="8554309">%</span><span class="num" id="8554310">7</span>&nbsp;<span class="op" id="8554312">==</span>&nbsp;<span class="num" id="8554315">0</span>&nbsp;<span class="op" id="8554317">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8554323">f</span><span class="op" id="8554324">.</span><span class="ident" id="8554325">AddLineInfo</span><span class="op" id="8554336">(</span><span class="ident" id="8554337">offs</span><span class="op" id="8554341">,</span>&nbsp;<span class="ident" id="8554343">fmt</span><span class="op" id="8554346">.</span><span class="ident" id="8554347">Sprintf</span><span class="op" id="8554354">(</span><span class="string" id="8554355">&#34;file%d&#34;</span><span class="op" id="8554363">,</span>&nbsp;<span class="ident" id="8554365">offs</span><span class="op" id="8554369">)</span><span class="op" id="8554370">,</span>&nbsp;<span class="ident" id="8554372">line</span><span class="op" id="8554376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8554382">line</span>&nbsp;<span class="op" id="8554387">+=</span>&nbsp;<span class="num" id="8554390">33</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8554396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8554400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8554404">checkSerialize</span><span class="op" id="8554418">(</span><span class="ident" id="8554419">t</span><span class="op" id="8554420">,</span>&nbsp;<span class="ident" id="8554422">p</span><span class="op" id="8554423">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8554426">}</span><br>
<span class="lineno"></span><span class="op" id="8554428">}</span>
</div>
</body>
</html>
