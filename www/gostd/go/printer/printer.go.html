<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6004800">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6004855">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6004909">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6004960">//&nbsp;Package&nbsp;printer&nbsp;implements&nbsp;printing&nbsp;of&nbsp;AST&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="6005013">package</span>&nbsp;<span class="ident" id="6005021">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6005030">import</span>&nbsp;<span class="op" id="6005037">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6005040">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6005047">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6005057">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6005069">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6005075">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6005081">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6005092">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6005103">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6005121">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="6005131">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6005134">const</span>&nbsp;<span class="op" id="6005140">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005143">maxNewlines</span>&nbsp;<span class="op" id="6005155">=</span>&nbsp;<span class="num" id="6005157">2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6005163">//&nbsp;max.&nbsp;number&nbsp;of&nbsp;newlines&nbsp;between&nbsp;source&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005211">debug</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6005223">=</span>&nbsp;<span class="builtintype" id="6005225">false</span>&nbsp;<span class="comment" id="6005231">//&nbsp;enable&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005256">infinity</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6005268">=</span>&nbsp;<span class="num" id="6005270">1</span>&nbsp;<span class="op" id="6005272">&lt;&lt;</span>&nbsp;<span class="num" id="6005275">30</span><br>
<span class="lineno"></span><span class="op" id="6005278">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="6005281">type</span>&nbsp;<span class="ident" id="6005286">whiteSpace</span>&nbsp;<span class="builtintype" id="6005297">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6005303">const</span>&nbsp;<span class="op" id="6005309">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005312">ignore</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6005321">=</span>&nbsp;<span class="ident" id="6005323">whiteSpace</span><span class="op" id="6005333">(</span><span class="num" id="6005334">0</span><span class="op" id="6005335">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005338">blank</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6005347">=</span>&nbsp;<span class="ident" id="6005349">whiteSpace</span><span class="op" id="6005359">(</span><span class="string" id="6005360">&#39;&nbsp;&#39;</span><span class="op" id="6005363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005366">vtab</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6005375">=</span>&nbsp;<span class="ident" id="6005377">whiteSpace</span><span class="op" id="6005387">(</span><span class="string" id="6005388">&#39;\v&#39;</span><span class="op" id="6005392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005395">newline</span>&nbsp;&nbsp;<span class="op" id="6005404">=</span>&nbsp;<span class="ident" id="6005406">whiteSpace</span><span class="op" id="6005416">(</span><span class="string" id="6005417">&#39;\n&#39;</span><span class="op" id="6005421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005424">formfeed</span>&nbsp;<span class="op" id="6005433">=</span>&nbsp;<span class="ident" id="6005435">whiteSpace</span><span class="op" id="6005445">(</span><span class="string" id="6005446">&#39;\f&#39;</span><span class="op" id="6005450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005453">indent</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6005462">=</span>&nbsp;<span class="ident" id="6005464">whiteSpace</span><span class="op" id="6005474">(</span><span class="string" id="6005475">&#39;&gt;&#39;</span><span class="op" id="6005478">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005481">unindent</span>&nbsp;<span class="op" id="6005490">=</span>&nbsp;<span class="ident" id="6005492">whiteSpace</span><span class="op" id="6005502">(</span><span class="string" id="6005503">&#39;&lt;&#39;</span><span class="op" id="6005506">)</span><br>
<span class="lineno"></span><span class="op" id="6005508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6005511">//&nbsp;A&nbsp;pmode&nbsp;value&nbsp;represents&nbsp;the&nbsp;current&nbsp;printer&nbsp;mode.</span><br>
<span class="lineno"></span><span class="keyword" id="6005565">type</span>&nbsp;<span class="ident" id="6005570">pmode</span>&nbsp;<span class="builtintype" id="6005576">int</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6005581">const</span>&nbsp;<span class="op" id="6005587">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005590">noExtraBlank</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6005607">pmode</span>&nbsp;<span class="op" id="6005613">=</span>&nbsp;<span class="num" id="6005615">1</span>&nbsp;<span class="op" id="6005617">&lt;&lt;</span>&nbsp;<span class="ident" id="6005620">iota</span>&nbsp;<span class="comment" id="6005625">//&nbsp;disables&nbsp;extra&nbsp;blank&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005673">noExtraLinebreak</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6005708">//&nbsp;disables&nbsp;extra&nbsp;line&nbsp;break&nbsp;after&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span><span class="op" id="6005760">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="6005763">type</span>&nbsp;<span class="ident" id="6005768">commentInfo</span>&nbsp;<span class="keyword" id="6005780">struct</span>&nbsp;<span class="op" id="6005787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005790">cindex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6005805">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6005823">//&nbsp;current&nbsp;comment&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005849">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6005864">*</span><span class="ident" id="6005865">ast</span><span class="op" id="6005868">.</span><span class="ident" id="6005869">CommentGroup</span>&nbsp;<span class="comment" id="6005882">//&nbsp;=&nbsp;printer.comments[cindex];&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005921">commentOffset</span>&nbsp;&nbsp;<span class="builtintype" id="6005936">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6005954">//&nbsp;=&nbsp;printer.posFor(printer.comments[cindex].List[0].Pos()).Offset;&nbsp;or&nbsp;infinity</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006035">commentNewline</span>&nbsp;<span class="builtintype" id="6006050">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6006068">//&nbsp;true&nbsp;if&nbsp;the&nbsp;comment&nbsp;group&nbsp;contains&nbsp;newlines</span><br>
<span class="lineno"></span><span class="op" id="6006115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6006118">type</span>&nbsp;<span class="ident" id="6006123">printer</span>&nbsp;<span class="keyword" id="6006131">struct</span>&nbsp;<span class="op" id="6006138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006141">//&nbsp;Configuration&nbsp;(does&nbsp;not&nbsp;change&nbsp;after&nbsp;initialization)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006198">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006206">fset</span>&nbsp;<span class="op" id="6006211">*</span><span class="ident" id="6006212">token</span><span class="op" id="6006217">.</span><span class="ident" id="6006218">FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006228">//&nbsp;Current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006246">output</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6006258">[</span><span class="op" id="6006259">]</span><span class="builtintype" id="6006260">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6006271">//&nbsp;raw&nbsp;printer&nbsp;result</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006294">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6006306">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6006319">//&nbsp;current&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006343">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006355">pmode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6006368">//&nbsp;current&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006393">impliedSemi</span>&nbsp;<span class="builtintype" id="6006405">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6006418">//&nbsp;if&nbsp;set,&nbsp;a&nbsp;linebreak&nbsp;implies&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006462">lastTok</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006474">token</span><span class="op" id="6006479">.</span><span class="ident" id="6006480">Token</span>&nbsp;&nbsp;<span class="comment" id="6006487">//&nbsp;last&nbsp;token&nbsp;printed&nbsp;(token.ILLEGAL&nbsp;if&nbsp;it&#39;s&nbsp;whitespace)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006545">prevOpen</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6006557">token</span><span class="op" id="6006562">.</span><span class="ident" id="6006563">Token</span>&nbsp;&nbsp;<span class="comment" id="6006570">//&nbsp;previous&nbsp;non-brace&nbsp;&#34;open&#34;&nbsp;token&nbsp;(,&nbsp;[,&nbsp;or&nbsp;token.ILLEGAL</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006629">wsbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6006641">[</span><span class="op" id="6006642">]</span><span class="ident" id="6006643">whiteSpace</span>&nbsp;<span class="comment" id="6006654">//&nbsp;delayed&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006679">//&nbsp;Positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006693">//&nbsp;The&nbsp;out&nbsp;position&nbsp;differs&nbsp;from&nbsp;the&nbsp;pos&nbsp;position&nbsp;when&nbsp;the&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006760">//&nbsp;formatting&nbsp;differs&nbsp;from&nbsp;the&nbsp;source&nbsp;formatting&nbsp;(in&nbsp;the&nbsp;amount&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006828">//&nbsp;white&nbsp;space).&nbsp;If&nbsp;there&#39;s&nbsp;a&nbsp;difference&nbsp;and&nbsp;SourcePos&nbsp;is&nbsp;set&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006894">//&nbsp;ConfigMode,&nbsp;//line&nbsp;comments&nbsp;are&nbsp;used&nbsp;in&nbsp;the&nbsp;output&nbsp;to&nbsp;restore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006960">//&nbsp;original&nbsp;source&nbsp;positions&nbsp;for&nbsp;a&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007004">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6007012">token</span><span class="op" id="6007017">.</span><span class="ident" id="6007018">Position</span>&nbsp;<span class="comment" id="6007027">//&nbsp;current&nbsp;position&nbsp;in&nbsp;AST&nbsp;(source)&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007070">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6007078">token</span><span class="op" id="6007083">.</span><span class="ident" id="6007084">Position</span>&nbsp;<span class="comment" id="6007093">//&nbsp;current&nbsp;position&nbsp;in&nbsp;output&nbsp;space</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007130">last</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6007138">token</span><span class="op" id="6007143">.</span><span class="ident" id="6007144">Position</span>&nbsp;<span class="comment" id="6007153">//&nbsp;value&nbsp;of&nbsp;pos&nbsp;after&nbsp;calling&nbsp;writeString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007196">linePtr</span>&nbsp;<span class="op" id="6007204">*</span><span class="builtintype" id="6007205">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6007219">//&nbsp;if&nbsp;set,&nbsp;record&nbsp;out.Line&nbsp;for&nbsp;the&nbsp;next&nbsp;token&nbsp;in&nbsp;*linePtr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007279">//&nbsp;The&nbsp;list&nbsp;of&nbsp;all&nbsp;source&nbsp;comments,&nbsp;in&nbsp;order&nbsp;of&nbsp;appearance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007340">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6007356">[</span><span class="op" id="6007357">]</span><span class="op" id="6007358">*</span><span class="ident" id="6007359">ast</span><span class="op" id="6007362">.</span><span class="ident" id="6007363">CommentGroup</span>&nbsp;<span class="comment" id="6007376">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007391">useNodeComments</span>&nbsp;<span class="builtintype" id="6007407">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6007427">//&nbsp;if&nbsp;not&nbsp;set,&nbsp;ignore&nbsp;lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;of&nbsp;nodes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007483">//&nbsp;Information&nbsp;about&nbsp;p.comments[p.cindex];&nbsp;set&nbsp;up&nbsp;by&nbsp;nextComment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007550">commentInfo</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007564">//&nbsp;Cache&nbsp;of&nbsp;already&nbsp;computed&nbsp;node&nbsp;sizes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007606">nodeSizes</span>&nbsp;<span class="keyword" id="6007616">map</span><span class="op" id="6007619">[</span><span class="ident" id="6007620">ast</span><span class="op" id="6007623">.</span><span class="ident" id="6007624">Node</span><span class="op" id="6007628">]</span><span class="builtintype" id="6007629">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007635">//&nbsp;Cache&nbsp;of&nbsp;most&nbsp;recently&nbsp;computed&nbsp;line&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007686">cachedPos</span>&nbsp;&nbsp;<span class="ident" id="6007697">token</span><span class="op" id="6007702">.</span><span class="ident" id="6007703">Pos</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007708">cachedLine</span>&nbsp;<span class="builtintype" id="6007719">int</span>&nbsp;<span class="comment" id="6007723">//&nbsp;line&nbsp;corresponding&nbsp;to&nbsp;cachedPos</span><br>
<span class="lineno"></span><span class="op" id="6007758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6007761">func</span>&nbsp;<span class="op" id="6007766">(</span><span class="ident" id="6007767">p</span>&nbsp;<span class="op" id="6007769">*</span><span class="ident" id="6007770">printer</span><span class="op" id="6007777">)</span>&nbsp;<span class="ident" id="6007779">init</span><span class="op" id="6007783">(</span><span class="ident" id="6007784">cfg</span>&nbsp;<span class="op" id="6007788">*</span><span class="ident" id="6007789">Config</span><span class="op" id="6007795">,</span>&nbsp;<span class="ident" id="6007797">fset</span>&nbsp;<span class="op" id="6007802">*</span><span class="ident" id="6007803">token</span><span class="op" id="6007808">.</span><span class="ident" id="6007809">FileSet</span><span class="op" id="6007816">,</span>&nbsp;<span class="ident" id="6007818">nodeSizes</span>&nbsp;<span class="keyword" id="6007828">map</span><span class="op" id="6007831">[</span><span class="ident" id="6007832">ast</span><span class="op" id="6007835">.</span><span class="ident" id="6007836">Node</span><span class="op" id="6007840">]</span><span class="builtintype" id="6007841">int</span><span class="op" id="6007844">)</span>&nbsp;<span class="op" id="6007846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007849">p</span><span class="op" id="6007850">.</span><span class="ident" id="6007851">Config</span>&nbsp;<span class="op" id="6007858">=</span>&nbsp;<span class="op" id="6007860">*</span><span class="ident" id="6007861">cfg</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007866">p</span><span class="op" id="6007867">.</span><span class="ident" id="6007868">fset</span>&nbsp;<span class="op" id="6007873">=</span>&nbsp;<span class="ident" id="6007875">fset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007881">p</span><span class="op" id="6007882">.</span><span class="ident" id="6007883">pos</span>&nbsp;<span class="op" id="6007887">=</span>&nbsp;<span class="ident" id="6007889">token</span><span class="op" id="6007894">.</span><span class="ident" id="6007895">Position</span><span class="op" id="6007903">{</span><span class="ident" id="6007904">Line</span><span class="op" id="6007908">:</span>&nbsp;<span class="num" id="6007910">1</span><span class="op" id="6007911">,</span>&nbsp;<span class="ident" id="6007913">Column</span><span class="op" id="6007919">:</span>&nbsp;<span class="num" id="6007921">1</span><span class="op" id="6007922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007925">p</span><span class="op" id="6007926">.</span><span class="ident" id="6007927">out</span>&nbsp;<span class="op" id="6007931">=</span>&nbsp;<span class="ident" id="6007933">token</span><span class="op" id="6007938">.</span><span class="ident" id="6007939">Position</span><span class="op" id="6007947">{</span><span class="ident" id="6007948">Line</span><span class="op" id="6007952">:</span>&nbsp;<span class="num" id="6007954">1</span><span class="op" id="6007955">,</span>&nbsp;<span class="ident" id="6007957">Column</span><span class="op" id="6007963">:</span>&nbsp;<span class="num" id="6007965">1</span><span class="op" id="6007966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007969">p</span><span class="op" id="6007970">.</span><span class="ident" id="6007971">wsbuf</span>&nbsp;<span class="op" id="6007977">=</span>&nbsp;<span class="builtinfunc" id="6007979">make</span><span class="op" id="6007983">(</span><span class="op" id="6007984">[</span><span class="op" id="6007985">]</span><span class="ident" id="6007986">whiteSpace</span><span class="op" id="6007996">,</span>&nbsp;<span class="num" id="6007998">0</span><span class="op" id="6007999">,</span>&nbsp;<span class="num" id="6008001">16</span><span class="op" id="6008003">)</span>&nbsp;<span class="comment" id="6008005">//&nbsp;whitespace&nbsp;sequences&nbsp;are&nbsp;short</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008040">p</span><span class="op" id="6008041">.</span><span class="ident" id="6008042">nodeSizes</span>&nbsp;<span class="op" id="6008052">=</span>&nbsp;<span class="ident" id="6008054">nodeSizes</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008065">p</span><span class="op" id="6008066">.</span><span class="ident" id="6008067">cachedPos</span>&nbsp;<span class="op" id="6008077">=</span>&nbsp;<span class="op" id="6008079">-</span><span class="num" id="6008080">1</span><br>
<span class="lineno"></span><span class="op" id="6008082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6008085">func</span>&nbsp;<span class="op" id="6008090">(</span><span class="ident" id="6008091">p</span>&nbsp;<span class="op" id="6008093">*</span><span class="ident" id="6008094">printer</span><span class="op" id="6008101">)</span>&nbsp;<span class="ident" id="6008103">internalError</span><span class="op" id="6008116">(</span><span class="ident" id="6008117">msg</span>&nbsp;<span class="op" id="6008121">...</span><span class="keyword" id="6008124">interface</span><span class="op" id="6008133">{</span><span class="op" id="6008134">}</span><span class="op" id="6008135">)</span>&nbsp;<span class="op" id="6008137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008140">if</span>&nbsp;<span class="ident" id="6008143">debug</span>&nbsp;<span class="op" id="6008149">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008153">fmt</span><span class="op" id="6008156">.</span><span class="ident" id="6008157">Print</span><span class="op" id="6008162">(</span><span class="ident" id="6008163">p</span><span class="op" id="6008164">.</span><span class="ident" id="6008165">pos</span><span class="op" id="6008168">.</span><span class="ident" id="6008169">String</span><span class="op" id="6008175">(</span><span class="op" id="6008176">)</span>&nbsp;<span class="op" id="6008178">+</span>&nbsp;<span class="string" id="6008180">&#34;:&nbsp;&#34;</span><span class="op" id="6008184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008188">fmt</span><span class="op" id="6008191">.</span><span class="ident" id="6008192">Println</span><span class="op" id="6008199">(</span><span class="ident" id="6008200">msg</span><span class="op" id="6008203">...</span><span class="op" id="6008206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6008210">panic</span><span class="op" id="6008215">(</span><span class="string" id="6008216">&#34;go/printer&#34;</span><span class="op" id="6008228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6008231">}</span><br>
<span class="lineno"></span><span class="op" id="6008233">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="6008236">//&nbsp;commentsHaveNewline&nbsp;reports&nbsp;whether&nbsp;a&nbsp;list&nbsp;of&nbsp;comments&nbsp;belonging&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6008307">//&nbsp;an&nbsp;*ast.CommentGroup&nbsp;contains&nbsp;newlines.&nbsp;Because&nbsp;the&nbsp;position&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="6008383">//&nbsp;may&nbsp;only&nbsp;be&nbsp;partially&nbsp;correct,&nbsp;we&nbsp;also&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;comment&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="6008456">func</span>&nbsp;<span class="op" id="6008461">(</span><span class="ident" id="6008462">p</span>&nbsp;<span class="op" id="6008464">*</span><span class="ident" id="6008465">printer</span><span class="op" id="6008472">)</span>&nbsp;<span class="ident" id="6008474">commentsHaveNewline</span><span class="op" id="6008493">(</span><span class="ident" id="6008494">list</span>&nbsp;<span class="op" id="6008499">[</span><span class="op" id="6008500">]</span><span class="op" id="6008501">*</span><span class="ident" id="6008502">ast</span><span class="op" id="6008505">.</span><span class="ident" id="6008506">Comment</span><span class="op" id="6008513">)</span>&nbsp;<span class="builtintype" id="6008515">bool</span>&nbsp;<span class="op" id="6008520">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008523">//&nbsp;len(list)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008541">line</span>&nbsp;<span class="op" id="6008546">:=</span>&nbsp;<span class="ident" id="6008549">p</span><span class="op" id="6008550">.</span><span class="ident" id="6008551">lineFor</span><span class="op" id="6008558">(</span><span class="ident" id="6008559">list</span><span class="op" id="6008563">[</span><span class="num" id="6008564">0</span><span class="op" id="6008565">]</span><span class="op" id="6008566">.</span><span class="ident" id="6008567">Pos</span><span class="op" id="6008570">(</span><span class="op" id="6008571">)</span><span class="op" id="6008572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008575">for</span>&nbsp;<span class="ident" id="6008579">i</span><span class="op" id="6008580">,</span>&nbsp;<span class="ident" id="6008582">c</span>&nbsp;<span class="op" id="6008584">:=</span>&nbsp;<span class="keyword" id="6008587">range</span>&nbsp;<span class="ident" id="6008593">list</span>&nbsp;<span class="op" id="6008598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008602">if</span>&nbsp;<span class="ident" id="6008605">i</span>&nbsp;<span class="op" id="6008607">&gt;</span>&nbsp;<span class="num" id="6008609">0</span>&nbsp;<span class="op" id="6008611">&amp;&amp;</span>&nbsp;<span class="ident" id="6008614">p</span><span class="op" id="6008615">.</span><span class="ident" id="6008616">lineFor</span><span class="op" id="6008623">(</span><span class="ident" id="6008624">list</span><span class="op" id="6008628">[</span><span class="ident" id="6008629">i</span><span class="op" id="6008630">]</span><span class="op" id="6008631">.</span><span class="ident" id="6008632">Pos</span><span class="op" id="6008635">(</span><span class="op" id="6008636">)</span><span class="op" id="6008637">)</span>&nbsp;<span class="op" id="6008639">!=</span>&nbsp;<span class="ident" id="6008642">line</span>&nbsp;<span class="op" id="6008647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008652">//&nbsp;not&nbsp;all&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008692">return</span>&nbsp;<span class="builtintype" id="6008699">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6008706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008710">if</span>&nbsp;<span class="ident" id="6008713">t</span>&nbsp;<span class="op" id="6008715">:=</span>&nbsp;<span class="ident" id="6008718">c</span><span class="op" id="6008719">.</span><span class="ident" id="6008720">Text</span><span class="op" id="6008724">;</span>&nbsp;<span class="builtinfunc" id="6008726">len</span><span class="op" id="6008729">(</span><span class="ident" id="6008730">t</span><span class="op" id="6008731">)</span>&nbsp;<span class="op" id="6008733">&gt;=</span>&nbsp;<span class="num" id="6008736">2</span>&nbsp;<span class="op" id="6008738">&amp;&amp;</span>&nbsp;<span class="op" id="6008741">(</span><span class="ident" id="6008742">t</span><span class="op" id="6008743">[</span><span class="num" id="6008744">1</span><span class="op" id="6008745">]</span>&nbsp;<span class="op" id="6008747">==</span>&nbsp;<span class="string" id="6008750">&#39;/&#39;</span>&nbsp;<span class="op" id="6008754">||</span>&nbsp;<span class="ident" id="6008757">strings</span><span class="op" id="6008764">.</span><span class="ident" id="6008765">Contains</span><span class="op" id="6008773">(</span><span class="ident" id="6008774">t</span><span class="op" id="6008775">,</span>&nbsp;<span class="string" id="6008777">&#34;\n&#34;</span><span class="op" id="6008781">)</span><span class="op" id="6008782">)</span>&nbsp;<span class="op" id="6008784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008789">return</span>&nbsp;<span class="builtintype" id="6008796">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6008803">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6008806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008809">_</span>&nbsp;<span class="op" id="6008811">=</span>&nbsp;<span class="ident" id="6008813">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008819">return</span>&nbsp;<span class="builtintype" id="6008826">false</span><br>
<span class="lineno"></span><span class="op" id="6008832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6008835">func</span>&nbsp;<span class="op" id="6008840">(</span><span class="ident" id="6008841">p</span>&nbsp;<span class="op" id="6008843">*</span><span class="ident" id="6008844">printer</span><span class="op" id="6008851">)</span>&nbsp;<span class="ident" id="6008853">nextComment</span><span class="op" id="6008864">(</span><span class="op" id="6008865">)</span>&nbsp;<span class="op" id="6008867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008870">for</span>&nbsp;<span class="ident" id="6008874">p</span><span class="op" id="6008875">.</span><span class="ident" id="6008876">cindex</span>&nbsp;<span class="op" id="6008883">&lt;</span>&nbsp;<span class="builtinfunc" id="6008885">len</span><span class="op" id="6008888">(</span><span class="ident" id="6008889">p</span><span class="op" id="6008890">.</span><span class="ident" id="6008891">comments</span><span class="op" id="6008899">)</span>&nbsp;<span class="op" id="6008901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008905">c</span>&nbsp;<span class="op" id="6008907">:=</span>&nbsp;<span class="ident" id="6008910">p</span><span class="op" id="6008911">.</span><span class="ident" id="6008912">comments</span><span class="op" id="6008920">[</span><span class="ident" id="6008921">p</span><span class="op" id="6008922">.</span><span class="ident" id="6008923">cindex</span><span class="op" id="6008929">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008933">p</span><span class="op" id="6008934">.</span><span class="ident" id="6008935">cindex</span><span class="op" id="6008941">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008946">if</span>&nbsp;<span class="ident" id="6008949">list</span>&nbsp;<span class="op" id="6008954">:=</span>&nbsp;<span class="ident" id="6008957">c</span><span class="op" id="6008958">.</span><span class="ident" id="6008959">List</span><span class="op" id="6008963">;</span>&nbsp;<span class="builtinfunc" id="6008965">len</span><span class="op" id="6008968">(</span><span class="ident" id="6008969">list</span><span class="op" id="6008973">)</span>&nbsp;<span class="op" id="6008975">&gt;</span>&nbsp;<span class="num" id="6008977">0</span>&nbsp;<span class="op" id="6008979">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008984">p</span><span class="op" id="6008985">.</span><span class="ident" id="6008986">comment</span>&nbsp;<span class="op" id="6008994">=</span>&nbsp;<span class="ident" id="6008996">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009001">p</span><span class="op" id="6009002">.</span><span class="ident" id="6009003">commentOffset</span>&nbsp;<span class="op" id="6009017">=</span>&nbsp;<span class="ident" id="6009019">p</span><span class="op" id="6009020">.</span><span class="ident" id="6009021">posFor</span><span class="op" id="6009027">(</span><span class="ident" id="6009028">list</span><span class="op" id="6009032">[</span><span class="num" id="6009033">0</span><span class="op" id="6009034">]</span><span class="op" id="6009035">.</span><span class="ident" id="6009036">Pos</span><span class="op" id="6009039">(</span><span class="op" id="6009040">)</span><span class="op" id="6009041">)</span><span class="op" id="6009042">.</span><span class="ident" id="6009043">Offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009053">p</span><span class="op" id="6009054">.</span><span class="ident" id="6009055">commentNewline</span>&nbsp;<span class="op" id="6009070">=</span>&nbsp;<span class="ident" id="6009072">p</span><span class="op" id="6009073">.</span><span class="ident" id="6009074">commentsHaveNewline</span><span class="op" id="6009093">(</span><span class="ident" id="6009094">list</span><span class="op" id="6009098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009103">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6009112">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009116">//&nbsp;we&nbsp;should&nbsp;not&nbsp;reach&nbsp;here&nbsp;(correct&nbsp;ASTs&nbsp;don&#39;t&nbsp;have&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009177">//&nbsp;ast.CommentGroup&nbsp;nodes),&nbsp;but&nbsp;be&nbsp;conservative&nbsp;and&nbsp;try&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6009240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009243">//&nbsp;no&nbsp;more&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009264">p</span><span class="op" id="6009265">.</span><span class="ident" id="6009266">commentOffset</span>&nbsp;<span class="op" id="6009280">=</span>&nbsp;<span class="ident" id="6009282">infinity</span><br>
<span class="lineno">145</span><span class="op" id="6009291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6009294">//&nbsp;commentBefore&nbsp;returns&nbsp;true&nbsp;iff&nbsp;the&nbsp;current&nbsp;comment&nbsp;group&nbsp;occurs</span><br>
<span class="lineno"></span><span class="comment" id="6009361">//&nbsp;before&nbsp;the&nbsp;next&nbsp;position&nbsp;in&nbsp;the&nbsp;source&nbsp;code&nbsp;and&nbsp;printing&nbsp;it&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="6009429">//&nbsp;not&nbsp;introduce&nbsp;implicit&nbsp;semicolons.</span><br>
<span class="lineno">150</span><span class="comment" id="6009467">//</span><br>
<span class="lineno"></span><span class="keyword" id="6009470">func</span>&nbsp;<span class="op" id="6009475">(</span><span class="ident" id="6009476">p</span>&nbsp;<span class="op" id="6009478">*</span><span class="ident" id="6009479">printer</span><span class="op" id="6009486">)</span>&nbsp;<span class="ident" id="6009488">commentBefore</span><span class="op" id="6009501">(</span><span class="ident" id="6009502">next</span>&nbsp;<span class="ident" id="6009507">token</span><span class="op" id="6009512">.</span><span class="ident" id="6009513">Position</span><span class="op" id="6009521">)</span>&nbsp;<span class="builtintype" id="6009523">bool</span>&nbsp;<span class="op" id="6009528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009531">return</span>&nbsp;<span class="ident" id="6009538">p</span><span class="op" id="6009539">.</span><span class="ident" id="6009540">commentOffset</span>&nbsp;<span class="op" id="6009554">&lt;</span>&nbsp;<span class="ident" id="6009556">next</span><span class="op" id="6009560">.</span><span class="ident" id="6009561">Offset</span>&nbsp;<span class="op" id="6009568">&amp;&amp;</span>&nbsp;<span class="op" id="6009571">(</span><span class="op" id="6009572">!</span><span class="ident" id="6009573">p</span><span class="op" id="6009574">.</span><span class="ident" id="6009575">impliedSemi</span>&nbsp;<span class="op" id="6009587">||</span>&nbsp;<span class="op" id="6009590">!</span><span class="ident" id="6009591">p</span><span class="op" id="6009592">.</span><span class="ident" id="6009593">commentNewline</span><span class="op" id="6009607">)</span><br>
<span class="lineno"></span><span class="op" id="6009609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="6009612">//&nbsp;commentSizeBefore&nbsp;returns&nbsp;the&nbsp;estimated&nbsp;size&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6009667">//&nbsp;comments&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;before&nbsp;the&nbsp;next&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="6009722">//</span><br>
<span class="lineno"></span><span class="keyword" id="6009725">func</span>&nbsp;<span class="op" id="6009730">(</span><span class="ident" id="6009731">p</span>&nbsp;<span class="op" id="6009733">*</span><span class="ident" id="6009734">printer</span><span class="op" id="6009741">)</span>&nbsp;<span class="ident" id="6009743">commentSizeBefore</span><span class="op" id="6009760">(</span><span class="ident" id="6009761">next</span>&nbsp;<span class="ident" id="6009766">token</span><span class="op" id="6009771">.</span><span class="ident" id="6009772">Position</span><span class="op" id="6009780">)</span>&nbsp;<span class="builtintype" id="6009782">int</span>&nbsp;<span class="op" id="6009786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009789">//&nbsp;save/restore&nbsp;current&nbsp;p.commentInfo&nbsp;(p.nextComment()&nbsp;modifies&nbsp;it)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009858">defer</span>&nbsp;<span class="keyword" id="6009864">func</span><span class="op" id="6009868">(</span><span class="ident" id="6009869">info</span>&nbsp;<span class="ident" id="6009874">commentInfo</span><span class="op" id="6009885">)</span>&nbsp;<span class="op" id="6009887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009891">p</span><span class="op" id="6009892">.</span><span class="ident" id="6009893">commentInfo</span>&nbsp;<span class="op" id="6009905">=</span>&nbsp;<span class="ident" id="6009907">info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6009913">}</span><span class="op" id="6009914">(</span><span class="ident" id="6009915">p</span><span class="op" id="6009916">.</span><span class="ident" id="6009917">commentInfo</span><span class="op" id="6009928">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009932">size</span>&nbsp;<span class="op" id="6009937">:=</span>&nbsp;<span class="num" id="6009940">0</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009943">for</span>&nbsp;<span class="ident" id="6009947">p</span><span class="op" id="6009948">.</span><span class="ident" id="6009949">commentBefore</span><span class="op" id="6009962">(</span><span class="ident" id="6009963">next</span><span class="op" id="6009967">)</span>&nbsp;<span class="op" id="6009969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009973">for</span>&nbsp;<span class="ident" id="6009977">_</span><span class="op" id="6009978">,</span>&nbsp;<span class="ident" id="6009980">c</span>&nbsp;<span class="op" id="6009982">:=</span>&nbsp;<span class="keyword" id="6009985">range</span>&nbsp;<span class="ident" id="6009991">p</span><span class="op" id="6009992">.</span><span class="ident" id="6009993">comment</span><span class="op" id="6010000">.</span><span class="ident" id="6010001">List</span>&nbsp;<span class="op" id="6010006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010011">size</span>&nbsp;<span class="op" id="6010016">+=</span>&nbsp;<span class="builtinfunc" id="6010019">len</span><span class="op" id="6010022">(</span><span class="ident" id="6010023">c</span><span class="op" id="6010024">.</span><span class="ident" id="6010025">Text</span><span class="op" id="6010029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6010033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010037">p</span><span class="op" id="6010038">.</span><span class="ident" id="6010039">nextComment</span><span class="op" id="6010050">(</span><span class="op" id="6010051">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6010054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010057">return</span>&nbsp;<span class="ident" id="6010064">size</span><br>
<span class="lineno"></span><span class="op" id="6010069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6010072">//&nbsp;recordLine&nbsp;records&nbsp;the&nbsp;output&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;next&nbsp;non-whitespace</span><br>
<span class="lineno">175</span><span class="comment" id="6010145">//&nbsp;token&nbsp;in&nbsp;*linePtr.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate&nbsp;line&nbsp;number&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6010219">//&nbsp;formatted&nbsp;construct,&nbsp;independent&nbsp;of&nbsp;pending&nbsp;(not&nbsp;yet&nbsp;emitted)&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="6010295">//&nbsp;or&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="6010311">//</span><br>
<span class="lineno"></span><span class="keyword" id="6010314">func</span>&nbsp;<span class="op" id="6010319">(</span><span class="ident" id="6010320">p</span>&nbsp;<span class="op" id="6010322">*</span><span class="ident" id="6010323">printer</span><span class="op" id="6010330">)</span>&nbsp;<span class="ident" id="6010332">recordLine</span><span class="op" id="6010342">(</span><span class="ident" id="6010343">linePtr</span>&nbsp;<span class="op" id="6010351">*</span><span class="builtintype" id="6010352">int</span><span class="op" id="6010355">)</span>&nbsp;<span class="op" id="6010357">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010360">p</span><span class="op" id="6010361">.</span><span class="ident" id="6010362">linePtr</span>&nbsp;<span class="op" id="6010370">=</span>&nbsp;<span class="ident" id="6010372">linePtr</span><br>
<span class="lineno"></span><span class="op" id="6010380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6010383">//&nbsp;linesFrom&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;output&nbsp;lines&nbsp;between&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="6010451">//&nbsp;output&nbsp;line&nbsp;and&nbsp;the&nbsp;line&nbsp;argument,&nbsp;ignoring&nbsp;any&nbsp;pending&nbsp;(not&nbsp;yet</span><br>
<span class="lineno">185</span><span class="comment" id="6010519">//&nbsp;emitted)&nbsp;whitespace&nbsp;or&nbsp;comments.&nbsp;It&nbsp;is&nbsp;used&nbsp;to&nbsp;compute&nbsp;an&nbsp;accurate</span><br>
<span class="lineno"></span><span class="comment" id="6010589">//&nbsp;size&nbsp;(in&nbsp;number&nbsp;of&nbsp;lines)&nbsp;for&nbsp;a&nbsp;formatted&nbsp;construct.</span><br>
<span class="lineno"></span><span class="comment" id="6010645">//</span><br>
<span class="lineno"></span><span class="keyword" id="6010648">func</span>&nbsp;<span class="op" id="6010653">(</span><span class="ident" id="6010654">p</span>&nbsp;<span class="op" id="6010656">*</span><span class="ident" id="6010657">printer</span><span class="op" id="6010664">)</span>&nbsp;<span class="ident" id="6010666">linesFrom</span><span class="op" id="6010675">(</span><span class="ident" id="6010676">line</span>&nbsp;<span class="builtintype" id="6010681">int</span><span class="op" id="6010684">)</span>&nbsp;<span class="builtintype" id="6010686">int</span>&nbsp;<span class="op" id="6010690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010693">return</span>&nbsp;<span class="ident" id="6010700">p</span><span class="op" id="6010701">.</span><span class="ident" id="6010702">out</span><span class="op" id="6010705">.</span><span class="ident" id="6010706">Line</span>&nbsp;<span class="op" id="6010711">-</span>&nbsp;<span class="ident" id="6010713">line</span><br>
<span class="lineno">190</span><span class="op" id="6010718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6010721">func</span>&nbsp;<span class="op" id="6010726">(</span><span class="ident" id="6010727">p</span>&nbsp;<span class="op" id="6010729">*</span><span class="ident" id="6010730">printer</span><span class="op" id="6010737">)</span>&nbsp;<span class="ident" id="6010739">posFor</span><span class="op" id="6010745">(</span><span class="ident" id="6010746">pos</span>&nbsp;<span class="ident" id="6010750">token</span><span class="op" id="6010755">.</span><span class="ident" id="6010756">Pos</span><span class="op" id="6010759">)</span>&nbsp;<span class="ident" id="6010761">token</span><span class="op" id="6010766">.</span><span class="ident" id="6010767">Position</span>&nbsp;<span class="op" id="6010776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6010779">//&nbsp;not&nbsp;used&nbsp;frequently&nbsp;enough&nbsp;to&nbsp;cache&nbsp;entire&nbsp;token.Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010841">return</span>&nbsp;<span class="ident" id="6010848">p</span><span class="op" id="6010849">.</span><span class="ident" id="6010850">fset</span><span class="op" id="6010854">.</span><span class="ident" id="6010855">Position</span><span class="op" id="6010863">(</span><span class="ident" id="6010864">pos</span><span class="op" id="6010867">)</span><br>
<span class="lineno">195</span><span class="op" id="6010869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6010872">func</span>&nbsp;<span class="op" id="6010877">(</span><span class="ident" id="6010878">p</span>&nbsp;<span class="op" id="6010880">*</span><span class="ident" id="6010881">printer</span><span class="op" id="6010888">)</span>&nbsp;<span class="ident" id="6010890">lineFor</span><span class="op" id="6010897">(</span><span class="ident" id="6010898">pos</span>&nbsp;<span class="ident" id="6010902">token</span><span class="op" id="6010907">.</span><span class="ident" id="6010908">Pos</span><span class="op" id="6010911">)</span>&nbsp;<span class="builtintype" id="6010913">int</span>&nbsp;<span class="op" id="6010917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010920">if</span>&nbsp;<span class="ident" id="6010923">pos</span>&nbsp;<span class="op" id="6010927">!=</span>&nbsp;<span class="ident" id="6010930">p</span><span class="op" id="6010931">.</span><span class="ident" id="6010932">cachedPos</span>&nbsp;<span class="op" id="6010942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010946">p</span><span class="op" id="6010947">.</span><span class="ident" id="6010948">cachedPos</span>&nbsp;<span class="op" id="6010958">=</span>&nbsp;<span class="ident" id="6010960">pos</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010966">p</span><span class="op" id="6010967">.</span><span class="ident" id="6010968">cachedLine</span>&nbsp;<span class="op" id="6010979">=</span>&nbsp;<span class="ident" id="6010981">p</span><span class="op" id="6010982">.</span><span class="ident" id="6010983">fset</span><span class="op" id="6010987">.</span><span class="ident" id="6010988">Position</span><span class="op" id="6010996">(</span><span class="ident" id="6010997">pos</span><span class="op" id="6011000">)</span><span class="op" id="6011001">.</span><span class="ident" id="6011002">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011011">return</span>&nbsp;<span class="ident" id="6011018">p</span><span class="op" id="6011019">.</span><span class="ident" id="6011020">cachedLine</span><br>
<span class="lineno"></span><span class="op" id="6011031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="6011034">//&nbsp;atLineBegin&nbsp;emits&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary&nbsp;and&nbsp;prints&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="keyword" id="6011109">func</span>&nbsp;<span class="op" id="6011114">(</span><span class="ident" id="6011115">p</span>&nbsp;<span class="op" id="6011117">*</span><span class="ident" id="6011118">printer</span><span class="op" id="6011125">)</span>&nbsp;<span class="ident" id="6011127">atLineBegin</span><span class="op" id="6011138">(</span><span class="ident" id="6011139">pos</span>&nbsp;<span class="ident" id="6011143">token</span><span class="op" id="6011148">.</span><span class="ident" id="6011149">Position</span><span class="op" id="6011157">)</span>&nbsp;<span class="op" id="6011159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011162">//&nbsp;write&nbsp;a&nbsp;//line&nbsp;comment&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011202">if</span>&nbsp;<span class="ident" id="6011205">p</span><span class="op" id="6011206">.</span><span class="ident" id="6011207">Config</span><span class="op" id="6011213">.</span><span class="ident" id="6011214">Mode</span><span class="op" id="6011218">&amp;</span><span class="ident" id="6011219">SourcePos</span>&nbsp;<span class="op" id="6011229">!=</span>&nbsp;<span class="num" id="6011232">0</span>&nbsp;<span class="op" id="6011234">&amp;&amp;</span>&nbsp;<span class="ident" id="6011237">pos</span><span class="op" id="6011240">.</span><span class="ident" id="6011241">IsValid</span><span class="op" id="6011248">(</span><span class="op" id="6011249">)</span>&nbsp;<span class="op" id="6011251">&amp;&amp;</span>&nbsp;<span class="op" id="6011254">(</span><span class="ident" id="6011255">p</span><span class="op" id="6011256">.</span><span class="ident" id="6011257">out</span><span class="op" id="6011260">.</span><span class="ident" id="6011261">Line</span>&nbsp;<span class="op" id="6011266">!=</span>&nbsp;<span class="ident" id="6011269">pos</span><span class="op" id="6011272">.</span><span class="ident" id="6011273">Line</span>&nbsp;<span class="op" id="6011278">||</span>&nbsp;<span class="ident" id="6011281">p</span><span class="op" id="6011282">.</span><span class="ident" id="6011283">out</span><span class="op" id="6011286">.</span><span class="ident" id="6011287">Filename</span>&nbsp;<span class="op" id="6011296">!=</span>&nbsp;<span class="ident" id="6011299">pos</span><span class="op" id="6011302">.</span><span class="ident" id="6011303">Filename</span><span class="op" id="6011311">)</span>&nbsp;<span class="op" id="6011313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011317">p</span><span class="op" id="6011318">.</span><span class="ident" id="6011319">output</span>&nbsp;<span class="op" id="6011326">=</span>&nbsp;<span class="builtinfunc" id="6011328">append</span><span class="op" id="6011334">(</span><span class="ident" id="6011335">p</span><span class="op" id="6011336">.</span><span class="ident" id="6011337">output</span><span class="op" id="6011343">,</span>&nbsp;<span class="ident" id="6011345">tabwriter</span><span class="op" id="6011354">.</span><span class="ident" id="6011355">Escape</span><span class="op" id="6011361">)</span>&nbsp;<span class="comment" id="6011363">//&nbsp;protect&nbsp;&#39;\n&#39;&nbsp;in&nbsp;//line&nbsp;from&nbsp;tabwriter&nbsp;interpretation</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011421">p</span><span class="op" id="6011422">.</span><span class="ident" id="6011423">output</span>&nbsp;<span class="op" id="6011430">=</span>&nbsp;<span class="builtinfunc" id="6011432">append</span><span class="op" id="6011438">(</span><span class="ident" id="6011439">p</span><span class="op" id="6011440">.</span><span class="ident" id="6011441">output</span><span class="op" id="6011447">,</span>&nbsp;<span class="ident" id="6011449">fmt</span><span class="op" id="6011452">.</span><span class="ident" id="6011453">Sprintf</span><span class="op" id="6011460">(</span><span class="string" id="6011461">&#34;//line&nbsp;%s:%d\n&#34;</span><span class="op" id="6011477">,</span>&nbsp;<span class="ident" id="6011479">pos</span><span class="op" id="6011482">.</span><span class="ident" id="6011483">Filename</span><span class="op" id="6011491">,</span>&nbsp;<span class="ident" id="6011493">pos</span><span class="op" id="6011496">.</span><span class="ident" id="6011497">Line</span><span class="op" id="6011501">)</span><span class="op" id="6011502">...</span><span class="op" id="6011505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011509">p</span><span class="op" id="6011510">.</span><span class="ident" id="6011511">output</span>&nbsp;<span class="op" id="6011518">=</span>&nbsp;<span class="builtinfunc" id="6011520">append</span><span class="op" id="6011526">(</span><span class="ident" id="6011527">p</span><span class="op" id="6011528">.</span><span class="ident" id="6011529">output</span><span class="op" id="6011535">,</span>&nbsp;<span class="ident" id="6011537">tabwriter</span><span class="op" id="6011546">.</span><span class="ident" id="6011547">Escape</span><span class="op" id="6011553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011557">//&nbsp;p.out&nbsp;must&nbsp;match&nbsp;the&nbsp;//line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011598">p</span><span class="op" id="6011599">.</span><span class="ident" id="6011600">out</span><span class="op" id="6011603">.</span><span class="ident" id="6011604">Filename</span>&nbsp;<span class="op" id="6011613">=</span>&nbsp;<span class="ident" id="6011615">pos</span><span class="op" id="6011618">.</span><span class="ident" id="6011619">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011630">p</span><span class="op" id="6011631">.</span><span class="ident" id="6011632">out</span><span class="op" id="6011635">.</span><span class="ident" id="6011636">Line</span>&nbsp;<span class="op" id="6011641">=</span>&nbsp;<span class="ident" id="6011643">pos</span><span class="op" id="6011646">.</span><span class="ident" id="6011647">Line</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011657">//&nbsp;write&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011679">//&nbsp;use&nbsp;&#34;hard&#34;&nbsp;htabs&nbsp;-&nbsp;indentation&nbsp;columns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011722">//&nbsp;must&nbsp;not&nbsp;be&nbsp;discarded&nbsp;by&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011765">n</span>&nbsp;<span class="op" id="6011767">:=</span>&nbsp;<span class="ident" id="6011770">p</span><span class="op" id="6011771">.</span><span class="ident" id="6011772">Config</span><span class="op" id="6011778">.</span><span class="ident" id="6011779">Indent</span>&nbsp;<span class="op" id="6011786">+</span>&nbsp;<span class="ident" id="6011788">p</span><span class="op" id="6011789">.</span><span class="ident" id="6011790">indent</span>&nbsp;<span class="comment" id="6011797">//&nbsp;include&nbsp;base&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011826">for</span>&nbsp;<span class="ident" id="6011830">i</span>&nbsp;<span class="op" id="6011832">:=</span>&nbsp;<span class="num" id="6011835">0</span><span class="op" id="6011836">;</span>&nbsp;<span class="ident" id="6011838">i</span>&nbsp;<span class="op" id="6011840">&lt;</span>&nbsp;<span class="ident" id="6011842">n</span><span class="op" id="6011843">;</span>&nbsp;<span class="ident" id="6011845">i</span><span class="op" id="6011846">++</span>&nbsp;<span class="op" id="6011849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011853">p</span><span class="op" id="6011854">.</span><span class="ident" id="6011855">output</span>&nbsp;<span class="op" id="6011862">=</span>&nbsp;<span class="builtinfunc" id="6011864">append</span><span class="op" id="6011870">(</span><span class="ident" id="6011871">p</span><span class="op" id="6011872">.</span><span class="ident" id="6011873">output</span><span class="op" id="6011879">,</span>&nbsp;<span class="string" id="6011881">&#39;\t&#39;</span><span class="op" id="6011885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011892">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011913">p</span><span class="op" id="6011914">.</span><span class="ident" id="6011915">pos</span><span class="op" id="6011918">.</span><span class="ident" id="6011919">Offset</span>&nbsp;<span class="op" id="6011926">+=</span>&nbsp;<span class="ident" id="6011929">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011932">p</span><span class="op" id="6011933">.</span><span class="ident" id="6011934">pos</span><span class="op" id="6011937">.</span><span class="ident" id="6011938">Column</span>&nbsp;<span class="op" id="6011945">+=</span>&nbsp;<span class="ident" id="6011948">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011951">p</span><span class="op" id="6011952">.</span><span class="ident" id="6011953">out</span><span class="op" id="6011956">.</span><span class="ident" id="6011957">Column</span>&nbsp;<span class="op" id="6011964">+=</span>&nbsp;<span class="ident" id="6011967">n</span><br>
<span class="lineno"></span><span class="op" id="6011969">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="6011972">//&nbsp;writeByte&nbsp;writes&nbsp;ch&nbsp;n&nbsp;times&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos.</span><br>
<span class="lineno"></span><span class="keyword" id="6012034">func</span>&nbsp;<span class="op" id="6012039">(</span><span class="ident" id="6012040">p</span>&nbsp;<span class="op" id="6012042">*</span><span class="ident" id="6012043">printer</span><span class="op" id="6012050">)</span>&nbsp;<span class="ident" id="6012052">writeByte</span><span class="op" id="6012061">(</span><span class="ident" id="6012062">ch</span>&nbsp;<span class="builtintype" id="6012065">byte</span><span class="op" id="6012069">,</span>&nbsp;<span class="ident" id="6012071">n</span>&nbsp;<span class="builtintype" id="6012073">int</span><span class="op" id="6012076">)</span>&nbsp;<span class="op" id="6012078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012081">if</span>&nbsp;<span class="ident" id="6012084">p</span><span class="op" id="6012085">.</span><span class="ident" id="6012086">out</span><span class="op" id="6012089">.</span><span class="ident" id="6012090">Column</span>&nbsp;<span class="op" id="6012097">==</span>&nbsp;<span class="num" id="6012100">1</span>&nbsp;<span class="op" id="6012102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012106">p</span><span class="op" id="6012107">.</span><span class="ident" id="6012108">atLineBegin</span><span class="op" id="6012119">(</span><span class="ident" id="6012120">p</span><span class="op" id="6012121">.</span><span class="ident" id="6012122">pos</span><span class="op" id="6012125">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012132">for</span>&nbsp;<span class="ident" id="6012136">i</span>&nbsp;<span class="op" id="6012138">:=</span>&nbsp;<span class="num" id="6012141">0</span><span class="op" id="6012142">;</span>&nbsp;<span class="ident" id="6012144">i</span>&nbsp;<span class="op" id="6012146">&lt;</span>&nbsp;<span class="ident" id="6012148">n</span><span class="op" id="6012149">;</span>&nbsp;<span class="ident" id="6012151">i</span><span class="op" id="6012152">++</span>&nbsp;<span class="op" id="6012155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012159">p</span><span class="op" id="6012160">.</span><span class="ident" id="6012161">output</span>&nbsp;<span class="op" id="6012168">=</span>&nbsp;<span class="builtinfunc" id="6012170">append</span><span class="op" id="6012176">(</span><span class="ident" id="6012177">p</span><span class="op" id="6012178">.</span><span class="ident" id="6012179">output</span><span class="op" id="6012185">,</span>&nbsp;<span class="ident" id="6012187">ch</span><span class="op" id="6012189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012192">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012196">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012217">p</span><span class="op" id="6012218">.</span><span class="ident" id="6012219">pos</span><span class="op" id="6012222">.</span><span class="ident" id="6012223">Offset</span>&nbsp;<span class="op" id="6012230">+=</span>&nbsp;<span class="ident" id="6012233">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012236">if</span>&nbsp;<span class="ident" id="6012239">ch</span>&nbsp;<span class="op" id="6012242">==</span>&nbsp;<span class="string" id="6012245">&#39;\n&#39;</span>&nbsp;<span class="op" id="6012250">||</span>&nbsp;<span class="ident" id="6012253">ch</span>&nbsp;<span class="op" id="6012256">==</span>&nbsp;<span class="string" id="6012259">&#39;\f&#39;</span>&nbsp;<span class="op" id="6012264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012268">p</span><span class="op" id="6012269">.</span><span class="ident" id="6012270">pos</span><span class="op" id="6012273">.</span><span class="ident" id="6012274">Line</span>&nbsp;<span class="op" id="6012279">+=</span>&nbsp;<span class="ident" id="6012282">n</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012286">p</span><span class="op" id="6012287">.</span><span class="ident" id="6012288">out</span><span class="op" id="6012291">.</span><span class="ident" id="6012292">Line</span>&nbsp;<span class="op" id="6012297">+=</span>&nbsp;<span class="ident" id="6012300">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012304">p</span><span class="op" id="6012305">.</span><span class="ident" id="6012306">pos</span><span class="op" id="6012309">.</span><span class="ident" id="6012310">Column</span>&nbsp;<span class="op" id="6012317">=</span>&nbsp;<span class="num" id="6012319">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012323">p</span><span class="op" id="6012324">.</span><span class="ident" id="6012325">out</span><span class="op" id="6012328">.</span><span class="ident" id="6012329">Column</span>&nbsp;<span class="op" id="6012336">=</span>&nbsp;<span class="num" id="6012338">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012342">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012350">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012353">p</span><span class="op" id="6012354">.</span><span class="ident" id="6012355">pos</span><span class="op" id="6012358">.</span><span class="ident" id="6012359">Column</span>&nbsp;<span class="op" id="6012366">+=</span>&nbsp;<span class="ident" id="6012369">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012372">p</span><span class="op" id="6012373">.</span><span class="ident" id="6012374">out</span><span class="op" id="6012377">.</span><span class="ident" id="6012378">Column</span>&nbsp;<span class="op" id="6012385">+=</span>&nbsp;<span class="ident" id="6012388">n</span><br>
<span class="lineno"></span><span class="op" id="6012390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6012393">//&nbsp;writeString&nbsp;writes&nbsp;the&nbsp;string&nbsp;s&nbsp;to&nbsp;p.output&nbsp;and&nbsp;updates&nbsp;p.pos,&nbsp;p.out,</span><br>
<span class="lineno">255</span><span class="comment" id="6012466">//&nbsp;and&nbsp;p.last.&nbsp;If&nbsp;isLit&nbsp;is&nbsp;set,&nbsp;s&nbsp;is&nbsp;escaped&nbsp;w/&nbsp;tabwriter.Escape&nbsp;characters</span><br>
<span class="lineno"></span><span class="comment" id="6012542">//&nbsp;to&nbsp;protect&nbsp;s&nbsp;from&nbsp;being&nbsp;interpreted&nbsp;by&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><span class="comment" id="6012599">//</span><br>
<span class="lineno"></span><span class="comment" id="6012602">//&nbsp;Note:&nbsp;writeString&nbsp;is&nbsp;only&nbsp;used&nbsp;to&nbsp;write&nbsp;Go&nbsp;tokens,&nbsp;literals,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6012670">//&nbsp;comments,&nbsp;all&nbsp;of&nbsp;which&nbsp;must&nbsp;be&nbsp;written&nbsp;literally.&nbsp;Thus,&nbsp;it&nbsp;is&nbsp;correct</span><br>
<span class="lineno">260</span><span class="comment" id="6012743">//&nbsp;to&nbsp;always&nbsp;set&nbsp;isLit&nbsp;=&nbsp;true.&nbsp;However,&nbsp;setting&nbsp;it&nbsp;explicitly&nbsp;only&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="6012815">//&nbsp;needed&nbsp;(i.e.,&nbsp;when&nbsp;we&nbsp;don&#39;t&nbsp;know&nbsp;that&nbsp;s&nbsp;contains&nbsp;no&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks)</span><br>
<span class="lineno"></span><span class="comment" id="6012891">//&nbsp;avoids&nbsp;processing&nbsp;extra&nbsp;escape&nbsp;characters&nbsp;and&nbsp;reduces&nbsp;run&nbsp;time&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6012964">//&nbsp;printer&nbsp;benchmark&nbsp;by&nbsp;up&nbsp;to&nbsp;10%.</span><br>
<span class="lineno"></span><span class="comment" id="6012999">//</span><br>
<span class="lineno">265</span><span class="keyword" id="6013002">func</span>&nbsp;<span class="op" id="6013007">(</span><span class="ident" id="6013008">p</span>&nbsp;<span class="op" id="6013010">*</span><span class="ident" id="6013011">printer</span><span class="op" id="6013018">)</span>&nbsp;<span class="ident" id="6013020">writeString</span><span class="op" id="6013031">(</span><span class="ident" id="6013032">pos</span>&nbsp;<span class="ident" id="6013036">token</span><span class="op" id="6013041">.</span><span class="ident" id="6013042">Position</span><span class="op" id="6013050">,</span>&nbsp;<span class="ident" id="6013052">s</span>&nbsp;<span class="builtintype" id="6013054">string</span><span class="op" id="6013060">,</span>&nbsp;<span class="ident" id="6013062">isLit</span>&nbsp;<span class="builtintype" id="6013068">bool</span><span class="op" id="6013072">)</span>&nbsp;<span class="op" id="6013074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013077">if</span>&nbsp;<span class="ident" id="6013080">p</span><span class="op" id="6013081">.</span><span class="ident" id="6013082">out</span><span class="op" id="6013085">.</span><span class="ident" id="6013086">Column</span>&nbsp;<span class="op" id="6013093">==</span>&nbsp;<span class="num" id="6013096">1</span>&nbsp;<span class="op" id="6013098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013102">p</span><span class="op" id="6013103">.</span><span class="ident" id="6013104">atLineBegin</span><span class="op" id="6013115">(</span><span class="ident" id="6013116">pos</span><span class="op" id="6013119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6013122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013126">if</span>&nbsp;<span class="ident" id="6013129">pos</span><span class="op" id="6013132">.</span><span class="ident" id="6013133">IsValid</span><span class="op" id="6013140">(</span><span class="op" id="6013141">)</span>&nbsp;<span class="op" id="6013143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013147">//&nbsp;update&nbsp;p.pos&nbsp;(if&nbsp;pos&nbsp;is&nbsp;invalid,&nbsp;continue&nbsp;with&nbsp;existing&nbsp;p.pos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013215">//&nbsp;Note:&nbsp;Must&nbsp;do&nbsp;this&nbsp;after&nbsp;handling&nbsp;line&nbsp;beginnings&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013278">//&nbsp;atLineBegin&nbsp;updates&nbsp;p.pos&nbsp;if&nbsp;there&#39;s&nbsp;indentation,&nbsp;but&nbsp;p.pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013343">//&nbsp;is&nbsp;the&nbsp;position&nbsp;of&nbsp;s.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013370">p</span><span class="op" id="6013371">.</span><span class="ident" id="6013372">pos</span>&nbsp;<span class="op" id="6013376">=</span>&nbsp;<span class="ident" id="6013378">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6013383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013387">if</span>&nbsp;<span class="ident" id="6013390">isLit</span>&nbsp;<span class="op" id="6013396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013400">//&nbsp;Protect&nbsp;s&nbsp;such&nbsp;that&nbsp;is&nbsp;passes&nbsp;through&nbsp;the&nbsp;tabwriter</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013457">//&nbsp;unchanged.&nbsp;Note&nbsp;that&nbsp;valid&nbsp;Go&nbsp;programs&nbsp;cannot&nbsp;contain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013516">//&nbsp;tabwriter.Escape&nbsp;bytes&nbsp;since&nbsp;they&nbsp;do&nbsp;not&nbsp;appear&nbsp;in&nbsp;legal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013578">//&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013600">p</span><span class="op" id="6013601">.</span><span class="ident" id="6013602">output</span>&nbsp;<span class="op" id="6013609">=</span>&nbsp;<span class="builtinfunc" id="6013611">append</span><span class="op" id="6013617">(</span><span class="ident" id="6013618">p</span><span class="op" id="6013619">.</span><span class="ident" id="6013620">output</span><span class="op" id="6013626">,</span>&nbsp;<span class="ident" id="6013628">tabwriter</span><span class="op" id="6013637">.</span><span class="ident" id="6013638">Escape</span><span class="op" id="6013644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6013647">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013651">if</span>&nbsp;<span class="ident" id="6013654">debug</span>&nbsp;<span class="op" id="6013660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013664">p</span><span class="op" id="6013665">.</span><span class="ident" id="6013666">output</span>&nbsp;<span class="op" id="6013673">=</span>&nbsp;<span class="builtinfunc" id="6013675">append</span><span class="op" id="6013681">(</span><span class="ident" id="6013682">p</span><span class="op" id="6013683">.</span><span class="ident" id="6013684">output</span><span class="op" id="6013690">,</span>&nbsp;<span class="ident" id="6013692">fmt</span><span class="op" id="6013695">.</span><span class="ident" id="6013696">Sprintf</span><span class="op" id="6013703">(</span><span class="string" id="6013704">&#34;/*%s*/&#34;</span><span class="op" id="6013712">,</span>&nbsp;<span class="ident" id="6013714">pos</span><span class="op" id="6013717">)</span><span class="op" id="6013718">...</span><span class="op" id="6013721">)</span>&nbsp;<span class="comment" id="6013723">//&nbsp;do&nbsp;not&nbsp;update&nbsp;p.pos!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6013748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013751">p</span><span class="op" id="6013752">.</span><span class="ident" id="6013753">output</span>&nbsp;<span class="op" id="6013760">=</span>&nbsp;<span class="builtinfunc" id="6013762">append</span><span class="op" id="6013768">(</span><span class="ident" id="6013769">p</span><span class="op" id="6013770">.</span><span class="ident" id="6013771">output</span><span class="op" id="6013777">,</span>&nbsp;<span class="ident" id="6013779">s</span><span class="op" id="6013780">...</span><span class="op" id="6013783">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013787">//&nbsp;update&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013808">nlines</span>&nbsp;<span class="op" id="6013815">:=</span>&nbsp;<span class="num" id="6013818">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013821">var</span>&nbsp;<span class="ident" id="6013825">li</span>&nbsp;<span class="builtintype" id="6013828">int</span>&nbsp;<span class="comment" id="6013832">//&nbsp;index&nbsp;of&nbsp;last&nbsp;newline;&nbsp;valid&nbsp;if&nbsp;nlines&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013879">for</span>&nbsp;<span class="ident" id="6013883">i</span>&nbsp;<span class="op" id="6013885">:=</span>&nbsp;<span class="num" id="6013888">0</span><span class="op" id="6013889">;</span>&nbsp;<span class="ident" id="6013891">i</span>&nbsp;<span class="op" id="6013893">&lt;</span>&nbsp;<span class="builtinfunc" id="6013895">len</span><span class="op" id="6013898">(</span><span class="ident" id="6013899">s</span><span class="op" id="6013900">)</span><span class="op" id="6013901">;</span>&nbsp;<span class="ident" id="6013903">i</span><span class="op" id="6013904">++</span>&nbsp;<span class="op" id="6013907">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013911">//&nbsp;Go&nbsp;tokens&nbsp;cannot&nbsp;contain&nbsp;&#39;\f&#39;&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013971">if</span>&nbsp;<span class="ident" id="6013974">s</span><span class="op" id="6013975">[</span><span class="ident" id="6013976">i</span><span class="op" id="6013977">]</span>&nbsp;<span class="op" id="6013979">==</span>&nbsp;<span class="string" id="6013982">&#39;\n&#39;</span>&nbsp;<span class="op" id="6013987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013992">nlines</span><span class="op" id="6013998">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014004">li</span>&nbsp;<span class="op" id="6014007">=</span>&nbsp;<span class="ident" id="6014009">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6014013">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6014016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014019">p</span><span class="op" id="6014020">.</span><span class="ident" id="6014021">pos</span><span class="op" id="6014024">.</span><span class="ident" id="6014025">Offset</span>&nbsp;<span class="op" id="6014032">+=</span>&nbsp;<span class="builtinfunc" id="6014035">len</span><span class="op" id="6014038">(</span><span class="ident" id="6014039">s</span><span class="op" id="6014040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014043">if</span>&nbsp;<span class="ident" id="6014046">nlines</span>&nbsp;<span class="op" id="6014053">&gt;</span>&nbsp;<span class="num" id="6014055">0</span>&nbsp;<span class="op" id="6014057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014061">p</span><span class="op" id="6014062">.</span><span class="ident" id="6014063">pos</span><span class="op" id="6014066">.</span><span class="ident" id="6014067">Line</span>&nbsp;<span class="op" id="6014072">+=</span>&nbsp;<span class="ident" id="6014075">nlines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014084">p</span><span class="op" id="6014085">.</span><span class="ident" id="6014086">out</span><span class="op" id="6014089">.</span><span class="ident" id="6014090">Line</span>&nbsp;<span class="op" id="6014095">+=</span>&nbsp;<span class="ident" id="6014098">nlines</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014107">c</span>&nbsp;<span class="op" id="6014109">:=</span>&nbsp;<span class="builtinfunc" id="6014112">len</span><span class="op" id="6014115">(</span><span class="ident" id="6014116">s</span><span class="op" id="6014117">)</span>&nbsp;<span class="op" id="6014119">-</span>&nbsp;<span class="ident" id="6014121">li</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014126">p</span><span class="op" id="6014127">.</span><span class="ident" id="6014128">pos</span><span class="op" id="6014131">.</span><span class="ident" id="6014132">Column</span>&nbsp;<span class="op" id="6014139">=</span>&nbsp;<span class="ident" id="6014141">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014145">p</span><span class="op" id="6014146">.</span><span class="ident" id="6014147">out</span><span class="op" id="6014150">.</span><span class="ident" id="6014151">Column</span>&nbsp;<span class="op" id="6014158">=</span>&nbsp;<span class="ident" id="6014160">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6014163">}</span>&nbsp;<span class="keyword" id="6014165">else</span>&nbsp;<span class="op" id="6014170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014174">p</span><span class="op" id="6014175">.</span><span class="ident" id="6014176">pos</span><span class="op" id="6014179">.</span><span class="ident" id="6014180">Column</span>&nbsp;<span class="op" id="6014187">+=</span>&nbsp;<span class="builtinfunc" id="6014190">len</span><span class="op" id="6014193">(</span><span class="ident" id="6014194">s</span><span class="op" id="6014195">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014199">p</span><span class="op" id="6014200">.</span><span class="ident" id="6014201">out</span><span class="op" id="6014204">.</span><span class="ident" id="6014205">Column</span>&nbsp;<span class="op" id="6014212">+=</span>&nbsp;<span class="builtinfunc" id="6014215">len</span><span class="op" id="6014218">(</span><span class="ident" id="6014219">s</span><span class="op" id="6014220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6014223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014227">if</span>&nbsp;<span class="ident" id="6014230">isLit</span>&nbsp;<span class="op" id="6014236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014240">p</span><span class="op" id="6014241">.</span><span class="ident" id="6014242">output</span>&nbsp;<span class="op" id="6014249">=</span>&nbsp;<span class="builtinfunc" id="6014251">append</span><span class="op" id="6014257">(</span><span class="ident" id="6014258">p</span><span class="op" id="6014259">.</span><span class="ident" id="6014260">output</span><span class="op" id="6014266">,</span>&nbsp;<span class="ident" id="6014268">tabwriter</span><span class="op" id="6014277">.</span><span class="ident" id="6014278">Escape</span><span class="op" id="6014284">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6014287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014291">p</span><span class="op" id="6014292">.</span><span class="ident" id="6014293">last</span>&nbsp;<span class="op" id="6014298">=</span>&nbsp;<span class="ident" id="6014300">p</span><span class="op" id="6014301">.</span><span class="ident" id="6014302">pos</span><br>
<span class="lineno"></span><span class="op" id="6014306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="comment" id="6014309">//&nbsp;writeCommentPrefix&nbsp;writes&nbsp;the&nbsp;whitespace&nbsp;before&nbsp;a&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="6014371">//&nbsp;If&nbsp;there&nbsp;is&nbsp;any&nbsp;pending&nbsp;whitespace,&nbsp;it&nbsp;consumes&nbsp;as&nbsp;much&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6014433">//&nbsp;it&nbsp;as&nbsp;is&nbsp;likely&nbsp;to&nbsp;help&nbsp;position&nbsp;the&nbsp;comment&nbsp;nicely.</span><br>
<span class="lineno"></span><span class="comment" id="6014489">//&nbsp;pos&nbsp;is&nbsp;the&nbsp;comment&nbsp;position,&nbsp;next&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;item</span><br>
<span class="lineno"></span><span class="comment" id="6014551">//&nbsp;after&nbsp;all&nbsp;pending&nbsp;comments,&nbsp;prev&nbsp;is&nbsp;the&nbsp;previous&nbsp;comment&nbsp;in</span><br>
<span class="lineno">325</span><span class="comment" id="6014614">//&nbsp;a&nbsp;group&nbsp;of&nbsp;comments&nbsp;(or&nbsp;nil),&nbsp;and&nbsp;tok&nbsp;is&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="6014674">//</span><br>
<span class="lineno"></span><span class="keyword" id="6014677">func</span>&nbsp;<span class="op" id="6014682">(</span><span class="ident" id="6014683">p</span>&nbsp;<span class="op" id="6014685">*</span><span class="ident" id="6014686">printer</span><span class="op" id="6014693">)</span>&nbsp;<span class="ident" id="6014695">writeCommentPrefix</span><span class="op" id="6014713">(</span><span class="ident" id="6014714">pos</span><span class="op" id="6014717">,</span>&nbsp;<span class="ident" id="6014719">next</span>&nbsp;<span class="ident" id="6014724">token</span><span class="op" id="6014729">.</span><span class="ident" id="6014730">Position</span><span class="op" id="6014738">,</span>&nbsp;<span class="ident" id="6014740">prev</span><span class="op" id="6014744">,</span>&nbsp;<span class="ident" id="6014746">comment</span>&nbsp;<span class="op" id="6014754">*</span><span class="ident" id="6014755">ast</span><span class="op" id="6014758">.</span><span class="ident" id="6014759">Comment</span><span class="op" id="6014766">,</span>&nbsp;<span class="ident" id="6014768">tok</span>&nbsp;<span class="ident" id="6014772">token</span><span class="op" id="6014777">.</span><span class="ident" id="6014778">Token</span><span class="op" id="6014783">)</span>&nbsp;<span class="op" id="6014785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014788">if</span>&nbsp;<span class="builtinfunc" id="6014791">len</span><span class="op" id="6014794">(</span><span class="ident" id="6014795">p</span><span class="op" id="6014796">.</span><span class="ident" id="6014797">output</span><span class="op" id="6014803">)</span>&nbsp;<span class="op" id="6014805">==</span>&nbsp;<span class="num" id="6014808">0</span>&nbsp;<span class="op" id="6014810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6014814">//&nbsp;the&nbsp;comment&nbsp;is&nbsp;the&nbsp;first&nbsp;item&nbsp;to&nbsp;be&nbsp;printed&nbsp;-&nbsp;don&#39;t&nbsp;write&nbsp;any&nbsp;whitespace</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014892">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6014900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014904">if</span>&nbsp;<span class="ident" id="6014907">pos</span><span class="op" id="6014910">.</span><span class="ident" id="6014911">IsValid</span><span class="op" id="6014918">(</span><span class="op" id="6014919">)</span>&nbsp;<span class="op" id="6014921">&amp;&amp;</span>&nbsp;<span class="ident" id="6014924">pos</span><span class="op" id="6014927">.</span><span class="ident" id="6014928">Filename</span>&nbsp;<span class="op" id="6014937">!=</span>&nbsp;<span class="ident" id="6014940">p</span><span class="op" id="6014941">.</span><span class="ident" id="6014942">last</span><span class="op" id="6014946">.</span><span class="ident" id="6014947">Filename</span>&nbsp;<span class="op" id="6014956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6014960">//&nbsp;comment&nbsp;in&nbsp;a&nbsp;different&nbsp;file&nbsp;-&nbsp;separate&nbsp;with&nbsp;newlines</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015018">p</span><span class="op" id="6015019">.</span><span class="ident" id="6015020">writeByte</span><span class="op" id="6015029">(</span><span class="string" id="6015030">&#39;\f&#39;</span><span class="op" id="6015034">,</span>&nbsp;<span class="ident" id="6015036">maxNewlines</span><span class="op" id="6015047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015051">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015063">if</span>&nbsp;<span class="ident" id="6015066">pos</span><span class="op" id="6015069">.</span><span class="ident" id="6015070">Line</span>&nbsp;<span class="op" id="6015075">==</span>&nbsp;<span class="ident" id="6015078">p</span><span class="op" id="6015079">.</span><span class="ident" id="6015080">last</span><span class="op" id="6015084">.</span><span class="ident" id="6015085">Line</span>&nbsp;<span class="op" id="6015090">&amp;&amp;</span>&nbsp;<span class="op" id="6015093">(</span><span class="ident" id="6015094">prev</span>&nbsp;<span class="op" id="6015099">==</span>&nbsp;<span class="ident" id="6015102">nil</span>&nbsp;<span class="op" id="6015106">||</span>&nbsp;<span class="ident" id="6015109">prev</span><span class="op" id="6015113">.</span><span class="ident" id="6015114">Text</span><span class="op" id="6015118">[</span><span class="num" id="6015119">1</span><span class="op" id="6015120">]</span>&nbsp;<span class="op" id="6015122">!=</span>&nbsp;<span class="string" id="6015125">&#39;/&#39;</span><span class="op" id="6015128">)</span>&nbsp;<span class="op" id="6015130">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015134">//&nbsp;comment&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;last&nbsp;item:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015178">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015220">hasSep</span>&nbsp;<span class="op" id="6015227">:=</span>&nbsp;<span class="builtintype" id="6015230">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015238">if</span>&nbsp;<span class="ident" id="6015241">prev</span>&nbsp;<span class="op" id="6015246">==</span>&nbsp;<span class="ident" id="6015249">nil</span>&nbsp;<span class="op" id="6015253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015258">//&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;comment&nbsp;group</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015297">j</span>&nbsp;<span class="op" id="6015299">:=</span>&nbsp;<span class="num" id="6015302">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015307">for</span>&nbsp;<span class="ident" id="6015311">i</span><span class="op" id="6015312">,</span>&nbsp;<span class="ident" id="6015314">ch</span>&nbsp;<span class="op" id="6015317">:=</span>&nbsp;<span class="keyword" id="6015320">range</span>&nbsp;<span class="ident" id="6015326">p</span><span class="op" id="6015327">.</span><span class="ident" id="6015328">wsbuf</span>&nbsp;<span class="op" id="6015334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015340">switch</span>&nbsp;<span class="ident" id="6015347">ch</span>&nbsp;<span class="op" id="6015350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015356">case</span>&nbsp;<span class="ident" id="6015361">blank</span><span class="op" id="6015366">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015373">//&nbsp;ignore&nbsp;any&nbsp;blanks&nbsp;before&nbsp;a&nbsp;comment</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015416">p</span><span class="op" id="6015417">.</span><span class="ident" id="6015418">wsbuf</span><span class="op" id="6015423">[</span><span class="ident" id="6015424">i</span><span class="op" id="6015425">]</span>&nbsp;<span class="op" id="6015427">=</span>&nbsp;<span class="ident" id="6015429">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015441">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015454">case</span>&nbsp;<span class="ident" id="6015459">vtab</span><span class="op" id="6015463">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015470">//&nbsp;respect&nbsp;existing&nbsp;tabs&nbsp;-&nbsp;important</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015512">//&nbsp;for&nbsp;proper&nbsp;formatting&nbsp;of&nbsp;commented&nbsp;structs</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015563">hasSep</span>&nbsp;<span class="op" id="6015570">=</span>&nbsp;<span class="builtintype" id="6015572">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015582">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015595">case</span>&nbsp;<span class="ident" id="6015600">indent</span><span class="op" id="6015606">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015613">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015647">continue</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015666">j</span>&nbsp;<span class="op" id="6015668">=</span>&nbsp;<span class="ident" id="6015670">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015676">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015690">p</span><span class="op" id="6015691">.</span><span class="ident" id="6015692">writeWhitespace</span><span class="op" id="6015707">(</span><span class="ident" id="6015708">j</span><span class="op" id="6015709">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015717">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015764">if</span>&nbsp;<span class="op" id="6015767">!</span><span class="ident" id="6015768">hasSep</span>&nbsp;<span class="op" id="6015775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015780">sep</span>&nbsp;<span class="op" id="6015784">:=</span>&nbsp;<span class="builtintype" id="6015787">byte</span><span class="op" id="6015791">(</span><span class="string" id="6015792">&#39;\t&#39;</span><span class="op" id="6015796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015801">if</span>&nbsp;<span class="ident" id="6015804">pos</span><span class="op" id="6015807">.</span><span class="ident" id="6015808">Line</span>&nbsp;<span class="op" id="6015813">==</span>&nbsp;<span class="ident" id="6015816">next</span><span class="op" id="6015820">.</span><span class="ident" id="6015821">Line</span>&nbsp;<span class="op" id="6015826">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015832">//&nbsp;next&nbsp;item&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015884">//&nbsp;(which&nbsp;must&nbsp;be&nbsp;a&nbsp;/*-style&nbsp;comment):&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015936">//&nbsp;with&nbsp;a&nbsp;blank&nbsp;instead&nbsp;of&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015973">sep</span>&nbsp;<span class="op" id="6015977">=</span>&nbsp;<span class="string" id="6015979">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015986">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015991">p</span><span class="op" id="6015992">.</span><span class="ident" id="6015993">writeByte</span><span class="op" id="6016002">(</span><span class="ident" id="6016003">sep</span><span class="op" id="6016006">,</span>&nbsp;<span class="num" id="6016008">1</span><span class="op" id="6016009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6016013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6016017">}</span>&nbsp;<span class="keyword" id="6016019">else</span>&nbsp;<span class="op" id="6016024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016028">//&nbsp;comment&nbsp;on&nbsp;a&nbsp;different&nbsp;line:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016062">//&nbsp;separate&nbsp;with&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016105">droppedLinebreak</span>&nbsp;<span class="op" id="6016122">:=</span>&nbsp;<span class="builtintype" id="6016125">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016133">j</span>&nbsp;<span class="op" id="6016135">:=</span>&nbsp;<span class="num" id="6016138">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016142">for</span>&nbsp;<span class="ident" id="6016146">i</span><span class="op" id="6016147">,</span>&nbsp;<span class="ident" id="6016149">ch</span>&nbsp;<span class="op" id="6016152">:=</span>&nbsp;<span class="keyword" id="6016155">range</span>&nbsp;<span class="ident" id="6016161">p</span><span class="op" id="6016162">.</span><span class="ident" id="6016163">wsbuf</span>&nbsp;<span class="op" id="6016169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016174">switch</span>&nbsp;<span class="ident" id="6016181">ch</span>&nbsp;<span class="op" id="6016184">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016189">case</span>&nbsp;<span class="ident" id="6016194">blank</span><span class="op" id="6016199">,</span>&nbsp;<span class="ident" id="6016201">vtab</span><span class="op" id="6016205">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016211">//&nbsp;ignore&nbsp;any&nbsp;horizontal&nbsp;whitespace&nbsp;before&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016270">p</span><span class="op" id="6016271">.</span><span class="ident" id="6016272">wsbuf</span><span class="op" id="6016277">[</span><span class="ident" id="6016278">i</span><span class="op" id="6016279">]</span>&nbsp;<span class="op" id="6016281">=</span>&nbsp;<span class="ident" id="6016283">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016294">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016306">case</span>&nbsp;<span class="ident" id="6016311">indent</span><span class="op" id="6016317">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016323">//&nbsp;apply&nbsp;pending&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016356">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016368">case</span>&nbsp;<span class="ident" id="6016373">unindent</span><span class="op" id="6016381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016387">//&nbsp;if&nbsp;this&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;unindent,&nbsp;apply&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016437">//&nbsp;as&nbsp;it&nbsp;is&nbsp;(likely)&nbsp;belonging&nbsp;to&nbsp;the&nbsp;last</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016484">//&nbsp;construct&nbsp;(e.g.,&nbsp;a&nbsp;multi-line&nbsp;expression&nbsp;list)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016538">//&nbsp;and&nbsp;is&nbsp;not&nbsp;part&nbsp;of&nbsp;closing&nbsp;a&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016580">if</span>&nbsp;<span class="ident" id="6016583">i</span><span class="op" id="6016584">+</span><span class="num" id="6016585">1</span>&nbsp;<span class="op" id="6016587">&lt;</span>&nbsp;<span class="builtinfunc" id="6016589">len</span><span class="op" id="6016592">(</span><span class="ident" id="6016593">p</span><span class="op" id="6016594">.</span><span class="ident" id="6016595">wsbuf</span><span class="op" id="6016600">)</span>&nbsp;<span class="op" id="6016602">&amp;&amp;</span>&nbsp;<span class="ident" id="6016605">p</span><span class="op" id="6016606">.</span><span class="ident" id="6016607">wsbuf</span><span class="op" id="6016612">[</span><span class="ident" id="6016613">i</span><span class="op" id="6016614">+</span><span class="num" id="6016615">1</span><span class="op" id="6016616">]</span>&nbsp;<span class="op" id="6016618">==</span>&nbsp;<span class="ident" id="6016621">unindent</span>&nbsp;<span class="op" id="6016630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016637">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6016650">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016656">//&nbsp;if&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;not&nbsp;a&nbsp;closing&nbsp;},&nbsp;apply&nbsp;the&nbsp;unindent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016720">//&nbsp;if&nbsp;it&nbsp;appears&nbsp;that&nbsp;the&nbsp;comment&nbsp;is&nbsp;aligned&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016778">//&nbsp;token;&nbsp;otherwise&nbsp;assume&nbsp;the&nbsp;unindent&nbsp;is&nbsp;part&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016835">//&nbsp;closing&nbsp;block&nbsp;and&nbsp;stop&nbsp;(this&nbsp;scenario&nbsp;appears&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016893">//&nbsp;comments&nbsp;before&nbsp;a&nbsp;case&nbsp;label&nbsp;where&nbsp;the&nbsp;comments</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6016948">//&nbsp;apply&nbsp;to&nbsp;the&nbsp;next&nbsp;case&nbsp;instead&nbsp;of&nbsp;the&nbsp;current&nbsp;one)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017006">if</span>&nbsp;<span class="ident" id="6017009">tok</span>&nbsp;<span class="op" id="6017013">!=</span>&nbsp;<span class="ident" id="6017016">token</span><span class="op" id="6017021">.</span><span class="ident" id="6017022">RBRACE</span>&nbsp;<span class="op" id="6017029">&amp;&amp;</span>&nbsp;<span class="ident" id="6017032">pos</span><span class="op" id="6017035">.</span><span class="ident" id="6017036">Column</span>&nbsp;<span class="op" id="6017043">==</span>&nbsp;<span class="ident" id="6017046">next</span><span class="op" id="6017050">.</span><span class="ident" id="6017051">Column</span>&nbsp;<span class="op" id="6017058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017065">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6017078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017083">case</span>&nbsp;<span class="ident" id="6017088">newline</span><span class="op" id="6017095">,</span>&nbsp;<span class="ident" id="6017097">formfeed</span><span class="op" id="6017105">:</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017111">p</span><span class="op" id="6017112">.</span><span class="ident" id="6017113">wsbuf</span><span class="op" id="6017118">[</span><span class="ident" id="6017119">i</span><span class="op" id="6017120">]</span>&nbsp;<span class="op" id="6017122">=</span>&nbsp;<span class="ident" id="6017124">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017135">droppedLinebreak</span>&nbsp;<span class="op" id="6017152">=</span>&nbsp;<span class="ident" id="6017154">prev</span>&nbsp;<span class="op" id="6017159">==</span>&nbsp;<span class="ident" id="6017162">nil</span>&nbsp;<span class="comment" id="6017166">//&nbsp;record&nbsp;only&nbsp;if&nbsp;first&nbsp;comment&nbsp;of&nbsp;a&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6017212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017217">j</span>&nbsp;<span class="op" id="6017219">=</span>&nbsp;<span class="ident" id="6017221">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017226">break</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6017234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017238">p</span><span class="op" id="6017239">.</span><span class="ident" id="6017240">writeWhitespace</span><span class="op" id="6017255">(</span><span class="ident" id="6017256">j</span><span class="op" id="6017257">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017262">//&nbsp;determine&nbsp;number&nbsp;of&nbsp;linebreaks&nbsp;before&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017317">n</span>&nbsp;<span class="op" id="6017319">:=</span>&nbsp;<span class="num" id="6017322">0</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017326">if</span>&nbsp;<span class="ident" id="6017329">pos</span><span class="op" id="6017332">.</span><span class="ident" id="6017333">IsValid</span><span class="op" id="6017340">(</span><span class="op" id="6017341">)</span>&nbsp;<span class="op" id="6017343">&amp;&amp;</span>&nbsp;<span class="ident" id="6017346">p</span><span class="op" id="6017347">.</span><span class="ident" id="6017348">last</span><span class="op" id="6017352">.</span><span class="ident" id="6017353">IsValid</span><span class="op" id="6017360">(</span><span class="op" id="6017361">)</span>&nbsp;<span class="op" id="6017363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017368">n</span>&nbsp;<span class="op" id="6017370">=</span>&nbsp;<span class="ident" id="6017372">pos</span><span class="op" id="6017375">.</span><span class="ident" id="6017376">Line</span>&nbsp;<span class="op" id="6017381">-</span>&nbsp;<span class="ident" id="6017383">p</span><span class="op" id="6017384">.</span><span class="ident" id="6017385">last</span><span class="op" id="6017389">.</span><span class="ident" id="6017390">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017398">if</span>&nbsp;<span class="ident" id="6017401">n</span>&nbsp;<span class="op" id="6017403">&lt;</span>&nbsp;<span class="num" id="6017405">0</span>&nbsp;<span class="op" id="6017407">{</span>&nbsp;<span class="comment" id="6017409">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017436">n</span>&nbsp;<span class="op" id="6017438">=</span>&nbsp;<span class="num" id="6017440">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6017445">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6017449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017454">//&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;only&nbsp;(p.indent&nbsp;==&nbsp;0),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017508">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;newline&nbsp;if&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017560">//&nbsp;this&nbsp;preserves&nbsp;a&nbsp;blank&nbsp;line&nbsp;before&nbsp;documentation</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017614">//&nbsp;comments&nbsp;at&nbsp;the&nbsp;package&nbsp;scope&nbsp;level&nbsp;(issue&nbsp;2570)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017668">if</span>&nbsp;<span class="ident" id="6017671">p</span><span class="op" id="6017672">.</span><span class="ident" id="6017673">indent</span>&nbsp;<span class="op" id="6017680">==</span>&nbsp;<span class="num" id="6017683">0</span>&nbsp;<span class="op" id="6017685">&amp;&amp;</span>&nbsp;<span class="ident" id="6017688">droppedLinebreak</span>&nbsp;<span class="op" id="6017705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017710">n</span><span class="op" id="6017711">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6017716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017721">//&nbsp;make&nbsp;sure&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017769">//&nbsp;if&nbsp;the&nbsp;previous&nbsp;comment&nbsp;was&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017817">if</span>&nbsp;<span class="ident" id="6017820">n</span>&nbsp;<span class="op" id="6017822">==</span>&nbsp;<span class="num" id="6017825">0</span>&nbsp;<span class="op" id="6017827">&amp;&amp;</span>&nbsp;<span class="ident" id="6017830">prev</span>&nbsp;<span class="op" id="6017835">!=</span>&nbsp;<span class="ident" id="6017838">nil</span>&nbsp;<span class="op" id="6017842">&amp;&amp;</span>&nbsp;<span class="ident" id="6017845">prev</span><span class="op" id="6017849">.</span><span class="ident" id="6017850">Text</span><span class="op" id="6017854">[</span><span class="num" id="6017855">1</span><span class="op" id="6017856">]</span>&nbsp;<span class="op" id="6017858">==</span>&nbsp;<span class="string" id="6017861">&#39;/&#39;</span>&nbsp;<span class="op" id="6017865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6017870">n</span>&nbsp;<span class="op" id="6017872">=</span>&nbsp;<span class="num" id="6017874">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6017878">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6017883">if</span>&nbsp;<span class="ident" id="6017886">n</span>&nbsp;<span class="op" id="6017888">&gt;</span>&nbsp;<span class="num" id="6017890">0</span>&nbsp;<span class="op" id="6017892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017897">//&nbsp;use&nbsp;formfeeds&nbsp;to&nbsp;break&nbsp;columns&nbsp;before&nbsp;a&nbsp;comment;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6017952">//&nbsp;this&nbsp;is&nbsp;analogous&nbsp;to&nbsp;using&nbsp;formfeeds&nbsp;to&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6018007">//&nbsp;individual&nbsp;lines&nbsp;of&nbsp;/*-style&nbsp;comments</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018051">p</span><span class="op" id="6018052">.</span><span class="ident" id="6018053">writeByte</span><span class="op" id="6018062">(</span><span class="string" id="6018063">&#39;\f&#39;</span><span class="op" id="6018067">,</span>&nbsp;<span class="ident" id="6018069">nlimit</span><span class="op" id="6018075">(</span><span class="ident" id="6018076">n</span><span class="op" id="6018077">)</span><span class="op" id="6018078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6018082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6018085">}</span><br>
<span class="lineno"></span><span class="op" id="6018087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="comment" id="6018090">//&nbsp;Returns&nbsp;true&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="6018137">//&nbsp;(only&nbsp;tabs&nbsp;and&nbsp;blanks&nbsp;can&nbsp;appear&nbsp;in&nbsp;the&nbsp;printer&#39;s&nbsp;context).</span><br>
<span class="lineno"></span><span class="comment" id="6018200">//</span><br>
<span class="lineno"></span><span class="keyword" id="6018203">func</span>&nbsp;<span class="ident" id="6018208">isBlank</span><span class="op" id="6018215">(</span><span class="ident" id="6018216">s</span>&nbsp;<span class="builtintype" id="6018218">string</span><span class="op" id="6018224">)</span>&nbsp;<span class="builtintype" id="6018226">bool</span>&nbsp;<span class="op" id="6018231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6018234">for</span>&nbsp;<span class="ident" id="6018238">i</span>&nbsp;<span class="op" id="6018240">:=</span>&nbsp;<span class="num" id="6018243">0</span><span class="op" id="6018244">;</span>&nbsp;<span class="ident" id="6018246">i</span>&nbsp;<span class="op" id="6018248">&lt;</span>&nbsp;<span class="builtinfunc" id="6018250">len</span><span class="op" id="6018253">(</span><span class="ident" id="6018254">s</span><span class="op" id="6018255">)</span><span class="op" id="6018256">;</span>&nbsp;<span class="ident" id="6018258">i</span><span class="op" id="6018259">++</span>&nbsp;<span class="op" id="6018262">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6018266">if</span>&nbsp;<span class="ident" id="6018269">s</span><span class="op" id="6018270">[</span><span class="ident" id="6018271">i</span><span class="op" id="6018272">]</span>&nbsp;<span class="op" id="6018274">&gt;</span>&nbsp;<span class="string" id="6018276">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6018280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6018285">return</span>&nbsp;<span class="builtintype" id="6018292">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6018300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6018303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6018306">return</span>&nbsp;<span class="builtintype" id="6018313">true</span><br>
<span class="lineno">460</span><span class="op" id="6018318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6018321">//&nbsp;commonPrefix&nbsp;returns&nbsp;the&nbsp;common&nbsp;prefix&nbsp;of&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="6018375">func</span>&nbsp;<span class="ident" id="6018380">commonPrefix</span><span class="op" id="6018392">(</span><span class="ident" id="6018393">a</span><span class="op" id="6018394">,</span>&nbsp;<span class="ident" id="6018396">b</span>&nbsp;<span class="builtintype" id="6018398">string</span><span class="op" id="6018404">)</span>&nbsp;<span class="builtintype" id="6018406">string</span>&nbsp;<span class="op" id="6018413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018416">i</span>&nbsp;<span class="op" id="6018418">:=</span>&nbsp;<span class="num" id="6018421">0</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6018424">for</span>&nbsp;<span class="ident" id="6018428">i</span>&nbsp;<span class="op" id="6018430">&lt;</span>&nbsp;<span class="builtinfunc" id="6018432">len</span><span class="op" id="6018435">(</span><span class="ident" id="6018436">a</span><span class="op" id="6018437">)</span>&nbsp;<span class="op" id="6018439">&amp;&amp;</span>&nbsp;<span class="ident" id="6018442">i</span>&nbsp;<span class="op" id="6018444">&lt;</span>&nbsp;<span class="builtinfunc" id="6018446">len</span><span class="op" id="6018449">(</span><span class="ident" id="6018450">b</span><span class="op" id="6018451">)</span>&nbsp;<span class="op" id="6018453">&amp;&amp;</span>&nbsp;<span class="ident" id="6018456">a</span><span class="op" id="6018457">[</span><span class="ident" id="6018458">i</span><span class="op" id="6018459">]</span>&nbsp;<span class="op" id="6018461">==</span>&nbsp;<span class="ident" id="6018464">b</span><span class="op" id="6018465">[</span><span class="ident" id="6018466">i</span><span class="op" id="6018467">]</span>&nbsp;<span class="op" id="6018469">&amp;&amp;</span>&nbsp;<span class="op" id="6018472">(</span><span class="ident" id="6018473">a</span><span class="op" id="6018474">[</span><span class="ident" id="6018475">i</span><span class="op" id="6018476">]</span>&nbsp;<span class="op" id="6018478">&lt;=</span>&nbsp;<span class="string" id="6018481">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6018485">||</span>&nbsp;<span class="ident" id="6018488">a</span><span class="op" id="6018489">[</span><span class="ident" id="6018490">i</span><span class="op" id="6018491">]</span>&nbsp;<span class="op" id="6018493">==</span>&nbsp;<span class="string" id="6018496">&#39;*&#39;</span><span class="op" id="6018499">)</span>&nbsp;<span class="op" id="6018501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6018505">i</span><span class="op" id="6018506">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6018510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6018513">return</span>&nbsp;<span class="ident" id="6018520">a</span><span class="op" id="6018521">[</span><span class="num" id="6018522">0</span><span class="op" id="6018523">:</span><span class="ident" id="6018524">i</span><span class="op" id="6018525">]</span><br>
<span class="lineno"></span><span class="op" id="6018527">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="6018530">//&nbsp;trimRight&nbsp;returns&nbsp;s&nbsp;with&nbsp;trailing&nbsp;whitespace&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="6018587">func</span>&nbsp;<span class="ident" id="6018592">trimRight</span><span class="op" id="6018601">(</span><span class="ident" id="6018602">s</span>&nbsp;<span class="builtintype" id="6018604">string</span><span class="op" id="6018610">)</span>&nbsp;<span class="builtintype" id="6018612">string</span>&nbsp;<span class="op" id="6018619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6018622">return</span>&nbsp;<span class="ident" id="6018629">strings</span><span class="op" id="6018636">.</span><span class="ident" id="6018637">TrimRightFunc</span><span class="op" id="6018650">(</span><span class="ident" id="6018651">s</span><span class="op" id="6018652">,</span>&nbsp;<span class="ident" id="6018654">unicode</span><span class="op" id="6018661">.</span><span class="ident" id="6018662">IsSpace</span><span class="op" id="6018669">)</span><br>
<span class="lineno"></span><span class="op" id="6018671">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="6018674">//&nbsp;stripCommonPrefix&nbsp;removes&nbsp;a&nbsp;common&nbsp;prefix&nbsp;from&nbsp;/*-style&nbsp;comment&nbsp;lines&nbsp;(unless&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="6018758">//&nbsp;comment&nbsp;line&nbsp;is&nbsp;indented,&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;line&nbsp;have&nbsp;some&nbsp;form&nbsp;of&nbsp;space&nbsp;prefix).</span><br>
<span class="lineno"></span><span class="comment" id="6018843">//&nbsp;The&nbsp;prefix&nbsp;is&nbsp;computed&nbsp;using&nbsp;heuristics&nbsp;such&nbsp;that&nbsp;is&nbsp;likely&nbsp;that&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="6018923">//&nbsp;contents&nbsp;are&nbsp;nicely&nbsp;laid&nbsp;out&nbsp;after&nbsp;re-printing&nbsp;each&nbsp;line&nbsp;using&nbsp;the&nbsp;printer&#39;s</span><br>
<span class="lineno">480</span><span class="comment" id="6019003">//&nbsp;current&nbsp;indentation.</span><br>
<span class="lineno"></span><span class="comment" id="6019027">//</span><br>
<span class="lineno"></span><span class="keyword" id="6019030">func</span>&nbsp;<span class="ident" id="6019035">stripCommonPrefix</span><span class="op" id="6019052">(</span><span class="ident" id="6019053">lines</span>&nbsp;<span class="op" id="6019059">[</span><span class="op" id="6019060">]</span><span class="builtintype" id="6019061">string</span><span class="op" id="6019067">)</span>&nbsp;<span class="op" id="6019069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019072">if</span>&nbsp;<span class="builtinfunc" id="6019075">len</span><span class="op" id="6019078">(</span><span class="ident" id="6019079">lines</span><span class="op" id="6019084">)</span>&nbsp;<span class="op" id="6019086">&lt;=</span>&nbsp;<span class="num" id="6019089">1</span>&nbsp;<span class="op" id="6019091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019095">return</span>&nbsp;<span class="comment" id="6019102">//&nbsp;at&nbsp;most&nbsp;one&nbsp;line&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6019139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019142">//&nbsp;len(lines)&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019162">//&nbsp;The&nbsp;heuristic&nbsp;in&nbsp;this&nbsp;function&nbsp;tries&nbsp;to&nbsp;handle&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019219">//&nbsp;common&nbsp;patterns&nbsp;of&nbsp;/*-style&nbsp;comments:&nbsp;Comments&nbsp;where</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019276">//&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;are&nbsp;aligned&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019330">//&nbsp;rest&nbsp;of&nbsp;the&nbsp;comment&nbsp;text&nbsp;is&nbsp;aligned&nbsp;and&nbsp;indented&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019388">//&nbsp;blanks&nbsp;or&nbsp;tabs,&nbsp;cases&nbsp;with&nbsp;a&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019446">//&nbsp;on&nbsp;the&nbsp;left,&nbsp;and&nbsp;cases&nbsp;where&nbsp;the&nbsp;closing&nbsp;*/&nbsp;is&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019504">//&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;last&nbsp;comment&nbsp;text.</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019545">//&nbsp;Compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix&nbsp;of&nbsp;all&nbsp;but&nbsp;the&nbsp;first,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019607">//&nbsp;last,&nbsp;and&nbsp;blank&nbsp;lines,&nbsp;and&nbsp;replace&nbsp;blank&nbsp;lines&nbsp;with&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019669">//&nbsp;lines&nbsp;(the&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;/*&nbsp;and&nbsp;has&nbsp;no&nbsp;prefix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019730">//&nbsp;In&nbsp;case&nbsp;of&nbsp;two-line&nbsp;comments,&nbsp;consider&nbsp;the&nbsp;last&nbsp;line&nbsp;for</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019791">//&nbsp;the&nbsp;prefix&nbsp;computation&nbsp;since&nbsp;otherwise&nbsp;the&nbsp;prefix&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019851">//&nbsp;be&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019865">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019869">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;line&nbsp;are&nbsp;never&nbsp;empty&nbsp;(they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019929">//&nbsp;contain&nbsp;the&nbsp;opening&nbsp;/*&nbsp;and&nbsp;closing&nbsp;*/&nbsp;respectively)&nbsp;and</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019989">//&nbsp;thus&nbsp;they&nbsp;can&nbsp;be&nbsp;ignored&nbsp;by&nbsp;the&nbsp;blank&nbsp;line&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020043">var</span>&nbsp;<span class="ident" id="6020047">prefix</span>&nbsp;<span class="builtintype" id="6020054">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020062">if</span>&nbsp;<span class="builtinfunc" id="6020065">len</span><span class="op" id="6020068">(</span><span class="ident" id="6020069">lines</span><span class="op" id="6020074">)</span>&nbsp;<span class="op" id="6020076">&gt;</span>&nbsp;<span class="num" id="6020078">2</span>&nbsp;<span class="op" id="6020080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020084">first</span>&nbsp;<span class="op" id="6020090">:=</span>&nbsp;<span class="builtintype" id="6020093">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020100">for</span>&nbsp;<span class="ident" id="6020104">i</span><span class="op" id="6020105">,</span>&nbsp;<span class="ident" id="6020107">line</span>&nbsp;<span class="op" id="6020112">:=</span>&nbsp;<span class="keyword" id="6020115">range</span>&nbsp;<span class="ident" id="6020121">lines</span><span class="op" id="6020126">[</span><span class="num" id="6020127">1</span>&nbsp;<span class="op" id="6020129">:</span>&nbsp;<span class="builtinfunc" id="6020131">len</span><span class="op" id="6020134">(</span><span class="ident" id="6020135">lines</span><span class="op" id="6020140">)</span><span class="op" id="6020141">-</span><span class="num" id="6020142">1</span><span class="op" id="6020143">]</span>&nbsp;<span class="op" id="6020145">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020150">switch</span>&nbsp;<span class="op" id="6020157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020162">case</span>&nbsp;<span class="ident" id="6020167">isBlank</span><span class="op" id="6020174">(</span><span class="ident" id="6020175">line</span><span class="op" id="6020179">)</span><span class="op" id="6020180">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020186">lines</span><span class="op" id="6020191">[</span><span class="num" id="6020192">1</span><span class="op" id="6020193">+</span><span class="ident" id="6020194">i</span><span class="op" id="6020195">]</span>&nbsp;<span class="op" id="6020197">=</span>&nbsp;<span class="string" id="6020199">&#34;&#34;</span>&nbsp;<span class="comment" id="6020202">//&nbsp;range&nbsp;starts&nbsp;with&nbsp;lines[1]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020235">case</span>&nbsp;<span class="ident" id="6020240">first</span><span class="op" id="6020245">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020251">prefix</span>&nbsp;<span class="op" id="6020258">=</span>&nbsp;<span class="ident" id="6020260">commonPrefix</span><span class="op" id="6020272">(</span><span class="ident" id="6020273">line</span><span class="op" id="6020277">,</span>&nbsp;<span class="ident" id="6020279">line</span><span class="op" id="6020283">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020289">first</span>&nbsp;<span class="op" id="6020295">=</span>&nbsp;<span class="builtintype" id="6020297">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020306">default</span><span class="op" id="6020313">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020319">prefix</span>&nbsp;<span class="op" id="6020326">=</span>&nbsp;<span class="ident" id="6020328">commonPrefix</span><span class="op" id="6020340">(</span><span class="ident" id="6020341">prefix</span><span class="op" id="6020347">,</span>&nbsp;<span class="ident" id="6020349">line</span><span class="op" id="6020353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6020358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6020362">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6020365">}</span>&nbsp;<span class="keyword" id="6020367">else</span>&nbsp;<span class="op" id="6020372">{</span>&nbsp;<span class="comment" id="6020374">//&nbsp;len(lines)&nbsp;==&nbsp;2,&nbsp;lines&nbsp;cannot&nbsp;be&nbsp;blank&nbsp;(contain&nbsp;/*&nbsp;and&nbsp;*/)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020438">line</span>&nbsp;<span class="op" id="6020443">:=</span>&nbsp;<span class="ident" id="6020446">lines</span><span class="op" id="6020451">[</span><span class="num" id="6020452">1</span><span class="op" id="6020453">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020457">prefix</span>&nbsp;<span class="op" id="6020464">=</span>&nbsp;<span class="ident" id="6020466">commonPrefix</span><span class="op" id="6020478">(</span><span class="ident" id="6020479">line</span><span class="op" id="6020483">,</span>&nbsp;<span class="ident" id="6020485">line</span><span class="op" id="6020489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6020492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020496">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Check&nbsp;for&nbsp;vertical&nbsp;&#34;line&nbsp;of&nbsp;stars&#34;&nbsp;and&nbsp;correct&nbsp;prefix&nbsp;accordingly.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020576">lineOfStars</span>&nbsp;<span class="op" id="6020588">:=</span>&nbsp;<span class="builtintype" id="6020591">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020598">if</span>&nbsp;<span class="ident" id="6020601">i</span>&nbsp;<span class="op" id="6020603">:=</span>&nbsp;<span class="ident" id="6020606">strings</span><span class="op" id="6020613">.</span><span class="ident" id="6020614">Index</span><span class="op" id="6020619">(</span><span class="ident" id="6020620">prefix</span><span class="op" id="6020626">,</span>&nbsp;<span class="string" id="6020628">&#34;*&#34;</span><span class="op" id="6020631">)</span><span class="op" id="6020632">;</span>&nbsp;<span class="ident" id="6020634">i</span>&nbsp;<span class="op" id="6020636">&gt;=</span>&nbsp;<span class="num" id="6020639">0</span>&nbsp;<span class="op" id="6020641">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020645">//&nbsp;Line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6020673">if</span>&nbsp;<span class="ident" id="6020676">i</span>&nbsp;<span class="op" id="6020678">&gt;</span>&nbsp;<span class="num" id="6020680">0</span>&nbsp;<span class="op" id="6020682">&amp;&amp;</span>&nbsp;<span class="ident" id="6020685">prefix</span><span class="op" id="6020691">[</span><span class="ident" id="6020692">i</span><span class="op" id="6020693">-</span><span class="num" id="6020694">1</span><span class="op" id="6020695">]</span>&nbsp;<span class="op" id="6020697">==</span>&nbsp;<span class="string" id="6020700">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6020704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020709">i</span><span class="op" id="6020710">--</span>&nbsp;<span class="comment" id="6020713">//&nbsp;remove&nbsp;trailing&nbsp;blank&nbsp;from&nbsp;prefix&nbsp;so&nbsp;stars&nbsp;remain&nbsp;aligned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6020776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020780">prefix</span>&nbsp;<span class="op" id="6020787">=</span>&nbsp;<span class="ident" id="6020789">prefix</span><span class="op" id="6020795">[</span><span class="num" id="6020796">0</span><span class="op" id="6020797">:</span><span class="ident" id="6020798">i</span><span class="op" id="6020799">]</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020803">lineOfStars</span>&nbsp;<span class="op" id="6020815">=</span>&nbsp;<span class="builtintype" id="6020817">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6020823">}</span>&nbsp;<span class="keyword" id="6020825">else</span>&nbsp;<span class="op" id="6020830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020834">//&nbsp;No&nbsp;line&nbsp;of&nbsp;stars&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020865">//&nbsp;Determine&nbsp;the&nbsp;white&nbsp;space&nbsp;on&nbsp;the&nbsp;first&nbsp;line&nbsp;after&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020927">//&nbsp;and&nbsp;before&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;comment&nbsp;text,&nbsp;assume&nbsp;two</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020989">//&nbsp;blanks&nbsp;instead&nbsp;of&nbsp;the&nbsp;/*&nbsp;unless&nbsp;the&nbsp;first&nbsp;character&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021052">//&nbsp;the&nbsp;/*&nbsp;is&nbsp;a&nbsp;tab.&nbsp;If&nbsp;the&nbsp;first&nbsp;comment&nbsp;line&nbsp;is&nbsp;empty&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021113">//&nbsp;for&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;assume&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab.&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021175">//&nbsp;whitespace&nbsp;may&nbsp;be&nbsp;found&nbsp;as&nbsp;suffix&nbsp;in&nbsp;the&nbsp;common&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021236">first</span>&nbsp;<span class="op" id="6021242">:=</span>&nbsp;<span class="ident" id="6021245">lines</span><span class="op" id="6021250">[</span><span class="num" id="6021251">0</span><span class="op" id="6021252">]</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021256">if</span>&nbsp;<span class="ident" id="6021259">isBlank</span><span class="op" id="6021266">(</span><span class="ident" id="6021267">first</span><span class="op" id="6021272">[</span><span class="num" id="6021273">2</span><span class="op" id="6021274">:</span><span class="op" id="6021275">]</span><span class="op" id="6021276">)</span>&nbsp;<span class="op" id="6021278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021283">//&nbsp;no&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021324">//&nbsp;reduce&nbsp;prefix&nbsp;by&nbsp;up&nbsp;to&nbsp;3&nbsp;blanks&nbsp;or&nbsp;a&nbsp;tab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021371">//&nbsp;if&nbsp;present&nbsp;-&nbsp;this&nbsp;keeps&nbsp;comment&nbsp;text&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021423">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;/*&nbsp;and&nbsp;*/&#39;s&nbsp;if&nbsp;it&nbsp;was&nbsp;indented</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021476">//&nbsp;in&nbsp;the&nbsp;first&nbsp;place</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021501">i</span>&nbsp;<span class="op" id="6021503">:=</span>&nbsp;<span class="builtinfunc" id="6021506">len</span><span class="op" id="6021509">(</span><span class="ident" id="6021510">prefix</span><span class="op" id="6021516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021521">for</span>&nbsp;<span class="ident" id="6021525">n</span>&nbsp;<span class="op" id="6021527">:=</span>&nbsp;<span class="num" id="6021530">0</span><span class="op" id="6021531">;</span>&nbsp;<span class="ident" id="6021533">n</span>&nbsp;<span class="op" id="6021535">&lt;</span>&nbsp;<span class="num" id="6021537">3</span>&nbsp;<span class="op" id="6021539">&amp;&amp;</span>&nbsp;<span class="ident" id="6021542">i</span>&nbsp;<span class="op" id="6021544">&gt;</span>&nbsp;<span class="num" id="6021546">0</span>&nbsp;<span class="op" id="6021548">&amp;&amp;</span>&nbsp;<span class="ident" id="6021551">prefix</span><span class="op" id="6021557">[</span><span class="ident" id="6021558">i</span><span class="op" id="6021559">-</span><span class="num" id="6021560">1</span><span class="op" id="6021561">]</span>&nbsp;<span class="op" id="6021563">==</span>&nbsp;<span class="string" id="6021566">&#39;&nbsp;&#39;</span><span class="op" id="6021569">;</span>&nbsp;<span class="ident" id="6021571">n</span><span class="op" id="6021572">++</span>&nbsp;<span class="op" id="6021575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021581">i</span><span class="op" id="6021582">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021588">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021593">if</span>&nbsp;<span class="ident" id="6021596">i</span>&nbsp;<span class="op" id="6021598">==</span>&nbsp;<span class="builtinfunc" id="6021601">len</span><span class="op" id="6021604">(</span><span class="ident" id="6021605">prefix</span><span class="op" id="6021611">)</span>&nbsp;<span class="op" id="6021613">&amp;&amp;</span>&nbsp;<span class="ident" id="6021616">i</span>&nbsp;<span class="op" id="6021618">&gt;</span>&nbsp;<span class="num" id="6021620">0</span>&nbsp;<span class="op" id="6021622">&amp;&amp;</span>&nbsp;<span class="ident" id="6021625">prefix</span><span class="op" id="6021631">[</span><span class="ident" id="6021632">i</span><span class="op" id="6021633">-</span><span class="num" id="6021634">1</span><span class="op" id="6021635">]</span>&nbsp;<span class="op" id="6021637">==</span>&nbsp;<span class="string" id="6021640">&#39;\t&#39;</span>&nbsp;<span class="op" id="6021645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021651">i</span><span class="op" id="6021652">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021663">prefix</span>&nbsp;<span class="op" id="6021670">=</span>&nbsp;<span class="ident" id="6021672">prefix</span><span class="op" id="6021678">[</span><span class="num" id="6021679">0</span><span class="op" id="6021680">:</span><span class="ident" id="6021681">i</span><span class="op" id="6021682">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021686">}</span>&nbsp;<span class="keyword" id="6021688">else</span>&nbsp;<span class="op" id="6021693">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021698">//&nbsp;comment&nbsp;text&nbsp;on&nbsp;the&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021735">suffix</span>&nbsp;<span class="op" id="6021742">:=</span>&nbsp;<span class="builtinfunc" id="6021745">make</span><span class="op" id="6021749">(</span><span class="op" id="6021750">[</span><span class="op" id="6021751">]</span><span class="builtintype" id="6021752">byte</span><span class="op" id="6021756">,</span>&nbsp;<span class="builtinfunc" id="6021758">len</span><span class="op" id="6021761">(</span><span class="ident" id="6021762">first</span><span class="op" id="6021767">)</span><span class="op" id="6021768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021773">n</span>&nbsp;<span class="op" id="6021775">:=</span>&nbsp;<span class="num" id="6021778">2</span>&nbsp;<span class="comment" id="6021780">//&nbsp;start&nbsp;after&nbsp;opening&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021809">for</span>&nbsp;<span class="ident" id="6021813">n</span>&nbsp;<span class="op" id="6021815">&lt;</span>&nbsp;<span class="builtinfunc" id="6021817">len</span><span class="op" id="6021820">(</span><span class="ident" id="6021821">first</span><span class="op" id="6021826">)</span>&nbsp;<span class="op" id="6021828">&amp;&amp;</span>&nbsp;<span class="ident" id="6021831">first</span><span class="op" id="6021836">[</span><span class="ident" id="6021837">n</span><span class="op" id="6021838">]</span>&nbsp;<span class="op" id="6021840">&lt;=</span>&nbsp;<span class="string" id="6021843">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6021847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021853">suffix</span><span class="op" id="6021859">[</span><span class="ident" id="6021860">n</span><span class="op" id="6021861">]</span>&nbsp;<span class="op" id="6021863">=</span>&nbsp;<span class="ident" id="6021865">first</span><span class="op" id="6021870">[</span><span class="ident" id="6021871">n</span><span class="op" id="6021872">]</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021878">n</span><span class="op" id="6021879">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021890">if</span>&nbsp;<span class="ident" id="6021893">n</span>&nbsp;<span class="op" id="6021895">&gt;</span>&nbsp;<span class="num" id="6021897">2</span>&nbsp;<span class="op" id="6021899">&amp;&amp;</span>&nbsp;<span class="ident" id="6021902">suffix</span><span class="op" id="6021908">[</span><span class="num" id="6021909">2</span><span class="op" id="6021910">]</span>&nbsp;<span class="op" id="6021912">==</span>&nbsp;<span class="string" id="6021915">&#39;\t&#39;</span>&nbsp;<span class="op" id="6021920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021926">//&nbsp;assume&nbsp;the&nbsp;&#39;\t&#39;&nbsp;compensates&nbsp;for&nbsp;the&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021972">suffix</span>&nbsp;<span class="op" id="6021979">=</span>&nbsp;<span class="ident" id="6021981">suffix</span><span class="op" id="6021987">[</span><span class="num" id="6021988">2</span><span class="op" id="6021989">:</span><span class="ident" id="6021990">n</span><span class="op" id="6021991">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021996">}</span>&nbsp;<span class="keyword" id="6021998">else</span>&nbsp;<span class="op" id="6022003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022009">//&nbsp;otherwise&nbsp;assume&nbsp;two&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022044">suffix</span><span class="op" id="6022050">[</span><span class="num" id="6022051">0</span><span class="op" id="6022052">]</span><span class="op" id="6022053">,</span>&nbsp;<span class="ident" id="6022055">suffix</span><span class="op" id="6022061">[</span><span class="num" id="6022062">1</span><span class="op" id="6022063">]</span>&nbsp;<span class="op" id="6022065">=</span>&nbsp;<span class="string" id="6022067">&#39;&nbsp;&#39;</span><span class="op" id="6022070">,</span>&nbsp;<span class="string" id="6022072">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022080">suffix</span>&nbsp;<span class="op" id="6022087">=</span>&nbsp;<span class="ident" id="6022089">suffix</span><span class="op" id="6022095">[</span><span class="num" id="6022096">0</span><span class="op" id="6022097">:</span><span class="ident" id="6022098">n</span><span class="op" id="6022099">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022104">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022109">//&nbsp;Shorten&nbsp;the&nbsp;computed&nbsp;common&nbsp;prefix&nbsp;by&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022167">//&nbsp;suffix,&nbsp;if&nbsp;it&nbsp;is&nbsp;found&nbsp;as&nbsp;suffix&nbsp;of&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022221">prefix</span>&nbsp;<span class="op" id="6022228">=</span>&nbsp;<span class="ident" id="6022230">strings</span><span class="op" id="6022237">.</span><span class="ident" id="6022238">TrimSuffix</span><span class="op" id="6022248">(</span><span class="ident" id="6022249">prefix</span><span class="op" id="6022255">,</span>&nbsp;<span class="builtintype" id="6022257">string</span><span class="op" id="6022263">(</span><span class="ident" id="6022264">suffix</span><span class="op" id="6022270">)</span><span class="op" id="6022271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022278">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022282">//&nbsp;Handle&nbsp;last&nbsp;line:&nbsp;If&nbsp;it&nbsp;only&nbsp;contains&nbsp;a&nbsp;closing&nbsp;*/,&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022347">//&nbsp;with&nbsp;the&nbsp;opening&nbsp;/*,&nbsp;otherwise&nbsp;align&nbsp;the&nbsp;text&nbsp;with&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022412">//&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022423">last</span>&nbsp;<span class="op" id="6022428">:=</span>&nbsp;<span class="ident" id="6022431">lines</span><span class="op" id="6022436">[</span><span class="builtinfunc" id="6022437">len</span><span class="op" id="6022440">(</span><span class="ident" id="6022441">lines</span><span class="op" id="6022446">)</span><span class="op" id="6022447">-</span><span class="num" id="6022448">1</span><span class="op" id="6022449">]</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022452">closing</span>&nbsp;<span class="op" id="6022460">:=</span>&nbsp;<span class="string" id="6022463">&#34;*/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022469">i</span>&nbsp;<span class="op" id="6022471">:=</span>&nbsp;<span class="ident" id="6022474">strings</span><span class="op" id="6022481">.</span><span class="ident" id="6022482">Index</span><span class="op" id="6022487">(</span><span class="ident" id="6022488">last</span><span class="op" id="6022492">,</span>&nbsp;<span class="ident" id="6022494">closing</span><span class="op" id="6022501">)</span>&nbsp;<span class="comment" id="6022503">//&nbsp;i&nbsp;&gt;=&nbsp;0&nbsp;(closing&nbsp;is&nbsp;always&nbsp;present)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022542">if</span>&nbsp;<span class="ident" id="6022545">isBlank</span><span class="op" id="6022552">(</span><span class="ident" id="6022553">last</span><span class="op" id="6022557">[</span><span class="num" id="6022558">0</span><span class="op" id="6022559">:</span><span class="ident" id="6022560">i</span><span class="op" id="6022561">]</span><span class="op" id="6022562">)</span>&nbsp;<span class="op" id="6022564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022568">//&nbsp;last&nbsp;line&nbsp;only&nbsp;contains&nbsp;closing&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022608">if</span>&nbsp;<span class="ident" id="6022611">lineOfStars</span>&nbsp;<span class="op" id="6022623">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022628">closing</span>&nbsp;<span class="op" id="6022636">=</span>&nbsp;<span class="string" id="6022638">&#34;&nbsp;*/&#34;</span>&nbsp;<span class="comment" id="6022644">//&nbsp;add&nbsp;blank&nbsp;to&nbsp;align&nbsp;final&nbsp;star</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022683">lines</span><span class="op" id="6022688">[</span><span class="builtinfunc" id="6022689">len</span><span class="op" id="6022692">(</span><span class="ident" id="6022693">lines</span><span class="op" id="6022698">)</span><span class="op" id="6022699">-</span><span class="num" id="6022700">1</span><span class="op" id="6022701">]</span>&nbsp;<span class="op" id="6022703">=</span>&nbsp;<span class="ident" id="6022705">prefix</span>&nbsp;<span class="op" id="6022712">+</span>&nbsp;<span class="ident" id="6022714">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022723">}</span>&nbsp;<span class="keyword" id="6022725">else</span>&nbsp;<span class="op" id="6022730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022734">//&nbsp;last&nbsp;line&nbsp;contains&nbsp;more&nbsp;comment&nbsp;text&nbsp;-&nbsp;assume</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022785">//&nbsp;it&nbsp;is&nbsp;aligned&nbsp;like&nbsp;the&nbsp;other&nbsp;lines&nbsp;and&nbsp;include</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022837">//&nbsp;in&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022864">prefix</span>&nbsp;<span class="op" id="6022871">=</span>&nbsp;<span class="ident" id="6022873">commonPrefix</span><span class="op" id="6022885">(</span><span class="ident" id="6022886">prefix</span><span class="op" id="6022892">,</span>&nbsp;<span class="ident" id="6022894">last</span><span class="op" id="6022898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6022905">//&nbsp;Remove&nbsp;the&nbsp;common&nbsp;prefix&nbsp;from&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;empty&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022974">for</span>&nbsp;<span class="ident" id="6022978">i</span><span class="op" id="6022979">,</span>&nbsp;<span class="ident" id="6022981">line</span>&nbsp;<span class="op" id="6022986">:=</span>&nbsp;<span class="keyword" id="6022989">range</span>&nbsp;<span class="ident" id="6022995">lines</span>&nbsp;<span class="op" id="6023001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023005">if</span>&nbsp;<span class="ident" id="6023008">i</span>&nbsp;<span class="op" id="6023010">&gt;</span>&nbsp;<span class="num" id="6023012">0</span>&nbsp;<span class="op" id="6023014">&amp;&amp;</span>&nbsp;<span class="ident" id="6023017">line</span>&nbsp;<span class="op" id="6023022">!=</span>&nbsp;<span class="string" id="6023025">&#34;&#34;</span>&nbsp;<span class="op" id="6023028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023033">lines</span><span class="op" id="6023038">[</span><span class="ident" id="6023039">i</span><span class="op" id="6023040">]</span>&nbsp;<span class="op" id="6023042">=</span>&nbsp;<span class="ident" id="6023044">line</span><span class="op" id="6023048">[</span><span class="builtinfunc" id="6023049">len</span><span class="op" id="6023052">(</span><span class="ident" id="6023053">prefix</span><span class="op" id="6023059">)</span><span class="op" id="6023060">:</span><span class="op" id="6023061">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023065">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023068">}</span><br>
<span class="lineno"></span><span class="op" id="6023070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6023073">func</span>&nbsp;<span class="op" id="6023078">(</span><span class="ident" id="6023079">p</span>&nbsp;<span class="op" id="6023081">*</span><span class="ident" id="6023082">printer</span><span class="op" id="6023089">)</span>&nbsp;<span class="ident" id="6023091">writeComment</span><span class="op" id="6023103">(</span><span class="ident" id="6023104">comment</span>&nbsp;<span class="op" id="6023112">*</span><span class="ident" id="6023113">ast</span><span class="op" id="6023116">.</span><span class="ident" id="6023117">Comment</span><span class="op" id="6023124">)</span>&nbsp;<span class="op" id="6023126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023129">text</span>&nbsp;<span class="op" id="6023134">:=</span>&nbsp;<span class="ident" id="6023137">comment</span><span class="op" id="6023144">.</span><span class="ident" id="6023145">Text</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023151">pos</span>&nbsp;<span class="op" id="6023155">:=</span>&nbsp;<span class="ident" id="6023158">p</span><span class="op" id="6023159">.</span><span class="ident" id="6023160">posFor</span><span class="op" id="6023166">(</span><span class="ident" id="6023167">comment</span><span class="op" id="6023174">.</span><span class="ident" id="6023175">Pos</span><span class="op" id="6023178">(</span><span class="op" id="6023179">)</span><span class="op" id="6023180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023184">const</span>&nbsp;<span class="ident" id="6023190">linePrefix</span>&nbsp;<span class="op" id="6023201">=</span>&nbsp;<span class="string" id="6023203">&#34;//line&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023214">if</span>&nbsp;<span class="ident" id="6023217">strings</span><span class="op" id="6023224">.</span><span class="ident" id="6023225">HasPrefix</span><span class="op" id="6023234">(</span><span class="ident" id="6023235">text</span><span class="op" id="6023239">,</span>&nbsp;<span class="ident" id="6023241">linePrefix</span><span class="op" id="6023251">)</span>&nbsp;<span class="op" id="6023253">&amp;&amp;</span>&nbsp;<span class="op" id="6023256">(</span><span class="op" id="6023257">!</span><span class="ident" id="6023258">pos</span><span class="op" id="6023261">.</span><span class="ident" id="6023262">IsValid</span><span class="op" id="6023269">(</span><span class="op" id="6023270">)</span>&nbsp;<span class="op" id="6023272">||</span>&nbsp;<span class="ident" id="6023275">pos</span><span class="op" id="6023278">.</span><span class="ident" id="6023279">Column</span>&nbsp;<span class="op" id="6023286">==</span>&nbsp;<span class="num" id="6023289">1</span><span class="op" id="6023290">)</span>&nbsp;<span class="op" id="6023292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6023296">//&nbsp;possibly&nbsp;a&nbsp;line&nbsp;directive</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023327">ldir</span>&nbsp;<span class="op" id="6023332">:=</span>&nbsp;<span class="ident" id="6023335">strings</span><span class="op" id="6023342">.</span><span class="ident" id="6023343">TrimSpace</span><span class="op" id="6023352">(</span><span class="ident" id="6023353">text</span><span class="op" id="6023357">[</span><span class="builtinfunc" id="6023358">len</span><span class="op" id="6023361">(</span><span class="ident" id="6023362">linePrefix</span><span class="op" id="6023372">)</span><span class="op" id="6023373">:</span><span class="op" id="6023374">]</span><span class="op" id="6023375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023379">if</span>&nbsp;<span class="ident" id="6023382">i</span>&nbsp;<span class="op" id="6023384">:=</span>&nbsp;<span class="ident" id="6023387">strings</span><span class="op" id="6023394">.</span><span class="ident" id="6023395">LastIndex</span><span class="op" id="6023404">(</span><span class="ident" id="6023405">ldir</span><span class="op" id="6023409">,</span>&nbsp;<span class="string" id="6023411">&#34;:&#34;</span><span class="op" id="6023414">)</span><span class="op" id="6023415">;</span>&nbsp;<span class="ident" id="6023417">i</span>&nbsp;<span class="op" id="6023419">&gt;=</span>&nbsp;<span class="num" id="6023422">0</span>&nbsp;<span class="op" id="6023424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023429">if</span>&nbsp;<span class="ident" id="6023432">line</span><span class="op" id="6023436">,</span>&nbsp;<span class="ident" id="6023438">err</span>&nbsp;<span class="op" id="6023442">:=</span>&nbsp;<span class="ident" id="6023445">strconv</span><span class="op" id="6023452">.</span><span class="ident" id="6023453">Atoi</span><span class="op" id="6023457">(</span><span class="ident" id="6023458">ldir</span><span class="op" id="6023462">[</span><span class="ident" id="6023463">i</span><span class="op" id="6023464">+</span><span class="num" id="6023465">1</span><span class="op" id="6023466">:</span><span class="op" id="6023467">]</span><span class="op" id="6023468">)</span><span class="op" id="6023469">;</span>&nbsp;<span class="ident" id="6023471">err</span>&nbsp;<span class="op" id="6023475">==</span>&nbsp;<span class="ident" id="6023478">nil</span>&nbsp;<span class="op" id="6023482">&amp;&amp;</span>&nbsp;<span class="ident" id="6023485">line</span>&nbsp;<span class="op" id="6023490">&gt;</span>&nbsp;<span class="num" id="6023492">0</span>&nbsp;<span class="op" id="6023494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6023500">//&nbsp;The&nbsp;line&nbsp;directive&nbsp;we&nbsp;are&nbsp;about&nbsp;to&nbsp;print&nbsp;changed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6023556">//&nbsp;the&nbsp;Filename&nbsp;and&nbsp;Line&nbsp;number&nbsp;used&nbsp;for&nbsp;subsequent</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6023612">//&nbsp;tokens.&nbsp;We&nbsp;have&nbsp;to&nbsp;update&nbsp;our&nbsp;AST-space&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6023668">//&nbsp;accordingly&nbsp;and&nbsp;suspend&nbsp;indentation&nbsp;temporarily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023724">indent</span>&nbsp;<span class="op" id="6023731">:=</span>&nbsp;<span class="ident" id="6023734">p</span><span class="op" id="6023735">.</span><span class="ident" id="6023736">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023747">p</span><span class="op" id="6023748">.</span><span class="ident" id="6023749">indent</span>&nbsp;<span class="op" id="6023756">=</span>&nbsp;<span class="num" id="6023758">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023764">defer</span>&nbsp;<span class="keyword" id="6023770">func</span><span class="op" id="6023774">(</span><span class="op" id="6023775">)</span>&nbsp;<span class="op" id="6023777">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023784">p</span><span class="op" id="6023785">.</span><span class="ident" id="6023786">pos</span><span class="op" id="6023789">.</span><span class="ident" id="6023790">Filename</span>&nbsp;<span class="op" id="6023799">=</span>&nbsp;<span class="ident" id="6023801">ldir</span><span class="op" id="6023805">[</span><span class="op" id="6023806">:</span><span class="ident" id="6023807">i</span><span class="op" id="6023808">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023815">p</span><span class="op" id="6023816">.</span><span class="ident" id="6023817">pos</span><span class="op" id="6023820">.</span><span class="ident" id="6023821">Line</span>&nbsp;<span class="op" id="6023826">=</span>&nbsp;<span class="ident" id="6023828">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023838">p</span><span class="op" id="6023839">.</span><span class="ident" id="6023840">pos</span><span class="op" id="6023843">.</span><span class="ident" id="6023844">Column</span>&nbsp;<span class="op" id="6023851">=</span>&nbsp;<span class="num" id="6023853">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023860">p</span><span class="op" id="6023861">.</span><span class="ident" id="6023862">indent</span>&nbsp;<span class="op" id="6023869">=</span>&nbsp;<span class="ident" id="6023871">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023882">}</span><span class="op" id="6023883">(</span><span class="op" id="6023884">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6023900">//&nbsp;shortcut&nbsp;common&nbsp;case&nbsp;of&nbsp;//-style&nbsp;comments</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023946">if</span>&nbsp;<span class="ident" id="6023949">text</span><span class="op" id="6023953">[</span><span class="num" id="6023954">1</span><span class="op" id="6023955">]</span>&nbsp;<span class="op" id="6023957">==</span>&nbsp;<span class="string" id="6023960">&#39;/&#39;</span>&nbsp;<span class="op" id="6023964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023968">p</span><span class="op" id="6023969">.</span><span class="ident" id="6023970">writeString</span><span class="op" id="6023981">(</span><span class="ident" id="6023982">pos</span><span class="op" id="6023985">,</span>&nbsp;<span class="ident" id="6023987">trimRight</span><span class="op" id="6023996">(</span><span class="ident" id="6023997">text</span><span class="op" id="6024001">)</span><span class="op" id="6024002">,</span>&nbsp;<span class="builtintype" id="6024004">true</span><span class="op" id="6024008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024012">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024024">//&nbsp;for&nbsp;/*-style&nbsp;comments,&nbsp;print&nbsp;line&nbsp;by&nbsp;line&nbsp;and&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024082">//&nbsp;write&nbsp;function&nbsp;take&nbsp;care&nbsp;of&nbsp;the&nbsp;proper&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024137">lines</span>&nbsp;<span class="op" id="6024143">:=</span>&nbsp;<span class="ident" id="6024146">strings</span><span class="op" id="6024153">.</span><span class="ident" id="6024154">Split</span><span class="op" id="6024159">(</span><span class="ident" id="6024160">text</span><span class="op" id="6024164">,</span>&nbsp;<span class="string" id="6024166">&#34;\n&#34;</span><span class="op" id="6024170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024174">//&nbsp;The&nbsp;comment&nbsp;started&nbsp;in&nbsp;the&nbsp;first&nbsp;column&nbsp;but&nbsp;is&nbsp;going</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024231">//&nbsp;to&nbsp;be&nbsp;indented.&nbsp;For&nbsp;an&nbsp;idempotent&nbsp;result,&nbsp;add&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024293">//&nbsp;to&nbsp;all&nbsp;lines&nbsp;such&nbsp;that&nbsp;they&nbsp;look&nbsp;like&nbsp;they&nbsp;were&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024354">//&nbsp;before&nbsp;-&nbsp;this&nbsp;will&nbsp;make&nbsp;sure&nbsp;the&nbsp;common&nbsp;prefix&nbsp;computation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024417">//&nbsp;is&nbsp;the&nbsp;same&nbsp;independent&nbsp;of&nbsp;how&nbsp;many&nbsp;times&nbsp;formatting&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024477">//&nbsp;applied&nbsp;(was&nbsp;issue&nbsp;1835).</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024507">if</span>&nbsp;<span class="ident" id="6024510">pos</span><span class="op" id="6024513">.</span><span class="ident" id="6024514">IsValid</span><span class="op" id="6024521">(</span><span class="op" id="6024522">)</span>&nbsp;<span class="op" id="6024524">&amp;&amp;</span>&nbsp;<span class="ident" id="6024527">pos</span><span class="op" id="6024530">.</span><span class="ident" id="6024531">Column</span>&nbsp;<span class="op" id="6024538">==</span>&nbsp;<span class="num" id="6024541">1</span>&nbsp;<span class="op" id="6024543">&amp;&amp;</span>&nbsp;<span class="ident" id="6024546">p</span><span class="op" id="6024547">.</span><span class="ident" id="6024548">indent</span>&nbsp;<span class="op" id="6024555">&gt;</span>&nbsp;<span class="num" id="6024557">0</span>&nbsp;<span class="op" id="6024559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024563">for</span>&nbsp;<span class="ident" id="6024567">i</span><span class="op" id="6024568">,</span>&nbsp;<span class="ident" id="6024570">line</span>&nbsp;<span class="op" id="6024575">:=</span>&nbsp;<span class="keyword" id="6024578">range</span>&nbsp;<span class="ident" id="6024584">lines</span><span class="op" id="6024589">[</span><span class="num" id="6024590">1</span><span class="op" id="6024591">:</span><span class="op" id="6024592">]</span>&nbsp;<span class="op" id="6024594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024599">lines</span><span class="op" id="6024604">[</span><span class="num" id="6024605">1</span><span class="op" id="6024606">+</span><span class="ident" id="6024607">i</span><span class="op" id="6024608">]</span>&nbsp;<span class="op" id="6024610">=</span>&nbsp;<span class="string" id="6024612">&#34;&nbsp;&nbsp;&nbsp;&#34;</span>&nbsp;<span class="op" id="6024618">+</span>&nbsp;<span class="ident" id="6024620">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024630">}</span><br>
<span class="lineno">655</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024634">stripCommonPrefix</span><span class="op" id="6024651">(</span><span class="ident" id="6024652">lines</span><span class="op" id="6024657">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024661">//&nbsp;write&nbsp;comment&nbsp;lines,&nbsp;separated&nbsp;by&nbsp;formfeed,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024709">//&nbsp;without&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;the&nbsp;last&nbsp;line</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024754">for</span>&nbsp;<span class="ident" id="6024758">i</span><span class="op" id="6024759">,</span>&nbsp;<span class="ident" id="6024761">line</span>&nbsp;<span class="op" id="6024766">:=</span>&nbsp;<span class="keyword" id="6024769">range</span>&nbsp;<span class="ident" id="6024775">lines</span>&nbsp;<span class="op" id="6024781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024785">if</span>&nbsp;<span class="ident" id="6024788">i</span>&nbsp;<span class="op" id="6024790">&gt;</span>&nbsp;<span class="num" id="6024792">0</span>&nbsp;<span class="op" id="6024794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024799">p</span><span class="op" id="6024800">.</span><span class="ident" id="6024801">writeByte</span><span class="op" id="6024810">(</span><span class="string" id="6024811">&#39;\f&#39;</span><span class="op" id="6024815">,</span>&nbsp;<span class="num" id="6024817">1</span><span class="op" id="6024818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024823">pos</span>&nbsp;<span class="op" id="6024827">=</span>&nbsp;<span class="ident" id="6024829">p</span><span class="op" id="6024830">.</span><span class="ident" id="6024831">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024837">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024841">if</span>&nbsp;<span class="builtinfunc" id="6024844">len</span><span class="op" id="6024847">(</span><span class="ident" id="6024848">line</span><span class="op" id="6024852">)</span>&nbsp;<span class="op" id="6024854">&gt;</span>&nbsp;<span class="num" id="6024856">0</span>&nbsp;<span class="op" id="6024858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024863">p</span><span class="op" id="6024864">.</span><span class="ident" id="6024865">writeString</span><span class="op" id="6024876">(</span><span class="ident" id="6024877">pos</span><span class="op" id="6024880">,</span>&nbsp;<span class="ident" id="6024882">trimRight</span><span class="op" id="6024891">(</span><span class="ident" id="6024892">line</span><span class="op" id="6024896">)</span><span class="op" id="6024897">,</span>&nbsp;<span class="builtintype" id="6024899">true</span><span class="op" id="6024903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024910">}</span><br>
<span class="lineno"></span><span class="op" id="6024912">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="6024915">//&nbsp;writeCommentSuffix&nbsp;writes&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;comment&nbsp;if&nbsp;indicated</span><br>
<span class="lineno"></span><span class="comment" id="6024986">//&nbsp;and&nbsp;processes&nbsp;any&nbsp;leftover&nbsp;indentation&nbsp;information.&nbsp;If&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span><span class="comment" id="6025057">//&nbsp;is&nbsp;needed,&nbsp;the&nbsp;kind&nbsp;of&nbsp;break&nbsp;(newline&nbsp;vs&nbsp;formfeed)&nbsp;depends&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6025126">//&nbsp;pending&nbsp;whitespace.&nbsp;The&nbsp;writeCommentSuffix&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="6025194">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="6025266">//&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="6025277">//</span><br>
<span class="lineno"></span><span class="keyword" id="6025280">func</span>&nbsp;<span class="op" id="6025285">(</span><span class="ident" id="6025286">p</span>&nbsp;<span class="op" id="6025288">*</span><span class="ident" id="6025289">printer</span><span class="op" id="6025296">)</span>&nbsp;<span class="ident" id="6025298">writeCommentSuffix</span><span class="op" id="6025316">(</span><span class="ident" id="6025317">needsLinebreak</span>&nbsp;<span class="builtintype" id="6025332">bool</span><span class="op" id="6025336">)</span>&nbsp;<span class="op" id="6025338">(</span><span class="ident" id="6025339">wroteNewline</span><span class="op" id="6025351">,</span>&nbsp;<span class="ident" id="6025353">droppedFF</span>&nbsp;<span class="builtintype" id="6025363">bool</span><span class="op" id="6025367">)</span>&nbsp;<span class="op" id="6025369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025372">for</span>&nbsp;<span class="ident" id="6025376">i</span><span class="op" id="6025377">,</span>&nbsp;<span class="ident" id="6025379">ch</span>&nbsp;<span class="op" id="6025382">:=</span>&nbsp;<span class="keyword" id="6025385">range</span>&nbsp;<span class="ident" id="6025391">p</span><span class="op" id="6025392">.</span><span class="ident" id="6025393">wsbuf</span>&nbsp;<span class="op" id="6025399">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025403">switch</span>&nbsp;<span class="ident" id="6025410">ch</span>&nbsp;<span class="op" id="6025413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025417">case</span>&nbsp;<span class="ident" id="6025422">blank</span><span class="op" id="6025427">,</span>&nbsp;<span class="ident" id="6025429">vtab</span><span class="op" id="6025433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025438">//&nbsp;ignore&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025471">p</span><span class="op" id="6025472">.</span><span class="ident" id="6025473">wsbuf</span><span class="op" id="6025478">[</span><span class="ident" id="6025479">i</span><span class="op" id="6025480">]</span>&nbsp;<span class="op" id="6025482">=</span>&nbsp;<span class="ident" id="6025484">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025493">case</span>&nbsp;<span class="ident" id="6025498">indent</span><span class="op" id="6025504">,</span>&nbsp;<span class="ident" id="6025506">unindent</span><span class="op" id="6025514">:</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025519">//&nbsp;don&#39;t&nbsp;lose&nbsp;indentation&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025559">case</span>&nbsp;<span class="ident" id="6025564">newline</span><span class="op" id="6025571">,</span>&nbsp;<span class="ident" id="6025573">formfeed</span><span class="op" id="6025581">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025586">//&nbsp;if&nbsp;we&nbsp;need&nbsp;a&nbsp;line&nbsp;break,&nbsp;keep&nbsp;exactly&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025634">//&nbsp;but&nbsp;remember&nbsp;if&nbsp;we&nbsp;dropped&nbsp;any&nbsp;formfeeds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025681">if</span>&nbsp;<span class="ident" id="6025684">needsLinebreak</span>&nbsp;<span class="op" id="6025699">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025705">needsLinebreak</span>&nbsp;<span class="op" id="6025720">=</span>&nbsp;<span class="builtintype" id="6025722">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025732">wroteNewline</span>&nbsp;<span class="op" id="6025745">=</span>&nbsp;<span class="builtintype" id="6025747">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025755">}</span>&nbsp;<span class="keyword" id="6025757">else</span>&nbsp;<span class="op" id="6025762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025768">if</span>&nbsp;<span class="ident" id="6025771">ch</span>&nbsp;<span class="op" id="6025774">==</span>&nbsp;<span class="ident" id="6025777">formfeed</span>&nbsp;<span class="op" id="6025786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025793">droppedFF</span>&nbsp;<span class="op" id="6025803">=</span>&nbsp;<span class="builtintype" id="6025805">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025820">p</span><span class="op" id="6025821">.</span><span class="ident" id="6025822">wsbuf</span><span class="op" id="6025827">[</span><span class="ident" id="6025828">i</span><span class="op" id="6025829">]</span>&nbsp;<span class="op" id="6025831">=</span>&nbsp;<span class="ident" id="6025833">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025850">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025853">p</span><span class="op" id="6025854">.</span><span class="ident" id="6025855">writeWhitespace</span><span class="op" id="6025870">(</span><span class="builtinfunc" id="6025871">len</span><span class="op" id="6025874">(</span><span class="ident" id="6025875">p</span><span class="op" id="6025876">.</span><span class="ident" id="6025877">wsbuf</span><span class="op" id="6025882">)</span><span class="op" id="6025883">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025887">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;have&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025922">if</span>&nbsp;<span class="ident" id="6025925">needsLinebreak</span>&nbsp;<span class="op" id="6025940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025944">p</span><span class="op" id="6025945">.</span><span class="ident" id="6025946">writeByte</span><span class="op" id="6025955">(</span><span class="string" id="6025956">&#39;\n&#39;</span><span class="op" id="6025960">,</span>&nbsp;<span class="num" id="6025962">1</span><span class="op" id="6025963">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025967">wroteNewline</span>&nbsp;<span class="op" id="6025980">=</span>&nbsp;<span class="builtintype" id="6025982">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025992">return</span><br>
<span class="lineno"></span><span class="op" id="6025999">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="6026002">//&nbsp;intersperseComments&nbsp;consumes&nbsp;all&nbsp;comments&nbsp;that&nbsp;appear&nbsp;before&nbsp;the&nbsp;next&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="6026081">//&nbsp;tok&nbsp;and&nbsp;prints&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;buffered&nbsp;whitespace&nbsp;(i.e.,&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="6026162">//&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;written&nbsp;before&nbsp;the&nbsp;next&nbsp;token).&nbsp;A&nbsp;heuristic&nbsp;is&nbsp;used&nbsp;to&nbsp;mix</span><br>
<span class="lineno"></span><span class="comment" id="6026241">//&nbsp;the&nbsp;comments&nbsp;and&nbsp;whitespace.&nbsp;The&nbsp;intersperseComments&nbsp;result&nbsp;indicates&nbsp;if&nbsp;a</span><br>
<span class="lineno">715</span><span class="comment" id="6026319">//&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="6026399">//</span><br>
<span class="lineno"></span><span class="keyword" id="6026402">func</span>&nbsp;<span class="op" id="6026407">(</span><span class="ident" id="6026408">p</span>&nbsp;<span class="op" id="6026410">*</span><span class="ident" id="6026411">printer</span><span class="op" id="6026418">)</span>&nbsp;<span class="ident" id="6026420">intersperseComments</span><span class="op" id="6026439">(</span><span class="ident" id="6026440">next</span>&nbsp;<span class="ident" id="6026445">token</span><span class="op" id="6026450">.</span><span class="ident" id="6026451">Position</span><span class="op" id="6026459">,</span>&nbsp;<span class="ident" id="6026461">tok</span>&nbsp;<span class="ident" id="6026465">token</span><span class="op" id="6026470">.</span><span class="ident" id="6026471">Token</span><span class="op" id="6026476">)</span>&nbsp;<span class="op" id="6026478">(</span><span class="ident" id="6026479">wroteNewline</span><span class="op" id="6026491">,</span>&nbsp;<span class="ident" id="6026493">droppedFF</span>&nbsp;<span class="builtintype" id="6026503">bool</span><span class="op" id="6026507">)</span>&nbsp;<span class="op" id="6026509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026512">var</span>&nbsp;<span class="ident" id="6026516">last</span>&nbsp;<span class="op" id="6026521">*</span><span class="ident" id="6026522">ast</span><span class="op" id="6026525">.</span><span class="ident" id="6026526">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026535">for</span>&nbsp;<span class="ident" id="6026539">p</span><span class="op" id="6026540">.</span><span class="ident" id="6026541">commentBefore</span><span class="op" id="6026554">(</span><span class="ident" id="6026555">next</span><span class="op" id="6026559">)</span>&nbsp;<span class="op" id="6026561">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026565">for</span>&nbsp;<span class="ident" id="6026569">_</span><span class="op" id="6026570">,</span>&nbsp;<span class="ident" id="6026572">c</span>&nbsp;<span class="op" id="6026574">:=</span>&nbsp;<span class="keyword" id="6026577">range</span>&nbsp;<span class="ident" id="6026583">p</span><span class="op" id="6026584">.</span><span class="ident" id="6026585">comment</span><span class="op" id="6026592">.</span><span class="ident" id="6026593">List</span>&nbsp;<span class="op" id="6026598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026603">p</span><span class="op" id="6026604">.</span><span class="ident" id="6026605">writeCommentPrefix</span><span class="op" id="6026623">(</span><span class="ident" id="6026624">p</span><span class="op" id="6026625">.</span><span class="ident" id="6026626">posFor</span><span class="op" id="6026632">(</span><span class="ident" id="6026633">c</span><span class="op" id="6026634">.</span><span class="ident" id="6026635">Pos</span><span class="op" id="6026638">(</span><span class="op" id="6026639">)</span><span class="op" id="6026640">)</span><span class="op" id="6026641">,</span>&nbsp;<span class="ident" id="6026643">next</span><span class="op" id="6026647">,</span>&nbsp;<span class="ident" id="6026649">last</span><span class="op" id="6026653">,</span>&nbsp;<span class="ident" id="6026655">c</span><span class="op" id="6026656">,</span>&nbsp;<span class="ident" id="6026658">tok</span><span class="op" id="6026661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026666">p</span><span class="op" id="6026667">.</span><span class="ident" id="6026668">writeComment</span><span class="op" id="6026680">(</span><span class="ident" id="6026681">c</span><span class="op" id="6026682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026687">last</span>&nbsp;<span class="op" id="6026692">=</span>&nbsp;<span class="ident" id="6026694">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6026698">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026702">p</span><span class="op" id="6026703">.</span><span class="ident" id="6026704">nextComment</span><span class="op" id="6026715">(</span><span class="op" id="6026716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6026719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026723">if</span>&nbsp;<span class="ident" id="6026726">last</span>&nbsp;<span class="op" id="6026731">!=</span>&nbsp;<span class="ident" id="6026734">nil</span>&nbsp;<span class="op" id="6026738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6026742">//&nbsp;if&nbsp;the&nbsp;last&nbsp;comment&nbsp;is&nbsp;a&nbsp;/*-style&nbsp;comment&nbsp;and&nbsp;the&nbsp;next&nbsp;item</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6026807">//&nbsp;follows&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;but&nbsp;is&nbsp;not&nbsp;a&nbsp;comma,&nbsp;and&nbsp;not&nbsp;a&nbsp;&#34;closing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6026877">//&nbsp;token&nbsp;immediately&nbsp;following&nbsp;its&nbsp;corresponding&nbsp;&#34;opening&#34;&nbsp;token,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6026945">//&nbsp;add&nbsp;an&nbsp;extra&nbsp;blank&nbsp;for&nbsp;separation&nbsp;unless&nbsp;explicitly&nbsp;disabled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027011">if</span>&nbsp;<span class="ident" id="6027014">p</span><span class="op" id="6027015">.</span><span class="ident" id="6027016">mode</span><span class="op" id="6027020">&amp;</span><span class="ident" id="6027021">noExtraBlank</span>&nbsp;<span class="op" id="6027034">==</span>&nbsp;<span class="num" id="6027037">0</span>&nbsp;<span class="op" id="6027039">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027045">last</span><span class="op" id="6027049">.</span><span class="ident" id="6027050">Text</span><span class="op" id="6027054">[</span><span class="num" id="6027055">1</span><span class="op" id="6027056">]</span>&nbsp;<span class="op" id="6027058">==</span>&nbsp;<span class="string" id="6027061">&#39;*&#39;</span>&nbsp;<span class="op" id="6027065">&amp;&amp;</span>&nbsp;<span class="ident" id="6027068">p</span><span class="op" id="6027069">.</span><span class="ident" id="6027070">lineFor</span><span class="op" id="6027077">(</span><span class="ident" id="6027078">last</span><span class="op" id="6027082">.</span><span class="ident" id="6027083">Pos</span><span class="op" id="6027086">(</span><span class="op" id="6027087">)</span><span class="op" id="6027088">)</span>&nbsp;<span class="op" id="6027090">==</span>&nbsp;<span class="ident" id="6027093">next</span><span class="op" id="6027097">.</span><span class="ident" id="6027098">Line</span>&nbsp;<span class="op" id="6027103">&amp;&amp;</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027109">tok</span>&nbsp;<span class="op" id="6027113">!=</span>&nbsp;<span class="ident" id="6027116">token</span><span class="op" id="6027121">.</span><span class="ident" id="6027122">COMMA</span>&nbsp;<span class="op" id="6027128">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027134">(</span><span class="ident" id="6027135">tok</span>&nbsp;<span class="op" id="6027139">!=</span>&nbsp;<span class="ident" id="6027142">token</span><span class="op" id="6027147">.</span><span class="ident" id="6027148">RPAREN</span>&nbsp;<span class="op" id="6027155">||</span>&nbsp;<span class="ident" id="6027158">p</span><span class="op" id="6027159">.</span><span class="ident" id="6027160">prevOpen</span>&nbsp;<span class="op" id="6027169">==</span>&nbsp;<span class="ident" id="6027172">token</span><span class="op" id="6027177">.</span><span class="ident" id="6027178">LPAREN</span><span class="op" id="6027184">)</span>&nbsp;<span class="op" id="6027186">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027192">(</span><span class="ident" id="6027193">tok</span>&nbsp;<span class="op" id="6027197">!=</span>&nbsp;<span class="ident" id="6027200">token</span><span class="op" id="6027205">.</span><span class="ident" id="6027206">RBRACK</span>&nbsp;<span class="op" id="6027213">||</span>&nbsp;<span class="ident" id="6027216">p</span><span class="op" id="6027217">.</span><span class="ident" id="6027218">prevOpen</span>&nbsp;<span class="op" id="6027227">==</span>&nbsp;<span class="ident" id="6027230">token</span><span class="op" id="6027235">.</span><span class="ident" id="6027236">LBRACK</span><span class="op" id="6027242">)</span>&nbsp;<span class="op" id="6027244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027249">p</span><span class="op" id="6027250">.</span><span class="ident" id="6027251">writeByte</span><span class="op" id="6027260">(</span><span class="string" id="6027261">&#39;&nbsp;&#39;</span><span class="op" id="6027264">,</span>&nbsp;<span class="num" id="6027266">1</span><span class="op" id="6027267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027271">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027275">//&nbsp;ensure&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;line&nbsp;break&nbsp;after&nbsp;a&nbsp;//-style&nbsp;comment,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027340">//&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;}&#39;&nbsp;unless&nbsp;explicitly&nbsp;disabled,&nbsp;or&nbsp;at&nbsp;eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027404">needsLinebreak</span>&nbsp;<span class="op" id="6027419">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027425">last</span><span class="op" id="6027429">.</span><span class="ident" id="6027430">Text</span><span class="op" id="6027434">[</span><span class="num" id="6027435">1</span><span class="op" id="6027436">]</span>&nbsp;<span class="op" id="6027438">==</span>&nbsp;<span class="string" id="6027441">&#39;/&#39;</span>&nbsp;<span class="op" id="6027445">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027452">tok</span>&nbsp;<span class="op" id="6027456">==</span>&nbsp;<span class="ident" id="6027459">token</span><span class="op" id="6027464">.</span><span class="ident" id="6027465">RBRACE</span>&nbsp;<span class="op" id="6027472">&amp;&amp;</span>&nbsp;<span class="ident" id="6027475">p</span><span class="op" id="6027476">.</span><span class="ident" id="6027477">mode</span><span class="op" id="6027481">&amp;</span><span class="ident" id="6027482">noExtraLinebreak</span>&nbsp;<span class="op" id="6027499">==</span>&nbsp;<span class="num" id="6027502">0</span>&nbsp;<span class="op" id="6027504">||</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027511">tok</span>&nbsp;<span class="op" id="6027515">==</span>&nbsp;<span class="ident" id="6027518">token</span><span class="op" id="6027523">.</span><span class="ident" id="6027524">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027530">return</span>&nbsp;<span class="ident" id="6027537">p</span><span class="op" id="6027538">.</span><span class="ident" id="6027539">writeCommentSuffix</span><span class="op" id="6027557">(</span><span class="ident" id="6027558">needsLinebreak</span><span class="op" id="6027572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6027575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027579">//&nbsp;no&nbsp;comment&nbsp;was&nbsp;written&nbsp;-&nbsp;we&nbsp;should&nbsp;never&nbsp;reach&nbsp;here&nbsp;since</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027641">//&nbsp;intersperseComments&nbsp;should&nbsp;not&nbsp;be&nbsp;called&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6027699">p</span><span class="op" id="6027700">.</span><span class="ident" id="6027701">internalError</span><span class="op" id="6027714">(</span><span class="string" id="6027715">&#34;intersperseComments&nbsp;called&nbsp;without&nbsp;pending&nbsp;comments&#34;</span><span class="op" id="6027768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027771">return</span><br>
<span class="lineno"></span><span class="op" id="6027778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="6027781">//&nbsp;whiteWhitespace&nbsp;writes&nbsp;the&nbsp;first&nbsp;n&nbsp;whitespace&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="6027839">func</span>&nbsp;<span class="op" id="6027844">(</span><span class="ident" id="6027845">p</span>&nbsp;<span class="op" id="6027847">*</span><span class="ident" id="6027848">printer</span><span class="op" id="6027855">)</span>&nbsp;<span class="ident" id="6027857">writeWhitespace</span><span class="op" id="6027872">(</span><span class="ident" id="6027873">n</span>&nbsp;<span class="builtintype" id="6027875">int</span><span class="op" id="6027878">)</span>&nbsp;<span class="op" id="6027880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027883">//&nbsp;write&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027901">for</span>&nbsp;<span class="ident" id="6027905">i</span>&nbsp;<span class="op" id="6027907">:=</span>&nbsp;<span class="num" id="6027910">0</span><span class="op" id="6027911">;</span>&nbsp;<span class="ident" id="6027913">i</span>&nbsp;<span class="op" id="6027915">&lt;</span>&nbsp;<span class="ident" id="6027917">n</span><span class="op" id="6027918">;</span>&nbsp;<span class="ident" id="6027920">i</span><span class="op" id="6027921">++</span>&nbsp;<span class="op" id="6027924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027928">switch</span>&nbsp;<span class="ident" id="6027935">ch</span>&nbsp;<span class="op" id="6027938">:=</span>&nbsp;<span class="ident" id="6027941">p</span><span class="op" id="6027942">.</span><span class="ident" id="6027943">wsbuf</span><span class="op" id="6027948">[</span><span class="ident" id="6027949">i</span><span class="op" id="6027950">]</span><span class="op" id="6027951">;</span>&nbsp;<span class="ident" id="6027953">ch</span>&nbsp;<span class="op" id="6027956">{</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027960">case</span>&nbsp;<span class="ident" id="6027965">ignore</span><span class="op" id="6027971">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6027976">//&nbsp;ignore!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6027989">case</span>&nbsp;<span class="ident" id="6027994">indent</span><span class="op" id="6028000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028005">p</span><span class="op" id="6028006">.</span><span class="ident" id="6028007">indent</span><span class="op" id="6028013">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028018">case</span>&nbsp;<span class="ident" id="6028023">unindent</span><span class="op" id="6028031">:</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028036">p</span><span class="op" id="6028037">.</span><span class="ident" id="6028038">indent</span><span class="op" id="6028044">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028050">if</span>&nbsp;<span class="ident" id="6028053">p</span><span class="op" id="6028054">.</span><span class="ident" id="6028055">indent</span>&nbsp;<span class="op" id="6028062">&lt;</span>&nbsp;<span class="num" id="6028064">0</span>&nbsp;<span class="op" id="6028066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028072">p</span><span class="op" id="6028073">.</span><span class="ident" id="6028074">internalError</span><span class="op" id="6028087">(</span><span class="string" id="6028088">&#34;negative&nbsp;indentation:&#34;</span><span class="op" id="6028111">,</span>&nbsp;<span class="ident" id="6028113">p</span><span class="op" id="6028114">.</span><span class="ident" id="6028115">indent</span><span class="op" id="6028121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028127">p</span><span class="op" id="6028128">.</span><span class="ident" id="6028129">indent</span>&nbsp;<span class="op" id="6028136">=</span>&nbsp;<span class="num" id="6028138">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028143">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028147">case</span>&nbsp;<span class="ident" id="6028152">newline</span><span class="op" id="6028159">,</span>&nbsp;<span class="ident" id="6028161">formfeed</span><span class="op" id="6028169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028174">//&nbsp;A&nbsp;line&nbsp;break&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#34;correcting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028232">//&nbsp;unindent&nbsp;is&nbsp;swapped&nbsp;with&nbsp;the&nbsp;unindent&nbsp;-&nbsp;this&nbsp;permits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028291">//&nbsp;proper&nbsp;label&nbsp;positioning.&nbsp;If&nbsp;a&nbsp;comment&nbsp;is&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028347">//&nbsp;the&nbsp;line&nbsp;break&nbsp;and&nbsp;the&nbsp;label,&nbsp;the&nbsp;unindent&nbsp;is&nbsp;not</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028403">//&nbsp;part&nbsp;of&nbsp;the&nbsp;comment&nbsp;whitespace&nbsp;prefix&nbsp;and&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028463">//&nbsp;will&nbsp;be&nbsp;positioned&nbsp;correctly&nbsp;indented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028508">if</span>&nbsp;<span class="ident" id="6028511">i</span><span class="op" id="6028512">+</span><span class="num" id="6028513">1</span>&nbsp;<span class="op" id="6028515">&lt;</span>&nbsp;<span class="ident" id="6028517">n</span>&nbsp;<span class="op" id="6028519">&amp;&amp;</span>&nbsp;<span class="ident" id="6028522">p</span><span class="op" id="6028523">.</span><span class="ident" id="6028524">wsbuf</span><span class="op" id="6028529">[</span><span class="ident" id="6028530">i</span><span class="op" id="6028531">+</span><span class="num" id="6028532">1</span><span class="op" id="6028533">]</span>&nbsp;<span class="op" id="6028535">==</span>&nbsp;<span class="ident" id="6028538">unindent</span>&nbsp;<span class="op" id="6028547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028553">//&nbsp;Use&nbsp;a&nbsp;formfeed&nbsp;to&nbsp;terminate&nbsp;the&nbsp;current&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028609">//&nbsp;Otherwise,&nbsp;a&nbsp;long&nbsp;label&nbsp;name&nbsp;on&nbsp;the&nbsp;next&nbsp;line&nbsp;leading</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028670">//&nbsp;to&nbsp;a&nbsp;wide&nbsp;column&nbsp;may&nbsp;increase&nbsp;the&nbsp;indentation&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028730">//&nbsp;of&nbsp;lines&nbsp;before&nbsp;the&nbsp;label;&nbsp;effectively&nbsp;leading&nbsp;to&nbsp;wrong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028793">//&nbsp;indentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028813">p</span><span class="op" id="6028814">.</span><span class="ident" id="6028815">wsbuf</span><span class="op" id="6028820">[</span><span class="ident" id="6028821">i</span><span class="op" id="6028822">]</span><span class="op" id="6028823">,</span>&nbsp;<span class="ident" id="6028825">p</span><span class="op" id="6028826">.</span><span class="ident" id="6028827">wsbuf</span><span class="op" id="6028832">[</span><span class="ident" id="6028833">i</span><span class="op" id="6028834">+</span><span class="num" id="6028835">1</span><span class="op" id="6028836">]</span>&nbsp;<span class="op" id="6028838">=</span>&nbsp;<span class="ident" id="6028840">unindent</span><span class="op" id="6028848">,</span>&nbsp;<span class="ident" id="6028850">formfeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028863">i</span><span class="op" id="6028864">--</span>&nbsp;<span class="comment" id="6028867">//&nbsp;do&nbsp;it&nbsp;again</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028886">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028903">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6028917">default</span><span class="op" id="6028924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028929">p</span><span class="op" id="6028930">.</span><span class="ident" id="6028931">writeByte</span><span class="op" id="6028940">(</span><span class="builtintype" id="6028941">byte</span><span class="op" id="6028945">(</span><span class="ident" id="6028946">ch</span><span class="op" id="6028948">)</span><span class="op" id="6028949">,</span>&nbsp;<span class="num" id="6028951">1</span><span class="op" id="6028952">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6028959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6028963">//&nbsp;shift&nbsp;remaining&nbsp;entries&nbsp;down</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6028996">l</span>&nbsp;<span class="op" id="6028998">:=</span>&nbsp;<span class="builtinfunc" id="6029001">copy</span><span class="op" id="6029005">(</span><span class="ident" id="6029006">p</span><span class="op" id="6029007">.</span><span class="ident" id="6029008">wsbuf</span><span class="op" id="6029013">,</span>&nbsp;<span class="ident" id="6029015">p</span><span class="op" id="6029016">.</span><span class="ident" id="6029017">wsbuf</span><span class="op" id="6029022">[</span><span class="ident" id="6029023">n</span><span class="op" id="6029024">:</span><span class="op" id="6029025">]</span><span class="op" id="6029026">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029029">p</span><span class="op" id="6029030">.</span><span class="ident" id="6029031">wsbuf</span>&nbsp;<span class="op" id="6029037">=</span>&nbsp;<span class="ident" id="6029039">p</span><span class="op" id="6029040">.</span><span class="ident" id="6029041">wsbuf</span><span class="op" id="6029046">[</span><span class="op" id="6029047">:</span><span class="ident" id="6029048">l</span><span class="op" id="6029049">]</span><br>
<span class="lineno"></span><span class="op" id="6029051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6029054">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6029134">//&nbsp;Printing&nbsp;interface</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="6029157">//&nbsp;nlines&nbsp;limits&nbsp;n&nbsp;to&nbsp;maxNewlines.</span><br>
<span class="lineno"></span><span class="keyword" id="6029192">func</span>&nbsp;<span class="ident" id="6029197">nlimit</span><span class="op" id="6029203">(</span><span class="ident" id="6029204">n</span>&nbsp;<span class="builtintype" id="6029206">int</span><span class="op" id="6029209">)</span>&nbsp;<span class="builtintype" id="6029211">int</span>&nbsp;<span class="op" id="6029215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029218">if</span>&nbsp;<span class="ident" id="6029221">n</span>&nbsp;<span class="op" id="6029223">&gt;</span>&nbsp;<span class="ident" id="6029225">maxNewlines</span>&nbsp;<span class="op" id="6029237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029241">n</span>&nbsp;<span class="op" id="6029243">=</span>&nbsp;<span class="ident" id="6029245">maxNewlines</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6029258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029261">return</span>&nbsp;<span class="ident" id="6029268">n</span><br>
<span class="lineno"></span><span class="op" id="6029270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6029273">func</span>&nbsp;<span class="ident" id="6029278">mayCombine</span><span class="op" id="6029288">(</span><span class="ident" id="6029289">prev</span>&nbsp;<span class="ident" id="6029294">token</span><span class="op" id="6029299">.</span><span class="ident" id="6029300">Token</span><span class="op" id="6029305">,</span>&nbsp;<span class="ident" id="6029307">next</span>&nbsp;<span class="builtintype" id="6029312">byte</span><span class="op" id="6029316">)</span>&nbsp;<span class="op" id="6029318">(</span><span class="ident" id="6029319">b</span>&nbsp;<span class="builtintype" id="6029321">bool</span><span class="op" id="6029325">)</span>&nbsp;<span class="op" id="6029327">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029330">switch</span>&nbsp;<span class="ident" id="6029337">prev</span>&nbsp;<span class="op" id="6029342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029345">case</span>&nbsp;<span class="ident" id="6029350">token</span><span class="op" id="6029355">.</span><span class="ident" id="6029356">INT</span><span class="op" id="6029359">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029363">b</span>&nbsp;<span class="op" id="6029365">=</span>&nbsp;<span class="ident" id="6029367">next</span>&nbsp;<span class="op" id="6029372">==</span>&nbsp;<span class="string" id="6029375">&#39;.&#39;</span>&nbsp;<span class="comment" id="6029379">//&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029386">case</span>&nbsp;<span class="ident" id="6029391">token</span><span class="op" id="6029396">.</span><span class="ident" id="6029397">ADD</span><span class="op" id="6029400">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029404">b</span>&nbsp;<span class="op" id="6029406">=</span>&nbsp;<span class="ident" id="6029408">next</span>&nbsp;<span class="op" id="6029413">==</span>&nbsp;<span class="string" id="6029416">&#39;+&#39;</span>&nbsp;<span class="comment" id="6029420">//&nbsp;++</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029427">case</span>&nbsp;<span class="ident" id="6029432">token</span><span class="op" id="6029437">.</span><span class="ident" id="6029438">SUB</span><span class="op" id="6029441">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029445">b</span>&nbsp;<span class="op" id="6029447">=</span>&nbsp;<span class="ident" id="6029449">next</span>&nbsp;<span class="op" id="6029454">==</span>&nbsp;<span class="string" id="6029457">&#39;-&#39;</span>&nbsp;<span class="comment" id="6029461">//&nbsp;--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029468">case</span>&nbsp;<span class="ident" id="6029473">token</span><span class="op" id="6029478">.</span><span class="ident" id="6029479">QUO</span><span class="op" id="6029482">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029486">b</span>&nbsp;<span class="op" id="6029488">=</span>&nbsp;<span class="ident" id="6029490">next</span>&nbsp;<span class="op" id="6029495">==</span>&nbsp;<span class="string" id="6029498">&#39;*&#39;</span>&nbsp;<span class="comment" id="6029502">//&nbsp;/*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029509">case</span>&nbsp;<span class="ident" id="6029514">token</span><span class="op" id="6029519">.</span><span class="ident" id="6029520">LSS</span><span class="op" id="6029523">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029527">b</span>&nbsp;<span class="op" id="6029529">=</span>&nbsp;<span class="ident" id="6029531">next</span>&nbsp;<span class="op" id="6029536">==</span>&nbsp;<span class="string" id="6029539">&#39;-&#39;</span>&nbsp;<span class="op" id="6029543">||</span>&nbsp;<span class="ident" id="6029546">next</span>&nbsp;<span class="op" id="6029551">==</span>&nbsp;<span class="string" id="6029554">&#39;&lt;&#39;</span>&nbsp;<span class="comment" id="6029558">//&nbsp;&lt;-&nbsp;or&nbsp;&lt;&lt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029571">case</span>&nbsp;<span class="ident" id="6029576">token</span><span class="op" id="6029581">.</span><span class="ident" id="6029582">AND</span><span class="op" id="6029585">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6029589">b</span>&nbsp;<span class="op" id="6029591">=</span>&nbsp;<span class="ident" id="6029593">next</span>&nbsp;<span class="op" id="6029598">==</span>&nbsp;<span class="string" id="6029601">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="6029605">||</span>&nbsp;<span class="ident" id="6029608">next</span>&nbsp;<span class="op" id="6029613">==</span>&nbsp;<span class="string" id="6029616">&#39;^&#39;</span>&nbsp;<span class="comment" id="6029620">//&nbsp;&amp;&amp;&nbsp;or&nbsp;&amp;^</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6029633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6029636">return</span><br>
<span class="lineno">825</span><span class="op" id="6029643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6029646">//&nbsp;print&nbsp;prints&nbsp;a&nbsp;list&nbsp;of&nbsp;&#34;items&#34;&nbsp;(roughly&nbsp;corresponding&nbsp;to&nbsp;syntactic</span><br>
<span class="lineno"></span><span class="comment" id="6029716">//&nbsp;tokens,&nbsp;but&nbsp;also&nbsp;including&nbsp;whitespace&nbsp;and&nbsp;formatting&nbsp;information).</span><br>
<span class="lineno"></span><span class="comment" id="6029786">//&nbsp;It&nbsp;is&nbsp;the&nbsp;only&nbsp;print&nbsp;function&nbsp;that&nbsp;should&nbsp;be&nbsp;called&nbsp;directly&nbsp;from</span><br>
<span class="lineno">830</span><span class="comment" id="6029855">//&nbsp;any&nbsp;of&nbsp;the&nbsp;AST&nbsp;printing&nbsp;functions&nbsp;in&nbsp;nodes.go.</span><br>
<span class="lineno"></span><span class="comment" id="6029905">//</span><br>
<span class="lineno"></span><span class="comment" id="6029908">//&nbsp;Whitespace&nbsp;is&nbsp;accumulated&nbsp;until&nbsp;a&nbsp;non-whitespace&nbsp;token&nbsp;appears.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="6029979">//&nbsp;comments&nbsp;that&nbsp;need&nbsp;to&nbsp;appear&nbsp;before&nbsp;that&nbsp;token&nbsp;are&nbsp;printed&nbsp;first,</span><br>
<span class="lineno"></span><span class="comment" id="6030048">//&nbsp;taking&nbsp;into&nbsp;account&nbsp;the&nbsp;amount&nbsp;and&nbsp;structure&nbsp;of&nbsp;any&nbsp;pending&nbsp;white-</span><br>
<span class="lineno">835</span><span class="comment" id="6030118">//&nbsp;space&nbsp;for&nbsp;best&nbsp;comment&nbsp;placement.&nbsp;Then,&nbsp;any&nbsp;leftover&nbsp;whitespace&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="6030188">//&nbsp;printed,&nbsp;followed&nbsp;by&nbsp;the&nbsp;actual&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="6030230">//</span><br>
<span class="lineno"></span><span class="keyword" id="6030233">func</span>&nbsp;<span class="op" id="6030238">(</span><span class="ident" id="6030239">p</span>&nbsp;<span class="op" id="6030241">*</span><span class="ident" id="6030242">printer</span><span class="op" id="6030249">)</span>&nbsp;<span class="builtinfunc" id="6030251">print</span><span class="op" id="6030256">(</span><span class="ident" id="6030257">args</span>&nbsp;<span class="op" id="6030262">...</span><span class="keyword" id="6030265">interface</span><span class="op" id="6030274">{</span><span class="op" id="6030275">}</span><span class="op" id="6030276">)</span>&nbsp;<span class="op" id="6030278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030281">for</span>&nbsp;<span class="ident" id="6030285">_</span><span class="op" id="6030286">,</span>&nbsp;<span class="ident" id="6030288">arg</span>&nbsp;<span class="op" id="6030292">:=</span>&nbsp;<span class="keyword" id="6030295">range</span>&nbsp;<span class="ident" id="6030301">args</span>&nbsp;<span class="op" id="6030306">{</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030310">//&nbsp;information&nbsp;about&nbsp;the&nbsp;current&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030349">var</span>&nbsp;<span class="ident" id="6030353">data</span>&nbsp;<span class="builtintype" id="6030358">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030367">var</span>&nbsp;<span class="ident" id="6030371">isLit</span>&nbsp;<span class="builtintype" id="6030377">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030384">var</span>&nbsp;<span class="ident" id="6030388">impliedSemi</span>&nbsp;<span class="builtintype" id="6030400">bool</span>&nbsp;<span class="comment" id="6030405">//&nbsp;value&nbsp;for&nbsp;p.impliedSemi&nbsp;after&nbsp;this&nbsp;arg</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030450">//&nbsp;record&nbsp;previous&nbsp;opening&nbsp;token,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030493">switch</span>&nbsp;<span class="ident" id="6030500">p</span><span class="op" id="6030501">.</span><span class="ident" id="6030502">lastTok</span>&nbsp;<span class="op" id="6030510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030514">case</span>&nbsp;<span class="ident" id="6030519">token</span><span class="op" id="6030524">.</span><span class="ident" id="6030525">ILLEGAL</span><span class="op" id="6030532">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030537">//&nbsp;ignore&nbsp;(white&nbsp;space)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030563">case</span>&nbsp;<span class="ident" id="6030568">token</span><span class="op" id="6030573">.</span><span class="ident" id="6030574">LPAREN</span><span class="op" id="6030580">,</span>&nbsp;<span class="ident" id="6030582">token</span><span class="op" id="6030587">.</span><span class="ident" id="6030588">LBRACK</span><span class="op" id="6030594">:</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030599">p</span><span class="op" id="6030600">.</span><span class="ident" id="6030601">prevOpen</span>&nbsp;<span class="op" id="6030610">=</span>&nbsp;<span class="ident" id="6030612">p</span><span class="op" id="6030613">.</span><span class="ident" id="6030614">lastTok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030624">default</span><span class="op" id="6030631">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030636">//&nbsp;other&nbsp;tokens&nbsp;followed&nbsp;any&nbsp;opening&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030682">p</span><span class="op" id="6030683">.</span><span class="ident" id="6030684">prevOpen</span>&nbsp;<span class="op" id="6030693">=</span>&nbsp;<span class="ident" id="6030695">token</span><span class="op" id="6030700">.</span><span class="ident" id="6030701">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030711">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030716">switch</span>&nbsp;<span class="ident" id="6030723">x</span>&nbsp;<span class="op" id="6030725">:=</span>&nbsp;<span class="ident" id="6030728">arg</span><span class="op" id="6030731">.</span><span class="op" id="6030732">(</span><span class="keyword" id="6030733">type</span><span class="op" id="6030737">)</span>&nbsp;<span class="op" id="6030739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030743">case</span>&nbsp;<span class="ident" id="6030748">pmode</span><span class="op" id="6030753">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030758">//&nbsp;toggle&nbsp;printer&nbsp;mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030784">p</span><span class="op" id="6030785">.</span><span class="ident" id="6030786">mode</span>&nbsp;<span class="op" id="6030791">^=</span>&nbsp;<span class="ident" id="6030794">x</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030799">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030811">case</span>&nbsp;<span class="ident" id="6030816">whiteSpace</span><span class="op" id="6030826">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030831">if</span>&nbsp;<span class="ident" id="6030834">x</span>&nbsp;<span class="op" id="6030836">==</span>&nbsp;<span class="ident" id="6030839">ignore</span>&nbsp;<span class="op" id="6030846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030852">//&nbsp;don&#39;t&nbsp;add&nbsp;ignore&#39;s&nbsp;to&nbsp;the&nbsp;buffer;&nbsp;they</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030898">//&nbsp;may&nbsp;screw&nbsp;up&nbsp;&#34;correcting&#34;&nbsp;unindents&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6030946">//&nbsp;LabeledStmt)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6030966">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6030978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6030983">i</span>&nbsp;<span class="op" id="6030985">:=</span>&nbsp;<span class="builtinfunc" id="6030988">len</span><span class="op" id="6030991">(</span><span class="ident" id="6030992">p</span><span class="op" id="6030993">.</span><span class="ident" id="6030994">wsbuf</span><span class="op" id="6030999">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031004">if</span>&nbsp;<span class="ident" id="6031007">i</span>&nbsp;<span class="op" id="6031009">==</span>&nbsp;<span class="builtinfunc" id="6031012">cap</span><span class="op" id="6031015">(</span><span class="ident" id="6031016">p</span><span class="op" id="6031017">.</span><span class="ident" id="6031018">wsbuf</span><span class="op" id="6031023">)</span>&nbsp;<span class="op" id="6031025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031031">//&nbsp;Whitespace&nbsp;sequences&nbsp;are&nbsp;very&nbsp;short&nbsp;so&nbsp;this&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031089">//&nbsp;never&nbsp;happen.&nbsp;Handle&nbsp;gracefully&nbsp;(but&nbsp;possibly&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031147">//&nbsp;bad&nbsp;comment&nbsp;placement)&nbsp;if&nbsp;it&nbsp;does&nbsp;happen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031196">p</span><span class="op" id="6031197">.</span><span class="ident" id="6031198">writeWhitespace</span><span class="op" id="6031213">(</span><span class="ident" id="6031214">i</span><span class="op" id="6031215">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031221">i</span>&nbsp;<span class="op" id="6031223">=</span>&nbsp;<span class="num" id="6031225">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6031230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031235">p</span><span class="op" id="6031236">.</span><span class="ident" id="6031237">wsbuf</span>&nbsp;<span class="op" id="6031243">=</span>&nbsp;<span class="ident" id="6031245">p</span><span class="op" id="6031246">.</span><span class="ident" id="6031247">wsbuf</span><span class="op" id="6031252">[</span><span class="num" id="6031253">0</span>&nbsp;<span class="op" id="6031255">:</span>&nbsp;<span class="ident" id="6031257">i</span><span class="op" id="6031258">+</span><span class="num" id="6031259">1</span><span class="op" id="6031260">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031265">p</span><span class="op" id="6031266">.</span><span class="ident" id="6031267">wsbuf</span><span class="op" id="6031272">[</span><span class="ident" id="6031273">i</span><span class="op" id="6031274">]</span>&nbsp;<span class="op" id="6031276">=</span>&nbsp;<span class="ident" id="6031278">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031283">if</span>&nbsp;<span class="ident" id="6031286">x</span>&nbsp;<span class="op" id="6031288">==</span>&nbsp;<span class="ident" id="6031291">newline</span>&nbsp;<span class="op" id="6031299">||</span>&nbsp;<span class="ident" id="6031302">x</span>&nbsp;<span class="op" id="6031304">==</span>&nbsp;<span class="ident" id="6031307">formfeed</span>&nbsp;<span class="op" id="6031316">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031322">//&nbsp;newlines&nbsp;affect&nbsp;the&nbsp;current&nbsp;state&nbsp;(p.impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031379">//&nbsp;and&nbsp;not&nbsp;the&nbsp;state&nbsp;after&nbsp;printing&nbsp;arg&nbsp;(impliedSemi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031437">//&nbsp;because&nbsp;comments&nbsp;can&nbsp;be&nbsp;interspersed&nbsp;before&nbsp;the&nbsp;arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031496">//&nbsp;in&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031516">p</span><span class="op" id="6031517">.</span><span class="ident" id="6031518">impliedSemi</span>&nbsp;<span class="op" id="6031530">=</span>&nbsp;<span class="builtintype" id="6031532">false</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6031541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031546">p</span><span class="op" id="6031547">.</span><span class="ident" id="6031548">lastTok</span>&nbsp;<span class="op" id="6031556">=</span>&nbsp;<span class="ident" id="6031558">token</span><span class="op" id="6031563">.</span><span class="ident" id="6031564">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031575">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031587">case</span>&nbsp;<span class="op" id="6031592">*</span><span class="ident" id="6031593">ast</span><span class="op" id="6031596">.</span><span class="ident" id="6031597">Ident</span><span class="op" id="6031602">:</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031607">data</span>&nbsp;<span class="op" id="6031612">=</span>&nbsp;<span class="ident" id="6031614">x</span><span class="op" id="6031615">.</span><span class="ident" id="6031616">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031624">impliedSemi</span>&nbsp;<span class="op" id="6031636">=</span>&nbsp;<span class="builtintype" id="6031638">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031646">p</span><span class="op" id="6031647">.</span><span class="ident" id="6031648">lastTok</span>&nbsp;<span class="op" id="6031656">=</span>&nbsp;<span class="ident" id="6031658">token</span><span class="op" id="6031663">.</span><span class="ident" id="6031664">IDENT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031673">case</span>&nbsp;<span class="op" id="6031678">*</span><span class="ident" id="6031679">ast</span><span class="op" id="6031682">.</span><span class="ident" id="6031683">BasicLit</span><span class="op" id="6031691">:</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031696">data</span>&nbsp;<span class="op" id="6031701">=</span>&nbsp;<span class="ident" id="6031703">x</span><span class="op" id="6031704">.</span><span class="ident" id="6031705">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031714">isLit</span>&nbsp;<span class="op" id="6031720">=</span>&nbsp;<span class="builtintype" id="6031722">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031730">impliedSemi</span>&nbsp;<span class="op" id="6031742">=</span>&nbsp;<span class="builtintype" id="6031744">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031752">p</span><span class="op" id="6031753">.</span><span class="ident" id="6031754">lastTok</span>&nbsp;<span class="op" id="6031762">=</span>&nbsp;<span class="ident" id="6031764">x</span><span class="op" id="6031765">.</span><span class="ident" id="6031766">Kind</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031774">case</span>&nbsp;<span class="ident" id="6031779">token</span><span class="op" id="6031784">.</span><span class="ident" id="6031785">Token</span><span class="op" id="6031790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6031795">s</span>&nbsp;<span class="op" id="6031797">:=</span>&nbsp;<span class="ident" id="6031800">x</span><span class="op" id="6031801">.</span><span class="ident" id="6031802">String</span><span class="op" id="6031808">(</span><span class="op" id="6031809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6031814">if</span>&nbsp;<span class="ident" id="6031817">mayCombine</span><span class="op" id="6031827">(</span><span class="ident" id="6031828">p</span><span class="op" id="6031829">.</span><span class="ident" id="6031830">lastTok</span><span class="op" id="6031837">,</span>&nbsp;<span class="ident" id="6031839">s</span><span class="op" id="6031840">[</span><span class="num" id="6031841">0</span><span class="op" id="6031842">]</span><span class="op" id="6031843">)</span>&nbsp;<span class="op" id="6031845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031851">//&nbsp;the&nbsp;previous&nbsp;and&nbsp;the&nbsp;current&nbsp;token&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031901">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;blank&nbsp;otherwise&nbsp;they&nbsp;combine</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6031952">//&nbsp;into&nbsp;a&nbsp;different&nbsp;incorrect&nbsp;token&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6032001">//&nbsp;(except&nbsp;for&nbsp;token.INT&nbsp;followed&nbsp;by&nbsp;a&nbsp;&#39;.&#39;&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6032053">//&nbsp;should&nbsp;never&nbsp;happen&nbsp;because&nbsp;it&nbsp;is&nbsp;taken&nbsp;care</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6032105">//&nbsp;of&nbsp;via&nbsp;binary&nbsp;expression&nbsp;formatting)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032149">if</span>&nbsp;<span class="builtinfunc" id="6032152">len</span><span class="op" id="6032155">(</span><span class="ident" id="6032156">p</span><span class="op" id="6032157">.</span><span class="ident" id="6032158">wsbuf</span><span class="op" id="6032163">)</span>&nbsp;<span class="op" id="6032165">!=</span>&nbsp;<span class="num" id="6032168">0</span>&nbsp;<span class="op" id="6032170">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032177">p</span><span class="op" id="6032178">.</span><span class="ident" id="6032179">internalError</span><span class="op" id="6032192">(</span><span class="string" id="6032193">&#34;whitespace&nbsp;buffer&nbsp;not&nbsp;empty&#34;</span><span class="op" id="6032222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6032228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032234">p</span><span class="op" id="6032235">.</span><span class="ident" id="6032236">wsbuf</span>&nbsp;<span class="op" id="6032242">=</span>&nbsp;<span class="ident" id="6032244">p</span><span class="op" id="6032245">.</span><span class="ident" id="6032246">wsbuf</span><span class="op" id="6032251">[</span><span class="num" id="6032252">0</span><span class="op" id="6032253">:</span><span class="num" id="6032254">1</span><span class="op" id="6032255">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032261">p</span><span class="op" id="6032262">.</span><span class="ident" id="6032263">wsbuf</span><span class="op" id="6032268">[</span><span class="num" id="6032269">0</span><span class="op" id="6032270">]</span>&nbsp;<span class="op" id="6032272">=</span>&nbsp;<span class="string" id="6032274">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6032281">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032286">data</span>&nbsp;<span class="op" id="6032291">=</span>&nbsp;<span class="ident" id="6032293">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6032298">//&nbsp;some&nbsp;keywords&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;imply&nbsp;a&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032358">switch</span>&nbsp;<span class="ident" id="6032365">x</span>&nbsp;<span class="op" id="6032367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032372">case</span>&nbsp;<span class="ident" id="6032377">token</span><span class="op" id="6032382">.</span><span class="ident" id="6032383">BREAK</span><span class="op" id="6032388">,</span>&nbsp;<span class="ident" id="6032390">token</span><span class="op" id="6032395">.</span><span class="ident" id="6032396">CONTINUE</span><span class="op" id="6032404">,</span>&nbsp;<span class="ident" id="6032406">token</span><span class="op" id="6032411">.</span><span class="ident" id="6032412">FALLTHROUGH</span><span class="op" id="6032423">,</span>&nbsp;<span class="ident" id="6032425">token</span><span class="op" id="6032430">.</span><span class="ident" id="6032431">RETURN</span><span class="op" id="6032437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032443">token</span><span class="op" id="6032448">.</span><span class="ident" id="6032449">INC</span><span class="op" id="6032452">,</span>&nbsp;<span class="ident" id="6032454">token</span><span class="op" id="6032459">.</span><span class="ident" id="6032460">DEC</span><span class="op" id="6032463">,</span>&nbsp;<span class="ident" id="6032465">token</span><span class="op" id="6032470">.</span><span class="ident" id="6032471">RPAREN</span><span class="op" id="6032477">,</span>&nbsp;<span class="ident" id="6032479">token</span><span class="op" id="6032484">.</span><span class="ident" id="6032485">RBRACK</span><span class="op" id="6032491">,</span>&nbsp;<span class="ident" id="6032493">token</span><span class="op" id="6032498">.</span><span class="ident" id="6032499">RBRACE</span><span class="op" id="6032505">:</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032511">impliedSemi</span>&nbsp;<span class="op" id="6032523">=</span>&nbsp;<span class="builtintype" id="6032525">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6032533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032538">p</span><span class="op" id="6032539">.</span><span class="ident" id="6032540">lastTok</span>&nbsp;<span class="op" id="6032548">=</span>&nbsp;<span class="ident" id="6032550">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032555">case</span>&nbsp;<span class="ident" id="6032560">token</span><span class="op" id="6032565">.</span><span class="ident" id="6032566">Pos</span><span class="op" id="6032569">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032574">if</span>&nbsp;<span class="ident" id="6032577">x</span><span class="op" id="6032578">.</span><span class="ident" id="6032579">IsValid</span><span class="op" id="6032586">(</span><span class="op" id="6032587">)</span>&nbsp;<span class="op" id="6032589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032595">p</span><span class="op" id="6032596">.</span><span class="ident" id="6032597">pos</span>&nbsp;<span class="op" id="6032601">=</span>&nbsp;<span class="ident" id="6032603">p</span><span class="op" id="6032604">.</span><span class="ident" id="6032605">posFor</span><span class="op" id="6032611">(</span><span class="ident" id="6032612">x</span><span class="op" id="6032613">)</span>&nbsp;<span class="comment" id="6032615">//&nbsp;accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6032652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032657">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032669">case</span>&nbsp;<span class="builtintype" id="6032674">string</span><span class="op" id="6032680">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6032685">//&nbsp;incorrect&nbsp;AST&nbsp;-&nbsp;print&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032727">data</span>&nbsp;<span class="op" id="6032732">=</span>&nbsp;<span class="ident" id="6032734">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032739">isLit</span>&nbsp;<span class="op" id="6032745">=</span>&nbsp;<span class="builtintype" id="6032747">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032755">impliedSemi</span>&nbsp;<span class="op" id="6032767">=</span>&nbsp;<span class="builtintype" id="6032769">true</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032777">p</span><span class="op" id="6032778">.</span><span class="ident" id="6032779">lastTok</span>&nbsp;<span class="op" id="6032787">=</span>&nbsp;<span class="ident" id="6032789">token</span><span class="op" id="6032794">.</span><span class="ident" id="6032795">STRING</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6032805">default</span><span class="op" id="6032812">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032817">fmt</span><span class="op" id="6032820">.</span><span class="ident" id="6032821">Fprintf</span><span class="op" id="6032828">(</span><span class="ident" id="6032829">os</span><span class="op" id="6032831">.</span><span class="ident" id="6032832">Stderr</span><span class="op" id="6032838">,</span>&nbsp;<span class="string" id="6032840">&#34;print:&nbsp;unsupported&nbsp;argument&nbsp;%v&nbsp;(%T)\n&#34;</span><span class="op" id="6032879">,</span>&nbsp;<span class="ident" id="6032881">arg</span><span class="op" id="6032884">,</span>&nbsp;<span class="ident" id="6032886">arg</span><span class="op" id="6032889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6032894">panic</span><span class="op" id="6032899">(</span><span class="string" id="6032900">&#34;go/printer&nbsp;type&#34;</span><span class="op" id="6032917">)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6032921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6032925">//&nbsp;data&nbsp;!=&nbsp;&#34;&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6032942">next</span>&nbsp;<span class="op" id="6032947">:=</span>&nbsp;<span class="ident" id="6032950">p</span><span class="op" id="6032951">.</span><span class="ident" id="6032952">pos</span>&nbsp;<span class="comment" id="6032956">//&nbsp;estimated/accurate&nbsp;position&nbsp;of&nbsp;next&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033002">wroteNewline</span><span class="op" id="6033014">,</span>&nbsp;<span class="ident" id="6033016">droppedFF</span>&nbsp;<span class="op" id="6033026">:=</span>&nbsp;<span class="ident" id="6033029">p</span><span class="op" id="6033030">.</span><span class="ident" id="6033031">flush</span><span class="op" id="6033036">(</span><span class="ident" id="6033037">next</span><span class="op" id="6033041">,</span>&nbsp;<span class="ident" id="6033043">p</span><span class="op" id="6033044">.</span><span class="ident" id="6033045">lastTok</span><span class="op" id="6033052">)</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6033057">//&nbsp;intersperse&nbsp;extra&nbsp;newlines&nbsp;if&nbsp;present&nbsp;in&nbsp;the&nbsp;source&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6033118">//&nbsp;if&nbsp;they&nbsp;don&#39;t&nbsp;cause&nbsp;extra&nbsp;semicolons&nbsp;(don&#39;t&nbsp;do&nbsp;this&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6033178">//&nbsp;flush&nbsp;as&nbsp;it&nbsp;will&nbsp;cause&nbsp;extra&nbsp;newlines&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;file)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033243">if</span>&nbsp;<span class="op" id="6033246">!</span><span class="ident" id="6033247">p</span><span class="op" id="6033248">.</span><span class="ident" id="6033249">impliedSemi</span>&nbsp;<span class="op" id="6033261">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033266">n</span>&nbsp;<span class="op" id="6033268">:=</span>&nbsp;<span class="ident" id="6033271">nlimit</span><span class="op" id="6033277">(</span><span class="ident" id="6033278">next</span><span class="op" id="6033282">.</span><span class="ident" id="6033283">Line</span>&nbsp;<span class="op" id="6033288">-</span>&nbsp;<span class="ident" id="6033290">p</span><span class="op" id="6033291">.</span><span class="ident" id="6033292">pos</span><span class="op" id="6033295">.</span><span class="ident" id="6033296">Line</span><span class="op" id="6033300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6033305">//&nbsp;don&#39;t&nbsp;exceed&nbsp;maxNewlines&nbsp;if&nbsp;we&nbsp;already&nbsp;wrote&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033360">if</span>&nbsp;<span class="ident" id="6033363">wroteNewline</span>&nbsp;<span class="op" id="6033376">&amp;&amp;</span>&nbsp;<span class="ident" id="6033379">n</span>&nbsp;<span class="op" id="6033381">==</span>&nbsp;<span class="ident" id="6033384">maxNewlines</span>&nbsp;<span class="op" id="6033396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033402">n</span>&nbsp;<span class="op" id="6033404">=</span>&nbsp;<span class="ident" id="6033406">maxNewlines</span>&nbsp;<span class="op" id="6033418">-</span>&nbsp;<span class="num" id="6033420">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6033425">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033430">if</span>&nbsp;<span class="ident" id="6033433">n</span>&nbsp;<span class="op" id="6033435">&gt;</span>&nbsp;<span class="num" id="6033437">0</span>&nbsp;<span class="op" id="6033439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033445">ch</span>&nbsp;<span class="op" id="6033448">:=</span>&nbsp;<span class="builtintype" id="6033451">byte</span><span class="op" id="6033455">(</span><span class="string" id="6033456">&#39;\n&#39;</span><span class="op" id="6033460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033466">if</span>&nbsp;<span class="ident" id="6033469">droppedFF</span>&nbsp;<span class="op" id="6033479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033486">ch</span>&nbsp;<span class="op" id="6033489">=</span>&nbsp;<span class="string" id="6033491">&#39;\f&#39;</span>&nbsp;<span class="comment" id="6033496">//&nbsp;use&nbsp;formfeed&nbsp;since&nbsp;we&nbsp;dropped&nbsp;one&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6033544">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033550">p</span><span class="op" id="6033551">.</span><span class="ident" id="6033552">writeByte</span><span class="op" id="6033561">(</span><span class="ident" id="6033562">ch</span><span class="op" id="6033564">,</span>&nbsp;<span class="ident" id="6033566">n</span><span class="op" id="6033567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033573">impliedSemi</span>&nbsp;<span class="op" id="6033585">=</span>&nbsp;<span class="builtintype" id="6033587">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6033596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6033600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6033605">//&nbsp;the&nbsp;next&nbsp;token&nbsp;starts&nbsp;now&nbsp;-&nbsp;record&nbsp;its&nbsp;line&nbsp;number&nbsp;if&nbsp;requested</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6033674">if</span>&nbsp;<span class="ident" id="6033677">p</span><span class="op" id="6033678">.</span><span class="ident" id="6033679">linePtr</span>&nbsp;<span class="op" id="6033687">!=</span>&nbsp;<span class="ident" id="6033690">nil</span>&nbsp;<span class="op" id="6033694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6033699">*</span><span class="ident" id="6033700">p</span><span class="op" id="6033701">.</span><span class="ident" id="6033702">linePtr</span>&nbsp;<span class="op" id="6033710">=</span>&nbsp;<span class="ident" id="6033712">p</span><span class="op" id="6033713">.</span><span class="ident" id="6033714">out</span><span class="op" id="6033717">.</span><span class="ident" id="6033718">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033726">p</span><span class="op" id="6033727">.</span><span class="ident" id="6033728">linePtr</span>&nbsp;<span class="op" id="6033736">=</span>&nbsp;<span class="ident" id="6033738">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6033744">}</span><br>
<span class="lineno">970</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033749">p</span><span class="op" id="6033750">.</span><span class="ident" id="6033751">writeString</span><span class="op" id="6033762">(</span><span class="ident" id="6033763">next</span><span class="op" id="6033767">,</span>&nbsp;<span class="ident" id="6033769">data</span><span class="op" id="6033773">,</span>&nbsp;<span class="ident" id="6033775">isLit</span><span class="op" id="6033780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6033784">p</span><span class="op" id="6033785">.</span><span class="ident" id="6033786">impliedSemi</span>&nbsp;<span class="op" id="6033798">=</span>&nbsp;<span class="ident" id="6033800">impliedSemi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6033813">}</span><br>
<span class="lineno"></span><span class="op" id="6033815">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span><span class="comment" id="6033818">//&nbsp;flush&nbsp;prints&nbsp;any&nbsp;pending&nbsp;comments&nbsp;and&nbsp;whitespace&nbsp;occurring&nbsp;textually</span><br>
<span class="lineno"></span><span class="comment" id="6033890">//&nbsp;before&nbsp;the&nbsp;position&nbsp;of&nbsp;the&nbsp;next&nbsp;token&nbsp;tok.&nbsp;The&nbsp;flush&nbsp;result&nbsp;indicates</span><br>
<span class="lineno"></span><span class="comment" id="6033963">//&nbsp;if&nbsp;a&nbsp;newline&nbsp;was&nbsp;written&nbsp;or&nbsp;if&nbsp;a&nbsp;formfeed&nbsp;was&nbsp;dropped&nbsp;from&nbsp;the&nbsp;whitespace</span><br>
<span class="lineno"></span><span class="comment" id="6034040">//&nbsp;buffer.</span><br>
<span class="lineno">980</span><span class="comment" id="6034051">//</span><br>
<span class="lineno"></span><span class="keyword" id="6034054">func</span>&nbsp;<span class="op" id="6034059">(</span><span class="ident" id="6034060">p</span>&nbsp;<span class="op" id="6034062">*</span><span class="ident" id="6034063">printer</span><span class="op" id="6034070">)</span>&nbsp;<span class="ident" id="6034072">flush</span><span class="op" id="6034077">(</span><span class="ident" id="6034078">next</span>&nbsp;<span class="ident" id="6034083">token</span><span class="op" id="6034088">.</span><span class="ident" id="6034089">Position</span><span class="op" id="6034097">,</span>&nbsp;<span class="ident" id="6034099">tok</span>&nbsp;<span class="ident" id="6034103">token</span><span class="op" id="6034108">.</span><span class="ident" id="6034109">Token</span><span class="op" id="6034114">)</span>&nbsp;<span class="op" id="6034116">(</span><span class="ident" id="6034117">wroteNewline</span><span class="op" id="6034129">,</span>&nbsp;<span class="ident" id="6034131">droppedFF</span>&nbsp;<span class="builtintype" id="6034141">bool</span><span class="op" id="6034145">)</span>&nbsp;<span class="op" id="6034147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034150">if</span>&nbsp;<span class="ident" id="6034153">p</span><span class="op" id="6034154">.</span><span class="ident" id="6034155">commentBefore</span><span class="op" id="6034168">(</span><span class="ident" id="6034169">next</span><span class="op" id="6034173">)</span>&nbsp;<span class="op" id="6034175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6034179">//&nbsp;if&nbsp;there&nbsp;are&nbsp;comments&nbsp;before&nbsp;the&nbsp;next&nbsp;item,&nbsp;intersperse&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034245">wroteNewline</span><span class="op" id="6034257">,</span>&nbsp;<span class="ident" id="6034259">droppedFF</span>&nbsp;<span class="op" id="6034269">=</span>&nbsp;<span class="ident" id="6034271">p</span><span class="op" id="6034272">.</span><span class="ident" id="6034273">intersperseComments</span><span class="op" id="6034292">(</span><span class="ident" id="6034293">next</span><span class="op" id="6034297">,</span>&nbsp;<span class="ident" id="6034299">tok</span><span class="op" id="6034302">)</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034305">}</span>&nbsp;<span class="keyword" id="6034307">else</span>&nbsp;<span class="op" id="6034312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6034316">//&nbsp;otherwise,&nbsp;write&nbsp;any&nbsp;leftover&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034362">p</span><span class="op" id="6034363">.</span><span class="ident" id="6034364">writeWhitespace</span><span class="op" id="6034379">(</span><span class="builtinfunc" id="6034380">len</span><span class="op" id="6034383">(</span><span class="ident" id="6034384">p</span><span class="op" id="6034385">.</span><span class="ident" id="6034386">wsbuf</span><span class="op" id="6034391">)</span><span class="op" id="6034392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034398">return</span><br>
<span class="lineno">990</span><span class="op" id="6034405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6034408">//&nbsp;getNode&nbsp;returns&nbsp;the&nbsp;ast.CommentGroup&nbsp;associated&nbsp;with&nbsp;n,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="6034475">func</span>&nbsp;<span class="ident" id="6034480">getDoc</span><span class="op" id="6034486">(</span><span class="ident" id="6034487">n</span>&nbsp;<span class="ident" id="6034489">ast</span><span class="op" id="6034492">.</span><span class="ident" id="6034493">Node</span><span class="op" id="6034497">)</span>&nbsp;<span class="op" id="6034499">*</span><span class="ident" id="6034500">ast</span><span class="op" id="6034503">.</span><span class="ident" id="6034504">CommentGroup</span>&nbsp;<span class="op" id="6034517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034520">switch</span>&nbsp;<span class="ident" id="6034527">n</span>&nbsp;<span class="op" id="6034529">:=</span>&nbsp;<span class="ident" id="6034532">n</span><span class="op" id="6034533">.</span><span class="op" id="6034534">(</span><span class="keyword" id="6034535">type</span><span class="op" id="6034539">)</span>&nbsp;<span class="op" id="6034541">{</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034544">case</span>&nbsp;<span class="op" id="6034549">*</span><span class="ident" id="6034550">ast</span><span class="op" id="6034553">.</span><span class="ident" id="6034554">Field</span><span class="op" id="6034559">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034563">return</span>&nbsp;<span class="ident" id="6034570">n</span><span class="op" id="6034571">.</span><span class="ident" id="6034572">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034577">case</span>&nbsp;<span class="op" id="6034582">*</span><span class="ident" id="6034583">ast</span><span class="op" id="6034586">.</span><span class="ident" id="6034587">ImportSpec</span><span class="op" id="6034597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034601">return</span>&nbsp;<span class="ident" id="6034608">n</span><span class="op" id="6034609">.</span><span class="ident" id="6034610">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034615">case</span>&nbsp;<span class="op" id="6034620">*</span><span class="ident" id="6034621">ast</span><span class="op" id="6034624">.</span><span class="ident" id="6034625">ValueSpec</span><span class="op" id="6034634">:</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034638">return</span>&nbsp;<span class="ident" id="6034645">n</span><span class="op" id="6034646">.</span><span class="ident" id="6034647">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034652">case</span>&nbsp;<span class="op" id="6034657">*</span><span class="ident" id="6034658">ast</span><span class="op" id="6034661">.</span><span class="ident" id="6034662">TypeSpec</span><span class="op" id="6034670">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034674">return</span>&nbsp;<span class="ident" id="6034681">n</span><span class="op" id="6034682">.</span><span class="ident" id="6034683">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034688">case</span>&nbsp;<span class="op" id="6034693">*</span><span class="ident" id="6034694">ast</span><span class="op" id="6034697">.</span><span class="ident" id="6034698">GenDecl</span><span class="op" id="6034705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034709">return</span>&nbsp;<span class="ident" id="6034716">n</span><span class="op" id="6034717">.</span><span class="ident" id="6034718">Doc</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034723">case</span>&nbsp;<span class="op" id="6034728">*</span><span class="ident" id="6034729">ast</span><span class="op" id="6034732">.</span><span class="ident" id="6034733">FuncDecl</span><span class="op" id="6034741">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034745">return</span>&nbsp;<span class="ident" id="6034752">n</span><span class="op" id="6034753">.</span><span class="ident" id="6034754">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034759">case</span>&nbsp;<span class="op" id="6034764">*</span><span class="ident" id="6034765">ast</span><span class="op" id="6034768">.</span><span class="ident" id="6034769">File</span><span class="op" id="6034773">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034777">return</span>&nbsp;<span class="ident" id="6034784">n</span><span class="op" id="6034785">.</span><span class="ident" id="6034786">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6034791">}</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034794">return</span>&nbsp;<span class="ident" id="6034801">nil</span><br>
<span class="lineno"></span><span class="op" id="6034805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6034808">func</span>&nbsp;<span class="op" id="6034813">(</span><span class="ident" id="6034814">p</span>&nbsp;<span class="op" id="6034816">*</span><span class="ident" id="6034817">printer</span><span class="op" id="6034824">)</span>&nbsp;<span class="ident" id="6034826">printNode</span><span class="op" id="6034835">(</span><span class="ident" id="6034836">node</span>&nbsp;<span class="keyword" id="6034841">interface</span><span class="op" id="6034850">{</span><span class="op" id="6034851">}</span><span class="op" id="6034852">)</span>&nbsp;<span class="builtintype" id="6034854">error</span>&nbsp;<span class="op" id="6034860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6034863">//&nbsp;unpack&nbsp;*CommentedNode,&nbsp;if&nbsp;any</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034897">var</span>&nbsp;<span class="ident" id="6034901">comments</span>&nbsp;<span class="op" id="6034910">[</span><span class="op" id="6034911">]</span><span class="op" id="6034912">*</span><span class="ident" id="6034913">ast</span><span class="op" id="6034916">.</span><span class="ident" id="6034917">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6034931">if</span>&nbsp;<span class="ident" id="6034934">cnode</span><span class="op" id="6034939">,</span>&nbsp;<span class="ident" id="6034941">ok</span>&nbsp;<span class="op" id="6034944">:=</span>&nbsp;<span class="ident" id="6034947">node</span><span class="op" id="6034951">.</span><span class="op" id="6034952">(</span><span class="op" id="6034953">*</span><span class="ident" id="6034954">CommentedNode</span><span class="op" id="6034967">)</span><span class="op" id="6034968">;</span>&nbsp;<span class="ident" id="6034970">ok</span>&nbsp;<span class="op" id="6034973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034977">node</span>&nbsp;<span class="op" id="6034982">=</span>&nbsp;<span class="ident" id="6034984">cnode</span><span class="op" id="6034989">.</span><span class="ident" id="6034990">Node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6034997">comments</span>&nbsp;<span class="op" id="6035006">=</span>&nbsp;<span class="ident" id="6035008">cnode</span><span class="op" id="6035013">.</span><span class="ident" id="6035014">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6035024">}</span><br>
<span class="lineno">1020</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035028">if</span>&nbsp;<span class="ident" id="6035031">comments</span>&nbsp;<span class="op" id="6035040">!=</span>&nbsp;<span class="ident" id="6035043">nil</span>&nbsp;<span class="op" id="6035047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6035051">//&nbsp;commented&nbsp;node&nbsp;-&nbsp;restrict&nbsp;comment&nbsp;list&nbsp;to&nbsp;relevant&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035113">n</span><span class="op" id="6035114">,</span>&nbsp;<span class="ident" id="6035116">ok</span>&nbsp;<span class="op" id="6035119">:=</span>&nbsp;<span class="ident" id="6035122">node</span><span class="op" id="6035126">.</span><span class="op" id="6035127">(</span><span class="ident" id="6035128">ast</span><span class="op" id="6035131">.</span><span class="ident" id="6035132">Node</span><span class="op" id="6035136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035140">if</span>&nbsp;<span class="op" id="6035143">!</span><span class="ident" id="6035144">ok</span>&nbsp;<span class="op" id="6035147">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035152">goto</span>&nbsp;<span class="ident" id="6035157">unsupported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6035171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035175">beg</span>&nbsp;<span class="op" id="6035179">:=</span>&nbsp;<span class="ident" id="6035182">n</span><span class="op" id="6035183">.</span><span class="ident" id="6035184">Pos</span><span class="op" id="6035187">(</span><span class="op" id="6035188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035192">end</span>&nbsp;<span class="op" id="6035196">:=</span>&nbsp;<span class="ident" id="6035199">n</span><span class="op" id="6035200">.</span><span class="ident" id="6035201">End</span><span class="op" id="6035204">(</span><span class="op" id="6035205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6035209">//&nbsp;if&nbsp;the&nbsp;node&nbsp;has&nbsp;associated&nbsp;documentation,</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6035256">//&nbsp;include&nbsp;that&nbsp;commentgroup&nbsp;in&nbsp;the&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6035300">//&nbsp;(the&nbsp;comment&nbsp;list&nbsp;is&nbsp;sorted&nbsp;in&nbsp;the&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6035346">//&nbsp;of&nbsp;the&nbsp;comment&nbsp;appearance&nbsp;in&nbsp;the&nbsp;source&nbsp;code)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035397">if</span>&nbsp;<span class="ident" id="6035400">doc</span>&nbsp;<span class="op" id="6035404">:=</span>&nbsp;<span class="ident" id="6035407">getDoc</span><span class="op" id="6035413">(</span><span class="ident" id="6035414">n</span><span class="op" id="6035415">)</span><span class="op" id="6035416">;</span>&nbsp;<span class="ident" id="6035418">doc</span>&nbsp;<span class="op" id="6035422">!=</span>&nbsp;<span class="ident" id="6035425">nil</span>&nbsp;<span class="op" id="6035429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035434">beg</span>&nbsp;<span class="op" id="6035438">=</span>&nbsp;<span class="ident" id="6035440">doc</span><span class="op" id="6035443">.</span><span class="ident" id="6035444">Pos</span><span class="op" id="6035447">(</span><span class="op" id="6035448">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6035452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6035456">//&nbsp;token.Pos&nbsp;values&nbsp;are&nbsp;global&nbsp;offsets,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6035505">//&nbsp;compare&nbsp;them&nbsp;directly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035532">i</span>&nbsp;<span class="op" id="6035534">:=</span>&nbsp;<span class="num" id="6035537">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035541">for</span>&nbsp;<span class="ident" id="6035545">i</span>&nbsp;<span class="op" id="6035547">&lt;</span>&nbsp;<span class="builtinfunc" id="6035549">len</span><span class="op" id="6035552">(</span><span class="ident" id="6035553">comments</span><span class="op" id="6035561">)</span>&nbsp;<span class="op" id="6035563">&amp;&amp;</span>&nbsp;<span class="ident" id="6035566">comments</span><span class="op" id="6035574">[</span><span class="ident" id="6035575">i</span><span class="op" id="6035576">]</span><span class="op" id="6035577">.</span><span class="ident" id="6035578">End</span><span class="op" id="6035581">(</span><span class="op" id="6035582">)</span>&nbsp;<span class="op" id="6035584">&lt;</span>&nbsp;<span class="ident" id="6035586">beg</span>&nbsp;<span class="op" id="6035590">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035595">i</span><span class="op" id="6035596">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6035601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035605">j</span>&nbsp;<span class="op" id="6035607">:=</span>&nbsp;<span class="ident" id="6035610">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035614">for</span>&nbsp;<span class="ident" id="6035618">j</span>&nbsp;<span class="op" id="6035620">&lt;</span>&nbsp;<span class="builtinfunc" id="6035622">len</span><span class="op" id="6035625">(</span><span class="ident" id="6035626">comments</span><span class="op" id="6035634">)</span>&nbsp;<span class="op" id="6035636">&amp;&amp;</span>&nbsp;<span class="ident" id="6035639">comments</span><span class="op" id="6035647">[</span><span class="ident" id="6035648">j</span><span class="op" id="6035649">]</span><span class="op" id="6035650">.</span><span class="ident" id="6035651">Pos</span><span class="op" id="6035654">(</span><span class="op" id="6035655">)</span>&nbsp;<span class="op" id="6035657">&lt;</span>&nbsp;<span class="ident" id="6035659">end</span>&nbsp;<span class="op" id="6035663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035668">j</span><span class="op" id="6035669">++</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6035674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035678">if</span>&nbsp;<span class="ident" id="6035681">i</span>&nbsp;<span class="op" id="6035683">&lt;</span>&nbsp;<span class="ident" id="6035685">j</span>&nbsp;<span class="op" id="6035687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035692">p</span><span class="op" id="6035693">.</span><span class="ident" id="6035694">comments</span>&nbsp;<span class="op" id="6035703">=</span>&nbsp;<span class="ident" id="6035705">comments</span><span class="op" id="6035713">[</span><span class="ident" id="6035714">i</span><span class="op" id="6035715">:</span><span class="ident" id="6035716">j</span><span class="op" id="6035717">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6035721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6035724">}</span>&nbsp;<span class="keyword" id="6035726">else</span>&nbsp;<span class="keyword" id="6035731">if</span>&nbsp;<span class="ident" id="6035734">n</span><span class="op" id="6035735">,</span>&nbsp;<span class="ident" id="6035737">ok</span>&nbsp;<span class="op" id="6035740">:=</span>&nbsp;<span class="ident" id="6035743">node</span><span class="op" id="6035747">.</span><span class="op" id="6035748">(</span><span class="op" id="6035749">*</span><span class="ident" id="6035750">ast</span><span class="op" id="6035753">.</span><span class="ident" id="6035754">File</span><span class="op" id="6035758">)</span><span class="op" id="6035759">;</span>&nbsp;<span class="ident" id="6035761">ok</span>&nbsp;<span class="op" id="6035764">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6035768">//&nbsp;use&nbsp;ast.File&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035803">p</span><span class="op" id="6035804">.</span><span class="ident" id="6035805">comments</span>&nbsp;<span class="op" id="6035814">=</span>&nbsp;<span class="ident" id="6035816">n</span><span class="op" id="6035817">.</span><span class="ident" id="6035818">Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6035828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6035832">//&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;comments,&nbsp;use&nbsp;node&nbsp;comments</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035880">p</span><span class="op" id="6035881">.</span><span class="ident" id="6035882">useNodeComments</span>&nbsp;<span class="op" id="6035898">=</span>&nbsp;<span class="ident" id="6035900">p</span><span class="op" id="6035901">.</span><span class="ident" id="6035902">comments</span>&nbsp;<span class="op" id="6035911">==</span>&nbsp;<span class="ident" id="6035914">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6035920">//&nbsp;get&nbsp;comments&nbsp;ready&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6035951">p</span><span class="op" id="6035952">.</span><span class="ident" id="6035953">nextComment</span><span class="op" id="6035964">(</span><span class="op" id="6035965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6035969">//&nbsp;format&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6035985">switch</span>&nbsp;<span class="ident" id="6035992">n</span>&nbsp;<span class="op" id="6035994">:=</span>&nbsp;<span class="ident" id="6035997">node</span><span class="op" id="6036001">.</span><span class="op" id="6036002">(</span><span class="keyword" id="6036003">type</span><span class="op" id="6036007">)</span>&nbsp;<span class="op" id="6036009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036012">case</span>&nbsp;<span class="ident" id="6036017">ast</span><span class="op" id="6036020">.</span><span class="ident" id="6036021">Expr</span><span class="op" id="6036025">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036029">p</span><span class="op" id="6036030">.</span><span class="ident" id="6036031">expr</span><span class="op" id="6036035">(</span><span class="ident" id="6036036">n</span><span class="op" id="6036037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036040">case</span>&nbsp;<span class="ident" id="6036045">ast</span><span class="op" id="6036048">.</span><span class="ident" id="6036049">Stmt</span><span class="op" id="6036053">:</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6036057">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6036120">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036179">if</span>&nbsp;<span class="ident" id="6036182">_</span><span class="op" id="6036183">,</span>&nbsp;<span class="ident" id="6036185">ok</span>&nbsp;<span class="op" id="6036188">:=</span>&nbsp;<span class="ident" id="6036191">n</span><span class="op" id="6036192">.</span><span class="op" id="6036193">(</span><span class="op" id="6036194">*</span><span class="ident" id="6036195">ast</span><span class="op" id="6036198">.</span><span class="ident" id="6036199">LabeledStmt</span><span class="op" id="6036210">)</span><span class="op" id="6036211">;</span>&nbsp;<span class="ident" id="6036213">ok</span>&nbsp;<span class="op" id="6036216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036221">p</span><span class="op" id="6036222">.</span><span class="ident" id="6036223">indent</span>&nbsp;<span class="op" id="6036230">=</span>&nbsp;<span class="num" id="6036232">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036236">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036240">p</span><span class="op" id="6036241">.</span><span class="ident" id="6036242">stmt</span><span class="op" id="6036246">(</span><span class="ident" id="6036247">n</span><span class="op" id="6036248">,</span>&nbsp;<span class="builtintype" id="6036250">false</span><span class="op" id="6036255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036258">case</span>&nbsp;<span class="ident" id="6036263">ast</span><span class="op" id="6036266">.</span><span class="ident" id="6036267">Decl</span><span class="op" id="6036271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036275">p</span><span class="op" id="6036276">.</span><span class="ident" id="6036277">decl</span><span class="op" id="6036281">(</span><span class="ident" id="6036282">n</span><span class="op" id="6036283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036286">case</span>&nbsp;<span class="ident" id="6036291">ast</span><span class="op" id="6036294">.</span><span class="ident" id="6036295">Spec</span><span class="op" id="6036299">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036303">p</span><span class="op" id="6036304">.</span><span class="ident" id="6036305">spec</span><span class="op" id="6036309">(</span><span class="ident" id="6036310">n</span><span class="op" id="6036311">,</span>&nbsp;<span class="num" id="6036313">1</span><span class="op" id="6036314">,</span>&nbsp;<span class="builtintype" id="6036316">false</span><span class="op" id="6036321">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036324">case</span>&nbsp;<span class="op" id="6036329">[</span><span class="op" id="6036330">]</span><span class="ident" id="6036331">ast</span><span class="op" id="6036334">.</span><span class="ident" id="6036335">Stmt</span><span class="op" id="6036339">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6036343">//&nbsp;A&nbsp;labeled&nbsp;statement&nbsp;will&nbsp;un-indent&nbsp;to&nbsp;position&nbsp;the&nbsp;label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6036406">//&nbsp;Set&nbsp;p.indent&nbsp;to&nbsp;1&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;indent&nbsp;&#34;underflow&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036465">for</span>&nbsp;<span class="ident" id="6036469">_</span><span class="op" id="6036470">,</span>&nbsp;<span class="ident" id="6036472">s</span>&nbsp;<span class="op" id="6036474">:=</span>&nbsp;<span class="keyword" id="6036477">range</span>&nbsp;<span class="ident" id="6036483">n</span>&nbsp;<span class="op" id="6036485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036490">if</span>&nbsp;<span class="ident" id="6036493">_</span><span class="op" id="6036494">,</span>&nbsp;<span class="ident" id="6036496">ok</span>&nbsp;<span class="op" id="6036499">:=</span>&nbsp;<span class="ident" id="6036502">s</span><span class="op" id="6036503">.</span><span class="op" id="6036504">(</span><span class="op" id="6036505">*</span><span class="ident" id="6036506">ast</span><span class="op" id="6036509">.</span><span class="ident" id="6036510">LabeledStmt</span><span class="op" id="6036521">)</span><span class="op" id="6036522">;</span>&nbsp;<span class="ident" id="6036524">ok</span>&nbsp;<span class="op" id="6036527">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036533">p</span><span class="op" id="6036534">.</span><span class="ident" id="6036535">indent</span>&nbsp;<span class="op" id="6036542">=</span>&nbsp;<span class="num" id="6036544">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036557">p</span><span class="op" id="6036558">.</span><span class="ident" id="6036559">stmtList</span><span class="op" id="6036567">(</span><span class="ident" id="6036568">n</span><span class="op" id="6036569">,</span>&nbsp;<span class="num" id="6036571">0</span><span class="op" id="6036572">,</span>&nbsp;<span class="builtintype" id="6036574">false</span><span class="op" id="6036579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036582">case</span>&nbsp;<span class="op" id="6036587">[</span><span class="op" id="6036588">]</span><span class="ident" id="6036589">ast</span><span class="op" id="6036592">.</span><span class="ident" id="6036593">Decl</span><span class="op" id="6036597">:</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036601">p</span><span class="op" id="6036602">.</span><span class="ident" id="6036603">declList</span><span class="op" id="6036611">(</span><span class="ident" id="6036612">n</span><span class="op" id="6036613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036616">case</span>&nbsp;<span class="op" id="6036621">*</span><span class="ident" id="6036622">ast</span><span class="op" id="6036625">.</span><span class="ident" id="6036626">File</span><span class="op" id="6036630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6036634">p</span><span class="op" id="6036635">.</span><span class="ident" id="6036636">file</span><span class="op" id="6036640">(</span><span class="ident" id="6036641">n</span><span class="op" id="6036642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036645">default</span><span class="op" id="6036652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036656">goto</span>&nbsp;<span class="ident" id="6036661">unsupported</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6036674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036678">return</span>&nbsp;<span class="ident" id="6036685">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="6036690">unsupported</span><span class="op" id="6036701">:</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6036704">return</span>&nbsp;<span class="ident" id="6036711">fmt</span><span class="op" id="6036714">.</span><span class="ident" id="6036715">Errorf</span><span class="op" id="6036721">(</span><span class="string" id="6036722">&#34;go/printer:&nbsp;unsupported&nbsp;node&nbsp;type&nbsp;%T&#34;</span><span class="op" id="6036760">,</span>&nbsp;<span class="ident" id="6036762">node</span><span class="op" id="6036766">)</span><br>
<span class="lineno"></span><span class="op" id="6036768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6036771">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6036851">//&nbsp;Trimmer</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span><span class="comment" id="6036863">//&nbsp;A&nbsp;trimmer&nbsp;is&nbsp;an&nbsp;io.Writer&nbsp;filter&nbsp;for&nbsp;stripping&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span><span class="comment" id="6036930">//&nbsp;characters,&nbsp;trailing&nbsp;blanks&nbsp;and&nbsp;tabs,&nbsp;and&nbsp;for&nbsp;converting&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="6036999">//&nbsp;and&nbsp;vtab&nbsp;characters&nbsp;into&nbsp;newlines&nbsp;and&nbsp;htabs&nbsp;(in&nbsp;case&nbsp;no&nbsp;tabwriter</span><br>
<span class="lineno"></span><span class="comment" id="6037068">//&nbsp;is&nbsp;used).&nbsp;Text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escape&nbsp;characters&nbsp;is&nbsp;passed</span><br>
<span class="lineno">1105</span><span class="comment" id="6037137">//&nbsp;through&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="comment" id="6037159">//</span><br>
<span class="lineno"></span><span class="keyword" id="6037162">type</span>&nbsp;<span class="ident" id="6037167">trimmer</span>&nbsp;<span class="keyword" id="6037175">struct</span>&nbsp;<span class="op" id="6037182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037185">output</span>&nbsp;<span class="ident" id="6037192">io</span><span class="op" id="6037194">.</span><span class="ident" id="6037195">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037203">state</span>&nbsp;&nbsp;<span class="builtintype" id="6037210">int</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037215">space</span>&nbsp;&nbsp;<span class="op" id="6037222">[</span><span class="op" id="6037223">]</span><span class="builtintype" id="6037224">byte</span><br>
<span class="lineno"></span><span class="op" id="6037229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6037232">//&nbsp;trimmer&nbsp;is&nbsp;implemented&nbsp;as&nbsp;a&nbsp;state&nbsp;machine.</span><br>
<span class="lineno"></span><span class="comment" id="6037278">//&nbsp;It&nbsp;can&nbsp;be&nbsp;in&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;states:</span><br>
<span class="lineno">1115</span><span class="keyword" id="6037323">const</span>&nbsp;<span class="op" id="6037329">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037332">inSpace</span>&nbsp;&nbsp;<span class="op" id="6037341">=</span>&nbsp;<span class="ident" id="6037343">iota</span>&nbsp;<span class="comment" id="6037348">//&nbsp;inside&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037365">inEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6037381">//&nbsp;inside&nbsp;text&nbsp;bracketed&nbsp;by&nbsp;tabwriter.Escapes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037428">inText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6037444">//&nbsp;inside&nbsp;text</span><br>
<span class="lineno"></span><span class="op" id="6037459">)</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span><span class="keyword" id="6037462">func</span>&nbsp;<span class="op" id="6037467">(</span><span class="ident" id="6037468">p</span>&nbsp;<span class="op" id="6037470">*</span><span class="ident" id="6037471">trimmer</span><span class="op" id="6037478">)</span>&nbsp;<span class="ident" id="6037480">resetSpace</span><span class="op" id="6037490">(</span><span class="op" id="6037491">)</span>&nbsp;<span class="op" id="6037493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037496">p</span><span class="op" id="6037497">.</span><span class="ident" id="6037498">state</span>&nbsp;<span class="op" id="6037504">=</span>&nbsp;<span class="ident" id="6037506">inSpace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6037515">p</span><span class="op" id="6037516">.</span><span class="ident" id="6037517">space</span>&nbsp;<span class="op" id="6037523">=</span>&nbsp;<span class="ident" id="6037525">p</span><span class="op" id="6037526">.</span><span class="ident" id="6037527">space</span><span class="op" id="6037532">[</span><span class="num" id="6037533">0</span><span class="op" id="6037534">:</span><span class="num" id="6037535">0</span><span class="op" id="6037536">]</span><br>
<span class="lineno"></span><span class="op" id="6037538">}</span><br>
<span class="lineno">1125</span><br>
<span class="lineno"></span><span class="comment" id="6037541">//&nbsp;Design&nbsp;note:&nbsp;It&nbsp;is&nbsp;tempting&nbsp;to&nbsp;eliminate&nbsp;extra&nbsp;blanks&nbsp;occurring&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6037611">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whitespace&nbsp;in&nbsp;this&nbsp;function&nbsp;as&nbsp;it&nbsp;could&nbsp;simplify&nbsp;some</span><br>
<span class="lineno"></span><span class="comment" id="6037681">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;blanks&nbsp;logic&nbsp;in&nbsp;the&nbsp;node&nbsp;printing&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="6037749">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;However,&nbsp;this&nbsp;would&nbsp;mess&nbsp;up&nbsp;any&nbsp;formatting&nbsp;done&nbsp;by</span><br>
<span class="lineno">1130</span><span class="comment" id="6037816">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;tabwriter.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6037848">var</span>&nbsp;<span class="ident" id="6037852">aNewline</span>&nbsp;<span class="op" id="6037861">=</span>&nbsp;<span class="op" id="6037863">[</span><span class="op" id="6037864">]</span><span class="builtintype" id="6037865">byte</span><span class="op" id="6037869">(</span><span class="string" id="6037870">&#34;\n&#34;</span><span class="op" id="6037874">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6037877">func</span>&nbsp;<span class="op" id="6037882">(</span><span class="ident" id="6037883">p</span>&nbsp;<span class="op" id="6037885">*</span><span class="ident" id="6037886">trimmer</span><span class="op" id="6037893">)</span>&nbsp;<span class="ident" id="6037895">Write</span><span class="op" id="6037900">(</span><span class="ident" id="6037901">data</span>&nbsp;<span class="op" id="6037906">[</span><span class="op" id="6037907">]</span><span class="builtintype" id="6037908">byte</span><span class="op" id="6037912">)</span>&nbsp;<span class="op" id="6037914">(</span><span class="ident" id="6037915">n</span>&nbsp;<span class="builtintype" id="6037917">int</span><span class="op" id="6037920">,</span>&nbsp;<span class="ident" id="6037922">err</span>&nbsp;<span class="builtintype" id="6037926">error</span><span class="op" id="6037931">)</span>&nbsp;<span class="op" id="6037933">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6037936">//&nbsp;invariants:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6037952">//&nbsp;p.state&nbsp;==&nbsp;inSpace:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6037976">//&nbsp;&nbsp;&nbsp;&nbspp.space&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6038001">//&nbsp;p.state&nbsp;==&nbsp;inEscape,&nbsp;inText:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6038034">//&nbsp;&nbsp;&nbsp;&nbspdata[m:n]&nbsp;is&nbsp;unwritten</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038061">m</span>&nbsp;<span class="op" id="6038063">:=</span>&nbsp;<span class="num" id="6038066">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038069">var</span>&nbsp;<span class="ident" id="6038073">b</span>&nbsp;<span class="builtintype" id="6038075">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038081">for</span>&nbsp;<span class="ident" id="6038085">n</span><span class="op" id="6038086">,</span>&nbsp;<span class="ident" id="6038088">b</span>&nbsp;<span class="op" id="6038090">=</span>&nbsp;<span class="keyword" id="6038092">range</span>&nbsp;<span class="ident" id="6038098">data</span>&nbsp;<span class="op" id="6038103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038107">if</span>&nbsp;<span class="ident" id="6038110">b</span>&nbsp;<span class="op" id="6038112">==</span>&nbsp;<span class="string" id="6038115">&#39;\v&#39;</span>&nbsp;<span class="op" id="6038120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038125">b</span>&nbsp;<span class="op" id="6038127">=</span>&nbsp;<span class="string" id="6038129">&#39;\t&#39;</span>&nbsp;<span class="comment" id="6038134">//&nbsp;convert&nbsp;to&nbsp;htab</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6038155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038159">switch</span>&nbsp;<span class="ident" id="6038166">p</span><span class="op" id="6038167">.</span><span class="ident" id="6038168">state</span>&nbsp;<span class="op" id="6038174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038178">case</span>&nbsp;<span class="ident" id="6038183">inSpace</span><span class="op" id="6038190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038195">switch</span>&nbsp;<span class="ident" id="6038202">b</span>&nbsp;<span class="op" id="6038204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038209">case</span>&nbsp;<span class="string" id="6038214">&#39;\t&#39;</span><span class="op" id="6038218">,</span>&nbsp;<span class="string" id="6038220">&#39;&nbsp;&#39;</span><span class="op" id="6038223">:</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038229">p</span><span class="op" id="6038230">.</span><span class="ident" id="6038231">space</span>&nbsp;<span class="op" id="6038237">=</span>&nbsp;<span class="builtinfunc" id="6038239">append</span><span class="op" id="6038245">(</span><span class="ident" id="6038246">p</span><span class="op" id="6038247">.</span><span class="ident" id="6038248">space</span><span class="op" id="6038253">,</span>&nbsp;<span class="ident" id="6038255">b</span><span class="op" id="6038256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038261">case</span>&nbsp;<span class="string" id="6038266">&#39;\n&#39;</span><span class="op" id="6038270">,</span>&nbsp;<span class="string" id="6038272">&#39;\f&#39;</span><span class="op" id="6038276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038282">p</span><span class="op" id="6038283">.</span><span class="ident" id="6038284">resetSpace</span><span class="op" id="6038294">(</span><span class="op" id="6038295">)</span>&nbsp;<span class="comment" id="6038297">//&nbsp;discard&nbsp;trailing&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038327">_</span><span class="op" id="6038328">,</span>&nbsp;<span class="ident" id="6038330">err</span>&nbsp;<span class="op" id="6038334">=</span>&nbsp;<span class="ident" id="6038336">p</span><span class="op" id="6038337">.</span><span class="ident" id="6038338">output</span><span class="op" id="6038344">.</span><span class="ident" id="6038345">Write</span><span class="op" id="6038350">(</span><span class="ident" id="6038351">aNewline</span><span class="op" id="6038359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038364">case</span>&nbsp;<span class="ident" id="6038369">tabwriter</span><span class="op" id="6038378">.</span><span class="ident" id="6038379">Escape</span><span class="op" id="6038385">:</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038391">_</span><span class="op" id="6038392">,</span>&nbsp;<span class="ident" id="6038394">err</span>&nbsp;<span class="op" id="6038398">=</span>&nbsp;<span class="ident" id="6038400">p</span><span class="op" id="6038401">.</span><span class="ident" id="6038402">output</span><span class="op" id="6038408">.</span><span class="ident" id="6038409">Write</span><span class="op" id="6038414">(</span><span class="ident" id="6038415">p</span><span class="op" id="6038416">.</span><span class="ident" id="6038417">space</span><span class="op" id="6038422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038428">p</span><span class="op" id="6038429">.</span><span class="ident" id="6038430">state</span>&nbsp;<span class="op" id="6038436">=</span>&nbsp;<span class="ident" id="6038438">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038451">m</span>&nbsp;<span class="op" id="6038453">=</span>&nbsp;<span class="ident" id="6038455">n</span>&nbsp;<span class="op" id="6038457">+</span>&nbsp;<span class="num" id="6038459">1</span>&nbsp;<span class="comment" id="6038461">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038493">default</span><span class="op" id="6038500">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038506">_</span><span class="op" id="6038507">,</span>&nbsp;<span class="ident" id="6038509">err</span>&nbsp;<span class="op" id="6038513">=</span>&nbsp;<span class="ident" id="6038515">p</span><span class="op" id="6038516">.</span><span class="ident" id="6038517">output</span><span class="op" id="6038523">.</span><span class="ident" id="6038524">Write</span><span class="op" id="6038529">(</span><span class="ident" id="6038530">p</span><span class="op" id="6038531">.</span><span class="ident" id="6038532">space</span><span class="op" id="6038537">)</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038543">p</span><span class="op" id="6038544">.</span><span class="ident" id="6038545">state</span>&nbsp;<span class="op" id="6038551">=</span>&nbsp;<span class="ident" id="6038553">inText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038564">m</span>&nbsp;<span class="op" id="6038566">=</span>&nbsp;<span class="ident" id="6038568">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6038573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038577">case</span>&nbsp;<span class="ident" id="6038582">inEscape</span><span class="op" id="6038590">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038595">if</span>&nbsp;<span class="ident" id="6038598">b</span>&nbsp;<span class="op" id="6038600">==</span>&nbsp;<span class="ident" id="6038603">tabwriter</span><span class="op" id="6038612">.</span><span class="ident" id="6038613">Escape</span>&nbsp;<span class="op" id="6038620">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038626">_</span><span class="op" id="6038627">,</span>&nbsp;<span class="ident" id="6038629">err</span>&nbsp;<span class="op" id="6038633">=</span>&nbsp;<span class="ident" id="6038635">p</span><span class="op" id="6038636">.</span><span class="ident" id="6038637">output</span><span class="op" id="6038643">.</span><span class="ident" id="6038644">Write</span><span class="op" id="6038649">(</span><span class="ident" id="6038650">data</span><span class="op" id="6038654">[</span><span class="ident" id="6038655">m</span><span class="op" id="6038656">:</span><span class="ident" id="6038657">n</span><span class="op" id="6038658">]</span><span class="op" id="6038659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038665">p</span><span class="op" id="6038666">.</span><span class="ident" id="6038667">resetSpace</span><span class="op" id="6038677">(</span><span class="op" id="6038678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6038683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038687">case</span>&nbsp;<span class="ident" id="6038692">inText</span><span class="op" id="6038698">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038703">switch</span>&nbsp;<span class="ident" id="6038710">b</span>&nbsp;<span class="op" id="6038712">{</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038717">case</span>&nbsp;<span class="string" id="6038722">&#39;\t&#39;</span><span class="op" id="6038726">,</span>&nbsp;<span class="string" id="6038728">&#39;&nbsp;&#39;</span><span class="op" id="6038731">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038737">_</span><span class="op" id="6038738">,</span>&nbsp;<span class="ident" id="6038740">err</span>&nbsp;<span class="op" id="6038744">=</span>&nbsp;<span class="ident" id="6038746">p</span><span class="op" id="6038747">.</span><span class="ident" id="6038748">output</span><span class="op" id="6038754">.</span><span class="ident" id="6038755">Write</span><span class="op" id="6038760">(</span><span class="ident" id="6038761">data</span><span class="op" id="6038765">[</span><span class="ident" id="6038766">m</span><span class="op" id="6038767">:</span><span class="ident" id="6038768">n</span><span class="op" id="6038769">]</span><span class="op" id="6038770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038776">p</span><span class="op" id="6038777">.</span><span class="ident" id="6038778">resetSpace</span><span class="op" id="6038788">(</span><span class="op" id="6038789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038795">p</span><span class="op" id="6038796">.</span><span class="ident" id="6038797">space</span>&nbsp;<span class="op" id="6038803">=</span>&nbsp;<span class="builtinfunc" id="6038805">append</span><span class="op" id="6038811">(</span><span class="ident" id="6038812">p</span><span class="op" id="6038813">.</span><span class="ident" id="6038814">space</span><span class="op" id="6038819">,</span>&nbsp;<span class="ident" id="6038821">b</span><span class="op" id="6038822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038827">case</span>&nbsp;<span class="string" id="6038832">&#39;\n&#39;</span><span class="op" id="6038836">,</span>&nbsp;<span class="string" id="6038838">&#39;\f&#39;</span><span class="op" id="6038842">:</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038848">_</span><span class="op" id="6038849">,</span>&nbsp;<span class="ident" id="6038851">err</span>&nbsp;<span class="op" id="6038855">=</span>&nbsp;<span class="ident" id="6038857">p</span><span class="op" id="6038858">.</span><span class="ident" id="6038859">output</span><span class="op" id="6038865">.</span><span class="ident" id="6038866">Write</span><span class="op" id="6038871">(</span><span class="ident" id="6038872">data</span><span class="op" id="6038876">[</span><span class="ident" id="6038877">m</span><span class="op" id="6038878">:</span><span class="ident" id="6038879">n</span><span class="op" id="6038880">]</span><span class="op" id="6038881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038887">p</span><span class="op" id="6038888">.</span><span class="ident" id="6038889">resetSpace</span><span class="op" id="6038899">(</span><span class="op" id="6038900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038906">_</span><span class="op" id="6038907">,</span>&nbsp;<span class="ident" id="6038909">err</span>&nbsp;<span class="op" id="6038913">=</span>&nbsp;<span class="ident" id="6038915">p</span><span class="op" id="6038916">.</span><span class="ident" id="6038917">output</span><span class="op" id="6038923">.</span><span class="ident" id="6038924">Write</span><span class="op" id="6038929">(</span><span class="ident" id="6038930">aNewline</span><span class="op" id="6038938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6038943">case</span>&nbsp;<span class="ident" id="6038948">tabwriter</span><span class="op" id="6038957">.</span><span class="ident" id="6038958">Escape</span><span class="op" id="6038964">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6038970">_</span><span class="op" id="6038971">,</span>&nbsp;<span class="ident" id="6038973">err</span>&nbsp;<span class="op" id="6038977">=</span>&nbsp;<span class="ident" id="6038979">p</span><span class="op" id="6038980">.</span><span class="ident" id="6038981">output</span><span class="op" id="6038987">.</span><span class="ident" id="6038988">Write</span><span class="op" id="6038993">(</span><span class="ident" id="6038994">data</span><span class="op" id="6038998">[</span><span class="ident" id="6038999">m</span><span class="op" id="6039000">:</span><span class="ident" id="6039001">n</span><span class="op" id="6039002">]</span><span class="op" id="6039003">)</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6039009">p</span><span class="op" id="6039010">.</span><span class="ident" id="6039011">state</span>&nbsp;<span class="op" id="6039017">=</span>&nbsp;<span class="ident" id="6039019">inEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6039032">m</span>&nbsp;<span class="op" id="6039034">=</span>&nbsp;<span class="ident" id="6039036">n</span>&nbsp;<span class="op" id="6039038">+</span>&nbsp;<span class="num" id="6039040">1</span>&nbsp;<span class="comment" id="6039042">//&nbsp;+1:&nbsp;skip&nbsp;tabwriter.Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6039074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6039078">default</span><span class="op" id="6039085">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6039090">panic</span><span class="op" id="6039095">(</span><span class="string" id="6039096">&#34;unreachable&#34;</span><span class="op" id="6039109">)</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6039113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6039117">if</span>&nbsp;<span class="ident" id="6039120">err</span>&nbsp;<span class="op" id="6039124">!=</span>&nbsp;<span class="ident" id="6039127">nil</span>&nbsp;<span class="op" id="6039131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6039136">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6039145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6039148">}</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6039151">n</span>&nbsp;<span class="op" id="6039153">=</span>&nbsp;<span class="builtinfunc" id="6039155">len</span><span class="op" id="6039158">(</span><span class="ident" id="6039159">data</span><span class="op" id="6039163">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6039167">switch</span>&nbsp;<span class="ident" id="6039174">p</span><span class="op" id="6039175">.</span><span class="ident" id="6039176">state</span>&nbsp;<span class="op" id="6039182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6039185">case</span>&nbsp;<span class="ident" id="6039190">inEscape</span><span class="op" id="6039198">,</span>&nbsp;<span class="ident" id="6039200">inText</span><span class="op" id="6039206">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6039210">_</span><span class="op" id="6039211">,</span>&nbsp;<span class="ident" id="6039213">err</span>&nbsp;<span class="op" id="6039217">=</span>&nbsp;<span class="ident" id="6039219">p</span><span class="op" id="6039220">.</span><span class="ident" id="6039221">output</span><span class="op" id="6039227">.</span><span class="ident" id="6039228">Write</span><span class="op" id="6039233">(</span><span class="ident" id="6039234">data</span><span class="op" id="6039238">[</span><span class="ident" id="6039239">m</span><span class="op" id="6039240">:</span><span class="ident" id="6039241">n</span><span class="op" id="6039242">]</span><span class="op" id="6039243">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6039247">p</span><span class="op" id="6039248">.</span><span class="ident" id="6039249">resetSpace</span><span class="op" id="6039259">(</span><span class="op" id="6039260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6039263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6039267">return</span><br>
<span class="lineno"></span><span class="op" id="6039274">}</span><br>
<span class="lineno">1200</span><br>
<span class="lineno"></span><span class="comment" id="6039277">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6039357">//&nbsp;Public&nbsp;interface</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6039378">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).&nbsp;They&nbsp;control&nbsp;printing.</span><br>
<span class="lineno">1205</span><span class="keyword" id="6039443">type</span>&nbsp;<span class="ident" id="6039448">Mode</span>&nbsp;<span class="builtintype" id="6039453">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6039459">const</span>&nbsp;<span class="op" id="6039465">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6039468">RawFormat</span>&nbsp;<span class="ident" id="6039478">Mode</span>&nbsp;<span class="op" id="6039483">=</span>&nbsp;<span class="num" id="6039485">1</span>&nbsp;<span class="op" id="6039487">&lt;&lt;</span>&nbsp;<span class="ident" id="6039490">iota</span>&nbsp;<span class="comment" id="6039495">//&nbsp;do&nbsp;not&nbsp;use&nbsp;a&nbsp;tabwriter;&nbsp;if&nbsp;set,&nbsp;UseSpaces&nbsp;is&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6039552">TabIndent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6039579">//&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;independent&nbsp;of&nbsp;UseSpaces</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6039633">UseSpaces</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6039660">//&nbsp;use&nbsp;spaces&nbsp;instead&nbsp;of&nbsp;tabs&nbsp;for&nbsp;alignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6039705">SourcePos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6039732">//&nbsp;emit&nbsp;//line&nbsp;comments&nbsp;to&nbsp;preserve&nbsp;original&nbsp;source&nbsp;positions</span><br>
<span class="lineno"></span><span class="op" id="6039794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6039797">//&nbsp;A&nbsp;Config&nbsp;node&nbsp;controls&nbsp;the&nbsp;output&nbsp;of&nbsp;Fprint.</span><br>
<span class="lineno">1215</span><span class="keyword" id="6039845">type</span>&nbsp;<span class="ident" id="6039850">Config</span>&nbsp;<span class="keyword" id="6039857">struct</span>&nbsp;<span class="op" id="6039864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6039867">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039876">Mode</span>&nbsp;<span class="comment" id="6039881">//&nbsp;default:&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6039896">Tabwidth</span>&nbsp;<span class="builtintype" id="6039905">int</span>&nbsp;&nbsp;<span class="comment" id="6039910">//&nbsp;default:&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6039925">Indent</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6039934">int</span>&nbsp;&nbsp;<span class="comment" id="6039939">//&nbsp;default:&nbsp;0&nbsp;(all&nbsp;code&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;by&nbsp;this&nbsp;much)</span><br>
<span class="lineno"></span><span class="op" id="6039998">}</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span><span class="comment" id="6040001">//&nbsp;fprint&nbsp;implements&nbsp;Fprint&nbsp;and&nbsp;takes&nbsp;a&nbsp;nodesSizes&nbsp;map&nbsp;for&nbsp;setting&nbsp;up&nbsp;the&nbsp;printer&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="6040090">func</span>&nbsp;<span class="op" id="6040095">(</span><span class="ident" id="6040096">cfg</span>&nbsp;<span class="op" id="6040100">*</span><span class="ident" id="6040101">Config</span><span class="op" id="6040107">)</span>&nbsp;<span class="ident" id="6040109">fprint</span><span class="op" id="6040115">(</span><span class="ident" id="6040116">output</span>&nbsp;<span class="ident" id="6040123">io</span><span class="op" id="6040125">.</span><span class="ident" id="6040126">Writer</span><span class="op" id="6040132">,</span>&nbsp;<span class="ident" id="6040134">fset</span>&nbsp;<span class="op" id="6040139">*</span><span class="ident" id="6040140">token</span><span class="op" id="6040145">.</span><span class="ident" id="6040146">FileSet</span><span class="op" id="6040153">,</span>&nbsp;<span class="ident" id="6040155">node</span>&nbsp;<span class="keyword" id="6040160">interface</span><span class="op" id="6040169">{</span><span class="op" id="6040170">}</span><span class="op" id="6040171">,</span>&nbsp;<span class="ident" id="6040173">nodeSizes</span>&nbsp;<span class="keyword" id="6040183">map</span><span class="op" id="6040186">[</span><span class="ident" id="6040187">ast</span><span class="op" id="6040190">.</span><span class="ident" id="6040191">Node</span><span class="op" id="6040195">]</span><span class="builtintype" id="6040196">int</span><span class="op" id="6040199">)</span>&nbsp;<span class="op" id="6040201">(</span><span class="ident" id="6040202">err</span>&nbsp;<span class="builtintype" id="6040206">error</span><span class="op" id="6040211">)</span>&nbsp;<span class="op" id="6040213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6040216">//&nbsp;print&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6040231">var</span>&nbsp;<span class="ident" id="6040235">p</span>&nbsp;<span class="ident" id="6040237">printer</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6040246">p</span><span class="op" id="6040247">.</span><span class="ident" id="6040248">init</span><span class="op" id="6040252">(</span><span class="ident" id="6040253">cfg</span><span class="op" id="6040256">,</span>&nbsp;<span class="ident" id="6040258">fset</span><span class="op" id="6040262">,</span>&nbsp;<span class="ident" id="6040264">nodeSizes</span><span class="op" id="6040273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6040276">if</span>&nbsp;<span class="ident" id="6040279">err</span>&nbsp;<span class="op" id="6040283">=</span>&nbsp;<span class="ident" id="6040285">p</span><span class="op" id="6040286">.</span><span class="ident" id="6040287">printNode</span><span class="op" id="6040296">(</span><span class="ident" id="6040297">node</span><span class="op" id="6040301">)</span><span class="op" id="6040302">;</span>&nbsp;<span class="ident" id="6040304">err</span>&nbsp;<span class="op" id="6040308">!=</span>&nbsp;<span class="ident" id="6040311">nil</span>&nbsp;<span class="op" id="6040315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6040319">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6040327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6040330">//&nbsp;print&nbsp;outstanding&nbsp;comments</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6040361">p</span><span class="op" id="6040362">.</span><span class="ident" id="6040363">impliedSemi</span>&nbsp;<span class="op" id="6040375">=</span>&nbsp;<span class="builtintype" id="6040377">false</span>&nbsp;<span class="comment" id="6040383">//&nbsp;EOF&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6040411">p</span><span class="op" id="6040412">.</span><span class="ident" id="6040413">flush</span><span class="op" id="6040418">(</span><span class="ident" id="6040419">token</span><span class="op" id="6040424">.</span><span class="ident" id="6040425">Position</span><span class="op" id="6040433">{</span><span class="ident" id="6040434">Offset</span><span class="op" id="6040440">:</span>&nbsp;<span class="ident" id="6040442">infinity</span><span class="op" id="6040450">,</span>&nbsp;<span class="ident" id="6040452">Line</span><span class="op" id="6040456">:</span>&nbsp;<span class="ident" id="6040458">infinity</span><span class="op" id="6040466">}</span><span class="op" id="6040467">,</span>&nbsp;<span class="ident" id="6040469">token</span><span class="op" id="6040474">.</span><span class="ident" id="6040475">EOF</span><span class="op" id="6040478">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6040482">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;trimmer&nbsp;to&nbsp;eliminate&nbsp;trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6040553">//&nbsp;(Input&nbsp;to&nbsp;a&nbsp;tabwriter&nbsp;must&nbsp;be&nbsp;untrimmed&nbsp;since&nbsp;trailing&nbsp;tabs&nbsp;provide</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6040625">//&nbsp;formatting&nbsp;information.&nbsp;The&nbsp;tabwriter&nbsp;could&nbsp;provide&nbsp;trimming</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6040690">//&nbsp;functionality&nbsp;but&nbsp;no&nbsp;tabwriter&nbsp;is&nbsp;used&nbsp;when&nbsp;RawFormat&nbsp;is&nbsp;set.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6040757">output</span>&nbsp;<span class="op" id="6040764">=</span>&nbsp;<span class="op" id="6040766">&amp;</span><span class="ident" id="6040767">trimmer</span><span class="op" id="6040774">{</span><span class="ident" id="6040775">output</span><span class="op" id="6040781">:</span>&nbsp;<span class="ident" id="6040783">output</span><span class="op" id="6040789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6040793">//&nbsp;redirect&nbsp;output&nbsp;through&nbsp;a&nbsp;tabwriter&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6040846">if</span>&nbsp;<span class="ident" id="6040849">cfg</span><span class="op" id="6040852">.</span><span class="ident" id="6040853">Mode</span><span class="op" id="6040857">&amp;</span><span class="ident" id="6040858">RawFormat</span>&nbsp;<span class="op" id="6040868">==</span>&nbsp;<span class="num" id="6040871">0</span>&nbsp;<span class="op" id="6040873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6040877">minwidth</span>&nbsp;<span class="op" id="6040886">:=</span>&nbsp;<span class="ident" id="6040889">cfg</span><span class="op" id="6040892">.</span><span class="ident" id="6040893">Tabwidth</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6040905">padchar</span>&nbsp;<span class="op" id="6040913">:=</span>&nbsp;<span class="builtintype" id="6040916">byte</span><span class="op" id="6040920">(</span><span class="string" id="6040921">&#39;\t&#39;</span><span class="op" id="6040925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6040929">if</span>&nbsp;<span class="ident" id="6040932">cfg</span><span class="op" id="6040935">.</span><span class="ident" id="6040936">Mode</span><span class="op" id="6040940">&amp;</span><span class="ident" id="6040941">UseSpaces</span>&nbsp;<span class="op" id="6040951">!=</span>&nbsp;<span class="num" id="6040954">0</span>&nbsp;<span class="op" id="6040956">{</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6040961">padchar</span>&nbsp;<span class="op" id="6040969">=</span>&nbsp;<span class="string" id="6040971">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6040977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6040982">twmode</span>&nbsp;<span class="op" id="6040989">:=</span>&nbsp;<span class="ident" id="6040992">tabwriter</span><span class="op" id="6041001">.</span><span class="ident" id="6041002">DiscardEmptyColumns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6041024">if</span>&nbsp;<span class="ident" id="6041027">cfg</span><span class="op" id="6041030">.</span><span class="ident" id="6041031">Mode</span><span class="op" id="6041035">&amp;</span><span class="ident" id="6041036">TabIndent</span>&nbsp;<span class="op" id="6041046">!=</span>&nbsp;<span class="num" id="6041049">0</span>&nbsp;<span class="op" id="6041051">{</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6041056">minwidth</span>&nbsp;<span class="op" id="6041065">=</span>&nbsp;<span class="num" id="6041067">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6041072">twmode</span>&nbsp;<span class="op" id="6041079">|=</span>&nbsp;<span class="ident" id="6041082">tabwriter</span><span class="op" id="6041091">.</span><span class="ident" id="6041092">TabIndent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6041104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6041109">output</span>&nbsp;<span class="op" id="6041116">=</span>&nbsp;<span class="ident" id="6041118">tabwriter</span><span class="op" id="6041127">.</span><span class="ident" id="6041128">NewWriter</span><span class="op" id="6041137">(</span><span class="ident" id="6041138">output</span><span class="op" id="6041144">,</span>&nbsp;<span class="ident" id="6041146">minwidth</span><span class="op" id="6041154">,</span>&nbsp;<span class="ident" id="6041156">cfg</span><span class="op" id="6041159">.</span><span class="ident" id="6041160">Tabwidth</span><span class="op" id="6041168">,</span>&nbsp;<span class="num" id="6041170">1</span><span class="op" id="6041171">,</span>&nbsp;<span class="ident" id="6041173">padchar</span><span class="op" id="6041180">,</span>&nbsp;<span class="ident" id="6041182">twmode</span><span class="op" id="6041188">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6041191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6041195">//&nbsp;write&nbsp;printer&nbsp;result&nbsp;via&nbsp;tabwriter/trimmer&nbsp;to&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6041252">if</span>&nbsp;<span class="ident" id="6041255">_</span><span class="op" id="6041256">,</span>&nbsp;<span class="ident" id="6041258">err</span>&nbsp;<span class="op" id="6041262">=</span>&nbsp;<span class="ident" id="6041264">output</span><span class="op" id="6041270">.</span><span class="ident" id="6041271">Write</span><span class="op" id="6041276">(</span><span class="ident" id="6041277">p</span><span class="op" id="6041278">.</span><span class="ident" id="6041279">output</span><span class="op" id="6041285">)</span><span class="op" id="6041286">;</span>&nbsp;<span class="ident" id="6041288">err</span>&nbsp;<span class="op" id="6041292">!=</span>&nbsp;<span class="ident" id="6041295">nil</span>&nbsp;<span class="op" id="6041299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6041303">return</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6041311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6041315">//&nbsp;flush&nbsp;tabwriter,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6041343">if</span>&nbsp;<span class="ident" id="6041346">tw</span><span class="op" id="6041348">,</span>&nbsp;<span class="ident" id="6041350">_</span>&nbsp;<span class="op" id="6041352">:=</span>&nbsp;<span class="ident" id="6041355">output</span><span class="op" id="6041361">.</span><span class="op" id="6041362">(</span><span class="op" id="6041363">*</span><span class="ident" id="6041364">tabwriter</span><span class="op" id="6041373">.</span><span class="ident" id="6041374">Writer</span><span class="op" id="6041380">)</span><span class="op" id="6041381">;</span>&nbsp;<span class="ident" id="6041383">tw</span>&nbsp;<span class="op" id="6041386">!=</span>&nbsp;<span class="ident" id="6041389">nil</span>&nbsp;<span class="op" id="6041393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6041397">err</span>&nbsp;<span class="op" id="6041401">=</span>&nbsp;<span class="ident" id="6041403">tw</span><span class="op" id="6041405">.</span><span class="ident" id="6041406">Flush</span><span class="op" id="6041411">(</span><span class="op" id="6041412">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6041415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6041419">return</span><br>
<span class="lineno"></span><span class="op" id="6041426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span><span class="comment" id="6041429">//&nbsp;A&nbsp;CommentedNode&nbsp;bundles&nbsp;an&nbsp;AST&nbsp;node&nbsp;and&nbsp;corresponding&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="6041496">//&nbsp;It&nbsp;may&nbsp;be&nbsp;provided&nbsp;as&nbsp;argument&nbsp;to&nbsp;any&nbsp;of&nbsp;the&nbsp;Fprint&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="6041562">//</span><br>
<span class="lineno"></span><span class="keyword" id="6041565">type</span>&nbsp;<span class="ident" id="6041570">CommentedNode</span>&nbsp;<span class="keyword" id="6041584">struct</span>&nbsp;<span class="op" id="6041591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6041594">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041603">interface</span><span class="op" id="6041612">{</span><span class="op" id="6041613">}</span>&nbsp;<span class="comment" id="6041615">//&nbsp;*ast.File,&nbsp;or&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6041675">Comments</span>&nbsp;<span class="op" id="6041684">[</span><span class="op" id="6041685">]</span><span class="op" id="6041686">*</span><span class="ident" id="6041687">ast</span><span class="op" id="6041690">.</span><span class="ident" id="6041691">CommentGroup</span><br>
<span class="lineno"></span><span class="op" id="6041704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6041707">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output&nbsp;for&nbsp;a&nbsp;given&nbsp;configuration&nbsp;cfg.</span><br>
<span class="lineno"></span><span class="comment" id="6041786">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno">1280</span><span class="comment" id="6041856">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*CommentedNode,&nbsp;[]ast.Decl,&nbsp;[]ast.Stmt,</span><br>
<span class="lineno"></span><span class="comment" id="6041932">//&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,&nbsp;or&nbsp;ast.Stmt.</span><br>
<span class="lineno"></span><span class="comment" id="6042006">//</span><br>
<span class="lineno"></span><span class="keyword" id="6042009">func</span>&nbsp;<span class="op" id="6042014">(</span><span class="ident" id="6042015">cfg</span>&nbsp;<span class="op" id="6042019">*</span><span class="ident" id="6042020">Config</span><span class="op" id="6042026">)</span>&nbsp;<span class="ident" id="6042028">Fprint</span><span class="op" id="6042034">(</span><span class="ident" id="6042035">output</span>&nbsp;<span class="ident" id="6042042">io</span><span class="op" id="6042044">.</span><span class="ident" id="6042045">Writer</span><span class="op" id="6042051">,</span>&nbsp;<span class="ident" id="6042053">fset</span>&nbsp;<span class="op" id="6042058">*</span><span class="ident" id="6042059">token</span><span class="op" id="6042064">.</span><span class="ident" id="6042065">FileSet</span><span class="op" id="6042072">,</span>&nbsp;<span class="ident" id="6042074">node</span>&nbsp;<span class="keyword" id="6042079">interface</span><span class="op" id="6042088">{</span><span class="op" id="6042089">}</span><span class="op" id="6042090">)</span>&nbsp;<span class="builtintype" id="6042092">error</span>&nbsp;<span class="op" id="6042098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6042101">return</span>&nbsp;<span class="ident" id="6042108">cfg</span><span class="op" id="6042111">.</span><span class="ident" id="6042112">fprint</span><span class="op" id="6042118">(</span><span class="ident" id="6042119">output</span><span class="op" id="6042125">,</span>&nbsp;<span class="ident" id="6042127">fset</span><span class="op" id="6042131">,</span>&nbsp;<span class="ident" id="6042133">node</span><span class="op" id="6042137">,</span>&nbsp;<span class="builtinfunc" id="6042139">make</span><span class="op" id="6042143">(</span><span class="keyword" id="6042144">map</span><span class="op" id="6042147">[</span><span class="ident" id="6042148">ast</span><span class="op" id="6042151">.</span><span class="ident" id="6042152">Node</span><span class="op" id="6042156">]</span><span class="builtintype" id="6042157">int</span><span class="op" id="6042160">)</span><span class="op" id="6042161">)</span><br>
<span class="lineno">1285</span><span class="op" id="6042163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6042166">//&nbsp;Fprint&nbsp;&#34;pretty-prints&#34;&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="6042215">//&nbsp;It&nbsp;calls&nbsp;Config.Fprint&nbsp;with&nbsp;default&nbsp;settings.</span><br>
<span class="lineno"></span><span class="comment" id="6042264">//</span><br>
<span class="lineno">1290</span><span class="keyword" id="6042267">func</span>&nbsp;<span class="ident" id="6042272">Fprint</span><span class="op" id="6042278">(</span><span class="ident" id="6042279">output</span>&nbsp;<span class="ident" id="6042286">io</span><span class="op" id="6042288">.</span><span class="ident" id="6042289">Writer</span><span class="op" id="6042295">,</span>&nbsp;<span class="ident" id="6042297">fset</span>&nbsp;<span class="op" id="6042302">*</span><span class="ident" id="6042303">token</span><span class="op" id="6042308">.</span><span class="ident" id="6042309">FileSet</span><span class="op" id="6042316">,</span>&nbsp;<span class="ident" id="6042318">node</span>&nbsp;<span class="keyword" id="6042323">interface</span><span class="op" id="6042332">{</span><span class="op" id="6042333">}</span><span class="op" id="6042334">)</span>&nbsp;<span class="builtintype" id="6042336">error</span>&nbsp;<span class="op" id="6042342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6042345">return</span>&nbsp;<span class="op" id="6042352">(</span><span class="op" id="6042353">&amp;</span><span class="ident" id="6042354">Config</span><span class="op" id="6042360">{</span><span class="ident" id="6042361">Tabwidth</span><span class="op" id="6042369">:</span>&nbsp;<span class="num" id="6042371">8</span><span class="op" id="6042372">}</span><span class="op" id="6042373">)</span><span class="op" id="6042374">.</span><span class="ident" id="6042375">Fprint</span><span class="op" id="6042381">(</span><span class="ident" id="6042382">output</span><span class="op" id="6042388">,</span>&nbsp;<span class="ident" id="6042390">fset</span><span class="op" id="6042394">,</span>&nbsp;<span class="ident" id="6042396">node</span><span class="op" id="6042400">)</span><br>
<span class="lineno"></span><span class="op" id="6042402">}</span>
</div>
</body>
</html>
