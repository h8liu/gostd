<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html" class="current">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7974918">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7974973">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7975027">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7975078">package</span>&nbsp;<span class="ident" id="7975086">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7975093">import</span>&nbsp;<span class="op" id="7975100">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7975103">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7975112">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7975128">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7975135">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7975145">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7975148">//&nbsp;equal&nbsp;returns&nbsp;nil&nbsp;if&nbsp;p&nbsp;and&nbsp;q&nbsp;describe&nbsp;the&nbsp;same&nbsp;file&nbsp;set;</span><br>
<span class="lineno">15</span><span class="comment" id="7975208">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;discrepancy.</span><br>
<span class="lineno"></span><span class="keyword" id="7975269">func</span>&nbsp;<span class="ident" id="7975274">equal</span><span class="op" id="7975279">(</span><span class="ident" id="7975280">p</span><span class="op" id="7975281">,</span>&nbsp;<span class="ident" id="7975283">q</span>&nbsp;<span class="op" id="7975285">*</span><span class="ident" id="7975286">FileSet</span><span class="op" id="7975293">)</span>&nbsp;<span class="builtintype" id="7975295">error</span>&nbsp;<span class="op" id="7975301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7975304">if</span>&nbsp;<span class="ident" id="7975307">p</span>&nbsp;<span class="op" id="7975309">==</span>&nbsp;<span class="ident" id="7975312">q</span>&nbsp;<span class="op" id="7975314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7975318">//&nbsp;avoid&nbsp;deadlock&nbsp;if&nbsp;p&nbsp;==&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7975348">return</span>&nbsp;<span class="ident" id="7975355">nil</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7975360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7975364">//&nbsp;not&nbsp;strictly&nbsp;needed&nbsp;for&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7975401">p</span><span class="op" id="7975402">.</span><span class="ident" id="7975403">mutex</span><span class="op" id="7975408">.</span><span class="ident" id="7975409">Lock</span><span class="op" id="7975413">(</span><span class="op" id="7975414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7975417">q</span><span class="op" id="7975418">.</span><span class="ident" id="7975419">mutex</span><span class="op" id="7975424">.</span><span class="ident" id="7975425">Lock</span><span class="op" id="7975429">(</span><span class="op" id="7975430">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7975433">defer</span>&nbsp;<span class="ident" id="7975439">q</span><span class="op" id="7975440">.</span><span class="ident" id="7975441">mutex</span><span class="op" id="7975446">.</span><span class="ident" id="7975447">Unlock</span><span class="op" id="7975453">(</span><span class="op" id="7975454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7975457">defer</span>&nbsp;<span class="ident" id="7975463">p</span><span class="op" id="7975464">.</span><span class="ident" id="7975465">mutex</span><span class="op" id="7975470">.</span><span class="ident" id="7975471">Unlock</span><span class="op" id="7975477">(</span><span class="op" id="7975478">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7975482">if</span>&nbsp;<span class="ident" id="7975485">p</span><span class="op" id="7975486">.</span><span class="ident" id="7975487">base</span>&nbsp;<span class="op" id="7975492">!=</span>&nbsp;<span class="ident" id="7975495">q</span><span class="op" id="7975496">.</span><span class="ident" id="7975497">base</span>&nbsp;<span class="op" id="7975502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7975506">return</span>&nbsp;<span class="ident" id="7975513">fmt</span><span class="op" id="7975516">.</span><span class="ident" id="7975517">Errorf</span><span class="op" id="7975523">(</span><span class="string" id="7975524">&#34;different&nbsp;bases:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7975551">,</span>&nbsp;<span class="ident" id="7975553">p</span><span class="op" id="7975554">.</span><span class="ident" id="7975555">base</span><span class="op" id="7975559">,</span>&nbsp;<span class="ident" id="7975561">q</span><span class="op" id="7975562">.</span><span class="ident" id="7975563">base</span><span class="op" id="7975567">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7975570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7975574">if</span>&nbsp;<span class="builtinfunc" id="7975577">len</span><span class="op" id="7975580">(</span><span class="ident" id="7975581">p</span><span class="op" id="7975582">.</span><span class="ident" id="7975583">files</span><span class="op" id="7975588">)</span>&nbsp;<span class="op" id="7975590">!=</span>&nbsp;<span class="builtinfunc" id="7975593">len</span><span class="op" id="7975596">(</span><span class="ident" id="7975597">q</span><span class="op" id="7975598">.</span><span class="ident" id="7975599">files</span><span class="op" id="7975604">)</span>&nbsp;<span class="op" id="7975606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7975610">return</span>&nbsp;<span class="ident" id="7975617">fmt</span><span class="op" id="7975620">.</span><span class="ident" id="7975621">Errorf</span><span class="op" id="7975627">(</span><span class="string" id="7975628">&#34;different&nbsp;number&nbsp;of&nbsp;files:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7975665">,</span>&nbsp;<span class="builtinfunc" id="7975667">len</span><span class="op" id="7975670">(</span><span class="ident" id="7975671">p</span><span class="op" id="7975672">.</span><span class="ident" id="7975673">files</span><span class="op" id="7975678">)</span><span class="op" id="7975679">,</span>&nbsp;<span class="builtinfunc" id="7975681">len</span><span class="op" id="7975684">(</span><span class="ident" id="7975685">q</span><span class="op" id="7975686">.</span><span class="ident" id="7975687">files</span><span class="op" id="7975692">)</span><span class="op" id="7975693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7975696">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7975700">for</span>&nbsp;<span class="ident" id="7975704">i</span><span class="op" id="7975705">,</span>&nbsp;<span class="ident" id="7975707">f</span>&nbsp;<span class="op" id="7975709">:=</span>&nbsp;<span class="keyword" id="7975712">range</span>&nbsp;<span class="ident" id="7975718">p</span><span class="op" id="7975719">.</span><span class="ident" id="7975720">files</span>&nbsp;<span class="op" id="7975726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7975730">g</span>&nbsp;<span class="op" id="7975732">:=</span>&nbsp;<span class="ident" id="7975735">q</span><span class="op" id="7975736">.</span><span class="ident" id="7975737">files</span><span class="op" id="7975742">[</span><span class="ident" id="7975743">i</span><span class="op" id="7975744">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7975748">if</span>&nbsp;<span class="ident" id="7975751">f</span><span class="op" id="7975752">.</span><span class="ident" id="7975753">set</span>&nbsp;<span class="op" id="7975757">!=</span>&nbsp;<span class="ident" id="7975760">p</span>&nbsp;<span class="op" id="7975762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7975767">return</span>&nbsp;<span class="ident" id="7975774">fmt</span><span class="op" id="7975777">.</span><span class="ident" id="7975778">Errorf</span><span class="op" id="7975784">(</span><span class="string" id="7975785">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7975807">,</span>&nbsp;<span class="ident" id="7975809">f</span><span class="op" id="7975810">.</span><span class="ident" id="7975811">name</span><span class="op" id="7975815">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7975819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7975823">if</span>&nbsp;<span class="ident" id="7975826">g</span><span class="op" id="7975827">.</span><span class="ident" id="7975828">set</span>&nbsp;<span class="op" id="7975832">!=</span>&nbsp;<span class="ident" id="7975835">q</span>&nbsp;<span class="op" id="7975837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7975842">return</span>&nbsp;<span class="ident" id="7975849">fmt</span><span class="op" id="7975852">.</span><span class="ident" id="7975853">Errorf</span><span class="op" id="7975859">(</span><span class="string" id="7975860">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7975882">,</span>&nbsp;<span class="ident" id="7975884">g</span><span class="op" id="7975885">.</span><span class="ident" id="7975886">name</span><span class="op" id="7975890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7975894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7975898">if</span>&nbsp;<span class="ident" id="7975901">f</span><span class="op" id="7975902">.</span><span class="ident" id="7975903">name</span>&nbsp;<span class="op" id="7975908">!=</span>&nbsp;<span class="ident" id="7975911">g</span><span class="op" id="7975912">.</span><span class="ident" id="7975913">name</span>&nbsp;<span class="op" id="7975918">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7975923">return</span>&nbsp;<span class="ident" id="7975930">fmt</span><span class="op" id="7975933">.</span><span class="ident" id="7975934">Errorf</span><span class="op" id="7975940">(</span><span class="string" id="7975941">&#34;different&nbsp;filenames:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="7975972">,</span>&nbsp;<span class="ident" id="7975974">f</span><span class="op" id="7975975">.</span><span class="ident" id="7975976">name</span><span class="op" id="7975980">,</span>&nbsp;<span class="ident" id="7975982">g</span><span class="op" id="7975983">.</span><span class="ident" id="7975984">name</span><span class="op" id="7975988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7975992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7975996">if</span>&nbsp;<span class="ident" id="7975999">f</span><span class="op" id="7976000">.</span><span class="ident" id="7976001">base</span>&nbsp;<span class="op" id="7976006">!=</span>&nbsp;<span class="ident" id="7976009">g</span><span class="op" id="7976010">.</span><span class="ident" id="7976011">base</span>&nbsp;<span class="op" id="7976016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976021">return</span>&nbsp;<span class="ident" id="7976028">fmt</span><span class="op" id="7976031">.</span><span class="ident" id="7976032">Errorf</span><span class="op" id="7976038">(</span><span class="string" id="7976039">&#34;different&nbsp;base&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7976072">,</span>&nbsp;<span class="ident" id="7976074">f</span><span class="op" id="7976075">.</span><span class="ident" id="7976076">name</span><span class="op" id="7976080">,</span>&nbsp;<span class="ident" id="7976082">f</span><span class="op" id="7976083">.</span><span class="ident" id="7976084">base</span><span class="op" id="7976088">,</span>&nbsp;<span class="ident" id="7976090">g</span><span class="op" id="7976091">.</span><span class="ident" id="7976092">base</span><span class="op" id="7976096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976100">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976104">if</span>&nbsp;<span class="ident" id="7976107">f</span><span class="op" id="7976108">.</span><span class="ident" id="7976109">size</span>&nbsp;<span class="op" id="7976114">!=</span>&nbsp;<span class="ident" id="7976117">g</span><span class="op" id="7976118">.</span><span class="ident" id="7976119">size</span>&nbsp;<span class="op" id="7976124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976129">return</span>&nbsp;<span class="ident" id="7976136">fmt</span><span class="op" id="7976139">.</span><span class="ident" id="7976140">Errorf</span><span class="op" id="7976146">(</span><span class="string" id="7976147">&#34;different&nbsp;size&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7976180">,</span>&nbsp;<span class="ident" id="7976182">f</span><span class="op" id="7976183">.</span><span class="ident" id="7976184">name</span><span class="op" id="7976188">,</span>&nbsp;<span class="ident" id="7976190">f</span><span class="op" id="7976191">.</span><span class="ident" id="7976192">size</span><span class="op" id="7976196">,</span>&nbsp;<span class="ident" id="7976198">g</span><span class="op" id="7976199">.</span><span class="ident" id="7976200">size</span><span class="op" id="7976204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976212">for</span>&nbsp;<span class="ident" id="7976216">j</span><span class="op" id="7976217">,</span>&nbsp;<span class="ident" id="7976219">l</span>&nbsp;<span class="op" id="7976221">:=</span>&nbsp;<span class="keyword" id="7976224">range</span>&nbsp;<span class="ident" id="7976230">f</span><span class="op" id="7976231">.</span><span class="ident" id="7976232">lines</span>&nbsp;<span class="op" id="7976238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7976243">m</span>&nbsp;<span class="op" id="7976245">:=</span>&nbsp;<span class="ident" id="7976248">g</span><span class="op" id="7976249">.</span><span class="ident" id="7976250">lines</span><span class="op" id="7976255">[</span><span class="ident" id="7976256">j</span><span class="op" id="7976257">]</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976262">if</span>&nbsp;<span class="ident" id="7976265">l</span>&nbsp;<span class="op" id="7976267">!=</span>&nbsp;<span class="ident" id="7976270">m</span>&nbsp;<span class="op" id="7976272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976278">return</span>&nbsp;<span class="ident" id="7976285">fmt</span><span class="op" id="7976288">.</span><span class="ident" id="7976289">Errorf</span><span class="op" id="7976295">(</span><span class="string" id="7976296">&#34;different&nbsp;offsets&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7976322">,</span>&nbsp;<span class="ident" id="7976324">f</span><span class="op" id="7976325">.</span><span class="ident" id="7976326">name</span><span class="op" id="7976330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976343">for</span>&nbsp;<span class="ident" id="7976347">j</span><span class="op" id="7976348">,</span>&nbsp;<span class="ident" id="7976350">l</span>&nbsp;<span class="op" id="7976352">:=</span>&nbsp;<span class="keyword" id="7976355">range</span>&nbsp;<span class="ident" id="7976361">f</span><span class="op" id="7976362">.</span><span class="ident" id="7976363">infos</span>&nbsp;<span class="op" id="7976369">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7976374">m</span>&nbsp;<span class="op" id="7976376">:=</span>&nbsp;<span class="ident" id="7976379">g</span><span class="op" id="7976380">.</span><span class="ident" id="7976381">infos</span><span class="op" id="7976386">[</span><span class="ident" id="7976387">j</span><span class="op" id="7976388">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976393">if</span>&nbsp;<span class="ident" id="7976396">l</span><span class="op" id="7976397">.</span><span class="ident" id="7976398">Offset</span>&nbsp;<span class="op" id="7976405">!=</span>&nbsp;<span class="ident" id="7976408">m</span><span class="op" id="7976409">.</span><span class="ident" id="7976410">Offset</span>&nbsp;<span class="op" id="7976417">||</span>&nbsp;<span class="ident" id="7976420">l</span><span class="op" id="7976421">.</span><span class="ident" id="7976422">Filename</span>&nbsp;<span class="op" id="7976431">!=</span>&nbsp;<span class="ident" id="7976434">m</span><span class="op" id="7976435">.</span><span class="ident" id="7976436">Filename</span>&nbsp;<span class="op" id="7976445">||</span>&nbsp;<span class="ident" id="7976448">l</span><span class="op" id="7976449">.</span><span class="ident" id="7976450">Line</span>&nbsp;<span class="op" id="7976455">!=</span>&nbsp;<span class="ident" id="7976458">m</span><span class="op" id="7976459">.</span><span class="ident" id="7976460">Line</span>&nbsp;<span class="op" id="7976465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976471">return</span>&nbsp;<span class="ident" id="7976478">fmt</span><span class="op" id="7976481">.</span><span class="ident" id="7976482">Errorf</span><span class="op" id="7976488">(</span><span class="string" id="7976489">&#34;different&nbsp;infos&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7976513">,</span>&nbsp;<span class="ident" id="7976515">f</span><span class="op" id="7976516">.</span><span class="ident" id="7976517">name</span><span class="op" id="7976521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976530">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7976537">//&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;about&nbsp;.last&nbsp;-&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976587">return</span>&nbsp;<span class="ident" id="7976594">nil</span><br>
<span class="lineno"></span><span class="op" id="7976598">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7976601">func</span>&nbsp;<span class="ident" id="7976606">checkSerialize</span><span class="op" id="7976620">(</span><span class="ident" id="7976621">t</span>&nbsp;<span class="op" id="7976623">*</span><span class="ident" id="7976624">testing</span><span class="op" id="7976631">.</span><span class="ident" id="7976632">T</span><span class="op" id="7976633">,</span>&nbsp;<span class="ident" id="7976635">p</span>&nbsp;<span class="op" id="7976637">*</span><span class="ident" id="7976638">FileSet</span><span class="op" id="7976645">)</span>&nbsp;<span class="op" id="7976647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976650">var</span>&nbsp;<span class="ident" id="7976654">buf</span>&nbsp;<span class="ident" id="7976658">bytes</span><span class="op" id="7976663">.</span><span class="ident" id="7976664">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7976672">encode</span>&nbsp;<span class="op" id="7976679">:=</span>&nbsp;<span class="keyword" id="7976682">func</span><span class="op" id="7976686">(</span><span class="ident" id="7976687">x</span>&nbsp;<span class="keyword" id="7976689">interface</span><span class="op" id="7976698">{</span><span class="op" id="7976699">}</span><span class="op" id="7976700">)</span>&nbsp;<span class="builtintype" id="7976702">error</span>&nbsp;<span class="op" id="7976708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976712">return</span>&nbsp;<span class="ident" id="7976719">gob</span><span class="op" id="7976722">.</span><span class="ident" id="7976723">NewEncoder</span><span class="op" id="7976733">(</span><span class="op" id="7976734">&amp;</span><span class="ident" id="7976735">buf</span><span class="op" id="7976738">)</span><span class="op" id="7976739">.</span><span class="ident" id="7976740">Encode</span><span class="op" id="7976746">(</span><span class="ident" id="7976747">x</span><span class="op" id="7976748">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976754">if</span>&nbsp;<span class="ident" id="7976757">err</span>&nbsp;<span class="op" id="7976761">:=</span>&nbsp;<span class="ident" id="7976764">p</span><span class="op" id="7976765">.</span><span class="ident" id="7976766">Write</span><span class="op" id="7976771">(</span><span class="ident" id="7976772">encode</span><span class="op" id="7976778">)</span><span class="op" id="7976779">;</span>&nbsp;<span class="ident" id="7976781">err</span>&nbsp;<span class="op" id="7976785">!=</span>&nbsp;<span class="ident" id="7976788">nil</span>&nbsp;<span class="op" id="7976792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7976796">t</span><span class="op" id="7976797">.</span><span class="ident" id="7976798">Errorf</span><span class="op" id="7976804">(</span><span class="string" id="7976805">&#34;writing&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7976833">,</span>&nbsp;<span class="ident" id="7976835">err</span><span class="op" id="7976838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976842">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976850">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7976853">q</span>&nbsp;<span class="op" id="7976855">:=</span>&nbsp;<span class="ident" id="7976858">NewFileSet</span><span class="op" id="7976868">(</span><span class="op" id="7976869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7976872">decode</span>&nbsp;<span class="op" id="7976879">:=</span>&nbsp;<span class="keyword" id="7976882">func</span><span class="op" id="7976886">(</span><span class="ident" id="7976887">x</span>&nbsp;<span class="keyword" id="7976889">interface</span><span class="op" id="7976898">{</span><span class="op" id="7976899">}</span><span class="op" id="7976900">)</span>&nbsp;<span class="builtintype" id="7976902">error</span>&nbsp;<span class="op" id="7976908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976912">return</span>&nbsp;<span class="ident" id="7976919">gob</span><span class="op" id="7976922">.</span><span class="ident" id="7976923">NewDecoder</span><span class="op" id="7976933">(</span><span class="op" id="7976934">&amp;</span><span class="ident" id="7976935">buf</span><span class="op" id="7976938">)</span><span class="op" id="7976939">.</span><span class="ident" id="7976940">Decode</span><span class="op" id="7976946">(</span><span class="ident" id="7976947">x</span><span class="op" id="7976948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976954">if</span>&nbsp;<span class="ident" id="7976957">err</span>&nbsp;<span class="op" id="7976961">:=</span>&nbsp;<span class="ident" id="7976964">q</span><span class="op" id="7976965">.</span><span class="ident" id="7976966">Read</span><span class="op" id="7976970">(</span><span class="ident" id="7976971">decode</span><span class="op" id="7976977">)</span><span class="op" id="7976978">;</span>&nbsp;<span class="ident" id="7976980">err</span>&nbsp;<span class="op" id="7976984">!=</span>&nbsp;<span class="ident" id="7976987">nil</span>&nbsp;<span class="op" id="7976991">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7976995">t</span><span class="op" id="7976996">.</span><span class="ident" id="7976997">Errorf</span><span class="op" id="7977003">(</span><span class="string" id="7977004">&#34;reading&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7977032">,</span>&nbsp;<span class="ident" id="7977034">err</span><span class="op" id="7977037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977041">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977052">if</span>&nbsp;<span class="ident" id="7977055">err</span>&nbsp;<span class="op" id="7977059">:=</span>&nbsp;<span class="ident" id="7977062">equal</span><span class="op" id="7977067">(</span><span class="ident" id="7977068">p</span><span class="op" id="7977069">,</span>&nbsp;<span class="ident" id="7977071">q</span><span class="op" id="7977072">)</span><span class="op" id="7977073">;</span>&nbsp;<span class="ident" id="7977075">err</span>&nbsp;<span class="op" id="7977079">!=</span>&nbsp;<span class="ident" id="7977082">nil</span>&nbsp;<span class="op" id="7977086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977090">t</span><span class="op" id="7977091">.</span><span class="ident" id="7977092">Errorf</span><span class="op" id="7977098">(</span><span class="string" id="7977099">&#34;filesets&nbsp;not&nbsp;identical:&nbsp;%s&#34;</span><span class="op" id="7977127">,</span>&nbsp;<span class="ident" id="7977129">err</span><span class="op" id="7977132">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977135">}</span><br>
<span class="lineno"></span><span class="op" id="7977137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7977140">func</span>&nbsp;<span class="ident" id="7977145">TestSerialization</span><span class="op" id="7977162">(</span><span class="ident" id="7977163">t</span>&nbsp;<span class="op" id="7977165">*</span><span class="ident" id="7977166">testing</span><span class="op" id="7977173">.</span><span class="ident" id="7977174">T</span><span class="op" id="7977175">)</span>&nbsp;<span class="op" id="7977177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977180">p</span>&nbsp;<span class="op" id="7977182">:=</span>&nbsp;<span class="ident" id="7977185">NewFileSet</span><span class="op" id="7977195">(</span><span class="op" id="7977196">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977199">checkSerialize</span><span class="op" id="7977213">(</span><span class="ident" id="7977214">t</span><span class="op" id="7977215">,</span>&nbsp;<span class="ident" id="7977217">p</span><span class="op" id="7977218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7977221">//&nbsp;add&nbsp;some&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977240">for</span>&nbsp;<span class="ident" id="7977244">i</span>&nbsp;<span class="op" id="7977246">:=</span>&nbsp;<span class="num" id="7977249">0</span><span class="op" id="7977250">;</span>&nbsp;<span class="ident" id="7977252">i</span>&nbsp;<span class="op" id="7977254">&lt;</span>&nbsp;<span class="num" id="7977256">10</span><span class="op" id="7977258">;</span>&nbsp;<span class="ident" id="7977260">i</span><span class="op" id="7977261">++</span>&nbsp;<span class="op" id="7977264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977268">f</span>&nbsp;<span class="op" id="7977270">:=</span>&nbsp;<span class="ident" id="7977273">p</span><span class="op" id="7977274">.</span><span class="ident" id="7977275">AddFile</span><span class="op" id="7977282">(</span><span class="ident" id="7977283">fmt</span><span class="op" id="7977286">.</span><span class="ident" id="7977287">Sprintf</span><span class="op" id="7977294">(</span><span class="string" id="7977295">&#34;file%d&#34;</span><span class="op" id="7977303">,</span>&nbsp;<span class="ident" id="7977305">i</span><span class="op" id="7977306">)</span><span class="op" id="7977307">,</span>&nbsp;<span class="ident" id="7977309">p</span><span class="op" id="7977310">.</span><span class="ident" id="7977311">Base</span><span class="op" id="7977315">(</span><span class="op" id="7977316">)</span><span class="op" id="7977317">+</span><span class="ident" id="7977318">i</span><span class="op" id="7977319">,</span>&nbsp;<span class="ident" id="7977321">i</span><span class="op" id="7977322">*</span><span class="num" id="7977323">100</span><span class="op" id="7977326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977330">checkSerialize</span><span class="op" id="7977344">(</span><span class="ident" id="7977345">t</span><span class="op" id="7977346">,</span>&nbsp;<span class="ident" id="7977348">p</span><span class="op" id="7977349">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7977353">//&nbsp;add&nbsp;some&nbsp;lines&nbsp;and&nbsp;alternative&nbsp;file&nbsp;infos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977400">line</span>&nbsp;<span class="op" id="7977405">:=</span>&nbsp;<span class="num" id="7977408">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977415">for</span>&nbsp;<span class="ident" id="7977419">offs</span>&nbsp;<span class="op" id="7977424">:=</span>&nbsp;<span class="num" id="7977427">0</span><span class="op" id="7977428">;</span>&nbsp;<span class="ident" id="7977430">offs</span>&nbsp;<span class="op" id="7977435">&lt;</span>&nbsp;<span class="ident" id="7977437">f</span><span class="op" id="7977438">.</span><span class="ident" id="7977439">Size</span><span class="op" id="7977443">(</span><span class="op" id="7977444">)</span><span class="op" id="7977445">;</span>&nbsp;<span class="ident" id="7977447">offs</span>&nbsp;<span class="op" id="7977452">+=</span>&nbsp;<span class="num" id="7977455">40</span>&nbsp;<span class="op" id="7977458">+</span>&nbsp;<span class="ident" id="7977460">i</span>&nbsp;<span class="op" id="7977462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977467">f</span><span class="op" id="7977468">.</span><span class="ident" id="7977469">AddLine</span><span class="op" id="7977476">(</span><span class="ident" id="7977477">offs</span><span class="op" id="7977481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977486">if</span>&nbsp;<span class="ident" id="7977489">offs</span><span class="op" id="7977493">%</span><span class="num" id="7977494">7</span>&nbsp;<span class="op" id="7977496">==</span>&nbsp;<span class="num" id="7977499">0</span>&nbsp;<span class="op" id="7977501">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977507">f</span><span class="op" id="7977508">.</span><span class="ident" id="7977509">AddLineInfo</span><span class="op" id="7977520">(</span><span class="ident" id="7977521">offs</span><span class="op" id="7977525">,</span>&nbsp;<span class="ident" id="7977527">fmt</span><span class="op" id="7977530">.</span><span class="ident" id="7977531">Sprintf</span><span class="op" id="7977538">(</span><span class="string" id="7977539">&#34;file%d&#34;</span><span class="op" id="7977547">,</span>&nbsp;<span class="ident" id="7977549">offs</span><span class="op" id="7977553">)</span><span class="op" id="7977554">,</span>&nbsp;<span class="ident" id="7977556">line</span><span class="op" id="7977560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977566">line</span>&nbsp;<span class="op" id="7977571">+=</span>&nbsp;<span class="num" id="7977574">33</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977588">checkSerialize</span><span class="op" id="7977602">(</span><span class="ident" id="7977603">t</span><span class="op" id="7977604">,</span>&nbsp;<span class="ident" id="7977606">p</span><span class="op" id="7977607">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977610">}</span><br>
<span class="lineno"></span><span class="op" id="7977612">}</span>
</div>
</body>
</html>
