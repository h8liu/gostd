<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7505890">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7505945">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7505999">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7506050">package</span>&nbsp;<span class="ident" id="7506058">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7506063">import</span>&nbsp;<span class="op" id="7506070">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7506073">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7506082">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7506089">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7506098">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7506113">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7506126">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7506136">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7506139">func</span>&nbsp;<span class="ident" id="7506144">diff</span><span class="op" id="7506148">(</span><span class="ident" id="7506149">m0</span><span class="op" id="7506151">,</span>&nbsp;<span class="ident" id="7506153">m1</span>&nbsp;<span class="ident" id="7506156">image</span><span class="op" id="7506161">.</span><span class="ident" id="7506162">Image</span><span class="op" id="7506167">)</span>&nbsp;<span class="builtintype" id="7506169">error</span>&nbsp;<span class="op" id="7506175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7506178">b0</span><span class="op" id="7506180">,</span>&nbsp;<span class="ident" id="7506182">b1</span>&nbsp;<span class="op" id="7506185">:=</span>&nbsp;<span class="ident" id="7506188">m0</span><span class="op" id="7506190">.</span><span class="ident" id="7506191">Bounds</span><span class="op" id="7506197">(</span><span class="op" id="7506198">)</span><span class="op" id="7506199">,</span>&nbsp;<span class="ident" id="7506201">m1</span><span class="op" id="7506203">.</span><span class="ident" id="7506204">Bounds</span><span class="op" id="7506210">(</span><span class="op" id="7506211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7506214">if</span>&nbsp;<span class="op" id="7506217">!</span><span class="ident" id="7506218">b0</span><span class="op" id="7506220">.</span><span class="ident" id="7506221">Size</span><span class="op" id="7506225">(</span><span class="op" id="7506226">)</span><span class="op" id="7506227">.</span><span class="ident" id="7506228">Eq</span><span class="op" id="7506230">(</span><span class="ident" id="7506231">b1</span><span class="op" id="7506233">.</span><span class="ident" id="7506234">Size</span><span class="op" id="7506238">(</span><span class="op" id="7506239">)</span><span class="op" id="7506240">)</span>&nbsp;<span class="op" id="7506242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7506246">return</span>&nbsp;<span class="ident" id="7506253">fmt</span><span class="op" id="7506256">.</span><span class="ident" id="7506257">Errorf</span><span class="op" id="7506263">(</span><span class="string" id="7506264">&#34;dimensions&nbsp;differ:&nbsp;%v&nbsp;vs&nbsp;%v&#34;</span><span class="op" id="7506293">,</span>&nbsp;<span class="ident" id="7506295">b0</span><span class="op" id="7506297">,</span>&nbsp;<span class="ident" id="7506299">b1</span><span class="op" id="7506301">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7506304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7506307">dx</span>&nbsp;<span class="op" id="7506310">:=</span>&nbsp;<span class="ident" id="7506313">b1</span><span class="op" id="7506315">.</span><span class="ident" id="7506316">Min</span><span class="op" id="7506319">.</span><span class="ident" id="7506320">X</span>&nbsp;<span class="op" id="7506322">-</span>&nbsp;<span class="ident" id="7506324">b0</span><span class="op" id="7506326">.</span><span class="ident" id="7506327">Min</span><span class="op" id="7506330">.</span><span class="ident" id="7506331">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7506334">dy</span>&nbsp;<span class="op" id="7506337">:=</span>&nbsp;<span class="ident" id="7506340">b1</span><span class="op" id="7506342">.</span><span class="ident" id="7506343">Min</span><span class="op" id="7506346">.</span><span class="ident" id="7506347">Y</span>&nbsp;<span class="op" id="7506349">-</span>&nbsp;<span class="ident" id="7506351">b0</span><span class="op" id="7506353">.</span><span class="ident" id="7506354">Min</span><span class="op" id="7506357">.</span><span class="ident" id="7506358">Y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7506361">for</span>&nbsp;<span class="ident" id="7506365">y</span>&nbsp;<span class="op" id="7506367">:=</span>&nbsp;<span class="ident" id="7506370">b0</span><span class="op" id="7506372">.</span><span class="ident" id="7506373">Min</span><span class="op" id="7506376">.</span><span class="ident" id="7506377">Y</span><span class="op" id="7506378">;</span>&nbsp;<span class="ident" id="7506380">y</span>&nbsp;<span class="op" id="7506382">&lt;</span>&nbsp;<span class="ident" id="7506384">b0</span><span class="op" id="7506386">.</span><span class="ident" id="7506387">Max</span><span class="op" id="7506390">.</span><span class="ident" id="7506391">Y</span><span class="op" id="7506392">;</span>&nbsp;<span class="ident" id="7506394">y</span><span class="op" id="7506395">++</span>&nbsp;<span class="op" id="7506398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7506402">for</span>&nbsp;<span class="ident" id="7506406">x</span>&nbsp;<span class="op" id="7506408">:=</span>&nbsp;<span class="ident" id="7506411">b0</span><span class="op" id="7506413">.</span><span class="ident" id="7506414">Min</span><span class="op" id="7506417">.</span><span class="ident" id="7506418">X</span><span class="op" id="7506419">;</span>&nbsp;<span class="ident" id="7506421">x</span>&nbsp;<span class="op" id="7506423">&lt;</span>&nbsp;<span class="ident" id="7506425">b0</span><span class="op" id="7506427">.</span><span class="ident" id="7506428">Max</span><span class="op" id="7506431">.</span><span class="ident" id="7506432">X</span><span class="op" id="7506433">;</span>&nbsp;<span class="ident" id="7506435">x</span><span class="op" id="7506436">++</span>&nbsp;<span class="op" id="7506439">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7506444">c0</span>&nbsp;<span class="op" id="7506447">:=</span>&nbsp;<span class="ident" id="7506450">m0</span><span class="op" id="7506452">.</span><span class="ident" id="7506453">At</span><span class="op" id="7506455">(</span><span class="ident" id="7506456">x</span><span class="op" id="7506457">,</span>&nbsp;<span class="ident" id="7506459">y</span><span class="op" id="7506460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7506465">c1</span>&nbsp;<span class="op" id="7506468">:=</span>&nbsp;<span class="ident" id="7506471">m1</span><span class="op" id="7506473">.</span><span class="ident" id="7506474">At</span><span class="op" id="7506476">(</span><span class="ident" id="7506477">x</span><span class="op" id="7506478">+</span><span class="ident" id="7506479">dx</span><span class="op" id="7506481">,</span>&nbsp;<span class="ident" id="7506483">y</span><span class="op" id="7506484">+</span><span class="ident" id="7506485">dy</span><span class="op" id="7506487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7506492">r0</span><span class="op" id="7506494">,</span>&nbsp;<span class="ident" id="7506496">g0</span><span class="op" id="7506498">,</span>&nbsp;<span class="ident" id="7506500">b0</span><span class="op" id="7506502">,</span>&nbsp;<span class="ident" id="7506504">a0</span>&nbsp;<span class="op" id="7506507">:=</span>&nbsp;<span class="ident" id="7506510">c0</span><span class="op" id="7506512">.</span><span class="ident" id="7506513">RGBA</span><span class="op" id="7506517">(</span><span class="op" id="7506518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7506523">r1</span><span class="op" id="7506525">,</span>&nbsp;<span class="ident" id="7506527">g1</span><span class="op" id="7506529">,</span>&nbsp;<span class="ident" id="7506531">b1</span><span class="op" id="7506533">,</span>&nbsp;<span class="ident" id="7506535">a1</span>&nbsp;<span class="op" id="7506538">:=</span>&nbsp;<span class="ident" id="7506541">c1</span><span class="op" id="7506543">.</span><span class="ident" id="7506544">RGBA</span><span class="op" id="7506548">(</span><span class="op" id="7506549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7506554">if</span>&nbsp;<span class="ident" id="7506557">r0</span>&nbsp;<span class="op" id="7506560">!=</span>&nbsp;<span class="ident" id="7506563">r1</span>&nbsp;<span class="op" id="7506566">||</span>&nbsp;<span class="ident" id="7506569">g0</span>&nbsp;<span class="op" id="7506572">!=</span>&nbsp;<span class="ident" id="7506575">g1</span>&nbsp;<span class="op" id="7506578">||</span>&nbsp;<span class="ident" id="7506581">b0</span>&nbsp;<span class="op" id="7506584">!=</span>&nbsp;<span class="ident" id="7506587">b1</span>&nbsp;<span class="op" id="7506590">||</span>&nbsp;<span class="ident" id="7506593">a0</span>&nbsp;<span class="op" id="7506596">!=</span>&nbsp;<span class="ident" id="7506599">a1</span>&nbsp;<span class="op" id="7506602">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7506608">return</span>&nbsp;<span class="ident" id="7506615">fmt</span><span class="op" id="7506618">.</span><span class="ident" id="7506619">Errorf</span><span class="op" id="7506625">(</span><span class="string" id="7506626">&#34;colors&nbsp;differ&nbsp;at&nbsp;(%d,&nbsp;%d):&nbsp;%v&nbsp;vs&nbsp;%v&#34;</span><span class="op" id="7506663">,</span>&nbsp;<span class="ident" id="7506665">x</span><span class="op" id="7506666">,</span>&nbsp;<span class="ident" id="7506668">y</span><span class="op" id="7506669">,</span>&nbsp;<span class="ident" id="7506671">c0</span><span class="op" id="7506673">,</span>&nbsp;<span class="ident" id="7506675">c1</span><span class="op" id="7506677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7506682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7506686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7506689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7506692">return</span>&nbsp;<span class="ident" id="7506699">nil</span><br>
<span class="lineno">35</span><span class="op" id="7506703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7506706">func</span>&nbsp;<span class="ident" id="7506711">encodeDecode</span><span class="op" id="7506723">(</span><span class="ident" id="7506724">m</span>&nbsp;<span class="ident" id="7506726">image</span><span class="op" id="7506731">.</span><span class="ident" id="7506732">Image</span><span class="op" id="7506737">)</span>&nbsp;<span class="op" id="7506739">(</span><span class="ident" id="7506740">image</span><span class="op" id="7506745">.</span><span class="ident" id="7506746">Image</span><span class="op" id="7506751">,</span>&nbsp;<span class="builtintype" id="7506753">error</span><span class="op" id="7506758">)</span>&nbsp;<span class="op" id="7506760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7506763">var</span>&nbsp;<span class="ident" id="7506767">b</span>&nbsp;<span class="ident" id="7506769">bytes</span><span class="op" id="7506774">.</span><span class="ident" id="7506775">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7506783">err</span>&nbsp;<span class="op" id="7506787">:=</span>&nbsp;<span class="ident" id="7506790">Encode</span><span class="op" id="7506796">(</span><span class="op" id="7506797">&amp;</span><span class="ident" id="7506798">b</span><span class="op" id="7506799">,</span>&nbsp;<span class="ident" id="7506801">m</span><span class="op" id="7506802">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7506805">if</span>&nbsp;<span class="ident" id="7506808">err</span>&nbsp;<span class="op" id="7506812">!=</span>&nbsp;<span class="ident" id="7506815">nil</span>&nbsp;<span class="op" id="7506819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7506823">return</span>&nbsp;<span class="ident" id="7506830">nil</span><span class="op" id="7506833">,</span>&nbsp;<span class="ident" id="7506835">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7506840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7506843">return</span>&nbsp;<span class="ident" id="7506850">Decode</span><span class="op" id="7506856">(</span><span class="op" id="7506857">&amp;</span><span class="ident" id="7506858">b</span><span class="op" id="7506859">)</span><br>
<span class="lineno"></span><span class="op" id="7506861">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7506864">func</span>&nbsp;<span class="ident" id="7506869">TestWriter</span><span class="op" id="7506879">(</span><span class="ident" id="7506880">t</span>&nbsp;<span class="op" id="7506882">*</span><span class="ident" id="7506883">testing</span><span class="op" id="7506890">.</span><span class="ident" id="7506891">T</span><span class="op" id="7506892">)</span>&nbsp;<span class="op" id="7506894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7506897">//&nbsp;The&nbsp;filenames&nbsp;variable&nbsp;is&nbsp;declared&nbsp;in&nbsp;reader_test.go.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7506955">names</span>&nbsp;<span class="op" id="7506961">:=</span>&nbsp;<span class="ident" id="7506964">filenames</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7506975">if</span>&nbsp;<span class="ident" id="7506978">testing</span><span class="op" id="7506985">.</span><span class="ident" id="7506986">Short</span><span class="op" id="7506991">(</span><span class="op" id="7506992">)</span>&nbsp;<span class="op" id="7506994">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7506998">names</span>&nbsp;<span class="op" id="7507004">=</span>&nbsp;<span class="ident" id="7507006">filenamesShort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7507022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7507025">for</span>&nbsp;<span class="ident" id="7507029">_</span><span class="op" id="7507030">,</span>&nbsp;<span class="ident" id="7507032">fn</span>&nbsp;<span class="op" id="7507035">:=</span>&nbsp;<span class="keyword" id="7507038">range</span>&nbsp;<span class="ident" id="7507044">names</span>&nbsp;<span class="op" id="7507050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7507054">qfn</span>&nbsp;<span class="op" id="7507058">:=</span>&nbsp;<span class="string" id="7507061">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="7507082">+</span>&nbsp;<span class="ident" id="7507084">fn</span>&nbsp;<span class="op" id="7507087">+</span>&nbsp;<span class="string" id="7507089">&#34;.png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7507098">//&nbsp;Read&nbsp;the&nbsp;image.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7507119">m0</span><span class="op" id="7507121">,</span>&nbsp;<span class="ident" id="7507123">err</span>&nbsp;<span class="op" id="7507127">:=</span>&nbsp;<span class="ident" id="7507130">readPNG</span><span class="op" id="7507137">(</span><span class="ident" id="7507138">qfn</span><span class="op" id="7507141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7507145">if</span>&nbsp;<span class="ident" id="7507148">err</span>&nbsp;<span class="op" id="7507152">!=</span>&nbsp;<span class="ident" id="7507155">nil</span>&nbsp;<span class="op" id="7507159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7507164">t</span><span class="op" id="7507165">.</span><span class="ident" id="7507166">Error</span><span class="op" id="7507171">(</span><span class="ident" id="7507172">fn</span><span class="op" id="7507174">,</span>&nbsp;<span class="ident" id="7507176">err</span><span class="op" id="7507179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7507184">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7507195">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7507199">//&nbsp;Read&nbsp;the&nbsp;image&nbsp;again,&nbsp;encode&nbsp;it,&nbsp;and&nbsp;decode&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7507252">m1</span><span class="op" id="7507254">,</span>&nbsp;<span class="ident" id="7507256">err</span>&nbsp;<span class="op" id="7507260">:=</span>&nbsp;<span class="ident" id="7507263">readPNG</span><span class="op" id="7507270">(</span><span class="ident" id="7507271">qfn</span><span class="op" id="7507274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7507278">if</span>&nbsp;<span class="ident" id="7507281">err</span>&nbsp;<span class="op" id="7507285">!=</span>&nbsp;<span class="ident" id="7507288">nil</span>&nbsp;<span class="op" id="7507292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7507297">t</span><span class="op" id="7507298">.</span><span class="ident" id="7507299">Error</span><span class="op" id="7507304">(</span><span class="ident" id="7507305">fn</span><span class="op" id="7507307">,</span>&nbsp;<span class="ident" id="7507309">err</span><span class="op" id="7507312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7507317">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7507326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7507330">m2</span><span class="op" id="7507332">,</span>&nbsp;<span class="ident" id="7507334">err</span>&nbsp;<span class="op" id="7507338">:=</span>&nbsp;<span class="ident" id="7507341">encodeDecode</span><span class="op" id="7507353">(</span><span class="ident" id="7507354">m1</span><span class="op" id="7507356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7507360">if</span>&nbsp;<span class="ident" id="7507363">err</span>&nbsp;<span class="op" id="7507367">!=</span>&nbsp;<span class="ident" id="7507370">nil</span>&nbsp;<span class="op" id="7507374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7507379">t</span><span class="op" id="7507380">.</span><span class="ident" id="7507381">Error</span><span class="op" id="7507386">(</span><span class="ident" id="7507387">fn</span><span class="op" id="7507389">,</span>&nbsp;<span class="ident" id="7507391">err</span><span class="op" id="7507394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7507399">return</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7507408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7507412">//&nbsp;Compare&nbsp;the&nbsp;two.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7507434">err</span>&nbsp;<span class="op" id="7507438">=</span>&nbsp;<span class="ident" id="7507440">diff</span><span class="op" id="7507444">(</span><span class="ident" id="7507445">m0</span><span class="op" id="7507447">,</span>&nbsp;<span class="ident" id="7507449">m2</span><span class="op" id="7507451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7507455">if</span>&nbsp;<span class="ident" id="7507458">err</span>&nbsp;<span class="op" id="7507462">!=</span>&nbsp;<span class="ident" id="7507465">nil</span>&nbsp;<span class="op" id="7507469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7507474">t</span><span class="op" id="7507475">.</span><span class="ident" id="7507476">Error</span><span class="op" id="7507481">(</span><span class="ident" id="7507482">fn</span><span class="op" id="7507484">,</span>&nbsp;<span class="ident" id="7507486">err</span><span class="op" id="7507489">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7507494">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7507505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7507508">}</span><br>
<span class="lineno"></span><span class="op" id="7507510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7507513">func</span>&nbsp;<span class="ident" id="7507518">TestWriterLevels</span><span class="op" id="7507534">(</span><span class="ident" id="7507535">t</span>&nbsp;<span class="op" id="7507537">*</span><span class="ident" id="7507538">testing</span><span class="op" id="7507545">.</span><span class="ident" id="7507546">T</span><span class="op" id="7507547">)</span>&nbsp;<span class="op" id="7507549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7507552">m</span>&nbsp;<span class="op" id="7507554">:=</span>&nbsp;<span class="ident" id="7507557">image</span><span class="op" id="7507562">.</span><span class="ident" id="7507563">NewNRGBA</span><span class="op" id="7507571">(</span><span class="ident" id="7507572">image</span><span class="op" id="7507577">.</span><span class="ident" id="7507578">Rect</span><span class="op" id="7507582">(</span><span class="num" id="7507583">0</span><span class="op" id="7507584">,</span>&nbsp;<span class="num" id="7507586">0</span><span class="op" id="7507587">,</span>&nbsp;<span class="num" id="7507589">100</span><span class="op" id="7507592">,</span>&nbsp;<span class="num" id="7507594">100</span><span class="op" id="7507597">)</span><span class="op" id="7507598">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7507602">var</span>&nbsp;<span class="ident" id="7507606">b1</span><span class="op" id="7507608">,</span>&nbsp;<span class="ident" id="7507610">b2</span>&nbsp;<span class="ident" id="7507613">bytes</span><span class="op" id="7507618">.</span><span class="ident" id="7507619">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7507627">if</span>&nbsp;<span class="ident" id="7507630">err</span>&nbsp;<span class="op" id="7507634">:=</span>&nbsp;<span class="op" id="7507637">(</span><span class="op" id="7507638">&amp;</span><span class="ident" id="7507639">Encoder</span><span class="op" id="7507646">{</span><span class="op" id="7507647">}</span><span class="op" id="7507648">)</span><span class="op" id="7507649">.</span><span class="ident" id="7507650">Encode</span><span class="op" id="7507656">(</span><span class="op" id="7507657">&amp;</span><span class="ident" id="7507658">b1</span><span class="op" id="7507660">,</span>&nbsp;<span class="ident" id="7507662">m</span><span class="op" id="7507663">)</span><span class="op" id="7507664">;</span>&nbsp;<span class="ident" id="7507666">err</span>&nbsp;<span class="op" id="7507670">!=</span>&nbsp;<span class="ident" id="7507673">nil</span>&nbsp;<span class="op" id="7507677">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7507681">t</span><span class="op" id="7507682">.</span><span class="ident" id="7507683">Fatal</span><span class="op" id="7507688">(</span><span class="ident" id="7507689">err</span><span class="op" id="7507692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7507695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7507698">noenc</span>&nbsp;<span class="op" id="7507704">:=</span>&nbsp;<span class="op" id="7507707">&amp;</span><span class="ident" id="7507708">Encoder</span><span class="op" id="7507715">{</span><span class="ident" id="7507716">CompressionLevel</span><span class="op" id="7507732">:</span>&nbsp;<span class="ident" id="7507734">NoCompression</span><span class="op" id="7507747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7507750">if</span>&nbsp;<span class="ident" id="7507753">err</span>&nbsp;<span class="op" id="7507757">:=</span>&nbsp;<span class="ident" id="7507760">noenc</span><span class="op" id="7507765">.</span><span class="ident" id="7507766">Encode</span><span class="op" id="7507772">(</span><span class="op" id="7507773">&amp;</span><span class="ident" id="7507774">b2</span><span class="op" id="7507776">,</span>&nbsp;<span class="ident" id="7507778">m</span><span class="op" id="7507779">)</span><span class="op" id="7507780">;</span>&nbsp;<span class="ident" id="7507782">err</span>&nbsp;<span class="op" id="7507786">!=</span>&nbsp;<span class="ident" id="7507789">nil</span>&nbsp;<span class="op" id="7507793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7507797">t</span><span class="op" id="7507798">.</span><span class="ident" id="7507799">Fatal</span><span class="op" id="7507804">(</span><span class="ident" id="7507805">err</span><span class="op" id="7507808">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7507811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7507815">if</span>&nbsp;<span class="ident" id="7507818">b2</span><span class="op" id="7507820">.</span><span class="ident" id="7507821">Len</span><span class="op" id="7507824">(</span><span class="op" id="7507825">)</span>&nbsp;<span class="op" id="7507827">&lt;=</span>&nbsp;<span class="ident" id="7507830">b1</span><span class="op" id="7507832">.</span><span class="ident" id="7507833">Len</span><span class="op" id="7507836">(</span><span class="op" id="7507837">)</span>&nbsp;<span class="op" id="7507839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7507843">t</span><span class="op" id="7507844">.</span><span class="ident" id="7507845">Error</span><span class="op" id="7507850">(</span><span class="string" id="7507851">&#34;DefaultCompression&nbsp;encoding&nbsp;was&nbsp;larger&nbsp;than&nbsp;NoCompression&nbsp;encoding&#34;</span><span class="op" id="7507919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7507922">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7507925">if</span>&nbsp;<span class="ident" id="7507928">_</span><span class="op" id="7507929">,</span>&nbsp;<span class="ident" id="7507931">err</span>&nbsp;<span class="op" id="7507935">:=</span>&nbsp;<span class="ident" id="7507938">Decode</span><span class="op" id="7507944">(</span><span class="op" id="7507945">&amp;</span><span class="ident" id="7507946">b1</span><span class="op" id="7507948">)</span><span class="op" id="7507949">;</span>&nbsp;<span class="ident" id="7507951">err</span>&nbsp;<span class="op" id="7507955">!=</span>&nbsp;<span class="ident" id="7507958">nil</span>&nbsp;<span class="op" id="7507962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7507966">t</span><span class="op" id="7507967">.</span><span class="ident" id="7507968">Error</span><span class="op" id="7507973">(</span><span class="string" id="7507974">&#34;cannot&nbsp;decode&nbsp;DefaultCompression&#34;</span><span class="op" id="7508008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7508011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7508014">if</span>&nbsp;<span class="ident" id="7508017">_</span><span class="op" id="7508018">,</span>&nbsp;<span class="ident" id="7508020">err</span>&nbsp;<span class="op" id="7508024">:=</span>&nbsp;<span class="ident" id="7508027">Decode</span><span class="op" id="7508033">(</span><span class="op" id="7508034">&amp;</span><span class="ident" id="7508035">b2</span><span class="op" id="7508037">)</span><span class="op" id="7508038">;</span>&nbsp;<span class="ident" id="7508040">err</span>&nbsp;<span class="op" id="7508044">!=</span>&nbsp;<span class="ident" id="7508047">nil</span>&nbsp;<span class="op" id="7508051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7508055">t</span><span class="op" id="7508056">.</span><span class="ident" id="7508057">Error</span><span class="op" id="7508062">(</span><span class="string" id="7508063">&#34;cannot&nbsp;decode&nbsp;NoCompression&#34;</span><span class="op" id="7508092">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7508095">}</span><br>
<span class="lineno"></span><span class="op" id="7508097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7508100">func</span>&nbsp;<span class="ident" id="7508105">TestSubImage</span><span class="op" id="7508117">(</span><span class="ident" id="7508118">t</span>&nbsp;<span class="op" id="7508120">*</span><span class="ident" id="7508121">testing</span><span class="op" id="7508128">.</span><span class="ident" id="7508129">T</span><span class="op" id="7508130">)</span>&nbsp;<span class="op" id="7508132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7508135">m0</span>&nbsp;<span class="op" id="7508138">:=</span>&nbsp;<span class="ident" id="7508141">image</span><span class="op" id="7508146">.</span><span class="ident" id="7508147">NewRGBA</span><span class="op" id="7508154">(</span><span class="ident" id="7508155">image</span><span class="op" id="7508160">.</span><span class="ident" id="7508161">Rect</span><span class="op" id="7508165">(</span><span class="num" id="7508166">0</span><span class="op" id="7508167">,</span>&nbsp;<span class="num" id="7508169">0</span><span class="op" id="7508170">,</span>&nbsp;<span class="num" id="7508172">256</span><span class="op" id="7508175">,</span>&nbsp;<span class="num" id="7508177">256</span><span class="op" id="7508180">)</span><span class="op" id="7508181">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7508184">for</span>&nbsp;<span class="ident" id="7508188">y</span>&nbsp;<span class="op" id="7508190">:=</span>&nbsp;<span class="num" id="7508193">0</span><span class="op" id="7508194">;</span>&nbsp;<span class="ident" id="7508196">y</span>&nbsp;<span class="op" id="7508198">&lt;</span>&nbsp;<span class="num" id="7508200">256</span><span class="op" id="7508203">;</span>&nbsp;<span class="ident" id="7508205">y</span><span class="op" id="7508206">++</span>&nbsp;<span class="op" id="7508209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7508213">for</span>&nbsp;<span class="ident" id="7508217">x</span>&nbsp;<span class="op" id="7508219">:=</span>&nbsp;<span class="num" id="7508222">0</span><span class="op" id="7508223">;</span>&nbsp;<span class="ident" id="7508225">x</span>&nbsp;<span class="op" id="7508227">&lt;</span>&nbsp;<span class="num" id="7508229">256</span><span class="op" id="7508232">;</span>&nbsp;<span class="ident" id="7508234">x</span><span class="op" id="7508235">++</span>&nbsp;<span class="op" id="7508238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7508243">m0</span><span class="op" id="7508245">.</span><span class="ident" id="7508246">Set</span><span class="op" id="7508249">(</span><span class="ident" id="7508250">x</span><span class="op" id="7508251">,</span>&nbsp;<span class="ident" id="7508253">y</span><span class="op" id="7508254">,</span>&nbsp;<span class="ident" id="7508256">color</span><span class="op" id="7508261">.</span><span class="ident" id="7508262">RGBA</span><span class="op" id="7508266">{</span><span class="builtintype" id="7508267">uint8</span><span class="op" id="7508272">(</span><span class="ident" id="7508273">x</span><span class="op" id="7508274">)</span><span class="op" id="7508275">,</span>&nbsp;<span class="builtintype" id="7508277">uint8</span><span class="op" id="7508282">(</span><span class="ident" id="7508283">y</span><span class="op" id="7508284">)</span><span class="op" id="7508285">,</span>&nbsp;<span class="num" id="7508287">0</span><span class="op" id="7508288">,</span>&nbsp;<span class="num" id="7508290">255</span><span class="op" id="7508293">}</span><span class="op" id="7508294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7508298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7508301">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7508304">m0</span>&nbsp;<span class="op" id="7508307">=</span>&nbsp;<span class="ident" id="7508309">m0</span><span class="op" id="7508311">.</span><span class="ident" id="7508312">SubImage</span><span class="op" id="7508320">(</span><span class="ident" id="7508321">image</span><span class="op" id="7508326">.</span><span class="ident" id="7508327">Rect</span><span class="op" id="7508331">(</span><span class="num" id="7508332">50</span><span class="op" id="7508334">,</span>&nbsp;<span class="num" id="7508336">30</span><span class="op" id="7508338">,</span>&nbsp;<span class="num" id="7508340">250</span><span class="op" id="7508343">,</span>&nbsp;<span class="num" id="7508345">130</span><span class="op" id="7508348">)</span><span class="op" id="7508349">)</span><span class="op" id="7508350">.</span><span class="op" id="7508351">(</span><span class="op" id="7508352">*</span><span class="ident" id="7508353">image</span><span class="op" id="7508358">.</span><span class="ident" id="7508359">RGBA</span><span class="op" id="7508363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7508366">m1</span><span class="op" id="7508368">,</span>&nbsp;<span class="ident" id="7508370">err</span>&nbsp;<span class="op" id="7508374">:=</span>&nbsp;<span class="ident" id="7508377">encodeDecode</span><span class="op" id="7508389">(</span><span class="ident" id="7508390">m0</span><span class="op" id="7508392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7508395">if</span>&nbsp;<span class="ident" id="7508398">err</span>&nbsp;<span class="op" id="7508402">!=</span>&nbsp;<span class="ident" id="7508405">nil</span>&nbsp;<span class="op" id="7508409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7508413">t</span><span class="op" id="7508414">.</span><span class="ident" id="7508415">Error</span><span class="op" id="7508420">(</span><span class="ident" id="7508421">err</span><span class="op" id="7508424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7508428">return</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7508436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7508439">err</span>&nbsp;<span class="op" id="7508443">=</span>&nbsp;<span class="ident" id="7508445">diff</span><span class="op" id="7508449">(</span><span class="ident" id="7508450">m0</span><span class="op" id="7508452">,</span>&nbsp;<span class="ident" id="7508454">m1</span><span class="op" id="7508456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7508459">if</span>&nbsp;<span class="ident" id="7508462">err</span>&nbsp;<span class="op" id="7508466">!=</span>&nbsp;<span class="ident" id="7508469">nil</span>&nbsp;<span class="op" id="7508473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7508477">t</span><span class="op" id="7508478">.</span><span class="ident" id="7508479">Error</span><span class="op" id="7508484">(</span><span class="ident" id="7508485">err</span><span class="op" id="7508488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7508492">return</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7508500">}</span><br>
<span class="lineno"></span><span class="op" id="7508502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7508505">func</span>&nbsp;<span class="ident" id="7508510">BenchmarkEncodeGray</span><span class="op" id="7508529">(</span><span class="ident" id="7508530">b</span>&nbsp;<span class="op" id="7508532">*</span><span class="ident" id="7508533">testing</span><span class="op" id="7508540">.</span><span class="ident" id="7508541">B</span><span class="op" id="7508542">)</span>&nbsp;<span class="op" id="7508544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7508547">b</span><span class="op" id="7508548">.</span><span class="ident" id="7508549">StopTimer</span><span class="op" id="7508558">(</span><span class="op" id="7508559">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7508562">img</span>&nbsp;<span class="op" id="7508566">:=</span>&nbsp;<span class="ident" id="7508569">image</span><span class="op" id="7508574">.</span><span class="ident" id="7508575">NewGray</span><span class="op" id="7508582">(</span><span class="ident" id="7508583">image</span><span class="op" id="7508588">.</span><span class="ident" id="7508589">Rect</span><span class="op" id="7508593">(</span><span class="num" id="7508594">0</span><span class="op" id="7508595">,</span>&nbsp;<span class="num" id="7508597">0</span><span class="op" id="7508598">,</span>&nbsp;<span class="num" id="7508600">640</span><span class="op" id="7508603">,</span>&nbsp;<span class="num" id="7508605">480</span><span class="op" id="7508608">)</span><span class="op" id="7508609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7508612">b</span><span class="op" id="7508613">.</span><span class="ident" id="7508614">SetBytes</span><span class="op" id="7508622">(</span><span class="num" id="7508623">640</span>&nbsp;<span class="op" id="7508627">*</span>&nbsp;<span class="num" id="7508629">480</span>&nbsp;<span class="op" id="7508633">*</span>&nbsp;<span class="num" id="7508635">1</span><span class="op" id="7508636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7508639">b</span><span class="op" id="7508640">.</span><span class="ident" id="7508641">StartTimer</span><span class="op" id="7508651">(</span><span class="op" id="7508652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7508655">for</span>&nbsp;<span class="ident" id="7508659">i</span>&nbsp;<span class="op" id="7508661">:=</span>&nbsp;<span class="num" id="7508664">0</span><span class="op" id="7508665">;</span>&nbsp;<span class="ident" id="7508667">i</span>&nbsp;<span class="op" id="7508669">&lt;</span>&nbsp;<span class="ident" id="7508671">b</span><span class="op" id="7508672">.</span><span class="ident" id="7508673">N</span><span class="op" id="7508674">;</span>&nbsp;<span class="ident" id="7508676">i</span><span class="op" id="7508677">++</span>&nbsp;<span class="op" id="7508680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7508684">Encode</span><span class="op" id="7508690">(</span><span class="ident" id="7508691">ioutil</span><span class="op" id="7508697">.</span><span class="ident" id="7508698">Discard</span><span class="op" id="7508705">,</span>&nbsp;<span class="ident" id="7508707">img</span><span class="op" id="7508710">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7508713">}</span><br>
<span class="lineno"></span><span class="op" id="7508715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7508718">func</span>&nbsp;<span class="ident" id="7508723">BenchmarkEncodeNRGBOpaque</span><span class="op" id="7508748">(</span><span class="ident" id="7508749">b</span>&nbsp;<span class="op" id="7508751">*</span><span class="ident" id="7508752">testing</span><span class="op" id="7508759">.</span><span class="ident" id="7508760">B</span><span class="op" id="7508761">)</span>&nbsp;<span class="op" id="7508763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7508766">b</span><span class="op" id="7508767">.</span><span class="ident" id="7508768">StopTimer</span><span class="op" id="7508777">(</span><span class="op" id="7508778">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7508781">img</span>&nbsp;<span class="op" id="7508785">:=</span>&nbsp;<span class="ident" id="7508788">image</span><span class="op" id="7508793">.</span><span class="ident" id="7508794">NewNRGBA</span><span class="op" id="7508802">(</span><span class="ident" id="7508803">image</span><span class="op" id="7508808">.</span><span class="ident" id="7508809">Rect</span><span class="op" id="7508813">(</span><span class="num" id="7508814">0</span><span class="op" id="7508815">,</span>&nbsp;<span class="num" id="7508817">0</span><span class="op" id="7508818">,</span>&nbsp;<span class="num" id="7508820">640</span><span class="op" id="7508823">,</span>&nbsp;<span class="num" id="7508825">480</span><span class="op" id="7508828">)</span><span class="op" id="7508829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7508832">//&nbsp;Set&nbsp;all&nbsp;pixels&nbsp;to&nbsp;0xFF&nbsp;alpha&nbsp;to&nbsp;force&nbsp;opaque&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7508887">bo</span>&nbsp;<span class="op" id="7508890">:=</span>&nbsp;<span class="ident" id="7508893">img</span><span class="op" id="7508896">.</span><span class="ident" id="7508897">Bounds</span><span class="op" id="7508903">(</span><span class="op" id="7508904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7508907">for</span>&nbsp;<span class="ident" id="7508911">y</span>&nbsp;<span class="op" id="7508913">:=</span>&nbsp;<span class="ident" id="7508916">bo</span><span class="op" id="7508918">.</span><span class="ident" id="7508919">Min</span><span class="op" id="7508922">.</span><span class="ident" id="7508923">Y</span><span class="op" id="7508924">;</span>&nbsp;<span class="ident" id="7508926">y</span>&nbsp;<span class="op" id="7508928">&lt;</span>&nbsp;<span class="ident" id="7508930">bo</span><span class="op" id="7508932">.</span><span class="ident" id="7508933">Max</span><span class="op" id="7508936">.</span><span class="ident" id="7508937">Y</span><span class="op" id="7508938">;</span>&nbsp;<span class="ident" id="7508940">y</span><span class="op" id="7508941">++</span>&nbsp;<span class="op" id="7508944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7508948">for</span>&nbsp;<span class="ident" id="7508952">x</span>&nbsp;<span class="op" id="7508954">:=</span>&nbsp;<span class="ident" id="7508957">bo</span><span class="op" id="7508959">.</span><span class="ident" id="7508960">Min</span><span class="op" id="7508963">.</span><span class="ident" id="7508964">X</span><span class="op" id="7508965">;</span>&nbsp;<span class="ident" id="7508967">x</span>&nbsp;<span class="op" id="7508969">&lt;</span>&nbsp;<span class="ident" id="7508971">bo</span><span class="op" id="7508973">.</span><span class="ident" id="7508974">Max</span><span class="op" id="7508977">.</span><span class="ident" id="7508978">X</span><span class="op" id="7508979">;</span>&nbsp;<span class="ident" id="7508981">x</span><span class="op" id="7508982">++</span>&nbsp;<span class="op" id="7508985">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7508990">img</span><span class="op" id="7508993">.</span><span class="ident" id="7508994">Set</span><span class="op" id="7508997">(</span><span class="ident" id="7508998">x</span><span class="op" id="7508999">,</span>&nbsp;<span class="ident" id="7509001">y</span><span class="op" id="7509002">,</span>&nbsp;<span class="ident" id="7509004">color</span><span class="op" id="7509009">.</span><span class="ident" id="7509010">NRGBA</span><span class="op" id="7509015">{</span><span class="num" id="7509016">0</span><span class="op" id="7509017">,</span>&nbsp;<span class="num" id="7509019">0</span><span class="op" id="7509020">,</span>&nbsp;<span class="num" id="7509022">0</span><span class="op" id="7509023">,</span>&nbsp;<span class="num" id="7509025">255</span><span class="op" id="7509028">}</span><span class="op" id="7509029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7509033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7509036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7509039">if</span>&nbsp;<span class="op" id="7509042">!</span><span class="ident" id="7509043">img</span><span class="op" id="7509046">.</span><span class="ident" id="7509047">Opaque</span><span class="op" id="7509053">(</span><span class="op" id="7509054">)</span>&nbsp;<span class="op" id="7509056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509060">b</span><span class="op" id="7509061">.</span><span class="ident" id="7509062">Fatal</span><span class="op" id="7509067">(</span><span class="string" id="7509068">&#34;expected&nbsp;image&nbsp;to&nbsp;be&nbsp;opaque&#34;</span><span class="op" id="7509097">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7509100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509103">b</span><span class="op" id="7509104">.</span><span class="ident" id="7509105">SetBytes</span><span class="op" id="7509113">(</span><span class="num" id="7509114">640</span>&nbsp;<span class="op" id="7509118">*</span>&nbsp;<span class="num" id="7509120">480</span>&nbsp;<span class="op" id="7509124">*</span>&nbsp;<span class="num" id="7509126">4</span><span class="op" id="7509127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509130">b</span><span class="op" id="7509131">.</span><span class="ident" id="7509132">StartTimer</span><span class="op" id="7509142">(</span><span class="op" id="7509143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7509146">for</span>&nbsp;<span class="ident" id="7509150">i</span>&nbsp;<span class="op" id="7509152">:=</span>&nbsp;<span class="num" id="7509155">0</span><span class="op" id="7509156">;</span>&nbsp;<span class="ident" id="7509158">i</span>&nbsp;<span class="op" id="7509160">&lt;</span>&nbsp;<span class="ident" id="7509162">b</span><span class="op" id="7509163">.</span><span class="ident" id="7509164">N</span><span class="op" id="7509165">;</span>&nbsp;<span class="ident" id="7509167">i</span><span class="op" id="7509168">++</span>&nbsp;<span class="op" id="7509171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509175">Encode</span><span class="op" id="7509181">(</span><span class="ident" id="7509182">ioutil</span><span class="op" id="7509188">.</span><span class="ident" id="7509189">Discard</span><span class="op" id="7509196">,</span>&nbsp;<span class="ident" id="7509198">img</span><span class="op" id="7509201">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7509204">}</span><br>
<span class="lineno"></span><span class="op" id="7509206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7509209">func</span>&nbsp;<span class="ident" id="7509214">BenchmarkEncodeNRGBA</span><span class="op" id="7509234">(</span><span class="ident" id="7509235">b</span>&nbsp;<span class="op" id="7509237">*</span><span class="ident" id="7509238">testing</span><span class="op" id="7509245">.</span><span class="ident" id="7509246">B</span><span class="op" id="7509247">)</span>&nbsp;<span class="op" id="7509249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509252">b</span><span class="op" id="7509253">.</span><span class="ident" id="7509254">StopTimer</span><span class="op" id="7509263">(</span><span class="op" id="7509264">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509267">img</span>&nbsp;<span class="op" id="7509271">:=</span>&nbsp;<span class="ident" id="7509274">image</span><span class="op" id="7509279">.</span><span class="ident" id="7509280">NewNRGBA</span><span class="op" id="7509288">(</span><span class="ident" id="7509289">image</span><span class="op" id="7509294">.</span><span class="ident" id="7509295">Rect</span><span class="op" id="7509299">(</span><span class="num" id="7509300">0</span><span class="op" id="7509301">,</span>&nbsp;<span class="num" id="7509303">0</span><span class="op" id="7509304">,</span>&nbsp;<span class="num" id="7509306">640</span><span class="op" id="7509309">,</span>&nbsp;<span class="num" id="7509311">480</span><span class="op" id="7509314">)</span><span class="op" id="7509315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7509318">if</span>&nbsp;<span class="ident" id="7509321">img</span><span class="op" id="7509324">.</span><span class="ident" id="7509325">Opaque</span><span class="op" id="7509331">(</span><span class="op" id="7509332">)</span>&nbsp;<span class="op" id="7509334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509338">b</span><span class="op" id="7509339">.</span><span class="ident" id="7509340">Fatal</span><span class="op" id="7509345">(</span><span class="string" id="7509346">&#34;expected&nbsp;image&nbsp;not&nbsp;to&nbsp;be&nbsp;opaque&#34;</span><span class="op" id="7509379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7509382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509385">b</span><span class="op" id="7509386">.</span><span class="ident" id="7509387">SetBytes</span><span class="op" id="7509395">(</span><span class="num" id="7509396">640</span>&nbsp;<span class="op" id="7509400">*</span>&nbsp;<span class="num" id="7509402">480</span>&nbsp;<span class="op" id="7509406">*</span>&nbsp;<span class="num" id="7509408">4</span><span class="op" id="7509409">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509412">b</span><span class="op" id="7509413">.</span><span class="ident" id="7509414">StartTimer</span><span class="op" id="7509424">(</span><span class="op" id="7509425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7509428">for</span>&nbsp;<span class="ident" id="7509432">i</span>&nbsp;<span class="op" id="7509434">:=</span>&nbsp;<span class="num" id="7509437">0</span><span class="op" id="7509438">;</span>&nbsp;<span class="ident" id="7509440">i</span>&nbsp;<span class="op" id="7509442">&lt;</span>&nbsp;<span class="ident" id="7509444">b</span><span class="op" id="7509445">.</span><span class="ident" id="7509446">N</span><span class="op" id="7509447">;</span>&nbsp;<span class="ident" id="7509449">i</span><span class="op" id="7509450">++</span>&nbsp;<span class="op" id="7509453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509457">Encode</span><span class="op" id="7509463">(</span><span class="ident" id="7509464">ioutil</span><span class="op" id="7509470">.</span><span class="ident" id="7509471">Discard</span><span class="op" id="7509478">,</span>&nbsp;<span class="ident" id="7509480">img</span><span class="op" id="7509483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7509486">}</span><br>
<span class="lineno"></span><span class="op" id="7509488">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="7509491">func</span>&nbsp;<span class="ident" id="7509496">BenchmarkEncodePaletted</span><span class="op" id="7509519">(</span><span class="ident" id="7509520">b</span>&nbsp;<span class="op" id="7509522">*</span><span class="ident" id="7509523">testing</span><span class="op" id="7509530">.</span><span class="ident" id="7509531">B</span><span class="op" id="7509532">)</span>&nbsp;<span class="op" id="7509534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509537">b</span><span class="op" id="7509538">.</span><span class="ident" id="7509539">StopTimer</span><span class="op" id="7509548">(</span><span class="op" id="7509549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509552">img</span>&nbsp;<span class="op" id="7509556">:=</span>&nbsp;<span class="ident" id="7509559">image</span><span class="op" id="7509564">.</span><span class="ident" id="7509565">NewPaletted</span><span class="op" id="7509576">(</span><span class="ident" id="7509577">image</span><span class="op" id="7509582">.</span><span class="ident" id="7509583">Rect</span><span class="op" id="7509587">(</span><span class="num" id="7509588">0</span><span class="op" id="7509589">,</span>&nbsp;<span class="num" id="7509591">0</span><span class="op" id="7509592">,</span>&nbsp;<span class="num" id="7509594">640</span><span class="op" id="7509597">,</span>&nbsp;<span class="num" id="7509599">480</span><span class="op" id="7509602">)</span><span class="op" id="7509603">,</span>&nbsp;<span class="ident" id="7509605">color</span><span class="op" id="7509610">.</span><span class="ident" id="7509611">Palette</span><span class="op" id="7509618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509622">color</span><span class="op" id="7509627">.</span><span class="ident" id="7509628">RGBA</span><span class="op" id="7509632">{</span><span class="num" id="7509633">0</span><span class="op" id="7509634">,</span>&nbsp;<span class="num" id="7509636">0</span><span class="op" id="7509637">,</span>&nbsp;<span class="num" id="7509639">0</span><span class="op" id="7509640">,</span>&nbsp;<span class="num" id="7509642">255</span><span class="op" id="7509645">}</span><span class="op" id="7509646">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509650">color</span><span class="op" id="7509655">.</span><span class="ident" id="7509656">RGBA</span><span class="op" id="7509660">{</span><span class="num" id="7509661">255</span><span class="op" id="7509664">,</span>&nbsp;<span class="num" id="7509666">255</span><span class="op" id="7509669">,</span>&nbsp;<span class="num" id="7509671">255</span><span class="op" id="7509674">,</span>&nbsp;<span class="num" id="7509676">255</span><span class="op" id="7509679">}</span><span class="op" id="7509680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7509683">}</span><span class="op" id="7509684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509687">b</span><span class="op" id="7509688">.</span><span class="ident" id="7509689">SetBytes</span><span class="op" id="7509697">(</span><span class="num" id="7509698">640</span>&nbsp;<span class="op" id="7509702">*</span>&nbsp;<span class="num" id="7509704">480</span>&nbsp;<span class="op" id="7509708">*</span>&nbsp;<span class="num" id="7509710">1</span><span class="op" id="7509711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509714">b</span><span class="op" id="7509715">.</span><span class="ident" id="7509716">StartTimer</span><span class="op" id="7509726">(</span><span class="op" id="7509727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7509730">for</span>&nbsp;<span class="ident" id="7509734">i</span>&nbsp;<span class="op" id="7509736">:=</span>&nbsp;<span class="num" id="7509739">0</span><span class="op" id="7509740">;</span>&nbsp;<span class="ident" id="7509742">i</span>&nbsp;<span class="op" id="7509744">&lt;</span>&nbsp;<span class="ident" id="7509746">b</span><span class="op" id="7509747">.</span><span class="ident" id="7509748">N</span><span class="op" id="7509749">;</span>&nbsp;<span class="ident" id="7509751">i</span><span class="op" id="7509752">++</span>&nbsp;<span class="op" id="7509755">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509759">Encode</span><span class="op" id="7509765">(</span><span class="ident" id="7509766">ioutil</span><span class="op" id="7509772">.</span><span class="ident" id="7509773">Discard</span><span class="op" id="7509780">,</span>&nbsp;<span class="ident" id="7509782">img</span><span class="op" id="7509785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7509788">}</span><br>
<span class="lineno"></span><span class="op" id="7509790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7509793">func</span>&nbsp;<span class="ident" id="7509798">BenchmarkEncodeRGBOpaque</span><span class="op" id="7509822">(</span><span class="ident" id="7509823">b</span>&nbsp;<span class="op" id="7509825">*</span><span class="ident" id="7509826">testing</span><span class="op" id="7509833">.</span><span class="ident" id="7509834">B</span><span class="op" id="7509835">)</span>&nbsp;<span class="op" id="7509837">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509840">b</span><span class="op" id="7509841">.</span><span class="ident" id="7509842">StopTimer</span><span class="op" id="7509851">(</span><span class="op" id="7509852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509855">img</span>&nbsp;<span class="op" id="7509859">:=</span>&nbsp;<span class="ident" id="7509862">image</span><span class="op" id="7509867">.</span><span class="ident" id="7509868">NewRGBA</span><span class="op" id="7509875">(</span><span class="ident" id="7509876">image</span><span class="op" id="7509881">.</span><span class="ident" id="7509882">Rect</span><span class="op" id="7509886">(</span><span class="num" id="7509887">0</span><span class="op" id="7509888">,</span>&nbsp;<span class="num" id="7509890">0</span><span class="op" id="7509891">,</span>&nbsp;<span class="num" id="7509893">640</span><span class="op" id="7509896">,</span>&nbsp;<span class="num" id="7509898">480</span><span class="op" id="7509901">)</span><span class="op" id="7509902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7509905">//&nbsp;Set&nbsp;all&nbsp;pixels&nbsp;to&nbsp;0xFF&nbsp;alpha&nbsp;to&nbsp;force&nbsp;opaque&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7509960">bo</span>&nbsp;<span class="op" id="7509963">:=</span>&nbsp;<span class="ident" id="7509966">img</span><span class="op" id="7509969">.</span><span class="ident" id="7509970">Bounds</span><span class="op" id="7509976">(</span><span class="op" id="7509977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7509980">for</span>&nbsp;<span class="ident" id="7509984">y</span>&nbsp;<span class="op" id="7509986">:=</span>&nbsp;<span class="ident" id="7509989">bo</span><span class="op" id="7509991">.</span><span class="ident" id="7509992">Min</span><span class="op" id="7509995">.</span><span class="ident" id="7509996">Y</span><span class="op" id="7509997">;</span>&nbsp;<span class="ident" id="7509999">y</span>&nbsp;<span class="op" id="7510001">&lt;</span>&nbsp;<span class="ident" id="7510003">bo</span><span class="op" id="7510005">.</span><span class="ident" id="7510006">Max</span><span class="op" id="7510009">.</span><span class="ident" id="7510010">Y</span><span class="op" id="7510011">;</span>&nbsp;<span class="ident" id="7510013">y</span><span class="op" id="7510014">++</span>&nbsp;<span class="op" id="7510017">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7510021">for</span>&nbsp;<span class="ident" id="7510025">x</span>&nbsp;<span class="op" id="7510027">:=</span>&nbsp;<span class="ident" id="7510030">bo</span><span class="op" id="7510032">.</span><span class="ident" id="7510033">Min</span><span class="op" id="7510036">.</span><span class="ident" id="7510037">X</span><span class="op" id="7510038">;</span>&nbsp;<span class="ident" id="7510040">x</span>&nbsp;<span class="op" id="7510042">&lt;</span>&nbsp;<span class="ident" id="7510044">bo</span><span class="op" id="7510046">.</span><span class="ident" id="7510047">Max</span><span class="op" id="7510050">.</span><span class="ident" id="7510051">X</span><span class="op" id="7510052">;</span>&nbsp;<span class="ident" id="7510054">x</span><span class="op" id="7510055">++</span>&nbsp;<span class="op" id="7510058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7510063">img</span><span class="op" id="7510066">.</span><span class="ident" id="7510067">Set</span><span class="op" id="7510070">(</span><span class="ident" id="7510071">x</span><span class="op" id="7510072">,</span>&nbsp;<span class="ident" id="7510074">y</span><span class="op" id="7510075">,</span>&nbsp;<span class="ident" id="7510077">color</span><span class="op" id="7510082">.</span><span class="ident" id="7510083">RGBA</span><span class="op" id="7510087">{</span><span class="num" id="7510088">0</span><span class="op" id="7510089">,</span>&nbsp;<span class="num" id="7510091">0</span><span class="op" id="7510092">,</span>&nbsp;<span class="num" id="7510094">0</span><span class="op" id="7510095">,</span>&nbsp;<span class="num" id="7510097">255</span><span class="op" id="7510100">}</span><span class="op" id="7510101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7510105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7510108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7510111">if</span>&nbsp;<span class="op" id="7510114">!</span><span class="ident" id="7510115">img</span><span class="op" id="7510118">.</span><span class="ident" id="7510119">Opaque</span><span class="op" id="7510125">(</span><span class="op" id="7510126">)</span>&nbsp;<span class="op" id="7510128">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7510132">b</span><span class="op" id="7510133">.</span><span class="ident" id="7510134">Fatal</span><span class="op" id="7510139">(</span><span class="string" id="7510140">&#34;expected&nbsp;image&nbsp;to&nbsp;be&nbsp;opaque&#34;</span><span class="op" id="7510169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7510172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7510175">b</span><span class="op" id="7510176">.</span><span class="ident" id="7510177">SetBytes</span><span class="op" id="7510185">(</span><span class="num" id="7510186">640</span>&nbsp;<span class="op" id="7510190">*</span>&nbsp;<span class="num" id="7510192">480</span>&nbsp;<span class="op" id="7510196">*</span>&nbsp;<span class="num" id="7510198">4</span><span class="op" id="7510199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7510202">b</span><span class="op" id="7510203">.</span><span class="ident" id="7510204">StartTimer</span><span class="op" id="7510214">(</span><span class="op" id="7510215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7510218">for</span>&nbsp;<span class="ident" id="7510222">i</span>&nbsp;<span class="op" id="7510224">:=</span>&nbsp;<span class="num" id="7510227">0</span><span class="op" id="7510228">;</span>&nbsp;<span class="ident" id="7510230">i</span>&nbsp;<span class="op" id="7510232">&lt;</span>&nbsp;<span class="ident" id="7510234">b</span><span class="op" id="7510235">.</span><span class="ident" id="7510236">N</span><span class="op" id="7510237">;</span>&nbsp;<span class="ident" id="7510239">i</span><span class="op" id="7510240">++</span>&nbsp;<span class="op" id="7510243">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7510247">Encode</span><span class="op" id="7510253">(</span><span class="ident" id="7510254">ioutil</span><span class="op" id="7510260">.</span><span class="ident" id="7510261">Discard</span><span class="op" id="7510268">,</span>&nbsp;<span class="ident" id="7510270">img</span><span class="op" id="7510273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7510276">}</span><br>
<span class="lineno"></span><span class="op" id="7510278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7510281">func</span>&nbsp;<span class="ident" id="7510286">BenchmarkEncodeRGBA</span><span class="op" id="7510305">(</span><span class="ident" id="7510306">b</span>&nbsp;<span class="op" id="7510308">*</span><span class="ident" id="7510309">testing</span><span class="op" id="7510316">.</span><span class="ident" id="7510317">B</span><span class="op" id="7510318">)</span>&nbsp;<span class="op" id="7510320">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7510323">b</span><span class="op" id="7510324">.</span><span class="ident" id="7510325">StopTimer</span><span class="op" id="7510334">(</span><span class="op" id="7510335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7510338">img</span>&nbsp;<span class="op" id="7510342">:=</span>&nbsp;<span class="ident" id="7510345">image</span><span class="op" id="7510350">.</span><span class="ident" id="7510351">NewRGBA</span><span class="op" id="7510358">(</span><span class="ident" id="7510359">image</span><span class="op" id="7510364">.</span><span class="ident" id="7510365">Rect</span><span class="op" id="7510369">(</span><span class="num" id="7510370">0</span><span class="op" id="7510371">,</span>&nbsp;<span class="num" id="7510373">0</span><span class="op" id="7510374">,</span>&nbsp;<span class="num" id="7510376">640</span><span class="op" id="7510379">,</span>&nbsp;<span class="num" id="7510381">480</span><span class="op" id="7510384">)</span><span class="op" id="7510385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7510388">if</span>&nbsp;<span class="ident" id="7510391">img</span><span class="op" id="7510394">.</span><span class="ident" id="7510395">Opaque</span><span class="op" id="7510401">(</span><span class="op" id="7510402">)</span>&nbsp;<span class="op" id="7510404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7510408">b</span><span class="op" id="7510409">.</span><span class="ident" id="7510410">Fatal</span><span class="op" id="7510415">(</span><span class="string" id="7510416">&#34;expected&nbsp;image&nbsp;not&nbsp;to&nbsp;be&nbsp;opaque&#34;</span><span class="op" id="7510449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7510452">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7510455">b</span><span class="op" id="7510456">.</span><span class="ident" id="7510457">SetBytes</span><span class="op" id="7510465">(</span><span class="num" id="7510466">640</span>&nbsp;<span class="op" id="7510470">*</span>&nbsp;<span class="num" id="7510472">480</span>&nbsp;<span class="op" id="7510476">*</span>&nbsp;<span class="num" id="7510478">4</span><span class="op" id="7510479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7510482">b</span><span class="op" id="7510483">.</span><span class="ident" id="7510484">StartTimer</span><span class="op" id="7510494">(</span><span class="op" id="7510495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7510498">for</span>&nbsp;<span class="ident" id="7510502">i</span>&nbsp;<span class="op" id="7510504">:=</span>&nbsp;<span class="num" id="7510507">0</span><span class="op" id="7510508">;</span>&nbsp;<span class="ident" id="7510510">i</span>&nbsp;<span class="op" id="7510512">&lt;</span>&nbsp;<span class="ident" id="7510514">b</span><span class="op" id="7510515">.</span><span class="ident" id="7510516">N</span><span class="op" id="7510517">;</span>&nbsp;<span class="ident" id="7510519">i</span><span class="op" id="7510520">++</span>&nbsp;<span class="op" id="7510523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7510527">Encode</span><span class="op" id="7510533">(</span><span class="ident" id="7510534">ioutil</span><span class="op" id="7510540">.</span><span class="ident" id="7510541">Discard</span><span class="op" id="7510548">,</span>&nbsp;<span class="ident" id="7510550">img</span><span class="op" id="7510553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7510556">}</span><br>
<span class="lineno">210</span><span class="op" id="7510558">}</span>
</div>
</body>
</html>
