<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword">package</span>&nbsp;<span class="ident">strconv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;An&nbsp;extFloat&nbsp;represents&nbsp;an&nbsp;extended&nbsp;floating-point&nbsp;number,&nbsp;with&nbsp;more</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;precision&nbsp;than&nbsp;a&nbsp;float64.&nbsp;It&nbsp;does&nbsp;not&nbsp;try&nbsp;to&nbsp;save&nbsp;bits:&nbsp;the</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;number&nbsp;represented&nbsp;by&nbsp;the&nbsp;structure&nbsp;is&nbsp;mant*(2^exp),&nbsp;with&nbsp;a&nbsp;negative</span><br>
<span class="lineno">10</span><span class="comment">//&nbsp;sign&nbsp;if&nbsp;neg&nbsp;is&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">extFloat</span>&nbsp;<span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="ident">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;&nbsp;<span class="builtintype">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">neg</span>&nbsp;&nbsp;<span class="builtintype">bool</span><br>
<span class="lineno">15</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Powers&nbsp;of&nbsp;ten&nbsp;taken&nbsp;from&nbsp;double-conversion&nbsp;library.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;http://code.google.com/p/double-conversion/</span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="op">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">firstPowerOfTen</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="num">348</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">stepPowerOfTen</span>&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">8</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">smallPowersOfTen</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="op">...</span><span class="op">]</span><span class="ident">extFloat</span><span class="op">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">63</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">63</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xa</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">60</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">60</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;1e1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x64</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">57</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">57</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;1e2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x3e8</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">54</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">54</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;1e3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x2710</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">50</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">50</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;1e4</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x186a0</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">47</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">47</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;1e5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xf4240</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">44</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">44</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;1e6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x989680</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">40</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">40</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;<span class="comment">//&nbsp;1e7</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword">var</span>&nbsp;<span class="ident">powersOfTen</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="op">...</span><span class="op">]</span><span class="ident">extFloat</span><span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xfa8fd5a0081c0288</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">1220</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;<span class="comment">//&nbsp;10^-348</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xbaaee17fa23ebf76</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">1193</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;<span class="comment">//&nbsp;10^-340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x8b16fb203055ac76</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">1166</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;<span class="comment">//&nbsp;10^-332</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xcf42894a5dce35ea</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">1140</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;<span class="comment">//&nbsp;10^-324</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x9a6bb0aa55653b2d</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">1113</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;<span class="comment">//&nbsp;10^-316</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xe61acf033d1a45df</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">1087</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;<span class="comment">//&nbsp;10^-308</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xab70fe17c79ac6ca</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">1060</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;<span class="comment">//&nbsp;10^-300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xff77b1fcbebcdc4f</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">1034</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;<span class="comment">//&nbsp;10^-292</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xbe5691ef416bd60c</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">1007</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;<span class="comment">//&nbsp;10^-284</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x8dd01fad907ffc3c</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">980</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-276</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xd3515c2831559a83</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">954</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-268</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x9d71ac8fada6c9b5</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">927</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xea9c227723ee8bcb</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">901</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-252</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xaecc49914078536d</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">874</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-244</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x823c12795db6ce57</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">847</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-236</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xc21094364dfb5637</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">821</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-228</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x9096ea6f3848984f</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">794</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xd77485cb25823ac7</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">768</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-212</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xa086cfcd97bf97f4</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">741</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-204</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xef340a98172aace5</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">715</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-196</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xb23867fb2a35b28e</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">688</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-188</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x84c8d4dfd2c63f3b</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">661</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xc5dd44271ad3cdba</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">635</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-172</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x936b9fcebb25c996</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">608</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-164</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xdbac6c247d62a584</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">582</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-156</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xa3ab66580d5fdaf6</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">555</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-148</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xf3e2f893dec3f126</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">529</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xb5b5ada8aaff80b8</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">502</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-132</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x87625f056c7c4a8b</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">475</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-124</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xc9bcff6034c13053</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">449</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-116</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x964e858c91ba2655</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">422</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-108</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xdff9772470297ebd</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">396</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xa6dfbd9fb8e5b88f</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">369</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-92</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xf8a95fcf88747d94</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">343</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-84</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xb94470938fa89bcf</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">316</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-76</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x8a08f0f8bf0f156b</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">289</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-68</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xcdb02555653131b6</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">263</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x993fe2c6d07b7fac</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">236</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xe45c10c42a2b3b06</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">210</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-44</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xaa242499697392d3</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">183</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-36</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xfd87b5f28300ca0e</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">157</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xbce5086492111aeb</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">130</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x8cbccc096f5088cc</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">103</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^-12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xd1b71758e219652c</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">77</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^-4</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x9c40000000000000</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">50</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xe8d4a51000000000</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">24</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xad78ebc5ac620000</span><span class="op">,</span>&nbsp;<span class="num">3</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x813f3978f8940984</span><span class="op">,</span>&nbsp;<span class="num">30</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xc097ce7bc90715b3</span><span class="op">,</span>&nbsp;<span class="num">56</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^36</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x8f7e32ce7bea5c70</span><span class="op">,</span>&nbsp;<span class="num">83</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^44</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xd5d238a4abe98068</span><span class="op">,</span>&nbsp;<span class="num">109</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x9f4f2726179a2245</span><span class="op">,</span>&nbsp;<span class="num">136</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xed63a231d4c4fb27</span><span class="op">,</span>&nbsp;<span class="num">162</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^68</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xb0de65388cc8ada8</span><span class="op">,</span>&nbsp;<span class="num">189</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^76</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x83c7088e1aab65db</span><span class="op">,</span>&nbsp;<span class="num">216</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^84</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xc45d1df942711d9a</span><span class="op">,</span>&nbsp;<span class="num">242</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^92</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x924d692ca61be758</span><span class="op">,</span>&nbsp;<span class="num">269</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xda01ee641a708dea</span><span class="op">,</span>&nbsp;<span class="num">295</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^108</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xa26da3999aef774a</span><span class="op">,</span>&nbsp;<span class="num">322</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^116</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xf209787bb47d6b85</span><span class="op">,</span>&nbsp;<span class="num">348</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^124</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xb454e4a179dd1877</span><span class="op">,</span>&nbsp;<span class="num">375</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^132</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x865b86925b9bc5c2</span><span class="op">,</span>&nbsp;<span class="num">402</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xc83553c5c8965d3d</span><span class="op">,</span>&nbsp;<span class="num">428</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^148</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x952ab45cfa97a0b3</span><span class="op">,</span>&nbsp;<span class="num">455</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^156</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xde469fbd99a05fe3</span><span class="op">,</span>&nbsp;<span class="num">481</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^164</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xa59bc234db398c25</span><span class="op">,</span>&nbsp;<span class="num">508</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^172</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xf6c69a72a3989f5c</span><span class="op">,</span>&nbsp;<span class="num">534</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xb7dcbf5354e9bece</span><span class="op">,</span>&nbsp;<span class="num">561</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^188</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x88fcf317f22241e2</span><span class="op">,</span>&nbsp;<span class="num">588</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^196</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xcc20ce9bd35c78a5</span><span class="op">,</span>&nbsp;<span class="num">614</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^204</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x98165af37b2153df</span><span class="op">,</span>&nbsp;<span class="num">641</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^212</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xe2a0b5dc971f303a</span><span class="op">,</span>&nbsp;<span class="num">667</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xa8d9d1535ce3b396</span><span class="op">,</span>&nbsp;<span class="num">694</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^228</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xfb9b7cd9a4a7443c</span><span class="op">,</span>&nbsp;<span class="num">720</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^236</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xbb764c4ca7a44410</span><span class="op">,</span>&nbsp;<span class="num">747</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^244</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x8bab8eefb6409c1a</span><span class="op">,</span>&nbsp;<span class="num">774</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^252</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xd01fef10a657842c</span><span class="op">,</span>&nbsp;<span class="num">800</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x9b10a4e5e9913129</span><span class="op">,</span>&nbsp;<span class="num">827</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^268</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xe7109bfba19c0c9d</span><span class="op">,</span>&nbsp;<span class="num">853</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^276</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xac2820d9623bf429</span><span class="op">,</span>&nbsp;<span class="num">880</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^284</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x80444b5e7aa7cf85</span><span class="op">,</span>&nbsp;<span class="num">907</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^292</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xbf21e44003acdd2d</span><span class="op">,</span>&nbsp;<span class="num">933</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x8e679c2f5e44ff8f</span><span class="op">,</span>&nbsp;<span class="num">960</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^308</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xd433179d9c8cb841</span><span class="op">,</span>&nbsp;<span class="num">986</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;10^316</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0x9e19db92b4e31ba9</span><span class="op">,</span>&nbsp;<span class="num">1013</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^324</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xeb96bf6ebadf77d9</span><span class="op">,</span>&nbsp;<span class="num">1039</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^332</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="num">0xaf87023b9bf0ee6b</span><span class="op">,</span>&nbsp;<span class="num">1066</span><span class="op">,</span>&nbsp;<span class="ident">false</span><span class="op">}</span><span class="op">,</span>&nbsp;&nbsp;<span class="comment">//&nbsp;10^340</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment">//&nbsp;floatBits&nbsp;returns&nbsp;the&nbsp;bits&nbsp;of&nbsp;the&nbsp;float64&nbsp;that&nbsp;best&nbsp;approximates</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;the&nbsp;extFloat&nbsp;passed&nbsp;as&nbsp;receiver.&nbsp;Overflow&nbsp;is&nbsp;set&nbsp;to&nbsp;true&nbsp;if</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;the&nbsp;resulting&nbsp;float64&nbsp;is&nbsp;±Inf.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">extFloat</span><span class="op">)</span>&nbsp;<span class="ident">floatBits</span><span class="op">(</span><span class="ident">flt</span>&nbsp;<span class="op">*</span><span class="ident">floatInfo</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">bits</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">overflow</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">Normalize</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">63</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Exponent&nbsp;too&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">flt</span><span class="op">.</span><span class="ident">bias</span><span class="op">+</span><span class="num">1</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">flt</span><span class="op">.</span><span class="ident">bias</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="builtintype">uint</span><span class="op">(</span><span class="ident">n</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Extract&nbsp;1+flt.mantbits&nbsp;bits&nbsp;from&nbsp;the&nbsp;64-bit&nbsp;mantissa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="op">(</span><span class="num">63</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">flt</span><span class="op">.</span><span class="ident">mantbits</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span><span class="op">&amp;</span><span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="op">(</span><span class="num">62</span><span class="op">-</span><span class="ident">flt</span><span class="op">.</span><span class="ident">mantbits</span><span class="op">)</span><span class="op">)</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Round&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Rounding&nbsp;might&nbsp;have&nbsp;added&nbsp;a&nbsp;bit;&nbsp;shift&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">2</span><span class="op">&lt;&lt;</span><span class="ident">flt</span><span class="op">.</span><span class="ident">mantbits</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Infinities.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">exp</span><span class="op">-</span><span class="ident">flt</span><span class="op">.</span><span class="ident">bias</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">flt</span><span class="op">.</span><span class="ident">expbits</span><span class="op">-</span><span class="num">1</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;±Inf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">flt</span><span class="op">.</span><span class="ident">expbits</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">flt</span><span class="op">.</span><span class="ident">bias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">overflow</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">if</span>&nbsp;<span class="ident">mant</span><span class="op">&amp;</span><span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">flt</span><span class="op">.</span><span class="ident">mantbits</span><span class="op">)</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Denormalized?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">flt</span><span class="op">.</span><span class="ident">bias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Assemble&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bits</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="ident">uint64</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="ident">flt</span><span class="op">.</span><span class="ident">mantbits</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bits</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="op">(</span><span class="ident">exp</span><span class="op">-</span><span class="ident">flt</span><span class="op">.</span><span class="ident">bias</span><span class="op">)</span><span class="op">&amp;</span><span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">flt</span><span class="op">.</span><span class="ident">expbits</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="op">)</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="ident">flt</span><span class="op">.</span><span class="ident">mantbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">neg</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bits</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="op">(</span><span class="ident">flt</span><span class="op">.</span><span class="ident">mantbits</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">flt</span><span class="op">.</span><span class="ident">expbits</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno">170</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;AssignComputeBounds&nbsp;sets&nbsp;f&nbsp;to&nbsp;the&nbsp;floating&nbsp;point&nbsp;value</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;defined&nbsp;by&nbsp;mant,&nbsp;exp&nbsp;and&nbsp;precision&nbsp;given&nbsp;by&nbsp;flt.&nbsp;It&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;lower,&nbsp;upper&nbsp;such&nbsp;that&nbsp;any&nbsp;number&nbsp;in&nbsp;the&nbsp;closed&nbsp;interval</span><br>
<span class="lineno">175</span><span class="comment">//&nbsp;[lower,&nbsp;upper]&nbsp;is&nbsp;converted&nbsp;back&nbsp;to&nbsp;the&nbsp;same&nbsp;floating&nbsp;point&nbsp;number.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">extFloat</span><span class="op">)</span>&nbsp;<span class="ident">AssignComputeBounds</span><span class="op">(</span><span class="ident">mant</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">neg</span>&nbsp;<span class="builtintype">bool</span><span class="op">,</span>&nbsp;<span class="ident">flt</span>&nbsp;<span class="op">*</span><span class="ident">floatInfo</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">lower</span><span class="op">,</span>&nbsp;<span class="ident">upper</span>&nbsp;<span class="ident">extFloat</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">mant</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="op">-</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">flt</span><span class="op">.</span><span class="ident">mantbits</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">neg</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">neg</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">==</span>&nbsp;<span class="op">(</span><span class="ident">mant</span><span class="op">&gt;&gt;</span><span class="builtintype">uint</span><span class="op">(</span><span class="op">-</span><span class="ident">f</span><span class="op">.</span><span class="ident">exp</span><span class="op">)</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="builtintype">uint</span><span class="op">(</span><span class="op">-</span><span class="ident">f</span><span class="op">.</span><span class="ident">exp</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;An&nbsp;exact&nbsp;integer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="builtintype">uint</span><span class="op">(</span><span class="op">-</span><span class="ident">f</span><span class="op">.</span><span class="ident">exp</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">*</span><span class="ident">f</span><span class="op">,</span>&nbsp;<span class="op">*</span><span class="ident">f</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">expBiased</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">flt</span><span class="op">.</span><span class="ident">bias</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">upper</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">extFloat</span><span class="op">{</span><span class="ident">mant</span><span class="op">:</span>&nbsp;<span class="num">2</span><span class="op">*</span><span class="ident">f</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><span class="op">,</span>&nbsp;<span class="ident">exp</span><span class="op">:</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">,</span>&nbsp;<span class="ident">neg</span><span class="op">:</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">neg</span><span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">flt</span><span class="op">.</span><span class="ident">mantbits</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">expBiased</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lower</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">extFloat</span><span class="op">{</span><span class="ident">mant</span><span class="op">:</span>&nbsp;<span class="num">2</span><span class="op">*</span><span class="ident">f</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">,</span>&nbsp;<span class="ident">exp</span><span class="op">:</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">,</span>&nbsp;<span class="ident">neg</span><span class="op">:</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">neg</span><span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lower</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">extFloat</span><span class="op">{</span><span class="ident">mant</span><span class="op">:</span>&nbsp;<span class="num">4</span><span class="op">*</span><span class="ident">f</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">,</span>&nbsp;<span class="ident">exp</span><span class="op">:</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">2</span><span class="op">,</span>&nbsp;<span class="ident">neg</span><span class="op">:</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">neg</span><span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno">195</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Normalize&nbsp;normalizes&nbsp;f&nbsp;so&nbsp;that&nbsp;the&nbsp;highest&nbsp;bit&nbsp;of&nbsp;the&nbsp;mantissa&nbsp;is</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;set,&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;by&nbsp;which&nbsp;the&nbsp;mantissa&nbsp;was&nbsp;left-shifted.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">extFloat</span><span class="op">)</span>&nbsp;<span class="ident">Normalize</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">shift</span>&nbsp;<span class="builtintype">uint</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span><span class="op">,</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span><span class="op">,</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span><span class="op">&gt;&gt;</span><span class="op">(</span><span class="num">64</span><span class="op">-</span><span class="num">32</span><span class="op">)</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span><span class="op">&gt;&gt;</span><span class="op">(</span><span class="num">64</span><span class="op">-</span><span class="num">16</span><span class="op">)</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">16</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span><span class="op">&gt;&gt;</span><span class="op">(</span><span class="num">64</span><span class="op">-</span><span class="num">8</span><span class="op">)</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">8</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span><span class="op">&gt;&gt;</span><span class="op">(</span><span class="num">64</span><span class="op">-</span><span class="num">4</span><span class="op">)</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span><span class="op">&gt;&gt;</span><span class="op">(</span><span class="num">64</span><span class="op">-</span><span class="num">2</span><span class="op">)</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">mant</span><span class="op">&gt;&gt;</span><span class="op">(</span><span class="num">64</span><span class="op">-</span><span class="num">1</span><span class="op">)</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">shift</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">uint</span><span class="op">(</span><span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">exp</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span><span class="op">,</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">mant</span><span class="op">,</span>&nbsp;<span class="ident">exp</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Multiply&nbsp;sets&nbsp;f&nbsp;to&nbsp;the&nbsp;product&nbsp;f*g:&nbsp;the&nbsp;result&nbsp;is&nbsp;correctly&nbsp;rounded,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;but&nbsp;not&nbsp;normalized.</span><br>
<span class="lineno">235</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">extFloat</span><span class="op">)</span>&nbsp;<span class="ident">Multiply</span><span class="op">(</span><span class="ident">g</span>&nbsp;<span class="ident">extFloat</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fhi</span><span class="op">,</span>&nbsp;<span class="ident">flo</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span><span class="op">&gt;&gt;</span><span class="num">32</span><span class="op">,</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="builtintype">uint32</span><span class="op">(</span><span class="ident">f</span><span class="op">.</span><span class="ident">mant</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">ghi</span><span class="op">,</span>&nbsp;<span class="ident">glo</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">g</span><span class="op">.</span><span class="ident">mant</span><span class="op">&gt;&gt;</span><span class="num">32</span><span class="op">,</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="builtintype">uint32</span><span class="op">(</span><span class="ident">g</span><span class="op">.</span><span class="ident">mant</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Cross&nbsp;products.</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">cross1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">fhi</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">glo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">cross2</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">flo</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">ghi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;f.mant*g.mant&nbsp;is&nbsp;fhi*ghi&nbsp;&lt;&lt;&nbsp;64&nbsp;+&nbsp;(cross1+cross2)&nbsp;&lt;&lt;&nbsp;32&nbsp;+&nbsp;flo*glo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">fhi</span><span class="op">*</span><span class="ident">ghi</span>&nbsp;<span class="op">+</span>&nbsp;<span class="op">(</span><span class="ident">cross1</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">32</span><span class="op">)</span>&nbsp;<span class="op">+</span>&nbsp;<span class="op">(</span><span class="ident">cross2</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">32</span><span class="op">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">rem</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="builtintype">uint32</span><span class="op">(</span><span class="ident">cross1</span><span class="op">)</span><span class="op">)</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="builtintype">uint32</span><span class="op">(</span><span class="ident">cross2</span><span class="op">)</span><span class="op">)</span>&nbsp;<span class="op">+</span>&nbsp;<span class="op">(</span><span class="op">(</span><span class="ident">flo</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">glo</span><span class="op">)</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">32</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Round&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">rem</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="op">(</span><span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">31</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="op">(</span><span class="ident">rem</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">32</span><span class="op">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">g</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">64</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">uint64pow10</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="op">...</span><span class="op">]</span><span class="ident">uint64</span><span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">1</span><span class="op">,</span>&nbsp;<span class="num">1e1</span><span class="op">,</span>&nbsp;<span class="num">1e2</span><span class="op">,</span>&nbsp;<span class="num">1e3</span><span class="op">,</span>&nbsp;<span class="num">1e4</span><span class="op">,</span>&nbsp;<span class="num">1e5</span><span class="op">,</span>&nbsp;<span class="num">1e6</span><span class="op">,</span>&nbsp;<span class="num">1e7</span><span class="op">,</span>&nbsp;<span class="num">1e8</span><span class="op">,</span>&nbsp;<span class="num">1e9</span><span class="op">,</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">1e10</span><span class="op">,</span>&nbsp;<span class="num">1e11</span><span class="op">,</span>&nbsp;<span class="num">1e12</span><span class="op">,</span>&nbsp;<span class="num">1e13</span><span class="op">,</span>&nbsp;<span class="num">1e14</span><span class="op">,</span>&nbsp;<span class="num">1e15</span><span class="op">,</span>&nbsp;<span class="num">1e16</span><span class="op">,</span>&nbsp;<span class="num">1e17</span><span class="op">,</span>&nbsp;<span class="num">1e18</span><span class="op">,</span>&nbsp;<span class="num">1e19</span><span class="op">,</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;AssignDecimal&nbsp;sets&nbsp;f&nbsp;to&nbsp;an&nbsp;approximate&nbsp;value&nbsp;mantissa*10^exp.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;value&nbsp;represented&nbsp;by&nbsp;f&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;the</span><br>
<span class="lineno">260</span><span class="comment">//&nbsp;best&nbsp;approximation&nbsp;of&nbsp;d&nbsp;after&nbsp;being&nbsp;rounded&nbsp;to&nbsp;a&nbsp;float64&nbsp;or</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;float32&nbsp;depending&nbsp;on&nbsp;flt.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">extFloat</span><span class="op">)</span>&nbsp;<span class="ident">AssignDecimal</span><span class="op">(</span><span class="ident">mantissa</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">exp10</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">neg</span>&nbsp;<span class="builtintype">bool</span><span class="op">,</span>&nbsp;<span class="ident">trunc</span>&nbsp;<span class="builtintype">bool</span><span class="op">,</span>&nbsp;<span class="ident">flt</span>&nbsp;<span class="op">*</span><span class="ident">floatInfo</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">ok</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">const</span>&nbsp;<span class="ident">uint64digits</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">19</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">const</span>&nbsp;<span class="ident">errorscale</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">8</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">errors</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="comment">//&nbsp;An&nbsp;upper&nbsp;bound&nbsp;for&nbsp;error,&nbsp;computed&nbsp;in&nbsp;errorscale*ulp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">trunc</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;the&nbsp;decimal&nbsp;number&nbsp;was&nbsp;truncated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">errors</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">errorscale</span>&nbsp;<span class="op">/</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">mantissa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">neg</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">neg</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Multiply&nbsp;by&nbsp;powers&nbsp;of&nbsp;ten.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="ident">exp10</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">firstPowerOfTen</span><span class="op">)</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">stepPowerOfTen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">exp10</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">firstPowerOfTen</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">powersOfTen</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">adjExp</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="ident">exp10</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">firstPowerOfTen</span><span class="op">)</span>&nbsp;<span class="op">%</span>&nbsp;<span class="ident">stepPowerOfTen</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;We&nbsp;multiply&nbsp;by&nbsp;exp%step</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">adjExp</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">uint64digits</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">mantissa</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">uint64pow10</span><span class="op">[</span><span class="ident">uint64digits</span><span class="op">-</span><span class="ident">adjExp</span><span class="op">]</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;We&nbsp;can&nbsp;multiply&nbsp;the&nbsp;mantissa&nbsp;exactly.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">*=</span>&nbsp;<span class="ident">uint64pow10</span><span class="op">[</span><span class="ident">adjExp</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">Normalize</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">Normalize</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">Multiply</span><span class="op">(</span><span class="ident">smallPowersOfTen</span><span class="op">[</span><span class="ident">adjExp</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">errors</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">errorscale</span>&nbsp;<span class="op">/</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;We&nbsp;multiply&nbsp;by&nbsp;10&nbsp;to&nbsp;the&nbsp;exp&nbsp;-&nbsp;exp%step.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">Multiply</span><span class="op">(</span><span class="ident">powersOfTen</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">errors</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">errors</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">errors</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">errorscale</span>&nbsp;<span class="op">/</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Normalize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">shift</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">Normalize</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">errors</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="ident">shift</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Now&nbsp;f&nbsp;is&nbsp;a&nbsp;good&nbsp;approximation&nbsp;of&nbsp;the&nbsp;decimal.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Check&nbsp;whether&nbsp;the&nbsp;error&nbsp;is&nbsp;too&nbsp;large:&nbsp;that&nbsp;is,&nbsp;if&nbsp;the&nbsp;mantissa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;is&nbsp;perturbated&nbsp;by&nbsp;the&nbsp;error,&nbsp;the&nbsp;resulting&nbsp;float64&nbsp;will&nbsp;change.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;64&nbsp;bits&nbsp;mantissa&nbsp;is&nbsp;1&nbsp;+&nbsp;52&nbsp;bits&nbsp;for&nbsp;float64&nbsp;+&nbsp;11&nbsp;extra&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;In&nbsp;many&nbsp;cases&nbsp;the&nbsp;approximation&nbsp;will&nbsp;be&nbsp;good&nbsp;enough.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">denormalExp</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">flt</span><span class="op">.</span><span class="ident">bias</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">63</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">extrabits</span>&nbsp;<span class="builtintype">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">denormalExp</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;f.mant&nbsp;*&nbsp;2^f.exp&nbsp;is&nbsp;smaller&nbsp;than&nbsp;2^(flt.bias+1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">extrabits</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">uint</span><span class="op">(</span><span class="num">63</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">flt</span><span class="op">.</span><span class="ident">mantbits</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">+</span>&nbsp;<span class="builtintype">uint</span><span class="op">(</span><span class="ident">denormalExp</span><span class="op">-</span><span class="ident">f</span><span class="op">.</span><span class="ident">exp</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">extrabits</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">uint</span><span class="op">(</span><span class="num">63</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">flt</span><span class="op">.</span><span class="ident">mantbits</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">halfway</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="num">1</span><span class="op">)</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="op">(</span><span class="ident">extrabits</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mant_extra</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">extrabits</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Do&nbsp;a&nbsp;signed&nbsp;comparison&nbsp;here!&nbsp;If&nbsp;the&nbsp;error&nbsp;estimate&nbsp;could&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;the&nbsp;mantissa&nbsp;round&nbsp;differently&nbsp;for&nbsp;the&nbsp;conversion&nbsp;to&nbsp;double,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;then&nbsp;we&nbsp;can&#39;t&nbsp;give&nbsp;a&nbsp;definite&nbsp;answer.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">halfway</span><span class="op">)</span><span class="op">-</span><span class="ident">int64</span><span class="op">(</span><span class="ident">errors</span><span class="op">)</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">mant_extra</span><span class="op">)</span>&nbsp;<span class="op">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">int64</span><span class="op">(</span><span class="ident">mant_extra</span><span class="op">)</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">halfway</span><span class="op">)</span><span class="op">+</span><span class="ident">int64</span><span class="op">(</span><span class="ident">errors</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno">330</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Frexp10&nbsp;is&nbsp;an&nbsp;analogue&nbsp;of&nbsp;math.Frexp&nbsp;for&nbsp;decimal&nbsp;powers.&nbsp;It&nbsp;scales</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;f&nbsp;by&nbsp;an&nbsp;approximate&nbsp;power&nbsp;of&nbsp;ten&nbsp;10^-exp,&nbsp;and&nbsp;returns&nbsp;exp10,&nbsp;so</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;that&nbsp;f*10^exp10&nbsp;has&nbsp;the&nbsp;same&nbsp;value&nbsp;as&nbsp;the&nbsp;old&nbsp;f,&nbsp;up&nbsp;to&nbsp;an&nbsp;ulp,</span><br>
<span class="lineno">335</span><span class="comment">//&nbsp;as&nbsp;well&nbsp;as&nbsp;the&nbsp;index&nbsp;of&nbsp;10^-exp&nbsp;in&nbsp;the&nbsp;powersOfTen&nbsp;table.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">extFloat</span><span class="op">)</span>&nbsp;<span class="ident">frexp10</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">exp10</span><span class="op">,</span>&nbsp;<span class="ident">index</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;constants&nbsp;expMin&nbsp;and&nbsp;expMax&nbsp;constrain&nbsp;the&nbsp;final&nbsp;value&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;binary&nbsp;exponent&nbsp;of&nbsp;f.&nbsp;We&nbsp;want&nbsp;a&nbsp;small&nbsp;integral&nbsp;part&nbsp;in&nbsp;the&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;because&nbsp;finding&nbsp;digits&nbsp;of&nbsp;an&nbsp;integer&nbsp;requires&nbsp;divisions,&nbsp;whereas</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;digits&nbsp;of&nbsp;the&nbsp;fractional&nbsp;part&nbsp;can&nbsp;be&nbsp;found&nbsp;by&nbsp;repeatedly&nbsp;multiplying</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;by&nbsp;10.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">const</span>&nbsp;<span class="ident">expMin</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="num">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">const</span>&nbsp;<span class="ident">expMax</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="num">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Find&nbsp;power&nbsp;of&nbsp;ten&nbsp;such&nbsp;that&nbsp;x&nbsp;*&nbsp;10^n&nbsp;has&nbsp;a&nbsp;binary&nbsp;exponent</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;between&nbsp;expMin&nbsp;and&nbsp;expMax.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">approxExp10</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="op">(</span><span class="ident">expMin</span><span class="op">+</span><span class="ident">expMax</span><span class="op">)</span><span class="op">/</span><span class="num">2</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span><span class="op">)</span>&nbsp;<span class="op">*</span>&nbsp;<span class="num">28</span>&nbsp;<span class="op">/</span>&nbsp;<span class="num">93</span>&nbsp;<span class="comment">//&nbsp;log(10)/log(2)&nbsp;is&nbsp;close&nbsp;to&nbsp;93/28.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="ident">approxExp10</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">firstPowerOfTen</span><span class="op">)</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">stepPowerOfTen</span><br>
<span class="lineno"></span><span class="ident">Loop</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">powersOfTen</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">switch</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">expMin</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">i</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">exp</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">expMax</span><span class="op">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">i</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">default</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">break</span>&nbsp;<span class="ident">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Apply&nbsp;the&nbsp;desired&nbsp;decimal&nbsp;shift&nbsp;on&nbsp;f.&nbsp;It&nbsp;will&nbsp;have&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;in&nbsp;the&nbsp;desired&nbsp;range.&nbsp;This&nbsp;is&nbsp;multiplication&nbsp;by&nbsp;10^-exp10.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">Multiply</span><span class="op">(</span><span class="ident">powersOfTen</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">-</span><span class="op">(</span><span class="ident">firstPowerOfTen</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">i</span><span class="op">*</span><span class="ident">stepPowerOfTen</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">i</span><br>
<span class="lineno">365</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;frexp10Many&nbsp;applies&nbsp;a&nbsp;common&nbsp;shift&nbsp;by&nbsp;a&nbsp;power&nbsp;of&nbsp;ten&nbsp;to&nbsp;a,&nbsp;b,&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">frexp10Many</span><span class="op">(</span><span class="ident">a</span><span class="op">,</span>&nbsp;<span class="ident">b</span><span class="op">,</span>&nbsp;<span class="ident">c</span>&nbsp;<span class="op">*</span><span class="ident">extFloat</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">exp10</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp10</span><span class="op">,</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">c</span><span class="op">.</span><span class="ident">frexp10</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">a</span><span class="op">.</span><span class="ident">Multiply</span><span class="op">(</span><span class="ident">powersOfTen</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b</span><span class="op">.</span><span class="ident">Multiply</span><span class="op">(</span><span class="ident">powersOfTen</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment">//&nbsp;FixedDecimal&nbsp;stores&nbsp;in&nbsp;d&nbsp;the&nbsp;first&nbsp;n&nbsp;significant&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;of&nbsp;the&nbsp;decimal&nbsp;representation&nbsp;of&nbsp;f.&nbsp;It&nbsp;returns&nbsp;false</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;if&nbsp;it&nbsp;cannot&nbsp;be&nbsp;sure&nbsp;of&nbsp;the&nbsp;answer.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">extFloat</span><span class="op">)</span>&nbsp;<span class="ident">FixedDecimal</span><span class="op">(</span><span class="ident">d</span>&nbsp;<span class="op">*</span><span class="ident">decimalSlice</span><span class="op">,</span>&nbsp;<span class="ident">n</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">dp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">neg</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">n</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">panic</span><span class="op">(</span><span class="string">&#34;strconv:&nbsp;internal&nbsp;error:&nbsp;extFloat.FixedDecimal&nbsp;called&nbsp;with&nbsp;n&nbsp;==&nbsp;0&#34;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Multiply&nbsp;by&nbsp;an&nbsp;appropriate&nbsp;power&nbsp;of&nbsp;ten&nbsp;to&nbsp;have&nbsp;a&nbsp;reasonable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;number&nbsp;to&nbsp;process.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">Normalize</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp10</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">frexp10</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">shift</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint</span><span class="op">(</span><span class="op">-</span><span class="ident">f</span><span class="op">.</span><span class="ident">exp</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">integer</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">f</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="ident">shift</span><span class="op">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fraction</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">-</span>&nbsp;<span class="op">(</span><span class="ident">uint64</span><span class="op">(</span><span class="ident">integer</span><span class="op">)</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="ident">shift</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">ε</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="num">1</span><span class="op">)</span>&nbsp;<span class="comment">//&nbsp;ε&nbsp;is&nbsp;the&nbsp;uncertainty&nbsp;we&nbsp;have&nbsp;on&nbsp;the&nbsp;mantissa&nbsp;of&nbsp;f.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Write&nbsp;exactly&nbsp;n&nbsp;digits&nbsp;to&nbsp;d.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">needed</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;how&nbsp;many&nbsp;digits&nbsp;are&nbsp;left&nbsp;to&nbsp;write.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">integerDigits</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="comment">//&nbsp;the&nbsp;number&nbsp;of&nbsp;decimal&nbsp;digits&nbsp;of&nbsp;integer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pow10</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="num">1</span><span class="op">)</span>&nbsp;<span class="comment">//&nbsp;the&nbsp;power&nbsp;of&nbsp;ten&nbsp;by&nbsp;which&nbsp;f&nbsp;was&nbsp;scaled.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span><span class="op">,</span>&nbsp;<span class="ident">pow</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">20</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">pow</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">integer</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">integerDigits</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">i</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pow</span>&nbsp;<span class="op">*=</span>&nbsp;<span class="num">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">rest</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">integer</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">integerDigits</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">needed</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;the&nbsp;integral&nbsp;part&nbsp;is&nbsp;already&nbsp;large,&nbsp;trim&nbsp;the&nbsp;last&nbsp;digits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pow10</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">uint64pow10</span><span class="op">[</span><span class="ident">integerDigits</span><span class="op">-</span><span class="ident">needed</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">integer</span>&nbsp;<span class="op">/=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">pow10</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">rest</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">integer</span>&nbsp;<span class="op">*</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">pow10</span><span class="op">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">rest</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Write&nbsp;the&nbsp;digits&nbsp;of&nbsp;integer:&nbsp;the&nbsp;digits&nbsp;of&nbsp;rest&nbsp;are&nbsp;omitted.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">buf</span>&nbsp;<span class="op">[</span><span class="num">32</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pos</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">buf</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">integer</span><span class="op">;</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">v1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="op">/</span>&nbsp;<span class="num">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">v</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">10</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">v1</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pos</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="ident">pos</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">v</span>&nbsp;<span class="op">+</span>&nbsp;<span class="string">&#39;0&#39;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">v</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">v1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">pos</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">buf</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">d</span><span class="op">[</span><span class="ident">i</span><span class="op">-</span><span class="ident">pos</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">buf</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nd</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">buf</span><span class="op">)</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">dp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">integerDigits</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">exp10</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">needed</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">nd</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">needed</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">rest</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">pow10</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">panic</span><span class="op">(</span><span class="string">&#34;strconv:&nbsp;internal&nbsp;error,&nbsp;rest&nbsp;!=&nbsp;0&nbsp;but&nbsp;needed&nbsp;&gt;&nbsp;0&#34;</span><span class="op">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Emit&nbsp;digits&nbsp;for&nbsp;the&nbsp;fractional&nbsp;part.&nbsp;Each&nbsp;time,&nbsp;10*fraction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;fits&nbsp;in&nbsp;a&nbsp;uint64&nbsp;without&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">needed</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fraction</span>&nbsp;<span class="op">*=</span>&nbsp;<span class="num">10</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">ε</span>&nbsp;<span class="op">*=</span>&nbsp;<span class="num">10</span>&nbsp;<span class="comment">//&nbsp;the&nbsp;uncertainty&nbsp;scales&nbsp;as&nbsp;we&nbsp;multiply&nbsp;by&nbsp;ten.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="num">2</span><span class="op">*</span><span class="ident">ε</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">shift</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;the&nbsp;error&nbsp;is&nbsp;so&nbsp;large&nbsp;it&nbsp;could&nbsp;modify&nbsp;which&nbsp;digit&nbsp;to&nbsp;write,&nbsp;abort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">digit</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">fraction</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="ident">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">d</span><span class="op">[</span><span class="ident">nd</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">digit</span>&nbsp;<span class="op">+</span>&nbsp;<span class="string">&#39;0&#39;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fraction</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">digit</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="ident">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nd</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">needed</span><span class="op">--</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;We&nbsp;have&nbsp;written&nbsp;a&nbsp;truncation&nbsp;of&nbsp;f&nbsp;(a&nbsp;numerator&nbsp;/&nbsp;10^d.dp).&nbsp;The&nbsp;remaining&nbsp;part</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;can&nbsp;be&nbsp;interpreted&nbsp;as&nbsp;a&nbsp;small&nbsp;number&nbsp;(&lt;&nbsp;1)&nbsp;to&nbsp;be&nbsp;added&nbsp;to&nbsp;the&nbsp;last&nbsp;digit&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;numerator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;If&nbsp;rest&nbsp;&gt;&nbsp;0,&nbsp;the&nbsp;amount&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;(rest&lt;&lt;shift&nbsp;|&nbsp;fraction)&nbsp;/&nbsp;(pow10&nbsp;&lt;&lt;&nbsp;shift)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;fraction&nbsp;being&nbsp;known&nbsp;with&nbsp;a&nbsp;±ε&nbsp;uncertainty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;fact&nbsp;that&nbsp;n&nbsp;&gt;&nbsp;0&nbsp;guarantees&nbsp;that&nbsp;pow10&nbsp;&lt;&lt;&nbsp;shift&nbsp;does&nbsp;not&nbsp;overflow&nbsp;a&nbsp;uint64.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;If&nbsp;rest&nbsp;=&nbsp;0,&nbsp;pow10&nbsp;==&nbsp;1&nbsp;and&nbsp;the&nbsp;amount&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;fraction&nbsp;/&nbsp;(1&nbsp;&lt;&lt;&nbsp;shift)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;fraction&nbsp;being&nbsp;known&nbsp;with&nbsp;a&nbsp;±ε&nbsp;uncertainty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;We&nbsp;pass&nbsp;this&nbsp;information&nbsp;to&nbsp;the&nbsp;rounding&nbsp;routine&nbsp;for&nbsp;adjustment.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">ok</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">adjustLastDigitFixed</span><span class="op">(</span><span class="ident">d</span><span class="op">,</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">rest</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="ident">shift</span><span class="op">|</span><span class="ident">fraction</span><span class="op">,</span>&nbsp;<span class="ident">pow10</span><span class="op">,</span>&nbsp;<span class="ident">shift</span><span class="op">,</span>&nbsp;<span class="ident">ε</span><span class="op">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="op">!</span><span class="ident">ok</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Trim&nbsp;trailing&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">--</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">d</span><span class="op">.</span><span class="ident">d</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="string">&#39;0&#39;</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;adjustLastDigitFixed&nbsp;assumes&nbsp;d&nbsp;contains&nbsp;the&nbsp;representation&nbsp;of&nbsp;the&nbsp;integral&nbsp;part</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;of&nbsp;some&nbsp;number,&nbsp;whose&nbsp;fractional&nbsp;part&nbsp;is&nbsp;num&nbsp;/&nbsp;(den&nbsp;&lt;&lt;&nbsp;shift).&nbsp;The&nbsp;numerator</span><br>
<span class="lineno">490</span><span class="comment">//&nbsp;num&nbsp;is&nbsp;only&nbsp;known&nbsp;up&nbsp;to&nbsp;an&nbsp;uncertainty&nbsp;of&nbsp;size&nbsp;ε,&nbsp;assumed&nbsp;to&nbsp;be&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;(den&nbsp;&lt;&lt;&nbsp;shift)/2.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;It&nbsp;will&nbsp;increase&nbsp;the&nbsp;last&nbsp;digit&nbsp;by&nbsp;one&nbsp;to&nbsp;account&nbsp;for&nbsp;correct&nbsp;rounding,&nbsp;typically</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;when&nbsp;the&nbsp;fractional&nbsp;part&nbsp;is&nbsp;greater&nbsp;than&nbsp;1/2,&nbsp;and&nbsp;will&nbsp;return&nbsp;false&nbsp;if&nbsp;ε&nbsp;is&nbsp;such</span><br>
<span class="lineno">495</span><span class="comment">//&nbsp;that&nbsp;no&nbsp;correct&nbsp;answer&nbsp;can&nbsp;be&nbsp;given.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">adjustLastDigitFixed</span><span class="op">(</span><span class="ident">d</span>&nbsp;<span class="op">*</span><span class="ident">decimalSlice</span><span class="op">,</span>&nbsp;<span class="ident">num</span><span class="op">,</span>&nbsp;<span class="ident">den</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">shift</span>&nbsp;<span class="builtintype">uint</span><span class="op">,</span>&nbsp;<span class="ident">ε</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">num</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">den</span><span class="op">&lt;&lt;</span><span class="ident">shift</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">panic</span><span class="op">(</span><span class="string">&#34;strconv:&nbsp;num&nbsp;&gt;&nbsp;den&lt;&lt;shift&nbsp;in&nbsp;adjustLastDigitFixed&#34;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="num">2</span><span class="op">*</span><span class="ident">ε</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">den</span><span class="op">&lt;&lt;</span><span class="ident">shift</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">panic</span><span class="op">(</span><span class="string">&#34;strconv:&nbsp;ε&nbsp;&gt;&nbsp;(den&lt;&lt;shift)/2&#34;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="num">2</span><span class="op">*</span><span class="op">(</span><span class="ident">num</span><span class="op">+</span><span class="ident">ε</span><span class="op">)</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">den</span><span class="op">&lt;&lt;</span><span class="ident">shift</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="num">2</span><span class="op">*</span><span class="op">(</span><span class="ident">num</span><span class="op">-</span><span class="ident">ε</span><span class="op">)</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">den</span><span class="op">&lt;&lt;</span><span class="ident">shift</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;increment&nbsp;d&nbsp;by&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">--</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">d</span><span class="op">.</span><span class="ident">d</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">==</span>&nbsp;<span class="string">&#39;9&#39;</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">d</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#39;1&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">dp</span><span class="op">++</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">d</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;ShortestDecimal&nbsp;stores&nbsp;in&nbsp;d&nbsp;the&nbsp;shortest&nbsp;decimal&nbsp;representation&nbsp;of&nbsp;f</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;which&nbsp;belongs&nbsp;to&nbsp;the&nbsp;open&nbsp;interval&nbsp;(lower,&nbsp;upper),&nbsp;where&nbsp;f&nbsp;is&nbsp;supposed</span><br>
<span class="lineno">530</span><span class="comment">//&nbsp;to&nbsp;lie.&nbsp;It&nbsp;returns&nbsp;false&nbsp;whenever&nbsp;the&nbsp;result&nbsp;is&nbsp;unsure.&nbsp;The&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;uses&nbsp;the&nbsp;Grisu3&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">extFloat</span><span class="op">)</span>&nbsp;<span class="ident">ShortestDecimal</span><span class="op">(</span><span class="ident">d</span>&nbsp;<span class="op">*</span><span class="ident">decimalSlice</span><span class="op">,</span>&nbsp;<span class="ident">lower</span><span class="op">,</span>&nbsp;<span class="ident">upper</span>&nbsp;<span class="op">*</span><span class="ident">extFloat</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">dp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">neg</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="op">*</span><span class="ident">lower</span>&nbsp;<span class="op">==</span>&nbsp;<span class="op">*</span><span class="ident">f</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="op">*</span><span class="ident">lower</span>&nbsp;<span class="op">==</span>&nbsp;<span class="op">*</span><span class="ident">upper</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;an&nbsp;exact&nbsp;integer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">buf</span>&nbsp;<span class="op">[</span><span class="num">24</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">buf</span><span class="op">)</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span><span class="op">;</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">v1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="op">/</span>&nbsp;<span class="num">10</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">v</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">10</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">v1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="ident">n</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">v</span>&nbsp;<span class="op">+</span>&nbsp;<span class="string">&#39;0&#39;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">v</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">v1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nd</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">buf</span><span class="op">)</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">n</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">nd</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">d</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">buf</span><span class="op">[</span><span class="ident">n</span><span class="op">+</span><span class="num">1</span><span class="op">+</span><span class="ident">i</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span><span class="op">,</span>&nbsp;<span class="ident">d</span><span class="op">.</span><span class="ident">dp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">nd</span><span class="op">,</span>&nbsp;<span class="ident">nd</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">d</span><span class="op">.</span><span class="ident">d</span><span class="op">[</span><span class="ident">d</span><span class="op">.</span><span class="ident">nd</span><span class="op">-</span><span class="num">1</span><span class="op">]</span>&nbsp;<span class="op">==</span>&nbsp;<span class="string">&#39;0&#39;</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">dp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">neg</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">upper</span><span class="op">.</span><span class="ident">Normalize</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Uniformize&nbsp;exponents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">upper</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="builtintype">uint</span><span class="op">(</span><span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">upper</span><span class="op">.</span><span class="ident">exp</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">upper</span><span class="op">.</span><span class="ident">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">lower</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">upper</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lower</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="builtintype">uint</span><span class="op">(</span><span class="ident">lower</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">upper</span><span class="op">.</span><span class="ident">exp</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lower</span><span class="op">.</span><span class="ident">exp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">upper</span><span class="op">.</span><span class="ident">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">exp10</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">frexp10Many</span><span class="op">(</span><span class="ident">lower</span><span class="op">,</span>&nbsp;<span class="ident">f</span><span class="op">,</span>&nbsp;<span class="ident">upper</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Take&nbsp;a&nbsp;safety&nbsp;margin&nbsp;due&nbsp;to&nbsp;rounding&nbsp;in&nbsp;frexp10Many,&nbsp;but&nbsp;we&nbsp;lose&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">upper</span><span class="op">.</span><span class="ident">mant</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lower</span><span class="op">.</span><span class="ident">mant</span><span class="op">--</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;shortest&nbsp;representation&nbsp;of&nbsp;f&nbsp;is&nbsp;either&nbsp;rounded&nbsp;up&nbsp;or&nbsp;down,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;in&nbsp;any&nbsp;case,&nbsp;it&nbsp;is&nbsp;a&nbsp;truncation&nbsp;of&nbsp;upper.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">shift</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint</span><span class="op">(</span><span class="op">-</span><span class="ident">upper</span><span class="op">.</span><span class="ident">exp</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">integer</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">upper</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="ident">shift</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fraction</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">upper</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">-</span>&nbsp;<span class="op">(</span><span class="ident">uint64</span><span class="op">(</span><span class="ident">integer</span><span class="op">)</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="ident">shift</span><span class="op">)</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;How&nbsp;far&nbsp;we&nbsp;can&nbsp;go&nbsp;down&nbsp;from&nbsp;upper&nbsp;until&nbsp;the&nbsp;result&nbsp;is&nbsp;wrong.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">allowance</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">upper</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">lower</span><span class="op">.</span><span class="ident">mant</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;How&nbsp;far&nbsp;we&nbsp;should&nbsp;go&nbsp;to&nbsp;get&nbsp;a&nbsp;very&nbsp;precise&nbsp;result.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">targetDiff</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">upper</span><span class="op">.</span><span class="ident">mant</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">mant</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Count&nbsp;integral&nbsp;digits:&nbsp;there&nbsp;are&nbsp;at&nbsp;most&nbsp;10.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">integerDigits</span>&nbsp;<span class="builtintype">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span><span class="op">,</span>&nbsp;<span class="ident">pow</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">20</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">pow</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">integer</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">integerDigits</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pow</span>&nbsp;<span class="op">*=</span>&nbsp;<span class="num">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">integerDigits</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pow</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64pow10</span><span class="op">[</span><span class="ident">integerDigits</span><span class="op">-</span><span class="ident">i</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">digit</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">integer</span>&nbsp;<span class="op">/</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">pow</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">d</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">digit</span>&nbsp;<span class="op">+</span>&nbsp;<span class="string">&#39;0&#39;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">integer</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">digit</span>&nbsp;<span class="op">*</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">pow</span><span class="op">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;evaluate&nbsp;whether&nbsp;we&nbsp;should&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">currentDiff</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">integer</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="ident">shift</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">fraction</span><span class="op">;</span>&nbsp;<span class="ident">currentDiff</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">allowance</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">dp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">integerDigits</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">exp10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">neg</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">neg</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Sometimes&nbsp;allowance&nbsp;is&nbsp;so&nbsp;large&nbsp;the&nbsp;last&nbsp;digit&nbsp;might&nbsp;need&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;decremented&nbsp;to&nbsp;get&nbsp;closer&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">adjustLastDigit</span><span class="op">(</span><span class="ident">d</span><span class="op">,</span>&nbsp;<span class="ident">currentDiff</span><span class="op">,</span>&nbsp;<span class="ident">targetDiff</span><span class="op">,</span>&nbsp;<span class="ident">allowance</span><span class="op">,</span>&nbsp;<span class="ident">pow</span><span class="op">&lt;&lt;</span><span class="ident">shift</span><span class="op">,</span>&nbsp;<span class="num">2</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">integerDigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">dp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">exp10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">neg</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">neg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Compute&nbsp;digits&nbsp;of&nbsp;the&nbsp;fractional&nbsp;part.&nbsp;At&nbsp;each&nbsp;step&nbsp;fraction&nbsp;does&nbsp;not</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;overflow.&nbsp;The&nbsp;choice&nbsp;of&nbsp;minExp&nbsp;implies&nbsp;that&nbsp;fraction&nbsp;is&nbsp;less&nbsp;than&nbsp;2^60.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">digit</span>&nbsp;<span class="builtintype">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">multiplier</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fraction</span>&nbsp;<span class="op">*=</span>&nbsp;<span class="num">10</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">multiplier</span>&nbsp;<span class="op">*=</span>&nbsp;<span class="num">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">digit</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">fraction</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="ident">shift</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">d</span><span class="op">[</span><span class="ident">d</span><span class="op">.</span><span class="ident">nd</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">digit</span>&nbsp;<span class="op">+</span>&nbsp;<span class="string">&#39;0&#39;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fraction</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">digit</span><span class="op">)</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="ident">shift</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">fraction</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">allowance</span><span class="op">*</span><span class="ident">multiplier</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;We&nbsp;are&nbsp;in&nbsp;the&nbsp;admissible&nbsp;range.&nbsp;Note&nbsp;that&nbsp;if&nbsp;allowance&nbsp;is&nbsp;about&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;overflow,&nbsp;that&nbsp;is,&nbsp;allowance&nbsp;&gt;&nbsp;2^64/10,&nbsp;the&nbsp;condition&nbsp;is&nbsp;automatically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;true&nbsp;due&nbsp;to&nbsp;the&nbsp;limited&nbsp;range&nbsp;of&nbsp;fraction.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">adjustLastDigit</span><span class="op">(</span><span class="ident">d</span><span class="op">,</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fraction</span><span class="op">,</span>&nbsp;<span class="ident">targetDiff</span><span class="op">*</span><span class="ident">multiplier</span><span class="op">,</span>&nbsp;<span class="ident">allowance</span><span class="op">*</span><span class="ident">multiplier</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num">1</span><span class="op">&lt;&lt;</span><span class="ident">shift</span><span class="op">,</span>&nbsp;<span class="ident">multiplier</span><span class="op">*</span><span class="num">2</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">640</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;adjustLastDigit&nbsp;modifies&nbsp;d&nbsp;=&nbsp;x-currentDiff*ε,&nbsp;to&nbsp;get&nbsp;closest&nbsp;to</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;d&nbsp;=&nbsp;x-targetDiff*ε,&nbsp;without&nbsp;becoming&nbsp;smaller&nbsp;than&nbsp;x-maxDiff*ε.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;It&nbsp;assumes&nbsp;that&nbsp;a&nbsp;decimal&nbsp;digit&nbsp;is&nbsp;worth&nbsp;ulpDecimal*ε,&nbsp;and&nbsp;that</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;all&nbsp;data&nbsp;is&nbsp;known&nbsp;with&nbsp;a&nbsp;error&nbsp;estimate&nbsp;of&nbsp;ulpBinary*ε.</span><br>
<span class="lineno">645</span><span class="keyword">func</span>&nbsp;<span class="ident">adjustLastDigit</span><span class="op">(</span><span class="ident">d</span>&nbsp;<span class="op">*</span><span class="ident">decimalSlice</span><span class="op">,</span>&nbsp;<span class="ident">currentDiff</span><span class="op">,</span>&nbsp;<span class="ident">targetDiff</span><span class="op">,</span>&nbsp;<span class="ident">maxDiff</span><span class="op">,</span>&nbsp;<span class="ident">ulpDecimal</span><span class="op">,</span>&nbsp;<span class="ident">ulpBinary</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">ulpDecimal</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">2</span><span class="op">*</span><span class="ident">ulpBinary</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Approximation&nbsp;is&nbsp;too&nbsp;wide.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">currentDiff</span><span class="op">+</span><span class="ident">ulpDecimal</span><span class="op">/</span><span class="num">2</span><span class="op">+</span><span class="ident">ulpBinary</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">targetDiff</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">d</span><span class="op">[</span><span class="ident">d</span><span class="op">.</span><span class="ident">nd</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">currentDiff</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">ulpDecimal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">currentDiff</span><span class="op">+</span><span class="ident">ulpDecimal</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">targetDiff</span><span class="op">+</span><span class="ident">ulpDecimal</span><span class="op">/</span><span class="num">2</span><span class="op">+</span><span class="ident">ulpBinary</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;we&nbsp;have&nbsp;two&nbsp;choices,&nbsp;and&nbsp;don&#39;t&nbsp;know&nbsp;what&nbsp;to&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">currentDiff</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">ulpBinary</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">currentDiff</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">maxDiff</span><span class="op">-</span><span class="ident">ulpBinary</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;we&nbsp;went&nbsp;too&nbsp;far</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">d</span><span class="op">.</span><span class="ident">d</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">==</span>&nbsp;<span class="string">&#39;0&#39;</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;the&nbsp;number&nbsp;has&nbsp;actually&nbsp;reached&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">nd</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">dp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno"></span><span class="op">}</span>
</div>
</body>
</html>
