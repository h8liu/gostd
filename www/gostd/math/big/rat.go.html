<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html" class="current">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3666207">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3666262">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3666316">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3666367">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;multi-precision&nbsp;rational&nbsp;numbers.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3666426">package</span>&nbsp;<span class="ident" id="3666434">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3666439">import</span>&nbsp;<span class="op" id="3666446">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3666449">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3666468">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3666478">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3666485">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3666493">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3666503">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3666506">//&nbsp;A&nbsp;Rat&nbsp;represents&nbsp;a&nbsp;quotient&nbsp;a/b&nbsp;of&nbsp;arbitrary&nbsp;precision.</span><br>
<span class="lineno"></span><span class="comment" id="3666565">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Rat&nbsp;represents&nbsp;the&nbsp;value&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3666617">type</span>&nbsp;<span class="ident" id="3666622">Rat</span>&nbsp;<span class="keyword" id="3666626">struct</span>&nbsp;<span class="op" id="3666633">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3666636">//&nbsp;To&nbsp;make&nbsp;zero&nbsp;values&nbsp;for&nbsp;Rat&nbsp;work&nbsp;w/o&nbsp;initialization,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3666693">//&nbsp;a&nbsp;zero&nbsp;value&nbsp;of&nbsp;b&nbsp;(len(b)&nbsp;==&nbsp;0)&nbsp;acts&nbsp;like&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3666747">//&nbsp;a.neg&nbsp;determines&nbsp;the&nbsp;sign&nbsp;of&nbsp;the&nbsp;Rat,&nbsp;b.neg&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3666807">a</span><span class="op" id="3666808">,</span>&nbsp;<span class="ident" id="3666810">b</span>&nbsp;<span class="ident" id="3666812">Int</span><br>
<span class="lineno"></span><span class="op" id="3666816">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3666819">//&nbsp;NewRat&nbsp;creates&nbsp;a&nbsp;new&nbsp;Rat&nbsp;with&nbsp;numerator&nbsp;a&nbsp;and&nbsp;denominator&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3666883">func</span>&nbsp;<span class="ident" id="3666888">NewRat</span><span class="op" id="3666894">(</span><span class="ident" id="3666895">a</span><span class="op" id="3666896">,</span>&nbsp;<span class="ident" id="3666898">b</span>&nbsp;<span class="ident" id="3666900">int64</span><span class="op" id="3666905">)</span>&nbsp;<span class="op" id="3666907">*</span><span class="ident" id="3666908">Rat</span>&nbsp;<span class="op" id="3666912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3666915">return</span>&nbsp;<span class="builtinfunc" id="3666922">new</span><span class="op" id="3666925">(</span><span class="ident" id="3666926">Rat</span><span class="op" id="3666929">)</span><span class="op" id="3666930">.</span><span class="ident" id="3666931">SetFrac64</span><span class="op" id="3666940">(</span><span class="ident" id="3666941">a</span><span class="op" id="3666942">,</span>&nbsp;<span class="ident" id="3666944">b</span><span class="op" id="3666945">)</span><br>
<span class="lineno"></span><span class="op" id="3666947">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="3666950">//&nbsp;SetFloat64&nbsp;sets&nbsp;z&nbsp;to&nbsp;exactly&nbsp;f&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3666999">//&nbsp;If&nbsp;f&nbsp;is&nbsp;not&nbsp;finite,&nbsp;SetFloat&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3667044">func</span>&nbsp;<span class="op" id="3667049">(</span><span class="ident" id="3667050">z</span>&nbsp;<span class="op" id="3667052">*</span><span class="ident" id="3667053">Rat</span><span class="op" id="3667056">)</span>&nbsp;<span class="ident" id="3667058">SetFloat64</span><span class="op" id="3667068">(</span><span class="ident" id="3667069">f</span>&nbsp;<span class="builtintype" id="3667071">float64</span><span class="op" id="3667078">)</span>&nbsp;<span class="op" id="3667080">*</span><span class="ident" id="3667081">Rat</span>&nbsp;<span class="op" id="3667085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667088">const</span>&nbsp;<span class="ident" id="3667094">expMask</span>&nbsp;<span class="op" id="3667102">=</span>&nbsp;<span class="num" id="3667104">1</span><span class="op" id="3667105">&lt;&lt;</span><span class="num" id="3667107">11</span>&nbsp;<span class="op" id="3667110">-</span>&nbsp;<span class="num" id="3667112">1</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667115">bits</span>&nbsp;<span class="op" id="3667120">:=</span>&nbsp;<span class="ident" id="3667123">math</span><span class="op" id="3667127">.</span><span class="ident" id="3667128">Float64bits</span><span class="op" id="3667139">(</span><span class="ident" id="3667140">f</span><span class="op" id="3667141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667144">mantissa</span>&nbsp;<span class="op" id="3667153">:=</span>&nbsp;<span class="ident" id="3667156">bits</span>&nbsp;<span class="op" id="3667161">&amp;</span>&nbsp;<span class="op" id="3667163">(</span><span class="num" id="3667164">1</span><span class="op" id="3667165">&lt;&lt;</span><span class="num" id="3667167">52</span>&nbsp;<span class="op" id="3667170">-</span>&nbsp;<span class="num" id="3667172">1</span><span class="op" id="3667173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667176">exp</span>&nbsp;<span class="op" id="3667180">:=</span>&nbsp;<span class="builtintype" id="3667183">int</span><span class="op" id="3667186">(</span><span class="op" id="3667187">(</span><span class="ident" id="3667188">bits</span>&nbsp;<span class="op" id="3667193">&gt;&gt;</span>&nbsp;<span class="num" id="3667196">52</span><span class="op" id="3667198">)</span>&nbsp;<span class="op" id="3667200">&amp;</span>&nbsp;<span class="ident" id="3667202">expMask</span><span class="op" id="3667209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667212">switch</span>&nbsp;<span class="ident" id="3667219">exp</span>&nbsp;<span class="op" id="3667223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667226">case</span>&nbsp;<span class="ident" id="3667231">expMask</span><span class="op" id="3667238">:</span>&nbsp;<span class="comment" id="3667240">//&nbsp;non-finite</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667256">return</span>&nbsp;<span class="builtintype" id="3667263">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667268">case</span>&nbsp;<span class="num" id="3667273">0</span><span class="op" id="3667274">:</span>&nbsp;<span class="comment" id="3667276">//&nbsp;denormal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667290">exp</span>&nbsp;<span class="op" id="3667294">-=</span>&nbsp;<span class="num" id="3667297">1022</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667303">default</span><span class="op" id="3667310">:</span>&nbsp;<span class="comment" id="3667312">//&nbsp;normal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667324">mantissa</span>&nbsp;<span class="op" id="3667333">|=</span>&nbsp;<span class="num" id="3667336">1</span>&nbsp;<span class="op" id="3667338">&lt;&lt;</span>&nbsp;<span class="num" id="3667341">52</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667346">exp</span>&nbsp;<span class="op" id="3667350">-=</span>&nbsp;<span class="num" id="3667353">1023</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3667359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667363">shift</span>&nbsp;<span class="op" id="3667369">:=</span>&nbsp;<span class="num" id="3667372">52</span>&nbsp;<span class="op" id="3667375">-</span>&nbsp;<span class="ident" id="3667377">exp</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3667383">//&nbsp;Optimization&nbsp;(?):&nbsp;partially&nbsp;pre-normalise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667430">for</span>&nbsp;<span class="ident" id="3667434">mantissa</span><span class="op" id="3667442">&amp;</span><span class="num" id="3667443">1</span>&nbsp;<span class="op" id="3667445">==</span>&nbsp;<span class="num" id="3667448">0</span>&nbsp;<span class="op" id="3667450">&amp;&amp;</span>&nbsp;<span class="ident" id="3667453">shift</span>&nbsp;<span class="op" id="3667459">&gt;</span>&nbsp;<span class="num" id="3667461">0</span>&nbsp;<span class="op" id="3667463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667467">mantissa</span>&nbsp;<span class="op" id="3667476">&gt;&gt;=</span>&nbsp;<span class="num" id="3667480">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667484">shift</span><span class="op" id="3667489">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3667493">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667497">z</span><span class="op" id="3667498">.</span><span class="ident" id="3667499">a</span><span class="op" id="3667500">.</span><span class="ident" id="3667501">SetUint64</span><span class="op" id="3667510">(</span><span class="ident" id="3667511">mantissa</span><span class="op" id="3667519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667522">z</span><span class="op" id="3667523">.</span><span class="ident" id="3667524">a</span><span class="op" id="3667525">.</span><span class="ident" id="3667526">neg</span>&nbsp;<span class="op" id="3667530">=</span>&nbsp;<span class="ident" id="3667532">f</span>&nbsp;<span class="op" id="3667534">&lt;</span>&nbsp;<span class="num" id="3667536">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667539">z</span><span class="op" id="3667540">.</span><span class="ident" id="3667541">b</span><span class="op" id="3667542">.</span><span class="ident" id="3667543">Set</span><span class="op" id="3667546">(</span><span class="ident" id="3667547">intOne</span><span class="op" id="3667553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667556">if</span>&nbsp;<span class="ident" id="3667559">shift</span>&nbsp;<span class="op" id="3667565">&gt;</span>&nbsp;<span class="num" id="3667567">0</span>&nbsp;<span class="op" id="3667569">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667573">z</span><span class="op" id="3667574">.</span><span class="ident" id="3667575">b</span><span class="op" id="3667576">.</span><span class="ident" id="3667577">Lsh</span><span class="op" id="3667580">(</span><span class="op" id="3667581">&amp;</span><span class="ident" id="3667582">z</span><span class="op" id="3667583">.</span><span class="ident" id="3667584">b</span><span class="op" id="3667585">,</span>&nbsp;<span class="builtintype" id="3667587">uint</span><span class="op" id="3667591">(</span><span class="ident" id="3667592">shift</span><span class="op" id="3667597">)</span><span class="op" id="3667598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3667601">}</span>&nbsp;<span class="keyword" id="3667603">else</span>&nbsp;<span class="op" id="3667608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667612">z</span><span class="op" id="3667613">.</span><span class="ident" id="3667614">a</span><span class="op" id="3667615">.</span><span class="ident" id="3667616">Lsh</span><span class="op" id="3667619">(</span><span class="op" id="3667620">&amp;</span><span class="ident" id="3667621">z</span><span class="op" id="3667622">.</span><span class="ident" id="3667623">a</span><span class="op" id="3667624">,</span>&nbsp;<span class="builtintype" id="3667626">uint</span><span class="op" id="3667630">(</span><span class="op" id="3667631">-</span><span class="ident" id="3667632">shift</span><span class="op" id="3667637">)</span><span class="op" id="3667638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3667641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667644">return</span>&nbsp;<span class="ident" id="3667651">z</span><span class="op" id="3667652">.</span><span class="ident" id="3667653">norm</span><span class="op" id="3667657">(</span><span class="op" id="3667658">)</span><br>
<span class="lineno">65</span><span class="op" id="3667660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3667663">//&nbsp;quotToFloat32&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float32&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3667719">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3667774">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno">70</span><span class="comment" id="3667827">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="3667892">func</span>&nbsp;<span class="ident" id="3667897">quotToFloat32</span><span class="op" id="3667910">(</span><span class="ident" id="3667911">a</span><span class="op" id="3667912">,</span>&nbsp;<span class="ident" id="3667914">b</span>&nbsp;<span class="ident" id="3667916">nat</span><span class="op" id="3667919">)</span>&nbsp;<span class="op" id="3667921">(</span><span class="ident" id="3667922">f</span>&nbsp;<span class="builtintype" id="3667924">float32</span><span class="op" id="3667931">,</span>&nbsp;<span class="ident" id="3667933">exact</span>&nbsp;<span class="builtintype" id="3667939">bool</span><span class="op" id="3667943">)</span>&nbsp;<span class="op" id="3667945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3667948">const</span>&nbsp;<span class="op" id="3667954">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3667958">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3667982">Fsize</span>&nbsp;<span class="op" id="3667988">=</span>&nbsp;<span class="num" id="3667990">32</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3667996">//&nbsp;mantissa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668010">Msize</span>&nbsp;&nbsp;<span class="op" id="3668017">=</span>&nbsp;<span class="num" id="3668019">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668024">Msize1</span>&nbsp;<span class="op" id="3668031">=</span>&nbsp;<span class="ident" id="3668033">Msize</span>&nbsp;<span class="op" id="3668039">+</span>&nbsp;<span class="num" id="3668041">1</span>&nbsp;<span class="comment" id="3668043">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668065">Msize2</span>&nbsp;<span class="op" id="3668072">=</span>&nbsp;<span class="ident" id="3668074">Msize1</span>&nbsp;<span class="op" id="3668081">+</span>&nbsp;<span class="num" id="3668083">1</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3668088">//&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668102">Esize</span>&nbsp;<span class="op" id="3668108">=</span>&nbsp;<span class="ident" id="3668110">Fsize</span>&nbsp;<span class="op" id="3668116">-</span>&nbsp;<span class="ident" id="3668118">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668127">Ebias</span>&nbsp;<span class="op" id="3668133">=</span>&nbsp;<span class="num" id="3668135">1</span><span class="op" id="3668136">&lt;&lt;</span><span class="op" id="3668138">(</span><span class="ident" id="3668139">Esize</span><span class="op" id="3668144">-</span><span class="num" id="3668145">1</span><span class="op" id="3668146">)</span>&nbsp;<span class="op" id="3668148">-</span>&nbsp;<span class="num" id="3668150">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668154">Emin</span>&nbsp;&nbsp;<span class="op" id="3668160">=</span>&nbsp;<span class="num" id="3668162">1</span>&nbsp;<span class="op" id="3668164">-</span>&nbsp;<span class="ident" id="3668166">Ebias</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668174">Emax</span>&nbsp;&nbsp;<span class="op" id="3668180">=</span>&nbsp;<span class="ident" id="3668182">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3668189">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3668193">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668264">alen</span>&nbsp;<span class="op" id="3668269">:=</span>&nbsp;<span class="ident" id="3668272">a</span><span class="op" id="3668273">.</span><span class="ident" id="3668274">bitLen</span><span class="op" id="3668280">(</span><span class="op" id="3668281">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668284">if</span>&nbsp;<span class="ident" id="3668287">alen</span>&nbsp;<span class="op" id="3668292">==</span>&nbsp;<span class="num" id="3668295">0</span>&nbsp;<span class="op" id="3668297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668301">return</span>&nbsp;<span class="num" id="3668308">0</span><span class="op" id="3668309">,</span>&nbsp;<span class="builtintype" id="3668311">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3668317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668320">blen</span>&nbsp;<span class="op" id="3668325">:=</span>&nbsp;<span class="ident" id="3668328">b</span><span class="op" id="3668329">.</span><span class="ident" id="3668330">bitLen</span><span class="op" id="3668336">(</span><span class="op" id="3668337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668340">if</span>&nbsp;<span class="ident" id="3668343">blen</span>&nbsp;<span class="op" id="3668348">==</span>&nbsp;<span class="num" id="3668351">0</span>&nbsp;<span class="op" id="3668353">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3668357">panic</span><span class="op" id="3668362">(</span><span class="string" id="3668363">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3668381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3668384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3668388">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3668468">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3668548">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float32&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3668620">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3668682">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3668744">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668811">exp</span>&nbsp;<span class="op" id="3668815">:=</span>&nbsp;<span class="ident" id="3668818">alen</span>&nbsp;<span class="op" id="3668823">-</span>&nbsp;<span class="ident" id="3668825">blen</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668831">var</span>&nbsp;<span class="ident" id="3668835">a2</span><span class="op" id="3668837">,</span>&nbsp;<span class="ident" id="3668839">b2</span>&nbsp;<span class="ident" id="3668842">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668847">a2</span>&nbsp;<span class="op" id="3668850">=</span>&nbsp;<span class="ident" id="3668852">a2</span><span class="op" id="3668854">.</span><span class="ident" id="3668855">set</span><span class="op" id="3668858">(</span><span class="ident" id="3668859">a</span><span class="op" id="3668860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668863">b2</span>&nbsp;<span class="op" id="3668866">=</span>&nbsp;<span class="ident" id="3668868">b2</span><span class="op" id="3668870">.</span><span class="ident" id="3668871">set</span><span class="op" id="3668874">(</span><span class="ident" id="3668875">b</span><span class="op" id="3668876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3668879">if</span>&nbsp;<span class="ident" id="3668882">shift</span>&nbsp;<span class="op" id="3668888">:=</span>&nbsp;<span class="ident" id="3668891">Msize2</span>&nbsp;<span class="op" id="3668898">-</span>&nbsp;<span class="ident" id="3668900">exp</span><span class="op" id="3668903">;</span>&nbsp;<span class="ident" id="3668905">shift</span>&nbsp;<span class="op" id="3668911">&gt;</span>&nbsp;<span class="num" id="3668913">0</span>&nbsp;<span class="op" id="3668915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668919">a2</span>&nbsp;<span class="op" id="3668922">=</span>&nbsp;<span class="ident" id="3668924">a2</span><span class="op" id="3668926">.</span><span class="ident" id="3668927">shl</span><span class="op" id="3668930">(</span><span class="ident" id="3668931">a2</span><span class="op" id="3668933">,</span>&nbsp;<span class="builtintype" id="3668935">uint</span><span class="op" id="3668939">(</span><span class="ident" id="3668940">shift</span><span class="op" id="3668945">)</span><span class="op" id="3668946">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3668949">}</span>&nbsp;<span class="keyword" id="3668951">else</span>&nbsp;<span class="keyword" id="3668956">if</span>&nbsp;<span class="ident" id="3668959">shift</span>&nbsp;<span class="op" id="3668965">&lt;</span>&nbsp;<span class="num" id="3668967">0</span>&nbsp;<span class="op" id="3668969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3668973">b2</span>&nbsp;<span class="op" id="3668976">=</span>&nbsp;<span class="ident" id="3668978">b2</span><span class="op" id="3668980">.</span><span class="ident" id="3668981">shl</span><span class="op" id="3668984">(</span><span class="ident" id="3668985">b2</span><span class="op" id="3668987">,</span>&nbsp;<span class="builtintype" id="3668989">uint</span><span class="op" id="3668993">(</span><span class="op" id="3668994">-</span><span class="ident" id="3668995">shift</span><span class="op" id="3669000">)</span><span class="op" id="3669001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3669004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3669008">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3669070">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3669127">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3669152">var</span>&nbsp;<span class="ident" id="3669156">q</span>&nbsp;<span class="ident" id="3669158">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3669163">q</span><span class="op" id="3669164">,</span>&nbsp;<span class="ident" id="3669166">r</span>&nbsp;<span class="op" id="3669168">:=</span>&nbsp;<span class="ident" id="3669171">q</span><span class="op" id="3669172">.</span><span class="ident" id="3669173">div</span><span class="op" id="3669176">(</span><span class="ident" id="3669177">a2</span><span class="op" id="3669179">,</span>&nbsp;<span class="ident" id="3669181">a2</span><span class="op" id="3669183">,</span>&nbsp;<span class="ident" id="3669185">b2</span><span class="op" id="3669187">)</span>&nbsp;<span class="comment" id="3669189">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3669206">mantissa</span>&nbsp;<span class="op" id="3669215">:=</span>&nbsp;<span class="ident" id="3669218">low32</span><span class="op" id="3669223">(</span><span class="ident" id="3669224">q</span><span class="op" id="3669225">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3669228">haveRem</span>&nbsp;<span class="op" id="3669236">:=</span>&nbsp;<span class="builtinfunc" id="3669239">len</span><span class="op" id="3669242">(</span><span class="ident" id="3669243">r</span><span class="op" id="3669244">)</span>&nbsp;<span class="op" id="3669246">&gt;</span>&nbsp;<span class="num" id="3669248">0</span>&nbsp;<span class="comment" id="3669250">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3669307">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3669376">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3669428">if</span>&nbsp;<span class="ident" id="3669431">mantissa</span><span class="op" id="3669439">&gt;&gt;</span><span class="ident" id="3669441">Msize2</span>&nbsp;<span class="op" id="3669448">==</span>&nbsp;<span class="num" id="3669451">1</span>&nbsp;<span class="op" id="3669453">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3669457">if</span>&nbsp;<span class="ident" id="3669460">mantissa</span><span class="op" id="3669468">&amp;</span><span class="num" id="3669469">1</span>&nbsp;<span class="op" id="3669471">==</span>&nbsp;<span class="num" id="3669474">1</span>&nbsp;<span class="op" id="3669476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3669481">haveRem</span>&nbsp;<span class="op" id="3669489">=</span>&nbsp;<span class="builtintype" id="3669491">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3669498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3669502">mantissa</span>&nbsp;<span class="op" id="3669511">&gt;&gt;=</span>&nbsp;<span class="num" id="3669515">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3669519">exp</span><span class="op" id="3669522">++</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3669526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3669529">if</span>&nbsp;<span class="ident" id="3669532">mantissa</span><span class="op" id="3669540">&gt;&gt;</span><span class="ident" id="3669542">Msize1</span>&nbsp;<span class="op" id="3669549">!=</span>&nbsp;<span class="num" id="3669552">1</span>&nbsp;<span class="op" id="3669554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3669558">panic</span><span class="op" id="3669563">(</span><span class="ident" id="3669564">fmt</span><span class="op" id="3669567">.</span><span class="ident" id="3669568">Sprintf</span><span class="op" id="3669575">(</span><span class="string" id="3669576">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="3669612">,</span>&nbsp;<span class="ident" id="3669614">Msize2</span><span class="op" id="3669620">)</span><span class="op" id="3669621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3669624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3669628">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3669645">if</span>&nbsp;<span class="ident" id="3669648">Emin</span><span class="op" id="3669652">-</span><span class="ident" id="3669653">Msize</span>&nbsp;<span class="op" id="3669659">&lt;=</span>&nbsp;<span class="ident" id="3669662">exp</span>&nbsp;<span class="op" id="3669666">&amp;&amp;</span>&nbsp;<span class="ident" id="3669669">exp</span>&nbsp;<span class="op" id="3669673">&lt;=</span>&nbsp;<span class="ident" id="3669676">Emin</span>&nbsp;<span class="op" id="3669681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3669685">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3669737">shift</span>&nbsp;<span class="op" id="3669743">:=</span>&nbsp;<span class="builtintype" id="3669746">uint</span><span class="op" id="3669750">(</span><span class="ident" id="3669751">Emin</span>&nbsp;<span class="op" id="3669756">-</span>&nbsp;<span class="op" id="3669758">(</span><span class="ident" id="3669759">exp</span>&nbsp;<span class="op" id="3669763">-</span>&nbsp;<span class="num" id="3669765">1</span><span class="op" id="3669766">)</span><span class="op" id="3669767">)</span>&nbsp;<span class="comment" id="3669769">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3669786">lostbits</span>&nbsp;<span class="op" id="3669795">:=</span>&nbsp;<span class="ident" id="3669798">mantissa</span>&nbsp;<span class="op" id="3669807">&amp;</span>&nbsp;<span class="op" id="3669809">(</span><span class="num" id="3669810">1</span><span class="op" id="3669811">&lt;&lt;</span><span class="ident" id="3669813">shift</span>&nbsp;<span class="op" id="3669819">-</span>&nbsp;<span class="num" id="3669821">1</span><span class="op" id="3669822">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3669826">haveRem</span>&nbsp;<span class="op" id="3669834">=</span>&nbsp;<span class="ident" id="3669836">haveRem</span>&nbsp;<span class="op" id="3669844">||</span>&nbsp;<span class="ident" id="3669847">lostbits</span>&nbsp;<span class="op" id="3669856">!=</span>&nbsp;<span class="num" id="3669859">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3669863">mantissa</span>&nbsp;<span class="op" id="3669872">&gt;&gt;=</span>&nbsp;<span class="ident" id="3669876">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3669884">exp</span>&nbsp;<span class="op" id="3669888">=</span>&nbsp;<span class="num" id="3669890">2</span>&nbsp;<span class="op" id="3669892">-</span>&nbsp;<span class="ident" id="3669894">Ebias</span>&nbsp;<span class="comment" id="3669900">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3669919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3669922">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3669960">exact</span>&nbsp;<span class="op" id="3669966">=</span>&nbsp;<span class="op" id="3669968">!</span><span class="ident" id="3669969">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3669978">if</span>&nbsp;<span class="ident" id="3669981">mantissa</span><span class="op" id="3669989">&amp;</span><span class="num" id="3669990">1</span>&nbsp;<span class="op" id="3669992">!=</span>&nbsp;<span class="num" id="3669995">0</span>&nbsp;<span class="op" id="3669997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670001">exact</span>&nbsp;<span class="op" id="3670007">=</span>&nbsp;<span class="builtintype" id="3670009">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3670017">if</span>&nbsp;<span class="ident" id="3670020">haveRem</span>&nbsp;<span class="op" id="3670028">||</span>&nbsp;<span class="ident" id="3670031">mantissa</span><span class="op" id="3670039">&amp;</span><span class="num" id="3670040">2</span>&nbsp;<span class="op" id="3670042">!=</span>&nbsp;<span class="num" id="3670045">0</span>&nbsp;<span class="op" id="3670047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3670052">if</span>&nbsp;<span class="ident" id="3670055">mantissa</span><span class="op" id="3670063">++</span><span class="op" id="3670065">;</span>&nbsp;<span class="ident" id="3670067">mantissa</span>&nbsp;<span class="op" id="3670076">&gt;=</span>&nbsp;<span class="num" id="3670079">1</span><span class="op" id="3670080">&lt;&lt;</span><span class="ident" id="3670082">Msize2</span>&nbsp;<span class="op" id="3670089">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3670095">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670156">mantissa</span>&nbsp;<span class="op" id="3670165">&gt;&gt;=</span>&nbsp;<span class="num" id="3670169">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670175">exp</span><span class="op" id="3670178">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3670184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3670188">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3670191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670194">mantissa</span>&nbsp;<span class="op" id="3670203">&gt;&gt;=</span>&nbsp;<span class="num" id="3670207">1</span>&nbsp;<span class="comment" id="3670209">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670271">f</span>&nbsp;<span class="op" id="3670273">=</span>&nbsp;<span class="builtintype" id="3670275">float32</span><span class="op" id="3670282">(</span><span class="ident" id="3670283">math</span><span class="op" id="3670287">.</span><span class="ident" id="3670288">Ldexp</span><span class="op" id="3670293">(</span><span class="builtintype" id="3670294">float64</span><span class="op" id="3670301">(</span><span class="ident" id="3670302">mantissa</span><span class="op" id="3670310">)</span><span class="op" id="3670311">,</span>&nbsp;<span class="ident" id="3670313">exp</span><span class="op" id="3670316">-</span><span class="ident" id="3670317">Msize1</span><span class="op" id="3670323">)</span><span class="op" id="3670324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3670327">if</span>&nbsp;<span class="ident" id="3670330">math</span><span class="op" id="3670334">.</span><span class="ident" id="3670335">IsInf</span><span class="op" id="3670340">(</span><span class="builtintype" id="3670341">float64</span><span class="op" id="3670348">(</span><span class="ident" id="3670349">f</span><span class="op" id="3670350">)</span><span class="op" id="3670351">,</span>&nbsp;<span class="num" id="3670353">0</span><span class="op" id="3670354">)</span>&nbsp;<span class="op" id="3670356">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670360">exact</span>&nbsp;<span class="op" id="3670366">=</span>&nbsp;<span class="builtintype" id="3670368">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3670375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3670378">return</span><br>
<span class="lineno"></span><span class="op" id="3670385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3670388">//&nbsp;quotToFloat64&nbsp;returns&nbsp;the&nbsp;non-negative&nbsp;float64&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3670444">//&nbsp;nearest&nbsp;to&nbsp;the&nbsp;quotient&nbsp;a/b,&nbsp;using&nbsp;round-to-even&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3670499">//&nbsp;halfway&nbsp;cases.&nbsp;&nbsp;It&nbsp;does&nbsp;not&nbsp;mutate&nbsp;its&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="3670552">//&nbsp;Preconditions:&nbsp;b&nbsp;is&nbsp;non-zero;&nbsp;a&nbsp;and&nbsp;b&nbsp;have&nbsp;no&nbsp;common&nbsp;factors.</span><br>
<span class="lineno"></span><span class="keyword" id="3670617">func</span>&nbsp;<span class="ident" id="3670622">quotToFloat64</span><span class="op" id="3670635">(</span><span class="ident" id="3670636">a</span><span class="op" id="3670637">,</span>&nbsp;<span class="ident" id="3670639">b</span>&nbsp;<span class="ident" id="3670641">nat</span><span class="op" id="3670644">)</span>&nbsp;<span class="op" id="3670646">(</span><span class="ident" id="3670647">f</span>&nbsp;<span class="builtintype" id="3670649">float64</span><span class="op" id="3670656">,</span>&nbsp;<span class="ident" id="3670658">exact</span>&nbsp;<span class="builtintype" id="3670664">bool</span><span class="op" id="3670668">)</span>&nbsp;<span class="op" id="3670670">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3670673">const</span>&nbsp;<span class="op" id="3670679">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3670683">//&nbsp;float&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670707">Fsize</span>&nbsp;<span class="op" id="3670713">=</span>&nbsp;<span class="num" id="3670715">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3670721">//&nbsp;mantissa</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670735">Msize</span>&nbsp;&nbsp;<span class="op" id="3670742">=</span>&nbsp;<span class="num" id="3670744">52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670749">Msize1</span>&nbsp;<span class="op" id="3670756">=</span>&nbsp;<span class="ident" id="3670758">Msize</span>&nbsp;<span class="op" id="3670764">+</span>&nbsp;<span class="num" id="3670766">1</span>&nbsp;<span class="comment" id="3670768">//&nbsp;incl.&nbsp;implicit&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670790">Msize2</span>&nbsp;<span class="op" id="3670797">=</span>&nbsp;<span class="ident" id="3670799">Msize1</span>&nbsp;<span class="op" id="3670806">+</span>&nbsp;<span class="num" id="3670808">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3670813">//&nbsp;exponent</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670827">Esize</span>&nbsp;<span class="op" id="3670833">=</span>&nbsp;<span class="ident" id="3670835">Fsize</span>&nbsp;<span class="op" id="3670841">-</span>&nbsp;<span class="ident" id="3670843">Msize1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670852">Ebias</span>&nbsp;<span class="op" id="3670858">=</span>&nbsp;<span class="num" id="3670860">1</span><span class="op" id="3670861">&lt;&lt;</span><span class="op" id="3670863">(</span><span class="ident" id="3670864">Esize</span><span class="op" id="3670869">-</span><span class="num" id="3670870">1</span><span class="op" id="3670871">)</span>&nbsp;<span class="op" id="3670873">-</span>&nbsp;<span class="num" id="3670875">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670879">Emin</span>&nbsp;&nbsp;<span class="op" id="3670885">=</span>&nbsp;<span class="num" id="3670887">1</span>&nbsp;<span class="op" id="3670889">-</span>&nbsp;<span class="ident" id="3670891">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670899">Emax</span>&nbsp;&nbsp;<span class="op" id="3670905">=</span>&nbsp;<span class="ident" id="3670907">Ebias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3670914">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3670918">//&nbsp;TODO(adonovan):&nbsp;specialize&nbsp;common&nbsp;degenerate&nbsp;cases:&nbsp;1.0,&nbsp;integers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3670989">alen</span>&nbsp;<span class="op" id="3670994">:=</span>&nbsp;<span class="ident" id="3670997">a</span><span class="op" id="3670998">.</span><span class="ident" id="3670999">bitLen</span><span class="op" id="3671005">(</span><span class="op" id="3671006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3671009">if</span>&nbsp;<span class="ident" id="3671012">alen</span>&nbsp;<span class="op" id="3671017">==</span>&nbsp;<span class="num" id="3671020">0</span>&nbsp;<span class="op" id="3671022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3671026">return</span>&nbsp;<span class="num" id="3671033">0</span><span class="op" id="3671034">,</span>&nbsp;<span class="builtintype" id="3671036">true</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3671042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3671045">blen</span>&nbsp;<span class="op" id="3671050">:=</span>&nbsp;<span class="ident" id="3671053">b</span><span class="op" id="3671054">.</span><span class="ident" id="3671055">bitLen</span><span class="op" id="3671061">(</span><span class="op" id="3671062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3671065">if</span>&nbsp;<span class="ident" id="3671068">blen</span>&nbsp;<span class="op" id="3671073">==</span>&nbsp;<span class="num" id="3671076">0</span>&nbsp;<span class="op" id="3671078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3671082">panic</span><span class="op" id="3671087">(</span><span class="string" id="3671088">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3671106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3671109">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3671113">//&nbsp;1.&nbsp;Left-shift&nbsp;A&nbsp;or&nbsp;B&nbsp;such&nbsp;that&nbsp;quotient&nbsp;A/B&nbsp;is&nbsp;in&nbsp;[1&lt;&lt;Msize1,&nbsp;1&lt;&lt;(Msize2+1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3671193">//&nbsp;(Msize2&nbsp;bits&nbsp;if&nbsp;A&nbsp;&lt;&nbsp;B&nbsp;when&nbsp;they&nbsp;are&nbsp;left-aligned,&nbsp;Msize2+1&nbsp;bits&nbsp;if&nbsp;A&nbsp;&gt;=&nbsp;B).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3671273">//&nbsp;This&nbsp;is&nbsp;2&nbsp;or&nbsp;3&nbsp;more&nbsp;than&nbsp;the&nbsp;float64&nbsp;mantissa&nbsp;field&nbsp;width&nbsp;of&nbsp;Msize:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3671345">//&nbsp;-&nbsp;the&nbsp;optional&nbsp;extra&nbsp;bit&nbsp;is&nbsp;shifted&nbsp;away&nbsp;in&nbsp;step&nbsp;3&nbsp;below.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3671407">//&nbsp;-&nbsp;the&nbsp;high-order&nbsp;1&nbsp;is&nbsp;omitted&nbsp;in&nbsp;&#34;normal&#34;&nbsp;representation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3671469">//&nbsp;-&nbsp;the&nbsp;low-order&nbsp;1&nbsp;will&nbsp;be&nbsp;used&nbsp;during&nbsp;rounding&nbsp;then&nbsp;discarded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3671536">exp</span>&nbsp;<span class="op" id="3671540">:=</span>&nbsp;<span class="ident" id="3671543">alen</span>&nbsp;<span class="op" id="3671548">-</span>&nbsp;<span class="ident" id="3671550">blen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3671556">var</span>&nbsp;<span class="ident" id="3671560">a2</span><span class="op" id="3671562">,</span>&nbsp;<span class="ident" id="3671564">b2</span>&nbsp;<span class="ident" id="3671567">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3671572">a2</span>&nbsp;<span class="op" id="3671575">=</span>&nbsp;<span class="ident" id="3671577">a2</span><span class="op" id="3671579">.</span><span class="ident" id="3671580">set</span><span class="op" id="3671583">(</span><span class="ident" id="3671584">a</span><span class="op" id="3671585">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3671588">b2</span>&nbsp;<span class="op" id="3671591">=</span>&nbsp;<span class="ident" id="3671593">b2</span><span class="op" id="3671595">.</span><span class="ident" id="3671596">set</span><span class="op" id="3671599">(</span><span class="ident" id="3671600">b</span><span class="op" id="3671601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3671604">if</span>&nbsp;<span class="ident" id="3671607">shift</span>&nbsp;<span class="op" id="3671613">:=</span>&nbsp;<span class="ident" id="3671616">Msize2</span>&nbsp;<span class="op" id="3671623">-</span>&nbsp;<span class="ident" id="3671625">exp</span><span class="op" id="3671628">;</span>&nbsp;<span class="ident" id="3671630">shift</span>&nbsp;<span class="op" id="3671636">&gt;</span>&nbsp;<span class="num" id="3671638">0</span>&nbsp;<span class="op" id="3671640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3671644">a2</span>&nbsp;<span class="op" id="3671647">=</span>&nbsp;<span class="ident" id="3671649">a2</span><span class="op" id="3671651">.</span><span class="ident" id="3671652">shl</span><span class="op" id="3671655">(</span><span class="ident" id="3671656">a2</span><span class="op" id="3671658">,</span>&nbsp;<span class="builtintype" id="3671660">uint</span><span class="op" id="3671664">(</span><span class="ident" id="3671665">shift</span><span class="op" id="3671670">)</span><span class="op" id="3671671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3671674">}</span>&nbsp;<span class="keyword" id="3671676">else</span>&nbsp;<span class="keyword" id="3671681">if</span>&nbsp;<span class="ident" id="3671684">shift</span>&nbsp;<span class="op" id="3671690">&lt;</span>&nbsp;<span class="num" id="3671692">0</span>&nbsp;<span class="op" id="3671694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3671698">b2</span>&nbsp;<span class="op" id="3671701">=</span>&nbsp;<span class="ident" id="3671703">b2</span><span class="op" id="3671705">.</span><span class="ident" id="3671706">shl</span><span class="op" id="3671709">(</span><span class="ident" id="3671710">b2</span><span class="op" id="3671712">,</span>&nbsp;<span class="builtintype" id="3671714">uint</span><span class="op" id="3671718">(</span><span class="op" id="3671719">-</span><span class="ident" id="3671720">shift</span><span class="op" id="3671725">)</span><span class="op" id="3671726">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3671729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3671733">//&nbsp;2.&nbsp;Compute&nbsp;quotient&nbsp;and&nbsp;remainder&nbsp;(q,&nbsp;r).&nbsp;&nbsp;NB:&nbsp;due&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3671795">//&nbsp;extra&nbsp;shift,&nbsp;the&nbsp;low-order&nbsp;bit&nbsp;of&nbsp;q&nbsp;is&nbsp;logically&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3671852">//&nbsp;high-order&nbsp;bit&nbsp;of&nbsp;r.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3671877">var</span>&nbsp;<span class="ident" id="3671881">q</span>&nbsp;<span class="ident" id="3671883">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3671888">q</span><span class="op" id="3671889">,</span>&nbsp;<span class="ident" id="3671891">r</span>&nbsp;<span class="op" id="3671893">:=</span>&nbsp;<span class="ident" id="3671896">q</span><span class="op" id="3671897">.</span><span class="ident" id="3671898">div</span><span class="op" id="3671901">(</span><span class="ident" id="3671902">a2</span><span class="op" id="3671904">,</span>&nbsp;<span class="ident" id="3671906">a2</span><span class="op" id="3671908">,</span>&nbsp;<span class="ident" id="3671910">b2</span><span class="op" id="3671912">)</span>&nbsp;<span class="comment" id="3671914">//&nbsp;(recycle&nbsp;a2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3671931">mantissa</span>&nbsp;<span class="op" id="3671940">:=</span>&nbsp;<span class="ident" id="3671943">low64</span><span class="op" id="3671948">(</span><span class="ident" id="3671949">q</span><span class="op" id="3671950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3671953">haveRem</span>&nbsp;<span class="op" id="3671961">:=</span>&nbsp;<span class="builtinfunc" id="3671964">len</span><span class="op" id="3671967">(</span><span class="ident" id="3671968">r</span><span class="op" id="3671969">)</span>&nbsp;<span class="op" id="3671971">&gt;</span>&nbsp;<span class="num" id="3671973">0</span>&nbsp;<span class="comment" id="3671975">//&nbsp;mantissa&amp;1&nbsp;&amp;&amp;&nbsp;!haveRem&nbsp;=&gt;&nbsp;remainder&nbsp;is&nbsp;exactly&nbsp;half</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3672032">//&nbsp;3.&nbsp;If&nbsp;quotient&nbsp;didn&#39;t&nbsp;fit&nbsp;in&nbsp;Msize2&nbsp;bits,&nbsp;redo&nbsp;division&nbsp;by&nbsp;b2&lt;&lt;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3672101">//&nbsp;(in&nbsp;effect---we&nbsp;accomplish&nbsp;this&nbsp;incrementally).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3672153">if</span>&nbsp;<span class="ident" id="3672156">mantissa</span><span class="op" id="3672164">&gt;&gt;</span><span class="ident" id="3672166">Msize2</span>&nbsp;<span class="op" id="3672173">==</span>&nbsp;<span class="num" id="3672176">1</span>&nbsp;<span class="op" id="3672178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3672182">if</span>&nbsp;<span class="ident" id="3672185">mantissa</span><span class="op" id="3672193">&amp;</span><span class="num" id="3672194">1</span>&nbsp;<span class="op" id="3672196">==</span>&nbsp;<span class="num" id="3672199">1</span>&nbsp;<span class="op" id="3672201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3672206">haveRem</span>&nbsp;<span class="op" id="3672214">=</span>&nbsp;<span class="builtintype" id="3672216">true</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3672223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3672227">mantissa</span>&nbsp;<span class="op" id="3672236">&gt;&gt;=</span>&nbsp;<span class="num" id="3672240">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3672244">exp</span><span class="op" id="3672247">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3672251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3672254">if</span>&nbsp;<span class="ident" id="3672257">mantissa</span><span class="op" id="3672265">&gt;&gt;</span><span class="ident" id="3672267">Msize1</span>&nbsp;<span class="op" id="3672274">!=</span>&nbsp;<span class="num" id="3672277">1</span>&nbsp;<span class="op" id="3672279">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3672283">panic</span><span class="op" id="3672288">(</span><span class="ident" id="3672289">fmt</span><span class="op" id="3672292">.</span><span class="ident" id="3672293">Sprintf</span><span class="op" id="3672300">(</span><span class="string" id="3672301">&#34;expected&nbsp;exactly&nbsp;%d&nbsp;bits&nbsp;of&nbsp;result&#34;</span><span class="op" id="3672337">,</span>&nbsp;<span class="ident" id="3672339">Msize2</span><span class="op" id="3672345">)</span><span class="op" id="3672346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3672349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3672353">//&nbsp;4.&nbsp;Rounding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3672370">if</span>&nbsp;<span class="ident" id="3672373">Emin</span><span class="op" id="3672377">-</span><span class="ident" id="3672378">Msize</span>&nbsp;<span class="op" id="3672384">&lt;=</span>&nbsp;<span class="ident" id="3672387">exp</span>&nbsp;<span class="op" id="3672391">&amp;&amp;</span>&nbsp;<span class="ident" id="3672394">exp</span>&nbsp;<span class="op" id="3672398">&lt;=</span>&nbsp;<span class="ident" id="3672401">Emin</span>&nbsp;<span class="op" id="3672406">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3672410">//&nbsp;Denormal&nbsp;case;&nbsp;lose&nbsp;&#39;shift&#39;&nbsp;bits&nbsp;of&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3672462">shift</span>&nbsp;<span class="op" id="3672468">:=</span>&nbsp;<span class="builtintype" id="3672471">uint</span><span class="op" id="3672475">(</span><span class="ident" id="3672476">Emin</span>&nbsp;<span class="op" id="3672481">-</span>&nbsp;<span class="op" id="3672483">(</span><span class="ident" id="3672484">exp</span>&nbsp;<span class="op" id="3672488">-</span>&nbsp;<span class="num" id="3672490">1</span><span class="op" id="3672491">)</span><span class="op" id="3672492">)</span>&nbsp;<span class="comment" id="3672494">//&nbsp;[1..Esize1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3672511">lostbits</span>&nbsp;<span class="op" id="3672520">:=</span>&nbsp;<span class="ident" id="3672523">mantissa</span>&nbsp;<span class="op" id="3672532">&amp;</span>&nbsp;<span class="op" id="3672534">(</span><span class="num" id="3672535">1</span><span class="op" id="3672536">&lt;&lt;</span><span class="ident" id="3672538">shift</span>&nbsp;<span class="op" id="3672544">-</span>&nbsp;<span class="num" id="3672546">1</span><span class="op" id="3672547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3672551">haveRem</span>&nbsp;<span class="op" id="3672559">=</span>&nbsp;<span class="ident" id="3672561">haveRem</span>&nbsp;<span class="op" id="3672569">||</span>&nbsp;<span class="ident" id="3672572">lostbits</span>&nbsp;<span class="op" id="3672581">!=</span>&nbsp;<span class="num" id="3672584">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3672588">mantissa</span>&nbsp;<span class="op" id="3672597">&gt;&gt;=</span>&nbsp;<span class="ident" id="3672601">shift</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3672609">exp</span>&nbsp;<span class="op" id="3672613">=</span>&nbsp;<span class="num" id="3672615">2</span>&nbsp;<span class="op" id="3672617">-</span>&nbsp;<span class="ident" id="3672619">Ebias</span>&nbsp;<span class="comment" id="3672625">//&nbsp;==&nbsp;exp&nbsp;+&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3672644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3672647">//&nbsp;Round&nbsp;q&nbsp;using&nbsp;round-half-to-even.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3672685">exact</span>&nbsp;<span class="op" id="3672691">=</span>&nbsp;<span class="op" id="3672693">!</span><span class="ident" id="3672694">haveRem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3672703">if</span>&nbsp;<span class="ident" id="3672706">mantissa</span><span class="op" id="3672714">&amp;</span><span class="num" id="3672715">1</span>&nbsp;<span class="op" id="3672717">!=</span>&nbsp;<span class="num" id="3672720">0</span>&nbsp;<span class="op" id="3672722">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3672726">exact</span>&nbsp;<span class="op" id="3672732">=</span>&nbsp;<span class="builtintype" id="3672734">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3672742">if</span>&nbsp;<span class="ident" id="3672745">haveRem</span>&nbsp;<span class="op" id="3672753">||</span>&nbsp;<span class="ident" id="3672756">mantissa</span><span class="op" id="3672764">&amp;</span><span class="num" id="3672765">2</span>&nbsp;<span class="op" id="3672767">!=</span>&nbsp;<span class="num" id="3672770">0</span>&nbsp;<span class="op" id="3672772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3672777">if</span>&nbsp;<span class="ident" id="3672780">mantissa</span><span class="op" id="3672788">++</span><span class="op" id="3672790">;</span>&nbsp;<span class="ident" id="3672792">mantissa</span>&nbsp;<span class="op" id="3672801">&gt;=</span>&nbsp;<span class="num" id="3672804">1</span><span class="op" id="3672805">&lt;&lt;</span><span class="ident" id="3672807">Msize2</span>&nbsp;<span class="op" id="3672814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3672820">//&nbsp;Complete&nbsp;rollover&nbsp;11...1&nbsp;=&gt;&nbsp;100...0,&nbsp;so&nbsp;shift&nbsp;is&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3672881">mantissa</span>&nbsp;<span class="op" id="3672890">&gt;&gt;=</span>&nbsp;<span class="num" id="3672894">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3672900">exp</span><span class="op" id="3672903">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3672909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3672913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3672916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3672919">mantissa</span>&nbsp;<span class="op" id="3672928">&gt;&gt;=</span>&nbsp;<span class="num" id="3672932">1</span>&nbsp;<span class="comment" id="3672934">//&nbsp;discard&nbsp;rounding&nbsp;bit.&nbsp;&nbsp;Mantissa&nbsp;now&nbsp;scaled&nbsp;by&nbsp;1&lt;&lt;Msize1.</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3672996">f</span>&nbsp;<span class="op" id="3672998">=</span>&nbsp;<span class="ident" id="3673000">math</span><span class="op" id="3673004">.</span><span class="ident" id="3673005">Ldexp</span><span class="op" id="3673010">(</span><span class="builtintype" id="3673011">float64</span><span class="op" id="3673018">(</span><span class="ident" id="3673019">mantissa</span><span class="op" id="3673027">)</span><span class="op" id="3673028">,</span>&nbsp;<span class="ident" id="3673030">exp</span><span class="op" id="3673033">-</span><span class="ident" id="3673034">Msize1</span><span class="op" id="3673040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3673043">if</span>&nbsp;<span class="ident" id="3673046">math</span><span class="op" id="3673050">.</span><span class="ident" id="3673051">IsInf</span><span class="op" id="3673056">(</span><span class="ident" id="3673057">f</span><span class="op" id="3673058">,</span>&nbsp;<span class="num" id="3673060">0</span><span class="op" id="3673061">)</span>&nbsp;<span class="op" id="3673063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3673067">exact</span>&nbsp;<span class="op" id="3673073">=</span>&nbsp;<span class="builtintype" id="3673075">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3673082">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3673085">return</span><br>
<span class="lineno"></span><span class="op" id="3673092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3673095">//&nbsp;Float32&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float32&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="3673168">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno">265</span><span class="comment" id="3673241">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float32,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3673310">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3673373">func</span>&nbsp;<span class="op" id="3673378">(</span><span class="ident" id="3673379">x</span>&nbsp;<span class="op" id="3673381">*</span><span class="ident" id="3673382">Rat</span><span class="op" id="3673385">)</span>&nbsp;<span class="ident" id="3673387">Float32</span><span class="op" id="3673394">(</span><span class="op" id="3673395">)</span>&nbsp;<span class="op" id="3673397">(</span><span class="ident" id="3673398">f</span>&nbsp;<span class="builtintype" id="3673400">float32</span><span class="op" id="3673407">,</span>&nbsp;<span class="ident" id="3673409">exact</span>&nbsp;<span class="builtintype" id="3673415">bool</span><span class="op" id="3673419">)</span>&nbsp;<span class="op" id="3673421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3673424">b</span>&nbsp;<span class="op" id="3673426">:=</span>&nbsp;<span class="ident" id="3673429">x</span><span class="op" id="3673430">.</span><span class="ident" id="3673431">b</span><span class="op" id="3673432">.</span><span class="ident" id="3673433">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3673438">if</span>&nbsp;<span class="builtinfunc" id="3673441">len</span><span class="op" id="3673444">(</span><span class="ident" id="3673445">b</span><span class="op" id="3673446">)</span>&nbsp;<span class="op" id="3673448">==</span>&nbsp;<span class="num" id="3673451">0</span>&nbsp;<span class="op" id="3673453">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3673457">b</span>&nbsp;<span class="op" id="3673459">=</span>&nbsp;<span class="ident" id="3673461">b</span><span class="op" id="3673462">.</span><span class="ident" id="3673463">set</span><span class="op" id="3673466">(</span><span class="ident" id="3673467">natOne</span><span class="op" id="3673473">)</span>&nbsp;<span class="comment" id="3673475">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3673503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3673506">f</span><span class="op" id="3673507">,</span>&nbsp;<span class="ident" id="3673509">exact</span>&nbsp;<span class="op" id="3673515">=</span>&nbsp;<span class="ident" id="3673517">quotToFloat32</span><span class="op" id="3673530">(</span><span class="ident" id="3673531">x</span><span class="op" id="3673532">.</span><span class="ident" id="3673533">a</span><span class="op" id="3673534">.</span><span class="ident" id="3673535">abs</span><span class="op" id="3673538">,</span>&nbsp;<span class="ident" id="3673540">b</span><span class="op" id="3673541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3673544">if</span>&nbsp;<span class="ident" id="3673547">x</span><span class="op" id="3673548">.</span><span class="ident" id="3673549">a</span><span class="op" id="3673550">.</span><span class="ident" id="3673551">neg</span>&nbsp;<span class="op" id="3673555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3673559">f</span>&nbsp;<span class="op" id="3673561">=</span>&nbsp;<span class="op" id="3673563">-</span><span class="ident" id="3673564">f</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3673567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3673570">return</span><br>
<span class="lineno"></span><span class="op" id="3673577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3673580">//&nbsp;Float64&nbsp;returns&nbsp;the&nbsp;nearest&nbsp;float64&nbsp;value&nbsp;for&nbsp;x&nbsp;and&nbsp;a&nbsp;bool&nbsp;indicating</span><br>
<span class="lineno">280</span><span class="comment" id="3673653">//&nbsp;whether&nbsp;f&nbsp;represents&nbsp;x&nbsp;exactly.&nbsp;If&nbsp;the&nbsp;magnitude&nbsp;of&nbsp;x&nbsp;is&nbsp;too&nbsp;large&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3673726">//&nbsp;be&nbsp;represented&nbsp;by&nbsp;a&nbsp;float64,&nbsp;f&nbsp;is&nbsp;an&nbsp;infinity&nbsp;and&nbsp;exact&nbsp;is&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3673795">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;f&nbsp;always&nbsp;matches&nbsp;the&nbsp;sign&nbsp;of&nbsp;x,&nbsp;even&nbsp;if&nbsp;f&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3673858">func</span>&nbsp;<span class="op" id="3673863">(</span><span class="ident" id="3673864">x</span>&nbsp;<span class="op" id="3673866">*</span><span class="ident" id="3673867">Rat</span><span class="op" id="3673870">)</span>&nbsp;<span class="ident" id="3673872">Float64</span><span class="op" id="3673879">(</span><span class="op" id="3673880">)</span>&nbsp;<span class="op" id="3673882">(</span><span class="ident" id="3673883">f</span>&nbsp;<span class="builtintype" id="3673885">float64</span><span class="op" id="3673892">,</span>&nbsp;<span class="ident" id="3673894">exact</span>&nbsp;<span class="builtintype" id="3673900">bool</span><span class="op" id="3673904">)</span>&nbsp;<span class="op" id="3673906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3673909">b</span>&nbsp;<span class="op" id="3673911">:=</span>&nbsp;<span class="ident" id="3673914">x</span><span class="op" id="3673915">.</span><span class="ident" id="3673916">b</span><span class="op" id="3673917">.</span><span class="ident" id="3673918">abs</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3673923">if</span>&nbsp;<span class="builtinfunc" id="3673926">len</span><span class="op" id="3673929">(</span><span class="ident" id="3673930">b</span><span class="op" id="3673931">)</span>&nbsp;<span class="op" id="3673933">==</span>&nbsp;<span class="num" id="3673936">0</span>&nbsp;<span class="op" id="3673938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3673942">b</span>&nbsp;<span class="op" id="3673944">=</span>&nbsp;<span class="ident" id="3673946">b</span><span class="op" id="3673947">.</span><span class="ident" id="3673948">set</span><span class="op" id="3673951">(</span><span class="ident" id="3673952">natOne</span><span class="op" id="3673958">)</span>&nbsp;<span class="comment" id="3673960">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3673988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3673991">f</span><span class="op" id="3673992">,</span>&nbsp;<span class="ident" id="3673994">exact</span>&nbsp;<span class="op" id="3674000">=</span>&nbsp;<span class="ident" id="3674002">quotToFloat64</span><span class="op" id="3674015">(</span><span class="ident" id="3674016">x</span><span class="op" id="3674017">.</span><span class="ident" id="3674018">a</span><span class="op" id="3674019">.</span><span class="ident" id="3674020">abs</span><span class="op" id="3674023">,</span>&nbsp;<span class="ident" id="3674025">b</span><span class="op" id="3674026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3674029">if</span>&nbsp;<span class="ident" id="3674032">x</span><span class="op" id="3674033">.</span><span class="ident" id="3674034">a</span><span class="op" id="3674035">.</span><span class="ident" id="3674036">neg</span>&nbsp;<span class="op" id="3674040">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3674044">f</span>&nbsp;<span class="op" id="3674046">=</span>&nbsp;<span class="op" id="3674048">-</span><span class="ident" id="3674049">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3674052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3674055">return</span><br>
<span class="lineno"></span><span class="op" id="3674062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="3674065">//&nbsp;SetFrac&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3674105">func</span>&nbsp;<span class="op" id="3674110">(</span><span class="ident" id="3674111">z</span>&nbsp;<span class="op" id="3674113">*</span><span class="ident" id="3674114">Rat</span><span class="op" id="3674117">)</span>&nbsp;<span class="ident" id="3674119">SetFrac</span><span class="op" id="3674126">(</span><span class="ident" id="3674127">a</span><span class="op" id="3674128">,</span>&nbsp;<span class="ident" id="3674130">b</span>&nbsp;<span class="op" id="3674132">*</span><span class="ident" id="3674133">Int</span><span class="op" id="3674136">)</span>&nbsp;<span class="op" id="3674138">*</span><span class="ident" id="3674139">Rat</span>&nbsp;<span class="op" id="3674143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3674146">z</span><span class="op" id="3674147">.</span><span class="ident" id="3674148">a</span><span class="op" id="3674149">.</span><span class="ident" id="3674150">neg</span>&nbsp;<span class="op" id="3674154">=</span>&nbsp;<span class="ident" id="3674156">a</span><span class="op" id="3674157">.</span><span class="ident" id="3674158">neg</span>&nbsp;<span class="op" id="3674162">!=</span>&nbsp;<span class="ident" id="3674165">b</span><span class="op" id="3674166">.</span><span class="ident" id="3674167">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3674172">babs</span>&nbsp;<span class="op" id="3674177">:=</span>&nbsp;<span class="ident" id="3674180">b</span><span class="op" id="3674181">.</span><span class="ident" id="3674182">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3674187">if</span>&nbsp;<span class="builtinfunc" id="3674190">len</span><span class="op" id="3674193">(</span><span class="ident" id="3674194">babs</span><span class="op" id="3674198">)</span>&nbsp;<span class="op" id="3674200">==</span>&nbsp;<span class="num" id="3674203">0</span>&nbsp;<span class="op" id="3674205">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3674209">panic</span><span class="op" id="3674214">(</span><span class="string" id="3674215">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3674233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3674236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3674239">if</span>&nbsp;<span class="op" id="3674242">&amp;</span><span class="ident" id="3674243">z</span><span class="op" id="3674244">.</span><span class="ident" id="3674245">a</span>&nbsp;<span class="op" id="3674247">==</span>&nbsp;<span class="ident" id="3674250">b</span>&nbsp;<span class="op" id="3674252">||</span>&nbsp;<span class="ident" id="3674255">alias</span><span class="op" id="3674260">(</span><span class="ident" id="3674261">z</span><span class="op" id="3674262">.</span><span class="ident" id="3674263">a</span><span class="op" id="3674264">.</span><span class="ident" id="3674265">abs</span><span class="op" id="3674268">,</span>&nbsp;<span class="ident" id="3674270">babs</span><span class="op" id="3674274">)</span>&nbsp;<span class="op" id="3674276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3674280">babs</span>&nbsp;<span class="op" id="3674285">=</span>&nbsp;<span class="ident" id="3674287">nat</span><span class="op" id="3674290">(</span><span class="builtintype" id="3674291">nil</span><span class="op" id="3674294">)</span><span class="op" id="3674295">.</span><span class="ident" id="3674296">set</span><span class="op" id="3674299">(</span><span class="ident" id="3674300">babs</span><span class="op" id="3674304">)</span>&nbsp;<span class="comment" id="3674306">//&nbsp;make&nbsp;a&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3674322">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3674325">z</span><span class="op" id="3674326">.</span><span class="ident" id="3674327">a</span><span class="op" id="3674328">.</span><span class="ident" id="3674329">abs</span>&nbsp;<span class="op" id="3674333">=</span>&nbsp;<span class="ident" id="3674335">z</span><span class="op" id="3674336">.</span><span class="ident" id="3674337">a</span><span class="op" id="3674338">.</span><span class="ident" id="3674339">abs</span><span class="op" id="3674342">.</span><span class="ident" id="3674343">set</span><span class="op" id="3674346">(</span><span class="ident" id="3674347">a</span><span class="op" id="3674348">.</span><span class="ident" id="3674349">abs</span><span class="op" id="3674352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3674355">z</span><span class="op" id="3674356">.</span><span class="ident" id="3674357">b</span><span class="op" id="3674358">.</span><span class="ident" id="3674359">abs</span>&nbsp;<span class="op" id="3674363">=</span>&nbsp;<span class="ident" id="3674365">z</span><span class="op" id="3674366">.</span><span class="ident" id="3674367">b</span><span class="op" id="3674368">.</span><span class="ident" id="3674369">abs</span><span class="op" id="3674372">.</span><span class="ident" id="3674373">set</span><span class="op" id="3674376">(</span><span class="ident" id="3674377">babs</span><span class="op" id="3674381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3674384">return</span>&nbsp;<span class="ident" id="3674391">z</span><span class="op" id="3674392">.</span><span class="ident" id="3674393">norm</span><span class="op" id="3674397">(</span><span class="op" id="3674398">)</span><br>
<span class="lineno"></span><span class="op" id="3674400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="3674403">//&nbsp;SetFrac64&nbsp;sets&nbsp;z&nbsp;to&nbsp;a/b&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3674445">func</span>&nbsp;<span class="op" id="3674450">(</span><span class="ident" id="3674451">z</span>&nbsp;<span class="op" id="3674453">*</span><span class="ident" id="3674454">Rat</span><span class="op" id="3674457">)</span>&nbsp;<span class="ident" id="3674459">SetFrac64</span><span class="op" id="3674468">(</span><span class="ident" id="3674469">a</span><span class="op" id="3674470">,</span>&nbsp;<span class="ident" id="3674472">b</span>&nbsp;<span class="ident" id="3674474">int64</span><span class="op" id="3674479">)</span>&nbsp;<span class="op" id="3674481">*</span><span class="ident" id="3674482">Rat</span>&nbsp;<span class="op" id="3674486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3674489">z</span><span class="op" id="3674490">.</span><span class="ident" id="3674491">a</span><span class="op" id="3674492">.</span><span class="ident" id="3674493">SetInt64</span><span class="op" id="3674501">(</span><span class="ident" id="3674502">a</span><span class="op" id="3674503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3674506">if</span>&nbsp;<span class="ident" id="3674509">b</span>&nbsp;<span class="op" id="3674511">==</span>&nbsp;<span class="num" id="3674514">0</span>&nbsp;<span class="op" id="3674516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3674520">panic</span><span class="op" id="3674525">(</span><span class="string" id="3674526">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3674544">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3674547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3674550">if</span>&nbsp;<span class="ident" id="3674553">b</span>&nbsp;<span class="op" id="3674555">&lt;</span>&nbsp;<span class="num" id="3674557">0</span>&nbsp;<span class="op" id="3674559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3674563">b</span>&nbsp;<span class="op" id="3674565">=</span>&nbsp;<span class="op" id="3674567">-</span><span class="ident" id="3674568">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3674572">z</span><span class="op" id="3674573">.</span><span class="ident" id="3674574">a</span><span class="op" id="3674575">.</span><span class="ident" id="3674576">neg</span>&nbsp;<span class="op" id="3674580">=</span>&nbsp;<span class="op" id="3674582">!</span><span class="ident" id="3674583">z</span><span class="op" id="3674584">.</span><span class="ident" id="3674585">a</span><span class="op" id="3674586">.</span><span class="ident" id="3674587">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3674592">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3674595">z</span><span class="op" id="3674596">.</span><span class="ident" id="3674597">b</span><span class="op" id="3674598">.</span><span class="ident" id="3674599">abs</span>&nbsp;<span class="op" id="3674603">=</span>&nbsp;<span class="ident" id="3674605">z</span><span class="op" id="3674606">.</span><span class="ident" id="3674607">b</span><span class="op" id="3674608">.</span><span class="ident" id="3674609">abs</span><span class="op" id="3674612">.</span><span class="ident" id="3674613">setUint64</span><span class="op" id="3674622">(</span><span class="ident" id="3674623">uint64</span><span class="op" id="3674629">(</span><span class="ident" id="3674630">b</span><span class="op" id="3674631">)</span><span class="op" id="3674632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3674635">return</span>&nbsp;<span class="ident" id="3674642">z</span><span class="op" id="3674643">.</span><span class="ident" id="3674644">norm</span><span class="op" id="3674648">(</span><span class="op" id="3674649">)</span><br>
<span class="lineno"></span><span class="op" id="3674651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3674654">//&nbsp;SetInt&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">325</span><span class="keyword" id="3674715">func</span>&nbsp;<span class="op" id="3674720">(</span><span class="ident" id="3674721">z</span>&nbsp;<span class="op" id="3674723">*</span><span class="ident" id="3674724">Rat</span><span class="op" id="3674727">)</span>&nbsp;<span class="ident" id="3674729">SetInt</span><span class="op" id="3674735">(</span><span class="ident" id="3674736">x</span>&nbsp;<span class="op" id="3674738">*</span><span class="ident" id="3674739">Int</span><span class="op" id="3674742">)</span>&nbsp;<span class="op" id="3674744">*</span><span class="ident" id="3674745">Rat</span>&nbsp;<span class="op" id="3674749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3674752">z</span><span class="op" id="3674753">.</span><span class="ident" id="3674754">a</span><span class="op" id="3674755">.</span><span class="ident" id="3674756">Set</span><span class="op" id="3674759">(</span><span class="ident" id="3674760">x</span><span class="op" id="3674761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3674764">z</span><span class="op" id="3674765">.</span><span class="ident" id="3674766">b</span><span class="op" id="3674767">.</span><span class="ident" id="3674768">abs</span>&nbsp;<span class="op" id="3674772">=</span>&nbsp;<span class="ident" id="3674774">z</span><span class="op" id="3674775">.</span><span class="ident" id="3674776">b</span><span class="op" id="3674777">.</span><span class="ident" id="3674778">abs</span><span class="op" id="3674781">.</span><span class="builtinfunc" id="3674782">make</span><span class="op" id="3674786">(</span><span class="num" id="3674787">0</span><span class="op" id="3674788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3674791">return</span>&nbsp;<span class="ident" id="3674798">z</span><br>
<span class="lineno"></span><span class="op" id="3674800">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="3674803">//&nbsp;SetInt64&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3674842">func</span>&nbsp;<span class="op" id="3674847">(</span><span class="ident" id="3674848">z</span>&nbsp;<span class="op" id="3674850">*</span><span class="ident" id="3674851">Rat</span><span class="op" id="3674854">)</span>&nbsp;<span class="ident" id="3674856">SetInt64</span><span class="op" id="3674864">(</span><span class="ident" id="3674865">x</span>&nbsp;<span class="ident" id="3674867">int64</span><span class="op" id="3674872">)</span>&nbsp;<span class="op" id="3674874">*</span><span class="ident" id="3674875">Rat</span>&nbsp;<span class="op" id="3674879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3674882">z</span><span class="op" id="3674883">.</span><span class="ident" id="3674884">a</span><span class="op" id="3674885">.</span><span class="ident" id="3674886">SetInt64</span><span class="op" id="3674894">(</span><span class="ident" id="3674895">x</span><span class="op" id="3674896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3674899">z</span><span class="op" id="3674900">.</span><span class="ident" id="3674901">b</span><span class="op" id="3674902">.</span><span class="ident" id="3674903">abs</span>&nbsp;<span class="op" id="3674907">=</span>&nbsp;<span class="ident" id="3674909">z</span><span class="op" id="3674910">.</span><span class="ident" id="3674911">b</span><span class="op" id="3674912">.</span><span class="ident" id="3674913">abs</span><span class="op" id="3674916">.</span><span class="builtinfunc" id="3674917">make</span><span class="op" id="3674921">(</span><span class="num" id="3674922">0</span><span class="op" id="3674923">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3674926">return</span>&nbsp;<span class="ident" id="3674933">z</span><br>
<span class="lineno"></span><span class="op" id="3674935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3674938">//&nbsp;Set&nbsp;sets&nbsp;z&nbsp;to&nbsp;x&nbsp;(by&nbsp;making&nbsp;a&nbsp;copy&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3674996">func</span>&nbsp;<span class="op" id="3675001">(</span><span class="ident" id="3675002">z</span>&nbsp;<span class="op" id="3675004">*</span><span class="ident" id="3675005">Rat</span><span class="op" id="3675008">)</span>&nbsp;<span class="ident" id="3675010">Set</span><span class="op" id="3675013">(</span><span class="ident" id="3675014">x</span>&nbsp;<span class="op" id="3675016">*</span><span class="ident" id="3675017">Rat</span><span class="op" id="3675020">)</span>&nbsp;<span class="op" id="3675022">*</span><span class="ident" id="3675023">Rat</span>&nbsp;<span class="op" id="3675027">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675030">if</span>&nbsp;<span class="ident" id="3675033">z</span>&nbsp;<span class="op" id="3675035">!=</span>&nbsp;<span class="ident" id="3675038">x</span>&nbsp;<span class="op" id="3675040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3675044">z</span><span class="op" id="3675045">.</span><span class="ident" id="3675046">a</span><span class="op" id="3675047">.</span><span class="ident" id="3675048">Set</span><span class="op" id="3675051">(</span><span class="op" id="3675052">&amp;</span><span class="ident" id="3675053">x</span><span class="op" id="3675054">.</span><span class="ident" id="3675055">a</span><span class="op" id="3675056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3675060">z</span><span class="op" id="3675061">.</span><span class="ident" id="3675062">b</span><span class="op" id="3675063">.</span><span class="ident" id="3675064">Set</span><span class="op" id="3675067">(</span><span class="op" id="3675068">&amp;</span><span class="ident" id="3675069">x</span><span class="op" id="3675070">.</span><span class="ident" id="3675071">b</span><span class="op" id="3675072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3675075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675078">return</span>&nbsp;<span class="ident" id="3675085">z</span><br>
<span class="lineno">345</span><span class="op" id="3675087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3675090">//&nbsp;Abs&nbsp;sets&nbsp;z&nbsp;to&nbsp;|x|&nbsp;(the&nbsp;absolute&nbsp;value&nbsp;of&nbsp;x)&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3675152">func</span>&nbsp;<span class="op" id="3675157">(</span><span class="ident" id="3675158">z</span>&nbsp;<span class="op" id="3675160">*</span><span class="ident" id="3675161">Rat</span><span class="op" id="3675164">)</span>&nbsp;<span class="ident" id="3675166">Abs</span><span class="op" id="3675169">(</span><span class="ident" id="3675170">x</span>&nbsp;<span class="op" id="3675172">*</span><span class="ident" id="3675173">Rat</span><span class="op" id="3675176">)</span>&nbsp;<span class="op" id="3675178">*</span><span class="ident" id="3675179">Rat</span>&nbsp;<span class="op" id="3675183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3675186">z</span><span class="op" id="3675187">.</span><span class="ident" id="3675188">Set</span><span class="op" id="3675191">(</span><span class="ident" id="3675192">x</span><span class="op" id="3675193">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3675196">z</span><span class="op" id="3675197">.</span><span class="ident" id="3675198">a</span><span class="op" id="3675199">.</span><span class="ident" id="3675200">neg</span>&nbsp;<span class="op" id="3675204">=</span>&nbsp;<span class="builtintype" id="3675206">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675213">return</span>&nbsp;<span class="ident" id="3675220">z</span><br>
<span class="lineno"></span><span class="op" id="3675222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3675225">//&nbsp;Neg&nbsp;sets&nbsp;z&nbsp;to&nbsp;-x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">355</span><span class="keyword" id="3675260">func</span>&nbsp;<span class="op" id="3675265">(</span><span class="ident" id="3675266">z</span>&nbsp;<span class="op" id="3675268">*</span><span class="ident" id="3675269">Rat</span><span class="op" id="3675272">)</span>&nbsp;<span class="ident" id="3675274">Neg</span><span class="op" id="3675277">(</span><span class="ident" id="3675278">x</span>&nbsp;<span class="op" id="3675280">*</span><span class="ident" id="3675281">Rat</span><span class="op" id="3675284">)</span>&nbsp;<span class="op" id="3675286">*</span><span class="ident" id="3675287">Rat</span>&nbsp;<span class="op" id="3675291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3675294">z</span><span class="op" id="3675295">.</span><span class="ident" id="3675296">Set</span><span class="op" id="3675299">(</span><span class="ident" id="3675300">x</span><span class="op" id="3675301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3675304">z</span><span class="op" id="3675305">.</span><span class="ident" id="3675306">a</span><span class="op" id="3675307">.</span><span class="ident" id="3675308">neg</span>&nbsp;<span class="op" id="3675312">=</span>&nbsp;<span class="builtinfunc" id="3675314">len</span><span class="op" id="3675317">(</span><span class="ident" id="3675318">z</span><span class="op" id="3675319">.</span><span class="ident" id="3675320">a</span><span class="op" id="3675321">.</span><span class="ident" id="3675322">abs</span><span class="op" id="3675325">)</span>&nbsp;<span class="op" id="3675327">&gt;</span>&nbsp;<span class="num" id="3675329">0</span>&nbsp;<span class="op" id="3675331">&amp;&amp;</span>&nbsp;<span class="op" id="3675334">!</span><span class="ident" id="3675335">z</span><span class="op" id="3675336">.</span><span class="ident" id="3675337">a</span><span class="op" id="3675338">.</span><span class="ident" id="3675339">neg</span>&nbsp;<span class="comment" id="3675343">//&nbsp;0&nbsp;has&nbsp;no&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675361">return</span>&nbsp;<span class="ident" id="3675368">z</span><br>
<span class="lineno"></span><span class="op" id="3675370">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="3675373">//&nbsp;Inv&nbsp;sets&nbsp;z&nbsp;to&nbsp;1/x&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3675409">func</span>&nbsp;<span class="op" id="3675414">(</span><span class="ident" id="3675415">z</span>&nbsp;<span class="op" id="3675417">*</span><span class="ident" id="3675418">Rat</span><span class="op" id="3675421">)</span>&nbsp;<span class="ident" id="3675423">Inv</span><span class="op" id="3675426">(</span><span class="ident" id="3675427">x</span>&nbsp;<span class="op" id="3675429">*</span><span class="ident" id="3675430">Rat</span><span class="op" id="3675433">)</span>&nbsp;<span class="op" id="3675435">*</span><span class="ident" id="3675436">Rat</span>&nbsp;<span class="op" id="3675440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675443">if</span>&nbsp;<span class="builtinfunc" id="3675446">len</span><span class="op" id="3675449">(</span><span class="ident" id="3675450">x</span><span class="op" id="3675451">.</span><span class="ident" id="3675452">a</span><span class="op" id="3675453">.</span><span class="ident" id="3675454">abs</span><span class="op" id="3675457">)</span>&nbsp;<span class="op" id="3675459">==</span>&nbsp;<span class="num" id="3675462">0</span>&nbsp;<span class="op" id="3675464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3675468">panic</span><span class="op" id="3675473">(</span><span class="string" id="3675474">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3675492">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3675495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3675498">z</span><span class="op" id="3675499">.</span><span class="ident" id="3675500">Set</span><span class="op" id="3675503">(</span><span class="ident" id="3675504">x</span><span class="op" id="3675505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3675508">a</span>&nbsp;<span class="op" id="3675510">:=</span>&nbsp;<span class="ident" id="3675513">z</span><span class="op" id="3675514">.</span><span class="ident" id="3675515">b</span><span class="op" id="3675516">.</span><span class="ident" id="3675517">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675522">if</span>&nbsp;<span class="builtinfunc" id="3675525">len</span><span class="op" id="3675528">(</span><span class="ident" id="3675529">a</span><span class="op" id="3675530">)</span>&nbsp;<span class="op" id="3675532">==</span>&nbsp;<span class="num" id="3675535">0</span>&nbsp;<span class="op" id="3675537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3675541">a</span>&nbsp;<span class="op" id="3675543">=</span>&nbsp;<span class="ident" id="3675545">a</span><span class="op" id="3675546">.</span><span class="ident" id="3675547">set</span><span class="op" id="3675550">(</span><span class="ident" id="3675551">natOne</span><span class="op" id="3675557">)</span>&nbsp;<span class="comment" id="3675559">//&nbsp;materialize&nbsp;numerator</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3675585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3675588">b</span>&nbsp;<span class="op" id="3675590">:=</span>&nbsp;<span class="ident" id="3675593">z</span><span class="op" id="3675594">.</span><span class="ident" id="3675595">a</span><span class="op" id="3675596">.</span><span class="ident" id="3675597">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675602">if</span>&nbsp;<span class="ident" id="3675605">b</span><span class="op" id="3675606">.</span><span class="ident" id="3675607">cmp</span><span class="op" id="3675610">(</span><span class="ident" id="3675611">natOne</span><span class="op" id="3675617">)</span>&nbsp;<span class="op" id="3675619">==</span>&nbsp;<span class="num" id="3675622">0</span>&nbsp;<span class="op" id="3675624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3675628">b</span>&nbsp;<span class="op" id="3675630">=</span>&nbsp;<span class="ident" id="3675632">b</span><span class="op" id="3675633">.</span><span class="builtinfunc" id="3675634">make</span><span class="op" id="3675638">(</span><span class="num" id="3675639">0</span><span class="op" id="3675640">)</span>&nbsp;<span class="comment" id="3675642">//&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3675668">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3675671">z</span><span class="op" id="3675672">.</span><span class="ident" id="3675673">a</span><span class="op" id="3675674">.</span><span class="ident" id="3675675">abs</span><span class="op" id="3675678">,</span>&nbsp;<span class="ident" id="3675680">z</span><span class="op" id="3675681">.</span><span class="ident" id="3675682">b</span><span class="op" id="3675683">.</span><span class="ident" id="3675684">abs</span>&nbsp;<span class="op" id="3675688">=</span>&nbsp;<span class="ident" id="3675690">a</span><span class="op" id="3675691">,</span>&nbsp;<span class="ident" id="3675693">b</span>&nbsp;<span class="comment" id="3675695">//&nbsp;sign&nbsp;doesn&#39;t&nbsp;change</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675719">return</span>&nbsp;<span class="ident" id="3675726">z</span><br>
<span class="lineno"></span><span class="op" id="3675728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3675731">//&nbsp;Sign&nbsp;returns:</span><br>
<span class="lineno">380</span><span class="comment" id="3675748">//</span><br>
<span class="lineno"></span><span class="comment" id="3675751">//&nbsp;&nbsp;&nbsp;&nbsp;-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3675767">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3675783">//&nbsp;&nbsp;&nbsp;&nbsp;+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3675799">//</span><br>
<span class="lineno">385</span><span class="keyword" id="3675802">func</span>&nbsp;<span class="op" id="3675807">(</span><span class="ident" id="3675808">x</span>&nbsp;<span class="op" id="3675810">*</span><span class="ident" id="3675811">Rat</span><span class="op" id="3675814">)</span>&nbsp;<span class="ident" id="3675816">Sign</span><span class="op" id="3675820">(</span><span class="op" id="3675821">)</span>&nbsp;<span class="builtintype" id="3675823">int</span>&nbsp;<span class="op" id="3675827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675830">return</span>&nbsp;<span class="ident" id="3675837">x</span><span class="op" id="3675838">.</span><span class="ident" id="3675839">a</span><span class="op" id="3675840">.</span><span class="ident" id="3675841">Sign</span><span class="op" id="3675845">(</span><span class="op" id="3675846">)</span><br>
<span class="lineno"></span><span class="op" id="3675848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3675851">//&nbsp;IsInt&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x&nbsp;is&nbsp;1.</span><br>
<span class="lineno">390</span><span class="keyword" id="3675903">func</span>&nbsp;<span class="op" id="3675908">(</span><span class="ident" id="3675909">x</span>&nbsp;<span class="op" id="3675911">*</span><span class="ident" id="3675912">Rat</span><span class="op" id="3675915">)</span>&nbsp;<span class="ident" id="3675917">IsInt</span><span class="op" id="3675922">(</span><span class="op" id="3675923">)</span>&nbsp;<span class="builtintype" id="3675925">bool</span>&nbsp;<span class="op" id="3675930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675933">return</span>&nbsp;<span class="builtinfunc" id="3675940">len</span><span class="op" id="3675943">(</span><span class="ident" id="3675944">x</span><span class="op" id="3675945">.</span><span class="ident" id="3675946">b</span><span class="op" id="3675947">.</span><span class="ident" id="3675948">abs</span><span class="op" id="3675951">)</span>&nbsp;<span class="op" id="3675953">==</span>&nbsp;<span class="num" id="3675956">0</span>&nbsp;<span class="op" id="3675958">||</span>&nbsp;<span class="ident" id="3675961">x</span><span class="op" id="3675962">.</span><span class="ident" id="3675963">b</span><span class="op" id="3675964">.</span><span class="ident" id="3675965">abs</span><span class="op" id="3675968">.</span><span class="ident" id="3675969">cmp</span><span class="op" id="3675972">(</span><span class="ident" id="3675973">natOne</span><span class="op" id="3675979">)</span>&nbsp;<span class="op" id="3675981">==</span>&nbsp;<span class="num" id="3675984">0</span><br>
<span class="lineno"></span><span class="op" id="3675986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3675989">//&nbsp;Num&nbsp;returns&nbsp;the&nbsp;numerator&nbsp;of&nbsp;x;&nbsp;it&nbsp;may&nbsp;be&nbsp;&lt;=&nbsp;0.</span><br>
<span class="lineno">395</span><span class="comment" id="3676040">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;numerator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3676090">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span><span class="comment" id="3676153">//&nbsp;The&nbsp;sign&nbsp;of&nbsp;the&nbsp;numerator&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;sign&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3676212">func</span>&nbsp;<span class="op" id="3676217">(</span><span class="ident" id="3676218">x</span>&nbsp;<span class="op" id="3676220">*</span><span class="ident" id="3676221">Rat</span><span class="op" id="3676224">)</span>&nbsp;<span class="ident" id="3676226">Num</span><span class="op" id="3676229">(</span><span class="op" id="3676230">)</span>&nbsp;<span class="op" id="3676232">*</span><span class="ident" id="3676233">Int</span>&nbsp;<span class="op" id="3676237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676240">return</span>&nbsp;<span class="op" id="3676247">&amp;</span><span class="ident" id="3676248">x</span><span class="op" id="3676249">.</span><span class="ident" id="3676250">a</span><br>
<span class="lineno">400</span><span class="op" id="3676252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3676255">//&nbsp;Denom&nbsp;returns&nbsp;the&nbsp;denominator&nbsp;of&nbsp;x;&nbsp;it&nbsp;is&nbsp;always&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3676312">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;x&#39;s&nbsp;denominator;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3676364">//&nbsp;may&nbsp;change&nbsp;if&nbsp;a&nbsp;new&nbsp;value&nbsp;is&nbsp;assigned&nbsp;to&nbsp;x,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno">405</span><span class="keyword" id="3676427">func</span>&nbsp;<span class="op" id="3676432">(</span><span class="ident" id="3676433">x</span>&nbsp;<span class="op" id="3676435">*</span><span class="ident" id="3676436">Rat</span><span class="op" id="3676439">)</span>&nbsp;<span class="ident" id="3676441">Denom</span><span class="op" id="3676446">(</span><span class="op" id="3676447">)</span>&nbsp;<span class="op" id="3676449">*</span><span class="ident" id="3676450">Int</span>&nbsp;<span class="op" id="3676454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676457">x</span><span class="op" id="3676458">.</span><span class="ident" id="3676459">b</span><span class="op" id="3676460">.</span><span class="ident" id="3676461">neg</span>&nbsp;<span class="op" id="3676465">=</span>&nbsp;<span class="builtintype" id="3676467">false</span>&nbsp;<span class="comment" id="3676473">//&nbsp;the&nbsp;result&nbsp;is&nbsp;always&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676503">if</span>&nbsp;<span class="builtinfunc" id="3676506">len</span><span class="op" id="3676509">(</span><span class="ident" id="3676510">x</span><span class="op" id="3676511">.</span><span class="ident" id="3676512">b</span><span class="op" id="3676513">.</span><span class="ident" id="3676514">abs</span><span class="op" id="3676517">)</span>&nbsp;<span class="op" id="3676519">==</span>&nbsp;<span class="num" id="3676522">0</span>&nbsp;<span class="op" id="3676524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676528">x</span><span class="op" id="3676529">.</span><span class="ident" id="3676530">b</span><span class="op" id="3676531">.</span><span class="ident" id="3676532">abs</span>&nbsp;<span class="op" id="3676536">=</span>&nbsp;<span class="ident" id="3676538">x</span><span class="op" id="3676539">.</span><span class="ident" id="3676540">b</span><span class="op" id="3676541">.</span><span class="ident" id="3676542">abs</span><span class="op" id="3676545">.</span><span class="ident" id="3676546">set</span><span class="op" id="3676549">(</span><span class="ident" id="3676550">natOne</span><span class="op" id="3676556">)</span>&nbsp;<span class="comment" id="3676558">//&nbsp;materialize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3676586">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676589">return</span>&nbsp;<span class="op" id="3676596">&amp;</span><span class="ident" id="3676597">x</span><span class="op" id="3676598">.</span><span class="ident" id="3676599">b</span><br>
<span class="lineno"></span><span class="op" id="3676601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3676604">func</span>&nbsp;<span class="op" id="3676609">(</span><span class="ident" id="3676610">z</span>&nbsp;<span class="op" id="3676612">*</span><span class="ident" id="3676613">Rat</span><span class="op" id="3676616">)</span>&nbsp;<span class="ident" id="3676618">norm</span><span class="op" id="3676622">(</span><span class="op" id="3676623">)</span>&nbsp;<span class="op" id="3676625">*</span><span class="ident" id="3676626">Rat</span>&nbsp;<span class="op" id="3676630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676633">switch</span>&nbsp;<span class="op" id="3676640">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676643">case</span>&nbsp;<span class="builtinfunc" id="3676648">len</span><span class="op" id="3676651">(</span><span class="ident" id="3676652">z</span><span class="op" id="3676653">.</span><span class="ident" id="3676654">a</span><span class="op" id="3676655">.</span><span class="ident" id="3676656">abs</span><span class="op" id="3676659">)</span>&nbsp;<span class="op" id="3676661">==</span>&nbsp;<span class="num" id="3676664">0</span><span class="op" id="3676665">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676669">//&nbsp;z&nbsp;==&nbsp;0&nbsp;-&nbsp;normalize&nbsp;sign&nbsp;and&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676714">z</span><span class="op" id="3676715">.</span><span class="ident" id="3676716">a</span><span class="op" id="3676717">.</span><span class="ident" id="3676718">neg</span>&nbsp;<span class="op" id="3676722">=</span>&nbsp;<span class="builtintype" id="3676724">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676732">z</span><span class="op" id="3676733">.</span><span class="ident" id="3676734">b</span><span class="op" id="3676735">.</span><span class="ident" id="3676736">abs</span>&nbsp;<span class="op" id="3676740">=</span>&nbsp;<span class="ident" id="3676742">z</span><span class="op" id="3676743">.</span><span class="ident" id="3676744">b</span><span class="op" id="3676745">.</span><span class="ident" id="3676746">abs</span><span class="op" id="3676749">.</span><span class="builtinfunc" id="3676750">make</span><span class="op" id="3676754">(</span><span class="num" id="3676755">0</span><span class="op" id="3676756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676759">case</span>&nbsp;<span class="builtinfunc" id="3676764">len</span><span class="op" id="3676767">(</span><span class="ident" id="3676768">z</span><span class="op" id="3676769">.</span><span class="ident" id="3676770">b</span><span class="op" id="3676771">.</span><span class="ident" id="3676772">abs</span><span class="op" id="3676775">)</span>&nbsp;<span class="op" id="3676777">==</span>&nbsp;<span class="num" id="3676780">0</span><span class="op" id="3676781">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676785">//&nbsp;z&nbsp;is&nbsp;normalized&nbsp;int&nbsp;-&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676825">case</span>&nbsp;<span class="ident" id="3676830">z</span><span class="op" id="3676831">.</span><span class="ident" id="3676832">b</span><span class="op" id="3676833">.</span><span class="ident" id="3676834">abs</span><span class="op" id="3676837">.</span><span class="ident" id="3676838">cmp</span><span class="op" id="3676841">(</span><span class="ident" id="3676842">natOne</span><span class="op" id="3676848">)</span>&nbsp;<span class="op" id="3676850">==</span>&nbsp;<span class="num" id="3676853">0</span><span class="op" id="3676854">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676858">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676896">z</span><span class="op" id="3676897">.</span><span class="ident" id="3676898">b</span><span class="op" id="3676899">.</span><span class="ident" id="3676900">abs</span>&nbsp;<span class="op" id="3676904">=</span>&nbsp;<span class="ident" id="3676906">z</span><span class="op" id="3676907">.</span><span class="ident" id="3676908">b</span><span class="op" id="3676909">.</span><span class="ident" id="3676910">abs</span><span class="op" id="3676913">.</span><span class="builtinfunc" id="3676914">make</span><span class="op" id="3676918">(</span><span class="num" id="3676919">0</span><span class="op" id="3676920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676923">default</span><span class="op" id="3676930">:</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676934">neg</span>&nbsp;<span class="op" id="3676938">:=</span>&nbsp;<span class="ident" id="3676941">z</span><span class="op" id="3676942">.</span><span class="ident" id="3676943">a</span><span class="op" id="3676944">.</span><span class="ident" id="3676945">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676951">z</span><span class="op" id="3676952">.</span><span class="ident" id="3676953">a</span><span class="op" id="3676954">.</span><span class="ident" id="3676955">neg</span>&nbsp;<span class="op" id="3676959">=</span>&nbsp;<span class="builtintype" id="3676961">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676969">z</span><span class="op" id="3676970">.</span><span class="ident" id="3676971">b</span><span class="op" id="3676972">.</span><span class="ident" id="3676973">neg</span>&nbsp;<span class="op" id="3676977">=</span>&nbsp;<span class="builtintype" id="3676979">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676987">if</span>&nbsp;<span class="ident" id="3676990">f</span>&nbsp;<span class="op" id="3676992">:=</span>&nbsp;<span class="ident" id="3676995">NewInt</span><span class="op" id="3677001">(</span><span class="num" id="3677002">0</span><span class="op" id="3677003">)</span><span class="op" id="3677004">.</span><span class="ident" id="3677005">binaryGCD</span><span class="op" id="3677014">(</span><span class="op" id="3677015">&amp;</span><span class="ident" id="3677016">z</span><span class="op" id="3677017">.</span><span class="ident" id="3677018">a</span><span class="op" id="3677019">,</span>&nbsp;<span class="op" id="3677021">&amp;</span><span class="ident" id="3677022">z</span><span class="op" id="3677023">.</span><span class="ident" id="3677024">b</span><span class="op" id="3677025">)</span><span class="op" id="3677026">;</span>&nbsp;<span class="ident" id="3677028">f</span><span class="op" id="3677029">.</span><span class="ident" id="3677030">Cmp</span><span class="op" id="3677033">(</span><span class="ident" id="3677034">intOne</span><span class="op" id="3677040">)</span>&nbsp;<span class="op" id="3677042">!=</span>&nbsp;<span class="num" id="3677045">0</span>&nbsp;<span class="op" id="3677047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677052">z</span><span class="op" id="3677053">.</span><span class="ident" id="3677054">a</span><span class="op" id="3677055">.</span><span class="ident" id="3677056">abs</span><span class="op" id="3677059">,</span>&nbsp;<span class="ident" id="3677061">_</span>&nbsp;<span class="op" id="3677063">=</span>&nbsp;<span class="ident" id="3677065">z</span><span class="op" id="3677066">.</span><span class="ident" id="3677067">a</span><span class="op" id="3677068">.</span><span class="ident" id="3677069">abs</span><span class="op" id="3677072">.</span><span class="ident" id="3677073">div</span><span class="op" id="3677076">(</span><span class="builtintype" id="3677077">nil</span><span class="op" id="3677080">,</span>&nbsp;<span class="ident" id="3677082">z</span><span class="op" id="3677083">.</span><span class="ident" id="3677084">a</span><span class="op" id="3677085">.</span><span class="ident" id="3677086">abs</span><span class="op" id="3677089">,</span>&nbsp;<span class="ident" id="3677091">f</span><span class="op" id="3677092">.</span><span class="ident" id="3677093">abs</span><span class="op" id="3677096">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677101">z</span><span class="op" id="3677102">.</span><span class="ident" id="3677103">b</span><span class="op" id="3677104">.</span><span class="ident" id="3677105">abs</span><span class="op" id="3677108">,</span>&nbsp;<span class="ident" id="3677110">_</span>&nbsp;<span class="op" id="3677112">=</span>&nbsp;<span class="ident" id="3677114">z</span><span class="op" id="3677115">.</span><span class="ident" id="3677116">b</span><span class="op" id="3677117">.</span><span class="ident" id="3677118">abs</span><span class="op" id="3677121">.</span><span class="ident" id="3677122">div</span><span class="op" id="3677125">(</span><span class="builtintype" id="3677126">nil</span><span class="op" id="3677129">,</span>&nbsp;<span class="ident" id="3677131">z</span><span class="op" id="3677132">.</span><span class="ident" id="3677133">b</span><span class="op" id="3677134">.</span><span class="ident" id="3677135">abs</span><span class="op" id="3677138">,</span>&nbsp;<span class="ident" id="3677140">f</span><span class="op" id="3677141">.</span><span class="ident" id="3677142">abs</span><span class="op" id="3677145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677150">if</span>&nbsp;<span class="ident" id="3677153">z</span><span class="op" id="3677154">.</span><span class="ident" id="3677155">b</span><span class="op" id="3677156">.</span><span class="ident" id="3677157">abs</span><span class="op" id="3677160">.</span><span class="ident" id="3677161">cmp</span><span class="op" id="3677164">(</span><span class="ident" id="3677165">natOne</span><span class="op" id="3677171">)</span>&nbsp;<span class="op" id="3677173">==</span>&nbsp;<span class="num" id="3677176">0</span>&nbsp;<span class="op" id="3677178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3677184">//&nbsp;z&nbsp;is&nbsp;int&nbsp;-&nbsp;normalize&nbsp;denominator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677224">z</span><span class="op" id="3677225">.</span><span class="ident" id="3677226">b</span><span class="op" id="3677227">.</span><span class="ident" id="3677228">abs</span>&nbsp;<span class="op" id="3677232">=</span>&nbsp;<span class="ident" id="3677234">z</span><span class="op" id="3677235">.</span><span class="ident" id="3677236">b</span><span class="op" id="3677237">.</span><span class="ident" id="3677238">abs</span><span class="op" id="3677241">.</span><span class="builtinfunc" id="3677242">make</span><span class="op" id="3677246">(</span><span class="num" id="3677247">0</span><span class="op" id="3677248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3677253">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3677257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677261">z</span><span class="op" id="3677262">.</span><span class="ident" id="3677263">a</span><span class="op" id="3677264">.</span><span class="ident" id="3677265">neg</span>&nbsp;<span class="op" id="3677269">=</span>&nbsp;<span class="ident" id="3677271">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3677276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677279">return</span>&nbsp;<span class="ident" id="3677286">z</span><br>
<span class="lineno"></span><span class="op" id="3677288">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="3677291">//&nbsp;mulDenom&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;denominator&nbsp;product&nbsp;x*y&nbsp;(by&nbsp;taking&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="3677357">//&nbsp;account&nbsp;that&nbsp;0&nbsp;values&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;as&nbsp;1)&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3677423">//&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3677437">func</span>&nbsp;<span class="ident" id="3677442">mulDenom</span><span class="op" id="3677450">(</span><span class="ident" id="3677451">z</span><span class="op" id="3677452">,</span>&nbsp;<span class="ident" id="3677454">x</span><span class="op" id="3677455">,</span>&nbsp;<span class="ident" id="3677457">y</span>&nbsp;<span class="ident" id="3677459">nat</span><span class="op" id="3677462">)</span>&nbsp;<span class="ident" id="3677464">nat</span>&nbsp;<span class="op" id="3677468">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677471">switch</span>&nbsp;<span class="op" id="3677478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677481">case</span>&nbsp;<span class="builtinfunc" id="3677486">len</span><span class="op" id="3677489">(</span><span class="ident" id="3677490">x</span><span class="op" id="3677491">)</span>&nbsp;<span class="op" id="3677493">==</span>&nbsp;<span class="num" id="3677496">0</span><span class="op" id="3677497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677501">return</span>&nbsp;<span class="ident" id="3677508">z</span><span class="op" id="3677509">.</span><span class="ident" id="3677510">set</span><span class="op" id="3677513">(</span><span class="ident" id="3677514">y</span><span class="op" id="3677515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677518">case</span>&nbsp;<span class="builtinfunc" id="3677523">len</span><span class="op" id="3677526">(</span><span class="ident" id="3677527">y</span><span class="op" id="3677528">)</span>&nbsp;<span class="op" id="3677530">==</span>&nbsp;<span class="num" id="3677533">0</span><span class="op" id="3677534">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677538">return</span>&nbsp;<span class="ident" id="3677545">z</span><span class="op" id="3677546">.</span><span class="ident" id="3677547">set</span><span class="op" id="3677550">(</span><span class="ident" id="3677551">x</span><span class="op" id="3677552">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3677555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677558">return</span>&nbsp;<span class="ident" id="3677565">z</span><span class="op" id="3677566">.</span><span class="ident" id="3677567">mul</span><span class="op" id="3677570">(</span><span class="ident" id="3677571">x</span><span class="op" id="3677572">,</span>&nbsp;<span class="ident" id="3677574">y</span><span class="op" id="3677575">)</span><br>
<span class="lineno"></span><span class="op" id="3677577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3677580">//&nbsp;scaleDenom&nbsp;computes&nbsp;x*f.</span><br>
<span class="lineno">455</span><span class="comment" id="3677608">//&nbsp;If&nbsp;f&nbsp;==&nbsp;0&nbsp;(zero&nbsp;value&nbsp;of&nbsp;denominator),&nbsp;the&nbsp;result&nbsp;is&nbsp;(a&nbsp;copy&nbsp;of)&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3677679">func</span>&nbsp;<span class="ident" id="3677684">scaleDenom</span><span class="op" id="3677694">(</span><span class="ident" id="3677695">x</span>&nbsp;<span class="op" id="3677697">*</span><span class="ident" id="3677698">Int</span><span class="op" id="3677701">,</span>&nbsp;<span class="ident" id="3677703">f</span>&nbsp;<span class="ident" id="3677705">nat</span><span class="op" id="3677708">)</span>&nbsp;<span class="op" id="3677710">*</span><span class="ident" id="3677711">Int</span>&nbsp;<span class="op" id="3677715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677718">var</span>&nbsp;<span class="ident" id="3677722">z</span>&nbsp;<span class="ident" id="3677724">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677729">if</span>&nbsp;<span class="builtinfunc" id="3677732">len</span><span class="op" id="3677735">(</span><span class="ident" id="3677736">f</span><span class="op" id="3677737">)</span>&nbsp;<span class="op" id="3677739">==</span>&nbsp;<span class="num" id="3677742">0</span>&nbsp;<span class="op" id="3677744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677748">return</span>&nbsp;<span class="ident" id="3677755">z</span><span class="op" id="3677756">.</span><span class="ident" id="3677757">Set</span><span class="op" id="3677760">(</span><span class="ident" id="3677761">x</span><span class="op" id="3677762">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3677765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677768">z</span><span class="op" id="3677769">.</span><span class="ident" id="3677770">abs</span>&nbsp;<span class="op" id="3677774">=</span>&nbsp;<span class="ident" id="3677776">z</span><span class="op" id="3677777">.</span><span class="ident" id="3677778">abs</span><span class="op" id="3677781">.</span><span class="ident" id="3677782">mul</span><span class="op" id="3677785">(</span><span class="ident" id="3677786">x</span><span class="op" id="3677787">.</span><span class="ident" id="3677788">abs</span><span class="op" id="3677791">,</span>&nbsp;<span class="ident" id="3677793">f</span><span class="op" id="3677794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677797">z</span><span class="op" id="3677798">.</span><span class="ident" id="3677799">neg</span>&nbsp;<span class="op" id="3677803">=</span>&nbsp;<span class="ident" id="3677805">x</span><span class="op" id="3677806">.</span><span class="ident" id="3677807">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677812">return</span>&nbsp;<span class="op" id="3677819">&amp;</span><span class="ident" id="3677820">z</span><br>
<span class="lineno"></span><span class="op" id="3677822">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span><span class="comment" id="3677825">//&nbsp;Cmp&nbsp;compares&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;returns:</span><br>
<span class="lineno"></span><span class="comment" id="3677862">//</span><br>
<span class="lineno"></span><span class="comment" id="3677865">//&nbsp;&nbsp;&nbsp;-1&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3677883">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;if&nbsp;x&nbsp;==&nbsp;y</span><br>
<span class="lineno">470</span><span class="comment" id="3677901">//&nbsp;&nbsp;&nbsp;+1&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3677919">//</span><br>
<span class="lineno"></span><span class="keyword" id="3677922">func</span>&nbsp;<span class="op" id="3677927">(</span><span class="ident" id="3677928">x</span>&nbsp;<span class="op" id="3677930">*</span><span class="ident" id="3677931">Rat</span><span class="op" id="3677934">)</span>&nbsp;<span class="ident" id="3677936">Cmp</span><span class="op" id="3677939">(</span><span class="ident" id="3677940">y</span>&nbsp;<span class="op" id="3677942">*</span><span class="ident" id="3677943">Rat</span><span class="op" id="3677946">)</span>&nbsp;<span class="builtintype" id="3677948">int</span>&nbsp;<span class="op" id="3677952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677955">return</span>&nbsp;<span class="ident" id="3677962">scaleDenom</span><span class="op" id="3677972">(</span><span class="op" id="3677973">&amp;</span><span class="ident" id="3677974">x</span><span class="op" id="3677975">.</span><span class="ident" id="3677976">a</span><span class="op" id="3677977">,</span>&nbsp;<span class="ident" id="3677979">y</span><span class="op" id="3677980">.</span><span class="ident" id="3677981">b</span><span class="op" id="3677982">.</span><span class="ident" id="3677983">abs</span><span class="op" id="3677986">)</span><span class="op" id="3677987">.</span><span class="ident" id="3677988">Cmp</span><span class="op" id="3677991">(</span><span class="ident" id="3677992">scaleDenom</span><span class="op" id="3678002">(</span><span class="op" id="3678003">&amp;</span><span class="ident" id="3678004">y</span><span class="op" id="3678005">.</span><span class="ident" id="3678006">a</span><span class="op" id="3678007">,</span>&nbsp;<span class="ident" id="3678009">x</span><span class="op" id="3678010">.</span><span class="ident" id="3678011">b</span><span class="op" id="3678012">.</span><span class="ident" id="3678013">abs</span><span class="op" id="3678016">)</span><span class="op" id="3678017">)</span><br>
<span class="lineno"></span><span class="op" id="3678019">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="3678022">//&nbsp;Add&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;sum&nbsp;x+y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3678066">func</span>&nbsp;<span class="op" id="3678071">(</span><span class="ident" id="3678072">z</span>&nbsp;<span class="op" id="3678074">*</span><span class="ident" id="3678075">Rat</span><span class="op" id="3678078">)</span>&nbsp;<span class="ident" id="3678080">Add</span><span class="op" id="3678083">(</span><span class="ident" id="3678084">x</span><span class="op" id="3678085">,</span>&nbsp;<span class="ident" id="3678087">y</span>&nbsp;<span class="op" id="3678089">*</span><span class="ident" id="3678090">Rat</span><span class="op" id="3678093">)</span>&nbsp;<span class="op" id="3678095">*</span><span class="ident" id="3678096">Rat</span>&nbsp;<span class="op" id="3678100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678103">a1</span>&nbsp;<span class="op" id="3678106">:=</span>&nbsp;<span class="ident" id="3678109">scaleDenom</span><span class="op" id="3678119">(</span><span class="op" id="3678120">&amp;</span><span class="ident" id="3678121">x</span><span class="op" id="3678122">.</span><span class="ident" id="3678123">a</span><span class="op" id="3678124">,</span>&nbsp;<span class="ident" id="3678126">y</span><span class="op" id="3678127">.</span><span class="ident" id="3678128">b</span><span class="op" id="3678129">.</span><span class="ident" id="3678130">abs</span><span class="op" id="3678133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678136">a2</span>&nbsp;<span class="op" id="3678139">:=</span>&nbsp;<span class="ident" id="3678142">scaleDenom</span><span class="op" id="3678152">(</span><span class="op" id="3678153">&amp;</span><span class="ident" id="3678154">y</span><span class="op" id="3678155">.</span><span class="ident" id="3678156">a</span><span class="op" id="3678157">,</span>&nbsp;<span class="ident" id="3678159">x</span><span class="op" id="3678160">.</span><span class="ident" id="3678161">b</span><span class="op" id="3678162">.</span><span class="ident" id="3678163">abs</span><span class="op" id="3678166">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678169">z</span><span class="op" id="3678170">.</span><span class="ident" id="3678171">a</span><span class="op" id="3678172">.</span><span class="ident" id="3678173">Add</span><span class="op" id="3678176">(</span><span class="ident" id="3678177">a1</span><span class="op" id="3678179">,</span>&nbsp;<span class="ident" id="3678181">a2</span><span class="op" id="3678183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678186">z</span><span class="op" id="3678187">.</span><span class="ident" id="3678188">b</span><span class="op" id="3678189">.</span><span class="ident" id="3678190">abs</span>&nbsp;<span class="op" id="3678194">=</span>&nbsp;<span class="ident" id="3678196">mulDenom</span><span class="op" id="3678204">(</span><span class="ident" id="3678205">z</span><span class="op" id="3678206">.</span><span class="ident" id="3678207">b</span><span class="op" id="3678208">.</span><span class="ident" id="3678209">abs</span><span class="op" id="3678212">,</span>&nbsp;<span class="ident" id="3678214">x</span><span class="op" id="3678215">.</span><span class="ident" id="3678216">b</span><span class="op" id="3678217">.</span><span class="ident" id="3678218">abs</span><span class="op" id="3678221">,</span>&nbsp;<span class="ident" id="3678223">y</span><span class="op" id="3678224">.</span><span class="ident" id="3678225">b</span><span class="op" id="3678226">.</span><span class="ident" id="3678227">abs</span><span class="op" id="3678230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678233">return</span>&nbsp;<span class="ident" id="3678240">z</span><span class="op" id="3678241">.</span><span class="ident" id="3678242">norm</span><span class="op" id="3678246">(</span><span class="op" id="3678247">)</span><br>
<span class="lineno"></span><span class="op" id="3678249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span><span class="comment" id="3678252">//&nbsp;Sub&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;difference&nbsp;x-y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3678303">func</span>&nbsp;<span class="op" id="3678308">(</span><span class="ident" id="3678309">z</span>&nbsp;<span class="op" id="3678311">*</span><span class="ident" id="3678312">Rat</span><span class="op" id="3678315">)</span>&nbsp;<span class="ident" id="3678317">Sub</span><span class="op" id="3678320">(</span><span class="ident" id="3678321">x</span><span class="op" id="3678322">,</span>&nbsp;<span class="ident" id="3678324">y</span>&nbsp;<span class="op" id="3678326">*</span><span class="ident" id="3678327">Rat</span><span class="op" id="3678330">)</span>&nbsp;<span class="op" id="3678332">*</span><span class="ident" id="3678333">Rat</span>&nbsp;<span class="op" id="3678337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678340">a1</span>&nbsp;<span class="op" id="3678343">:=</span>&nbsp;<span class="ident" id="3678346">scaleDenom</span><span class="op" id="3678356">(</span><span class="op" id="3678357">&amp;</span><span class="ident" id="3678358">x</span><span class="op" id="3678359">.</span><span class="ident" id="3678360">a</span><span class="op" id="3678361">,</span>&nbsp;<span class="ident" id="3678363">y</span><span class="op" id="3678364">.</span><span class="ident" id="3678365">b</span><span class="op" id="3678366">.</span><span class="ident" id="3678367">abs</span><span class="op" id="3678370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678373">a2</span>&nbsp;<span class="op" id="3678376">:=</span>&nbsp;<span class="ident" id="3678379">scaleDenom</span><span class="op" id="3678389">(</span><span class="op" id="3678390">&amp;</span><span class="ident" id="3678391">y</span><span class="op" id="3678392">.</span><span class="ident" id="3678393">a</span><span class="op" id="3678394">,</span>&nbsp;<span class="ident" id="3678396">x</span><span class="op" id="3678397">.</span><span class="ident" id="3678398">b</span><span class="op" id="3678399">.</span><span class="ident" id="3678400">abs</span><span class="op" id="3678403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678406">z</span><span class="op" id="3678407">.</span><span class="ident" id="3678408">a</span><span class="op" id="3678409">.</span><span class="ident" id="3678410">Sub</span><span class="op" id="3678413">(</span><span class="ident" id="3678414">a1</span><span class="op" id="3678416">,</span>&nbsp;<span class="ident" id="3678418">a2</span><span class="op" id="3678420">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678423">z</span><span class="op" id="3678424">.</span><span class="ident" id="3678425">b</span><span class="op" id="3678426">.</span><span class="ident" id="3678427">abs</span>&nbsp;<span class="op" id="3678431">=</span>&nbsp;<span class="ident" id="3678433">mulDenom</span><span class="op" id="3678441">(</span><span class="ident" id="3678442">z</span><span class="op" id="3678443">.</span><span class="ident" id="3678444">b</span><span class="op" id="3678445">.</span><span class="ident" id="3678446">abs</span><span class="op" id="3678449">,</span>&nbsp;<span class="ident" id="3678451">x</span><span class="op" id="3678452">.</span><span class="ident" id="3678453">b</span><span class="op" id="3678454">.</span><span class="ident" id="3678455">abs</span><span class="op" id="3678458">,</span>&nbsp;<span class="ident" id="3678460">y</span><span class="op" id="3678461">.</span><span class="ident" id="3678462">b</span><span class="op" id="3678463">.</span><span class="ident" id="3678464">abs</span><span class="op" id="3678467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678470">return</span>&nbsp;<span class="ident" id="3678477">z</span><span class="op" id="3678478">.</span><span class="ident" id="3678479">norm</span><span class="op" id="3678483">(</span><span class="op" id="3678484">)</span><br>
<span class="lineno"></span><span class="op" id="3678486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3678489">//&nbsp;Mul&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;product&nbsp;x*y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno">495</span><span class="keyword" id="3678537">func</span>&nbsp;<span class="op" id="3678542">(</span><span class="ident" id="3678543">z</span>&nbsp;<span class="op" id="3678545">*</span><span class="ident" id="3678546">Rat</span><span class="op" id="3678549">)</span>&nbsp;<span class="ident" id="3678551">Mul</span><span class="op" id="3678554">(</span><span class="ident" id="3678555">x</span><span class="op" id="3678556">,</span>&nbsp;<span class="ident" id="3678558">y</span>&nbsp;<span class="op" id="3678560">*</span><span class="ident" id="3678561">Rat</span><span class="op" id="3678564">)</span>&nbsp;<span class="op" id="3678566">*</span><span class="ident" id="3678567">Rat</span>&nbsp;<span class="op" id="3678571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678574">z</span><span class="op" id="3678575">.</span><span class="ident" id="3678576">a</span><span class="op" id="3678577">.</span><span class="ident" id="3678578">Mul</span><span class="op" id="3678581">(</span><span class="op" id="3678582">&amp;</span><span class="ident" id="3678583">x</span><span class="op" id="3678584">.</span><span class="ident" id="3678585">a</span><span class="op" id="3678586">,</span>&nbsp;<span class="op" id="3678588">&amp;</span><span class="ident" id="3678589">y</span><span class="op" id="3678590">.</span><span class="ident" id="3678591">a</span><span class="op" id="3678592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678595">z</span><span class="op" id="3678596">.</span><span class="ident" id="3678597">b</span><span class="op" id="3678598">.</span><span class="ident" id="3678599">abs</span>&nbsp;<span class="op" id="3678603">=</span>&nbsp;<span class="ident" id="3678605">mulDenom</span><span class="op" id="3678613">(</span><span class="ident" id="3678614">z</span><span class="op" id="3678615">.</span><span class="ident" id="3678616">b</span><span class="op" id="3678617">.</span><span class="ident" id="3678618">abs</span><span class="op" id="3678621">,</span>&nbsp;<span class="ident" id="3678623">x</span><span class="op" id="3678624">.</span><span class="ident" id="3678625">b</span><span class="op" id="3678626">.</span><span class="ident" id="3678627">abs</span><span class="op" id="3678630">,</span>&nbsp;<span class="ident" id="3678632">y</span><span class="op" id="3678633">.</span><span class="ident" id="3678634">b</span><span class="op" id="3678635">.</span><span class="ident" id="3678636">abs</span><span class="op" id="3678639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678642">return</span>&nbsp;<span class="ident" id="3678649">z</span><span class="op" id="3678650">.</span><span class="ident" id="3678651">norm</span><span class="op" id="3678655">(</span><span class="op" id="3678656">)</span><br>
<span class="lineno"></span><span class="op" id="3678658">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="3678661">//&nbsp;Quo&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;quotient&nbsp;x/y&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3678710">//&nbsp;If&nbsp;y&nbsp;==&nbsp;0,&nbsp;a&nbsp;division-by-zero&nbsp;run-time&nbsp;panic&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="keyword" id="3678766">func</span>&nbsp;<span class="op" id="3678771">(</span><span class="ident" id="3678772">z</span>&nbsp;<span class="op" id="3678774">*</span><span class="ident" id="3678775">Rat</span><span class="op" id="3678778">)</span>&nbsp;<span class="ident" id="3678780">Quo</span><span class="op" id="3678783">(</span><span class="ident" id="3678784">x</span><span class="op" id="3678785">,</span>&nbsp;<span class="ident" id="3678787">y</span>&nbsp;<span class="op" id="3678789">*</span><span class="ident" id="3678790">Rat</span><span class="op" id="3678793">)</span>&nbsp;<span class="op" id="3678795">*</span><span class="ident" id="3678796">Rat</span>&nbsp;<span class="op" id="3678800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678803">if</span>&nbsp;<span class="builtinfunc" id="3678806">len</span><span class="op" id="3678809">(</span><span class="ident" id="3678810">y</span><span class="op" id="3678811">.</span><span class="ident" id="3678812">a</span><span class="op" id="3678813">.</span><span class="ident" id="3678814">abs</span><span class="op" id="3678817">)</span>&nbsp;<span class="op" id="3678819">==</span>&nbsp;<span class="num" id="3678822">0</span>&nbsp;<span class="op" id="3678824">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3678828">panic</span><span class="op" id="3678833">(</span><span class="string" id="3678834">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3678852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3678855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678858">a</span>&nbsp;<span class="op" id="3678860">:=</span>&nbsp;<span class="ident" id="3678863">scaleDenom</span><span class="op" id="3678873">(</span><span class="op" id="3678874">&amp;</span><span class="ident" id="3678875">x</span><span class="op" id="3678876">.</span><span class="ident" id="3678877">a</span><span class="op" id="3678878">,</span>&nbsp;<span class="ident" id="3678880">y</span><span class="op" id="3678881">.</span><span class="ident" id="3678882">b</span><span class="op" id="3678883">.</span><span class="ident" id="3678884">abs</span><span class="op" id="3678887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678890">b</span>&nbsp;<span class="op" id="3678892">:=</span>&nbsp;<span class="ident" id="3678895">scaleDenom</span><span class="op" id="3678905">(</span><span class="op" id="3678906">&amp;</span><span class="ident" id="3678907">y</span><span class="op" id="3678908">.</span><span class="ident" id="3678909">a</span><span class="op" id="3678910">,</span>&nbsp;<span class="ident" id="3678912">x</span><span class="op" id="3678913">.</span><span class="ident" id="3678914">b</span><span class="op" id="3678915">.</span><span class="ident" id="3678916">abs</span><span class="op" id="3678919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678922">z</span><span class="op" id="3678923">.</span><span class="ident" id="3678924">a</span><span class="op" id="3678925">.</span><span class="ident" id="3678926">abs</span>&nbsp;<span class="op" id="3678930">=</span>&nbsp;<span class="ident" id="3678932">a</span><span class="op" id="3678933">.</span><span class="ident" id="3678934">abs</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678939">z</span><span class="op" id="3678940">.</span><span class="ident" id="3678941">b</span><span class="op" id="3678942">.</span><span class="ident" id="3678943">abs</span>&nbsp;<span class="op" id="3678947">=</span>&nbsp;<span class="ident" id="3678949">b</span><span class="op" id="3678950">.</span><span class="ident" id="3678951">abs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3678956">z</span><span class="op" id="3678957">.</span><span class="ident" id="3678958">a</span><span class="op" id="3678959">.</span><span class="ident" id="3678960">neg</span>&nbsp;<span class="op" id="3678964">=</span>&nbsp;<span class="ident" id="3678966">a</span><span class="op" id="3678967">.</span><span class="ident" id="3678968">neg</span>&nbsp;<span class="op" id="3678972">!=</span>&nbsp;<span class="ident" id="3678975">b</span><span class="op" id="3678976">.</span><span class="ident" id="3678977">neg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3678982">return</span>&nbsp;<span class="ident" id="3678989">z</span><span class="op" id="3678990">.</span><span class="ident" id="3678991">norm</span><span class="op" id="3678995">(</span><span class="op" id="3678996">)</span><br>
<span class="lineno"></span><span class="op" id="3678998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="3679001">func</span>&nbsp;<span class="ident" id="3679006">ratTok</span><span class="op" id="3679012">(</span><span class="ident" id="3679013">ch</span>&nbsp;<span class="builtintype" id="3679016">rune</span><span class="op" id="3679020">)</span>&nbsp;<span class="builtintype" id="3679022">bool</span>&nbsp;<span class="op" id="3679027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679030">return</span>&nbsp;<span class="ident" id="3679037">strings</span><span class="op" id="3679044">.</span><span class="ident" id="3679045">IndexRune</span><span class="op" id="3679054">(</span><span class="string" id="3679055">&#34;+-/0123456789.eE&#34;</span><span class="op" id="3679073">,</span>&nbsp;<span class="ident" id="3679075">ch</span><span class="op" id="3679077">)</span>&nbsp;<span class="op" id="3679079">&gt;=</span>&nbsp;<span class="num" id="3679082">0</span><br>
<span class="lineno"></span><span class="op" id="3679084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3679087">//&nbsp;Scan&nbsp;is&nbsp;a&nbsp;support&nbsp;routine&nbsp;for&nbsp;fmt.Scanner.&nbsp;It&nbsp;accepts&nbsp;the&nbsp;formats</span><br>
<span class="lineno">520</span><span class="comment" id="3679156">//&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;F&#39;,&nbsp;&#39;g&#39;,&nbsp;&#39;G&#39;,&nbsp;and&nbsp;&#39;v&#39;.&nbsp;All&nbsp;formats&nbsp;are&nbsp;equivalent.</span><br>
<span class="lineno"></span><span class="keyword" id="3679226">func</span>&nbsp;<span class="op" id="3679231">(</span><span class="ident" id="3679232">z</span>&nbsp;<span class="op" id="3679234">*</span><span class="ident" id="3679235">Rat</span><span class="op" id="3679238">)</span>&nbsp;<span class="ident" id="3679240">Scan</span><span class="op" id="3679244">(</span><span class="ident" id="3679245">s</span>&nbsp;<span class="ident" id="3679247">fmt</span><span class="op" id="3679250">.</span><span class="ident" id="3679251">ScanState</span><span class="op" id="3679260">,</span>&nbsp;<span class="ident" id="3679262">ch</span>&nbsp;<span class="builtintype" id="3679265">rune</span><span class="op" id="3679269">)</span>&nbsp;<span class="builtintype" id="3679271">error</span>&nbsp;<span class="op" id="3679277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3679280">tok</span><span class="op" id="3679283">,</span>&nbsp;<span class="ident" id="3679285">err</span>&nbsp;<span class="op" id="3679289">:=</span>&nbsp;<span class="ident" id="3679292">s</span><span class="op" id="3679293">.</span><span class="ident" id="3679294">Token</span><span class="op" id="3679299">(</span><span class="builtintype" id="3679300">true</span><span class="op" id="3679304">,</span>&nbsp;<span class="ident" id="3679306">ratTok</span><span class="op" id="3679312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679315">if</span>&nbsp;<span class="ident" id="3679318">err</span>&nbsp;<span class="op" id="3679322">!=</span>&nbsp;<span class="builtintype" id="3679325">nil</span>&nbsp;<span class="op" id="3679329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679333">return</span>&nbsp;<span class="ident" id="3679340">err</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3679345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679348">if</span>&nbsp;<span class="ident" id="3679351">strings</span><span class="op" id="3679358">.</span><span class="ident" id="3679359">IndexRune</span><span class="op" id="3679368">(</span><span class="string" id="3679369">&#34;efgEFGv&#34;</span><span class="op" id="3679378">,</span>&nbsp;<span class="ident" id="3679380">ch</span><span class="op" id="3679382">)</span>&nbsp;<span class="op" id="3679384">&lt;</span>&nbsp;<span class="num" id="3679386">0</span>&nbsp;<span class="op" id="3679388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679392">return</span>&nbsp;<span class="ident" id="3679399">errors</span><span class="op" id="3679405">.</span><span class="ident" id="3679406">New</span><span class="op" id="3679409">(</span><span class="string" id="3679410">&#34;Rat.Scan:&nbsp;invalid&nbsp;verb&#34;</span><span class="op" id="3679434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3679437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679440">if</span>&nbsp;<span class="ident" id="3679443">_</span><span class="op" id="3679444">,</span>&nbsp;<span class="ident" id="3679446">ok</span>&nbsp;<span class="op" id="3679449">:=</span>&nbsp;<span class="ident" id="3679452">z</span><span class="op" id="3679453">.</span><span class="ident" id="3679454">SetString</span><span class="op" id="3679463">(</span><span class="builtintype" id="3679464">string</span><span class="op" id="3679470">(</span><span class="ident" id="3679471">tok</span><span class="op" id="3679474">)</span><span class="op" id="3679475">)</span><span class="op" id="3679476">;</span>&nbsp;<span class="op" id="3679478">!</span><span class="ident" id="3679479">ok</span>&nbsp;<span class="op" id="3679482">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679486">return</span>&nbsp;<span class="ident" id="3679493">errors</span><span class="op" id="3679499">.</span><span class="ident" id="3679500">New</span><span class="op" id="3679503">(</span><span class="string" id="3679504">&#34;Rat.Scan:&nbsp;invalid&nbsp;syntax&#34;</span><span class="op" id="3679530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3679533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679536">return</span>&nbsp;<span class="builtintype" id="3679543">nil</span><br>
<span class="lineno"></span><span class="op" id="3679547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3679550">//&nbsp;SetString&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;value&nbsp;of&nbsp;s&nbsp;and&nbsp;returns&nbsp;z&nbsp;and&nbsp;a&nbsp;boolean&nbsp;indicating</span><br>
<span class="lineno"></span><span class="comment" id="3679627">//&nbsp;success.&nbsp;s&nbsp;can&nbsp;be&nbsp;given&nbsp;as&nbsp;a&nbsp;fraction&nbsp;&#34;a/b&#34;&nbsp;or&nbsp;as&nbsp;a&nbsp;floating-point&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3679704">//&nbsp;optionally&nbsp;followed&nbsp;by&nbsp;an&nbsp;exponent.&nbsp;If&nbsp;the&nbsp;operation&nbsp;failed,&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3679781">//&nbsp;z&nbsp;is&nbsp;undefined&nbsp;but&nbsp;the&nbsp;returned&nbsp;value&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3679830">func</span>&nbsp;<span class="op" id="3679835">(</span><span class="ident" id="3679836">z</span>&nbsp;<span class="op" id="3679838">*</span><span class="ident" id="3679839">Rat</span><span class="op" id="3679842">)</span>&nbsp;<span class="ident" id="3679844">SetString</span><span class="op" id="3679853">(</span><span class="ident" id="3679854">s</span>&nbsp;<span class="builtintype" id="3679856">string</span><span class="op" id="3679862">)</span>&nbsp;<span class="op" id="3679864">(</span><span class="op" id="3679865">*</span><span class="ident" id="3679866">Rat</span><span class="op" id="3679869">,</span>&nbsp;<span class="builtintype" id="3679871">bool</span><span class="op" id="3679875">)</span>&nbsp;<span class="op" id="3679877">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679880">if</span>&nbsp;<span class="builtinfunc" id="3679883">len</span><span class="op" id="3679886">(</span><span class="ident" id="3679887">s</span><span class="op" id="3679888">)</span>&nbsp;<span class="op" id="3679890">==</span>&nbsp;<span class="num" id="3679893">0</span>&nbsp;<span class="op" id="3679895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679899">return</span>&nbsp;<span class="builtintype" id="3679906">nil</span><span class="op" id="3679909">,</span>&nbsp;<span class="builtintype" id="3679911">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3679918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3679922">//&nbsp;check&nbsp;for&nbsp;a&nbsp;quotient</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3679947">sep</span>&nbsp;<span class="op" id="3679951">:=</span>&nbsp;<span class="ident" id="3679954">strings</span><span class="op" id="3679961">.</span><span class="ident" id="3679962">Index</span><span class="op" id="3679967">(</span><span class="ident" id="3679968">s</span><span class="op" id="3679969">,</span>&nbsp;<span class="string" id="3679971">&#34;/&#34;</span><span class="op" id="3679974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679977">if</span>&nbsp;<span class="ident" id="3679980">sep</span>&nbsp;<span class="op" id="3679984">&gt;=</span>&nbsp;<span class="num" id="3679987">0</span>&nbsp;<span class="op" id="3679989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3679993">if</span>&nbsp;<span class="ident" id="3679996">_</span><span class="op" id="3679997">,</span>&nbsp;<span class="ident" id="3679999">ok</span>&nbsp;<span class="op" id="3680002">:=</span>&nbsp;<span class="ident" id="3680005">z</span><span class="op" id="3680006">.</span><span class="ident" id="3680007">a</span><span class="op" id="3680008">.</span><span class="ident" id="3680009">SetString</span><span class="op" id="3680018">(</span><span class="ident" id="3680019">s</span><span class="op" id="3680020">[</span><span class="num" id="3680021">0</span><span class="op" id="3680022">:</span><span class="ident" id="3680023">sep</span><span class="op" id="3680026">]</span><span class="op" id="3680027">,</span>&nbsp;<span class="num" id="3680029">10</span><span class="op" id="3680031">)</span><span class="op" id="3680032">;</span>&nbsp;<span class="op" id="3680034">!</span><span class="ident" id="3680035">ok</span>&nbsp;<span class="op" id="3680038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680043">return</span>&nbsp;<span class="builtintype" id="3680050">nil</span><span class="op" id="3680053">,</span>&nbsp;<span class="builtintype" id="3680055">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680063">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680067">s</span>&nbsp;<span class="op" id="3680069">=</span>&nbsp;<span class="ident" id="3680071">s</span><span class="op" id="3680072">[</span><span class="ident" id="3680073">sep</span><span class="op" id="3680076">+</span><span class="num" id="3680077">1</span><span class="op" id="3680078">:</span><span class="op" id="3680079">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680083">var</span>&nbsp;<span class="ident" id="3680087">err</span>&nbsp;<span class="builtintype" id="3680091">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680099">if</span>&nbsp;<span class="ident" id="3680102">z</span><span class="op" id="3680103">.</span><span class="ident" id="3680104">b</span><span class="op" id="3680105">.</span><span class="ident" id="3680106">abs</span><span class="op" id="3680109">,</span>&nbsp;<span class="ident" id="3680111">_</span><span class="op" id="3680112">,</span>&nbsp;<span class="ident" id="3680114">err</span>&nbsp;<span class="op" id="3680118">=</span>&nbsp;<span class="ident" id="3680120">z</span><span class="op" id="3680121">.</span><span class="ident" id="3680122">b</span><span class="op" id="3680123">.</span><span class="ident" id="3680124">abs</span><span class="op" id="3680127">.</span><span class="ident" id="3680128">scan</span><span class="op" id="3680132">(</span><span class="ident" id="3680133">strings</span><span class="op" id="3680140">.</span><span class="ident" id="3680141">NewReader</span><span class="op" id="3680150">(</span><span class="ident" id="3680151">s</span><span class="op" id="3680152">)</span><span class="op" id="3680153">,</span>&nbsp;<span class="num" id="3680155">10</span><span class="op" id="3680157">)</span><span class="op" id="3680158">;</span>&nbsp;<span class="ident" id="3680160">err</span>&nbsp;<span class="op" id="3680164">!=</span>&nbsp;<span class="builtintype" id="3680167">nil</span>&nbsp;<span class="op" id="3680171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680176">return</span>&nbsp;<span class="builtintype" id="3680183">nil</span><span class="op" id="3680186">,</span>&nbsp;<span class="builtintype" id="3680188">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680196">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680200">if</span>&nbsp;<span class="builtinfunc" id="3680203">len</span><span class="op" id="3680206">(</span><span class="ident" id="3680207">z</span><span class="op" id="3680208">.</span><span class="ident" id="3680209">b</span><span class="op" id="3680210">.</span><span class="ident" id="3680211">abs</span><span class="op" id="3680214">)</span>&nbsp;<span class="op" id="3680216">==</span>&nbsp;<span class="num" id="3680219">0</span>&nbsp;<span class="op" id="3680221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680226">return</span>&nbsp;<span class="builtintype" id="3680233">nil</span><span class="op" id="3680236">,</span>&nbsp;<span class="builtintype" id="3680238">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680250">return</span>&nbsp;<span class="ident" id="3680257">z</span><span class="op" id="3680258">.</span><span class="ident" id="3680259">norm</span><span class="op" id="3680263">(</span><span class="op" id="3680264">)</span><span class="op" id="3680265">,</span>&nbsp;<span class="builtintype" id="3680267">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680273">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3680277">//&nbsp;check&nbsp;for&nbsp;a&nbsp;decimal&nbsp;point</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680307">sep</span>&nbsp;<span class="op" id="3680311">=</span>&nbsp;<span class="ident" id="3680313">strings</span><span class="op" id="3680320">.</span><span class="ident" id="3680321">Index</span><span class="op" id="3680326">(</span><span class="ident" id="3680327">s</span><span class="op" id="3680328">,</span>&nbsp;<span class="string" id="3680330">&#34;.&#34;</span><span class="op" id="3680333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3680336">//&nbsp;check&nbsp;for&nbsp;an&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680362">e</span>&nbsp;<span class="op" id="3680364">:=</span>&nbsp;<span class="ident" id="3680367">strings</span><span class="op" id="3680374">.</span><span class="ident" id="3680375">IndexAny</span><span class="op" id="3680383">(</span><span class="ident" id="3680384">s</span><span class="op" id="3680385">,</span>&nbsp;<span class="string" id="3680387">&#34;eE&#34;</span><span class="op" id="3680391">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680394">var</span>&nbsp;<span class="ident" id="3680398">exp</span>&nbsp;<span class="ident" id="3680402">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680407">if</span>&nbsp;<span class="ident" id="3680410">e</span>&nbsp;<span class="op" id="3680412">&gt;=</span>&nbsp;<span class="num" id="3680415">0</span>&nbsp;<span class="op" id="3680417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680421">if</span>&nbsp;<span class="ident" id="3680424">e</span>&nbsp;<span class="op" id="3680426">&lt;</span>&nbsp;<span class="ident" id="3680428">sep</span>&nbsp;<span class="op" id="3680432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3680437">//&nbsp;The&nbsp;E&nbsp;must&nbsp;come&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680484">return</span>&nbsp;<span class="builtintype" id="3680491">nil</span><span class="op" id="3680494">,</span>&nbsp;<span class="builtintype" id="3680496">false</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680508">if</span>&nbsp;<span class="ident" id="3680511">_</span><span class="op" id="3680512">,</span>&nbsp;<span class="ident" id="3680514">ok</span>&nbsp;<span class="op" id="3680517">:=</span>&nbsp;<span class="ident" id="3680520">exp</span><span class="op" id="3680523">.</span><span class="ident" id="3680524">SetString</span><span class="op" id="3680533">(</span><span class="ident" id="3680534">s</span><span class="op" id="3680535">[</span><span class="ident" id="3680536">e</span><span class="op" id="3680537">+</span><span class="num" id="3680538">1</span><span class="op" id="3680539">:</span><span class="op" id="3680540">]</span><span class="op" id="3680541">,</span>&nbsp;<span class="num" id="3680543">10</span><span class="op" id="3680545">)</span><span class="op" id="3680546">;</span>&nbsp;<span class="op" id="3680548">!</span><span class="ident" id="3680549">ok</span>&nbsp;<span class="op" id="3680552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680557">return</span>&nbsp;<span class="builtintype" id="3680564">nil</span><span class="op" id="3680567">,</span>&nbsp;<span class="builtintype" id="3680569">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680581">s</span>&nbsp;<span class="op" id="3680583">=</span>&nbsp;<span class="ident" id="3680585">s</span><span class="op" id="3680586">[</span><span class="num" id="3680587">0</span><span class="op" id="3680588">:</span><span class="ident" id="3680589">e</span><span class="op" id="3680590">]</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680596">if</span>&nbsp;<span class="ident" id="3680599">sep</span>&nbsp;<span class="op" id="3680603">&gt;=</span>&nbsp;<span class="num" id="3680606">0</span>&nbsp;<span class="op" id="3680608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680612">s</span>&nbsp;<span class="op" id="3680614">=</span>&nbsp;<span class="ident" id="3680616">s</span><span class="op" id="3680617">[</span><span class="num" id="3680618">0</span><span class="op" id="3680619">:</span><span class="ident" id="3680620">sep</span><span class="op" id="3680623">]</span>&nbsp;<span class="op" id="3680625">+</span>&nbsp;<span class="ident" id="3680627">s</span><span class="op" id="3680628">[</span><span class="ident" id="3680629">sep</span><span class="op" id="3680632">+</span><span class="num" id="3680633">1</span><span class="op" id="3680634">:</span><span class="op" id="3680635">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680639">exp</span><span class="op" id="3680642">.</span><span class="ident" id="3680643">Sub</span><span class="op" id="3680646">(</span><span class="op" id="3680647">&amp;</span><span class="ident" id="3680648">exp</span><span class="op" id="3680651">,</span>&nbsp;<span class="ident" id="3680653">NewInt</span><span class="op" id="3680659">(</span><span class="ident" id="3680660">int64</span><span class="op" id="3680665">(</span><span class="builtinfunc" id="3680666">len</span><span class="op" id="3680669">(</span><span class="ident" id="3680670">s</span><span class="op" id="3680671">)</span><span class="op" id="3680672">-</span><span class="ident" id="3680673">sep</span><span class="op" id="3680676">)</span><span class="op" id="3680677">)</span><span class="op" id="3680678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680681">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680685">if</span>&nbsp;<span class="ident" id="3680688">_</span><span class="op" id="3680689">,</span>&nbsp;<span class="ident" id="3680691">ok</span>&nbsp;<span class="op" id="3680694">:=</span>&nbsp;<span class="ident" id="3680697">z</span><span class="op" id="3680698">.</span><span class="ident" id="3680699">a</span><span class="op" id="3680700">.</span><span class="ident" id="3680701">SetString</span><span class="op" id="3680710">(</span><span class="ident" id="3680711">s</span><span class="op" id="3680712">,</span>&nbsp;<span class="num" id="3680714">10</span><span class="op" id="3680716">)</span><span class="op" id="3680717">;</span>&nbsp;<span class="op" id="3680719">!</span><span class="ident" id="3680720">ok</span>&nbsp;<span class="op" id="3680723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680727">return</span>&nbsp;<span class="builtintype" id="3680734">nil</span><span class="op" id="3680737">,</span>&nbsp;<span class="builtintype" id="3680739">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680749">powTen</span>&nbsp;<span class="op" id="3680756">:=</span>&nbsp;<span class="ident" id="3680759">nat</span><span class="op" id="3680762">(</span><span class="builtintype" id="3680763">nil</span><span class="op" id="3680766">)</span><span class="op" id="3680767">.</span><span class="ident" id="3680768">expNN</span><span class="op" id="3680773">(</span><span class="ident" id="3680774">natTen</span><span class="op" id="3680780">,</span>&nbsp;<span class="ident" id="3680782">exp</span><span class="op" id="3680785">.</span><span class="ident" id="3680786">abs</span><span class="op" id="3680789">,</span>&nbsp;<span class="builtintype" id="3680791">nil</span><span class="op" id="3680794">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680797">if</span>&nbsp;<span class="ident" id="3680800">exp</span><span class="op" id="3680803">.</span><span class="ident" id="3680804">neg</span>&nbsp;<span class="op" id="3680808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680812">z</span><span class="op" id="3680813">.</span><span class="ident" id="3680814">b</span><span class="op" id="3680815">.</span><span class="ident" id="3680816">abs</span>&nbsp;<span class="op" id="3680820">=</span>&nbsp;<span class="ident" id="3680822">powTen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680831">z</span><span class="op" id="3680832">.</span><span class="ident" id="3680833">norm</span><span class="op" id="3680837">(</span><span class="op" id="3680838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680841">}</span>&nbsp;<span class="keyword" id="3680843">else</span>&nbsp;<span class="op" id="3680848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680852">z</span><span class="op" id="3680853">.</span><span class="ident" id="3680854">a</span><span class="op" id="3680855">.</span><span class="ident" id="3680856">abs</span>&nbsp;<span class="op" id="3680860">=</span>&nbsp;<span class="ident" id="3680862">z</span><span class="op" id="3680863">.</span><span class="ident" id="3680864">a</span><span class="op" id="3680865">.</span><span class="ident" id="3680866">abs</span><span class="op" id="3680869">.</span><span class="ident" id="3680870">mul</span><span class="op" id="3680873">(</span><span class="ident" id="3680874">z</span><span class="op" id="3680875">.</span><span class="ident" id="3680876">a</span><span class="op" id="3680877">.</span><span class="ident" id="3680878">abs</span><span class="op" id="3680881">,</span>&nbsp;<span class="ident" id="3680883">powTen</span><span class="op" id="3680889">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3680893">z</span><span class="op" id="3680894">.</span><span class="ident" id="3680895">b</span><span class="op" id="3680896">.</span><span class="ident" id="3680897">abs</span>&nbsp;<span class="op" id="3680901">=</span>&nbsp;<span class="ident" id="3680903">z</span><span class="op" id="3680904">.</span><span class="ident" id="3680905">b</span><span class="op" id="3680906">.</span><span class="ident" id="3680907">abs</span><span class="op" id="3680910">.</span><span class="builtinfunc" id="3680911">make</span><span class="op" id="3680915">(</span><span class="num" id="3680916">0</span><span class="op" id="3680917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3680920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3680924">return</span>&nbsp;<span class="ident" id="3680931">z</span><span class="op" id="3680932">,</span>&nbsp;<span class="builtintype" id="3680934">true</span><br>
<span class="lineno"></span><span class="op" id="3680939">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="comment" id="3680942">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;(even&nbsp;if&nbsp;b&nbsp;==&nbsp;1).</span><br>
<span class="lineno"></span><span class="keyword" id="3681025">func</span>&nbsp;<span class="op" id="3681030">(</span><span class="ident" id="3681031">x</span>&nbsp;<span class="op" id="3681033">*</span><span class="ident" id="3681034">Rat</span><span class="op" id="3681037">)</span>&nbsp;<span class="ident" id="3681039">String</span><span class="op" id="3681045">(</span><span class="op" id="3681046">)</span>&nbsp;<span class="builtintype" id="3681048">string</span>&nbsp;<span class="op" id="3681055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681058">s</span>&nbsp;<span class="op" id="3681060">:=</span>&nbsp;<span class="string" id="3681063">&#34;/1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681069">if</span>&nbsp;<span class="builtinfunc" id="3681072">len</span><span class="op" id="3681075">(</span><span class="ident" id="3681076">x</span><span class="op" id="3681077">.</span><span class="ident" id="3681078">b</span><span class="op" id="3681079">.</span><span class="ident" id="3681080">abs</span><span class="op" id="3681083">)</span>&nbsp;<span class="op" id="3681085">!=</span>&nbsp;<span class="num" id="3681088">0</span>&nbsp;<span class="op" id="3681090">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681094">s</span>&nbsp;<span class="op" id="3681096">=</span>&nbsp;<span class="string" id="3681098">&#34;/&#34;</span>&nbsp;<span class="op" id="3681102">+</span>&nbsp;<span class="ident" id="3681104">x</span><span class="op" id="3681105">.</span><span class="ident" id="3681106">b</span><span class="op" id="3681107">.</span><span class="ident" id="3681108">abs</span><span class="op" id="3681111">.</span><span class="ident" id="3681112">decimalString</span><span class="op" id="3681125">(</span><span class="op" id="3681126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3681129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681132">return</span>&nbsp;<span class="ident" id="3681139">x</span><span class="op" id="3681140">.</span><span class="ident" id="3681141">a</span><span class="op" id="3681142">.</span><span class="ident" id="3681143">String</span><span class="op" id="3681149">(</span><span class="op" id="3681150">)</span>&nbsp;<span class="op" id="3681152">+</span>&nbsp;<span class="ident" id="3681154">s</span><br>
<span class="lineno"></span><span class="op" id="3681156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="comment" id="3681159">//&nbsp;RatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a/b&#34;&nbsp;if&nbsp;b&nbsp;!=&nbsp;1,</span><br>
<span class="lineno"></span><span class="comment" id="3681238">//&nbsp;and&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;a&#34;&nbsp;if&nbsp;b&nbsp;==&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3681272">func</span>&nbsp;<span class="op" id="3681277">(</span><span class="ident" id="3681278">x</span>&nbsp;<span class="op" id="3681280">*</span><span class="ident" id="3681281">Rat</span><span class="op" id="3681284">)</span>&nbsp;<span class="ident" id="3681286">RatString</span><span class="op" id="3681295">(</span><span class="op" id="3681296">)</span>&nbsp;<span class="builtintype" id="3681298">string</span>&nbsp;<span class="op" id="3681305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681308">if</span>&nbsp;<span class="ident" id="3681311">x</span><span class="op" id="3681312">.</span><span class="ident" id="3681313">IsInt</span><span class="op" id="3681318">(</span><span class="op" id="3681319">)</span>&nbsp;<span class="op" id="3681321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681325">return</span>&nbsp;<span class="ident" id="3681332">x</span><span class="op" id="3681333">.</span><span class="ident" id="3681334">a</span><span class="op" id="3681335">.</span><span class="ident" id="3681336">String</span><span class="op" id="3681342">(</span><span class="op" id="3681343">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3681346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681349">return</span>&nbsp;<span class="ident" id="3681356">x</span><span class="op" id="3681357">.</span><span class="ident" id="3681358">String</span><span class="op" id="3681364">(</span><span class="op" id="3681365">)</span><br>
<span class="lineno"></span><span class="op" id="3681367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3681370">//&nbsp;FloatString&nbsp;returns&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;x&nbsp;in&nbsp;decimal&nbsp;form&nbsp;with&nbsp;prec</span><br>
<span class="lineno">615</span><span class="comment" id="3681448">//&nbsp;digits&nbsp;of&nbsp;precision&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point&nbsp;and&nbsp;the&nbsp;last&nbsp;digit&nbsp;rounded.</span><br>
<span class="lineno"></span><span class="keyword" id="3681523">func</span>&nbsp;<span class="op" id="3681528">(</span><span class="ident" id="3681529">x</span>&nbsp;<span class="op" id="3681531">*</span><span class="ident" id="3681532">Rat</span><span class="op" id="3681535">)</span>&nbsp;<span class="ident" id="3681537">FloatString</span><span class="op" id="3681548">(</span><span class="ident" id="3681549">prec</span>&nbsp;<span class="builtintype" id="3681554">int</span><span class="op" id="3681557">)</span>&nbsp;<span class="builtintype" id="3681559">string</span>&nbsp;<span class="op" id="3681566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681569">if</span>&nbsp;<span class="ident" id="3681572">x</span><span class="op" id="3681573">.</span><span class="ident" id="3681574">IsInt</span><span class="op" id="3681579">(</span><span class="op" id="3681580">)</span>&nbsp;<span class="op" id="3681582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681586">s</span>&nbsp;<span class="op" id="3681588">:=</span>&nbsp;<span class="ident" id="3681591">x</span><span class="op" id="3681592">.</span><span class="ident" id="3681593">a</span><span class="op" id="3681594">.</span><span class="ident" id="3681595">String</span><span class="op" id="3681601">(</span><span class="op" id="3681602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681606">if</span>&nbsp;<span class="ident" id="3681609">prec</span>&nbsp;<span class="op" id="3681614">&gt;</span>&nbsp;<span class="num" id="3681616">0</span>&nbsp;<span class="op" id="3681618">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681623">s</span>&nbsp;<span class="op" id="3681625">+=</span>&nbsp;<span class="string" id="3681628">&#34;.&#34;</span>&nbsp;<span class="op" id="3681632">+</span>&nbsp;<span class="ident" id="3681634">strings</span><span class="op" id="3681641">.</span><span class="ident" id="3681642">Repeat</span><span class="op" id="3681648">(</span><span class="string" id="3681649">&#34;0&#34;</span><span class="op" id="3681652">,</span>&nbsp;<span class="ident" id="3681654">prec</span><span class="op" id="3681658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3681662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681666">return</span>&nbsp;<span class="ident" id="3681673">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3681676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3681679">//&nbsp;x.b.abs&nbsp;!=&nbsp;0</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681697">q</span><span class="op" id="3681698">,</span>&nbsp;<span class="ident" id="3681700">r</span>&nbsp;<span class="op" id="3681702">:=</span>&nbsp;<span class="ident" id="3681705">nat</span><span class="op" id="3681708">(</span><span class="builtintype" id="3681709">nil</span><span class="op" id="3681712">)</span><span class="op" id="3681713">.</span><span class="ident" id="3681714">div</span><span class="op" id="3681717">(</span><span class="ident" id="3681718">nat</span><span class="op" id="3681721">(</span><span class="builtintype" id="3681722">nil</span><span class="op" id="3681725">)</span><span class="op" id="3681726">,</span>&nbsp;<span class="ident" id="3681728">x</span><span class="op" id="3681729">.</span><span class="ident" id="3681730">a</span><span class="op" id="3681731">.</span><span class="ident" id="3681732">abs</span><span class="op" id="3681735">,</span>&nbsp;<span class="ident" id="3681737">x</span><span class="op" id="3681738">.</span><span class="ident" id="3681739">b</span><span class="op" id="3681740">.</span><span class="ident" id="3681741">abs</span><span class="op" id="3681744">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681748">p</span>&nbsp;<span class="op" id="3681750">:=</span>&nbsp;<span class="ident" id="3681753">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681761">if</span>&nbsp;<span class="ident" id="3681764">prec</span>&nbsp;<span class="op" id="3681769">&gt;</span>&nbsp;<span class="num" id="3681771">0</span>&nbsp;<span class="op" id="3681773">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681777">p</span>&nbsp;<span class="op" id="3681779">=</span>&nbsp;<span class="ident" id="3681781">nat</span><span class="op" id="3681784">(</span><span class="builtintype" id="3681785">nil</span><span class="op" id="3681788">)</span><span class="op" id="3681789">.</span><span class="ident" id="3681790">expNN</span><span class="op" id="3681795">(</span><span class="ident" id="3681796">natTen</span><span class="op" id="3681802">,</span>&nbsp;<span class="ident" id="3681804">nat</span><span class="op" id="3681807">(</span><span class="builtintype" id="3681808">nil</span><span class="op" id="3681811">)</span><span class="op" id="3681812">.</span><span class="ident" id="3681813">setUint64</span><span class="op" id="3681822">(</span><span class="ident" id="3681823">uint64</span><span class="op" id="3681829">(</span><span class="ident" id="3681830">prec</span><span class="op" id="3681834">)</span><span class="op" id="3681835">)</span><span class="op" id="3681836">,</span>&nbsp;<span class="builtintype" id="3681838">nil</span><span class="op" id="3681841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3681844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681848">r</span>&nbsp;<span class="op" id="3681850">=</span>&nbsp;<span class="ident" id="3681852">r</span><span class="op" id="3681853">.</span><span class="ident" id="3681854">mul</span><span class="op" id="3681857">(</span><span class="ident" id="3681858">r</span><span class="op" id="3681859">,</span>&nbsp;<span class="ident" id="3681861">p</span><span class="op" id="3681862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681865">r</span><span class="op" id="3681866">,</span>&nbsp;<span class="ident" id="3681868">r2</span>&nbsp;<span class="op" id="3681871">:=</span>&nbsp;<span class="ident" id="3681874">r</span><span class="op" id="3681875">.</span><span class="ident" id="3681876">div</span><span class="op" id="3681879">(</span><span class="ident" id="3681880">nat</span><span class="op" id="3681883">(</span><span class="builtintype" id="3681884">nil</span><span class="op" id="3681887">)</span><span class="op" id="3681888">,</span>&nbsp;<span class="ident" id="3681890">r</span><span class="op" id="3681891">,</span>&nbsp;<span class="ident" id="3681893">x</span><span class="op" id="3681894">.</span><span class="ident" id="3681895">b</span><span class="op" id="3681896">.</span><span class="ident" id="3681897">abs</span><span class="op" id="3681900">)</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3681904">//&nbsp;see&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;round&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681935">r2</span>&nbsp;<span class="op" id="3681938">=</span>&nbsp;<span class="ident" id="3681940">r2</span><span class="op" id="3681942">.</span><span class="ident" id="3681943">add</span><span class="op" id="3681946">(</span><span class="ident" id="3681947">r2</span><span class="op" id="3681949">,</span>&nbsp;<span class="ident" id="3681951">r2</span><span class="op" id="3681953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3681956">if</span>&nbsp;<span class="ident" id="3681959">x</span><span class="op" id="3681960">.</span><span class="ident" id="3681961">b</span><span class="op" id="3681962">.</span><span class="ident" id="3681963">abs</span><span class="op" id="3681966">.</span><span class="ident" id="3681967">cmp</span><span class="op" id="3681970">(</span><span class="ident" id="3681971">r2</span><span class="op" id="3681973">)</span>&nbsp;<span class="op" id="3681975">&lt;=</span>&nbsp;<span class="num" id="3681978">0</span>&nbsp;<span class="op" id="3681980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3681984">r</span>&nbsp;<span class="op" id="3681986">=</span>&nbsp;<span class="ident" id="3681988">r</span><span class="op" id="3681989">.</span><span class="ident" id="3681990">add</span><span class="op" id="3681993">(</span><span class="ident" id="3681994">r</span><span class="op" id="3681995">,</span>&nbsp;<span class="ident" id="3681997">natOne</span><span class="op" id="3682003">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682007">if</span>&nbsp;<span class="ident" id="3682010">r</span><span class="op" id="3682011">.</span><span class="ident" id="3682012">cmp</span><span class="op" id="3682015">(</span><span class="ident" id="3682016">p</span><span class="op" id="3682017">)</span>&nbsp;<span class="op" id="3682019">&gt;=</span>&nbsp;<span class="num" id="3682022">0</span>&nbsp;<span class="op" id="3682024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682029">q</span>&nbsp;<span class="op" id="3682031">=</span>&nbsp;<span class="ident" id="3682033">nat</span><span class="op" id="3682036">(</span><span class="builtintype" id="3682037">nil</span><span class="op" id="3682040">)</span><span class="op" id="3682041">.</span><span class="ident" id="3682042">add</span><span class="op" id="3682045">(</span><span class="ident" id="3682046">q</span><span class="op" id="3682047">,</span>&nbsp;<span class="ident" id="3682049">natOne</span><span class="op" id="3682055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682060">r</span>&nbsp;<span class="op" id="3682062">=</span>&nbsp;<span class="ident" id="3682064">nat</span><span class="op" id="3682067">(</span><span class="builtintype" id="3682068">nil</span><span class="op" id="3682071">)</span><span class="op" id="3682072">.</span><span class="ident" id="3682073">sub</span><span class="op" id="3682076">(</span><span class="ident" id="3682077">r</span><span class="op" id="3682078">,</span>&nbsp;<span class="ident" id="3682080">p</span><span class="op" id="3682081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3682085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3682088">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682092">s</span>&nbsp;<span class="op" id="3682094">:=</span>&nbsp;<span class="ident" id="3682097">q</span><span class="op" id="3682098">.</span><span class="ident" id="3682099">decimalString</span><span class="op" id="3682112">(</span><span class="op" id="3682113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682116">if</span>&nbsp;<span class="ident" id="3682119">x</span><span class="op" id="3682120">.</span><span class="ident" id="3682121">a</span><span class="op" id="3682122">.</span><span class="ident" id="3682123">neg</span>&nbsp;<span class="op" id="3682127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682131">s</span>&nbsp;<span class="op" id="3682133">=</span>&nbsp;<span class="string" id="3682135">&#34;-&#34;</span>&nbsp;<span class="op" id="3682139">+</span>&nbsp;<span class="ident" id="3682141">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3682144">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682148">if</span>&nbsp;<span class="ident" id="3682151">prec</span>&nbsp;<span class="op" id="3682156">&gt;</span>&nbsp;<span class="num" id="3682158">0</span>&nbsp;<span class="op" id="3682160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682164">rs</span>&nbsp;<span class="op" id="3682167">:=</span>&nbsp;<span class="ident" id="3682170">r</span><span class="op" id="3682171">.</span><span class="ident" id="3682172">decimalString</span><span class="op" id="3682185">(</span><span class="op" id="3682186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682190">leadingZeros</span>&nbsp;<span class="op" id="3682203">:=</span>&nbsp;<span class="ident" id="3682206">prec</span>&nbsp;<span class="op" id="3682211">-</span>&nbsp;<span class="builtinfunc" id="3682213">len</span><span class="op" id="3682216">(</span><span class="ident" id="3682217">rs</span><span class="op" id="3682219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682223">s</span>&nbsp;<span class="op" id="3682225">+=</span>&nbsp;<span class="string" id="3682228">&#34;.&#34;</span>&nbsp;<span class="op" id="3682232">+</span>&nbsp;<span class="ident" id="3682234">strings</span><span class="op" id="3682241">.</span><span class="ident" id="3682242">Repeat</span><span class="op" id="3682248">(</span><span class="string" id="3682249">&#34;0&#34;</span><span class="op" id="3682252">,</span>&nbsp;<span class="ident" id="3682254">leadingZeros</span><span class="op" id="3682266">)</span>&nbsp;<span class="op" id="3682268">+</span>&nbsp;<span class="ident" id="3682270">rs</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3682274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682278">return</span>&nbsp;<span class="ident" id="3682285">s</span><br>
<span class="lineno"></span><span class="op" id="3682287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="comment" id="3682290">//&nbsp;Gob&nbsp;codec&nbsp;version.&nbsp;Permits&nbsp;backward-compatible&nbsp;changes&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3682365">const</span>&nbsp;<span class="ident" id="3682371">ratGobVersion</span>&nbsp;<span class="builtintype" id="3682385">byte</span>&nbsp;<span class="op" id="3682390">=</span>&nbsp;<span class="num" id="3682392">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3682395">//&nbsp;GobEncode&nbsp;implements&nbsp;the&nbsp;gob.GobEncoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3682449">func</span>&nbsp;<span class="op" id="3682454">(</span><span class="ident" id="3682455">x</span>&nbsp;<span class="op" id="3682457">*</span><span class="ident" id="3682458">Rat</span><span class="op" id="3682461">)</span>&nbsp;<span class="ident" id="3682463">GobEncode</span><span class="op" id="3682472">(</span><span class="op" id="3682473">)</span>&nbsp;<span class="op" id="3682475">(</span><span class="op" id="3682476">[</span><span class="op" id="3682477">]</span><span class="builtintype" id="3682478">byte</span><span class="op" id="3682482">,</span>&nbsp;<span class="builtintype" id="3682484">error</span><span class="op" id="3682489">)</span>&nbsp;<span class="op" id="3682491">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682494">if</span>&nbsp;<span class="ident" id="3682497">x</span>&nbsp;<span class="op" id="3682499">==</span>&nbsp;<span class="builtintype" id="3682502">nil</span>&nbsp;<span class="op" id="3682506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682510">return</span>&nbsp;<span class="builtintype" id="3682517">nil</span><span class="op" id="3682520">,</span>&nbsp;<span class="builtintype" id="3682522">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3682527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682530">buf</span>&nbsp;<span class="op" id="3682534">:=</span>&nbsp;<span class="builtinfunc" id="3682537">make</span><span class="op" id="3682541">(</span><span class="op" id="3682542">[</span><span class="op" id="3682543">]</span><span class="builtintype" id="3682544">byte</span><span class="op" id="3682548">,</span>&nbsp;<span class="num" id="3682550">1</span><span class="op" id="3682551">+</span><span class="num" id="3682552">4</span><span class="op" id="3682553">+</span><span class="op" id="3682554">(</span><span class="builtinfunc" id="3682555">len</span><span class="op" id="3682558">(</span><span class="ident" id="3682559">x</span><span class="op" id="3682560">.</span><span class="ident" id="3682561">a</span><span class="op" id="3682562">.</span><span class="ident" id="3682563">abs</span><span class="op" id="3682566">)</span><span class="op" id="3682567">+</span><span class="builtinfunc" id="3682568">len</span><span class="op" id="3682571">(</span><span class="ident" id="3682572">x</span><span class="op" id="3682573">.</span><span class="ident" id="3682574">b</span><span class="op" id="3682575">.</span><span class="ident" id="3682576">abs</span><span class="op" id="3682579">)</span><span class="op" id="3682580">)</span><span class="op" id="3682581">*</span><span class="ident" id="3682582">_S</span><span class="op" id="3682584">)</span>&nbsp;<span class="comment" id="3682586">//&nbsp;extra&nbsp;bytes&nbsp;for&nbsp;version&nbsp;and&nbsp;sign&nbsp;bit&nbsp;(1),&nbsp;and&nbsp;numerator&nbsp;length&nbsp;(4)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682657">i</span>&nbsp;<span class="op" id="3682659">:=</span>&nbsp;<span class="ident" id="3682662">x</span><span class="op" id="3682663">.</span><span class="ident" id="3682664">b</span><span class="op" id="3682665">.</span><span class="ident" id="3682666">abs</span><span class="op" id="3682669">.</span><span class="ident" id="3682670">bytes</span><span class="op" id="3682675">(</span><span class="ident" id="3682676">buf</span><span class="op" id="3682679">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682682">j</span>&nbsp;<span class="op" id="3682684">:=</span>&nbsp;<span class="ident" id="3682687">x</span><span class="op" id="3682688">.</span><span class="ident" id="3682689">a</span><span class="op" id="3682690">.</span><span class="ident" id="3682691">abs</span><span class="op" id="3682694">.</span><span class="ident" id="3682695">bytes</span><span class="op" id="3682700">(</span><span class="ident" id="3682701">buf</span><span class="op" id="3682704">[</span><span class="num" id="3682705">0</span><span class="op" id="3682706">:</span><span class="ident" id="3682707">i</span><span class="op" id="3682708">]</span><span class="op" id="3682709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682712">n</span>&nbsp;<span class="op" id="3682714">:=</span>&nbsp;<span class="ident" id="3682717">i</span>&nbsp;<span class="op" id="3682719">-</span>&nbsp;<span class="ident" id="3682721">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682724">if</span>&nbsp;<span class="builtintype" id="3682727">int</span><span class="op" id="3682730">(</span><span class="builtintype" id="3682731">uint32</span><span class="op" id="3682737">(</span><span class="ident" id="3682738">n</span><span class="op" id="3682739">)</span><span class="op" id="3682740">)</span>&nbsp;<span class="op" id="3682742">!=</span>&nbsp;<span class="ident" id="3682745">n</span>&nbsp;<span class="op" id="3682747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3682751">//&nbsp;this&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682781">return</span>&nbsp;<span class="builtintype" id="3682788">nil</span><span class="op" id="3682791">,</span>&nbsp;<span class="ident" id="3682793">errors</span><span class="op" id="3682799">.</span><span class="ident" id="3682800">New</span><span class="op" id="3682803">(</span><span class="string" id="3682804">&#34;Rat.GobEncode:&nbsp;numerator&nbsp;too&nbsp;large&#34;</span><span class="op" id="3682840">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3682843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682846">binary</span><span class="op" id="3682852">.</span><span class="ident" id="3682853">BigEndian</span><span class="op" id="3682862">.</span><span class="ident" id="3682863">PutUint32</span><span class="op" id="3682872">(</span><span class="ident" id="3682873">buf</span><span class="op" id="3682876">[</span><span class="ident" id="3682877">j</span><span class="op" id="3682878">-</span><span class="num" id="3682879">4</span><span class="op" id="3682880">:</span><span class="ident" id="3682881">j</span><span class="op" id="3682882">]</span><span class="op" id="3682883">,</span>&nbsp;<span class="builtintype" id="3682885">uint32</span><span class="op" id="3682891">(</span><span class="ident" id="3682892">n</span><span class="op" id="3682893">)</span><span class="op" id="3682894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682897">j</span>&nbsp;<span class="op" id="3682899">-=</span>&nbsp;<span class="num" id="3682902">1</span>&nbsp;<span class="op" id="3682904">+</span>&nbsp;<span class="num" id="3682906">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682909">b</span>&nbsp;<span class="op" id="3682911">:=</span>&nbsp;<span class="ident" id="3682914">ratGobVersion</span>&nbsp;<span class="op" id="3682928">&lt;&lt;</span>&nbsp;<span class="num" id="3682931">1</span>&nbsp;<span class="comment" id="3682933">//&nbsp;make&nbsp;space&nbsp;for&nbsp;sign&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682961">if</span>&nbsp;<span class="ident" id="3682964">x</span><span class="op" id="3682965">.</span><span class="ident" id="3682966">a</span><span class="op" id="3682967">.</span><span class="ident" id="3682968">neg</span>&nbsp;<span class="op" id="3682972">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682976">b</span>&nbsp;<span class="op" id="3682978">|=</span>&nbsp;<span class="num" id="3682981">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3682984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3682987">buf</span><span class="op" id="3682990">[</span><span class="ident" id="3682991">j</span><span class="op" id="3682992">]</span>&nbsp;<span class="op" id="3682994">=</span>&nbsp;<span class="ident" id="3682996">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3682999">return</span>&nbsp;<span class="ident" id="3683006">buf</span><span class="op" id="3683009">[</span><span class="ident" id="3683010">j</span><span class="op" id="3683011">:</span><span class="op" id="3683012">]</span><span class="op" id="3683013">,</span>&nbsp;<span class="builtintype" id="3683015">nil</span><br>
<span class="lineno"></span><span class="op" id="3683019">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="3683022">//&nbsp;GobDecode&nbsp;implements&nbsp;the&nbsp;gob.GobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3683076">func</span>&nbsp;<span class="op" id="3683081">(</span><span class="ident" id="3683082">z</span>&nbsp;<span class="op" id="3683084">*</span><span class="ident" id="3683085">Rat</span><span class="op" id="3683088">)</span>&nbsp;<span class="ident" id="3683090">GobDecode</span><span class="op" id="3683099">(</span><span class="ident" id="3683100">buf</span>&nbsp;<span class="op" id="3683104">[</span><span class="op" id="3683105">]</span><span class="builtintype" id="3683106">byte</span><span class="op" id="3683110">)</span>&nbsp;<span class="builtintype" id="3683112">error</span>&nbsp;<span class="op" id="3683118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683121">if</span>&nbsp;<span class="builtinfunc" id="3683124">len</span><span class="op" id="3683127">(</span><span class="ident" id="3683128">buf</span><span class="op" id="3683131">)</span>&nbsp;<span class="op" id="3683133">==</span>&nbsp;<span class="num" id="3683136">0</span>&nbsp;<span class="op" id="3683138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3683142">//&nbsp;Other&nbsp;side&nbsp;sent&nbsp;a&nbsp;nil&nbsp;or&nbsp;default&nbsp;value.</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3683187">*</span><span class="ident" id="3683188">z</span>&nbsp;<span class="op" id="3683190">=</span>&nbsp;<span class="ident" id="3683192">Rat</span><span class="op" id="3683195">{</span><span class="op" id="3683196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683200">return</span>&nbsp;<span class="builtintype" id="3683207">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3683212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3683215">b</span>&nbsp;<span class="op" id="3683217">:=</span>&nbsp;<span class="ident" id="3683220">buf</span><span class="op" id="3683223">[</span><span class="num" id="3683224">0</span><span class="op" id="3683225">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683228">if</span>&nbsp;<span class="ident" id="3683231">b</span><span class="op" id="3683232">&gt;&gt;</span><span class="num" id="3683234">1</span>&nbsp;<span class="op" id="3683236">!=</span>&nbsp;<span class="ident" id="3683239">ratGobVersion</span>&nbsp;<span class="op" id="3683253">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683257">return</span>&nbsp;<span class="ident" id="3683264">errors</span><span class="op" id="3683270">.</span><span class="ident" id="3683271">New</span><span class="op" id="3683274">(</span><span class="ident" id="3683275">fmt</span><span class="op" id="3683278">.</span><span class="ident" id="3683279">Sprintf</span><span class="op" id="3683286">(</span><span class="string" id="3683287">&#34;Rat.GobDecode:&nbsp;encoding&nbsp;version&nbsp;%d&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3683337">,</span>&nbsp;<span class="ident" id="3683339">b</span><span class="op" id="3683340">&gt;&gt;</span><span class="num" id="3683342">1</span><span class="op" id="3683343">)</span><span class="op" id="3683344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3683347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683350">const</span>&nbsp;<span class="ident" id="3683356">j</span>&nbsp;<span class="op" id="3683358">=</span>&nbsp;<span class="num" id="3683360">1</span>&nbsp;<span class="op" id="3683362">+</span>&nbsp;<span class="num" id="3683364">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3683367">i</span>&nbsp;<span class="op" id="3683369">:=</span>&nbsp;<span class="ident" id="3683372">j</span>&nbsp;<span class="op" id="3683374">+</span>&nbsp;<span class="ident" id="3683376">binary</span><span class="op" id="3683382">.</span><span class="ident" id="3683383">BigEndian</span><span class="op" id="3683392">.</span><span class="ident" id="3683393">Uint32</span><span class="op" id="3683399">(</span><span class="ident" id="3683400">buf</span><span class="op" id="3683403">[</span><span class="ident" id="3683404">j</span><span class="op" id="3683405">-</span><span class="num" id="3683406">4</span><span class="op" id="3683407">:</span><span class="ident" id="3683408">j</span><span class="op" id="3683409">]</span><span class="op" id="3683410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3683413">z</span><span class="op" id="3683414">.</span><span class="ident" id="3683415">a</span><span class="op" id="3683416">.</span><span class="ident" id="3683417">neg</span>&nbsp;<span class="op" id="3683421">=</span>&nbsp;<span class="ident" id="3683423">b</span><span class="op" id="3683424">&amp;</span><span class="num" id="3683425">1</span>&nbsp;<span class="op" id="3683427">!=</span>&nbsp;<span class="num" id="3683430">0</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3683433">z</span><span class="op" id="3683434">.</span><span class="ident" id="3683435">a</span><span class="op" id="3683436">.</span><span class="ident" id="3683437">abs</span>&nbsp;<span class="op" id="3683441">=</span>&nbsp;<span class="ident" id="3683443">z</span><span class="op" id="3683444">.</span><span class="ident" id="3683445">a</span><span class="op" id="3683446">.</span><span class="ident" id="3683447">abs</span><span class="op" id="3683450">.</span><span class="ident" id="3683451">setBytes</span><span class="op" id="3683459">(</span><span class="ident" id="3683460">buf</span><span class="op" id="3683463">[</span><span class="ident" id="3683464">j</span><span class="op" id="3683465">:</span><span class="ident" id="3683466">i</span><span class="op" id="3683467">]</span><span class="op" id="3683468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3683471">z</span><span class="op" id="3683472">.</span><span class="ident" id="3683473">b</span><span class="op" id="3683474">.</span><span class="ident" id="3683475">abs</span>&nbsp;<span class="op" id="3683479">=</span>&nbsp;<span class="ident" id="3683481">z</span><span class="op" id="3683482">.</span><span class="ident" id="3683483">b</span><span class="op" id="3683484">.</span><span class="ident" id="3683485">abs</span><span class="op" id="3683488">.</span><span class="ident" id="3683489">setBytes</span><span class="op" id="3683497">(</span><span class="ident" id="3683498">buf</span><span class="op" id="3683501">[</span><span class="ident" id="3683502">i</span><span class="op" id="3683503">:</span><span class="op" id="3683504">]</span><span class="op" id="3683505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683508">return</span>&nbsp;<span class="builtintype" id="3683515">nil</span><br>
<span class="lineno"></span><span class="op" id="3683519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="3683522">//&nbsp;MarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextMarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3683586">func</span>&nbsp;<span class="op" id="3683591">(</span><span class="ident" id="3683592">r</span>&nbsp;<span class="op" id="3683594">*</span><span class="ident" id="3683595">Rat</span><span class="op" id="3683598">)</span>&nbsp;<span class="ident" id="3683600">MarshalText</span><span class="op" id="3683611">(</span><span class="op" id="3683612">)</span>&nbsp;<span class="op" id="3683614">(</span><span class="ident" id="3683615">text</span>&nbsp;<span class="op" id="3683620">[</span><span class="op" id="3683621">]</span><span class="builtintype" id="3683622">byte</span><span class="op" id="3683626">,</span>&nbsp;<span class="ident" id="3683628">err</span>&nbsp;<span class="builtintype" id="3683632">error</span><span class="op" id="3683637">)</span>&nbsp;<span class="op" id="3683639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683642">return</span>&nbsp;<span class="op" id="3683649">[</span><span class="op" id="3683650">]</span><span class="builtintype" id="3683651">byte</span><span class="op" id="3683655">(</span><span class="ident" id="3683656">r</span><span class="op" id="3683657">.</span><span class="ident" id="3683658">RatString</span><span class="op" id="3683667">(</span><span class="op" id="3683668">)</span><span class="op" id="3683669">)</span><span class="op" id="3683670">,</span>&nbsp;<span class="builtintype" id="3683672">nil</span><br>
<span class="lineno"></span><span class="op" id="3683676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span><span class="comment" id="3683679">//&nbsp;UnmarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextUnmarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3683747">func</span>&nbsp;<span class="op" id="3683752">(</span><span class="ident" id="3683753">r</span>&nbsp;<span class="op" id="3683755">*</span><span class="ident" id="3683756">Rat</span><span class="op" id="3683759">)</span>&nbsp;<span class="ident" id="3683761">UnmarshalText</span><span class="op" id="3683774">(</span><span class="ident" id="3683775">text</span>&nbsp;<span class="op" id="3683780">[</span><span class="op" id="3683781">]</span><span class="builtintype" id="3683782">byte</span><span class="op" id="3683786">)</span>&nbsp;<span class="builtintype" id="3683788">error</span>&nbsp;<span class="op" id="3683794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683797">if</span>&nbsp;<span class="ident" id="3683800">_</span><span class="op" id="3683801">,</span>&nbsp;<span class="ident" id="3683803">ok</span>&nbsp;<span class="op" id="3683806">:=</span>&nbsp;<span class="ident" id="3683809">r</span><span class="op" id="3683810">.</span><span class="ident" id="3683811">SetString</span><span class="op" id="3683820">(</span><span class="builtintype" id="3683821">string</span><span class="op" id="3683827">(</span><span class="ident" id="3683828">text</span><span class="op" id="3683832">)</span><span class="op" id="3683833">)</span><span class="op" id="3683834">;</span>&nbsp;<span class="op" id="3683836">!</span><span class="ident" id="3683837">ok</span>&nbsp;<span class="op" id="3683840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683844">return</span>&nbsp;<span class="ident" id="3683851">fmt</span><span class="op" id="3683854">.</span><span class="ident" id="3683855">Errorf</span><span class="op" id="3683861">(</span><span class="string" id="3683862">&#34;math/big:&nbsp;cannot&nbsp;unmarshal&nbsp;%q&nbsp;into&nbsp;a&nbsp;*big.Rat&#34;</span><span class="op" id="3683909">,</span>&nbsp;<span class="ident" id="3683911">text</span><span class="op" id="3683915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3683918">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3683921">return</span>&nbsp;<span class="builtintype" id="3683928">nil</span><br>
<span class="lineno"></span><span class="op" id="3683932">}</span>
</div>
</body>
</html>
