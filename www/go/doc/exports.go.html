<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6233369">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6233424">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6233478">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6233529">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;export&nbsp;filtering&nbsp;of&nbsp;an&nbsp;AST.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6233582">package</span>&nbsp;<span class="ident" id="6233590">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6233595">import</span>&nbsp;<span class="op" id="6233602">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6233605">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6233615">&#34;go/token&#34;</span><br>
<span class="lineno"></span><span class="op" id="6233626">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6233629">//&nbsp;filterIdentList&nbsp;removes&nbsp;unexported&nbsp;names&nbsp;from&nbsp;list&nbsp;in&nbsp;place</span><br>
<span class="lineno">15</span><span class="comment" id="6233692">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;list.&nbsp;If&nbsp;blankOk&nbsp;is&nbsp;set,&nbsp;blank</span><br>
<span class="lineno"></span><span class="comment" id="6233752">//&nbsp;identifiers&nbsp;are&nbsp;considered&nbsp;exported&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="6233798">//</span><br>
<span class="lineno"></span><span class="keyword" id="6233801">func</span>&nbsp;<span class="ident" id="6233806">filterIdentList</span><span class="op" id="6233821">(</span><span class="ident" id="6233822">list</span>&nbsp;<span class="op" id="6233827">[</span><span class="op" id="6233828">]</span><span class="op" id="6233829">*</span><span class="ident" id="6233830">ast</span><span class="op" id="6233833">.</span><span class="ident" id="6233834">Ident</span><span class="op" id="6233839">,</span>&nbsp;<span class="ident" id="6233841">blankOk</span>&nbsp;<span class="builtintype" id="6233849">bool</span><span class="op" id="6233853">)</span>&nbsp;<span class="op" id="6233855">[</span><span class="op" id="6233856">]</span><span class="op" id="6233857">*</span><span class="ident" id="6233858">ast</span><span class="op" id="6233861">.</span><span class="ident" id="6233862">Ident</span>&nbsp;<span class="op" id="6233868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6233871">j</span>&nbsp;<span class="op" id="6233873">:=</span>&nbsp;<span class="num" id="6233876">0</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233879">for</span>&nbsp;<span class="ident" id="6233883">_</span><span class="op" id="6233884">,</span>&nbsp;<span class="ident" id="6233886">x</span>&nbsp;<span class="op" id="6233888">:=</span>&nbsp;<span class="keyword" id="6233891">range</span>&nbsp;<span class="ident" id="6233897">list</span>&nbsp;<span class="op" id="6233902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233906">if</span>&nbsp;<span class="ident" id="6233909">ast</span><span class="op" id="6233912">.</span><span class="ident" id="6233913">IsExported</span><span class="op" id="6233923">(</span><span class="ident" id="6233924">x</span><span class="op" id="6233925">.</span><span class="ident" id="6233926">Name</span><span class="op" id="6233930">)</span>&nbsp;<span class="op" id="6233932">||</span>&nbsp;<span class="op" id="6233935">(</span><span class="ident" id="6233936">blankOk</span>&nbsp;<span class="op" id="6233944">&amp;&amp;</span>&nbsp;<span class="ident" id="6233947">x</span><span class="op" id="6233948">.</span><span class="ident" id="6233949">Name</span>&nbsp;<span class="op" id="6233954">==</span>&nbsp;<span class="string" id="6233957">&#34;_&#34;</span><span class="op" id="6233960">)</span>&nbsp;<span class="op" id="6233962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6233967">list</span><span class="op" id="6233971">[</span><span class="ident" id="6233972">j</span><span class="op" id="6233973">]</span>&nbsp;<span class="op" id="6233975">=</span>&nbsp;<span class="ident" id="6233977">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6233982">j</span><span class="op" id="6233983">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6233988">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6233991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6233994">return</span>&nbsp;<span class="ident" id="6234001">list</span><span class="op" id="6234005">[</span><span class="num" id="6234006">0</span><span class="op" id="6234007">:</span><span class="ident" id="6234008">j</span><span class="op" id="6234009">]</span><br>
<span class="lineno"></span><span class="op" id="6234011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6234014">//&nbsp;removeErrorField&nbsp;removes&nbsp;anonymous&nbsp;fields&nbsp;named&nbsp;&#34;error&#34;&nbsp;from&nbsp;an&nbsp;interface.</span><br>
<span class="lineno">30</span><span class="comment" id="6234092">//&nbsp;This&nbsp;is&nbsp;called&nbsp;when&nbsp;&#34;error&#34;&nbsp;has&nbsp;been&nbsp;determined&nbsp;to&nbsp;be&nbsp;a&nbsp;local&nbsp;name,</span><br>
<span class="lineno"></span><span class="comment" id="6234163">//&nbsp;not&nbsp;the&nbsp;predeclared&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="6234192">//</span><br>
<span class="lineno"></span><span class="keyword" id="6234195">func</span>&nbsp;<span class="ident" id="6234200">removeErrorField</span><span class="op" id="6234216">(</span><span class="ident" id="6234217">ityp</span>&nbsp;<span class="op" id="6234222">*</span><span class="ident" id="6234223">ast</span><span class="op" id="6234226">.</span><span class="ident" id="6234227">InterfaceType</span><span class="op" id="6234240">)</span>&nbsp;<span class="op" id="6234242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234245">list</span>&nbsp;<span class="op" id="6234250">:=</span>&nbsp;<span class="ident" id="6234253">ityp</span><span class="op" id="6234257">.</span><span class="ident" id="6234258">Methods</span><span class="op" id="6234265">.</span><span class="ident" id="6234266">List</span>&nbsp;<span class="comment" id="6234271">//&nbsp;we&nbsp;know&nbsp;that&nbsp;ityp.Methods&nbsp;!=&nbsp;nil</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234308">j</span>&nbsp;<span class="op" id="6234310">:=</span>&nbsp;<span class="num" id="6234313">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6234316">for</span>&nbsp;<span class="ident" id="6234320">_</span><span class="op" id="6234321">,</span>&nbsp;<span class="ident" id="6234323">field</span>&nbsp;<span class="op" id="6234329">:=</span>&nbsp;<span class="keyword" id="6234332">range</span>&nbsp;<span class="ident" id="6234338">list</span>&nbsp;<span class="op" id="6234343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234347">keepField</span>&nbsp;<span class="op" id="6234357">:=</span>&nbsp;<span class="ident" id="6234360">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6234367">if</span>&nbsp;<span class="ident" id="6234370">n</span>&nbsp;<span class="op" id="6234372">:=</span>&nbsp;<span class="builtinfunc" id="6234375">len</span><span class="op" id="6234378">(</span><span class="ident" id="6234379">field</span><span class="op" id="6234384">.</span><span class="ident" id="6234385">Names</span><span class="op" id="6234390">)</span><span class="op" id="6234391">;</span>&nbsp;<span class="ident" id="6234393">n</span>&nbsp;<span class="op" id="6234395">==</span>&nbsp;<span class="num" id="6234398">0</span>&nbsp;<span class="op" id="6234400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6234405">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6234427">if</span>&nbsp;<span class="ident" id="6234430">fname</span><span class="op" id="6234435">,</span>&nbsp;<span class="ident" id="6234437">_</span>&nbsp;<span class="op" id="6234439">:=</span>&nbsp;<span class="ident" id="6234442">baseTypeName</span><span class="op" id="6234454">(</span><span class="ident" id="6234455">field</span><span class="op" id="6234460">.</span><span class="ident" id="6234461">Type</span><span class="op" id="6234465">)</span><span class="op" id="6234466">;</span>&nbsp;<span class="ident" id="6234468">fname</span>&nbsp;<span class="op" id="6234474">==</span>&nbsp;<span class="string" id="6234477">&#34;error&#34;</span>&nbsp;<span class="op" id="6234485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234491">keepField</span>&nbsp;<span class="op" id="6234501">=</span>&nbsp;<span class="ident" id="6234503">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6234512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6234516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6234520">if</span>&nbsp;<span class="ident" id="6234523">keepField</span>&nbsp;<span class="op" id="6234533">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234538">list</span><span class="op" id="6234542">[</span><span class="ident" id="6234543">j</span><span class="op" id="6234544">]</span>&nbsp;<span class="op" id="6234546">=</span>&nbsp;<span class="ident" id="6234548">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234557">j</span><span class="op" id="6234558">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6234563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6234566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6234569">if</span>&nbsp;<span class="ident" id="6234572">j</span>&nbsp;<span class="op" id="6234574">&lt;</span>&nbsp;<span class="builtinfunc" id="6234576">len</span><span class="op" id="6234579">(</span><span class="ident" id="6234580">list</span><span class="op" id="6234584">)</span>&nbsp;<span class="op" id="6234586">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234590">ityp</span><span class="op" id="6234594">.</span><span class="ident" id="6234595">Incomplete</span>&nbsp;<span class="op" id="6234606">=</span>&nbsp;<span class="ident" id="6234608">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6234614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234617">ityp</span><span class="op" id="6234621">.</span><span class="ident" id="6234622">Methods</span><span class="op" id="6234629">.</span><span class="ident" id="6234630">List</span>&nbsp;<span class="op" id="6234635">=</span>&nbsp;<span class="ident" id="6234637">list</span><span class="op" id="6234641">[</span><span class="num" id="6234642">0</span><span class="op" id="6234643">:</span><span class="ident" id="6234644">j</span><span class="op" id="6234645">]</span><br>
<span class="lineno"></span><span class="op" id="6234647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="6234650">//&nbsp;filterFieldList&nbsp;removes&nbsp;unexported&nbsp;fields&nbsp;(field&nbsp;names)&nbsp;from&nbsp;the&nbsp;field&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="6234729">//&nbsp;in&nbsp;place&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;fields&nbsp;were&nbsp;removed.&nbsp;Anonymous&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="6234803">//&nbsp;recorded&nbsp;with&nbsp;the&nbsp;parent&nbsp;type.&nbsp;filterType&nbsp;is&nbsp;called&nbsp;with&nbsp;the&nbsp;types&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6234876">//&nbsp;all&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="6234901">//</span><br>
<span class="lineno">60</span><span class="keyword" id="6234904">func</span>&nbsp;<span class="op" id="6234909">(</span><span class="ident" id="6234910">r</span>&nbsp;<span class="op" id="6234912">*</span><span class="ident" id="6234913">reader</span><span class="op" id="6234919">)</span>&nbsp;<span class="ident" id="6234921">filterFieldList</span><span class="op" id="6234936">(</span><span class="ident" id="6234937">parent</span>&nbsp;<span class="op" id="6234944">*</span><span class="ident" id="6234945">namedType</span><span class="op" id="6234954">,</span>&nbsp;<span class="ident" id="6234956">fields</span>&nbsp;<span class="op" id="6234963">*</span><span class="ident" id="6234964">ast</span><span class="op" id="6234967">.</span><span class="ident" id="6234968">FieldList</span><span class="op" id="6234977">,</span>&nbsp;<span class="ident" id="6234979">ityp</span>&nbsp;<span class="op" id="6234984">*</span><span class="ident" id="6234985">ast</span><span class="op" id="6234988">.</span><span class="ident" id="6234989">InterfaceType</span><span class="op" id="6235002">)</span>&nbsp;<span class="op" id="6235004">(</span><span class="ident" id="6235005">removedFields</span>&nbsp;<span class="builtintype" id="6235019">bool</span><span class="op" id="6235023">)</span>&nbsp;<span class="op" id="6235025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235028">if</span>&nbsp;<span class="ident" id="6235031">fields</span>&nbsp;<span class="op" id="6235038">==</span>&nbsp;<span class="ident" id="6235041">nil</span>&nbsp;<span class="op" id="6235045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235049">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235060">list</span>&nbsp;<span class="op" id="6235065">:=</span>&nbsp;<span class="ident" id="6235068">fields</span><span class="op" id="6235074">.</span><span class="ident" id="6235075">List</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235081">j</span>&nbsp;<span class="op" id="6235083">:=</span>&nbsp;<span class="num" id="6235086">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235089">for</span>&nbsp;<span class="ident" id="6235093">_</span><span class="op" id="6235094">,</span>&nbsp;<span class="ident" id="6235096">field</span>&nbsp;<span class="op" id="6235102">:=</span>&nbsp;<span class="keyword" id="6235105">range</span>&nbsp;<span class="ident" id="6235111">list</span>&nbsp;<span class="op" id="6235116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235120">keepField</span>&nbsp;<span class="op" id="6235130">:=</span>&nbsp;<span class="ident" id="6235133">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235141">if</span>&nbsp;<span class="ident" id="6235144">n</span>&nbsp;<span class="op" id="6235146">:=</span>&nbsp;<span class="builtinfunc" id="6235149">len</span><span class="op" id="6235152">(</span><span class="ident" id="6235153">field</span><span class="op" id="6235158">.</span><span class="ident" id="6235159">Names</span><span class="op" id="6235164">)</span><span class="op" id="6235165">;</span>&nbsp;<span class="ident" id="6235167">n</span>&nbsp;<span class="op" id="6235169">==</span>&nbsp;<span class="num" id="6235172">0</span>&nbsp;<span class="op" id="6235174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6235179">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235201">fname</span>&nbsp;<span class="op" id="6235207">:=</span>&nbsp;<span class="ident" id="6235210">r</span><span class="op" id="6235211">.</span><span class="ident" id="6235212">recordAnonymousField</span><span class="op" id="6235232">(</span><span class="ident" id="6235233">parent</span><span class="op" id="6235239">,</span>&nbsp;<span class="ident" id="6235241">field</span><span class="op" id="6235246">.</span><span class="ident" id="6235247">Type</span><span class="op" id="6235251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235256">if</span>&nbsp;<span class="ident" id="6235259">ast</span><span class="op" id="6235262">.</span><span class="ident" id="6235263">IsExported</span><span class="op" id="6235273">(</span><span class="ident" id="6235274">fname</span><span class="op" id="6235279">)</span>&nbsp;<span class="op" id="6235281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235287">keepField</span>&nbsp;<span class="op" id="6235297">=</span>&nbsp;<span class="ident" id="6235299">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235307">}</span>&nbsp;<span class="keyword" id="6235309">else</span>&nbsp;<span class="keyword" id="6235314">if</span>&nbsp;<span class="ident" id="6235317">ityp</span>&nbsp;<span class="op" id="6235322">!=</span>&nbsp;<span class="ident" id="6235325">nil</span>&nbsp;<span class="op" id="6235329">&amp;&amp;</span>&nbsp;<span class="ident" id="6235332">fname</span>&nbsp;<span class="op" id="6235338">==</span>&nbsp;<span class="string" id="6235341">&#34;error&#34;</span>&nbsp;<span class="op" id="6235349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6235355">//&nbsp;possibly&nbsp;the&nbsp;predeclared&nbsp;error&nbsp;interface;&nbsp;keep</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6235409">//&nbsp;it&nbsp;for&nbsp;now&nbsp;but&nbsp;remember&nbsp;this&nbsp;interface&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6235463">//&nbsp;it&nbsp;can&nbsp;be&nbsp;fixed&nbsp;if&nbsp;error&nbsp;is&nbsp;also&nbsp;defined&nbsp;locally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235519">keepField</span>&nbsp;<span class="op" id="6235529">=</span>&nbsp;<span class="ident" id="6235531">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235540">r</span><span class="op" id="6235541">.</span><span class="ident" id="6235542">remember</span><span class="op" id="6235550">(</span><span class="ident" id="6235551">ityp</span><span class="op" id="6235555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235560">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235564">}</span>&nbsp;<span class="keyword" id="6235566">else</span>&nbsp;<span class="op" id="6235571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235576">field</span><span class="op" id="6235581">.</span><span class="ident" id="6235582">Names</span>&nbsp;<span class="op" id="6235588">=</span>&nbsp;<span class="ident" id="6235590">filterIdentList</span><span class="op" id="6235605">(</span><span class="ident" id="6235606">field</span><span class="op" id="6235611">.</span><span class="ident" id="6235612">Names</span><span class="op" id="6235617">,</span>&nbsp;<span class="ident" id="6235619">false</span><span class="op" id="6235624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235629">if</span>&nbsp;<span class="builtinfunc" id="6235632">len</span><span class="op" id="6235635">(</span><span class="ident" id="6235636">field</span><span class="op" id="6235641">.</span><span class="ident" id="6235642">Names</span><span class="op" id="6235647">)</span>&nbsp;<span class="op" id="6235649">&lt;</span>&nbsp;<span class="ident" id="6235651">n</span>&nbsp;<span class="op" id="6235653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235659">removedFields</span>&nbsp;<span class="op" id="6235673">=</span>&nbsp;<span class="ident" id="6235675">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235683">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235688">if</span>&nbsp;<span class="builtinfunc" id="6235691">len</span><span class="op" id="6235694">(</span><span class="ident" id="6235695">field</span><span class="op" id="6235700">.</span><span class="ident" id="6235701">Names</span><span class="op" id="6235706">)</span>&nbsp;<span class="op" id="6235708">&gt;</span>&nbsp;<span class="num" id="6235710">0</span>&nbsp;<span class="op" id="6235712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235718">keepField</span>&nbsp;<span class="op" id="6235728">=</span>&nbsp;<span class="ident" id="6235730">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235746">if</span>&nbsp;<span class="ident" id="6235749">keepField</span>&nbsp;<span class="op" id="6235759">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235764">r</span><span class="op" id="6235765">.</span><span class="ident" id="6235766">filterType</span><span class="op" id="6235776">(</span><span class="ident" id="6235777">nil</span><span class="op" id="6235780">,</span>&nbsp;<span class="ident" id="6235782">field</span><span class="op" id="6235787">.</span><span class="ident" id="6235788">Type</span><span class="op" id="6235792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235797">list</span><span class="op" id="6235801">[</span><span class="ident" id="6235802">j</span><span class="op" id="6235803">]</span>&nbsp;<span class="op" id="6235805">=</span>&nbsp;<span class="ident" id="6235807">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235816">j</span><span class="op" id="6235817">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235825">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235828">if</span>&nbsp;<span class="ident" id="6235831">j</span>&nbsp;<span class="op" id="6235833">&lt;</span>&nbsp;<span class="builtinfunc" id="6235835">len</span><span class="op" id="6235838">(</span><span class="ident" id="6235839">list</span><span class="op" id="6235843">)</span>&nbsp;<span class="op" id="6235845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235849">removedFields</span>&nbsp;<span class="op" id="6235863">=</span>&nbsp;<span class="ident" id="6235865">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235874">fields</span><span class="op" id="6235880">.</span><span class="ident" id="6235881">List</span>&nbsp;<span class="op" id="6235886">=</span>&nbsp;<span class="ident" id="6235888">list</span><span class="op" id="6235892">[</span><span class="num" id="6235893">0</span><span class="op" id="6235894">:</span><span class="ident" id="6235895">j</span><span class="op" id="6235896">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235899">return</span><br>
<span class="lineno">100</span><span class="op" id="6235906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6235909">//&nbsp;filterParamList&nbsp;applies&nbsp;filterType&nbsp;to&nbsp;each&nbsp;parameter&nbsp;type&nbsp;in&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="6235981">//</span><br>
<span class="lineno"></span><span class="keyword" id="6235984">func</span>&nbsp;<span class="op" id="6235989">(</span><span class="ident" id="6235990">r</span>&nbsp;<span class="op" id="6235992">*</span><span class="ident" id="6235993">reader</span><span class="op" id="6235999">)</span>&nbsp;<span class="ident" id="6236001">filterParamList</span><span class="op" id="6236016">(</span><span class="ident" id="6236017">fields</span>&nbsp;<span class="op" id="6236024">*</span><span class="ident" id="6236025">ast</span><span class="op" id="6236028">.</span><span class="ident" id="6236029">FieldList</span><span class="op" id="6236038">)</span>&nbsp;<span class="op" id="6236040">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236043">if</span>&nbsp;<span class="ident" id="6236046">fields</span>&nbsp;<span class="op" id="6236053">!=</span>&nbsp;<span class="ident" id="6236056">nil</span>&nbsp;<span class="op" id="6236060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236064">for</span>&nbsp;<span class="ident" id="6236068">_</span><span class="op" id="6236069">,</span>&nbsp;<span class="ident" id="6236071">f</span>&nbsp;<span class="op" id="6236073">:=</span>&nbsp;<span class="keyword" id="6236076">range</span>&nbsp;<span class="ident" id="6236082">fields</span><span class="op" id="6236088">.</span><span class="ident" id="6236089">List</span>&nbsp;<span class="op" id="6236094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236099">r</span><span class="op" id="6236100">.</span><span class="ident" id="6236101">filterType</span><span class="op" id="6236111">(</span><span class="ident" id="6236112">nil</span><span class="op" id="6236115">,</span>&nbsp;<span class="ident" id="6236117">f</span><span class="op" id="6236118">.</span><span class="ident" id="6236119">Type</span><span class="op" id="6236123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6236127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6236130">}</span><br>
<span class="lineno">110</span><span class="op" id="6236132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6236135">//&nbsp;filterType&nbsp;strips&nbsp;any&nbsp;unexported&nbsp;struct&nbsp;fields&nbsp;or&nbsp;method&nbsp;types&nbsp;from&nbsp;typ</span><br>
<span class="lineno"></span><span class="comment" id="6236210">//&nbsp;in&nbsp;place.&nbsp;If&nbsp;fields&nbsp;(or&nbsp;methods)&nbsp;have&nbsp;been&nbsp;removed,&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="6236283">//&nbsp;struct&nbsp;or&nbsp;interface&nbsp;type&nbsp;has&nbsp;the&nbsp;Incomplete&nbsp;field&nbsp;set&nbsp;to&nbsp;true.</span><br>
<span class="lineno">115</span><span class="comment" id="6236349">//</span><br>
<span class="lineno"></span><span class="keyword" id="6236352">func</span>&nbsp;<span class="op" id="6236357">(</span><span class="ident" id="6236358">r</span>&nbsp;<span class="op" id="6236360">*</span><span class="ident" id="6236361">reader</span><span class="op" id="6236367">)</span>&nbsp;<span class="ident" id="6236369">filterType</span><span class="op" id="6236379">(</span><span class="ident" id="6236380">parent</span>&nbsp;<span class="op" id="6236387">*</span><span class="ident" id="6236388">namedType</span><span class="op" id="6236397">,</span>&nbsp;<span class="ident" id="6236399">typ</span>&nbsp;<span class="ident" id="6236403">ast</span><span class="op" id="6236406">.</span><span class="ident" id="6236407">Expr</span><span class="op" id="6236411">)</span>&nbsp;<span class="op" id="6236413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236416">switch</span>&nbsp;<span class="ident" id="6236423">t</span>&nbsp;<span class="op" id="6236425">:=</span>&nbsp;<span class="ident" id="6236428">typ</span><span class="op" id="6236431">.</span><span class="op" id="6236432">(</span><span class="keyword" id="6236433">type</span><span class="op" id="6236437">)</span>&nbsp;<span class="op" id="6236439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236442">case</span>&nbsp;<span class="op" id="6236447">*</span><span class="ident" id="6236448">ast</span><span class="op" id="6236451">.</span><span class="ident" id="6236452">Ident</span><span class="op" id="6236457">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236461">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236479">case</span>&nbsp;<span class="op" id="6236484">*</span><span class="ident" id="6236485">ast</span><span class="op" id="6236488">.</span><span class="ident" id="6236489">ParenExpr</span><span class="op" id="6236498">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236502">r</span><span class="op" id="6236503">.</span><span class="ident" id="6236504">filterType</span><span class="op" id="6236514">(</span><span class="ident" id="6236515">nil</span><span class="op" id="6236518">,</span>&nbsp;<span class="ident" id="6236520">t</span><span class="op" id="6236521">.</span><span class="ident" id="6236522">X</span><span class="op" id="6236523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236526">case</span>&nbsp;<span class="op" id="6236531">*</span><span class="ident" id="6236532">ast</span><span class="op" id="6236535">.</span><span class="ident" id="6236536">ArrayType</span><span class="op" id="6236545">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236549">r</span><span class="op" id="6236550">.</span><span class="ident" id="6236551">filterType</span><span class="op" id="6236561">(</span><span class="ident" id="6236562">nil</span><span class="op" id="6236565">,</span>&nbsp;<span class="ident" id="6236567">t</span><span class="op" id="6236568">.</span><span class="ident" id="6236569">Elt</span><span class="op" id="6236572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236575">case</span>&nbsp;<span class="op" id="6236580">*</span><span class="ident" id="6236581">ast</span><span class="op" id="6236584">.</span><span class="ident" id="6236585">StructType</span><span class="op" id="6236595">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236599">if</span>&nbsp;<span class="ident" id="6236602">r</span><span class="op" id="6236603">.</span><span class="ident" id="6236604">filterFieldList</span><span class="op" id="6236619">(</span><span class="ident" id="6236620">parent</span><span class="op" id="6236626">,</span>&nbsp;<span class="ident" id="6236628">t</span><span class="op" id="6236629">.</span><span class="ident" id="6236630">Fields</span><span class="op" id="6236636">,</span>&nbsp;<span class="ident" id="6236638">nil</span><span class="op" id="6236641">)</span>&nbsp;<span class="op" id="6236643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236648">t</span><span class="op" id="6236649">.</span><span class="ident" id="6236650">Incomplete</span>&nbsp;<span class="op" id="6236661">=</span>&nbsp;<span class="ident" id="6236663">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6236670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236673">case</span>&nbsp;<span class="op" id="6236678">*</span><span class="ident" id="6236679">ast</span><span class="op" id="6236682">.</span><span class="ident" id="6236683">FuncType</span><span class="op" id="6236691">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236695">r</span><span class="op" id="6236696">.</span><span class="ident" id="6236697">filterParamList</span><span class="op" id="6236712">(</span><span class="ident" id="6236713">t</span><span class="op" id="6236714">.</span><span class="ident" id="6236715">Params</span><span class="op" id="6236721">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236725">r</span><span class="op" id="6236726">.</span><span class="ident" id="6236727">filterParamList</span><span class="op" id="6236742">(</span><span class="ident" id="6236743">t</span><span class="op" id="6236744">.</span><span class="ident" id="6236745">Results</span><span class="op" id="6236752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236755">case</span>&nbsp;<span class="op" id="6236760">*</span><span class="ident" id="6236761">ast</span><span class="op" id="6236764">.</span><span class="ident" id="6236765">InterfaceType</span><span class="op" id="6236778">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236782">if</span>&nbsp;<span class="ident" id="6236785">r</span><span class="op" id="6236786">.</span><span class="ident" id="6236787">filterFieldList</span><span class="op" id="6236802">(</span><span class="ident" id="6236803">parent</span><span class="op" id="6236809">,</span>&nbsp;<span class="ident" id="6236811">t</span><span class="op" id="6236812">.</span><span class="ident" id="6236813">Methods</span><span class="op" id="6236820">,</span>&nbsp;<span class="ident" id="6236822">t</span><span class="op" id="6236823">)</span>&nbsp;<span class="op" id="6236825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236830">t</span><span class="op" id="6236831">.</span><span class="ident" id="6236832">Incomplete</span>&nbsp;<span class="op" id="6236843">=</span>&nbsp;<span class="ident" id="6236845">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6236852">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236855">case</span>&nbsp;<span class="op" id="6236860">*</span><span class="ident" id="6236861">ast</span><span class="op" id="6236864">.</span><span class="ident" id="6236865">MapType</span><span class="op" id="6236872">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236876">r</span><span class="op" id="6236877">.</span><span class="ident" id="6236878">filterType</span><span class="op" id="6236888">(</span><span class="ident" id="6236889">nil</span><span class="op" id="6236892">,</span>&nbsp;<span class="ident" id="6236894">t</span><span class="op" id="6236895">.</span><span class="ident" id="6236896">Key</span><span class="op" id="6236899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236903">r</span><span class="op" id="6236904">.</span><span class="ident" id="6236905">filterType</span><span class="op" id="6236915">(</span><span class="ident" id="6236916">nil</span><span class="op" id="6236919">,</span>&nbsp;<span class="ident" id="6236921">t</span><span class="op" id="6236922">.</span><span class="ident" id="6236923">Value</span><span class="op" id="6236928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236931">case</span>&nbsp;<span class="op" id="6236936">*</span><span class="ident" id="6236937">ast</span><span class="op" id="6236940">.</span><span class="ident" id="6236941">ChanType</span><span class="op" id="6236949">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236953">r</span><span class="op" id="6236954">.</span><span class="ident" id="6236955">filterType</span><span class="op" id="6236965">(</span><span class="ident" id="6236966">nil</span><span class="op" id="6236969">,</span>&nbsp;<span class="ident" id="6236971">t</span><span class="op" id="6236972">.</span><span class="ident" id="6236973">Value</span><span class="op" id="6236978">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6236981">}</span><br>
<span class="lineno"></span><span class="op" id="6236983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6236986">func</span>&nbsp;<span class="op" id="6236991">(</span><span class="ident" id="6236992">r</span>&nbsp;<span class="op" id="6236994">*</span><span class="ident" id="6236995">reader</span><span class="op" id="6237001">)</span>&nbsp;<span class="ident" id="6237003">filterSpec</span><span class="op" id="6237013">(</span><span class="ident" id="6237014">spec</span>&nbsp;<span class="ident" id="6237019">ast</span><span class="op" id="6237022">.</span><span class="ident" id="6237023">Spec</span><span class="op" id="6237027">,</span>&nbsp;<span class="ident" id="6237029">tok</span>&nbsp;<span class="ident" id="6237033">token</span><span class="op" id="6237038">.</span><span class="ident" id="6237039">Token</span><span class="op" id="6237044">)</span>&nbsp;<span class="builtintype" id="6237046">bool</span>&nbsp;<span class="op" id="6237051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237054">switch</span>&nbsp;<span class="ident" id="6237061">s</span>&nbsp;<span class="op" id="6237063">:=</span>&nbsp;<span class="ident" id="6237066">spec</span><span class="op" id="6237070">.</span><span class="op" id="6237071">(</span><span class="keyword" id="6237072">type</span><span class="op" id="6237076">)</span>&nbsp;<span class="op" id="6237078">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237081">case</span>&nbsp;<span class="op" id="6237086">*</span><span class="ident" id="6237087">ast</span><span class="op" id="6237090">.</span><span class="ident" id="6237091">ImportSpec</span><span class="op" id="6237101">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6237105">//&nbsp;always&nbsp;keep&nbsp;imports&nbsp;so&nbsp;we&nbsp;can&nbsp;collect&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237153">return</span>&nbsp;<span class="ident" id="6237160">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237166">case</span>&nbsp;<span class="op" id="6237171">*</span><span class="ident" id="6237172">ast</span><span class="op" id="6237175">.</span><span class="ident" id="6237176">ValueSpec</span><span class="op" id="6237185">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6237189">//&nbsp;special&nbsp;case:&nbsp;consider&nbsp;blank&nbsp;constants&nbsp;as&nbsp;exported</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6237245">//&nbsp;(work-around&nbsp;for&nbsp;issue&nbsp;5397)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237279">s</span><span class="op" id="6237280">.</span><span class="ident" id="6237281">Names</span>&nbsp;<span class="op" id="6237287">=</span>&nbsp;<span class="ident" id="6237289">filterIdentList</span><span class="op" id="6237304">(</span><span class="ident" id="6237305">s</span><span class="op" id="6237306">.</span><span class="ident" id="6237307">Names</span><span class="op" id="6237312">,</span>&nbsp;<span class="ident" id="6237314">tok</span>&nbsp;<span class="op" id="6237318">==</span>&nbsp;<span class="ident" id="6237321">token</span><span class="op" id="6237326">.</span><span class="ident" id="6237327">CONST</span><span class="op" id="6237332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237336">if</span>&nbsp;<span class="builtinfunc" id="6237339">len</span><span class="op" id="6237342">(</span><span class="ident" id="6237343">s</span><span class="op" id="6237344">.</span><span class="ident" id="6237345">Names</span><span class="op" id="6237350">)</span>&nbsp;<span class="op" id="6237352">&gt;</span>&nbsp;<span class="num" id="6237354">0</span>&nbsp;<span class="op" id="6237356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237361">r</span><span class="op" id="6237362">.</span><span class="ident" id="6237363">filterType</span><span class="op" id="6237373">(</span><span class="ident" id="6237374">nil</span><span class="op" id="6237377">,</span>&nbsp;<span class="ident" id="6237379">s</span><span class="op" id="6237380">.</span><span class="ident" id="6237381">Type</span><span class="op" id="6237385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237390">return</span>&nbsp;<span class="ident" id="6237397">true</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6237404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237407">case</span>&nbsp;<span class="op" id="6237412">*</span><span class="ident" id="6237413">ast</span><span class="op" id="6237416">.</span><span class="ident" id="6237417">TypeSpec</span><span class="op" id="6237425">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237429">if</span>&nbsp;<span class="ident" id="6237432">name</span>&nbsp;<span class="op" id="6237437">:=</span>&nbsp;<span class="ident" id="6237440">s</span><span class="op" id="6237441">.</span><span class="ident" id="6237442">Name</span><span class="op" id="6237446">.</span><span class="ident" id="6237447">Name</span><span class="op" id="6237451">;</span>&nbsp;<span class="ident" id="6237453">ast</span><span class="op" id="6237456">.</span><span class="ident" id="6237457">IsExported</span><span class="op" id="6237467">(</span><span class="ident" id="6237468">name</span><span class="op" id="6237472">)</span>&nbsp;<span class="op" id="6237474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237479">r</span><span class="op" id="6237480">.</span><span class="ident" id="6237481">filterType</span><span class="op" id="6237491">(</span><span class="ident" id="6237492">r</span><span class="op" id="6237493">.</span><span class="ident" id="6237494">lookupType</span><span class="op" id="6237504">(</span><span class="ident" id="6237505">s</span><span class="op" id="6237506">.</span><span class="ident" id="6237507">Name</span><span class="op" id="6237511">.</span><span class="ident" id="6237512">Name</span><span class="op" id="6237516">)</span><span class="op" id="6237517">,</span>&nbsp;<span class="ident" id="6237519">s</span><span class="op" id="6237520">.</span><span class="ident" id="6237521">Type</span><span class="op" id="6237525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237530">return</span>&nbsp;<span class="ident" id="6237537">true</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6237544">}</span>&nbsp;<span class="keyword" id="6237546">else</span>&nbsp;<span class="keyword" id="6237551">if</span>&nbsp;<span class="ident" id="6237554">name</span>&nbsp;<span class="op" id="6237559">==</span>&nbsp;<span class="string" id="6237562">&#34;error&#34;</span>&nbsp;<span class="op" id="6237570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6237575">//&nbsp;special&nbsp;case:&nbsp;remember&nbsp;that&nbsp;error&nbsp;is&nbsp;declared&nbsp;locally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237635">r</span><span class="op" id="6237636">.</span><span class="ident" id="6237637">errorDecl</span>&nbsp;<span class="op" id="6237647">=</span>&nbsp;<span class="ident" id="6237649">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6237656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6237659">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237662">return</span>&nbsp;<span class="ident" id="6237669">false</span><br>
<span class="lineno"></span><span class="op" id="6237675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6237678">func</span>&nbsp;<span class="op" id="6237683">(</span><span class="ident" id="6237684">r</span>&nbsp;<span class="op" id="6237686">*</span><span class="ident" id="6237687">reader</span><span class="op" id="6237693">)</span>&nbsp;<span class="ident" id="6237695">filterSpecList</span><span class="op" id="6237709">(</span><span class="ident" id="6237710">list</span>&nbsp;<span class="op" id="6237715">[</span><span class="op" id="6237716">]</span><span class="ident" id="6237717">ast</span><span class="op" id="6237720">.</span><span class="ident" id="6237721">Spec</span><span class="op" id="6237725">,</span>&nbsp;<span class="ident" id="6237727">tok</span>&nbsp;<span class="ident" id="6237731">token</span><span class="op" id="6237736">.</span><span class="ident" id="6237737">Token</span><span class="op" id="6237742">)</span>&nbsp;<span class="op" id="6237744">[</span><span class="op" id="6237745">]</span><span class="ident" id="6237746">ast</span><span class="op" id="6237749">.</span><span class="ident" id="6237750">Spec</span>&nbsp;<span class="op" id="6237755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237758">j</span>&nbsp;<span class="op" id="6237760">:=</span>&nbsp;<span class="num" id="6237763">0</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237766">for</span>&nbsp;<span class="ident" id="6237770">_</span><span class="op" id="6237771">,</span>&nbsp;<span class="ident" id="6237773">s</span>&nbsp;<span class="op" id="6237775">:=</span>&nbsp;<span class="keyword" id="6237778">range</span>&nbsp;<span class="ident" id="6237784">list</span>&nbsp;<span class="op" id="6237789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237793">if</span>&nbsp;<span class="ident" id="6237796">r</span><span class="op" id="6237797">.</span><span class="ident" id="6237798">filterSpec</span><span class="op" id="6237808">(</span><span class="ident" id="6237809">s</span><span class="op" id="6237810">,</span>&nbsp;<span class="ident" id="6237812">tok</span><span class="op" id="6237815">)</span>&nbsp;<span class="op" id="6237817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237822">list</span><span class="op" id="6237826">[</span><span class="ident" id="6237827">j</span><span class="op" id="6237828">]</span>&nbsp;<span class="op" id="6237830">=</span>&nbsp;<span class="ident" id="6237832">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237837">j</span><span class="op" id="6237838">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6237843">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6237846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237849">return</span>&nbsp;<span class="ident" id="6237856">list</span><span class="op" id="6237860">[</span><span class="num" id="6237861">0</span><span class="op" id="6237862">:</span><span class="ident" id="6237863">j</span><span class="op" id="6237864">]</span><br>
<span class="lineno"></span><span class="op" id="6237866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6237869">func</span>&nbsp;<span class="op" id="6237874">(</span><span class="ident" id="6237875">r</span>&nbsp;<span class="op" id="6237877">*</span><span class="ident" id="6237878">reader</span><span class="op" id="6237884">)</span>&nbsp;<span class="ident" id="6237886">filterDecl</span><span class="op" id="6237896">(</span><span class="ident" id="6237897">decl</span>&nbsp;<span class="ident" id="6237902">ast</span><span class="op" id="6237905">.</span><span class="ident" id="6237906">Decl</span><span class="op" id="6237910">)</span>&nbsp;<span class="builtintype" id="6237912">bool</span>&nbsp;<span class="op" id="6237917">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237920">switch</span>&nbsp;<span class="ident" id="6237927">d</span>&nbsp;<span class="op" id="6237929">:=</span>&nbsp;<span class="ident" id="6237932">decl</span><span class="op" id="6237936">.</span><span class="op" id="6237937">(</span><span class="keyword" id="6237938">type</span><span class="op" id="6237942">)</span>&nbsp;<span class="op" id="6237944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237947">case</span>&nbsp;<span class="op" id="6237952">*</span><span class="ident" id="6237953">ast</span><span class="op" id="6237956">.</span><span class="ident" id="6237957">GenDecl</span><span class="op" id="6237964">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237968">d</span><span class="op" id="6237969">.</span><span class="ident" id="6237970">Specs</span>&nbsp;<span class="op" id="6237976">=</span>&nbsp;<span class="ident" id="6237978">r</span><span class="op" id="6237979">.</span><span class="ident" id="6237980">filterSpecList</span><span class="op" id="6237994">(</span><span class="ident" id="6237995">d</span><span class="op" id="6237996">.</span><span class="ident" id="6237997">Specs</span><span class="op" id="6238002">,</span>&nbsp;<span class="ident" id="6238004">d</span><span class="op" id="6238005">.</span><span class="ident" id="6238006">Tok</span><span class="op" id="6238009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238013">return</span>&nbsp;<span class="builtinfunc" id="6238020">len</span><span class="op" id="6238023">(</span><span class="ident" id="6238024">d</span><span class="op" id="6238025">.</span><span class="ident" id="6238026">Specs</span><span class="op" id="6238031">)</span>&nbsp;<span class="op" id="6238033">&gt;</span>&nbsp;<span class="num" id="6238035">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238038">case</span>&nbsp;<span class="op" id="6238043">*</span><span class="ident" id="6238044">ast</span><span class="op" id="6238047">.</span><span class="ident" id="6238048">FuncDecl</span><span class="op" id="6238056">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6238060">//&nbsp;ok&nbsp;to&nbsp;filter&nbsp;these&nbsp;methods&nbsp;early&nbsp;because&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6238110">//&nbsp;conflicting&nbsp;method&nbsp;will&nbsp;be&nbsp;filtered&nbsp;here,&nbsp;too&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6238163">//&nbsp;thus,&nbsp;removing&nbsp;these&nbsp;methods&nbsp;early&nbsp;will&nbsp;not&nbsp;lead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6238217">//&nbsp;to&nbsp;the&nbsp;false&nbsp;removal&nbsp;of&nbsp;possible&nbsp;conflicts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238265">return</span>&nbsp;<span class="ident" id="6238272">ast</span><span class="op" id="6238275">.</span><span class="ident" id="6238276">IsExported</span><span class="op" id="6238286">(</span><span class="ident" id="6238287">d</span><span class="op" id="6238288">.</span><span class="ident" id="6238289">Name</span><span class="op" id="6238293">.</span><span class="ident" id="6238294">Name</span><span class="op" id="6238298">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6238301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238304">return</span>&nbsp;<span class="ident" id="6238311">false</span><br>
<span class="lineno"></span><span class="op" id="6238317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6238320">//&nbsp;fileExports&nbsp;removes&nbsp;unexported&nbsp;declarations&nbsp;from&nbsp;src&nbsp;in&nbsp;place.</span><br>
<span class="lineno">195</span><span class="comment" id="6238386">//</span><br>
<span class="lineno"></span><span class="keyword" id="6238389">func</span>&nbsp;<span class="op" id="6238394">(</span><span class="ident" id="6238395">r</span>&nbsp;<span class="op" id="6238397">*</span><span class="ident" id="6238398">reader</span><span class="op" id="6238404">)</span>&nbsp;<span class="ident" id="6238406">fileExports</span><span class="op" id="6238417">(</span><span class="ident" id="6238418">src</span>&nbsp;<span class="op" id="6238422">*</span><span class="ident" id="6238423">ast</span><span class="op" id="6238426">.</span><span class="ident" id="6238427">File</span><span class="op" id="6238431">)</span>&nbsp;<span class="op" id="6238433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238436">j</span>&nbsp;<span class="op" id="6238438">:=</span>&nbsp;<span class="num" id="6238441">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238444">for</span>&nbsp;<span class="ident" id="6238448">_</span><span class="op" id="6238449">,</span>&nbsp;<span class="ident" id="6238451">d</span>&nbsp;<span class="op" id="6238453">:=</span>&nbsp;<span class="keyword" id="6238456">range</span>&nbsp;<span class="ident" id="6238462">src</span><span class="op" id="6238465">.</span><span class="ident" id="6238466">Decls</span>&nbsp;<span class="op" id="6238472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238476">if</span>&nbsp;<span class="ident" id="6238479">r</span><span class="op" id="6238480">.</span><span class="ident" id="6238481">filterDecl</span><span class="op" id="6238491">(</span><span class="ident" id="6238492">d</span><span class="op" id="6238493">)</span>&nbsp;<span class="op" id="6238495">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238500">src</span><span class="op" id="6238503">.</span><span class="ident" id="6238504">Decls</span><span class="op" id="6238509">[</span><span class="ident" id="6238510">j</span><span class="op" id="6238511">]</span>&nbsp;<span class="op" id="6238513">=</span>&nbsp;<span class="ident" id="6238515">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238520">j</span><span class="op" id="6238521">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6238526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6238529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238532">src</span><span class="op" id="6238535">.</span><span class="ident" id="6238536">Decls</span>&nbsp;<span class="op" id="6238542">=</span>&nbsp;<span class="ident" id="6238544">src</span><span class="op" id="6238547">.</span><span class="ident" id="6238548">Decls</span><span class="op" id="6238553">[</span><span class="num" id="6238554">0</span><span class="op" id="6238555">:</span><span class="ident" id="6238556">j</span><span class="op" id="6238557">]</span><br>
<span class="lineno">205</span><span class="op" id="6238559">}</span>
</div>
</body>
</html>
