<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5565002">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5565057">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5565111">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5565162">package</span>&nbsp;<span class="ident" id="5565170">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5565175">import</span>&nbsp;<span class="op" id="5565182">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5565185">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5565194">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5565210">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5565220">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5565229">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5565244">&#34;image/color/palette&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5565267">&#34;image/draw&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5565281">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5565286">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5565289">//&nbsp;Graphic&nbsp;control&nbsp;extension&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="5565326">const</span>&nbsp;<span class="op" id="5565332">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5565335">gcLabel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5565347">=</span>&nbsp;<span class="num" id="5565349">0xF9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5565355">gcBlockSize</span>&nbsp;<span class="op" id="5565367">=</span>&nbsp;<span class="num" id="5565369">0x04</span><br>
<span class="lineno"></span><span class="op" id="5565374">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5565377">var</span>&nbsp;<span class="ident" id="5565381">log2Lookup</span>&nbsp;<span class="op" id="5565392">=</span>&nbsp;<span class="op" id="5565394">[</span><span class="num" id="5565395">8</span><span class="op" id="5565396">]</span><span class="builtintype" id="5565397">int</span><span class="op" id="5565400">{</span><span class="num" id="5565401">2</span><span class="op" id="5565402">,</span>&nbsp;<span class="num" id="5565404">4</span><span class="op" id="5565405">,</span>&nbsp;<span class="num" id="5565407">8</span><span class="op" id="5565408">,</span>&nbsp;<span class="num" id="5565410">16</span><span class="op" id="5565412">,</span>&nbsp;<span class="num" id="5565414">32</span><span class="op" id="5565416">,</span>&nbsp;<span class="num" id="5565418">64</span><span class="op" id="5565420">,</span>&nbsp;<span class="num" id="5565422">128</span><span class="op" id="5565425">,</span>&nbsp;<span class="num" id="5565427">256</span><span class="op" id="5565430">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5565433">func</span>&nbsp;<span class="ident" id="5565438">log2</span><span class="op" id="5565442">(</span><span class="ident" id="5565443">x</span>&nbsp;<span class="builtintype" id="5565445">int</span><span class="op" id="5565448">)</span>&nbsp;<span class="builtintype" id="5565450">int</span>&nbsp;<span class="op" id="5565454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5565457">for</span>&nbsp;<span class="ident" id="5565461">i</span><span class="op" id="5565462">,</span>&nbsp;<span class="ident" id="5565464">v</span>&nbsp;<span class="op" id="5565466">:=</span>&nbsp;<span class="keyword" id="5565469">range</span>&nbsp;<span class="ident" id="5565475">log2Lookup</span>&nbsp;<span class="op" id="5565486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5565490">if</span>&nbsp;<span class="ident" id="5565493">x</span>&nbsp;<span class="op" id="5565495">&lt;=</span>&nbsp;<span class="ident" id="5565498">v</span>&nbsp;<span class="op" id="5565500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5565505">return</span>&nbsp;<span class="ident" id="5565512">i</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5565516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5565519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5565522">return</span>&nbsp;<span class="op" id="5565529">-</span><span class="num" id="5565530">1</span><br>
<span class="lineno"></span><span class="op" id="5565532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5565535">//&nbsp;Little-endian.</span><br>
<span class="lineno"></span><span class="keyword" id="5565553">func</span>&nbsp;<span class="ident" id="5565558">writeUint16</span><span class="op" id="5565569">(</span><span class="ident" id="5565570">b</span>&nbsp;<span class="op" id="5565572">[</span><span class="op" id="5565573">]</span><span class="builtintype" id="5565574">uint8</span><span class="op" id="5565579">,</span>&nbsp;<span class="ident" id="5565581">u</span>&nbsp;<span class="builtintype" id="5565583">uint16</span><span class="op" id="5565589">)</span>&nbsp;<span class="op" id="5565591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5565594">b</span><span class="op" id="5565595">[</span><span class="num" id="5565596">0</span><span class="op" id="5565597">]</span>&nbsp;<span class="op" id="5565599">=</span>&nbsp;<span class="builtintype" id="5565601">uint8</span><span class="op" id="5565606">(</span><span class="ident" id="5565607">u</span><span class="op" id="5565608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5565611">b</span><span class="op" id="5565612">[</span><span class="num" id="5565613">1</span><span class="op" id="5565614">]</span>&nbsp;<span class="op" id="5565616">=</span>&nbsp;<span class="builtintype" id="5565618">uint8</span><span class="op" id="5565623">(</span><span class="ident" id="5565624">u</span>&nbsp;<span class="op" id="5565626">&gt;&gt;</span>&nbsp;<span class="num" id="5565629">8</span><span class="op" id="5565630">)</span><br>
<span class="lineno"></span><span class="op" id="5565632">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="5565635">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5565667">type</span>&nbsp;<span class="ident" id="5565672">writer</span>&nbsp;<span class="keyword" id="5565679">interface</span>&nbsp;<span class="op" id="5565689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5565692">Flush</span><span class="op" id="5565697">(</span><span class="op" id="5565698">)</span>&nbsp;<span class="builtintype" id="5565700">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5565707">io</span><span class="op" id="5565709">.</span><span class="ident" id="5565710">Writer</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5565718">io</span><span class="op" id="5565720">.</span><span class="ident" id="5565721">ByteWriter</span><br>
<span class="lineno"></span><span class="op" id="5565732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5565735">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;GIF&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="5565782">type</span>&nbsp;<span class="ident" id="5565787">encoder</span>&nbsp;<span class="keyword" id="5565795">struct</span>&nbsp;<span class="op" id="5565802">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5565805">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5565880">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5565951">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5565955">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5565963">err</span>&nbsp;<span class="builtintype" id="5565967">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5565974">//&nbsp;g&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;data&nbsp;that&nbsp;is&nbsp;being&nbsp;encoded.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566030">g</span>&nbsp;<span class="op" id="5566032">*</span><span class="ident" id="5566033">GIF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5566038">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.&nbsp;It&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;write&nbsp;the&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566122">buf</span>&nbsp;<span class="op" id="5566126">[</span><span class="num" id="5566127">1024</span><span class="op" id="5566131">]</span><span class="builtintype" id="5566132">byte</span><br>
<span class="lineno"></span><span class="op" id="5566137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5566140">//&nbsp;blockWriter&nbsp;writes&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="5566207">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5566273">//&nbsp;writer&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;encoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5566337">//&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="5566350">type</span>&nbsp;<span class="ident" id="5566355">blockWriter</span>&nbsp;<span class="keyword" id="5566367">struct</span>&nbsp;<span class="op" id="5566374">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566377">e</span>&nbsp;<span class="op" id="5566379">*</span><span class="ident" id="5566380">encoder</span><br>
<span class="lineno"></span><span class="op" id="5566388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5566391">func</span>&nbsp;<span class="op" id="5566396">(</span><span class="ident" id="5566397">b</span>&nbsp;<span class="ident" id="5566399">blockWriter</span><span class="op" id="5566410">)</span>&nbsp;<span class="ident" id="5566412">Write</span><span class="op" id="5566417">(</span><span class="ident" id="5566418">data</span>&nbsp;<span class="op" id="5566423">[</span><span class="op" id="5566424">]</span><span class="builtintype" id="5566425">byte</span><span class="op" id="5566429">)</span>&nbsp;<span class="op" id="5566431">(</span><span class="builtintype" id="5566432">int</span><span class="op" id="5566435">,</span>&nbsp;<span class="builtintype" id="5566437">error</span><span class="op" id="5566442">)</span>&nbsp;<span class="op" id="5566444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5566447">if</span>&nbsp;<span class="ident" id="5566450">b</span><span class="op" id="5566451">.</span><span class="ident" id="5566452">e</span><span class="op" id="5566453">.</span><span class="ident" id="5566454">err</span>&nbsp;<span class="op" id="5566458">!=</span>&nbsp;<span class="ident" id="5566461">nil</span>&nbsp;<span class="op" id="5566465">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5566469">return</span>&nbsp;<span class="num" id="5566476">0</span><span class="op" id="5566477">,</span>&nbsp;<span class="ident" id="5566479">b</span><span class="op" id="5566480">.</span><span class="ident" id="5566481">e</span><span class="op" id="5566482">.</span><span class="ident" id="5566483">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5566488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5566491">if</span>&nbsp;<span class="builtinfunc" id="5566494">len</span><span class="op" id="5566497">(</span><span class="ident" id="5566498">data</span><span class="op" id="5566502">)</span>&nbsp;<span class="op" id="5566504">==</span>&nbsp;<span class="num" id="5566507">0</span>&nbsp;<span class="op" id="5566509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5566513">return</span>&nbsp;<span class="num" id="5566520">0</span><span class="op" id="5566521">,</span>&nbsp;<span class="ident" id="5566523">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5566528">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566531">total</span>&nbsp;<span class="op" id="5566537">:=</span>&nbsp;<span class="num" id="5566540">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5566543">for</span>&nbsp;<span class="ident" id="5566547">total</span>&nbsp;<span class="op" id="5566553">&lt;</span>&nbsp;<span class="builtinfunc" id="5566555">len</span><span class="op" id="5566558">(</span><span class="ident" id="5566559">data</span><span class="op" id="5566563">)</span>&nbsp;<span class="op" id="5566565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566569">n</span>&nbsp;<span class="op" id="5566571">:=</span>&nbsp;<span class="builtinfunc" id="5566574">copy</span><span class="op" id="5566578">(</span><span class="ident" id="5566579">b</span><span class="op" id="5566580">.</span><span class="ident" id="5566581">e</span><span class="op" id="5566582">.</span><span class="ident" id="5566583">buf</span><span class="op" id="5566586">[</span><span class="num" id="5566587">1</span><span class="op" id="5566588">:</span><span class="num" id="5566589">256</span><span class="op" id="5566592">]</span><span class="op" id="5566593">,</span>&nbsp;<span class="ident" id="5566595">data</span><span class="op" id="5566599">[</span><span class="ident" id="5566600">total</span><span class="op" id="5566605">:</span><span class="op" id="5566606">]</span><span class="op" id="5566607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566611">total</span>&nbsp;<span class="op" id="5566617">+=</span>&nbsp;<span class="ident" id="5566620">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566624">b</span><span class="op" id="5566625">.</span><span class="ident" id="5566626">e</span><span class="op" id="5566627">.</span><span class="ident" id="5566628">buf</span><span class="op" id="5566631">[</span><span class="num" id="5566632">0</span><span class="op" id="5566633">]</span>&nbsp;<span class="op" id="5566635">=</span>&nbsp;<span class="builtintype" id="5566637">uint8</span><span class="op" id="5566642">(</span><span class="ident" id="5566643">n</span><span class="op" id="5566644">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566649">n</span><span class="op" id="5566650">,</span>&nbsp;<span class="ident" id="5566652">b</span><span class="op" id="5566653">.</span><span class="ident" id="5566654">e</span><span class="op" id="5566655">.</span><span class="ident" id="5566656">err</span>&nbsp;<span class="op" id="5566660">=</span>&nbsp;<span class="ident" id="5566662">b</span><span class="op" id="5566663">.</span><span class="ident" id="5566664">e</span><span class="op" id="5566665">.</span><span class="ident" id="5566666">w</span><span class="op" id="5566667">.</span><span class="ident" id="5566668">Write</span><span class="op" id="5566673">(</span><span class="ident" id="5566674">b</span><span class="op" id="5566675">.</span><span class="ident" id="5566676">e</span><span class="op" id="5566677">.</span><span class="ident" id="5566678">buf</span><span class="op" id="5566681">[</span><span class="op" id="5566682">:</span><span class="ident" id="5566683">n</span><span class="op" id="5566684">+</span><span class="num" id="5566685">1</span><span class="op" id="5566686">]</span><span class="op" id="5566687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5566691">if</span>&nbsp;<span class="ident" id="5566694">b</span><span class="op" id="5566695">.</span><span class="ident" id="5566696">e</span><span class="op" id="5566697">.</span><span class="ident" id="5566698">err</span>&nbsp;<span class="op" id="5566702">!=</span>&nbsp;<span class="ident" id="5566705">nil</span>&nbsp;<span class="op" id="5566709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5566714">return</span>&nbsp;<span class="num" id="5566721">0</span><span class="op" id="5566722">,</span>&nbsp;<span class="ident" id="5566724">b</span><span class="op" id="5566725">.</span><span class="ident" id="5566726">e</span><span class="op" id="5566727">.</span><span class="ident" id="5566728">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5566734">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5566737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5566740">return</span>&nbsp;<span class="ident" id="5566747">total</span><span class="op" id="5566752">,</span>&nbsp;<span class="ident" id="5566754">b</span><span class="op" id="5566755">.</span><span class="ident" id="5566756">e</span><span class="op" id="5566757">.</span><span class="ident" id="5566758">err</span><br>
<span class="lineno"></span><span class="op" id="5566762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5566765">func</span>&nbsp;<span class="op" id="5566770">(</span><span class="ident" id="5566771">e</span>&nbsp;<span class="op" id="5566773">*</span><span class="ident" id="5566774">encoder</span><span class="op" id="5566781">)</span>&nbsp;<span class="ident" id="5566783">flush</span><span class="op" id="5566788">(</span><span class="op" id="5566789">)</span>&nbsp;<span class="op" id="5566791">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5566794">if</span>&nbsp;<span class="ident" id="5566797">e</span><span class="op" id="5566798">.</span><span class="ident" id="5566799">err</span>&nbsp;<span class="op" id="5566803">!=</span>&nbsp;<span class="ident" id="5566806">nil</span>&nbsp;<span class="op" id="5566810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5566814">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5566822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566825">e</span><span class="op" id="5566826">.</span><span class="ident" id="5566827">err</span>&nbsp;<span class="op" id="5566831">=</span>&nbsp;<span class="ident" id="5566833">e</span><span class="op" id="5566834">.</span><span class="ident" id="5566835">w</span><span class="op" id="5566836">.</span><span class="ident" id="5566837">Flush</span><span class="op" id="5566842">(</span><span class="op" id="5566843">)</span><br>
<span class="lineno"></span><span class="op" id="5566845">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="5566848">func</span>&nbsp;<span class="op" id="5566853">(</span><span class="ident" id="5566854">e</span>&nbsp;<span class="op" id="5566856">*</span><span class="ident" id="5566857">encoder</span><span class="op" id="5566864">)</span>&nbsp;<span class="ident" id="5566866">write</span><span class="op" id="5566871">(</span><span class="ident" id="5566872">p</span>&nbsp;<span class="op" id="5566874">[</span><span class="op" id="5566875">]</span><span class="builtintype" id="5566876">byte</span><span class="op" id="5566880">)</span>&nbsp;<span class="op" id="5566882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5566885">if</span>&nbsp;<span class="ident" id="5566888">e</span><span class="op" id="5566889">.</span><span class="ident" id="5566890">err</span>&nbsp;<span class="op" id="5566894">!=</span>&nbsp;<span class="ident" id="5566897">nil</span>&nbsp;<span class="op" id="5566901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5566905">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5566913">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5566916">_</span><span class="op" id="5566917">,</span>&nbsp;<span class="ident" id="5566919">e</span><span class="op" id="5566920">.</span><span class="ident" id="5566921">err</span>&nbsp;<span class="op" id="5566925">=</span>&nbsp;<span class="ident" id="5566927">e</span><span class="op" id="5566928">.</span><span class="ident" id="5566929">w</span><span class="op" id="5566930">.</span><span class="ident" id="5566931">Write</span><span class="op" id="5566936">(</span><span class="ident" id="5566937">p</span><span class="op" id="5566938">)</span><br>
<span class="lineno"></span><span class="op" id="5566940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5566943">func</span>&nbsp;<span class="op" id="5566948">(</span><span class="ident" id="5566949">e</span>&nbsp;<span class="op" id="5566951">*</span><span class="ident" id="5566952">encoder</span><span class="op" id="5566959">)</span>&nbsp;<span class="ident" id="5566961">writeByte</span><span class="op" id="5566970">(</span><span class="ident" id="5566971">b</span>&nbsp;<span class="builtintype" id="5566973">byte</span><span class="op" id="5566977">)</span>&nbsp;<span class="op" id="5566979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5566982">if</span>&nbsp;<span class="ident" id="5566985">e</span><span class="op" id="5566986">.</span><span class="ident" id="5566987">err</span>&nbsp;<span class="op" id="5566991">!=</span>&nbsp;<span class="ident" id="5566994">nil</span>&nbsp;<span class="op" id="5566998">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5567002">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5567010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567013">e</span><span class="op" id="5567014">.</span><span class="ident" id="5567015">err</span>&nbsp;<span class="op" id="5567019">=</span>&nbsp;<span class="ident" id="5567021">e</span><span class="op" id="5567022">.</span><span class="ident" id="5567023">w</span><span class="op" id="5567024">.</span><span class="ident" id="5567025">WriteByte</span><span class="op" id="5567034">(</span><span class="ident" id="5567035">b</span><span class="op" id="5567036">)</span><br>
<span class="lineno"></span><span class="op" id="5567038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="5567041">func</span>&nbsp;<span class="op" id="5567046">(</span><span class="ident" id="5567047">e</span>&nbsp;<span class="op" id="5567049">*</span><span class="ident" id="5567050">encoder</span><span class="op" id="5567057">)</span>&nbsp;<span class="ident" id="5567059">writeHeader</span><span class="op" id="5567070">(</span><span class="op" id="5567071">)</span>&nbsp;<span class="op" id="5567073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5567076">if</span>&nbsp;<span class="ident" id="5567079">e</span><span class="op" id="5567080">.</span><span class="ident" id="5567081">err</span>&nbsp;<span class="op" id="5567085">!=</span>&nbsp;<span class="ident" id="5567088">nil</span>&nbsp;<span class="op" id="5567092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5567096">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5567104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567107">_</span><span class="op" id="5567108">,</span>&nbsp;<span class="ident" id="5567110">e</span><span class="op" id="5567111">.</span><span class="ident" id="5567112">err</span>&nbsp;<span class="op" id="5567116">=</span>&nbsp;<span class="ident" id="5567118">io</span><span class="op" id="5567120">.</span><span class="ident" id="5567121">WriteString</span><span class="op" id="5567132">(</span><span class="ident" id="5567133">e</span><span class="op" id="5567134">.</span><span class="ident" id="5567135">w</span><span class="op" id="5567136">,</span>&nbsp;<span class="string" id="5567138">&#34;GIF89a&#34;</span><span class="op" id="5567146">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5567149">if</span>&nbsp;<span class="ident" id="5567152">e</span><span class="op" id="5567153">.</span><span class="ident" id="5567154">err</span>&nbsp;<span class="op" id="5567158">!=</span>&nbsp;<span class="ident" id="5567161">nil</span>&nbsp;<span class="op" id="5567165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5567169">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5567177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567181">pm</span>&nbsp;<span class="op" id="5567184">:=</span>&nbsp;<span class="ident" id="5567187">e</span><span class="op" id="5567188">.</span><span class="ident" id="5567189">g</span><span class="op" id="5567190">.</span><span class="ident" id="5567191">Image</span><span class="op" id="5567196">[</span><span class="num" id="5567197">0</span><span class="op" id="5567198">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5567201">//&nbsp;Logical&nbsp;screen&nbsp;width&nbsp;and&nbsp;height.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567238">writeUint16</span><span class="op" id="5567249">(</span><span class="ident" id="5567250">e</span><span class="op" id="5567251">.</span><span class="ident" id="5567252">buf</span><span class="op" id="5567255">[</span><span class="num" id="5567256">0</span><span class="op" id="5567257">:</span><span class="num" id="5567258">2</span><span class="op" id="5567259">]</span><span class="op" id="5567260">,</span>&nbsp;<span class="builtintype" id="5567262">uint16</span><span class="op" id="5567268">(</span><span class="ident" id="5567269">pm</span><span class="op" id="5567271">.</span><span class="ident" id="5567272">Bounds</span><span class="op" id="5567278">(</span><span class="op" id="5567279">)</span><span class="op" id="5567280">.</span><span class="ident" id="5567281">Dx</span><span class="op" id="5567283">(</span><span class="op" id="5567284">)</span><span class="op" id="5567285">)</span><span class="op" id="5567286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567289">writeUint16</span><span class="op" id="5567300">(</span><span class="ident" id="5567301">e</span><span class="op" id="5567302">.</span><span class="ident" id="5567303">buf</span><span class="op" id="5567306">[</span><span class="num" id="5567307">2</span><span class="op" id="5567308">:</span><span class="num" id="5567309">4</span><span class="op" id="5567310">]</span><span class="op" id="5567311">,</span>&nbsp;<span class="builtintype" id="5567313">uint16</span><span class="op" id="5567319">(</span><span class="ident" id="5567320">pm</span><span class="op" id="5567322">.</span><span class="ident" id="5567323">Bounds</span><span class="op" id="5567329">(</span><span class="op" id="5567330">)</span><span class="op" id="5567331">.</span><span class="ident" id="5567332">Dy</span><span class="op" id="5567334">(</span><span class="op" id="5567335">)</span><span class="op" id="5567336">)</span><span class="op" id="5567337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567340">e</span><span class="op" id="5567341">.</span><span class="ident" id="5567342">write</span><span class="op" id="5567347">(</span><span class="ident" id="5567348">e</span><span class="op" id="5567349">.</span><span class="ident" id="5567350">buf</span><span class="op" id="5567353">[</span><span class="op" id="5567354">:</span><span class="num" id="5567355">4</span><span class="op" id="5567356">]</span><span class="op" id="5567357">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5567361">//&nbsp;All&nbsp;frames&nbsp;have&nbsp;a&nbsp;local&nbsp;color&nbsp;table,&nbsp;so&nbsp;a&nbsp;global&nbsp;color&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5567426">//&nbsp;is&nbsp;not&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567445">e</span><span class="op" id="5567446">.</span><span class="ident" id="5567447">buf</span><span class="op" id="5567450">[</span><span class="num" id="5567451">0</span><span class="op" id="5567452">]</span>&nbsp;<span class="op" id="5567454">=</span>&nbsp;<span class="num" id="5567456">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567462">e</span><span class="op" id="5567463">.</span><span class="ident" id="5567464">buf</span><span class="op" id="5567467">[</span><span class="num" id="5567468">1</span><span class="op" id="5567469">]</span>&nbsp;<span class="op" id="5567471">=</span>&nbsp;<span class="num" id="5567473">0x00</span>&nbsp;<span class="comment" id="5567478">//&nbsp;Background&nbsp;Color&nbsp;Index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567506">e</span><span class="op" id="5567507">.</span><span class="ident" id="5567508">buf</span><span class="op" id="5567511">[</span><span class="num" id="5567512">2</span><span class="op" id="5567513">]</span>&nbsp;<span class="op" id="5567515">=</span>&nbsp;<span class="num" id="5567517">0x00</span>&nbsp;<span class="comment" id="5567522">//&nbsp;Pixel&nbsp;Aspect&nbsp;Ratio.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567546">e</span><span class="op" id="5567547">.</span><span class="ident" id="5567548">write</span><span class="op" id="5567553">(</span><span class="ident" id="5567554">e</span><span class="op" id="5567555">.</span><span class="ident" id="5567556">buf</span><span class="op" id="5567559">[</span><span class="op" id="5567560">:</span><span class="num" id="5567561">3</span><span class="op" id="5567562">]</span><span class="op" id="5567563">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5567567">//&nbsp;Add&nbsp;animation&nbsp;info&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5567604">if</span>&nbsp;<span class="builtinfunc" id="5567607">len</span><span class="op" id="5567610">(</span><span class="ident" id="5567611">e</span><span class="op" id="5567612">.</span><span class="ident" id="5567613">g</span><span class="op" id="5567614">.</span><span class="ident" id="5567615">Image</span><span class="op" id="5567620">)</span>&nbsp;<span class="op" id="5567622">&gt;</span>&nbsp;<span class="num" id="5567624">1</span>&nbsp;<span class="op" id="5567626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567630">e</span><span class="op" id="5567631">.</span><span class="ident" id="5567632">buf</span><span class="op" id="5567635">[</span><span class="num" id="5567636">0</span><span class="op" id="5567637">]</span>&nbsp;<span class="op" id="5567639">=</span>&nbsp;<span class="num" id="5567641">0x21</span>&nbsp;<span class="comment" id="5567646">//&nbsp;Extension&nbsp;Introducer.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567673">e</span><span class="op" id="5567674">.</span><span class="ident" id="5567675">buf</span><span class="op" id="5567678">[</span><span class="num" id="5567679">1</span><span class="op" id="5567680">]</span>&nbsp;<span class="op" id="5567682">=</span>&nbsp;<span class="num" id="5567684">0xff</span>&nbsp;<span class="comment" id="5567689">//&nbsp;Application&nbsp;Label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567713">e</span><span class="op" id="5567714">.</span><span class="ident" id="5567715">buf</span><span class="op" id="5567718">[</span><span class="num" id="5567719">2</span><span class="op" id="5567720">]</span>&nbsp;<span class="op" id="5567722">=</span>&nbsp;<span class="num" id="5567724">0x0b</span>&nbsp;<span class="comment" id="5567729">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567746">e</span><span class="op" id="5567747">.</span><span class="ident" id="5567748">write</span><span class="op" id="5567753">(</span><span class="ident" id="5567754">e</span><span class="op" id="5567755">.</span><span class="ident" id="5567756">buf</span><span class="op" id="5567759">[</span><span class="op" id="5567760">:</span><span class="num" id="5567761">3</span><span class="op" id="5567762">]</span><span class="op" id="5567763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567767">_</span><span class="op" id="5567768">,</span>&nbsp;<span class="ident" id="5567770">e</span><span class="op" id="5567771">.</span><span class="ident" id="5567772">err</span>&nbsp;<span class="op" id="5567776">=</span>&nbsp;<span class="ident" id="5567778">io</span><span class="op" id="5567780">.</span><span class="ident" id="5567781">WriteString</span><span class="op" id="5567792">(</span><span class="ident" id="5567793">e</span><span class="op" id="5567794">.</span><span class="ident" id="5567795">w</span><span class="op" id="5567796">,</span>&nbsp;<span class="string" id="5567798">&#34;NETSCAPE2.0&#34;</span><span class="op" id="5567811">)</span>&nbsp;<span class="comment" id="5567813">//&nbsp;Application&nbsp;Identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5567842">if</span>&nbsp;<span class="ident" id="5567845">e</span><span class="op" id="5567846">.</span><span class="ident" id="5567847">err</span>&nbsp;<span class="op" id="5567851">!=</span>&nbsp;<span class="ident" id="5567854">nil</span>&nbsp;<span class="op" id="5567858">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5567863">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5567872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567876">e</span><span class="op" id="5567877">.</span><span class="ident" id="5567878">buf</span><span class="op" id="5567881">[</span><span class="num" id="5567882">0</span><span class="op" id="5567883">]</span>&nbsp;<span class="op" id="5567885">=</span>&nbsp;<span class="num" id="5567887">0x03</span>&nbsp;<span class="comment" id="5567892">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567909">e</span><span class="op" id="5567910">.</span><span class="ident" id="5567911">buf</span><span class="op" id="5567914">[</span><span class="num" id="5567915">1</span><span class="op" id="5567916">]</span>&nbsp;<span class="op" id="5567918">=</span>&nbsp;<span class="num" id="5567920">0x01</span>&nbsp;<span class="comment" id="5567925">//&nbsp;Sub-block&nbsp;Index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567947">writeUint16</span><span class="op" id="5567958">(</span><span class="ident" id="5567959">e</span><span class="op" id="5567960">.</span><span class="ident" id="5567961">buf</span><span class="op" id="5567964">[</span><span class="num" id="5567965">2</span><span class="op" id="5567966">:</span><span class="num" id="5567967">4</span><span class="op" id="5567968">]</span><span class="op" id="5567969">,</span>&nbsp;<span class="builtintype" id="5567971">uint16</span><span class="op" id="5567977">(</span><span class="ident" id="5567978">e</span><span class="op" id="5567979">.</span><span class="ident" id="5567980">g</span><span class="op" id="5567981">.</span><span class="ident" id="5567982">LoopCount</span><span class="op" id="5567991">)</span><span class="op" id="5567992">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5567996">e</span><span class="op" id="5567997">.</span><span class="ident" id="5567998">buf</span><span class="op" id="5568001">[</span><span class="num" id="5568002">4</span><span class="op" id="5568003">]</span>&nbsp;<span class="op" id="5568005">=</span>&nbsp;<span class="num" id="5568007">0x00</span>&nbsp;<span class="comment" id="5568012">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568035">e</span><span class="op" id="5568036">.</span><span class="ident" id="5568037">write</span><span class="op" id="5568042">(</span><span class="ident" id="5568043">e</span><span class="op" id="5568044">.</span><span class="ident" id="5568045">buf</span><span class="op" id="5568048">[</span><span class="op" id="5568049">:</span><span class="num" id="5568050">5</span><span class="op" id="5568051">]</span><span class="op" id="5568052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5568055">}</span><br>
<span class="lineno"></span><span class="op" id="5568057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="5568060">func</span>&nbsp;<span class="op" id="5568065">(</span><span class="ident" id="5568066">e</span>&nbsp;<span class="op" id="5568068">*</span><span class="ident" id="5568069">encoder</span><span class="op" id="5568076">)</span>&nbsp;<span class="ident" id="5568078">writeColorTable</span><span class="op" id="5568093">(</span><span class="ident" id="5568094">p</span>&nbsp;<span class="ident" id="5568096">color</span><span class="op" id="5568101">.</span><span class="ident" id="5568102">Palette</span><span class="op" id="5568109">,</span>&nbsp;<span class="ident" id="5568111">size</span>&nbsp;<span class="builtintype" id="5568116">int</span><span class="op" id="5568119">)</span>&nbsp;<span class="op" id="5568121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568124">if</span>&nbsp;<span class="ident" id="5568127">e</span><span class="op" id="5568128">.</span><span class="ident" id="5568129">err</span>&nbsp;<span class="op" id="5568133">!=</span>&nbsp;<span class="ident" id="5568136">nil</span>&nbsp;<span class="op" id="5568140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568144">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5568152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568156">for</span>&nbsp;<span class="ident" id="5568160">i</span>&nbsp;<span class="op" id="5568162">:=</span>&nbsp;<span class="num" id="5568165">0</span><span class="op" id="5568166">;</span>&nbsp;<span class="ident" id="5568168">i</span>&nbsp;<span class="op" id="5568170">&lt;</span>&nbsp;<span class="ident" id="5568172">log2Lookup</span><span class="op" id="5568182">[</span><span class="ident" id="5568183">size</span><span class="op" id="5568187">]</span><span class="op" id="5568188">;</span>&nbsp;<span class="ident" id="5568190">i</span><span class="op" id="5568191">++</span>&nbsp;<span class="op" id="5568194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568198">if</span>&nbsp;<span class="ident" id="5568201">i</span>&nbsp;<span class="op" id="5568203">&lt;</span>&nbsp;<span class="builtinfunc" id="5568205">len</span><span class="op" id="5568208">(</span><span class="ident" id="5568209">p</span><span class="op" id="5568210">)</span>&nbsp;<span class="op" id="5568212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568217">r</span><span class="op" id="5568218">,</span>&nbsp;<span class="ident" id="5568220">g</span><span class="op" id="5568221">,</span>&nbsp;<span class="ident" id="5568223">b</span><span class="op" id="5568224">,</span>&nbsp;<span class="ident" id="5568226">_</span>&nbsp;<span class="op" id="5568228">:=</span>&nbsp;<span class="ident" id="5568231">p</span><span class="op" id="5568232">[</span><span class="ident" id="5568233">i</span><span class="op" id="5568234">]</span><span class="op" id="5568235">.</span><span class="ident" id="5568236">RGBA</span><span class="op" id="5568240">(</span><span class="op" id="5568241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568246">e</span><span class="op" id="5568247">.</span><span class="ident" id="5568248">buf</span><span class="op" id="5568251">[</span><span class="num" id="5568252">3</span><span class="op" id="5568253">*</span><span class="ident" id="5568254">i</span><span class="op" id="5568255">+</span><span class="num" id="5568256">0</span><span class="op" id="5568257">]</span>&nbsp;<span class="op" id="5568259">=</span>&nbsp;<span class="builtintype" id="5568261">uint8</span><span class="op" id="5568266">(</span><span class="ident" id="5568267">r</span>&nbsp;<span class="op" id="5568269">&gt;&gt;</span>&nbsp;<span class="num" id="5568272">8</span><span class="op" id="5568273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568278">e</span><span class="op" id="5568279">.</span><span class="ident" id="5568280">buf</span><span class="op" id="5568283">[</span><span class="num" id="5568284">3</span><span class="op" id="5568285">*</span><span class="ident" id="5568286">i</span><span class="op" id="5568287">+</span><span class="num" id="5568288">1</span><span class="op" id="5568289">]</span>&nbsp;<span class="op" id="5568291">=</span>&nbsp;<span class="builtintype" id="5568293">uint8</span><span class="op" id="5568298">(</span><span class="ident" id="5568299">g</span>&nbsp;<span class="op" id="5568301">&gt;&gt;</span>&nbsp;<span class="num" id="5568304">8</span><span class="op" id="5568305">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568310">e</span><span class="op" id="5568311">.</span><span class="ident" id="5568312">buf</span><span class="op" id="5568315">[</span><span class="num" id="5568316">3</span><span class="op" id="5568317">*</span><span class="ident" id="5568318">i</span><span class="op" id="5568319">+</span><span class="num" id="5568320">2</span><span class="op" id="5568321">]</span>&nbsp;<span class="op" id="5568323">=</span>&nbsp;<span class="builtintype" id="5568325">uint8</span><span class="op" id="5568330">(</span><span class="ident" id="5568331">b</span>&nbsp;<span class="op" id="5568333">&gt;&gt;</span>&nbsp;<span class="num" id="5568336">8</span><span class="op" id="5568337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5568341">}</span>&nbsp;<span class="keyword" id="5568343">else</span>&nbsp;<span class="op" id="5568348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5568353">//&nbsp;Pad&nbsp;with&nbsp;black.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568375">e</span><span class="op" id="5568376">.</span><span class="ident" id="5568377">buf</span><span class="op" id="5568380">[</span><span class="num" id="5568381">3</span><span class="op" id="5568382">*</span><span class="ident" id="5568383">i</span><span class="op" id="5568384">+</span><span class="num" id="5568385">0</span><span class="op" id="5568386">]</span>&nbsp;<span class="op" id="5568388">=</span>&nbsp;<span class="num" id="5568390">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568398">e</span><span class="op" id="5568399">.</span><span class="ident" id="5568400">buf</span><span class="op" id="5568403">[</span><span class="num" id="5568404">3</span><span class="op" id="5568405">*</span><span class="ident" id="5568406">i</span><span class="op" id="5568407">+</span><span class="num" id="5568408">1</span><span class="op" id="5568409">]</span>&nbsp;<span class="op" id="5568411">=</span>&nbsp;<span class="num" id="5568413">0x00</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568421">e</span><span class="op" id="5568422">.</span><span class="ident" id="5568423">buf</span><span class="op" id="5568426">[</span><span class="num" id="5568427">3</span><span class="op" id="5568428">*</span><span class="ident" id="5568429">i</span><span class="op" id="5568430">+</span><span class="num" id="5568431">2</span><span class="op" id="5568432">]</span>&nbsp;<span class="op" id="5568434">=</span>&nbsp;<span class="num" id="5568436">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5568443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5568446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568449">e</span><span class="op" id="5568450">.</span><span class="ident" id="5568451">write</span><span class="op" id="5568456">(</span><span class="ident" id="5568457">e</span><span class="op" id="5568458">.</span><span class="ident" id="5568459">buf</span><span class="op" id="5568462">[</span><span class="op" id="5568463">:</span><span class="num" id="5568464">3</span><span class="op" id="5568465">*</span><span class="ident" id="5568466">log2Lookup</span><span class="op" id="5568476">[</span><span class="ident" id="5568477">size</span><span class="op" id="5568481">]</span><span class="op" id="5568482">]</span><span class="op" id="5568483">)</span><br>
<span class="lineno"></span><span class="op" id="5568485">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5568488">func</span>&nbsp;<span class="op" id="5568493">(</span><span class="ident" id="5568494">e</span>&nbsp;<span class="op" id="5568496">*</span><span class="ident" id="5568497">encoder</span><span class="op" id="5568504">)</span>&nbsp;<span class="ident" id="5568506">writeImageBlock</span><span class="op" id="5568521">(</span><span class="ident" id="5568522">pm</span>&nbsp;<span class="op" id="5568525">*</span><span class="ident" id="5568526">image</span><span class="op" id="5568531">.</span><span class="ident" id="5568532">Paletted</span><span class="op" id="5568540">,</span>&nbsp;<span class="ident" id="5568542">delay</span>&nbsp;<span class="builtintype" id="5568548">int</span><span class="op" id="5568551">)</span>&nbsp;<span class="op" id="5568553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568556">if</span>&nbsp;<span class="ident" id="5568559">e</span><span class="op" id="5568560">.</span><span class="ident" id="5568561">err</span>&nbsp;<span class="op" id="5568565">!=</span>&nbsp;<span class="ident" id="5568568">nil</span>&nbsp;<span class="op" id="5568572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568576">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5568584">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568588">if</span>&nbsp;<span class="builtinfunc" id="5568591">len</span><span class="op" id="5568594">(</span><span class="ident" id="5568595">pm</span><span class="op" id="5568597">.</span><span class="ident" id="5568598">Palette</span><span class="op" id="5568605">)</span>&nbsp;<span class="op" id="5568607">==</span>&nbsp;<span class="num" id="5568610">0</span>&nbsp;<span class="op" id="5568612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568616">e</span><span class="op" id="5568617">.</span><span class="ident" id="5568618">err</span>&nbsp;<span class="op" id="5568622">=</span>&nbsp;<span class="ident" id="5568624">errors</span><span class="op" id="5568630">.</span><span class="ident" id="5568631">New</span><span class="op" id="5568634">(</span><span class="string" id="5568635">&#34;gif:&nbsp;cannot&nbsp;encode&nbsp;image&nbsp;block&nbsp;with&nbsp;empty&nbsp;palette&#34;</span><span class="op" id="5568686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568690">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5568698">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568702">b</span>&nbsp;<span class="op" id="5568704">:=</span>&nbsp;<span class="ident" id="5568707">pm</span><span class="op" id="5568709">.</span><span class="ident" id="5568710">Bounds</span><span class="op" id="5568716">(</span><span class="op" id="5568717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568720">if</span>&nbsp;<span class="ident" id="5568723">b</span><span class="op" id="5568724">.</span><span class="ident" id="5568725">Dx</span><span class="op" id="5568727">(</span><span class="op" id="5568728">)</span>&nbsp;<span class="op" id="5568730">&gt;=</span>&nbsp;<span class="num" id="5568733">1</span><span class="op" id="5568734">&lt;&lt;</span><span class="num" id="5568736">16</span>&nbsp;<span class="op" id="5568739">||</span>&nbsp;<span class="ident" id="5568742">b</span><span class="op" id="5568743">.</span><span class="ident" id="5568744">Dy</span><span class="op" id="5568746">(</span><span class="op" id="5568747">)</span>&nbsp;<span class="op" id="5568749">&gt;=</span>&nbsp;<span class="num" id="5568752">1</span><span class="op" id="5568753">&lt;&lt;</span><span class="num" id="5568755">16</span>&nbsp;<span class="op" id="5568758">||</span>&nbsp;<span class="ident" id="5568761">b</span><span class="op" id="5568762">.</span><span class="ident" id="5568763">Min</span><span class="op" id="5568766">.</span><span class="ident" id="5568767">X</span>&nbsp;<span class="op" id="5568769">&lt;</span>&nbsp;<span class="num" id="5568771">0</span>&nbsp;<span class="op" id="5568773">||</span>&nbsp;<span class="ident" id="5568776">b</span><span class="op" id="5568777">.</span><span class="ident" id="5568778">Min</span><span class="op" id="5568781">.</span><span class="ident" id="5568782">X</span>&nbsp;<span class="op" id="5568784">&gt;=</span>&nbsp;<span class="num" id="5568787">1</span><span class="op" id="5568788">&lt;&lt;</span><span class="num" id="5568790">16</span>&nbsp;<span class="op" id="5568793">||</span>&nbsp;<span class="ident" id="5568796">b</span><span class="op" id="5568797">.</span><span class="ident" id="5568798">Min</span><span class="op" id="5568801">.</span><span class="ident" id="5568802">Y</span>&nbsp;<span class="op" id="5568804">&lt;</span>&nbsp;<span class="num" id="5568806">0</span>&nbsp;<span class="op" id="5568808">||</span>&nbsp;<span class="ident" id="5568811">b</span><span class="op" id="5568812">.</span><span class="ident" id="5568813">Min</span><span class="op" id="5568816">.</span><span class="ident" id="5568817">Y</span>&nbsp;<span class="op" id="5568819">&gt;=</span>&nbsp;<span class="num" id="5568822">1</span><span class="op" id="5568823">&lt;&lt;</span><span class="num" id="5568825">16</span>&nbsp;<span class="op" id="5568828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568832">e</span><span class="op" id="5568833">.</span><span class="ident" id="5568834">err</span>&nbsp;<span class="op" id="5568838">=</span>&nbsp;<span class="ident" id="5568840">errors</span><span class="op" id="5568846">.</span><span class="ident" id="5568847">New</span><span class="op" id="5568850">(</span><span class="string" id="5568851">&#34;gif:&nbsp;image&nbsp;block&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="5568892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568896">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5568904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5568908">transparentIndex</span>&nbsp;<span class="op" id="5568925">:=</span>&nbsp;<span class="op" id="5568928">-</span><span class="num" id="5568929">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568932">for</span>&nbsp;<span class="ident" id="5568936">i</span><span class="op" id="5568937">,</span>&nbsp;<span class="ident" id="5568939">c</span>&nbsp;<span class="op" id="5568941">:=</span>&nbsp;<span class="keyword" id="5568944">range</span>&nbsp;<span class="ident" id="5568950">pm</span><span class="op" id="5568952">.</span><span class="ident" id="5568953">Palette</span>&nbsp;<span class="op" id="5568961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5568965">if</span>&nbsp;<span class="ident" id="5568968">_</span><span class="op" id="5568969">,</span>&nbsp;<span class="ident" id="5568971">_</span><span class="op" id="5568972">,</span>&nbsp;<span class="ident" id="5568974">_</span><span class="op" id="5568975">,</span>&nbsp;<span class="ident" id="5568977">a</span>&nbsp;<span class="op" id="5568979">:=</span>&nbsp;<span class="ident" id="5568982">c</span><span class="op" id="5568983">.</span><span class="ident" id="5568984">RGBA</span><span class="op" id="5568988">(</span><span class="op" id="5568989">)</span><span class="op" id="5568990">;</span>&nbsp;<span class="ident" id="5568992">a</span>&nbsp;<span class="op" id="5568994">==</span>&nbsp;<span class="num" id="5568997">0</span>&nbsp;<span class="op" id="5568999">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569004">transparentIndex</span>&nbsp;<span class="op" id="5569021">=</span>&nbsp;<span class="ident" id="5569023">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5569028">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5569036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5569039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5569043">if</span>&nbsp;<span class="ident" id="5569046">delay</span>&nbsp;<span class="op" id="5569052">&gt;</span>&nbsp;<span class="num" id="5569054">0</span>&nbsp;<span class="op" id="5569056">||</span>&nbsp;<span class="ident" id="5569059">transparentIndex</span>&nbsp;<span class="op" id="5569076">!=</span>&nbsp;<span class="op" id="5569079">-</span><span class="num" id="5569080">1</span>&nbsp;<span class="op" id="5569082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569086">e</span><span class="op" id="5569087">.</span><span class="ident" id="5569088">buf</span><span class="op" id="5569091">[</span><span class="num" id="5569092">0</span><span class="op" id="5569093">]</span>&nbsp;<span class="op" id="5569095">=</span>&nbsp;<span class="ident" id="5569097">sExtension</span>&nbsp;&nbsp;<span class="comment" id="5569109">//&nbsp;Extension&nbsp;Introducer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569136">e</span><span class="op" id="5569137">.</span><span class="ident" id="5569138">buf</span><span class="op" id="5569141">[</span><span class="num" id="5569142">1</span><span class="op" id="5569143">]</span>&nbsp;<span class="op" id="5569145">=</span>&nbsp;<span class="ident" id="5569147">gcLabel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5569159">//&nbsp;Graphic&nbsp;Control&nbsp;Label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569187">e</span><span class="op" id="5569188">.</span><span class="ident" id="5569189">buf</span><span class="op" id="5569192">[</span><span class="num" id="5569193">2</span><span class="op" id="5569194">]</span>&nbsp;<span class="op" id="5569196">=</span>&nbsp;<span class="ident" id="5569198">gcBlockSize</span>&nbsp;<span class="comment" id="5569210">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5569227">if</span>&nbsp;<span class="ident" id="5569230">transparentIndex</span>&nbsp;<span class="op" id="5569247">!=</span>&nbsp;<span class="op" id="5569250">-</span><span class="num" id="5569251">1</span>&nbsp;<span class="op" id="5569253">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569258">e</span><span class="op" id="5569259">.</span><span class="ident" id="5569260">buf</span><span class="op" id="5569263">[</span><span class="num" id="5569264">3</span><span class="op" id="5569265">]</span>&nbsp;<span class="op" id="5569267">=</span>&nbsp;<span class="num" id="5569269">0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5569276">}</span>&nbsp;<span class="keyword" id="5569278">else</span>&nbsp;<span class="op" id="5569283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569288">e</span><span class="op" id="5569289">.</span><span class="ident" id="5569290">buf</span><span class="op" id="5569293">[</span><span class="num" id="5569294">3</span><span class="op" id="5569295">]</span>&nbsp;<span class="op" id="5569297">=</span>&nbsp;<span class="num" id="5569299">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5569306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569310">writeUint16</span><span class="op" id="5569321">(</span><span class="ident" id="5569322">e</span><span class="op" id="5569323">.</span><span class="ident" id="5569324">buf</span><span class="op" id="5569327">[</span><span class="num" id="5569328">4</span><span class="op" id="5569329">:</span><span class="num" id="5569330">6</span><span class="op" id="5569331">]</span><span class="op" id="5569332">,</span>&nbsp;<span class="builtintype" id="5569334">uint16</span><span class="op" id="5569340">(</span><span class="ident" id="5569341">delay</span><span class="op" id="5569346">)</span><span class="op" id="5569347">)</span>&nbsp;<span class="comment" id="5569349">//&nbsp;Delay&nbsp;Time&nbsp;(1/100ths&nbsp;of&nbsp;a&nbsp;second)</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5569389">//&nbsp;Transparent&nbsp;color&nbsp;index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5569419">if</span>&nbsp;<span class="ident" id="5569422">transparentIndex</span>&nbsp;<span class="op" id="5569439">!=</span>&nbsp;<span class="op" id="5569442">-</span><span class="num" id="5569443">1</span>&nbsp;<span class="op" id="5569445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569450">e</span><span class="op" id="5569451">.</span><span class="ident" id="5569452">buf</span><span class="op" id="5569455">[</span><span class="num" id="5569456">6</span><span class="op" id="5569457">]</span>&nbsp;<span class="op" id="5569459">=</span>&nbsp;<span class="builtintype" id="5569461">uint8</span><span class="op" id="5569466">(</span><span class="ident" id="5569467">transparentIndex</span><span class="op" id="5569483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5569487">}</span>&nbsp;<span class="keyword" id="5569489">else</span>&nbsp;<span class="op" id="5569494">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569499">e</span><span class="op" id="5569500">.</span><span class="ident" id="5569501">buf</span><span class="op" id="5569504">[</span><span class="num" id="5569505">6</span><span class="op" id="5569506">]</span>&nbsp;<span class="op" id="5569508">=</span>&nbsp;<span class="num" id="5569510">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5569517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569521">e</span><span class="op" id="5569522">.</span><span class="ident" id="5569523">buf</span><span class="op" id="5569526">[</span><span class="num" id="5569527">7</span><span class="op" id="5569528">]</span>&nbsp;<span class="op" id="5569530">=</span>&nbsp;<span class="num" id="5569532">0x00</span>&nbsp;<span class="comment" id="5569537">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569560">e</span><span class="op" id="5569561">.</span><span class="ident" id="5569562">write</span><span class="op" id="5569567">(</span><span class="ident" id="5569568">e</span><span class="op" id="5569569">.</span><span class="ident" id="5569570">buf</span><span class="op" id="5569573">[</span><span class="op" id="5569574">:</span><span class="num" id="5569575">8</span><span class="op" id="5569576">]</span><span class="op" id="5569577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5569580">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569583">e</span><span class="op" id="5569584">.</span><span class="ident" id="5569585">buf</span><span class="op" id="5569588">[</span><span class="num" id="5569589">0</span><span class="op" id="5569590">]</span>&nbsp;<span class="op" id="5569592">=</span>&nbsp;<span class="ident" id="5569594">sImageDescriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569612">writeUint16</span><span class="op" id="5569623">(</span><span class="ident" id="5569624">e</span><span class="op" id="5569625">.</span><span class="ident" id="5569626">buf</span><span class="op" id="5569629">[</span><span class="num" id="5569630">1</span><span class="op" id="5569631">:</span><span class="num" id="5569632">3</span><span class="op" id="5569633">]</span><span class="op" id="5569634">,</span>&nbsp;<span class="builtintype" id="5569636">uint16</span><span class="op" id="5569642">(</span><span class="ident" id="5569643">b</span><span class="op" id="5569644">.</span><span class="ident" id="5569645">Min</span><span class="op" id="5569648">.</span><span class="ident" id="5569649">X</span><span class="op" id="5569650">)</span><span class="op" id="5569651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569654">writeUint16</span><span class="op" id="5569665">(</span><span class="ident" id="5569666">e</span><span class="op" id="5569667">.</span><span class="ident" id="5569668">buf</span><span class="op" id="5569671">[</span><span class="num" id="5569672">3</span><span class="op" id="5569673">:</span><span class="num" id="5569674">5</span><span class="op" id="5569675">]</span><span class="op" id="5569676">,</span>&nbsp;<span class="builtintype" id="5569678">uint16</span><span class="op" id="5569684">(</span><span class="ident" id="5569685">b</span><span class="op" id="5569686">.</span><span class="ident" id="5569687">Min</span><span class="op" id="5569690">.</span><span class="ident" id="5569691">Y</span><span class="op" id="5569692">)</span><span class="op" id="5569693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569696">writeUint16</span><span class="op" id="5569707">(</span><span class="ident" id="5569708">e</span><span class="op" id="5569709">.</span><span class="ident" id="5569710">buf</span><span class="op" id="5569713">[</span><span class="num" id="5569714">5</span><span class="op" id="5569715">:</span><span class="num" id="5569716">7</span><span class="op" id="5569717">]</span><span class="op" id="5569718">,</span>&nbsp;<span class="builtintype" id="5569720">uint16</span><span class="op" id="5569726">(</span><span class="ident" id="5569727">b</span><span class="op" id="5569728">.</span><span class="ident" id="5569729">Dx</span><span class="op" id="5569731">(</span><span class="op" id="5569732">)</span><span class="op" id="5569733">)</span><span class="op" id="5569734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569737">writeUint16</span><span class="op" id="5569748">(</span><span class="ident" id="5569749">e</span><span class="op" id="5569750">.</span><span class="ident" id="5569751">buf</span><span class="op" id="5569754">[</span><span class="num" id="5569755">7</span><span class="op" id="5569756">:</span><span class="num" id="5569757">9</span><span class="op" id="5569758">]</span><span class="op" id="5569759">,</span>&nbsp;<span class="builtintype" id="5569761">uint16</span><span class="op" id="5569767">(</span><span class="ident" id="5569768">b</span><span class="op" id="5569769">.</span><span class="ident" id="5569770">Dy</span><span class="op" id="5569772">(</span><span class="op" id="5569773">)</span><span class="op" id="5569774">)</span><span class="op" id="5569775">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569778">e</span><span class="op" id="5569779">.</span><span class="ident" id="5569780">write</span><span class="op" id="5569785">(</span><span class="ident" id="5569786">e</span><span class="op" id="5569787">.</span><span class="ident" id="5569788">buf</span><span class="op" id="5569791">[</span><span class="op" id="5569792">:</span><span class="num" id="5569793">9</span><span class="op" id="5569794">]</span><span class="op" id="5569795">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569799">paddedSize</span>&nbsp;<span class="op" id="5569810">:=</span>&nbsp;<span class="ident" id="5569813">log2</span><span class="op" id="5569817">(</span><span class="builtinfunc" id="5569818">len</span><span class="op" id="5569821">(</span><span class="ident" id="5569822">pm</span><span class="op" id="5569824">.</span><span class="ident" id="5569825">Palette</span><span class="op" id="5569832">)</span><span class="op" id="5569833">)</span>&nbsp;<span class="comment" id="5569835">//&nbsp;Size&nbsp;of&nbsp;Local&nbsp;Color&nbsp;Table:&nbsp;2^(1+n).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5569875">//&nbsp;Interlacing&nbsp;is&nbsp;not&nbsp;supported.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569909">e</span><span class="op" id="5569910">.</span><span class="ident" id="5569911">writeByte</span><span class="op" id="5569920">(</span><span class="num" id="5569921">0x80</span>&nbsp;<span class="op" id="5569926">|</span>&nbsp;<span class="builtintype" id="5569928">uint8</span><span class="op" id="5569933">(</span><span class="ident" id="5569934">paddedSize</span><span class="op" id="5569944">)</span><span class="op" id="5569945">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5569949">//&nbsp;Local&nbsp;Color&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5569972">e</span><span class="op" id="5569973">.</span><span class="ident" id="5569974">writeColorTable</span><span class="op" id="5569989">(</span><span class="ident" id="5569990">pm</span><span class="op" id="5569992">.</span><span class="ident" id="5569993">Palette</span><span class="op" id="5570000">,</span>&nbsp;<span class="ident" id="5570002">paddedSize</span><span class="op" id="5570012">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5570016">litWidth</span>&nbsp;<span class="op" id="5570025">:=</span>&nbsp;<span class="ident" id="5570028">paddedSize</span>&nbsp;<span class="op" id="5570039">+</span>&nbsp;<span class="num" id="5570041">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5570044">if</span>&nbsp;<span class="ident" id="5570047">litWidth</span>&nbsp;<span class="op" id="5570056">&lt;</span>&nbsp;<span class="num" id="5570058">2</span>&nbsp;<span class="op" id="5570060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5570064">litWidth</span>&nbsp;<span class="op" id="5570073">=</span>&nbsp;<span class="num" id="5570075">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5570078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5570081">e</span><span class="op" id="5570082">.</span><span class="ident" id="5570083">writeByte</span><span class="op" id="5570092">(</span><span class="builtintype" id="5570093">uint8</span><span class="op" id="5570098">(</span><span class="ident" id="5570099">litWidth</span><span class="op" id="5570107">)</span><span class="op" id="5570108">)</span>&nbsp;<span class="comment" id="5570110">//&nbsp;LZW&nbsp;Minimum&nbsp;Code&nbsp;Size.</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5570138">lzww</span>&nbsp;<span class="op" id="5570143">:=</span>&nbsp;<span class="ident" id="5570146">lzw</span><span class="op" id="5570149">.</span><span class="ident" id="5570150">NewWriter</span><span class="op" id="5570159">(</span><span class="ident" id="5570160">blockWriter</span><span class="op" id="5570171">{</span><span class="ident" id="5570172">e</span><span class="op" id="5570173">:</span>&nbsp;<span class="ident" id="5570175">e</span><span class="op" id="5570176">}</span><span class="op" id="5570177">,</span>&nbsp;<span class="ident" id="5570179">lzw</span><span class="op" id="5570182">.</span><span class="ident" id="5570183">LSB</span><span class="op" id="5570186">,</span>&nbsp;<span class="ident" id="5570188">litWidth</span><span class="op" id="5570196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5570199">if</span>&nbsp;<span class="ident" id="5570202">dx</span>&nbsp;<span class="op" id="5570205">:=</span>&nbsp;<span class="ident" id="5570208">b</span><span class="op" id="5570209">.</span><span class="ident" id="5570210">Dx</span><span class="op" id="5570212">(</span><span class="op" id="5570213">)</span><span class="op" id="5570214">;</span>&nbsp;<span class="ident" id="5570216">dx</span>&nbsp;<span class="op" id="5570219">==</span>&nbsp;<span class="ident" id="5570222">pm</span><span class="op" id="5570224">.</span><span class="ident" id="5570225">Stride</span>&nbsp;<span class="op" id="5570232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5570236">_</span><span class="op" id="5570237">,</span>&nbsp;<span class="ident" id="5570239">e</span><span class="op" id="5570240">.</span><span class="ident" id="5570241">err</span>&nbsp;<span class="op" id="5570245">=</span>&nbsp;<span class="ident" id="5570247">lzww</span><span class="op" id="5570251">.</span><span class="ident" id="5570252">Write</span><span class="op" id="5570257">(</span><span class="ident" id="5570258">pm</span><span class="op" id="5570260">.</span><span class="ident" id="5570261">Pix</span><span class="op" id="5570264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5570268">if</span>&nbsp;<span class="ident" id="5570271">e</span><span class="op" id="5570272">.</span><span class="ident" id="5570273">err</span>&nbsp;<span class="op" id="5570277">!=</span>&nbsp;<span class="ident" id="5570280">nil</span>&nbsp;<span class="op" id="5570284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5570289">lzww</span><span class="op" id="5570293">.</span><span class="ident" id="5570294">Close</span><span class="op" id="5570299">(</span><span class="op" id="5570300">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5570305">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5570314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5570317">}</span>&nbsp;<span class="keyword" id="5570319">else</span>&nbsp;<span class="op" id="5570324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5570328">for</span>&nbsp;<span class="ident" id="5570332">i</span><span class="op" id="5570333">,</span>&nbsp;<span class="ident" id="5570335">y</span>&nbsp;<span class="op" id="5570337">:=</span>&nbsp;<span class="num" id="5570340">0</span><span class="op" id="5570341">,</span>&nbsp;<span class="ident" id="5570343">b</span><span class="op" id="5570344">.</span><span class="ident" id="5570345">Min</span><span class="op" id="5570348">.</span><span class="ident" id="5570349">Y</span><span class="op" id="5570350">;</span>&nbsp;<span class="ident" id="5570352">y</span>&nbsp;<span class="op" id="5570354">&lt;</span>&nbsp;<span class="ident" id="5570356">b</span><span class="op" id="5570357">.</span><span class="ident" id="5570358">Max</span><span class="op" id="5570361">.</span><span class="ident" id="5570362">Y</span><span class="op" id="5570363">;</span>&nbsp;<span class="ident" id="5570365">i</span><span class="op" id="5570366">,</span>&nbsp;<span class="ident" id="5570368">y</span>&nbsp;<span class="op" id="5570370">=</span>&nbsp;<span class="ident" id="5570372">i</span><span class="op" id="5570373">+</span><span class="ident" id="5570374">pm</span><span class="op" id="5570376">.</span><span class="ident" id="5570377">Stride</span><span class="op" id="5570383">,</span>&nbsp;<span class="ident" id="5570385">y</span><span class="op" id="5570386">+</span><span class="num" id="5570387">1</span>&nbsp;<span class="op" id="5570389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5570394">_</span><span class="op" id="5570395">,</span>&nbsp;<span class="ident" id="5570397">e</span><span class="op" id="5570398">.</span><span class="ident" id="5570399">err</span>&nbsp;<span class="op" id="5570403">=</span>&nbsp;<span class="ident" id="5570405">lzww</span><span class="op" id="5570409">.</span><span class="ident" id="5570410">Write</span><span class="op" id="5570415">(</span><span class="ident" id="5570416">pm</span><span class="op" id="5570418">.</span><span class="ident" id="5570419">Pix</span><span class="op" id="5570422">[</span><span class="ident" id="5570423">i</span>&nbsp;<span class="op" id="5570425">:</span>&nbsp;<span class="ident" id="5570427">i</span><span class="op" id="5570428">+</span><span class="ident" id="5570429">dx</span><span class="op" id="5570431">]</span><span class="op" id="5570432">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5570437">if</span>&nbsp;<span class="ident" id="5570440">e</span><span class="op" id="5570441">.</span><span class="ident" id="5570442">err</span>&nbsp;<span class="op" id="5570446">!=</span>&nbsp;<span class="ident" id="5570449">nil</span>&nbsp;<span class="op" id="5570453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5570459">lzww</span><span class="op" id="5570463">.</span><span class="ident" id="5570464">Close</span><span class="op" id="5570469">(</span><span class="op" id="5570470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5570476">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5570486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5570490">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5570493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5570496">lzww</span><span class="op" id="5570500">.</span><span class="ident" id="5570501">Close</span><span class="op" id="5570506">(</span><span class="op" id="5570507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5570510">e</span><span class="op" id="5570511">.</span><span class="ident" id="5570512">writeByte</span><span class="op" id="5570521">(</span><span class="num" id="5570522">0x00</span><span class="op" id="5570526">)</span>&nbsp;<span class="comment" id="5570528">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span><span class="op" id="5570549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="5570552">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="5570592">type</span>&nbsp;<span class="ident" id="5570597">Options</span>&nbsp;<span class="keyword" id="5570605">struct</span>&nbsp;<span class="op" id="5570612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5570615">//&nbsp;NumColors&nbsp;is&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;colors&nbsp;used&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5570680">//&nbsp;It&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;256.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5570709">NumColors</span>&nbsp;<span class="builtintype" id="5570719">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5570725">//&nbsp;Quantizer&nbsp;is&nbsp;used&nbsp;to&nbsp;produce&nbsp;a&nbsp;palette&nbsp;with&nbsp;size&nbsp;NumColors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5570789">//&nbsp;palette.Plan9&nbsp;is&nbsp;used&nbsp;in&nbsp;place&nbsp;of&nbsp;a&nbsp;nil&nbsp;Quantizer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5570844">Quantizer</span>&nbsp;<span class="ident" id="5570854">draw</span><span class="op" id="5570858">.</span><span class="ident" id="5570859">Quantizer</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5570871">//&nbsp;Drawer&nbsp;is&nbsp;used&nbsp;to&nbsp;convert&nbsp;the&nbsp;source&nbsp;image&nbsp;to&nbsp;the&nbsp;desired&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5570942">//&nbsp;draw.FloydSteinberg&nbsp;is&nbsp;used&nbsp;in&nbsp;place&nbsp;of&nbsp;a&nbsp;nil&nbsp;Drawer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571000">Drawer</span>&nbsp;<span class="ident" id="5571007">draw</span><span class="op" id="5571011">.</span><span class="ident" id="5571012">Drawer</span><br>
<span class="lineno"></span><span class="op" id="5571019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5571022">//&nbsp;EncodeAll&nbsp;writes&nbsp;the&nbsp;images&nbsp;in&nbsp;g&nbsp;to&nbsp;w&nbsp;in&nbsp;GIF&nbsp;format&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5571086">//&nbsp;given&nbsp;loop&nbsp;count&nbsp;and&nbsp;delay&nbsp;between&nbsp;frames.</span><br>
<span class="lineno"></span><span class="keyword" id="5571132">func</span>&nbsp;<span class="ident" id="5571137">EncodeAll</span><span class="op" id="5571146">(</span><span class="ident" id="5571147">w</span>&nbsp;<span class="ident" id="5571149">io</span><span class="op" id="5571151">.</span><span class="ident" id="5571152">Writer</span><span class="op" id="5571158">,</span>&nbsp;<span class="ident" id="5571160">g</span>&nbsp;<span class="op" id="5571162">*</span><span class="ident" id="5571163">GIF</span><span class="op" id="5571166">)</span>&nbsp;<span class="builtintype" id="5571168">error</span>&nbsp;<span class="op" id="5571174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5571177">if</span>&nbsp;<span class="builtinfunc" id="5571180">len</span><span class="op" id="5571183">(</span><span class="ident" id="5571184">g</span><span class="op" id="5571185">.</span><span class="ident" id="5571186">Image</span><span class="op" id="5571191">)</span>&nbsp;<span class="op" id="5571193">==</span>&nbsp;<span class="num" id="5571196">0</span>&nbsp;<span class="op" id="5571198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5571202">return</span>&nbsp;<span class="ident" id="5571209">errors</span><span class="op" id="5571215">.</span><span class="ident" id="5571216">New</span><span class="op" id="5571219">(</span><span class="string" id="5571220">&#34;gif:&nbsp;must&nbsp;provide&nbsp;at&nbsp;least&nbsp;one&nbsp;image&#34;</span><span class="op" id="5571258">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5571261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5571265">if</span>&nbsp;<span class="builtinfunc" id="5571268">len</span><span class="op" id="5571271">(</span><span class="ident" id="5571272">g</span><span class="op" id="5571273">.</span><span class="ident" id="5571274">Image</span><span class="op" id="5571279">)</span>&nbsp;<span class="op" id="5571281">!=</span>&nbsp;<span class="builtinfunc" id="5571284">len</span><span class="op" id="5571287">(</span><span class="ident" id="5571288">g</span><span class="op" id="5571289">.</span><span class="ident" id="5571290">Delay</span><span class="op" id="5571295">)</span>&nbsp;<span class="op" id="5571297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5571301">return</span>&nbsp;<span class="ident" id="5571308">errors</span><span class="op" id="5571314">.</span><span class="ident" id="5571315">New</span><span class="op" id="5571318">(</span><span class="string" id="5571319">&#34;gif:&nbsp;mismatched&nbsp;image&nbsp;and&nbsp;delay&nbsp;lengths&#34;</span><span class="op" id="5571360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5571363">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5571366">if</span>&nbsp;<span class="ident" id="5571369">g</span><span class="op" id="5571370">.</span><span class="ident" id="5571371">LoopCount</span>&nbsp;<span class="op" id="5571381">&lt;</span>&nbsp;<span class="num" id="5571383">0</span>&nbsp;<span class="op" id="5571385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571389">g</span><span class="op" id="5571390">.</span><span class="ident" id="5571391">LoopCount</span>&nbsp;<span class="op" id="5571401">=</span>&nbsp;<span class="num" id="5571403">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5571406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571410">e</span>&nbsp;<span class="op" id="5571412">:=</span>&nbsp;<span class="ident" id="5571415">encoder</span><span class="op" id="5571422">{</span><span class="ident" id="5571423">g</span><span class="op" id="5571424">:</span>&nbsp;<span class="ident" id="5571426">g</span><span class="op" id="5571427">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5571430">if</span>&nbsp;<span class="ident" id="5571433">ww</span><span class="op" id="5571435">,</span>&nbsp;<span class="ident" id="5571437">ok</span>&nbsp;<span class="op" id="5571440">:=</span>&nbsp;<span class="ident" id="5571443">w</span><span class="op" id="5571444">.</span><span class="op" id="5571445">(</span><span class="ident" id="5571446">writer</span><span class="op" id="5571452">)</span><span class="op" id="5571453">;</span>&nbsp;<span class="ident" id="5571455">ok</span>&nbsp;<span class="op" id="5571458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571462">e</span><span class="op" id="5571463">.</span><span class="ident" id="5571464">w</span>&nbsp;<span class="op" id="5571466">=</span>&nbsp;<span class="ident" id="5571468">ww</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5571472">}</span>&nbsp;<span class="keyword" id="5571474">else</span>&nbsp;<span class="op" id="5571479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571483">e</span><span class="op" id="5571484">.</span><span class="ident" id="5571485">w</span>&nbsp;<span class="op" id="5571487">=</span>&nbsp;<span class="ident" id="5571489">bufio</span><span class="op" id="5571494">.</span><span class="ident" id="5571495">NewWriter</span><span class="op" id="5571504">(</span><span class="ident" id="5571505">w</span><span class="op" id="5571506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5571509">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571513">e</span><span class="op" id="5571514">.</span><span class="ident" id="5571515">writeHeader</span><span class="op" id="5571526">(</span><span class="op" id="5571527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5571530">for</span>&nbsp;<span class="ident" id="5571534">i</span><span class="op" id="5571535">,</span>&nbsp;<span class="ident" id="5571537">pm</span>&nbsp;<span class="op" id="5571540">:=</span>&nbsp;<span class="keyword" id="5571543">range</span>&nbsp;<span class="ident" id="5571549">g</span><span class="op" id="5571550">.</span><span class="ident" id="5571551">Image</span>&nbsp;<span class="op" id="5571557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571561">e</span><span class="op" id="5571562">.</span><span class="ident" id="5571563">writeImageBlock</span><span class="op" id="5571578">(</span><span class="ident" id="5571579">pm</span><span class="op" id="5571581">,</span>&nbsp;<span class="ident" id="5571583">g</span><span class="op" id="5571584">.</span><span class="ident" id="5571585">Delay</span><span class="op" id="5571590">[</span><span class="ident" id="5571591">i</span><span class="op" id="5571592">]</span><span class="op" id="5571593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5571596">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571599">e</span><span class="op" id="5571600">.</span><span class="ident" id="5571601">writeByte</span><span class="op" id="5571610">(</span><span class="ident" id="5571611">sTrailer</span><span class="op" id="5571619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571622">e</span><span class="op" id="5571623">.</span><span class="ident" id="5571624">flush</span><span class="op" id="5571629">(</span><span class="op" id="5571630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5571633">return</span>&nbsp;<span class="ident" id="5571640">e</span><span class="op" id="5571641">.</span><span class="ident" id="5571642">err</span><br>
<span class="lineno"></span><span class="op" id="5571646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="5571649">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;GIF&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="5571698">func</span>&nbsp;<span class="ident" id="5571703">Encode</span><span class="op" id="5571709">(</span><span class="ident" id="5571710">w</span>&nbsp;<span class="ident" id="5571712">io</span><span class="op" id="5571714">.</span><span class="ident" id="5571715">Writer</span><span class="op" id="5571721">,</span>&nbsp;<span class="ident" id="5571723">m</span>&nbsp;<span class="ident" id="5571725">image</span><span class="op" id="5571730">.</span><span class="ident" id="5571731">Image</span><span class="op" id="5571736">,</span>&nbsp;<span class="ident" id="5571738">o</span>&nbsp;<span class="op" id="5571740">*</span><span class="ident" id="5571741">Options</span><span class="op" id="5571748">)</span>&nbsp;<span class="builtintype" id="5571750">error</span>&nbsp;<span class="op" id="5571756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5571759">//&nbsp;Check&nbsp;for&nbsp;bounds&nbsp;and&nbsp;size&nbsp;restrictions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571803">b</span>&nbsp;<span class="op" id="5571805">:=</span>&nbsp;<span class="ident" id="5571808">m</span><span class="op" id="5571809">.</span><span class="ident" id="5571810">Bounds</span><span class="op" id="5571816">(</span><span class="op" id="5571817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5571820">if</span>&nbsp;<span class="ident" id="5571823">b</span><span class="op" id="5571824">.</span><span class="ident" id="5571825">Dx</span><span class="op" id="5571827">(</span><span class="op" id="5571828">)</span>&nbsp;<span class="op" id="5571830">&gt;=</span>&nbsp;<span class="num" id="5571833">1</span><span class="op" id="5571834">&lt;&lt;</span><span class="num" id="5571836">16</span>&nbsp;<span class="op" id="5571839">||</span>&nbsp;<span class="ident" id="5571842">b</span><span class="op" id="5571843">.</span><span class="ident" id="5571844">Dy</span><span class="op" id="5571846">(</span><span class="op" id="5571847">)</span>&nbsp;<span class="op" id="5571849">&gt;=</span>&nbsp;<span class="num" id="5571852">1</span><span class="op" id="5571853">&lt;&lt;</span><span class="num" id="5571855">16</span>&nbsp;<span class="op" id="5571858">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5571862">return</span>&nbsp;<span class="ident" id="5571869">errors</span><span class="op" id="5571875">.</span><span class="ident" id="5571876">New</span><span class="op" id="5571879">(</span><span class="string" id="5571880">&#34;gif:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="5571915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5571918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571922">opts</span>&nbsp;<span class="op" id="5571927">:=</span>&nbsp;<span class="ident" id="5571930">Options</span><span class="op" id="5571937">{</span><span class="op" id="5571938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5571941">if</span>&nbsp;<span class="ident" id="5571944">o</span>&nbsp;<span class="op" id="5571946">!=</span>&nbsp;<span class="ident" id="5571949">nil</span>&nbsp;<span class="op" id="5571953">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571957">opts</span>&nbsp;<span class="op" id="5571962">=</span>&nbsp;<span class="op" id="5571964">*</span><span class="ident" id="5571965">o</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5571968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5571971">if</span>&nbsp;<span class="ident" id="5571974">opts</span><span class="op" id="5571978">.</span><span class="ident" id="5571979">NumColors</span>&nbsp;<span class="op" id="5571989">&lt;</span>&nbsp;<span class="num" id="5571991">1</span>&nbsp;<span class="op" id="5571993">||</span>&nbsp;<span class="num" id="5571996">256</span>&nbsp;<span class="op" id="5572000">&lt;</span>&nbsp;<span class="ident" id="5572002">opts</span><span class="op" id="5572006">.</span><span class="ident" id="5572007">NumColors</span>&nbsp;<span class="op" id="5572017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572021">opts</span><span class="op" id="5572025">.</span><span class="ident" id="5572026">NumColors</span>&nbsp;<span class="op" id="5572036">=</span>&nbsp;<span class="num" id="5572038">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5572043">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5572046">if</span>&nbsp;<span class="ident" id="5572049">opts</span><span class="op" id="5572053">.</span><span class="ident" id="5572054">Drawer</span>&nbsp;<span class="op" id="5572061">==</span>&nbsp;<span class="ident" id="5572064">nil</span>&nbsp;<span class="op" id="5572068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572072">opts</span><span class="op" id="5572076">.</span><span class="ident" id="5572077">Drawer</span>&nbsp;<span class="op" id="5572084">=</span>&nbsp;<span class="ident" id="5572086">draw</span><span class="op" id="5572090">.</span><span class="ident" id="5572091">FloydSteinberg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5572107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572111">pm</span><span class="op" id="5572113">,</span>&nbsp;<span class="ident" id="5572115">ok</span>&nbsp;<span class="op" id="5572118">:=</span>&nbsp;<span class="ident" id="5572121">m</span><span class="op" id="5572122">.</span><span class="op" id="5572123">(</span><span class="op" id="5572124">*</span><span class="ident" id="5572125">image</span><span class="op" id="5572130">.</span><span class="ident" id="5572131">Paletted</span><span class="op" id="5572139">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5572142">if</span>&nbsp;<span class="op" id="5572145">!</span><span class="ident" id="5572146">ok</span>&nbsp;<span class="op" id="5572149">||</span>&nbsp;<span class="builtinfunc" id="5572152">len</span><span class="op" id="5572155">(</span><span class="ident" id="5572156">pm</span><span class="op" id="5572158">.</span><span class="ident" id="5572159">Palette</span><span class="op" id="5572166">)</span>&nbsp;<span class="op" id="5572168">&gt;</span>&nbsp;<span class="ident" id="5572170">opts</span><span class="op" id="5572174">.</span><span class="ident" id="5572175">NumColors</span>&nbsp;<span class="op" id="5572185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5572189">//&nbsp;TODO:&nbsp;Pick&nbsp;a&nbsp;better&nbsp;sub-sample&nbsp;of&nbsp;the&nbsp;Plan&nbsp;9&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572248">pm</span>&nbsp;<span class="op" id="5572251">=</span>&nbsp;<span class="ident" id="5572253">image</span><span class="op" id="5572258">.</span><span class="ident" id="5572259">NewPaletted</span><span class="op" id="5572270">(</span><span class="ident" id="5572271">b</span><span class="op" id="5572272">,</span>&nbsp;<span class="ident" id="5572274">palette</span><span class="op" id="5572281">.</span><span class="ident" id="5572282">Plan9</span><span class="op" id="5572287">[</span><span class="op" id="5572288">:</span><span class="ident" id="5572289">opts</span><span class="op" id="5572293">.</span><span class="ident" id="5572294">NumColors</span><span class="op" id="5572303">]</span><span class="op" id="5572304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5572308">if</span>&nbsp;<span class="ident" id="5572311">opts</span><span class="op" id="5572315">.</span><span class="ident" id="5572316">Quantizer</span>&nbsp;<span class="op" id="5572326">!=</span>&nbsp;<span class="ident" id="5572329">nil</span>&nbsp;<span class="op" id="5572333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572338">pm</span><span class="op" id="5572340">.</span><span class="ident" id="5572341">Palette</span>&nbsp;<span class="op" id="5572349">=</span>&nbsp;<span class="ident" id="5572351">opts</span><span class="op" id="5572355">.</span><span class="ident" id="5572356">Quantizer</span><span class="op" id="5572365">.</span><span class="ident" id="5572366">Quantize</span><span class="op" id="5572374">(</span><span class="builtinfunc" id="5572375">make</span><span class="op" id="5572379">(</span><span class="ident" id="5572380">color</span><span class="op" id="5572385">.</span><span class="ident" id="5572386">Palette</span><span class="op" id="5572393">,</span>&nbsp;<span class="num" id="5572395">0</span><span class="op" id="5572396">,</span>&nbsp;<span class="ident" id="5572398">opts</span><span class="op" id="5572402">.</span><span class="ident" id="5572403">NumColors</span><span class="op" id="5572412">)</span><span class="op" id="5572413">,</span>&nbsp;<span class="ident" id="5572415">m</span><span class="op" id="5572416">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5572420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572424">opts</span><span class="op" id="5572428">.</span><span class="ident" id="5572429">Drawer</span><span class="op" id="5572435">.</span><span class="ident" id="5572436">Draw</span><span class="op" id="5572440">(</span><span class="ident" id="5572441">pm</span><span class="op" id="5572443">,</span>&nbsp;<span class="ident" id="5572445">b</span><span class="op" id="5572446">,</span>&nbsp;<span class="ident" id="5572448">m</span><span class="op" id="5572449">,</span>&nbsp;<span class="ident" id="5572451">image</span><span class="op" id="5572456">.</span><span class="ident" id="5572457">ZP</span><span class="op" id="5572459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5572462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5572466">return</span>&nbsp;<span class="ident" id="5572473">EncodeAll</span><span class="op" id="5572482">(</span><span class="ident" id="5572483">w</span><span class="op" id="5572484">,</span>&nbsp;<span class="op" id="5572486">&amp;</span><span class="ident" id="5572487">GIF</span><span class="op" id="5572490">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572494">Image</span><span class="op" id="5572499">:</span>&nbsp;<span class="op" id="5572501">[</span><span class="op" id="5572502">]</span><span class="op" id="5572503">*</span><span class="ident" id="5572504">image</span><span class="op" id="5572509">.</span><span class="ident" id="5572510">Paletted</span><span class="op" id="5572518">{</span><span class="ident" id="5572519">pm</span><span class="op" id="5572521">}</span><span class="op" id="5572522">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572526">Delay</span><span class="op" id="5572531">:</span>&nbsp;<span class="op" id="5572533">[</span><span class="op" id="5572534">]</span><span class="builtintype" id="5572535">int</span><span class="op" id="5572538">{</span><span class="num" id="5572539">0</span><span class="op" id="5572540">}</span><span class="op" id="5572541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5572544">}</span><span class="op" id="5572545">)</span><br>
<span class="lineno"></span><span class="op" id="5572547">}</span>
</div>
</body>
</html>
