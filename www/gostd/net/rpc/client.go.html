<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4695457">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4695512">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4695566">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4695617">package</span>&nbsp;<span class="ident" id="4695625">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4695630">import</span>&nbsp;<span class="op" id="4695637">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4695640">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4695649">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4695665">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4695675">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4695681">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4695688">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4695695">&#34;net/http&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4695707">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="4695714">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4695717">//&nbsp;ServerError&nbsp;represents&nbsp;an&nbsp;error&nbsp;that&nbsp;has&nbsp;been&nbsp;returned&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4695780">//&nbsp;the&nbsp;remote&nbsp;side&nbsp;of&nbsp;the&nbsp;RPC&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="4695822">type</span>&nbsp;<span class="ident" id="4695827">ServerError</span>&nbsp;<span class="builtintype" id="4695839">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4695847">func</span>&nbsp;<span class="op" id="4695852">(</span><span class="ident" id="4695853">e</span>&nbsp;<span class="ident" id="4695855">ServerError</span><span class="op" id="4695866">)</span>&nbsp;<span class="ident" id="4695868">Error</span><span class="op" id="4695873">(</span><span class="op" id="4695874">)</span>&nbsp;<span class="builtintype" id="4695876">string</span>&nbsp;<span class="op" id="4695883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4695886">return</span>&nbsp;<span class="builtintype" id="4695893">string</span><span class="op" id="4695899">(</span><span class="ident" id="4695900">e</span><span class="op" id="4695901">)</span><br>
<span class="lineno"></span><span class="op" id="4695903">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="4695906">var</span>&nbsp;<span class="ident" id="4695910">ErrShutdown</span>&nbsp;<span class="op" id="4695922">=</span>&nbsp;<span class="ident" id="4695924">errors</span><span class="op" id="4695930">.</span><span class="ident" id="4695931">New</span><span class="op" id="4695934">(</span><span class="string" id="4695935">&#34;connection&nbsp;is&nbsp;shut&nbsp;down&#34;</span><span class="op" id="4695960">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4695963">//&nbsp;Call&nbsp;represents&nbsp;an&nbsp;active&nbsp;RPC.</span><br>
<span class="lineno"></span><span class="keyword" id="4695997">type</span>&nbsp;<span class="ident" id="4696002">Call</span>&nbsp;<span class="keyword" id="4696007">struct</span>&nbsp;<span class="op" id="4696014">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696017">ServiceMethod</span>&nbsp;<span class="builtintype" id="4696031">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4696043">//&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;service&nbsp;and&nbsp;method&nbsp;to&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696091">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4696105">interface</span><span class="op" id="4696114">{</span><span class="op" id="4696115">}</span>&nbsp;<span class="comment" id="4696117">//&nbsp;The&nbsp;argument&nbsp;to&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696161">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4696175">interface</span><span class="op" id="4696184">{</span><span class="op" id="4696185">}</span>&nbsp;<span class="comment" id="4696187">//&nbsp;The&nbsp;reply&nbsp;from&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696230">Error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4696244">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4696256">//&nbsp;After&nbsp;completion,&nbsp;the&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696296">Done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4696310">chan</span>&nbsp;<span class="op" id="4696315">*</span><span class="ident" id="4696316">Call</span>&nbsp;&nbsp;<span class="comment" id="4696322">//&nbsp;Strobes&nbsp;when&nbsp;call&nbsp;is&nbsp;complete.</span><br>
<span class="lineno">35</span><span class="op" id="4696356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4696359">//&nbsp;Client&nbsp;represents&nbsp;an&nbsp;RPC&nbsp;Client.</span><br>
<span class="lineno"></span><span class="comment" id="4696395">//&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;outstanding&nbsp;Calls&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4696449">//&nbsp;with&nbsp;a&nbsp;single&nbsp;Client,&nbsp;and&nbsp;a&nbsp;Client&nbsp;may&nbsp;be&nbsp;used&nbsp;by</span><br>
<span class="lineno">40</span><span class="comment" id="4696502">//&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="keyword" id="4696541">type</span>&nbsp;<span class="ident" id="4696546">Client</span>&nbsp;<span class="keyword" id="4696553">struct</span>&nbsp;<span class="op" id="4696560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696563">codec</span>&nbsp;<span class="ident" id="4696569">ClientCodec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696583">reqMutex</span>&nbsp;<span class="ident" id="4696592">sync</span><span class="op" id="4696596">.</span><span class="ident" id="4696597">Mutex</span>&nbsp;<span class="comment" id="4696603">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696626">request</span>&nbsp;&nbsp;<span class="ident" id="4696635">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696645">mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4696654">sync</span><span class="op" id="4696658">.</span><span class="ident" id="4696659">Mutex</span>&nbsp;<span class="comment" id="4696665">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696688">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4696697">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696705">pending</span>&nbsp;&nbsp;<span class="keyword" id="4696714">map</span><span class="op" id="4696717">[</span><span class="ident" id="4696718">uint64</span><span class="op" id="4696724">]</span><span class="op" id="4696725">*</span><span class="ident" id="4696726">Call</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696732">closing</span>&nbsp;&nbsp;<span class="builtintype" id="4696741">bool</span>&nbsp;<span class="comment" id="4696746">//&nbsp;user&nbsp;has&nbsp;called&nbsp;Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4696772">shutdown</span>&nbsp;<span class="builtintype" id="4696781">bool</span>&nbsp;<span class="comment" id="4696786">//&nbsp;server&nbsp;has&nbsp;told&nbsp;us&nbsp;to&nbsp;stop</span><br>
<span class="lineno"></span><span class="op" id="4696816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4696819">//&nbsp;A&nbsp;ClientCodec&nbsp;implements&nbsp;writing&nbsp;of&nbsp;RPC&nbsp;requests&nbsp;and</span><br>
<span class="lineno">55</span><span class="comment" id="4696875">//&nbsp;reading&nbsp;of&nbsp;RPC&nbsp;responses&nbsp;for&nbsp;the&nbsp;client&nbsp;side&nbsp;of&nbsp;an&nbsp;RPC&nbsp;session.</span><br>
<span class="lineno"></span><span class="comment" id="4696942">//&nbsp;The&nbsp;client&nbsp;calls&nbsp;WriteRequest&nbsp;to&nbsp;write&nbsp;a&nbsp;request&nbsp;to&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="4697012">//&nbsp;and&nbsp;calls&nbsp;ReadResponseHeader&nbsp;and&nbsp;ReadResponseBody&nbsp;in&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="4697074">//&nbsp;to&nbsp;read&nbsp;responses.&nbsp;&nbsp;The&nbsp;client&nbsp;calls&nbsp;Close&nbsp;when&nbsp;finished&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4697143">//&nbsp;connection.&nbsp;ReadResponseBody&nbsp;may&nbsp;be&nbsp;called&nbsp;with&nbsp;a&nbsp;nil</span><br>
<span class="lineno">60</span><span class="comment" id="4697200">//&nbsp;argument&nbsp;to&nbsp;force&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;response&nbsp;to&nbsp;be&nbsp;read&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="4697266">//&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="4697280">type</span>&nbsp;<span class="ident" id="4697285">ClientCodec</span>&nbsp;<span class="keyword" id="4697297">interface</span>&nbsp;<span class="op" id="4697307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4697310">//&nbsp;WriteRequest&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697383">WriteRequest</span><span class="op" id="4697395">(</span><span class="op" id="4697396">*</span><span class="ident" id="4697397">Request</span><span class="op" id="4697404">,</span>&nbsp;<span class="keyword" id="4697406">interface</span><span class="op" id="4697415">{</span><span class="op" id="4697416">}</span><span class="op" id="4697417">)</span>&nbsp;<span class="builtintype" id="4697419">error</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697426">ReadResponseHeader</span><span class="op" id="4697444">(</span><span class="op" id="4697445">*</span><span class="ident" id="4697446">Response</span><span class="op" id="4697454">)</span>&nbsp;<span class="builtintype" id="4697456">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697463">ReadResponseBody</span><span class="op" id="4697479">(</span><span class="keyword" id="4697480">interface</span><span class="op" id="4697489">{</span><span class="op" id="4697490">}</span><span class="op" id="4697491">)</span>&nbsp;<span class="builtintype" id="4697493">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697501">Close</span><span class="op" id="4697506">(</span><span class="op" id="4697507">)</span>&nbsp;<span class="builtintype" id="4697509">error</span><br>
<span class="lineno"></span><span class="op" id="4697515">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4697518">func</span>&nbsp;<span class="op" id="4697523">(</span><span class="ident" id="4697524">client</span>&nbsp;<span class="op" id="4697531">*</span><span class="ident" id="4697532">Client</span><span class="op" id="4697538">)</span>&nbsp;<span class="ident" id="4697540">send</span><span class="op" id="4697544">(</span><span class="ident" id="4697545">call</span>&nbsp;<span class="op" id="4697550">*</span><span class="ident" id="4697551">Call</span><span class="op" id="4697555">)</span>&nbsp;<span class="op" id="4697557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697560">client</span><span class="op" id="4697566">.</span><span class="ident" id="4697567">reqMutex</span><span class="op" id="4697575">.</span><span class="ident" id="4697576">Lock</span><span class="op" id="4697580">(</span><span class="op" id="4697581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697584">defer</span>&nbsp;<span class="ident" id="4697590">client</span><span class="op" id="4697596">.</span><span class="ident" id="4697597">reqMutex</span><span class="op" id="4697605">.</span><span class="ident" id="4697606">Unlock</span><span class="op" id="4697612">(</span><span class="op" id="4697613">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4697617">//&nbsp;Register&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697641">client</span><span class="op" id="4697647">.</span><span class="ident" id="4697648">mutex</span><span class="op" id="4697653">.</span><span class="ident" id="4697654">Lock</span><span class="op" id="4697658">(</span><span class="op" id="4697659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697662">if</span>&nbsp;<span class="ident" id="4697665">client</span><span class="op" id="4697671">.</span><span class="ident" id="4697672">shutdown</span>&nbsp;<span class="op" id="4697681">||</span>&nbsp;<span class="ident" id="4697684">client</span><span class="op" id="4697690">.</span><span class="ident" id="4697691">closing</span>&nbsp;<span class="op" id="4697699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697703">call</span><span class="op" id="4697707">.</span><span class="ident" id="4697708">Error</span>&nbsp;<span class="op" id="4697714">=</span>&nbsp;<span class="ident" id="4697716">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697730">client</span><span class="op" id="4697736">.</span><span class="ident" id="4697737">mutex</span><span class="op" id="4697742">.</span><span class="ident" id="4697743">Unlock</span><span class="op" id="4697749">(</span><span class="op" id="4697750">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697754">call</span><span class="op" id="4697758">.</span><span class="ident" id="4697759">done</span><span class="op" id="4697763">(</span><span class="op" id="4697764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4697768">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4697776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697779">seq</span>&nbsp;<span class="op" id="4697783">:=</span>&nbsp;<span class="ident" id="4697786">client</span><span class="op" id="4697792">.</span><span class="ident" id="4697793">seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697798">client</span><span class="op" id="4697804">.</span><span class="ident" id="4697805">seq</span><span class="op" id="4697808">++</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697812">client</span><span class="op" id="4697818">.</span><span class="ident" id="4697819">pending</span><span class="op" id="4697826">[</span><span class="ident" id="4697827">seq</span><span class="op" id="4697830">]</span>&nbsp;<span class="op" id="4697832">=</span>&nbsp;<span class="ident" id="4697834">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697840">client</span><span class="op" id="4697846">.</span><span class="ident" id="4697847">mutex</span><span class="op" id="4697852">.</span><span class="ident" id="4697853">Unlock</span><span class="op" id="4697859">(</span><span class="op" id="4697860">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4697864">//&nbsp;Encode&nbsp;and&nbsp;send&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697897">client</span><span class="op" id="4697903">.</span><span class="ident" id="4697904">request</span><span class="op" id="4697911">.</span><span class="ident" id="4697912">Seq</span>&nbsp;<span class="op" id="4697916">=</span>&nbsp;<span class="ident" id="4697918">seq</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697923">client</span><span class="op" id="4697929">.</span><span class="ident" id="4697930">request</span><span class="op" id="4697937">.</span><span class="ident" id="4697938">ServiceMethod</span>&nbsp;<span class="op" id="4697952">=</span>&nbsp;<span class="ident" id="4697954">call</span><span class="op" id="4697958">.</span><span class="ident" id="4697959">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4697974">err</span>&nbsp;<span class="op" id="4697978">:=</span>&nbsp;<span class="ident" id="4697981">client</span><span class="op" id="4697987">.</span><span class="ident" id="4697988">codec</span><span class="op" id="4697993">.</span><span class="ident" id="4697994">WriteRequest</span><span class="op" id="4698006">(</span><span class="op" id="4698007">&amp;</span><span class="ident" id="4698008">client</span><span class="op" id="4698014">.</span><span class="ident" id="4698015">request</span><span class="op" id="4698022">,</span>&nbsp;<span class="ident" id="4698024">call</span><span class="op" id="4698028">.</span><span class="ident" id="4698029">Args</span><span class="op" id="4698033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698036">if</span>&nbsp;<span class="ident" id="4698039">err</span>&nbsp;<span class="op" id="4698043">!=</span>&nbsp;<span class="ident" id="4698046">nil</span>&nbsp;<span class="op" id="4698050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698054">client</span><span class="op" id="4698060">.</span><span class="ident" id="4698061">mutex</span><span class="op" id="4698066">.</span><span class="ident" id="4698067">Lock</span><span class="op" id="4698071">(</span><span class="op" id="4698072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698076">call</span>&nbsp;<span class="op" id="4698081">=</span>&nbsp;<span class="ident" id="4698083">client</span><span class="op" id="4698089">.</span><span class="ident" id="4698090">pending</span><span class="op" id="4698097">[</span><span class="ident" id="4698098">seq</span><span class="op" id="4698101">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4698105">delete</span><span class="op" id="4698111">(</span><span class="ident" id="4698112">client</span><span class="op" id="4698118">.</span><span class="ident" id="4698119">pending</span><span class="op" id="4698126">,</span>&nbsp;<span class="ident" id="4698128">seq</span><span class="op" id="4698131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698135">client</span><span class="op" id="4698141">.</span><span class="ident" id="4698142">mutex</span><span class="op" id="4698147">.</span><span class="ident" id="4698148">Unlock</span><span class="op" id="4698154">(</span><span class="op" id="4698155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698159">if</span>&nbsp;<span class="ident" id="4698162">call</span>&nbsp;<span class="op" id="4698167">!=</span>&nbsp;<span class="ident" id="4698170">nil</span>&nbsp;<span class="op" id="4698174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698179">call</span><span class="op" id="4698183">.</span><span class="ident" id="4698184">Error</span>&nbsp;<span class="op" id="4698190">=</span>&nbsp;<span class="ident" id="4698192">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698199">call</span><span class="op" id="4698203">.</span><span class="ident" id="4698204">done</span><span class="op" id="4698208">(</span><span class="op" id="4698209">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4698213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4698216">}</span><br>
<span class="lineno"></span><span class="op" id="4698218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4698221">func</span>&nbsp;<span class="op" id="4698226">(</span><span class="ident" id="4698227">client</span>&nbsp;<span class="op" id="4698234">*</span><span class="ident" id="4698235">Client</span><span class="op" id="4698241">)</span>&nbsp;<span class="ident" id="4698243">input</span><span class="op" id="4698248">(</span><span class="op" id="4698249">)</span>&nbsp;<span class="op" id="4698251">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698254">var</span>&nbsp;<span class="ident" id="4698258">err</span>&nbsp;<span class="builtintype" id="4698262">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698269">var</span>&nbsp;<span class="ident" id="4698273">response</span>&nbsp;<span class="ident" id="4698282">Response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698292">for</span>&nbsp;<span class="ident" id="4698296">err</span>&nbsp;<span class="op" id="4698300">==</span>&nbsp;<span class="ident" id="4698303">nil</span>&nbsp;<span class="op" id="4698307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698311">response</span>&nbsp;<span class="op" id="4698320">=</span>&nbsp;<span class="ident" id="4698322">Response</span><span class="op" id="4698330">{</span><span class="op" id="4698331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698335">err</span>&nbsp;<span class="op" id="4698339">=</span>&nbsp;<span class="ident" id="4698341">client</span><span class="op" id="4698347">.</span><span class="ident" id="4698348">codec</span><span class="op" id="4698353">.</span><span class="ident" id="4698354">ReadResponseHeader</span><span class="op" id="4698372">(</span><span class="op" id="4698373">&amp;</span><span class="ident" id="4698374">response</span><span class="op" id="4698382">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698386">if</span>&nbsp;<span class="ident" id="4698389">err</span>&nbsp;<span class="op" id="4698393">!=</span>&nbsp;<span class="ident" id="4698396">nil</span>&nbsp;<span class="op" id="4698400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698405">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4698413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698417">seq</span>&nbsp;<span class="op" id="4698421">:=</span>&nbsp;<span class="ident" id="4698424">response</span><span class="op" id="4698432">.</span><span class="ident" id="4698433">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698439">client</span><span class="op" id="4698445">.</span><span class="ident" id="4698446">mutex</span><span class="op" id="4698451">.</span><span class="ident" id="4698452">Lock</span><span class="op" id="4698456">(</span><span class="op" id="4698457">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698461">call</span>&nbsp;<span class="op" id="4698466">:=</span>&nbsp;<span class="ident" id="4698469">client</span><span class="op" id="4698475">.</span><span class="ident" id="4698476">pending</span><span class="op" id="4698483">[</span><span class="ident" id="4698484">seq</span><span class="op" id="4698487">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4698491">delete</span><span class="op" id="4698497">(</span><span class="ident" id="4698498">client</span><span class="op" id="4698504">.</span><span class="ident" id="4698505">pending</span><span class="op" id="4698512">,</span>&nbsp;<span class="ident" id="4698514">seq</span><span class="op" id="4698517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698521">client</span><span class="op" id="4698527">.</span><span class="ident" id="4698528">mutex</span><span class="op" id="4698533">.</span><span class="ident" id="4698534">Unlock</span><span class="op" id="4698540">(</span><span class="op" id="4698541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698546">switch</span>&nbsp;<span class="op" id="4698553">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698557">case</span>&nbsp;<span class="ident" id="4698562">call</span>&nbsp;<span class="op" id="4698567">==</span>&nbsp;<span class="ident" id="4698570">nil</span><span class="op" id="4698573">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4698578">//&nbsp;We&#39;ve&nbsp;got&nbsp;no&nbsp;pending&nbsp;call.&nbsp;That&nbsp;usually&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4698635">//&nbsp;WriteRequest&nbsp;partially&nbsp;failed,&nbsp;and&nbsp;call&nbsp;was&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4698693">//&nbsp;removed;&nbsp;response&nbsp;is&nbsp;a&nbsp;server&nbsp;telling&nbsp;us&nbsp;about&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4698749">//&nbsp;error&nbsp;reading&nbsp;request&nbsp;body.&nbsp;We&nbsp;should&nbsp;still&nbsp;attempt</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4698807">//&nbsp;to&nbsp;read&nbsp;error&nbsp;body,&nbsp;but&nbsp;there&#39;s&nbsp;no&nbsp;one&nbsp;to&nbsp;give&nbsp;it&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698867">err</span>&nbsp;<span class="op" id="4698871">=</span>&nbsp;<span class="ident" id="4698873">client</span><span class="op" id="4698879">.</span><span class="ident" id="4698880">codec</span><span class="op" id="4698885">.</span><span class="ident" id="4698886">ReadResponseBody</span><span class="op" id="4698902">(</span><span class="ident" id="4698903">nil</span><span class="op" id="4698906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698911">if</span>&nbsp;<span class="ident" id="4698914">err</span>&nbsp;<span class="op" id="4698918">!=</span>&nbsp;<span class="ident" id="4698921">nil</span>&nbsp;<span class="op" id="4698925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4698931">err</span>&nbsp;<span class="op" id="4698935">=</span>&nbsp;<span class="ident" id="4698937">errors</span><span class="op" id="4698943">.</span><span class="ident" id="4698944">New</span><span class="op" id="4698947">(</span><span class="string" id="4698948">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="4698971">+</span>&nbsp;<span class="ident" id="4698973">err</span><span class="op" id="4698976">.</span><span class="ident" id="4698977">Error</span><span class="op" id="4698982">(</span><span class="op" id="4698983">)</span><span class="op" id="4698984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4698989">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4698993">case</span>&nbsp;<span class="ident" id="4698998">response</span><span class="op" id="4699006">.</span><span class="ident" id="4699007">Error</span>&nbsp;<span class="op" id="4699013">!=</span>&nbsp;<span class="string" id="4699016">&#34;&#34;</span><span class="op" id="4699018">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4699023">//&nbsp;We&#39;ve&nbsp;got&nbsp;an&nbsp;error&nbsp;response.&nbsp;Give&nbsp;this&nbsp;to&nbsp;the&nbsp;request;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4699084">//&nbsp;any&nbsp;subsequent&nbsp;requests&nbsp;will&nbsp;get&nbsp;the&nbsp;ReadResponseBody</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4699144">//&nbsp;error&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699173">call</span><span class="op" id="4699177">.</span><span class="ident" id="4699178">Error</span>&nbsp;<span class="op" id="4699184">=</span>&nbsp;<span class="ident" id="4699186">ServerError</span><span class="op" id="4699197">(</span><span class="ident" id="4699198">response</span><span class="op" id="4699206">.</span><span class="ident" id="4699207">Error</span><span class="op" id="4699212">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699217">err</span>&nbsp;<span class="op" id="4699221">=</span>&nbsp;<span class="ident" id="4699223">client</span><span class="op" id="4699229">.</span><span class="ident" id="4699230">codec</span><span class="op" id="4699235">.</span><span class="ident" id="4699236">ReadResponseBody</span><span class="op" id="4699252">(</span><span class="ident" id="4699253">nil</span><span class="op" id="4699256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699261">if</span>&nbsp;<span class="ident" id="4699264">err</span>&nbsp;<span class="op" id="4699268">!=</span>&nbsp;<span class="ident" id="4699271">nil</span>&nbsp;<span class="op" id="4699275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699281">err</span>&nbsp;<span class="op" id="4699285">=</span>&nbsp;<span class="ident" id="4699287">errors</span><span class="op" id="4699293">.</span><span class="ident" id="4699294">New</span><span class="op" id="4699297">(</span><span class="string" id="4699298">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="4699321">+</span>&nbsp;<span class="ident" id="4699323">err</span><span class="op" id="4699326">.</span><span class="ident" id="4699327">Error</span><span class="op" id="4699332">(</span><span class="op" id="4699333">)</span><span class="op" id="4699334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699344">call</span><span class="op" id="4699348">.</span><span class="ident" id="4699349">done</span><span class="op" id="4699353">(</span><span class="op" id="4699354">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699358">default</span><span class="op" id="4699365">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699370">err</span>&nbsp;<span class="op" id="4699374">=</span>&nbsp;<span class="ident" id="4699376">client</span><span class="op" id="4699382">.</span><span class="ident" id="4699383">codec</span><span class="op" id="4699388">.</span><span class="ident" id="4699389">ReadResponseBody</span><span class="op" id="4699405">(</span><span class="ident" id="4699406">call</span><span class="op" id="4699410">.</span><span class="ident" id="4699411">Reply</span><span class="op" id="4699416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699421">if</span>&nbsp;<span class="ident" id="4699424">err</span>&nbsp;<span class="op" id="4699428">!=</span>&nbsp;<span class="ident" id="4699431">nil</span>&nbsp;<span class="op" id="4699435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699441">call</span><span class="op" id="4699445">.</span><span class="ident" id="4699446">Error</span>&nbsp;<span class="op" id="4699452">=</span>&nbsp;<span class="ident" id="4699454">errors</span><span class="op" id="4699460">.</span><span class="ident" id="4699461">New</span><span class="op" id="4699464">(</span><span class="string" id="4699465">&#34;reading&nbsp;body&nbsp;&#34;</span>&nbsp;<span class="op" id="4699481">+</span>&nbsp;<span class="ident" id="4699483">err</span><span class="op" id="4699486">.</span><span class="ident" id="4699487">Error</span><span class="op" id="4699492">(</span><span class="op" id="4699493">)</span><span class="op" id="4699494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699499">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699504">call</span><span class="op" id="4699508">.</span><span class="ident" id="4699509">done</span><span class="op" id="4699513">(</span><span class="op" id="4699514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4699524">//&nbsp;Terminate&nbsp;pending&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699553">client</span><span class="op" id="4699559">.</span><span class="ident" id="4699560">reqMutex</span><span class="op" id="4699568">.</span><span class="ident" id="4699569">Lock</span><span class="op" id="4699573">(</span><span class="op" id="4699574">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699577">client</span><span class="op" id="4699583">.</span><span class="ident" id="4699584">mutex</span><span class="op" id="4699589">.</span><span class="ident" id="4699590">Lock</span><span class="op" id="4699594">(</span><span class="op" id="4699595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699598">client</span><span class="op" id="4699604">.</span><span class="ident" id="4699605">shutdown</span>&nbsp;<span class="op" id="4699614">=</span>&nbsp;<span class="builtintype" id="4699616">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699622">closing</span>&nbsp;<span class="op" id="4699630">:=</span>&nbsp;<span class="ident" id="4699633">client</span><span class="op" id="4699639">.</span><span class="ident" id="4699640">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699649">if</span>&nbsp;<span class="ident" id="4699652">err</span>&nbsp;<span class="op" id="4699656">==</span>&nbsp;<span class="ident" id="4699659">io</span><span class="op" id="4699661">.</span><span class="ident" id="4699662">EOF</span>&nbsp;<span class="op" id="4699666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699670">if</span>&nbsp;<span class="ident" id="4699673">closing</span>&nbsp;<span class="op" id="4699681">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699686">err</span>&nbsp;<span class="op" id="4699690">=</span>&nbsp;<span class="ident" id="4699692">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699706">}</span>&nbsp;<span class="keyword" id="4699708">else</span>&nbsp;<span class="op" id="4699713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699718">err</span>&nbsp;<span class="op" id="4699722">=</span>&nbsp;<span class="ident" id="4699724">io</span><span class="op" id="4699726">.</span><span class="ident" id="4699727">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699749">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699752">for</span>&nbsp;<span class="ident" id="4699756">_</span><span class="op" id="4699757">,</span>&nbsp;<span class="ident" id="4699759">call</span>&nbsp;<span class="op" id="4699764">:=</span>&nbsp;<span class="keyword" id="4699767">range</span>&nbsp;<span class="ident" id="4699773">client</span><span class="op" id="4699779">.</span><span class="ident" id="4699780">pending</span>&nbsp;<span class="op" id="4699788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699792">call</span><span class="op" id="4699796">.</span><span class="ident" id="4699797">Error</span>&nbsp;<span class="op" id="4699803">=</span>&nbsp;<span class="ident" id="4699805">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699811">call</span><span class="op" id="4699815">.</span><span class="ident" id="4699816">done</span><span class="op" id="4699820">(</span><span class="op" id="4699821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699827">client</span><span class="op" id="4699833">.</span><span class="ident" id="4699834">mutex</span><span class="op" id="4699839">.</span><span class="ident" id="4699840">Unlock</span><span class="op" id="4699846">(</span><span class="op" id="4699847">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699850">client</span><span class="op" id="4699856">.</span><span class="ident" id="4699857">reqMutex</span><span class="op" id="4699865">.</span><span class="ident" id="4699866">Unlock</span><span class="op" id="4699872">(</span><span class="op" id="4699873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4699876">if</span>&nbsp;<span class="ident" id="4699879">debugLog</span>&nbsp;<span class="op" id="4699888">&amp;&amp;</span>&nbsp;<span class="ident" id="4699891">err</span>&nbsp;<span class="op" id="4699895">!=</span>&nbsp;<span class="ident" id="4699898">io</span><span class="op" id="4699900">.</span><span class="ident" id="4699901">EOF</span>&nbsp;<span class="op" id="4699905">&amp;&amp;</span>&nbsp;<span class="op" id="4699908">!</span><span class="ident" id="4699909">closing</span>&nbsp;<span class="op" id="4699917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4699921">log</span><span class="op" id="4699924">.</span><span class="ident" id="4699925">Println</span><span class="op" id="4699932">(</span><span class="string" id="4699933">&#34;rpc:&nbsp;client&nbsp;protocol&nbsp;error:&#34;</span><span class="op" id="4699962">,</span>&nbsp;<span class="ident" id="4699964">err</span><span class="op" id="4699967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4699970">}</span><br>
<span class="lineno"></span><span class="op" id="4699972">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="4699975">func</span>&nbsp;<span class="op" id="4699980">(</span><span class="ident" id="4699981">call</span>&nbsp;<span class="op" id="4699986">*</span><span class="ident" id="4699987">Call</span><span class="op" id="4699991">)</span>&nbsp;<span class="ident" id="4699993">done</span><span class="op" id="4699997">(</span><span class="op" id="4699998">)</span>&nbsp;<span class="op" id="4700000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700003">select</span>&nbsp;<span class="op" id="4700010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700013">case</span>&nbsp;<span class="ident" id="4700018">call</span><span class="op" id="4700022">.</span><span class="ident" id="4700023">Done</span>&nbsp;<span class="op" id="4700028">&lt;-</span>&nbsp;<span class="ident" id="4700031">call</span><span class="op" id="4700035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4700039">//&nbsp;ok</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700046">default</span><span class="op" id="4700053">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4700057">//&nbsp;We&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;block&nbsp;here.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4700134">//&nbsp;sure&nbsp;the&nbsp;channel&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;space.&nbsp;See&nbsp;comment&nbsp;in&nbsp;Go().</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700202">if</span>&nbsp;<span class="ident" id="4700205">debugLog</span>&nbsp;<span class="op" id="4700214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700219">log</span><span class="op" id="4700222">.</span><span class="ident" id="4700223">Println</span><span class="op" id="4700230">(</span><span class="string" id="4700231">&#34;rpc:&nbsp;discarding&nbsp;Call&nbsp;reply&nbsp;due&nbsp;to&nbsp;insufficient&nbsp;Done&nbsp;chan&nbsp;capacity&#34;</span><span class="op" id="4700298">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4700302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4700305">}</span><br>
<span class="lineno"></span><span class="op" id="4700307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4700310">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno">185</span><span class="comment" id="4700370">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4700425">//&nbsp;It&nbsp;adds&nbsp;a&nbsp;buffer&nbsp;to&nbsp;the&nbsp;write&nbsp;side&nbsp;of&nbsp;the&nbsp;connection&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="4700484">//&nbsp;the&nbsp;header&nbsp;and&nbsp;payload&nbsp;are&nbsp;sent&nbsp;as&nbsp;a&nbsp;unit.</span><br>
<span class="lineno"></span><span class="keyword" id="4700530">func</span>&nbsp;<span class="ident" id="4700535">NewClient</span><span class="op" id="4700544">(</span><span class="ident" id="4700545">conn</span>&nbsp;<span class="ident" id="4700550">io</span><span class="op" id="4700552">.</span><span class="ident" id="4700553">ReadWriteCloser</span><span class="op" id="4700568">)</span>&nbsp;<span class="op" id="4700570">*</span><span class="ident" id="4700571">Client</span>&nbsp;<span class="op" id="4700578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700581">encBuf</span>&nbsp;<span class="op" id="4700588">:=</span>&nbsp;<span class="ident" id="4700591">bufio</span><span class="op" id="4700596">.</span><span class="ident" id="4700597">NewWriter</span><span class="op" id="4700606">(</span><span class="ident" id="4700607">conn</span><span class="op" id="4700611">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700614">client</span>&nbsp;<span class="op" id="4700621">:=</span>&nbsp;<span class="op" id="4700624">&amp;</span><span class="ident" id="4700625">gobClientCodec</span><span class="op" id="4700639">{</span><span class="ident" id="4700640">conn</span><span class="op" id="4700644">,</span>&nbsp;<span class="ident" id="4700646">gob</span><span class="op" id="4700649">.</span><span class="ident" id="4700650">NewDecoder</span><span class="op" id="4700660">(</span><span class="ident" id="4700661">conn</span><span class="op" id="4700665">)</span><span class="op" id="4700666">,</span>&nbsp;<span class="ident" id="4700668">gob</span><span class="op" id="4700671">.</span><span class="ident" id="4700672">NewEncoder</span><span class="op" id="4700682">(</span><span class="ident" id="4700683">encBuf</span><span class="op" id="4700689">)</span><span class="op" id="4700690">,</span>&nbsp;<span class="ident" id="4700692">encBuf</span><span class="op" id="4700698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700701">return</span>&nbsp;<span class="ident" id="4700708">NewClientWithCodec</span><span class="op" id="4700726">(</span><span class="ident" id="4700727">client</span><span class="op" id="4700733">)</span><br>
<span class="lineno"></span><span class="op" id="4700735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4700738">//&nbsp;NewClientWithCodec&nbsp;is&nbsp;like&nbsp;NewClient&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified</span><br>
<span class="lineno">195</span><span class="comment" id="4700801">//&nbsp;codec&nbsp;to&nbsp;encode&nbsp;requests&nbsp;and&nbsp;decode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="4700851">func</span>&nbsp;<span class="ident" id="4700856">NewClientWithCodec</span><span class="op" id="4700874">(</span><span class="ident" id="4700875">codec</span>&nbsp;<span class="ident" id="4700881">ClientCodec</span><span class="op" id="4700892">)</span>&nbsp;<span class="op" id="4700894">*</span><span class="ident" id="4700895">Client</span>&nbsp;<span class="op" id="4700902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700905">client</span>&nbsp;<span class="op" id="4700912">:=</span>&nbsp;<span class="op" id="4700915">&amp;</span><span class="ident" id="4700916">Client</span><span class="op" id="4700922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700926">codec</span><span class="op" id="4700931">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4700935">codec</span><span class="op" id="4700940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4700944">pending</span><span class="op" id="4700951">:</span>&nbsp;<span class="builtinfunc" id="4700953">make</span><span class="op" id="4700957">(</span><span class="keyword" id="4700958">map</span><span class="op" id="4700961">[</span><span class="ident" id="4700962">uint64</span><span class="op" id="4700968">]</span><span class="op" id="4700969">*</span><span class="ident" id="4700970">Call</span><span class="op" id="4700974">)</span><span class="op" id="4700975">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4700978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4700981">go</span>&nbsp;<span class="ident" id="4700984">client</span><span class="op" id="4700990">.</span><span class="ident" id="4700991">input</span><span class="op" id="4700996">(</span><span class="op" id="4700997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701000">return</span>&nbsp;<span class="ident" id="4701007">client</span><br>
<span class="lineno"></span><span class="op" id="4701014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="4701017">type</span>&nbsp;<span class="ident" id="4701022">gobClientCodec</span>&nbsp;<span class="keyword" id="4701037">struct</span>&nbsp;<span class="op" id="4701044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701047">rwc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4701054">io</span><span class="op" id="4701056">.</span><span class="ident" id="4701057">ReadWriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701074">dec</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4701081">*</span><span class="ident" id="4701082">gob</span><span class="op" id="4701085">.</span><span class="ident" id="4701086">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701095">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4701102">*</span><span class="ident" id="4701103">gob</span><span class="op" id="4701106">.</span><span class="ident" id="4701107">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4701116">encBuf</span>&nbsp;<span class="op" id="4701123">*</span><span class="ident" id="4701124">bufio</span><span class="op" id="4701129">.</span><span class="ident" id="4701130">Writer</span><br>
<span class="lineno">210</span><span class="op" id="4701137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4701140">func</span>&nbsp;<span class="op" id="4701145">(</span><span class="ident" id="4701146">c</span>&nbsp;<span class="op" id="4701148">*</span><span class="ident" id="4701149">gobClientCodec</span><span class="op" id="4701163">)</span>&nbsp;<span class="ident" id="4701165">WriteRequest</span><span class="op" id="4701177">(</span><span class="ident" id="4701178">r</span>&nbsp;<span class="op" id="4701180">*</span><span class="ident" id="4701181">Request</span><span class="op" id="4701188">,</span>&nbsp;<span class="ident" id="4701190">body</span>&nbsp;<span class="keyword" id="4701195">interface</span><span class="op" id="4701204">{</span><span class="op" id="4701205">}</span><span class="op" id="4701206">)</span>&nbsp;<span class="op" id="4701208">(</span><span class="ident" id="4701209">err</span>&nbsp;<span class="builtintype" id="4701213">error</span><span class="op" id="4701218">)</span>&nbsp;<span class="op" id="4701220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701223">if</span>&nbsp;<span class="ident" id="4701226">err</span>&nbsp;<span class="op" id="4701230">=</span>&nbsp;<span class="ident" id="4701232">c</span><span class="op" id="4701233">.</span><span class="ident" id="4701234">enc</span><span class="op" id="4701237">.</span><span class="ident" id="4701238">Encode</span><span class="op" id="4701244">(</span><span class="ident" id="4701245">r</span><span class="op" id="4701246">)</span><span class="op" id="4701247">;</span>&nbsp;<span class="ident" id="4701249">err</span>&nbsp;<span class="op" id="4701253">!=</span>&nbsp;<span class="ident" id="4701256">nil</span>&nbsp;<span class="op" id="4701260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701264">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4701272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701275">if</span>&nbsp;<span class="ident" id="4701278">err</span>&nbsp;<span class="op" id="4701282">=</span>&nbsp;<span class="ident" id="4701284">c</span><span class="op" id="4701285">.</span><span class="ident" id="4701286">enc</span><span class="op" id="4701289">.</span><span class="ident" id="4701290">Encode</span><span class="op" id="4701296">(</span><span class="ident" id="4701297">body</span><span class="op" id="4701301">)</span><span class="op" id="4701302">;</span>&nbsp;<span class="ident" id="4701304">err</span>&nbsp;<span class="op" id="4701308">!=</span>&nbsp;<span class="ident" id="4701311">nil</span>&nbsp;<span class="op" id="4701315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701319">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4701327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701330">return</span>&nbsp;<span class="ident" id="4701337">c</span><span class="op" id="4701338">.</span><span class="ident" id="4701339">encBuf</span><span class="op" id="4701345">.</span><span class="ident" id="4701346">Flush</span><span class="op" id="4701351">(</span><span class="op" id="4701352">)</span><br>
<span class="lineno">220</span><span class="op" id="4701354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4701357">func</span>&nbsp;<span class="op" id="4701362">(</span><span class="ident" id="4701363">c</span>&nbsp;<span class="op" id="4701365">*</span><span class="ident" id="4701366">gobClientCodec</span><span class="op" id="4701380">)</span>&nbsp;<span class="ident" id="4701382">ReadResponseHeader</span><span class="op" id="4701400">(</span><span class="ident" id="4701401">r</span>&nbsp;<span class="op" id="4701403">*</span><span class="ident" id="4701404">Response</span><span class="op" id="4701412">)</span>&nbsp;<span class="builtintype" id="4701414">error</span>&nbsp;<span class="op" id="4701420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701423">return</span>&nbsp;<span class="ident" id="4701430">c</span><span class="op" id="4701431">.</span><span class="ident" id="4701432">dec</span><span class="op" id="4701435">.</span><span class="ident" id="4701436">Decode</span><span class="op" id="4701442">(</span><span class="ident" id="4701443">r</span><span class="op" id="4701444">)</span><br>
<span class="lineno"></span><span class="op" id="4701446">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="4701449">func</span>&nbsp;<span class="op" id="4701454">(</span><span class="ident" id="4701455">c</span>&nbsp;<span class="op" id="4701457">*</span><span class="ident" id="4701458">gobClientCodec</span><span class="op" id="4701472">)</span>&nbsp;<span class="ident" id="4701474">ReadResponseBody</span><span class="op" id="4701490">(</span><span class="ident" id="4701491">body</span>&nbsp;<span class="keyword" id="4701496">interface</span><span class="op" id="4701505">{</span><span class="op" id="4701506">}</span><span class="op" id="4701507">)</span>&nbsp;<span class="builtintype" id="4701509">error</span>&nbsp;<span class="op" id="4701515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701518">return</span>&nbsp;<span class="ident" id="4701525">c</span><span class="op" id="4701526">.</span><span class="ident" id="4701527">dec</span><span class="op" id="4701530">.</span><span class="ident" id="4701531">Decode</span><span class="op" id="4701537">(</span><span class="ident" id="4701538">body</span><span class="op" id="4701542">)</span><br>
<span class="lineno"></span><span class="op" id="4701544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="4701547">func</span>&nbsp;<span class="op" id="4701552">(</span><span class="ident" id="4701553">c</span>&nbsp;<span class="op" id="4701555">*</span><span class="ident" id="4701556">gobClientCodec</span><span class="op" id="4701570">)</span>&nbsp;<span class="ident" id="4701572">Close</span><span class="op" id="4701577">(</span><span class="op" id="4701578">)</span>&nbsp;<span class="builtintype" id="4701580">error</span>&nbsp;<span class="op" id="4701586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701589">return</span>&nbsp;<span class="ident" id="4701596">c</span><span class="op" id="4701597">.</span><span class="ident" id="4701598">rwc</span><span class="op" id="4701601">.</span><span class="ident" id="4701602">Close</span><span class="op" id="4701607">(</span><span class="op" id="4701608">)</span><br>
<span class="lineno"></span><span class="op" id="4701610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4701613">//&nbsp;DialHTTP&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address</span><br>
<span class="lineno">235</span><span class="comment" id="4701689">//&nbsp;listening&nbsp;on&nbsp;the&nbsp;default&nbsp;HTTP&nbsp;RPC&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="4701732">func</span>&nbsp;<span class="ident" id="4701737">DialHTTP</span><span class="op" id="4701745">(</span><span class="ident" id="4701746">network</span><span class="op" id="4701753">,</span>&nbsp;<span class="ident" id="4701755">address</span>&nbsp;<span class="builtintype" id="4701763">string</span><span class="op" id="4701769">)</span>&nbsp;<span class="op" id="4701771">(</span><span class="op" id="4701772">*</span><span class="ident" id="4701773">Client</span><span class="op" id="4701779">,</span>&nbsp;<span class="builtintype" id="4701781">error</span><span class="op" id="4701786">)</span>&nbsp;<span class="op" id="4701788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4701791">return</span>&nbsp;<span class="ident" id="4701798">DialHTTPPath</span><span class="op" id="4701810">(</span><span class="ident" id="4701811">network</span><span class="op" id="4701818">,</span>&nbsp;<span class="ident" id="4701820">address</span><span class="op" id="4701827">,</span>&nbsp;<span class="ident" id="4701829">DefaultRPCPath</span><span class="op" id="4701843">)</span><br>
<span class="lineno"></span><span class="op" id="4701845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="4701848">//&nbsp;DialHTTPPath&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="4701895">//&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address&nbsp;and&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="4701941">func</span>&nbsp;<span class="ident" id="4701946">DialHTTPPath</span><span class="op" id="4701958">(</span><span class="ident" id="4701959">network</span><span class="op" id="4701966">,</span>&nbsp;<span class="ident" id="4701968">address</span><span class="op" id="4701975">,</span>&nbsp;<span class="ident" id="4701977">path</span>&nbsp;<span class="builtintype" id="4701982">string</span><span class="op" id="4701988">)</span>&nbsp;<span class="op" id="4701990">(</span><span class="op" id="4701991">*</span><span class="ident" id="4701992">Client</span><span class="op" id="4701998">,</span>&nbsp;<span class="builtintype" id="4702000">error</span><span class="op" id="4702005">)</span>&nbsp;<span class="op" id="4702007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702010">var</span>&nbsp;<span class="ident" id="4702014">err</span>&nbsp;<span class="builtintype" id="4702018">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702025">conn</span><span class="op" id="4702029">,</span>&nbsp;<span class="ident" id="4702031">err</span>&nbsp;<span class="op" id="4702035">:=</span>&nbsp;<span class="ident" id="4702038">net</span><span class="op" id="4702041">.</span><span class="ident" id="4702042">Dial</span><span class="op" id="4702046">(</span><span class="ident" id="4702047">network</span><span class="op" id="4702054">,</span>&nbsp;<span class="ident" id="4702056">address</span><span class="op" id="4702063">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702066">if</span>&nbsp;<span class="ident" id="4702069">err</span>&nbsp;<span class="op" id="4702073">!=</span>&nbsp;<span class="ident" id="4702076">nil</span>&nbsp;<span class="op" id="4702080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702084">return</span>&nbsp;<span class="ident" id="4702091">nil</span><span class="op" id="4702094">,</span>&nbsp;<span class="ident" id="4702096">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4702101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702104">io</span><span class="op" id="4702106">.</span><span class="ident" id="4702107">WriteString</span><span class="op" id="4702118">(</span><span class="ident" id="4702119">conn</span><span class="op" id="4702123">,</span>&nbsp;<span class="string" id="4702125">&#34;CONNECT&nbsp;&#34;</span><span class="op" id="4702135">+</span><span class="ident" id="4702136">path</span><span class="op" id="4702140">+</span><span class="string" id="4702141">&#34;&nbsp;HTTP/1.0\n\n&#34;</span><span class="op" id="4702156">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702160">//&nbsp;Require&nbsp;successful&nbsp;HTTP&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702197">//&nbsp;before&nbsp;switching&nbsp;to&nbsp;RPC&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702235">resp</span><span class="op" id="4702239">,</span>&nbsp;<span class="ident" id="4702241">err</span>&nbsp;<span class="op" id="4702245">:=</span>&nbsp;<span class="ident" id="4702248">http</span><span class="op" id="4702252">.</span><span class="ident" id="4702253">ReadResponse</span><span class="op" id="4702265">(</span><span class="ident" id="4702266">bufio</span><span class="op" id="4702271">.</span><span class="ident" id="4702272">NewReader</span><span class="op" id="4702281">(</span><span class="ident" id="4702282">conn</span><span class="op" id="4702286">)</span><span class="op" id="4702287">,</span>&nbsp;<span class="op" id="4702289">&amp;</span><span class="ident" id="4702290">http</span><span class="op" id="4702294">.</span><span class="ident" id="4702295">Request</span><span class="op" id="4702302">{</span><span class="ident" id="4702303">Method</span><span class="op" id="4702309">:</span>&nbsp;<span class="string" id="4702311">&#34;CONNECT&#34;</span><span class="op" id="4702320">}</span><span class="op" id="4702321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702324">if</span>&nbsp;<span class="ident" id="4702327">err</span>&nbsp;<span class="op" id="4702331">==</span>&nbsp;<span class="ident" id="4702334">nil</span>&nbsp;<span class="op" id="4702338">&amp;&amp;</span>&nbsp;<span class="ident" id="4702341">resp</span><span class="op" id="4702345">.</span><span class="ident" id="4702346">Status</span>&nbsp;<span class="op" id="4702353">==</span>&nbsp;<span class="ident" id="4702356">connected</span>&nbsp;<span class="op" id="4702366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702370">return</span>&nbsp;<span class="ident" id="4702377">NewClient</span><span class="op" id="4702386">(</span><span class="ident" id="4702387">conn</span><span class="op" id="4702391">)</span><span class="op" id="4702392">,</span>&nbsp;<span class="ident" id="4702394">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4702399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702402">if</span>&nbsp;<span class="ident" id="4702405">err</span>&nbsp;<span class="op" id="4702409">==</span>&nbsp;<span class="ident" id="4702412">nil</span>&nbsp;<span class="op" id="4702416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702420">err</span>&nbsp;<span class="op" id="4702424">=</span>&nbsp;<span class="ident" id="4702426">errors</span><span class="op" id="4702432">.</span><span class="ident" id="4702433">New</span><span class="op" id="4702436">(</span><span class="string" id="4702437">&#34;unexpected&nbsp;HTTP&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="4702466">+</span>&nbsp;<span class="ident" id="4702468">resp</span><span class="op" id="4702472">.</span><span class="ident" id="4702473">Status</span><span class="op" id="4702479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4702482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702485">conn</span><span class="op" id="4702489">.</span><span class="ident" id="4702490">Close</span><span class="op" id="4702495">(</span><span class="op" id="4702496">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702499">return</span>&nbsp;<span class="ident" id="4702506">nil</span><span class="op" id="4702509">,</span>&nbsp;<span class="op" id="4702511">&amp;</span><span class="ident" id="4702512">net</span><span class="op" id="4702515">.</span><span class="ident" id="4702516">OpError</span><span class="op" id="4702523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702527">Op</span><span class="op" id="4702529">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="4702533">&#34;dial-http&#34;</span><span class="op" id="4702544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702548">Net</span><span class="op" id="4702551">:</span>&nbsp;&nbsp;<span class="ident" id="4702554">network</span>&nbsp;<span class="op" id="4702562">+</span>&nbsp;<span class="string" id="4702564">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="4702568">+</span>&nbsp;<span class="ident" id="4702570">address</span><span class="op" id="4702577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702581">Addr</span><span class="op" id="4702585">:</span>&nbsp;<span class="ident" id="4702587">nil</span><span class="op" id="4702590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702594">Err</span><span class="op" id="4702597">:</span>&nbsp;&nbsp;<span class="ident" id="4702600">err</span><span class="op" id="4702603">,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4702606">}</span><br>
<span class="lineno"></span><span class="op" id="4702608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4702611">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;an&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="4702679">func</span>&nbsp;<span class="ident" id="4702684">Dial</span><span class="op" id="4702688">(</span><span class="ident" id="4702689">network</span><span class="op" id="4702696">,</span>&nbsp;<span class="ident" id="4702698">address</span>&nbsp;<span class="builtintype" id="4702706">string</span><span class="op" id="4702712">)</span>&nbsp;<span class="op" id="4702714">(</span><span class="op" id="4702715">*</span><span class="ident" id="4702716">Client</span><span class="op" id="4702722">,</span>&nbsp;<span class="builtintype" id="4702724">error</span><span class="op" id="4702729">)</span>&nbsp;<span class="op" id="4702731">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702734">conn</span><span class="op" id="4702738">,</span>&nbsp;<span class="ident" id="4702740">err</span>&nbsp;<span class="op" id="4702744">:=</span>&nbsp;<span class="ident" id="4702747">net</span><span class="op" id="4702750">.</span><span class="ident" id="4702751">Dial</span><span class="op" id="4702755">(</span><span class="ident" id="4702756">network</span><span class="op" id="4702763">,</span>&nbsp;<span class="ident" id="4702765">address</span><span class="op" id="4702772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702775">if</span>&nbsp;<span class="ident" id="4702778">err</span>&nbsp;<span class="op" id="4702782">!=</span>&nbsp;<span class="ident" id="4702785">nil</span>&nbsp;<span class="op" id="4702789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702793">return</span>&nbsp;<span class="ident" id="4702800">nil</span><span class="op" id="4702803">,</span>&nbsp;<span class="ident" id="4702805">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4702810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702813">return</span>&nbsp;<span class="ident" id="4702820">NewClient</span><span class="op" id="4702829">(</span><span class="ident" id="4702830">conn</span><span class="op" id="4702834">)</span><span class="op" id="4702835">,</span>&nbsp;<span class="ident" id="4702837">nil</span><br>
<span class="lineno">275</span><span class="op" id="4702841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4702844">func</span>&nbsp;<span class="op" id="4702849">(</span><span class="ident" id="4702850">client</span>&nbsp;<span class="op" id="4702857">*</span><span class="ident" id="4702858">Client</span><span class="op" id="4702864">)</span>&nbsp;<span class="ident" id="4702866">Close</span><span class="op" id="4702871">(</span><span class="op" id="4702872">)</span>&nbsp;<span class="builtintype" id="4702874">error</span>&nbsp;<span class="op" id="4702880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702883">client</span><span class="op" id="4702889">.</span><span class="ident" id="4702890">mutex</span><span class="op" id="4702895">.</span><span class="ident" id="4702896">Lock</span><span class="op" id="4702900">(</span><span class="op" id="4702901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702904">if</span>&nbsp;<span class="ident" id="4702907">client</span><span class="op" id="4702913">.</span><span class="ident" id="4702914">closing</span>&nbsp;<span class="op" id="4702922">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702926">client</span><span class="op" id="4702932">.</span><span class="ident" id="4702933">mutex</span><span class="op" id="4702938">.</span><span class="ident" id="4702939">Unlock</span><span class="op" id="4702945">(</span><span class="op" id="4702946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4702950">return</span>&nbsp;<span class="ident" id="4702957">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4702970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702973">client</span><span class="op" id="4702979">.</span><span class="ident" id="4702980">closing</span>&nbsp;<span class="op" id="4702988">=</span>&nbsp;<span class="builtintype" id="4702990">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702996">client</span><span class="op" id="4703002">.</span><span class="ident" id="4703003">mutex</span><span class="op" id="4703008">.</span><span class="ident" id="4703009">Unlock</span><span class="op" id="4703015">(</span><span class="op" id="4703016">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703019">return</span>&nbsp;<span class="ident" id="4703026">client</span><span class="op" id="4703032">.</span><span class="ident" id="4703033">codec</span><span class="op" id="4703038">.</span><span class="ident" id="4703039">Close</span><span class="op" id="4703044">(</span><span class="op" id="4703045">)</span><br>
<span class="lineno"></span><span class="op" id="4703047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4703050">//&nbsp;Go&nbsp;invokes&nbsp;the&nbsp;function&nbsp;asynchronously.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;Call&nbsp;structure&nbsp;representing</span><br>
<span class="lineno"></span><span class="comment" id="4703137">//&nbsp;the&nbsp;invocation.&nbsp;&nbsp;The&nbsp;done&nbsp;channel&nbsp;will&nbsp;signal&nbsp;when&nbsp;the&nbsp;call&nbsp;is&nbsp;complete&nbsp;by&nbsp;returning</span><br>
<span class="lineno">290</span><span class="comment" id="4703225">//&nbsp;the&nbsp;same&nbsp;Call&nbsp;object.&nbsp;&nbsp;If&nbsp;done&nbsp;is&nbsp;nil,&nbsp;Go&nbsp;will&nbsp;allocate&nbsp;a&nbsp;new&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="4703299">//&nbsp;If&nbsp;non-nil,&nbsp;done&nbsp;must&nbsp;be&nbsp;buffered&nbsp;or&nbsp;Go&nbsp;will&nbsp;deliberately&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="4703367">func</span>&nbsp;<span class="op" id="4703372">(</span><span class="ident" id="4703373">client</span>&nbsp;<span class="op" id="4703380">*</span><span class="ident" id="4703381">Client</span><span class="op" id="4703387">)</span>&nbsp;<span class="ident" id="4703389">Go</span><span class="op" id="4703391">(</span><span class="ident" id="4703392">serviceMethod</span>&nbsp;<span class="builtintype" id="4703406">string</span><span class="op" id="4703412">,</span>&nbsp;<span class="ident" id="4703414">args</span>&nbsp;<span class="keyword" id="4703419">interface</span><span class="op" id="4703428">{</span><span class="op" id="4703429">}</span><span class="op" id="4703430">,</span>&nbsp;<span class="ident" id="4703432">reply</span>&nbsp;<span class="keyword" id="4703438">interface</span><span class="op" id="4703447">{</span><span class="op" id="4703448">}</span><span class="op" id="4703449">,</span>&nbsp;<span class="ident" id="4703451">done</span>&nbsp;<span class="keyword" id="4703456">chan</span>&nbsp;<span class="op" id="4703461">*</span><span class="ident" id="4703462">Call</span><span class="op" id="4703466">)</span>&nbsp;<span class="op" id="4703468">*</span><span class="ident" id="4703469">Call</span>&nbsp;<span class="op" id="4703474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703477">call</span>&nbsp;<span class="op" id="4703482">:=</span>&nbsp;<span class="builtinfunc" id="4703485">new</span><span class="op" id="4703488">(</span><span class="ident" id="4703489">Call</span><span class="op" id="4703493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703496">call</span><span class="op" id="4703500">.</span><span class="ident" id="4703501">ServiceMethod</span>&nbsp;<span class="op" id="4703515">=</span>&nbsp;<span class="ident" id="4703517">serviceMethod</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703532">call</span><span class="op" id="4703536">.</span><span class="ident" id="4703537">Args</span>&nbsp;<span class="op" id="4703542">=</span>&nbsp;<span class="ident" id="4703544">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703550">call</span><span class="op" id="4703554">.</span><span class="ident" id="4703555">Reply</span>&nbsp;<span class="op" id="4703561">=</span>&nbsp;<span class="ident" id="4703563">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703570">if</span>&nbsp;<span class="ident" id="4703573">done</span>&nbsp;<span class="op" id="4703578">==</span>&nbsp;<span class="ident" id="4703581">nil</span>&nbsp;<span class="op" id="4703585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703589">done</span>&nbsp;<span class="op" id="4703594">=</span>&nbsp;<span class="builtinfunc" id="4703596">make</span><span class="op" id="4703600">(</span><span class="keyword" id="4703601">chan</span>&nbsp;<span class="op" id="4703606">*</span><span class="ident" id="4703607">Call</span><span class="op" id="4703611">,</span>&nbsp;<span class="num" id="4703613">10</span><span class="op" id="4703615">)</span>&nbsp;<span class="comment" id="4703617">//&nbsp;buffered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703631">}</span>&nbsp;<span class="keyword" id="4703633">else</span>&nbsp;<span class="op" id="4703638">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4703642">//&nbsp;If&nbsp;caller&nbsp;passes&nbsp;done&nbsp;!=&nbsp;nil,&nbsp;it&nbsp;must&nbsp;arrange&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4703698">//&nbsp;done&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;for&nbsp;the&nbsp;number&nbsp;of&nbsp;simultaneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4703757">//&nbsp;RPCs&nbsp;that&nbsp;will&nbsp;be&nbsp;using&nbsp;that&nbsp;channel.&nbsp;&nbsp;If&nbsp;the&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4703816">//&nbsp;is&nbsp;totally&nbsp;unbuffered,&nbsp;it&#39;s&nbsp;best&nbsp;not&nbsp;to&nbsp;run&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703873">if</span>&nbsp;<span class="builtinfunc" id="4703876">cap</span><span class="op" id="4703879">(</span><span class="ident" id="4703880">done</span><span class="op" id="4703884">)</span>&nbsp;<span class="op" id="4703886">==</span>&nbsp;<span class="num" id="4703889">0</span>&nbsp;<span class="op" id="4703891">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703896">log</span><span class="op" id="4703899">.</span><span class="ident" id="4703900">Panic</span><span class="op" id="4703905">(</span><span class="string" id="4703906">&#34;rpc:&nbsp;done&nbsp;channel&nbsp;is&nbsp;unbuffered&#34;</span><span class="op" id="4703939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703949">call</span><span class="op" id="4703953">.</span><span class="ident" id="4703954">Done</span>&nbsp;<span class="op" id="4703959">=</span>&nbsp;<span class="ident" id="4703961">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703967">client</span><span class="op" id="4703973">.</span><span class="ident" id="4703974">send</span><span class="op" id="4703978">(</span><span class="ident" id="4703979">call</span><span class="op" id="4703983">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703986">return</span>&nbsp;<span class="ident" id="4703993">call</span><br>
<span class="lineno"></span><span class="op" id="4703998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4704001">//&nbsp;Call&nbsp;invokes&nbsp;the&nbsp;named&nbsp;function,&nbsp;waits&nbsp;for&nbsp;it&nbsp;to&nbsp;complete,&nbsp;and&nbsp;returns&nbsp;its&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span><span class="keyword" id="4704093">func</span>&nbsp;<span class="op" id="4704098">(</span><span class="ident" id="4704099">client</span>&nbsp;<span class="op" id="4704106">*</span><span class="ident" id="4704107">Client</span><span class="op" id="4704113">)</span>&nbsp;<span class="ident" id="4704115">Call</span><span class="op" id="4704119">(</span><span class="ident" id="4704120">serviceMethod</span>&nbsp;<span class="builtintype" id="4704134">string</span><span class="op" id="4704140">,</span>&nbsp;<span class="ident" id="4704142">args</span>&nbsp;<span class="keyword" id="4704147">interface</span><span class="op" id="4704156">{</span><span class="op" id="4704157">}</span><span class="op" id="4704158">,</span>&nbsp;<span class="ident" id="4704160">reply</span>&nbsp;<span class="keyword" id="4704166">interface</span><span class="op" id="4704175">{</span><span class="op" id="4704176">}</span><span class="op" id="4704177">)</span>&nbsp;<span class="builtintype" id="4704179">error</span>&nbsp;<span class="op" id="4704185">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704188">call</span>&nbsp;<span class="op" id="4704193">:=</span>&nbsp;<span class="op" id="4704196">&lt;-</span><span class="ident" id="4704198">client</span><span class="op" id="4704204">.</span><span class="ident" id="4704205">Go</span><span class="op" id="4704207">(</span><span class="ident" id="4704208">serviceMethod</span><span class="op" id="4704221">,</span>&nbsp;<span class="ident" id="4704223">args</span><span class="op" id="4704227">,</span>&nbsp;<span class="ident" id="4704229">reply</span><span class="op" id="4704234">,</span>&nbsp;<span class="builtinfunc" id="4704236">make</span><span class="op" id="4704240">(</span><span class="keyword" id="4704241">chan</span>&nbsp;<span class="op" id="4704246">*</span><span class="ident" id="4704247">Call</span><span class="op" id="4704251">,</span>&nbsp;<span class="num" id="4704253">1</span><span class="op" id="4704254">)</span><span class="op" id="4704255">)</span><span class="op" id="4704256">.</span><span class="ident" id="4704257">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704263">return</span>&nbsp;<span class="ident" id="4704270">call</span><span class="op" id="4704274">.</span><span class="ident" id="4704275">Error</span><br>
<span class="lineno"></span><span class="op" id="4704281">}</span>
</div>
</body>
</html>
