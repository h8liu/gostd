<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1329532">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1329587">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1329641">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1329692">//&nbsp;Package&nbsp;tar&nbsp;implements&nbsp;access&nbsp;to&nbsp;tar&nbsp;archives.</span><br>
<span class="lineno"></span><span class="comment" id="1329742">//&nbsp;It&nbsp;aims&nbsp;to&nbsp;cover&nbsp;most&nbsp;of&nbsp;the&nbsp;variations,&nbsp;including&nbsp;those&nbsp;produced</span><br>
<span class="lineno"></span><span class="comment" id="1329811">//&nbsp;by&nbsp;GNU&nbsp;and&nbsp;BSD&nbsp;tars.</span><br>
<span class="lineno"></span><span class="comment" id="1329835">//</span><br>
<span class="lineno"></span><span class="comment" id="1329838">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="1329853">//&nbsp;&nbsp;&nbsp;http://www.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=5</span><br>
<span class="lineno"></span><span class="comment" id="1329913">//&nbsp;&nbsp;&nbsp;http://www.gnu.org/software/tar/manual/html_node/Standard.html</span><br>
<span class="lineno"></span><span class="comment" id="1329981">//&nbsp;&nbsp;&nbsp;http://pubs.opengroup.org/onlinepubs/9699919799/utilities/pax.html</span><br>
<span class="lineno"></span><span class="keyword" id="1330053">package</span>&nbsp;<span class="ident" id="1330061">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="1330066">import</span>&nbsp;<span class="op" id="1330073">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1330076">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1330085">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1330095">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1330102">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1330108">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1330116">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="1330123">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1330126">const</span>&nbsp;<span class="op" id="1330132">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330135">blockSize</span>&nbsp;<span class="op" id="1330145">=</span>&nbsp;<span class="num" id="1330147">512</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330153">//&nbsp;Types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330163">TypeReg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1330181">=</span>&nbsp;<span class="string" id="1330183">&#39;0&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330190">//&nbsp;regular&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330207">TypeRegA</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1330225">=</span>&nbsp;<span class="string" id="1330227">&#39;\x00&#39;</span>&nbsp;<span class="comment" id="1330234">//&nbsp;regular&nbsp;file</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330251">TypeLink</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1330269">=</span>&nbsp;<span class="string" id="1330271">&#39;1&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330278">//&nbsp;hard&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330292">TypeSymlink</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1330310">=</span>&nbsp;<span class="string" id="1330312">&#39;2&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330319">//&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330337">TypeChar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1330355">=</span>&nbsp;<span class="string" id="1330357">&#39;3&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330364">//&nbsp;character&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330390">TypeBlock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1330408">=</span>&nbsp;<span class="string" id="1330410">&#39;4&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330417">//&nbsp;block&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330439">TypeDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1330457">=</span>&nbsp;<span class="string" id="1330459">&#39;5&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330466">//&nbsp;directory</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330480">TypeFifo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1330498">=</span>&nbsp;<span class="string" id="1330500">&#39;6&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330507">//&nbsp;fifo&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330521">TypeCont</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1330539">=</span>&nbsp;<span class="string" id="1330541">&#39;7&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330548">//&nbsp;reserved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330561">TypeXHeader</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1330579">=</span>&nbsp;<span class="string" id="1330581">&#39;x&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330588">//&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330608">TypeXGlobalHeader</span>&nbsp;<span class="op" id="1330626">=</span>&nbsp;<span class="string" id="1330628">&#39;g&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330635">//&nbsp;global&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330662">TypeGNULongName</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1330680">=</span>&nbsp;<span class="string" id="1330682">&#39;L&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330689">//&nbsp;Next&nbsp;file&nbsp;has&nbsp;a&nbsp;long&nbsp;name</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330719">TypeGNULongLink</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1330737">=</span>&nbsp;<span class="string" id="1330739">&#39;K&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330746">//&nbsp;Next&nbsp;file&nbsp;symlinks&nbsp;to&nbsp;a&nbsp;file&nbsp;w/&nbsp;a&nbsp;long&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330794">TypeGNUSparse</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1330812">=</span>&nbsp;<span class="string" id="1330814">&#39;S&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330821">//&nbsp;sparse&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="1330836">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1330839">//&nbsp;A&nbsp;Header&nbsp;represents&nbsp;a&nbsp;single&nbsp;header&nbsp;in&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno">45</span><span class="comment" id="1330896">//&nbsp;Some&nbsp;fields&nbsp;may&nbsp;not&nbsp;be&nbsp;populated.</span><br>
<span class="lineno"></span><span class="keyword" id="1330933">type</span>&nbsp;<span class="ident" id="1330938">Header</span>&nbsp;<span class="keyword" id="1330945">struct</span>&nbsp;<span class="op" id="1330952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330955">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1330966">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1330976">//&nbsp;name&nbsp;of&nbsp;header&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331006">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331017">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1331027">//&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331056">Uid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1331067">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1331077">//&nbsp;user&nbsp;id&nbsp;of&nbsp;owner</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331098">Gid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1331109">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1331119">//&nbsp;group&nbsp;id&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331141">Size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331152">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1331162">//&nbsp;length&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331182">ModTime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1331193">time</span><span class="op" id="1331197">.</span><span class="ident" id="1331198">Time</span>&nbsp;<span class="comment" id="1331203">//&nbsp;modified&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331221">Typeflag</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1331232">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1331242">//&nbsp;type&nbsp;of&nbsp;header&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331267">Linkname</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1331278">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1331288">//&nbsp;target&nbsp;name&nbsp;of&nbsp;link</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331312">Uname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1331323">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1331333">//&nbsp;user&nbsp;name&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331356">Gname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1331367">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1331377">//&nbsp;group&nbsp;name&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331401">Devmajor</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1331412">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1331422">//&nbsp;major&nbsp;number&nbsp;of&nbsp;character&nbsp;or&nbsp;block&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331468">Devminor</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1331479">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1331489">//&nbsp;minor&nbsp;number&nbsp;of&nbsp;character&nbsp;or&nbsp;block&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331535">AccessTime</span>&nbsp;<span class="ident" id="1331546">time</span><span class="op" id="1331550">.</span><span class="ident" id="1331551">Time</span>&nbsp;<span class="comment" id="1331556">//&nbsp;access&nbsp;time</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331572">ChangeTime</span>&nbsp;<span class="ident" id="1331583">time</span><span class="op" id="1331587">.</span><span class="ident" id="1331588">Time</span>&nbsp;<span class="comment" id="1331593">//&nbsp;status&nbsp;change&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331616">Xattrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1331627">map</span><span class="op" id="1331630">[</span><span class="builtintype" id="1331631">string</span><span class="op" id="1331637">]</span><span class="builtintype" id="1331638">string</span><br>
<span class="lineno"></span><span class="op" id="1331645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1331648">//&nbsp;File&nbsp;name&nbsp;constants&nbsp;from&nbsp;the&nbsp;tar&nbsp;spec.</span><br>
<span class="lineno">65</span><span class="keyword" id="1331690">const</span>&nbsp;<span class="op" id="1331696">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331699">fileNameSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1331718">=</span>&nbsp;<span class="num" id="1331720">100</span>&nbsp;<span class="comment" id="1331724">//&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;a&nbsp;standard&nbsp;tar&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331776">fileNamePrefixSize</span>&nbsp;<span class="op" id="1331795">=</span>&nbsp;<span class="num" id="1331797">155</span>&nbsp;<span class="comment" id="1331801">//&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;ustar&nbsp;extension&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="op" id="1331845">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="1331848">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;Header.</span><br>
<span class="lineno"></span><span class="keyword" id="1331899">func</span>&nbsp;<span class="op" id="1331904">(</span><span class="ident" id="1331905">h</span>&nbsp;<span class="op" id="1331907">*</span><span class="ident" id="1331908">Header</span><span class="op" id="1331914">)</span>&nbsp;<span class="ident" id="1331916">FileInfo</span><span class="op" id="1331924">(</span><span class="op" id="1331925">)</span>&nbsp;<span class="ident" id="1331927">os</span><span class="op" id="1331929">.</span><span class="ident" id="1331930">FileInfo</span>&nbsp;<span class="op" id="1331939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331942">return</span>&nbsp;<span class="ident" id="1331949">headerFileInfo</span><span class="op" id="1331963">{</span><span class="ident" id="1331964">h</span><span class="op" id="1331965">}</span><br>
<span class="lineno"></span><span class="op" id="1331967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="1331970">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="1332012">type</span>&nbsp;<span class="ident" id="1332017">headerFileInfo</span>&nbsp;<span class="keyword" id="1332032">struct</span>&nbsp;<span class="op" id="1332039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332042">h</span>&nbsp;<span class="op" id="1332044">*</span><span class="ident" id="1332045">Header</span><br>
<span class="lineno"></span><span class="op" id="1332052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="1332055">func</span>&nbsp;<span class="op" id="1332060">(</span><span class="ident" id="1332061">fi</span>&nbsp;<span class="ident" id="1332064">headerFileInfo</span><span class="op" id="1332078">)</span>&nbsp;<span class="ident" id="1332080">Size</span><span class="op" id="1332084">(</span><span class="op" id="1332085">)</span>&nbsp;<span class="ident" id="1332087">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1332100">{</span>&nbsp;<span class="keyword" id="1332102">return</span>&nbsp;<span class="ident" id="1332109">fi</span><span class="op" id="1332111">.</span><span class="ident" id="1332112">h</span><span class="op" id="1332113">.</span><span class="ident" id="1332114">Size</span>&nbsp;<span class="op" id="1332119">}</span><br>
<span class="lineno"></span><span class="keyword" id="1332121">func</span>&nbsp;<span class="op" id="1332126">(</span><span class="ident" id="1332127">fi</span>&nbsp;<span class="ident" id="1332130">headerFileInfo</span><span class="op" id="1332144">)</span>&nbsp;<span class="ident" id="1332146">IsDir</span><span class="op" id="1332151">(</span><span class="op" id="1332152">)</span>&nbsp;<span class="builtintype" id="1332154">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1332166">{</span>&nbsp;<span class="keyword" id="1332168">return</span>&nbsp;<span class="ident" id="1332175">fi</span><span class="op" id="1332177">.</span><span class="ident" id="1332178">Mode</span><span class="op" id="1332182">(</span><span class="op" id="1332183">)</span><span class="op" id="1332184">.</span><span class="ident" id="1332185">IsDir</span><span class="op" id="1332190">(</span><span class="op" id="1332191">)</span>&nbsp;<span class="op" id="1332193">}</span><br>
<span class="lineno"></span><span class="keyword" id="1332195">func</span>&nbsp;<span class="op" id="1332200">(</span><span class="ident" id="1332201">fi</span>&nbsp;<span class="ident" id="1332204">headerFileInfo</span><span class="op" id="1332218">)</span>&nbsp;<span class="ident" id="1332220">ModTime</span><span class="op" id="1332227">(</span><span class="op" id="1332228">)</span>&nbsp;<span class="ident" id="1332230">time</span><span class="op" id="1332234">.</span><span class="ident" id="1332235">Time</span>&nbsp;<span class="op" id="1332240">{</span>&nbsp;<span class="keyword" id="1332242">return</span>&nbsp;<span class="ident" id="1332249">fi</span><span class="op" id="1332251">.</span><span class="ident" id="1332252">h</span><span class="op" id="1332253">.</span><span class="ident" id="1332254">ModTime</span>&nbsp;<span class="op" id="1332262">}</span><br>
<span class="lineno"></span><span class="keyword" id="1332264">func</span>&nbsp;<span class="op" id="1332269">(</span><span class="ident" id="1332270">fi</span>&nbsp;<span class="ident" id="1332273">headerFileInfo</span><span class="op" id="1332287">)</span>&nbsp;<span class="ident" id="1332289">Sys</span><span class="op" id="1332292">(</span><span class="op" id="1332293">)</span>&nbsp;<span class="keyword" id="1332295">interface</span><span class="op" id="1332304">{</span><span class="op" id="1332305">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1332309">{</span>&nbsp;<span class="keyword" id="1332311">return</span>&nbsp;<span class="ident" id="1332318">fi</span><span class="op" id="1332320">.</span><span class="ident" id="1332321">h</span>&nbsp;<span class="op" id="1332323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1332326">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;base&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="1332369">func</span>&nbsp;<span class="op" id="1332374">(</span><span class="ident" id="1332375">fi</span>&nbsp;<span class="ident" id="1332378">headerFileInfo</span><span class="op" id="1332392">)</span>&nbsp;<span class="ident" id="1332394">Name</span><span class="op" id="1332398">(</span><span class="op" id="1332399">)</span>&nbsp;<span class="builtintype" id="1332401">string</span>&nbsp;<span class="op" id="1332408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332411">if</span>&nbsp;<span class="ident" id="1332414">fi</span><span class="op" id="1332416">.</span><span class="ident" id="1332417">IsDir</span><span class="op" id="1332422">(</span><span class="op" id="1332423">)</span>&nbsp;<span class="op" id="1332425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332429">return</span>&nbsp;<span class="ident" id="1332436">path</span><span class="op" id="1332440">.</span><span class="ident" id="1332441">Base</span><span class="op" id="1332445">(</span><span class="ident" id="1332446">path</span><span class="op" id="1332450">.</span><span class="ident" id="1332451">Clean</span><span class="op" id="1332456">(</span><span class="ident" id="1332457">fi</span><span class="op" id="1332459">.</span><span class="ident" id="1332460">h</span><span class="op" id="1332461">.</span><span class="ident" id="1332462">Name</span><span class="op" id="1332466">)</span><span class="op" id="1332467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332470">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332473">return</span>&nbsp;<span class="ident" id="1332480">path</span><span class="op" id="1332484">.</span><span class="ident" id="1332485">Base</span><span class="op" id="1332489">(</span><span class="ident" id="1332490">fi</span><span class="op" id="1332492">.</span><span class="ident" id="1332493">h</span><span class="op" id="1332494">.</span><span class="ident" id="1332495">Name</span><span class="op" id="1332499">)</span><br>
<span class="lineno"></span><span class="op" id="1332501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1332504">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;headerFileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="1332573">func</span>&nbsp;<span class="op" id="1332578">(</span><span class="ident" id="1332579">fi</span>&nbsp;<span class="ident" id="1332582">headerFileInfo</span><span class="op" id="1332596">)</span>&nbsp;<span class="ident" id="1332598">Mode</span><span class="op" id="1332602">(</span><span class="op" id="1332603">)</span>&nbsp;<span class="op" id="1332605">(</span><span class="ident" id="1332606">mode</span>&nbsp;<span class="ident" id="1332611">os</span><span class="op" id="1332613">.</span><span class="ident" id="1332614">FileMode</span><span class="op" id="1332622">)</span>&nbsp;<span class="op" id="1332624">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332627">//&nbsp;Set&nbsp;file&nbsp;permission&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332657">mode</span>&nbsp;<span class="op" id="1332662">=</span>&nbsp;<span class="ident" id="1332664">os</span><span class="op" id="1332666">.</span><span class="ident" id="1332667">FileMode</span><span class="op" id="1332675">(</span><span class="ident" id="1332676">fi</span><span class="op" id="1332678">.</span><span class="ident" id="1332679">h</span><span class="op" id="1332680">.</span><span class="ident" id="1332681">Mode</span><span class="op" id="1332685">)</span><span class="op" id="1332686">.</span><span class="ident" id="1332687">Perm</span><span class="op" id="1332691">(</span><span class="op" id="1332692">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332696">//&nbsp;Set&nbsp;setuid,&nbsp;setgid&nbsp;and&nbsp;sticky&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332736">if</span>&nbsp;<span class="ident" id="1332739">fi</span><span class="op" id="1332741">.</span><span class="ident" id="1332742">h</span><span class="op" id="1332743">.</span><span class="ident" id="1332744">Mode</span><span class="op" id="1332748">&amp;</span><span class="ident" id="1332749">c_ISUID</span>&nbsp;<span class="op" id="1332757">!=</span>&nbsp;<span class="num" id="1332760">0</span>&nbsp;<span class="op" id="1332762">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332766">//&nbsp;setuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332778">mode</span>&nbsp;<span class="op" id="1332783">|=</span>&nbsp;<span class="ident" id="1332786">os</span><span class="op" id="1332788">.</span><span class="ident" id="1332789">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332804">if</span>&nbsp;<span class="ident" id="1332807">fi</span><span class="op" id="1332809">.</span><span class="ident" id="1332810">h</span><span class="op" id="1332811">.</span><span class="ident" id="1332812">Mode</span><span class="op" id="1332816">&amp;</span><span class="ident" id="1332817">c_ISGID</span>&nbsp;<span class="op" id="1332825">!=</span>&nbsp;<span class="num" id="1332828">0</span>&nbsp;<span class="op" id="1332830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332834">//&nbsp;setgid</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332846">mode</span>&nbsp;<span class="op" id="1332851">|=</span>&nbsp;<span class="ident" id="1332854">os</span><span class="op" id="1332856">.</span><span class="ident" id="1332857">ModeSetgid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1332872">if</span>&nbsp;<span class="ident" id="1332875">fi</span><span class="op" id="1332877">.</span><span class="ident" id="1332878">h</span><span class="op" id="1332879">.</span><span class="ident" id="1332880">Mode</span><span class="op" id="1332884">&amp;</span><span class="ident" id="1332885">c_ISVTX</span>&nbsp;<span class="op" id="1332893">!=</span>&nbsp;<span class="num" id="1332896">0</span>&nbsp;<span class="op" id="1332898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332902">//&nbsp;sticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332914">mode</span>&nbsp;<span class="op" id="1332919">|=</span>&nbsp;<span class="ident" id="1332922">os</span><span class="op" id="1332924">.</span><span class="ident" id="1332925">ModeSticky</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1332937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332941">//&nbsp;Set&nbsp;file&nbsp;mode&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332965">//&nbsp;clear&nbsp;perm,&nbsp;setuid,&nbsp;setgid&nbsp;and&nbsp;sticky&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333013">m</span>&nbsp;<span class="op" id="1333015">:=</span>&nbsp;<span class="ident" id="1333018">os</span><span class="op" id="1333020">.</span><span class="ident" id="1333021">FileMode</span><span class="op" id="1333029">(</span><span class="ident" id="1333030">fi</span><span class="op" id="1333032">.</span><span class="ident" id="1333033">h</span><span class="op" id="1333034">.</span><span class="ident" id="1333035">Mode</span><span class="op" id="1333039">)</span>&nbsp;<span class="op" id="1333041">&amp;^</span>&nbsp;<span class="num" id="1333044">07777</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333051">if</span>&nbsp;<span class="ident" id="1333054">m</span>&nbsp;<span class="op" id="1333056">==</span>&nbsp;<span class="ident" id="1333059">c_ISDIR</span>&nbsp;<span class="op" id="1333067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333071">//&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333086">mode</span>&nbsp;<span class="op" id="1333091">|=</span>&nbsp;<span class="ident" id="1333094">os</span><span class="op" id="1333096">.</span><span class="ident" id="1333097">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333109">if</span>&nbsp;<span class="ident" id="1333112">m</span>&nbsp;<span class="op" id="1333114">==</span>&nbsp;<span class="ident" id="1333117">c_ISFIFO</span>&nbsp;<span class="op" id="1333126">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333130">//&nbsp;named&nbsp;pipe&nbsp;(FIFO)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333153">mode</span>&nbsp;<span class="op" id="1333158">|=</span>&nbsp;<span class="ident" id="1333161">os</span><span class="op" id="1333163">.</span><span class="ident" id="1333164">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333182">if</span>&nbsp;<span class="ident" id="1333185">m</span>&nbsp;<span class="op" id="1333187">==</span>&nbsp;<span class="ident" id="1333190">c_ISLNK</span>&nbsp;<span class="op" id="1333198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333202">//&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333221">mode</span>&nbsp;<span class="op" id="1333226">|=</span>&nbsp;<span class="ident" id="1333229">os</span><span class="op" id="1333231">.</span><span class="ident" id="1333232">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333248">if</span>&nbsp;<span class="ident" id="1333251">m</span>&nbsp;<span class="op" id="1333253">==</span>&nbsp;<span class="ident" id="1333256">c_ISBLK</span>&nbsp;<span class="op" id="1333264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333268">//&nbsp;device&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333285">mode</span>&nbsp;<span class="op" id="1333290">|=</span>&nbsp;<span class="ident" id="1333293">os</span><span class="op" id="1333295">.</span><span class="ident" id="1333296">ModeDevice</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333311">if</span>&nbsp;<span class="ident" id="1333314">m</span>&nbsp;<span class="op" id="1333316">==</span>&nbsp;<span class="ident" id="1333319">c_ISCHR</span>&nbsp;<span class="op" id="1333327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333331">//&nbsp;Unix&nbsp;character&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333358">mode</span>&nbsp;<span class="op" id="1333363">|=</span>&nbsp;<span class="ident" id="1333366">os</span><span class="op" id="1333368">.</span><span class="ident" id="1333369">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333382">mode</span>&nbsp;<span class="op" id="1333387">|=</span>&nbsp;<span class="ident" id="1333390">os</span><span class="op" id="1333392">.</span><span class="ident" id="1333393">ModeCharDevice</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333412">if</span>&nbsp;<span class="ident" id="1333415">m</span>&nbsp;<span class="op" id="1333417">==</span>&nbsp;<span class="ident" id="1333420">c_ISSOCK</span>&nbsp;<span class="op" id="1333429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333433">//&nbsp;Unix&nbsp;domain&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333457">mode</span>&nbsp;<span class="op" id="1333462">|=</span>&nbsp;<span class="ident" id="1333465">os</span><span class="op" id="1333467">.</span><span class="ident" id="1333468">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333480">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333484">switch</span>&nbsp;<span class="ident" id="1333491">fi</span><span class="op" id="1333493">.</span><span class="ident" id="1333494">h</span><span class="op" id="1333495">.</span><span class="ident" id="1333496">Typeflag</span>&nbsp;<span class="op" id="1333505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333508">case</span>&nbsp;<span class="ident" id="1333513">TypeLink</span><span class="op" id="1333521">,</span>&nbsp;<span class="ident" id="1333523">TypeSymlink</span><span class="op" id="1333534">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333538">//&nbsp;hard&nbsp;link,&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333568">mode</span>&nbsp;<span class="op" id="1333573">|=</span>&nbsp;<span class="ident" id="1333576">os</span><span class="op" id="1333578">.</span><span class="ident" id="1333579">ModeSymlink</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333592">case</span>&nbsp;<span class="ident" id="1333597">TypeChar</span><span class="op" id="1333605">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333609">//&nbsp;character&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333636">mode</span>&nbsp;<span class="op" id="1333641">|=</span>&nbsp;<span class="ident" id="1333644">os</span><span class="op" id="1333646">.</span><span class="ident" id="1333647">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333660">mode</span>&nbsp;<span class="op" id="1333665">|=</span>&nbsp;<span class="ident" id="1333668">os</span><span class="op" id="1333670">.</span><span class="ident" id="1333671">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333687">case</span>&nbsp;<span class="ident" id="1333692">TypeBlock</span><span class="op" id="1333701">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333705">//&nbsp;block&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333728">mode</span>&nbsp;<span class="op" id="1333733">|=</span>&nbsp;<span class="ident" id="1333736">os</span><span class="op" id="1333738">.</span><span class="ident" id="1333739">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333751">case</span>&nbsp;<span class="ident" id="1333756">TypeDir</span><span class="op" id="1333763">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333767">//&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333782">mode</span>&nbsp;<span class="op" id="1333787">|=</span>&nbsp;<span class="ident" id="1333790">os</span><span class="op" id="1333792">.</span><span class="ident" id="1333793">ModeDir</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333802">case</span>&nbsp;<span class="ident" id="1333807">TypeFifo</span><span class="op" id="1333815">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333819">//&nbsp;fifo&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333834">mode</span>&nbsp;<span class="op" id="1333839">|=</span>&nbsp;<span class="ident" id="1333842">os</span><span class="op" id="1333844">.</span><span class="ident" id="1333845">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333864">return</span>&nbsp;<span class="ident" id="1333871">mode</span><br>
<span class="lineno"></span><span class="op" id="1333876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1333879">//&nbsp;sysStat,&nbsp;if&nbsp;non-nil,&nbsp;populates&nbsp;h&nbsp;from&nbsp;system-dependent&nbsp;fields&nbsp;of&nbsp;fi.</span><br>
<span class="lineno"></span><span class="keyword" id="1333951">var</span>&nbsp;<span class="ident" id="1333955">sysStat</span>&nbsp;<span class="keyword" id="1333963">func</span><span class="op" id="1333967">(</span><span class="ident" id="1333968">fi</span>&nbsp;<span class="ident" id="1333971">os</span><span class="op" id="1333973">.</span><span class="ident" id="1333974">FileInfo</span><span class="op" id="1333982">,</span>&nbsp;<span class="ident" id="1333984">h</span>&nbsp;<span class="op" id="1333986">*</span><span class="ident" id="1333987">Header</span><span class="op" id="1333993">)</span>&nbsp;<span class="builtintype" id="1333995">error</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="1334002">//&nbsp;Mode&nbsp;constants&nbsp;from&nbsp;the&nbsp;tar&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="1334039">const</span>&nbsp;<span class="op" id="1334045">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334048">c_ISUID</span>&nbsp;&nbsp;<span class="op" id="1334057">=</span>&nbsp;<span class="num" id="1334059">04000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1334067">//&nbsp;Set&nbsp;uid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334079">c_ISGID</span>&nbsp;&nbsp;<span class="op" id="1334088">=</span>&nbsp;<span class="num" id="1334090">02000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1334098">//&nbsp;Set&nbsp;gid</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334110">c_ISVTX</span>&nbsp;&nbsp;<span class="op" id="1334119">=</span>&nbsp;<span class="num" id="1334121">01000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1334129">//&nbsp;Save&nbsp;text&nbsp;(sticky&nbsp;bit)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334156">c_ISDIR</span>&nbsp;&nbsp;<span class="op" id="1334165">=</span>&nbsp;<span class="num" id="1334167">040000</span>&nbsp;&nbsp;<span class="comment" id="1334175">//&nbsp;Directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334189">c_ISFIFO</span>&nbsp;<span class="op" id="1334198">=</span>&nbsp;<span class="num" id="1334200">010000</span>&nbsp;&nbsp;<span class="comment" id="1334208">//&nbsp;FIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334217">c_ISREG</span>&nbsp;&nbsp;<span class="op" id="1334226">=</span>&nbsp;<span class="num" id="1334228">0100000</span>&nbsp;<span class="comment" id="1334236">//&nbsp;Regular&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334253">c_ISLNK</span>&nbsp;&nbsp;<span class="op" id="1334262">=</span>&nbsp;<span class="num" id="1334264">0120000</span>&nbsp;<span class="comment" id="1334272">//&nbsp;Symbolic&nbsp;link</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334290">c_ISBLK</span>&nbsp;&nbsp;<span class="op" id="1334299">=</span>&nbsp;<span class="num" id="1334301">060000</span>&nbsp;&nbsp;<span class="comment" id="1334309">//&nbsp;Block&nbsp;special&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334332">c_ISCHR</span>&nbsp;&nbsp;<span class="op" id="1334341">=</span>&nbsp;<span class="num" id="1334343">020000</span>&nbsp;&nbsp;<span class="comment" id="1334351">//&nbsp;Character&nbsp;special&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334378">c_ISSOCK</span>&nbsp;<span class="op" id="1334387">=</span>&nbsp;<span class="num" id="1334389">0140000</span>&nbsp;<span class="comment" id="1334397">//&nbsp;Socket</span><br>
<span class="lineno"></span><span class="op" id="1334407">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="1334410">//&nbsp;Keywords&nbsp;for&nbsp;the&nbsp;PAX&nbsp;Extended&nbsp;Header</span><br>
<span class="lineno"></span><span class="keyword" id="1334450">const</span>&nbsp;<span class="op" id="1334456">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334459">paxAtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334471">=</span>&nbsp;<span class="string" id="1334473">&#34;atime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334482">paxCharset</span>&nbsp;&nbsp;<span class="op" id="1334494">=</span>&nbsp;<span class="string" id="1334496">&#34;charset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334507">paxComment</span>&nbsp;&nbsp;<span class="op" id="1334519">=</span>&nbsp;<span class="string" id="1334521">&#34;comment&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334532">paxCtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334544">=</span>&nbsp;<span class="string" id="1334546">&#34;ctime&#34;</span>&nbsp;<span class="comment" id="1334554">//&nbsp;please&nbsp;note&nbsp;that&nbsp;ctime&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;pax&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334608">paxGid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334620">=</span>&nbsp;<span class="string" id="1334622">&#34;gid&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334629">paxGname</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334641">=</span>&nbsp;<span class="string" id="1334643">&#34;gname&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334652">paxLinkpath</span>&nbsp;<span class="op" id="1334664">=</span>&nbsp;<span class="string" id="1334666">&#34;linkpath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334678">paxMtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334690">=</span>&nbsp;<span class="string" id="1334692">&#34;mtime&#34;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334701">paxPath</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334713">=</span>&nbsp;<span class="string" id="1334715">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334723">paxSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334735">=</span>&nbsp;<span class="string" id="1334737">&#34;size&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334745">paxUid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334757">=</span>&nbsp;<span class="string" id="1334759">&#34;uid&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334766">paxUname</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334778">=</span>&nbsp;<span class="string" id="1334780">&#34;uname&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334789">paxXattr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334801">=</span>&nbsp;<span class="string" id="1334803">&#34;SCHILY.xattr.&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334820">paxNone</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1334832">=</span>&nbsp;<span class="string" id="1334834">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="1334837">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1334840">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;Header&nbsp;from&nbsp;fi.</span><br>
<span class="lineno"></span><span class="comment" id="1334904">//&nbsp;If&nbsp;fi&nbsp;describes&nbsp;a&nbsp;symlink,&nbsp;FileInfoHeader&nbsp;records&nbsp;link&nbsp;as&nbsp;the&nbsp;link&nbsp;target.</span><br>
<span class="lineno">200</span><span class="comment" id="1334982">//&nbsp;If&nbsp;fi&nbsp;describes&nbsp;a&nbsp;directory,&nbsp;a&nbsp;slash&nbsp;is&nbsp;appended&nbsp;to&nbsp;the&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="1335047">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1335114">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="1335185">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="1335254">func</span>&nbsp;<span class="ident" id="1335259">FileInfoHeader</span><span class="op" id="1335273">(</span><span class="ident" id="1335274">fi</span>&nbsp;<span class="ident" id="1335277">os</span><span class="op" id="1335279">.</span><span class="ident" id="1335280">FileInfo</span><span class="op" id="1335288">,</span>&nbsp;<span class="ident" id="1335290">link</span>&nbsp;<span class="builtintype" id="1335295">string</span><span class="op" id="1335301">)</span>&nbsp;<span class="op" id="1335303">(</span><span class="op" id="1335304">*</span><span class="ident" id="1335305">Header</span><span class="op" id="1335311">,</span>&nbsp;<span class="builtintype" id="1335313">error</span><span class="op" id="1335318">)</span>&nbsp;<span class="op" id="1335320">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335323">if</span>&nbsp;<span class="ident" id="1335326">fi</span>&nbsp;<span class="op" id="1335329">==</span>&nbsp;<span class="ident" id="1335332">nil</span>&nbsp;<span class="op" id="1335336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335340">return</span>&nbsp;<span class="ident" id="1335347">nil</span><span class="op" id="1335350">,</span>&nbsp;<span class="ident" id="1335352">errors</span><span class="op" id="1335358">.</span><span class="ident" id="1335359">New</span><span class="op" id="1335362">(</span><span class="string" id="1335363">&#34;tar:&nbsp;FileInfo&nbsp;is&nbsp;nil&#34;</span><span class="op" id="1335385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335391">fm</span>&nbsp;<span class="op" id="1335394">:=</span>&nbsp;<span class="ident" id="1335397">fi</span><span class="op" id="1335399">.</span><span class="ident" id="1335400">Mode</span><span class="op" id="1335404">(</span><span class="op" id="1335405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335408">h</span>&nbsp;<span class="op" id="1335410">:=</span>&nbsp;<span class="op" id="1335413">&amp;</span><span class="ident" id="1335414">Header</span><span class="op" id="1335420">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335424">Name</span><span class="op" id="1335428">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335433">fi</span><span class="op" id="1335435">.</span><span class="ident" id="1335436">Name</span><span class="op" id="1335440">(</span><span class="op" id="1335441">)</span><span class="op" id="1335442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335446">ModTime</span><span class="op" id="1335453">:</span>&nbsp;<span class="ident" id="1335455">fi</span><span class="op" id="1335457">.</span><span class="ident" id="1335458">ModTime</span><span class="op" id="1335465">(</span><span class="op" id="1335466">)</span><span class="op" id="1335467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335471">Mode</span><span class="op" id="1335475">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1335480">int64</span><span class="op" id="1335485">(</span><span class="ident" id="1335486">fm</span><span class="op" id="1335488">.</span><span class="ident" id="1335489">Perm</span><span class="op" id="1335493">(</span><span class="op" id="1335494">)</span><span class="op" id="1335495">)</span><span class="op" id="1335496">,</span>&nbsp;<span class="comment" id="1335498">//&nbsp;or&#39;d&nbsp;with&nbsp;c_IS*&nbsp;constants&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335537">switch</span>&nbsp;<span class="op" id="1335544">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335547">case</span>&nbsp;<span class="ident" id="1335552">fm</span><span class="op" id="1335554">.</span><span class="ident" id="1335555">IsRegular</span><span class="op" id="1335564">(</span><span class="op" id="1335565">)</span><span class="op" id="1335566">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335570">h</span><span class="op" id="1335571">.</span><span class="ident" id="1335572">Mode</span>&nbsp;<span class="op" id="1335577">|=</span>&nbsp;<span class="ident" id="1335580">c_ISREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335590">h</span><span class="op" id="1335591">.</span><span class="ident" id="1335592">Typeflag</span>&nbsp;<span class="op" id="1335601">=</span>&nbsp;<span class="ident" id="1335603">TypeReg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335613">h</span><span class="op" id="1335614">.</span><span class="ident" id="1335615">Size</span>&nbsp;<span class="op" id="1335620">=</span>&nbsp;<span class="ident" id="1335622">fi</span><span class="op" id="1335624">.</span><span class="ident" id="1335625">Size</span><span class="op" id="1335629">(</span><span class="op" id="1335630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335633">case</span>&nbsp;<span class="ident" id="1335638">fi</span><span class="op" id="1335640">.</span><span class="ident" id="1335641">IsDir</span><span class="op" id="1335646">(</span><span class="op" id="1335647">)</span><span class="op" id="1335648">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335652">h</span><span class="op" id="1335653">.</span><span class="ident" id="1335654">Typeflag</span>&nbsp;<span class="op" id="1335663">=</span>&nbsp;<span class="ident" id="1335665">TypeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335675">h</span><span class="op" id="1335676">.</span><span class="ident" id="1335677">Mode</span>&nbsp;<span class="op" id="1335682">|=</span>&nbsp;<span class="ident" id="1335685">c_ISDIR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335695">h</span><span class="op" id="1335696">.</span><span class="ident" id="1335697">Name</span>&nbsp;<span class="op" id="1335702">+=</span>&nbsp;<span class="string" id="1335705">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335710">case</span>&nbsp;<span class="ident" id="1335715">fm</span><span class="op" id="1335717">&amp;</span><span class="ident" id="1335718">os</span><span class="op" id="1335720">.</span><span class="ident" id="1335721">ModeSymlink</span>&nbsp;<span class="op" id="1335733">!=</span>&nbsp;<span class="num" id="1335736">0</span><span class="op" id="1335737">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335741">h</span><span class="op" id="1335742">.</span><span class="ident" id="1335743">Typeflag</span>&nbsp;<span class="op" id="1335752">=</span>&nbsp;<span class="ident" id="1335754">TypeSymlink</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335768">h</span><span class="op" id="1335769">.</span><span class="ident" id="1335770">Mode</span>&nbsp;<span class="op" id="1335775">|=</span>&nbsp;<span class="ident" id="1335778">c_ISLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335788">h</span><span class="op" id="1335789">.</span><span class="ident" id="1335790">Linkname</span>&nbsp;<span class="op" id="1335799">=</span>&nbsp;<span class="ident" id="1335801">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335807">case</span>&nbsp;<span class="ident" id="1335812">fm</span><span class="op" id="1335814">&amp;</span><span class="ident" id="1335815">os</span><span class="op" id="1335817">.</span><span class="ident" id="1335818">ModeDevice</span>&nbsp;<span class="op" id="1335829">!=</span>&nbsp;<span class="num" id="1335832">0</span><span class="op" id="1335833">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335837">if</span>&nbsp;<span class="ident" id="1335840">fm</span><span class="op" id="1335842">&amp;</span><span class="ident" id="1335843">os</span><span class="op" id="1335845">.</span><span class="ident" id="1335846">ModeCharDevice</span>&nbsp;<span class="op" id="1335861">!=</span>&nbsp;<span class="num" id="1335864">0</span>&nbsp;<span class="op" id="1335866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335871">h</span><span class="op" id="1335872">.</span><span class="ident" id="1335873">Mode</span>&nbsp;<span class="op" id="1335878">|=</span>&nbsp;<span class="ident" id="1335881">c_ISCHR</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335892">h</span><span class="op" id="1335893">.</span><span class="ident" id="1335894">Typeflag</span>&nbsp;<span class="op" id="1335903">=</span>&nbsp;<span class="ident" id="1335905">TypeChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335916">}</span>&nbsp;<span class="keyword" id="1335918">else</span>&nbsp;<span class="op" id="1335923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335928">h</span><span class="op" id="1335929">.</span><span class="ident" id="1335930">Mode</span>&nbsp;<span class="op" id="1335935">|=</span>&nbsp;<span class="ident" id="1335938">c_ISBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335949">h</span><span class="op" id="1335950">.</span><span class="ident" id="1335951">Typeflag</span>&nbsp;<span class="op" id="1335960">=</span>&nbsp;<span class="ident" id="1335962">TypeBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335974">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335977">case</span>&nbsp;<span class="ident" id="1335982">fm</span><span class="op" id="1335984">&amp;</span><span class="ident" id="1335985">os</span><span class="op" id="1335987">.</span><span class="ident" id="1335988">ModeNamedPipe</span>&nbsp;<span class="op" id="1336002">!=</span>&nbsp;<span class="num" id="1336005">0</span><span class="op" id="1336006">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336010">h</span><span class="op" id="1336011">.</span><span class="ident" id="1336012">Typeflag</span>&nbsp;<span class="op" id="1336021">=</span>&nbsp;<span class="ident" id="1336023">TypeFifo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336034">h</span><span class="op" id="1336035">.</span><span class="ident" id="1336036">Mode</span>&nbsp;<span class="op" id="1336041">|=</span>&nbsp;<span class="ident" id="1336044">c_ISFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336054">case</span>&nbsp;<span class="ident" id="1336059">fm</span><span class="op" id="1336061">&amp;</span><span class="ident" id="1336062">os</span><span class="op" id="1336064">.</span><span class="ident" id="1336065">ModeSocket</span>&nbsp;<span class="op" id="1336076">!=</span>&nbsp;<span class="num" id="1336079">0</span><span class="op" id="1336080">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336084">h</span><span class="op" id="1336085">.</span><span class="ident" id="1336086">Mode</span>&nbsp;<span class="op" id="1336091">|=</span>&nbsp;<span class="ident" id="1336094">c_ISSOCK</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336104">default</span><span class="op" id="1336111">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336115">return</span>&nbsp;<span class="ident" id="1336122">nil</span><span class="op" id="1336125">,</span>&nbsp;<span class="ident" id="1336127">fmt</span><span class="op" id="1336130">.</span><span class="ident" id="1336131">Errorf</span><span class="op" id="1336137">(</span><span class="string" id="1336138">&#34;archive/tar:&nbsp;unknown&nbsp;file&nbsp;mode&nbsp;%v&#34;</span><span class="op" id="1336173">,</span>&nbsp;<span class="ident" id="1336175">fm</span><span class="op" id="1336177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336183">if</span>&nbsp;<span class="ident" id="1336186">fm</span><span class="op" id="1336188">&amp;</span><span class="ident" id="1336189">os</span><span class="op" id="1336191">.</span><span class="ident" id="1336192">ModeSetuid</span>&nbsp;<span class="op" id="1336203">!=</span>&nbsp;<span class="num" id="1336206">0</span>&nbsp;<span class="op" id="1336208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336212">h</span><span class="op" id="1336213">.</span><span class="ident" id="1336214">Mode</span>&nbsp;<span class="op" id="1336219">|=</span>&nbsp;<span class="ident" id="1336222">c_ISUID</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336234">if</span>&nbsp;<span class="ident" id="1336237">fm</span><span class="op" id="1336239">&amp;</span><span class="ident" id="1336240">os</span><span class="op" id="1336242">.</span><span class="ident" id="1336243">ModeSetgid</span>&nbsp;<span class="op" id="1336254">!=</span>&nbsp;<span class="num" id="1336257">0</span>&nbsp;<span class="op" id="1336259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336263">h</span><span class="op" id="1336264">.</span><span class="ident" id="1336265">Mode</span>&nbsp;<span class="op" id="1336270">|=</span>&nbsp;<span class="ident" id="1336273">c_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336285">if</span>&nbsp;<span class="ident" id="1336288">fm</span><span class="op" id="1336290">&amp;</span><span class="ident" id="1336291">os</span><span class="op" id="1336293">.</span><span class="ident" id="1336294">ModeSticky</span>&nbsp;<span class="op" id="1336305">!=</span>&nbsp;<span class="num" id="1336308">0</span>&nbsp;<span class="op" id="1336310">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336314">h</span><span class="op" id="1336315">.</span><span class="ident" id="1336316">Mode</span>&nbsp;<span class="op" id="1336321">|=</span>&nbsp;<span class="ident" id="1336324">c_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336336">if</span>&nbsp;<span class="ident" id="1336339">sysStat</span>&nbsp;<span class="op" id="1336347">!=</span>&nbsp;<span class="ident" id="1336350">nil</span>&nbsp;<span class="op" id="1336354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336358">return</span>&nbsp;<span class="ident" id="1336365">h</span><span class="op" id="1336366">,</span>&nbsp;<span class="ident" id="1336368">sysStat</span><span class="op" id="1336375">(</span><span class="ident" id="1336376">fi</span><span class="op" id="1336378">,</span>&nbsp;<span class="ident" id="1336380">h</span><span class="op" id="1336381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336384">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336387">return</span>&nbsp;<span class="ident" id="1336394">h</span><span class="op" id="1336395">,</span>&nbsp;<span class="ident" id="1336397">nil</span><br>
<span class="lineno"></span><span class="op" id="1336401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1336404">var</span>&nbsp;<span class="ident" id="1336408">zeroBlock</span>&nbsp;<span class="op" id="1336418">=</span>&nbsp;<span class="builtinfunc" id="1336420">make</span><span class="op" id="1336424">(</span><span class="op" id="1336425">[</span><span class="op" id="1336426">]</span><span class="builtintype" id="1336427">byte</span><span class="op" id="1336431">,</span>&nbsp;<span class="ident" id="1336433">blockSize</span><span class="op" id="1336442">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="1336445">//&nbsp;POSIX&nbsp;specifies&nbsp;a&nbsp;sum&nbsp;of&nbsp;the&nbsp;unsigned&nbsp;byte&nbsp;values,&nbsp;but&nbsp;the&nbsp;Sun&nbsp;tar&nbsp;uses&nbsp;signed&nbsp;byte&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="1336540">//&nbsp;We&nbsp;compute&nbsp;and&nbsp;return&nbsp;both.</span><br>
<span class="lineno"></span><span class="keyword" id="1336571">func</span>&nbsp;<span class="ident" id="1336576">checksum</span><span class="op" id="1336584">(</span><span class="ident" id="1336585">header</span>&nbsp;<span class="op" id="1336592">[</span><span class="op" id="1336593">]</span><span class="builtintype" id="1336594">byte</span><span class="op" id="1336598">)</span>&nbsp;<span class="op" id="1336600">(</span><span class="ident" id="1336601">unsigned</span>&nbsp;<span class="ident" id="1336610">int64</span><span class="op" id="1336615">,</span>&nbsp;<span class="ident" id="1336617">signed</span>&nbsp;<span class="ident" id="1336624">int64</span><span class="op" id="1336629">)</span>&nbsp;<span class="op" id="1336631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336634">for</span>&nbsp;<span class="ident" id="1336638">i</span>&nbsp;<span class="op" id="1336640">:=</span>&nbsp;<span class="num" id="1336643">0</span><span class="op" id="1336644">;</span>&nbsp;<span class="ident" id="1336646">i</span>&nbsp;<span class="op" id="1336648">&lt;</span>&nbsp;<span class="builtinfunc" id="1336650">len</span><span class="op" id="1336653">(</span><span class="ident" id="1336654">header</span><span class="op" id="1336660">)</span><span class="op" id="1336661">;</span>&nbsp;<span class="ident" id="1336663">i</span><span class="op" id="1336664">++</span>&nbsp;<span class="op" id="1336667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336671">if</span>&nbsp;<span class="ident" id="1336674">i</span>&nbsp;<span class="op" id="1336676">==</span>&nbsp;<span class="num" id="1336679">148</span>&nbsp;<span class="op" id="1336683">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336688">//&nbsp;The&nbsp;chksum&nbsp;field&nbsp;(header[148:156])&nbsp;is&nbsp;special:&nbsp;it&nbsp;should&nbsp;be&nbsp;treated&nbsp;as&nbsp;space&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336778">unsigned</span>&nbsp;<span class="op" id="1336787">+=</span>&nbsp;<span class="string" id="1336790">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="1336794">*</span>&nbsp;<span class="num" id="1336796">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336801">signed</span>&nbsp;<span class="op" id="1336808">+=</span>&nbsp;<span class="string" id="1336811">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="1336815">*</span>&nbsp;<span class="num" id="1336817">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336822">i</span>&nbsp;<span class="op" id="1336824">+=</span>&nbsp;<span class="num" id="1336827">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336832">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336847">unsigned</span>&nbsp;<span class="op" id="1336856">+=</span>&nbsp;<span class="ident" id="1336859">int64</span><span class="op" id="1336864">(</span><span class="ident" id="1336865">header</span><span class="op" id="1336871">[</span><span class="ident" id="1336872">i</span><span class="op" id="1336873">]</span><span class="op" id="1336874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336878">signed</span>&nbsp;<span class="op" id="1336885">+=</span>&nbsp;<span class="ident" id="1336888">int64</span><span class="op" id="1336893">(</span><span class="builtintype" id="1336894">int8</span><span class="op" id="1336898">(</span><span class="ident" id="1336899">header</span><span class="op" id="1336905">[</span><span class="ident" id="1336906">i</span><span class="op" id="1336907">]</span><span class="op" id="1336908">)</span><span class="op" id="1336909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336915">return</span><br>
<span class="lineno">275</span><span class="op" id="1336922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1336925">type</span>&nbsp;<span class="ident" id="1336930">slicer</span>&nbsp;<span class="op" id="1336937">[</span><span class="op" id="1336938">]</span><span class="builtintype" id="1336939">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1336945">func</span>&nbsp;<span class="op" id="1336950">(</span><span class="ident" id="1336951">sp</span>&nbsp;<span class="op" id="1336954">*</span><span class="ident" id="1336955">slicer</span><span class="op" id="1336961">)</span>&nbsp;<span class="ident" id="1336963">next</span><span class="op" id="1336967">(</span><span class="ident" id="1336968">n</span>&nbsp;<span class="builtintype" id="1336970">int</span><span class="op" id="1336973">)</span>&nbsp;<span class="op" id="1336975">(</span><span class="ident" id="1336976">b</span>&nbsp;<span class="op" id="1336978">[</span><span class="op" id="1336979">]</span><span class="builtintype" id="1336980">byte</span><span class="op" id="1336984">)</span>&nbsp;<span class="op" id="1336986">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336989">s</span>&nbsp;<span class="op" id="1336991">:=</span>&nbsp;<span class="op" id="1336994">*</span><span class="ident" id="1336995">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336999">b</span><span class="op" id="1337000">,</span>&nbsp;<span class="op" id="1337002">*</span><span class="ident" id="1337003">sp</span>&nbsp;<span class="op" id="1337006">=</span>&nbsp;<span class="ident" id="1337008">s</span><span class="op" id="1337009">[</span><span class="num" id="1337010">0</span><span class="op" id="1337011">:</span><span class="ident" id="1337012">n</span><span class="op" id="1337013">]</span><span class="op" id="1337014">,</span>&nbsp;<span class="ident" id="1337016">s</span><span class="op" id="1337017">[</span><span class="ident" id="1337018">n</span><span class="op" id="1337019">:</span><span class="op" id="1337020">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337023">return</span><br>
<span class="lineno"></span><span class="op" id="1337030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="1337033">func</span>&nbsp;<span class="ident" id="1337038">isASCII</span><span class="op" id="1337045">(</span><span class="ident" id="1337046">s</span>&nbsp;<span class="builtintype" id="1337048">string</span><span class="op" id="1337054">)</span>&nbsp;<span class="builtintype" id="1337056">bool</span>&nbsp;<span class="op" id="1337061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337064">for</span>&nbsp;<span class="ident" id="1337068">_</span><span class="op" id="1337069">,</span>&nbsp;<span class="ident" id="1337071">c</span>&nbsp;<span class="op" id="1337073">:=</span>&nbsp;<span class="keyword" id="1337076">range</span>&nbsp;<span class="ident" id="1337082">s</span>&nbsp;<span class="op" id="1337084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337088">if</span>&nbsp;<span class="ident" id="1337091">c</span>&nbsp;<span class="op" id="1337093">&gt;=</span>&nbsp;<span class="num" id="1337096">0x80</span>&nbsp;<span class="op" id="1337101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337106">return</span>&nbsp;<span class="builtintype" id="1337113">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337121">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337127">return</span>&nbsp;<span class="builtintype" id="1337134">true</span><br>
<span class="lineno"></span><span class="op" id="1337139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1337142">func</span>&nbsp;<span class="ident" id="1337147">toASCII</span><span class="op" id="1337154">(</span><span class="ident" id="1337155">s</span>&nbsp;<span class="builtintype" id="1337157">string</span><span class="op" id="1337163">)</span>&nbsp;<span class="builtintype" id="1337165">string</span>&nbsp;<span class="op" id="1337172">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337175">if</span>&nbsp;<span class="ident" id="1337178">isASCII</span><span class="op" id="1337185">(</span><span class="ident" id="1337186">s</span><span class="op" id="1337187">)</span>&nbsp;<span class="op" id="1337189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337193">return</span>&nbsp;<span class="ident" id="1337200">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337206">var</span>&nbsp;<span class="ident" id="1337210">buf</span>&nbsp;<span class="ident" id="1337214">bytes</span><span class="op" id="1337219">.</span><span class="ident" id="1337220">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337228">for</span>&nbsp;<span class="ident" id="1337232">_</span><span class="op" id="1337233">,</span>&nbsp;<span class="ident" id="1337235">c</span>&nbsp;<span class="op" id="1337237">:=</span>&nbsp;<span class="keyword" id="1337240">range</span>&nbsp;<span class="ident" id="1337246">s</span>&nbsp;<span class="op" id="1337248">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337252">if</span>&nbsp;<span class="ident" id="1337255">c</span>&nbsp;<span class="op" id="1337257">&lt;</span>&nbsp;<span class="num" id="1337259">0x80</span>&nbsp;<span class="op" id="1337264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337269">buf</span><span class="op" id="1337272">.</span><span class="ident" id="1337273">WriteByte</span><span class="op" id="1337282">(</span><span class="builtintype" id="1337283">byte</span><span class="op" id="1337287">(</span><span class="ident" id="1337288">c</span><span class="op" id="1337289">)</span><span class="op" id="1337290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337300">return</span>&nbsp;<span class="ident" id="1337307">buf</span><span class="op" id="1337310">.</span><span class="ident" id="1337311">String</span><span class="op" id="1337317">(</span><span class="op" id="1337318">)</span><br>
<span class="lineno">305</span><span class="op" id="1337320">}</span>
</div>
</body>
</html>
