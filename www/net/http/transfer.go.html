<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3896048">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3896103">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3896157">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3896208">package</span>&nbsp;<span class="ident" id="3896216">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3896222">import</span>&nbsp;<span class="op" id="3896229">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3896232">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3896241">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3896250">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3896260">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3896267">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3896273">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3896286">&#34;net/http/internal&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3896307">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3896324">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3896332">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3896343">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3896354">&#34;sync&#34;</span><br>
<span class="lineno">20</span><span class="op" id="3896361">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3896364">//&nbsp;ErrLineTooLong&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;request&nbsp;or&nbsp;response&nbsp;bodies</span><br>
<span class="lineno"></span><span class="comment" id="3896434">//&nbsp;with&nbsp;malformed&nbsp;chunked&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3896470">var</span>&nbsp;<span class="ident" id="3896474">ErrLineTooLong</span>&nbsp;<span class="op" id="3896489">=</span>&nbsp;<span class="ident" id="3896491"><a href="/net/http/transfer.go.html#3896286">internal</a></span><span class="op" id="3896499">.</span><span class="ident" id="3896500">ErrLineTooLong</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3896516">type</span>&nbsp;<span class="ident" id="3896521">errorReader</span>&nbsp;<span class="keyword" id="3896533">struct</span>&nbsp;<span class="op" id="3896540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896543">err</span>&nbsp;<span class="builtintype" id="3896547">error</span><br>
<span class="lineno"></span><span class="op" id="3896553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="3896556">func</span>&nbsp;<span class="op" id="3896561">(</span><span class="ident" id="3896562">r</span>&nbsp;<span class="op" id="3896564">*</span><span class="ident" id="3896565"><a href="/net/http/transfer.go.html#3896521">errorReader</a></span><span class="op" id="3896576">)</span>&nbsp;<span class="ident" id="3896578">Read</span><span class="op" id="3896582">(</span><span class="ident" id="3896583">p</span>&nbsp;<span class="op" id="3896585">[</span><span class="op" id="3896586">]</span><span class="builtintype" id="3896587">byte</span><span class="op" id="3896591">)</span>&nbsp;<span class="op" id="3896593">(</span><span class="ident" id="3896594">n</span>&nbsp;<span class="builtintype" id="3896596">int</span><span class="op" id="3896599">,</span>&nbsp;<span class="ident" id="3896601">err</span>&nbsp;<span class="builtintype" id="3896605">error</span><span class="op" id="3896610">)</span>&nbsp;<span class="op" id="3896612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896615">return</span>&nbsp;<span class="num" id="3896622">0</span><span class="op" id="3896623">,</span>&nbsp;<span class="ident" id="3896625"><a href="/net/http/transfer.go.html#3896562">r</a></span><span class="op" id="3896626">.</span><span class="ident" id="3896627">err</span><br>
<span class="lineno"></span><span class="op" id="3896631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3896634">//&nbsp;transferWriter&nbsp;inspects&nbsp;the&nbsp;fields&nbsp;of&nbsp;a&nbsp;user-supplied&nbsp;Request&nbsp;or&nbsp;Response,</span><br>
<span class="lineno">35</span><span class="comment" id="3896712">//&nbsp;sanitizes&nbsp;them&nbsp;without&nbsp;changing&nbsp;the&nbsp;user&nbsp;object&nbsp;and&nbsp;provides&nbsp;methods&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3896788">//&nbsp;writing&nbsp;the&nbsp;respective&nbsp;header,&nbsp;body&nbsp;and&nbsp;trailer&nbsp;in&nbsp;wire&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="3896855">type</span>&nbsp;<span class="ident" id="3896860">transferWriter</span>&nbsp;<span class="keyword" id="3896875">struct</span>&nbsp;<span class="op" id="3896882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896885">Method</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3896902">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896910">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3896927"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3896929">.</span><span class="ident" id="3896930">Reader</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896938">BodyCloser</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3896955"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3896957">.</span><span class="ident" id="3896958">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896966">ResponseToHEAD</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3896983">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896989">ContentLength</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3897006">int64</span>&nbsp;<span class="comment" id="3897012">//&nbsp;-1&nbsp;means&nbsp;unknown,&nbsp;0&nbsp;means&nbsp;exactly&nbsp;none</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897055">Close</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3897072">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897078">TransferEncoding</span>&nbsp;<span class="op" id="3897095">[</span><span class="op" id="3897096">]</span><span class="builtintype" id="3897097">string</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897105">Trailer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3897122"><a href="/net/http/header.go.html#3781581">Header</a></span><br>
<span class="lineno"></span><span class="op" id="3897129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3897132">func</span>&nbsp;<span class="ident" id="3897137">newTransferWriter</span><span class="op" id="3897154">(</span><span class="ident" id="3897155">r</span>&nbsp;<span class="keyword" id="3897157">interface</span><span class="op" id="3897166">{</span><span class="op" id="3897167">}</span><span class="op" id="3897168">)</span>&nbsp;<span class="op" id="3897170">(</span><span class="ident" id="3897171">t</span>&nbsp;<span class="op" id="3897173">*</span><span class="ident" id="3897174"><a href="/net/http/transfer.go.html#3896860">transferWriter</a></span><span class="op" id="3897188">,</span>&nbsp;<span class="ident" id="3897190">err</span>&nbsp;<span class="builtintype" id="3897194">error</span><span class="op" id="3897199">)</span>&nbsp;<span class="op" id="3897201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897204"><a href="/net/http/transfer.go.html#3897171">t</a></span>&nbsp;<span class="op" id="3897206">=</span>&nbsp;<span class="op" id="3897208">&amp;</span><span class="ident" id="3897209"><a href="/net/http/transfer.go.html#3896860">transferWriter</a></span><span class="op" id="3897223">{</span><span class="op" id="3897224">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3897228">//&nbsp;Extract&nbsp;relevant&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897256">atLeastHTTP11</span>&nbsp;<span class="op" id="3897270">:=</span>&nbsp;<span class="ident" id="3897273">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897280">switch</span>&nbsp;<span class="ident" id="3897287">rr</span>&nbsp;<span class="op" id="3897290">:=</span>&nbsp;<span class="ident" id="3897293"><a href="/net/http/transfer.go.html#3897155">r</a></span><span class="op" id="3897294">.</span><span class="op" id="3897295">(</span><span class="keyword" id="3897296">type</span><span class="op" id="3897300">)</span>&nbsp;<span class="op" id="3897302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897305">case</span>&nbsp;<span class="op" id="3897310">*</span><span class="ident" id="3897311"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3897318">:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897322">if</span>&nbsp;<span class="ident" id="3897325"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3897327">.</span><span class="ident" id="3897328">ContentLength</span>&nbsp;<span class="op" id="3897342">!=</span>&nbsp;<span class="num" id="3897345">0</span>&nbsp;<span class="op" id="3897347">&amp;&amp;</span>&nbsp;<span class="ident" id="3897350"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3897352">.</span><span class="ident" id="3897353">Body</span>&nbsp;<span class="op" id="3897358">==</span>&nbsp;<span class="ident" id="3897361">nil</span>&nbsp;<span class="op" id="3897365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897370">return</span>&nbsp;<span class="ident" id="3897377">nil</span><span class="op" id="3897380">,</span>&nbsp;<span class="ident" id="3897382"><a href="/net/http/transfer.go.html#3896260">fmt</a></span><span class="op" id="3897385">.</span><span class="ident" id="3897386">Errorf</span><span class="op" id="3897392">(</span><span class="string" id="3897393">&#34;http:&nbsp;Request.ContentLength=%d&nbsp;with&nbsp;nil&nbsp;Body&#34;</span><span class="op" id="3897439">,</span>&nbsp;<span class="ident" id="3897441"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3897443">.</span><span class="ident" id="3897444">ContentLength</span><span class="op" id="3897457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3897461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897465"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3897466">.</span><span class="ident" id="3897467">Method</span>&nbsp;<span class="op" id="3897474">=</span>&nbsp;<span class="ident" id="3897476"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3897478">.</span><span class="ident" id="3897479">Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897488"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3897489">.</span><span class="ident" id="3897490">Body</span>&nbsp;<span class="op" id="3897495">=</span>&nbsp;<span class="ident" id="3897497"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3897499">.</span><span class="ident" id="3897500">Body</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897507"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3897508">.</span><span class="ident" id="3897509">BodyCloser</span>&nbsp;<span class="op" id="3897520">=</span>&nbsp;<span class="ident" id="3897522"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3897524">.</span><span class="ident" id="3897525">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897532"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3897533">.</span><span class="ident" id="3897534">ContentLength</span>&nbsp;<span class="op" id="3897548">=</span>&nbsp;<span class="ident" id="3897550"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3897552">.</span><span class="ident" id="3897553">ContentLength</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897569"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3897570">.</span><span class="ident" id="3897571">Close</span>&nbsp;<span class="op" id="3897577">=</span>&nbsp;<span class="ident" id="3897579"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3897581">.</span><span class="ident" id="3897582">Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897590"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3897591">.</span><span class="ident" id="3897592">TransferEncoding</span>&nbsp;<span class="op" id="3897609">=</span>&nbsp;<span class="ident" id="3897611"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3897613">.</span><span class="ident" id="3897614">TransferEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897633"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3897634">.</span><span class="ident" id="3897635">Trailer</span>&nbsp;<span class="op" id="3897643">=</span>&nbsp;<span class="ident" id="3897645"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3897647">.</span><span class="ident" id="3897648">Trailer</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897658"><a href="/net/http/transfer.go.html#3897256">atLeastHTTP11</a></span>&nbsp;<span class="op" id="3897672">=</span>&nbsp;<span class="ident" id="3897674"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3897676">.</span><span class="ident" id="3897677">ProtoAtLeast</span><span class="op" id="3897689">(</span><span class="num" id="3897690">1</span><span class="op" id="3897691">,</span>&nbsp;<span class="num" id="3897693">1</span><span class="op" id="3897694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897698">if</span>&nbsp;<span class="ident" id="3897701"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3897702">.</span><span class="ident" id="3897703">Body</span>&nbsp;<span class="op" id="3897708">!=</span>&nbsp;<span class="ident" id="3897711">nil</span>&nbsp;<span class="op" id="3897715">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3897718">len</span><span class="op" id="3897721">(</span><span class="ident" id="3897722"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3897723">.</span><span class="ident" id="3897724">TransferEncoding</span><span class="op" id="3897740">)</span>&nbsp;<span class="op" id="3897742">==</span>&nbsp;<span class="num" id="3897745">0</span>&nbsp;<span class="op" id="3897747">&amp;&amp;</span>&nbsp;<span class="ident" id="3897750"><a href="/net/http/transfer.go.html#3897256">atLeastHTTP11</a></span>&nbsp;<span class="op" id="3897764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897769">if</span>&nbsp;<span class="ident" id="3897772"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3897773">.</span><span class="ident" id="3897774">ContentLength</span>&nbsp;<span class="op" id="3897788">==</span>&nbsp;<span class="num" id="3897791">0</span>&nbsp;<span class="op" id="3897793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3897799">//&nbsp;Test&nbsp;to&nbsp;see&nbsp;if&nbsp;it&#39;s&nbsp;actually&nbsp;zero&nbsp;or&nbsp;just&nbsp;unset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897855">var</span>&nbsp;<span class="ident" id="3897859">buf</span>&nbsp;<span class="op" id="3897863">[</span><span class="num" id="3897864">1</span><span class="op" id="3897865">]</span><span class="builtintype" id="3897866">byte</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897875">n</span><span class="op" id="3897876">,</span>&nbsp;<span class="ident" id="3897878">rerr</span>&nbsp;<span class="op" id="3897883">:=</span>&nbsp;<span class="ident" id="3897886"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3897888">.</span><span class="ident" id="3897889">ReadFull</span><span class="op" id="3897897">(</span><span class="ident" id="3897898"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3897899">.</span><span class="ident" id="3897900">Body</span><span class="op" id="3897904">,</span>&nbsp;<span class="ident" id="3897906"><a href="/net/http/transfer.go.html#3897859">buf</a></span><span class="op" id="3897909">[</span><span class="op" id="3897910">:</span><span class="op" id="3897911">]</span><span class="op" id="3897912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897918">if</span>&nbsp;<span class="ident" id="3897921"><a href="/net/http/transfer.go.html#3897878">rerr</a></span>&nbsp;<span class="op" id="3897926">!=</span>&nbsp;<span class="ident" id="3897929">nil</span>&nbsp;<span class="op" id="3897933">&amp;&amp;</span>&nbsp;<span class="ident" id="3897936"><a href="/net/http/transfer.go.html#3897878">rerr</a></span>&nbsp;<span class="op" id="3897941">!=</span>&nbsp;<span class="ident" id="3897944"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3897946">.</span><span class="ident" id="3897947">EOF</span>&nbsp;<span class="op" id="3897951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897958"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3897959">.</span><span class="ident" id="3897960">ContentLength</span>&nbsp;<span class="op" id="3897974">=</span>&nbsp;<span class="op" id="3897976">-</span><span class="num" id="3897977">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897984"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3897985">.</span><span class="ident" id="3897986">Body</span>&nbsp;<span class="op" id="3897991">=</span>&nbsp;<span class="op" id="3897993">&amp;</span><span class="ident" id="3897994"><a href="/net/http/transfer.go.html#3896521">errorReader</a></span><span class="op" id="3898005">{</span><span class="ident" id="3898006"><a href="/net/http/transfer.go.html#3897878">rerr</a></span><span class="op" id="3898010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898016">}</span>&nbsp;<span class="keyword" id="3898018">else</span>&nbsp;<span class="keyword" id="3898023">if</span>&nbsp;<span class="ident" id="3898026"><a href="/net/http/transfer.go.html#3897875">n</a></span>&nbsp;<span class="op" id="3898028">==</span>&nbsp;<span class="num" id="3898031">1</span>&nbsp;<span class="op" id="3898033">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3898040">//&nbsp;Oh,&nbsp;guess&nbsp;there&nbsp;is&nbsp;data&nbsp;in&nbsp;this&nbsp;Body&nbsp;Reader&nbsp;after&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3898103">//&nbsp;The&nbsp;ContentLength&nbsp;field&nbsp;just&nbsp;wasn&#39;t&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3898152">//&nbsp;Stich&nbsp;the&nbsp;Body&nbsp;back&nbsp;together&nbsp;again,&nbsp;re-attaching&nbsp;our</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3898213">//&nbsp;consumed&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898236"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898237">.</span><span class="ident" id="3898238">ContentLength</span>&nbsp;<span class="op" id="3898252">=</span>&nbsp;<span class="op" id="3898254">-</span><span class="num" id="3898255">1</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898262"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898263">.</span><span class="ident" id="3898264">Body</span>&nbsp;<span class="op" id="3898269">=</span>&nbsp;<span class="ident" id="3898271"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3898273">.</span><span class="ident" id="3898274">MultiReader</span><span class="op" id="3898285">(</span><span class="ident" id="3898286"><a href="/net/http/transfer.go.html#3896241">bytes</a></span><span class="op" id="3898291">.</span><span class="ident" id="3898292">NewReader</span><span class="op" id="3898301">(</span><span class="ident" id="3898302"><a href="/net/http/transfer.go.html#3897859">buf</a></span><span class="op" id="3898305">[</span><span class="op" id="3898306">:</span><span class="op" id="3898307">]</span><span class="op" id="3898308">)</span><span class="op" id="3898309">,</span>&nbsp;<span class="ident" id="3898311"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898312">.</span><span class="ident" id="3898313">Body</span><span class="op" id="3898317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898323">}</span>&nbsp;<span class="keyword" id="3898325">else</span>&nbsp;<span class="op" id="3898330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3898337">//&nbsp;Body&nbsp;is&nbsp;actually&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898369"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898370">.</span><span class="ident" id="3898371">Body</span>&nbsp;<span class="op" id="3898376">=</span>&nbsp;<span class="ident" id="3898378">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898387"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898388">.</span><span class="ident" id="3898389">BodyCloser</span>&nbsp;<span class="op" id="3898400">=</span>&nbsp;<span class="ident" id="3898402">nil</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898420">if</span>&nbsp;<span class="ident" id="3898423"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898424">.</span><span class="ident" id="3898425">ContentLength</span>&nbsp;<span class="op" id="3898439">&lt;</span>&nbsp;<span class="num" id="3898441">0</span>&nbsp;<span class="op" id="3898443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898449"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898450">.</span><span class="ident" id="3898451">TransferEncoding</span>&nbsp;<span class="op" id="3898468">=</span>&nbsp;<span class="op" id="3898470">[</span><span class="op" id="3898471">]</span><span class="builtintype" id="3898472">string</span><span class="op" id="3898478">{</span><span class="string" id="3898479">&#34;chunked&#34;</span><span class="op" id="3898488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898493">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898500">case</span>&nbsp;<span class="op" id="3898505">*</span><span class="ident" id="3898506"><a href="/net/http/response.go.html#3816973">Response</a></span><span class="op" id="3898514">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898518">if</span>&nbsp;<span class="ident" id="3898521"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3898523">.</span><span class="ident" id="3898524">Request</span>&nbsp;<span class="op" id="3898532">!=</span>&nbsp;<span class="ident" id="3898535">nil</span>&nbsp;<span class="op" id="3898539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898544"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898545">.</span><span class="ident" id="3898546">Method</span>&nbsp;<span class="op" id="3898553">=</span>&nbsp;<span class="ident" id="3898555"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3898557">.</span><span class="ident" id="3898558">Request</span><span class="op" id="3898565">.</span><span class="ident" id="3898566">Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898575">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898579"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898580">.</span><span class="ident" id="3898581">Body</span>&nbsp;<span class="op" id="3898586">=</span>&nbsp;<span class="ident" id="3898588"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3898590">.</span><span class="ident" id="3898591">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898598"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898599">.</span><span class="ident" id="3898600">BodyCloser</span>&nbsp;<span class="op" id="3898611">=</span>&nbsp;<span class="ident" id="3898613"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3898615">.</span><span class="ident" id="3898616">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898623"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898624">.</span><span class="ident" id="3898625">ContentLength</span>&nbsp;<span class="op" id="3898639">=</span>&nbsp;<span class="ident" id="3898641"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3898643">.</span><span class="ident" id="3898644">ContentLength</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898660"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898661">.</span><span class="ident" id="3898662">Close</span>&nbsp;<span class="op" id="3898668">=</span>&nbsp;<span class="ident" id="3898670"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3898672">.</span><span class="ident" id="3898673">Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898681"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898682">.</span><span class="ident" id="3898683">TransferEncoding</span>&nbsp;<span class="op" id="3898700">=</span>&nbsp;<span class="ident" id="3898702"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3898704">.</span><span class="ident" id="3898705">TransferEncoding</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898724"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898725">.</span><span class="ident" id="3898726">Trailer</span>&nbsp;<span class="op" id="3898734">=</span>&nbsp;<span class="ident" id="3898736"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3898738">.</span><span class="ident" id="3898739">Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898749"><a href="/net/http/transfer.go.html#3897256">atLeastHTTP11</a></span>&nbsp;<span class="op" id="3898763">=</span>&nbsp;<span class="ident" id="3898765"><a href="/net/http/transfer.go.html#3897287">rr</a></span><span class="op" id="3898767">.</span><span class="ident" id="3898768">ProtoAtLeast</span><span class="op" id="3898780">(</span><span class="num" id="3898781">1</span><span class="op" id="3898782">,</span>&nbsp;<span class="num" id="3898784">1</span><span class="op" id="3898785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898789"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898790">.</span><span class="ident" id="3898791">ResponseToHEAD</span>&nbsp;<span class="op" id="3898806">=</span>&nbsp;<span class="ident" id="3898808"><a href="/net/http/transfer.go.html#3899311">noBodyExpected</a></span><span class="op" id="3898822">(</span><span class="ident" id="3898823"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898824">.</span><span class="ident" id="3898825">Method</span><span class="op" id="3898831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3898838">//&nbsp;Sanitize&nbsp;Body,ContentLength,TransferEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898887">if</span>&nbsp;<span class="ident" id="3898890"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898891">.</span><span class="ident" id="3898892">ResponseToHEAD</span>&nbsp;<span class="op" id="3898907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898911"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898912">.</span><span class="ident" id="3898913">Body</span>&nbsp;<span class="op" id="3898918">=</span>&nbsp;<span class="ident" id="3898920">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898926">if</span>&nbsp;<span class="ident" id="3898929"><a href="/net/http/transfer.go.html#3906289">chunked</a></span><span class="op" id="3898936">(</span><span class="ident" id="3898937"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898938">.</span><span class="ident" id="3898939">TransferEncoding</span><span class="op" id="3898955">)</span>&nbsp;<span class="op" id="3898957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898962"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3898963">.</span><span class="ident" id="3898964">ContentLength</span>&nbsp;<span class="op" id="3898978">=</span>&nbsp;<span class="op" id="3898980">-</span><span class="num" id="3898981">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898988">}</span>&nbsp;<span class="keyword" id="3898990">else</span>&nbsp;<span class="op" id="3898995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898999">if</span>&nbsp;<span class="op" id="3899002">!</span><span class="ident" id="3899003"><a href="/net/http/transfer.go.html#3897256">atLeastHTTP11</a></span>&nbsp;<span class="op" id="3899017">||</span>&nbsp;<span class="ident" id="3899020"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3899021">.</span><span class="ident" id="3899022">Body</span>&nbsp;<span class="op" id="3899027">==</span>&nbsp;<span class="ident" id="3899030">nil</span>&nbsp;<span class="op" id="3899034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899039"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3899040">.</span><span class="ident" id="3899041">TransferEncoding</span>&nbsp;<span class="op" id="3899058">=</span>&nbsp;<span class="ident" id="3899060">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899066">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899070">if</span>&nbsp;<span class="ident" id="3899073"><a href="/net/http/transfer.go.html#3906289">chunked</a></span><span class="op" id="3899080">(</span><span class="ident" id="3899081"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3899082">.</span><span class="ident" id="3899083">TransferEncoding</span><span class="op" id="3899099">)</span>&nbsp;<span class="op" id="3899101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899106"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3899107">.</span><span class="ident" id="3899108">ContentLength</span>&nbsp;<span class="op" id="3899122">=</span>&nbsp;<span class="op" id="3899124">-</span><span class="num" id="3899125">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899129">}</span>&nbsp;<span class="keyword" id="3899131">else</span>&nbsp;<span class="keyword" id="3899136">if</span>&nbsp;<span class="ident" id="3899139"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3899140">.</span><span class="ident" id="3899141">Body</span>&nbsp;<span class="op" id="3899146">==</span>&nbsp;<span class="ident" id="3899149">nil</span>&nbsp;<span class="op" id="3899153">{</span>&nbsp;<span class="comment" id="3899155">//&nbsp;no&nbsp;chunking,&nbsp;no&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899182"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3899183">.</span><span class="ident" id="3899184">ContentLength</span>&nbsp;<span class="op" id="3899198">=</span>&nbsp;<span class="num" id="3899200">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899204">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3899211">//&nbsp;Sanitize&nbsp;Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899232">if</span>&nbsp;<span class="op" id="3899235">!</span><span class="ident" id="3899236"><a href="/net/http/transfer.go.html#3906289">chunked</a></span><span class="op" id="3899243">(</span><span class="ident" id="3899244"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3899245">.</span><span class="ident" id="3899246">TransferEncoding</span><span class="op" id="3899262">)</span>&nbsp;<span class="op" id="3899264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899268"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3899269">.</span><span class="ident" id="3899270">Trailer</span>&nbsp;<span class="op" id="3899278">=</span>&nbsp;<span class="ident" id="3899280">nil</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899289">return</span>&nbsp;<span class="ident" id="3899296"><a href="/net/http/transfer.go.html#3897171">t</a></span><span class="op" id="3899297">,</span>&nbsp;<span class="ident" id="3899299">nil</span><br>
<span class="lineno"></span><span class="op" id="3899303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="3899306">func</span>&nbsp;<span class="ident" id="3899311">noBodyExpected</span><span class="op" id="3899325">(</span><span class="ident" id="3899326">requestMethod</span>&nbsp;<span class="builtintype" id="3899340">string</span><span class="op" id="3899346">)</span>&nbsp;<span class="builtintype" id="3899348">bool</span>&nbsp;<span class="op" id="3899353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899356">return</span>&nbsp;<span class="ident" id="3899363"><a href="/net/http/transfer.go.html#3899326">requestMethod</a></span>&nbsp;<span class="op" id="3899377">==</span>&nbsp;<span class="string" id="3899380">&#34;HEAD&#34;</span><br>
<span class="lineno"></span><span class="op" id="3899387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3899390">func</span>&nbsp;<span class="op" id="3899395">(</span><span class="ident" id="3899396">t</span>&nbsp;<span class="op" id="3899398">*</span><span class="ident" id="3899399"><a href="/net/http/transfer.go.html#3896860">transferWriter</a></span><span class="op" id="3899413">)</span>&nbsp;<span class="ident" id="3899415">shouldSendContentLength</span><span class="op" id="3899438">(</span><span class="op" id="3899439">)</span>&nbsp;<span class="builtintype" id="3899441">bool</span>&nbsp;<span class="op" id="3899446">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899449">if</span>&nbsp;<span class="ident" id="3899452"><a href="/net/http/transfer.go.html#3906289">chunked</a></span><span class="op" id="3899459">(</span><span class="ident" id="3899460"><a href="/net/http/transfer.go.html#3899396">t</a></span><span class="op" id="3899461">.</span><span class="ident" id="3899462">TransferEncoding</span><span class="op" id="3899478">)</span>&nbsp;<span class="op" id="3899480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899484">return</span>&nbsp;<span class="ident" id="3899491">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899501">if</span>&nbsp;<span class="ident" id="3899504"><a href="/net/http/transfer.go.html#3899396">t</a></span><span class="op" id="3899505">.</span><span class="ident" id="3899506">ContentLength</span>&nbsp;<span class="op" id="3899520">&gt;</span>&nbsp;<span class="num" id="3899522">0</span>&nbsp;<span class="op" id="3899524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899528">return</span>&nbsp;<span class="ident" id="3899535">true</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3899544">//&nbsp;Many&nbsp;servers&nbsp;expect&nbsp;a&nbsp;Content-Length&nbsp;for&nbsp;these&nbsp;methods</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899603">if</span>&nbsp;<span class="ident" id="3899606"><a href="/net/http/transfer.go.html#3899396">t</a></span><span class="op" id="3899607">.</span><span class="ident" id="3899608">Method</span>&nbsp;<span class="op" id="3899615">==</span>&nbsp;<span class="string" id="3899618">&#34;POST&#34;</span>&nbsp;<span class="op" id="3899625">||</span>&nbsp;<span class="ident" id="3899628"><a href="/net/http/transfer.go.html#3899396">t</a></span><span class="op" id="3899629">.</span><span class="ident" id="3899630">Method</span>&nbsp;<span class="op" id="3899637">==</span>&nbsp;<span class="string" id="3899640">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3899646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899650">return</span>&nbsp;<span class="ident" id="3899657">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899663">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899666">if</span>&nbsp;<span class="ident" id="3899669"><a href="/net/http/transfer.go.html#3899396">t</a></span><span class="op" id="3899670">.</span><span class="ident" id="3899671">ContentLength</span>&nbsp;<span class="op" id="3899685">==</span>&nbsp;<span class="num" id="3899688">0</span>&nbsp;<span class="op" id="3899690">&amp;&amp;</span>&nbsp;<span class="ident" id="3899693"><a href="/net/http/transfer.go.html#3906423">isIdentity</a></span><span class="op" id="3899703">(</span><span class="ident" id="3899704"><a href="/net/http/transfer.go.html#3899396">t</a></span><span class="op" id="3899705">.</span><span class="ident" id="3899706">TransferEncoding</span><span class="op" id="3899722">)</span>&nbsp;<span class="op" id="3899724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899728">return</span>&nbsp;<span class="ident" id="3899735">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899745">return</span>&nbsp;<span class="ident" id="3899752">false</span><br>
<span class="lineno">150</span><span class="op" id="3899758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3899761">func</span>&nbsp;<span class="op" id="3899766">(</span><span class="ident" id="3899767">t</span>&nbsp;<span class="op" id="3899769">*</span><span class="ident" id="3899770"><a href="/net/http/transfer.go.html#3896860">transferWriter</a></span><span class="op" id="3899784">)</span>&nbsp;<span class="ident" id="3899786">WriteHeader</span><span class="op" id="3899797">(</span><span class="ident" id="3899798">w</span>&nbsp;<span class="ident" id="3899800"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3899802">.</span><span class="ident" id="3899803">Writer</span><span class="op" id="3899809">)</span>&nbsp;<span class="builtintype" id="3899811">error</span>&nbsp;<span class="op" id="3899817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899820">if</span>&nbsp;<span class="ident" id="3899823"><a href="/net/http/transfer.go.html#3899767">t</a></span><span class="op" id="3899824">.</span><span class="ident" id="3899825">Close</span>&nbsp;<span class="op" id="3899831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899835">if</span>&nbsp;<span class="ident" id="3899838">_</span><span class="op" id="3899839">,</span>&nbsp;<span class="ident" id="3899841">err</span>&nbsp;<span class="op" id="3899845">:=</span>&nbsp;<span class="ident" id="3899848"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3899850">.</span><span class="ident" id="3899851">WriteString</span><span class="op" id="3899862">(</span><span class="ident" id="3899863"><a href="/net/http/transfer.go.html#3899798">w</a></span><span class="op" id="3899864">,</span>&nbsp;<span class="string" id="3899866">&#34;Connection:&nbsp;close\r\n&#34;</span><span class="op" id="3899889">)</span><span class="op" id="3899890">;</span>&nbsp;<span class="ident" id="3899892"><a href="/net/http/transfer.go.html#3899841">err</a></span>&nbsp;<span class="op" id="3899896">!=</span>&nbsp;<span class="ident" id="3899899">nil</span>&nbsp;<span class="op" id="3899903">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899908">return</span>&nbsp;<span class="ident" id="3899915"><a href="/net/http/transfer.go.html#3899841">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3899928">//&nbsp;Write&nbsp;Content-Length&nbsp;and/or&nbsp;Transfer-Encoding&nbsp;whose&nbsp;values&nbsp;are&nbsp;a</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3899997">//&nbsp;function&nbsp;of&nbsp;the&nbsp;sanitized&nbsp;field&nbsp;triple&nbsp;(Body,&nbsp;ContentLength,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3900062">//&nbsp;TransferEncoding)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900084">if</span>&nbsp;<span class="ident" id="3900087"><a href="/net/http/transfer.go.html#3899767">t</a></span><span class="op" id="3900088">.</span><span class="ident" id="3900089">shouldSendContentLength</span><span class="op" id="3900112">(</span><span class="op" id="3900113">)</span>&nbsp;<span class="op" id="3900115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900119">if</span>&nbsp;<span class="ident" id="3900122">_</span><span class="op" id="3900123">,</span>&nbsp;<span class="ident" id="3900125">err</span>&nbsp;<span class="op" id="3900129">:=</span>&nbsp;<span class="ident" id="3900132"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3900134">.</span><span class="ident" id="3900135">WriteString</span><span class="op" id="3900146">(</span><span class="ident" id="3900147"><a href="/net/http/transfer.go.html#3899798">w</a></span><span class="op" id="3900148">,</span>&nbsp;<span class="string" id="3900150">&#34;Content-Length:&nbsp;&#34;</span><span class="op" id="3900168">)</span><span class="op" id="3900169">;</span>&nbsp;<span class="ident" id="3900171"><a href="/net/http/transfer.go.html#3900125">err</a></span>&nbsp;<span class="op" id="3900175">!=</span>&nbsp;<span class="ident" id="3900178">nil</span>&nbsp;<span class="op" id="3900182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900187">return</span>&nbsp;<span class="ident" id="3900194"><a href="/net/http/transfer.go.html#3900125">err</a></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900204">if</span>&nbsp;<span class="ident" id="3900207">_</span><span class="op" id="3900208">,</span>&nbsp;<span class="ident" id="3900210">err</span>&nbsp;<span class="op" id="3900214">:=</span>&nbsp;<span class="ident" id="3900217"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3900219">.</span><span class="ident" id="3900220">WriteString</span><span class="op" id="3900231">(</span><span class="ident" id="3900232"><a href="/net/http/transfer.go.html#3899798">w</a></span><span class="op" id="3900233">,</span>&nbsp;<span class="ident" id="3900235"><a href="/net/http/transfer.go.html#3896332">strconv</a></span><span class="op" id="3900242">.</span><span class="ident" id="3900243">FormatInt</span><span class="op" id="3900252">(</span><span class="ident" id="3900253"><a href="/net/http/transfer.go.html#3899767">t</a></span><span class="op" id="3900254">.</span><span class="ident" id="3900255">ContentLength</span><span class="op" id="3900268">,</span>&nbsp;<span class="num" id="3900270">10</span><span class="op" id="3900272">)</span><span class="op" id="3900273">+</span><span class="string" id="3900274">&#34;\r\n&#34;</span><span class="op" id="3900280">)</span><span class="op" id="3900281">;</span>&nbsp;<span class="ident" id="3900283"><a href="/net/http/transfer.go.html#3900210">err</a></span>&nbsp;<span class="op" id="3900287">!=</span>&nbsp;<span class="ident" id="3900290">nil</span>&nbsp;<span class="op" id="3900294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900299">return</span>&nbsp;<span class="ident" id="3900306"><a href="/net/http/transfer.go.html#3900210">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900315">}</span>&nbsp;<span class="keyword" id="3900317">else</span>&nbsp;<span class="keyword" id="3900322">if</span>&nbsp;<span class="ident" id="3900325"><a href="/net/http/transfer.go.html#3906289">chunked</a></span><span class="op" id="3900332">(</span><span class="ident" id="3900333"><a href="/net/http/transfer.go.html#3899767">t</a></span><span class="op" id="3900334">.</span><span class="ident" id="3900335">TransferEncoding</span><span class="op" id="3900351">)</span>&nbsp;<span class="op" id="3900353">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900357">if</span>&nbsp;<span class="ident" id="3900360">_</span><span class="op" id="3900361">,</span>&nbsp;<span class="ident" id="3900363">err</span>&nbsp;<span class="op" id="3900367">:=</span>&nbsp;<span class="ident" id="3900370"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3900372">.</span><span class="ident" id="3900373">WriteString</span><span class="op" id="3900384">(</span><span class="ident" id="3900385"><a href="/net/http/transfer.go.html#3899798">w</a></span><span class="op" id="3900386">,</span>&nbsp;<span class="string" id="3900388">&#34;Transfer-Encoding:&nbsp;chunked\r\n&#34;</span><span class="op" id="3900420">)</span><span class="op" id="3900421">;</span>&nbsp;<span class="ident" id="3900423"><a href="/net/http/transfer.go.html#3900363">err</a></span>&nbsp;<span class="op" id="3900427">!=</span>&nbsp;<span class="ident" id="3900430">nil</span>&nbsp;<span class="op" id="3900434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900439">return</span>&nbsp;<span class="ident" id="3900446"><a href="/net/http/transfer.go.html#3900363">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3900459">//&nbsp;Write&nbsp;Trailer&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900484">if</span>&nbsp;<span class="ident" id="3900487"><a href="/net/http/transfer.go.html#3899767">t</a></span><span class="op" id="3900488">.</span><span class="ident" id="3900489">Trailer</span>&nbsp;<span class="op" id="3900497">!=</span>&nbsp;<span class="ident" id="3900500">nil</span>&nbsp;<span class="op" id="3900504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900508">keys</span>&nbsp;<span class="op" id="3900513">:=</span>&nbsp;<span class="builtinfunc" id="3900516">make</span><span class="op" id="3900520">(</span><span class="op" id="3900521">[</span><span class="op" id="3900522">]</span><span class="builtintype" id="3900523">string</span><span class="op" id="3900529">,</span>&nbsp;<span class="num" id="3900531">0</span><span class="op" id="3900532">,</span>&nbsp;<span class="builtinfunc" id="3900534">len</span><span class="op" id="3900537">(</span><span class="ident" id="3900538"><a href="/net/http/transfer.go.html#3899767">t</a></span><span class="op" id="3900539">.</span><span class="ident" id="3900540">Trailer</span><span class="op" id="3900547">)</span><span class="op" id="3900548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900552">for</span>&nbsp;<span class="ident" id="3900556">k</span>&nbsp;<span class="op" id="3900558">:=</span>&nbsp;<span class="keyword" id="3900561">range</span>&nbsp;<span class="ident" id="3900567"><a href="/net/http/transfer.go.html#3899767">t</a></span><span class="op" id="3900568">.</span><span class="ident" id="3900569">Trailer</span>&nbsp;<span class="op" id="3900577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900582"><a href="/net/http/transfer.go.html#3900556">k</a></span>&nbsp;<span class="op" id="3900584">=</span>&nbsp;<span class="ident" id="3900586"><a href="/net/http/header.go.html#3785696">CanonicalHeaderKey</a></span><span class="op" id="3900604">(</span><span class="ident" id="3900605"><a href="/net/http/transfer.go.html#3900556">k</a></span><span class="op" id="3900606">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900611">switch</span>&nbsp;<span class="ident" id="3900618"><a href="/net/http/transfer.go.html#3900556">k</a></span>&nbsp;<span class="op" id="3900620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900625">case</span>&nbsp;<span class="string" id="3900630">&#34;Transfer-Encoding&#34;</span><span class="op" id="3900649">,</span>&nbsp;<span class="string" id="3900651">&#34;Trailer&#34;</span><span class="op" id="3900660">,</span>&nbsp;<span class="string" id="3900662">&#34;Content-Length&#34;</span><span class="op" id="3900678">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900684">return</span>&nbsp;<span class="op" id="3900691">&amp;</span><span class="ident" id="3900692"><a href="/net/http/request.go.html#3790712">badStringError</a></span><span class="op" id="3900706">{</span><span class="string" id="3900707">&#34;invalid&nbsp;Trailer&nbsp;key&#34;</span><span class="op" id="3900728">,</span>&nbsp;<span class="ident" id="3900730"><a href="/net/http/transfer.go.html#3900556">k</a></span><span class="op" id="3900731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900741"><a href="/net/http/transfer.go.html#3900508">keys</a></span>&nbsp;<span class="op" id="3900746">=</span>&nbsp;<span class="builtinfunc" id="3900748">append</span><span class="op" id="3900754">(</span><span class="ident" id="3900755"><a href="/net/http/transfer.go.html#3900508">keys</a></span><span class="op" id="3900759">,</span>&nbsp;<span class="ident" id="3900761"><a href="/net/http/transfer.go.html#3900556">k</a></span><span class="op" id="3900762">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3900766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900770">if</span>&nbsp;<span class="builtinfunc" id="3900773">len</span><span class="op" id="3900776">(</span><span class="ident" id="3900777"><a href="/net/http/transfer.go.html#3900508">keys</a></span><span class="op" id="3900781">)</span>&nbsp;<span class="op" id="3900783">&gt;</span>&nbsp;<span class="num" id="3900785">0</span>&nbsp;<span class="op" id="3900787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3900792"><a href="/net/http/transfer.go.html#3896324">sort</a></span><span class="op" id="3900796">.</span><span class="ident" id="3900797">Strings</span><span class="op" id="3900804">(</span><span class="ident" id="3900805"><a href="/net/http/transfer.go.html#3900508">keys</a></span><span class="op" id="3900809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3900814">//&nbsp;TODO:&nbsp;could&nbsp;do&nbsp;better&nbsp;allocation-wise&nbsp;here,&nbsp;but&nbsp;trailers&nbsp;are&nbsp;rare,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3900887">//&nbsp;so&nbsp;being&nbsp;lazy&nbsp;for&nbsp;now.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3900916">if</span>&nbsp;<span class="ident" id="3900919">_</span><span class="op" id="3900920">,</span>&nbsp;<span class="ident" id="3900922">err</span>&nbsp;<span class="op" id="3900926">:=</span>&nbsp;<span class="ident" id="3900929"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3900931">.</span><span class="ident" id="3900932">WriteString</span><span class="op" id="3900943">(</span><span class="ident" id="3900944"><a href="/net/http/transfer.go.html#3899798">w</a></span><span class="op" id="3900945">,</span>&nbsp;<span class="string" id="3900947">&#34;Trailer:&nbsp;&#34;</span><span class="op" id="3900958">+</span><span class="ident" id="3900959"><a href="/net/http/transfer.go.html#3896343">strings</a></span><span class="op" id="3900966">.</span><span class="ident" id="3900967">Join</span><span class="op" id="3900971">(</span><span class="ident" id="3900972"><a href="/net/http/transfer.go.html#3900508">keys</a></span><span class="op" id="3900976">,</span>&nbsp;<span class="string" id="3900978">&#34;,&#34;</span><span class="op" id="3900981">)</span><span class="op" id="3900982">+</span><span class="string" id="3900983">&#34;\r\n&#34;</span><span class="op" id="3900989">)</span><span class="op" id="3900990">;</span>&nbsp;<span class="ident" id="3900992"><a href="/net/http/transfer.go.html#3900922">err</a></span>&nbsp;<span class="op" id="3900996">!=</span>&nbsp;<span class="ident" id="3900999">nil</span>&nbsp;<span class="op" id="3901003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901009">return</span>&nbsp;<span class="ident" id="3901016"><a href="/net/http/transfer.go.html#3900922">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901030">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901034">return</span>&nbsp;<span class="ident" id="3901041">nil</span><br>
<span class="lineno"></span><span class="op" id="3901045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3901048">func</span>&nbsp;<span class="op" id="3901053">(</span><span class="ident" id="3901054">t</span>&nbsp;<span class="op" id="3901056">*</span><span class="ident" id="3901057"><a href="/net/http/transfer.go.html#3896860">transferWriter</a></span><span class="op" id="3901071">)</span>&nbsp;<span class="ident" id="3901073">WriteBody</span><span class="op" id="3901082">(</span><span class="ident" id="3901083">w</span>&nbsp;<span class="ident" id="3901085"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3901087">.</span><span class="ident" id="3901088">Writer</span><span class="op" id="3901094">)</span>&nbsp;<span class="builtintype" id="3901096">error</span>&nbsp;<span class="op" id="3901102">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901105">var</span>&nbsp;<span class="ident" id="3901109">err</span>&nbsp;<span class="builtintype" id="3901113">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901120">var</span>&nbsp;<span class="ident" id="3901124">ncopy</span>&nbsp;<span class="ident" id="3901130">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3901138">//&nbsp;Write&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901153">if</span>&nbsp;<span class="ident" id="3901156"><a href="/net/http/transfer.go.html#3901054">t</a></span><span class="op" id="3901157">.</span><span class="ident" id="3901158">Body</span>&nbsp;<span class="op" id="3901163">!=</span>&nbsp;<span class="ident" id="3901166">nil</span>&nbsp;<span class="op" id="3901170">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901174">if</span>&nbsp;<span class="ident" id="3901177"><a href="/net/http/transfer.go.html#3906289">chunked</a></span><span class="op" id="3901184">(</span><span class="ident" id="3901185"><a href="/net/http/transfer.go.html#3901054">t</a></span><span class="op" id="3901186">.</span><span class="ident" id="3901187">TransferEncoding</span><span class="op" id="3901203">)</span>&nbsp;<span class="op" id="3901205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901210">cw</span>&nbsp;<span class="op" id="3901213">:=</span>&nbsp;<span class="ident" id="3901216"><a href="/net/http/transfer.go.html#3896286">internal</a></span><span class="op" id="3901224">.</span><span class="ident" id="3901225">NewChunkedWriter</span><span class="op" id="3901241">(</span><span class="ident" id="3901242"><a href="/net/http/transfer.go.html#3901083">w</a></span><span class="op" id="3901243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901248">_</span><span class="op" id="3901249">,</span>&nbsp;<span class="ident" id="3901251"><a href="/net/http/transfer.go.html#3901109">err</a></span>&nbsp;<span class="op" id="3901255">=</span>&nbsp;<span class="ident" id="3901257"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3901259">.</span><span class="ident" id="3901260">Copy</span><span class="op" id="3901264">(</span><span class="ident" id="3901265"><a href="/net/http/transfer.go.html#3901210">cw</a></span><span class="op" id="3901267">,</span>&nbsp;<span class="ident" id="3901269"><a href="/net/http/transfer.go.html#3901054">t</a></span><span class="op" id="3901270">.</span><span class="ident" id="3901271">Body</span><span class="op" id="3901275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901280">if</span>&nbsp;<span class="ident" id="3901283"><a href="/net/http/transfer.go.html#3901109">err</a></span>&nbsp;<span class="op" id="3901287">==</span>&nbsp;<span class="ident" id="3901290">nil</span>&nbsp;<span class="op" id="3901294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901300"><a href="/net/http/transfer.go.html#3901109">err</a></span>&nbsp;<span class="op" id="3901304">=</span>&nbsp;<span class="ident" id="3901306"><a href="/net/http/transfer.go.html#3901210">cw</a></span><span class="op" id="3901308">.</span><span class="ident" id="3901309">Close</span><span class="op" id="3901314">(</span><span class="op" id="3901315">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901324">}</span>&nbsp;<span class="keyword" id="3901326">else</span>&nbsp;<span class="keyword" id="3901331">if</span>&nbsp;<span class="ident" id="3901334"><a href="/net/http/transfer.go.html#3901054">t</a></span><span class="op" id="3901335">.</span><span class="ident" id="3901336">ContentLength</span>&nbsp;<span class="op" id="3901350">==</span>&nbsp;<span class="op" id="3901353">-</span><span class="num" id="3901354">1</span>&nbsp;<span class="op" id="3901356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901361"><a href="/net/http/transfer.go.html#3901124">ncopy</a></span><span class="op" id="3901366">,</span>&nbsp;<span class="ident" id="3901368"><a href="/net/http/transfer.go.html#3901109">err</a></span>&nbsp;<span class="op" id="3901372">=</span>&nbsp;<span class="ident" id="3901374"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3901376">.</span><span class="ident" id="3901377">Copy</span><span class="op" id="3901381">(</span><span class="ident" id="3901382"><a href="/net/http/transfer.go.html#3901083">w</a></span><span class="op" id="3901383">,</span>&nbsp;<span class="ident" id="3901385"><a href="/net/http/transfer.go.html#3901054">t</a></span><span class="op" id="3901386">.</span><span class="ident" id="3901387">Body</span><span class="op" id="3901391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901395">}</span>&nbsp;<span class="keyword" id="3901397">else</span>&nbsp;<span class="op" id="3901402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901407"><a href="/net/http/transfer.go.html#3901124">ncopy</a></span><span class="op" id="3901412">,</span>&nbsp;<span class="ident" id="3901414"><a href="/net/http/transfer.go.html#3901109">err</a></span>&nbsp;<span class="op" id="3901418">=</span>&nbsp;<span class="ident" id="3901420"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3901422">.</span><span class="ident" id="3901423">Copy</span><span class="op" id="3901427">(</span><span class="ident" id="3901428"><a href="/net/http/transfer.go.html#3901083">w</a></span><span class="op" id="3901429">,</span>&nbsp;<span class="ident" id="3901431"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3901433">.</span><span class="ident" id="3901434">LimitReader</span><span class="op" id="3901445">(</span><span class="ident" id="3901446"><a href="/net/http/transfer.go.html#3901054">t</a></span><span class="op" id="3901447">.</span><span class="ident" id="3901448">Body</span><span class="op" id="3901452">,</span>&nbsp;<span class="ident" id="3901454"><a href="/net/http/transfer.go.html#3901054">t</a></span><span class="op" id="3901455">.</span><span class="ident" id="3901456">ContentLength</span><span class="op" id="3901469">)</span><span class="op" id="3901470">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901475">if</span>&nbsp;<span class="ident" id="3901478"><a href="/net/http/transfer.go.html#3901109">err</a></span>&nbsp;<span class="op" id="3901482">!=</span>&nbsp;<span class="ident" id="3901485">nil</span>&nbsp;<span class="op" id="3901489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901495">return</span>&nbsp;<span class="ident" id="3901502"><a href="/net/http/transfer.go.html#3901109">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901514">var</span>&nbsp;<span class="ident" id="3901518">nextra</span>&nbsp;<span class="ident" id="3901525">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901534"><a href="/net/http/transfer.go.html#3901518">nextra</a></span><span class="op" id="3901540">,</span>&nbsp;<span class="ident" id="3901542"><a href="/net/http/transfer.go.html#3901109">err</a></span>&nbsp;<span class="op" id="3901546">=</span>&nbsp;<span class="ident" id="3901548"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3901550">.</span><span class="ident" id="3901551">Copy</span><span class="op" id="3901555">(</span><span class="ident" id="3901556"><a href="/net/http/transfer.go.html#3896273">ioutil</a></span><span class="op" id="3901562">.</span><span class="ident" id="3901563">Discard</span><span class="op" id="3901570">,</span>&nbsp;<span class="ident" id="3901572"><a href="/net/http/transfer.go.html#3901054">t</a></span><span class="op" id="3901573">.</span><span class="ident" id="3901574">Body</span><span class="op" id="3901578">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901583"><a href="/net/http/transfer.go.html#3901124">ncopy</a></span>&nbsp;<span class="op" id="3901589">+=</span>&nbsp;<span class="ident" id="3901592"><a href="/net/http/transfer.go.html#3901518">nextra</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901605">if</span>&nbsp;<span class="ident" id="3901608"><a href="/net/http/transfer.go.html#3901109">err</a></span>&nbsp;<span class="op" id="3901612">!=</span>&nbsp;<span class="ident" id="3901615">nil</span>&nbsp;<span class="op" id="3901619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901624">return</span>&nbsp;<span class="ident" id="3901631"><a href="/net/http/transfer.go.html#3901109">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901637">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901641">if</span>&nbsp;<span class="ident" id="3901644"><a href="/net/http/transfer.go.html#3901109">err</a></span>&nbsp;<span class="op" id="3901648">=</span>&nbsp;<span class="ident" id="3901650"><a href="/net/http/transfer.go.html#3901054">t</a></span><span class="op" id="3901651">.</span><span class="ident" id="3901652">BodyCloser</span><span class="op" id="3901662">.</span><span class="ident" id="3901663">Close</span><span class="op" id="3901668">(</span><span class="op" id="3901669">)</span><span class="op" id="3901670">;</span>&nbsp;<span class="ident" id="3901672"><a href="/net/http/transfer.go.html#3901109">err</a></span>&nbsp;<span class="op" id="3901676">!=</span>&nbsp;<span class="ident" id="3901679">nil</span>&nbsp;<span class="op" id="3901683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901688">return</span>&nbsp;<span class="ident" id="3901695"><a href="/net/http/transfer.go.html#3901109">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901708">if</span>&nbsp;<span class="op" id="3901711">!</span><span class="ident" id="3901712"><a href="/net/http/transfer.go.html#3901054">t</a></span><span class="op" id="3901713">.</span><span class="ident" id="3901714">ResponseToHEAD</span>&nbsp;<span class="op" id="3901729">&amp;&amp;</span>&nbsp;<span class="ident" id="3901732"><a href="/net/http/transfer.go.html#3901054">t</a></span><span class="op" id="3901733">.</span><span class="ident" id="3901734">ContentLength</span>&nbsp;<span class="op" id="3901748">!=</span>&nbsp;<span class="op" id="3901751">-</span><span class="num" id="3901752">1</span>&nbsp;<span class="op" id="3901754">&amp;&amp;</span>&nbsp;<span class="ident" id="3901757"><a href="/net/http/transfer.go.html#3901054">t</a></span><span class="op" id="3901758">.</span><span class="ident" id="3901759">ContentLength</span>&nbsp;<span class="op" id="3901773">!=</span>&nbsp;<span class="ident" id="3901776"><a href="/net/http/transfer.go.html#3901124">ncopy</a></span>&nbsp;<span class="op" id="3901782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901786">return</span>&nbsp;<span class="ident" id="3901793"><a href="/net/http/transfer.go.html#3896260">fmt</a></span><span class="op" id="3901796">.</span><span class="ident" id="3901797">Errorf</span><span class="op" id="3901803">(</span><span class="string" id="3901804">&#34;http:&nbsp;ContentLength=%d&nbsp;with&nbsp;Body&nbsp;length&nbsp;%d&#34;</span><span class="op" id="3901848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3901853"><a href="/net/http/transfer.go.html#3901054">t</a></span><span class="op" id="3901854">.</span><span class="ident" id="3901855">ContentLength</span><span class="op" id="3901868">,</span>&nbsp;<span class="ident" id="3901870"><a href="/net/http/transfer.go.html#3901124">ncopy</a></span><span class="op" id="3901875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3901878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3901882">//&nbsp;TODO(petar):&nbsp;Place&nbsp;trailer&nbsp;writer&nbsp;code&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901931">if</span>&nbsp;<span class="ident" id="3901934"><a href="/net/http/transfer.go.html#3906289">chunked</a></span><span class="op" id="3901941">(</span><span class="ident" id="3901942"><a href="/net/http/transfer.go.html#3901054">t</a></span><span class="op" id="3901943">.</span><span class="ident" id="3901944">TransferEncoding</span><span class="op" id="3901960">)</span>&nbsp;<span class="op" id="3901962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3901966">//&nbsp;Write&nbsp;Trailer&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3901992">if</span>&nbsp;<span class="ident" id="3901995"><a href="/net/http/transfer.go.html#3901054">t</a></span><span class="op" id="3901996">.</span><span class="ident" id="3901997">Trailer</span>&nbsp;<span class="op" id="3902005">!=</span>&nbsp;<span class="ident" id="3902008">nil</span>&nbsp;<span class="op" id="3902012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902017">if</span>&nbsp;<span class="ident" id="3902020">err</span>&nbsp;<span class="op" id="3902024">:=</span>&nbsp;<span class="ident" id="3902027"><a href="/net/http/transfer.go.html#3901054">t</a></span><span class="op" id="3902028">.</span><span class="ident" id="3902029">Trailer</span><span class="op" id="3902036">.</span><span class="ident" id="3902037">Write</span><span class="op" id="3902042">(</span><span class="ident" id="3902043"><a href="/net/http/transfer.go.html#3901083">w</a></span><span class="op" id="3902044">)</span><span class="op" id="3902045">;</span>&nbsp;<span class="ident" id="3902047"><a href="/net/http/transfer.go.html#3902020">err</a></span>&nbsp;<span class="op" id="3902051">!=</span>&nbsp;<span class="ident" id="3902054">nil</span>&nbsp;<span class="op" id="3902058">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902064">return</span>&nbsp;<span class="ident" id="3902071"><a href="/net/http/transfer.go.html#3902020">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3902078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3902082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3902086">//&nbsp;Last&nbsp;chunk,&nbsp;empty&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902117">_</span><span class="op" id="3902118">,</span>&nbsp;<span class="ident" id="3902120"><a href="/net/http/transfer.go.html#3901109">err</a></span>&nbsp;<span class="op" id="3902124">=</span>&nbsp;<span class="ident" id="3902126"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3902128">.</span><span class="ident" id="3902129">WriteString</span><span class="op" id="3902140">(</span><span class="ident" id="3902141"><a href="/net/http/transfer.go.html#3901083">w</a></span><span class="op" id="3902142">,</span>&nbsp;<span class="string" id="3902144">&#34;\r\n&#34;</span><span class="op" id="3902150">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3902153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902156">return</span>&nbsp;<span class="ident" id="3902163"><a href="/net/http/transfer.go.html#3901109">err</a></span><br>
<span class="lineno"></span><span class="op" id="3902167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3902170">type</span>&nbsp;<span class="ident" id="3902175">transferReader</span>&nbsp;<span class="keyword" id="3902190">struct</span>&nbsp;<span class="op" id="3902197">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3902200">//&nbsp;Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902210">Header</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3902224"><a href="/net/http/header.go.html#3781581">Header</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902232">StatusCode</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3902246">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902251">RequestMethod</span>&nbsp;<span class="builtintype" id="3902265">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902273">ProtoMajor</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3902287">int</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902292">ProtoMinor</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3902306">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3902311">//&nbsp;Output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902322">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3902339"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3902341">.</span><span class="ident" id="3902342">ReadCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902354">ContentLength</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3902371">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902378">TransferEncoding</span>&nbsp;<span class="op" id="3902395">[</span><span class="op" id="3902396">]</span><span class="builtintype" id="3902397">string</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902405">Close</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3902422">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902428">Trailer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3902445"><a href="/net/http/header.go.html#3781581">Header</a></span><br>
<span class="lineno"></span><span class="op" id="3902452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3902455">//&nbsp;bodyAllowedForStatus&nbsp;reports&nbsp;whether&nbsp;a&nbsp;given&nbsp;response&nbsp;status&nbsp;code</span><br>
<span class="lineno">265</span><span class="comment" id="3902524">//&nbsp;permits&nbsp;a&nbsp;body.&nbsp;&nbsp;See&nbsp;RFC2616,&nbsp;section&nbsp;4.4.</span><br>
<span class="lineno"></span><span class="keyword" id="3902570">func</span>&nbsp;<span class="ident" id="3902575">bodyAllowedForStatus</span><span class="op" id="3902595">(</span><span class="ident" id="3902596">status</span>&nbsp;<span class="builtintype" id="3902603">int</span><span class="op" id="3902606">)</span>&nbsp;<span class="builtintype" id="3902608">bool</span>&nbsp;<span class="op" id="3902613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902616">switch</span>&nbsp;<span class="op" id="3902623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902626">case</span>&nbsp;<span class="ident" id="3902631"><a href="/net/http/transfer.go.html#3902596">status</a></span>&nbsp;<span class="op" id="3902638">&gt;=</span>&nbsp;<span class="num" id="3902641">100</span>&nbsp;<span class="op" id="3902645">&amp;&amp;</span>&nbsp;<span class="ident" id="3902648"><a href="/net/http/transfer.go.html#3902596">status</a></span>&nbsp;<span class="op" id="3902655">&lt;=</span>&nbsp;<span class="num" id="3902658">199</span><span class="op" id="3902661">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902665">return</span>&nbsp;<span class="ident" id="3902672">false</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902679">case</span>&nbsp;<span class="ident" id="3902684"><a href="/net/http/transfer.go.html#3902596">status</a></span>&nbsp;<span class="op" id="3902691">==</span>&nbsp;<span class="num" id="3902694">204</span><span class="op" id="3902697">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902701">return</span>&nbsp;<span class="ident" id="3902708">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902715">case</span>&nbsp;<span class="ident" id="3902720"><a href="/net/http/transfer.go.html#3902596">status</a></span>&nbsp;<span class="op" id="3902727">==</span>&nbsp;<span class="num" id="3902730">304</span><span class="op" id="3902733">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902737">return</span>&nbsp;<span class="ident" id="3902744">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3902751">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902754">return</span>&nbsp;<span class="ident" id="3902761">true</span><br>
<span class="lineno"></span><span class="op" id="3902766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3902769">var</span>&nbsp;<span class="op" id="3902773">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902776">suppressedHeaders304</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3902800">=</span>&nbsp;<span class="op" id="3902802">[</span><span class="op" id="3902803">]</span><span class="builtintype" id="3902804">string</span><span class="op" id="3902810">{</span><span class="string" id="3902811">&#34;Content-Type&#34;</span><span class="op" id="3902825">,</span>&nbsp;<span class="string" id="3902827">&#34;Content-Length&#34;</span><span class="op" id="3902843">,</span>&nbsp;<span class="string" id="3902845">&#34;Transfer-Encoding&#34;</span><span class="op" id="3902864">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3902867">suppressedHeadersNoBody</span>&nbsp;<span class="op" id="3902891">=</span>&nbsp;<span class="op" id="3902893">[</span><span class="op" id="3902894">]</span><span class="builtintype" id="3902895">string</span><span class="op" id="3902901">{</span><span class="string" id="3902902">&#34;Content-Length&#34;</span><span class="op" id="3902918">,</span>&nbsp;<span class="string" id="3902920">&#34;Transfer-Encoding&#34;</span><span class="op" id="3902939">}</span><br>
<span class="lineno"></span><span class="op" id="3902941">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3902944">func</span>&nbsp;<span class="ident" id="3902949">suppressedHeaders</span><span class="op" id="3902966">(</span><span class="ident" id="3902967">status</span>&nbsp;<span class="builtintype" id="3902974">int</span><span class="op" id="3902977">)</span>&nbsp;<span class="op" id="3902979">[</span><span class="op" id="3902980">]</span><span class="builtintype" id="3902981">string</span>&nbsp;<span class="op" id="3902988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3902991">switch</span>&nbsp;<span class="op" id="3902998">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903001">case</span>&nbsp;<span class="ident" id="3903006"><a href="/net/http/transfer.go.html#3902967">status</a></span>&nbsp;<span class="op" id="3903013">==</span>&nbsp;<span class="num" id="3903016">304</span><span class="op" id="3903019">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3903023">//&nbsp;RFC&nbsp;2616&nbsp;section&nbsp;10.3.5:&nbsp;&#34;the&nbsp;response&nbsp;MUST&nbsp;NOT&nbsp;include&nbsp;other&nbsp;entity-headers&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903106">return</span>&nbsp;<span class="ident" id="3903113"><a href="/net/http/transfer.go.html#3902776">suppressedHeaders304</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903135">case</span>&nbsp;<span class="op" id="3903140">!</span><span class="ident" id="3903141"><a href="/net/http/transfer.go.html#3902575">bodyAllowedForStatus</a></span><span class="op" id="3903161">(</span><span class="ident" id="3903162"><a href="/net/http/transfer.go.html#3902967">status</a></span><span class="op" id="3903168">)</span><span class="op" id="3903169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903173">return</span>&nbsp;<span class="ident" id="3903180"><a href="/net/http/transfer.go.html#3902867">suppressedHeadersNoBody</a></span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3903205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903208">return</span>&nbsp;<span class="ident" id="3903215">nil</span><br>
<span class="lineno"></span><span class="op" id="3903219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3903222">//&nbsp;msg&nbsp;is&nbsp;*Request&nbsp;or&nbsp;*Response.</span><br>
<span class="lineno">295</span><span class="keyword" id="3903255">func</span>&nbsp;<span class="ident" id="3903260">readTransfer</span><span class="op" id="3903272">(</span><span class="ident" id="3903273">msg</span>&nbsp;<span class="keyword" id="3903277">interface</span><span class="op" id="3903286">{</span><span class="op" id="3903287">}</span><span class="op" id="3903288">,</span>&nbsp;<span class="ident" id="3903290">r</span>&nbsp;<span class="op" id="3903292">*</span><span class="ident" id="3903293"><a href="/net/http/transfer.go.html#3896232">bufio</a></span><span class="op" id="3903298">.</span><span class="ident" id="3903299">Reader</span><span class="op" id="3903305">)</span>&nbsp;<span class="op" id="3903307">(</span><span class="ident" id="3903308">err</span>&nbsp;<span class="builtintype" id="3903312">error</span><span class="op" id="3903317">)</span>&nbsp;<span class="op" id="3903319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3903322">t</span>&nbsp;<span class="op" id="3903324">:=</span>&nbsp;<span class="op" id="3903327">&amp;</span><span class="ident" id="3903328"><a href="/net/http/transfer.go.html#3902175">transferReader</a></span><span class="op" id="3903342">{</span><span class="ident" id="3903343">RequestMethod</span><span class="op" id="3903356">:</span>&nbsp;<span class="string" id="3903358">&#34;GET&#34;</span><span class="op" id="3903363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3903367">//&nbsp;Unify&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3903383">isResponse</span>&nbsp;<span class="op" id="3903394">:=</span>&nbsp;<span class="ident" id="3903397">false</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903404">switch</span>&nbsp;<span class="ident" id="3903411">rr</span>&nbsp;<span class="op" id="3903414">:=</span>&nbsp;<span class="ident" id="3903417"><a href="/net/http/transfer.go.html#3903273">msg</a></span><span class="op" id="3903420">.</span><span class="op" id="3903421">(</span><span class="keyword" id="3903422">type</span><span class="op" id="3903426">)</span>&nbsp;<span class="op" id="3903428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903431">case</span>&nbsp;<span class="op" id="3903436">*</span><span class="ident" id="3903437"><a href="/net/http/response.go.html#3816973">Response</a></span><span class="op" id="3903445">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3903449"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3903450">.</span><span class="ident" id="3903451">Header</span>&nbsp;<span class="op" id="3903458">=</span>&nbsp;<span class="ident" id="3903460"><a href="/net/http/transfer.go.html#3903411">rr</a></span><span class="op" id="3903462">.</span><span class="ident" id="3903463">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3903472"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3903473">.</span><span class="ident" id="3903474">StatusCode</span>&nbsp;<span class="op" id="3903485">=</span>&nbsp;<span class="ident" id="3903487"><a href="/net/http/transfer.go.html#3903411">rr</a></span><span class="op" id="3903489">.</span><span class="ident" id="3903490">StatusCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3903503"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3903504">.</span><span class="ident" id="3903505">ProtoMajor</span>&nbsp;<span class="op" id="3903516">=</span>&nbsp;<span class="ident" id="3903518"><a href="/net/http/transfer.go.html#3903411">rr</a></span><span class="op" id="3903520">.</span><span class="ident" id="3903521">ProtoMajor</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3903534"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3903535">.</span><span class="ident" id="3903536">ProtoMinor</span>&nbsp;<span class="op" id="3903547">=</span>&nbsp;<span class="ident" id="3903549"><a href="/net/http/transfer.go.html#3903411">rr</a></span><span class="op" id="3903551">.</span><span class="ident" id="3903552">ProtoMinor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3903565"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3903566">.</span><span class="ident" id="3903567">Close</span>&nbsp;<span class="op" id="3903573">=</span>&nbsp;<span class="ident" id="3903575"><a href="/net/http/transfer.go.html#3909011">shouldClose</a></span><span class="op" id="3903586">(</span><span class="ident" id="3903587"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3903588">.</span><span class="ident" id="3903589">ProtoMajor</span><span class="op" id="3903599">,</span>&nbsp;<span class="ident" id="3903601"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3903602">.</span><span class="ident" id="3903603">ProtoMinor</span><span class="op" id="3903613">,</span>&nbsp;<span class="ident" id="3903615"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3903616">.</span><span class="ident" id="3903617">Header</span><span class="op" id="3903623">,</span>&nbsp;<span class="ident" id="3903625">true</span><span class="op" id="3903629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3903633"><a href="/net/http/transfer.go.html#3903383">isResponse</a></span>&nbsp;<span class="op" id="3903644">=</span>&nbsp;<span class="ident" id="3903646">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903653">if</span>&nbsp;<span class="ident" id="3903656"><a href="/net/http/transfer.go.html#3903411">rr</a></span><span class="op" id="3903658">.</span><span class="ident" id="3903659">Request</span>&nbsp;<span class="op" id="3903667">!=</span>&nbsp;<span class="ident" id="3903670">nil</span>&nbsp;<span class="op" id="3903674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3903679"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3903680">.</span><span class="ident" id="3903681">RequestMethod</span>&nbsp;<span class="op" id="3903695">=</span>&nbsp;<span class="ident" id="3903697"><a href="/net/http/transfer.go.html#3903411">rr</a></span><span class="op" id="3903699">.</span><span class="ident" id="3903700">Request</span><span class="op" id="3903707">.</span><span class="ident" id="3903708">Method</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3903717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903720">case</span>&nbsp;<span class="op" id="3903725">*</span><span class="ident" id="3903726"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3903733">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3903737"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3903738">.</span><span class="ident" id="3903739">Header</span>&nbsp;<span class="op" id="3903746">=</span>&nbsp;<span class="ident" id="3903748"><a href="/net/http/transfer.go.html#3903411">rr</a></span><span class="op" id="3903750">.</span><span class="ident" id="3903751">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3903760"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3903761">.</span><span class="ident" id="3903762">ProtoMajor</span>&nbsp;<span class="op" id="3903773">=</span>&nbsp;<span class="ident" id="3903775"><a href="/net/http/transfer.go.html#3903411">rr</a></span><span class="op" id="3903777">.</span><span class="ident" id="3903778">ProtoMajor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3903791"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3903792">.</span><span class="ident" id="3903793">ProtoMinor</span>&nbsp;<span class="op" id="3903804">=</span>&nbsp;<span class="ident" id="3903806"><a href="/net/http/transfer.go.html#3903411">rr</a></span><span class="op" id="3903808">.</span><span class="ident" id="3903809">ProtoMinor</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3903822">//&nbsp;Transfer&nbsp;semantics&nbsp;for&nbsp;Requests&nbsp;are&nbsp;exactly&nbsp;like&nbsp;those&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3903886">//&nbsp;Responses&nbsp;with&nbsp;status&nbsp;code&nbsp;200,&nbsp;responding&nbsp;to&nbsp;a&nbsp;GET&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3903950"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3903951">.</span><span class="ident" id="3903952">StatusCode</span>&nbsp;<span class="op" id="3903963">=</span>&nbsp;<span class="num" id="3903965">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3903970">default</span><span class="op" id="3903977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3903981">panic</span><span class="op" id="3903986">(</span><span class="string" id="3903987">&#34;unexpected&nbsp;type&#34;</span><span class="op" id="3904004">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3904011">//&nbsp;Default&nbsp;to&nbsp;HTTP/1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904035">if</span>&nbsp;<span class="ident" id="3904038"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904039">.</span><span class="ident" id="3904040">ProtoMajor</span>&nbsp;<span class="op" id="3904051">==</span>&nbsp;<span class="num" id="3904054">0</span>&nbsp;<span class="op" id="3904056">&amp;&amp;</span>&nbsp;<span class="ident" id="3904059"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904060">.</span><span class="ident" id="3904061">ProtoMinor</span>&nbsp;<span class="op" id="3904072">==</span>&nbsp;<span class="num" id="3904075">0</span>&nbsp;<span class="op" id="3904077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3904081"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904082">.</span><span class="ident" id="3904083">ProtoMajor</span><span class="op" id="3904093">,</span>&nbsp;<span class="ident" id="3904095"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904096">.</span><span class="ident" id="3904097">ProtoMinor</span>&nbsp;<span class="op" id="3904108">=</span>&nbsp;<span class="num" id="3904110">1</span><span class="op" id="3904111">,</span>&nbsp;<span class="num" id="3904113">1</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3904120">//&nbsp;Transfer&nbsp;encoding,&nbsp;content&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3904158"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904159">.</span><span class="ident" id="3904160">TransferEncoding</span><span class="op" id="3904176">,</span>&nbsp;<span class="ident" id="3904178"><a href="/net/http/transfer.go.html#3903308">err</a></span>&nbsp;<span class="op" id="3904182">=</span>&nbsp;<span class="ident" id="3904184"><a href="/net/http/transfer.go.html#3906535">fixTransferEncoding</a></span><span class="op" id="3904203">(</span><span class="ident" id="3904204"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904205">.</span><span class="ident" id="3904206">RequestMethod</span><span class="op" id="3904219">,</span>&nbsp;<span class="ident" id="3904221"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904222">.</span><span class="ident" id="3904223">Header</span><span class="op" id="3904229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904232">if</span>&nbsp;<span class="ident" id="3904235"><a href="/net/http/transfer.go.html#3903308">err</a></span>&nbsp;<span class="op" id="3904239">!=</span>&nbsp;<span class="ident" id="3904242">nil</span>&nbsp;<span class="op" id="3904246">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904250">return</span>&nbsp;<span class="ident" id="3904257"><a href="/net/http/transfer.go.html#3903308">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3904266">realLength</span><span class="op" id="3904276">,</span>&nbsp;<span class="ident" id="3904278"><a href="/net/http/transfer.go.html#3903308">err</a></span>&nbsp;<span class="op" id="3904282">:=</span>&nbsp;<span class="ident" id="3904285"><a href="/net/http/transfer.go.html#3907894">fixLength</a></span><span class="op" id="3904294">(</span><span class="ident" id="3904295"><a href="/net/http/transfer.go.html#3903383">isResponse</a></span><span class="op" id="3904305">,</span>&nbsp;<span class="ident" id="3904307"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904308">.</span><span class="ident" id="3904309">StatusCode</span><span class="op" id="3904319">,</span>&nbsp;<span class="ident" id="3904321"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904322">.</span><span class="ident" id="3904323">RequestMethod</span><span class="op" id="3904336">,</span>&nbsp;<span class="ident" id="3904338"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904339">.</span><span class="ident" id="3904340">Header</span><span class="op" id="3904346">,</span>&nbsp;<span class="ident" id="3904348"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904349">.</span><span class="ident" id="3904350">TransferEncoding</span><span class="op" id="3904366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904369">if</span>&nbsp;<span class="ident" id="3904372"><a href="/net/http/transfer.go.html#3903308">err</a></span>&nbsp;<span class="op" id="3904376">!=</span>&nbsp;<span class="ident" id="3904379">nil</span>&nbsp;<span class="op" id="3904383">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904387">return</span>&nbsp;<span class="ident" id="3904394"><a href="/net/http/transfer.go.html#3903308">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904402">if</span>&nbsp;<span class="ident" id="3904405"><a href="/net/http/transfer.go.html#3903383">isResponse</a></span>&nbsp;<span class="op" id="3904416">&amp;&amp;</span>&nbsp;<span class="ident" id="3904419"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904420">.</span><span class="ident" id="3904421">RequestMethod</span>&nbsp;<span class="op" id="3904435">==</span>&nbsp;<span class="string" id="3904438">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="3904445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904449">if</span>&nbsp;<span class="ident" id="3904452">n</span><span class="op" id="3904453">,</span>&nbsp;<span class="ident" id="3904455">err</span>&nbsp;<span class="op" id="3904459">:=</span>&nbsp;<span class="ident" id="3904462"><a href="/net/http/transfer.go.html#3914684">parseContentLength</a></span><span class="op" id="3904480">(</span><span class="ident" id="3904481"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904482">.</span><span class="ident" id="3904483">Header</span><span class="op" id="3904489">.</span><span class="ident" id="3904490">get</span><span class="op" id="3904493">(</span><span class="string" id="3904494">&#34;Content-Length&#34;</span><span class="op" id="3904510">)</span><span class="op" id="3904511">)</span><span class="op" id="3904512">;</span>&nbsp;<span class="ident" id="3904514"><a href="/net/http/transfer.go.html#3904455">err</a></span>&nbsp;<span class="op" id="3904518">!=</span>&nbsp;<span class="ident" id="3904521">nil</span>&nbsp;<span class="op" id="3904525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904530">return</span>&nbsp;<span class="ident" id="3904537"><a href="/net/http/transfer.go.html#3904455">err</a></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904543">}</span>&nbsp;<span class="keyword" id="3904545">else</span>&nbsp;<span class="op" id="3904550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3904555"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904556">.</span><span class="ident" id="3904557">ContentLength</span>&nbsp;<span class="op" id="3904571">=</span>&nbsp;<span class="ident" id="3904573"><a href="/net/http/transfer.go.html#3904452">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904580">}</span>&nbsp;<span class="keyword" id="3904582">else</span>&nbsp;<span class="op" id="3904587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3904591"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904592">.</span><span class="ident" id="3904593">ContentLength</span>&nbsp;<span class="op" id="3904607">=</span>&nbsp;<span class="ident" id="3904609"><a href="/net/http/transfer.go.html#3904266">realLength</a></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3904625">//&nbsp;Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3904637"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904638">.</span><span class="ident" id="3904639">Trailer</span><span class="op" id="3904646">,</span>&nbsp;<span class="ident" id="3904648"><a href="/net/http/transfer.go.html#3903308">err</a></span>&nbsp;<span class="op" id="3904652">=</span>&nbsp;<span class="ident" id="3904654"><a href="/net/http/transfer.go.html#3909565">fixTrailer</a></span><span class="op" id="3904664">(</span><span class="ident" id="3904665"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904666">.</span><span class="ident" id="3904667">Header</span><span class="op" id="3904673">,</span>&nbsp;<span class="ident" id="3904675"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904676">.</span><span class="ident" id="3904677">TransferEncoding</span><span class="op" id="3904693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904696">if</span>&nbsp;<span class="ident" id="3904699"><a href="/net/http/transfer.go.html#3903308">err</a></span>&nbsp;<span class="op" id="3904703">!=</span>&nbsp;<span class="ident" id="3904706">nil</span>&nbsp;<span class="op" id="3904710">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904714">return</span>&nbsp;<span class="ident" id="3904721"><a href="/net/http/transfer.go.html#3903308">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3904730">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;Content-Length&nbsp;or&nbsp;chunked&nbsp;Transfer-Encoding&nbsp;on&nbsp;a&nbsp;*Response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3904808">//&nbsp;and&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;1xx,&nbsp;204&nbsp;or&nbsp;304,&nbsp;then&nbsp;the&nbsp;body&nbsp;is&nbsp;unbounded.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3904879">//&nbsp;See&nbsp;RFC2616,&nbsp;section&nbsp;4.4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904909">switch</span>&nbsp;<span class="ident" id="3904916"><a href="/net/http/transfer.go.html#3903273">msg</a></span><span class="op" id="3904919">.</span><span class="op" id="3904920">(</span><span class="keyword" id="3904921">type</span><span class="op" id="3904925">)</span>&nbsp;<span class="op" id="3904927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904930">case</span>&nbsp;<span class="op" id="3904935">*</span><span class="ident" id="3904936"><a href="/net/http/response.go.html#3816973">Response</a></span><span class="op" id="3904944">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3904948">if</span>&nbsp;<span class="ident" id="3904951"><a href="/net/http/transfer.go.html#3904266">realLength</a></span>&nbsp;<span class="op" id="3904962">==</span>&nbsp;<span class="op" id="3904965">-</span><span class="num" id="3904966">1</span>&nbsp;<span class="op" id="3904968">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3904974">!</span><span class="ident" id="3904975"><a href="/net/http/transfer.go.html#3906289">chunked</a></span><span class="op" id="3904982">(</span><span class="ident" id="3904983"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3904984">.</span><span class="ident" id="3904985">TransferEncoding</span><span class="op" id="3905001">)</span>&nbsp;<span class="op" id="3905003">&amp;&amp;</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905009"><a href="/net/http/transfer.go.html#3902575">bodyAllowedForStatus</a></span><span class="op" id="3905029">(</span><span class="ident" id="3905030"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3905031">.</span><span class="ident" id="3905032">StatusCode</span><span class="op" id="3905042">)</span>&nbsp;<span class="op" id="3905044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3905049">//&nbsp;Unbounded&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905071"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3905072">.</span><span class="ident" id="3905073">Close</span>&nbsp;<span class="op" id="3905079">=</span>&nbsp;<span class="ident" id="3905081">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905091">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3905095">//&nbsp;Prepare&nbsp;body&nbsp;reader.&nbsp;&nbsp;ContentLength&nbsp;&lt;&nbsp;0&nbsp;means&nbsp;chunked&nbsp;encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3905162">//&nbsp;or&nbsp;close&nbsp;connection&nbsp;when&nbsp;finished,&nbsp;since&nbsp;multipart&nbsp;is&nbsp;not&nbsp;supported&nbsp;yet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905238">switch</span>&nbsp;<span class="op" id="3905245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905248">case</span>&nbsp;<span class="ident" id="3905253"><a href="/net/http/transfer.go.html#3906289">chunked</a></span><span class="op" id="3905260">(</span><span class="ident" id="3905261"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3905262">.</span><span class="ident" id="3905263">TransferEncoding</span><span class="op" id="3905279">)</span><span class="op" id="3905280">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905284">if</span>&nbsp;<span class="ident" id="3905287"><a href="/net/http/transfer.go.html#3899311">noBodyExpected</a></span><span class="op" id="3905301">(</span><span class="ident" id="3905302"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3905303">.</span><span class="ident" id="3905304">RequestMethod</span><span class="op" id="3905317">)</span>&nbsp;<span class="op" id="3905319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905324"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3905325">.</span><span class="ident" id="3905326">Body</span>&nbsp;<span class="op" id="3905331">=</span>&nbsp;<span class="ident" id="3905333"><a href="/net/http/server.go.html#3883891">eofReader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905345">}</span>&nbsp;<span class="keyword" id="3905347">else</span>&nbsp;<span class="op" id="3905352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905357"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3905358">.</span><span class="ident" id="3905359">Body</span>&nbsp;<span class="op" id="3905364">=</span>&nbsp;<span class="op" id="3905366">&amp;</span><span class="ident" id="3905367"><a href="/net/http/transfer.go.html#3910302">body</a></span><span class="op" id="3905371">{</span><span class="ident" id="3905372">src</span><span class="op" id="3905375">:</span>&nbsp;<span class="ident" id="3905377"><a href="/net/http/transfer.go.html#3896286">internal</a></span><span class="op" id="3905385">.</span><span class="ident" id="3905386">NewChunkedReader</span><span class="op" id="3905402">(</span><span class="ident" id="3905403"><a href="/net/http/transfer.go.html#3903290">r</a></span><span class="op" id="3905404">)</span><span class="op" id="3905405">,</span>&nbsp;<span class="ident" id="3905407">hdr</span><span class="op" id="3905410">:</span>&nbsp;<span class="ident" id="3905412"><a href="/net/http/transfer.go.html#3903273">msg</a></span><span class="op" id="3905415">,</span>&nbsp;<span class="ident" id="3905417">r</span><span class="op" id="3905418">:</span>&nbsp;<span class="ident" id="3905420"><a href="/net/http/transfer.go.html#3903290">r</a></span><span class="op" id="3905421">,</span>&nbsp;<span class="ident" id="3905423">closing</span><span class="op" id="3905430">:</span>&nbsp;<span class="ident" id="3905432"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3905433">.</span><span class="ident" id="3905434">Close</span><span class="op" id="3905439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905443">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905446">case</span>&nbsp;<span class="ident" id="3905451"><a href="/net/http/transfer.go.html#3904266">realLength</a></span>&nbsp;<span class="op" id="3905462">==</span>&nbsp;<span class="num" id="3905465">0</span><span class="op" id="3905466">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905470"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3905471">.</span><span class="ident" id="3905472">Body</span>&nbsp;<span class="op" id="3905477">=</span>&nbsp;<span class="ident" id="3905479"><a href="/net/http/server.go.html#3883891">eofReader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905490">case</span>&nbsp;<span class="ident" id="3905495"><a href="/net/http/transfer.go.html#3904266">realLength</a></span>&nbsp;<span class="op" id="3905506">&gt;</span>&nbsp;<span class="num" id="3905508">0</span><span class="op" id="3905509">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905513"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3905514">.</span><span class="ident" id="3905515">Body</span>&nbsp;<span class="op" id="3905520">=</span>&nbsp;<span class="op" id="3905522">&amp;</span><span class="ident" id="3905523"><a href="/net/http/transfer.go.html#3910302">body</a></span><span class="op" id="3905527">{</span><span class="ident" id="3905528">src</span><span class="op" id="3905531">:</span>&nbsp;<span class="ident" id="3905533"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3905535">.</span><span class="ident" id="3905536">LimitReader</span><span class="op" id="3905547">(</span><span class="ident" id="3905548"><a href="/net/http/transfer.go.html#3903290">r</a></span><span class="op" id="3905549">,</span>&nbsp;<span class="ident" id="3905551"><a href="/net/http/transfer.go.html#3904266">realLength</a></span><span class="op" id="3905561">)</span><span class="op" id="3905562">,</span>&nbsp;<span class="ident" id="3905564">closing</span><span class="op" id="3905571">:</span>&nbsp;<span class="ident" id="3905573"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3905574">.</span><span class="ident" id="3905575">Close</span><span class="op" id="3905580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905583">default</span><span class="op" id="3905590">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3905594">//&nbsp;realLength&nbsp;&lt;&nbsp;0,&nbsp;i.e.&nbsp;&#34;Content-Length&#34;&nbsp;not&nbsp;mentioned&nbsp;in&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905661">if</span>&nbsp;<span class="ident" id="3905664"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3905665">.</span><span class="ident" id="3905666">Close</span>&nbsp;<span class="op" id="3905672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3905677">//&nbsp;Close&nbsp;semantics&nbsp;(i.e.&nbsp;HTTP/1.0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905715"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3905716">.</span><span class="ident" id="3905717">Body</span>&nbsp;<span class="op" id="3905722">=</span>&nbsp;<span class="op" id="3905724">&amp;</span><span class="ident" id="3905725"><a href="/net/http/transfer.go.html#3910302">body</a></span><span class="op" id="3905729">{</span><span class="ident" id="3905730">src</span><span class="op" id="3905733">:</span>&nbsp;<span class="ident" id="3905735"><a href="/net/http/transfer.go.html#3903290">r</a></span><span class="op" id="3905736">,</span>&nbsp;<span class="ident" id="3905738">closing</span><span class="op" id="3905745">:</span>&nbsp;<span class="ident" id="3905747"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3905748">.</span><span class="ident" id="3905749">Close</span><span class="op" id="3905754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905758">}</span>&nbsp;<span class="keyword" id="3905760">else</span>&nbsp;<span class="op" id="3905765">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3905770">//&nbsp;Persistent&nbsp;connection&nbsp;(i.e.&nbsp;HTTP/1.1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905814"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3905815">.</span><span class="ident" id="3905816">Body</span>&nbsp;<span class="op" id="3905821">=</span>&nbsp;<span class="ident" id="3905823"><a href="/net/http/server.go.html#3883891">eofReader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3905838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3905842">//&nbsp;Unify&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905859">switch</span>&nbsp;<span class="ident" id="3905866">rr</span>&nbsp;<span class="op" id="3905869">:=</span>&nbsp;<span class="ident" id="3905872"><a href="/net/http/transfer.go.html#3903273">msg</a></span><span class="op" id="3905875">.</span><span class="op" id="3905876">(</span><span class="keyword" id="3905877">type</span><span class="op" id="3905881">)</span>&nbsp;<span class="op" id="3905883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3905886">case</span>&nbsp;<span class="op" id="3905891">*</span><span class="ident" id="3905892"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3905899">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905903"><a href="/net/http/transfer.go.html#3905866">rr</a></span><span class="op" id="3905905">.</span><span class="ident" id="3905906">Body</span>&nbsp;<span class="op" id="3905911">=</span>&nbsp;<span class="ident" id="3905913"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3905914">.</span><span class="ident" id="3905915">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905922"><a href="/net/http/transfer.go.html#3905866">rr</a></span><span class="op" id="3905924">.</span><span class="ident" id="3905925">ContentLength</span>&nbsp;<span class="op" id="3905939">=</span>&nbsp;<span class="ident" id="3905941"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3905942">.</span><span class="ident" id="3905943">ContentLength</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3905959"><a href="/net/http/transfer.go.html#3905866">rr</a></span><span class="op" id="3905961">.</span><span class="ident" id="3905962">TransferEncoding</span>&nbsp;<span class="op" id="3905979">=</span>&nbsp;<span class="ident" id="3905981"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3905982">.</span><span class="ident" id="3905983">TransferEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906002"><a href="/net/http/transfer.go.html#3905866">rr</a></span><span class="op" id="3906004">.</span><span class="ident" id="3906005">Close</span>&nbsp;<span class="op" id="3906011">=</span>&nbsp;<span class="ident" id="3906013"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3906014">.</span><span class="ident" id="3906015">Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906023"><a href="/net/http/transfer.go.html#3905866">rr</a></span><span class="op" id="3906025">.</span><span class="ident" id="3906026">Trailer</span>&nbsp;<span class="op" id="3906034">=</span>&nbsp;<span class="ident" id="3906036"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3906037">.</span><span class="ident" id="3906038">Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3906047">case</span>&nbsp;<span class="op" id="3906052">*</span><span class="ident" id="3906053"><a href="/net/http/response.go.html#3816973">Response</a></span><span class="op" id="3906061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906065"><a href="/net/http/transfer.go.html#3905866">rr</a></span><span class="op" id="3906067">.</span><span class="ident" id="3906068">Body</span>&nbsp;<span class="op" id="3906073">=</span>&nbsp;<span class="ident" id="3906075"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3906076">.</span><span class="ident" id="3906077">Body</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906084"><a href="/net/http/transfer.go.html#3905866">rr</a></span><span class="op" id="3906086">.</span><span class="ident" id="3906087">ContentLength</span>&nbsp;<span class="op" id="3906101">=</span>&nbsp;<span class="ident" id="3906103"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3906104">.</span><span class="ident" id="3906105">ContentLength</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906121"><a href="/net/http/transfer.go.html#3905866">rr</a></span><span class="op" id="3906123">.</span><span class="ident" id="3906124">TransferEncoding</span>&nbsp;<span class="op" id="3906141">=</span>&nbsp;<span class="ident" id="3906143"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3906144">.</span><span class="ident" id="3906145">TransferEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906164"><a href="/net/http/transfer.go.html#3905866">rr</a></span><span class="op" id="3906166">.</span><span class="ident" id="3906167">Close</span>&nbsp;<span class="op" id="3906173">=</span>&nbsp;<span class="ident" id="3906175"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3906176">.</span><span class="ident" id="3906177">Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906185"><a href="/net/http/transfer.go.html#3905866">rr</a></span><span class="op" id="3906187">.</span><span class="ident" id="3906188">Trailer</span>&nbsp;<span class="op" id="3906196">=</span>&nbsp;<span class="ident" id="3906198"><a href="/net/http/transfer.go.html#3903322">t</a></span><span class="op" id="3906199">.</span><span class="ident" id="3906200">Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3906209">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3906213">return</span>&nbsp;<span class="ident" id="3906220">nil</span><br>
<span class="lineno"></span><span class="op" id="3906224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3906227">//&nbsp;Checks&nbsp;whether&nbsp;chunked&nbsp;is&nbsp;part&nbsp;of&nbsp;the&nbsp;encodings&nbsp;stack</span><br>
<span class="lineno">410</span><span class="keyword" id="3906284">func</span>&nbsp;<span class="ident" id="3906289">chunked</span><span class="op" id="3906296">(</span><span class="ident" id="3906297">te</span>&nbsp;<span class="op" id="3906300">[</span><span class="op" id="3906301">]</span><span class="builtintype" id="3906302">string</span><span class="op" id="3906308">)</span>&nbsp;<span class="builtintype" id="3906310">bool</span>&nbsp;<span class="op" id="3906315">{</span>&nbsp;<span class="keyword" id="3906317">return</span>&nbsp;<span class="builtinfunc" id="3906324">len</span><span class="op" id="3906327">(</span><span class="ident" id="3906328"><a href="/net/http/transfer.go.html#3906297">te</a></span><span class="op" id="3906330">)</span>&nbsp;<span class="op" id="3906332">&gt;</span>&nbsp;<span class="num" id="3906334">0</span>&nbsp;<span class="op" id="3906336">&amp;&amp;</span>&nbsp;<span class="ident" id="3906339"><a href="/net/http/transfer.go.html#3906297">te</a></span><span class="op" id="3906341">[</span><span class="num" id="3906342">0</span><span class="op" id="3906343">]</span>&nbsp;<span class="op" id="3906345">==</span>&nbsp;<span class="string" id="3906348">&#34;chunked&#34;</span>&nbsp;<span class="op" id="3906358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3906361">//&nbsp;Checks&nbsp;whether&nbsp;the&nbsp;encoding&nbsp;is&nbsp;explicitly&nbsp;&#34;identity&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3906418">func</span>&nbsp;<span class="ident" id="3906423">isIdentity</span><span class="op" id="3906433">(</span><span class="ident" id="3906434">te</span>&nbsp;<span class="op" id="3906437">[</span><span class="op" id="3906438">]</span><span class="builtintype" id="3906439">string</span><span class="op" id="3906445">)</span>&nbsp;<span class="builtintype" id="3906447">bool</span>&nbsp;<span class="op" id="3906452">{</span>&nbsp;<span class="keyword" id="3906454">return</span>&nbsp;<span class="builtinfunc" id="3906461">len</span><span class="op" id="3906464">(</span><span class="ident" id="3906465"><a href="/net/http/transfer.go.html#3906434">te</a></span><span class="op" id="3906467">)</span>&nbsp;<span class="op" id="3906469">==</span>&nbsp;<span class="num" id="3906472">1</span>&nbsp;<span class="op" id="3906474">&amp;&amp;</span>&nbsp;<span class="ident" id="3906477"><a href="/net/http/transfer.go.html#3906434">te</a></span><span class="op" id="3906479">[</span><span class="num" id="3906480">0</span><span class="op" id="3906481">]</span>&nbsp;<span class="op" id="3906483">==</span>&nbsp;<span class="string" id="3906486">&#34;identity&#34;</span>&nbsp;<span class="op" id="3906497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="3906500">//&nbsp;Sanitize&nbsp;transfer&nbsp;encoding</span><br>
<span class="lineno"></span><span class="keyword" id="3906530">func</span>&nbsp;<span class="ident" id="3906535">fixTransferEncoding</span><span class="op" id="3906554">(</span><span class="ident" id="3906555">requestMethod</span>&nbsp;<span class="builtintype" id="3906569">string</span><span class="op" id="3906575">,</span>&nbsp;<span class="ident" id="3906577">header</span>&nbsp;<span class="ident" id="3906584"><a href="/net/http/header.go.html#3781581">Header</a></span><span class="op" id="3906590">)</span>&nbsp;<span class="op" id="3906592">(</span><span class="op" id="3906593">[</span><span class="op" id="3906594">]</span><span class="builtintype" id="3906595">string</span><span class="op" id="3906601">,</span>&nbsp;<span class="builtintype" id="3906603">error</span><span class="op" id="3906608">)</span>&nbsp;<span class="op" id="3906610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906613">raw</span><span class="op" id="3906616">,</span>&nbsp;<span class="ident" id="3906618">present</span>&nbsp;<span class="op" id="3906626">:=</span>&nbsp;<span class="ident" id="3906629"><a href="/net/http/transfer.go.html#3906577">header</a></span><span class="op" id="3906635">[</span><span class="string" id="3906636">&#34;Transfer-Encoding&#34;</span><span class="op" id="3906655">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3906658">if</span>&nbsp;<span class="op" id="3906661">!</span><span class="ident" id="3906662"><a href="/net/http/transfer.go.html#3906618">present</a></span>&nbsp;<span class="op" id="3906670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3906674">return</span>&nbsp;<span class="ident" id="3906681">nil</span><span class="op" id="3906684">,</span>&nbsp;<span class="ident" id="3906686">nil</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3906691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3906695">delete</span><span class="op" id="3906701">(</span><span class="ident" id="3906702"><a href="/net/http/transfer.go.html#3906577">header</a></span><span class="op" id="3906708">,</span>&nbsp;<span class="string" id="3906710">&#34;Transfer-Encoding&#34;</span><span class="op" id="3906729">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906733">encodings</span>&nbsp;<span class="op" id="3906743">:=</span>&nbsp;<span class="ident" id="3906746"><a href="/net/http/transfer.go.html#3896343">strings</a></span><span class="op" id="3906753">.</span><span class="ident" id="3906754">Split</span><span class="op" id="3906759">(</span><span class="ident" id="3906760"><a href="/net/http/transfer.go.html#3906613">raw</a></span><span class="op" id="3906763">[</span><span class="num" id="3906764">0</span><span class="op" id="3906765">]</span><span class="op" id="3906766">,</span>&nbsp;<span class="string" id="3906768">&#34;,&#34;</span><span class="op" id="3906771">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3906774">te</span>&nbsp;<span class="op" id="3906777">:=</span>&nbsp;<span class="builtinfunc" id="3906780">make</span><span class="op" id="3906784">(</span><span class="op" id="3906785">[</span><span class="op" id="3906786">]</span><span class="builtintype" id="3906787">string</span><span class="op" id="3906793">,</span>&nbsp;<span class="num" id="3906795">0</span><span class="op" id="3906796">,</span>&nbsp;<span class="builtinfunc" id="3906798">len</span><span class="op" id="3906801">(</span><span class="ident" id="3906802"><a href="/net/http/transfer.go.html#3906733">encodings</a></span><span class="op" id="3906811">)</span><span class="op" id="3906812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3906815">//&nbsp;TODO:&nbsp;Even&nbsp;though&nbsp;we&nbsp;only&nbsp;support&nbsp;&#34;identity&#34;&nbsp;and&nbsp;&#34;chunked&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3906878">//&nbsp;encodings,&nbsp;the&nbsp;loop&nbsp;below&nbsp;is&nbsp;designed&nbsp;with&nbsp;foresight.&nbsp;One</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3906940">//&nbsp;invariant&nbsp;that&nbsp;must&nbsp;be&nbsp;maintained&nbsp;is&nbsp;that,&nbsp;if&nbsp;present,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3906999">//&nbsp;chunked&nbsp;encoding&nbsp;must&nbsp;always&nbsp;come&nbsp;first.</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3907044">for</span>&nbsp;<span class="ident" id="3907048">_</span><span class="op" id="3907049">,</span>&nbsp;<span class="ident" id="3907051">encoding</span>&nbsp;<span class="op" id="3907060">:=</span>&nbsp;<span class="keyword" id="3907063">range</span>&nbsp;<span class="ident" id="3907069"><a href="/net/http/transfer.go.html#3906733">encodings</a></span>&nbsp;<span class="op" id="3907079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3907083"><a href="/net/http/transfer.go.html#3907051">encoding</a></span>&nbsp;<span class="op" id="3907092">=</span>&nbsp;<span class="ident" id="3907094"><a href="/net/http/transfer.go.html#3896343">strings</a></span><span class="op" id="3907101">.</span><span class="ident" id="3907102">ToLower</span><span class="op" id="3907109">(</span><span class="ident" id="3907110"><a href="/net/http/transfer.go.html#3896343">strings</a></span><span class="op" id="3907117">.</span><span class="ident" id="3907118">TrimSpace</span><span class="op" id="3907127">(</span><span class="ident" id="3907128"><a href="/net/http/transfer.go.html#3907051">encoding</a></span><span class="op" id="3907136">)</span><span class="op" id="3907137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3907141">//&nbsp;&#34;identity&#34;&nbsp;encoding&nbsp;is&nbsp;not&nbsp;recorded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3907182">if</span>&nbsp;<span class="ident" id="3907185"><a href="/net/http/transfer.go.html#3907051">encoding</a></span>&nbsp;<span class="op" id="3907194">==</span>&nbsp;<span class="string" id="3907197">&#34;identity&#34;</span>&nbsp;<span class="op" id="3907208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3907213">break</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3907221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3907225">if</span>&nbsp;<span class="ident" id="3907228"><a href="/net/http/transfer.go.html#3907051">encoding</a></span>&nbsp;<span class="op" id="3907237">!=</span>&nbsp;<span class="string" id="3907240">&#34;chunked&#34;</span>&nbsp;<span class="op" id="3907250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3907255">return</span>&nbsp;<span class="ident" id="3907262">nil</span><span class="op" id="3907265">,</span>&nbsp;<span class="op" id="3907267">&amp;</span><span class="ident" id="3907268"><a href="/net/http/request.go.html#3790712">badStringError</a></span><span class="op" id="3907282">{</span><span class="string" id="3907283">&#34;unsupported&nbsp;transfer&nbsp;encoding&#34;</span><span class="op" id="3907314">,</span>&nbsp;<span class="ident" id="3907316"><a href="/net/http/transfer.go.html#3907051">encoding</a></span><span class="op" id="3907324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3907328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3907332"><a href="/net/http/transfer.go.html#3906774">te</a></span>&nbsp;<span class="op" id="3907335">=</span>&nbsp;<span class="ident" id="3907337"><a href="/net/http/transfer.go.html#3906774">te</a></span><span class="op" id="3907339">[</span><span class="num" id="3907340">0</span>&nbsp;<span class="op" id="3907342">:</span>&nbsp;<span class="builtinfunc" id="3907344">len</span><span class="op" id="3907347">(</span><span class="ident" id="3907348"><a href="/net/http/transfer.go.html#3906774">te</a></span><span class="op" id="3907350">)</span><span class="op" id="3907351">+</span><span class="num" id="3907352">1</span><span class="op" id="3907353">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3907357"><a href="/net/http/transfer.go.html#3906774">te</a></span><span class="op" id="3907359">[</span><span class="builtinfunc" id="3907360">len</span><span class="op" id="3907363">(</span><span class="ident" id="3907364"><a href="/net/http/transfer.go.html#3906774">te</a></span><span class="op" id="3907366">)</span><span class="op" id="3907367">-</span><span class="num" id="3907368">1</span><span class="op" id="3907369">]</span>&nbsp;<span class="op" id="3907371">=</span>&nbsp;<span class="ident" id="3907373"><a href="/net/http/transfer.go.html#3907051">encoding</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3907383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3907386">if</span>&nbsp;<span class="builtinfunc" id="3907389">len</span><span class="op" id="3907392">(</span><span class="ident" id="3907393"><a href="/net/http/transfer.go.html#3906774">te</a></span><span class="op" id="3907395">)</span>&nbsp;<span class="op" id="3907397">&gt;</span>&nbsp;<span class="num" id="3907399">1</span>&nbsp;<span class="op" id="3907401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3907405">return</span>&nbsp;<span class="ident" id="3907412">nil</span><span class="op" id="3907415">,</span>&nbsp;<span class="op" id="3907417">&amp;</span><span class="ident" id="3907418"><a href="/net/http/request.go.html#3790712">badStringError</a></span><span class="op" id="3907432">{</span><span class="string" id="3907433">&#34;too&nbsp;many&nbsp;transfer&nbsp;encodings&#34;</span><span class="op" id="3907462">,</span>&nbsp;<span class="ident" id="3907464"><a href="/net/http/transfer.go.html#3896343">strings</a></span><span class="op" id="3907471">.</span><span class="ident" id="3907472">Join</span><span class="op" id="3907476">(</span><span class="ident" id="3907477"><a href="/net/http/transfer.go.html#3906774">te</a></span><span class="op" id="3907479">,</span>&nbsp;<span class="string" id="3907481">&#34;,&#34;</span><span class="op" id="3907484">)</span><span class="op" id="3907485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3907488">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3907491">if</span>&nbsp;<span class="builtinfunc" id="3907494">len</span><span class="op" id="3907497">(</span><span class="ident" id="3907498"><a href="/net/http/transfer.go.html#3906774">te</a></span><span class="op" id="3907500">)</span>&nbsp;<span class="op" id="3907502">&gt;</span>&nbsp;<span class="num" id="3907504">0</span>&nbsp;<span class="op" id="3907506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3907510">//&nbsp;Chunked&nbsp;encoding&nbsp;trumps&nbsp;Content-Length.&nbsp;See&nbsp;RFC&nbsp;2616</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3907568">//&nbsp;Section&nbsp;4.4.&nbsp;Currently&nbsp;len(te)&nbsp;&gt;&nbsp;0&nbsp;implies&nbsp;chunked</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3907624">//&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3907639">delete</span><span class="op" id="3907645">(</span><span class="ident" id="3907646"><a href="/net/http/transfer.go.html#3906577">header</a></span><span class="op" id="3907652">,</span>&nbsp;<span class="string" id="3907654">&#34;Content-Length&#34;</span><span class="op" id="3907670">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3907674">return</span>&nbsp;<span class="ident" id="3907681"><a href="/net/http/transfer.go.html#3906774">te</a></span><span class="op" id="3907683">,</span>&nbsp;<span class="ident" id="3907685">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3907690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3907694">return</span>&nbsp;<span class="ident" id="3907701">nil</span><span class="op" id="3907704">,</span>&nbsp;<span class="ident" id="3907706">nil</span><br>
<span class="lineno"></span><span class="op" id="3907710">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="3907713">//&nbsp;Determine&nbsp;the&nbsp;expected&nbsp;body&nbsp;length,&nbsp;using&nbsp;RFC&nbsp;2616&nbsp;Section&nbsp;4.4.&nbsp;This</span><br>
<span class="lineno"></span><span class="comment" id="3907785">//&nbsp;function&nbsp;is&nbsp;not&nbsp;a&nbsp;method,&nbsp;because&nbsp;ultimately&nbsp;it&nbsp;should&nbsp;be&nbsp;shared&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3907856">//&nbsp;ReadResponse&nbsp;and&nbsp;ReadRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="3907889">func</span>&nbsp;<span class="ident" id="3907894">fixLength</span><span class="op" id="3907903">(</span><span class="ident" id="3907904">isResponse</span>&nbsp;<span class="builtintype" id="3907915">bool</span><span class="op" id="3907919">,</span>&nbsp;<span class="ident" id="3907921">status</span>&nbsp;<span class="builtintype" id="3907928">int</span><span class="op" id="3907931">,</span>&nbsp;<span class="ident" id="3907933">requestMethod</span>&nbsp;<span class="builtintype" id="3907947">string</span><span class="op" id="3907953">,</span>&nbsp;<span class="ident" id="3907955">header</span>&nbsp;<span class="ident" id="3907962"><a href="/net/http/header.go.html#3781581">Header</a></span><span class="op" id="3907968">,</span>&nbsp;<span class="ident" id="3907970">te</span>&nbsp;<span class="op" id="3907973">[</span><span class="op" id="3907974">]</span><span class="builtintype" id="3907975">string</span><span class="op" id="3907981">)</span>&nbsp;<span class="op" id="3907983">(</span><span class="ident" id="3907984">int64</span><span class="op" id="3907989">,</span>&nbsp;<span class="builtintype" id="3907991">error</span><span class="op" id="3907996">)</span>&nbsp;<span class="op" id="3907998">{</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3908002">//&nbsp;Logic&nbsp;based&nbsp;on&nbsp;response&nbsp;type&nbsp;or&nbsp;status</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3908045">if</span>&nbsp;<span class="ident" id="3908048"><a href="/net/http/transfer.go.html#3899311">noBodyExpected</a></span><span class="op" id="3908062">(</span><span class="ident" id="3908063"><a href="/net/http/transfer.go.html#3907933">requestMethod</a></span><span class="op" id="3908076">)</span>&nbsp;<span class="op" id="3908078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3908082">return</span>&nbsp;<span class="num" id="3908089">0</span><span class="op" id="3908090">,</span>&nbsp;<span class="ident" id="3908092">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3908097">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3908100">if</span>&nbsp;<span class="ident" id="3908103"><a href="/net/http/transfer.go.html#3907921">status</a></span><span class="op" id="3908109">/</span><span class="num" id="3908110">100</span>&nbsp;<span class="op" id="3908114">==</span>&nbsp;<span class="num" id="3908117">1</span>&nbsp;<span class="op" id="3908119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3908123">return</span>&nbsp;<span class="num" id="3908130">0</span><span class="op" id="3908131">,</span>&nbsp;<span class="ident" id="3908133">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3908138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3908141">switch</span>&nbsp;<span class="ident" id="3908148"><a href="/net/http/transfer.go.html#3907921">status</a></span>&nbsp;<span class="op" id="3908155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3908158">case</span>&nbsp;<span class="num" id="3908163">204</span><span class="op" id="3908166">,</span>&nbsp;<span class="num" id="3908168">304</span><span class="op" id="3908171">:</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3908175">return</span>&nbsp;<span class="num" id="3908182">0</span><span class="op" id="3908183">,</span>&nbsp;<span class="ident" id="3908185">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3908190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3908194">//&nbsp;Logic&nbsp;based&nbsp;on&nbsp;Transfer-Encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3908231">if</span>&nbsp;<span class="ident" id="3908234"><a href="/net/http/transfer.go.html#3906289">chunked</a></span><span class="op" id="3908241">(</span><span class="ident" id="3908242"><a href="/net/http/transfer.go.html#3907970">te</a></span><span class="op" id="3908244">)</span>&nbsp;<span class="op" id="3908246">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3908250">return</span>&nbsp;<span class="op" id="3908257">-</span><span class="num" id="3908258">1</span><span class="op" id="3908259">,</span>&nbsp;<span class="ident" id="3908261">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3908266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3908270">//&nbsp;Logic&nbsp;based&nbsp;on&nbsp;Content-Length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3908304">cl</span>&nbsp;<span class="op" id="3908307">:=</span>&nbsp;<span class="ident" id="3908310"><a href="/net/http/transfer.go.html#3896343">strings</a></span><span class="op" id="3908317">.</span><span class="ident" id="3908318">TrimSpace</span><span class="op" id="3908327">(</span><span class="ident" id="3908328"><a href="/net/http/transfer.go.html#3907955">header</a></span><span class="op" id="3908334">.</span><span class="ident" id="3908335">get</span><span class="op" id="3908338">(</span><span class="string" id="3908339">&#34;Content-Length&#34;</span><span class="op" id="3908355">)</span><span class="op" id="3908356">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3908359">if</span>&nbsp;<span class="ident" id="3908362"><a href="/net/http/transfer.go.html#3908304">cl</a></span>&nbsp;<span class="op" id="3908365">!=</span>&nbsp;<span class="string" id="3908368">&#34;&#34;</span>&nbsp;<span class="op" id="3908371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3908375">n</span><span class="op" id="3908376">,</span>&nbsp;<span class="ident" id="3908378">err</span>&nbsp;<span class="op" id="3908382">:=</span>&nbsp;<span class="ident" id="3908385"><a href="/net/http/transfer.go.html#3914684">parseContentLength</a></span><span class="op" id="3908403">(</span><span class="ident" id="3908404"><a href="/net/http/transfer.go.html#3908304">cl</a></span><span class="op" id="3908406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3908410">if</span>&nbsp;<span class="ident" id="3908413"><a href="/net/http/transfer.go.html#3908378">err</a></span>&nbsp;<span class="op" id="3908417">!=</span>&nbsp;<span class="ident" id="3908420">nil</span>&nbsp;<span class="op" id="3908424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3908429">return</span>&nbsp;<span class="op" id="3908436">-</span><span class="num" id="3908437">1</span><span class="op" id="3908438">,</span>&nbsp;<span class="ident" id="3908440"><a href="/net/http/transfer.go.html#3908378">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3908446">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3908450">return</span>&nbsp;<span class="ident" id="3908457"><a href="/net/http/transfer.go.html#3908375">n</a></span><span class="op" id="3908458">,</span>&nbsp;<span class="ident" id="3908460">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3908465">}</span>&nbsp;<span class="keyword" id="3908467">else</span>&nbsp;<span class="op" id="3908472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3908476"><a href="/net/http/transfer.go.html#3907955">header</a></span><span class="op" id="3908482">.</span><span class="ident" id="3908483">Del</span><span class="op" id="3908486">(</span><span class="string" id="3908487">&#34;Content-Length&#34;</span><span class="op" id="3908503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3908506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3908510">if</span>&nbsp;<span class="op" id="3908513">!</span><span class="ident" id="3908514"><a href="/net/http/transfer.go.html#3907904">isResponse</a></span>&nbsp;<span class="op" id="3908525">&amp;&amp;</span>&nbsp;<span class="ident" id="3908528"><a href="/net/http/transfer.go.html#3907933">requestMethod</a></span>&nbsp;<span class="op" id="3908542">==</span>&nbsp;<span class="string" id="3908545">&#34;GET&#34;</span>&nbsp;<span class="op" id="3908551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3908555">//&nbsp;RFC&nbsp;2616&nbsp;doesn&#39;t&nbsp;explicitly&nbsp;permit&nbsp;nor&nbsp;forbid&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3908609">//&nbsp;entity-body&nbsp;on&nbsp;a&nbsp;GET&nbsp;request&nbsp;so&nbsp;we&nbsp;permit&nbsp;one&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3908663">//&nbsp;declared,&nbsp;but&nbsp;we&nbsp;default&nbsp;to&nbsp;0&nbsp;here&nbsp;(not&nbsp;-1&nbsp;below)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3908718">//&nbsp;if&nbsp;there&#39;s&nbsp;no&nbsp;mention&nbsp;of&nbsp;a&nbsp;body.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3908756">return</span>&nbsp;<span class="num" id="3908763">0</span><span class="op" id="3908764">,</span>&nbsp;<span class="ident" id="3908766">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3908771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3908775">//&nbsp;Body-EOF&nbsp;logic&nbsp;based&nbsp;on&nbsp;other&nbsp;methods&nbsp;(like&nbsp;closing,&nbsp;or&nbsp;chunked&nbsp;coding)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3908851">return</span>&nbsp;<span class="op" id="3908858">-</span><span class="num" id="3908859">1</span><span class="op" id="3908860">,</span>&nbsp;<span class="ident" id="3908862">nil</span><br>
<span class="lineno">500</span><span class="op" id="3908866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3908869">//&nbsp;Determine&nbsp;whether&nbsp;to&nbsp;hang&nbsp;up&nbsp;after&nbsp;sending&nbsp;a&nbsp;request&nbsp;and&nbsp;body,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3908938">//&nbsp;receiving&nbsp;a&nbsp;response&nbsp;and&nbsp;body</span><br>
<span class="lineno"></span><span class="comment" id="3908971">//&nbsp;&#39;header&#39;&nbsp;is&nbsp;the&nbsp;request&nbsp;headers</span><br>
<span class="lineno">505</span><span class="keyword" id="3909006">func</span>&nbsp;<span class="ident" id="3909011">shouldClose</span><span class="op" id="3909022">(</span><span class="ident" id="3909023">major</span><span class="op" id="3909028">,</span>&nbsp;<span class="ident" id="3909030">minor</span>&nbsp;<span class="builtintype" id="3909036">int</span><span class="op" id="3909039">,</span>&nbsp;<span class="ident" id="3909041">header</span>&nbsp;<span class="ident" id="3909048"><a href="/net/http/header.go.html#3781581">Header</a></span><span class="op" id="3909054">,</span>&nbsp;<span class="ident" id="3909056">removeCloseHeader</span>&nbsp;<span class="builtintype" id="3909074">bool</span><span class="op" id="3909078">)</span>&nbsp;<span class="builtintype" id="3909080">bool</span>&nbsp;<span class="op" id="3909085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3909088">if</span>&nbsp;<span class="ident" id="3909091"><a href="/net/http/transfer.go.html#3909023">major</a></span>&nbsp;<span class="op" id="3909097">&lt;</span>&nbsp;<span class="num" id="3909099">1</span>&nbsp;<span class="op" id="3909101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3909105">return</span>&nbsp;<span class="ident" id="3909112">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3909118">}</span>&nbsp;<span class="keyword" id="3909120">else</span>&nbsp;<span class="keyword" id="3909125">if</span>&nbsp;<span class="ident" id="3909128"><a href="/net/http/transfer.go.html#3909023">major</a></span>&nbsp;<span class="op" id="3909134">==</span>&nbsp;<span class="num" id="3909137">1</span>&nbsp;<span class="op" id="3909139">&amp;&amp;</span>&nbsp;<span class="ident" id="3909142"><a href="/net/http/transfer.go.html#3909030">minor</a></span>&nbsp;<span class="op" id="3909148">==</span>&nbsp;<span class="num" id="3909151">0</span>&nbsp;<span class="op" id="3909153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3909157">if</span>&nbsp;<span class="op" id="3909160">!</span><span class="ident" id="3909161"><a href="/net/http/transfer.go.html#3896343">strings</a></span><span class="op" id="3909168">.</span><span class="ident" id="3909169">Contains</span><span class="op" id="3909177">(</span><span class="ident" id="3909178"><a href="/net/http/transfer.go.html#3896343">strings</a></span><span class="op" id="3909185">.</span><span class="ident" id="3909186">ToLower</span><span class="op" id="3909193">(</span><span class="ident" id="3909194"><a href="/net/http/transfer.go.html#3909041">header</a></span><span class="op" id="3909200">.</span><span class="ident" id="3909201">get</span><span class="op" id="3909204">(</span><span class="string" id="3909205">&#34;Connection&#34;</span><span class="op" id="3909217">)</span><span class="op" id="3909218">)</span><span class="op" id="3909219">,</span>&nbsp;<span class="string" id="3909221">&#34;keep-alive&#34;</span><span class="op" id="3909233">)</span>&nbsp;<span class="op" id="3909235">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3909240">return</span>&nbsp;<span class="ident" id="3909247">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3909254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3909258">return</span>&nbsp;<span class="ident" id="3909265">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3909272">}</span>&nbsp;<span class="keyword" id="3909274">else</span>&nbsp;<span class="op" id="3909279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3909283">//&nbsp;TODO:&nbsp;Should&nbsp;split&nbsp;on&nbsp;commas,&nbsp;toss&nbsp;surrounding&nbsp;white&nbsp;space,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3909348">//&nbsp;and&nbsp;check&nbsp;each&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3909375">if</span>&nbsp;<span class="ident" id="3909378"><a href="/net/http/transfer.go.html#3896343">strings</a></span><span class="op" id="3909385">.</span><span class="ident" id="3909386">ToLower</span><span class="op" id="3909393">(</span><span class="ident" id="3909394"><a href="/net/http/transfer.go.html#3909041">header</a></span><span class="op" id="3909400">.</span><span class="ident" id="3909401">get</span><span class="op" id="3909404">(</span><span class="string" id="3909405">&#34;Connection&#34;</span><span class="op" id="3909417">)</span><span class="op" id="3909418">)</span>&nbsp;<span class="op" id="3909420">==</span>&nbsp;<span class="string" id="3909423">&#34;close&#34;</span>&nbsp;<span class="op" id="3909431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3909436">if</span>&nbsp;<span class="ident" id="3909439"><a href="/net/http/transfer.go.html#3909056">removeCloseHeader</a></span>&nbsp;<span class="op" id="3909457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3909463"><a href="/net/http/transfer.go.html#3909041">header</a></span><span class="op" id="3909469">.</span><span class="ident" id="3909470">Del</span><span class="op" id="3909473">(</span><span class="string" id="3909474">&#34;Connection&#34;</span><span class="op" id="3909486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3909491">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3909496">return</span>&nbsp;<span class="ident" id="3909503">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3909510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3909513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3909516">return</span>&nbsp;<span class="ident" id="3909523">false</span><br>
<span class="lineno"></span><span class="op" id="3909529">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span><span class="comment" id="3909532">//&nbsp;Parse&nbsp;the&nbsp;trailer&nbsp;header</span><br>
<span class="lineno"></span><span class="keyword" id="3909560">func</span>&nbsp;<span class="ident" id="3909565">fixTrailer</span><span class="op" id="3909575">(</span><span class="ident" id="3909576">header</span>&nbsp;<span class="ident" id="3909583"><a href="/net/http/header.go.html#3781581">Header</a></span><span class="op" id="3909589">,</span>&nbsp;<span class="ident" id="3909591">te</span>&nbsp;<span class="op" id="3909594">[</span><span class="op" id="3909595">]</span><span class="builtintype" id="3909596">string</span><span class="op" id="3909602">)</span>&nbsp;<span class="op" id="3909604">(</span><span class="ident" id="3909605"><a href="/net/http/header.go.html#3781581">Header</a></span><span class="op" id="3909611">,</span>&nbsp;<span class="builtintype" id="3909613">error</span><span class="op" id="3909618">)</span>&nbsp;<span class="op" id="3909620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3909623">raw</span>&nbsp;<span class="op" id="3909627">:=</span>&nbsp;<span class="ident" id="3909630"><a href="/net/http/transfer.go.html#3909576">header</a></span><span class="op" id="3909636">.</span><span class="ident" id="3909637">get</span><span class="op" id="3909640">(</span><span class="string" id="3909641">&#34;Trailer&#34;</span><span class="op" id="3909650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3909653">if</span>&nbsp;<span class="ident" id="3909656"><a href="/net/http/transfer.go.html#3909623">raw</a></span>&nbsp;<span class="op" id="3909660">==</span>&nbsp;<span class="string" id="3909663">&#34;&#34;</span>&nbsp;<span class="op" id="3909666">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3909670">return</span>&nbsp;<span class="ident" id="3909677">nil</span><span class="op" id="3909680">,</span>&nbsp;<span class="ident" id="3909682">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3909687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3909691"><a href="/net/http/transfer.go.html#3909576">header</a></span><span class="op" id="3909697">.</span><span class="ident" id="3909698">Del</span><span class="op" id="3909701">(</span><span class="string" id="3909702">&#34;Trailer&#34;</span><span class="op" id="3909711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3909714">trailer</span>&nbsp;<span class="op" id="3909722">:=</span>&nbsp;<span class="builtinfunc" id="3909725">make</span><span class="op" id="3909729">(</span><span class="ident" id="3909730"><a href="/net/http/header.go.html#3781581">Header</a></span><span class="op" id="3909736">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3909739">keys</span>&nbsp;<span class="op" id="3909744">:=</span>&nbsp;<span class="ident" id="3909747"><a href="/net/http/transfer.go.html#3896343">strings</a></span><span class="op" id="3909754">.</span><span class="ident" id="3909755">Split</span><span class="op" id="3909760">(</span><span class="ident" id="3909761"><a href="/net/http/transfer.go.html#3909623">raw</a></span><span class="op" id="3909764">,</span>&nbsp;<span class="string" id="3909766">&#34;,&#34;</span><span class="op" id="3909769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3909772">for</span>&nbsp;<span class="ident" id="3909776">_</span><span class="op" id="3909777">,</span>&nbsp;<span class="ident" id="3909779">key</span>&nbsp;<span class="op" id="3909783">:=</span>&nbsp;<span class="keyword" id="3909786">range</span>&nbsp;<span class="ident" id="3909792"><a href="/net/http/transfer.go.html#3909739">keys</a></span>&nbsp;<span class="op" id="3909797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3909801"><a href="/net/http/transfer.go.html#3909779">key</a></span>&nbsp;<span class="op" id="3909805">=</span>&nbsp;<span class="ident" id="3909807"><a href="/net/http/header.go.html#3785696">CanonicalHeaderKey</a></span><span class="op" id="3909825">(</span><span class="ident" id="3909826"><a href="/net/http/transfer.go.html#3896343">strings</a></span><span class="op" id="3909833">.</span><span class="ident" id="3909834">TrimSpace</span><span class="op" id="3909843">(</span><span class="ident" id="3909844"><a href="/net/http/transfer.go.html#3909779">key</a></span><span class="op" id="3909847">)</span><span class="op" id="3909848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3909852">switch</span>&nbsp;<span class="ident" id="3909859"><a href="/net/http/transfer.go.html#3909779">key</a></span>&nbsp;<span class="op" id="3909863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3909867">case</span>&nbsp;<span class="string" id="3909872">&#34;Transfer-Encoding&#34;</span><span class="op" id="3909891">,</span>&nbsp;<span class="string" id="3909893">&#34;Trailer&#34;</span><span class="op" id="3909902">,</span>&nbsp;<span class="string" id="3909904">&#34;Content-Length&#34;</span><span class="op" id="3909920">:</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3909925">return</span>&nbsp;<span class="ident" id="3909932">nil</span><span class="op" id="3909935">,</span>&nbsp;<span class="op" id="3909937">&amp;</span><span class="ident" id="3909938"><a href="/net/http/request.go.html#3790712">badStringError</a></span><span class="op" id="3909952">{</span><span class="string" id="3909953">&#34;bad&nbsp;trailer&nbsp;key&#34;</span><span class="op" id="3909970">,</span>&nbsp;<span class="ident" id="3909972"><a href="/net/http/transfer.go.html#3909779">key</a></span><span class="op" id="3909975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3909979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3909983"><a href="/net/http/transfer.go.html#3909714">trailer</a></span><span class="op" id="3909990">[</span><span class="ident" id="3909991"><a href="/net/http/transfer.go.html#3909779">key</a></span><span class="op" id="3909994">]</span>&nbsp;<span class="op" id="3909996">=</span>&nbsp;<span class="ident" id="3909998">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3910003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3910006">if</span>&nbsp;<span class="builtinfunc" id="3910009">len</span><span class="op" id="3910012">(</span><span class="ident" id="3910013"><a href="/net/http/transfer.go.html#3909714">trailer</a></span><span class="op" id="3910020">)</span>&nbsp;<span class="op" id="3910022">==</span>&nbsp;<span class="num" id="3910025">0</span>&nbsp;<span class="op" id="3910027">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3910031">return</span>&nbsp;<span class="ident" id="3910038">nil</span><span class="op" id="3910041">,</span>&nbsp;<span class="ident" id="3910043">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3910048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3910051">if</span>&nbsp;<span class="op" id="3910054">!</span><span class="ident" id="3910055"><a href="/net/http/transfer.go.html#3906289">chunked</a></span><span class="op" id="3910062">(</span><span class="ident" id="3910063"><a href="/net/http/transfer.go.html#3909591">te</a></span><span class="op" id="3910065">)</span>&nbsp;<span class="op" id="3910067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3910071">//&nbsp;Trailer&nbsp;and&nbsp;no&nbsp;chunking</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3910100">return</span>&nbsp;<span class="ident" id="3910107">nil</span><span class="op" id="3910110">,</span>&nbsp;<span class="ident" id="3910112"><a href="/net/http/request.go.html#3790346">ErrUnexpectedTrailer</a></span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3910134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3910137">return</span>&nbsp;<span class="ident" id="3910144"><a href="/net/http/transfer.go.html#3909714">trailer</a></span><span class="op" id="3910151">,</span>&nbsp;<span class="ident" id="3910153">nil</span><br>
<span class="lineno"></span><span class="op" id="3910157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3910160">//&nbsp;body&nbsp;turns&nbsp;a&nbsp;Reader&nbsp;into&nbsp;a&nbsp;ReadCloser.</span><br>
<span class="lineno">555</span><span class="comment" id="3910202">//&nbsp;Close&nbsp;ensures&nbsp;that&nbsp;the&nbsp;body&nbsp;has&nbsp;been&nbsp;fully&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3910253">//&nbsp;and&nbsp;then&nbsp;reads&nbsp;the&nbsp;trailer&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="3910297">type</span>&nbsp;<span class="ident" id="3910302">body</span>&nbsp;<span class="keyword" id="3910307">struct</span>&nbsp;<span class="op" id="3910314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3910317">src</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3910325"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3910327">.</span><span class="ident" id="3910328">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3910336">hdr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3910344">interface</span><span class="op" id="3910353">{</span><span class="op" id="3910354">}</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3910358">//&nbsp;non-nil&nbsp;(Response&nbsp;or&nbsp;Request)&nbsp;value&nbsp;means&nbsp;read&nbsp;trailer</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3910417">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3910425">*</span><span class="ident" id="3910426"><a href="/net/http/transfer.go.html#3896232">bufio</a></span><span class="op" id="3910431">.</span><span class="ident" id="3910432">Reader</span>&nbsp;<span class="comment" id="3910439">//&nbsp;underlying&nbsp;wire-format&nbsp;reader&nbsp;for&nbsp;the&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3910489">closing</span>&nbsp;<span class="builtintype" id="3910497">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3910511">//&nbsp;is&nbsp;the&nbsp;connection&nbsp;to&nbsp;be&nbsp;closed&nbsp;after&nbsp;reading&nbsp;body?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3910567">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3910574"><a href="/net/http/transfer.go.html#3896354">sync</a></span><span class="op" id="3910578">.</span><span class="ident" id="3910579">Mutex</span>&nbsp;<span class="comment" id="3910585">//&nbsp;guards&nbsp;closed,&nbsp;and&nbsp;calls&nbsp;to&nbsp;Read&nbsp;and&nbsp;Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3910632">closed</span>&nbsp;<span class="builtintype" id="3910639">bool</span><br>
<span class="lineno">565</span><span class="op" id="3910644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3910647">//&nbsp;ErrBodyReadAfterClose&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;a&nbsp;Request&nbsp;or&nbsp;Response</span><br>
<span class="lineno"></span><span class="comment" id="3910719">//&nbsp;Body&nbsp;after&nbsp;the&nbsp;body&nbsp;has&nbsp;been&nbsp;closed.&nbsp;This&nbsp;typically&nbsp;happens&nbsp;when&nbsp;the&nbsp;body&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3910799">//&nbsp;read&nbsp;after&nbsp;an&nbsp;HTTP&nbsp;Handler&nbsp;calls&nbsp;WriteHeader&nbsp;or&nbsp;Write&nbsp;on&nbsp;its</span><br>
<span class="lineno">570</span><span class="comment" id="3910863">//&nbsp;ResponseWriter.</span><br>
<span class="lineno"></span><span class="keyword" id="3910882">var</span>&nbsp;<span class="ident" id="3910886">ErrBodyReadAfterClose</span>&nbsp;<span class="op" id="3910908">=</span>&nbsp;<span class="ident" id="3910910"><a href="/net/http/transfer.go.html#3896250">errors</a></span><span class="op" id="3910916">.</span><span class="ident" id="3910917">New</span><span class="op" id="3910920">(</span><span class="string" id="3910921">&#34;http:&nbsp;invalid&nbsp;Read&nbsp;on&nbsp;closed&nbsp;Body&#34;</span><span class="op" id="3910956">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3910959">func</span>&nbsp;<span class="op" id="3910964">(</span><span class="ident" id="3910965">b</span>&nbsp;<span class="op" id="3910967">*</span><span class="ident" id="3910968"><a href="/net/http/transfer.go.html#3910302">body</a></span><span class="op" id="3910972">)</span>&nbsp;<span class="ident" id="3910974">Read</span><span class="op" id="3910978">(</span><span class="ident" id="3910979">p</span>&nbsp;<span class="op" id="3910981">[</span><span class="op" id="3910982">]</span><span class="builtintype" id="3910983">byte</span><span class="op" id="3910987">)</span>&nbsp;<span class="op" id="3910989">(</span><span class="ident" id="3910990">n</span>&nbsp;<span class="builtintype" id="3910992">int</span><span class="op" id="3910995">,</span>&nbsp;<span class="ident" id="3910997">err</span>&nbsp;<span class="builtintype" id="3911001">error</span><span class="op" id="3911006">)</span>&nbsp;<span class="op" id="3911008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3911011"><a href="/net/http/transfer.go.html#3910965">b</a></span><span class="op" id="3911012">.</span><span class="ident" id="3911013">mu</span><span class="op" id="3911015">.</span><span class="ident" id="3911016">Lock</span><span class="op" id="3911020">(</span><span class="op" id="3911021">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3911024">defer</span>&nbsp;<span class="ident" id="3911030"><a href="/net/http/transfer.go.html#3910965">b</a></span><span class="op" id="3911031">.</span><span class="ident" id="3911032">mu</span><span class="op" id="3911034">.</span><span class="ident" id="3911035">Unlock</span><span class="op" id="3911041">(</span><span class="op" id="3911042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3911045">if</span>&nbsp;<span class="ident" id="3911048"><a href="/net/http/transfer.go.html#3910965">b</a></span><span class="op" id="3911049">.</span><span class="ident" id="3911050">closed</span>&nbsp;<span class="op" id="3911057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3911061">return</span>&nbsp;<span class="num" id="3911068">0</span><span class="op" id="3911069">,</span>&nbsp;<span class="ident" id="3911071"><a href="/net/http/transfer.go.html#3910886">ErrBodyReadAfterClose</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3911094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3911097">return</span>&nbsp;<span class="ident" id="3911104"><a href="/net/http/transfer.go.html#3910965">b</a></span><span class="op" id="3911105">.</span><span class="ident" id="3911106">readLocked</span><span class="op" id="3911116">(</span><span class="ident" id="3911117"><a href="/net/http/transfer.go.html#3910979">p</a></span><span class="op" id="3911118">)</span><br>
<span class="lineno">580</span><span class="op" id="3911120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3911123">//&nbsp;Must&nbsp;hold&nbsp;b.mu.</span><br>
<span class="lineno"></span><span class="keyword" id="3911142">func</span>&nbsp;<span class="op" id="3911147">(</span><span class="ident" id="3911148">b</span>&nbsp;<span class="op" id="3911150">*</span><span class="ident" id="3911151"><a href="/net/http/transfer.go.html#3910302">body</a></span><span class="op" id="3911155">)</span>&nbsp;<span class="ident" id="3911157">readLocked</span><span class="op" id="3911167">(</span><span class="ident" id="3911168">p</span>&nbsp;<span class="op" id="3911170">[</span><span class="op" id="3911171">]</span><span class="builtintype" id="3911172">byte</span><span class="op" id="3911176">)</span>&nbsp;<span class="op" id="3911178">(</span><span class="ident" id="3911179">n</span>&nbsp;<span class="builtintype" id="3911181">int</span><span class="op" id="3911184">,</span>&nbsp;<span class="ident" id="3911186">err</span>&nbsp;<span class="builtintype" id="3911190">error</span><span class="op" id="3911195">)</span>&nbsp;<span class="op" id="3911197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3911200"><a href="/net/http/transfer.go.html#3911179">n</a></span><span class="op" id="3911201">,</span>&nbsp;<span class="ident" id="3911203"><a href="/net/http/transfer.go.html#3911186">err</a></span>&nbsp;<span class="op" id="3911207">=</span>&nbsp;<span class="ident" id="3911209"><a href="/net/http/transfer.go.html#3911148">b</a></span><span class="op" id="3911210">.</span><span class="ident" id="3911211">src</span><span class="op" id="3911214">.</span><span class="ident" id="3911215">Read</span><span class="op" id="3911219">(</span><span class="ident" id="3911220"><a href="/net/http/transfer.go.html#3911168">p</a></span><span class="op" id="3911221">)</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3911225">if</span>&nbsp;<span class="ident" id="3911228"><a href="/net/http/transfer.go.html#3911186">err</a></span>&nbsp;<span class="op" id="3911232">==</span>&nbsp;<span class="ident" id="3911235"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3911237">.</span><span class="ident" id="3911238">EOF</span>&nbsp;<span class="op" id="3911242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3911246">//&nbsp;Chunked&nbsp;case.&nbsp;Read&nbsp;the&nbsp;trailer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3911283">if</span>&nbsp;<span class="ident" id="3911286"><a href="/net/http/transfer.go.html#3911148">b</a></span><span class="op" id="3911287">.</span><span class="ident" id="3911288">hdr</span>&nbsp;<span class="op" id="3911292">!=</span>&nbsp;<span class="ident" id="3911295">nil</span>&nbsp;<span class="op" id="3911299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3911304">if</span>&nbsp;<span class="ident" id="3911307">e</span>&nbsp;<span class="op" id="3911309">:=</span>&nbsp;<span class="ident" id="3911312"><a href="/net/http/transfer.go.html#3911148">b</a></span><span class="op" id="3911313">.</span><span class="ident" id="3911314">readTrailer</span><span class="op" id="3911325">(</span><span class="op" id="3911326">)</span><span class="op" id="3911327">;</span>&nbsp;<span class="ident" id="3911329"><a href="/net/http/transfer.go.html#3911307">e</a></span>&nbsp;<span class="op" id="3911331">!=</span>&nbsp;<span class="ident" id="3911334">nil</span>&nbsp;<span class="op" id="3911338">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3911344"><a href="/net/http/transfer.go.html#3911186">err</a></span>&nbsp;<span class="op" id="3911348">=</span>&nbsp;<span class="ident" id="3911350"><a href="/net/http/transfer.go.html#3911307">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3911355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3911360"><a href="/net/http/transfer.go.html#3911148">b</a></span><span class="op" id="3911361">.</span><span class="ident" id="3911362">hdr</span>&nbsp;<span class="op" id="3911366">=</span>&nbsp;<span class="ident" id="3911368">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3911374">}</span>&nbsp;<span class="keyword" id="3911376">else</span>&nbsp;<span class="op" id="3911381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3911386">//&nbsp;If&nbsp;the&nbsp;server&nbsp;declared&nbsp;the&nbsp;Content-Length,&nbsp;our&nbsp;body&nbsp;is&nbsp;a&nbsp;LimitedReader</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3911463">//&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;check&nbsp;whether&nbsp;this&nbsp;EOF&nbsp;arrived&nbsp;early.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3911522">if</span>&nbsp;<span class="ident" id="3911525">lr</span><span class="op" id="3911527">,</span>&nbsp;<span class="ident" id="3911529">ok</span>&nbsp;<span class="op" id="3911532">:=</span>&nbsp;<span class="ident" id="3911535"><a href="/net/http/transfer.go.html#3911148">b</a></span><span class="op" id="3911536">.</span><span class="ident" id="3911537">src</span><span class="op" id="3911540">.</span><span class="op" id="3911541">(</span><span class="op" id="3911542">*</span><span class="ident" id="3911543"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3911545">.</span><span class="ident" id="3911546">LimitedReader</span><span class="op" id="3911559">)</span><span class="op" id="3911560">;</span>&nbsp;<span class="ident" id="3911562"><a href="/net/http/transfer.go.html#3911529">ok</a></span>&nbsp;<span class="op" id="3911565">&amp;&amp;</span>&nbsp;<span class="ident" id="3911568"><a href="/net/http/transfer.go.html#3911525">lr</a></span><span class="op" id="3911570">.</span><span class="ident" id="3911571">N</span>&nbsp;<span class="op" id="3911573">&gt;</span>&nbsp;<span class="num" id="3911575">0</span>&nbsp;<span class="op" id="3911577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3911583"><a href="/net/http/transfer.go.html#3911186">err</a></span>&nbsp;<span class="op" id="3911587">=</span>&nbsp;<span class="ident" id="3911589"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3911591">.</span><span class="ident" id="3911592">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3911612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3911616">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3911619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3911623">//&nbsp;If&nbsp;we&nbsp;can&nbsp;return&nbsp;an&nbsp;EOF&nbsp;here&nbsp;along&nbsp;with&nbsp;the&nbsp;read&nbsp;data,&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3911685">//&nbsp;so.&nbsp;This&nbsp;is&nbsp;optional&nbsp;per&nbsp;the&nbsp;io.Reader&nbsp;contract,&nbsp;but&nbsp;doing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3911748">//&nbsp;so&nbsp;helps&nbsp;the&nbsp;HTTP&nbsp;transport&nbsp;code&nbsp;recycle&nbsp;its&nbsp;connection</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3911808">//&nbsp;earlier&nbsp;(since&nbsp;it&nbsp;will&nbsp;see&nbsp;this&nbsp;EOF&nbsp;itself),&nbsp;even&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3911869">//&nbsp;client&nbsp;doesn&#39;t&nbsp;do&nbsp;future&nbsp;reads&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3911914">if</span>&nbsp;<span class="ident" id="3911917"><a href="/net/http/transfer.go.html#3911186">err</a></span>&nbsp;<span class="op" id="3911921">==</span>&nbsp;<span class="ident" id="3911924">nil</span>&nbsp;<span class="op" id="3911928">&amp;&amp;</span>&nbsp;<span class="ident" id="3911931"><a href="/net/http/transfer.go.html#3911179">n</a></span>&nbsp;<span class="op" id="3911933">&gt;</span>&nbsp;<span class="num" id="3911935">0</span>&nbsp;<span class="op" id="3911937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3911941">if</span>&nbsp;<span class="ident" id="3911944">lr</span><span class="op" id="3911946">,</span>&nbsp;<span class="ident" id="3911948">ok</span>&nbsp;<span class="op" id="3911951">:=</span>&nbsp;<span class="ident" id="3911954"><a href="/net/http/transfer.go.html#3911148">b</a></span><span class="op" id="3911955">.</span><span class="ident" id="3911956">src</span><span class="op" id="3911959">.</span><span class="op" id="3911960">(</span><span class="op" id="3911961">*</span><span class="ident" id="3911962"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3911964">.</span><span class="ident" id="3911965">LimitedReader</span><span class="op" id="3911978">)</span><span class="op" id="3911979">;</span>&nbsp;<span class="ident" id="3911981"><a href="/net/http/transfer.go.html#3911948">ok</a></span>&nbsp;<span class="op" id="3911984">&amp;&amp;</span>&nbsp;<span class="ident" id="3911987"><a href="/net/http/transfer.go.html#3911944">lr</a></span><span class="op" id="3911989">.</span><span class="ident" id="3911990">N</span>&nbsp;<span class="op" id="3911992">==</span>&nbsp;<span class="num" id="3911995">0</span>&nbsp;<span class="op" id="3911997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3912002"><a href="/net/http/transfer.go.html#3911186">err</a></span>&nbsp;<span class="op" id="3912006">=</span>&nbsp;<span class="ident" id="3912008"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3912010">.</span><span class="ident" id="3912011">EOF</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3912017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3912020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3912024">return</span>&nbsp;<span class="ident" id="3912031"><a href="/net/http/transfer.go.html#3911179">n</a></span><span class="op" id="3912032">,</span>&nbsp;<span class="ident" id="3912034"><a href="/net/http/transfer.go.html#3911186">err</a></span><br>
<span class="lineno"></span><span class="op" id="3912038">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="3912041">var</span>&nbsp;<span class="op" id="3912045">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3912048">singleCRLF</span>&nbsp;<span class="op" id="3912059">=</span>&nbsp;<span class="op" id="3912061">[</span><span class="op" id="3912062">]</span><span class="builtintype" id="3912063">byte</span><span class="op" id="3912067">(</span><span class="string" id="3912068">&#34;\r\n&#34;</span><span class="op" id="3912074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3912077">doubleCRLF</span>&nbsp;<span class="op" id="3912088">=</span>&nbsp;<span class="op" id="3912090">[</span><span class="op" id="3912091">]</span><span class="builtintype" id="3912092">byte</span><span class="op" id="3912096">(</span><span class="string" id="3912097">&#34;\r\n\r\n&#34;</span><span class="op" id="3912107">)</span><br>
<span class="lineno"></span><span class="op" id="3912109">)</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span><span class="keyword" id="3912112">func</span>&nbsp;<span class="ident" id="3912117">seeUpcomingDoubleCRLF</span><span class="op" id="3912138">(</span><span class="ident" id="3912139">r</span>&nbsp;<span class="op" id="3912141">*</span><span class="ident" id="3912142"><a href="/net/http/transfer.go.html#3896232">bufio</a></span><span class="op" id="3912147">.</span><span class="ident" id="3912148">Reader</span><span class="op" id="3912154">)</span>&nbsp;<span class="builtintype" id="3912156">bool</span>&nbsp;<span class="op" id="3912161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3912164">for</span>&nbsp;<span class="ident" id="3912168">peekSize</span>&nbsp;<span class="op" id="3912177">:=</span>&nbsp;<span class="num" id="3912180">4</span><span class="op" id="3912181">;</span>&nbsp;<span class="op" id="3912183">;</span>&nbsp;<span class="ident" id="3912185"><a href="/net/http/transfer.go.html#3912168">peekSize</a></span><span class="op" id="3912193">++</span>&nbsp;<span class="op" id="3912196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3912200">//&nbsp;This&nbsp;loop&nbsp;stops&nbsp;when&nbsp;Peek&nbsp;returns&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3912249">//&nbsp;which&nbsp;it&nbsp;does&nbsp;when&nbsp;r&#39;s&nbsp;buffer&nbsp;has&nbsp;been&nbsp;filled.</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3912301">buf</span><span class="op" id="3912304">,</span>&nbsp;<span class="ident" id="3912306">err</span>&nbsp;<span class="op" id="3912310">:=</span>&nbsp;<span class="ident" id="3912313"><a href="/net/http/transfer.go.html#3912139">r</a></span><span class="op" id="3912314">.</span><span class="ident" id="3912315">Peek</span><span class="op" id="3912319">(</span><span class="ident" id="3912320"><a href="/net/http/transfer.go.html#3912168">peekSize</a></span><span class="op" id="3912328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3912332">if</span>&nbsp;<span class="ident" id="3912335"><a href="/net/http/transfer.go.html#3896241">bytes</a></span><span class="op" id="3912340">.</span><span class="ident" id="3912341">HasSuffix</span><span class="op" id="3912350">(</span><span class="ident" id="3912351"><a href="/net/http/transfer.go.html#3912301">buf</a></span><span class="op" id="3912354">,</span>&nbsp;<span class="ident" id="3912356"><a href="/net/http/transfer.go.html#3912077">doubleCRLF</a></span><span class="op" id="3912366">)</span>&nbsp;<span class="op" id="3912368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3912373">return</span>&nbsp;<span class="ident" id="3912380">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3912387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3912391">if</span>&nbsp;<span class="ident" id="3912394"><a href="/net/http/transfer.go.html#3912306">err</a></span>&nbsp;<span class="op" id="3912398">!=</span>&nbsp;<span class="ident" id="3912401">nil</span>&nbsp;<span class="op" id="3912405">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3912410">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3912418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3912421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3912424">return</span>&nbsp;<span class="ident" id="3912431">false</span><br>
<span class="lineno"></span><span class="op" id="3912437">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span><span class="keyword" id="3912440">var</span>&nbsp;<span class="ident" id="3912444">errTrailerEOF</span>&nbsp;<span class="op" id="3912458">=</span>&nbsp;<span class="ident" id="3912460"><a href="/net/http/transfer.go.html#3896250">errors</a></span><span class="op" id="3912466">.</span><span class="ident" id="3912467">New</span><span class="op" id="3912470">(</span><span class="string" id="3912471">&#34;http:&nbsp;unexpected&nbsp;EOF&nbsp;reading&nbsp;trailer&#34;</span><span class="op" id="3912509">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3912512">func</span>&nbsp;<span class="op" id="3912517">(</span><span class="ident" id="3912518">b</span>&nbsp;<span class="op" id="3912520">*</span><span class="ident" id="3912521"><a href="/net/http/transfer.go.html#3910302">body</a></span><span class="op" id="3912525">)</span>&nbsp;<span class="ident" id="3912527">readTrailer</span><span class="op" id="3912538">(</span><span class="op" id="3912539">)</span>&nbsp;<span class="builtintype" id="3912541">error</span>&nbsp;<span class="op" id="3912547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3912550">//&nbsp;The&nbsp;common&nbsp;case,&nbsp;since&nbsp;nobody&nbsp;uses&nbsp;trailers.</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3912599">buf</span><span class="op" id="3912602">,</span>&nbsp;<span class="ident" id="3912604">err</span>&nbsp;<span class="op" id="3912608">:=</span>&nbsp;<span class="ident" id="3912611"><a href="/net/http/transfer.go.html#3912518">b</a></span><span class="op" id="3912612">.</span><span class="ident" id="3912613">r</span><span class="op" id="3912614">.</span><span class="ident" id="3912615">Peek</span><span class="op" id="3912619">(</span><span class="num" id="3912620">2</span><span class="op" id="3912621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3912624">if</span>&nbsp;<span class="ident" id="3912627"><a href="/net/http/transfer.go.html#3896241">bytes</a></span><span class="op" id="3912632">.</span><span class="ident" id="3912633">Equal</span><span class="op" id="3912638">(</span><span class="ident" id="3912639"><a href="/net/http/transfer.go.html#3912599">buf</a></span><span class="op" id="3912642">,</span>&nbsp;<span class="ident" id="3912644"><a href="/net/http/transfer.go.html#3912048">singleCRLF</a></span><span class="op" id="3912654">)</span>&nbsp;<span class="op" id="3912656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3912660"><a href="/net/http/transfer.go.html#3912518">b</a></span><span class="op" id="3912661">.</span><span class="ident" id="3912662">r</span><span class="op" id="3912663">.</span><span class="ident" id="3912664">ReadByte</span><span class="op" id="3912672">(</span><span class="op" id="3912673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3912677"><a href="/net/http/transfer.go.html#3912518">b</a></span><span class="op" id="3912678">.</span><span class="ident" id="3912679">r</span><span class="op" id="3912680">.</span><span class="ident" id="3912681">ReadByte</span><span class="op" id="3912689">(</span><span class="op" id="3912690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3912694">return</span>&nbsp;<span class="ident" id="3912701">nil</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3912706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3912709">if</span>&nbsp;<span class="builtinfunc" id="3912712">len</span><span class="op" id="3912715">(</span><span class="ident" id="3912716"><a href="/net/http/transfer.go.html#3912599">buf</a></span><span class="op" id="3912719">)</span>&nbsp;<span class="op" id="3912721">&lt;</span>&nbsp;<span class="num" id="3912723">2</span>&nbsp;<span class="op" id="3912725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3912729">return</span>&nbsp;<span class="ident" id="3912736"><a href="/net/http/transfer.go.html#3912444">errTrailerEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3912751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3912754">if</span>&nbsp;<span class="ident" id="3912757"><a href="/net/http/transfer.go.html#3912604">err</a></span>&nbsp;<span class="op" id="3912761">!=</span>&nbsp;<span class="ident" id="3912764">nil</span>&nbsp;<span class="op" id="3912768">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3912772">return</span>&nbsp;<span class="ident" id="3912779"><a href="/net/http/transfer.go.html#3912604">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3912784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3912788">//&nbsp;Make&nbsp;sure&nbsp;there&#39;s&nbsp;a&nbsp;header&nbsp;terminator&nbsp;coming&nbsp;up,&nbsp;to&nbsp;prevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3912852">//&nbsp;a&nbsp;DoS&nbsp;with&nbsp;an&nbsp;unbounded&nbsp;size&nbsp;Trailer.&nbsp;&nbsp;It&#39;s&nbsp;not&nbsp;easy&nbsp;to</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3912912">//&nbsp;slip&nbsp;in&nbsp;a&nbsp;LimitReader&nbsp;here,&nbsp;as&nbsp;textproto.NewReader&nbsp;requires</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3912976">//&nbsp;a&nbsp;concrete&nbsp;*bufio.Reader.&nbsp;&nbsp;Also,&nbsp;we&nbsp;can&#39;t&nbsp;get&nbsp;all&nbsp;the&nbsp;way</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3913038">//&nbsp;back&nbsp;up&nbsp;to&nbsp;our&nbsp;conn&#39;s&nbsp;LimitedReader&nbsp;that&nbsp;*might*&nbsp;be&nbsp;backing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3913102">//&nbsp;this&nbsp;bufio.Reader.&nbsp;&nbsp;Instead,&nbsp;a&nbsp;hack:&nbsp;we&nbsp;iteratively&nbsp;Peek&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3913166">//&nbsp;to&nbsp;the&nbsp;bufio.Reader&#39;s&nbsp;max&nbsp;size,&nbsp;looking&nbsp;for&nbsp;a&nbsp;double&nbsp;CRLF.</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3913229">//&nbsp;This&nbsp;limits&nbsp;the&nbsp;trailer&nbsp;to&nbsp;the&nbsp;underlying&nbsp;buffer&nbsp;size,&nbsp;typically&nbsp;4kB.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913303">if</span>&nbsp;<span class="op" id="3913306">!</span><span class="ident" id="3913307"><a href="/net/http/transfer.go.html#3912117">seeUpcomingDoubleCRLF</a></span><span class="op" id="3913328">(</span><span class="ident" id="3913329"><a href="/net/http/transfer.go.html#3912518">b</a></span><span class="op" id="3913330">.</span><span class="ident" id="3913331">r</span><span class="op" id="3913332">)</span>&nbsp;<span class="op" id="3913334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913338">return</span>&nbsp;<span class="ident" id="3913345"><a href="/net/http/transfer.go.html#3896250">errors</a></span><span class="op" id="3913351">.</span><span class="ident" id="3913352">New</span><span class="op" id="3913355">(</span><span class="string" id="3913356">&#34;http:&nbsp;suspiciously&nbsp;long&nbsp;trailer&nbsp;after&nbsp;chunked&nbsp;body&#34;</span><span class="op" id="3913408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3913411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3913415">hdr</span><span class="op" id="3913418">,</span>&nbsp;<span class="ident" id="3913420"><a href="/net/http/transfer.go.html#3912604">err</a></span>&nbsp;<span class="op" id="3913424">:=</span>&nbsp;<span class="ident" id="3913427"><a href="/net/http/transfer.go.html#3896307">textproto</a></span><span class="op" id="3913436">.</span><span class="ident" id="3913437">NewReader</span><span class="op" id="3913446">(</span><span class="ident" id="3913447"><a href="/net/http/transfer.go.html#3912518">b</a></span><span class="op" id="3913448">.</span><span class="ident" id="3913449">r</span><span class="op" id="3913450">)</span><span class="op" id="3913451">.</span><span class="ident" id="3913452">ReadMIMEHeader</span><span class="op" id="3913466">(</span><span class="op" id="3913467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913470">if</span>&nbsp;<span class="ident" id="3913473"><a href="/net/http/transfer.go.html#3912604">err</a></span>&nbsp;<span class="op" id="3913477">!=</span>&nbsp;<span class="ident" id="3913480">nil</span>&nbsp;<span class="op" id="3913484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913488">if</span>&nbsp;<span class="ident" id="3913491"><a href="/net/http/transfer.go.html#3912604">err</a></span>&nbsp;<span class="op" id="3913495">==</span>&nbsp;<span class="ident" id="3913498"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3913500">.</span><span class="ident" id="3913501">EOF</span>&nbsp;<span class="op" id="3913505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913510">return</span>&nbsp;<span class="ident" id="3913517"><a href="/net/http/transfer.go.html#3912444">errTrailerEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3913533">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913537">return</span>&nbsp;<span class="ident" id="3913544"><a href="/net/http/transfer.go.html#3912604">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3913549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913552">switch</span>&nbsp;<span class="ident" id="3913559">rr</span>&nbsp;<span class="op" id="3913562">:=</span>&nbsp;<span class="ident" id="3913565"><a href="/net/http/transfer.go.html#3912518">b</a></span><span class="op" id="3913566">.</span><span class="ident" id="3913567">hdr</span><span class="op" id="3913570">.</span><span class="op" id="3913571">(</span><span class="keyword" id="3913572">type</span><span class="op" id="3913576">)</span>&nbsp;<span class="op" id="3913578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913581">case</span>&nbsp;<span class="op" id="3913586">*</span><span class="ident" id="3913587"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3913594">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3913598"><a href="/net/http/transfer.go.html#3913722">mergeSetHeader</a></span><span class="op" id="3913612">(</span><span class="op" id="3913613">&amp;</span><span class="ident" id="3913614"><a href="/net/http/transfer.go.html#3913559">rr</a></span><span class="op" id="3913616">.</span><span class="ident" id="3913617">Trailer</span><span class="op" id="3913624">,</span>&nbsp;<span class="ident" id="3913626"><a href="/net/http/header.go.html#3781581">Header</a></span><span class="op" id="3913632">(</span><span class="ident" id="3913633"><a href="/net/http/transfer.go.html#3913415">hdr</a></span><span class="op" id="3913636">)</span><span class="op" id="3913637">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913640">case</span>&nbsp;<span class="op" id="3913645">*</span><span class="ident" id="3913646"><a href="/net/http/response.go.html#3816973">Response</a></span><span class="op" id="3913654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3913658"><a href="/net/http/transfer.go.html#3913722">mergeSetHeader</a></span><span class="op" id="3913672">(</span><span class="op" id="3913673">&amp;</span><span class="ident" id="3913674"><a href="/net/http/transfer.go.html#3913559">rr</a></span><span class="op" id="3913676">.</span><span class="ident" id="3913677">Trailer</span><span class="op" id="3913684">,</span>&nbsp;<span class="ident" id="3913686"><a href="/net/http/header.go.html#3781581">Header</a></span><span class="op" id="3913692">(</span><span class="ident" id="3913693"><a href="/net/http/transfer.go.html#3913415">hdr</a></span><span class="op" id="3913696">)</span><span class="op" id="3913697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3913700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913703">return</span>&nbsp;<span class="ident" id="3913710">nil</span><br>
<span class="lineno"></span><span class="op" id="3913714">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="3913717">func</span>&nbsp;<span class="ident" id="3913722">mergeSetHeader</span><span class="op" id="3913736">(</span><span class="ident" id="3913737">dst</span>&nbsp;<span class="op" id="3913741">*</span><span class="ident" id="3913742"><a href="/net/http/header.go.html#3781581">Header</a></span><span class="op" id="3913748">,</span>&nbsp;<span class="ident" id="3913750">src</span>&nbsp;<span class="ident" id="3913754"><a href="/net/http/header.go.html#3781581">Header</a></span><span class="op" id="3913760">)</span>&nbsp;<span class="op" id="3913762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913765">if</span>&nbsp;<span class="op" id="3913768">*</span><span class="ident" id="3913769"><a href="/net/http/transfer.go.html#3913737">dst</a></span>&nbsp;<span class="op" id="3913773">==</span>&nbsp;<span class="ident" id="3913776">nil</span>&nbsp;<span class="op" id="3913780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3913784">*</span><span class="ident" id="3913785"><a href="/net/http/transfer.go.html#3913737">dst</a></span>&nbsp;<span class="op" id="3913789">=</span>&nbsp;<span class="ident" id="3913791"><a href="/net/http/transfer.go.html#3913750">src</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913797">return</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3913805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913808">for</span>&nbsp;<span class="ident" id="3913812">k</span><span class="op" id="3913813">,</span>&nbsp;<span class="ident" id="3913815">vv</span>&nbsp;<span class="op" id="3913818">:=</span>&nbsp;<span class="keyword" id="3913821">range</span>&nbsp;<span class="ident" id="3913827"><a href="/net/http/transfer.go.html#3913750">src</a></span>&nbsp;<span class="op" id="3913831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3913835">(</span><span class="op" id="3913836">*</span><span class="ident" id="3913837"><a href="/net/http/transfer.go.html#3913737">dst</a></span><span class="op" id="3913840">)</span><span class="op" id="3913841">[</span><span class="ident" id="3913842"><a href="/net/http/transfer.go.html#3913812">k</a></span><span class="op" id="3913843">]</span>&nbsp;<span class="op" id="3913845">=</span>&nbsp;<span class="ident" id="3913847"><a href="/net/http/transfer.go.html#3913815">vv</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3913851">}</span><br>
<span class="lineno"></span><span class="op" id="3913853">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="3913856">func</span>&nbsp;<span class="op" id="3913861">(</span><span class="ident" id="3913862">b</span>&nbsp;<span class="op" id="3913864">*</span><span class="ident" id="3913865"><a href="/net/http/transfer.go.html#3910302">body</a></span><span class="op" id="3913869">)</span>&nbsp;<span class="ident" id="3913871">Close</span><span class="op" id="3913876">(</span><span class="op" id="3913877">)</span>&nbsp;<span class="builtintype" id="3913879">error</span>&nbsp;<span class="op" id="3913885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3913888"><a href="/net/http/transfer.go.html#3913862">b</a></span><span class="op" id="3913889">.</span><span class="ident" id="3913890">mu</span><span class="op" id="3913892">.</span><span class="ident" id="3913893">Lock</span><span class="op" id="3913897">(</span><span class="op" id="3913898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913901">defer</span>&nbsp;<span class="ident" id="3913907"><a href="/net/http/transfer.go.html#3913862">b</a></span><span class="op" id="3913908">.</span><span class="ident" id="3913909">mu</span><span class="op" id="3913911">.</span><span class="ident" id="3913912">Unlock</span><span class="op" id="3913918">(</span><span class="op" id="3913919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913922">if</span>&nbsp;<span class="ident" id="3913925"><a href="/net/http/transfer.go.html#3913862">b</a></span><span class="op" id="3913926">.</span><span class="ident" id="3913927">closed</span>&nbsp;<span class="op" id="3913934">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913938">return</span>&nbsp;<span class="ident" id="3913945">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3913950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913953">var</span>&nbsp;<span class="ident" id="3913957">err</span>&nbsp;<span class="builtintype" id="3913961">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913968">switch</span>&nbsp;<span class="op" id="3913975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3913978">case</span>&nbsp;<span class="ident" id="3913983"><a href="/net/http/transfer.go.html#3913862">b</a></span><span class="op" id="3913984">.</span><span class="ident" id="3913985">hdr</span>&nbsp;<span class="op" id="3913989">==</span>&nbsp;<span class="ident" id="3913992">nil</span>&nbsp;<span class="op" id="3913996">&amp;&amp;</span>&nbsp;<span class="ident" id="3913999"><a href="/net/http/transfer.go.html#3913862">b</a></span><span class="op" id="3914000">.</span><span class="ident" id="3914001">closing</span><span class="op" id="3914008">:</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3914012">//&nbsp;no&nbsp;trailer&nbsp;and&nbsp;closing&nbsp;the&nbsp;connection&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3914061">//&nbsp;no&nbsp;point&nbsp;in&nbsp;reading&nbsp;to&nbsp;EOF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3914093">default</span><span class="op" id="3914100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3914104">//&nbsp;Fully&nbsp;consume&nbsp;the&nbsp;body,&nbsp;which&nbsp;will&nbsp;also&nbsp;lead&nbsp;to&nbsp;us&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3914168">//&nbsp;the&nbsp;trailer&nbsp;headers&nbsp;after&nbsp;the&nbsp;body,&nbsp;if&nbsp;present.</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3914221">_</span><span class="op" id="3914222">,</span>&nbsp;<span class="ident" id="3914224"><a href="/net/http/transfer.go.html#3913957">err</a></span>&nbsp;<span class="op" id="3914228">=</span>&nbsp;<span class="ident" id="3914230"><a href="/net/http/transfer.go.html#3896267">io</a></span><span class="op" id="3914232">.</span><span class="ident" id="3914233">Copy</span><span class="op" id="3914237">(</span><span class="ident" id="3914238"><a href="/net/http/transfer.go.html#3896273">ioutil</a></span><span class="op" id="3914244">.</span><span class="ident" id="3914245">Discard</span><span class="op" id="3914252">,</span>&nbsp;<span class="ident" id="3914254"><a href="/net/http/transfer.go.html#3914394">bodyLocked</a></span><span class="op" id="3914264">{</span><span class="ident" id="3914265"><a href="/net/http/transfer.go.html#3913862">b</a></span><span class="op" id="3914266">}</span><span class="op" id="3914267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3914270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3914273"><a href="/net/http/transfer.go.html#3913862">b</a></span><span class="op" id="3914274">.</span><span class="ident" id="3914275">closed</span>&nbsp;<span class="op" id="3914282">=</span>&nbsp;<span class="ident" id="3914284">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3914290">return</span>&nbsp;<span class="ident" id="3914297"><a href="/net/http/transfer.go.html#3913957">err</a></span><br>
<span class="lineno"></span><span class="op" id="3914301">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="3914304">//&nbsp;bodyLocked&nbsp;is&nbsp;a&nbsp;io.Reader&nbsp;reading&nbsp;from&nbsp;a&nbsp;*body&nbsp;when&nbsp;its&nbsp;mutex&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3914372">//&nbsp;already&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="3914389">type</span>&nbsp;<span class="ident" id="3914394">bodyLocked</span>&nbsp;<span class="keyword" id="3914405">struct</span>&nbsp;<span class="op" id="3914412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3914415">b</span>&nbsp;<span class="op" id="3914417">*</span><span class="ident" id="3914418"><a href="/net/http/transfer.go.html#3910302">body</a></span><br>
<span class="lineno">715</span><span class="op" id="3914423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3914426">func</span>&nbsp;<span class="op" id="3914431">(</span><span class="ident" id="3914432">bl</span>&nbsp;<span class="ident" id="3914435"><a href="/net/http/transfer.go.html#3914394">bodyLocked</a></span><span class="op" id="3914445">)</span>&nbsp;<span class="ident" id="3914447">Read</span><span class="op" id="3914451">(</span><span class="ident" id="3914452">p</span>&nbsp;<span class="op" id="3914454">[</span><span class="op" id="3914455">]</span><span class="builtintype" id="3914456">byte</span><span class="op" id="3914460">)</span>&nbsp;<span class="op" id="3914462">(</span><span class="ident" id="3914463">n</span>&nbsp;<span class="builtintype" id="3914465">int</span><span class="op" id="3914468">,</span>&nbsp;<span class="ident" id="3914470">err</span>&nbsp;<span class="builtintype" id="3914474">error</span><span class="op" id="3914479">)</span>&nbsp;<span class="op" id="3914481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3914484">if</span>&nbsp;<span class="ident" id="3914487"><a href="/net/http/transfer.go.html#3914432">bl</a></span><span class="op" id="3914489">.</span><span class="ident" id="3914490">b</span><span class="op" id="3914491">.</span><span class="ident" id="3914492">closed</span>&nbsp;<span class="op" id="3914499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3914503">return</span>&nbsp;<span class="num" id="3914510">0</span><span class="op" id="3914511">,</span>&nbsp;<span class="ident" id="3914513"><a href="/net/http/transfer.go.html#3910886">ErrBodyReadAfterClose</a></span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3914536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3914539">return</span>&nbsp;<span class="ident" id="3914546"><a href="/net/http/transfer.go.html#3914432">bl</a></span><span class="op" id="3914548">.</span><span class="ident" id="3914549">b</span><span class="op" id="3914550">.</span><span class="ident" id="3914551">readLocked</span><span class="op" id="3914561">(</span><span class="ident" id="3914562"><a href="/net/http/transfer.go.html#3914452">p</a></span><span class="op" id="3914563">)</span><br>
<span class="lineno"></span><span class="op" id="3914565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3914568">//&nbsp;parseContentLength&nbsp;trims&nbsp;whitespace&nbsp;from&nbsp;s&nbsp;and&nbsp;returns&nbsp;-1&nbsp;if&nbsp;no&nbsp;value</span><br>
<span class="lineno">725</span><span class="comment" id="3914641">//&nbsp;is&nbsp;set,&nbsp;or&nbsp;the&nbsp;value&nbsp;if&nbsp;it&#39;s&nbsp;&gt;=&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3914679">func</span>&nbsp;<span class="ident" id="3914684">parseContentLength</span><span class="op" id="3914702">(</span><span class="ident" id="3914703">cl</span>&nbsp;<span class="builtintype" id="3914706">string</span><span class="op" id="3914712">)</span>&nbsp;<span class="op" id="3914714">(</span><span class="ident" id="3914715">int64</span><span class="op" id="3914720">,</span>&nbsp;<span class="builtintype" id="3914722">error</span><span class="op" id="3914727">)</span>&nbsp;<span class="op" id="3914729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3914732"><a href="/net/http/transfer.go.html#3914703">cl</a></span>&nbsp;<span class="op" id="3914735">=</span>&nbsp;<span class="ident" id="3914737"><a href="/net/http/transfer.go.html#3896343">strings</a></span><span class="op" id="3914744">.</span><span class="ident" id="3914745">TrimSpace</span><span class="op" id="3914754">(</span><span class="ident" id="3914755"><a href="/net/http/transfer.go.html#3914703">cl</a></span><span class="op" id="3914757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3914760">if</span>&nbsp;<span class="ident" id="3914763"><a href="/net/http/transfer.go.html#3914703">cl</a></span>&nbsp;<span class="op" id="3914766">==</span>&nbsp;<span class="string" id="3914769">&#34;&#34;</span>&nbsp;<span class="op" id="3914772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3914776">return</span>&nbsp;<span class="op" id="3914783">-</span><span class="num" id="3914784">1</span><span class="op" id="3914785">,</span>&nbsp;<span class="ident" id="3914787">nil</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3914792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3914795">n</span><span class="op" id="3914796">,</span>&nbsp;<span class="ident" id="3914798">err</span>&nbsp;<span class="op" id="3914802">:=</span>&nbsp;<span class="ident" id="3914805"><a href="/net/http/transfer.go.html#3896332">strconv</a></span><span class="op" id="3914812">.</span><span class="ident" id="3914813">ParseInt</span><span class="op" id="3914821">(</span><span class="ident" id="3914822"><a href="/net/http/transfer.go.html#3914703">cl</a></span><span class="op" id="3914824">,</span>&nbsp;<span class="num" id="3914826">10</span><span class="op" id="3914828">,</span>&nbsp;<span class="num" id="3914830">64</span><span class="op" id="3914832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3914835">if</span>&nbsp;<span class="ident" id="3914838"><a href="/net/http/transfer.go.html#3914798">err</a></span>&nbsp;<span class="op" id="3914842">!=</span>&nbsp;<span class="ident" id="3914845">nil</span>&nbsp;<span class="op" id="3914849">||</span>&nbsp;<span class="ident" id="3914852"><a href="/net/http/transfer.go.html#3914795">n</a></span>&nbsp;<span class="op" id="3914854">&lt;</span>&nbsp;<span class="num" id="3914856">0</span>&nbsp;<span class="op" id="3914858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3914862">return</span>&nbsp;<span class="num" id="3914869">0</span><span class="op" id="3914870">,</span>&nbsp;<span class="op" id="3914872">&amp;</span><span class="ident" id="3914873"><a href="/net/http/request.go.html#3790712">badStringError</a></span><span class="op" id="3914887">{</span><span class="string" id="3914888">&#34;bad&nbsp;Content-Length&#34;</span><span class="op" id="3914908">,</span>&nbsp;<span class="ident" id="3914910"><a href="/net/http/transfer.go.html#3914703">cl</a></span><span class="op" id="3914912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3914915">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3914918">return</span>&nbsp;<span class="ident" id="3914925"><a href="/net/http/transfer.go.html#3914795">n</a></span><span class="op" id="3914926">,</span>&nbsp;<span class="ident" id="3914928">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="3914933">}</span>
</div>
</body>
</html>
