<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5849349">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5849404">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5849458">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5849509">//&nbsp;This&nbsp;algorithm&nbsp;is&nbsp;based&nbsp;on&nbsp;&#34;Faster&nbsp;Suffix&nbsp;Sorting&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5849563">//&nbsp;&nbsp;&nbsp;by&nbsp;N.&nbsp;Jesper&nbsp;Larsson&nbsp;and&nbsp;Kunihiko&nbsp;Sadakane</span><br>
<span class="lineno"></span><span class="comment" id="5849611">//&nbsp;paper:&nbsp;http://www.larsson.dogma.net/ssrev-tr.pdf</span><br>
<span class="lineno"></span><span class="comment" id="5849663">//&nbsp;code:&nbsp;&nbsp;http://www.larsson.dogma.net/qsufsort.c</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="5849714">//&nbsp;This&nbsp;algorithm&nbsp;computes&nbsp;the&nbsp;suffix&nbsp;array&nbsp;sa&nbsp;by&nbsp;computing&nbsp;its&nbsp;inverse.</span><br>
<span class="lineno"></span><span class="comment" id="5849787">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;in&nbsp;sa&nbsp;are&nbsp;labeled&nbsp;as&nbsp;sorted&nbsp;groups&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5849859">//&nbsp;unsorted&nbsp;groups.&nbsp;For&nbsp;a&nbsp;given&nbsp;pass&nbsp;of&nbsp;the&nbsp;sorter,&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;ordered</span><br>
<span class="lineno"></span><span class="comment" id="5849936">//&nbsp;up&nbsp;to&nbsp;their&nbsp;first&nbsp;h&nbsp;characters,&nbsp;and&nbsp;sa&nbsp;is&nbsp;h-ordered.&nbsp;Suffixes&nbsp;in&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="5850010">//&nbsp;final&nbsp;positions&nbsp;and&nbsp;unambiguously&nbsp;sorted&nbsp;in&nbsp;h-order&nbsp;are&nbsp;in&nbsp;a&nbsp;sorted&nbsp;group.</span><br>
<span class="lineno">15</span><span class="comment" id="5850088">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;with&nbsp;identical&nbsp;first&nbsp;h&nbsp;characters&nbsp;are&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5850163">//&nbsp;unsorted&nbsp;group.&nbsp;In&nbsp;each&nbsp;pass&nbsp;of&nbsp;the&nbsp;algorithm,&nbsp;unsorted&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span><span class="comment" id="5850240">//&nbsp;according&nbsp;to&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;their&nbsp;following&nbsp;suffix.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5850301">//&nbsp;In&nbsp;the&nbsp;implementation,&nbsp;if&nbsp;sa[i]&nbsp;is&nbsp;negative,&nbsp;it&nbsp;indicates&nbsp;that&nbsp;i&nbsp;is</span><br>
<span class="lineno">20</span><span class="comment" id="5850372">//&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;a&nbsp;sorted&nbsp;group&nbsp;of&nbsp;length&nbsp;-sa[i],&nbsp;and&nbsp;can&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="comment" id="5850449">//&nbsp;An&nbsp;unsorted&nbsp;group&nbsp;sa[i:k]&nbsp;is&nbsp;given&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;the&nbsp;index&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5850524">//&nbsp;last&nbsp;element,&nbsp;k-1.&nbsp;The&nbsp;group&nbsp;numbers&nbsp;are&nbsp;stored&nbsp;in&nbsp;the&nbsp;inverse&nbsp;slice&nbsp;(inv),</span><br>
<span class="lineno"></span><span class="comment" id="5850603">//&nbsp;and&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted,&nbsp;this&nbsp;slice&nbsp;is&nbsp;the&nbsp;inverse&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5850679">package</span>&nbsp;<span class="ident" id="5850687">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5850700">import</span>&nbsp;<span class="string" id="5850707">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5850715">func</span>&nbsp;<span class="ident" id="5850720">qsufsort</span><span class="op" id="5850728">(</span><span class="ident" id="5850729">data</span>&nbsp;<span class="op" id="5850734">[</span><span class="op" id="5850735">]</span><span class="builtintype" id="5850736">byte</span><span class="op" id="5850740">)</span>&nbsp;<span class="op" id="5850742">[</span><span class="op" id="5850743">]</span><span class="builtintype" id="5850744">int</span>&nbsp;<span class="op" id="5850748">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5850751">//&nbsp;initial&nbsp;sorting&nbsp;by&nbsp;first&nbsp;byte&nbsp;of&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5850795">sa</span>&nbsp;<span class="op" id="5850798">:=</span>&nbsp;<span class="ident" id="5850801">sortedByFirstByte</span><span class="op" id="5850818">(</span><span class="ident" id="5850819">data</span><span class="op" id="5850823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5850826">if</span>&nbsp;<span class="builtinfunc" id="5850829">len</span><span class="op" id="5850832">(</span><span class="ident" id="5850833">sa</span><span class="op" id="5850835">)</span>&nbsp;<span class="op" id="5850837">&lt;</span>&nbsp;<span class="num" id="5850839">2</span>&nbsp;<span class="op" id="5850841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5850845">return</span>&nbsp;<span class="ident" id="5850852">sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5850856">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5850859">//&nbsp;initialize&nbsp;the&nbsp;group&nbsp;lookup&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5850897">//&nbsp;this&nbsp;becomes&nbsp;the&nbsp;inverse&nbsp;of&nbsp;the&nbsp;suffix&nbsp;array&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5850973">inv</span>&nbsp;<span class="op" id="5850977">:=</span>&nbsp;<span class="ident" id="5850980">initGroups</span><span class="op" id="5850990">(</span><span class="ident" id="5850991">sa</span><span class="op" id="5850993">,</span>&nbsp;<span class="ident" id="5850995">data</span><span class="op" id="5850999">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5851003">//&nbsp;the&nbsp;index&nbsp;starts&nbsp;1-ordered</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5851034">sufSortable</span>&nbsp;<span class="op" id="5851046">:=</span>&nbsp;<span class="op" id="5851049">&amp;</span><span class="ident" id="5851050">suffixSortable</span><span class="op" id="5851064">{</span><span class="ident" id="5851065">sa</span><span class="op" id="5851067">:</span>&nbsp;<span class="ident" id="5851069">sa</span><span class="op" id="5851071">,</span>&nbsp;<span class="ident" id="5851073">inv</span><span class="op" id="5851076">:</span>&nbsp;<span class="ident" id="5851078">inv</span><span class="op" id="5851081">,</span>&nbsp;<span class="ident" id="5851083">h</span><span class="op" id="5851084">:</span>&nbsp;<span class="num" id="5851086">1</span><span class="op" id="5851087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5851091">for</span>&nbsp;<span class="ident" id="5851095">sa</span><span class="op" id="5851097">[</span><span class="num" id="5851098">0</span><span class="op" id="5851099">]</span>&nbsp;<span class="op" id="5851101">&gt;</span>&nbsp;<span class="op" id="5851103">-</span><span class="builtinfunc" id="5851104">len</span><span class="op" id="5851107">(</span><span class="ident" id="5851108">sa</span><span class="op" id="5851110">)</span>&nbsp;<span class="op" id="5851112">{</span>&nbsp;<span class="comment" id="5851114">//&nbsp;until&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;one&nbsp;big&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5851163">//&nbsp;The&nbsp;suffixes&nbsp;are&nbsp;h-ordered,&nbsp;make&nbsp;them&nbsp;2*h-ordered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5851218">pi</span>&nbsp;<span class="op" id="5851221">:=</span>&nbsp;<span class="num" id="5851224">0</span>&nbsp;<span class="comment" id="5851226">//&nbsp;pi&nbsp;is&nbsp;first&nbsp;position&nbsp;of&nbsp;first&nbsp;group</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5851267">sl</span>&nbsp;<span class="op" id="5851270">:=</span>&nbsp;<span class="num" id="5851273">0</span>&nbsp;<span class="comment" id="5851275">//&nbsp;sl&nbsp;is&nbsp;negated&nbsp;length&nbsp;of&nbsp;sorted&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5851318">for</span>&nbsp;<span class="ident" id="5851322">pi</span>&nbsp;<span class="op" id="5851325">&lt;</span>&nbsp;<span class="builtinfunc" id="5851327">len</span><span class="op" id="5851330">(</span><span class="ident" id="5851331">sa</span><span class="op" id="5851333">)</span>&nbsp;<span class="op" id="5851335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5851340">if</span>&nbsp;<span class="ident" id="5851343">s</span>&nbsp;<span class="op" id="5851345">:=</span>&nbsp;<span class="ident" id="5851348">sa</span><span class="op" id="5851350">[</span><span class="ident" id="5851351">pi</span><span class="op" id="5851353">]</span><span class="op" id="5851354">;</span>&nbsp;<span class="ident" id="5851356">s</span>&nbsp;<span class="op" id="5851358">&lt;</span>&nbsp;<span class="num" id="5851360">0</span>&nbsp;<span class="op" id="5851362">{</span>&nbsp;<span class="comment" id="5851364">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5851397">pi</span>&nbsp;<span class="op" id="5851400">-=</span>&nbsp;<span class="ident" id="5851403">s</span>&nbsp;<span class="comment" id="5851405">//&nbsp;skip&nbsp;over&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5851435">sl</span>&nbsp;<span class="op" id="5851438">+=</span>&nbsp;<span class="ident" id="5851441">s</span>&nbsp;<span class="comment" id="5851443">//&nbsp;add&nbsp;negated&nbsp;length&nbsp;to&nbsp;sl</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5851474">}</span>&nbsp;<span class="keyword" id="5851476">else</span>&nbsp;<span class="op" id="5851481">{</span>&nbsp;<span class="comment" id="5851483">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5851518">if</span>&nbsp;<span class="ident" id="5851521">sl</span>&nbsp;<span class="op" id="5851524">!=</span>&nbsp;<span class="num" id="5851527">0</span>&nbsp;<span class="op" id="5851529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5851536">sa</span><span class="op" id="5851538">[</span><span class="ident" id="5851539">pi</span><span class="op" id="5851541">+</span><span class="ident" id="5851542">sl</span><span class="op" id="5851544">]</span>&nbsp;<span class="op" id="5851546">=</span>&nbsp;<span class="ident" id="5851548">sl</span>&nbsp;<span class="comment" id="5851551">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;before&nbsp;pi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5851591">sl</span>&nbsp;<span class="op" id="5851594">=</span>&nbsp;<span class="num" id="5851596">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5851602">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5851608">pk</span>&nbsp;<span class="op" id="5851611">:=</span>&nbsp;<span class="ident" id="5851614">inv</span><span class="op" id="5851617">[</span><span class="ident" id="5851618">s</span><span class="op" id="5851619">]</span>&nbsp;<span class="op" id="5851621">+</span>&nbsp;<span class="num" id="5851623">1</span>&nbsp;<span class="comment" id="5851625">//&nbsp;pk-1&nbsp;is&nbsp;last&nbsp;position&nbsp;of&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5851672">sufSortable</span><span class="op" id="5851683">.</span><span class="ident" id="5851684">sa</span>&nbsp;<span class="op" id="5851687">=</span>&nbsp;<span class="ident" id="5851689">sa</span><span class="op" id="5851691">[</span><span class="ident" id="5851692">pi</span><span class="op" id="5851694">:</span><span class="ident" id="5851695">pk</span><span class="op" id="5851697">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5851703">sort</span><span class="op" id="5851707">.</span><span class="ident" id="5851708">Sort</span><span class="op" id="5851712">(</span><span class="ident" id="5851713">sufSortable</span><span class="op" id="5851724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5851730">sufSortable</span><span class="op" id="5851741">.</span><span class="ident" id="5851742">updateGroups</span><span class="op" id="5851754">(</span><span class="ident" id="5851755">pi</span><span class="op" id="5851757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5851763">pi</span>&nbsp;<span class="op" id="5851766">=</span>&nbsp;<span class="ident" id="5851768">pk</span>&nbsp;<span class="comment" id="5851771">//&nbsp;next&nbsp;group</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5851788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5851792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5851796">if</span>&nbsp;<span class="ident" id="5851799">sl</span>&nbsp;<span class="op" id="5851802">!=</span>&nbsp;<span class="num" id="5851805">0</span>&nbsp;<span class="op" id="5851807">{</span>&nbsp;<span class="comment" id="5851809">//&nbsp;if&nbsp;the&nbsp;array&nbsp;ends&nbsp;with&nbsp;a&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5851853">sa</span><span class="op" id="5851855">[</span><span class="ident" id="5851856">pi</span><span class="op" id="5851858">+</span><span class="ident" id="5851859">sl</span><span class="op" id="5851861">]</span>&nbsp;<span class="op" id="5851863">=</span>&nbsp;<span class="ident" id="5851865">sl</span>&nbsp;<span class="comment" id="5851868">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;at&nbsp;end&nbsp;of&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5851908">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5851913">sufSortable</span><span class="op" id="5851924">.</span><span class="ident" id="5851925">h</span>&nbsp;<span class="op" id="5851927">*=</span>&nbsp;<span class="num" id="5851930">2</span>&nbsp;<span class="comment" id="5851932">//&nbsp;double&nbsp;sorted&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5851956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5851960">for</span>&nbsp;<span class="ident" id="5851964">i</span>&nbsp;<span class="op" id="5851966">:=</span>&nbsp;<span class="keyword" id="5851969">range</span>&nbsp;<span class="ident" id="5851975">sa</span>&nbsp;<span class="op" id="5851978">{</span>&nbsp;<span class="comment" id="5851980">//&nbsp;reconstruct&nbsp;suffix&nbsp;array&nbsp;from&nbsp;inverse</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852023">sa</span><span class="op" id="5852025">[</span><span class="ident" id="5852026">inv</span><span class="op" id="5852029">[</span><span class="ident" id="5852030">i</span><span class="op" id="5852031">]</span><span class="op" id="5852032">]</span>&nbsp;<span class="op" id="5852034">=</span>&nbsp;<span class="ident" id="5852036">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5852039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852042">return</span>&nbsp;<span class="ident" id="5852049">sa</span><br>
<span class="lineno"></span><span class="op" id="5852052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5852055">func</span>&nbsp;<span class="ident" id="5852060">sortedByFirstByte</span><span class="op" id="5852077">(</span><span class="ident" id="5852078">data</span>&nbsp;<span class="op" id="5852083">[</span><span class="op" id="5852084">]</span><span class="builtintype" id="5852085">byte</span><span class="op" id="5852089">)</span>&nbsp;<span class="op" id="5852091">[</span><span class="op" id="5852092">]</span><span class="builtintype" id="5852093">int</span>&nbsp;<span class="op" id="5852097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5852100">//&nbsp;total&nbsp;byte&nbsp;counts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852122">var</span>&nbsp;<span class="ident" id="5852126">count</span>&nbsp;<span class="op" id="5852132">[</span><span class="num" id="5852133">256</span><span class="op" id="5852136">]</span><span class="builtintype" id="5852137">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852142">for</span>&nbsp;<span class="ident" id="5852146">_</span><span class="op" id="5852147">,</span>&nbsp;<span class="ident" id="5852149">b</span>&nbsp;<span class="op" id="5852151">:=</span>&nbsp;<span class="keyword" id="5852154">range</span>&nbsp;<span class="ident" id="5852160">data</span>&nbsp;<span class="op" id="5852165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852169">count</span><span class="op" id="5852174">[</span><span class="ident" id="5852175">b</span><span class="op" id="5852176">]</span><span class="op" id="5852177">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5852181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5852184">//&nbsp;make&nbsp;count[b]&nbsp;equal&nbsp;index&nbsp;of&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;sorted&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852255">sum</span>&nbsp;<span class="op" id="5852259">:=</span>&nbsp;<span class="num" id="5852262">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852265">for</span>&nbsp;<span class="ident" id="5852269">b</span>&nbsp;<span class="op" id="5852271">:=</span>&nbsp;<span class="keyword" id="5852274">range</span>&nbsp;<span class="ident" id="5852280">count</span>&nbsp;<span class="op" id="5852286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852290">count</span><span class="op" id="5852295">[</span><span class="ident" id="5852296">b</span><span class="op" id="5852297">]</span><span class="op" id="5852298">,</span>&nbsp;<span class="ident" id="5852300">sum</span>&nbsp;<span class="op" id="5852304">=</span>&nbsp;<span class="ident" id="5852306">sum</span><span class="op" id="5852309">,</span>&nbsp;<span class="ident" id="5852311">count</span><span class="op" id="5852316">[</span><span class="ident" id="5852317">b</span><span class="op" id="5852318">]</span><span class="op" id="5852319">+</span><span class="ident" id="5852320">sum</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5852325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5852328">//&nbsp;iterate&nbsp;through&nbsp;bytes,&nbsp;placing&nbsp;index&nbsp;into&nbsp;the&nbsp;correct&nbsp;spot&nbsp;in&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852397">sa</span>&nbsp;<span class="op" id="5852400">:=</span>&nbsp;<span class="builtinfunc" id="5852403">make</span><span class="op" id="5852407">(</span><span class="op" id="5852408">[</span><span class="op" id="5852409">]</span><span class="builtintype" id="5852410">int</span><span class="op" id="5852413">,</span>&nbsp;<span class="builtinfunc" id="5852415">len</span><span class="op" id="5852418">(</span><span class="ident" id="5852419">data</span><span class="op" id="5852423">)</span><span class="op" id="5852424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852427">for</span>&nbsp;<span class="ident" id="5852431">i</span><span class="op" id="5852432">,</span>&nbsp;<span class="ident" id="5852434">b</span>&nbsp;<span class="op" id="5852436">:=</span>&nbsp;<span class="keyword" id="5852439">range</span>&nbsp;<span class="ident" id="5852445">data</span>&nbsp;<span class="op" id="5852450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852454">sa</span><span class="op" id="5852456">[</span><span class="ident" id="5852457">count</span><span class="op" id="5852462">[</span><span class="ident" id="5852463">b</span><span class="op" id="5852464">]</span><span class="op" id="5852465">]</span>&nbsp;<span class="op" id="5852467">=</span>&nbsp;<span class="ident" id="5852469">i</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852473">count</span><span class="op" id="5852478">[</span><span class="ident" id="5852479">b</span><span class="op" id="5852480">]</span><span class="op" id="5852481">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5852485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852488">return</span>&nbsp;<span class="ident" id="5852495">sa</span><br>
<span class="lineno"></span><span class="op" id="5852498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5852501">func</span>&nbsp;<span class="ident" id="5852506">initGroups</span><span class="op" id="5852516">(</span><span class="ident" id="5852517">sa</span>&nbsp;<span class="op" id="5852520">[</span><span class="op" id="5852521">]</span><span class="builtintype" id="5852522">int</span><span class="op" id="5852525">,</span>&nbsp;<span class="ident" id="5852527">data</span>&nbsp;<span class="op" id="5852532">[</span><span class="op" id="5852533">]</span><span class="builtintype" id="5852534">byte</span><span class="op" id="5852538">)</span>&nbsp;<span class="op" id="5852540">[</span><span class="op" id="5852541">]</span><span class="builtintype" id="5852542">int</span>&nbsp;<span class="op" id="5852546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5852549">//&nbsp;label&nbsp;contiguous&nbsp;same-letter&nbsp;groups&nbsp;with&nbsp;the&nbsp;same&nbsp;group&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852616">inv</span>&nbsp;<span class="op" id="5852620">:=</span>&nbsp;<span class="builtinfunc" id="5852623">make</span><span class="op" id="5852627">(</span><span class="op" id="5852628">[</span><span class="op" id="5852629">]</span><span class="builtintype" id="5852630">int</span><span class="op" id="5852633">,</span>&nbsp;<span class="builtinfunc" id="5852635">len</span><span class="op" id="5852638">(</span><span class="ident" id="5852639">data</span><span class="op" id="5852643">)</span><span class="op" id="5852644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852647">prevGroup</span>&nbsp;<span class="op" id="5852657">:=</span>&nbsp;<span class="builtinfunc" id="5852660">len</span><span class="op" id="5852663">(</span><span class="ident" id="5852664">sa</span><span class="op" id="5852666">)</span>&nbsp;<span class="op" id="5852668">-</span>&nbsp;<span class="num" id="5852670">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852673">groupByte</span>&nbsp;<span class="op" id="5852683">:=</span>&nbsp;<span class="ident" id="5852686">data</span><span class="op" id="5852690">[</span><span class="ident" id="5852691">sa</span><span class="op" id="5852693">[</span><span class="ident" id="5852694">prevGroup</span><span class="op" id="5852703">]</span><span class="op" id="5852704">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852707">for</span>&nbsp;<span class="ident" id="5852711">i</span>&nbsp;<span class="op" id="5852713">:=</span>&nbsp;<span class="builtinfunc" id="5852716">len</span><span class="op" id="5852719">(</span><span class="ident" id="5852720">sa</span><span class="op" id="5852722">)</span>&nbsp;<span class="op" id="5852724">-</span>&nbsp;<span class="num" id="5852726">1</span><span class="op" id="5852727">;</span>&nbsp;<span class="ident" id="5852729">i</span>&nbsp;<span class="op" id="5852731">&gt;=</span>&nbsp;<span class="num" id="5852734">0</span><span class="op" id="5852735">;</span>&nbsp;<span class="ident" id="5852737">i</span><span class="op" id="5852738">--</span>&nbsp;<span class="op" id="5852741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852745">if</span>&nbsp;<span class="ident" id="5852748">b</span>&nbsp;<span class="op" id="5852750">:=</span>&nbsp;<span class="ident" id="5852753">data</span><span class="op" id="5852757">[</span><span class="ident" id="5852758">sa</span><span class="op" id="5852760">[</span><span class="ident" id="5852761">i</span><span class="op" id="5852762">]</span><span class="op" id="5852763">]</span><span class="op" id="5852764">;</span>&nbsp;<span class="ident" id="5852766">b</span>&nbsp;<span class="op" id="5852768">&lt;</span>&nbsp;<span class="ident" id="5852770">groupByte</span>&nbsp;<span class="op" id="5852780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852785">if</span>&nbsp;<span class="ident" id="5852788">prevGroup</span>&nbsp;<span class="op" id="5852798">==</span>&nbsp;<span class="ident" id="5852801">i</span><span class="op" id="5852802">+</span><span class="num" id="5852803">1</span>&nbsp;<span class="op" id="5852805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852811">sa</span><span class="op" id="5852813">[</span><span class="ident" id="5852814">i</span><span class="op" id="5852815">+</span><span class="num" id="5852816">1</span><span class="op" id="5852817">]</span>&nbsp;<span class="op" id="5852819">=</span>&nbsp;<span class="op" id="5852821">-</span><span class="num" id="5852822">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5852827">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852832">groupByte</span>&nbsp;<span class="op" id="5852842">=</span>&nbsp;<span class="ident" id="5852844">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852849">prevGroup</span>&nbsp;<span class="op" id="5852859">=</span>&nbsp;<span class="ident" id="5852861">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5852865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852869">inv</span><span class="op" id="5852872">[</span><span class="ident" id="5852873">sa</span><span class="op" id="5852875">[</span><span class="ident" id="5852876">i</span><span class="op" id="5852877">]</span><span class="op" id="5852878">]</span>&nbsp;<span class="op" id="5852880">=</span>&nbsp;<span class="ident" id="5852882">prevGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852894">if</span>&nbsp;<span class="ident" id="5852897">prevGroup</span>&nbsp;<span class="op" id="5852907">==</span>&nbsp;<span class="num" id="5852910">0</span>&nbsp;<span class="op" id="5852912">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852917">sa</span><span class="op" id="5852919">[</span><span class="num" id="5852920">0</span><span class="op" id="5852921">]</span>&nbsp;<span class="op" id="5852923">=</span>&nbsp;<span class="op" id="5852925">-</span><span class="num" id="5852926">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5852930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5852933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5852936">//&nbsp;Separate&nbsp;out&nbsp;the&nbsp;final&nbsp;suffix&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;its&nbsp;group.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5852997">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;to&nbsp;ensure&nbsp;the&nbsp;suffix&nbsp;&#34;a&#34;&nbsp;is&nbsp;before&nbsp;&#34;aba&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5853060">//&nbsp;when&nbsp;using&nbsp;a&nbsp;potentially&nbsp;unstable&nbsp;sort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853104">lastByte</span>&nbsp;<span class="op" id="5853113">:=</span>&nbsp;<span class="ident" id="5853116">data</span><span class="op" id="5853120">[</span><span class="builtinfunc" id="5853121">len</span><span class="op" id="5853124">(</span><span class="ident" id="5853125">data</span><span class="op" id="5853129">)</span><span class="op" id="5853130">-</span><span class="num" id="5853131">1</span><span class="op" id="5853132">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853135">s</span>&nbsp;<span class="op" id="5853137">:=</span>&nbsp;<span class="op" id="5853140">-</span><span class="num" id="5853141">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853144">for</span>&nbsp;<span class="ident" id="5853148">i</span>&nbsp;<span class="op" id="5853150">:=</span>&nbsp;<span class="keyword" id="5853153">range</span>&nbsp;<span class="ident" id="5853159">sa</span>&nbsp;<span class="op" id="5853162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853166">if</span>&nbsp;<span class="ident" id="5853169">sa</span><span class="op" id="5853171">[</span><span class="ident" id="5853172">i</span><span class="op" id="5853173">]</span>&nbsp;<span class="op" id="5853175">&gt;=</span>&nbsp;<span class="num" id="5853178">0</span>&nbsp;<span class="op" id="5853180">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853185">if</span>&nbsp;<span class="ident" id="5853188">data</span><span class="op" id="5853192">[</span><span class="ident" id="5853193">sa</span><span class="op" id="5853195">[</span><span class="ident" id="5853196">i</span><span class="op" id="5853197">]</span><span class="op" id="5853198">]</span>&nbsp;<span class="op" id="5853200">==</span>&nbsp;<span class="ident" id="5853203">lastByte</span>&nbsp;<span class="op" id="5853212">&amp;&amp;</span>&nbsp;<span class="ident" id="5853215">s</span>&nbsp;<span class="op" id="5853217">==</span>&nbsp;<span class="op" id="5853220">-</span><span class="num" id="5853221">1</span>&nbsp;<span class="op" id="5853223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853229">s</span>&nbsp;<span class="op" id="5853231">=</span>&nbsp;<span class="ident" id="5853233">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5853238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853243">if</span>&nbsp;<span class="ident" id="5853246">sa</span><span class="op" id="5853248">[</span><span class="ident" id="5853249">i</span><span class="op" id="5853250">]</span>&nbsp;<span class="op" id="5853252">==</span>&nbsp;<span class="builtinfunc" id="5853255">len</span><span class="op" id="5853258">(</span><span class="ident" id="5853259">sa</span><span class="op" id="5853261">)</span><span class="op" id="5853262">-</span><span class="num" id="5853263">1</span>&nbsp;<span class="op" id="5853265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853271">sa</span><span class="op" id="5853273">[</span><span class="ident" id="5853274">i</span><span class="op" id="5853275">]</span><span class="op" id="5853276">,</span>&nbsp;<span class="ident" id="5853278">sa</span><span class="op" id="5853280">[</span><span class="ident" id="5853281">s</span><span class="op" id="5853282">]</span>&nbsp;<span class="op" id="5853284">=</span>&nbsp;<span class="ident" id="5853286">sa</span><span class="op" id="5853288">[</span><span class="ident" id="5853289">s</span><span class="op" id="5853290">]</span><span class="op" id="5853291">,</span>&nbsp;<span class="ident" id="5853293">sa</span><span class="op" id="5853295">[</span><span class="ident" id="5853296">i</span><span class="op" id="5853297">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853303">inv</span><span class="op" id="5853306">[</span><span class="ident" id="5853307">sa</span><span class="op" id="5853309">[</span><span class="ident" id="5853310">s</span><span class="op" id="5853311">]</span><span class="op" id="5853312">]</span>&nbsp;<span class="op" id="5853314">=</span>&nbsp;<span class="ident" id="5853316">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853322">sa</span><span class="op" id="5853324">[</span><span class="ident" id="5853325">s</span><span class="op" id="5853326">]</span>&nbsp;<span class="op" id="5853328">=</span>&nbsp;<span class="op" id="5853330">-</span><span class="num" id="5853331">1</span>&nbsp;<span class="comment" id="5853333">//&nbsp;mark&nbsp;it&nbsp;as&nbsp;an&nbsp;isolated&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853376">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5853385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5853389">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5853392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853395">return</span>&nbsp;<span class="ident" id="5853402">inv</span><br>
<span class="lineno"></span><span class="op" id="5853406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5853409">type</span>&nbsp;<span class="ident" id="5853414">suffixSortable</span>&nbsp;<span class="keyword" id="5853429">struct</span>&nbsp;<span class="op" id="5853436">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853439">sa</span>&nbsp;&nbsp;<span class="op" id="5853443">[</span><span class="op" id="5853444">]</span><span class="builtintype" id="5853445">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853450">inv</span>&nbsp;<span class="op" id="5853454">[</span><span class="op" id="5853455">]</span><span class="builtintype" id="5853456">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853461">h</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5853465">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853470">buf</span>&nbsp;<span class="op" id="5853474">[</span><span class="op" id="5853475">]</span><span class="builtintype" id="5853476">int</span>&nbsp;<span class="comment" id="5853480">//&nbsp;common&nbsp;scratch&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="5853504">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="5853507">func</span>&nbsp;<span class="op" id="5853512">(</span><span class="ident" id="5853513">x</span>&nbsp;<span class="op" id="5853515">*</span><span class="ident" id="5853516">suffixSortable</span><span class="op" id="5853530">)</span>&nbsp;<span class="ident" id="5853532">Len</span><span class="op" id="5853535">(</span><span class="op" id="5853536">)</span>&nbsp;<span class="builtintype" id="5853538">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5853552">{</span>&nbsp;<span class="keyword" id="5853554">return</span>&nbsp;<span class="builtinfunc" id="5853561">len</span><span class="op" id="5853564">(</span><span class="ident" id="5853565">x</span><span class="op" id="5853566">.</span><span class="ident" id="5853567">sa</span><span class="op" id="5853569">)</span>&nbsp;<span class="op" id="5853571">}</span><br>
<span class="lineno"></span><span class="keyword" id="5853573">func</span>&nbsp;<span class="op" id="5853578">(</span><span class="ident" id="5853579">x</span>&nbsp;<span class="op" id="5853581">*</span><span class="ident" id="5853582">suffixSortable</span><span class="op" id="5853596">)</span>&nbsp;<span class="ident" id="5853598">Less</span><span class="op" id="5853602">(</span><span class="ident" id="5853603">i</span><span class="op" id="5853604">,</span>&nbsp;<span class="ident" id="5853606">j</span>&nbsp;<span class="builtintype" id="5853608">int</span><span class="op" id="5853611">)</span>&nbsp;<span class="builtintype" id="5853613">bool</span>&nbsp;<span class="op" id="5853618">{</span>&nbsp;<span class="keyword" id="5853620">return</span>&nbsp;<span class="ident" id="5853627">x</span><span class="op" id="5853628">.</span><span class="ident" id="5853629">inv</span><span class="op" id="5853632">[</span><span class="ident" id="5853633">x</span><span class="op" id="5853634">.</span><span class="ident" id="5853635">sa</span><span class="op" id="5853637">[</span><span class="ident" id="5853638">i</span><span class="op" id="5853639">]</span><span class="op" id="5853640">+</span><span class="ident" id="5853641">x</span><span class="op" id="5853642">.</span><span class="ident" id="5853643">h</span><span class="op" id="5853644">]</span>&nbsp;<span class="op" id="5853646">&lt;</span>&nbsp;<span class="ident" id="5853648">x</span><span class="op" id="5853649">.</span><span class="ident" id="5853650">inv</span><span class="op" id="5853653">[</span><span class="ident" id="5853654">x</span><span class="op" id="5853655">.</span><span class="ident" id="5853656">sa</span><span class="op" id="5853658">[</span><span class="ident" id="5853659">j</span><span class="op" id="5853660">]</span><span class="op" id="5853661">+</span><span class="ident" id="5853662">x</span><span class="op" id="5853663">.</span><span class="ident" id="5853664">h</span><span class="op" id="5853665">]</span>&nbsp;<span class="op" id="5853667">}</span><br>
<span class="lineno"></span><span class="keyword" id="5853669">func</span>&nbsp;<span class="op" id="5853674">(</span><span class="ident" id="5853675">x</span>&nbsp;<span class="op" id="5853677">*</span><span class="ident" id="5853678">suffixSortable</span><span class="op" id="5853692">)</span>&nbsp;<span class="ident" id="5853694">Swap</span><span class="op" id="5853698">(</span><span class="ident" id="5853699">i</span><span class="op" id="5853700">,</span>&nbsp;<span class="ident" id="5853702">j</span>&nbsp;<span class="builtintype" id="5853704">int</span><span class="op" id="5853707">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5853714">{</span>&nbsp;<span class="ident" id="5853716">x</span><span class="op" id="5853717">.</span><span class="ident" id="5853718">sa</span><span class="op" id="5853720">[</span><span class="ident" id="5853721">i</span><span class="op" id="5853722">]</span><span class="op" id="5853723">,</span>&nbsp;<span class="ident" id="5853725">x</span><span class="op" id="5853726">.</span><span class="ident" id="5853727">sa</span><span class="op" id="5853729">[</span><span class="ident" id="5853730">j</span><span class="op" id="5853731">]</span>&nbsp;<span class="op" id="5853733">=</span>&nbsp;<span class="ident" id="5853735">x</span><span class="op" id="5853736">.</span><span class="ident" id="5853737">sa</span><span class="op" id="5853739">[</span><span class="ident" id="5853740">j</span><span class="op" id="5853741">]</span><span class="op" id="5853742">,</span>&nbsp;<span class="ident" id="5853744">x</span><span class="op" id="5853745">.</span><span class="ident" id="5853746">sa</span><span class="op" id="5853748">[</span><span class="ident" id="5853749">i</span><span class="op" id="5853750">]</span>&nbsp;<span class="op" id="5853752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="5853755">func</span>&nbsp;<span class="op" id="5853760">(</span><span class="ident" id="5853761">x</span>&nbsp;<span class="op" id="5853763">*</span><span class="ident" id="5853764">suffixSortable</span><span class="op" id="5853778">)</span>&nbsp;<span class="ident" id="5853780">updateGroups</span><span class="op" id="5853792">(</span><span class="ident" id="5853793">offset</span>&nbsp;<span class="builtintype" id="5853800">int</span><span class="op" id="5853803">)</span>&nbsp;<span class="op" id="5853805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853808">bounds</span>&nbsp;<span class="op" id="5853815">:=</span>&nbsp;<span class="ident" id="5853818">x</span><span class="op" id="5853819">.</span><span class="ident" id="5853820">buf</span><span class="op" id="5853823">[</span><span class="num" id="5853824">0</span><span class="op" id="5853825">:</span><span class="num" id="5853826">0</span><span class="op" id="5853827">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853830">group</span>&nbsp;<span class="op" id="5853836">:=</span>&nbsp;<span class="ident" id="5853839">x</span><span class="op" id="5853840">.</span><span class="ident" id="5853841">inv</span><span class="op" id="5853844">[</span><span class="ident" id="5853845">x</span><span class="op" id="5853846">.</span><span class="ident" id="5853847">sa</span><span class="op" id="5853849">[</span><span class="num" id="5853850">0</span><span class="op" id="5853851">]</span><span class="op" id="5853852">+</span><span class="ident" id="5853853">x</span><span class="op" id="5853854">.</span><span class="ident" id="5853855">h</span><span class="op" id="5853856">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853859">for</span>&nbsp;<span class="ident" id="5853863">i</span>&nbsp;<span class="op" id="5853865">:=</span>&nbsp;<span class="num" id="5853868">1</span><span class="op" id="5853869">;</span>&nbsp;<span class="ident" id="5853871">i</span>&nbsp;<span class="op" id="5853873">&lt;</span>&nbsp;<span class="builtinfunc" id="5853875">len</span><span class="op" id="5853878">(</span><span class="ident" id="5853879">x</span><span class="op" id="5853880">.</span><span class="ident" id="5853881">sa</span><span class="op" id="5853883">)</span><span class="op" id="5853884">;</span>&nbsp;<span class="ident" id="5853886">i</span><span class="op" id="5853887">++</span>&nbsp;<span class="op" id="5853890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853894">if</span>&nbsp;<span class="ident" id="5853897">g</span>&nbsp;<span class="op" id="5853899">:=</span>&nbsp;<span class="ident" id="5853902">x</span><span class="op" id="5853903">.</span><span class="ident" id="5853904">inv</span><span class="op" id="5853907">[</span><span class="ident" id="5853908">x</span><span class="op" id="5853909">.</span><span class="ident" id="5853910">sa</span><span class="op" id="5853912">[</span><span class="ident" id="5853913">i</span><span class="op" id="5853914">]</span><span class="op" id="5853915">+</span><span class="ident" id="5853916">x</span><span class="op" id="5853917">.</span><span class="ident" id="5853918">h</span><span class="op" id="5853919">]</span><span class="op" id="5853920">;</span>&nbsp;<span class="ident" id="5853922">g</span>&nbsp;<span class="op" id="5853924">&gt;</span>&nbsp;<span class="ident" id="5853926">group</span>&nbsp;<span class="op" id="5853932">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853937">bounds</span>&nbsp;<span class="op" id="5853944">=</span>&nbsp;<span class="builtinfunc" id="5853946">append</span><span class="op" id="5853952">(</span><span class="ident" id="5853953">bounds</span><span class="op" id="5853959">,</span>&nbsp;<span class="ident" id="5853961">i</span><span class="op" id="5853962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853967">group</span>&nbsp;<span class="op" id="5853973">=</span>&nbsp;<span class="ident" id="5853975">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5853979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5853982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853985">bounds</span>&nbsp;<span class="op" id="5853992">=</span>&nbsp;<span class="builtinfunc" id="5853994">append</span><span class="op" id="5854000">(</span><span class="ident" id="5854001">bounds</span><span class="op" id="5854007">,</span>&nbsp;<span class="builtinfunc" id="5854009">len</span><span class="op" id="5854012">(</span><span class="ident" id="5854013">x</span><span class="op" id="5854014">.</span><span class="ident" id="5854015">sa</span><span class="op" id="5854017">)</span><span class="op" id="5854018">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854021">x</span><span class="op" id="5854022">.</span><span class="ident" id="5854023">buf</span>&nbsp;<span class="op" id="5854027">=</span>&nbsp;<span class="ident" id="5854029">bounds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5854038">//&nbsp;update&nbsp;the&nbsp;group&nbsp;numberings&nbsp;after&nbsp;all&nbsp;new&nbsp;groups&nbsp;are&nbsp;determined</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854106">prev</span>&nbsp;<span class="op" id="5854111">:=</span>&nbsp;<span class="num" id="5854114">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854117">for</span>&nbsp;<span class="ident" id="5854121">_</span><span class="op" id="5854122">,</span>&nbsp;<span class="ident" id="5854124">b</span>&nbsp;<span class="op" id="5854126">:=</span>&nbsp;<span class="keyword" id="5854129">range</span>&nbsp;<span class="ident" id="5854135">bounds</span>&nbsp;<span class="op" id="5854142">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854146">for</span>&nbsp;<span class="ident" id="5854150">i</span>&nbsp;<span class="op" id="5854152">:=</span>&nbsp;<span class="ident" id="5854155">prev</span><span class="op" id="5854159">;</span>&nbsp;<span class="ident" id="5854161">i</span>&nbsp;<span class="op" id="5854163">&lt;</span>&nbsp;<span class="ident" id="5854165">b</span><span class="op" id="5854166">;</span>&nbsp;<span class="ident" id="5854168">i</span><span class="op" id="5854169">++</span>&nbsp;<span class="op" id="5854172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854177">x</span><span class="op" id="5854178">.</span><span class="ident" id="5854179">inv</span><span class="op" id="5854182">[</span><span class="ident" id="5854183">x</span><span class="op" id="5854184">.</span><span class="ident" id="5854185">sa</span><span class="op" id="5854187">[</span><span class="ident" id="5854188">i</span><span class="op" id="5854189">]</span><span class="op" id="5854190">]</span>&nbsp;<span class="op" id="5854192">=</span>&nbsp;<span class="ident" id="5854194">offset</span>&nbsp;<span class="op" id="5854201">+</span>&nbsp;<span class="ident" id="5854203">b</span>&nbsp;<span class="op" id="5854205">-</span>&nbsp;<span class="num" id="5854207">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5854211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854215">if</span>&nbsp;<span class="ident" id="5854218">b</span><span class="op" id="5854219">-</span><span class="ident" id="5854220">prev</span>&nbsp;<span class="op" id="5854225">==</span>&nbsp;<span class="num" id="5854228">1</span>&nbsp;<span class="op" id="5854230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854235">x</span><span class="op" id="5854236">.</span><span class="ident" id="5854237">sa</span><span class="op" id="5854239">[</span><span class="ident" id="5854240">prev</span><span class="op" id="5854244">]</span>&nbsp;<span class="op" id="5854246">=</span>&nbsp;<span class="op" id="5854248">-</span><span class="num" id="5854249">1</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5854253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854257">prev</span>&nbsp;<span class="op" id="5854262">=</span>&nbsp;<span class="ident" id="5854264">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5854267">}</span><br>
<span class="lineno"></span><span class="op" id="5854269">}</span>
</div>
</body>
</html>
