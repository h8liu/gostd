<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2017490">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2017546">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2017600">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2017651">package</span>&nbsp;<span class="ident" id="2017659">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2017668">var</span>&nbsp;<span class="ident" id="2017672">ticks</span>&nbsp;<span class="keyword" id="2017678">struct</span>&nbsp;<span class="op" id="2017685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017688">lock</span>&nbsp;<span class="ident" id="2017693">mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017700">val</span>&nbsp;&nbsp;<span class="ident" id="2017705">uint64</span><br>
<span class="lineno">10</span><span class="op" id="2017712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2017715">var</span>&nbsp;<span class="ident" id="2017719">tls0</span>&nbsp;<span class="op" id="2017724">[</span><span class="num" id="2017725">8</span><span class="op" id="2017726">]</span><span class="builtintype" id="2017727">uintptr</span>&nbsp;<span class="comment" id="2017735">//&nbsp;available&nbsp;storage&nbsp;for&nbsp;m0&#39;s&nbsp;TLS;&nbsp;not&nbsp;necessarily&nbsp;used;&nbsp;opaque&nbsp;to&nbsp;GC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2017806">//&nbsp;Note:&nbsp;Called&nbsp;by&nbsp;runtime/pprof&nbsp;in&nbsp;addition&nbsp;to&nbsp;runtime&nbsp;code.</span><br>
<span class="lineno">15</span><span class="keyword" id="2017868">func</span>&nbsp;<span class="ident" id="2017873">tickspersecond</span><span class="op" id="2017887">(</span><span class="op" id="2017888">)</span>&nbsp;<span class="ident" id="2017890">int64</span>&nbsp;<span class="op" id="2017896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017899">r</span>&nbsp;<span class="op" id="2017901">:=</span>&nbsp;<span class="ident" id="2017904">int64</span><span class="op" id="2017909">(</span><span class="ident" id="2017910">atomicload64</span><span class="op" id="2017922">(</span><span class="op" id="2017923">&amp;</span><span class="ident" id="2017924">ticks</span><span class="op" id="2017929">.</span><span class="ident" id="2017930">val</span><span class="op" id="2017933">)</span><span class="op" id="2017934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017937">if</span>&nbsp;<span class="ident" id="2017940">r</span>&nbsp;<span class="op" id="2017942">!=</span>&nbsp;<span class="num" id="2017945">0</span>&nbsp;<span class="op" id="2017947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017951">return</span>&nbsp;<span class="ident" id="2017958">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017961">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017964">lock</span><span class="op" id="2017968">(</span><span class="op" id="2017969">&amp;</span><span class="ident" id="2017970">ticks</span><span class="op" id="2017975">.</span><span class="ident" id="2017976">lock</span><span class="op" id="2017980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017983">r</span>&nbsp;<span class="op" id="2017985">=</span>&nbsp;<span class="ident" id="2017987">int64</span><span class="op" id="2017992">(</span><span class="ident" id="2017993">ticks</span><span class="op" id="2017998">.</span><span class="ident" id="2017999">val</span><span class="op" id="2018002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018005">if</span>&nbsp;<span class="ident" id="2018008">r</span>&nbsp;<span class="op" id="2018010">==</span>&nbsp;<span class="num" id="2018013">0</span>&nbsp;<span class="op" id="2018015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018019">t0</span>&nbsp;<span class="op" id="2018022">:=</span>&nbsp;<span class="ident" id="2018025">nanotime</span><span class="op" id="2018033">(</span><span class="op" id="2018034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018038">c0</span>&nbsp;<span class="op" id="2018041">:=</span>&nbsp;<span class="ident" id="2018044">cputicks</span><span class="op" id="2018052">(</span><span class="op" id="2018053">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018057">usleep</span><span class="op" id="2018063">(</span><span class="num" id="2018064">100</span>&nbsp;<span class="op" id="2018068">*</span>&nbsp;<span class="num" id="2018070">1000</span><span class="op" id="2018074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018078">t1</span>&nbsp;<span class="op" id="2018081">:=</span>&nbsp;<span class="ident" id="2018084">nanotime</span><span class="op" id="2018092">(</span><span class="op" id="2018093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018097">c1</span>&nbsp;<span class="op" id="2018100">:=</span>&nbsp;<span class="ident" id="2018103">cputicks</span><span class="op" id="2018111">(</span><span class="op" id="2018112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018116">if</span>&nbsp;<span class="ident" id="2018119">t1</span>&nbsp;<span class="op" id="2018122">==</span>&nbsp;<span class="ident" id="2018125">t0</span>&nbsp;<span class="op" id="2018128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018133">t1</span><span class="op" id="2018135">++</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018144">r</span>&nbsp;<span class="op" id="2018146">=</span>&nbsp;<span class="op" id="2018148">(</span><span class="ident" id="2018149">c1</span>&nbsp;<span class="op" id="2018152">-</span>&nbsp;<span class="ident" id="2018154">c0</span><span class="op" id="2018156">)</span>&nbsp;<span class="op" id="2018158">*</span>&nbsp;<span class="num" id="2018160">1000</span>&nbsp;<span class="op" id="2018165">*</span>&nbsp;<span class="num" id="2018167">1000</span>&nbsp;<span class="op" id="2018172">*</span>&nbsp;<span class="num" id="2018174">1000</span>&nbsp;<span class="op" id="2018179">/</span>&nbsp;<span class="op" id="2018181">(</span><span class="ident" id="2018182">t1</span>&nbsp;<span class="op" id="2018185">-</span>&nbsp;<span class="ident" id="2018187">t0</span><span class="op" id="2018189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018193">if</span>&nbsp;<span class="ident" id="2018196">r</span>&nbsp;<span class="op" id="2018198">==</span>&nbsp;<span class="num" id="2018201">0</span>&nbsp;<span class="op" id="2018203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018208">r</span><span class="op" id="2018209">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018214">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018218">atomicstore64</span><span class="op" id="2018231">(</span><span class="op" id="2018232">&amp;</span><span class="ident" id="2018233">ticks</span><span class="op" id="2018238">.</span><span class="ident" id="2018239">val</span><span class="op" id="2018242">,</span>&nbsp;<span class="ident" id="2018244">uint64</span><span class="op" id="2018250">(</span><span class="ident" id="2018251">r</span><span class="op" id="2018252">)</span><span class="op" id="2018253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018259">unlock</span><span class="op" id="2018265">(</span><span class="op" id="2018266">&amp;</span><span class="ident" id="2018267">ticks</span><span class="op" id="2018272">.</span><span class="ident" id="2018273">lock</span><span class="op" id="2018277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018280">return</span>&nbsp;<span class="ident" id="2018287">r</span><br>
<span class="lineno"></span><span class="op" id="2018289">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2018292">func</span>&nbsp;<span class="ident" id="2018297">makeStringSlice</span><span class="op" id="2018312">(</span><span class="ident" id="2018313">n</span>&nbsp;<span class="builtintype" id="2018315">int</span><span class="op" id="2018318">)</span>&nbsp;<span class="op" id="2018320">[</span><span class="op" id="2018321">]</span><span class="builtintype" id="2018322">string</span>&nbsp;<span class="op" id="2018329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018332">return</span>&nbsp;<span class="builtinfunc" id="2018339">make</span><span class="op" id="2018343">(</span><span class="op" id="2018344">[</span><span class="op" id="2018345">]</span><span class="builtintype" id="2018346">string</span><span class="op" id="2018352">,</span>&nbsp;<span class="ident" id="2018354">n</span><span class="op" id="2018355">)</span><br>
<span class="lineno"></span><span class="op" id="2018357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="2018360">//&nbsp;TODO:&nbsp;Move&nbsp;to&nbsp;parfor.go&nbsp;when&nbsp;parfor.c&nbsp;becomes&nbsp;parfor.go.</span><br>
<span class="lineno"></span><span class="keyword" id="2018420">func</span>&nbsp;<span class="ident" id="2018425">parforalloc</span><span class="op" id="2018436">(</span><span class="ident" id="2018437">nthrmax</span>&nbsp;<span class="builtintype" id="2018445">uint32</span><span class="op" id="2018451">)</span>&nbsp;<span class="op" id="2018453">*</span><span class="ident" id="2018454">parfor</span>&nbsp;<span class="op" id="2018461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018464">return</span>&nbsp;<span class="op" id="2018471">&amp;</span><span class="ident" id="2018472">parfor</span><span class="op" id="2018478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018482">thr</span><span class="op" id="2018485">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2018491">&amp;</span><span class="builtinfunc" id="2018492">make</span><span class="op" id="2018496">(</span><span class="op" id="2018497">[</span><span class="op" id="2018498">]</span><span class="ident" id="2018499">parforthread</span><span class="op" id="2018511">,</span>&nbsp;<span class="ident" id="2018513">nthrmax</span><span class="op" id="2018520">)</span><span class="op" id="2018521">[</span><span class="num" id="2018522">0</span><span class="op" id="2018523">]</span><span class="op" id="2018524">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018528">nthrmax</span><span class="op" id="2018535">:</span>&nbsp;<span class="ident" id="2018537">nthrmax</span><span class="op" id="2018544">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018547">}</span><br>
<span class="lineno"></span><span class="op" id="2018549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2018552">var</span>&nbsp;<span class="ident" id="2018556">envs</span>&nbsp;<span class="op" id="2018561">[</span><span class="op" id="2018562">]</span><span class="builtintype" id="2018563">string</span><br>
<span class="lineno"></span><span class="keyword" id="2018570">var</span>&nbsp;<span class="ident" id="2018574">argslice</span>&nbsp;<span class="op" id="2018583">[</span><span class="op" id="2018584">]</span><span class="builtintype" id="2018585">string</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="2018593">//&nbsp;called&nbsp;from&nbsp;syscall</span><br>
<span class="lineno"></span><span class="keyword" id="2018616">func</span>&nbsp;<span class="ident" id="2018621">runtime_envs</span><span class="op" id="2018633">(</span><span class="op" id="2018634">)</span>&nbsp;<span class="op" id="2018636">[</span><span class="op" id="2018637">]</span><span class="builtintype" id="2018638">string</span>&nbsp;<span class="op" id="2018645">{</span>&nbsp;<span class="keyword" id="2018647">return</span>&nbsp;<span class="ident" id="2018654">envs</span>&nbsp;<span class="op" id="2018659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2018662">//&nbsp;called&nbsp;from&nbsp;os</span><br>
<span class="lineno">60</span><span class="keyword" id="2018680">func</span>&nbsp;<span class="ident" id="2018685">runtime_args</span><span class="op" id="2018697">(</span><span class="op" id="2018698">)</span>&nbsp;<span class="op" id="2018700">[</span><span class="op" id="2018701">]</span><span class="builtintype" id="2018702">string</span>&nbsp;<span class="op" id="2018709">{</span>&nbsp;<span class="keyword" id="2018711">return</span>&nbsp;<span class="ident" id="2018718">argslice</span>&nbsp;<span class="op" id="2018727">}</span>
</div>
</body>
</html>
