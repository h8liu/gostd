<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4014133">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4014189">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4014243">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4014294">package</span>&nbsp;<span class="ident" id="4014302">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4014308">import</span>&nbsp;<span class="op" id="4014315">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4014318">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4014327">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4014337">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4014342">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4014345">//&nbsp;A&nbsp;Decoder&nbsp;reads&nbsp;and&nbsp;decodes&nbsp;JSON&nbsp;objects&nbsp;from&nbsp;an&nbsp;input&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="4014411">type</span>&nbsp;<span class="ident" id="4014416">Decoder</span>&nbsp;<span class="keyword" id="4014424">struct</span>&nbsp;<span class="op" id="4014431">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014434">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4014439">io</span><span class="op" id="4014441">.</span><span class="ident" id="4014442">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014450">buf</span>&nbsp;&nbsp;<span class="op" id="4014455">[</span><span class="op" id="4014456">]</span><span class="builtintype" id="4014457">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014463">d</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4014468">decodeState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014481">scan</span>&nbsp;<span class="ident" id="4014486">scanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4014495">err</span>&nbsp;&nbsp;<span class="builtintype" id="4014500">error</span><br>
<span class="lineno">20</span><span class="op" id="4014506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4014509">//&nbsp;NewDecoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;decoder&nbsp;that&nbsp;reads&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4014564">//</span><br>
<span class="lineno"></span><span class="comment" id="4014567">//&nbsp;The&nbsp;decoder&nbsp;introduces&nbsp;its&nbsp;own&nbsp;buffering&nbsp;and&nbsp;may</span><br>
<span class="lineno">25</span><span class="comment" id="4014619">//&nbsp;read&nbsp;data&nbsp;from&nbsp;r&nbsp;beyond&nbsp;the&nbsp;JSON&nbsp;values&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="4014673">func</span>&nbsp;<span class="ident" id="4014678">NewDecoder</span><span class="op" id="4014688">(</span><span class="ident" id="4014689">r</span>&nbsp;<span class="ident" id="4014691">io</span><span class="op" id="4014693">.</span><span class="ident" id="4014694">Reader</span><span class="op" id="4014700">)</span>&nbsp;<span class="op" id="4014702">*</span><span class="ident" id="4014703">Decoder</span>&nbsp;<span class="op" id="4014711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4014714">return</span>&nbsp;<span class="op" id="4014721">&amp;</span><span class="ident" id="4014722">Decoder</span><span class="op" id="4014729">{</span><span class="ident" id="4014730">r</span><span class="op" id="4014731">:</span>&nbsp;<span class="ident" id="4014733">r</span><span class="op" id="4014734">}</span><br>
<span class="lineno"></span><span class="op" id="4014736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="4014739">//&nbsp;UseNumber&nbsp;causes&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;unmarshal&nbsp;a&nbsp;number&nbsp;into&nbsp;an&nbsp;interface{}&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4014818">//&nbsp;Number&nbsp;instead&nbsp;of&nbsp;as&nbsp;a&nbsp;float64.</span><br>
<span class="lineno"></span><span class="keyword" id="4014853">func</span>&nbsp;<span class="op" id="4014858">(</span><span class="ident" id="4014859">dec</span>&nbsp;<span class="op" id="4014863">*</span><span class="ident" id="4014864">Decoder</span><span class="op" id="4014871">)</span>&nbsp;<span class="ident" id="4014873">UseNumber</span><span class="op" id="4014882">(</span><span class="op" id="4014883">)</span>&nbsp;<span class="op" id="4014885">{</span>&nbsp;<span class="ident" id="4014887">dec</span><span class="op" id="4014890">.</span><span class="ident" id="4014891">d</span><span class="op" id="4014892">.</span><span class="ident" id="4014893">useNumber</span>&nbsp;<span class="op" id="4014903">=</span>&nbsp;<span class="builtintype" id="4014905">true</span>&nbsp;<span class="op" id="4014910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4014913">//&nbsp;Decode&nbsp;reads&nbsp;the&nbsp;next&nbsp;JSON-encoded&nbsp;value&nbsp;from&nbsp;its</span><br>
<span class="lineno">35</span><span class="comment" id="4014966">//&nbsp;input&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to&nbsp;by&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="4015019">//</span><br>
<span class="lineno"></span><span class="comment" id="4015022">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Unmarshal&nbsp;for&nbsp;details&nbsp;about</span><br>
<span class="lineno"></span><span class="comment" id="4015079">//&nbsp;the&nbsp;conversion&nbsp;of&nbsp;JSON&nbsp;into&nbsp;a&nbsp;Go&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4015122">func</span>&nbsp;<span class="op" id="4015127">(</span><span class="ident" id="4015128">dec</span>&nbsp;<span class="op" id="4015132">*</span><span class="ident" id="4015133">Decoder</span><span class="op" id="4015140">)</span>&nbsp;<span class="ident" id="4015142">Decode</span><span class="op" id="4015148">(</span><span class="ident" id="4015149">v</span>&nbsp;<span class="keyword" id="4015151">interface</span><span class="op" id="4015160">{</span><span class="op" id="4015161">}</span><span class="op" id="4015162">)</span>&nbsp;<span class="builtintype" id="4015164">error</span>&nbsp;<span class="op" id="4015170">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4015173">if</span>&nbsp;<span class="ident" id="4015176">dec</span><span class="op" id="4015179">.</span><span class="ident" id="4015180">err</span>&nbsp;<span class="op" id="4015184">!=</span>&nbsp;<span class="ident" id="4015187">nil</span>&nbsp;<span class="op" id="4015191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4015195">return</span>&nbsp;<span class="ident" id="4015202">dec</span><span class="op" id="4015205">.</span><span class="ident" id="4015206">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4015211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015215">n</span><span class="op" id="4015216">,</span>&nbsp;<span class="ident" id="4015218">err</span>&nbsp;<span class="op" id="4015222">:=</span>&nbsp;<span class="ident" id="4015225">dec</span><span class="op" id="4015228">.</span><span class="ident" id="4015229">readValue</span><span class="op" id="4015238">(</span><span class="op" id="4015239">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4015242">if</span>&nbsp;<span class="ident" id="4015245">err</span>&nbsp;<span class="op" id="4015249">!=</span>&nbsp;<span class="ident" id="4015252">nil</span>&nbsp;<span class="op" id="4015256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4015260">return</span>&nbsp;<span class="ident" id="4015267">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4015272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4015276">//&nbsp;Don&#39;t&nbsp;save&nbsp;err&nbsp;from&nbsp;unmarshal&nbsp;into&nbsp;dec.err:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4015324">//&nbsp;the&nbsp;connection&nbsp;is&nbsp;still&nbsp;usable&nbsp;since&nbsp;we&nbsp;read&nbsp;a&nbsp;complete&nbsp;JSON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4015389">//&nbsp;object&nbsp;from&nbsp;it&nbsp;before&nbsp;the&nbsp;error&nbsp;happened.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015435">dec</span><span class="op" id="4015438">.</span><span class="ident" id="4015439">d</span><span class="op" id="4015440">.</span><span class="ident" id="4015441">init</span><span class="op" id="4015445">(</span><span class="ident" id="4015446">dec</span><span class="op" id="4015449">.</span><span class="ident" id="4015450">buf</span><span class="op" id="4015453">[</span><span class="num" id="4015454">0</span><span class="op" id="4015455">:</span><span class="ident" id="4015456">n</span><span class="op" id="4015457">]</span><span class="op" id="4015458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015461">err</span>&nbsp;<span class="op" id="4015465">=</span>&nbsp;<span class="ident" id="4015467">dec</span><span class="op" id="4015470">.</span><span class="ident" id="4015471">d</span><span class="op" id="4015472">.</span><span class="ident" id="4015473">unmarshal</span><span class="op" id="4015482">(</span><span class="ident" id="4015483">v</span><span class="op" id="4015484">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4015488">//&nbsp;Slide&nbsp;rest&nbsp;of&nbsp;data&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015517">rest</span>&nbsp;<span class="op" id="4015522">:=</span>&nbsp;<span class="builtinfunc" id="4015525">copy</span><span class="op" id="4015529">(</span><span class="ident" id="4015530">dec</span><span class="op" id="4015533">.</span><span class="ident" id="4015534">buf</span><span class="op" id="4015537">,</span>&nbsp;<span class="ident" id="4015539">dec</span><span class="op" id="4015542">.</span><span class="ident" id="4015543">buf</span><span class="op" id="4015546">[</span><span class="ident" id="4015547">n</span><span class="op" id="4015548">:</span><span class="op" id="4015549">]</span><span class="op" id="4015550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015553">dec</span><span class="op" id="4015556">.</span><span class="ident" id="4015557">buf</span>&nbsp;<span class="op" id="4015561">=</span>&nbsp;<span class="ident" id="4015563">dec</span><span class="op" id="4015566">.</span><span class="ident" id="4015567">buf</span><span class="op" id="4015570">[</span><span class="num" id="4015571">0</span><span class="op" id="4015572">:</span><span class="ident" id="4015573">rest</span><span class="op" id="4015577">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4015581">return</span>&nbsp;<span class="ident" id="4015588">err</span><br>
<span class="lineno">60</span><span class="op" id="4015592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4015595">//&nbsp;Buffered&nbsp;returns&nbsp;a&nbsp;reader&nbsp;of&nbsp;the&nbsp;data&nbsp;remaining&nbsp;in&nbsp;the&nbsp;Decoder&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4015663">//&nbsp;buffer.&nbsp;The&nbsp;reader&nbsp;is&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="keyword" id="4015725">func</span>&nbsp;<span class="op" id="4015730">(</span><span class="ident" id="4015731">dec</span>&nbsp;<span class="op" id="4015735">*</span><span class="ident" id="4015736">Decoder</span><span class="op" id="4015743">)</span>&nbsp;<span class="ident" id="4015745">Buffered</span><span class="op" id="4015753">(</span><span class="op" id="4015754">)</span>&nbsp;<span class="ident" id="4015756">io</span><span class="op" id="4015758">.</span><span class="ident" id="4015759">Reader</span>&nbsp;<span class="op" id="4015766">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4015769">return</span>&nbsp;<span class="ident" id="4015776">bytes</span><span class="op" id="4015781">.</span><span class="ident" id="4015782">NewReader</span><span class="op" id="4015791">(</span><span class="ident" id="4015792">dec</span><span class="op" id="4015795">.</span><span class="ident" id="4015796">buf</span><span class="op" id="4015799">)</span><br>
<span class="lineno"></span><span class="op" id="4015801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4015804">//&nbsp;readValue&nbsp;reads&nbsp;a&nbsp;JSON&nbsp;value&nbsp;into&nbsp;dec.buf.</span><br>
<span class="lineno"></span><span class="comment" id="4015850">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno">70</span><span class="keyword" id="4015892">func</span>&nbsp;<span class="op" id="4015897">(</span><span class="ident" id="4015898">dec</span>&nbsp;<span class="op" id="4015902">*</span><span class="ident" id="4015903">Decoder</span><span class="op" id="4015910">)</span>&nbsp;<span class="ident" id="4015912">readValue</span><span class="op" id="4015921">(</span><span class="op" id="4015922">)</span>&nbsp;<span class="op" id="4015924">(</span><span class="builtintype" id="4015925">int</span><span class="op" id="4015928">,</span>&nbsp;<span class="builtintype" id="4015930">error</span><span class="op" id="4015935">)</span>&nbsp;<span class="op" id="4015937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015940">dec</span><span class="op" id="4015943">.</span><span class="ident" id="4015944">scan</span><span class="op" id="4015948">.</span><span class="ident" id="4015949">reset</span><span class="op" id="4015954">(</span><span class="op" id="4015955">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015959">scanp</span>&nbsp;<span class="op" id="4015965">:=</span>&nbsp;<span class="num" id="4015968">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4015971">var</span>&nbsp;<span class="ident" id="4015975">err</span>&nbsp;<span class="builtintype" id="4015979">error</span><br>
<span class="lineno">75</span><span class="ident" id="4015985">Input</span><span class="op" id="4015990">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4015993">for</span>&nbsp;<span class="op" id="4015997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4016001">//&nbsp;Look&nbsp;in&nbsp;the&nbsp;buffer&nbsp;for&nbsp;a&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016042">for</span>&nbsp;<span class="ident" id="4016046">i</span><span class="op" id="4016047">,</span>&nbsp;<span class="ident" id="4016049">c</span>&nbsp;<span class="op" id="4016051">:=</span>&nbsp;<span class="keyword" id="4016054">range</span>&nbsp;<span class="ident" id="4016060">dec</span><span class="op" id="4016063">.</span><span class="ident" id="4016064">buf</span><span class="op" id="4016067">[</span><span class="ident" id="4016068">scanp</span><span class="op" id="4016073">:</span><span class="op" id="4016074">]</span>&nbsp;<span class="op" id="4016076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016081">dec</span><span class="op" id="4016084">.</span><span class="ident" id="4016085">scan</span><span class="op" id="4016089">.</span><span class="ident" id="4016090">bytes</span><span class="op" id="4016095">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016101">v</span>&nbsp;<span class="op" id="4016103">:=</span>&nbsp;<span class="ident" id="4016106">dec</span><span class="op" id="4016109">.</span><span class="ident" id="4016110">scan</span><span class="op" id="4016114">.</span><span class="ident" id="4016115">step</span><span class="op" id="4016119">(</span><span class="op" id="4016120">&amp;</span><span class="ident" id="4016121">dec</span><span class="op" id="4016124">.</span><span class="ident" id="4016125">scan</span><span class="op" id="4016129">,</span>&nbsp;<span class="builtintype" id="4016131">int</span><span class="op" id="4016134">(</span><span class="ident" id="4016135">c</span><span class="op" id="4016136">)</span><span class="op" id="4016137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016142">if</span>&nbsp;<span class="ident" id="4016145">v</span>&nbsp;<span class="op" id="4016147">==</span>&nbsp;<span class="ident" id="4016150">scanEnd</span>&nbsp;<span class="op" id="4016158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016164">scanp</span>&nbsp;<span class="op" id="4016170">+=</span>&nbsp;<span class="ident" id="4016173">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016179">break</span>&nbsp;<span class="ident" id="4016185">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4016194">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4016199">//&nbsp;scanEnd&nbsp;is&nbsp;delayed&nbsp;one&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4016234">//&nbsp;We&nbsp;might&nbsp;block&nbsp;trying&nbsp;to&nbsp;get&nbsp;that&nbsp;byte&nbsp;from&nbsp;src,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4016289">//&nbsp;so&nbsp;instead&nbsp;invent&nbsp;a&nbsp;space&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016327">if</span>&nbsp;<span class="op" id="4016330">(</span><span class="ident" id="4016331">v</span>&nbsp;<span class="op" id="4016333">==</span>&nbsp;<span class="ident" id="4016336">scanEndObject</span>&nbsp;<span class="op" id="4016350">||</span>&nbsp;<span class="ident" id="4016353">v</span>&nbsp;<span class="op" id="4016355">==</span>&nbsp;<span class="ident" id="4016358">scanEndArray</span><span class="op" id="4016370">)</span>&nbsp;<span class="op" id="4016372">&amp;&amp;</span>&nbsp;<span class="ident" id="4016375">dec</span><span class="op" id="4016378">.</span><span class="ident" id="4016379">scan</span><span class="op" id="4016383">.</span><span class="ident" id="4016384">step</span><span class="op" id="4016388">(</span><span class="op" id="4016389">&amp;</span><span class="ident" id="4016390">dec</span><span class="op" id="4016393">.</span><span class="ident" id="4016394">scan</span><span class="op" id="4016398">,</span>&nbsp;<span class="string" id="4016400">&#39;&nbsp;&#39;</span><span class="op" id="4016403">)</span>&nbsp;<span class="op" id="4016405">==</span>&nbsp;<span class="ident" id="4016408">scanEnd</span>&nbsp;<span class="op" id="4016416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016422">scanp</span>&nbsp;<span class="op" id="4016428">+=</span>&nbsp;<span class="ident" id="4016431">i</span>&nbsp;<span class="op" id="4016433">+</span>&nbsp;<span class="num" id="4016435">1</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016441">break</span>&nbsp;<span class="ident" id="4016447">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4016456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016461">if</span>&nbsp;<span class="ident" id="4016464">v</span>&nbsp;<span class="op" id="4016466">==</span>&nbsp;<span class="ident" id="4016469">scanError</span>&nbsp;<span class="op" id="4016479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016485">dec</span><span class="op" id="4016488">.</span><span class="ident" id="4016489">err</span>&nbsp;<span class="op" id="4016493">=</span>&nbsp;<span class="ident" id="4016495">dec</span><span class="op" id="4016498">.</span><span class="ident" id="4016499">scan</span><span class="op" id="4016503">.</span><span class="ident" id="4016504">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016512">return</span>&nbsp;<span class="num" id="4016519">0</span><span class="op" id="4016520">,</span>&nbsp;<span class="ident" id="4016522">dec</span><span class="op" id="4016525">.</span><span class="ident" id="4016526">scan</span><span class="op" id="4016530">.</span><span class="ident" id="4016531">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4016538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4016542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016546">scanp</span>&nbsp;<span class="op" id="4016552">=</span>&nbsp;<span class="builtinfunc" id="4016554">len</span><span class="op" id="4016557">(</span><span class="ident" id="4016558">dec</span><span class="op" id="4016561">.</span><span class="ident" id="4016562">buf</span><span class="op" id="4016565">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4016570">//&nbsp;Did&nbsp;the&nbsp;last&nbsp;read&nbsp;have&nbsp;an&nbsp;error?</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4016608">//&nbsp;Delayed&nbsp;until&nbsp;now&nbsp;to&nbsp;allow&nbsp;buffer&nbsp;scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016653">if</span>&nbsp;<span class="ident" id="4016656">err</span>&nbsp;<span class="op" id="4016660">!=</span>&nbsp;<span class="ident" id="4016663">nil</span>&nbsp;<span class="op" id="4016667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016672">if</span>&nbsp;<span class="ident" id="4016675">err</span>&nbsp;<span class="op" id="4016679">==</span>&nbsp;<span class="ident" id="4016682">io</span><span class="op" id="4016684">.</span><span class="ident" id="4016685">EOF</span>&nbsp;<span class="op" id="4016689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016695">if</span>&nbsp;<span class="ident" id="4016698">dec</span><span class="op" id="4016701">.</span><span class="ident" id="4016702">scan</span><span class="op" id="4016706">.</span><span class="ident" id="4016707">step</span><span class="op" id="4016711">(</span><span class="op" id="4016712">&amp;</span><span class="ident" id="4016713">dec</span><span class="op" id="4016716">.</span><span class="ident" id="4016717">scan</span><span class="op" id="4016721">,</span>&nbsp;<span class="string" id="4016723">&#39;&nbsp;&#39;</span><span class="op" id="4016726">)</span>&nbsp;<span class="op" id="4016728">==</span>&nbsp;<span class="ident" id="4016731">scanEnd</span>&nbsp;<span class="op" id="4016739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016746">break</span>&nbsp;<span class="ident" id="4016752">Input</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4016762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016768">if</span>&nbsp;<span class="ident" id="4016771">nonSpace</span><span class="op" id="4016779">(</span><span class="ident" id="4016780">dec</span><span class="op" id="4016783">.</span><span class="ident" id="4016784">buf</span><span class="op" id="4016787">)</span>&nbsp;<span class="op" id="4016789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016796">err</span>&nbsp;<span class="op" id="4016800">=</span>&nbsp;<span class="ident" id="4016802">io</span><span class="op" id="4016804">.</span><span class="ident" id="4016805">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4016826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4016831">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016836">dec</span><span class="op" id="4016839">.</span><span class="ident" id="4016840">err</span>&nbsp;<span class="op" id="4016844">=</span>&nbsp;<span class="ident" id="4016846">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016853">return</span>&nbsp;<span class="num" id="4016860">0</span><span class="op" id="4016861">,</span>&nbsp;<span class="ident" id="4016863">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4016869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4016874">//&nbsp;Make&nbsp;room&nbsp;to&nbsp;read&nbsp;more&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016919">const</span>&nbsp;<span class="ident" id="4016925">minRead</span>&nbsp;<span class="op" id="4016933">=</span>&nbsp;<span class="num" id="4016935">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4016941">if</span>&nbsp;<span class="builtinfunc" id="4016944">cap</span><span class="op" id="4016947">(</span><span class="ident" id="4016948">dec</span><span class="op" id="4016951">.</span><span class="ident" id="4016952">buf</span><span class="op" id="4016955">)</span><span class="op" id="4016956">-</span><span class="builtinfunc" id="4016957">len</span><span class="op" id="4016960">(</span><span class="ident" id="4016961">dec</span><span class="op" id="4016964">.</span><span class="ident" id="4016965">buf</span><span class="op" id="4016968">)</span>&nbsp;<span class="op" id="4016970">&lt;</span>&nbsp;<span class="ident" id="4016972">minRead</span>&nbsp;<span class="op" id="4016980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016985">newBuf</span>&nbsp;<span class="op" id="4016992">:=</span>&nbsp;<span class="builtinfunc" id="4016995">make</span><span class="op" id="4016999">(</span><span class="op" id="4017000">[</span><span class="op" id="4017001">]</span><span class="builtintype" id="4017002">byte</span><span class="op" id="4017006">,</span>&nbsp;<span class="builtinfunc" id="4017008">len</span><span class="op" id="4017011">(</span><span class="ident" id="4017012">dec</span><span class="op" id="4017015">.</span><span class="ident" id="4017016">buf</span><span class="op" id="4017019">)</span><span class="op" id="4017020">,</span>&nbsp;<span class="num" id="4017022">2</span><span class="op" id="4017023">*</span><span class="builtinfunc" id="4017024">cap</span><span class="op" id="4017027">(</span><span class="ident" id="4017028">dec</span><span class="op" id="4017031">.</span><span class="ident" id="4017032">buf</span><span class="op" id="4017035">)</span><span class="op" id="4017036">+</span><span class="ident" id="4017037">minRead</span><span class="op" id="4017044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4017049">copy</span><span class="op" id="4017053">(</span><span class="ident" id="4017054">newBuf</span><span class="op" id="4017060">,</span>&nbsp;<span class="ident" id="4017062">dec</span><span class="op" id="4017065">.</span><span class="ident" id="4017066">buf</span><span class="op" id="4017069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017074">dec</span><span class="op" id="4017077">.</span><span class="ident" id="4017078">buf</span>&nbsp;<span class="op" id="4017082">=</span>&nbsp;<span class="ident" id="4017084">newBuf</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4017093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4017098">//&nbsp;Read.&nbsp;&nbsp;Delay&nbsp;error&nbsp;for&nbsp;next&nbsp;iteration&nbsp;(after&nbsp;scan).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017155">var</span>&nbsp;<span class="ident" id="4017159">n</span>&nbsp;<span class="builtintype" id="4017161">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017167">n</span><span class="op" id="4017168">,</span>&nbsp;<span class="ident" id="4017170">err</span>&nbsp;<span class="op" id="4017174">=</span>&nbsp;<span class="ident" id="4017176">dec</span><span class="op" id="4017179">.</span><span class="ident" id="4017180">r</span><span class="op" id="4017181">.</span><span class="ident" id="4017182">Read</span><span class="op" id="4017186">(</span><span class="ident" id="4017187">dec</span><span class="op" id="4017190">.</span><span class="ident" id="4017191">buf</span><span class="op" id="4017194">[</span><span class="builtinfunc" id="4017195">len</span><span class="op" id="4017198">(</span><span class="ident" id="4017199">dec</span><span class="op" id="4017202">.</span><span class="ident" id="4017203">buf</span><span class="op" id="4017206">)</span><span class="op" id="4017207">:</span><span class="builtinfunc" id="4017208">cap</span><span class="op" id="4017211">(</span><span class="ident" id="4017212">dec</span><span class="op" id="4017215">.</span><span class="ident" id="4017216">buf</span><span class="op" id="4017219">)</span><span class="op" id="4017220">]</span><span class="op" id="4017221">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017225">dec</span><span class="op" id="4017228">.</span><span class="ident" id="4017229">buf</span>&nbsp;<span class="op" id="4017233">=</span>&nbsp;<span class="ident" id="4017235">dec</span><span class="op" id="4017238">.</span><span class="ident" id="4017239">buf</span><span class="op" id="4017242">[</span><span class="num" id="4017243">0</span>&nbsp;<span class="op" id="4017245">:</span>&nbsp;<span class="builtinfunc" id="4017247">len</span><span class="op" id="4017250">(</span><span class="ident" id="4017251">dec</span><span class="op" id="4017254">.</span><span class="ident" id="4017255">buf</span><span class="op" id="4017258">)</span><span class="op" id="4017259">+</span><span class="ident" id="4017260">n</span><span class="op" id="4017261">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4017264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017267">return</span>&nbsp;<span class="ident" id="4017274">scanp</span><span class="op" id="4017279">,</span>&nbsp;<span class="ident" id="4017281">nil</span><br>
<span class="lineno"></span><span class="op" id="4017285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="4017288">func</span>&nbsp;<span class="ident" id="4017293">nonSpace</span><span class="op" id="4017301">(</span><span class="ident" id="4017302">b</span>&nbsp;<span class="op" id="4017304">[</span><span class="op" id="4017305">]</span><span class="builtintype" id="4017306">byte</span><span class="op" id="4017310">)</span>&nbsp;<span class="builtintype" id="4017312">bool</span>&nbsp;<span class="op" id="4017317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017320">for</span>&nbsp;<span class="ident" id="4017324">_</span><span class="op" id="4017325">,</span>&nbsp;<span class="ident" id="4017327">c</span>&nbsp;<span class="op" id="4017329">:=</span>&nbsp;<span class="keyword" id="4017332">range</span>&nbsp;<span class="ident" id="4017338">b</span>&nbsp;<span class="op" id="4017340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017344">if</span>&nbsp;<span class="op" id="4017347">!</span><span class="ident" id="4017348">isSpace</span><span class="op" id="4017355">(</span><span class="builtintype" id="4017356">rune</span><span class="op" id="4017360">(</span><span class="ident" id="4017361">c</span><span class="op" id="4017362">)</span><span class="op" id="4017363">)</span>&nbsp;<span class="op" id="4017365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017370">return</span>&nbsp;<span class="builtintype" id="4017377">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4017384">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4017387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017390">return</span>&nbsp;<span class="builtintype" id="4017397">false</span><br>
<span class="lineno"></span><span class="op" id="4017403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4017406">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;JSON&nbsp;objects&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">140</span><span class="keyword" id="4017461">type</span>&nbsp;<span class="ident" id="4017466">Encoder</span>&nbsp;<span class="keyword" id="4017474">struct</span>&nbsp;<span class="op" id="4017481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017484">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4017488">io</span><span class="op" id="4017490">.</span><span class="ident" id="4017491">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017499">err</span>&nbsp;<span class="builtintype" id="4017503">error</span><br>
<span class="lineno"></span><span class="op" id="4017509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="4017512">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4017566">func</span>&nbsp;<span class="ident" id="4017571">NewEncoder</span><span class="op" id="4017581">(</span><span class="ident" id="4017582">w</span>&nbsp;<span class="ident" id="4017584">io</span><span class="op" id="4017586">.</span><span class="ident" id="4017587">Writer</span><span class="op" id="4017593">)</span>&nbsp;<span class="op" id="4017595">*</span><span class="ident" id="4017596">Encoder</span>&nbsp;<span class="op" id="4017604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017607">return</span>&nbsp;<span class="op" id="4017614">&amp;</span><span class="ident" id="4017615">Encoder</span><span class="op" id="4017622">{</span><span class="ident" id="4017623">w</span><span class="op" id="4017624">:</span>&nbsp;<span class="ident" id="4017626">w</span><span class="op" id="4017627">}</span><br>
<span class="lineno"></span><span class="op" id="4017629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="4017632">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="4017687">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="4017723">//</span><br>
<span class="lineno"></span><span class="comment" id="4017726">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4017785">//&nbsp;conversion&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;JSON.</span><br>
<span class="lineno">155</span><span class="keyword" id="4017821">func</span>&nbsp;<span class="op" id="4017826">(</span><span class="ident" id="4017827">enc</span>&nbsp;<span class="op" id="4017831">*</span><span class="ident" id="4017832">Encoder</span><span class="op" id="4017839">)</span>&nbsp;<span class="ident" id="4017841">Encode</span><span class="op" id="4017847">(</span><span class="ident" id="4017848">v</span>&nbsp;<span class="keyword" id="4017850">interface</span><span class="op" id="4017859">{</span><span class="op" id="4017860">}</span><span class="op" id="4017861">)</span>&nbsp;<span class="builtintype" id="4017863">error</span>&nbsp;<span class="op" id="4017869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017872">if</span>&nbsp;<span class="ident" id="4017875">enc</span><span class="op" id="4017878">.</span><span class="ident" id="4017879">err</span>&nbsp;<span class="op" id="4017883">!=</span>&nbsp;<span class="ident" id="4017886">nil</span>&nbsp;<span class="op" id="4017890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017894">return</span>&nbsp;<span class="ident" id="4017901">enc</span><span class="op" id="4017904">.</span><span class="ident" id="4017905">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4017910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017913">e</span>&nbsp;<span class="op" id="4017915">:=</span>&nbsp;<span class="ident" id="4017918">newEncodeState</span><span class="op" id="4017932">(</span><span class="op" id="4017933">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017936">err</span>&nbsp;<span class="op" id="4017940">:=</span>&nbsp;<span class="ident" id="4017943">e</span><span class="op" id="4017944">.</span><span class="ident" id="4017945">marshal</span><span class="op" id="4017952">(</span><span class="ident" id="4017953">v</span><span class="op" id="4017954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017957">if</span>&nbsp;<span class="ident" id="4017960">err</span>&nbsp;<span class="op" id="4017964">!=</span>&nbsp;<span class="ident" id="4017967">nil</span>&nbsp;<span class="op" id="4017971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017975">return</span>&nbsp;<span class="ident" id="4017982">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4017987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4017991">//&nbsp;Terminate&nbsp;each&nbsp;value&nbsp;with&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4018032">//&nbsp;This&nbsp;makes&nbsp;the&nbsp;output&nbsp;look&nbsp;a&nbsp;little&nbsp;nicer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4018078">//&nbsp;when&nbsp;debugging,&nbsp;and&nbsp;some&nbsp;kind&nbsp;of&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4018121">//&nbsp;is&nbsp;required&nbsp;if&nbsp;the&nbsp;encoded&nbsp;value&nbsp;was&nbsp;a&nbsp;number,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4018172">//&nbsp;so&nbsp;that&nbsp;the&nbsp;reader&nbsp;knows&nbsp;there&nbsp;aren&#39;t&nbsp;more</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4018219">//&nbsp;digits&nbsp;coming.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018238">e</span><span class="op" id="4018239">.</span><span class="ident" id="4018240">WriteByte</span><span class="op" id="4018249">(</span><span class="string" id="4018250">&#39;\n&#39;</span><span class="op" id="4018254">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018258">if</span>&nbsp;<span class="ident" id="4018261">_</span><span class="op" id="4018262">,</span>&nbsp;<span class="ident" id="4018264">err</span>&nbsp;<span class="op" id="4018268">=</span>&nbsp;<span class="ident" id="4018270">enc</span><span class="op" id="4018273">.</span><span class="ident" id="4018274">w</span><span class="op" id="4018275">.</span><span class="ident" id="4018276">Write</span><span class="op" id="4018281">(</span><span class="ident" id="4018282">e</span><span class="op" id="4018283">.</span><span class="ident" id="4018284">Bytes</span><span class="op" id="4018289">(</span><span class="op" id="4018290">)</span><span class="op" id="4018291">)</span><span class="op" id="4018292">;</span>&nbsp;<span class="ident" id="4018294">err</span>&nbsp;<span class="op" id="4018298">!=</span>&nbsp;<span class="ident" id="4018301">nil</span>&nbsp;<span class="op" id="4018305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018309">enc</span><span class="op" id="4018312">.</span><span class="ident" id="4018313">err</span>&nbsp;<span class="op" id="4018317">=</span>&nbsp;<span class="ident" id="4018319">err</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018327">encodeStatePool</span><span class="op" id="4018342">.</span><span class="ident" id="4018343">Put</span><span class="op" id="4018346">(</span><span class="ident" id="4018347">e</span><span class="op" id="4018348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018351">return</span>&nbsp;<span class="ident" id="4018358">err</span><br>
<span class="lineno"></span><span class="op" id="4018362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="4018365">//&nbsp;RawMessage&nbsp;is&nbsp;a&nbsp;raw&nbsp;encoded&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="4018409">//&nbsp;It&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;and&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="4018460">//&nbsp;be&nbsp;used&nbsp;to&nbsp;delay&nbsp;JSON&nbsp;decoding&nbsp;or&nbsp;precompute&nbsp;a&nbsp;JSON&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4018525">type</span>&nbsp;<span class="ident" id="4018530">RawMessage</span>&nbsp;<span class="op" id="4018541">[</span><span class="op" id="4018542">]</span><span class="builtintype" id="4018543">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="4018549">//&nbsp;MarshalJSON&nbsp;returns&nbsp;*m&nbsp;as&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;m.</span><br>
<span class="lineno"></span><span class="keyword" id="4018602">func</span>&nbsp;<span class="op" id="4018607">(</span><span class="ident" id="4018608">m</span>&nbsp;<span class="op" id="4018610">*</span><span class="ident" id="4018611">RawMessage</span><span class="op" id="4018621">)</span>&nbsp;<span class="ident" id="4018623">MarshalJSON</span><span class="op" id="4018634">(</span><span class="op" id="4018635">)</span>&nbsp;<span class="op" id="4018637">(</span><span class="op" id="4018638">[</span><span class="op" id="4018639">]</span><span class="builtintype" id="4018640">byte</span><span class="op" id="4018644">,</span>&nbsp;<span class="builtintype" id="4018646">error</span><span class="op" id="4018651">)</span>&nbsp;<span class="op" id="4018653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018656">return</span>&nbsp;<span class="op" id="4018663">*</span><span class="ident" id="4018664">m</span><span class="op" id="4018665">,</span>&nbsp;<span class="ident" id="4018667">nil</span><br>
<span class="lineno"></span><span class="op" id="4018671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4018674">//&nbsp;UnmarshalJSON&nbsp;sets&nbsp;*m&nbsp;to&nbsp;a&nbsp;copy&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4018718">func</span>&nbsp;<span class="op" id="4018723">(</span><span class="ident" id="4018724">m</span>&nbsp;<span class="op" id="4018726">*</span><span class="ident" id="4018727">RawMessage</span><span class="op" id="4018737">)</span>&nbsp;<span class="ident" id="4018739">UnmarshalJSON</span><span class="op" id="4018752">(</span><span class="ident" id="4018753">data</span>&nbsp;<span class="op" id="4018758">[</span><span class="op" id="4018759">]</span><span class="builtintype" id="4018760">byte</span><span class="op" id="4018764">)</span>&nbsp;<span class="builtintype" id="4018766">error</span>&nbsp;<span class="op" id="4018772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018775">if</span>&nbsp;<span class="ident" id="4018778">m</span>&nbsp;<span class="op" id="4018780">==</span>&nbsp;<span class="ident" id="4018783">nil</span>&nbsp;<span class="op" id="4018787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018791">return</span>&nbsp;<span class="ident" id="4018798">errors</span><span class="op" id="4018804">.</span><span class="ident" id="4018805">New</span><span class="op" id="4018808">(</span><span class="string" id="4018809">&#34;json.RawMessage:&nbsp;UnmarshalJSON&nbsp;on&nbsp;nil&nbsp;pointer&#34;</span><span class="op" id="4018856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018859">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018862">*</span><span class="ident" id="4018863">m</span>&nbsp;<span class="op" id="4018865">=</span>&nbsp;<span class="builtinfunc" id="4018867">append</span><span class="op" id="4018873">(</span><span class="op" id="4018874">(</span><span class="op" id="4018875">*</span><span class="ident" id="4018876">m</span><span class="op" id="4018877">)</span><span class="op" id="4018878">[</span><span class="num" id="4018879">0</span><span class="op" id="4018880">:</span><span class="num" id="4018881">0</span><span class="op" id="4018882">]</span><span class="op" id="4018883">,</span>&nbsp;<span class="ident" id="4018885">data</span><span class="op" id="4018889">...</span><span class="op" id="4018892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018895">return</span>&nbsp;<span class="ident" id="4018902">nil</span><br>
<span class="lineno"></span><span class="op" id="4018906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4018909">var</span>&nbsp;<span class="ident" id="4018913">_</span>&nbsp;<span class="ident" id="4018915">Marshaler</span>&nbsp;<span class="op" id="4018925">=</span>&nbsp;<span class="op" id="4018927">(</span><span class="op" id="4018928">*</span><span class="ident" id="4018929">RawMessage</span><span class="op" id="4018939">)</span><span class="op" id="4018940">(</span><span class="ident" id="4018941">nil</span><span class="op" id="4018944">)</span><br>
<span class="lineno">200</span><span class="keyword" id="4018946">var</span>&nbsp;<span class="ident" id="4018950">_</span>&nbsp;<span class="ident" id="4018952">Unmarshaler</span>&nbsp;<span class="op" id="4018964">=</span>&nbsp;<span class="op" id="4018966">(</span><span class="op" id="4018967">*</span><span class="ident" id="4018968">RawMessage</span><span class="op" id="4018978">)</span><span class="op" id="4018979">(</span><span class="ident" id="4018980">nil</span><span class="op" id="4018983">)</span>
</div>
</body>
</html>
