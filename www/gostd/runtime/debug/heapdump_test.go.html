<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7132159">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7132214">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7132268">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7132319">package</span>&nbsp;<span class="ident" id="7132327">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7132334">import</span>&nbsp;<span class="op" id="7132341">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7132344">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7132357">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7132363">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7132374">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7132384">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7132387">func</span>&nbsp;<span class="ident" id="7132392">TestWriteHeapDumpNonempty</span><span class="op" id="7132417">(</span><span class="ident" id="7132418">t</span>&nbsp;<span class="op" id="7132420">*</span><span class="ident" id="7132421">testing</span><span class="op" id="7132428">.</span><span class="ident" id="7132429">T</span><span class="op" id="7132430">)</span>&nbsp;<span class="op" id="7132432">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132435">if</span>&nbsp;<span class="ident" id="7132438">runtime</span><span class="op" id="7132445">.</span><span class="ident" id="7132446">GOOS</span>&nbsp;<span class="op" id="7132451">==</span>&nbsp;<span class="string" id="7132454">&#34;nacl&#34;</span>&nbsp;<span class="op" id="7132461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132465">t</span><span class="op" id="7132466">.</span><span class="ident" id="7132467">Skip</span><span class="op" id="7132471">(</span><span class="string" id="7132472">&#34;WriteHeapDump&nbsp;is&nbsp;not&nbsp;available&nbsp;on&nbsp;NaCl.&#34;</span><span class="op" id="7132513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132519">f</span><span class="op" id="7132520">,</span>&nbsp;<span class="ident" id="7132522">err</span>&nbsp;<span class="op" id="7132526">:=</span>&nbsp;<span class="ident" id="7132529">ioutil</span><span class="op" id="7132535">.</span><span class="ident" id="7132536">TempFile</span><span class="op" id="7132544">(</span><span class="string" id="7132545">&#34;&#34;</span><span class="op" id="7132547">,</span>&nbsp;<span class="string" id="7132549">&#34;heapdumptest&#34;</span><span class="op" id="7132563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132566">if</span>&nbsp;<span class="ident" id="7132569">err</span>&nbsp;<span class="op" id="7132573">!=</span>&nbsp;<span class="ident" id="7132576">nil</span>&nbsp;<span class="op" id="7132580">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132584">t</span><span class="op" id="7132585">.</span><span class="ident" id="7132586">Fatalf</span><span class="op" id="7132592">(</span><span class="string" id="7132593">&#34;TempFile&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7132614">,</span>&nbsp;<span class="ident" id="7132616">err</span><span class="op" id="7132619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132625">defer</span>&nbsp;<span class="ident" id="7132631">os</span><span class="op" id="7132633">.</span><span class="ident" id="7132634">Remove</span><span class="op" id="7132640">(</span><span class="ident" id="7132641">f</span><span class="op" id="7132642">.</span><span class="ident" id="7132643">Name</span><span class="op" id="7132647">(</span><span class="op" id="7132648">)</span><span class="op" id="7132649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132652">defer</span>&nbsp;<span class="ident" id="7132658">f</span><span class="op" id="7132659">.</span><span class="ident" id="7132660">Close</span><span class="op" id="7132665">(</span><span class="op" id="7132666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132669">WriteHeapDump</span><span class="op" id="7132682">(</span><span class="ident" id="7132683">f</span><span class="op" id="7132684">.</span><span class="ident" id="7132685">Fd</span><span class="op" id="7132687">(</span><span class="op" id="7132688">)</span><span class="op" id="7132689">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132692">fi</span><span class="op" id="7132694">,</span>&nbsp;<span class="ident" id="7132696">err</span>&nbsp;<span class="op" id="7132700">:=</span>&nbsp;<span class="ident" id="7132703">f</span><span class="op" id="7132704">.</span><span class="ident" id="7132705">Stat</span><span class="op" id="7132709">(</span><span class="op" id="7132710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132713">if</span>&nbsp;<span class="ident" id="7132716">err</span>&nbsp;<span class="op" id="7132720">!=</span>&nbsp;<span class="ident" id="7132723">nil</span>&nbsp;<span class="op" id="7132727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132731">t</span><span class="op" id="7132732">.</span><span class="ident" id="7132733">Fatalf</span><span class="op" id="7132739">(</span><span class="string" id="7132740">&#34;Stat&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7132757">,</span>&nbsp;<span class="ident" id="7132759">err</span><span class="op" id="7132762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132768">const</span>&nbsp;<span class="ident" id="7132774">minSize</span>&nbsp;<span class="op" id="7132782">=</span>&nbsp;<span class="num" id="7132784">1</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132787">if</span>&nbsp;<span class="ident" id="7132790">size</span>&nbsp;<span class="op" id="7132795">:=</span>&nbsp;<span class="ident" id="7132798">fi</span><span class="op" id="7132800">.</span><span class="ident" id="7132801">Size</span><span class="op" id="7132805">(</span><span class="op" id="7132806">)</span><span class="op" id="7132807">;</span>&nbsp;<span class="ident" id="7132809">size</span>&nbsp;<span class="op" id="7132814">&lt;</span>&nbsp;<span class="ident" id="7132816">minSize</span>&nbsp;<span class="op" id="7132824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132828">t</span><span class="op" id="7132829">.</span><span class="ident" id="7132830">Fatalf</span><span class="op" id="7132836">(</span><span class="string" id="7132837">&#34;Heap&nbsp;dump&nbsp;size&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;at&nbsp;least&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="7132890">,</span>&nbsp;<span class="ident" id="7132892">size</span><span class="op" id="7132896">,</span>&nbsp;<span class="ident" id="7132898">minSize</span><span class="op" id="7132905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7132908">}</span><br>
<span class="lineno"></span><span class="op" id="7132910">}</span>
</div>
</body>
</html>
