<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2525894">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2525950">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2526004">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2526055">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2526083">package</span>&nbsp;<span class="ident" id="2526091">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2526100">import</span>&nbsp;<span class="string" id="2526107">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2526117">//&nbsp;UnixCredentials&nbsp;encodes&nbsp;credentials&nbsp;into&nbsp;a&nbsp;socket&nbsp;control&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="2526186">//&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2526242">//&nbsp;authentication.</span><br>
<span class="lineno"></span><span class="keyword" id="2526261">func</span>&nbsp;<span class="ident" id="2526266">UnixCredentials</span><span class="op" id="2526281">(</span><span class="ident" id="2526282">ucred</span>&nbsp;<span class="op" id="2526288">*</span><span class="ident" id="2526289">Ucred</span><span class="op" id="2526294">)</span>&nbsp;<span class="op" id="2526296">[</span><span class="op" id="2526297">]</span><span class="builtintype" id="2526298">byte</span>&nbsp;<span class="op" id="2526303">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2526306">b</span>&nbsp;<span class="op" id="2526308">:=</span>&nbsp;<span class="builtinfunc" id="2526311">make</span><span class="op" id="2526315">(</span><span class="op" id="2526316">[</span><span class="op" id="2526317">]</span><span class="builtintype" id="2526318">byte</span><span class="op" id="2526322">,</span>&nbsp;<span class="ident" id="2526324">CmsgSpace</span><span class="op" id="2526333">(</span><span class="ident" id="2526334">SizeofUcred</span><span class="op" id="2526345">)</span><span class="op" id="2526346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2526349">h</span>&nbsp;<span class="op" id="2526351">:=</span>&nbsp;<span class="op" id="2526354">(</span><span class="op" id="2526355">*</span><span class="ident" id="2526356">Cmsghdr</span><span class="op" id="2526363">)</span><span class="op" id="2526364">(</span><span class="ident" id="2526365">unsafe</span><span class="op" id="2526371">.</span><span class="ident" id="2526372">Pointer</span><span class="op" id="2526379">(</span><span class="op" id="2526380">&amp;</span><span class="ident" id="2526381">b</span><span class="op" id="2526382">[</span><span class="num" id="2526383">0</span><span class="op" id="2526384">]</span><span class="op" id="2526385">)</span><span class="op" id="2526386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2526389">h</span><span class="op" id="2526390">.</span><span class="ident" id="2526391">Level</span>&nbsp;<span class="op" id="2526397">=</span>&nbsp;<span class="ident" id="2526399">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2526411">h</span><span class="op" id="2526412">.</span><span class="ident" id="2526413">Type</span>&nbsp;<span class="op" id="2526418">=</span>&nbsp;<span class="ident" id="2526420">SCM_CREDENTIALS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2526437">h</span><span class="op" id="2526438">.</span><span class="ident" id="2526439">SetLen</span><span class="op" id="2526445">(</span><span class="ident" id="2526446">CmsgLen</span><span class="op" id="2526453">(</span><span class="ident" id="2526454">SizeofUcred</span><span class="op" id="2526465">)</span><span class="op" id="2526466">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2526469">*</span><span class="op" id="2526470">(</span><span class="op" id="2526471">(</span><span class="op" id="2526472">*</span><span class="ident" id="2526473">Ucred</span><span class="op" id="2526478">)</span><span class="op" id="2526479">(</span><span class="ident" id="2526480">cmsgData</span><span class="op" id="2526488">(</span><span class="ident" id="2526489">h</span><span class="op" id="2526490">)</span><span class="op" id="2526491">)</span><span class="op" id="2526492">)</span>&nbsp;<span class="op" id="2526494">=</span>&nbsp;<span class="op" id="2526496">*</span><span class="ident" id="2526497">ucred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526504">return</span>&nbsp;<span class="ident" id="2526511">b</span><br>
<span class="lineno"></span><span class="op" id="2526513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2526516">//&nbsp;ParseUnixCredentials&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains</span><br>
<span class="lineno">25</span><span class="comment" id="2526587">//&nbsp;credentials&nbsp;in&nbsp;a&nbsp;Ucred&nbsp;structure.&nbsp;To&nbsp;receive&nbsp;such&nbsp;a&nbsp;message,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2526655">//&nbsp;SO_PASSCRED&nbsp;option&nbsp;must&nbsp;be&nbsp;enabled&nbsp;on&nbsp;the&nbsp;socket.</span><br>
<span class="lineno"></span><span class="keyword" id="2526708">func</span>&nbsp;<span class="ident" id="2526713">ParseUnixCredentials</span><span class="op" id="2526733">(</span><span class="ident" id="2526734">m</span>&nbsp;<span class="op" id="2526736">*</span><span class="ident" id="2526737">SocketControlMessage</span><span class="op" id="2526757">)</span>&nbsp;<span class="op" id="2526759">(</span><span class="op" id="2526760">*</span><span class="ident" id="2526761">Ucred</span><span class="op" id="2526766">,</span>&nbsp;<span class="builtintype" id="2526768">error</span><span class="op" id="2526773">)</span>&nbsp;<span class="op" id="2526775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526778">if</span>&nbsp;<span class="ident" id="2526781">m</span><span class="op" id="2526782">.</span><span class="ident" id="2526783">Header</span><span class="op" id="2526789">.</span><span class="ident" id="2526790">Level</span>&nbsp;<span class="op" id="2526796">!=</span>&nbsp;<span class="ident" id="2526799">SOL_SOCKET</span>&nbsp;<span class="op" id="2526810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526814">return</span>&nbsp;<span class="ident" id="2526821">nil</span><span class="op" id="2526824">,</span>&nbsp;<span class="ident" id="2526826">EINVAL</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2526834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526837">if</span>&nbsp;<span class="ident" id="2526840">m</span><span class="op" id="2526841">.</span><span class="ident" id="2526842">Header</span><span class="op" id="2526848">.</span><span class="ident" id="2526849">Type</span>&nbsp;<span class="op" id="2526854">!=</span>&nbsp;<span class="ident" id="2526857">SCM_CREDENTIALS</span>&nbsp;<span class="op" id="2526873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526877">return</span>&nbsp;<span class="ident" id="2526884">nil</span><span class="op" id="2526887">,</span>&nbsp;<span class="ident" id="2526889">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2526897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2526900">ucred</span>&nbsp;<span class="op" id="2526906">:=</span>&nbsp;<span class="op" id="2526909">*</span><span class="op" id="2526910">(</span><span class="op" id="2526911">*</span><span class="ident" id="2526912">Ucred</span><span class="op" id="2526917">)</span><span class="op" id="2526918">(</span><span class="ident" id="2526919">unsafe</span><span class="op" id="2526925">.</span><span class="ident" id="2526926">Pointer</span><span class="op" id="2526933">(</span><span class="op" id="2526934">&amp;</span><span class="ident" id="2526935">m</span><span class="op" id="2526936">.</span><span class="ident" id="2526937">Data</span><span class="op" id="2526941">[</span><span class="num" id="2526942">0</span><span class="op" id="2526943">]</span><span class="op" id="2526944">)</span><span class="op" id="2526945">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526948">return</span>&nbsp;<span class="op" id="2526955">&amp;</span><span class="ident" id="2526956">ucred</span><span class="op" id="2526961">,</span>&nbsp;<span class="ident" id="2526963">nil</span><br>
<span class="lineno"></span><span class="op" id="2526967">}</span>
</div>
</body>
</html>
