<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/exec</h2>
<ul>
<li><a href="/gostd/os/exec/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/exec/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/os/exec/lp_test.go.html">lp_test.go</a></li>
<li><a href="/gostd/os/exec/lp_unix.go.html">lp_unix.go</a></li>
<li><a href="/gostd/os/exec/lp_unix_test.go.html">lp_unix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3517288">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3517343">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3517397">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3517448">//&nbsp;Package&nbsp;exec&nbsp;runs&nbsp;external&nbsp;commands.&nbsp;It&nbsp;wraps&nbsp;os.StartProcess&nbsp;to&nbsp;make&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3517524">//&nbsp;easier&nbsp;to&nbsp;remap&nbsp;stdin&nbsp;and&nbsp;stdout,&nbsp;connect&nbsp;I/O&nbsp;with&nbsp;pipes,&nbsp;and&nbsp;do&nbsp;other</span><br>
<span class="lineno"></span><span class="comment" id="3517598">//&nbsp;adjustments.</span><br>
<span class="lineno"></span><span class="keyword" id="3517614">package</span>&nbsp;<span class="ident" id="3517622">exec</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3517628">import</span>&nbsp;<span class="op" id="3517635">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3517638">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3517647">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3517657">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3517663">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3517669">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3517686">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3517697">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3517708">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3517719">&#34;sync&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3517727">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="3517737">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3517740">//&nbsp;Error&nbsp;records&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;binary&nbsp;that&nbsp;failed&nbsp;to&nbsp;be&nbsp;executed</span><br>
<span class="lineno"></span><span class="comment" id="3517805">//&nbsp;and&nbsp;the&nbsp;reason&nbsp;it&nbsp;failed.</span><br>
<span class="lineno">25</span><span class="keyword" id="3517834">type</span>&nbsp;<span class="ident" id="3517839">Error</span>&nbsp;<span class="keyword" id="3517845">struct</span>&nbsp;<span class="op" id="3517852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3517855">Name</span>&nbsp;<span class="builtintype" id="3517860">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3517868">Err</span>&nbsp;&nbsp;<span class="builtintype" id="3517873">error</span><br>
<span class="lineno"></span><span class="op" id="3517879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="3517882">func</span>&nbsp;<span class="op" id="3517887">(</span><span class="ident" id="3517888">e</span>&nbsp;<span class="op" id="3517890">*</span><span class="ident" id="3517891">Error</span><span class="op" id="3517896">)</span>&nbsp;<span class="ident" id="3517898">Error</span><span class="op" id="3517903">(</span><span class="op" id="3517904">)</span>&nbsp;<span class="builtintype" id="3517906">string</span>&nbsp;<span class="op" id="3517913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3517916">return</span>&nbsp;<span class="string" id="3517923">&#34;exec:&nbsp;&#34;</span>&nbsp;<span class="op" id="3517932">+</span>&nbsp;<span class="ident" id="3517934">strconv</span><span class="op" id="3517941">.</span><span class="ident" id="3517942">Quote</span><span class="op" id="3517947">(</span><span class="ident" id="3517948">e</span><span class="op" id="3517949">.</span><span class="ident" id="3517950">Name</span><span class="op" id="3517954">)</span>&nbsp;<span class="op" id="3517956">+</span>&nbsp;<span class="string" id="3517958">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3517963">+</span>&nbsp;<span class="ident" id="3517965">e</span><span class="op" id="3517966">.</span><span class="ident" id="3517967">Err</span><span class="op" id="3517970">.</span><span class="ident" id="3517971">Error</span><span class="op" id="3517976">(</span><span class="op" id="3517977">)</span><br>
<span class="lineno"></span><span class="op" id="3517979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3517982">//&nbsp;Cmd&nbsp;represents&nbsp;an&nbsp;external&nbsp;command&nbsp;being&nbsp;prepared&nbsp;or&nbsp;run.</span><br>
<span class="lineno">35</span><span class="keyword" id="3518043">type</span>&nbsp;<span class="ident" id="3518048">Cmd</span>&nbsp;<span class="keyword" id="3518052">struct</span>&nbsp;<span class="op" id="3518059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518062">//&nbsp;Path&nbsp;is&nbsp;the&nbsp;path&nbsp;of&nbsp;the&nbsp;command&nbsp;to&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518106">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518110">//&nbsp;This&nbsp;is&nbsp;the&nbsp;only&nbsp;field&nbsp;that&nbsp;must&nbsp;be&nbsp;set&nbsp;to&nbsp;a&nbsp;non-zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518168">//&nbsp;value.&nbsp;If&nbsp;Path&nbsp;is&nbsp;relative,&nbsp;it&nbsp;is&nbsp;evaluated&nbsp;relative</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518225">//&nbsp;to&nbsp;Dir.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518237">Path</span>&nbsp;<span class="builtintype" id="3518242">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518251">//&nbsp;Args&nbsp;holds&nbsp;command&nbsp;line&nbsp;arguments,&nbsp;including&nbsp;the&nbsp;command&nbsp;as&nbsp;Args[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518324">//&nbsp;If&nbsp;the&nbsp;Args&nbsp;field&nbsp;is&nbsp;empty&nbsp;or&nbsp;nil,&nbsp;Run&nbsp;uses&nbsp;{Path}.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518380">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518384">//&nbsp;In&nbsp;typical&nbsp;use,&nbsp;both&nbsp;Path&nbsp;and&nbsp;Args&nbsp;are&nbsp;set&nbsp;by&nbsp;calling&nbsp;Command.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518451">Args</span>&nbsp;<span class="op" id="3518456">[</span><span class="op" id="3518457">]</span><span class="builtintype" id="3518458">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518467">//&nbsp;Env&nbsp;specifies&nbsp;the&nbsp;environment&nbsp;of&nbsp;the&nbsp;process.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518517">//&nbsp;If&nbsp;Env&nbsp;is&nbsp;nil,&nbsp;Run&nbsp;uses&nbsp;the&nbsp;current&nbsp;process&#39;s&nbsp;environment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518580">Env</span>&nbsp;<span class="op" id="3518584">[</span><span class="op" id="3518585">]</span><span class="builtintype" id="3518586">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518595">//&nbsp;Dir&nbsp;specifies&nbsp;the&nbsp;working&nbsp;directory&nbsp;of&nbsp;the&nbsp;command.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518651">//&nbsp;If&nbsp;Dir&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;Run&nbsp;runs&nbsp;the&nbsp;command&nbsp;in&nbsp;the</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518711">//&nbsp;calling&nbsp;process&#39;s&nbsp;current&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3518752">Dir</span>&nbsp;<span class="builtintype" id="3518756">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518765">//&nbsp;Stdin&nbsp;specifies&nbsp;the&nbsp;process&#39;s&nbsp;standard&nbsp;input.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518815">//&nbsp;If&nbsp;Stdin&nbsp;is&nbsp;nil,&nbsp;the&nbsp;process&nbsp;reads&nbsp;from&nbsp;the&nbsp;null&nbsp;device&nbsp;(os.DevNull).</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518889">//&nbsp;If&nbsp;Stdin&nbsp;is&nbsp;an&nbsp;*os.File,&nbsp;the&nbsp;process&#39;s&nbsp;standard&nbsp;input&nbsp;is&nbsp;connected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518960">//&nbsp;directly&nbsp;to&nbsp;that&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3518987">//&nbsp;Otherwise,&nbsp;during&nbsp;the&nbsp;execution&nbsp;of&nbsp;the&nbsp;command&nbsp;a&nbsp;separate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519049">//&nbsp;goroutine&nbsp;reads&nbsp;from&nbsp;Stdin&nbsp;and&nbsp;delivers&nbsp;that&nbsp;data&nbsp;to&nbsp;the&nbsp;command</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519118">//&nbsp;over&nbsp;a&nbsp;pipe.&nbsp;In&nbsp;this&nbsp;case,&nbsp;Wait&nbsp;does&nbsp;not&nbsp;complete&nbsp;until&nbsp;the&nbsp;goroutine</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519192">//&nbsp;stops&nbsp;copying,&nbsp;either&nbsp;because&nbsp;it&nbsp;has&nbsp;reached&nbsp;the&nbsp;end&nbsp;of&nbsp;Stdin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519258">//&nbsp;(EOF&nbsp;or&nbsp;a&nbsp;read&nbsp;error)&nbsp;or&nbsp;because&nbsp;writing&nbsp;to&nbsp;the&nbsp;pipe&nbsp;returned&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3519334">Stdin</span>&nbsp;<span class="ident" id="3519340">io</span><span class="op" id="3519342">.</span><span class="ident" id="3519343">Reader</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519352">//&nbsp;Stdout&nbsp;and&nbsp;Stderr&nbsp;specify&nbsp;the&nbsp;process&#39;s&nbsp;standard&nbsp;output&nbsp;and&nbsp;error.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519423">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519427">//&nbsp;If&nbsp;either&nbsp;is&nbsp;nil,&nbsp;Run&nbsp;connects&nbsp;the&nbsp;corresponding&nbsp;file&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519496">//&nbsp;to&nbsp;the&nbsp;null&nbsp;device&nbsp;(os.DevNull).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519533">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519537">//&nbsp;If&nbsp;Stdout&nbsp;and&nbsp;Stderr&nbsp;are&nbsp;the&nbsp;same&nbsp;writer,&nbsp;at&nbsp;most&nbsp;one</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519595">//&nbsp;goroutine&nbsp;at&nbsp;a&nbsp;time&nbsp;will&nbsp;call&nbsp;Write.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3519636">Stdout</span>&nbsp;<span class="ident" id="3519643">io</span><span class="op" id="3519645">.</span><span class="ident" id="3519646">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3519654">Stderr</span>&nbsp;<span class="ident" id="3519661">io</span><span class="op" id="3519663">.</span><span class="ident" id="3519664">Writer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519673">//&nbsp;ExtraFiles&nbsp;specifies&nbsp;additional&nbsp;open&nbsp;files&nbsp;to&nbsp;be&nbsp;inherited&nbsp;by&nbsp;the</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519743">//&nbsp;new&nbsp;process.&nbsp;It&nbsp;does&nbsp;not&nbsp;include&nbsp;standard&nbsp;input,&nbsp;standard&nbsp;output,&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519816">//&nbsp;standard&nbsp;error.&nbsp;If&nbsp;non-nil,&nbsp;entry&nbsp;i&nbsp;becomes&nbsp;file&nbsp;descriptor&nbsp;3+i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519885">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519889">//&nbsp;BUG:&nbsp;on&nbsp;OS&nbsp;X&nbsp;10.6,&nbsp;child&nbsp;processes&nbsp;may&nbsp;sometimes&nbsp;inherit&nbsp;unwanted&nbsp;fds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3519964">//&nbsp;http://golang.org/issue/2603</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3519997">ExtraFiles</span>&nbsp;<span class="op" id="3520008">[</span><span class="op" id="3520009">]</span><span class="op" id="3520010">*</span><span class="ident" id="3520011">os</span><span class="op" id="3520013">.</span><span class="ident" id="3520014">File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3520021">//&nbsp;SysProcAttr&nbsp;holds&nbsp;optional,&nbsp;operating&nbsp;system-specific&nbsp;attributes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3520091">//&nbsp;Run&nbsp;passes&nbsp;it&nbsp;to&nbsp;os.StartProcess&nbsp;as&nbsp;the&nbsp;os.ProcAttr&#39;s&nbsp;Sys&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520160">SysProcAttr</span>&nbsp;<span class="op" id="3520172">*</span><span class="ident" id="3520173">syscall</span><span class="op" id="3520180">.</span><span class="ident" id="3520181">SysProcAttr</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3520195">//&nbsp;Process&nbsp;is&nbsp;the&nbsp;underlying&nbsp;process,&nbsp;once&nbsp;started.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520248">Process</span>&nbsp;<span class="op" id="3520256">*</span><span class="ident" id="3520257">os</span><span class="op" id="3520259">.</span><span class="ident" id="3520260">Process</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3520270">//&nbsp;ProcessState&nbsp;contains&nbsp;information&nbsp;about&nbsp;an&nbsp;exited&nbsp;process,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3520333">//&nbsp;available&nbsp;after&nbsp;a&nbsp;call&nbsp;to&nbsp;Wait&nbsp;or&nbsp;Run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520376">ProcessState</span>&nbsp;<span class="op" id="3520389">*</span><span class="ident" id="3520390">os</span><span class="op" id="3520392">.</span><span class="ident" id="3520393">ProcessState</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520408">lookPathErr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3520424">error</span>&nbsp;<span class="comment" id="3520430">//&nbsp;LookPath&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520458">finished</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3520474">bool</span>&nbsp;&nbsp;<span class="comment" id="3520480">//&nbsp;when&nbsp;Wait&nbsp;was&nbsp;called</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520505">childFiles</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3520521">[</span><span class="op" id="3520522">]</span><span class="op" id="3520523">*</span><span class="ident" id="3520524">os</span><span class="op" id="3520526">.</span><span class="ident" id="3520527">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520533">closeAfterStart</span>&nbsp;<span class="op" id="3520549">[</span><span class="op" id="3520550">]</span><span class="ident" id="3520551">io</span><span class="op" id="3520553">.</span><span class="ident" id="3520554">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520562">closeAfterWait</span>&nbsp;&nbsp;<span class="op" id="3520578">[</span><span class="op" id="3520579">]</span><span class="ident" id="3520580">io</span><span class="op" id="3520582">.</span><span class="ident" id="3520583">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520591">goroutine</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3520607">[</span><span class="op" id="3520608">]</span><span class="keyword" id="3520609">func</span><span class="op" id="3520613">(</span><span class="op" id="3520614">)</span>&nbsp;<span class="builtintype" id="3520616">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3520623">errch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3520639">chan</span>&nbsp;<span class="builtintype" id="3520644">error</span>&nbsp;<span class="comment" id="3520650">//&nbsp;one&nbsp;send&nbsp;per&nbsp;goroutine</span><br>
<span class="lineno">105</span><span class="op" id="3520676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3520679">//&nbsp;Command&nbsp;returns&nbsp;the&nbsp;Cmd&nbsp;struct&nbsp;to&nbsp;execute&nbsp;the&nbsp;named&nbsp;program&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3520747">//&nbsp;the&nbsp;given&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="3520771">//</span><br>
<span class="lineno">110</span><span class="comment" id="3520774">//&nbsp;It&nbsp;sets&nbsp;only&nbsp;the&nbsp;Path&nbsp;and&nbsp;Args&nbsp;in&nbsp;the&nbsp;returned&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3520835">//</span><br>
<span class="lineno"></span><span class="comment" id="3520838">//&nbsp;If&nbsp;name&nbsp;contains&nbsp;no&nbsp;path&nbsp;separators,&nbsp;Command&nbsp;uses&nbsp;LookPath&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3520903">//&nbsp;resolve&nbsp;the&nbsp;path&nbsp;to&nbsp;a&nbsp;complete&nbsp;name&nbsp;if&nbsp;possible.&nbsp;Otherwise&nbsp;it&nbsp;uses</span><br>
<span class="lineno"></span><span class="comment" id="3520973">//&nbsp;name&nbsp;directly.</span><br>
<span class="lineno">115</span><span class="comment" id="3520991">//</span><br>
<span class="lineno"></span><span class="comment" id="3520994">//&nbsp;The&nbsp;returned&nbsp;Cmd&#39;s&nbsp;Args&nbsp;field&nbsp;is&nbsp;constructed&nbsp;from&nbsp;the&nbsp;command&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="3521064">//&nbsp;followed&nbsp;by&nbsp;the&nbsp;elements&nbsp;of&nbsp;arg,&nbsp;so&nbsp;arg&nbsp;should&nbsp;not&nbsp;include&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3521130">//&nbsp;command&nbsp;name&nbsp;itself.&nbsp;For&nbsp;example,&nbsp;Command(&#34;echo&#34;,&nbsp;&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="keyword" id="3521192">func</span>&nbsp;<span class="ident" id="3521197">Command</span><span class="op" id="3521204">(</span><span class="ident" id="3521205">name</span>&nbsp;<span class="builtintype" id="3521210">string</span><span class="op" id="3521216">,</span>&nbsp;<span class="ident" id="3521218">arg</span>&nbsp;<span class="op" id="3521222">...</span><span class="builtintype" id="3521225">string</span><span class="op" id="3521231">)</span>&nbsp;<span class="op" id="3521233">*</span><span class="ident" id="3521234">Cmd</span>&nbsp;<span class="op" id="3521238">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521241">cmd</span>&nbsp;<span class="op" id="3521245">:=</span>&nbsp;<span class="op" id="3521248">&amp;</span><span class="ident" id="3521249">Cmd</span><span class="op" id="3521252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521256">Path</span><span class="op" id="3521260">:</span>&nbsp;<span class="ident" id="3521262">name</span><span class="op" id="3521266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521270">Args</span><span class="op" id="3521274">:</span>&nbsp;<span class="builtinfunc" id="3521276">append</span><span class="op" id="3521282">(</span><span class="op" id="3521283">[</span><span class="op" id="3521284">]</span><span class="builtintype" id="3521285">string</span><span class="op" id="3521291">{</span><span class="ident" id="3521292">name</span><span class="op" id="3521296">}</span><span class="op" id="3521297">,</span>&nbsp;<span class="ident" id="3521299">arg</span><span class="op" id="3521302">...</span><span class="op" id="3521305">)</span><span class="op" id="3521306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3521309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521312">if</span>&nbsp;<span class="ident" id="3521315">filepath</span><span class="op" id="3521323">.</span><span class="ident" id="3521324">Base</span><span class="op" id="3521328">(</span><span class="ident" id="3521329">name</span><span class="op" id="3521333">)</span>&nbsp;<span class="op" id="3521335">==</span>&nbsp;<span class="ident" id="3521338">name</span>&nbsp;<span class="op" id="3521343">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521347">if</span>&nbsp;<span class="ident" id="3521350">lp</span><span class="op" id="3521352">,</span>&nbsp;<span class="ident" id="3521354">err</span>&nbsp;<span class="op" id="3521358">:=</span>&nbsp;<span class="ident" id="3521361">LookPath</span><span class="op" id="3521369">(</span><span class="ident" id="3521370">name</span><span class="op" id="3521374">)</span><span class="op" id="3521375">;</span>&nbsp;<span class="ident" id="3521377">err</span>&nbsp;<span class="op" id="3521381">!=</span>&nbsp;<span class="ident" id="3521384">nil</span>&nbsp;<span class="op" id="3521388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521393">cmd</span><span class="op" id="3521396">.</span><span class="ident" id="3521397">lookPathErr</span>&nbsp;<span class="op" id="3521409">=</span>&nbsp;<span class="ident" id="3521411">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3521417">}</span>&nbsp;<span class="keyword" id="3521419">else</span>&nbsp;<span class="op" id="3521424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521429">cmd</span><span class="op" id="3521432">.</span><span class="ident" id="3521433">Path</span>&nbsp;<span class="op" id="3521438">=</span>&nbsp;<span class="ident" id="3521440">lp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3521445">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3521448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521451">return</span>&nbsp;<span class="ident" id="3521458">cmd</span><br>
<span class="lineno"></span><span class="op" id="3521462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3521465">//&nbsp;interfaceEqual&nbsp;protects&nbsp;against&nbsp;panics&nbsp;from&nbsp;doing&nbsp;equality&nbsp;tests&nbsp;on</span><br>
<span class="lineno">135</span><span class="comment" id="3521536">//&nbsp;two&nbsp;interfaces&nbsp;with&nbsp;non-comparable&nbsp;underlying&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3521592">func</span>&nbsp;<span class="ident" id="3521597">interfaceEqual</span><span class="op" id="3521611">(</span><span class="ident" id="3521612">a</span><span class="op" id="3521613">,</span>&nbsp;<span class="ident" id="3521615">b</span>&nbsp;<span class="keyword" id="3521617">interface</span><span class="op" id="3521626">{</span><span class="op" id="3521627">}</span><span class="op" id="3521628">)</span>&nbsp;<span class="builtintype" id="3521630">bool</span>&nbsp;<span class="op" id="3521635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521638">defer</span>&nbsp;<span class="keyword" id="3521644">func</span><span class="op" id="3521648">(</span><span class="op" id="3521649">)</span>&nbsp;<span class="op" id="3521651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3521655">recover</span><span class="op" id="3521662">(</span><span class="op" id="3521663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3521666">}</span><span class="op" id="3521667">(</span><span class="op" id="3521668">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521671">return</span>&nbsp;<span class="ident" id="3521678">a</span>&nbsp;<span class="op" id="3521680">==</span>&nbsp;<span class="ident" id="3521683">b</span><br>
<span class="lineno"></span><span class="op" id="3521685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3521688">func</span>&nbsp;<span class="op" id="3521693">(</span><span class="ident" id="3521694">c</span>&nbsp;<span class="op" id="3521696">*</span><span class="ident" id="3521697">Cmd</span><span class="op" id="3521700">)</span>&nbsp;<span class="ident" id="3521702">envv</span><span class="op" id="3521706">(</span><span class="op" id="3521707">)</span>&nbsp;<span class="op" id="3521709">[</span><span class="op" id="3521710">]</span><span class="builtintype" id="3521711">string</span>&nbsp;<span class="op" id="3521718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521721">if</span>&nbsp;<span class="ident" id="3521724">c</span><span class="op" id="3521725">.</span><span class="ident" id="3521726">Env</span>&nbsp;<span class="op" id="3521730">!=</span>&nbsp;<span class="ident" id="3521733">nil</span>&nbsp;<span class="op" id="3521737">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521741">return</span>&nbsp;<span class="ident" id="3521748">c</span><span class="op" id="3521749">.</span><span class="ident" id="3521750">Env</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3521755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521758">return</span>&nbsp;<span class="ident" id="3521765">os</span><span class="op" id="3521767">.</span><span class="ident" id="3521768">Environ</span><span class="op" id="3521775">(</span><span class="op" id="3521776">)</span><br>
<span class="lineno"></span><span class="op" id="3521778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="3521781">func</span>&nbsp;<span class="op" id="3521786">(</span><span class="ident" id="3521787">c</span>&nbsp;<span class="op" id="3521789">*</span><span class="ident" id="3521790">Cmd</span><span class="op" id="3521793">)</span>&nbsp;<span class="ident" id="3521795">argv</span><span class="op" id="3521799">(</span><span class="op" id="3521800">)</span>&nbsp;<span class="op" id="3521802">[</span><span class="op" id="3521803">]</span><span class="builtintype" id="3521804">string</span>&nbsp;<span class="op" id="3521811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521814">if</span>&nbsp;<span class="builtinfunc" id="3521817">len</span><span class="op" id="3521820">(</span><span class="ident" id="3521821">c</span><span class="op" id="3521822">.</span><span class="ident" id="3521823">Args</span><span class="op" id="3521827">)</span>&nbsp;<span class="op" id="3521829">&gt;</span>&nbsp;<span class="num" id="3521831">0</span>&nbsp;<span class="op" id="3521833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521837">return</span>&nbsp;<span class="ident" id="3521844">c</span><span class="op" id="3521845">.</span><span class="ident" id="3521846">Args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3521852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521855">return</span>&nbsp;<span class="op" id="3521862">[</span><span class="op" id="3521863">]</span><span class="builtintype" id="3521864">string</span><span class="op" id="3521870">{</span><span class="ident" id="3521871">c</span><span class="op" id="3521872">.</span><span class="ident" id="3521873">Path</span><span class="op" id="3521877">}</span><br>
<span class="lineno">155</span><span class="op" id="3521879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3521882">func</span>&nbsp;<span class="op" id="3521887">(</span><span class="ident" id="3521888">c</span>&nbsp;<span class="op" id="3521890">*</span><span class="ident" id="3521891">Cmd</span><span class="op" id="3521894">)</span>&nbsp;<span class="ident" id="3521896">stdin</span><span class="op" id="3521901">(</span><span class="op" id="3521902">)</span>&nbsp;<span class="op" id="3521904">(</span><span class="ident" id="3521905">f</span>&nbsp;<span class="op" id="3521907">*</span><span class="ident" id="3521908">os</span><span class="op" id="3521910">.</span><span class="ident" id="3521911">File</span><span class="op" id="3521915">,</span>&nbsp;<span class="ident" id="3521917">err</span>&nbsp;<span class="builtintype" id="3521921">error</span><span class="op" id="3521926">)</span>&nbsp;<span class="op" id="3521928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521931">if</span>&nbsp;<span class="ident" id="3521934">c</span><span class="op" id="3521935">.</span><span class="ident" id="3521936">Stdin</span>&nbsp;<span class="op" id="3521942">==</span>&nbsp;<span class="ident" id="3521945">nil</span>&nbsp;<span class="op" id="3521949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3521953">f</span><span class="op" id="3521954">,</span>&nbsp;<span class="ident" id="3521956">err</span>&nbsp;<span class="op" id="3521960">=</span>&nbsp;<span class="ident" id="3521962">os</span><span class="op" id="3521964">.</span><span class="ident" id="3521965">Open</span><span class="op" id="3521969">(</span><span class="ident" id="3521970">os</span><span class="op" id="3521972">.</span><span class="ident" id="3521973">DevNull</span><span class="op" id="3521980">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3521984">if</span>&nbsp;<span class="ident" id="3521987">err</span>&nbsp;<span class="op" id="3521991">!=</span>&nbsp;<span class="ident" id="3521994">nil</span>&nbsp;<span class="op" id="3521998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522003">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522016">c</span><span class="op" id="3522017">.</span><span class="ident" id="3522018">closeAfterStart</span>&nbsp;<span class="op" id="3522034">=</span>&nbsp;<span class="builtinfunc" id="3522036">append</span><span class="op" id="3522042">(</span><span class="ident" id="3522043">c</span><span class="op" id="3522044">.</span><span class="ident" id="3522045">closeAfterStart</span><span class="op" id="3522060">,</span>&nbsp;<span class="ident" id="3522062">f</span><span class="op" id="3522063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522067">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522079">if</span>&nbsp;<span class="ident" id="3522082">f</span><span class="op" id="3522083">,</span>&nbsp;<span class="ident" id="3522085">ok</span>&nbsp;<span class="op" id="3522088">:=</span>&nbsp;<span class="ident" id="3522091">c</span><span class="op" id="3522092">.</span><span class="ident" id="3522093">Stdin</span><span class="op" id="3522098">.</span><span class="op" id="3522099">(</span><span class="op" id="3522100">*</span><span class="ident" id="3522101">os</span><span class="op" id="3522103">.</span><span class="ident" id="3522104">File</span><span class="op" id="3522108">)</span><span class="op" id="3522109">;</span>&nbsp;<span class="ident" id="3522111">ok</span>&nbsp;<span class="op" id="3522114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522118">return</span>&nbsp;<span class="ident" id="3522125">f</span><span class="op" id="3522126">,</span>&nbsp;<span class="ident" id="3522128">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522133">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522137">pr</span><span class="op" id="3522139">,</span>&nbsp;<span class="ident" id="3522141">pw</span><span class="op" id="3522143">,</span>&nbsp;<span class="ident" id="3522145">err</span>&nbsp;<span class="op" id="3522149">:=</span>&nbsp;<span class="ident" id="3522152">os</span><span class="op" id="3522154">.</span><span class="ident" id="3522155">Pipe</span><span class="op" id="3522159">(</span><span class="op" id="3522160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522163">if</span>&nbsp;<span class="ident" id="3522166">err</span>&nbsp;<span class="op" id="3522170">!=</span>&nbsp;<span class="ident" id="3522173">nil</span>&nbsp;<span class="op" id="3522177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522181">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522189">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522193">c</span><span class="op" id="3522194">.</span><span class="ident" id="3522195">closeAfterStart</span>&nbsp;<span class="op" id="3522211">=</span>&nbsp;<span class="builtinfunc" id="3522213">append</span><span class="op" id="3522219">(</span><span class="ident" id="3522220">c</span><span class="op" id="3522221">.</span><span class="ident" id="3522222">closeAfterStart</span><span class="op" id="3522237">,</span>&nbsp;<span class="ident" id="3522239">pr</span><span class="op" id="3522241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522244">c</span><span class="op" id="3522245">.</span><span class="ident" id="3522246">closeAfterWait</span>&nbsp;<span class="op" id="3522261">=</span>&nbsp;<span class="builtinfunc" id="3522263">append</span><span class="op" id="3522269">(</span><span class="ident" id="3522270">c</span><span class="op" id="3522271">.</span><span class="ident" id="3522272">closeAfterWait</span><span class="op" id="3522286">,</span>&nbsp;<span class="ident" id="3522288">pw</span><span class="op" id="3522290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522293">c</span><span class="op" id="3522294">.</span><span class="ident" id="3522295">goroutine</span>&nbsp;<span class="op" id="3522305">=</span>&nbsp;<span class="builtinfunc" id="3522307">append</span><span class="op" id="3522313">(</span><span class="ident" id="3522314">c</span><span class="op" id="3522315">.</span><span class="ident" id="3522316">goroutine</span><span class="op" id="3522325">,</span>&nbsp;<span class="keyword" id="3522327">func</span><span class="op" id="3522331">(</span><span class="op" id="3522332">)</span>&nbsp;<span class="builtintype" id="3522334">error</span>&nbsp;<span class="op" id="3522340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522344">_</span><span class="op" id="3522345">,</span>&nbsp;<span class="ident" id="3522347">err</span>&nbsp;<span class="op" id="3522351">:=</span>&nbsp;<span class="ident" id="3522354">io</span><span class="op" id="3522356">.</span><span class="ident" id="3522357">Copy</span><span class="op" id="3522361">(</span><span class="ident" id="3522362">pw</span><span class="op" id="3522364">,</span>&nbsp;<span class="ident" id="3522366">c</span><span class="op" id="3522367">.</span><span class="ident" id="3522368">Stdin</span><span class="op" id="3522373">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522377">if</span>&nbsp;<span class="ident" id="3522380">err1</span>&nbsp;<span class="op" id="3522385">:=</span>&nbsp;<span class="ident" id="3522388">pw</span><span class="op" id="3522390">.</span><span class="ident" id="3522391">Close</span><span class="op" id="3522396">(</span><span class="op" id="3522397">)</span><span class="op" id="3522398">;</span>&nbsp;<span class="ident" id="3522400">err</span>&nbsp;<span class="op" id="3522404">==</span>&nbsp;<span class="ident" id="3522407">nil</span>&nbsp;<span class="op" id="3522411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522416">err</span>&nbsp;<span class="op" id="3522420">=</span>&nbsp;<span class="ident" id="3522422">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522433">return</span>&nbsp;<span class="ident" id="3522440">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522445">}</span><span class="op" id="3522446">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522449">return</span>&nbsp;<span class="ident" id="3522456">pr</span><span class="op" id="3522458">,</span>&nbsp;<span class="ident" id="3522460">nil</span><br>
<span class="lineno"></span><span class="op" id="3522464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3522467">func</span>&nbsp;<span class="op" id="3522472">(</span><span class="ident" id="3522473">c</span>&nbsp;<span class="op" id="3522475">*</span><span class="ident" id="3522476">Cmd</span><span class="op" id="3522479">)</span>&nbsp;<span class="ident" id="3522481">stdout</span><span class="op" id="3522487">(</span><span class="op" id="3522488">)</span>&nbsp;<span class="op" id="3522490">(</span><span class="ident" id="3522491">f</span>&nbsp;<span class="op" id="3522493">*</span><span class="ident" id="3522494">os</span><span class="op" id="3522496">.</span><span class="ident" id="3522497">File</span><span class="op" id="3522501">,</span>&nbsp;<span class="ident" id="3522503">err</span>&nbsp;<span class="builtintype" id="3522507">error</span><span class="op" id="3522512">)</span>&nbsp;<span class="op" id="3522514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522517">return</span>&nbsp;<span class="ident" id="3522524">c</span><span class="op" id="3522525">.</span><span class="ident" id="3522526">writerDescriptor</span><span class="op" id="3522542">(</span><span class="ident" id="3522543">c</span><span class="op" id="3522544">.</span><span class="ident" id="3522545">Stdout</span><span class="op" id="3522551">)</span><br>
<span class="lineno">190</span><span class="op" id="3522553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3522556">func</span>&nbsp;<span class="op" id="3522561">(</span><span class="ident" id="3522562">c</span>&nbsp;<span class="op" id="3522564">*</span><span class="ident" id="3522565">Cmd</span><span class="op" id="3522568">)</span>&nbsp;<span class="ident" id="3522570">stderr</span><span class="op" id="3522576">(</span><span class="op" id="3522577">)</span>&nbsp;<span class="op" id="3522579">(</span><span class="ident" id="3522580">f</span>&nbsp;<span class="op" id="3522582">*</span><span class="ident" id="3522583">os</span><span class="op" id="3522585">.</span><span class="ident" id="3522586">File</span><span class="op" id="3522590">,</span>&nbsp;<span class="ident" id="3522592">err</span>&nbsp;<span class="builtintype" id="3522596">error</span><span class="op" id="3522601">)</span>&nbsp;<span class="op" id="3522603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522606">if</span>&nbsp;<span class="ident" id="3522609">c</span><span class="op" id="3522610">.</span><span class="ident" id="3522611">Stderr</span>&nbsp;<span class="op" id="3522618">!=</span>&nbsp;<span class="ident" id="3522621">nil</span>&nbsp;<span class="op" id="3522625">&amp;&amp;</span>&nbsp;<span class="ident" id="3522628">interfaceEqual</span><span class="op" id="3522642">(</span><span class="ident" id="3522643">c</span><span class="op" id="3522644">.</span><span class="ident" id="3522645">Stderr</span><span class="op" id="3522651">,</span>&nbsp;<span class="ident" id="3522653">c</span><span class="op" id="3522654">.</span><span class="ident" id="3522655">Stdout</span><span class="op" id="3522661">)</span>&nbsp;<span class="op" id="3522663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522667">return</span>&nbsp;<span class="ident" id="3522674">c</span><span class="op" id="3522675">.</span><span class="ident" id="3522676">childFiles</span><span class="op" id="3522686">[</span><span class="num" id="3522687">1</span><span class="op" id="3522688">]</span><span class="op" id="3522689">,</span>&nbsp;<span class="ident" id="3522691">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522699">return</span>&nbsp;<span class="ident" id="3522706">c</span><span class="op" id="3522707">.</span><span class="ident" id="3522708">writerDescriptor</span><span class="op" id="3522724">(</span><span class="ident" id="3522725">c</span><span class="op" id="3522726">.</span><span class="ident" id="3522727">Stderr</span><span class="op" id="3522733">)</span><br>
<span class="lineno"></span><span class="op" id="3522735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3522738">func</span>&nbsp;<span class="op" id="3522743">(</span><span class="ident" id="3522744">c</span>&nbsp;<span class="op" id="3522746">*</span><span class="ident" id="3522747">Cmd</span><span class="op" id="3522750">)</span>&nbsp;<span class="ident" id="3522752">writerDescriptor</span><span class="op" id="3522768">(</span><span class="ident" id="3522769">w</span>&nbsp;<span class="ident" id="3522771">io</span><span class="op" id="3522773">.</span><span class="ident" id="3522774">Writer</span><span class="op" id="3522780">)</span>&nbsp;<span class="op" id="3522782">(</span><span class="ident" id="3522783">f</span>&nbsp;<span class="op" id="3522785">*</span><span class="ident" id="3522786">os</span><span class="op" id="3522788">.</span><span class="ident" id="3522789">File</span><span class="op" id="3522793">,</span>&nbsp;<span class="ident" id="3522795">err</span>&nbsp;<span class="builtintype" id="3522799">error</span><span class="op" id="3522804">)</span>&nbsp;<span class="op" id="3522806">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522809">if</span>&nbsp;<span class="ident" id="3522812">w</span>&nbsp;<span class="op" id="3522814">==</span>&nbsp;<span class="ident" id="3522817">nil</span>&nbsp;<span class="op" id="3522821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522825">f</span><span class="op" id="3522826">,</span>&nbsp;<span class="ident" id="3522828">err</span>&nbsp;<span class="op" id="3522832">=</span>&nbsp;<span class="ident" id="3522834">os</span><span class="op" id="3522836">.</span><span class="ident" id="3522837">OpenFile</span><span class="op" id="3522845">(</span><span class="ident" id="3522846">os</span><span class="op" id="3522848">.</span><span class="ident" id="3522849">DevNull</span><span class="op" id="3522856">,</span>&nbsp;<span class="ident" id="3522858">os</span><span class="op" id="3522860">.</span><span class="ident" id="3522861">O_WRONLY</span><span class="op" id="3522869">,</span>&nbsp;<span class="num" id="3522871">0</span><span class="op" id="3522872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522876">if</span>&nbsp;<span class="ident" id="3522879">err</span>&nbsp;<span class="op" id="3522883">!=</span>&nbsp;<span class="ident" id="3522886">nil</span>&nbsp;<span class="op" id="3522890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522895">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522904">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3522908">c</span><span class="op" id="3522909">.</span><span class="ident" id="3522910">closeAfterStart</span>&nbsp;<span class="op" id="3522926">=</span>&nbsp;<span class="builtinfunc" id="3522928">append</span><span class="op" id="3522934">(</span><span class="ident" id="3522935">c</span><span class="op" id="3522936">.</span><span class="ident" id="3522937">closeAfterStart</span><span class="op" id="3522952">,</span>&nbsp;<span class="ident" id="3522954">f</span><span class="op" id="3522955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522959">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3522967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3522971">if</span>&nbsp;<span class="ident" id="3522974">f</span><span class="op" id="3522975">,</span>&nbsp;<span class="ident" id="3522977">ok</span>&nbsp;<span class="op" id="3522980">:=</span>&nbsp;<span class="ident" id="3522983">w</span><span class="op" id="3522984">.</span><span class="op" id="3522985">(</span><span class="op" id="3522986">*</span><span class="ident" id="3522987">os</span><span class="op" id="3522989">.</span><span class="ident" id="3522990">File</span><span class="op" id="3522994">)</span><span class="op" id="3522995">;</span>&nbsp;<span class="ident" id="3522997">ok</span>&nbsp;<span class="op" id="3523000">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523004">return</span>&nbsp;<span class="ident" id="3523011">f</span><span class="op" id="3523012">,</span>&nbsp;<span class="ident" id="3523014">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3523019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523023">pr</span><span class="op" id="3523025">,</span>&nbsp;<span class="ident" id="3523027">pw</span><span class="op" id="3523029">,</span>&nbsp;<span class="ident" id="3523031">err</span>&nbsp;<span class="op" id="3523035">:=</span>&nbsp;<span class="ident" id="3523038">os</span><span class="op" id="3523040">.</span><span class="ident" id="3523041">Pipe</span><span class="op" id="3523045">(</span><span class="op" id="3523046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523049">if</span>&nbsp;<span class="ident" id="3523052">err</span>&nbsp;<span class="op" id="3523056">!=</span>&nbsp;<span class="ident" id="3523059">nil</span>&nbsp;<span class="op" id="3523063">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523067">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3523075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523079">c</span><span class="op" id="3523080">.</span><span class="ident" id="3523081">closeAfterStart</span>&nbsp;<span class="op" id="3523097">=</span>&nbsp;<span class="builtinfunc" id="3523099">append</span><span class="op" id="3523105">(</span><span class="ident" id="3523106">c</span><span class="op" id="3523107">.</span><span class="ident" id="3523108">closeAfterStart</span><span class="op" id="3523123">,</span>&nbsp;<span class="ident" id="3523125">pw</span><span class="op" id="3523127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523130">c</span><span class="op" id="3523131">.</span><span class="ident" id="3523132">closeAfterWait</span>&nbsp;<span class="op" id="3523147">=</span>&nbsp;<span class="builtinfunc" id="3523149">append</span><span class="op" id="3523155">(</span><span class="ident" id="3523156">c</span><span class="op" id="3523157">.</span><span class="ident" id="3523158">closeAfterWait</span><span class="op" id="3523172">,</span>&nbsp;<span class="ident" id="3523174">pr</span><span class="op" id="3523176">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523179">c</span><span class="op" id="3523180">.</span><span class="ident" id="3523181">goroutine</span>&nbsp;<span class="op" id="3523191">=</span>&nbsp;<span class="builtinfunc" id="3523193">append</span><span class="op" id="3523199">(</span><span class="ident" id="3523200">c</span><span class="op" id="3523201">.</span><span class="ident" id="3523202">goroutine</span><span class="op" id="3523211">,</span>&nbsp;<span class="keyword" id="3523213">func</span><span class="op" id="3523217">(</span><span class="op" id="3523218">)</span>&nbsp;<span class="builtintype" id="3523220">error</span>&nbsp;<span class="op" id="3523226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523230">_</span><span class="op" id="3523231">,</span>&nbsp;<span class="ident" id="3523233">err</span>&nbsp;<span class="op" id="3523237">:=</span>&nbsp;<span class="ident" id="3523240">io</span><span class="op" id="3523242">.</span><span class="ident" id="3523243">Copy</span><span class="op" id="3523247">(</span><span class="ident" id="3523248">w</span><span class="op" id="3523249">,</span>&nbsp;<span class="ident" id="3523251">pr</span><span class="op" id="3523253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523257">return</span>&nbsp;<span class="ident" id="3523264">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3523269">}</span><span class="op" id="3523270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523273">return</span>&nbsp;<span class="ident" id="3523280">pw</span><span class="op" id="3523282">,</span>&nbsp;<span class="ident" id="3523284">nil</span><br>
<span class="lineno">225</span><span class="op" id="3523288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3523291">func</span>&nbsp;<span class="op" id="3523296">(</span><span class="ident" id="3523297">c</span>&nbsp;<span class="op" id="3523299">*</span><span class="ident" id="3523300">Cmd</span><span class="op" id="3523303">)</span>&nbsp;<span class="ident" id="3523305">closeDescriptors</span><span class="op" id="3523321">(</span><span class="ident" id="3523322">closers</span>&nbsp;<span class="op" id="3523330">[</span><span class="op" id="3523331">]</span><span class="ident" id="3523332">io</span><span class="op" id="3523334">.</span><span class="ident" id="3523335">Closer</span><span class="op" id="3523341">)</span>&nbsp;<span class="op" id="3523343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523346">for</span>&nbsp;<span class="ident" id="3523350">_</span><span class="op" id="3523351">,</span>&nbsp;<span class="ident" id="3523353">fd</span>&nbsp;<span class="op" id="3523356">:=</span>&nbsp;<span class="keyword" id="3523359">range</span>&nbsp;<span class="ident" id="3523365">closers</span>&nbsp;<span class="op" id="3523373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3523377">fd</span><span class="op" id="3523379">.</span><span class="ident" id="3523380">Close</span><span class="op" id="3523385">(</span><span class="op" id="3523386">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3523389">}</span><br>
<span class="lineno"></span><span class="op" id="3523391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3523394">//&nbsp;Run&nbsp;starts&nbsp;the&nbsp;specified&nbsp;command&nbsp;and&nbsp;waits&nbsp;for&nbsp;it&nbsp;to&nbsp;complete.</span><br>
<span class="lineno"></span><span class="comment" id="3523460">//</span><br>
<span class="lineno">235</span><span class="comment" id="3523463">//&nbsp;The&nbsp;returned&nbsp;error&nbsp;is&nbsp;nil&nbsp;if&nbsp;the&nbsp;command&nbsp;runs,&nbsp;has&nbsp;no&nbsp;problems</span><br>
<span class="lineno"></span><span class="comment" id="3523529">//&nbsp;copying&nbsp;stdin,&nbsp;stdout,&nbsp;and&nbsp;stderr,&nbsp;and&nbsp;exits&nbsp;with&nbsp;a&nbsp;zero&nbsp;exit</span><br>
<span class="lineno"></span><span class="comment" id="3523594">//&nbsp;status.</span><br>
<span class="lineno"></span><span class="comment" id="3523605">//</span><br>
<span class="lineno"></span><span class="comment" id="3523608">//&nbsp;If&nbsp;the&nbsp;command&nbsp;fails&nbsp;to&nbsp;run&nbsp;or&nbsp;doesn&#39;t&nbsp;complete&nbsp;successfully,&nbsp;the</span><br>
<span class="lineno">240</span><span class="comment" id="3523677">//&nbsp;error&nbsp;is&nbsp;of&nbsp;type&nbsp;*ExitError.&nbsp;Other&nbsp;error&nbsp;types&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3523734">//&nbsp;returned&nbsp;for&nbsp;I/O&nbsp;problems.</span><br>
<span class="lineno"></span><span class="keyword" id="3523764">func</span>&nbsp;<span class="op" id="3523769">(</span><span class="ident" id="3523770">c</span>&nbsp;<span class="op" id="3523772">*</span><span class="ident" id="3523773">Cmd</span><span class="op" id="3523776">)</span>&nbsp;<span class="ident" id="3523778">Run</span><span class="op" id="3523781">(</span><span class="op" id="3523782">)</span>&nbsp;<span class="builtintype" id="3523784">error</span>&nbsp;<span class="op" id="3523790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523793">if</span>&nbsp;<span class="ident" id="3523796">err</span>&nbsp;<span class="op" id="3523800">:=</span>&nbsp;<span class="ident" id="3523803">c</span><span class="op" id="3523804">.</span><span class="ident" id="3523805">Start</span><span class="op" id="3523810">(</span><span class="op" id="3523811">)</span><span class="op" id="3523812">;</span>&nbsp;<span class="ident" id="3523814">err</span>&nbsp;<span class="op" id="3523818">!=</span>&nbsp;<span class="ident" id="3523821">nil</span>&nbsp;<span class="op" id="3523825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523829">return</span>&nbsp;<span class="ident" id="3523836">err</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3523841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3523844">return</span>&nbsp;<span class="ident" id="3523851">c</span><span class="op" id="3523852">.</span><span class="ident" id="3523853">Wait</span><span class="op" id="3523857">(</span><span class="op" id="3523858">)</span><br>
<span class="lineno"></span><span class="op" id="3523860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3523863">//&nbsp;lookExtensions&nbsp;finds&nbsp;windows&nbsp;executable&nbsp;by&nbsp;its&nbsp;dir&nbsp;and&nbsp;path.</span><br>
<span class="lineno">250</span><span class="comment" id="3523927">//&nbsp;It&nbsp;uses&nbsp;LookPath&nbsp;to&nbsp;try&nbsp;appropriate&nbsp;extensions.</span><br>
<span class="lineno"></span><span class="comment" id="3523978">//&nbsp;lookExtensions&nbsp;does&nbsp;not&nbsp;search&nbsp;PATH,&nbsp;instead&nbsp;it&nbsp;converts&nbsp;`prog`&nbsp;into&nbsp;`.\prog`.</span><br>
<span class="lineno"></span><span class="keyword" id="3524060">func</span>&nbsp;<span class="ident" id="3524065">lookExtensions</span><span class="op" id="3524079">(</span><span class="ident" id="3524080">path</span><span class="op" id="3524084">,</span>&nbsp;<span class="ident" id="3524086">dir</span>&nbsp;<span class="builtintype" id="3524090">string</span><span class="op" id="3524096">)</span>&nbsp;<span class="op" id="3524098">(</span><span class="builtintype" id="3524099">string</span><span class="op" id="3524105">,</span>&nbsp;<span class="builtintype" id="3524107">error</span><span class="op" id="3524112">)</span>&nbsp;<span class="op" id="3524114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524117">if</span>&nbsp;<span class="ident" id="3524120">filepath</span><span class="op" id="3524128">.</span><span class="ident" id="3524129">Base</span><span class="op" id="3524133">(</span><span class="ident" id="3524134">path</span><span class="op" id="3524138">)</span>&nbsp;<span class="op" id="3524140">==</span>&nbsp;<span class="ident" id="3524143">path</span>&nbsp;<span class="op" id="3524148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524152">path</span>&nbsp;<span class="op" id="3524157">=</span>&nbsp;<span class="ident" id="3524159">filepath</span><span class="op" id="3524167">.</span><span class="ident" id="3524168">Join</span><span class="op" id="3524172">(</span><span class="string" id="3524173">&#34;.&#34;</span><span class="op" id="3524176">,</span>&nbsp;<span class="ident" id="3524178">path</span><span class="op" id="3524182">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3524185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524188">if</span>&nbsp;<span class="ident" id="3524191">dir</span>&nbsp;<span class="op" id="3524195">==</span>&nbsp;<span class="string" id="3524198">&#34;&#34;</span>&nbsp;<span class="op" id="3524201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524205">return</span>&nbsp;<span class="ident" id="3524212">LookPath</span><span class="op" id="3524220">(</span><span class="ident" id="3524221">path</span><span class="op" id="3524225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3524228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524231">if</span>&nbsp;<span class="ident" id="3524234">filepath</span><span class="op" id="3524242">.</span><span class="ident" id="3524243">VolumeName</span><span class="op" id="3524253">(</span><span class="ident" id="3524254">path</span><span class="op" id="3524258">)</span>&nbsp;<span class="op" id="3524260">!=</span>&nbsp;<span class="string" id="3524263">&#34;&#34;</span>&nbsp;<span class="op" id="3524266">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524270">return</span>&nbsp;<span class="ident" id="3524277">LookPath</span><span class="op" id="3524285">(</span><span class="ident" id="3524286">path</span><span class="op" id="3524290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3524293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524296">if</span>&nbsp;<span class="builtinfunc" id="3524299">len</span><span class="op" id="3524302">(</span><span class="ident" id="3524303">path</span><span class="op" id="3524307">)</span>&nbsp;<span class="op" id="3524309">&gt;</span>&nbsp;<span class="num" id="3524311">1</span>&nbsp;<span class="op" id="3524313">&amp;&amp;</span>&nbsp;<span class="ident" id="3524316">os</span><span class="op" id="3524318">.</span><span class="ident" id="3524319">IsPathSeparator</span><span class="op" id="3524334">(</span><span class="ident" id="3524335">path</span><span class="op" id="3524339">[</span><span class="num" id="3524340">0</span><span class="op" id="3524341">]</span><span class="op" id="3524342">)</span>&nbsp;<span class="op" id="3524344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524348">return</span>&nbsp;<span class="ident" id="3524355">LookPath</span><span class="op" id="3524363">(</span><span class="ident" id="3524364">path</span><span class="op" id="3524368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3524371">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524374">dirandpath</span>&nbsp;<span class="op" id="3524385">:=</span>&nbsp;<span class="ident" id="3524388">filepath</span><span class="op" id="3524396">.</span><span class="ident" id="3524397">Join</span><span class="op" id="3524401">(</span><span class="ident" id="3524402">dir</span><span class="op" id="3524405">,</span>&nbsp;<span class="ident" id="3524407">path</span><span class="op" id="3524411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3524414">//&nbsp;We&nbsp;assume&nbsp;that&nbsp;LookPath&nbsp;will&nbsp;only&nbsp;add&nbsp;file&nbsp;extension.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524472">lp</span><span class="op" id="3524474">,</span>&nbsp;<span class="ident" id="3524476">err</span>&nbsp;<span class="op" id="3524480">:=</span>&nbsp;<span class="ident" id="3524483">LookPath</span><span class="op" id="3524491">(</span><span class="ident" id="3524492">dirandpath</span><span class="op" id="3524502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524505">if</span>&nbsp;<span class="ident" id="3524508">err</span>&nbsp;<span class="op" id="3524512">!=</span>&nbsp;<span class="ident" id="3524515">nil</span>&nbsp;<span class="op" id="3524519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524523">return</span>&nbsp;<span class="string" id="3524530">&#34;&#34;</span><span class="op" id="3524532">,</span>&nbsp;<span class="ident" id="3524534">err</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3524539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524542">ext</span>&nbsp;<span class="op" id="3524546">:=</span>&nbsp;<span class="ident" id="3524549">strings</span><span class="op" id="3524556">.</span><span class="ident" id="3524557">TrimPrefix</span><span class="op" id="3524567">(</span><span class="ident" id="3524568">lp</span><span class="op" id="3524570">,</span>&nbsp;<span class="ident" id="3524572">dirandpath</span><span class="op" id="3524582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524585">return</span>&nbsp;<span class="ident" id="3524592">path</span>&nbsp;<span class="op" id="3524597">+</span>&nbsp;<span class="ident" id="3524599">ext</span><span class="op" id="3524602">,</span>&nbsp;<span class="ident" id="3524604">nil</span><br>
<span class="lineno"></span><span class="op" id="3524608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="comment" id="3524611">//&nbsp;Start&nbsp;starts&nbsp;the&nbsp;specified&nbsp;command&nbsp;but&nbsp;does&nbsp;not&nbsp;wait&nbsp;for&nbsp;it&nbsp;to&nbsp;complete.</span><br>
<span class="lineno"></span><span class="comment" id="3524687">//</span><br>
<span class="lineno"></span><span class="comment" id="3524690">//&nbsp;The&nbsp;Wait&nbsp;method&nbsp;will&nbsp;return&nbsp;the&nbsp;exit&nbsp;code&nbsp;and&nbsp;release&nbsp;associated&nbsp;resources</span><br>
<span class="lineno"></span><span class="comment" id="3524768">//&nbsp;once&nbsp;the&nbsp;command&nbsp;exits.</span><br>
<span class="lineno"></span><span class="keyword" id="3524795">func</span>&nbsp;<span class="op" id="3524800">(</span><span class="ident" id="3524801">c</span>&nbsp;<span class="op" id="3524803">*</span><span class="ident" id="3524804">Cmd</span><span class="op" id="3524807">)</span>&nbsp;<span class="ident" id="3524809">Start</span><span class="op" id="3524814">(</span><span class="op" id="3524815">)</span>&nbsp;<span class="builtintype" id="3524817">error</span>&nbsp;<span class="op" id="3524823">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524826">if</span>&nbsp;<span class="ident" id="3524829">c</span><span class="op" id="3524830">.</span><span class="ident" id="3524831">lookPathErr</span>&nbsp;<span class="op" id="3524843">!=</span>&nbsp;<span class="ident" id="3524846">nil</span>&nbsp;<span class="op" id="3524850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524854">c</span><span class="op" id="3524855">.</span><span class="ident" id="3524856">closeDescriptors</span><span class="op" id="3524872">(</span><span class="ident" id="3524873">c</span><span class="op" id="3524874">.</span><span class="ident" id="3524875">closeAfterStart</span><span class="op" id="3524890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524894">c</span><span class="op" id="3524895">.</span><span class="ident" id="3524896">closeDescriptors</span><span class="op" id="3524912">(</span><span class="ident" id="3524913">c</span><span class="op" id="3524914">.</span><span class="ident" id="3524915">closeAfterWait</span><span class="op" id="3524929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524933">return</span>&nbsp;<span class="ident" id="3524940">c</span><span class="op" id="3524941">.</span><span class="ident" id="3524942">lookPathErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3524955">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3524958">if</span>&nbsp;<span class="ident" id="3524961">runtime</span><span class="op" id="3524968">.</span><span class="ident" id="3524969">GOOS</span>&nbsp;<span class="op" id="3524974">==</span>&nbsp;<span class="string" id="3524977">&#34;windows&#34;</span>&nbsp;<span class="op" id="3524987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3524991">lp</span><span class="op" id="3524993">,</span>&nbsp;<span class="ident" id="3524995">err</span>&nbsp;<span class="op" id="3524999">:=</span>&nbsp;<span class="ident" id="3525002">lookExtensions</span><span class="op" id="3525016">(</span><span class="ident" id="3525017">c</span><span class="op" id="3525018">.</span><span class="ident" id="3525019">Path</span><span class="op" id="3525023">,</span>&nbsp;<span class="ident" id="3525025">c</span><span class="op" id="3525026">.</span><span class="ident" id="3525027">Dir</span><span class="op" id="3525030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525034">if</span>&nbsp;<span class="ident" id="3525037">err</span>&nbsp;<span class="op" id="3525041">!=</span>&nbsp;<span class="ident" id="3525044">nil</span>&nbsp;<span class="op" id="3525048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525053">c</span><span class="op" id="3525054">.</span><span class="ident" id="3525055">closeDescriptors</span><span class="op" id="3525071">(</span><span class="ident" id="3525072">c</span><span class="op" id="3525073">.</span><span class="ident" id="3525074">closeAfterStart</span><span class="op" id="3525089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525094">c</span><span class="op" id="3525095">.</span><span class="ident" id="3525096">closeDescriptors</span><span class="op" id="3525112">(</span><span class="ident" id="3525113">c</span><span class="op" id="3525114">.</span><span class="ident" id="3525115">closeAfterWait</span><span class="op" id="3525129">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525134">return</span>&nbsp;<span class="ident" id="3525141">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3525147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525151">c</span><span class="op" id="3525152">.</span><span class="ident" id="3525153">Path</span>&nbsp;<span class="op" id="3525158">=</span>&nbsp;<span class="ident" id="3525160">lp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3525164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525167">if</span>&nbsp;<span class="ident" id="3525170">c</span><span class="op" id="3525171">.</span><span class="ident" id="3525172">Process</span>&nbsp;<span class="op" id="3525180">!=</span>&nbsp;<span class="ident" id="3525183">nil</span>&nbsp;<span class="op" id="3525187">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525191">return</span>&nbsp;<span class="ident" id="3525198">errors</span><span class="op" id="3525204">.</span><span class="ident" id="3525205">New</span><span class="op" id="3525208">(</span><span class="string" id="3525209">&#34;exec:&nbsp;already&nbsp;started&#34;</span><span class="op" id="3525232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3525235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525239">type</span>&nbsp;<span class="ident" id="3525244">F</span>&nbsp;<span class="keyword" id="3525246">func</span><span class="op" id="3525250">(</span><span class="op" id="3525251">*</span><span class="ident" id="3525252">Cmd</span><span class="op" id="3525255">)</span>&nbsp;<span class="op" id="3525257">(</span><span class="op" id="3525258">*</span><span class="ident" id="3525259">os</span><span class="op" id="3525261">.</span><span class="ident" id="3525262">File</span><span class="op" id="3525266">,</span>&nbsp;<span class="builtintype" id="3525268">error</span><span class="op" id="3525273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525276">for</span>&nbsp;<span class="ident" id="3525280">_</span><span class="op" id="3525281">,</span>&nbsp;<span class="ident" id="3525283">setupFd</span>&nbsp;<span class="op" id="3525291">:=</span>&nbsp;<span class="keyword" id="3525294">range</span>&nbsp;<span class="op" id="3525300">[</span><span class="op" id="3525301">]</span><span class="ident" id="3525302">F</span><span class="op" id="3525303">{</span><span class="op" id="3525304">(</span><span class="op" id="3525305">*</span><span class="ident" id="3525306">Cmd</span><span class="op" id="3525309">)</span><span class="op" id="3525310">.</span><span class="ident" id="3525311">stdin</span><span class="op" id="3525316">,</span>&nbsp;<span class="op" id="3525318">(</span><span class="op" id="3525319">*</span><span class="ident" id="3525320">Cmd</span><span class="op" id="3525323">)</span><span class="op" id="3525324">.</span><span class="ident" id="3525325">stdout</span><span class="op" id="3525331">,</span>&nbsp;<span class="op" id="3525333">(</span><span class="op" id="3525334">*</span><span class="ident" id="3525335">Cmd</span><span class="op" id="3525338">)</span><span class="op" id="3525339">.</span><span class="ident" id="3525340">stderr</span><span class="op" id="3525346">}</span>&nbsp;<span class="op" id="3525348">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525352">fd</span><span class="op" id="3525354">,</span>&nbsp;<span class="ident" id="3525356">err</span>&nbsp;<span class="op" id="3525360">:=</span>&nbsp;<span class="ident" id="3525363">setupFd</span><span class="op" id="3525370">(</span><span class="ident" id="3525371">c</span><span class="op" id="3525372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525376">if</span>&nbsp;<span class="ident" id="3525379">err</span>&nbsp;<span class="op" id="3525383">!=</span>&nbsp;<span class="ident" id="3525386">nil</span>&nbsp;<span class="op" id="3525390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525395">c</span><span class="op" id="3525396">.</span><span class="ident" id="3525397">closeDescriptors</span><span class="op" id="3525413">(</span><span class="ident" id="3525414">c</span><span class="op" id="3525415">.</span><span class="ident" id="3525416">closeAfterStart</span><span class="op" id="3525431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525436">c</span><span class="op" id="3525437">.</span><span class="ident" id="3525438">closeDescriptors</span><span class="op" id="3525454">(</span><span class="ident" id="3525455">c</span><span class="op" id="3525456">.</span><span class="ident" id="3525457">closeAfterWait</span><span class="op" id="3525471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525476">return</span>&nbsp;<span class="ident" id="3525483">err</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3525489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525493">c</span><span class="op" id="3525494">.</span><span class="ident" id="3525495">childFiles</span>&nbsp;<span class="op" id="3525506">=</span>&nbsp;<span class="builtinfunc" id="3525508">append</span><span class="op" id="3525514">(</span><span class="ident" id="3525515">c</span><span class="op" id="3525516">.</span><span class="ident" id="3525517">childFiles</span><span class="op" id="3525527">,</span>&nbsp;<span class="ident" id="3525529">fd</span><span class="op" id="3525531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3525534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525537">c</span><span class="op" id="3525538">.</span><span class="ident" id="3525539">childFiles</span>&nbsp;<span class="op" id="3525550">=</span>&nbsp;<span class="builtinfunc" id="3525552">append</span><span class="op" id="3525558">(</span><span class="ident" id="3525559">c</span><span class="op" id="3525560">.</span><span class="ident" id="3525561">childFiles</span><span class="op" id="3525571">,</span>&nbsp;<span class="ident" id="3525573">c</span><span class="op" id="3525574">.</span><span class="ident" id="3525575">ExtraFiles</span><span class="op" id="3525585">...</span><span class="op" id="3525588">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525592">var</span>&nbsp;<span class="ident" id="3525596">err</span>&nbsp;<span class="builtintype" id="3525600">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525607">c</span><span class="op" id="3525608">.</span><span class="ident" id="3525609">Process</span><span class="op" id="3525616">,</span>&nbsp;<span class="ident" id="3525618">err</span>&nbsp;<span class="op" id="3525622">=</span>&nbsp;<span class="ident" id="3525624">os</span><span class="op" id="3525626">.</span><span class="ident" id="3525627">StartProcess</span><span class="op" id="3525639">(</span><span class="ident" id="3525640">c</span><span class="op" id="3525641">.</span><span class="ident" id="3525642">Path</span><span class="op" id="3525646">,</span>&nbsp;<span class="ident" id="3525648">c</span><span class="op" id="3525649">.</span><span class="ident" id="3525650">argv</span><span class="op" id="3525654">(</span><span class="op" id="3525655">)</span><span class="op" id="3525656">,</span>&nbsp;<span class="op" id="3525658">&amp;</span><span class="ident" id="3525659">os</span><span class="op" id="3525661">.</span><span class="ident" id="3525662">ProcAttr</span><span class="op" id="3525670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525674">Dir</span><span class="op" id="3525677">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3525681">c</span><span class="op" id="3525682">.</span><span class="ident" id="3525683">Dir</span><span class="op" id="3525686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525690">Files</span><span class="op" id="3525695">:</span>&nbsp;<span class="ident" id="3525697">c</span><span class="op" id="3525698">.</span><span class="ident" id="3525699">childFiles</span><span class="op" id="3525709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525713">Env</span><span class="op" id="3525716">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3525720">c</span><span class="op" id="3525721">.</span><span class="ident" id="3525722">envv</span><span class="op" id="3525726">(</span><span class="op" id="3525727">)</span><span class="op" id="3525728">,</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525732">Sys</span><span class="op" id="3525735">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3525739">c</span><span class="op" id="3525740">.</span><span class="ident" id="3525741">SysProcAttr</span><span class="op" id="3525752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3525755">}</span><span class="op" id="3525756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525759">if</span>&nbsp;<span class="ident" id="3525762">err</span>&nbsp;<span class="op" id="3525766">!=</span>&nbsp;<span class="ident" id="3525769">nil</span>&nbsp;<span class="op" id="3525773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525777">c</span><span class="op" id="3525778">.</span><span class="ident" id="3525779">closeDescriptors</span><span class="op" id="3525795">(</span><span class="ident" id="3525796">c</span><span class="op" id="3525797">.</span><span class="ident" id="3525798">closeAfterStart</span><span class="op" id="3525813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525817">c</span><span class="op" id="3525818">.</span><span class="ident" id="3525819">closeDescriptors</span><span class="op" id="3525835">(</span><span class="ident" id="3525836">c</span><span class="op" id="3525837">.</span><span class="ident" id="3525838">closeAfterWait</span><span class="op" id="3525852">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525856">return</span>&nbsp;<span class="ident" id="3525863">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3525868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525872">c</span><span class="op" id="3525873">.</span><span class="ident" id="3525874">closeDescriptors</span><span class="op" id="3525890">(</span><span class="ident" id="3525891">c</span><span class="op" id="3525892">.</span><span class="ident" id="3525893">closeAfterStart</span><span class="op" id="3525908">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3525912">c</span><span class="op" id="3525913">.</span><span class="ident" id="3525914">errch</span>&nbsp;<span class="op" id="3525920">=</span>&nbsp;<span class="builtinfunc" id="3525922">make</span><span class="op" id="3525926">(</span><span class="keyword" id="3525927">chan</span>&nbsp;<span class="builtintype" id="3525932">error</span><span class="op" id="3525937">,</span>&nbsp;<span class="builtinfunc" id="3525939">len</span><span class="op" id="3525942">(</span><span class="ident" id="3525943">c</span><span class="op" id="3525944">.</span><span class="ident" id="3525945">goroutine</span><span class="op" id="3525954">)</span><span class="op" id="3525955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525958">for</span>&nbsp;<span class="ident" id="3525962">_</span><span class="op" id="3525963">,</span>&nbsp;<span class="ident" id="3525965">fn</span>&nbsp;<span class="op" id="3525968">:=</span>&nbsp;<span class="keyword" id="3525971">range</span>&nbsp;<span class="ident" id="3525977">c</span><span class="op" id="3525978">.</span><span class="ident" id="3525979">goroutine</span>&nbsp;<span class="op" id="3525989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3525993">go</span>&nbsp;<span class="keyword" id="3525996">func</span><span class="op" id="3526000">(</span><span class="ident" id="3526001">fn</span>&nbsp;<span class="keyword" id="3526004">func</span><span class="op" id="3526008">(</span><span class="op" id="3526009">)</span>&nbsp;<span class="builtintype" id="3526011">error</span><span class="op" id="3526016">)</span>&nbsp;<span class="op" id="3526018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526023">c</span><span class="op" id="3526024">.</span><span class="ident" id="3526025">errch</span>&nbsp;<span class="op" id="3526031">&lt;-</span>&nbsp;<span class="ident" id="3526034">fn</span><span class="op" id="3526036">(</span><span class="op" id="3526037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3526041">}</span><span class="op" id="3526042">(</span><span class="ident" id="3526043">fn</span><span class="op" id="3526045">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3526048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526052">return</span>&nbsp;<span class="ident" id="3526059">nil</span><br>
<span class="lineno"></span><span class="op" id="3526063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="3526066">//&nbsp;An&nbsp;ExitError&nbsp;reports&nbsp;an&nbsp;unsuccessful&nbsp;exit&nbsp;by&nbsp;a&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="3526125">type</span>&nbsp;<span class="ident" id="3526130">ExitError</span>&nbsp;<span class="keyword" id="3526140">struct</span>&nbsp;<span class="op" id="3526147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3526150">*</span><span class="ident" id="3526151">os</span><span class="op" id="3526153">.</span><span class="ident" id="3526154">ProcessState</span><br>
<span class="lineno"></span><span class="op" id="3526167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="3526170">func</span>&nbsp;<span class="op" id="3526175">(</span><span class="ident" id="3526176">e</span>&nbsp;<span class="op" id="3526178">*</span><span class="ident" id="3526179">ExitError</span><span class="op" id="3526188">)</span>&nbsp;<span class="ident" id="3526190">Error</span><span class="op" id="3526195">(</span><span class="op" id="3526196">)</span>&nbsp;<span class="builtintype" id="3526198">string</span>&nbsp;<span class="op" id="3526205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526208">return</span>&nbsp;<span class="ident" id="3526215">e</span><span class="op" id="3526216">.</span><span class="ident" id="3526217">ProcessState</span><span class="op" id="3526229">.</span><span class="ident" id="3526230">String</span><span class="op" id="3526236">(</span><span class="op" id="3526237">)</span><br>
<span class="lineno"></span><span class="op" id="3526239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3526242">//&nbsp;Wait&nbsp;waits&nbsp;for&nbsp;the&nbsp;command&nbsp;to&nbsp;exit.</span><br>
<span class="lineno">345</span><span class="comment" id="3526281">//&nbsp;It&nbsp;must&nbsp;have&nbsp;been&nbsp;started&nbsp;by&nbsp;Start.</span><br>
<span class="lineno"></span><span class="comment" id="3526320">//</span><br>
<span class="lineno"></span><span class="comment" id="3526323">//&nbsp;The&nbsp;returned&nbsp;error&nbsp;is&nbsp;nil&nbsp;if&nbsp;the&nbsp;command&nbsp;runs,&nbsp;has&nbsp;no&nbsp;problems</span><br>
<span class="lineno"></span><span class="comment" id="3526389">//&nbsp;copying&nbsp;stdin,&nbsp;stdout,&nbsp;and&nbsp;stderr,&nbsp;and&nbsp;exits&nbsp;with&nbsp;a&nbsp;zero&nbsp;exit</span><br>
<span class="lineno"></span><span class="comment" id="3526454">//&nbsp;status.</span><br>
<span class="lineno">350</span><span class="comment" id="3526465">//</span><br>
<span class="lineno"></span><span class="comment" id="3526468">//&nbsp;If&nbsp;the&nbsp;command&nbsp;fails&nbsp;to&nbsp;run&nbsp;or&nbsp;doesn&#39;t&nbsp;complete&nbsp;successfully,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3526537">//&nbsp;error&nbsp;is&nbsp;of&nbsp;type&nbsp;*ExitError.&nbsp;Other&nbsp;error&nbsp;types&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3526594">//&nbsp;returned&nbsp;for&nbsp;I/O&nbsp;problems.</span><br>
<span class="lineno"></span><span class="comment" id="3526624">//</span><br>
<span class="lineno">355</span><span class="comment" id="3526627">//&nbsp;Wait&nbsp;releases&nbsp;any&nbsp;resources&nbsp;associated&nbsp;with&nbsp;the&nbsp;Cmd.</span><br>
<span class="lineno"></span><span class="keyword" id="3526683">func</span>&nbsp;<span class="op" id="3526688">(</span><span class="ident" id="3526689">c</span>&nbsp;<span class="op" id="3526691">*</span><span class="ident" id="3526692">Cmd</span><span class="op" id="3526695">)</span>&nbsp;<span class="ident" id="3526697">Wait</span><span class="op" id="3526701">(</span><span class="op" id="3526702">)</span>&nbsp;<span class="builtintype" id="3526704">error</span>&nbsp;<span class="op" id="3526710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526713">if</span>&nbsp;<span class="ident" id="3526716">c</span><span class="op" id="3526717">.</span><span class="ident" id="3526718">Process</span>&nbsp;<span class="op" id="3526726">==</span>&nbsp;<span class="ident" id="3526729">nil</span>&nbsp;<span class="op" id="3526733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526737">return</span>&nbsp;<span class="ident" id="3526744">errors</span><span class="op" id="3526750">.</span><span class="ident" id="3526751">New</span><span class="op" id="3526754">(</span><span class="string" id="3526755">&#34;exec:&nbsp;not&nbsp;started&#34;</span><span class="op" id="3526774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3526777">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526780">if</span>&nbsp;<span class="ident" id="3526783">c</span><span class="op" id="3526784">.</span><span class="ident" id="3526785">finished</span>&nbsp;<span class="op" id="3526794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526798">return</span>&nbsp;<span class="ident" id="3526805">errors</span><span class="op" id="3526811">.</span><span class="ident" id="3526812">New</span><span class="op" id="3526815">(</span><span class="string" id="3526816">&#34;exec:&nbsp;Wait&nbsp;was&nbsp;already&nbsp;called&#34;</span><span class="op" id="3526847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3526850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526853">c</span><span class="op" id="3526854">.</span><span class="ident" id="3526855">finished</span>&nbsp;<span class="op" id="3526864">=</span>&nbsp;<span class="builtintype" id="3526866">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526872">state</span><span class="op" id="3526877">,</span>&nbsp;<span class="ident" id="3526879">err</span>&nbsp;<span class="op" id="3526883">:=</span>&nbsp;<span class="ident" id="3526886">c</span><span class="op" id="3526887">.</span><span class="ident" id="3526888">Process</span><span class="op" id="3526895">.</span><span class="ident" id="3526896">Wait</span><span class="op" id="3526900">(</span><span class="op" id="3526901">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3526904">c</span><span class="op" id="3526905">.</span><span class="ident" id="3526906">ProcessState</span>&nbsp;<span class="op" id="3526919">=</span>&nbsp;<span class="ident" id="3526921">state</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526929">var</span>&nbsp;<span class="ident" id="3526933">copyError</span>&nbsp;<span class="builtintype" id="3526943">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526950">for</span>&nbsp;<span class="keyword" id="3526954">range</span>&nbsp;<span class="ident" id="3526960">c</span><span class="op" id="3526961">.</span><span class="ident" id="3526962">goroutine</span>&nbsp;<span class="op" id="3526972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3526976">if</span>&nbsp;<span class="ident" id="3526979">err</span>&nbsp;<span class="op" id="3526983">:=</span>&nbsp;<span class="op" id="3526986">&lt;-</span><span class="ident" id="3526988">c</span><span class="op" id="3526989">.</span><span class="ident" id="3526990">errch</span><span class="op" id="3526995">;</span>&nbsp;<span class="ident" id="3526997">err</span>&nbsp;<span class="op" id="3527001">!=</span>&nbsp;<span class="ident" id="3527004">nil</span>&nbsp;<span class="op" id="3527008">&amp;&amp;</span>&nbsp;<span class="ident" id="3527011">copyError</span>&nbsp;<span class="op" id="3527021">==</span>&nbsp;<span class="ident" id="3527024">nil</span>&nbsp;<span class="op" id="3527028">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3527033">copyError</span>&nbsp;<span class="op" id="3527043">=</span>&nbsp;<span class="ident" id="3527045">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3527051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3527054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3527058">c</span><span class="op" id="3527059">.</span><span class="ident" id="3527060">closeDescriptors</span><span class="op" id="3527076">(</span><span class="ident" id="3527077">c</span><span class="op" id="3527078">.</span><span class="ident" id="3527079">closeAfterWait</span><span class="op" id="3527093">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527097">if</span>&nbsp;<span class="ident" id="3527100">err</span>&nbsp;<span class="op" id="3527104">!=</span>&nbsp;<span class="ident" id="3527107">nil</span>&nbsp;<span class="op" id="3527111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527115">return</span>&nbsp;<span class="ident" id="3527122">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3527127">}</span>&nbsp;<span class="keyword" id="3527129">else</span>&nbsp;<span class="keyword" id="3527134">if</span>&nbsp;<span class="op" id="3527137">!</span><span class="ident" id="3527138">state</span><span class="op" id="3527143">.</span><span class="ident" id="3527144">Success</span><span class="op" id="3527151">(</span><span class="op" id="3527152">)</span>&nbsp;<span class="op" id="3527154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527158">return</span>&nbsp;<span class="op" id="3527165">&amp;</span><span class="ident" id="3527166">ExitError</span><span class="op" id="3527175">{</span><span class="ident" id="3527176">state</span><span class="op" id="3527181">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3527184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527188">return</span>&nbsp;<span class="ident" id="3527195">copyError</span><br>
<span class="lineno"></span><span class="op" id="3527205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="3527208">//&nbsp;Output&nbsp;runs&nbsp;the&nbsp;command&nbsp;and&nbsp;returns&nbsp;its&nbsp;standard&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="3527268">func</span>&nbsp;<span class="op" id="3527273">(</span><span class="ident" id="3527274">c</span>&nbsp;<span class="op" id="3527276">*</span><span class="ident" id="3527277">Cmd</span><span class="op" id="3527280">)</span>&nbsp;<span class="ident" id="3527282">Output</span><span class="op" id="3527288">(</span><span class="op" id="3527289">)</span>&nbsp;<span class="op" id="3527291">(</span><span class="op" id="3527292">[</span><span class="op" id="3527293">]</span><span class="builtintype" id="3527294">byte</span><span class="op" id="3527298">,</span>&nbsp;<span class="builtintype" id="3527300">error</span><span class="op" id="3527305">)</span>&nbsp;<span class="op" id="3527307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527310">if</span>&nbsp;<span class="ident" id="3527313">c</span><span class="op" id="3527314">.</span><span class="ident" id="3527315">Stdout</span>&nbsp;<span class="op" id="3527322">!=</span>&nbsp;<span class="ident" id="3527325">nil</span>&nbsp;<span class="op" id="3527329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527333">return</span>&nbsp;<span class="ident" id="3527340">nil</span><span class="op" id="3527343">,</span>&nbsp;<span class="ident" id="3527345">errors</span><span class="op" id="3527351">.</span><span class="ident" id="3527352">New</span><span class="op" id="3527355">(</span><span class="string" id="3527356">&#34;exec:&nbsp;Stdout&nbsp;already&nbsp;set&#34;</span><span class="op" id="3527382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3527385">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527388">var</span>&nbsp;<span class="ident" id="3527392">b</span>&nbsp;<span class="ident" id="3527394">bytes</span><span class="op" id="3527399">.</span><span class="ident" id="3527400">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3527408">c</span><span class="op" id="3527409">.</span><span class="ident" id="3527410">Stdout</span>&nbsp;<span class="op" id="3527417">=</span>&nbsp;<span class="op" id="3527419">&amp;</span><span class="ident" id="3527420">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3527423">err</span>&nbsp;<span class="op" id="3527427">:=</span>&nbsp;<span class="ident" id="3527430">c</span><span class="op" id="3527431">.</span><span class="ident" id="3527432">Run</span><span class="op" id="3527435">(</span><span class="op" id="3527436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527439">return</span>&nbsp;<span class="ident" id="3527446">b</span><span class="op" id="3527447">.</span><span class="ident" id="3527448">Bytes</span><span class="op" id="3527453">(</span><span class="op" id="3527454">)</span><span class="op" id="3527455">,</span>&nbsp;<span class="ident" id="3527457">err</span><br>
<span class="lineno"></span><span class="op" id="3527461">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="3527464">//&nbsp;CombinedOutput&nbsp;runs&nbsp;the&nbsp;command&nbsp;and&nbsp;returns&nbsp;its&nbsp;combined&nbsp;standard</span><br>
<span class="lineno"></span><span class="comment" id="3527533">//&nbsp;output&nbsp;and&nbsp;standard&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="3527563">func</span>&nbsp;<span class="op" id="3527568">(</span><span class="ident" id="3527569">c</span>&nbsp;<span class="op" id="3527571">*</span><span class="ident" id="3527572">Cmd</span><span class="op" id="3527575">)</span>&nbsp;<span class="ident" id="3527577">CombinedOutput</span><span class="op" id="3527591">(</span><span class="op" id="3527592">)</span>&nbsp;<span class="op" id="3527594">(</span><span class="op" id="3527595">[</span><span class="op" id="3527596">]</span><span class="builtintype" id="3527597">byte</span><span class="op" id="3527601">,</span>&nbsp;<span class="builtintype" id="3527603">error</span><span class="op" id="3527608">)</span>&nbsp;<span class="op" id="3527610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527613">if</span>&nbsp;<span class="ident" id="3527616">c</span><span class="op" id="3527617">.</span><span class="ident" id="3527618">Stdout</span>&nbsp;<span class="op" id="3527625">!=</span>&nbsp;<span class="ident" id="3527628">nil</span>&nbsp;<span class="op" id="3527632">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527636">return</span>&nbsp;<span class="ident" id="3527643">nil</span><span class="op" id="3527646">,</span>&nbsp;<span class="ident" id="3527648">errors</span><span class="op" id="3527654">.</span><span class="ident" id="3527655">New</span><span class="op" id="3527658">(</span><span class="string" id="3527659">&#34;exec:&nbsp;Stdout&nbsp;already&nbsp;set&#34;</span><span class="op" id="3527685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3527688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527691">if</span>&nbsp;<span class="ident" id="3527694">c</span><span class="op" id="3527695">.</span><span class="ident" id="3527696">Stderr</span>&nbsp;<span class="op" id="3527703">!=</span>&nbsp;<span class="ident" id="3527706">nil</span>&nbsp;<span class="op" id="3527710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527714">return</span>&nbsp;<span class="ident" id="3527721">nil</span><span class="op" id="3527724">,</span>&nbsp;<span class="ident" id="3527726">errors</span><span class="op" id="3527732">.</span><span class="ident" id="3527733">New</span><span class="op" id="3527736">(</span><span class="string" id="3527737">&#34;exec:&nbsp;Stderr&nbsp;already&nbsp;set&#34;</span><span class="op" id="3527763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3527766">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527769">var</span>&nbsp;<span class="ident" id="3527773">b</span>&nbsp;<span class="ident" id="3527775">bytes</span><span class="op" id="3527780">.</span><span class="ident" id="3527781">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3527789">c</span><span class="op" id="3527790">.</span><span class="ident" id="3527791">Stdout</span>&nbsp;<span class="op" id="3527798">=</span>&nbsp;<span class="op" id="3527800">&amp;</span><span class="ident" id="3527801">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3527804">c</span><span class="op" id="3527805">.</span><span class="ident" id="3527806">Stderr</span>&nbsp;<span class="op" id="3527813">=</span>&nbsp;<span class="op" id="3527815">&amp;</span><span class="ident" id="3527816">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3527819">err</span>&nbsp;<span class="op" id="3527823">:=</span>&nbsp;<span class="ident" id="3527826">c</span><span class="op" id="3527827">.</span><span class="ident" id="3527828">Run</span><span class="op" id="3527831">(</span><span class="op" id="3527832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3527835">return</span>&nbsp;<span class="ident" id="3527842">b</span><span class="op" id="3527843">.</span><span class="ident" id="3527844">Bytes</span><span class="op" id="3527849">(</span><span class="op" id="3527850">)</span><span class="op" id="3527851">,</span>&nbsp;<span class="ident" id="3527853">err</span><br>
<span class="lineno">410</span><span class="op" id="3527857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3527860">//&nbsp;StdinPipe&nbsp;returns&nbsp;a&nbsp;pipe&nbsp;that&nbsp;will&nbsp;be&nbsp;connected&nbsp;to&nbsp;the&nbsp;command&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3527928">//&nbsp;standard&nbsp;input&nbsp;when&nbsp;the&nbsp;command&nbsp;starts.</span><br>
<span class="lineno"></span><span class="comment" id="3527971">//&nbsp;The&nbsp;pipe&nbsp;will&nbsp;be&nbsp;closed&nbsp;automatically&nbsp;after&nbsp;Wait&nbsp;sees&nbsp;the&nbsp;command&nbsp;exit.</span><br>
<span class="lineno">415</span><span class="comment" id="3528046">//&nbsp;A&nbsp;caller&nbsp;need&nbsp;only&nbsp;call&nbsp;Close&nbsp;to&nbsp;force&nbsp;the&nbsp;pipe&nbsp;to&nbsp;close&nbsp;sooner.</span><br>
<span class="lineno"></span><span class="comment" id="3528114">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;the&nbsp;command&nbsp;being&nbsp;run&nbsp;will&nbsp;not&nbsp;exit&nbsp;until&nbsp;standard&nbsp;input</span><br>
<span class="lineno"></span><span class="comment" id="3528190">//&nbsp;is&nbsp;closed,&nbsp;the&nbsp;caller&nbsp;must&nbsp;close&nbsp;the&nbsp;pipe.</span><br>
<span class="lineno"></span><span class="keyword" id="3528236">func</span>&nbsp;<span class="op" id="3528241">(</span><span class="ident" id="3528242">c</span>&nbsp;<span class="op" id="3528244">*</span><span class="ident" id="3528245">Cmd</span><span class="op" id="3528248">)</span>&nbsp;<span class="ident" id="3528250">StdinPipe</span><span class="op" id="3528259">(</span><span class="op" id="3528260">)</span>&nbsp;<span class="op" id="3528262">(</span><span class="ident" id="3528263">io</span><span class="op" id="3528265">.</span><span class="ident" id="3528266">WriteCloser</span><span class="op" id="3528277">,</span>&nbsp;<span class="builtintype" id="3528279">error</span><span class="op" id="3528284">)</span>&nbsp;<span class="op" id="3528286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528289">if</span>&nbsp;<span class="ident" id="3528292">c</span><span class="op" id="3528293">.</span><span class="ident" id="3528294">Stdin</span>&nbsp;<span class="op" id="3528300">!=</span>&nbsp;<span class="ident" id="3528303">nil</span>&nbsp;<span class="op" id="3528307">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528311">return</span>&nbsp;<span class="ident" id="3528318">nil</span><span class="op" id="3528321">,</span>&nbsp;<span class="ident" id="3528323">errors</span><span class="op" id="3528329">.</span><span class="ident" id="3528330">New</span><span class="op" id="3528333">(</span><span class="string" id="3528334">&#34;exec:&nbsp;Stdin&nbsp;already&nbsp;set&#34;</span><span class="op" id="3528359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3528362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528365">if</span>&nbsp;<span class="ident" id="3528368">c</span><span class="op" id="3528369">.</span><span class="ident" id="3528370">Process</span>&nbsp;<span class="op" id="3528378">!=</span>&nbsp;<span class="ident" id="3528381">nil</span>&nbsp;<span class="op" id="3528385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528389">return</span>&nbsp;<span class="ident" id="3528396">nil</span><span class="op" id="3528399">,</span>&nbsp;<span class="ident" id="3528401">errors</span><span class="op" id="3528407">.</span><span class="ident" id="3528408">New</span><span class="op" id="3528411">(</span><span class="string" id="3528412">&#34;exec:&nbsp;StdinPipe&nbsp;after&nbsp;process&nbsp;started&#34;</span><span class="op" id="3528451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3528454">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528457">pr</span><span class="op" id="3528459">,</span>&nbsp;<span class="ident" id="3528461">pw</span><span class="op" id="3528463">,</span>&nbsp;<span class="ident" id="3528465">err</span>&nbsp;<span class="op" id="3528469">:=</span>&nbsp;<span class="ident" id="3528472">os</span><span class="op" id="3528474">.</span><span class="ident" id="3528475">Pipe</span><span class="op" id="3528479">(</span><span class="op" id="3528480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528483">if</span>&nbsp;<span class="ident" id="3528486">err</span>&nbsp;<span class="op" id="3528490">!=</span>&nbsp;<span class="ident" id="3528493">nil</span>&nbsp;<span class="op" id="3528497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528501">return</span>&nbsp;<span class="ident" id="3528508">nil</span><span class="op" id="3528511">,</span>&nbsp;<span class="ident" id="3528513">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3528518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528521">c</span><span class="op" id="3528522">.</span><span class="ident" id="3528523">Stdin</span>&nbsp;<span class="op" id="3528529">=</span>&nbsp;<span class="ident" id="3528531">pr</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528535">c</span><span class="op" id="3528536">.</span><span class="ident" id="3528537">closeAfterStart</span>&nbsp;<span class="op" id="3528553">=</span>&nbsp;<span class="builtinfunc" id="3528555">append</span><span class="op" id="3528561">(</span><span class="ident" id="3528562">c</span><span class="op" id="3528563">.</span><span class="ident" id="3528564">closeAfterStart</span><span class="op" id="3528579">,</span>&nbsp;<span class="ident" id="3528581">pr</span><span class="op" id="3528583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528586">wc</span>&nbsp;<span class="op" id="3528589">:=</span>&nbsp;<span class="op" id="3528592">&amp;</span><span class="ident" id="3528593">closeOnce</span><span class="op" id="3528602">{</span><span class="ident" id="3528603">File</span><span class="op" id="3528607">:</span>&nbsp;<span class="ident" id="3528609">pw</span><span class="op" id="3528611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528614">c</span><span class="op" id="3528615">.</span><span class="ident" id="3528616">closeAfterWait</span>&nbsp;<span class="op" id="3528631">=</span>&nbsp;<span class="builtinfunc" id="3528633">append</span><span class="op" id="3528639">(</span><span class="ident" id="3528640">c</span><span class="op" id="3528641">.</span><span class="ident" id="3528642">closeAfterWait</span><span class="op" id="3528656">,</span>&nbsp;<span class="ident" id="3528658">wc</span><span class="op" id="3528660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528663">return</span>&nbsp;<span class="ident" id="3528670">wc</span><span class="op" id="3528672">,</span>&nbsp;<span class="ident" id="3528674">nil</span><br>
<span class="lineno"></span><span class="op" id="3528678">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="keyword" id="3528681">type</span>&nbsp;<span class="ident" id="3528686">closeOnce</span>&nbsp;<span class="keyword" id="3528696">struct</span>&nbsp;<span class="op" id="3528703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3528706">*</span><span class="ident" id="3528707">os</span><span class="op" id="3528709">.</span><span class="ident" id="3528710">File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528717">once</span>&nbsp;<span class="ident" id="3528722">sync</span><span class="op" id="3528726">.</span><span class="ident" id="3528727">Once</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528733">err</span>&nbsp;&nbsp;<span class="builtintype" id="3528738">error</span><br>
<span class="lineno"></span><span class="op" id="3528744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3528747">func</span>&nbsp;<span class="op" id="3528752">(</span><span class="ident" id="3528753">c</span>&nbsp;<span class="op" id="3528755">*</span><span class="ident" id="3528756">closeOnce</span><span class="op" id="3528765">)</span>&nbsp;<span class="ident" id="3528767">Close</span><span class="op" id="3528772">(</span><span class="op" id="3528773">)</span>&nbsp;<span class="builtintype" id="3528775">error</span>&nbsp;<span class="op" id="3528781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528784">c</span><span class="op" id="3528785">.</span><span class="ident" id="3528786">once</span><span class="op" id="3528790">.</span><span class="ident" id="3528791">Do</span><span class="op" id="3528793">(</span><span class="ident" id="3528794">c</span><span class="op" id="3528795">.</span><span class="builtinfunc" id="3528796">close</span><span class="op" id="3528801">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528804">return</span>&nbsp;<span class="ident" id="3528811">c</span><span class="op" id="3528812">.</span><span class="ident" id="3528813">err</span><br>
<span class="lineno"></span><span class="op" id="3528817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3528820">func</span>&nbsp;<span class="op" id="3528825">(</span><span class="ident" id="3528826">c</span>&nbsp;<span class="op" id="3528828">*</span><span class="ident" id="3528829">closeOnce</span><span class="op" id="3528838">)</span>&nbsp;<span class="builtinfunc" id="3528840">close</span><span class="op" id="3528845">(</span><span class="op" id="3528846">)</span>&nbsp;<span class="op" id="3528848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528851">c</span><span class="op" id="3528852">.</span><span class="ident" id="3528853">err</span>&nbsp;<span class="op" id="3528857">=</span>&nbsp;<span class="ident" id="3528859">c</span><span class="op" id="3528860">.</span><span class="ident" id="3528861">File</span><span class="op" id="3528865">.</span><span class="ident" id="3528866">Close</span><span class="op" id="3528871">(</span><span class="op" id="3528872">)</span><br>
<span class="lineno">450</span><span class="op" id="3528874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3528877">//&nbsp;StdoutPipe&nbsp;returns&nbsp;a&nbsp;pipe&nbsp;that&nbsp;will&nbsp;be&nbsp;connected&nbsp;to&nbsp;the&nbsp;command&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3528946">//&nbsp;standard&nbsp;output&nbsp;when&nbsp;the&nbsp;command&nbsp;starts.</span><br>
<span class="lineno"></span><span class="comment" id="3528990">//</span><br>
<span class="lineno">455</span><span class="comment" id="3528993">//&nbsp;Wait&nbsp;will&nbsp;close&nbsp;the&nbsp;pipe&nbsp;after&nbsp;seeing&nbsp;the&nbsp;command&nbsp;exit,&nbsp;so&nbsp;most&nbsp;callers</span><br>
<span class="lineno"></span><span class="comment" id="3529068">//&nbsp;need&nbsp;not&nbsp;close&nbsp;the&nbsp;pipe&nbsp;themselves;&nbsp;however,&nbsp;an&nbsp;implication&nbsp;is&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3529139">//&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;to&nbsp;call&nbsp;Wait&nbsp;before&nbsp;all&nbsp;reads&nbsp;from&nbsp;the&nbsp;pipe&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span><span class="comment" id="3529218">//&nbsp;For&nbsp;the&nbsp;same&nbsp;reason,&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;to&nbsp;call&nbsp;Run&nbsp;when&nbsp;using&nbsp;StdoutPipe.</span><br>
<span class="lineno"></span><span class="comment" id="3529293">//&nbsp;See&nbsp;the&nbsp;example&nbsp;for&nbsp;idiomatic&nbsp;usage.</span><br>
<span class="lineno">460</span><span class="keyword" id="3529333">func</span>&nbsp;<span class="op" id="3529338">(</span><span class="ident" id="3529339">c</span>&nbsp;<span class="op" id="3529341">*</span><span class="ident" id="3529342">Cmd</span><span class="op" id="3529345">)</span>&nbsp;<span class="ident" id="3529347">StdoutPipe</span><span class="op" id="3529357">(</span><span class="op" id="3529358">)</span>&nbsp;<span class="op" id="3529360">(</span><span class="ident" id="3529361">io</span><span class="op" id="3529363">.</span><span class="ident" id="3529364">ReadCloser</span><span class="op" id="3529374">,</span>&nbsp;<span class="builtintype" id="3529376">error</span><span class="op" id="3529381">)</span>&nbsp;<span class="op" id="3529383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529386">if</span>&nbsp;<span class="ident" id="3529389">c</span><span class="op" id="3529390">.</span><span class="ident" id="3529391">Stdout</span>&nbsp;<span class="op" id="3529398">!=</span>&nbsp;<span class="ident" id="3529401">nil</span>&nbsp;<span class="op" id="3529405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529409">return</span>&nbsp;<span class="ident" id="3529416">nil</span><span class="op" id="3529419">,</span>&nbsp;<span class="ident" id="3529421">errors</span><span class="op" id="3529427">.</span><span class="ident" id="3529428">New</span><span class="op" id="3529431">(</span><span class="string" id="3529432">&#34;exec:&nbsp;Stdout&nbsp;already&nbsp;set&#34;</span><span class="op" id="3529458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529464">if</span>&nbsp;<span class="ident" id="3529467">c</span><span class="op" id="3529468">.</span><span class="ident" id="3529469">Process</span>&nbsp;<span class="op" id="3529477">!=</span>&nbsp;<span class="ident" id="3529480">nil</span>&nbsp;<span class="op" id="3529484">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529488">return</span>&nbsp;<span class="ident" id="3529495">nil</span><span class="op" id="3529498">,</span>&nbsp;<span class="ident" id="3529500">errors</span><span class="op" id="3529506">.</span><span class="ident" id="3529507">New</span><span class="op" id="3529510">(</span><span class="string" id="3529511">&#34;exec:&nbsp;StdoutPipe&nbsp;after&nbsp;process&nbsp;started&#34;</span><span class="op" id="3529551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529557">pr</span><span class="op" id="3529559">,</span>&nbsp;<span class="ident" id="3529561">pw</span><span class="op" id="3529563">,</span>&nbsp;<span class="ident" id="3529565">err</span>&nbsp;<span class="op" id="3529569">:=</span>&nbsp;<span class="ident" id="3529572">os</span><span class="op" id="3529574">.</span><span class="ident" id="3529575">Pipe</span><span class="op" id="3529579">(</span><span class="op" id="3529580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529583">if</span>&nbsp;<span class="ident" id="3529586">err</span>&nbsp;<span class="op" id="3529590">!=</span>&nbsp;<span class="ident" id="3529593">nil</span>&nbsp;<span class="op" id="3529597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529601">return</span>&nbsp;<span class="ident" id="3529608">nil</span><span class="op" id="3529611">,</span>&nbsp;<span class="ident" id="3529613">err</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529621">c</span><span class="op" id="3529622">.</span><span class="ident" id="3529623">Stdout</span>&nbsp;<span class="op" id="3529630">=</span>&nbsp;<span class="ident" id="3529632">pw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529636">c</span><span class="op" id="3529637">.</span><span class="ident" id="3529638">closeAfterStart</span>&nbsp;<span class="op" id="3529654">=</span>&nbsp;<span class="builtinfunc" id="3529656">append</span><span class="op" id="3529662">(</span><span class="ident" id="3529663">c</span><span class="op" id="3529664">.</span><span class="ident" id="3529665">closeAfterStart</span><span class="op" id="3529680">,</span>&nbsp;<span class="ident" id="3529682">pw</span><span class="op" id="3529684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529687">c</span><span class="op" id="3529688">.</span><span class="ident" id="3529689">closeAfterWait</span>&nbsp;<span class="op" id="3529704">=</span>&nbsp;<span class="builtinfunc" id="3529706">append</span><span class="op" id="3529712">(</span><span class="ident" id="3529713">c</span><span class="op" id="3529714">.</span><span class="ident" id="3529715">closeAfterWait</span><span class="op" id="3529729">,</span>&nbsp;<span class="ident" id="3529731">pr</span><span class="op" id="3529733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529736">return</span>&nbsp;<span class="ident" id="3529743">pr</span><span class="op" id="3529745">,</span>&nbsp;<span class="ident" id="3529747">nil</span><br>
<span class="lineno">475</span><span class="op" id="3529751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3529754">//&nbsp;StderrPipe&nbsp;returns&nbsp;a&nbsp;pipe&nbsp;that&nbsp;will&nbsp;be&nbsp;connected&nbsp;to&nbsp;the&nbsp;command&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3529823">//&nbsp;standard&nbsp;error&nbsp;when&nbsp;the&nbsp;command&nbsp;starts.</span><br>
<span class="lineno"></span><span class="comment" id="3529866">//</span><br>
<span class="lineno">480</span><span class="comment" id="3529869">//&nbsp;Wait&nbsp;will&nbsp;close&nbsp;the&nbsp;pipe&nbsp;after&nbsp;seeing&nbsp;the&nbsp;command&nbsp;exit,&nbsp;so&nbsp;most&nbsp;callers</span><br>
<span class="lineno"></span><span class="comment" id="3529944">//&nbsp;need&nbsp;not&nbsp;close&nbsp;the&nbsp;pipe&nbsp;themselves;&nbsp;however,&nbsp;an&nbsp;implication&nbsp;is&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3530015">//&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;to&nbsp;call&nbsp;Wait&nbsp;before&nbsp;all&nbsp;reads&nbsp;from&nbsp;the&nbsp;pipe&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span><span class="comment" id="3530094">//&nbsp;For&nbsp;the&nbsp;same&nbsp;reason,&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;to&nbsp;use&nbsp;Run&nbsp;when&nbsp;using&nbsp;StderrPipe.</span><br>
<span class="lineno"></span><span class="comment" id="3530168">//&nbsp;See&nbsp;the&nbsp;StdoutPipe&nbsp;example&nbsp;for&nbsp;idiomatic&nbsp;usage.</span><br>
<span class="lineno">485</span><span class="keyword" id="3530219">func</span>&nbsp;<span class="op" id="3530224">(</span><span class="ident" id="3530225">c</span>&nbsp;<span class="op" id="3530227">*</span><span class="ident" id="3530228">Cmd</span><span class="op" id="3530231">)</span>&nbsp;<span class="ident" id="3530233">StderrPipe</span><span class="op" id="3530243">(</span><span class="op" id="3530244">)</span>&nbsp;<span class="op" id="3530246">(</span><span class="ident" id="3530247">io</span><span class="op" id="3530249">.</span><span class="ident" id="3530250">ReadCloser</span><span class="op" id="3530260">,</span>&nbsp;<span class="builtintype" id="3530262">error</span><span class="op" id="3530267">)</span>&nbsp;<span class="op" id="3530269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530272">if</span>&nbsp;<span class="ident" id="3530275">c</span><span class="op" id="3530276">.</span><span class="ident" id="3530277">Stderr</span>&nbsp;<span class="op" id="3530284">!=</span>&nbsp;<span class="ident" id="3530287">nil</span>&nbsp;<span class="op" id="3530291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530295">return</span>&nbsp;<span class="ident" id="3530302">nil</span><span class="op" id="3530305">,</span>&nbsp;<span class="ident" id="3530307">errors</span><span class="op" id="3530313">.</span><span class="ident" id="3530314">New</span><span class="op" id="3530317">(</span><span class="string" id="3530318">&#34;exec:&nbsp;Stderr&nbsp;already&nbsp;set&#34;</span><span class="op" id="3530344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530350">if</span>&nbsp;<span class="ident" id="3530353">c</span><span class="op" id="3530354">.</span><span class="ident" id="3530355">Process</span>&nbsp;<span class="op" id="3530363">!=</span>&nbsp;<span class="ident" id="3530366">nil</span>&nbsp;<span class="op" id="3530370">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530374">return</span>&nbsp;<span class="ident" id="3530381">nil</span><span class="op" id="3530384">,</span>&nbsp;<span class="ident" id="3530386">errors</span><span class="op" id="3530392">.</span><span class="ident" id="3530393">New</span><span class="op" id="3530396">(</span><span class="string" id="3530397">&#34;exec:&nbsp;StderrPipe&nbsp;after&nbsp;process&nbsp;started&#34;</span><span class="op" id="3530437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530443">pr</span><span class="op" id="3530445">,</span>&nbsp;<span class="ident" id="3530447">pw</span><span class="op" id="3530449">,</span>&nbsp;<span class="ident" id="3530451">err</span>&nbsp;<span class="op" id="3530455">:=</span>&nbsp;<span class="ident" id="3530458">os</span><span class="op" id="3530460">.</span><span class="ident" id="3530461">Pipe</span><span class="op" id="3530465">(</span><span class="op" id="3530466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530469">if</span>&nbsp;<span class="ident" id="3530472">err</span>&nbsp;<span class="op" id="3530476">!=</span>&nbsp;<span class="ident" id="3530479">nil</span>&nbsp;<span class="op" id="3530483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530487">return</span>&nbsp;<span class="ident" id="3530494">nil</span><span class="op" id="3530497">,</span>&nbsp;<span class="ident" id="3530499">err</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530507">c</span><span class="op" id="3530508">.</span><span class="ident" id="3530509">Stderr</span>&nbsp;<span class="op" id="3530516">=</span>&nbsp;<span class="ident" id="3530518">pw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530522">c</span><span class="op" id="3530523">.</span><span class="ident" id="3530524">closeAfterStart</span>&nbsp;<span class="op" id="3530540">=</span>&nbsp;<span class="builtinfunc" id="3530542">append</span><span class="op" id="3530548">(</span><span class="ident" id="3530549">c</span><span class="op" id="3530550">.</span><span class="ident" id="3530551">closeAfterStart</span><span class="op" id="3530566">,</span>&nbsp;<span class="ident" id="3530568">pw</span><span class="op" id="3530570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530573">c</span><span class="op" id="3530574">.</span><span class="ident" id="3530575">closeAfterWait</span>&nbsp;<span class="op" id="3530590">=</span>&nbsp;<span class="builtinfunc" id="3530592">append</span><span class="op" id="3530598">(</span><span class="ident" id="3530599">c</span><span class="op" id="3530600">.</span><span class="ident" id="3530601">closeAfterWait</span><span class="op" id="3530615">,</span>&nbsp;<span class="ident" id="3530617">pr</span><span class="op" id="3530619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530622">return</span>&nbsp;<span class="ident" id="3530629">pr</span><span class="op" id="3530631">,</span>&nbsp;<span class="ident" id="3530633">nil</span><br>
<span class="lineno">500</span><span class="op" id="3530637">}</span>
</div>
</body>
</html>
