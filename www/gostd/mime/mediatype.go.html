<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime</h2>
<ul>
<li><a href="/gostd/mime/grammar.go.html">grammar.go</a></li>
<li><a href="/gostd/mime/mediatype.go.html">mediatype.go</a></li>
<li><a href="/gostd/mime/mediatype_test.go.html">mediatype_test.go</a></li>
<li><a href="/gostd/mime/type.go.html">type.go</a></li>
<li><a href="/gostd/mime/type_test.go.html">type_test.go</a></li>
<li><a href="/gostd/mime/type_unix.go.html">type_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3809661">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3809716">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3809770">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3809821">package</span>&nbsp;<span class="ident" id="3809829">mime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3809835">import</span>&nbsp;<span class="op" id="3809842">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3809845">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3809854">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3809864">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3809871">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3809879">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3809890">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="3809900">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3809903">//&nbsp;FormatMediaType&nbsp;serializes&nbsp;mediatype&nbsp;t&nbsp;and&nbsp;the&nbsp;parameters</span><br>
<span class="lineno"></span><span class="comment" id="3809964">//&nbsp;param&nbsp;as&nbsp;a&nbsp;media&nbsp;type&nbsp;conforming&nbsp;to&nbsp;RFC&nbsp;2045&nbsp;and&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="3810026">//&nbsp;The&nbsp;type&nbsp;and&nbsp;parameter&nbsp;names&nbsp;are&nbsp;written&nbsp;in&nbsp;lower-case.</span><br>
<span class="lineno"></span><span class="comment" id="3810085">//&nbsp;When&nbsp;any&nbsp;of&nbsp;the&nbsp;arguments&nbsp;result&nbsp;in&nbsp;a&nbsp;standard&nbsp;violation&nbsp;then</span><br>
<span class="lineno">20</span><span class="comment" id="3810150">//&nbsp;FormatMediaType&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3810195">func</span>&nbsp;<span class="ident" id="3810200">FormatMediaType</span><span class="op" id="3810215">(</span><span class="ident" id="3810216">t</span>&nbsp;<span class="builtintype" id="3810218">string</span><span class="op" id="3810224">,</span>&nbsp;<span class="ident" id="3810226">param</span>&nbsp;<span class="keyword" id="3810232">map</span><span class="op" id="3810235">[</span><span class="builtintype" id="3810236">string</span><span class="op" id="3810242">]</span><span class="builtintype" id="3810243">string</span><span class="op" id="3810249">)</span>&nbsp;<span class="builtintype" id="3810251">string</span>&nbsp;<span class="op" id="3810258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810261">slash</span>&nbsp;<span class="op" id="3810267">:=</span>&nbsp;<span class="ident" id="3810270">strings</span><span class="op" id="3810277">.</span><span class="ident" id="3810278">Index</span><span class="op" id="3810283">(</span><span class="ident" id="3810284">t</span><span class="op" id="3810285">,</span>&nbsp;<span class="string" id="3810287">&#34;/&#34;</span><span class="op" id="3810290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810293">if</span>&nbsp;<span class="ident" id="3810296">slash</span>&nbsp;<span class="op" id="3810302">==</span>&nbsp;<span class="op" id="3810305">-</span><span class="num" id="3810306">1</span>&nbsp;<span class="op" id="3810308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810312">return</span>&nbsp;<span class="string" id="3810319">&#34;&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3810323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810326">major</span><span class="op" id="3810331">,</span>&nbsp;<span class="ident" id="3810333">sub</span>&nbsp;<span class="op" id="3810337">:=</span>&nbsp;<span class="ident" id="3810340">t</span><span class="op" id="3810341">[</span><span class="op" id="3810342">:</span><span class="ident" id="3810343">slash</span><span class="op" id="3810348">]</span><span class="op" id="3810349">,</span>&nbsp;<span class="ident" id="3810351">t</span><span class="op" id="3810352">[</span><span class="ident" id="3810353">slash</span><span class="op" id="3810358">+</span><span class="num" id="3810359">1</span><span class="op" id="3810360">:</span><span class="op" id="3810361">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810364">if</span>&nbsp;<span class="op" id="3810367">!</span><span class="ident" id="3810368">isToken</span><span class="op" id="3810375">(</span><span class="ident" id="3810376">major</span><span class="op" id="3810381">)</span>&nbsp;<span class="op" id="3810383">||</span>&nbsp;<span class="op" id="3810386">!</span><span class="ident" id="3810387">isToken</span><span class="op" id="3810394">(</span><span class="ident" id="3810395">sub</span><span class="op" id="3810398">)</span>&nbsp;<span class="op" id="3810400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810404">return</span>&nbsp;<span class="string" id="3810411">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3810415">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810418">var</span>&nbsp;<span class="ident" id="3810422">b</span>&nbsp;<span class="ident" id="3810424">bytes</span><span class="op" id="3810429">.</span><span class="ident" id="3810430">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810438">b</span><span class="op" id="3810439">.</span><span class="ident" id="3810440">WriteString</span><span class="op" id="3810451">(</span><span class="ident" id="3810452">strings</span><span class="op" id="3810459">.</span><span class="ident" id="3810460">ToLower</span><span class="op" id="3810467">(</span><span class="ident" id="3810468">major</span><span class="op" id="3810473">)</span><span class="op" id="3810474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810477">b</span><span class="op" id="3810478">.</span><span class="ident" id="3810479">WriteByte</span><span class="op" id="3810488">(</span><span class="string" id="3810489">&#39;/&#39;</span><span class="op" id="3810492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810495">b</span><span class="op" id="3810496">.</span><span class="ident" id="3810497">WriteString</span><span class="op" id="3810508">(</span><span class="ident" id="3810509">strings</span><span class="op" id="3810516">.</span><span class="ident" id="3810517">ToLower</span><span class="op" id="3810524">(</span><span class="ident" id="3810525">sub</span><span class="op" id="3810528">)</span><span class="op" id="3810529">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810533">attrs</span>&nbsp;<span class="op" id="3810539">:=</span>&nbsp;<span class="builtinfunc" id="3810542">make</span><span class="op" id="3810546">(</span><span class="op" id="3810547">[</span><span class="op" id="3810548">]</span><span class="builtintype" id="3810549">string</span><span class="op" id="3810555">,</span>&nbsp;<span class="num" id="3810557">0</span><span class="op" id="3810558">,</span>&nbsp;<span class="builtinfunc" id="3810560">len</span><span class="op" id="3810563">(</span><span class="ident" id="3810564">param</span><span class="op" id="3810569">)</span><span class="op" id="3810570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810573">for</span>&nbsp;<span class="ident" id="3810577">a</span>&nbsp;<span class="op" id="3810579">:=</span>&nbsp;<span class="keyword" id="3810582">range</span>&nbsp;<span class="ident" id="3810588">param</span>&nbsp;<span class="op" id="3810594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810598">attrs</span>&nbsp;<span class="op" id="3810604">=</span>&nbsp;<span class="builtinfunc" id="3810606">append</span><span class="op" id="3810612">(</span><span class="ident" id="3810613">attrs</span><span class="op" id="3810618">,</span>&nbsp;<span class="ident" id="3810620">a</span><span class="op" id="3810621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3810624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810627">sort</span><span class="op" id="3810631">.</span><span class="ident" id="3810632">Strings</span><span class="op" id="3810639">(</span><span class="ident" id="3810640">attrs</span><span class="op" id="3810645">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810649">for</span>&nbsp;<span class="ident" id="3810653">_</span><span class="op" id="3810654">,</span>&nbsp;<span class="ident" id="3810656">attribute</span>&nbsp;<span class="op" id="3810666">:=</span>&nbsp;<span class="keyword" id="3810669">range</span>&nbsp;<span class="ident" id="3810675">attrs</span>&nbsp;<span class="op" id="3810681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810685">value</span>&nbsp;<span class="op" id="3810691">:=</span>&nbsp;<span class="ident" id="3810694">param</span><span class="op" id="3810699">[</span><span class="ident" id="3810700">attribute</span><span class="op" id="3810709">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810713">b</span><span class="op" id="3810714">.</span><span class="ident" id="3810715">WriteByte</span><span class="op" id="3810724">(</span><span class="string" id="3810725">&#39;;&#39;</span><span class="op" id="3810728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810732">b</span><span class="op" id="3810733">.</span><span class="ident" id="3810734">WriteByte</span><span class="op" id="3810743">(</span><span class="string" id="3810744">&#39;&nbsp;&#39;</span><span class="op" id="3810747">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810751">if</span>&nbsp;<span class="op" id="3810754">!</span><span class="ident" id="3810755">isToken</span><span class="op" id="3810762">(</span><span class="ident" id="3810763">attribute</span><span class="op" id="3810772">)</span>&nbsp;<span class="op" id="3810774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810779">return</span>&nbsp;<span class="string" id="3810786">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3810791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810795">b</span><span class="op" id="3810796">.</span><span class="ident" id="3810797">WriteString</span><span class="op" id="3810808">(</span><span class="ident" id="3810809">strings</span><span class="op" id="3810816">.</span><span class="ident" id="3810817">ToLower</span><span class="op" id="3810824">(</span><span class="ident" id="3810825">attribute</span><span class="op" id="3810834">)</span><span class="op" id="3810835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810839">b</span><span class="op" id="3810840">.</span><span class="ident" id="3810841">WriteByte</span><span class="op" id="3810850">(</span><span class="string" id="3810851">&#39;=&#39;</span><span class="op" id="3810854">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810858">if</span>&nbsp;<span class="ident" id="3810861">isToken</span><span class="op" id="3810868">(</span><span class="ident" id="3810869">value</span><span class="op" id="3810874">)</span>&nbsp;<span class="op" id="3810876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810881">b</span><span class="op" id="3810882">.</span><span class="ident" id="3810883">WriteString</span><span class="op" id="3810894">(</span><span class="ident" id="3810895">value</span><span class="op" id="3810900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810905">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3810916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810921">b</span><span class="op" id="3810922">.</span><span class="ident" id="3810923">WriteByte</span><span class="op" id="3810932">(</span><span class="string" id="3810933">&#39;&#34;&#39;</span><span class="op" id="3810936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3810940">offset</span>&nbsp;<span class="op" id="3810947">:=</span>&nbsp;<span class="num" id="3810950">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810954">for</span>&nbsp;<span class="ident" id="3810958">index</span><span class="op" id="3810963">,</span>&nbsp;<span class="ident" id="3810965">character</span>&nbsp;<span class="op" id="3810975">:=</span>&nbsp;<span class="keyword" id="3810978">range</span>&nbsp;<span class="ident" id="3810984">value</span>&nbsp;<span class="op" id="3810990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3810995">if</span>&nbsp;<span class="ident" id="3810998">character</span>&nbsp;<span class="op" id="3811008">==</span>&nbsp;<span class="string" id="3811011">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="3811015">||</span>&nbsp;<span class="ident" id="3811018">character</span>&nbsp;<span class="op" id="3811028">==</span>&nbsp;<span class="string" id="3811031">&#39;\\&#39;</span>&nbsp;<span class="op" id="3811036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3811042">b</span><span class="op" id="3811043">.</span><span class="ident" id="3811044">WriteString</span><span class="op" id="3811055">(</span><span class="ident" id="3811056">value</span><span class="op" id="3811061">[</span><span class="ident" id="3811062">offset</span><span class="op" id="3811068">:</span><span class="ident" id="3811069">index</span><span class="op" id="3811074">]</span><span class="op" id="3811075">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3811081">offset</span>&nbsp;<span class="op" id="3811088">=</span>&nbsp;<span class="ident" id="3811090">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3811100">b</span><span class="op" id="3811101">.</span><span class="ident" id="3811102">WriteByte</span><span class="op" id="3811111">(</span><span class="string" id="3811112">&#39;\\&#39;</span><span class="op" id="3811116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3811121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811126">if</span>&nbsp;<span class="ident" id="3811129">character</span><span class="op" id="3811138">&amp;</span><span class="num" id="3811139">0x80</span>&nbsp;<span class="op" id="3811144">!=</span>&nbsp;<span class="num" id="3811147">0</span>&nbsp;<span class="op" id="3811149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811155">return</span>&nbsp;<span class="string" id="3811162">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3811168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3811172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3811176">b</span><span class="op" id="3811177">.</span><span class="ident" id="3811178">WriteString</span><span class="op" id="3811189">(</span><span class="ident" id="3811190">value</span><span class="op" id="3811195">[</span><span class="ident" id="3811196">offset</span><span class="op" id="3811202">:</span><span class="op" id="3811203">]</span><span class="op" id="3811204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3811208">b</span><span class="op" id="3811209">.</span><span class="ident" id="3811210">WriteByte</span><span class="op" id="3811219">(</span><span class="string" id="3811220">&#39;&#34;&#39;</span><span class="op" id="3811223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3811226">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811229">return</span>&nbsp;<span class="ident" id="3811236">b</span><span class="op" id="3811237">.</span><span class="ident" id="3811238">String</span><span class="op" id="3811244">(</span><span class="op" id="3811245">)</span><br>
<span class="lineno"></span><span class="op" id="3811247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3811250">func</span>&nbsp;<span class="ident" id="3811255">checkMediaTypeDisposition</span><span class="op" id="3811280">(</span><span class="ident" id="3811281">s</span>&nbsp;<span class="builtintype" id="3811283">string</span><span class="op" id="3811289">)</span>&nbsp;<span class="builtintype" id="3811291">error</span>&nbsp;<span class="op" id="3811297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3811300">typ</span><span class="op" id="3811303">,</span>&nbsp;<span class="ident" id="3811305">rest</span>&nbsp;<span class="op" id="3811310">:=</span>&nbsp;<span class="ident" id="3811313">consumeToken</span><span class="op" id="3811325">(</span><span class="ident" id="3811326">s</span><span class="op" id="3811327">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811330">if</span>&nbsp;<span class="ident" id="3811333">typ</span>&nbsp;<span class="op" id="3811337">==</span>&nbsp;<span class="string" id="3811340">&#34;&#34;</span>&nbsp;<span class="op" id="3811343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811347">return</span>&nbsp;<span class="ident" id="3811354">errors</span><span class="op" id="3811360">.</span><span class="ident" id="3811361">New</span><span class="op" id="3811364">(</span><span class="string" id="3811365">&#34;mime:&nbsp;no&nbsp;media&nbsp;type&#34;</span><span class="op" id="3811386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3811389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811392">if</span>&nbsp;<span class="ident" id="3811395">rest</span>&nbsp;<span class="op" id="3811400">==</span>&nbsp;<span class="string" id="3811403">&#34;&#34;</span>&nbsp;<span class="op" id="3811406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811410">return</span>&nbsp;<span class="ident" id="3811417">nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3811422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811425">if</span>&nbsp;<span class="op" id="3811428">!</span><span class="ident" id="3811429">strings</span><span class="op" id="3811436">.</span><span class="ident" id="3811437">HasPrefix</span><span class="op" id="3811446">(</span><span class="ident" id="3811447">rest</span><span class="op" id="3811451">,</span>&nbsp;<span class="string" id="3811453">&#34;/&#34;</span><span class="op" id="3811456">)</span>&nbsp;<span class="op" id="3811458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811462">return</span>&nbsp;<span class="ident" id="3811469">errors</span><span class="op" id="3811475">.</span><span class="ident" id="3811476">New</span><span class="op" id="3811479">(</span><span class="string" id="3811480">&#34;mime:&nbsp;expected&nbsp;slash&nbsp;after&nbsp;first&nbsp;token&#34;</span><span class="op" id="3811520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3811523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3811526">subtype</span><span class="op" id="3811533">,</span>&nbsp;<span class="ident" id="3811535">rest</span>&nbsp;<span class="op" id="3811540">:=</span>&nbsp;<span class="ident" id="3811543">consumeToken</span><span class="op" id="3811555">(</span><span class="ident" id="3811556">rest</span><span class="op" id="3811560">[</span><span class="num" id="3811561">1</span><span class="op" id="3811562">:</span><span class="op" id="3811563">]</span><span class="op" id="3811564">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811567">if</span>&nbsp;<span class="ident" id="3811570">subtype</span>&nbsp;<span class="op" id="3811578">==</span>&nbsp;<span class="string" id="3811581">&#34;&#34;</span>&nbsp;<span class="op" id="3811584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811588">return</span>&nbsp;<span class="ident" id="3811595">errors</span><span class="op" id="3811601">.</span><span class="ident" id="3811602">New</span><span class="op" id="3811605">(</span><span class="string" id="3811606">&#34;mime:&nbsp;expected&nbsp;token&nbsp;after&nbsp;slash&#34;</span><span class="op" id="3811640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3811643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811646">if</span>&nbsp;<span class="ident" id="3811649">rest</span>&nbsp;<span class="op" id="3811654">!=</span>&nbsp;<span class="string" id="3811657">&#34;&#34;</span>&nbsp;<span class="op" id="3811660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811664">return</span>&nbsp;<span class="ident" id="3811671">errors</span><span class="op" id="3811677">.</span><span class="ident" id="3811678">New</span><span class="op" id="3811681">(</span><span class="string" id="3811682">&#34;mime:&nbsp;unexpected&nbsp;content&nbsp;after&nbsp;media&nbsp;subtype&#34;</span><span class="op" id="3811728">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3811731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3811734">return</span>&nbsp;<span class="ident" id="3811741">nil</span><br>
<span class="lineno"></span><span class="op" id="3811745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3811748">//&nbsp;ParseMediaType&nbsp;parses&nbsp;a&nbsp;media&nbsp;type&nbsp;value&nbsp;and&nbsp;any&nbsp;optional</span><br>
<span class="lineno">95</span><span class="comment" id="3811809">//&nbsp;parameters,&nbsp;per&nbsp;RFC&nbsp;1521.&nbsp;&nbsp;Media&nbsp;types&nbsp;are&nbsp;the&nbsp;values&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3811869">//&nbsp;Content-Type&nbsp;and&nbsp;Content-Disposition&nbsp;headers&nbsp;(RFC&nbsp;2183).</span><br>
<span class="lineno"></span><span class="comment" id="3811929">//&nbsp;On&nbsp;success,&nbsp;ParseMediaType&nbsp;returns&nbsp;the&nbsp;media&nbsp;type&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="3811992">//&nbsp;to&nbsp;lowercase&nbsp;and&nbsp;trimmed&nbsp;of&nbsp;white&nbsp;space&nbsp;and&nbsp;a&nbsp;non-nil&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="3812054">//&nbsp;The&nbsp;returned&nbsp;map,&nbsp;params,&nbsp;maps&nbsp;from&nbsp;the&nbsp;lowercase</span><br>
<span class="lineno">100</span><span class="comment" id="3812107">//&nbsp;attribute&nbsp;to&nbsp;the&nbsp;attribute&nbsp;value&nbsp;with&nbsp;its&nbsp;case&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="keyword" id="3812168">func</span>&nbsp;<span class="ident" id="3812173">ParseMediaType</span><span class="op" id="3812187">(</span><span class="ident" id="3812188">v</span>&nbsp;<span class="builtintype" id="3812190">string</span><span class="op" id="3812196">)</span>&nbsp;<span class="op" id="3812198">(</span><span class="ident" id="3812199">mediatype</span>&nbsp;<span class="builtintype" id="3812209">string</span><span class="op" id="3812215">,</span>&nbsp;<span class="ident" id="3812217">params</span>&nbsp;<span class="keyword" id="3812224">map</span><span class="op" id="3812227">[</span><span class="builtintype" id="3812228">string</span><span class="op" id="3812234">]</span><span class="builtintype" id="3812235">string</span><span class="op" id="3812241">,</span>&nbsp;<span class="ident" id="3812243">err</span>&nbsp;<span class="builtintype" id="3812247">error</span><span class="op" id="3812252">)</span>&nbsp;<span class="op" id="3812254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3812257">i</span>&nbsp;<span class="op" id="3812259">:=</span>&nbsp;<span class="ident" id="3812262">strings</span><span class="op" id="3812269">.</span><span class="ident" id="3812270">Index</span><span class="op" id="3812275">(</span><span class="ident" id="3812276">v</span><span class="op" id="3812277">,</span>&nbsp;<span class="string" id="3812279">&#34;;&#34;</span><span class="op" id="3812282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3812285">if</span>&nbsp;<span class="ident" id="3812288">i</span>&nbsp;<span class="op" id="3812290">==</span>&nbsp;<span class="op" id="3812293">-</span><span class="num" id="3812294">1</span>&nbsp;<span class="op" id="3812296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3812300">i</span>&nbsp;<span class="op" id="3812302">=</span>&nbsp;<span class="builtinfunc" id="3812304">len</span><span class="op" id="3812307">(</span><span class="ident" id="3812308">v</span><span class="op" id="3812309">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3812312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3812315">mediatype</span>&nbsp;<span class="op" id="3812325">=</span>&nbsp;<span class="ident" id="3812327">strings</span><span class="op" id="3812334">.</span><span class="ident" id="3812335">TrimSpace</span><span class="op" id="3812344">(</span><span class="ident" id="3812345">strings</span><span class="op" id="3812352">.</span><span class="ident" id="3812353">ToLower</span><span class="op" id="3812360">(</span><span class="ident" id="3812361">v</span><span class="op" id="3812362">[</span><span class="num" id="3812363">0</span><span class="op" id="3812364">:</span><span class="ident" id="3812365">i</span><span class="op" id="3812366">]</span><span class="op" id="3812367">)</span><span class="op" id="3812368">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3812372">err</span>&nbsp;<span class="op" id="3812376">=</span>&nbsp;<span class="ident" id="3812378">checkMediaTypeDisposition</span><span class="op" id="3812403">(</span><span class="ident" id="3812404">mediatype</span><span class="op" id="3812413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3812416">if</span>&nbsp;<span class="ident" id="3812419">err</span>&nbsp;<span class="op" id="3812423">!=</span>&nbsp;<span class="ident" id="3812426">nil</span>&nbsp;<span class="op" id="3812430">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3812434">return</span>&nbsp;<span class="string" id="3812441">&#34;&#34;</span><span class="op" id="3812443">,</span>&nbsp;<span class="ident" id="3812445">nil</span><span class="op" id="3812448">,</span>&nbsp;<span class="ident" id="3812450">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3812455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3812459">params</span>&nbsp;<span class="op" id="3812466">=</span>&nbsp;<span class="builtinfunc" id="3812468">make</span><span class="op" id="3812472">(</span><span class="keyword" id="3812473">map</span><span class="op" id="3812476">[</span><span class="builtintype" id="3812477">string</span><span class="op" id="3812483">]</span><span class="builtintype" id="3812484">string</span><span class="op" id="3812490">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3812494">//&nbsp;Map&nbsp;of&nbsp;base&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3812552">//&nbsp;for&nbsp;parameters&nbsp;containing&nbsp;a&nbsp;&#39;*&#39;&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3812599">//&nbsp;Lazily&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3812623">var</span>&nbsp;<span class="ident" id="3812627">continuation</span>&nbsp;<span class="keyword" id="3812640">map</span><span class="op" id="3812643">[</span><span class="builtintype" id="3812644">string</span><span class="op" id="3812650">]</span><span class="keyword" id="3812651">map</span><span class="op" id="3812654">[</span><span class="builtintype" id="3812655">string</span><span class="op" id="3812661">]</span><span class="builtintype" id="3812662">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3812671">v</span>&nbsp;<span class="op" id="3812673">=</span>&nbsp;<span class="ident" id="3812675">v</span><span class="op" id="3812676">[</span><span class="ident" id="3812677">i</span><span class="op" id="3812678">:</span><span class="op" id="3812679">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3812682">for</span>&nbsp;<span class="builtinfunc" id="3812686">len</span><span class="op" id="3812689">(</span><span class="ident" id="3812690">v</span><span class="op" id="3812691">)</span>&nbsp;<span class="op" id="3812693">&gt;</span>&nbsp;<span class="num" id="3812695">0</span>&nbsp;<span class="op" id="3812697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3812701">v</span>&nbsp;<span class="op" id="3812703">=</span>&nbsp;<span class="ident" id="3812705">strings</span><span class="op" id="3812712">.</span><span class="ident" id="3812713">TrimLeftFunc</span><span class="op" id="3812725">(</span><span class="ident" id="3812726">v</span><span class="op" id="3812727">,</span>&nbsp;<span class="ident" id="3812729">unicode</span><span class="op" id="3812736">.</span><span class="ident" id="3812737">IsSpace</span><span class="op" id="3812744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3812748">if</span>&nbsp;<span class="builtinfunc" id="3812751">len</span><span class="op" id="3812754">(</span><span class="ident" id="3812755">v</span><span class="op" id="3812756">)</span>&nbsp;<span class="op" id="3812758">==</span>&nbsp;<span class="num" id="3812761">0</span>&nbsp;<span class="op" id="3812763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3812768">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3812776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3812780">key</span><span class="op" id="3812783">,</span>&nbsp;<span class="ident" id="3812785">value</span><span class="op" id="3812790">,</span>&nbsp;<span class="ident" id="3812792">rest</span>&nbsp;<span class="op" id="3812797">:=</span>&nbsp;<span class="ident" id="3812800">consumeMediaParam</span><span class="op" id="3812817">(</span><span class="ident" id="3812818">v</span><span class="op" id="3812819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3812823">if</span>&nbsp;<span class="ident" id="3812826">key</span>&nbsp;<span class="op" id="3812830">==</span>&nbsp;<span class="string" id="3812833">&#34;&#34;</span>&nbsp;<span class="op" id="3812836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3812841">if</span>&nbsp;<span class="ident" id="3812844">strings</span><span class="op" id="3812851">.</span><span class="ident" id="3812852">TrimSpace</span><span class="op" id="3812861">(</span><span class="ident" id="3812862">rest</span><span class="op" id="3812866">)</span>&nbsp;<span class="op" id="3812868">==</span>&nbsp;<span class="string" id="3812871">&#34;;&#34;</span>&nbsp;<span class="op" id="3812875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3812881">//&nbsp;Ignore&nbsp;trailing&nbsp;semicolons.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3812916">//&nbsp;Not&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3812937">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3812947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3812952">//&nbsp;Parse&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3812971">return</span>&nbsp;<span class="string" id="3812978">&#34;&#34;</span><span class="op" id="3812980">,</span>&nbsp;<span class="ident" id="3812982">nil</span><span class="op" id="3812985">,</span>&nbsp;<span class="ident" id="3812987">errors</span><span class="op" id="3812993">.</span><span class="ident" id="3812994">New</span><span class="op" id="3812997">(</span><span class="string" id="3812998">&#34;mime:&nbsp;invalid&nbsp;media&nbsp;parameter&#34;</span><span class="op" id="3813029">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3813033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813038">pmap</span>&nbsp;<span class="op" id="3813043">:=</span>&nbsp;<span class="ident" id="3813046">params</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813055">if</span>&nbsp;<span class="ident" id="3813058">idx</span>&nbsp;<span class="op" id="3813062">:=</span>&nbsp;<span class="ident" id="3813065">strings</span><span class="op" id="3813072">.</span><span class="ident" id="3813073">Index</span><span class="op" id="3813078">(</span><span class="ident" id="3813079">key</span><span class="op" id="3813082">,</span>&nbsp;<span class="string" id="3813084">&#34;*&#34;</span><span class="op" id="3813087">)</span><span class="op" id="3813088">;</span>&nbsp;<span class="ident" id="3813090">idx</span>&nbsp;<span class="op" id="3813094">!=</span>&nbsp;<span class="op" id="3813097">-</span><span class="num" id="3813098">1</span>&nbsp;<span class="op" id="3813100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813105">baseName</span>&nbsp;<span class="op" id="3813114">:=</span>&nbsp;<span class="ident" id="3813117">key</span><span class="op" id="3813120">[</span><span class="op" id="3813121">:</span><span class="ident" id="3813122">idx</span><span class="op" id="3813125">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813130">if</span>&nbsp;<span class="ident" id="3813133">continuation</span>&nbsp;<span class="op" id="3813146">==</span>&nbsp;<span class="ident" id="3813149">nil</span>&nbsp;<span class="op" id="3813153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813159">continuation</span>&nbsp;<span class="op" id="3813172">=</span>&nbsp;<span class="builtinfunc" id="3813174">make</span><span class="op" id="3813178">(</span><span class="keyword" id="3813179">map</span><span class="op" id="3813182">[</span><span class="builtintype" id="3813183">string</span><span class="op" id="3813189">]</span><span class="keyword" id="3813190">map</span><span class="op" id="3813193">[</span><span class="builtintype" id="3813194">string</span><span class="op" id="3813200">]</span><span class="builtintype" id="3813201">string</span><span class="op" id="3813207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3813212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813217">var</span>&nbsp;<span class="ident" id="3813221">ok</span>&nbsp;<span class="builtintype" id="3813224">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813232">if</span>&nbsp;<span class="ident" id="3813235">pmap</span><span class="op" id="3813239">,</span>&nbsp;<span class="ident" id="3813241">ok</span>&nbsp;<span class="op" id="3813244">=</span>&nbsp;<span class="ident" id="3813246">continuation</span><span class="op" id="3813258">[</span><span class="ident" id="3813259">baseName</span><span class="op" id="3813267">]</span><span class="op" id="3813268">;</span>&nbsp;<span class="op" id="3813270">!</span><span class="ident" id="3813271">ok</span>&nbsp;<span class="op" id="3813274">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813280">continuation</span><span class="op" id="3813292">[</span><span class="ident" id="3813293">baseName</span><span class="op" id="3813301">]</span>&nbsp;<span class="op" id="3813303">=</span>&nbsp;<span class="builtinfunc" id="3813305">make</span><span class="op" id="3813309">(</span><span class="keyword" id="3813310">map</span><span class="op" id="3813313">[</span><span class="builtintype" id="3813314">string</span><span class="op" id="3813320">]</span><span class="builtintype" id="3813321">string</span><span class="op" id="3813327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813333">pmap</span>&nbsp;<span class="op" id="3813338">=</span>&nbsp;<span class="ident" id="3813340">continuation</span><span class="op" id="3813352">[</span><span class="ident" id="3813353">baseName</span><span class="op" id="3813361">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3813366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3813370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813374">if</span>&nbsp;<span class="ident" id="3813377">_</span><span class="op" id="3813378">,</span>&nbsp;<span class="ident" id="3813380">exists</span>&nbsp;<span class="op" id="3813387">:=</span>&nbsp;<span class="ident" id="3813390">pmap</span><span class="op" id="3813394">[</span><span class="ident" id="3813395">key</span><span class="op" id="3813398">]</span><span class="op" id="3813399">;</span>&nbsp;<span class="ident" id="3813401">exists</span>&nbsp;<span class="op" id="3813408">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3813413">//&nbsp;Duplicate&nbsp;parameter&nbsp;name&nbsp;is&nbsp;bogus.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813454">return</span>&nbsp;<span class="string" id="3813461">&#34;&#34;</span><span class="op" id="3813463">,</span>&nbsp;<span class="ident" id="3813465">nil</span><span class="op" id="3813468">,</span>&nbsp;<span class="ident" id="3813470">errors</span><span class="op" id="3813476">.</span><span class="ident" id="3813477">New</span><span class="op" id="3813480">(</span><span class="string" id="3813481">&#34;mime:&nbsp;duplicate&nbsp;parameter&nbsp;name&#34;</span><span class="op" id="3813513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3813517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813521">pmap</span><span class="op" id="3813525">[</span><span class="ident" id="3813526">key</span><span class="op" id="3813529">]</span>&nbsp;<span class="op" id="3813531">=</span>&nbsp;<span class="ident" id="3813533">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813541">v</span>&nbsp;<span class="op" id="3813543">=</span>&nbsp;<span class="ident" id="3813545">rest</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3813551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3813555">//&nbsp;Stitch&nbsp;together&nbsp;any&nbsp;continuations&nbsp;or&nbsp;things&nbsp;with&nbsp;stars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3813614">//&nbsp;(i.e.&nbsp;RFC&nbsp;2231&nbsp;things&nbsp;with&nbsp;stars:&nbsp;&#34;foo*0&#34;&nbsp;or&nbsp;&#34;foo*&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813671">var</span>&nbsp;<span class="ident" id="3813675">buf</span>&nbsp;<span class="ident" id="3813679">bytes</span><span class="op" id="3813684">.</span><span class="ident" id="3813685">Buffer</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813693">for</span>&nbsp;<span class="ident" id="3813697">key</span><span class="op" id="3813700">,</span>&nbsp;<span class="ident" id="3813702">pieceMap</span>&nbsp;<span class="op" id="3813711">:=</span>&nbsp;<span class="keyword" id="3813714">range</span>&nbsp;<span class="ident" id="3813720">continuation</span>&nbsp;<span class="op" id="3813733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813737">singlePartKey</span>&nbsp;<span class="op" id="3813751">:=</span>&nbsp;<span class="ident" id="3813754">key</span>&nbsp;<span class="op" id="3813758">+</span>&nbsp;<span class="string" id="3813760">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813766">if</span>&nbsp;<span class="ident" id="3813769">v</span><span class="op" id="3813770">,</span>&nbsp;<span class="ident" id="3813772">ok</span>&nbsp;<span class="op" id="3813775">:=</span>&nbsp;<span class="ident" id="3813778">pieceMap</span><span class="op" id="3813786">[</span><span class="ident" id="3813787">singlePartKey</span><span class="op" id="3813800">]</span><span class="op" id="3813801">;</span>&nbsp;<span class="ident" id="3813803">ok</span>&nbsp;<span class="op" id="3813806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813811">decv</span>&nbsp;<span class="op" id="3813816">:=</span>&nbsp;<span class="ident" id="3813819">decode2231Enc</span><span class="op" id="3813832">(</span><span class="ident" id="3813833">v</span><span class="op" id="3813834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813839">params</span><span class="op" id="3813845">[</span><span class="ident" id="3813846">key</span><span class="op" id="3813849">]</span>&nbsp;<span class="op" id="3813851">=</span>&nbsp;<span class="ident" id="3813853">decv</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813861">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3813872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813877">buf</span><span class="op" id="3813880">.</span><span class="ident" id="3813881">Reset</span><span class="op" id="3813886">(</span><span class="op" id="3813887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813891">valid</span>&nbsp;<span class="op" id="3813897">:=</span>&nbsp;<span class="builtintype" id="3813900">false</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813908">for</span>&nbsp;<span class="ident" id="3813912">n</span>&nbsp;<span class="op" id="3813914">:=</span>&nbsp;<span class="num" id="3813917">0</span><span class="op" id="3813918">;</span>&nbsp;<span class="op" id="3813920">;</span>&nbsp;<span class="ident" id="3813922">n</span><span class="op" id="3813923">++</span>&nbsp;<span class="op" id="3813926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3813931">simplePart</span>&nbsp;<span class="op" id="3813942">:=</span>&nbsp;<span class="ident" id="3813945">fmt</span><span class="op" id="3813948">.</span><span class="ident" id="3813949">Sprintf</span><span class="op" id="3813956">(</span><span class="string" id="3813957">&#34;%s*%d&#34;</span><span class="op" id="3813964">,</span>&nbsp;<span class="ident" id="3813966">key</span><span class="op" id="3813969">,</span>&nbsp;<span class="ident" id="3813971">n</span><span class="op" id="3813972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3813977">if</span>&nbsp;<span class="ident" id="3813980">v</span><span class="op" id="3813981">,</span>&nbsp;<span class="ident" id="3813983">ok</span>&nbsp;<span class="op" id="3813986">:=</span>&nbsp;<span class="ident" id="3813989">pieceMap</span><span class="op" id="3813997">[</span><span class="ident" id="3813998">simplePart</span><span class="op" id="3814008">]</span><span class="op" id="3814009">;</span>&nbsp;<span class="ident" id="3814011">ok</span>&nbsp;<span class="op" id="3814014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3814020">valid</span>&nbsp;<span class="op" id="3814026">=</span>&nbsp;<span class="builtintype" id="3814028">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3814037">buf</span><span class="op" id="3814040">.</span><span class="ident" id="3814041">WriteString</span><span class="op" id="3814052">(</span><span class="ident" id="3814053">v</span><span class="op" id="3814054">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3814060">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3814072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3814077">encodedPart</span>&nbsp;<span class="op" id="3814089">:=</span>&nbsp;<span class="ident" id="3814092">simplePart</span>&nbsp;<span class="op" id="3814103">+</span>&nbsp;<span class="string" id="3814105">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3814112">if</span>&nbsp;<span class="ident" id="3814115">v</span><span class="op" id="3814116">,</span>&nbsp;<span class="ident" id="3814118">ok</span>&nbsp;<span class="op" id="3814121">:=</span>&nbsp;<span class="ident" id="3814124">pieceMap</span><span class="op" id="3814132">[</span><span class="ident" id="3814133">encodedPart</span><span class="op" id="3814144">]</span><span class="op" id="3814145">;</span>&nbsp;<span class="ident" id="3814147">ok</span>&nbsp;<span class="op" id="3814150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3814156">valid</span>&nbsp;<span class="op" id="3814162">=</span>&nbsp;<span class="builtintype" id="3814164">true</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3814173">if</span>&nbsp;<span class="ident" id="3814176">n</span>&nbsp;<span class="op" id="3814178">==</span>&nbsp;<span class="num" id="3814181">0</span>&nbsp;<span class="op" id="3814183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3814190">buf</span><span class="op" id="3814193">.</span><span class="ident" id="3814194">WriteString</span><span class="op" id="3814205">(</span><span class="ident" id="3814206">decode2231Enc</span><span class="op" id="3814219">(</span><span class="ident" id="3814220">v</span><span class="op" id="3814221">)</span><span class="op" id="3814222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3814228">}</span>&nbsp;<span class="keyword" id="3814230">else</span>&nbsp;<span class="op" id="3814235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3814242">decv</span><span class="op" id="3814246">,</span>&nbsp;<span class="ident" id="3814248">_</span>&nbsp;<span class="op" id="3814250">:=</span>&nbsp;<span class="ident" id="3814253">percentHexUnescape</span><span class="op" id="3814271">(</span><span class="ident" id="3814272">v</span><span class="op" id="3814273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3814280">buf</span><span class="op" id="3814283">.</span><span class="ident" id="3814284">WriteString</span><span class="op" id="3814295">(</span><span class="ident" id="3814296">decv</span><span class="op" id="3814300">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3814306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3814311">}</span>&nbsp;<span class="keyword" id="3814313">else</span>&nbsp;<span class="op" id="3814318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3814324">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3814333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3814337">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3814341">if</span>&nbsp;<span class="ident" id="3814344">valid</span>&nbsp;<span class="op" id="3814350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3814355">params</span><span class="op" id="3814361">[</span><span class="ident" id="3814362">key</span><span class="op" id="3814365">]</span>&nbsp;<span class="op" id="3814367">=</span>&nbsp;<span class="ident" id="3814369">buf</span><span class="op" id="3814372">.</span><span class="ident" id="3814373">String</span><span class="op" id="3814379">(</span><span class="op" id="3814380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3814384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3814387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3814391">return</span><br>
<span class="lineno"></span><span class="op" id="3814398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3814401">func</span>&nbsp;<span class="ident" id="3814406">decode2231Enc</span><span class="op" id="3814419">(</span><span class="ident" id="3814420">v</span>&nbsp;<span class="builtintype" id="3814422">string</span><span class="op" id="3814428">)</span>&nbsp;<span class="builtintype" id="3814430">string</span>&nbsp;<span class="op" id="3814437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3814440">sv</span>&nbsp;<span class="op" id="3814443">:=</span>&nbsp;<span class="ident" id="3814446">strings</span><span class="op" id="3814453">.</span><span class="ident" id="3814454">SplitN</span><span class="op" id="3814460">(</span><span class="ident" id="3814461">v</span><span class="op" id="3814462">,</span>&nbsp;<span class="string" id="3814464">&#34;&#39;&#34;</span><span class="op" id="3814467">,</span>&nbsp;<span class="num" id="3814469">3</span><span class="op" id="3814470">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3814473">if</span>&nbsp;<span class="builtinfunc" id="3814476">len</span><span class="op" id="3814479">(</span><span class="ident" id="3814480">sv</span><span class="op" id="3814482">)</span>&nbsp;<span class="op" id="3814484">!=</span>&nbsp;<span class="num" id="3814487">3</span>&nbsp;<span class="op" id="3814489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3814493">return</span>&nbsp;<span class="string" id="3814500">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3814504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3814507">//&nbsp;TODO:&nbsp;ignoring&nbsp;lang&nbsp;in&nbsp;sv[1]&nbsp;for&nbsp;now.&nbsp;If&nbsp;anybody&nbsp;needs&nbsp;it&nbsp;we&#39;ll</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3814575">//&nbsp;need&nbsp;to&nbsp;decide&nbsp;how&nbsp;to&nbsp;expose&nbsp;it&nbsp;in&nbsp;the&nbsp;API.&nbsp;But&nbsp;I&#39;m&nbsp;not&nbsp;sure</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3814640">//&nbsp;anybody&nbsp;uses&nbsp;it&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3814673">charset</span>&nbsp;<span class="op" id="3814681">:=</span>&nbsp;<span class="ident" id="3814684">strings</span><span class="op" id="3814691">.</span><span class="ident" id="3814692">ToLower</span><span class="op" id="3814699">(</span><span class="ident" id="3814700">sv</span><span class="op" id="3814702">[</span><span class="num" id="3814703">0</span><span class="op" id="3814704">]</span><span class="op" id="3814705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3814708">if</span>&nbsp;<span class="ident" id="3814711">charset</span>&nbsp;<span class="op" id="3814719">!=</span>&nbsp;<span class="string" id="3814722">&#34;us-ascii&#34;</span>&nbsp;<span class="op" id="3814733">&amp;&amp;</span>&nbsp;<span class="ident" id="3814736">charset</span>&nbsp;<span class="op" id="3814744">!=</span>&nbsp;<span class="string" id="3814747">&#34;utf-8&#34;</span>&nbsp;<span class="op" id="3814755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3814759">//&nbsp;TODO:&nbsp;unsupported&nbsp;encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3814791">return</span>&nbsp;<span class="string" id="3814798">&#34;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3814802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3814805">encv</span><span class="op" id="3814809">,</span>&nbsp;<span class="ident" id="3814811">_</span>&nbsp;<span class="op" id="3814813">:=</span>&nbsp;<span class="ident" id="3814816">percentHexUnescape</span><span class="op" id="3814834">(</span><span class="ident" id="3814835">sv</span><span class="op" id="3814837">[</span><span class="num" id="3814838">2</span><span class="op" id="3814839">]</span><span class="op" id="3814840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3814843">return</span>&nbsp;<span class="ident" id="3814850">encv</span><br>
<span class="lineno"></span><span class="op" id="3814855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="3814858">func</span>&nbsp;<span class="ident" id="3814863">isNotTokenChar</span><span class="op" id="3814877">(</span><span class="ident" id="3814878">r</span>&nbsp;<span class="builtintype" id="3814880">rune</span><span class="op" id="3814884">)</span>&nbsp;<span class="builtintype" id="3814886">bool</span>&nbsp;<span class="op" id="3814891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3814894">return</span>&nbsp;<span class="op" id="3814901">!</span><span class="ident" id="3814902">isTokenChar</span><span class="op" id="3814913">(</span><span class="ident" id="3814914">r</span><span class="op" id="3814915">)</span><br>
<span class="lineno"></span><span class="op" id="3814917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3814920">//&nbsp;consumeToken&nbsp;consumes&nbsp;a&nbsp;token&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;provided</span><br>
<span class="lineno">220</span><span class="comment" id="3814984">//&nbsp;string,&nbsp;per&nbsp;RFC&nbsp;2045&nbsp;section&nbsp;5.1&nbsp;(referenced&nbsp;from&nbsp;2183),&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="3815055">//&nbsp;the&nbsp;token&nbsp;consumed&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;Returns&nbsp;(&#34;&#34;,&nbsp;v)&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3815125">//&nbsp;failure&nbsp;to&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="3815171">func</span>&nbsp;<span class="ident" id="3815176">consumeToken</span><span class="op" id="3815188">(</span><span class="ident" id="3815189">v</span>&nbsp;<span class="builtintype" id="3815191">string</span><span class="op" id="3815197">)</span>&nbsp;<span class="op" id="3815199">(</span><span class="ident" id="3815200">token</span><span class="op" id="3815205">,</span>&nbsp;<span class="ident" id="3815207">rest</span>&nbsp;<span class="builtintype" id="3815212">string</span><span class="op" id="3815218">)</span>&nbsp;<span class="op" id="3815220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3815223">notPos</span>&nbsp;<span class="op" id="3815230">:=</span>&nbsp;<span class="ident" id="3815233">strings</span><span class="op" id="3815240">.</span><span class="ident" id="3815241">IndexFunc</span><span class="op" id="3815250">(</span><span class="ident" id="3815251">v</span><span class="op" id="3815252">,</span>&nbsp;<span class="ident" id="3815254">isNotTokenChar</span><span class="op" id="3815268">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3815271">if</span>&nbsp;<span class="ident" id="3815274">notPos</span>&nbsp;<span class="op" id="3815281">==</span>&nbsp;<span class="op" id="3815284">-</span><span class="num" id="3815285">1</span>&nbsp;<span class="op" id="3815287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3815291">return</span>&nbsp;<span class="ident" id="3815298">v</span><span class="op" id="3815299">,</span>&nbsp;<span class="string" id="3815301">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3815305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3815308">if</span>&nbsp;<span class="ident" id="3815311">notPos</span>&nbsp;<span class="op" id="3815318">==</span>&nbsp;<span class="num" id="3815321">0</span>&nbsp;<span class="op" id="3815323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3815327">return</span>&nbsp;<span class="string" id="3815334">&#34;&#34;</span><span class="op" id="3815336">,</span>&nbsp;<span class="ident" id="3815338">v</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3815341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3815344">return</span>&nbsp;<span class="ident" id="3815351">v</span><span class="op" id="3815352">[</span><span class="num" id="3815353">0</span><span class="op" id="3815354">:</span><span class="ident" id="3815355">notPos</span><span class="op" id="3815361">]</span><span class="op" id="3815362">,</span>&nbsp;<span class="ident" id="3815364">v</span><span class="op" id="3815365">[</span><span class="ident" id="3815366">notPos</span><span class="op" id="3815372">:</span><span class="op" id="3815373">]</span><br>
<span class="lineno"></span><span class="op" id="3815375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3815378">//&nbsp;consumeValue&nbsp;consumes&nbsp;a&nbsp;&#34;value&#34;&nbsp;per&nbsp;RFC&nbsp;2045,&nbsp;where&nbsp;a&nbsp;value&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="3815444">//&nbsp;either&nbsp;a&nbsp;&#39;token&#39;&nbsp;or&nbsp;a&nbsp;&#39;quoted-string&#39;.&nbsp;&nbsp;On&nbsp;success,&nbsp;consumeValue</span><br>
<span class="lineno"></span><span class="comment" id="3815512">//&nbsp;returns&nbsp;the&nbsp;value&nbsp;consumed&nbsp;(and&nbsp;de-quoted/escaped,&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3815571">//&nbsp;quoted-string)&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;On&nbsp;failure,&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3815638">//&nbsp;(&#34;&#34;,&nbsp;v).</span><br>
<span class="lineno"></span><span class="keyword" id="3815650">func</span>&nbsp;<span class="ident" id="3815655">consumeValue</span><span class="op" id="3815667">(</span><span class="ident" id="3815668">v</span>&nbsp;<span class="builtintype" id="3815670">string</span><span class="op" id="3815676">)</span>&nbsp;<span class="op" id="3815678">(</span><span class="ident" id="3815679">value</span><span class="op" id="3815684">,</span>&nbsp;<span class="ident" id="3815686">rest</span>&nbsp;<span class="builtintype" id="3815691">string</span><span class="op" id="3815697">)</span>&nbsp;<span class="op" id="3815699">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3815702">if</span>&nbsp;<span class="op" id="3815705">!</span><span class="ident" id="3815706">strings</span><span class="op" id="3815713">.</span><span class="ident" id="3815714">HasPrefix</span><span class="op" id="3815723">(</span><span class="ident" id="3815724">v</span><span class="op" id="3815725">,</span>&nbsp;<span class="string" id="3815727">`&#34;`</span><span class="op" id="3815730">)</span>&nbsp;<span class="op" id="3815732">&amp;&amp;</span>&nbsp;<span class="op" id="3815735">!</span><span class="ident" id="3815736">strings</span><span class="op" id="3815743">.</span><span class="ident" id="3815744">HasPrefix</span><span class="op" id="3815753">(</span><span class="ident" id="3815754">v</span><span class="op" id="3815755">,</span>&nbsp;<span class="string" id="3815757">`&#39;`</span><span class="op" id="3815760">)</span>&nbsp;<span class="op" id="3815762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3815766">return</span>&nbsp;<span class="ident" id="3815773">consumeToken</span><span class="op" id="3815785">(</span><span class="ident" id="3815786">v</span><span class="op" id="3815787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3815790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3815794">leadQuote</span>&nbsp;<span class="op" id="3815804">:=</span>&nbsp;<span class="builtintype" id="3815807">rune</span><span class="op" id="3815811">(</span><span class="ident" id="3815812">v</span><span class="op" id="3815813">[</span><span class="num" id="3815814">0</span><span class="op" id="3815815">]</span><span class="op" id="3815816">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3815820">//&nbsp;parse&nbsp;a&nbsp;quoted-string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3815846">rest</span>&nbsp;<span class="op" id="3815851">=</span>&nbsp;<span class="ident" id="3815853">v</span><span class="op" id="3815854">[</span><span class="num" id="3815855">1</span><span class="op" id="3815856">:</span><span class="op" id="3815857">]</span>&nbsp;<span class="comment" id="3815859">//&nbsp;consume&nbsp;the&nbsp;leading&nbsp;quote</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3815889">buffer</span>&nbsp;<span class="op" id="3815896">:=</span>&nbsp;<span class="builtinfunc" id="3815899">new</span><span class="op" id="3815902">(</span><span class="ident" id="3815903">bytes</span><span class="op" id="3815908">.</span><span class="ident" id="3815909">Buffer</span><span class="op" id="3815915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3815918">var</span>&nbsp;<span class="ident" id="3815922">idx</span>&nbsp;<span class="builtintype" id="3815926">int</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3815931">var</span>&nbsp;<span class="ident" id="3815935">r</span>&nbsp;<span class="builtintype" id="3815937">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3815943">var</span>&nbsp;<span class="ident" id="3815947">nextIsLiteral</span>&nbsp;<span class="builtintype" id="3815961">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3815967">for</span>&nbsp;<span class="ident" id="3815971">idx</span><span class="op" id="3815974">,</span>&nbsp;<span class="ident" id="3815976">r</span>&nbsp;<span class="op" id="3815978">=</span>&nbsp;<span class="keyword" id="3815980">range</span>&nbsp;<span class="ident" id="3815986">rest</span>&nbsp;<span class="op" id="3815991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3815995">switch</span>&nbsp;<span class="op" id="3816002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3816006">case</span>&nbsp;<span class="ident" id="3816011">nextIsLiteral</span><span class="op" id="3816024">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3816029">buffer</span><span class="op" id="3816035">.</span><span class="ident" id="3816036">WriteRune</span><span class="op" id="3816045">(</span><span class="ident" id="3816046">r</span><span class="op" id="3816047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3816052">nextIsLiteral</span>&nbsp;<span class="op" id="3816066">=</span>&nbsp;<span class="builtintype" id="3816068">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3816076">case</span>&nbsp;<span class="ident" id="3816081">r</span>&nbsp;<span class="op" id="3816083">==</span>&nbsp;<span class="ident" id="3816086">leadQuote</span><span class="op" id="3816095">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3816100">return</span>&nbsp;<span class="ident" id="3816107">buffer</span><span class="op" id="3816113">.</span><span class="ident" id="3816114">String</span><span class="op" id="3816120">(</span><span class="op" id="3816121">)</span><span class="op" id="3816122">,</span>&nbsp;<span class="ident" id="3816124">rest</span><span class="op" id="3816128">[</span><span class="ident" id="3816129">idx</span><span class="op" id="3816132">+</span><span class="num" id="3816133">1</span><span class="op" id="3816134">:</span><span class="op" id="3816135">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3816139">case</span>&nbsp;<span class="ident" id="3816144">r</span>&nbsp;<span class="op" id="3816146">==</span>&nbsp;<span class="string" id="3816149">&#39;\\&#39;</span><span class="op" id="3816153">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3816158">nextIsLiteral</span>&nbsp;<span class="op" id="3816172">=</span>&nbsp;<span class="builtintype" id="3816174">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3816181">case</span>&nbsp;<span class="ident" id="3816186">r</span>&nbsp;<span class="op" id="3816188">!=</span>&nbsp;<span class="string" id="3816191">&#39;\r&#39;</span>&nbsp;<span class="op" id="3816196">&amp;&amp;</span>&nbsp;<span class="ident" id="3816199">r</span>&nbsp;<span class="op" id="3816201">!=</span>&nbsp;<span class="string" id="3816204">&#39;\n&#39;</span><span class="op" id="3816208">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3816213">buffer</span><span class="op" id="3816219">.</span><span class="ident" id="3816220">WriteRune</span><span class="op" id="3816229">(</span><span class="ident" id="3816230">r</span><span class="op" id="3816231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3816235">default</span><span class="op" id="3816242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3816247">return</span>&nbsp;<span class="string" id="3816254">&#34;&#34;</span><span class="op" id="3816256">,</span>&nbsp;<span class="ident" id="3816258">v</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3816262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3816265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3816268">return</span>&nbsp;<span class="string" id="3816275">&#34;&#34;</span><span class="op" id="3816277">,</span>&nbsp;<span class="ident" id="3816279">v</span><br>
<span class="lineno"></span><span class="op" id="3816281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="3816284">func</span>&nbsp;<span class="ident" id="3816289">consumeMediaParam</span><span class="op" id="3816306">(</span><span class="ident" id="3816307">v</span>&nbsp;<span class="builtintype" id="3816309">string</span><span class="op" id="3816315">)</span>&nbsp;<span class="op" id="3816317">(</span><span class="ident" id="3816318">param</span><span class="op" id="3816323">,</span>&nbsp;<span class="ident" id="3816325">value</span><span class="op" id="3816330">,</span>&nbsp;<span class="ident" id="3816332">rest</span>&nbsp;<span class="builtintype" id="3816337">string</span><span class="op" id="3816343">)</span>&nbsp;<span class="op" id="3816345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3816348">rest</span>&nbsp;<span class="op" id="3816353">=</span>&nbsp;<span class="ident" id="3816355">strings</span><span class="op" id="3816362">.</span><span class="ident" id="3816363">TrimLeftFunc</span><span class="op" id="3816375">(</span><span class="ident" id="3816376">v</span><span class="op" id="3816377">,</span>&nbsp;<span class="ident" id="3816379">unicode</span><span class="op" id="3816386">.</span><span class="ident" id="3816387">IsSpace</span><span class="op" id="3816394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3816397">if</span>&nbsp;<span class="op" id="3816400">!</span><span class="ident" id="3816401">strings</span><span class="op" id="3816408">.</span><span class="ident" id="3816409">HasPrefix</span><span class="op" id="3816418">(</span><span class="ident" id="3816419">rest</span><span class="op" id="3816423">,</span>&nbsp;<span class="string" id="3816425">&#34;;&#34;</span><span class="op" id="3816428">)</span>&nbsp;<span class="op" id="3816430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3816434">return</span>&nbsp;<span class="string" id="3816441">&#34;&#34;</span><span class="op" id="3816443">,</span>&nbsp;<span class="string" id="3816445">&#34;&#34;</span><span class="op" id="3816447">,</span>&nbsp;<span class="ident" id="3816449">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3816452">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3816456">rest</span>&nbsp;<span class="op" id="3816461">=</span>&nbsp;<span class="ident" id="3816463">rest</span><span class="op" id="3816467">[</span><span class="num" id="3816468">1</span><span class="op" id="3816469">:</span><span class="op" id="3816470">]</span>&nbsp;<span class="comment" id="3816472">//&nbsp;consume&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3816494">rest</span>&nbsp;<span class="op" id="3816499">=</span>&nbsp;<span class="ident" id="3816501">strings</span><span class="op" id="3816508">.</span><span class="ident" id="3816509">TrimLeftFunc</span><span class="op" id="3816521">(</span><span class="ident" id="3816522">rest</span><span class="op" id="3816526">,</span>&nbsp;<span class="ident" id="3816528">unicode</span><span class="op" id="3816535">.</span><span class="ident" id="3816536">IsSpace</span><span class="op" id="3816543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3816546">param</span><span class="op" id="3816551">,</span>&nbsp;<span class="ident" id="3816553">rest</span>&nbsp;<span class="op" id="3816558">=</span>&nbsp;<span class="ident" id="3816560">consumeToken</span><span class="op" id="3816572">(</span><span class="ident" id="3816573">rest</span><span class="op" id="3816577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3816580">param</span>&nbsp;<span class="op" id="3816586">=</span>&nbsp;<span class="ident" id="3816588">strings</span><span class="op" id="3816595">.</span><span class="ident" id="3816596">ToLower</span><span class="op" id="3816603">(</span><span class="ident" id="3816604">param</span><span class="op" id="3816609">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3816612">if</span>&nbsp;<span class="ident" id="3816615">param</span>&nbsp;<span class="op" id="3816621">==</span>&nbsp;<span class="string" id="3816624">&#34;&#34;</span>&nbsp;<span class="op" id="3816627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3816631">return</span>&nbsp;<span class="string" id="3816638">&#34;&#34;</span><span class="op" id="3816640">,</span>&nbsp;<span class="string" id="3816642">&#34;&#34;</span><span class="op" id="3816644">,</span>&nbsp;<span class="ident" id="3816646">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3816649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3816653">rest</span>&nbsp;<span class="op" id="3816658">=</span>&nbsp;<span class="ident" id="3816660">strings</span><span class="op" id="3816667">.</span><span class="ident" id="3816668">TrimLeftFunc</span><span class="op" id="3816680">(</span><span class="ident" id="3816681">rest</span><span class="op" id="3816685">,</span>&nbsp;<span class="ident" id="3816687">unicode</span><span class="op" id="3816694">.</span><span class="ident" id="3816695">IsSpace</span><span class="op" id="3816702">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3816705">if</span>&nbsp;<span class="op" id="3816708">!</span><span class="ident" id="3816709">strings</span><span class="op" id="3816716">.</span><span class="ident" id="3816717">HasPrefix</span><span class="op" id="3816726">(</span><span class="ident" id="3816727">rest</span><span class="op" id="3816731">,</span>&nbsp;<span class="string" id="3816733">&#34;=&#34;</span><span class="op" id="3816736">)</span>&nbsp;<span class="op" id="3816738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3816742">return</span>&nbsp;<span class="string" id="3816749">&#34;&#34;</span><span class="op" id="3816751">,</span>&nbsp;<span class="string" id="3816753">&#34;&#34;</span><span class="op" id="3816755">,</span>&nbsp;<span class="ident" id="3816757">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3816760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3816763">rest</span>&nbsp;<span class="op" id="3816768">=</span>&nbsp;<span class="ident" id="3816770">rest</span><span class="op" id="3816774">[</span><span class="num" id="3816775">1</span><span class="op" id="3816776">:</span><span class="op" id="3816777">]</span>&nbsp;<span class="comment" id="3816779">//&nbsp;consume&nbsp;equals&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3816803">rest</span>&nbsp;<span class="op" id="3816808">=</span>&nbsp;<span class="ident" id="3816810">strings</span><span class="op" id="3816817">.</span><span class="ident" id="3816818">TrimLeftFunc</span><span class="op" id="3816830">(</span><span class="ident" id="3816831">rest</span><span class="op" id="3816835">,</span>&nbsp;<span class="ident" id="3816837">unicode</span><span class="op" id="3816844">.</span><span class="ident" id="3816845">IsSpace</span><span class="op" id="3816852">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3816855">value</span><span class="op" id="3816860">,</span>&nbsp;<span class="ident" id="3816862">rest</span>&nbsp;<span class="op" id="3816867">=</span>&nbsp;<span class="ident" id="3816869">consumeValue</span><span class="op" id="3816881">(</span><span class="ident" id="3816882">rest</span><span class="op" id="3816886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3816889">if</span>&nbsp;<span class="ident" id="3816892">value</span>&nbsp;<span class="op" id="3816898">==</span>&nbsp;<span class="string" id="3816901">&#34;&#34;</span>&nbsp;<span class="op" id="3816904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3816908">return</span>&nbsp;<span class="string" id="3816915">&#34;&#34;</span><span class="op" id="3816917">,</span>&nbsp;<span class="string" id="3816919">&#34;&#34;</span><span class="op" id="3816921">,</span>&nbsp;<span class="ident" id="3816923">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3816926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3816929">return</span>&nbsp;<span class="ident" id="3816936">param</span><span class="op" id="3816941">,</span>&nbsp;<span class="ident" id="3816943">value</span><span class="op" id="3816948">,</span>&nbsp;<span class="ident" id="3816950">rest</span><br>
<span class="lineno">295</span><span class="op" id="3816955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3816958">func</span>&nbsp;<span class="ident" id="3816963">percentHexUnescape</span><span class="op" id="3816981">(</span><span class="ident" id="3816982">s</span>&nbsp;<span class="builtintype" id="3816984">string</span><span class="op" id="3816990">)</span>&nbsp;<span class="op" id="3816992">(</span><span class="builtintype" id="3816993">string</span><span class="op" id="3816999">,</span>&nbsp;<span class="builtintype" id="3817001">error</span><span class="op" id="3817006">)</span>&nbsp;<span class="op" id="3817008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817011">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817056">percents</span>&nbsp;<span class="op" id="3817065">:=</span>&nbsp;<span class="num" id="3817068">0</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817071">for</span>&nbsp;<span class="ident" id="3817075">i</span>&nbsp;<span class="op" id="3817077">:=</span>&nbsp;<span class="num" id="3817080">0</span><span class="op" id="3817081">;</span>&nbsp;<span class="ident" id="3817083">i</span>&nbsp;<span class="op" id="3817085">&lt;</span>&nbsp;<span class="builtinfunc" id="3817087">len</span><span class="op" id="3817090">(</span><span class="ident" id="3817091">s</span><span class="op" id="3817092">)</span><span class="op" id="3817093">;</span>&nbsp;<span class="op" id="3817095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817099">if</span>&nbsp;<span class="ident" id="3817102">s</span><span class="op" id="3817103">[</span><span class="ident" id="3817104">i</span><span class="op" id="3817105">]</span>&nbsp;<span class="op" id="3817107">!=</span>&nbsp;<span class="string" id="3817110">&#39;%&#39;</span>&nbsp;<span class="op" id="3817114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817119">i</span><span class="op" id="3817120">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817126">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3817137">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817141">percents</span><span class="op" id="3817149">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817154">if</span>&nbsp;<span class="ident" id="3817157">i</span><span class="op" id="3817158">+</span><span class="num" id="3817159">2</span>&nbsp;<span class="op" id="3817161">&gt;=</span>&nbsp;<span class="builtinfunc" id="3817164">len</span><span class="op" id="3817167">(</span><span class="ident" id="3817168">s</span><span class="op" id="3817169">)</span>&nbsp;<span class="op" id="3817171">||</span>&nbsp;<span class="op" id="3817174">!</span><span class="ident" id="3817175">ishex</span><span class="op" id="3817180">(</span><span class="ident" id="3817181">s</span><span class="op" id="3817182">[</span><span class="ident" id="3817183">i</span><span class="op" id="3817184">+</span><span class="num" id="3817185">1</span><span class="op" id="3817186">]</span><span class="op" id="3817187">)</span>&nbsp;<span class="op" id="3817189">||</span>&nbsp;<span class="op" id="3817192">!</span><span class="ident" id="3817193">ishex</span><span class="op" id="3817198">(</span><span class="ident" id="3817199">s</span><span class="op" id="3817200">[</span><span class="ident" id="3817201">i</span><span class="op" id="3817202">+</span><span class="num" id="3817203">2</span><span class="op" id="3817204">]</span><span class="op" id="3817205">)</span>&nbsp;<span class="op" id="3817207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817212">s</span>&nbsp;<span class="op" id="3817214">=</span>&nbsp;<span class="ident" id="3817216">s</span><span class="op" id="3817217">[</span><span class="ident" id="3817218">i</span><span class="op" id="3817219">:</span><span class="op" id="3817220">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817225">if</span>&nbsp;<span class="builtinfunc" id="3817228">len</span><span class="op" id="3817231">(</span><span class="ident" id="3817232">s</span><span class="op" id="3817233">)</span>&nbsp;<span class="op" id="3817235">&gt;</span>&nbsp;<span class="num" id="3817237">3</span>&nbsp;<span class="op" id="3817239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817245">s</span>&nbsp;<span class="op" id="3817247">=</span>&nbsp;<span class="ident" id="3817249">s</span><span class="op" id="3817250">[</span><span class="num" id="3817251">0</span><span class="op" id="3817252">:</span><span class="num" id="3817253">3</span><span class="op" id="3817254">]</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3817259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817264">return</span>&nbsp;<span class="string" id="3817271">&#34;&#34;</span><span class="op" id="3817273">,</span>&nbsp;<span class="ident" id="3817275">fmt</span><span class="op" id="3817278">.</span><span class="ident" id="3817279">Errorf</span><span class="op" id="3817285">(</span><span class="string" id="3817286">&#34;mime:&nbsp;bogus&nbsp;characters&nbsp;after&nbsp;%%:&nbsp;%q&#34;</span><span class="op" id="3817323">,</span>&nbsp;<span class="ident" id="3817325">s</span><span class="op" id="3817326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3817330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817334">i</span>&nbsp;<span class="op" id="3817336">+=</span>&nbsp;<span class="num" id="3817339">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3817342">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817345">if</span>&nbsp;<span class="ident" id="3817348">percents</span>&nbsp;<span class="op" id="3817357">==</span>&nbsp;<span class="num" id="3817360">0</span>&nbsp;<span class="op" id="3817362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817366">return</span>&nbsp;<span class="ident" id="3817373">s</span><span class="op" id="3817374">,</span>&nbsp;<span class="ident" id="3817376">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3817381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817385">t</span>&nbsp;<span class="op" id="3817387">:=</span>&nbsp;<span class="builtinfunc" id="3817390">make</span><span class="op" id="3817394">(</span><span class="op" id="3817395">[</span><span class="op" id="3817396">]</span><span class="builtintype" id="3817397">byte</span><span class="op" id="3817401">,</span>&nbsp;<span class="builtinfunc" id="3817403">len</span><span class="op" id="3817406">(</span><span class="ident" id="3817407">s</span><span class="op" id="3817408">)</span><span class="op" id="3817409">-</span><span class="num" id="3817410">2</span><span class="op" id="3817411">*</span><span class="ident" id="3817412">percents</span><span class="op" id="3817420">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817423">j</span>&nbsp;<span class="op" id="3817425">:=</span>&nbsp;<span class="num" id="3817428">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817431">for</span>&nbsp;<span class="ident" id="3817435">i</span>&nbsp;<span class="op" id="3817437">:=</span>&nbsp;<span class="num" id="3817440">0</span><span class="op" id="3817441">;</span>&nbsp;<span class="ident" id="3817443">i</span>&nbsp;<span class="op" id="3817445">&lt;</span>&nbsp;<span class="builtinfunc" id="3817447">len</span><span class="op" id="3817450">(</span><span class="ident" id="3817451">s</span><span class="op" id="3817452">)</span><span class="op" id="3817453">;</span>&nbsp;<span class="op" id="3817455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817459">switch</span>&nbsp;<span class="ident" id="3817466">s</span><span class="op" id="3817467">[</span><span class="ident" id="3817468">i</span><span class="op" id="3817469">]</span>&nbsp;<span class="op" id="3817471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817475">case</span>&nbsp;<span class="string" id="3817480">&#39;%&#39;</span><span class="op" id="3817483">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817488">t</span><span class="op" id="3817489">[</span><span class="ident" id="3817490">j</span><span class="op" id="3817491">]</span>&nbsp;<span class="op" id="3817493">=</span>&nbsp;<span class="ident" id="3817495">unhex</span><span class="op" id="3817500">(</span><span class="ident" id="3817501">s</span><span class="op" id="3817502">[</span><span class="ident" id="3817503">i</span><span class="op" id="3817504">+</span><span class="num" id="3817505">1</span><span class="op" id="3817506">]</span><span class="op" id="3817507">)</span><span class="op" id="3817508">&lt;&lt;</span><span class="num" id="3817510">4</span>&nbsp;<span class="op" id="3817512">|</span>&nbsp;<span class="ident" id="3817514">unhex</span><span class="op" id="3817519">(</span><span class="ident" id="3817520">s</span><span class="op" id="3817521">[</span><span class="ident" id="3817522">i</span><span class="op" id="3817523">+</span><span class="num" id="3817524">2</span><span class="op" id="3817525">]</span><span class="op" id="3817526">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817531">j</span><span class="op" id="3817532">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817538">i</span>&nbsp;<span class="op" id="3817540">+=</span>&nbsp;<span class="num" id="3817543">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817547">default</span><span class="op" id="3817554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817559">t</span><span class="op" id="3817560">[</span><span class="ident" id="3817561">j</span><span class="op" id="3817562">]</span>&nbsp;<span class="op" id="3817564">=</span>&nbsp;<span class="ident" id="3817566">s</span><span class="op" id="3817567">[</span><span class="ident" id="3817568">i</span><span class="op" id="3817569">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817574">j</span><span class="op" id="3817575">++</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817581">i</span><span class="op" id="3817582">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3817587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3817590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817593">return</span>&nbsp;<span class="builtintype" id="3817600">string</span><span class="op" id="3817606">(</span><span class="ident" id="3817607">t</span><span class="op" id="3817608">)</span><span class="op" id="3817609">,</span>&nbsp;<span class="ident" id="3817611">nil</span><br>
<span class="lineno"></span><span class="op" id="3817615">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="keyword" id="3817618">func</span>&nbsp;<span class="ident" id="3817623">ishex</span><span class="op" id="3817628">(</span><span class="ident" id="3817629">c</span>&nbsp;<span class="builtintype" id="3817631">byte</span><span class="op" id="3817635">)</span>&nbsp;<span class="builtintype" id="3817637">bool</span>&nbsp;<span class="op" id="3817642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817645">switch</span>&nbsp;<span class="op" id="3817652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817655">case</span>&nbsp;<span class="string" id="3817660">&#39;0&#39;</span>&nbsp;<span class="op" id="3817664">&lt;=</span>&nbsp;<span class="ident" id="3817667">c</span>&nbsp;<span class="op" id="3817669">&amp;&amp;</span>&nbsp;<span class="ident" id="3817672">c</span>&nbsp;<span class="op" id="3817674">&lt;=</span>&nbsp;<span class="string" id="3817677">&#39;9&#39;</span><span class="op" id="3817680">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817684">return</span>&nbsp;<span class="builtintype" id="3817691">true</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817697">case</span>&nbsp;<span class="string" id="3817702">&#39;a&#39;</span>&nbsp;<span class="op" id="3817706">&lt;=</span>&nbsp;<span class="ident" id="3817709">c</span>&nbsp;<span class="op" id="3817711">&amp;&amp;</span>&nbsp;<span class="ident" id="3817714">c</span>&nbsp;<span class="op" id="3817716">&lt;=</span>&nbsp;<span class="string" id="3817719">&#39;f&#39;</span><span class="op" id="3817722">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817726">return</span>&nbsp;<span class="builtintype" id="3817733">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817739">case</span>&nbsp;<span class="string" id="3817744">&#39;A&#39;</span>&nbsp;<span class="op" id="3817748">&lt;=</span>&nbsp;<span class="ident" id="3817751">c</span>&nbsp;<span class="op" id="3817753">&amp;&amp;</span>&nbsp;<span class="ident" id="3817756">c</span>&nbsp;<span class="op" id="3817758">&lt;=</span>&nbsp;<span class="string" id="3817761">&#39;F&#39;</span><span class="op" id="3817764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817768">return</span>&nbsp;<span class="builtintype" id="3817775">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3817781">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817784">return</span>&nbsp;<span class="builtintype" id="3817791">false</span><br>
<span class="lineno"></span><span class="op" id="3817797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3817800">func</span>&nbsp;<span class="ident" id="3817805">unhex</span><span class="op" id="3817810">(</span><span class="ident" id="3817811">c</span>&nbsp;<span class="builtintype" id="3817813">byte</span><span class="op" id="3817817">)</span>&nbsp;<span class="builtintype" id="3817819">byte</span>&nbsp;<span class="op" id="3817824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817827">switch</span>&nbsp;<span class="op" id="3817834">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817837">case</span>&nbsp;<span class="string" id="3817842">&#39;0&#39;</span>&nbsp;<span class="op" id="3817846">&lt;=</span>&nbsp;<span class="ident" id="3817849">c</span>&nbsp;<span class="op" id="3817851">&amp;&amp;</span>&nbsp;<span class="ident" id="3817854">c</span>&nbsp;<span class="op" id="3817856">&lt;=</span>&nbsp;<span class="string" id="3817859">&#39;9&#39;</span><span class="op" id="3817862">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817866">return</span>&nbsp;<span class="ident" id="3817873">c</span>&nbsp;<span class="op" id="3817875">-</span>&nbsp;<span class="string" id="3817877">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817882">case</span>&nbsp;<span class="string" id="3817887">&#39;a&#39;</span>&nbsp;<span class="op" id="3817891">&lt;=</span>&nbsp;<span class="ident" id="3817894">c</span>&nbsp;<span class="op" id="3817896">&amp;&amp;</span>&nbsp;<span class="ident" id="3817899">c</span>&nbsp;<span class="op" id="3817901">&lt;=</span>&nbsp;<span class="string" id="3817904">&#39;f&#39;</span><span class="op" id="3817907">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817911">return</span>&nbsp;<span class="ident" id="3817918">c</span>&nbsp;<span class="op" id="3817920">-</span>&nbsp;<span class="string" id="3817922">&#39;a&#39;</span>&nbsp;<span class="op" id="3817926">+</span>&nbsp;<span class="num" id="3817928">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817932">case</span>&nbsp;<span class="string" id="3817937">&#39;A&#39;</span>&nbsp;<span class="op" id="3817941">&lt;=</span>&nbsp;<span class="ident" id="3817944">c</span>&nbsp;<span class="op" id="3817946">&amp;&amp;</span>&nbsp;<span class="ident" id="3817949">c</span>&nbsp;<span class="op" id="3817951">&lt;=</span>&nbsp;<span class="string" id="3817954">&#39;F&#39;</span><span class="op" id="3817957">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817961">return</span>&nbsp;<span class="ident" id="3817968">c</span>&nbsp;<span class="op" id="3817970">-</span>&nbsp;<span class="string" id="3817972">&#39;A&#39;</span>&nbsp;<span class="op" id="3817976">+</span>&nbsp;<span class="num" id="3817978">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3817982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817985">return</span>&nbsp;<span class="num" id="3817992">0</span><br>
<span class="lineno"></span><span class="op" id="3817994">}</span>
</div>
</body>
</html>
