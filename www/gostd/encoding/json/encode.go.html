<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4896284">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4896340">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4896394">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4896445">//&nbsp;Package&nbsp;json&nbsp;implements&nbsp;encoding&nbsp;and&nbsp;decoding&nbsp;of&nbsp;JSON&nbsp;objects&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4896524">//&nbsp;RFC&nbsp;4627.&nbsp;The&nbsp;mapping&nbsp;between&nbsp;JSON&nbsp;objects&nbsp;and&nbsp;Go&nbsp;values&nbsp;is&nbsp;described</span><br>
<span class="lineno"></span><span class="comment" id="4896597">//&nbsp;in&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Marshal&nbsp;and&nbsp;Unmarshal&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="4896662">//</span><br>
<span class="lineno"></span><span class="comment" id="4896665">//&nbsp;See&nbsp;&#34;JSON&nbsp;and&nbsp;Go&#34;&nbsp;for&nbsp;an&nbsp;introduction&nbsp;to&nbsp;this&nbsp;package:</span><br>
<span class="lineno">10</span><span class="comment" id="4896723">//&nbsp;http://golang.org/doc/articles/json_and_go.html</span><br>
<span class="lineno"></span><span class="keyword" id="4896774">package</span>&nbsp;<span class="ident" id="4896782">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4896788">import</span>&nbsp;<span class="op" id="4896795">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4896798">&#34;bytes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4896807">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4896819">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4896838">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4896846">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4896857">&#34;runtime&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4896868">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4896876">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4896887">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4896898">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4896906">&#34;unicode&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4896917">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4896932">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4896935">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="4896978">//</span><br>
<span class="lineno">30</span><span class="comment" id="4896981">//&nbsp;Marshal&nbsp;traverses&nbsp;the&nbsp;value&nbsp;v&nbsp;recursively.</span><br>
<span class="lineno"></span><span class="comment" id="4897027">//&nbsp;If&nbsp;an&nbsp;encountered&nbsp;value&nbsp;implements&nbsp;the&nbsp;Marshaler&nbsp;interface</span><br>
<span class="lineno"></span><span class="comment" id="4897089">//&nbsp;and&nbsp;is&nbsp;not&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;Marshal&nbsp;calls&nbsp;its&nbsp;MarshalJSON&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="4897155">//&nbsp;to&nbsp;produce&nbsp;JSON.&nbsp;&nbsp;The&nbsp;nil&nbsp;pointer&nbsp;exception&nbsp;is&nbsp;not&nbsp;strictly&nbsp;necessary</span><br>
<span class="lineno"></span><span class="comment" id="4897228">//&nbsp;but&nbsp;mimics&nbsp;a&nbsp;similar,&nbsp;necessary&nbsp;exception&nbsp;in&nbsp;the&nbsp;behavior&nbsp;of</span><br>
<span class="lineno">35</span><span class="comment" id="4897292">//&nbsp;UnmarshalJSON.</span><br>
<span class="lineno"></span><span class="comment" id="4897310">//</span><br>
<span class="lineno"></span><span class="comment" id="4897313">//&nbsp;Otherwise,&nbsp;Marshal&nbsp;uses&nbsp;the&nbsp;following&nbsp;type-dependent&nbsp;default&nbsp;encodings:</span><br>
<span class="lineno"></span><span class="comment" id="4897388">//</span><br>
<span class="lineno"></span><span class="comment" id="4897391">//&nbsp;Boolean&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;booleans.</span><br>
<span class="lineno">40</span><span class="comment" id="4897434">//</span><br>
<span class="lineno"></span><span class="comment" id="4897437">//&nbsp;Floating&nbsp;point,&nbsp;integer,&nbsp;and&nbsp;Number&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;numbers.</span><br>
<span class="lineno"></span><span class="comment" id="4897507">//</span><br>
<span class="lineno"></span><span class="comment" id="4897510">//&nbsp;String&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;strings&nbsp;coerced&nbsp;to&nbsp;valid&nbsp;UTF-8,</span><br>
<span class="lineno"></span><span class="comment" id="4897574">//&nbsp;replacing&nbsp;invalid&nbsp;bytes&nbsp;with&nbsp;the&nbsp;Unicode&nbsp;replacement&nbsp;rune.</span><br>
<span class="lineno">45</span><span class="comment" id="4897636">//&nbsp;The&nbsp;angle&nbsp;brackets&nbsp;&#34;&lt;&#34;&nbsp;and&nbsp;&#34;&gt;&#34;&nbsp;are&nbsp;escaped&nbsp;to&nbsp;&#34;\u003c&#34;&nbsp;and&nbsp;&#34;\u003e&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4897707">//&nbsp;to&nbsp;keep&nbsp;some&nbsp;browsers&nbsp;from&nbsp;misinterpreting&nbsp;JSON&nbsp;output&nbsp;as&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="4897774">//&nbsp;Ampersand&nbsp;&#34;&amp;&#34;&nbsp;is&nbsp;also&nbsp;escaped&nbsp;to&nbsp;&#34;\u0026&#34;&nbsp;for&nbsp;the&nbsp;same&nbsp;reason.</span><br>
<span class="lineno"></span><span class="comment" id="4897840">//</span><br>
<span class="lineno"></span><span class="comment" id="4897843">//&nbsp;Array&nbsp;and&nbsp;slice&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;arrays,&nbsp;except&nbsp;that</span><br>
<span class="lineno">50</span><span class="comment" id="4897904">//&nbsp;[]byte&nbsp;encodes&nbsp;as&nbsp;a&nbsp;base64-encoded&nbsp;string,&nbsp;and&nbsp;a&nbsp;nil&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="4897966">//&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="4898002">//</span><br>
<span class="lineno"></span><span class="comment" id="4898005">//&nbsp;Struct&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;objects.&nbsp;Each&nbsp;exported&nbsp;struct&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="4898073">//&nbsp;becomes&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;object&nbsp;unless</span><br>
<span class="lineno">55</span><span class="comment" id="4898114">//&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;field&#39;s&nbsp;tag&nbsp;is&nbsp;&#34;-&#34;,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4898148">//&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;field&nbsp;is&nbsp;empty&nbsp;and&nbsp;its&nbsp;tag&nbsp;specifies&nbsp;the&nbsp;&#34;omitempty&#34;&nbsp;option.</span><br>
<span class="lineno"></span><span class="comment" id="4898220">//&nbsp;The&nbsp;empty&nbsp;values&nbsp;are&nbsp;false,&nbsp;0,&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="4898258">//&nbsp;nil&nbsp;pointer&nbsp;or&nbsp;interface&nbsp;value,&nbsp;and&nbsp;any&nbsp;array,&nbsp;slice,&nbsp;map,&nbsp;or&nbsp;string&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4898333">//&nbsp;length&nbsp;zero.&nbsp;The&nbsp;object&#39;s&nbsp;default&nbsp;key&nbsp;string&nbsp;is&nbsp;the&nbsp;struct&nbsp;field&nbsp;name</span><br>
<span class="lineno">60</span><span class="comment" id="4898406">//&nbsp;but&nbsp;can&nbsp;be&nbsp;specified&nbsp;in&nbsp;the&nbsp;struct&nbsp;field&#39;s&nbsp;tag&nbsp;value.&nbsp;The&nbsp;&#34;json&#34;&nbsp;key&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4898481">//&nbsp;the&nbsp;struct&nbsp;field&#39;s&nbsp;tag&nbsp;value&nbsp;is&nbsp;the&nbsp;key&nbsp;name,&nbsp;followed&nbsp;by&nbsp;an&nbsp;optional&nbsp;comma</span><br>
<span class="lineno"></span><span class="comment" id="4898560">//&nbsp;and&nbsp;options.&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="4898586">//</span><br>
<span class="lineno"></span><span class="comment" id="4898589">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;this&nbsp;package.</span><br>
<span class="lineno">65</span><span class="comment" id="4898631">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="4898657">//</span><br>
<span class="lineno"></span><span class="comment" id="4898660">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;myName&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4898707">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;myName&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="4898738">//</span><br>
<span class="lineno">70</span><span class="comment" id="4898741">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;myName&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4898791">//&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;field&nbsp;is&nbsp;omitted&nbsp;from&nbsp;the&nbsp;object&nbsp;if&nbsp;its&nbsp;value&nbsp;is&nbsp;empty,</span><br>
<span class="lineno"></span><span class="comment" id="4898859">//&nbsp;&nbsp;&nbsp;//&nbsp;as&nbsp;defined&nbsp;above.</span><br>
<span class="lineno"></span><span class="comment" id="4898885">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;myName,omitempty&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="4898926">//</span><br>
<span class="lineno">75</span><span class="comment" id="4898929">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;Field&#34;&nbsp;(the&nbsp;default),&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="4898993">//&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;field&nbsp;is&nbsp;skipped&nbsp;if&nbsp;empty.</span><br>
<span class="lineno"></span><span class="comment" id="4899032">//&nbsp;&nbsp;&nbsp;//&nbsp;Note&nbsp;the&nbsp;leading&nbsp;comma.</span><br>
<span class="lineno"></span><span class="comment" id="4899064">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="4899099">//</span><br>
<span class="lineno">80</span><span class="comment" id="4899102">//&nbsp;The&nbsp;&#34;string&#34;&nbsp;option&nbsp;signals&nbsp;that&nbsp;a&nbsp;field&nbsp;is&nbsp;stored&nbsp;as&nbsp;JSON&nbsp;inside&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4899173">//&nbsp;JSON-encoded&nbsp;string.&nbsp;It&nbsp;applies&nbsp;only&nbsp;to&nbsp;fields&nbsp;of&nbsp;string,&nbsp;floating&nbsp;point,</span><br>
<span class="lineno"></span><span class="comment" id="4899250">//&nbsp;or&nbsp;integer&nbsp;types.&nbsp;This&nbsp;extra&nbsp;level&nbsp;of&nbsp;encoding&nbsp;is&nbsp;sometimes&nbsp;used&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="4899323">//&nbsp;communicating&nbsp;with&nbsp;JavaScript&nbsp;programs:</span><br>
<span class="lineno"></span><span class="comment" id="4899366">//</span><br>
<span class="lineno">85</span><span class="comment" id="4899369">//&nbsp;&nbsp;&nbsp;&nbsp;Int64String&nbsp;int64&nbsp;`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="4899410">//</span><br>
<span class="lineno"></span><span class="comment" id="4899413">//&nbsp;The&nbsp;key&nbsp;name&nbsp;will&nbsp;be&nbsp;used&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;non-empty&nbsp;string&nbsp;consisting&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4899483">//&nbsp;only&nbsp;Unicode&nbsp;letters,&nbsp;digits,&nbsp;dollar&nbsp;signs,&nbsp;percent&nbsp;signs,&nbsp;hyphens,</span><br>
<span class="lineno"></span><span class="comment" id="4899554">//&nbsp;underscores&nbsp;and&nbsp;slashes.</span><br>
<span class="lineno">90</span><span class="comment" id="4899582">//</span><br>
<span class="lineno"></span><span class="comment" id="4899585">//&nbsp;Anonymous&nbsp;struct&nbsp;fields&nbsp;are&nbsp;usually&nbsp;marshaled&nbsp;as&nbsp;if&nbsp;their&nbsp;inner&nbsp;exported&nbsp;fields</span><br>
<span class="lineno"></span><span class="comment" id="4899668">//&nbsp;were&nbsp;fields&nbsp;in&nbsp;the&nbsp;outer&nbsp;struct,&nbsp;subject&nbsp;to&nbsp;the&nbsp;usual&nbsp;Go&nbsp;visibility&nbsp;rules&nbsp;amended</span><br>
<span class="lineno"></span><span class="comment" id="4899753">//&nbsp;as&nbsp;described&nbsp;in&nbsp;the&nbsp;next&nbsp;paragraph.</span><br>
<span class="lineno"></span><span class="comment" id="4899792">//&nbsp;An&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;given&nbsp;in&nbsp;its&nbsp;JSON&nbsp;tag&nbsp;is&nbsp;treated&nbsp;as</span><br>
<span class="lineno">95</span><span class="comment" id="4899869">//&nbsp;having&nbsp;that&nbsp;name,&nbsp;rather&nbsp;than&nbsp;being&nbsp;anonymous.</span><br>
<span class="lineno"></span><span class="comment" id="4899919">//&nbsp;An&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;of&nbsp;interface&nbsp;type&nbsp;is&nbsp;treated&nbsp;the&nbsp;same&nbsp;as&nbsp;having</span><br>
<span class="lineno"></span><span class="comment" id="4899996">//&nbsp;that&nbsp;type&nbsp;as&nbsp;its&nbsp;name,&nbsp;rather&nbsp;than&nbsp;being&nbsp;anonymous.</span><br>
<span class="lineno"></span><span class="comment" id="4900051">//</span><br>
<span class="lineno"></span><span class="comment" id="4900054">//&nbsp;The&nbsp;Go&nbsp;visibility&nbsp;rules&nbsp;for&nbsp;struct&nbsp;fields&nbsp;are&nbsp;amended&nbsp;for&nbsp;JSON&nbsp;when</span><br>
<span class="lineno">100</span><span class="comment" id="4900125">//&nbsp;deciding&nbsp;which&nbsp;field&nbsp;to&nbsp;marshal&nbsp;or&nbsp;unmarshal.&nbsp;If&nbsp;there&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4900187">//&nbsp;multiple&nbsp;fields&nbsp;at&nbsp;the&nbsp;same&nbsp;level,&nbsp;and&nbsp;that&nbsp;level&nbsp;is&nbsp;the&nbsp;least</span><br>
<span class="lineno"></span><span class="comment" id="4900253">//&nbsp;nested&nbsp;(and&nbsp;would&nbsp;therefore&nbsp;be&nbsp;the&nbsp;nesting&nbsp;level&nbsp;selected&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4900321">//&nbsp;usual&nbsp;Go&nbsp;rules),&nbsp;the&nbsp;following&nbsp;extra&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="4900374">//</span><br>
<span class="lineno">105</span><span class="comment" id="4900377">//&nbsp;1)&nbsp;Of&nbsp;those&nbsp;fields,&nbsp;if&nbsp;any&nbsp;are&nbsp;JSON-tagged,&nbsp;only&nbsp;tagged&nbsp;fields&nbsp;are&nbsp;considered,</span><br>
<span class="lineno"></span><span class="comment" id="4900459">//&nbsp;even&nbsp;if&nbsp;there&nbsp;are&nbsp;multiple&nbsp;untagged&nbsp;fields&nbsp;that&nbsp;would&nbsp;otherwise&nbsp;conflict.</span><br>
<span class="lineno"></span><span class="comment" id="4900536">//&nbsp;2)&nbsp;If&nbsp;there&nbsp;is&nbsp;exactly&nbsp;one&nbsp;field&nbsp;(tagged&nbsp;or&nbsp;not&nbsp;according&nbsp;to&nbsp;the&nbsp;first&nbsp;rule),&nbsp;that&nbsp;is&nbsp;selected.</span><br>
<span class="lineno"></span><span class="comment" id="4900635">//&nbsp;3)&nbsp;Otherwise&nbsp;there&nbsp;are&nbsp;multiple&nbsp;fields,&nbsp;and&nbsp;all&nbsp;are&nbsp;ignored;&nbsp;no&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="comment" id="4900716">//</span><br>
<span class="lineno">110</span><span class="comment" id="4900719">//&nbsp;Handling&nbsp;of&nbsp;anonymous&nbsp;struct&nbsp;fields&nbsp;is&nbsp;new&nbsp;in&nbsp;Go&nbsp;1.1.</span><br>
<span class="lineno"></span><span class="comment" id="4900776">//&nbsp;Prior&nbsp;to&nbsp;Go&nbsp;1.1,&nbsp;anonymous&nbsp;struct&nbsp;fields&nbsp;were&nbsp;ignored.&nbsp;To&nbsp;force&nbsp;ignoring&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4900855">//&nbsp;an&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;in&nbsp;both&nbsp;current&nbsp;and&nbsp;earlier&nbsp;versions,&nbsp;give&nbsp;the&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="4900937">//&nbsp;a&nbsp;JSON&nbsp;tag&nbsp;of&nbsp;&#34;-&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4900959">//</span><br>
<span class="lineno">115</span><span class="comment" id="4900962">//&nbsp;Map&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;objects.</span><br>
<span class="lineno"></span><span class="comment" id="4901000">//&nbsp;The&nbsp;map&#39;s&nbsp;key&nbsp;type&nbsp;must&nbsp;be&nbsp;string;&nbsp;the&nbsp;object&nbsp;keys&nbsp;are&nbsp;used&nbsp;directly</span><br>
<span class="lineno"></span><span class="comment" id="4901072">//&nbsp;as&nbsp;map&nbsp;keys.</span><br>
<span class="lineno"></span><span class="comment" id="4901088">//</span><br>
<span class="lineno"></span><span class="comment" id="4901091">//&nbsp;Pointer&nbsp;values&nbsp;encode&nbsp;as&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to.</span><br>
<span class="lineno">120</span><span class="comment" id="4901141">//&nbsp;A&nbsp;nil&nbsp;pointer&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="4901191">//</span><br>
<span class="lineno"></span><span class="comment" id="4901194">//&nbsp;Interface&nbsp;values&nbsp;encode&nbsp;as&nbsp;the&nbsp;value&nbsp;contained&nbsp;in&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="4901262">//&nbsp;A&nbsp;nil&nbsp;interface&nbsp;value&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="4901320">//</span><br>
<span class="lineno">125</span><span class="comment" id="4901323">//&nbsp;Channel,&nbsp;complex,&nbsp;and&nbsp;function&nbsp;values&nbsp;cannot&nbsp;be&nbsp;encoded&nbsp;in&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="comment" id="4901391">//&nbsp;Attempting&nbsp;to&nbsp;encode&nbsp;such&nbsp;a&nbsp;value&nbsp;causes&nbsp;Marshal&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4901453">//&nbsp;an&nbsp;UnsupportedTypeError.</span><br>
<span class="lineno"></span><span class="comment" id="4901481">//</span><br>
<span class="lineno"></span><span class="comment" id="4901484">//&nbsp;JSON&nbsp;cannot&nbsp;represent&nbsp;cyclic&nbsp;data&nbsp;structures&nbsp;and&nbsp;Marshal&nbsp;does&nbsp;not</span><br>
<span class="lineno">130</span><span class="comment" id="4901553">//&nbsp;handle&nbsp;them.&nbsp;&nbsp;Passing&nbsp;cyclic&nbsp;structures&nbsp;to&nbsp;Marshal&nbsp;will&nbsp;result&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4901622">//&nbsp;an&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span><span class="comment" id="4901648">//</span><br>
<span class="lineno"></span><span class="keyword" id="4901651">func</span>&nbsp;<span class="ident" id="4901656">Marshal</span><span class="op" id="4901663">(</span><span class="ident" id="4901664">v</span>&nbsp;<span class="keyword" id="4901666">interface</span><span class="op" id="4901675">{</span><span class="op" id="4901676">}</span><span class="op" id="4901677">)</span>&nbsp;<span class="op" id="4901679">(</span><span class="op" id="4901680">[</span><span class="op" id="4901681">]</span><span class="builtintype" id="4901682">byte</span><span class="op" id="4901686">,</span>&nbsp;<span class="builtintype" id="4901688">error</span><span class="op" id="4901693">)</span>&nbsp;<span class="op" id="4901695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4901698">e</span>&nbsp;<span class="op" id="4901700">:=</span>&nbsp;<span class="op" id="4901703">&amp;</span><span class="ident" id="4901704">encodeState</span><span class="op" id="4901715">{</span><span class="op" id="4901716">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4901719">err</span>&nbsp;<span class="op" id="4901723">:=</span>&nbsp;<span class="ident" id="4901726">e</span><span class="op" id="4901727">.</span><span class="ident" id="4901728">marshal</span><span class="op" id="4901735">(</span><span class="ident" id="4901736">v</span><span class="op" id="4901737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901740">if</span>&nbsp;<span class="ident" id="4901743">err</span>&nbsp;<span class="op" id="4901747">!=</span>&nbsp;<span class="ident" id="4901750">nil</span>&nbsp;<span class="op" id="4901754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901758">return</span>&nbsp;<span class="ident" id="4901765">nil</span><span class="op" id="4901768">,</span>&nbsp;<span class="ident" id="4901770">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4901775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901778">return</span>&nbsp;<span class="ident" id="4901785">e</span><span class="op" id="4901786">.</span><span class="ident" id="4901787">Bytes</span><span class="op" id="4901792">(</span><span class="op" id="4901793">)</span><span class="op" id="4901794">,</span>&nbsp;<span class="ident" id="4901796">nil</span><br>
<span class="lineno">140</span><span class="op" id="4901800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4901803">//&nbsp;MarshalIndent&nbsp;is&nbsp;like&nbsp;Marshal&nbsp;but&nbsp;applies&nbsp;Indent&nbsp;to&nbsp;format&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="4901877">func</span>&nbsp;<span class="ident" id="4901882">MarshalIndent</span><span class="op" id="4901895">(</span><span class="ident" id="4901896">v</span>&nbsp;<span class="keyword" id="4901898">interface</span><span class="op" id="4901907">{</span><span class="op" id="4901908">}</span><span class="op" id="4901909">,</span>&nbsp;<span class="ident" id="4901911">prefix</span><span class="op" id="4901917">,</span>&nbsp;<span class="ident" id="4901919">indent</span>&nbsp;<span class="builtintype" id="4901926">string</span><span class="op" id="4901932">)</span>&nbsp;<span class="op" id="4901934">(</span><span class="op" id="4901935">[</span><span class="op" id="4901936">]</span><span class="builtintype" id="4901937">byte</span><span class="op" id="4901941">,</span>&nbsp;<span class="builtintype" id="4901943">error</span><span class="op" id="4901948">)</span>&nbsp;<span class="op" id="4901950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4901953">b</span><span class="op" id="4901954">,</span>&nbsp;<span class="ident" id="4901956">err</span>&nbsp;<span class="op" id="4901960">:=</span>&nbsp;<span class="ident" id="4901963">Marshal</span><span class="op" id="4901970">(</span><span class="ident" id="4901971">v</span><span class="op" id="4901972">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901975">if</span>&nbsp;<span class="ident" id="4901978">err</span>&nbsp;<span class="op" id="4901982">!=</span>&nbsp;<span class="ident" id="4901985">nil</span>&nbsp;<span class="op" id="4901989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901993">return</span>&nbsp;<span class="ident" id="4902000">nil</span><span class="op" id="4902003">,</span>&nbsp;<span class="ident" id="4902005">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4902010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902013">var</span>&nbsp;<span class="ident" id="4902017">buf</span>&nbsp;<span class="ident" id="4902021">bytes</span><span class="op" id="4902026">.</span><span class="ident" id="4902027">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4902035">err</span>&nbsp;<span class="op" id="4902039">=</span>&nbsp;<span class="ident" id="4902041">Indent</span><span class="op" id="4902047">(</span><span class="op" id="4902048">&amp;</span><span class="ident" id="4902049">buf</span><span class="op" id="4902052">,</span>&nbsp;<span class="ident" id="4902054">b</span><span class="op" id="4902055">,</span>&nbsp;<span class="ident" id="4902057">prefix</span><span class="op" id="4902063">,</span>&nbsp;<span class="ident" id="4902065">indent</span><span class="op" id="4902071">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902074">if</span>&nbsp;<span class="ident" id="4902077">err</span>&nbsp;<span class="op" id="4902081">!=</span>&nbsp;<span class="ident" id="4902084">nil</span>&nbsp;<span class="op" id="4902088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902092">return</span>&nbsp;<span class="ident" id="4902099">nil</span><span class="op" id="4902102">,</span>&nbsp;<span class="ident" id="4902104">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4902109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902112">return</span>&nbsp;<span class="ident" id="4902119">buf</span><span class="op" id="4902122">.</span><span class="ident" id="4902123">Bytes</span><span class="op" id="4902128">(</span><span class="op" id="4902129">)</span><span class="op" id="4902130">,</span>&nbsp;<span class="ident" id="4902132">nil</span><br>
<span class="lineno"></span><span class="op" id="4902136">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="4902139">//&nbsp;HTMLEscape&nbsp;appends&nbsp;to&nbsp;dst&nbsp;the&nbsp;JSON-encoded&nbsp;src&nbsp;with&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;U+2028&nbsp;and&nbsp;U+2029</span><br>
<span class="lineno"></span><span class="comment" id="4902221">//&nbsp;characters&nbsp;inside&nbsp;string&nbsp;literals&nbsp;changed&nbsp;to&nbsp;\u003c,&nbsp;\u003e,&nbsp;\u0026,&nbsp;\u2028,&nbsp;\u2029</span><br>
<span class="lineno"></span><span class="comment" id="4902308">//&nbsp;so&nbsp;that&nbsp;the&nbsp;JSON&nbsp;will&nbsp;be&nbsp;safe&nbsp;to&nbsp;embed&nbsp;inside&nbsp;HTML&nbsp;&lt;script&gt;&nbsp;tags.</span><br>
<span class="lineno"></span><span class="comment" id="4902377">//&nbsp;For&nbsp;historical&nbsp;reasons,&nbsp;web&nbsp;browsers&nbsp;don&#39;t&nbsp;honor&nbsp;standard&nbsp;HTML</span><br>
<span class="lineno">160</span><span class="comment" id="4902443">//&nbsp;escaping&nbsp;within&nbsp;&lt;script&gt;&nbsp;tags,&nbsp;so&nbsp;an&nbsp;alternative&nbsp;JSON&nbsp;encoding&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="4902514">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4902526">func</span>&nbsp;<span class="ident" id="4902531">HTMLEscape</span><span class="op" id="4902541">(</span><span class="ident" id="4902542">dst</span>&nbsp;<span class="op" id="4902546">*</span><span class="ident" id="4902547">bytes</span><span class="op" id="4902552">.</span><span class="ident" id="4902553">Buffer</span><span class="op" id="4902559">,</span>&nbsp;<span class="ident" id="4902561">src</span>&nbsp;<span class="op" id="4902565">[</span><span class="op" id="4902566">]</span><span class="builtintype" id="4902567">byte</span><span class="op" id="4902571">)</span>&nbsp;<span class="op" id="4902573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4902576">//&nbsp;The&nbsp;characters&nbsp;can&nbsp;only&nbsp;appear&nbsp;in&nbsp;string&nbsp;literals,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4902631">//&nbsp;so&nbsp;just&nbsp;scan&nbsp;the&nbsp;string&nbsp;one&nbsp;byte&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4902679">start</span>&nbsp;<span class="op" id="4902685">:=</span>&nbsp;<span class="num" id="4902688">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902691">for</span>&nbsp;<span class="ident" id="4902695">i</span><span class="op" id="4902696">,</span>&nbsp;<span class="ident" id="4902698">c</span>&nbsp;<span class="op" id="4902700">:=</span>&nbsp;<span class="keyword" id="4902703">range</span>&nbsp;<span class="ident" id="4902709">src</span>&nbsp;<span class="op" id="4902713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902717">if</span>&nbsp;<span class="ident" id="4902720">c</span>&nbsp;<span class="op" id="4902722">==</span>&nbsp;<span class="string" id="4902725">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4902729">||</span>&nbsp;<span class="ident" id="4902732">c</span>&nbsp;<span class="op" id="4902734">==</span>&nbsp;<span class="string" id="4902737">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="4902741">||</span>&nbsp;<span class="ident" id="4902744">c</span>&nbsp;<span class="op" id="4902746">==</span>&nbsp;<span class="string" id="4902749">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4902753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902758">if</span>&nbsp;<span class="ident" id="4902761">start</span>&nbsp;<span class="op" id="4902767">&lt;</span>&nbsp;<span class="ident" id="4902769">i</span>&nbsp;<span class="op" id="4902771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4902777">dst</span><span class="op" id="4902780">.</span><span class="ident" id="4902781">Write</span><span class="op" id="4902786">(</span><span class="ident" id="4902787">src</span><span class="op" id="4902790">[</span><span class="ident" id="4902791">start</span><span class="op" id="4902796">:</span><span class="ident" id="4902797">i</span><span class="op" id="4902798">]</span><span class="op" id="4902799">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4902804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4902809">dst</span><span class="op" id="4902812">.</span><span class="ident" id="4902813">WriteString</span><span class="op" id="4902824">(</span><span class="string" id="4902825">`\u00`</span><span class="op" id="4902831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4902836">dst</span><span class="op" id="4902839">.</span><span class="ident" id="4902840">WriteByte</span><span class="op" id="4902849">(</span><span class="ident" id="4902850">hex</span><span class="op" id="4902853">[</span><span class="ident" id="4902854">c</span><span class="op" id="4902855">&gt;&gt;</span><span class="num" id="4902857">4</span><span class="op" id="4902858">]</span><span class="op" id="4902859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4902864">dst</span><span class="op" id="4902867">.</span><span class="ident" id="4902868">WriteByte</span><span class="op" id="4902877">(</span><span class="ident" id="4902878">hex</span><span class="op" id="4902881">[</span><span class="ident" id="4902882">c</span><span class="op" id="4902883">&amp;</span><span class="num" id="4902884">0xF</span><span class="op" id="4902887">]</span><span class="op" id="4902888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4902893">start</span>&nbsp;<span class="op" id="4902899">=</span>&nbsp;<span class="ident" id="4902901">i</span>&nbsp;<span class="op" id="4902903">+</span>&nbsp;<span class="num" id="4902905">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4902909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4902913">//&nbsp;Convert&nbsp;U+2028&nbsp;and&nbsp;U+2029&nbsp;(E2&nbsp;80&nbsp;A8&nbsp;and&nbsp;E2&nbsp;80&nbsp;A9).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902969">if</span>&nbsp;<span class="ident" id="4902972">c</span>&nbsp;<span class="op" id="4902974">==</span>&nbsp;<span class="num" id="4902977">0xE2</span>&nbsp;<span class="op" id="4902982">&amp;&amp;</span>&nbsp;<span class="ident" id="4902985">i</span><span class="op" id="4902986">+</span><span class="num" id="4902987">2</span>&nbsp;<span class="op" id="4902989">&lt;</span>&nbsp;<span class="builtinfunc" id="4902991">len</span><span class="op" id="4902994">(</span><span class="ident" id="4902995">src</span><span class="op" id="4902998">)</span>&nbsp;<span class="op" id="4903000">&amp;&amp;</span>&nbsp;<span class="ident" id="4903003">src</span><span class="op" id="4903006">[</span><span class="ident" id="4903007">i</span><span class="op" id="4903008">+</span><span class="num" id="4903009">1</span><span class="op" id="4903010">]</span>&nbsp;<span class="op" id="4903012">==</span>&nbsp;<span class="num" id="4903015">0x80</span>&nbsp;<span class="op" id="4903020">&amp;&amp;</span>&nbsp;<span class="ident" id="4903023">src</span><span class="op" id="4903026">[</span><span class="ident" id="4903027">i</span><span class="op" id="4903028">+</span><span class="num" id="4903029">2</span><span class="op" id="4903030">]</span><span class="op" id="4903031">&amp;^</span><span class="num" id="4903033">1</span>&nbsp;<span class="op" id="4903035">==</span>&nbsp;<span class="num" id="4903038">0xA8</span>&nbsp;<span class="op" id="4903043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4903048">if</span>&nbsp;<span class="ident" id="4903051">start</span>&nbsp;<span class="op" id="4903057">&lt;</span>&nbsp;<span class="ident" id="4903059">i</span>&nbsp;<span class="op" id="4903061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4903067">dst</span><span class="op" id="4903070">.</span><span class="ident" id="4903071">Write</span><span class="op" id="4903076">(</span><span class="ident" id="4903077">src</span><span class="op" id="4903080">[</span><span class="ident" id="4903081">start</span><span class="op" id="4903086">:</span><span class="ident" id="4903087">i</span><span class="op" id="4903088">]</span><span class="op" id="4903089">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4903094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4903099">dst</span><span class="op" id="4903102">.</span><span class="ident" id="4903103">WriteString</span><span class="op" id="4903114">(</span><span class="string" id="4903115">`\u202`</span><span class="op" id="4903122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4903127">dst</span><span class="op" id="4903130">.</span><span class="ident" id="4903131">WriteByte</span><span class="op" id="4903140">(</span><span class="ident" id="4903141">hex</span><span class="op" id="4903144">[</span><span class="ident" id="4903145">src</span><span class="op" id="4903148">[</span><span class="ident" id="4903149">i</span><span class="op" id="4903150">+</span><span class="num" id="4903151">2</span><span class="op" id="4903152">]</span><span class="op" id="4903153">&amp;</span><span class="num" id="4903154">0xF</span><span class="op" id="4903157">]</span><span class="op" id="4903158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4903163">start</span>&nbsp;<span class="op" id="4903169">=</span>&nbsp;<span class="ident" id="4903171">i</span>&nbsp;<span class="op" id="4903173">+</span>&nbsp;<span class="num" id="4903175">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4903179">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4903182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4903185">if</span>&nbsp;<span class="ident" id="4903188">start</span>&nbsp;<span class="op" id="4903194">&lt;</span>&nbsp;<span class="builtinfunc" id="4903196">len</span><span class="op" id="4903199">(</span><span class="ident" id="4903200">src</span><span class="op" id="4903203">)</span>&nbsp;<span class="op" id="4903205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4903209">dst</span><span class="op" id="4903212">.</span><span class="ident" id="4903213">Write</span><span class="op" id="4903218">(</span><span class="ident" id="4903219">src</span><span class="op" id="4903222">[</span><span class="ident" id="4903223">start</span><span class="op" id="4903228">:</span><span class="op" id="4903229">]</span><span class="op" id="4903230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4903233">}</span><br>
<span class="lineno"></span><span class="op" id="4903235">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="4903238">//&nbsp;Marshaler&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4903296">//&nbsp;can&nbsp;marshal&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="4903339">type</span>&nbsp;<span class="ident" id="4903344">Marshaler</span>&nbsp;<span class="keyword" id="4903354">interface</span>&nbsp;<span class="op" id="4903364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4903367">MarshalJSON</span><span class="op" id="4903378">(</span><span class="op" id="4903379">)</span>&nbsp;<span class="op" id="4903381">(</span><span class="op" id="4903382">[</span><span class="op" id="4903383">]</span><span class="builtintype" id="4903384">byte</span><span class="op" id="4903388">,</span>&nbsp;<span class="builtintype" id="4903390">error</span><span class="op" id="4903395">)</span><br>
<span class="lineno">195</span><span class="op" id="4903397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4903400">//&nbsp;An&nbsp;UnsupportedTypeError&nbsp;is&nbsp;returned&nbsp;by&nbsp;Marshal&nbsp;when&nbsp;attempting</span><br>
<span class="lineno"></span><span class="comment" id="4903466">//&nbsp;to&nbsp;encode&nbsp;an&nbsp;unsupported&nbsp;value&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4903506">type</span>&nbsp;<span class="ident" id="4903511">UnsupportedTypeError</span>&nbsp;<span class="keyword" id="4903532">struct</span>&nbsp;<span class="op" id="4903539">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4903542">Type</span>&nbsp;<span class="ident" id="4903547">reflect</span><span class="op" id="4903554">.</span><span class="ident" id="4903555">Type</span><br>
<span class="lineno"></span><span class="op" id="4903560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4903563">func</span>&nbsp;<span class="op" id="4903568">(</span><span class="ident" id="4903569">e</span>&nbsp;<span class="op" id="4903571">*</span><span class="ident" id="4903572">UnsupportedTypeError</span><span class="op" id="4903592">)</span>&nbsp;<span class="ident" id="4903594">Error</span><span class="op" id="4903599">(</span><span class="op" id="4903600">)</span>&nbsp;<span class="builtintype" id="4903602">string</span>&nbsp;<span class="op" id="4903609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4903612">return</span>&nbsp;<span class="string" id="4903619">&#34;json:&nbsp;unsupported&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4903646">+</span>&nbsp;<span class="ident" id="4903648">e</span><span class="op" id="4903649">.</span><span class="ident" id="4903650">Type</span><span class="op" id="4903654">.</span><span class="ident" id="4903655">String</span><span class="op" id="4903661">(</span><span class="op" id="4903662">)</span><br>
<span class="lineno">205</span><span class="op" id="4903664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4903667">type</span>&nbsp;<span class="ident" id="4903672">UnsupportedValueError</span>&nbsp;<span class="keyword" id="4903694">struct</span>&nbsp;<span class="op" id="4903701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4903704">Value</span>&nbsp;<span class="ident" id="4903710">reflect</span><span class="op" id="4903717">.</span><span class="ident" id="4903718">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4903725">Str</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4903731">string</span><br>
<span class="lineno">210</span><span class="op" id="4903738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4903741">func</span>&nbsp;<span class="op" id="4903746">(</span><span class="ident" id="4903747">e</span>&nbsp;<span class="op" id="4903749">*</span><span class="ident" id="4903750">UnsupportedValueError</span><span class="op" id="4903771">)</span>&nbsp;<span class="ident" id="4903773">Error</span><span class="op" id="4903778">(</span><span class="op" id="4903779">)</span>&nbsp;<span class="builtintype" id="4903781">string</span>&nbsp;<span class="op" id="4903788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4903791">return</span>&nbsp;<span class="string" id="4903798">&#34;json:&nbsp;unsupported&nbsp;value:&nbsp;&#34;</span>&nbsp;<span class="op" id="4903826">+</span>&nbsp;<span class="ident" id="4903828">e</span><span class="op" id="4903829">.</span><span class="ident" id="4903830">Str</span><br>
<span class="lineno"></span><span class="op" id="4903834">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="4903837">//&nbsp;Before&nbsp;Go&nbsp;1.2,&nbsp;an&nbsp;InvalidUTF8Error&nbsp;was&nbsp;returned&nbsp;by&nbsp;Marshal&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="4903904">//&nbsp;attempting&nbsp;to&nbsp;encode&nbsp;a&nbsp;string&nbsp;value&nbsp;with&nbsp;invalid&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="comment" id="4903973">//&nbsp;As&nbsp;of&nbsp;Go&nbsp;1.2,&nbsp;Marshal&nbsp;instead&nbsp;coerces&nbsp;the&nbsp;string&nbsp;to&nbsp;valid&nbsp;UTF-8&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4904043">//&nbsp;replacing&nbsp;invalid&nbsp;bytes&nbsp;with&nbsp;the&nbsp;Unicode&nbsp;replacement&nbsp;rune&nbsp;U+FFFD.</span><br>
<span class="lineno">220</span><span class="comment" id="4904112">//&nbsp;This&nbsp;error&nbsp;is&nbsp;no&nbsp;longer&nbsp;generated&nbsp;but&nbsp;is&nbsp;kept&nbsp;for&nbsp;backwards&nbsp;compatibility</span><br>
<span class="lineno"></span><span class="comment" id="4904189">//&nbsp;with&nbsp;programs&nbsp;that&nbsp;might&nbsp;mention&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4904229">type</span>&nbsp;<span class="ident" id="4904234">InvalidUTF8Error</span>&nbsp;<span class="keyword" id="4904251">struct</span>&nbsp;<span class="op" id="4904258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4904261">S</span>&nbsp;<span class="builtintype" id="4904263">string</span>&nbsp;<span class="comment" id="4904270">//&nbsp;the&nbsp;whole&nbsp;string&nbsp;value&nbsp;that&nbsp;caused&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="4904318">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="4904321">func</span>&nbsp;<span class="op" id="4904326">(</span><span class="ident" id="4904327">e</span>&nbsp;<span class="op" id="4904329">*</span><span class="ident" id="4904330">InvalidUTF8Error</span><span class="op" id="4904346">)</span>&nbsp;<span class="ident" id="4904348">Error</span><span class="op" id="4904353">(</span><span class="op" id="4904354">)</span>&nbsp;<span class="builtintype" id="4904356">string</span>&nbsp;<span class="op" id="4904363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4904366">return</span>&nbsp;<span class="string" id="4904373">&#34;json:&nbsp;invalid&nbsp;UTF-8&nbsp;in&nbsp;string:&nbsp;&#34;</span>&nbsp;<span class="op" id="4904407">+</span>&nbsp;<span class="ident" id="4904409">strconv</span><span class="op" id="4904416">.</span><span class="ident" id="4904417">Quote</span><span class="op" id="4904422">(</span><span class="ident" id="4904423">e</span><span class="op" id="4904424">.</span><span class="ident" id="4904425">S</span><span class="op" id="4904426">)</span><br>
<span class="lineno"></span><span class="op" id="4904428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="4904431">type</span>&nbsp;<span class="ident" id="4904436">MarshalerError</span>&nbsp;<span class="keyword" id="4904451">struct</span>&nbsp;<span class="op" id="4904458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4904461">Type</span>&nbsp;<span class="ident" id="4904466">reflect</span><span class="op" id="4904473">.</span><span class="ident" id="4904474">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4904480">Err</span>&nbsp;&nbsp;<span class="builtintype" id="4904485">error</span><br>
<span class="lineno"></span><span class="op" id="4904491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4904494">func</span>&nbsp;<span class="op" id="4904499">(</span><span class="ident" id="4904500">e</span>&nbsp;<span class="op" id="4904502">*</span><span class="ident" id="4904503">MarshalerError</span><span class="op" id="4904517">)</span>&nbsp;<span class="ident" id="4904519">Error</span><span class="op" id="4904524">(</span><span class="op" id="4904525">)</span>&nbsp;<span class="builtintype" id="4904527">string</span>&nbsp;<span class="op" id="4904534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4904537">return</span>&nbsp;<span class="string" id="4904544">&#34;json:&nbsp;error&nbsp;calling&nbsp;MarshalJSON&nbsp;for&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4904588">+</span>&nbsp;<span class="ident" id="4904590">e</span><span class="op" id="4904591">.</span><span class="ident" id="4904592">Type</span><span class="op" id="4904596">.</span><span class="ident" id="4904597">String</span><span class="op" id="4904603">(</span><span class="op" id="4904604">)</span>&nbsp;<span class="op" id="4904606">+</span>&nbsp;<span class="string" id="4904608">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4904613">+</span>&nbsp;<span class="ident" id="4904615">e</span><span class="op" id="4904616">.</span><span class="ident" id="4904617">Err</span><span class="op" id="4904620">.</span><span class="ident" id="4904621">Error</span><span class="op" id="4904626">(</span><span class="op" id="4904627">)</span><br>
<span class="lineno"></span><span class="op" id="4904629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4904632">var</span>&nbsp;<span class="ident" id="4904636">hex</span>&nbsp;<span class="op" id="4904640">=</span>&nbsp;<span class="string" id="4904642">&#34;0123456789abcdef&#34;</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="4904662">//&nbsp;An&nbsp;encodeState&nbsp;encodes&nbsp;JSON&nbsp;into&nbsp;a&nbsp;bytes.Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="4904714">type</span>&nbsp;<span class="ident" id="4904719">encodeState</span>&nbsp;<span class="keyword" id="4904731">struct</span>&nbsp;<span class="op" id="4904738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4904741">bytes</span><span class="op" id="4904746">.</span><span class="ident" id="4904747">Buffer</span>&nbsp;<span class="comment" id="4904754">//&nbsp;accumulated&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4904777">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4904790">[</span><span class="num" id="4904791">64</span><span class="op" id="4904793">]</span><span class="builtintype" id="4904794">byte</span><br>
<span class="lineno">245</span><span class="op" id="4904799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4904802">var</span>&nbsp;<span class="ident" id="4904806">encodeStatePool</span>&nbsp;<span class="ident" id="4904822">sync</span><span class="op" id="4904826">.</span><span class="ident" id="4904827">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4904833">func</span>&nbsp;<span class="ident" id="4904838">newEncodeState</span><span class="op" id="4904852">(</span><span class="op" id="4904853">)</span>&nbsp;<span class="op" id="4904855">*</span><span class="ident" id="4904856">encodeState</span>&nbsp;<span class="op" id="4904868">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4904871">if</span>&nbsp;<span class="ident" id="4904874">v</span>&nbsp;<span class="op" id="4904876">:=</span>&nbsp;<span class="ident" id="4904879">encodeStatePool</span><span class="op" id="4904894">.</span><span class="ident" id="4904895">Get</span><span class="op" id="4904898">(</span><span class="op" id="4904899">)</span><span class="op" id="4904900">;</span>&nbsp;<span class="ident" id="4904902">v</span>&nbsp;<span class="op" id="4904904">!=</span>&nbsp;<span class="ident" id="4904907">nil</span>&nbsp;<span class="op" id="4904911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4904915">e</span>&nbsp;<span class="op" id="4904917">:=</span>&nbsp;<span class="ident" id="4904920">v</span><span class="op" id="4904921">.</span><span class="op" id="4904922">(</span><span class="op" id="4904923">*</span><span class="ident" id="4904924">encodeState</span><span class="op" id="4904935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4904939">e</span><span class="op" id="4904940">.</span><span class="ident" id="4904941">Reset</span><span class="op" id="4904946">(</span><span class="op" id="4904947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4904951">return</span>&nbsp;<span class="ident" id="4904958">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4904961">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4904964">return</span>&nbsp;<span class="builtinfunc" id="4904971">new</span><span class="op" id="4904974">(</span><span class="ident" id="4904975">encodeState</span><span class="op" id="4904986">)</span><br>
<span class="lineno"></span><span class="op" id="4904988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4904991">func</span>&nbsp;<span class="op" id="4904996">(</span><span class="ident" id="4904997">e</span>&nbsp;<span class="op" id="4904999">*</span><span class="ident" id="4905000">encodeState</span><span class="op" id="4905011">)</span>&nbsp;<span class="ident" id="4905013">marshal</span><span class="op" id="4905020">(</span><span class="ident" id="4905021">v</span>&nbsp;<span class="keyword" id="4905023">interface</span><span class="op" id="4905032">{</span><span class="op" id="4905033">}</span><span class="op" id="4905034">)</span>&nbsp;<span class="op" id="4905036">(</span><span class="ident" id="4905037">err</span>&nbsp;<span class="builtintype" id="4905041">error</span><span class="op" id="4905046">)</span>&nbsp;<span class="op" id="4905048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905051">defer</span>&nbsp;<span class="keyword" id="4905057">func</span><span class="op" id="4905061">(</span><span class="op" id="4905062">)</span>&nbsp;<span class="op" id="4905064">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905068">if</span>&nbsp;<span class="ident" id="4905071">r</span>&nbsp;<span class="op" id="4905073">:=</span>&nbsp;<span class="builtinfunc" id="4905076">recover</span><span class="op" id="4905083">(</span><span class="op" id="4905084">)</span><span class="op" id="4905085">;</span>&nbsp;<span class="ident" id="4905087">r</span>&nbsp;<span class="op" id="4905089">!=</span>&nbsp;<span class="ident" id="4905092">nil</span>&nbsp;<span class="op" id="4905096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905101">if</span>&nbsp;<span class="ident" id="4905104">_</span><span class="op" id="4905105">,</span>&nbsp;<span class="ident" id="4905107">ok</span>&nbsp;<span class="op" id="4905110">:=</span>&nbsp;<span class="ident" id="4905113">r</span><span class="op" id="4905114">.</span><span class="op" id="4905115">(</span><span class="ident" id="4905116">runtime</span><span class="op" id="4905123">.</span><span class="ident" id="4905124">Error</span><span class="op" id="4905129">)</span><span class="op" id="4905130">;</span>&nbsp;<span class="ident" id="4905132">ok</span>&nbsp;<span class="op" id="4905135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4905141">panic</span><span class="op" id="4905146">(</span><span class="ident" id="4905147">r</span><span class="op" id="4905148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4905153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905158">if</span>&nbsp;<span class="ident" id="4905161">s</span><span class="op" id="4905162">,</span>&nbsp;<span class="ident" id="4905164">ok</span>&nbsp;<span class="op" id="4905167">:=</span>&nbsp;<span class="ident" id="4905170">r</span><span class="op" id="4905171">.</span><span class="op" id="4905172">(</span><span class="builtintype" id="4905173">string</span><span class="op" id="4905179">)</span><span class="op" id="4905180">;</span>&nbsp;<span class="ident" id="4905182">ok</span>&nbsp;<span class="op" id="4905185">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4905191">panic</span><span class="op" id="4905196">(</span><span class="ident" id="4905197">s</span><span class="op" id="4905198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4905203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4905208">err</span>&nbsp;<span class="op" id="4905212">=</span>&nbsp;<span class="ident" id="4905214">r</span><span class="op" id="4905215">.</span><span class="op" id="4905216">(</span><span class="builtintype" id="4905217">error</span><span class="op" id="4905222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4905226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4905229">}</span><span class="op" id="4905230">(</span><span class="op" id="4905231">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4905234">e</span><span class="op" id="4905235">.</span><span class="ident" id="4905236">reflectValue</span><span class="op" id="4905248">(</span><span class="ident" id="4905249">reflect</span><span class="op" id="4905256">.</span><span class="ident" id="4905257">ValueOf</span><span class="op" id="4905264">(</span><span class="ident" id="4905265">v</span><span class="op" id="4905266">)</span><span class="op" id="4905267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905270">return</span>&nbsp;<span class="ident" id="4905277">nil</span><br>
<span class="lineno"></span><span class="op" id="4905281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4905284">func</span>&nbsp;<span class="op" id="4905289">(</span><span class="ident" id="4905290">e</span>&nbsp;<span class="op" id="4905292">*</span><span class="ident" id="4905293">encodeState</span><span class="op" id="4905304">)</span>&nbsp;<span class="builtintype" id="4905306">error</span><span class="op" id="4905311">(</span><span class="ident" id="4905312">err</span>&nbsp;<span class="builtintype" id="4905316">error</span><span class="op" id="4905321">)</span>&nbsp;<span class="op" id="4905323">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4905326">panic</span><span class="op" id="4905331">(</span><span class="ident" id="4905332">err</span><span class="op" id="4905335">)</span><br>
<span class="lineno"></span><span class="op" id="4905337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4905340">var</span>&nbsp;<span class="ident" id="4905344">byteSliceType</span>&nbsp;<span class="op" id="4905358">=</span>&nbsp;<span class="ident" id="4905360">reflect</span><span class="op" id="4905367">.</span><span class="ident" id="4905368">TypeOf</span><span class="op" id="4905374">(</span><span class="op" id="4905375">[</span><span class="op" id="4905376">]</span><span class="builtintype" id="4905377">byte</span><span class="op" id="4905381">(</span><span class="ident" id="4905382">nil</span><span class="op" id="4905385">)</span><span class="op" id="4905386">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="4905389">func</span>&nbsp;<span class="ident" id="4905394">isEmptyValue</span><span class="op" id="4905406">(</span><span class="ident" id="4905407">v</span>&nbsp;<span class="ident" id="4905409">reflect</span><span class="op" id="4905416">.</span><span class="ident" id="4905417">Value</span><span class="op" id="4905422">)</span>&nbsp;<span class="builtintype" id="4905424">bool</span>&nbsp;<span class="op" id="4905429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905432">switch</span>&nbsp;<span class="ident" id="4905439">v</span><span class="op" id="4905440">.</span><span class="ident" id="4905441">Kind</span><span class="op" id="4905445">(</span><span class="op" id="4905446">)</span>&nbsp;<span class="op" id="4905448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905451">case</span>&nbsp;<span class="ident" id="4905456">reflect</span><span class="op" id="4905463">.</span><span class="ident" id="4905464">Array</span><span class="op" id="4905469">,</span>&nbsp;<span class="ident" id="4905471">reflect</span><span class="op" id="4905478">.</span><span class="ident" id="4905479">Map</span><span class="op" id="4905482">,</span>&nbsp;<span class="ident" id="4905484">reflect</span><span class="op" id="4905491">.</span><span class="ident" id="4905492">Slice</span><span class="op" id="4905497">,</span>&nbsp;<span class="ident" id="4905499">reflect</span><span class="op" id="4905506">.</span><span class="ident" id="4905507">String</span><span class="op" id="4905513">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905517">return</span>&nbsp;<span class="ident" id="4905524">v</span><span class="op" id="4905525">.</span><span class="ident" id="4905526">Len</span><span class="op" id="4905529">(</span><span class="op" id="4905530">)</span>&nbsp;<span class="op" id="4905532">==</span>&nbsp;<span class="num" id="4905535">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905538">case</span>&nbsp;<span class="ident" id="4905543">reflect</span><span class="op" id="4905550">.</span><span class="ident" id="4905551">Bool</span><span class="op" id="4905555">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905559">return</span>&nbsp;<span class="op" id="4905566">!</span><span class="ident" id="4905567">v</span><span class="op" id="4905568">.</span><span class="ident" id="4905569">Bool</span><span class="op" id="4905573">(</span><span class="op" id="4905574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905577">case</span>&nbsp;<span class="ident" id="4905582">reflect</span><span class="op" id="4905589">.</span><span class="ident" id="4905590">Int</span><span class="op" id="4905593">,</span>&nbsp;<span class="ident" id="4905595">reflect</span><span class="op" id="4905602">.</span><span class="ident" id="4905603">Int8</span><span class="op" id="4905607">,</span>&nbsp;<span class="ident" id="4905609">reflect</span><span class="op" id="4905616">.</span><span class="ident" id="4905617">Int16</span><span class="op" id="4905622">,</span>&nbsp;<span class="ident" id="4905624">reflect</span><span class="op" id="4905631">.</span><span class="ident" id="4905632">Int32</span><span class="op" id="4905637">,</span>&nbsp;<span class="ident" id="4905639">reflect</span><span class="op" id="4905646">.</span><span class="ident" id="4905647">Int64</span><span class="op" id="4905652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905656">return</span>&nbsp;<span class="ident" id="4905663">v</span><span class="op" id="4905664">.</span><span class="ident" id="4905665">Int</span><span class="op" id="4905668">(</span><span class="op" id="4905669">)</span>&nbsp;<span class="op" id="4905671">==</span>&nbsp;<span class="num" id="4905674">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905677">case</span>&nbsp;<span class="ident" id="4905682">reflect</span><span class="op" id="4905689">.</span><span class="ident" id="4905690">Uint</span><span class="op" id="4905694">,</span>&nbsp;<span class="ident" id="4905696">reflect</span><span class="op" id="4905703">.</span><span class="ident" id="4905704">Uint8</span><span class="op" id="4905709">,</span>&nbsp;<span class="ident" id="4905711">reflect</span><span class="op" id="4905718">.</span><span class="ident" id="4905719">Uint16</span><span class="op" id="4905725">,</span>&nbsp;<span class="ident" id="4905727">reflect</span><span class="op" id="4905734">.</span><span class="ident" id="4905735">Uint32</span><span class="op" id="4905741">,</span>&nbsp;<span class="ident" id="4905743">reflect</span><span class="op" id="4905750">.</span><span class="ident" id="4905751">Uint64</span><span class="op" id="4905757">,</span>&nbsp;<span class="ident" id="4905759">reflect</span><span class="op" id="4905766">.</span><span class="ident" id="4905767">Uintptr</span><span class="op" id="4905774">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905778">return</span>&nbsp;<span class="ident" id="4905785">v</span><span class="op" id="4905786">.</span><span class="ident" id="4905787">Uint</span><span class="op" id="4905791">(</span><span class="op" id="4905792">)</span>&nbsp;<span class="op" id="4905794">==</span>&nbsp;<span class="num" id="4905797">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905800">case</span>&nbsp;<span class="ident" id="4905805">reflect</span><span class="op" id="4905812">.</span><span class="ident" id="4905813">Float32</span><span class="op" id="4905820">,</span>&nbsp;<span class="ident" id="4905822">reflect</span><span class="op" id="4905829">.</span><span class="ident" id="4905830">Float64</span><span class="op" id="4905837">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905841">return</span>&nbsp;<span class="ident" id="4905848">v</span><span class="op" id="4905849">.</span><span class="ident" id="4905850">Float</span><span class="op" id="4905855">(</span><span class="op" id="4905856">)</span>&nbsp;<span class="op" id="4905858">==</span>&nbsp;<span class="num" id="4905861">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905864">case</span>&nbsp;<span class="ident" id="4905869">reflect</span><span class="op" id="4905876">.</span><span class="ident" id="4905877">Interface</span><span class="op" id="4905886">,</span>&nbsp;<span class="ident" id="4905888">reflect</span><span class="op" id="4905895">.</span><span class="ident" id="4905896">Ptr</span><span class="op" id="4905899">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905903">return</span>&nbsp;<span class="ident" id="4905910">v</span><span class="op" id="4905911">.</span><span class="ident" id="4905912">IsNil</span><span class="op" id="4905917">(</span><span class="op" id="4905918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4905921">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4905924">return</span>&nbsp;<span class="builtintype" id="4905931">false</span><br>
<span class="lineno"></span><span class="op" id="4905937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4905940">func</span>&nbsp;<span class="op" id="4905945">(</span><span class="ident" id="4905946">e</span>&nbsp;<span class="op" id="4905948">*</span><span class="ident" id="4905949">encodeState</span><span class="op" id="4905960">)</span>&nbsp;<span class="ident" id="4905962">reflectValue</span><span class="op" id="4905974">(</span><span class="ident" id="4905975">v</span>&nbsp;<span class="ident" id="4905977">reflect</span><span class="op" id="4905984">.</span><span class="ident" id="4905985">Value</span><span class="op" id="4905990">)</span>&nbsp;<span class="op" id="4905992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4905995">valueEncoder</span><span class="op" id="4906007">(</span><span class="ident" id="4906008">v</span><span class="op" id="4906009">)</span><span class="op" id="4906010">(</span><span class="ident" id="4906011">e</span><span class="op" id="4906012">,</span>&nbsp;<span class="ident" id="4906014">v</span><span class="op" id="4906015">,</span>&nbsp;<span class="builtintype" id="4906017">false</span><span class="op" id="4906022">)</span><br>
<span class="lineno">300</span><span class="op" id="4906024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4906027">type</span>&nbsp;<span class="ident" id="4906032">encoderFunc</span>&nbsp;<span class="keyword" id="4906044">func</span><span class="op" id="4906048">(</span><span class="ident" id="4906049">e</span>&nbsp;<span class="op" id="4906051">*</span><span class="ident" id="4906052">encodeState</span><span class="op" id="4906063">,</span>&nbsp;<span class="ident" id="4906065">v</span>&nbsp;<span class="ident" id="4906067">reflect</span><span class="op" id="4906074">.</span><span class="ident" id="4906075">Value</span><span class="op" id="4906080">,</span>&nbsp;<span class="ident" id="4906082">quoted</span>&nbsp;<span class="builtintype" id="4906089">bool</span><span class="op" id="4906093">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4906096">var</span>&nbsp;<span class="ident" id="4906100">encoderCache</span>&nbsp;<span class="keyword" id="4906113">struct</span>&nbsp;<span class="op" id="4906120">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4906123">sync</span><span class="op" id="4906127">.</span><span class="ident" id="4906128">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4906137">m</span>&nbsp;<span class="keyword" id="4906139">map</span><span class="op" id="4906142">[</span><span class="ident" id="4906143">reflect</span><span class="op" id="4906150">.</span><span class="ident" id="4906151">Type</span><span class="op" id="4906155">]</span><span class="ident" id="4906156">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4906168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4906171">func</span>&nbsp;<span class="ident" id="4906176">valueEncoder</span><span class="op" id="4906188">(</span><span class="ident" id="4906189">v</span>&nbsp;<span class="ident" id="4906191">reflect</span><span class="op" id="4906198">.</span><span class="ident" id="4906199">Value</span><span class="op" id="4906204">)</span>&nbsp;<span class="ident" id="4906206">encoderFunc</span>&nbsp;<span class="op" id="4906218">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4906221">if</span>&nbsp;<span class="op" id="4906224">!</span><span class="ident" id="4906225">v</span><span class="op" id="4906226">.</span><span class="ident" id="4906227">IsValid</span><span class="op" id="4906234">(</span><span class="op" id="4906235">)</span>&nbsp;<span class="op" id="4906237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4906241">return</span>&nbsp;<span class="ident" id="4906248">invalidValueEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4906269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4906272">return</span>&nbsp;<span class="ident" id="4906279">typeEncoder</span><span class="op" id="4906290">(</span><span class="ident" id="4906291">v</span><span class="op" id="4906292">.</span><span class="ident" id="4906293">Type</span><span class="op" id="4906297">(</span><span class="op" id="4906298">)</span><span class="op" id="4906299">)</span><br>
<span class="lineno"></span><span class="op" id="4906301">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="4906304">func</span>&nbsp;<span class="ident" id="4906309">typeEncoder</span><span class="op" id="4906320">(</span><span class="ident" id="4906321">t</span>&nbsp;<span class="ident" id="4906323">reflect</span><span class="op" id="4906330">.</span><span class="ident" id="4906331">Type</span><span class="op" id="4906335">)</span>&nbsp;<span class="ident" id="4906337">encoderFunc</span>&nbsp;<span class="op" id="4906349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4906352">encoderCache</span><span class="op" id="4906364">.</span><span class="ident" id="4906365">RLock</span><span class="op" id="4906370">(</span><span class="op" id="4906371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4906374">f</span>&nbsp;<span class="op" id="4906376">:=</span>&nbsp;<span class="ident" id="4906379">encoderCache</span><span class="op" id="4906391">.</span><span class="ident" id="4906392">m</span><span class="op" id="4906393">[</span><span class="ident" id="4906394">t</span><span class="op" id="4906395">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4906398">encoderCache</span><span class="op" id="4906410">.</span><span class="ident" id="4906411">RUnlock</span><span class="op" id="4906418">(</span><span class="op" id="4906419">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4906422">if</span>&nbsp;<span class="ident" id="4906425">f</span>&nbsp;<span class="op" id="4906427">!=</span>&nbsp;<span class="ident" id="4906430">nil</span>&nbsp;<span class="op" id="4906434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4906438">return</span>&nbsp;<span class="ident" id="4906445">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4906448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4906452">//&nbsp;To&nbsp;deal&nbsp;with&nbsp;recursive&nbsp;types,&nbsp;populate&nbsp;the&nbsp;map&nbsp;with&nbsp;an</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4906511">//&nbsp;indirect&nbsp;func&nbsp;before&nbsp;we&nbsp;build&nbsp;it.&nbsp;This&nbsp;type&nbsp;waits&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4906572">//&nbsp;real&nbsp;func&nbsp;(f)&nbsp;to&nbsp;be&nbsp;ready&nbsp;and&nbsp;then&nbsp;calls&nbsp;it.&nbsp;&nbsp;This&nbsp;indirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4906636">//&nbsp;func&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;recursive&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4906679">encoderCache</span><span class="op" id="4906691">.</span><span class="ident" id="4906692">Lock</span><span class="op" id="4906696">(</span><span class="op" id="4906697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4906700">if</span>&nbsp;<span class="ident" id="4906703">encoderCache</span><span class="op" id="4906715">.</span><span class="ident" id="4906716">m</span>&nbsp;<span class="op" id="4906718">==</span>&nbsp;<span class="ident" id="4906721">nil</span>&nbsp;<span class="op" id="4906725">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4906729">encoderCache</span><span class="op" id="4906741">.</span><span class="ident" id="4906742">m</span>&nbsp;<span class="op" id="4906744">=</span>&nbsp;<span class="builtinfunc" id="4906746">make</span><span class="op" id="4906750">(</span><span class="keyword" id="4906751">map</span><span class="op" id="4906754">[</span><span class="ident" id="4906755">reflect</span><span class="op" id="4906762">.</span><span class="ident" id="4906763">Type</span><span class="op" id="4906767">]</span><span class="ident" id="4906768">encoderFunc</span><span class="op" id="4906779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4906782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4906785">var</span>&nbsp;<span class="ident" id="4906789">wg</span>&nbsp;<span class="ident" id="4906792">sync</span><span class="op" id="4906796">.</span><span class="ident" id="4906797">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4906808">wg</span><span class="op" id="4906810">.</span><span class="ident" id="4906811">Add</span><span class="op" id="4906814">(</span><span class="num" id="4906815">1</span><span class="op" id="4906816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4906819">encoderCache</span><span class="op" id="4906831">.</span><span class="ident" id="4906832">m</span><span class="op" id="4906833">[</span><span class="ident" id="4906834">t</span><span class="op" id="4906835">]</span>&nbsp;<span class="op" id="4906837">=</span>&nbsp;<span class="keyword" id="4906839">func</span><span class="op" id="4906843">(</span><span class="ident" id="4906844">e</span>&nbsp;<span class="op" id="4906846">*</span><span class="ident" id="4906847">encodeState</span><span class="op" id="4906858">,</span>&nbsp;<span class="ident" id="4906860">v</span>&nbsp;<span class="ident" id="4906862">reflect</span><span class="op" id="4906869">.</span><span class="ident" id="4906870">Value</span><span class="op" id="4906875">,</span>&nbsp;<span class="ident" id="4906877">quoted</span>&nbsp;<span class="builtintype" id="4906884">bool</span><span class="op" id="4906888">)</span>&nbsp;<span class="op" id="4906890">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4906894">wg</span><span class="op" id="4906896">.</span><span class="ident" id="4906897">Wait</span><span class="op" id="4906901">(</span><span class="op" id="4906902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4906906">f</span><span class="op" id="4906907">(</span><span class="ident" id="4906908">e</span><span class="op" id="4906909">,</span>&nbsp;<span class="ident" id="4906911">v</span><span class="op" id="4906912">,</span>&nbsp;<span class="ident" id="4906914">quoted</span><span class="op" id="4906920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4906923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4906926">encoderCache</span><span class="op" id="4906938">.</span><span class="ident" id="4906939">Unlock</span><span class="op" id="4906945">(</span><span class="op" id="4906946">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4906950">//&nbsp;Compute&nbsp;fields&nbsp;without&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4906983">//&nbsp;Might&nbsp;duplicate&nbsp;effort&nbsp;but&nbsp;won&#39;t&nbsp;hold&nbsp;other&nbsp;computations&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4907050">f</span>&nbsp;<span class="op" id="4907052">=</span>&nbsp;<span class="ident" id="4907054">newTypeEncoder</span><span class="op" id="4907068">(</span><span class="ident" id="4907069">t</span><span class="op" id="4907070">,</span>&nbsp;<span class="builtintype" id="4907072">true</span><span class="op" id="4907076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4907079">wg</span><span class="op" id="4907081">.</span><span class="ident" id="4907082">Done</span><span class="op" id="4907086">(</span><span class="op" id="4907087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4907090">encoderCache</span><span class="op" id="4907102">.</span><span class="ident" id="4907103">Lock</span><span class="op" id="4907107">(</span><span class="op" id="4907108">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4907111">encoderCache</span><span class="op" id="4907123">.</span><span class="ident" id="4907124">m</span><span class="op" id="4907125">[</span><span class="ident" id="4907126">t</span><span class="op" id="4907127">]</span>&nbsp;<span class="op" id="4907129">=</span>&nbsp;<span class="ident" id="4907131">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4907134">encoderCache</span><span class="op" id="4907146">.</span><span class="ident" id="4907147">Unlock</span><span class="op" id="4907153">(</span><span class="op" id="4907154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4907157">return</span>&nbsp;<span class="ident" id="4907164">f</span><br>
<span class="lineno"></span><span class="op" id="4907166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="4907169">var</span>&nbsp;<span class="op" id="4907173">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4907176">marshalerType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4907194">=</span>&nbsp;<span class="ident" id="4907196">reflect</span><span class="op" id="4907203">.</span><span class="ident" id="4907204">TypeOf</span><span class="op" id="4907210">(</span><span class="builtinfunc" id="4907211">new</span><span class="op" id="4907214">(</span><span class="ident" id="4907215">Marshaler</span><span class="op" id="4907224">)</span><span class="op" id="4907225">)</span><span class="op" id="4907226">.</span><span class="ident" id="4907227">Elem</span><span class="op" id="4907231">(</span><span class="op" id="4907232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4907235">textMarshalerType</span>&nbsp;<span class="op" id="4907253">=</span>&nbsp;<span class="ident" id="4907255">reflect</span><span class="op" id="4907262">.</span><span class="ident" id="4907263">TypeOf</span><span class="op" id="4907269">(</span><span class="builtinfunc" id="4907270">new</span><span class="op" id="4907273">(</span><span class="ident" id="4907274">encoding</span><span class="op" id="4907282">.</span><span class="ident" id="4907283">TextMarshaler</span><span class="op" id="4907296">)</span><span class="op" id="4907297">)</span><span class="op" id="4907298">.</span><span class="ident" id="4907299">Elem</span><span class="op" id="4907303">(</span><span class="op" id="4907304">)</span><br>
<span class="lineno"></span><span class="op" id="4907306">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="4907309">//&nbsp;newTypeEncoder&nbsp;constructs&nbsp;an&nbsp;encoderFunc&nbsp;for&nbsp;a&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="4907365">//&nbsp;The&nbsp;returned&nbsp;encoder&nbsp;only&nbsp;checks&nbsp;CanAddr&nbsp;when&nbsp;allowAddr&nbsp;is&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="4907433">func</span>&nbsp;<span class="ident" id="4907438">newTypeEncoder</span><span class="op" id="4907452">(</span><span class="ident" id="4907453">t</span>&nbsp;<span class="ident" id="4907455">reflect</span><span class="op" id="4907462">.</span><span class="ident" id="4907463">Type</span><span class="op" id="4907467">,</span>&nbsp;<span class="ident" id="4907469">allowAddr</span>&nbsp;<span class="builtintype" id="4907479">bool</span><span class="op" id="4907483">)</span>&nbsp;<span class="ident" id="4907485">encoderFunc</span>&nbsp;<span class="op" id="4907497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4907500">if</span>&nbsp;<span class="ident" id="4907503">t</span><span class="op" id="4907504">.</span><span class="ident" id="4907505">Implements</span><span class="op" id="4907515">(</span><span class="ident" id="4907516">marshalerType</span><span class="op" id="4907529">)</span>&nbsp;<span class="op" id="4907531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4907535">return</span>&nbsp;<span class="ident" id="4907542">marshalerEncoder</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4907560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4907563">if</span>&nbsp;<span class="ident" id="4907566">t</span><span class="op" id="4907567">.</span><span class="ident" id="4907568">Kind</span><span class="op" id="4907572">(</span><span class="op" id="4907573">)</span>&nbsp;<span class="op" id="4907575">!=</span>&nbsp;<span class="ident" id="4907578">reflect</span><span class="op" id="4907585">.</span><span class="ident" id="4907586">Ptr</span>&nbsp;<span class="op" id="4907590">&amp;&amp;</span>&nbsp;<span class="ident" id="4907593">allowAddr</span>&nbsp;<span class="op" id="4907603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4907607">if</span>&nbsp;<span class="ident" id="4907610">reflect</span><span class="op" id="4907617">.</span><span class="ident" id="4907618">PtrTo</span><span class="op" id="4907623">(</span><span class="ident" id="4907624">t</span><span class="op" id="4907625">)</span><span class="op" id="4907626">.</span><span class="ident" id="4907627">Implements</span><span class="op" id="4907637">(</span><span class="ident" id="4907638">marshalerType</span><span class="op" id="4907651">)</span>&nbsp;<span class="op" id="4907653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4907658">return</span>&nbsp;<span class="ident" id="4907665">newCondAddrEncoder</span><span class="op" id="4907683">(</span><span class="ident" id="4907684">addrMarshalerEncoder</span><span class="op" id="4907704">,</span>&nbsp;<span class="ident" id="4907706">newTypeEncoder</span><span class="op" id="4907720">(</span><span class="ident" id="4907721">t</span><span class="op" id="4907722">,</span>&nbsp;<span class="builtintype" id="4907724">false</span><span class="op" id="4907729">)</span><span class="op" id="4907730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4907734">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4907737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4907741">if</span>&nbsp;<span class="ident" id="4907744">t</span><span class="op" id="4907745">.</span><span class="ident" id="4907746">Implements</span><span class="op" id="4907756">(</span><span class="ident" id="4907757">textMarshalerType</span><span class="op" id="4907774">)</span>&nbsp;<span class="op" id="4907776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4907780">return</span>&nbsp;<span class="ident" id="4907787">textMarshalerEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4907809">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4907812">if</span>&nbsp;<span class="ident" id="4907815">t</span><span class="op" id="4907816">.</span><span class="ident" id="4907817">Kind</span><span class="op" id="4907821">(</span><span class="op" id="4907822">)</span>&nbsp;<span class="op" id="4907824">!=</span>&nbsp;<span class="ident" id="4907827">reflect</span><span class="op" id="4907834">.</span><span class="ident" id="4907835">Ptr</span>&nbsp;<span class="op" id="4907839">&amp;&amp;</span>&nbsp;<span class="ident" id="4907842">allowAddr</span>&nbsp;<span class="op" id="4907852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4907856">if</span>&nbsp;<span class="ident" id="4907859">reflect</span><span class="op" id="4907866">.</span><span class="ident" id="4907867">PtrTo</span><span class="op" id="4907872">(</span><span class="ident" id="4907873">t</span><span class="op" id="4907874">)</span><span class="op" id="4907875">.</span><span class="ident" id="4907876">Implements</span><span class="op" id="4907886">(</span><span class="ident" id="4907887">textMarshalerType</span><span class="op" id="4907904">)</span>&nbsp;<span class="op" id="4907906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4907911">return</span>&nbsp;<span class="ident" id="4907918">newCondAddrEncoder</span><span class="op" id="4907936">(</span><span class="ident" id="4907937">addrTextMarshalerEncoder</span><span class="op" id="4907961">,</span>&nbsp;<span class="ident" id="4907963">newTypeEncoder</span><span class="op" id="4907977">(</span><span class="ident" id="4907978">t</span><span class="op" id="4907979">,</span>&nbsp;<span class="builtintype" id="4907981">false</span><span class="op" id="4907986">)</span><span class="op" id="4907987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4907991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4907994">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4907998">switch</span>&nbsp;<span class="ident" id="4908005">t</span><span class="op" id="4908006">.</span><span class="ident" id="4908007">Kind</span><span class="op" id="4908011">(</span><span class="op" id="4908012">)</span>&nbsp;<span class="op" id="4908014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908017">case</span>&nbsp;<span class="ident" id="4908022">reflect</span><span class="op" id="4908029">.</span><span class="ident" id="4908030">Bool</span><span class="op" id="4908034">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908038">return</span>&nbsp;<span class="ident" id="4908045">boolEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908058">case</span>&nbsp;<span class="ident" id="4908063">reflect</span><span class="op" id="4908070">.</span><span class="ident" id="4908071">Int</span><span class="op" id="4908074">,</span>&nbsp;<span class="ident" id="4908076">reflect</span><span class="op" id="4908083">.</span><span class="ident" id="4908084">Int8</span><span class="op" id="4908088">,</span>&nbsp;<span class="ident" id="4908090">reflect</span><span class="op" id="4908097">.</span><span class="ident" id="4908098">Int16</span><span class="op" id="4908103">,</span>&nbsp;<span class="ident" id="4908105">reflect</span><span class="op" id="4908112">.</span><span class="ident" id="4908113">Int32</span><span class="op" id="4908118">,</span>&nbsp;<span class="ident" id="4908120">reflect</span><span class="op" id="4908127">.</span><span class="ident" id="4908128">Int64</span><span class="op" id="4908133">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908137">return</span>&nbsp;<span class="ident" id="4908144">intEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908156">case</span>&nbsp;<span class="ident" id="4908161">reflect</span><span class="op" id="4908168">.</span><span class="ident" id="4908169">Uint</span><span class="op" id="4908173">,</span>&nbsp;<span class="ident" id="4908175">reflect</span><span class="op" id="4908182">.</span><span class="ident" id="4908183">Uint8</span><span class="op" id="4908188">,</span>&nbsp;<span class="ident" id="4908190">reflect</span><span class="op" id="4908197">.</span><span class="ident" id="4908198">Uint16</span><span class="op" id="4908204">,</span>&nbsp;<span class="ident" id="4908206">reflect</span><span class="op" id="4908213">.</span><span class="ident" id="4908214">Uint32</span><span class="op" id="4908220">,</span>&nbsp;<span class="ident" id="4908222">reflect</span><span class="op" id="4908229">.</span><span class="ident" id="4908230">Uint64</span><span class="op" id="4908236">,</span>&nbsp;<span class="ident" id="4908238">reflect</span><span class="op" id="4908245">.</span><span class="ident" id="4908246">Uintptr</span><span class="op" id="4908253">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908257">return</span>&nbsp;<span class="ident" id="4908264">uintEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908277">case</span>&nbsp;<span class="ident" id="4908282">reflect</span><span class="op" id="4908289">.</span><span class="ident" id="4908290">Float32</span><span class="op" id="4908297">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908301">return</span>&nbsp;<span class="ident" id="4908308">float32Encoder</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908324">case</span>&nbsp;<span class="ident" id="4908329">reflect</span><span class="op" id="4908336">.</span><span class="ident" id="4908337">Float64</span><span class="op" id="4908344">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908348">return</span>&nbsp;<span class="ident" id="4908355">float64Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908371">case</span>&nbsp;<span class="ident" id="4908376">reflect</span><span class="op" id="4908383">.</span><span class="ident" id="4908384">String</span><span class="op" id="4908390">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908394">return</span>&nbsp;<span class="ident" id="4908401">stringEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908416">case</span>&nbsp;<span class="ident" id="4908421">reflect</span><span class="op" id="4908428">.</span><span class="ident" id="4908429">Interface</span><span class="op" id="4908438">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908442">return</span>&nbsp;<span class="ident" id="4908449">interfaceEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908467">case</span>&nbsp;<span class="ident" id="4908472">reflect</span><span class="op" id="4908479">.</span><span class="ident" id="4908480">Struct</span><span class="op" id="4908486">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908490">return</span>&nbsp;<span class="ident" id="4908497">newStructEncoder</span><span class="op" id="4908513">(</span><span class="ident" id="4908514">t</span><span class="op" id="4908515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908518">case</span>&nbsp;<span class="ident" id="4908523">reflect</span><span class="op" id="4908530">.</span><span class="ident" id="4908531">Map</span><span class="op" id="4908534">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908538">return</span>&nbsp;<span class="ident" id="4908545">newMapEncoder</span><span class="op" id="4908558">(</span><span class="ident" id="4908559">t</span><span class="op" id="4908560">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908563">case</span>&nbsp;<span class="ident" id="4908568">reflect</span><span class="op" id="4908575">.</span><span class="ident" id="4908576">Slice</span><span class="op" id="4908581">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908585">return</span>&nbsp;<span class="ident" id="4908592">newSliceEncoder</span><span class="op" id="4908607">(</span><span class="ident" id="4908608">t</span><span class="op" id="4908609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908612">case</span>&nbsp;<span class="ident" id="4908617">reflect</span><span class="op" id="4908624">.</span><span class="ident" id="4908625">Array</span><span class="op" id="4908630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908634">return</span>&nbsp;<span class="ident" id="4908641">newArrayEncoder</span><span class="op" id="4908656">(</span><span class="ident" id="4908657">t</span><span class="op" id="4908658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908661">case</span>&nbsp;<span class="ident" id="4908666">reflect</span><span class="op" id="4908673">.</span><span class="ident" id="4908674">Ptr</span><span class="op" id="4908677">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908681">return</span>&nbsp;<span class="ident" id="4908688">newPtrEncoder</span><span class="op" id="4908701">(</span><span class="ident" id="4908702">t</span><span class="op" id="4908703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908706">default</span><span class="op" id="4908713">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908717">return</span>&nbsp;<span class="ident" id="4908724">unsupportedTypeEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4908748">}</span><br>
<span class="lineno"></span><span class="op" id="4908750">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="4908753">func</span>&nbsp;<span class="ident" id="4908758">invalidValueEncoder</span><span class="op" id="4908777">(</span><span class="ident" id="4908778">e</span>&nbsp;<span class="op" id="4908780">*</span><span class="ident" id="4908781">encodeState</span><span class="op" id="4908792">,</span>&nbsp;<span class="ident" id="4908794">v</span>&nbsp;<span class="ident" id="4908796">reflect</span><span class="op" id="4908803">.</span><span class="ident" id="4908804">Value</span><span class="op" id="4908809">,</span>&nbsp;<span class="ident" id="4908811">quoted</span>&nbsp;<span class="builtintype" id="4908818">bool</span><span class="op" id="4908822">)</span>&nbsp;<span class="op" id="4908824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4908827">e</span><span class="op" id="4908828">.</span><span class="ident" id="4908829">WriteString</span><span class="op" id="4908840">(</span><span class="string" id="4908841">&#34;null&#34;</span><span class="op" id="4908847">)</span><br>
<span class="lineno"></span><span class="op" id="4908849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="keyword" id="4908852">func</span>&nbsp;<span class="ident" id="4908857">marshalerEncoder</span><span class="op" id="4908873">(</span><span class="ident" id="4908874">e</span>&nbsp;<span class="op" id="4908876">*</span><span class="ident" id="4908877">encodeState</span><span class="op" id="4908888">,</span>&nbsp;<span class="ident" id="4908890">v</span>&nbsp;<span class="ident" id="4908892">reflect</span><span class="op" id="4908899">.</span><span class="ident" id="4908900">Value</span><span class="op" id="4908905">,</span>&nbsp;<span class="ident" id="4908907">quoted</span>&nbsp;<span class="builtintype" id="4908914">bool</span><span class="op" id="4908918">)</span>&nbsp;<span class="op" id="4908920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908923">if</span>&nbsp;<span class="ident" id="4908926">v</span><span class="op" id="4908927">.</span><span class="ident" id="4908928">Kind</span><span class="op" id="4908932">(</span><span class="op" id="4908933">)</span>&nbsp;<span class="op" id="4908935">==</span>&nbsp;<span class="ident" id="4908938">reflect</span><span class="op" id="4908945">.</span><span class="ident" id="4908946">Ptr</span>&nbsp;<span class="op" id="4908950">&amp;&amp;</span>&nbsp;<span class="ident" id="4908953">v</span><span class="op" id="4908954">.</span><span class="ident" id="4908955">IsNil</span><span class="op" id="4908960">(</span><span class="op" id="4908961">)</span>&nbsp;<span class="op" id="4908963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4908967">e</span><span class="op" id="4908968">.</span><span class="ident" id="4908969">WriteString</span><span class="op" id="4908980">(</span><span class="string" id="4908981">&#34;null&#34;</span><span class="op" id="4908987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4908991">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4908999">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4909002">m</span>&nbsp;<span class="op" id="4909004">:=</span>&nbsp;<span class="ident" id="4909007">v</span><span class="op" id="4909008">.</span><span class="ident" id="4909009">Interface</span><span class="op" id="4909018">(</span><span class="op" id="4909019">)</span><span class="op" id="4909020">.</span><span class="op" id="4909021">(</span><span class="ident" id="4909022">Marshaler</span><span class="op" id="4909031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4909034">b</span><span class="op" id="4909035">,</span>&nbsp;<span class="ident" id="4909037">err</span>&nbsp;<span class="op" id="4909041">:=</span>&nbsp;<span class="ident" id="4909044">m</span><span class="op" id="4909045">.</span><span class="ident" id="4909046">MarshalJSON</span><span class="op" id="4909057">(</span><span class="op" id="4909058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4909061">if</span>&nbsp;<span class="ident" id="4909064">err</span>&nbsp;<span class="op" id="4909068">==</span>&nbsp;<span class="ident" id="4909071">nil</span>&nbsp;<span class="op" id="4909075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4909079">//&nbsp;copy&nbsp;JSON&nbsp;into&nbsp;buffer,&nbsp;checking&nbsp;validity.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4909126">err</span>&nbsp;<span class="op" id="4909130">=</span>&nbsp;<span class="ident" id="4909132">compact</span><span class="op" id="4909139">(</span><span class="op" id="4909140">&amp;</span><span class="ident" id="4909141">e</span><span class="op" id="4909142">.</span><span class="ident" id="4909143">Buffer</span><span class="op" id="4909149">,</span>&nbsp;<span class="ident" id="4909151">b</span><span class="op" id="4909152">,</span>&nbsp;<span class="builtintype" id="4909154">true</span><span class="op" id="4909158">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4909161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4909164">if</span>&nbsp;<span class="ident" id="4909167">err</span>&nbsp;<span class="op" id="4909171">!=</span>&nbsp;<span class="ident" id="4909174">nil</span>&nbsp;<span class="op" id="4909178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4909182">e</span><span class="op" id="4909183">.</span><span class="builtintype" id="4909184">error</span><span class="op" id="4909189">(</span><span class="op" id="4909190">&amp;</span><span class="ident" id="4909191">MarshalerError</span><span class="op" id="4909205">{</span><span class="ident" id="4909206">v</span><span class="op" id="4909207">.</span><span class="ident" id="4909208">Type</span><span class="op" id="4909212">(</span><span class="op" id="4909213">)</span><span class="op" id="4909214">,</span>&nbsp;<span class="ident" id="4909216">err</span><span class="op" id="4909219">}</span><span class="op" id="4909220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4909223">}</span><br>
<span class="lineno"></span><span class="op" id="4909225">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="4909228">func</span>&nbsp;<span class="ident" id="4909233">addrMarshalerEncoder</span><span class="op" id="4909253">(</span><span class="ident" id="4909254">e</span>&nbsp;<span class="op" id="4909256">*</span><span class="ident" id="4909257">encodeState</span><span class="op" id="4909268">,</span>&nbsp;<span class="ident" id="4909270">v</span>&nbsp;<span class="ident" id="4909272">reflect</span><span class="op" id="4909279">.</span><span class="ident" id="4909280">Value</span><span class="op" id="4909285">,</span>&nbsp;<span class="ident" id="4909287">quoted</span>&nbsp;<span class="builtintype" id="4909294">bool</span><span class="op" id="4909298">)</span>&nbsp;<span class="op" id="4909300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4909303">va</span>&nbsp;<span class="op" id="4909306">:=</span>&nbsp;<span class="ident" id="4909309">v</span><span class="op" id="4909310">.</span><span class="ident" id="4909311">Addr</span><span class="op" id="4909315">(</span><span class="op" id="4909316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4909319">if</span>&nbsp;<span class="ident" id="4909322">va</span><span class="op" id="4909324">.</span><span class="ident" id="4909325">IsNil</span><span class="op" id="4909330">(</span><span class="op" id="4909331">)</span>&nbsp;<span class="op" id="4909333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4909337">e</span><span class="op" id="4909338">.</span><span class="ident" id="4909339">WriteString</span><span class="op" id="4909350">(</span><span class="string" id="4909351">&#34;null&#34;</span><span class="op" id="4909357">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4909361">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4909369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4909372">m</span>&nbsp;<span class="op" id="4909374">:=</span>&nbsp;<span class="ident" id="4909377">va</span><span class="op" id="4909379">.</span><span class="ident" id="4909380">Interface</span><span class="op" id="4909389">(</span><span class="op" id="4909390">)</span><span class="op" id="4909391">.</span><span class="op" id="4909392">(</span><span class="ident" id="4909393">Marshaler</span><span class="op" id="4909402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4909405">b</span><span class="op" id="4909406">,</span>&nbsp;<span class="ident" id="4909408">err</span>&nbsp;<span class="op" id="4909412">:=</span>&nbsp;<span class="ident" id="4909415">m</span><span class="op" id="4909416">.</span><span class="ident" id="4909417">MarshalJSON</span><span class="op" id="4909428">(</span><span class="op" id="4909429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4909432">if</span>&nbsp;<span class="ident" id="4909435">err</span>&nbsp;<span class="op" id="4909439">==</span>&nbsp;<span class="ident" id="4909442">nil</span>&nbsp;<span class="op" id="4909446">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4909450">//&nbsp;copy&nbsp;JSON&nbsp;into&nbsp;buffer,&nbsp;checking&nbsp;validity.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4909497">err</span>&nbsp;<span class="op" id="4909501">=</span>&nbsp;<span class="ident" id="4909503">compact</span><span class="op" id="4909510">(</span><span class="op" id="4909511">&amp;</span><span class="ident" id="4909512">e</span><span class="op" id="4909513">.</span><span class="ident" id="4909514">Buffer</span><span class="op" id="4909520">,</span>&nbsp;<span class="ident" id="4909522">b</span><span class="op" id="4909523">,</span>&nbsp;<span class="builtintype" id="4909525">true</span><span class="op" id="4909529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4909532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4909535">if</span>&nbsp;<span class="ident" id="4909538">err</span>&nbsp;<span class="op" id="4909542">!=</span>&nbsp;<span class="ident" id="4909545">nil</span>&nbsp;<span class="op" id="4909549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4909553">e</span><span class="op" id="4909554">.</span><span class="builtintype" id="4909555">error</span><span class="op" id="4909560">(</span><span class="op" id="4909561">&amp;</span><span class="ident" id="4909562">MarshalerError</span><span class="op" id="4909576">{</span><span class="ident" id="4909577">v</span><span class="op" id="4909578">.</span><span class="ident" id="4909579">Type</span><span class="op" id="4909583">(</span><span class="op" id="4909584">)</span><span class="op" id="4909585">,</span>&nbsp;<span class="ident" id="4909587">err</span><span class="op" id="4909590">}</span><span class="op" id="4909591">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4909594">}</span><br>
<span class="lineno"></span><span class="op" id="4909596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4909599">func</span>&nbsp;<span class="ident" id="4909604">textMarshalerEncoder</span><span class="op" id="4909624">(</span><span class="ident" id="4909625">e</span>&nbsp;<span class="op" id="4909627">*</span><span class="ident" id="4909628">encodeState</span><span class="op" id="4909639">,</span>&nbsp;<span class="ident" id="4909641">v</span>&nbsp;<span class="ident" id="4909643">reflect</span><span class="op" id="4909650">.</span><span class="ident" id="4909651">Value</span><span class="op" id="4909656">,</span>&nbsp;<span class="ident" id="4909658">quoted</span>&nbsp;<span class="builtintype" id="4909665">bool</span><span class="op" id="4909669">)</span>&nbsp;<span class="op" id="4909671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4909674">if</span>&nbsp;<span class="ident" id="4909677">v</span><span class="op" id="4909678">.</span><span class="ident" id="4909679">Kind</span><span class="op" id="4909683">(</span><span class="op" id="4909684">)</span>&nbsp;<span class="op" id="4909686">==</span>&nbsp;<span class="ident" id="4909689">reflect</span><span class="op" id="4909696">.</span><span class="ident" id="4909697">Ptr</span>&nbsp;<span class="op" id="4909701">&amp;&amp;</span>&nbsp;<span class="ident" id="4909704">v</span><span class="op" id="4909705">.</span><span class="ident" id="4909706">IsNil</span><span class="op" id="4909711">(</span><span class="op" id="4909712">)</span>&nbsp;<span class="op" id="4909714">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4909718">e</span><span class="op" id="4909719">.</span><span class="ident" id="4909720">WriteString</span><span class="op" id="4909731">(</span><span class="string" id="4909732">&#34;null&#34;</span><span class="op" id="4909738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4909742">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4909750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4909753">m</span>&nbsp;<span class="op" id="4909755">:=</span>&nbsp;<span class="ident" id="4909758">v</span><span class="op" id="4909759">.</span><span class="ident" id="4909760">Interface</span><span class="op" id="4909769">(</span><span class="op" id="4909770">)</span><span class="op" id="4909771">.</span><span class="op" id="4909772">(</span><span class="ident" id="4909773">encoding</span><span class="op" id="4909781">.</span><span class="ident" id="4909782">TextMarshaler</span><span class="op" id="4909795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4909798">b</span><span class="op" id="4909799">,</span>&nbsp;<span class="ident" id="4909801">err</span>&nbsp;<span class="op" id="4909805">:=</span>&nbsp;<span class="ident" id="4909808">m</span><span class="op" id="4909809">.</span><span class="ident" id="4909810">MarshalText</span><span class="op" id="4909821">(</span><span class="op" id="4909822">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4909825">if</span>&nbsp;<span class="ident" id="4909828">err</span>&nbsp;<span class="op" id="4909832">==</span>&nbsp;<span class="ident" id="4909835">nil</span>&nbsp;<span class="op" id="4909839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4909843">_</span><span class="op" id="4909844">,</span>&nbsp;<span class="ident" id="4909846">err</span>&nbsp;<span class="op" id="4909850">=</span>&nbsp;<span class="ident" id="4909852">e</span><span class="op" id="4909853">.</span><span class="ident" id="4909854">stringBytes</span><span class="op" id="4909865">(</span><span class="ident" id="4909866">b</span><span class="op" id="4909867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4909870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4909873">if</span>&nbsp;<span class="ident" id="4909876">err</span>&nbsp;<span class="op" id="4909880">!=</span>&nbsp;<span class="ident" id="4909883">nil</span>&nbsp;<span class="op" id="4909887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4909891">e</span><span class="op" id="4909892">.</span><span class="builtintype" id="4909893">error</span><span class="op" id="4909898">(</span><span class="op" id="4909899">&amp;</span><span class="ident" id="4909900">MarshalerError</span><span class="op" id="4909914">{</span><span class="ident" id="4909915">v</span><span class="op" id="4909916">.</span><span class="ident" id="4909917">Type</span><span class="op" id="4909921">(</span><span class="op" id="4909922">)</span><span class="op" id="4909923">,</span>&nbsp;<span class="ident" id="4909925">err</span><span class="op" id="4909928">}</span><span class="op" id="4909929">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4909932">}</span><br>
<span class="lineno"></span><span class="op" id="4909934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4909937">func</span>&nbsp;<span class="ident" id="4909942">addrTextMarshalerEncoder</span><span class="op" id="4909966">(</span><span class="ident" id="4909967">e</span>&nbsp;<span class="op" id="4909969">*</span><span class="ident" id="4909970">encodeState</span><span class="op" id="4909981">,</span>&nbsp;<span class="ident" id="4909983">v</span>&nbsp;<span class="ident" id="4909985">reflect</span><span class="op" id="4909992">.</span><span class="ident" id="4909993">Value</span><span class="op" id="4909998">,</span>&nbsp;<span class="ident" id="4910000">quoted</span>&nbsp;<span class="builtintype" id="4910007">bool</span><span class="op" id="4910011">)</span>&nbsp;<span class="op" id="4910013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910016">va</span>&nbsp;<span class="op" id="4910019">:=</span>&nbsp;<span class="ident" id="4910022">v</span><span class="op" id="4910023">.</span><span class="ident" id="4910024">Addr</span><span class="op" id="4910028">(</span><span class="op" id="4910029">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4910032">if</span>&nbsp;<span class="ident" id="4910035">va</span><span class="op" id="4910037">.</span><span class="ident" id="4910038">IsNil</span><span class="op" id="4910043">(</span><span class="op" id="4910044">)</span>&nbsp;<span class="op" id="4910046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910050">e</span><span class="op" id="4910051">.</span><span class="ident" id="4910052">WriteString</span><span class="op" id="4910063">(</span><span class="string" id="4910064">&#34;null&#34;</span><span class="op" id="4910070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4910074">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4910082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910085">m</span>&nbsp;<span class="op" id="4910087">:=</span>&nbsp;<span class="ident" id="4910090">va</span><span class="op" id="4910092">.</span><span class="ident" id="4910093">Interface</span><span class="op" id="4910102">(</span><span class="op" id="4910103">)</span><span class="op" id="4910104">.</span><span class="op" id="4910105">(</span><span class="ident" id="4910106">encoding</span><span class="op" id="4910114">.</span><span class="ident" id="4910115">TextMarshaler</span><span class="op" id="4910128">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910131">b</span><span class="op" id="4910132">,</span>&nbsp;<span class="ident" id="4910134">err</span>&nbsp;<span class="op" id="4910138">:=</span>&nbsp;<span class="ident" id="4910141">m</span><span class="op" id="4910142">.</span><span class="ident" id="4910143">MarshalText</span><span class="op" id="4910154">(</span><span class="op" id="4910155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4910158">if</span>&nbsp;<span class="ident" id="4910161">err</span>&nbsp;<span class="op" id="4910165">==</span>&nbsp;<span class="ident" id="4910168">nil</span>&nbsp;<span class="op" id="4910172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910176">_</span><span class="op" id="4910177">,</span>&nbsp;<span class="ident" id="4910179">err</span>&nbsp;<span class="op" id="4910183">=</span>&nbsp;<span class="ident" id="4910185">e</span><span class="op" id="4910186">.</span><span class="ident" id="4910187">stringBytes</span><span class="op" id="4910198">(</span><span class="ident" id="4910199">b</span><span class="op" id="4910200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4910203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4910206">if</span>&nbsp;<span class="ident" id="4910209">err</span>&nbsp;<span class="op" id="4910213">!=</span>&nbsp;<span class="ident" id="4910216">nil</span>&nbsp;<span class="op" id="4910220">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910224">e</span><span class="op" id="4910225">.</span><span class="builtintype" id="4910226">error</span><span class="op" id="4910231">(</span><span class="op" id="4910232">&amp;</span><span class="ident" id="4910233">MarshalerError</span><span class="op" id="4910247">{</span><span class="ident" id="4910248">v</span><span class="op" id="4910249">.</span><span class="ident" id="4910250">Type</span><span class="op" id="4910254">(</span><span class="op" id="4910255">)</span><span class="op" id="4910256">,</span>&nbsp;<span class="ident" id="4910258">err</span><span class="op" id="4910261">}</span><span class="op" id="4910262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4910265">}</span><br>
<span class="lineno"></span><span class="op" id="4910267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4910270">func</span>&nbsp;<span class="ident" id="4910275">boolEncoder</span><span class="op" id="4910286">(</span><span class="ident" id="4910287">e</span>&nbsp;<span class="op" id="4910289">*</span><span class="ident" id="4910290">encodeState</span><span class="op" id="4910301">,</span>&nbsp;<span class="ident" id="4910303">v</span>&nbsp;<span class="ident" id="4910305">reflect</span><span class="op" id="4910312">.</span><span class="ident" id="4910313">Value</span><span class="op" id="4910318">,</span>&nbsp;<span class="ident" id="4910320">quoted</span>&nbsp;<span class="builtintype" id="4910327">bool</span><span class="op" id="4910331">)</span>&nbsp;<span class="op" id="4910333">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4910336">if</span>&nbsp;<span class="ident" id="4910339">quoted</span>&nbsp;<span class="op" id="4910346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910350">e</span><span class="op" id="4910351">.</span><span class="ident" id="4910352">WriteByte</span><span class="op" id="4910361">(</span><span class="string" id="4910362">&#39;&#34;&#39;</span><span class="op" id="4910365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4910368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4910371">if</span>&nbsp;<span class="ident" id="4910374">v</span><span class="op" id="4910375">.</span><span class="ident" id="4910376">Bool</span><span class="op" id="4910380">(</span><span class="op" id="4910381">)</span>&nbsp;<span class="op" id="4910383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910387">e</span><span class="op" id="4910388">.</span><span class="ident" id="4910389">WriteString</span><span class="op" id="4910400">(</span><span class="string" id="4910401">&#34;true&#34;</span><span class="op" id="4910407">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4910410">}</span>&nbsp;<span class="keyword" id="4910412">else</span>&nbsp;<span class="op" id="4910417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910421">e</span><span class="op" id="4910422">.</span><span class="ident" id="4910423">WriteString</span><span class="op" id="4910434">(</span><span class="string" id="4910435">&#34;false&#34;</span><span class="op" id="4910442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4910445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4910448">if</span>&nbsp;<span class="ident" id="4910451">quoted</span>&nbsp;<span class="op" id="4910458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910462">e</span><span class="op" id="4910463">.</span><span class="ident" id="4910464">WriteByte</span><span class="op" id="4910473">(</span><span class="string" id="4910474">&#39;&#34;&#39;</span><span class="op" id="4910477">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4910480">}</span><br>
<span class="lineno"></span><span class="op" id="4910482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4910485">func</span>&nbsp;<span class="ident" id="4910490">intEncoder</span><span class="op" id="4910500">(</span><span class="ident" id="4910501">e</span>&nbsp;<span class="op" id="4910503">*</span><span class="ident" id="4910504">encodeState</span><span class="op" id="4910515">,</span>&nbsp;<span class="ident" id="4910517">v</span>&nbsp;<span class="ident" id="4910519">reflect</span><span class="op" id="4910526">.</span><span class="ident" id="4910527">Value</span><span class="op" id="4910532">,</span>&nbsp;<span class="ident" id="4910534">quoted</span>&nbsp;<span class="builtintype" id="4910541">bool</span><span class="op" id="4910545">)</span>&nbsp;<span class="op" id="4910547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910550">b</span>&nbsp;<span class="op" id="4910552">:=</span>&nbsp;<span class="ident" id="4910555">strconv</span><span class="op" id="4910562">.</span><span class="ident" id="4910563">AppendInt</span><span class="op" id="4910572">(</span><span class="ident" id="4910573">e</span><span class="op" id="4910574">.</span><span class="ident" id="4910575">scratch</span><span class="op" id="4910582">[</span><span class="op" id="4910583">:</span><span class="num" id="4910584">0</span><span class="op" id="4910585">]</span><span class="op" id="4910586">,</span>&nbsp;<span class="ident" id="4910588">v</span><span class="op" id="4910589">.</span><span class="ident" id="4910590">Int</span><span class="op" id="4910593">(</span><span class="op" id="4910594">)</span><span class="op" id="4910595">,</span>&nbsp;<span class="num" id="4910597">10</span><span class="op" id="4910599">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4910602">if</span>&nbsp;<span class="ident" id="4910605">quoted</span>&nbsp;<span class="op" id="4910612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910616">e</span><span class="op" id="4910617">.</span><span class="ident" id="4910618">WriteByte</span><span class="op" id="4910627">(</span><span class="string" id="4910628">&#39;&#34;&#39;</span><span class="op" id="4910631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4910634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910637">e</span><span class="op" id="4910638">.</span><span class="ident" id="4910639">Write</span><span class="op" id="4910644">(</span><span class="ident" id="4910645">b</span><span class="op" id="4910646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4910649">if</span>&nbsp;<span class="ident" id="4910652">quoted</span>&nbsp;<span class="op" id="4910659">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910663">e</span><span class="op" id="4910664">.</span><span class="ident" id="4910665">WriteByte</span><span class="op" id="4910674">(</span><span class="string" id="4910675">&#39;&#34;&#39;</span><span class="op" id="4910678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4910681">}</span><br>
<span class="lineno"></span><span class="op" id="4910683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4910686">func</span>&nbsp;<span class="ident" id="4910691">uintEncoder</span><span class="op" id="4910702">(</span><span class="ident" id="4910703">e</span>&nbsp;<span class="op" id="4910705">*</span><span class="ident" id="4910706">encodeState</span><span class="op" id="4910717">,</span>&nbsp;<span class="ident" id="4910719">v</span>&nbsp;<span class="ident" id="4910721">reflect</span><span class="op" id="4910728">.</span><span class="ident" id="4910729">Value</span><span class="op" id="4910734">,</span>&nbsp;<span class="ident" id="4910736">quoted</span>&nbsp;<span class="builtintype" id="4910743">bool</span><span class="op" id="4910747">)</span>&nbsp;<span class="op" id="4910749">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910752">b</span>&nbsp;<span class="op" id="4910754">:=</span>&nbsp;<span class="ident" id="4910757">strconv</span><span class="op" id="4910764">.</span><span class="ident" id="4910765">AppendUint</span><span class="op" id="4910775">(</span><span class="ident" id="4910776">e</span><span class="op" id="4910777">.</span><span class="ident" id="4910778">scratch</span><span class="op" id="4910785">[</span><span class="op" id="4910786">:</span><span class="num" id="4910787">0</span><span class="op" id="4910788">]</span><span class="op" id="4910789">,</span>&nbsp;<span class="ident" id="4910791">v</span><span class="op" id="4910792">.</span><span class="ident" id="4910793">Uint</span><span class="op" id="4910797">(</span><span class="op" id="4910798">)</span><span class="op" id="4910799">,</span>&nbsp;<span class="num" id="4910801">10</span><span class="op" id="4910803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4910806">if</span>&nbsp;<span class="ident" id="4910809">quoted</span>&nbsp;<span class="op" id="4910816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910820">e</span><span class="op" id="4910821">.</span><span class="ident" id="4910822">WriteByte</span><span class="op" id="4910831">(</span><span class="string" id="4910832">&#39;&#34;&#39;</span><span class="op" id="4910835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4910838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910841">e</span><span class="op" id="4910842">.</span><span class="ident" id="4910843">Write</span><span class="op" id="4910848">(</span><span class="ident" id="4910849">b</span><span class="op" id="4910850">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4910853">if</span>&nbsp;<span class="ident" id="4910856">quoted</span>&nbsp;<span class="op" id="4910863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4910867">e</span><span class="op" id="4910868">.</span><span class="ident" id="4910869">WriteByte</span><span class="op" id="4910878">(</span><span class="string" id="4910879">&#39;&#34;&#39;</span><span class="op" id="4910882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4910885">}</span><br>
<span class="lineno"></span><span class="op" id="4910887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span><span class="keyword" id="4910890">type</span>&nbsp;<span class="ident" id="4910895">floatEncoder</span>&nbsp;<span class="builtintype" id="4910908">int</span>&nbsp;<span class="comment" id="4910912">//&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4910931">func</span>&nbsp;<span class="op" id="4910936">(</span><span class="ident" id="4910937">bits</span>&nbsp;<span class="ident" id="4910942">floatEncoder</span><span class="op" id="4910954">)</span>&nbsp;<span class="ident" id="4910956">encode</span><span class="op" id="4910962">(</span><span class="ident" id="4910963">e</span>&nbsp;<span class="op" id="4910965">*</span><span class="ident" id="4910966">encodeState</span><span class="op" id="4910977">,</span>&nbsp;<span class="ident" id="4910979">v</span>&nbsp;<span class="ident" id="4910981">reflect</span><span class="op" id="4910988">.</span><span class="ident" id="4910989">Value</span><span class="op" id="4910994">,</span>&nbsp;<span class="ident" id="4910996">quoted</span>&nbsp;<span class="builtintype" id="4911003">bool</span><span class="op" id="4911007">)</span>&nbsp;<span class="op" id="4911009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911012">f</span>&nbsp;<span class="op" id="4911014">:=</span>&nbsp;<span class="ident" id="4911017">v</span><span class="op" id="4911018">.</span><span class="ident" id="4911019">Float</span><span class="op" id="4911024">(</span><span class="op" id="4911025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4911028">if</span>&nbsp;<span class="ident" id="4911031">math</span><span class="op" id="4911035">.</span><span class="ident" id="4911036">IsInf</span><span class="op" id="4911041">(</span><span class="ident" id="4911042">f</span><span class="op" id="4911043">,</span>&nbsp;<span class="num" id="4911045">0</span><span class="op" id="4911046">)</span>&nbsp;<span class="op" id="4911048">||</span>&nbsp;<span class="ident" id="4911051">math</span><span class="op" id="4911055">.</span><span class="ident" id="4911056">IsNaN</span><span class="op" id="4911061">(</span><span class="ident" id="4911062">f</span><span class="op" id="4911063">)</span>&nbsp;<span class="op" id="4911065">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911069">e</span><span class="op" id="4911070">.</span><span class="builtintype" id="4911071">error</span><span class="op" id="4911076">(</span><span class="op" id="4911077">&amp;</span><span class="ident" id="4911078">UnsupportedValueError</span><span class="op" id="4911099">{</span><span class="ident" id="4911100">v</span><span class="op" id="4911101">,</span>&nbsp;<span class="ident" id="4911103">strconv</span><span class="op" id="4911110">.</span><span class="ident" id="4911111">FormatFloat</span><span class="op" id="4911122">(</span><span class="ident" id="4911123">f</span><span class="op" id="4911124">,</span>&nbsp;<span class="string" id="4911126">&#39;g&#39;</span><span class="op" id="4911129">,</span>&nbsp;<span class="op" id="4911131">-</span><span class="num" id="4911132">1</span><span class="op" id="4911133">,</span>&nbsp;<span class="builtintype" id="4911135">int</span><span class="op" id="4911138">(</span><span class="ident" id="4911139">bits</span><span class="op" id="4911143">)</span><span class="op" id="4911144">)</span><span class="op" id="4911145">}</span><span class="op" id="4911146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4911149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911152">b</span>&nbsp;<span class="op" id="4911154">:=</span>&nbsp;<span class="ident" id="4911157">strconv</span><span class="op" id="4911164">.</span><span class="ident" id="4911165">AppendFloat</span><span class="op" id="4911176">(</span><span class="ident" id="4911177">e</span><span class="op" id="4911178">.</span><span class="ident" id="4911179">scratch</span><span class="op" id="4911186">[</span><span class="op" id="4911187">:</span><span class="num" id="4911188">0</span><span class="op" id="4911189">]</span><span class="op" id="4911190">,</span>&nbsp;<span class="ident" id="4911192">f</span><span class="op" id="4911193">,</span>&nbsp;<span class="string" id="4911195">&#39;g&#39;</span><span class="op" id="4911198">,</span>&nbsp;<span class="op" id="4911200">-</span><span class="num" id="4911201">1</span><span class="op" id="4911202">,</span>&nbsp;<span class="builtintype" id="4911204">int</span><span class="op" id="4911207">(</span><span class="ident" id="4911208">bits</span><span class="op" id="4911212">)</span><span class="op" id="4911213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4911216">if</span>&nbsp;<span class="ident" id="4911219">quoted</span>&nbsp;<span class="op" id="4911226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911230">e</span><span class="op" id="4911231">.</span><span class="ident" id="4911232">WriteByte</span><span class="op" id="4911241">(</span><span class="string" id="4911242">&#39;&#34;&#39;</span><span class="op" id="4911245">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4911248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911251">e</span><span class="op" id="4911252">.</span><span class="ident" id="4911253">Write</span><span class="op" id="4911258">(</span><span class="ident" id="4911259">b</span><span class="op" id="4911260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4911263">if</span>&nbsp;<span class="ident" id="4911266">quoted</span>&nbsp;<span class="op" id="4911273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911277">e</span><span class="op" id="4911278">.</span><span class="ident" id="4911279">WriteByte</span><span class="op" id="4911288">(</span><span class="string" id="4911289">&#39;&#34;&#39;</span><span class="op" id="4911292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4911295">}</span><br>
<span class="lineno">525</span><span class="op" id="4911297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4911300">var</span>&nbsp;<span class="op" id="4911304">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911307">float32Encoder</span>&nbsp;<span class="op" id="4911322">=</span>&nbsp;<span class="op" id="4911324">(</span><span class="ident" id="4911325">floatEncoder</span><span class="op" id="4911337">(</span><span class="num" id="4911338">32</span><span class="op" id="4911340">)</span><span class="op" id="4911341">)</span><span class="op" id="4911342">.</span><span class="ident" id="4911343">encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911351">float64Encoder</span>&nbsp;<span class="op" id="4911366">=</span>&nbsp;<span class="op" id="4911368">(</span><span class="ident" id="4911369">floatEncoder</span><span class="op" id="4911381">(</span><span class="num" id="4911382">64</span><span class="op" id="4911384">)</span><span class="op" id="4911385">)</span><span class="op" id="4911386">.</span><span class="ident" id="4911387">encode</span><br>
<span class="lineno">530</span><span class="op" id="4911394">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4911397">func</span>&nbsp;<span class="ident" id="4911402">stringEncoder</span><span class="op" id="4911415">(</span><span class="ident" id="4911416">e</span>&nbsp;<span class="op" id="4911418">*</span><span class="ident" id="4911419">encodeState</span><span class="op" id="4911430">,</span>&nbsp;<span class="ident" id="4911432">v</span>&nbsp;<span class="ident" id="4911434">reflect</span><span class="op" id="4911441">.</span><span class="ident" id="4911442">Value</span><span class="op" id="4911447">,</span>&nbsp;<span class="ident" id="4911449">quoted</span>&nbsp;<span class="builtintype" id="4911456">bool</span><span class="op" id="4911460">)</span>&nbsp;<span class="op" id="4911462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4911465">if</span>&nbsp;<span class="ident" id="4911468">v</span><span class="op" id="4911469">.</span><span class="ident" id="4911470">Type</span><span class="op" id="4911474">(</span><span class="op" id="4911475">)</span>&nbsp;<span class="op" id="4911477">==</span>&nbsp;<span class="ident" id="4911480">numberType</span>&nbsp;<span class="op" id="4911491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911495">numStr</span>&nbsp;<span class="op" id="4911502">:=</span>&nbsp;<span class="ident" id="4911505">v</span><span class="op" id="4911506">.</span><span class="ident" id="4911507">String</span><span class="op" id="4911513">(</span><span class="op" id="4911514">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4911518">if</span>&nbsp;<span class="ident" id="4911521">numStr</span>&nbsp;<span class="op" id="4911528">==</span>&nbsp;<span class="string" id="4911531">&#34;&#34;</span>&nbsp;<span class="op" id="4911534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911539">numStr</span>&nbsp;<span class="op" id="4911546">=</span>&nbsp;<span class="string" id="4911548">&#34;0&#34;</span>&nbsp;<span class="comment" id="4911552">//&nbsp;Number&#39;s&nbsp;zero-val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4911575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911579">e</span><span class="op" id="4911580">.</span><span class="ident" id="4911581">WriteString</span><span class="op" id="4911592">(</span><span class="ident" id="4911593">numStr</span><span class="op" id="4911599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4911603">return</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4911611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4911614">if</span>&nbsp;<span class="ident" id="4911617">quoted</span>&nbsp;<span class="op" id="4911624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911628">sb</span><span class="op" id="4911630">,</span>&nbsp;<span class="ident" id="4911632">err</span>&nbsp;<span class="op" id="4911636">:=</span>&nbsp;<span class="ident" id="4911639">Marshal</span><span class="op" id="4911646">(</span><span class="ident" id="4911647">v</span><span class="op" id="4911648">.</span><span class="ident" id="4911649">String</span><span class="op" id="4911655">(</span><span class="op" id="4911656">)</span><span class="op" id="4911657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4911661">if</span>&nbsp;<span class="ident" id="4911664">err</span>&nbsp;<span class="op" id="4911668">!=</span>&nbsp;<span class="ident" id="4911671">nil</span>&nbsp;<span class="op" id="4911675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911680">e</span><span class="op" id="4911681">.</span><span class="builtintype" id="4911682">error</span><span class="op" id="4911687">(</span><span class="ident" id="4911688">err</span><span class="op" id="4911691">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4911695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911699">e</span><span class="op" id="4911700">.</span><span class="builtintype" id="4911701">string</span><span class="op" id="4911707">(</span><span class="builtintype" id="4911708">string</span><span class="op" id="4911714">(</span><span class="ident" id="4911715">sb</span><span class="op" id="4911717">)</span><span class="op" id="4911718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4911721">}</span>&nbsp;<span class="keyword" id="4911723">else</span>&nbsp;<span class="op" id="4911728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911732">e</span><span class="op" id="4911733">.</span><span class="builtintype" id="4911734">string</span><span class="op" id="4911740">(</span><span class="ident" id="4911741">v</span><span class="op" id="4911742">.</span><span class="ident" id="4911743">String</span><span class="op" id="4911749">(</span><span class="op" id="4911750">)</span><span class="op" id="4911751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4911754">}</span><br>
<span class="lineno">550</span><span class="op" id="4911756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4911759">func</span>&nbsp;<span class="ident" id="4911764">interfaceEncoder</span><span class="op" id="4911780">(</span><span class="ident" id="4911781">e</span>&nbsp;<span class="op" id="4911783">*</span><span class="ident" id="4911784">encodeState</span><span class="op" id="4911795">,</span>&nbsp;<span class="ident" id="4911797">v</span>&nbsp;<span class="ident" id="4911799">reflect</span><span class="op" id="4911806">.</span><span class="ident" id="4911807">Value</span><span class="op" id="4911812">,</span>&nbsp;<span class="ident" id="4911814">quoted</span>&nbsp;<span class="builtintype" id="4911821">bool</span><span class="op" id="4911825">)</span>&nbsp;<span class="op" id="4911827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4911830">if</span>&nbsp;<span class="ident" id="4911833">v</span><span class="op" id="4911834">.</span><span class="ident" id="4911835">IsNil</span><span class="op" id="4911840">(</span><span class="op" id="4911841">)</span>&nbsp;<span class="op" id="4911843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911847">e</span><span class="op" id="4911848">.</span><span class="ident" id="4911849">WriteString</span><span class="op" id="4911860">(</span><span class="string" id="4911861">&#34;null&#34;</span><span class="op" id="4911867">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4911871">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4911879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911882">e</span><span class="op" id="4911883">.</span><span class="ident" id="4911884">reflectValue</span><span class="op" id="4911896">(</span><span class="ident" id="4911897">v</span><span class="op" id="4911898">.</span><span class="ident" id="4911899">Elem</span><span class="op" id="4911903">(</span><span class="op" id="4911904">)</span><span class="op" id="4911905">)</span><br>
<span class="lineno"></span><span class="op" id="4911907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span><span class="keyword" id="4911910">func</span>&nbsp;<span class="ident" id="4911915">unsupportedTypeEncoder</span><span class="op" id="4911937">(</span><span class="ident" id="4911938">e</span>&nbsp;<span class="op" id="4911940">*</span><span class="ident" id="4911941">encodeState</span><span class="op" id="4911952">,</span>&nbsp;<span class="ident" id="4911954">v</span>&nbsp;<span class="ident" id="4911956">reflect</span><span class="op" id="4911963">.</span><span class="ident" id="4911964">Value</span><span class="op" id="4911969">,</span>&nbsp;<span class="ident" id="4911971">quoted</span>&nbsp;<span class="builtintype" id="4911978">bool</span><span class="op" id="4911982">)</span>&nbsp;<span class="op" id="4911984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4911987">e</span><span class="op" id="4911988">.</span><span class="builtintype" id="4911989">error</span><span class="op" id="4911994">(</span><span class="op" id="4911995">&amp;</span><span class="ident" id="4911996">UnsupportedTypeError</span><span class="op" id="4912016">{</span><span class="ident" id="4912017">v</span><span class="op" id="4912018">.</span><span class="ident" id="4912019">Type</span><span class="op" id="4912023">(</span><span class="op" id="4912024">)</span><span class="op" id="4912025">}</span><span class="op" id="4912026">)</span><br>
<span class="lineno"></span><span class="op" id="4912028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4912031">type</span>&nbsp;<span class="ident" id="4912036">structEncoder</span>&nbsp;<span class="keyword" id="4912050">struct</span>&nbsp;<span class="op" id="4912057">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912060">fields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4912070">[</span><span class="op" id="4912071">]</span><span class="ident" id="4912072">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912079">fieldEncs</span>&nbsp;<span class="op" id="4912089">[</span><span class="op" id="4912090">]</span><span class="ident" id="4912091">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4912103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4912106">func</span>&nbsp;<span class="op" id="4912111">(</span><span class="ident" id="4912112">se</span>&nbsp;<span class="op" id="4912115">*</span><span class="ident" id="4912116">structEncoder</span><span class="op" id="4912129">)</span>&nbsp;<span class="ident" id="4912131">encode</span><span class="op" id="4912137">(</span><span class="ident" id="4912138">e</span>&nbsp;<span class="op" id="4912140">*</span><span class="ident" id="4912141">encodeState</span><span class="op" id="4912152">,</span>&nbsp;<span class="ident" id="4912154">v</span>&nbsp;<span class="ident" id="4912156">reflect</span><span class="op" id="4912163">.</span><span class="ident" id="4912164">Value</span><span class="op" id="4912169">,</span>&nbsp;<span class="ident" id="4912171">quoted</span>&nbsp;<span class="builtintype" id="4912178">bool</span><span class="op" id="4912182">)</span>&nbsp;<span class="op" id="4912184">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912187">e</span><span class="op" id="4912188">.</span><span class="ident" id="4912189">WriteByte</span><span class="op" id="4912198">(</span><span class="string" id="4912199">&#39;{&#39;</span><span class="op" id="4912202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912205">first</span>&nbsp;<span class="op" id="4912211">:=</span>&nbsp;<span class="builtintype" id="4912214">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4912220">for</span>&nbsp;<span class="ident" id="4912224">i</span><span class="op" id="4912225">,</span>&nbsp;<span class="ident" id="4912227">f</span>&nbsp;<span class="op" id="4912229">:=</span>&nbsp;<span class="keyword" id="4912232">range</span>&nbsp;<span class="ident" id="4912238">se</span><span class="op" id="4912240">.</span><span class="ident" id="4912241">fields</span>&nbsp;<span class="op" id="4912248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912252">fv</span>&nbsp;<span class="op" id="4912255">:=</span>&nbsp;<span class="ident" id="4912258">fieldByIndex</span><span class="op" id="4912270">(</span><span class="ident" id="4912271">v</span><span class="op" id="4912272">,</span>&nbsp;<span class="ident" id="4912274">f</span><span class="op" id="4912275">.</span><span class="ident" id="4912276">index</span><span class="op" id="4912281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4912285">if</span>&nbsp;<span class="op" id="4912288">!</span><span class="ident" id="4912289">fv</span><span class="op" id="4912291">.</span><span class="ident" id="4912292">IsValid</span><span class="op" id="4912299">(</span><span class="op" id="4912300">)</span>&nbsp;<span class="op" id="4912302">||</span>&nbsp;<span class="ident" id="4912305">f</span><span class="op" id="4912306">.</span><span class="ident" id="4912307">omitEmpty</span>&nbsp;<span class="op" id="4912317">&amp;&amp;</span>&nbsp;<span class="ident" id="4912320">isEmptyValue</span><span class="op" id="4912332">(</span><span class="ident" id="4912333">fv</span><span class="op" id="4912335">)</span>&nbsp;<span class="op" id="4912337">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4912342">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4912353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4912357">if</span>&nbsp;<span class="ident" id="4912360">first</span>&nbsp;<span class="op" id="4912366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912371">first</span>&nbsp;<span class="op" id="4912377">=</span>&nbsp;<span class="builtintype" id="4912379">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4912387">}</span>&nbsp;<span class="keyword" id="4912389">else</span>&nbsp;<span class="op" id="4912394">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912399">e</span><span class="op" id="4912400">.</span><span class="ident" id="4912401">WriteByte</span><span class="op" id="4912410">(</span><span class="string" id="4912411">&#39;,&#39;</span><span class="op" id="4912414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4912418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912422">e</span><span class="op" id="4912423">.</span><span class="builtintype" id="4912424">string</span><span class="op" id="4912430">(</span><span class="ident" id="4912431">f</span><span class="op" id="4912432">.</span><span class="ident" id="4912433">name</span><span class="op" id="4912437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912441">e</span><span class="op" id="4912442">.</span><span class="ident" id="4912443">WriteByte</span><span class="op" id="4912452">(</span><span class="string" id="4912453">&#39;:&#39;</span><span class="op" id="4912456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912460">se</span><span class="op" id="4912462">.</span><span class="ident" id="4912463">fieldEncs</span><span class="op" id="4912472">[</span><span class="ident" id="4912473">i</span><span class="op" id="4912474">]</span><span class="op" id="4912475">(</span><span class="ident" id="4912476">e</span><span class="op" id="4912477">,</span>&nbsp;<span class="ident" id="4912479">fv</span><span class="op" id="4912481">,</span>&nbsp;<span class="ident" id="4912483">f</span><span class="op" id="4912484">.</span><span class="ident" id="4912485">quoted</span><span class="op" id="4912491">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4912494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912497">e</span><span class="op" id="4912498">.</span><span class="ident" id="4912499">WriteByte</span><span class="op" id="4912508">(</span><span class="string" id="4912509">&#39;}&#39;</span><span class="op" id="4912512">)</span><br>
<span class="lineno"></span><span class="op" id="4912514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4912517">func</span>&nbsp;<span class="ident" id="4912522">newStructEncoder</span><span class="op" id="4912538">(</span><span class="ident" id="4912539">t</span>&nbsp;<span class="ident" id="4912541">reflect</span><span class="op" id="4912548">.</span><span class="ident" id="4912549">Type</span><span class="op" id="4912553">)</span>&nbsp;<span class="ident" id="4912555">encoderFunc</span>&nbsp;<span class="op" id="4912567">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912570">fields</span>&nbsp;<span class="op" id="4912577">:=</span>&nbsp;<span class="ident" id="4912580">cachedTypeFields</span><span class="op" id="4912596">(</span><span class="ident" id="4912597">t</span><span class="op" id="4912598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912601">se</span>&nbsp;<span class="op" id="4912604">:=</span>&nbsp;<span class="op" id="4912607">&amp;</span><span class="ident" id="4912608">structEncoder</span><span class="op" id="4912621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912625">fields</span><span class="op" id="4912631">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912636">fields</span><span class="op" id="4912642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912646">fieldEncs</span><span class="op" id="4912655">:</span>&nbsp;<span class="builtinfunc" id="4912657">make</span><span class="op" id="4912661">(</span><span class="op" id="4912662">[</span><span class="op" id="4912663">]</span><span class="ident" id="4912664">encoderFunc</span><span class="op" id="4912675">,</span>&nbsp;<span class="builtinfunc" id="4912677">len</span><span class="op" id="4912680">(</span><span class="ident" id="4912681">fields</span><span class="op" id="4912687">)</span><span class="op" id="4912688">)</span><span class="op" id="4912689">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4912692">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4912695">for</span>&nbsp;<span class="ident" id="4912699">i</span><span class="op" id="4912700">,</span>&nbsp;<span class="ident" id="4912702">f</span>&nbsp;<span class="op" id="4912704">:=</span>&nbsp;<span class="keyword" id="4912707">range</span>&nbsp;<span class="ident" id="4912713">fields</span>&nbsp;<span class="op" id="4912720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912724">se</span><span class="op" id="4912726">.</span><span class="ident" id="4912727">fieldEncs</span><span class="op" id="4912736">[</span><span class="ident" id="4912737">i</span><span class="op" id="4912738">]</span>&nbsp;<span class="op" id="4912740">=</span>&nbsp;<span class="ident" id="4912742">typeEncoder</span><span class="op" id="4912753">(</span><span class="ident" id="4912754">typeByIndex</span><span class="op" id="4912765">(</span><span class="ident" id="4912766">t</span><span class="op" id="4912767">,</span>&nbsp;<span class="ident" id="4912769">f</span><span class="op" id="4912770">.</span><span class="ident" id="4912771">index</span><span class="op" id="4912776">)</span><span class="op" id="4912777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4912780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4912783">return</span>&nbsp;<span class="ident" id="4912790">se</span><span class="op" id="4912792">.</span><span class="ident" id="4912793">encode</span><br>
<span class="lineno"></span><span class="op" id="4912800">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="4912803">type</span>&nbsp;<span class="ident" id="4912808">mapEncoder</span>&nbsp;<span class="keyword" id="4912819">struct</span>&nbsp;<span class="op" id="4912826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912829">elemEnc</span>&nbsp;<span class="ident" id="4912837">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4912849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="keyword" id="4912852">func</span>&nbsp;<span class="op" id="4912857">(</span><span class="ident" id="4912858">me</span>&nbsp;<span class="op" id="4912861">*</span><span class="ident" id="4912862">mapEncoder</span><span class="op" id="4912872">)</span>&nbsp;<span class="ident" id="4912874">encode</span><span class="op" id="4912880">(</span><span class="ident" id="4912881">e</span>&nbsp;<span class="op" id="4912883">*</span><span class="ident" id="4912884">encodeState</span><span class="op" id="4912895">,</span>&nbsp;<span class="ident" id="4912897">v</span>&nbsp;<span class="ident" id="4912899">reflect</span><span class="op" id="4912906">.</span><span class="ident" id="4912907">Value</span><span class="op" id="4912912">,</span>&nbsp;<span class="ident" id="4912914">_</span>&nbsp;<span class="builtintype" id="4912916">bool</span><span class="op" id="4912920">)</span>&nbsp;<span class="op" id="4912922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4912925">if</span>&nbsp;<span class="ident" id="4912928">v</span><span class="op" id="4912929">.</span><span class="ident" id="4912930">IsNil</span><span class="op" id="4912935">(</span><span class="op" id="4912936">)</span>&nbsp;<span class="op" id="4912938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912942">e</span><span class="op" id="4912943">.</span><span class="ident" id="4912944">WriteString</span><span class="op" id="4912955">(</span><span class="string" id="4912956">&#34;null&#34;</span><span class="op" id="4912962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4912966">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4912974">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4912977">e</span><span class="op" id="4912978">.</span><span class="ident" id="4912979">WriteByte</span><span class="op" id="4912988">(</span><span class="string" id="4912989">&#39;{&#39;</span><span class="op" id="4912992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4912995">var</span>&nbsp;<span class="ident" id="4912999">sv</span>&nbsp;<span class="ident" id="4913002">stringValues</span>&nbsp;<span class="op" id="4913015">=</span>&nbsp;<span class="ident" id="4913017">v</span><span class="op" id="4913018">.</span><span class="ident" id="4913019">MapKeys</span><span class="op" id="4913026">(</span><span class="op" id="4913027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4913030">sort</span><span class="op" id="4913034">.</span><span class="ident" id="4913035">Sort</span><span class="op" id="4913039">(</span><span class="ident" id="4913040">sv</span><span class="op" id="4913042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4913045">for</span>&nbsp;<span class="ident" id="4913049">i</span><span class="op" id="4913050">,</span>&nbsp;<span class="ident" id="4913052">k</span>&nbsp;<span class="op" id="4913054">:=</span>&nbsp;<span class="keyword" id="4913057">range</span>&nbsp;<span class="ident" id="4913063">sv</span>&nbsp;<span class="op" id="4913066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4913070">if</span>&nbsp;<span class="ident" id="4913073">i</span>&nbsp;<span class="op" id="4913075">&gt;</span>&nbsp;<span class="num" id="4913077">0</span>&nbsp;<span class="op" id="4913079">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4913084">e</span><span class="op" id="4913085">.</span><span class="ident" id="4913086">WriteByte</span><span class="op" id="4913095">(</span><span class="string" id="4913096">&#39;,&#39;</span><span class="op" id="4913099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4913103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4913107">e</span><span class="op" id="4913108">.</span><span class="builtintype" id="4913109">string</span><span class="op" id="4913115">(</span><span class="ident" id="4913116">k</span><span class="op" id="4913117">.</span><span class="ident" id="4913118">String</span><span class="op" id="4913124">(</span><span class="op" id="4913125">)</span><span class="op" id="4913126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4913130">e</span><span class="op" id="4913131">.</span><span class="ident" id="4913132">WriteByte</span><span class="op" id="4913141">(</span><span class="string" id="4913142">&#39;:&#39;</span><span class="op" id="4913145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4913149">me</span><span class="op" id="4913151">.</span><span class="ident" id="4913152">elemEnc</span><span class="op" id="4913159">(</span><span class="ident" id="4913160">e</span><span class="op" id="4913161">,</span>&nbsp;<span class="ident" id="4913163">v</span><span class="op" id="4913164">.</span><span class="ident" id="4913165">MapIndex</span><span class="op" id="4913173">(</span><span class="ident" id="4913174">k</span><span class="op" id="4913175">)</span><span class="op" id="4913176">,</span>&nbsp;<span class="builtintype" id="4913178">false</span><span class="op" id="4913183">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4913186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4913189">e</span><span class="op" id="4913190">.</span><span class="ident" id="4913191">WriteByte</span><span class="op" id="4913200">(</span><span class="string" id="4913201">&#39;}&#39;</span><span class="op" id="4913204">)</span><br>
<span class="lineno"></span><span class="op" id="4913206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4913209">func</span>&nbsp;<span class="ident" id="4913214">newMapEncoder</span><span class="op" id="4913227">(</span><span class="ident" id="4913228">t</span>&nbsp;<span class="ident" id="4913230">reflect</span><span class="op" id="4913237">.</span><span class="ident" id="4913238">Type</span><span class="op" id="4913242">)</span>&nbsp;<span class="ident" id="4913244">encoderFunc</span>&nbsp;<span class="op" id="4913256">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4913259">if</span>&nbsp;<span class="ident" id="4913262">t</span><span class="op" id="4913263">.</span><span class="ident" id="4913264">Key</span><span class="op" id="4913267">(</span><span class="op" id="4913268">)</span><span class="op" id="4913269">.</span><span class="ident" id="4913270">Kind</span><span class="op" id="4913274">(</span><span class="op" id="4913275">)</span>&nbsp;<span class="op" id="4913277">!=</span>&nbsp;<span class="ident" id="4913280">reflect</span><span class="op" id="4913287">.</span><span class="ident" id="4913288">String</span>&nbsp;<span class="op" id="4913295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4913299">return</span>&nbsp;<span class="ident" id="4913306">unsupportedTypeEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4913330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4913333">me</span>&nbsp;<span class="op" id="4913336">:=</span>&nbsp;<span class="op" id="4913339">&amp;</span><span class="ident" id="4913340">mapEncoder</span><span class="op" id="4913350">{</span><span class="ident" id="4913351">typeEncoder</span><span class="op" id="4913362">(</span><span class="ident" id="4913363">t</span><span class="op" id="4913364">.</span><span class="ident" id="4913365">Elem</span><span class="op" id="4913369">(</span><span class="op" id="4913370">)</span><span class="op" id="4913371">)</span><span class="op" id="4913372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4913375">return</span>&nbsp;<span class="ident" id="4913382">me</span><span class="op" id="4913384">.</span><span class="ident" id="4913385">encode</span><br>
<span class="lineno">630</span><span class="op" id="4913392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4913395">func</span>&nbsp;<span class="ident" id="4913400">encodeByteSlice</span><span class="op" id="4913415">(</span><span class="ident" id="4913416">e</span>&nbsp;<span class="op" id="4913418">*</span><span class="ident" id="4913419">encodeState</span><span class="op" id="4913430">,</span>&nbsp;<span class="ident" id="4913432">v</span>&nbsp;<span class="ident" id="4913434">reflect</span><span class="op" id="4913441">.</span><span class="ident" id="4913442">Value</span><span class="op" id="4913447">,</span>&nbsp;<span class="ident" id="4913449">_</span>&nbsp;<span class="builtintype" id="4913451">bool</span><span class="op" id="4913455">)</span>&nbsp;<span class="op" id="4913457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4913460">if</span>&nbsp;<span class="ident" id="4913463">v</span><span class="op" id="4913464">.</span><span class="ident" id="4913465">IsNil</span><span class="op" id="4913470">(</span><span class="op" id="4913471">)</span>&nbsp;<span class="op" id="4913473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4913477">e</span><span class="op" id="4913478">.</span><span class="ident" id="4913479">WriteString</span><span class="op" id="4913490">(</span><span class="string" id="4913491">&#34;null&#34;</span><span class="op" id="4913497">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4913501">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4913509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4913512">s</span>&nbsp;<span class="op" id="4913514">:=</span>&nbsp;<span class="ident" id="4913517">v</span><span class="op" id="4913518">.</span><span class="ident" id="4913519">Bytes</span><span class="op" id="4913524">(</span><span class="op" id="4913525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4913528">e</span><span class="op" id="4913529">.</span><span class="ident" id="4913530">WriteByte</span><span class="op" id="4913539">(</span><span class="string" id="4913540">&#39;&#34;&#39;</span><span class="op" id="4913543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4913546">if</span>&nbsp;<span class="builtinfunc" id="4913549">len</span><span class="op" id="4913552">(</span><span class="ident" id="4913553">s</span><span class="op" id="4913554">)</span>&nbsp;<span class="op" id="4913556">&lt;</span>&nbsp;<span class="num" id="4913558">1024</span>&nbsp;<span class="op" id="4913563">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4913567">//&nbsp;for&nbsp;small&nbsp;buffers,&nbsp;using&nbsp;Encode&nbsp;directly&nbsp;is&nbsp;much&nbsp;faster.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4913629">dst</span>&nbsp;<span class="op" id="4913633">:=</span>&nbsp;<span class="builtinfunc" id="4913636">make</span><span class="op" id="4913640">(</span><span class="op" id="4913641">[</span><span class="op" id="4913642">]</span><span class="builtintype" id="4913643">byte</span><span class="op" id="4913647">,</span>&nbsp;<span class="ident" id="4913649">base64</span><span class="op" id="4913655">.</span><span class="ident" id="4913656">StdEncoding</span><span class="op" id="4913667">.</span><span class="ident" id="4913668">EncodedLen</span><span class="op" id="4913678">(</span><span class="builtinfunc" id="4913679">len</span><span class="op" id="4913682">(</span><span class="ident" id="4913683">s</span><span class="op" id="4913684">)</span><span class="op" id="4913685">)</span><span class="op" id="4913686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4913690">base64</span><span class="op" id="4913696">.</span><span class="ident" id="4913697">StdEncoding</span><span class="op" id="4913708">.</span><span class="ident" id="4913709">Encode</span><span class="op" id="4913715">(</span><span class="ident" id="4913716">dst</span><span class="op" id="4913719">,</span>&nbsp;<span class="ident" id="4913721">s</span><span class="op" id="4913722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4913726">e</span><span class="op" id="4913727">.</span><span class="ident" id="4913728">Write</span><span class="op" id="4913733">(</span><span class="ident" id="4913734">dst</span><span class="op" id="4913737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4913740">}</span>&nbsp;<span class="keyword" id="4913742">else</span>&nbsp;<span class="op" id="4913747">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4913751">//&nbsp;for&nbsp;large&nbsp;buffers,&nbsp;avoid&nbsp;unnecessary&nbsp;extra&nbsp;temporary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4913809">//&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4913828">enc</span>&nbsp;<span class="op" id="4913832">:=</span>&nbsp;<span class="ident" id="4913835">base64</span><span class="op" id="4913841">.</span><span class="ident" id="4913842">NewEncoder</span><span class="op" id="4913852">(</span><span class="ident" id="4913853">base64</span><span class="op" id="4913859">.</span><span class="ident" id="4913860">StdEncoding</span><span class="op" id="4913871">,</span>&nbsp;<span class="ident" id="4913873">e</span><span class="op" id="4913874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4913878">enc</span><span class="op" id="4913881">.</span><span class="ident" id="4913882">Write</span><span class="op" id="4913887">(</span><span class="ident" id="4913888">s</span><span class="op" id="4913889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4913893">enc</span><span class="op" id="4913896">.</span><span class="ident" id="4913897">Close</span><span class="op" id="4913902">(</span><span class="op" id="4913903">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4913906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4913909">e</span><span class="op" id="4913910">.</span><span class="ident" id="4913911">WriteByte</span><span class="op" id="4913920">(</span><span class="string" id="4913921">&#39;&#34;&#39;</span><span class="op" id="4913924">)</span><br>
<span class="lineno"></span><span class="op" id="4913926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4913929">//&nbsp;sliceEncoder&nbsp;just&nbsp;wraps&nbsp;an&nbsp;arrayEncoder,&nbsp;checking&nbsp;to&nbsp;make&nbsp;sure&nbsp;the&nbsp;value&nbsp;isn&#39;t&nbsp;nil.</span><br>
<span class="lineno">655</span><span class="keyword" id="4914016">type</span>&nbsp;<span class="ident" id="4914021">sliceEncoder</span>&nbsp;<span class="keyword" id="4914034">struct</span>&nbsp;<span class="op" id="4914041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4914044">arrayEnc</span>&nbsp;<span class="ident" id="4914053">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4914065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4914068">func</span>&nbsp;<span class="op" id="4914073">(</span><span class="ident" id="4914074">se</span>&nbsp;<span class="op" id="4914077">*</span><span class="ident" id="4914078">sliceEncoder</span><span class="op" id="4914090">)</span>&nbsp;<span class="ident" id="4914092">encode</span><span class="op" id="4914098">(</span><span class="ident" id="4914099">e</span>&nbsp;<span class="op" id="4914101">*</span><span class="ident" id="4914102">encodeState</span><span class="op" id="4914113">,</span>&nbsp;<span class="ident" id="4914115">v</span>&nbsp;<span class="ident" id="4914117">reflect</span><span class="op" id="4914124">.</span><span class="ident" id="4914125">Value</span><span class="op" id="4914130">,</span>&nbsp;<span class="ident" id="4914132">_</span>&nbsp;<span class="builtintype" id="4914134">bool</span><span class="op" id="4914138">)</span>&nbsp;<span class="op" id="4914140">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4914143">if</span>&nbsp;<span class="ident" id="4914146">v</span><span class="op" id="4914147">.</span><span class="ident" id="4914148">IsNil</span><span class="op" id="4914153">(</span><span class="op" id="4914154">)</span>&nbsp;<span class="op" id="4914156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4914160">e</span><span class="op" id="4914161">.</span><span class="ident" id="4914162">WriteString</span><span class="op" id="4914173">(</span><span class="string" id="4914174">&#34;null&#34;</span><span class="op" id="4914180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4914184">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4914192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4914195">se</span><span class="op" id="4914197">.</span><span class="ident" id="4914198">arrayEnc</span><span class="op" id="4914206">(</span><span class="ident" id="4914207">e</span><span class="op" id="4914208">,</span>&nbsp;<span class="ident" id="4914210">v</span><span class="op" id="4914211">,</span>&nbsp;<span class="builtintype" id="4914213">false</span><span class="op" id="4914218">)</span><br>
<span class="lineno">665</span><span class="op" id="4914220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4914223">func</span>&nbsp;<span class="ident" id="4914228">newSliceEncoder</span><span class="op" id="4914243">(</span><span class="ident" id="4914244">t</span>&nbsp;<span class="ident" id="4914246">reflect</span><span class="op" id="4914253">.</span><span class="ident" id="4914254">Type</span><span class="op" id="4914258">)</span>&nbsp;<span class="ident" id="4914260">encoderFunc</span>&nbsp;<span class="op" id="4914272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4914275">//&nbsp;Byte&nbsp;slices&nbsp;get&nbsp;special&nbsp;treatment;&nbsp;arrays&nbsp;don&#39;t.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4914328">if</span>&nbsp;<span class="ident" id="4914331">t</span><span class="op" id="4914332">.</span><span class="ident" id="4914333">Elem</span><span class="op" id="4914337">(</span><span class="op" id="4914338">)</span><span class="op" id="4914339">.</span><span class="ident" id="4914340">Kind</span><span class="op" id="4914344">(</span><span class="op" id="4914345">)</span>&nbsp;<span class="op" id="4914347">==</span>&nbsp;<span class="ident" id="4914350">reflect</span><span class="op" id="4914357">.</span><span class="ident" id="4914358">Uint8</span>&nbsp;<span class="op" id="4914364">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4914368">return</span>&nbsp;<span class="ident" id="4914375">encodeByteSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4914392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4914395">enc</span>&nbsp;<span class="op" id="4914399">:=</span>&nbsp;<span class="op" id="4914402">&amp;</span><span class="ident" id="4914403">sliceEncoder</span><span class="op" id="4914415">{</span><span class="ident" id="4914416">newArrayEncoder</span><span class="op" id="4914431">(</span><span class="ident" id="4914432">t</span><span class="op" id="4914433">)</span><span class="op" id="4914434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4914437">return</span>&nbsp;<span class="ident" id="4914444">enc</span><span class="op" id="4914447">.</span><span class="ident" id="4914448">encode</span><br>
<span class="lineno"></span><span class="op" id="4914455">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="4914458">type</span>&nbsp;<span class="ident" id="4914463">arrayEncoder</span>&nbsp;<span class="keyword" id="4914476">struct</span>&nbsp;<span class="op" id="4914483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4914486">elemEnc</span>&nbsp;<span class="ident" id="4914494">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4914506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">680</span><span class="keyword" id="4914509">func</span>&nbsp;<span class="op" id="4914514">(</span><span class="ident" id="4914515">ae</span>&nbsp;<span class="op" id="4914518">*</span><span class="ident" id="4914519">arrayEncoder</span><span class="op" id="4914531">)</span>&nbsp;<span class="ident" id="4914533">encode</span><span class="op" id="4914539">(</span><span class="ident" id="4914540">e</span>&nbsp;<span class="op" id="4914542">*</span><span class="ident" id="4914543">encodeState</span><span class="op" id="4914554">,</span>&nbsp;<span class="ident" id="4914556">v</span>&nbsp;<span class="ident" id="4914558">reflect</span><span class="op" id="4914565">.</span><span class="ident" id="4914566">Value</span><span class="op" id="4914571">,</span>&nbsp;<span class="ident" id="4914573">_</span>&nbsp;<span class="builtintype" id="4914575">bool</span><span class="op" id="4914579">)</span>&nbsp;<span class="op" id="4914581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4914584">e</span><span class="op" id="4914585">.</span><span class="ident" id="4914586">WriteByte</span><span class="op" id="4914595">(</span><span class="string" id="4914596">&#39;[&#39;</span><span class="op" id="4914599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4914602">n</span>&nbsp;<span class="op" id="4914604">:=</span>&nbsp;<span class="ident" id="4914607">v</span><span class="op" id="4914608">.</span><span class="ident" id="4914609">Len</span><span class="op" id="4914612">(</span><span class="op" id="4914613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4914616">for</span>&nbsp;<span class="ident" id="4914620">i</span>&nbsp;<span class="op" id="4914622">:=</span>&nbsp;<span class="num" id="4914625">0</span><span class="op" id="4914626">;</span>&nbsp;<span class="ident" id="4914628">i</span>&nbsp;<span class="op" id="4914630">&lt;</span>&nbsp;<span class="ident" id="4914632">n</span><span class="op" id="4914633">;</span>&nbsp;<span class="ident" id="4914635">i</span><span class="op" id="4914636">++</span>&nbsp;<span class="op" id="4914639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4914643">if</span>&nbsp;<span class="ident" id="4914646">i</span>&nbsp;<span class="op" id="4914648">&gt;</span>&nbsp;<span class="num" id="4914650">0</span>&nbsp;<span class="op" id="4914652">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4914657">e</span><span class="op" id="4914658">.</span><span class="ident" id="4914659">WriteByte</span><span class="op" id="4914668">(</span><span class="string" id="4914669">&#39;,&#39;</span><span class="op" id="4914672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4914676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4914680">ae</span><span class="op" id="4914682">.</span><span class="ident" id="4914683">elemEnc</span><span class="op" id="4914690">(</span><span class="ident" id="4914691">e</span><span class="op" id="4914692">,</span>&nbsp;<span class="ident" id="4914694">v</span><span class="op" id="4914695">.</span><span class="ident" id="4914696">Index</span><span class="op" id="4914701">(</span><span class="ident" id="4914702">i</span><span class="op" id="4914703">)</span><span class="op" id="4914704">,</span>&nbsp;<span class="builtintype" id="4914706">false</span><span class="op" id="4914711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4914714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4914717">e</span><span class="op" id="4914718">.</span><span class="ident" id="4914719">WriteByte</span><span class="op" id="4914728">(</span><span class="string" id="4914729">&#39;]&#39;</span><span class="op" id="4914732">)</span><br>
<span class="lineno">690</span><span class="op" id="4914734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4914737">func</span>&nbsp;<span class="ident" id="4914742">newArrayEncoder</span><span class="op" id="4914757">(</span><span class="ident" id="4914758">t</span>&nbsp;<span class="ident" id="4914760">reflect</span><span class="op" id="4914767">.</span><span class="ident" id="4914768">Type</span><span class="op" id="4914772">)</span>&nbsp;<span class="ident" id="4914774">encoderFunc</span>&nbsp;<span class="op" id="4914786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4914789">enc</span>&nbsp;<span class="op" id="4914793">:=</span>&nbsp;<span class="op" id="4914796">&amp;</span><span class="ident" id="4914797">arrayEncoder</span><span class="op" id="4914809">{</span><span class="ident" id="4914810">typeEncoder</span><span class="op" id="4914821">(</span><span class="ident" id="4914822">t</span><span class="op" id="4914823">.</span><span class="ident" id="4914824">Elem</span><span class="op" id="4914828">(</span><span class="op" id="4914829">)</span><span class="op" id="4914830">)</span><span class="op" id="4914831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4914834">return</span>&nbsp;<span class="ident" id="4914841">enc</span><span class="op" id="4914844">.</span><span class="ident" id="4914845">encode</span><br>
<span class="lineno">695</span><span class="op" id="4914852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4914855">type</span>&nbsp;<span class="ident" id="4914860">ptrEncoder</span>&nbsp;<span class="keyword" id="4914871">struct</span>&nbsp;<span class="op" id="4914878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4914881">elemEnc</span>&nbsp;<span class="ident" id="4914889">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4914901">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="4914904">func</span>&nbsp;<span class="op" id="4914909">(</span><span class="ident" id="4914910">pe</span>&nbsp;<span class="op" id="4914913">*</span><span class="ident" id="4914914">ptrEncoder</span><span class="op" id="4914924">)</span>&nbsp;<span class="ident" id="4914926">encode</span><span class="op" id="4914932">(</span><span class="ident" id="4914933">e</span>&nbsp;<span class="op" id="4914935">*</span><span class="ident" id="4914936">encodeState</span><span class="op" id="4914947">,</span>&nbsp;<span class="ident" id="4914949">v</span>&nbsp;<span class="ident" id="4914951">reflect</span><span class="op" id="4914958">.</span><span class="ident" id="4914959">Value</span><span class="op" id="4914964">,</span>&nbsp;<span class="ident" id="4914966">quoted</span>&nbsp;<span class="builtintype" id="4914973">bool</span><span class="op" id="4914977">)</span>&nbsp;<span class="op" id="4914979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4914982">if</span>&nbsp;<span class="ident" id="4914985">v</span><span class="op" id="4914986">.</span><span class="ident" id="4914987">IsNil</span><span class="op" id="4914992">(</span><span class="op" id="4914993">)</span>&nbsp;<span class="op" id="4914995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4914999">e</span><span class="op" id="4915000">.</span><span class="ident" id="4915001">WriteString</span><span class="op" id="4915012">(</span><span class="string" id="4915013">&#34;null&#34;</span><span class="op" id="4915019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4915023">return</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4915031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4915034">pe</span><span class="op" id="4915036">.</span><span class="ident" id="4915037">elemEnc</span><span class="op" id="4915044">(</span><span class="ident" id="4915045">e</span><span class="op" id="4915046">,</span>&nbsp;<span class="ident" id="4915048">v</span><span class="op" id="4915049">.</span><span class="ident" id="4915050">Elem</span><span class="op" id="4915054">(</span><span class="op" id="4915055">)</span><span class="op" id="4915056">,</span>&nbsp;<span class="ident" id="4915058">quoted</span><span class="op" id="4915064">)</span><br>
<span class="lineno"></span><span class="op" id="4915066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4915069">func</span>&nbsp;<span class="ident" id="4915074">newPtrEncoder</span><span class="op" id="4915087">(</span><span class="ident" id="4915088">t</span>&nbsp;<span class="ident" id="4915090">reflect</span><span class="op" id="4915097">.</span><span class="ident" id="4915098">Type</span><span class="op" id="4915102">)</span>&nbsp;<span class="ident" id="4915104">encoderFunc</span>&nbsp;<span class="op" id="4915116">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4915119">enc</span>&nbsp;<span class="op" id="4915123">:=</span>&nbsp;<span class="op" id="4915126">&amp;</span><span class="ident" id="4915127">ptrEncoder</span><span class="op" id="4915137">{</span><span class="ident" id="4915138">typeEncoder</span><span class="op" id="4915149">(</span><span class="ident" id="4915150">t</span><span class="op" id="4915151">.</span><span class="ident" id="4915152">Elem</span><span class="op" id="4915156">(</span><span class="op" id="4915157">)</span><span class="op" id="4915158">)</span><span class="op" id="4915159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4915162">return</span>&nbsp;<span class="ident" id="4915169">enc</span><span class="op" id="4915172">.</span><span class="ident" id="4915173">encode</span><br>
<span class="lineno"></span><span class="op" id="4915180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4915183">type</span>&nbsp;<span class="ident" id="4915188">condAddrEncoder</span>&nbsp;<span class="keyword" id="4915204">struct</span>&nbsp;<span class="op" id="4915211">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4915214">canAddrEnc</span><span class="op" id="4915224">,</span>&nbsp;<span class="ident" id="4915226">elseEnc</span>&nbsp;<span class="ident" id="4915234">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4915246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4915249">func</span>&nbsp;<span class="op" id="4915254">(</span><span class="ident" id="4915255">ce</span>&nbsp;<span class="op" id="4915258">*</span><span class="ident" id="4915259">condAddrEncoder</span><span class="op" id="4915274">)</span>&nbsp;<span class="ident" id="4915276">encode</span><span class="op" id="4915282">(</span><span class="ident" id="4915283">e</span>&nbsp;<span class="op" id="4915285">*</span><span class="ident" id="4915286">encodeState</span><span class="op" id="4915297">,</span>&nbsp;<span class="ident" id="4915299">v</span>&nbsp;<span class="ident" id="4915301">reflect</span><span class="op" id="4915308">.</span><span class="ident" id="4915309">Value</span><span class="op" id="4915314">,</span>&nbsp;<span class="ident" id="4915316">quoted</span>&nbsp;<span class="builtintype" id="4915323">bool</span><span class="op" id="4915327">)</span>&nbsp;<span class="op" id="4915329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4915332">if</span>&nbsp;<span class="ident" id="4915335">v</span><span class="op" id="4915336">.</span><span class="ident" id="4915337">CanAddr</span><span class="op" id="4915344">(</span><span class="op" id="4915345">)</span>&nbsp;<span class="op" id="4915347">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4915351">ce</span><span class="op" id="4915353">.</span><span class="ident" id="4915354">canAddrEnc</span><span class="op" id="4915364">(</span><span class="ident" id="4915365">e</span><span class="op" id="4915366">,</span>&nbsp;<span class="ident" id="4915368">v</span><span class="op" id="4915369">,</span>&nbsp;<span class="ident" id="4915371">quoted</span><span class="op" id="4915377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4915380">}</span>&nbsp;<span class="keyword" id="4915382">else</span>&nbsp;<span class="op" id="4915387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4915391">ce</span><span class="op" id="4915393">.</span><span class="ident" id="4915394">elseEnc</span><span class="op" id="4915401">(</span><span class="ident" id="4915402">e</span><span class="op" id="4915403">,</span>&nbsp;<span class="ident" id="4915405">v</span><span class="op" id="4915406">,</span>&nbsp;<span class="ident" id="4915408">quoted</span><span class="op" id="4915414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4915417">}</span><br>
<span class="lineno"></span><span class="op" id="4915419">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="4915422">//&nbsp;newCondAddrEncoder&nbsp;returns&nbsp;an&nbsp;encoder&nbsp;that&nbsp;checks&nbsp;whether&nbsp;its&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4915493">//&nbsp;CanAddr&nbsp;and&nbsp;delegates&nbsp;to&nbsp;canAddrEnc&nbsp;if&nbsp;so,&nbsp;else&nbsp;to&nbsp;elseEnc.</span><br>
<span class="lineno"></span><span class="keyword" id="4915556">func</span>&nbsp;<span class="ident" id="4915561">newCondAddrEncoder</span><span class="op" id="4915579">(</span><span class="ident" id="4915580">canAddrEnc</span><span class="op" id="4915590">,</span>&nbsp;<span class="ident" id="4915592">elseEnc</span>&nbsp;<span class="ident" id="4915600">encoderFunc</span><span class="op" id="4915611">)</span>&nbsp;<span class="ident" id="4915613">encoderFunc</span>&nbsp;<span class="op" id="4915625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4915628">enc</span>&nbsp;<span class="op" id="4915632">:=</span>&nbsp;<span class="op" id="4915635">&amp;</span><span class="ident" id="4915636">condAddrEncoder</span><span class="op" id="4915651">{</span><span class="ident" id="4915652">canAddrEnc</span><span class="op" id="4915662">:</span>&nbsp;<span class="ident" id="4915664">canAddrEnc</span><span class="op" id="4915674">,</span>&nbsp;<span class="ident" id="4915676">elseEnc</span><span class="op" id="4915683">:</span>&nbsp;<span class="ident" id="4915685">elseEnc</span><span class="op" id="4915692">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4915695">return</span>&nbsp;<span class="ident" id="4915702">enc</span><span class="op" id="4915705">.</span><span class="ident" id="4915706">encode</span><br>
<span class="lineno"></span><span class="op" id="4915713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4915716">func</span>&nbsp;<span class="ident" id="4915721">isValidTag</span><span class="op" id="4915731">(</span><span class="ident" id="4915732">s</span>&nbsp;<span class="builtintype" id="4915734">string</span><span class="op" id="4915740">)</span>&nbsp;<span class="builtintype" id="4915742">bool</span>&nbsp;<span class="op" id="4915747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4915750">if</span>&nbsp;<span class="ident" id="4915753">s</span>&nbsp;<span class="op" id="4915755">==</span>&nbsp;<span class="string" id="4915758">&#34;&#34;</span>&nbsp;<span class="op" id="4915761">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4915765">return</span>&nbsp;<span class="builtintype" id="4915772">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4915779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4915782">for</span>&nbsp;<span class="ident" id="4915786">_</span><span class="op" id="4915787">,</span>&nbsp;<span class="ident" id="4915789">c</span>&nbsp;<span class="op" id="4915791">:=</span>&nbsp;<span class="keyword" id="4915794">range</span>&nbsp;<span class="ident" id="4915800">s</span>&nbsp;<span class="op" id="4915802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4915806">switch</span>&nbsp;<span class="op" id="4915813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4915817">case</span>&nbsp;<span class="ident" id="4915822">strings</span><span class="op" id="4915829">.</span><span class="ident" id="4915830">ContainsRune</span><span class="op" id="4915842">(</span><span class="string" id="4915843">&#34;!#$%&amp;()*+-./:&lt;=&gt;?@[]^_{|}~&nbsp;&#34;</span><span class="op" id="4915872">,</span>&nbsp;<span class="ident" id="4915874">c</span><span class="op" id="4915875">)</span><span class="op" id="4915876">:</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4915881">//&nbsp;Backslash&nbsp;and&nbsp;quote&nbsp;chars&nbsp;are&nbsp;reserved,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4915931">//&nbsp;otherwise&nbsp;any&nbsp;punctuation&nbsp;chars&nbsp;are&nbsp;allowed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4915981">//&nbsp;in&nbsp;a&nbsp;tag&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4916001">default</span><span class="op" id="4916008">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4916013">if</span>&nbsp;<span class="op" id="4916016">!</span><span class="ident" id="4916017">unicode</span><span class="op" id="4916024">.</span><span class="ident" id="4916025">IsLetter</span><span class="op" id="4916033">(</span><span class="ident" id="4916034">c</span><span class="op" id="4916035">)</span>&nbsp;<span class="op" id="4916037">&amp;&amp;</span>&nbsp;<span class="op" id="4916040">!</span><span class="ident" id="4916041">unicode</span><span class="op" id="4916048">.</span><span class="ident" id="4916049">IsDigit</span><span class="op" id="4916056">(</span><span class="ident" id="4916057">c</span><span class="op" id="4916058">)</span>&nbsp;<span class="op" id="4916060">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4916066">return</span>&nbsp;<span class="builtintype" id="4916073">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4916082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4916086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4916089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4916092">return</span>&nbsp;<span class="builtintype" id="4916099">true</span><br>
<span class="lineno">750</span><span class="op" id="4916104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4916107">func</span>&nbsp;<span class="ident" id="4916112">fieldByIndex</span><span class="op" id="4916124">(</span><span class="ident" id="4916125">v</span>&nbsp;<span class="ident" id="4916127">reflect</span><span class="op" id="4916134">.</span><span class="ident" id="4916135">Value</span><span class="op" id="4916140">,</span>&nbsp;<span class="ident" id="4916142">index</span>&nbsp;<span class="op" id="4916148">[</span><span class="op" id="4916149">]</span><span class="builtintype" id="4916150">int</span><span class="op" id="4916153">)</span>&nbsp;<span class="ident" id="4916155">reflect</span><span class="op" id="4916162">.</span><span class="ident" id="4916163">Value</span>&nbsp;<span class="op" id="4916169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4916172">for</span>&nbsp;<span class="ident" id="4916176">_</span><span class="op" id="4916177">,</span>&nbsp;<span class="ident" id="4916179">i</span>&nbsp;<span class="op" id="4916181">:=</span>&nbsp;<span class="keyword" id="4916184">range</span>&nbsp;<span class="ident" id="4916190">index</span>&nbsp;<span class="op" id="4916196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4916200">if</span>&nbsp;<span class="ident" id="4916203">v</span><span class="op" id="4916204">.</span><span class="ident" id="4916205">Kind</span><span class="op" id="4916209">(</span><span class="op" id="4916210">)</span>&nbsp;<span class="op" id="4916212">==</span>&nbsp;<span class="ident" id="4916215">reflect</span><span class="op" id="4916222">.</span><span class="ident" id="4916223">Ptr</span>&nbsp;<span class="op" id="4916227">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4916232">if</span>&nbsp;<span class="ident" id="4916235">v</span><span class="op" id="4916236">.</span><span class="ident" id="4916237">IsNil</span><span class="op" id="4916242">(</span><span class="op" id="4916243">)</span>&nbsp;<span class="op" id="4916245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4916251">return</span>&nbsp;<span class="ident" id="4916258">reflect</span><span class="op" id="4916265">.</span><span class="ident" id="4916266">Value</span><span class="op" id="4916271">{</span><span class="op" id="4916272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4916277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4916282">v</span>&nbsp;<span class="op" id="4916284">=</span>&nbsp;<span class="ident" id="4916286">v</span><span class="op" id="4916287">.</span><span class="ident" id="4916288">Elem</span><span class="op" id="4916292">(</span><span class="op" id="4916293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4916297">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4916301">v</span>&nbsp;<span class="op" id="4916303">=</span>&nbsp;<span class="ident" id="4916305">v</span><span class="op" id="4916306">.</span><span class="ident" id="4916307">Field</span><span class="op" id="4916312">(</span><span class="ident" id="4916313">i</span><span class="op" id="4916314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4916317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4916320">return</span>&nbsp;<span class="ident" id="4916327">v</span><br>
<span class="lineno"></span><span class="op" id="4916329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span><span class="keyword" id="4916332">func</span>&nbsp;<span class="ident" id="4916337">typeByIndex</span><span class="op" id="4916348">(</span><span class="ident" id="4916349">t</span>&nbsp;<span class="ident" id="4916351">reflect</span><span class="op" id="4916358">.</span><span class="ident" id="4916359">Type</span><span class="op" id="4916363">,</span>&nbsp;<span class="ident" id="4916365">index</span>&nbsp;<span class="op" id="4916371">[</span><span class="op" id="4916372">]</span><span class="builtintype" id="4916373">int</span><span class="op" id="4916376">)</span>&nbsp;<span class="ident" id="4916378">reflect</span><span class="op" id="4916385">.</span><span class="ident" id="4916386">Type</span>&nbsp;<span class="op" id="4916391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4916394">for</span>&nbsp;<span class="ident" id="4916398">_</span><span class="op" id="4916399">,</span>&nbsp;<span class="ident" id="4916401">i</span>&nbsp;<span class="op" id="4916403">:=</span>&nbsp;<span class="keyword" id="4916406">range</span>&nbsp;<span class="ident" id="4916412">index</span>&nbsp;<span class="op" id="4916418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4916422">if</span>&nbsp;<span class="ident" id="4916425">t</span><span class="op" id="4916426">.</span><span class="ident" id="4916427">Kind</span><span class="op" id="4916431">(</span><span class="op" id="4916432">)</span>&nbsp;<span class="op" id="4916434">==</span>&nbsp;<span class="ident" id="4916437">reflect</span><span class="op" id="4916444">.</span><span class="ident" id="4916445">Ptr</span>&nbsp;<span class="op" id="4916449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4916454">t</span>&nbsp;<span class="op" id="4916456">=</span>&nbsp;<span class="ident" id="4916458">t</span><span class="op" id="4916459">.</span><span class="ident" id="4916460">Elem</span><span class="op" id="4916464">(</span><span class="op" id="4916465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4916469">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4916473">t</span>&nbsp;<span class="op" id="4916475">=</span>&nbsp;<span class="ident" id="4916477">t</span><span class="op" id="4916478">.</span><span class="ident" id="4916479">Field</span><span class="op" id="4916484">(</span><span class="ident" id="4916485">i</span><span class="op" id="4916486">)</span><span class="op" id="4916487">.</span><span class="ident" id="4916488">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4916494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4916497">return</span>&nbsp;<span class="ident" id="4916504">t</span><br>
<span class="lineno"></span><span class="op" id="4916506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">775</span><span class="comment" id="4916509">//&nbsp;stringValues&nbsp;is&nbsp;a&nbsp;slice&nbsp;of&nbsp;reflect.Value&nbsp;holding&nbsp;*reflect.StringValue.</span><br>
<span class="lineno"></span><span class="comment" id="4916583">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;methods&nbsp;to&nbsp;sort&nbsp;by&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4916631">type</span>&nbsp;<span class="ident" id="4916636">stringValues</span>&nbsp;<span class="op" id="4916649">[</span><span class="op" id="4916650">]</span><span class="ident" id="4916651">reflect</span><span class="op" id="4916658">.</span><span class="ident" id="4916659">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4916666">func</span>&nbsp;<span class="op" id="4916671">(</span><span class="ident" id="4916672">sv</span>&nbsp;<span class="ident" id="4916675">stringValues</span><span class="op" id="4916687">)</span>&nbsp;<span class="ident" id="4916689">Len</span><span class="op" id="4916692">(</span><span class="op" id="4916693">)</span>&nbsp;<span class="builtintype" id="4916695">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4916709">{</span>&nbsp;<span class="keyword" id="4916711">return</span>&nbsp;<span class="builtinfunc" id="4916718">len</span><span class="op" id="4916721">(</span><span class="ident" id="4916722">sv</span><span class="op" id="4916724">)</span>&nbsp;<span class="op" id="4916726">}</span><br>
<span class="lineno">780</span><span class="keyword" id="4916728">func</span>&nbsp;<span class="op" id="4916733">(</span><span class="ident" id="4916734">sv</span>&nbsp;<span class="ident" id="4916737">stringValues</span><span class="op" id="4916749">)</span>&nbsp;<span class="ident" id="4916751">Swap</span><span class="op" id="4916755">(</span><span class="ident" id="4916756">i</span><span class="op" id="4916757">,</span>&nbsp;<span class="ident" id="4916759">j</span>&nbsp;<span class="builtintype" id="4916761">int</span><span class="op" id="4916764">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4916771">{</span>&nbsp;<span class="ident" id="4916773">sv</span><span class="op" id="4916775">[</span><span class="ident" id="4916776">i</span><span class="op" id="4916777">]</span><span class="op" id="4916778">,</span>&nbsp;<span class="ident" id="4916780">sv</span><span class="op" id="4916782">[</span><span class="ident" id="4916783">j</span><span class="op" id="4916784">]</span>&nbsp;<span class="op" id="4916786">=</span>&nbsp;<span class="ident" id="4916788">sv</span><span class="op" id="4916790">[</span><span class="ident" id="4916791">j</span><span class="op" id="4916792">]</span><span class="op" id="4916793">,</span>&nbsp;<span class="ident" id="4916795">sv</span><span class="op" id="4916797">[</span><span class="ident" id="4916798">i</span><span class="op" id="4916799">]</span>&nbsp;<span class="op" id="4916801">}</span><br>
<span class="lineno"></span><span class="keyword" id="4916803">func</span>&nbsp;<span class="op" id="4916808">(</span><span class="ident" id="4916809">sv</span>&nbsp;<span class="ident" id="4916812">stringValues</span><span class="op" id="4916824">)</span>&nbsp;<span class="ident" id="4916826">Less</span><span class="op" id="4916830">(</span><span class="ident" id="4916831">i</span><span class="op" id="4916832">,</span>&nbsp;<span class="ident" id="4916834">j</span>&nbsp;<span class="builtintype" id="4916836">int</span><span class="op" id="4916839">)</span>&nbsp;<span class="builtintype" id="4916841">bool</span>&nbsp;<span class="op" id="4916846">{</span>&nbsp;<span class="keyword" id="4916848">return</span>&nbsp;<span class="ident" id="4916855">sv</span><span class="op" id="4916857">.</span><span class="ident" id="4916858">get</span><span class="op" id="4916861">(</span><span class="ident" id="4916862">i</span><span class="op" id="4916863">)</span>&nbsp;<span class="op" id="4916865">&lt;</span>&nbsp;<span class="ident" id="4916867">sv</span><span class="op" id="4916869">.</span><span class="ident" id="4916870">get</span><span class="op" id="4916873">(</span><span class="ident" id="4916874">j</span><span class="op" id="4916875">)</span>&nbsp;<span class="op" id="4916877">}</span><br>
<span class="lineno"></span><span class="keyword" id="4916879">func</span>&nbsp;<span class="op" id="4916884">(</span><span class="ident" id="4916885">sv</span>&nbsp;<span class="ident" id="4916888">stringValues</span><span class="op" id="4916900">)</span>&nbsp;<span class="ident" id="4916902">get</span><span class="op" id="4916905">(</span><span class="ident" id="4916906">i</span>&nbsp;<span class="builtintype" id="4916908">int</span><span class="op" id="4916911">)</span>&nbsp;<span class="builtintype" id="4916913">string</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4916922">{</span>&nbsp;<span class="keyword" id="4916924">return</span>&nbsp;<span class="ident" id="4916931">sv</span><span class="op" id="4916933">[</span><span class="ident" id="4916934">i</span><span class="op" id="4916935">]</span><span class="op" id="4916936">.</span><span class="ident" id="4916937">String</span><span class="op" id="4916943">(</span><span class="op" id="4916944">)</span>&nbsp;<span class="op" id="4916946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4916949">//&nbsp;NOTE:&nbsp;keep&nbsp;in&nbsp;sync&nbsp;with&nbsp;stringBytes&nbsp;below.</span><br>
<span class="lineno">785</span><span class="keyword" id="4916995">func</span>&nbsp;<span class="op" id="4917000">(</span><span class="ident" id="4917001">e</span>&nbsp;<span class="op" id="4917003">*</span><span class="ident" id="4917004">encodeState</span><span class="op" id="4917015">)</span>&nbsp;<span class="builtintype" id="4917017">string</span><span class="op" id="4917023">(</span><span class="ident" id="4917024">s</span>&nbsp;<span class="builtintype" id="4917026">string</span><span class="op" id="4917032">)</span>&nbsp;<span class="op" id="4917034">(</span><span class="builtintype" id="4917035">int</span><span class="op" id="4917038">,</span>&nbsp;<span class="builtintype" id="4917040">error</span><span class="op" id="4917045">)</span>&nbsp;<span class="op" id="4917047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917050">len0</span>&nbsp;<span class="op" id="4917055">:=</span>&nbsp;<span class="ident" id="4917058">e</span><span class="op" id="4917059">.</span><span class="ident" id="4917060">Len</span><span class="op" id="4917063">(</span><span class="op" id="4917064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917067">e</span><span class="op" id="4917068">.</span><span class="ident" id="4917069">WriteByte</span><span class="op" id="4917078">(</span><span class="string" id="4917079">&#39;&#34;&#39;</span><span class="op" id="4917082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917085">start</span>&nbsp;<span class="op" id="4917091">:=</span>&nbsp;<span class="num" id="4917094">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917097">for</span>&nbsp;<span class="ident" id="4917101">i</span>&nbsp;<span class="op" id="4917103">:=</span>&nbsp;<span class="num" id="4917106">0</span><span class="op" id="4917107">;</span>&nbsp;<span class="ident" id="4917109">i</span>&nbsp;<span class="op" id="4917111">&lt;</span>&nbsp;<span class="builtinfunc" id="4917113">len</span><span class="op" id="4917116">(</span><span class="ident" id="4917117">s</span><span class="op" id="4917118">)</span><span class="op" id="4917119">;</span>&nbsp;<span class="op" id="4917121">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917125">if</span>&nbsp;<span class="ident" id="4917128">b</span>&nbsp;<span class="op" id="4917130">:=</span>&nbsp;<span class="ident" id="4917133">s</span><span class="op" id="4917134">[</span><span class="ident" id="4917135">i</span><span class="op" id="4917136">]</span><span class="op" id="4917137">;</span>&nbsp;<span class="ident" id="4917139">b</span>&nbsp;<span class="op" id="4917141">&lt;</span>&nbsp;<span class="ident" id="4917143">utf8</span><span class="op" id="4917147">.</span><span class="ident" id="4917148">RuneSelf</span>&nbsp;<span class="op" id="4917157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917162">if</span>&nbsp;<span class="num" id="4917165">0x20</span>&nbsp;<span class="op" id="4917170">&lt;=</span>&nbsp;<span class="ident" id="4917173">b</span>&nbsp;<span class="op" id="4917175">&amp;&amp;</span>&nbsp;<span class="ident" id="4917178">b</span>&nbsp;<span class="op" id="4917180">!=</span>&nbsp;<span class="string" id="4917183">&#39;\\&#39;</span>&nbsp;<span class="op" id="4917188">&amp;&amp;</span>&nbsp;<span class="ident" id="4917191">b</span>&nbsp;<span class="op" id="4917193">!=</span>&nbsp;<span class="string" id="4917196">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="4917200">&amp;&amp;</span>&nbsp;<span class="ident" id="4917203">b</span>&nbsp;<span class="op" id="4917205">!=</span>&nbsp;<span class="string" id="4917208">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4917212">&amp;&amp;</span>&nbsp;<span class="ident" id="4917215">b</span>&nbsp;<span class="op" id="4917217">!=</span>&nbsp;<span class="string" id="4917220">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="4917224">&amp;&amp;</span>&nbsp;<span class="ident" id="4917227">b</span>&nbsp;<span class="op" id="4917229">!=</span>&nbsp;<span class="string" id="4917232">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4917236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917242">i</span><span class="op" id="4917243">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917250">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4917262">}</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917267">if</span>&nbsp;<span class="ident" id="4917270">start</span>&nbsp;<span class="op" id="4917276">&lt;</span>&nbsp;<span class="ident" id="4917278">i</span>&nbsp;<span class="op" id="4917280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917286">e</span><span class="op" id="4917287">.</span><span class="ident" id="4917288">WriteString</span><span class="op" id="4917299">(</span><span class="ident" id="4917300">s</span><span class="op" id="4917301">[</span><span class="ident" id="4917302">start</span><span class="op" id="4917307">:</span><span class="ident" id="4917308">i</span><span class="op" id="4917309">]</span><span class="op" id="4917310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4917315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917320">switch</span>&nbsp;<span class="ident" id="4917327">b</span>&nbsp;<span class="op" id="4917329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917334">case</span>&nbsp;<span class="string" id="4917339">&#39;\\&#39;</span><span class="op" id="4917343">,</span>&nbsp;<span class="string" id="4917345">&#39;&#34;&#39;</span><span class="op" id="4917348">:</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917354">e</span><span class="op" id="4917355">.</span><span class="ident" id="4917356">WriteByte</span><span class="op" id="4917365">(</span><span class="string" id="4917366">&#39;\\&#39;</span><span class="op" id="4917370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917376">e</span><span class="op" id="4917377">.</span><span class="ident" id="4917378">WriteByte</span><span class="op" id="4917387">(</span><span class="ident" id="4917388">b</span><span class="op" id="4917389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917394">case</span>&nbsp;<span class="string" id="4917399">&#39;\n&#39;</span><span class="op" id="4917403">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917409">e</span><span class="op" id="4917410">.</span><span class="ident" id="4917411">WriteByte</span><span class="op" id="4917420">(</span><span class="string" id="4917421">&#39;\\&#39;</span><span class="op" id="4917425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917431">e</span><span class="op" id="4917432">.</span><span class="ident" id="4917433">WriteByte</span><span class="op" id="4917442">(</span><span class="string" id="4917443">&#39;n&#39;</span><span class="op" id="4917446">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917451">case</span>&nbsp;<span class="string" id="4917456">&#39;\r&#39;</span><span class="op" id="4917460">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917466">e</span><span class="op" id="4917467">.</span><span class="ident" id="4917468">WriteByte</span><span class="op" id="4917477">(</span><span class="string" id="4917478">&#39;\\&#39;</span><span class="op" id="4917482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917488">e</span><span class="op" id="4917489">.</span><span class="ident" id="4917490">WriteByte</span><span class="op" id="4917499">(</span><span class="string" id="4917500">&#39;r&#39;</span><span class="op" id="4917503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917508">case</span>&nbsp;<span class="string" id="4917513">&#39;\t&#39;</span><span class="op" id="4917517">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917523">e</span><span class="op" id="4917524">.</span><span class="ident" id="4917525">WriteByte</span><span class="op" id="4917534">(</span><span class="string" id="4917535">&#39;\\&#39;</span><span class="op" id="4917539">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917545">e</span><span class="op" id="4917546">.</span><span class="ident" id="4917547">WriteByte</span><span class="op" id="4917556">(</span><span class="string" id="4917557">&#39;t&#39;</span><span class="op" id="4917560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917565">default</span><span class="op" id="4917572">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4917578">//&nbsp;This&nbsp;encodes&nbsp;bytes&nbsp;&lt;&nbsp;0x20&nbsp;except&nbsp;for&nbsp;\n&nbsp;and&nbsp;\r,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4917633">//&nbsp;as&nbsp;well&nbsp;as&nbsp;&lt;,&nbsp;&gt;&nbsp;and&nbsp;&amp;.&nbsp;The&nbsp;latter&nbsp;are&nbsp;escaped&nbsp;because&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4917699">//&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;when&nbsp;user-controlled&nbsp;strings</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4917762">//&nbsp;are&nbsp;rendered&nbsp;into&nbsp;JSON&nbsp;and&nbsp;served&nbsp;to&nbsp;some&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917821">e</span><span class="op" id="4917822">.</span><span class="ident" id="4917823">WriteString</span><span class="op" id="4917834">(</span><span class="string" id="4917835">`\u00`</span><span class="op" id="4917841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917847">e</span><span class="op" id="4917848">.</span><span class="ident" id="4917849">WriteByte</span><span class="op" id="4917858">(</span><span class="ident" id="4917859">hex</span><span class="op" id="4917862">[</span><span class="ident" id="4917863">b</span><span class="op" id="4917864">&gt;&gt;</span><span class="num" id="4917866">4</span><span class="op" id="4917867">]</span><span class="op" id="4917868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917874">e</span><span class="op" id="4917875">.</span><span class="ident" id="4917876">WriteByte</span><span class="op" id="4917885">(</span><span class="ident" id="4917886">hex</span><span class="op" id="4917889">[</span><span class="ident" id="4917890">b</span><span class="op" id="4917891">&amp;</span><span class="num" id="4917892">0xF</span><span class="op" id="4917895">]</span><span class="op" id="4917896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4917901">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917906">i</span><span class="op" id="4917907">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917913">start</span>&nbsp;<span class="op" id="4917919">=</span>&nbsp;<span class="ident" id="4917921">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917926">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4917937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4917941">c</span><span class="op" id="4917942">,</span>&nbsp;<span class="ident" id="4917944">size</span>&nbsp;<span class="op" id="4917949">:=</span>&nbsp;<span class="ident" id="4917952">utf8</span><span class="op" id="4917956">.</span><span class="ident" id="4917957">DecodeRuneInString</span><span class="op" id="4917975">(</span><span class="ident" id="4917976">s</span><span class="op" id="4917977">[</span><span class="ident" id="4917978">i</span><span class="op" id="4917979">:</span><span class="op" id="4917980">]</span><span class="op" id="4917981">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4917985">if</span>&nbsp;<span class="ident" id="4917988">c</span>&nbsp;<span class="op" id="4917990">==</span>&nbsp;<span class="ident" id="4917993">utf8</span><span class="op" id="4917997">.</span><span class="ident" id="4917998">RuneError</span>&nbsp;<span class="op" id="4918008">&amp;&amp;</span>&nbsp;<span class="ident" id="4918011">size</span>&nbsp;<span class="op" id="4918016">==</span>&nbsp;<span class="num" id="4918019">1</span>&nbsp;<span class="op" id="4918021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4918026">if</span>&nbsp;<span class="ident" id="4918029">start</span>&nbsp;<span class="op" id="4918035">&lt;</span>&nbsp;<span class="ident" id="4918037">i</span>&nbsp;<span class="op" id="4918039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918045">e</span><span class="op" id="4918046">.</span><span class="ident" id="4918047">WriteString</span><span class="op" id="4918058">(</span><span class="ident" id="4918059">s</span><span class="op" id="4918060">[</span><span class="ident" id="4918061">start</span><span class="op" id="4918066">:</span><span class="ident" id="4918067">i</span><span class="op" id="4918068">]</span><span class="op" id="4918069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4918074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918079">e</span><span class="op" id="4918080">.</span><span class="ident" id="4918081">WriteString</span><span class="op" id="4918092">(</span><span class="string" id="4918093">`\ufffd`</span><span class="op" id="4918101">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918106">i</span>&nbsp;<span class="op" id="4918108">+=</span>&nbsp;<span class="ident" id="4918111">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918119">start</span>&nbsp;<span class="op" id="4918125">=</span>&nbsp;<span class="ident" id="4918127">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4918132">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4918143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4918147">//&nbsp;U+2028&nbsp;is&nbsp;LINE&nbsp;SEPARATOR.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4918178">//&nbsp;U+2029&nbsp;is&nbsp;PARAGRAPH&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4918214">//&nbsp;They&nbsp;are&nbsp;both&nbsp;technically&nbsp;valid&nbsp;characters&nbsp;in&nbsp;JSON&nbsp;strings,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4918279">//&nbsp;but&nbsp;don&#39;t&nbsp;work&nbsp;in&nbsp;JSONP,&nbsp;which&nbsp;has&nbsp;to&nbsp;be&nbsp;evaluated&nbsp;as&nbsp;JavaScript,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4918350">//&nbsp;and&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;there.&nbsp;It&nbsp;is&nbsp;valid&nbsp;JSON&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4918413">//&nbsp;escape&nbsp;them,&nbsp;so&nbsp;we&nbsp;do&nbsp;so&nbsp;unconditionally.</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4918460">//&nbsp;See&nbsp;http://timelessrepo.com/json-isnt-a-javascript-subset&nbsp;for&nbsp;discussion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4918539">if</span>&nbsp;<span class="ident" id="4918542">c</span>&nbsp;<span class="op" id="4918544">==</span>&nbsp;<span class="string" id="4918547">&#39;\u2028&#39;</span>&nbsp;<span class="op" id="4918556">||</span>&nbsp;<span class="ident" id="4918559">c</span>&nbsp;<span class="op" id="4918561">==</span>&nbsp;<span class="string" id="4918564">&#39;\u2029&#39;</span>&nbsp;<span class="op" id="4918573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4918578">if</span>&nbsp;<span class="ident" id="4918581">start</span>&nbsp;<span class="op" id="4918587">&lt;</span>&nbsp;<span class="ident" id="4918589">i</span>&nbsp;<span class="op" id="4918591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918597">e</span><span class="op" id="4918598">.</span><span class="ident" id="4918599">WriteString</span><span class="op" id="4918610">(</span><span class="ident" id="4918611">s</span><span class="op" id="4918612">[</span><span class="ident" id="4918613">start</span><span class="op" id="4918618">:</span><span class="ident" id="4918619">i</span><span class="op" id="4918620">]</span><span class="op" id="4918621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4918626">}</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918631">e</span><span class="op" id="4918632">.</span><span class="ident" id="4918633">WriteString</span><span class="op" id="4918644">(</span><span class="string" id="4918645">`\u202`</span><span class="op" id="4918652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918657">e</span><span class="op" id="4918658">.</span><span class="ident" id="4918659">WriteByte</span><span class="op" id="4918668">(</span><span class="ident" id="4918669">hex</span><span class="op" id="4918672">[</span><span class="ident" id="4918673">c</span><span class="op" id="4918674">&amp;</span><span class="num" id="4918675">0xF</span><span class="op" id="4918678">]</span><span class="op" id="4918679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918684">i</span>&nbsp;<span class="op" id="4918686">+=</span>&nbsp;<span class="ident" id="4918689">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918697">start</span>&nbsp;<span class="op" id="4918703">=</span>&nbsp;<span class="ident" id="4918705">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4918710">continue</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4918721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918725">i</span>&nbsp;<span class="op" id="4918727">+=</span>&nbsp;<span class="ident" id="4918730">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4918736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4918739">if</span>&nbsp;<span class="ident" id="4918742">start</span>&nbsp;<span class="op" id="4918748">&lt;</span>&nbsp;<span class="builtinfunc" id="4918750">len</span><span class="op" id="4918753">(</span><span class="ident" id="4918754">s</span><span class="op" id="4918755">)</span>&nbsp;<span class="op" id="4918757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918761">e</span><span class="op" id="4918762">.</span><span class="ident" id="4918763">WriteString</span><span class="op" id="4918774">(</span><span class="ident" id="4918775">s</span><span class="op" id="4918776">[</span><span class="ident" id="4918777">start</span><span class="op" id="4918782">:</span><span class="op" id="4918783">]</span><span class="op" id="4918784">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4918787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918790">e</span><span class="op" id="4918791">.</span><span class="ident" id="4918792">WriteByte</span><span class="op" id="4918801">(</span><span class="string" id="4918802">&#39;&#34;&#39;</span><span class="op" id="4918805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4918808">return</span>&nbsp;<span class="ident" id="4918815">e</span><span class="op" id="4918816">.</span><span class="ident" id="4918817">Len</span><span class="op" id="4918820">(</span><span class="op" id="4918821">)</span>&nbsp;<span class="op" id="4918823">-</span>&nbsp;<span class="ident" id="4918825">len0</span><span class="op" id="4918829">,</span>&nbsp;<span class="ident" id="4918831">nil</span><br>
<span class="lineno"></span><span class="op" id="4918835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">860</span><span class="comment" id="4918838">//&nbsp;NOTE:&nbsp;keep&nbsp;in&nbsp;sync&nbsp;with&nbsp;string&nbsp;above.</span><br>
<span class="lineno"></span><span class="keyword" id="4918879">func</span>&nbsp;<span class="op" id="4918884">(</span><span class="ident" id="4918885">e</span>&nbsp;<span class="op" id="4918887">*</span><span class="ident" id="4918888">encodeState</span><span class="op" id="4918899">)</span>&nbsp;<span class="ident" id="4918901">stringBytes</span><span class="op" id="4918912">(</span><span class="ident" id="4918913">s</span>&nbsp;<span class="op" id="4918915">[</span><span class="op" id="4918916">]</span><span class="builtintype" id="4918917">byte</span><span class="op" id="4918921">)</span>&nbsp;<span class="op" id="4918923">(</span><span class="builtintype" id="4918924">int</span><span class="op" id="4918927">,</span>&nbsp;<span class="builtintype" id="4918929">error</span><span class="op" id="4918934">)</span>&nbsp;<span class="op" id="4918936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918939">len0</span>&nbsp;<span class="op" id="4918944">:=</span>&nbsp;<span class="ident" id="4918947">e</span><span class="op" id="4918948">.</span><span class="ident" id="4918949">Len</span><span class="op" id="4918952">(</span><span class="op" id="4918953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918956">e</span><span class="op" id="4918957">.</span><span class="ident" id="4918958">WriteByte</span><span class="op" id="4918967">(</span><span class="string" id="4918968">&#39;&#34;&#39;</span><span class="op" id="4918971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4918974">start</span>&nbsp;<span class="op" id="4918980">:=</span>&nbsp;<span class="num" id="4918983">0</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4918986">for</span>&nbsp;<span class="ident" id="4918990">i</span>&nbsp;<span class="op" id="4918992">:=</span>&nbsp;<span class="num" id="4918995">0</span><span class="op" id="4918996">;</span>&nbsp;<span class="ident" id="4918998">i</span>&nbsp;<span class="op" id="4919000">&lt;</span>&nbsp;<span class="builtinfunc" id="4919002">len</span><span class="op" id="4919005">(</span><span class="ident" id="4919006">s</span><span class="op" id="4919007">)</span><span class="op" id="4919008">;</span>&nbsp;<span class="op" id="4919010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919014">if</span>&nbsp;<span class="ident" id="4919017">b</span>&nbsp;<span class="op" id="4919019">:=</span>&nbsp;<span class="ident" id="4919022">s</span><span class="op" id="4919023">[</span><span class="ident" id="4919024">i</span><span class="op" id="4919025">]</span><span class="op" id="4919026">;</span>&nbsp;<span class="ident" id="4919028">b</span>&nbsp;<span class="op" id="4919030">&lt;</span>&nbsp;<span class="ident" id="4919032">utf8</span><span class="op" id="4919036">.</span><span class="ident" id="4919037">RuneSelf</span>&nbsp;<span class="op" id="4919046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919051">if</span>&nbsp;<span class="num" id="4919054">0x20</span>&nbsp;<span class="op" id="4919059">&lt;=</span>&nbsp;<span class="ident" id="4919062">b</span>&nbsp;<span class="op" id="4919064">&amp;&amp;</span>&nbsp;<span class="ident" id="4919067">b</span>&nbsp;<span class="op" id="4919069">!=</span>&nbsp;<span class="string" id="4919072">&#39;\\&#39;</span>&nbsp;<span class="op" id="4919077">&amp;&amp;</span>&nbsp;<span class="ident" id="4919080">b</span>&nbsp;<span class="op" id="4919082">!=</span>&nbsp;<span class="string" id="4919085">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="4919089">&amp;&amp;</span>&nbsp;<span class="ident" id="4919092">b</span>&nbsp;<span class="op" id="4919094">!=</span>&nbsp;<span class="string" id="4919097">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4919101">&amp;&amp;</span>&nbsp;<span class="ident" id="4919104">b</span>&nbsp;<span class="op" id="4919106">!=</span>&nbsp;<span class="string" id="4919109">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="4919113">&amp;&amp;</span>&nbsp;<span class="ident" id="4919116">b</span>&nbsp;<span class="op" id="4919118">!=</span>&nbsp;<span class="string" id="4919121">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4919125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919131">i</span><span class="op" id="4919132">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919139">continue</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4919151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919156">if</span>&nbsp;<span class="ident" id="4919159">start</span>&nbsp;<span class="op" id="4919165">&lt;</span>&nbsp;<span class="ident" id="4919167">i</span>&nbsp;<span class="op" id="4919169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919175">e</span><span class="op" id="4919176">.</span><span class="ident" id="4919177">Write</span><span class="op" id="4919182">(</span><span class="ident" id="4919183">s</span><span class="op" id="4919184">[</span><span class="ident" id="4919185">start</span><span class="op" id="4919190">:</span><span class="ident" id="4919191">i</span><span class="op" id="4919192">]</span><span class="op" id="4919193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4919198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919203">switch</span>&nbsp;<span class="ident" id="4919210">b</span>&nbsp;<span class="op" id="4919212">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919217">case</span>&nbsp;<span class="string" id="4919222">&#39;\\&#39;</span><span class="op" id="4919226">,</span>&nbsp;<span class="string" id="4919228">&#39;&#34;&#39;</span><span class="op" id="4919231">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919237">e</span><span class="op" id="4919238">.</span><span class="ident" id="4919239">WriteByte</span><span class="op" id="4919248">(</span><span class="string" id="4919249">&#39;\\&#39;</span><span class="op" id="4919253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919259">e</span><span class="op" id="4919260">.</span><span class="ident" id="4919261">WriteByte</span><span class="op" id="4919270">(</span><span class="ident" id="4919271">b</span><span class="op" id="4919272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919277">case</span>&nbsp;<span class="string" id="4919282">&#39;\n&#39;</span><span class="op" id="4919286">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919292">e</span><span class="op" id="4919293">.</span><span class="ident" id="4919294">WriteByte</span><span class="op" id="4919303">(</span><span class="string" id="4919304">&#39;\\&#39;</span><span class="op" id="4919308">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919314">e</span><span class="op" id="4919315">.</span><span class="ident" id="4919316">WriteByte</span><span class="op" id="4919325">(</span><span class="string" id="4919326">&#39;n&#39;</span><span class="op" id="4919329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919334">case</span>&nbsp;<span class="string" id="4919339">&#39;\r&#39;</span><span class="op" id="4919343">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919349">e</span><span class="op" id="4919350">.</span><span class="ident" id="4919351">WriteByte</span><span class="op" id="4919360">(</span><span class="string" id="4919361">&#39;\\&#39;</span><span class="op" id="4919365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919371">e</span><span class="op" id="4919372">.</span><span class="ident" id="4919373">WriteByte</span><span class="op" id="4919382">(</span><span class="string" id="4919383">&#39;r&#39;</span><span class="op" id="4919386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919391">case</span>&nbsp;<span class="string" id="4919396">&#39;\t&#39;</span><span class="op" id="4919400">:</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919406">e</span><span class="op" id="4919407">.</span><span class="ident" id="4919408">WriteByte</span><span class="op" id="4919417">(</span><span class="string" id="4919418">&#39;\\&#39;</span><span class="op" id="4919422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919428">e</span><span class="op" id="4919429">.</span><span class="ident" id="4919430">WriteByte</span><span class="op" id="4919439">(</span><span class="string" id="4919440">&#39;t&#39;</span><span class="op" id="4919443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919448">default</span><span class="op" id="4919455">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4919461">//&nbsp;This&nbsp;encodes&nbsp;bytes&nbsp;&lt;&nbsp;0x20&nbsp;except&nbsp;for&nbsp;\n&nbsp;and&nbsp;\r,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4919516">//&nbsp;as&nbsp;well&nbsp;as&nbsp;&lt;,&nbsp;&gt;,&nbsp;and&nbsp;&amp;.&nbsp;The&nbsp;latter&nbsp;are&nbsp;escaped&nbsp;because&nbsp;they</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4919583">//&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;when&nbsp;user-controlled&nbsp;strings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4919646">//&nbsp;are&nbsp;rendered&nbsp;into&nbsp;JSON&nbsp;and&nbsp;served&nbsp;to&nbsp;some&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919705">e</span><span class="op" id="4919706">.</span><span class="ident" id="4919707">WriteString</span><span class="op" id="4919718">(</span><span class="string" id="4919719">`\u00`</span><span class="op" id="4919725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919731">e</span><span class="op" id="4919732">.</span><span class="ident" id="4919733">WriteByte</span><span class="op" id="4919742">(</span><span class="ident" id="4919743">hex</span><span class="op" id="4919746">[</span><span class="ident" id="4919747">b</span><span class="op" id="4919748">&gt;&gt;</span><span class="num" id="4919750">4</span><span class="op" id="4919751">]</span><span class="op" id="4919752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919758">e</span><span class="op" id="4919759">.</span><span class="ident" id="4919760">WriteByte</span><span class="op" id="4919769">(</span><span class="ident" id="4919770">hex</span><span class="op" id="4919773">[</span><span class="ident" id="4919774">b</span><span class="op" id="4919775">&amp;</span><span class="num" id="4919776">0xF</span><span class="op" id="4919779">]</span><span class="op" id="4919780">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4919785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919790">i</span><span class="op" id="4919791">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919797">start</span>&nbsp;<span class="op" id="4919803">=</span>&nbsp;<span class="ident" id="4919805">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919810">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4919821">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919825">c</span><span class="op" id="4919826">,</span>&nbsp;<span class="ident" id="4919828">size</span>&nbsp;<span class="op" id="4919833">:=</span>&nbsp;<span class="ident" id="4919836">utf8</span><span class="op" id="4919840">.</span><span class="ident" id="4919841">DecodeRune</span><span class="op" id="4919851">(</span><span class="ident" id="4919852">s</span><span class="op" id="4919853">[</span><span class="ident" id="4919854">i</span><span class="op" id="4919855">:</span><span class="op" id="4919856">]</span><span class="op" id="4919857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919861">if</span>&nbsp;<span class="ident" id="4919864">c</span>&nbsp;<span class="op" id="4919866">==</span>&nbsp;<span class="ident" id="4919869">utf8</span><span class="op" id="4919873">.</span><span class="ident" id="4919874">RuneError</span>&nbsp;<span class="op" id="4919884">&amp;&amp;</span>&nbsp;<span class="ident" id="4919887">size</span>&nbsp;<span class="op" id="4919892">==</span>&nbsp;<span class="num" id="4919895">1</span>&nbsp;<span class="op" id="4919897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4919902">if</span>&nbsp;<span class="ident" id="4919905">start</span>&nbsp;<span class="op" id="4919911">&lt;</span>&nbsp;<span class="ident" id="4919913">i</span>&nbsp;<span class="op" id="4919915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919921">e</span><span class="op" id="4919922">.</span><span class="ident" id="4919923">Write</span><span class="op" id="4919928">(</span><span class="ident" id="4919929">s</span><span class="op" id="4919930">[</span><span class="ident" id="4919931">start</span><span class="op" id="4919936">:</span><span class="ident" id="4919937">i</span><span class="op" id="4919938">]</span><span class="op" id="4919939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4919944">}</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919949">e</span><span class="op" id="4919950">.</span><span class="ident" id="4919951">WriteString</span><span class="op" id="4919962">(</span><span class="string" id="4919963">`\ufffd`</span><span class="op" id="4919971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919976">i</span>&nbsp;<span class="op" id="4919978">+=</span>&nbsp;<span class="ident" id="4919981">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4919989">start</span>&nbsp;<span class="op" id="4919995">=</span>&nbsp;<span class="ident" id="4919997">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920002">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4920013">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4920017">//&nbsp;U+2028&nbsp;is&nbsp;LINE&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4920048">//&nbsp;U+2029&nbsp;is&nbsp;PARAGRAPH&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4920084">//&nbsp;They&nbsp;are&nbsp;both&nbsp;technically&nbsp;valid&nbsp;characters&nbsp;in&nbsp;JSON&nbsp;strings,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4920149">//&nbsp;but&nbsp;don&#39;t&nbsp;work&nbsp;in&nbsp;JSONP,&nbsp;which&nbsp;has&nbsp;to&nbsp;be&nbsp;evaluated&nbsp;as&nbsp;JavaScript,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4920220">//&nbsp;and&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;there.&nbsp;It&nbsp;is&nbsp;valid&nbsp;JSON&nbsp;to</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4920283">//&nbsp;escape&nbsp;them,&nbsp;so&nbsp;we&nbsp;do&nbsp;so&nbsp;unconditionally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4920330">//&nbsp;See&nbsp;http://timelessrepo.com/json-isnt-a-javascript-subset&nbsp;for&nbsp;discussion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920409">if</span>&nbsp;<span class="ident" id="4920412">c</span>&nbsp;<span class="op" id="4920414">==</span>&nbsp;<span class="string" id="4920417">&#39;\u2028&#39;</span>&nbsp;<span class="op" id="4920426">||</span>&nbsp;<span class="ident" id="4920429">c</span>&nbsp;<span class="op" id="4920431">==</span>&nbsp;<span class="string" id="4920434">&#39;\u2029&#39;</span>&nbsp;<span class="op" id="4920443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920448">if</span>&nbsp;<span class="ident" id="4920451">start</span>&nbsp;<span class="op" id="4920457">&lt;</span>&nbsp;<span class="ident" id="4920459">i</span>&nbsp;<span class="op" id="4920461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920467">e</span><span class="op" id="4920468">.</span><span class="ident" id="4920469">Write</span><span class="op" id="4920474">(</span><span class="ident" id="4920475">s</span><span class="op" id="4920476">[</span><span class="ident" id="4920477">start</span><span class="op" id="4920482">:</span><span class="ident" id="4920483">i</span><span class="op" id="4920484">]</span><span class="op" id="4920485">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4920490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920495">e</span><span class="op" id="4920496">.</span><span class="ident" id="4920497">WriteString</span><span class="op" id="4920508">(</span><span class="string" id="4920509">`\u202`</span><span class="op" id="4920516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920521">e</span><span class="op" id="4920522">.</span><span class="ident" id="4920523">WriteByte</span><span class="op" id="4920532">(</span><span class="ident" id="4920533">hex</span><span class="op" id="4920536">[</span><span class="ident" id="4920537">c</span><span class="op" id="4920538">&amp;</span><span class="num" id="4920539">0xF</span><span class="op" id="4920542">]</span><span class="op" id="4920543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920548">i</span>&nbsp;<span class="op" id="4920550">+=</span>&nbsp;<span class="ident" id="4920553">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920561">start</span>&nbsp;<span class="op" id="4920567">=</span>&nbsp;<span class="ident" id="4920569">i</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920574">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4920585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920589">i</span>&nbsp;<span class="op" id="4920591">+=</span>&nbsp;<span class="ident" id="4920594">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4920600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920603">if</span>&nbsp;<span class="ident" id="4920606">start</span>&nbsp;<span class="op" id="4920612">&lt;</span>&nbsp;<span class="builtinfunc" id="4920614">len</span><span class="op" id="4920617">(</span><span class="ident" id="4920618">s</span><span class="op" id="4920619">)</span>&nbsp;<span class="op" id="4920621">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920625">e</span><span class="op" id="4920626">.</span><span class="ident" id="4920627">Write</span><span class="op" id="4920632">(</span><span class="ident" id="4920633">s</span><span class="op" id="4920634">[</span><span class="ident" id="4920635">start</span><span class="op" id="4920640">:</span><span class="op" id="4920641">]</span><span class="op" id="4920642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4920645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920648">e</span><span class="op" id="4920649">.</span><span class="ident" id="4920650">WriteByte</span><span class="op" id="4920659">(</span><span class="string" id="4920660">&#39;&#34;&#39;</span><span class="op" id="4920663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4920666">return</span>&nbsp;<span class="ident" id="4920673">e</span><span class="op" id="4920674">.</span><span class="ident" id="4920675">Len</span><span class="op" id="4920678">(</span><span class="op" id="4920679">)</span>&nbsp;<span class="op" id="4920681">-</span>&nbsp;<span class="ident" id="4920683">len0</span><span class="op" id="4920687">,</span>&nbsp;<span class="ident" id="4920689">nil</span><br>
<span class="lineno"></span><span class="op" id="4920693">}</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span><span class="comment" id="4920696">//&nbsp;A&nbsp;field&nbsp;represents&nbsp;a&nbsp;single&nbsp;field&nbsp;found&nbsp;in&nbsp;a&nbsp;struct.</span><br>
<span class="lineno"></span><span class="keyword" id="4920752">type</span>&nbsp;<span class="ident" id="4920757">field</span>&nbsp;<span class="keyword" id="4920763">struct</span>&nbsp;<span class="op" id="4920770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920773">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4920783">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920791">nameBytes</span>&nbsp;<span class="op" id="4920801">[</span><span class="op" id="4920802">]</span><span class="builtintype" id="4920803">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4920824">//&nbsp;[]byte(name)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920841">equalFold</span>&nbsp;<span class="keyword" id="4920851">func</span><span class="op" id="4920855">(</span><span class="ident" id="4920856">s</span><span class="op" id="4920857">,</span>&nbsp;<span class="ident" id="4920859">t</span>&nbsp;<span class="op" id="4920861">[</span><span class="op" id="4920862">]</span><span class="builtintype" id="4920863">byte</span><span class="op" id="4920867">)</span>&nbsp;<span class="builtintype" id="4920869">bool</span>&nbsp;<span class="comment" id="4920874">//&nbsp;bytes.EqualFold&nbsp;or&nbsp;equivalent</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920909">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4920919">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920925">index</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920935">[</span><span class="op" id="4920936">]</span><span class="builtintype" id="4920937">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920942">typ</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920952">reflect</span><span class="op" id="4920959">.</span><span class="ident" id="4920960">Type</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920966">omitEmpty</span>&nbsp;<span class="builtintype" id="4920976">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4920982">quoted</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4920992">bool</span><br>
<span class="lineno"></span><span class="op" id="4920997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4921000">func</span>&nbsp;<span class="ident" id="4921005">fillField</span><span class="op" id="4921014">(</span><span class="ident" id="4921015">f</span>&nbsp;<span class="ident" id="4921017">field</span><span class="op" id="4921022">)</span>&nbsp;<span class="ident" id="4921024">field</span>&nbsp;<span class="op" id="4921030">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921033">f</span><span class="op" id="4921034">.</span><span class="ident" id="4921035">nameBytes</span>&nbsp;<span class="op" id="4921045">=</span>&nbsp;<span class="op" id="4921047">[</span><span class="op" id="4921048">]</span><span class="builtintype" id="4921049">byte</span><span class="op" id="4921053">(</span><span class="ident" id="4921054">f</span><span class="op" id="4921055">.</span><span class="ident" id="4921056">name</span><span class="op" id="4921060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4921063">f</span><span class="op" id="4921064">.</span><span class="ident" id="4921065">equalFold</span>&nbsp;<span class="op" id="4921075">=</span>&nbsp;<span class="ident" id="4921077">foldFunc</span><span class="op" id="4921085">(</span><span class="ident" id="4921086">f</span><span class="op" id="4921087">.</span><span class="ident" id="4921088">nameBytes</span><span class="op" id="4921097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921100">return</span>&nbsp;<span class="ident" id="4921107">f</span><br>
<span class="lineno"></span><span class="op" id="4921109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span><span class="comment" id="4921112">//&nbsp;byName&nbsp;sorts&nbsp;field&nbsp;by&nbsp;name,&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;depth,</span><br>
<span class="lineno"></span><span class="comment" id="4921169">//&nbsp;then&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;&#34;name&nbsp;came&nbsp;from&nbsp;json&nbsp;tag&#34;,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="4921228">//&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="keyword" id="4921266">type</span>&nbsp;<span class="ident" id="4921271">byName</span>&nbsp;<span class="op" id="4921278">[</span><span class="op" id="4921279">]</span><span class="ident" id="4921280">field</span><br>
<span class="lineno"></span><br>
<span class="lineno">960</span><span class="keyword" id="4921287">func</span>&nbsp;<span class="op" id="4921292">(</span><span class="ident" id="4921293">x</span>&nbsp;<span class="ident" id="4921295">byName</span><span class="op" id="4921301">)</span>&nbsp;<span class="ident" id="4921303">Len</span><span class="op" id="4921306">(</span><span class="op" id="4921307">)</span>&nbsp;<span class="builtintype" id="4921309">int</span>&nbsp;<span class="op" id="4921313">{</span>&nbsp;<span class="keyword" id="4921315">return</span>&nbsp;<span class="builtinfunc" id="4921322">len</span><span class="op" id="4921325">(</span><span class="ident" id="4921326">x</span><span class="op" id="4921327">)</span>&nbsp;<span class="op" id="4921329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4921332">func</span>&nbsp;<span class="op" id="4921337">(</span><span class="ident" id="4921338">x</span>&nbsp;<span class="ident" id="4921340">byName</span><span class="op" id="4921346">)</span>&nbsp;<span class="ident" id="4921348">Swap</span><span class="op" id="4921352">(</span><span class="ident" id="4921353">i</span><span class="op" id="4921354">,</span>&nbsp;<span class="ident" id="4921356">j</span>&nbsp;<span class="builtintype" id="4921358">int</span><span class="op" id="4921361">)</span>&nbsp;<span class="op" id="4921363">{</span>&nbsp;<span class="ident" id="4921365">x</span><span class="op" id="4921366">[</span><span class="ident" id="4921367">i</span><span class="op" id="4921368">]</span><span class="op" id="4921369">,</span>&nbsp;<span class="ident" id="4921371">x</span><span class="op" id="4921372">[</span><span class="ident" id="4921373">j</span><span class="op" id="4921374">]</span>&nbsp;<span class="op" id="4921376">=</span>&nbsp;<span class="ident" id="4921378">x</span><span class="op" id="4921379">[</span><span class="ident" id="4921380">j</span><span class="op" id="4921381">]</span><span class="op" id="4921382">,</span>&nbsp;<span class="ident" id="4921384">x</span><span class="op" id="4921385">[</span><span class="ident" id="4921386">i</span><span class="op" id="4921387">]</span>&nbsp;<span class="op" id="4921389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4921392">func</span>&nbsp;<span class="op" id="4921397">(</span><span class="ident" id="4921398">x</span>&nbsp;<span class="ident" id="4921400">byName</span><span class="op" id="4921406">)</span>&nbsp;<span class="ident" id="4921408">Less</span><span class="op" id="4921412">(</span><span class="ident" id="4921413">i</span><span class="op" id="4921414">,</span>&nbsp;<span class="ident" id="4921416">j</span>&nbsp;<span class="builtintype" id="4921418">int</span><span class="op" id="4921421">)</span>&nbsp;<span class="builtintype" id="4921423">bool</span>&nbsp;<span class="op" id="4921428">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921431">if</span>&nbsp;<span class="ident" id="4921434">x</span><span class="op" id="4921435">[</span><span class="ident" id="4921436">i</span><span class="op" id="4921437">]</span><span class="op" id="4921438">.</span><span class="ident" id="4921439">name</span>&nbsp;<span class="op" id="4921444">!=</span>&nbsp;<span class="ident" id="4921447">x</span><span class="op" id="4921448">[</span><span class="ident" id="4921449">j</span><span class="op" id="4921450">]</span><span class="op" id="4921451">.</span><span class="ident" id="4921452">name</span>&nbsp;<span class="op" id="4921457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921461">return</span>&nbsp;<span class="ident" id="4921468">x</span><span class="op" id="4921469">[</span><span class="ident" id="4921470">i</span><span class="op" id="4921471">]</span><span class="op" id="4921472">.</span><span class="ident" id="4921473">name</span>&nbsp;<span class="op" id="4921478">&lt;</span>&nbsp;<span class="ident" id="4921480">x</span><span class="op" id="4921481">[</span><span class="ident" id="4921482">j</span><span class="op" id="4921483">]</span><span class="op" id="4921484">.</span><span class="ident" id="4921485">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4921491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921494">if</span>&nbsp;<span class="builtinfunc" id="4921497">len</span><span class="op" id="4921500">(</span><span class="ident" id="4921501">x</span><span class="op" id="4921502">[</span><span class="ident" id="4921503">i</span><span class="op" id="4921504">]</span><span class="op" id="4921505">.</span><span class="ident" id="4921506">index</span><span class="op" id="4921511">)</span>&nbsp;<span class="op" id="4921513">!=</span>&nbsp;<span class="builtinfunc" id="4921516">len</span><span class="op" id="4921519">(</span><span class="ident" id="4921520">x</span><span class="op" id="4921521">[</span><span class="ident" id="4921522">j</span><span class="op" id="4921523">]</span><span class="op" id="4921524">.</span><span class="ident" id="4921525">index</span><span class="op" id="4921530">)</span>&nbsp;<span class="op" id="4921532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921536">return</span>&nbsp;<span class="builtinfunc" id="4921543">len</span><span class="op" id="4921546">(</span><span class="ident" id="4921547">x</span><span class="op" id="4921548">[</span><span class="ident" id="4921549">i</span><span class="op" id="4921550">]</span><span class="op" id="4921551">.</span><span class="ident" id="4921552">index</span><span class="op" id="4921557">)</span>&nbsp;<span class="op" id="4921559">&lt;</span>&nbsp;<span class="builtinfunc" id="4921561">len</span><span class="op" id="4921564">(</span><span class="ident" id="4921565">x</span><span class="op" id="4921566">[</span><span class="ident" id="4921567">j</span><span class="op" id="4921568">]</span><span class="op" id="4921569">.</span><span class="ident" id="4921570">index</span><span class="op" id="4921575">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4921578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921581">if</span>&nbsp;<span class="ident" id="4921584">x</span><span class="op" id="4921585">[</span><span class="ident" id="4921586">i</span><span class="op" id="4921587">]</span><span class="op" id="4921588">.</span><span class="ident" id="4921589">tag</span>&nbsp;<span class="op" id="4921593">!=</span>&nbsp;<span class="ident" id="4921596">x</span><span class="op" id="4921597">[</span><span class="ident" id="4921598">j</span><span class="op" id="4921599">]</span><span class="op" id="4921600">.</span><span class="ident" id="4921601">tag</span>&nbsp;<span class="op" id="4921605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921609">return</span>&nbsp;<span class="ident" id="4921616">x</span><span class="op" id="4921617">[</span><span class="ident" id="4921618">i</span><span class="op" id="4921619">]</span><span class="op" id="4921620">.</span><span class="ident" id="4921621">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4921626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921629">return</span>&nbsp;<span class="ident" id="4921636">byIndex</span><span class="op" id="4921643">(</span><span class="ident" id="4921644">x</span><span class="op" id="4921645">)</span><span class="op" id="4921646">.</span><span class="ident" id="4921647">Less</span><span class="op" id="4921651">(</span><span class="ident" id="4921652">i</span><span class="op" id="4921653">,</span>&nbsp;<span class="ident" id="4921655">j</span><span class="op" id="4921656">)</span><br>
<span class="lineno">975</span><span class="op" id="4921658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4921661">//&nbsp;byIndex&nbsp;sorts&nbsp;field&nbsp;by&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="keyword" id="4921703">type</span>&nbsp;<span class="ident" id="4921708">byIndex</span>&nbsp;<span class="op" id="4921716">[</span><span class="op" id="4921717">]</span><span class="ident" id="4921718">field</span><br>
<span class="lineno"></span><br>
<span class="lineno">980</span><span class="keyword" id="4921725">func</span>&nbsp;<span class="op" id="4921730">(</span><span class="ident" id="4921731">x</span>&nbsp;<span class="ident" id="4921733">byIndex</span><span class="op" id="4921740">)</span>&nbsp;<span class="ident" id="4921742">Len</span><span class="op" id="4921745">(</span><span class="op" id="4921746">)</span>&nbsp;<span class="builtintype" id="4921748">int</span>&nbsp;<span class="op" id="4921752">{</span>&nbsp;<span class="keyword" id="4921754">return</span>&nbsp;<span class="builtinfunc" id="4921761">len</span><span class="op" id="4921764">(</span><span class="ident" id="4921765">x</span><span class="op" id="4921766">)</span>&nbsp;<span class="op" id="4921768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4921771">func</span>&nbsp;<span class="op" id="4921776">(</span><span class="ident" id="4921777">x</span>&nbsp;<span class="ident" id="4921779">byIndex</span><span class="op" id="4921786">)</span>&nbsp;<span class="ident" id="4921788">Swap</span><span class="op" id="4921792">(</span><span class="ident" id="4921793">i</span><span class="op" id="4921794">,</span>&nbsp;<span class="ident" id="4921796">j</span>&nbsp;<span class="builtintype" id="4921798">int</span><span class="op" id="4921801">)</span>&nbsp;<span class="op" id="4921803">{</span>&nbsp;<span class="ident" id="4921805">x</span><span class="op" id="4921806">[</span><span class="ident" id="4921807">i</span><span class="op" id="4921808">]</span><span class="op" id="4921809">,</span>&nbsp;<span class="ident" id="4921811">x</span><span class="op" id="4921812">[</span><span class="ident" id="4921813">j</span><span class="op" id="4921814">]</span>&nbsp;<span class="op" id="4921816">=</span>&nbsp;<span class="ident" id="4921818">x</span><span class="op" id="4921819">[</span><span class="ident" id="4921820">j</span><span class="op" id="4921821">]</span><span class="op" id="4921822">,</span>&nbsp;<span class="ident" id="4921824">x</span><span class="op" id="4921825">[</span><span class="ident" id="4921826">i</span><span class="op" id="4921827">]</span>&nbsp;<span class="op" id="4921829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4921832">func</span>&nbsp;<span class="op" id="4921837">(</span><span class="ident" id="4921838">x</span>&nbsp;<span class="ident" id="4921840">byIndex</span><span class="op" id="4921847">)</span>&nbsp;<span class="ident" id="4921849">Less</span><span class="op" id="4921853">(</span><span class="ident" id="4921854">i</span><span class="op" id="4921855">,</span>&nbsp;<span class="ident" id="4921857">j</span>&nbsp;<span class="builtintype" id="4921859">int</span><span class="op" id="4921862">)</span>&nbsp;<span class="builtintype" id="4921864">bool</span>&nbsp;<span class="op" id="4921869">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921872">for</span>&nbsp;<span class="ident" id="4921876">k</span><span class="op" id="4921877">,</span>&nbsp;<span class="ident" id="4921879">xik</span>&nbsp;<span class="op" id="4921883">:=</span>&nbsp;<span class="keyword" id="4921886">range</span>&nbsp;<span class="ident" id="4921892">x</span><span class="op" id="4921893">[</span><span class="ident" id="4921894">i</span><span class="op" id="4921895">]</span><span class="op" id="4921896">.</span><span class="ident" id="4921897">index</span>&nbsp;<span class="op" id="4921903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921907">if</span>&nbsp;<span class="ident" id="4921910">k</span>&nbsp;<span class="op" id="4921912">&gt;=</span>&nbsp;<span class="builtinfunc" id="4921915">len</span><span class="op" id="4921918">(</span><span class="ident" id="4921919">x</span><span class="op" id="4921920">[</span><span class="ident" id="4921921">j</span><span class="op" id="4921922">]</span><span class="op" id="4921923">.</span><span class="ident" id="4921924">index</span><span class="op" id="4921929">)</span>&nbsp;<span class="op" id="4921931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921936">return</span>&nbsp;<span class="builtintype" id="4921943">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4921951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921955">if</span>&nbsp;<span class="ident" id="4921958">xik</span>&nbsp;<span class="op" id="4921962">!=</span>&nbsp;<span class="ident" id="4921965">x</span><span class="op" id="4921966">[</span><span class="ident" id="4921967">j</span><span class="op" id="4921968">]</span><span class="op" id="4921969">.</span><span class="ident" id="4921970">index</span><span class="op" id="4921975">[</span><span class="ident" id="4921976">k</span><span class="op" id="4921977">]</span>&nbsp;<span class="op" id="4921979">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4921984">return</span>&nbsp;<span class="ident" id="4921991">xik</span>&nbsp;<span class="op" id="4921995">&lt;</span>&nbsp;<span class="ident" id="4921997">x</span><span class="op" id="4921998">[</span><span class="ident" id="4921999">j</span><span class="op" id="4922000">]</span><span class="op" id="4922001">.</span><span class="ident" id="4922002">index</span><span class="op" id="4922007">[</span><span class="ident" id="4922008">k</span><span class="op" id="4922009">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4922013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4922016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922019">return</span>&nbsp;<span class="builtinfunc" id="4922026">len</span><span class="op" id="4922029">(</span><span class="ident" id="4922030">x</span><span class="op" id="4922031">[</span><span class="ident" id="4922032">i</span><span class="op" id="4922033">]</span><span class="op" id="4922034">.</span><span class="ident" id="4922035">index</span><span class="op" id="4922040">)</span>&nbsp;<span class="op" id="4922042">&lt;</span>&nbsp;<span class="builtinfunc" id="4922044">len</span><span class="op" id="4922047">(</span><span class="ident" id="4922048">x</span><span class="op" id="4922049">[</span><span class="ident" id="4922050">j</span><span class="op" id="4922051">]</span><span class="op" id="4922052">.</span><span class="ident" id="4922053">index</span><span class="op" id="4922058">)</span><br>
<span class="lineno"></span><span class="op" id="4922060">}</span><br>
<span class="lineno">995</span><br>
<span class="lineno"></span><span class="comment" id="4922063">//&nbsp;typeFields&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;fields&nbsp;that&nbsp;JSON&nbsp;should&nbsp;recognize&nbsp;for&nbsp;the&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="4922149">//&nbsp;The&nbsp;algorithm&nbsp;is&nbsp;breadth-first&nbsp;search&nbsp;over&nbsp;the&nbsp;set&nbsp;of&nbsp;structs&nbsp;to&nbsp;include&nbsp;-&nbsp;the&nbsp;top&nbsp;struct</span><br>
<span class="lineno"></span><span class="comment" id="4922242">//&nbsp;and&nbsp;then&nbsp;any&nbsp;reachable&nbsp;anonymous&nbsp;structs.</span><br>
<span class="lineno"></span><span class="keyword" id="4922287">func</span>&nbsp;<span class="ident" id="4922292">typeFields</span><span class="op" id="4922302">(</span><span class="ident" id="4922303">t</span>&nbsp;<span class="ident" id="4922305">reflect</span><span class="op" id="4922312">.</span><span class="ident" id="4922313">Type</span><span class="op" id="4922317">)</span>&nbsp;<span class="op" id="4922319">[</span><span class="op" id="4922320">]</span><span class="ident" id="4922321">field</span>&nbsp;<span class="op" id="4922327">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922330">//&nbsp;Anonymous&nbsp;fields&nbsp;to&nbsp;explore&nbsp;at&nbsp;the&nbsp;current&nbsp;level&nbsp;and&nbsp;the&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922397">current</span>&nbsp;<span class="op" id="4922405">:=</span>&nbsp;<span class="op" id="4922408">[</span><span class="op" id="4922409">]</span><span class="ident" id="4922410">field</span><span class="op" id="4922415">{</span><span class="op" id="4922416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922419">next</span>&nbsp;<span class="op" id="4922424">:=</span>&nbsp;<span class="op" id="4922427">[</span><span class="op" id="4922428">]</span><span class="ident" id="4922429">field</span><span class="op" id="4922434">{</span><span class="op" id="4922435">{</span><span class="ident" id="4922436">typ</span><span class="op" id="4922439">:</span>&nbsp;<span class="ident" id="4922441">t</span><span class="op" id="4922442">}</span><span class="op" id="4922443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922447">//&nbsp;Count&nbsp;of&nbsp;queued&nbsp;names&nbsp;for&nbsp;current&nbsp;level&nbsp;and&nbsp;the&nbsp;next.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922505">count</span>&nbsp;<span class="op" id="4922511">:=</span>&nbsp;<span class="keyword" id="4922514">map</span><span class="op" id="4922517">[</span><span class="ident" id="4922518">reflect</span><span class="op" id="4922525">.</span><span class="ident" id="4922526">Type</span><span class="op" id="4922530">]</span><span class="builtintype" id="4922531">int</span><span class="op" id="4922534">{</span><span class="op" id="4922535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922538">nextCount</span>&nbsp;<span class="op" id="4922548">:=</span>&nbsp;<span class="keyword" id="4922551">map</span><span class="op" id="4922554">[</span><span class="ident" id="4922555">reflect</span><span class="op" id="4922562">.</span><span class="ident" id="4922563">Type</span><span class="op" id="4922567">]</span><span class="builtintype" id="4922568">int</span><span class="op" id="4922571">{</span><span class="op" id="4922572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922576">//&nbsp;Types&nbsp;already&nbsp;visited&nbsp;at&nbsp;an&nbsp;earlier&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922623">visited</span>&nbsp;<span class="op" id="4922631">:=</span>&nbsp;<span class="keyword" id="4922634">map</span><span class="op" id="4922637">[</span><span class="ident" id="4922638">reflect</span><span class="op" id="4922645">.</span><span class="ident" id="4922646">Type</span><span class="op" id="4922650">]</span><span class="builtintype" id="4922651">bool</span><span class="op" id="4922655">{</span><span class="op" id="4922656">}</span><br>
<span class="lineno">1010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922660">//&nbsp;Fields&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922678">var</span>&nbsp;<span class="ident" id="4922682">fields</span>&nbsp;<span class="op" id="4922689">[</span><span class="op" id="4922690">]</span><span class="ident" id="4922691">field</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922699">for</span>&nbsp;<span class="builtinfunc" id="4922703">len</span><span class="op" id="4922706">(</span><span class="ident" id="4922707">next</span><span class="op" id="4922711">)</span>&nbsp;<span class="op" id="4922713">&gt;</span>&nbsp;<span class="num" id="4922715">0</span>&nbsp;<span class="op" id="4922717">{</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922721">current</span><span class="op" id="4922728">,</span>&nbsp;<span class="ident" id="4922730">next</span>&nbsp;<span class="op" id="4922735">=</span>&nbsp;<span class="ident" id="4922737">next</span><span class="op" id="4922741">,</span>&nbsp;<span class="ident" id="4922743">current</span><span class="op" id="4922750">[</span><span class="op" id="4922751">:</span><span class="num" id="4922752">0</span><span class="op" id="4922753">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922757">count</span><span class="op" id="4922762">,</span>&nbsp;<span class="ident" id="4922764">nextCount</span>&nbsp;<span class="op" id="4922774">=</span>&nbsp;<span class="ident" id="4922776">nextCount</span><span class="op" id="4922785">,</span>&nbsp;<span class="keyword" id="4922787">map</span><span class="op" id="4922790">[</span><span class="ident" id="4922791">reflect</span><span class="op" id="4922798">.</span><span class="ident" id="4922799">Type</span><span class="op" id="4922803">]</span><span class="builtintype" id="4922804">int</span><span class="op" id="4922807">{</span><span class="op" id="4922808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922813">for</span>&nbsp;<span class="ident" id="4922817">_</span><span class="op" id="4922818">,</span>&nbsp;<span class="ident" id="4922820">f</span>&nbsp;<span class="op" id="4922822">:=</span>&nbsp;<span class="keyword" id="4922825">range</span>&nbsp;<span class="ident" id="4922831">current</span>&nbsp;<span class="op" id="4922839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922844">if</span>&nbsp;<span class="ident" id="4922847">visited</span><span class="op" id="4922854">[</span><span class="ident" id="4922855">f</span><span class="op" id="4922856">.</span><span class="ident" id="4922857">typ</span><span class="op" id="4922860">]</span>&nbsp;<span class="op" id="4922862">{</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922868">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4922880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922885">visited</span><span class="op" id="4922892">[</span><span class="ident" id="4922893">f</span><span class="op" id="4922894">.</span><span class="ident" id="4922895">typ</span><span class="op" id="4922898">]</span>&nbsp;<span class="op" id="4922900">=</span>&nbsp;<span class="builtintype" id="4922902">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4922911">//&nbsp;Scan&nbsp;f.typ&nbsp;for&nbsp;fields&nbsp;to&nbsp;include.</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4922951">for</span>&nbsp;<span class="ident" id="4922955">i</span>&nbsp;<span class="op" id="4922957">:=</span>&nbsp;<span class="num" id="4922960">0</span><span class="op" id="4922961">;</span>&nbsp;<span class="ident" id="4922963">i</span>&nbsp;<span class="op" id="4922965">&lt;</span>&nbsp;<span class="ident" id="4922967">f</span><span class="op" id="4922968">.</span><span class="ident" id="4922969">typ</span><span class="op" id="4922972">.</span><span class="ident" id="4922973">NumField</span><span class="op" id="4922981">(</span><span class="op" id="4922982">)</span><span class="op" id="4922983">;</span>&nbsp;<span class="ident" id="4922985">i</span><span class="op" id="4922986">++</span>&nbsp;<span class="op" id="4922989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4922995">sf</span>&nbsp;<span class="op" id="4922998">:=</span>&nbsp;<span class="ident" id="4923001">f</span><span class="op" id="4923002">.</span><span class="ident" id="4923003">typ</span><span class="op" id="4923006">.</span><span class="ident" id="4923007">Field</span><span class="op" id="4923012">(</span><span class="ident" id="4923013">i</span><span class="op" id="4923014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4923020">if</span>&nbsp;<span class="ident" id="4923023">sf</span><span class="op" id="4923025">.</span><span class="ident" id="4923026">PkgPath</span>&nbsp;<span class="op" id="4923034">!=</span>&nbsp;<span class="string" id="4923037">&#34;&#34;</span>&nbsp;<span class="op" id="4923040">{</span>&nbsp;<span class="comment" id="4923042">//&nbsp;unexported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4923061">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4923074">}</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923080">tag</span>&nbsp;<span class="op" id="4923084">:=</span>&nbsp;<span class="ident" id="4923087">sf</span><span class="op" id="4923089">.</span><span class="ident" id="4923090">Tag</span><span class="op" id="4923093">.</span><span class="ident" id="4923094">Get</span><span class="op" id="4923097">(</span><span class="string" id="4923098">&#34;json&#34;</span><span class="op" id="4923104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4923110">if</span>&nbsp;<span class="ident" id="4923113">tag</span>&nbsp;<span class="op" id="4923117">==</span>&nbsp;<span class="string" id="4923120">&#34;-&#34;</span>&nbsp;<span class="op" id="4923124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4923131">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4923144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923150">name</span><span class="op" id="4923154">,</span>&nbsp;<span class="ident" id="4923156">opts</span>&nbsp;<span class="op" id="4923161">:=</span>&nbsp;<span class="ident" id="4923164">parseTag</span><span class="op" id="4923172">(</span><span class="ident" id="4923173">tag</span><span class="op" id="4923176">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4923182">if</span>&nbsp;<span class="op" id="4923185">!</span><span class="ident" id="4923186">isValidTag</span><span class="op" id="4923196">(</span><span class="ident" id="4923197">name</span><span class="op" id="4923201">)</span>&nbsp;<span class="op" id="4923203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923210">name</span>&nbsp;<span class="op" id="4923215">=</span>&nbsp;<span class="string" id="4923217">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4923224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923230">index</span>&nbsp;<span class="op" id="4923236">:=</span>&nbsp;<span class="builtinfunc" id="4923239">make</span><span class="op" id="4923243">(</span><span class="op" id="4923244">[</span><span class="op" id="4923245">]</span><span class="builtintype" id="4923246">int</span><span class="op" id="4923249">,</span>&nbsp;<span class="builtinfunc" id="4923251">len</span><span class="op" id="4923254">(</span><span class="ident" id="4923255">f</span><span class="op" id="4923256">.</span><span class="ident" id="4923257">index</span><span class="op" id="4923262">)</span><span class="op" id="4923263">+</span><span class="num" id="4923264">1</span><span class="op" id="4923265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4923271">copy</span><span class="op" id="4923275">(</span><span class="ident" id="4923276">index</span><span class="op" id="4923281">,</span>&nbsp;<span class="ident" id="4923283">f</span><span class="op" id="4923284">.</span><span class="ident" id="4923285">index</span><span class="op" id="4923290">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923296">index</span><span class="op" id="4923301">[</span><span class="builtinfunc" id="4923302">len</span><span class="op" id="4923305">(</span><span class="ident" id="4923306">f</span><span class="op" id="4923307">.</span><span class="ident" id="4923308">index</span><span class="op" id="4923313">)</span><span class="op" id="4923314">]</span>&nbsp;<span class="op" id="4923316">=</span>&nbsp;<span class="ident" id="4923318">i</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923325">ft</span>&nbsp;<span class="op" id="4923328">:=</span>&nbsp;<span class="ident" id="4923331">sf</span><span class="op" id="4923333">.</span><span class="ident" id="4923334">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4923343">if</span>&nbsp;<span class="ident" id="4923346">ft</span><span class="op" id="4923348">.</span><span class="ident" id="4923349">Name</span><span class="op" id="4923353">(</span><span class="op" id="4923354">)</span>&nbsp;<span class="op" id="4923356">==</span>&nbsp;<span class="string" id="4923359">&#34;&#34;</span>&nbsp;<span class="op" id="4923362">&amp;&amp;</span>&nbsp;<span class="ident" id="4923365">ft</span><span class="op" id="4923367">.</span><span class="ident" id="4923368">Kind</span><span class="op" id="4923372">(</span><span class="op" id="4923373">)</span>&nbsp;<span class="op" id="4923375">==</span>&nbsp;<span class="ident" id="4923378">reflect</span><span class="op" id="4923385">.</span><span class="ident" id="4923386">Ptr</span>&nbsp;<span class="op" id="4923390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4923397">//&nbsp;Follow&nbsp;pointer.</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923421">ft</span>&nbsp;<span class="op" id="4923424">=</span>&nbsp;<span class="ident" id="4923426">ft</span><span class="op" id="4923428">.</span><span class="ident" id="4923429">Elem</span><span class="op" id="4923433">(</span><span class="op" id="4923434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4923440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4923447">//&nbsp;Record&nbsp;found&nbsp;field&nbsp;and&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4923493">if</span>&nbsp;<span class="ident" id="4923496">name</span>&nbsp;<span class="op" id="4923501">!=</span>&nbsp;<span class="string" id="4923504">&#34;&#34;</span>&nbsp;<span class="op" id="4923507">||</span>&nbsp;<span class="op" id="4923510">!</span><span class="ident" id="4923511">sf</span><span class="op" id="4923513">.</span><span class="ident" id="4923514">Anonymous</span>&nbsp;<span class="op" id="4923524">||</span>&nbsp;<span class="ident" id="4923527">ft</span><span class="op" id="4923529">.</span><span class="ident" id="4923530">Kind</span><span class="op" id="4923534">(</span><span class="op" id="4923535">)</span>&nbsp;<span class="op" id="4923537">!=</span>&nbsp;<span class="ident" id="4923540">reflect</span><span class="op" id="4923547">.</span><span class="ident" id="4923548">Struct</span>&nbsp;<span class="op" id="4923555">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923562">tagged</span>&nbsp;<span class="op" id="4923569">:=</span>&nbsp;<span class="ident" id="4923572">name</span>&nbsp;<span class="op" id="4923577">!=</span>&nbsp;<span class="string" id="4923580">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4923588">if</span>&nbsp;<span class="ident" id="4923591">name</span>&nbsp;<span class="op" id="4923596">==</span>&nbsp;<span class="string" id="4923599">&#34;&#34;</span>&nbsp;<span class="op" id="4923602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923610">name</span>&nbsp;<span class="op" id="4923615">=</span>&nbsp;<span class="ident" id="4923617">sf</span><span class="op" id="4923619">.</span><span class="ident" id="4923620">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4923630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923637">fields</span>&nbsp;<span class="op" id="4923644">=</span>&nbsp;<span class="builtinfunc" id="4923646">append</span><span class="op" id="4923652">(</span><span class="ident" id="4923653">fields</span><span class="op" id="4923659">,</span>&nbsp;<span class="ident" id="4923661">fillField</span><span class="op" id="4923670">(</span><span class="ident" id="4923671">field</span><span class="op" id="4923676">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923684">name</span><span class="op" id="4923688">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923695">name</span><span class="op" id="4923699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923707">tag</span><span class="op" id="4923710">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923718">tagged</span><span class="op" id="4923724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923732">index</span><span class="op" id="4923737">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923743">index</span><span class="op" id="4923748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923756">typ</span><span class="op" id="4923759">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923767">ft</span><span class="op" id="4923769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923777">omitEmpty</span><span class="op" id="4923786">:</span>&nbsp;<span class="ident" id="4923788">opts</span><span class="op" id="4923792">.</span><span class="ident" id="4923793">Contains</span><span class="op" id="4923801">(</span><span class="string" id="4923802">&#34;omitempty&#34;</span><span class="op" id="4923813">)</span><span class="op" id="4923814">,</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4923822">quoted</span><span class="op" id="4923828">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923833">opts</span><span class="op" id="4923837">.</span><span class="ident" id="4923838">Contains</span><span class="op" id="4923846">(</span><span class="string" id="4923847">&#34;string&#34;</span><span class="op" id="4923855">)</span><span class="op" id="4923856">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4923863">}</span><span class="op" id="4923864">)</span><span class="op" id="4923865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4923872">if</span>&nbsp;<span class="ident" id="4923875">count</span><span class="op" id="4923880">[</span><span class="ident" id="4923881">f</span><span class="op" id="4923882">.</span><span class="ident" id="4923883">typ</span><span class="op" id="4923886">]</span>&nbsp;<span class="op" id="4923888">&gt;</span>&nbsp;<span class="num" id="4923890">1</span>&nbsp;<span class="op" id="4923892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4923900">//&nbsp;If&nbsp;there&nbsp;were&nbsp;multiple&nbsp;instances,&nbsp;add&nbsp;a&nbsp;second,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4923957">//&nbsp;so&nbsp;that&nbsp;the&nbsp;annihilation&nbsp;code&nbsp;will&nbsp;see&nbsp;a&nbsp;duplicate.</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4924018">//&nbsp;It&nbsp;only&nbsp;cares&nbsp;about&nbsp;the&nbsp;distinction&nbsp;between&nbsp;1&nbsp;or&nbsp;2,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4924079">//&nbsp;so&nbsp;don&#39;t&nbsp;bother&nbsp;generating&nbsp;any&nbsp;more&nbsp;copies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4924132">fields</span>&nbsp;<span class="op" id="4924139">=</span>&nbsp;<span class="builtinfunc" id="4924141">append</span><span class="op" id="4924147">(</span><span class="ident" id="4924148">fields</span><span class="op" id="4924154">,</span>&nbsp;<span class="ident" id="4924156">fields</span><span class="op" id="4924162">[</span><span class="builtinfunc" id="4924163">len</span><span class="op" id="4924166">(</span><span class="ident" id="4924167">fields</span><span class="op" id="4924173">)</span><span class="op" id="4924174">-</span><span class="num" id="4924175">1</span><span class="op" id="4924176">]</span><span class="op" id="4924177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4924184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4924191">continue</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4924204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4924211">//&nbsp;Record&nbsp;new&nbsp;anonymous&nbsp;struct&nbsp;to&nbsp;explore&nbsp;in&nbsp;next&nbsp;round.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4924272">nextCount</span><span class="op" id="4924281">[</span><span class="ident" id="4924282">ft</span><span class="op" id="4924284">]</span><span class="op" id="4924285">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4924292">if</span>&nbsp;<span class="ident" id="4924295">nextCount</span><span class="op" id="4924304">[</span><span class="ident" id="4924305">ft</span><span class="op" id="4924307">]</span>&nbsp;<span class="op" id="4924309">==</span>&nbsp;<span class="num" id="4924312">1</span>&nbsp;<span class="op" id="4924314">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4924321">next</span>&nbsp;<span class="op" id="4924326">=</span>&nbsp;<span class="builtinfunc" id="4924328">append</span><span class="op" id="4924334">(</span><span class="ident" id="4924335">next</span><span class="op" id="4924339">,</span>&nbsp;<span class="ident" id="4924341">fillField</span><span class="op" id="4924350">(</span><span class="ident" id="4924351">field</span><span class="op" id="4924356">{</span><span class="ident" id="4924357">name</span><span class="op" id="4924361">:</span>&nbsp;<span class="ident" id="4924363">ft</span><span class="op" id="4924365">.</span><span class="ident" id="4924366">Name</span><span class="op" id="4924370">(</span><span class="op" id="4924371">)</span><span class="op" id="4924372">,</span>&nbsp;<span class="ident" id="4924374">index</span><span class="op" id="4924379">:</span>&nbsp;<span class="ident" id="4924381">index</span><span class="op" id="4924386">,</span>&nbsp;<span class="ident" id="4924388">typ</span><span class="op" id="4924391">:</span>&nbsp;<span class="ident" id="4924393">ft</span><span class="op" id="4924395">}</span><span class="op" id="4924396">)</span><span class="op" id="4924397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4924403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4924408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4924412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4924415">}</span><br>
<span class="lineno">1080</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4924419">sort</span><span class="op" id="4924423">.</span><span class="ident" id="4924424">Sort</span><span class="op" id="4924428">(</span><span class="ident" id="4924429">byName</span><span class="op" id="4924435">(</span><span class="ident" id="4924436">fields</span><span class="op" id="4924442">)</span><span class="op" id="4924443">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4924447">//&nbsp;Delete&nbsp;all&nbsp;fields&nbsp;that&nbsp;are&nbsp;hidden&nbsp;by&nbsp;the&nbsp;Go&nbsp;rules&nbsp;for&nbsp;embedded&nbsp;fields,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4924522">//&nbsp;except&nbsp;that&nbsp;fields&nbsp;with&nbsp;JSON&nbsp;tags&nbsp;are&nbsp;promoted.</span><br>
<span class="lineno">1085</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4924575">//&nbsp;The&nbsp;fields&nbsp;are&nbsp;sorted&nbsp;in&nbsp;primary&nbsp;order&nbsp;of&nbsp;name,&nbsp;secondary&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4924643">//&nbsp;of&nbsp;field&nbsp;index&nbsp;length.&nbsp;Loop&nbsp;over&nbsp;names;&nbsp;for&nbsp;each&nbsp;name,&nbsp;delete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4924709">//&nbsp;hidden&nbsp;fields&nbsp;by&nbsp;choosing&nbsp;the&nbsp;one&nbsp;dominant&nbsp;field&nbsp;that&nbsp;survives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4924777">out</span>&nbsp;<span class="op" id="4924781">:=</span>&nbsp;<span class="ident" id="4924784">fields</span><span class="op" id="4924790">[</span><span class="op" id="4924791">:</span><span class="num" id="4924792">0</span><span class="op" id="4924793">]</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4924796">for</span>&nbsp;<span class="ident" id="4924800">advance</span><span class="op" id="4924807">,</span>&nbsp;<span class="ident" id="4924809">i</span>&nbsp;<span class="op" id="4924811">:=</span>&nbsp;<span class="num" id="4924814">0</span><span class="op" id="4924815">,</span>&nbsp;<span class="num" id="4924817">0</span><span class="op" id="4924818">;</span>&nbsp;<span class="ident" id="4924820">i</span>&nbsp;<span class="op" id="4924822">&lt;</span>&nbsp;<span class="builtinfunc" id="4924824">len</span><span class="op" id="4924827">(</span><span class="ident" id="4924828">fields</span><span class="op" id="4924834">)</span><span class="op" id="4924835">;</span>&nbsp;<span class="ident" id="4924837">i</span>&nbsp;<span class="op" id="4924839">+=</span>&nbsp;<span class="ident" id="4924842">advance</span>&nbsp;<span class="op" id="4924850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4924854">//&nbsp;One&nbsp;iteration&nbsp;per&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4924883">//&nbsp;Find&nbsp;the&nbsp;sequence&nbsp;of&nbsp;fields&nbsp;with&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;first&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4924951">fi</span>&nbsp;<span class="op" id="4924954">:=</span>&nbsp;<span class="ident" id="4924957">fields</span><span class="op" id="4924963">[</span><span class="ident" id="4924964">i</span><span class="op" id="4924965">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4924969">name</span>&nbsp;<span class="op" id="4924974">:=</span>&nbsp;<span class="ident" id="4924977">fi</span><span class="op" id="4924979">.</span><span class="ident" id="4924980">name</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4924987">for</span>&nbsp;<span class="ident" id="4924991">advance</span>&nbsp;<span class="op" id="4924999">=</span>&nbsp;<span class="num" id="4925001">1</span><span class="op" id="4925002">;</span>&nbsp;<span class="ident" id="4925004">i</span><span class="op" id="4925005">+</span><span class="ident" id="4925006">advance</span>&nbsp;<span class="op" id="4925014">&lt;</span>&nbsp;<span class="builtinfunc" id="4925016">len</span><span class="op" id="4925019">(</span><span class="ident" id="4925020">fields</span><span class="op" id="4925026">)</span><span class="op" id="4925027">;</span>&nbsp;<span class="ident" id="4925029">advance</span><span class="op" id="4925036">++</span>&nbsp;<span class="op" id="4925039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4925044">fj</span>&nbsp;<span class="op" id="4925047">:=</span>&nbsp;<span class="ident" id="4925050">fields</span><span class="op" id="4925056">[</span><span class="ident" id="4925057">i</span><span class="op" id="4925058">+</span><span class="ident" id="4925059">advance</span><span class="op" id="4925066">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4925071">if</span>&nbsp;<span class="ident" id="4925074">fj</span><span class="op" id="4925076">.</span><span class="ident" id="4925077">name</span>&nbsp;<span class="op" id="4925082">!=</span>&nbsp;<span class="ident" id="4925085">name</span>&nbsp;<span class="op" id="4925090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4925096">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4925105">}</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4925109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4925113">if</span>&nbsp;<span class="ident" id="4925116">advance</span>&nbsp;<span class="op" id="4925124">==</span>&nbsp;<span class="num" id="4925127">1</span>&nbsp;<span class="op" id="4925129">{</span>&nbsp;<span class="comment" id="4925131">//&nbsp;Only&nbsp;one&nbsp;field&nbsp;with&nbsp;this&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4925167">out</span>&nbsp;<span class="op" id="4925171">=</span>&nbsp;<span class="builtinfunc" id="4925173">append</span><span class="op" id="4925179">(</span><span class="ident" id="4925180">out</span><span class="op" id="4925183">,</span>&nbsp;<span class="ident" id="4925185">fi</span><span class="op" id="4925187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4925192">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4925203">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4925207">dominant</span><span class="op" id="4925215">,</span>&nbsp;<span class="ident" id="4925217">ok</span>&nbsp;<span class="op" id="4925220">:=</span>&nbsp;<span class="ident" id="4925223">dominantField</span><span class="op" id="4925236">(</span><span class="ident" id="4925237">fields</span><span class="op" id="4925243">[</span><span class="ident" id="4925244">i</span>&nbsp;<span class="op" id="4925246">:</span>&nbsp;<span class="ident" id="4925248">i</span><span class="op" id="4925249">+</span><span class="ident" id="4925250">advance</span><span class="op" id="4925257">]</span><span class="op" id="4925258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4925262">if</span>&nbsp;<span class="ident" id="4925265">ok</span>&nbsp;<span class="op" id="4925268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4925273">out</span>&nbsp;<span class="op" id="4925277">=</span>&nbsp;<span class="builtinfunc" id="4925279">append</span><span class="op" id="4925285">(</span><span class="ident" id="4925286">out</span><span class="op" id="4925289">,</span>&nbsp;<span class="ident" id="4925291">dominant</span><span class="op" id="4925299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4925303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4925306">}</span><br>
<span class="lineno">1110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4925310">fields</span>&nbsp;<span class="op" id="4925317">=</span>&nbsp;<span class="ident" id="4925319">out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4925324">sort</span><span class="op" id="4925328">.</span><span class="ident" id="4925329">Sort</span><span class="op" id="4925333">(</span><span class="ident" id="4925334">byIndex</span><span class="op" id="4925341">(</span><span class="ident" id="4925342">fields</span><span class="op" id="4925348">)</span><span class="op" id="4925349">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4925353">return</span>&nbsp;<span class="ident" id="4925360">fields</span><br>
<span class="lineno">1115</span><span class="op" id="4925367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4925370">//&nbsp;dominantField&nbsp;looks&nbsp;through&nbsp;the&nbsp;fields,&nbsp;all&nbsp;of&nbsp;which&nbsp;are&nbsp;known&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4925439">//&nbsp;have&nbsp;the&nbsp;same&nbsp;name,&nbsp;to&nbsp;find&nbsp;the&nbsp;single&nbsp;field&nbsp;that&nbsp;dominates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4925506">//&nbsp;others&nbsp;using&nbsp;Go&#39;s&nbsp;embedding&nbsp;rules,&nbsp;modified&nbsp;by&nbsp;the&nbsp;presence&nbsp;of</span><br>
<span class="lineno">1120</span><span class="comment" id="4925572">//&nbsp;JSON&nbsp;tags.&nbsp;If&nbsp;there&nbsp;are&nbsp;multiple&nbsp;top-level&nbsp;fields,&nbsp;the&nbsp;boolean</span><br>
<span class="lineno"></span><span class="comment" id="4925638">//&nbsp;will&nbsp;be&nbsp;false:&nbsp;This&nbsp;condition&nbsp;is&nbsp;an&nbsp;error&nbsp;in&nbsp;Go&nbsp;and&nbsp;we&nbsp;skip&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="4925705">//&nbsp;the&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="4925720">func</span>&nbsp;<span class="ident" id="4925725">dominantField</span><span class="op" id="4925738">(</span><span class="ident" id="4925739">fields</span>&nbsp;<span class="op" id="4925746">[</span><span class="op" id="4925747">]</span><span class="ident" id="4925748">field</span><span class="op" id="4925753">)</span>&nbsp;<span class="op" id="4925755">(</span><span class="ident" id="4925756">field</span><span class="op" id="4925761">,</span>&nbsp;<span class="builtintype" id="4925763">bool</span><span class="op" id="4925767">)</span>&nbsp;<span class="op" id="4925769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4925772">//&nbsp;The&nbsp;fields&nbsp;are&nbsp;sorted&nbsp;in&nbsp;increasing&nbsp;index-length&nbsp;order.&nbsp;The&nbsp;winner</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4925843">//&nbsp;must&nbsp;therefore&nbsp;be&nbsp;one&nbsp;with&nbsp;the&nbsp;shortest&nbsp;index&nbsp;length.&nbsp;Drop&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4925910">//&nbsp;longer&nbsp;entries,&nbsp;which&nbsp;is&nbsp;easy:&nbsp;just&nbsp;truncate&nbsp;the&nbsp;slice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4925970">length</span>&nbsp;<span class="op" id="4925977">:=</span>&nbsp;<span class="builtinfunc" id="4925980">len</span><span class="op" id="4925983">(</span><span class="ident" id="4925984">fields</span><span class="op" id="4925990">[</span><span class="num" id="4925991">0</span><span class="op" id="4925992">]</span><span class="op" id="4925993">.</span><span class="ident" id="4925994">index</span><span class="op" id="4925999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4926002">tagged</span>&nbsp;<span class="op" id="4926009">:=</span>&nbsp;<span class="op" id="4926012">-</span><span class="num" id="4926013">1</span>&nbsp;<span class="comment" id="4926015">//&nbsp;Index&nbsp;of&nbsp;first&nbsp;tagged&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4926048">for</span>&nbsp;<span class="ident" id="4926052">i</span><span class="op" id="4926053">,</span>&nbsp;<span class="ident" id="4926055">f</span>&nbsp;<span class="op" id="4926057">:=</span>&nbsp;<span class="keyword" id="4926060">range</span>&nbsp;<span class="ident" id="4926066">fields</span>&nbsp;<span class="op" id="4926073">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4926077">if</span>&nbsp;<span class="builtinfunc" id="4926080">len</span><span class="op" id="4926083">(</span><span class="ident" id="4926084">f</span><span class="op" id="4926085">.</span><span class="ident" id="4926086">index</span><span class="op" id="4926091">)</span>&nbsp;<span class="op" id="4926093">&gt;</span>&nbsp;<span class="ident" id="4926095">length</span>&nbsp;<span class="op" id="4926102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4926107">fields</span>&nbsp;<span class="op" id="4926114">=</span>&nbsp;<span class="ident" id="4926116">fields</span><span class="op" id="4926122">[</span><span class="op" id="4926123">:</span><span class="ident" id="4926124">i</span><span class="op" id="4926125">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4926130">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4926138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4926142">if</span>&nbsp;<span class="ident" id="4926145">f</span><span class="op" id="4926146">.</span><span class="ident" id="4926147">tag</span>&nbsp;<span class="op" id="4926151">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4926156">if</span>&nbsp;<span class="ident" id="4926159">tagged</span>&nbsp;<span class="op" id="4926166">&gt;=</span>&nbsp;<span class="num" id="4926169">0</span>&nbsp;<span class="op" id="4926171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4926177">//&nbsp;Multiple&nbsp;tagged&nbsp;fields&nbsp;at&nbsp;the&nbsp;same&nbsp;level:&nbsp;conflict.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4926236">//&nbsp;Return&nbsp;no&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4926260">return</span>&nbsp;<span class="ident" id="4926267">field</span><span class="op" id="4926272">{</span><span class="op" id="4926273">}</span><span class="op" id="4926274">,</span>&nbsp;<span class="builtintype" id="4926276">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4926285">}</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4926290">tagged</span>&nbsp;<span class="op" id="4926297">=</span>&nbsp;<span class="ident" id="4926299">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4926303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4926306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4926309">if</span>&nbsp;<span class="ident" id="4926312">tagged</span>&nbsp;<span class="op" id="4926319">&gt;=</span>&nbsp;<span class="num" id="4926322">0</span>&nbsp;<span class="op" id="4926324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4926328">return</span>&nbsp;<span class="ident" id="4926335">fields</span><span class="op" id="4926341">[</span><span class="ident" id="4926342">tagged</span><span class="op" id="4926348">]</span><span class="op" id="4926349">,</span>&nbsp;<span class="builtintype" id="4926351">true</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4926357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4926360">//&nbsp;All&nbsp;remaining&nbsp;fields&nbsp;have&nbsp;the&nbsp;same&nbsp;length.&nbsp;If&nbsp;there&#39;s&nbsp;more&nbsp;than&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4926433">//&nbsp;we&nbsp;have&nbsp;a&nbsp;conflict&nbsp;(two&nbsp;fields&nbsp;named&nbsp;&#34;X&#34;&nbsp;at&nbsp;the&nbsp;same&nbsp;level)&nbsp;and&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4926504">//&nbsp;return&nbsp;no&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4926525">if</span>&nbsp;<span class="builtinfunc" id="4926528">len</span><span class="op" id="4926531">(</span><span class="ident" id="4926532">fields</span><span class="op" id="4926538">)</span>&nbsp;<span class="op" id="4926540">&gt;</span>&nbsp;<span class="num" id="4926542">1</span>&nbsp;<span class="op" id="4926544">{</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4926548">return</span>&nbsp;<span class="ident" id="4926555">field</span><span class="op" id="4926560">{</span><span class="op" id="4926561">}</span><span class="op" id="4926562">,</span>&nbsp;<span class="builtintype" id="4926564">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4926571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4926574">return</span>&nbsp;<span class="ident" id="4926581">fields</span><span class="op" id="4926587">[</span><span class="num" id="4926588">0</span><span class="op" id="4926589">]</span><span class="op" id="4926590">,</span>&nbsp;<span class="builtintype" id="4926592">true</span><br>
<span class="lineno"></span><span class="op" id="4926597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1155</span><span class="keyword" id="4926600">var</span>&nbsp;<span class="ident" id="4926604">fieldCache</span>&nbsp;<span class="keyword" id="4926615">struct</span>&nbsp;<span class="op" id="4926622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4926625">sync</span><span class="op" id="4926629">.</span><span class="ident" id="4926630">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4926639">m</span>&nbsp;<span class="keyword" id="4926641">map</span><span class="op" id="4926644">[</span><span class="ident" id="4926645">reflect</span><span class="op" id="4926652">.</span><span class="ident" id="4926653">Type</span><span class="op" id="4926657">]</span><span class="op" id="4926658">[</span><span class="op" id="4926659">]</span><span class="ident" id="4926660">field</span><br>
<span class="lineno"></span><span class="op" id="4926666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="comment" id="4926669">//&nbsp;cachedTypeFields&nbsp;is&nbsp;like&nbsp;typeFields&nbsp;but&nbsp;uses&nbsp;a&nbsp;cache&nbsp;to&nbsp;avoid&nbsp;repeated&nbsp;work.</span><br>
<span class="lineno"></span><span class="keyword" id="4926749">func</span>&nbsp;<span class="ident" id="4926754">cachedTypeFields</span><span class="op" id="4926770">(</span><span class="ident" id="4926771">t</span>&nbsp;<span class="ident" id="4926773">reflect</span><span class="op" id="4926780">.</span><span class="ident" id="4926781">Type</span><span class="op" id="4926785">)</span>&nbsp;<span class="op" id="4926787">[</span><span class="op" id="4926788">]</span><span class="ident" id="4926789">field</span>&nbsp;<span class="op" id="4926795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4926798">fieldCache</span><span class="op" id="4926808">.</span><span class="ident" id="4926809">RLock</span><span class="op" id="4926814">(</span><span class="op" id="4926815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4926818">f</span>&nbsp;<span class="op" id="4926820">:=</span>&nbsp;<span class="ident" id="4926823">fieldCache</span><span class="op" id="4926833">.</span><span class="ident" id="4926834">m</span><span class="op" id="4926835">[</span><span class="ident" id="4926836">t</span><span class="op" id="4926837">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4926840">fieldCache</span><span class="op" id="4926850">.</span><span class="ident" id="4926851">RUnlock</span><span class="op" id="4926858">(</span><span class="op" id="4926859">)</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4926862">if</span>&nbsp;<span class="ident" id="4926865">f</span>&nbsp;<span class="op" id="4926867">!=</span>&nbsp;<span class="ident" id="4926870">nil</span>&nbsp;<span class="op" id="4926874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4926878">return</span>&nbsp;<span class="ident" id="4926885">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4926888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4926892">//&nbsp;Compute&nbsp;fields&nbsp;without&nbsp;lock.</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4926925">//&nbsp;Might&nbsp;duplicate&nbsp;effort&nbsp;but&nbsp;won&#39;t&nbsp;hold&nbsp;other&nbsp;computations&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4926992">f</span>&nbsp;<span class="op" id="4926994">=</span>&nbsp;<span class="ident" id="4926996">typeFields</span><span class="op" id="4927006">(</span><span class="ident" id="4927007">t</span><span class="op" id="4927008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4927011">if</span>&nbsp;<span class="ident" id="4927014">f</span>&nbsp;<span class="op" id="4927016">==</span>&nbsp;<span class="ident" id="4927019">nil</span>&nbsp;<span class="op" id="4927023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4927027">f</span>&nbsp;<span class="op" id="4927029">=</span>&nbsp;<span class="op" id="4927031">[</span><span class="op" id="4927032">]</span><span class="ident" id="4927033">field</span><span class="op" id="4927038">{</span><span class="op" id="4927039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4927042">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4927046">fieldCache</span><span class="op" id="4927056">.</span><span class="ident" id="4927057">Lock</span><span class="op" id="4927061">(</span><span class="op" id="4927062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4927065">if</span>&nbsp;<span class="ident" id="4927068">fieldCache</span><span class="op" id="4927078">.</span><span class="ident" id="4927079">m</span>&nbsp;<span class="op" id="4927081">==</span>&nbsp;<span class="ident" id="4927084">nil</span>&nbsp;<span class="op" id="4927088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4927092">fieldCache</span><span class="op" id="4927102">.</span><span class="ident" id="4927103">m</span>&nbsp;<span class="op" id="4927105">=</span>&nbsp;<span class="keyword" id="4927107">map</span><span class="op" id="4927110">[</span><span class="ident" id="4927111">reflect</span><span class="op" id="4927118">.</span><span class="ident" id="4927119">Type</span><span class="op" id="4927123">]</span><span class="op" id="4927124">[</span><span class="op" id="4927125">]</span><span class="ident" id="4927126">field</span><span class="op" id="4927131">{</span><span class="op" id="4927132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4927135">}</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4927138">fieldCache</span><span class="op" id="4927148">.</span><span class="ident" id="4927149">m</span><span class="op" id="4927150">[</span><span class="ident" id="4927151">t</span><span class="op" id="4927152">]</span>&nbsp;<span class="op" id="4927154">=</span>&nbsp;<span class="ident" id="4927156">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4927159">fieldCache</span><span class="op" id="4927169">.</span><span class="ident" id="4927170">Unlock</span><span class="op" id="4927176">(</span><span class="op" id="4927177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4927180">return</span>&nbsp;<span class="ident" id="4927187">f</span><br>
<span class="lineno"></span><span class="op" id="4927189">}</span>
</div>
</body>
</html>
