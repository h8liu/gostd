<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5883970">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5884025">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5884079">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5884130">package</span>&nbsp;<span class="ident" id="5884138">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5884143">import</span>&nbsp;<span class="op" id="5884150">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5884153">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5884162">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5884181">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5884191">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5884199">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5884213">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5884219">&#34;os&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5884224">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5884227">var</span>&nbsp;<span class="op" id="5884231">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884234">ErrFormat</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5884247">=</span>&nbsp;<span class="ident" id="5884249">errors</span><span class="op" id="5884255">.</span><span class="ident" id="5884256">New</span><span class="op" id="5884259">(</span><span class="string" id="5884260">&#34;zip:&nbsp;not&nbsp;a&nbsp;valid&nbsp;zip&nbsp;file&#34;</span><span class="op" id="5884287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884290">ErrAlgorithm</span>&nbsp;<span class="op" id="5884303">=</span>&nbsp;<span class="ident" id="5884305">errors</span><span class="op" id="5884311">.</span><span class="ident" id="5884312">New</span><span class="op" id="5884315">(</span><span class="string" id="5884316">&#34;zip:&nbsp;unsupported&nbsp;compression&nbsp;algorithm&#34;</span><span class="op" id="5884356">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884359">ErrChecksum</span>&nbsp;&nbsp;<span class="op" id="5884372">=</span>&nbsp;<span class="ident" id="5884374">errors</span><span class="op" id="5884380">.</span><span class="ident" id="5884381">New</span><span class="op" id="5884384">(</span><span class="string" id="5884385">&#34;zip:&nbsp;checksum&nbsp;error&#34;</span><span class="op" id="5884406">)</span><br>
<span class="lineno"></span><span class="op" id="5884408">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5884411">type</span>&nbsp;<span class="ident" id="5884416">Reader</span>&nbsp;<span class="keyword" id="5884423">struct</span>&nbsp;<span class="op" id="5884430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884433">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5884441">io</span><span class="op" id="5884443">.</span><span class="ident" id="5884444">ReaderAt</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884454">File</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5884462">[</span><span class="op" id="5884463">]</span><span class="op" id="5884464">*</span><span class="ident" id="5884465">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884471">Comment</span>&nbsp;<span class="builtintype" id="5884479">string</span><br>
<span class="lineno"></span><span class="op" id="5884486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5884489">type</span>&nbsp;<span class="ident" id="5884494">ReadCloser</span>&nbsp;<span class="keyword" id="5884505">struct</span>&nbsp;<span class="op" id="5884512">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884515">f</span>&nbsp;<span class="op" id="5884517">*</span><span class="ident" id="5884518">os</span><span class="op" id="5884520">.</span><span class="ident" id="5884521">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884527">Reader</span><br>
<span class="lineno"></span><span class="op" id="5884534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5884537">type</span>&nbsp;<span class="ident" id="5884542">File</span>&nbsp;<span class="keyword" id="5884547">struct</span>&nbsp;<span class="op" id="5884554">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884557">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884569">zipr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5884582">io</span><span class="op" id="5884584">.</span><span class="ident" id="5884585">ReaderAt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884595">zipsize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5884608">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884615">headerOffset</span>&nbsp;<span class="ident" id="5884628">int64</span><br>
<span class="lineno"></span><span class="op" id="5884634">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5884637">func</span>&nbsp;<span class="op" id="5884642">(</span><span class="ident" id="5884643">f</span>&nbsp;<span class="op" id="5884645">*</span><span class="ident" id="5884646">File</span><span class="op" id="5884650">)</span>&nbsp;<span class="ident" id="5884652">hasDataDescriptor</span><span class="op" id="5884669">(</span><span class="op" id="5884670">)</span>&nbsp;<span class="builtintype" id="5884672">bool</span>&nbsp;<span class="op" id="5884677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5884680">return</span>&nbsp;<span class="ident" id="5884687">f</span><span class="op" id="5884688">.</span><span class="ident" id="5884689">Flags</span><span class="op" id="5884694">&amp;</span><span class="num" id="5884695">0x8</span>&nbsp;<span class="op" id="5884699">!=</span>&nbsp;<span class="num" id="5884702">0</span><br>
<span class="lineno"></span><span class="op" id="5884704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5884707">//&nbsp;OpenReader&nbsp;will&nbsp;open&nbsp;the&nbsp;Zip&nbsp;file&nbsp;specified&nbsp;by&nbsp;name&nbsp;and&nbsp;return&nbsp;a&nbsp;ReadCloser.</span><br>
<span class="lineno"></span><span class="keyword" id="5884787">func</span>&nbsp;<span class="ident" id="5884792">OpenReader</span><span class="op" id="5884802">(</span><span class="ident" id="5884803">name</span>&nbsp;<span class="builtintype" id="5884808">string</span><span class="op" id="5884814">)</span>&nbsp;<span class="op" id="5884816">(</span><span class="op" id="5884817">*</span><span class="ident" id="5884818">ReadCloser</span><span class="op" id="5884828">,</span>&nbsp;<span class="builtintype" id="5884830">error</span><span class="op" id="5884835">)</span>&nbsp;<span class="op" id="5884837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884840">f</span><span class="op" id="5884841">,</span>&nbsp;<span class="ident" id="5884843">err</span>&nbsp;<span class="op" id="5884847">:=</span>&nbsp;<span class="ident" id="5884850">os</span><span class="op" id="5884852">.</span><span class="ident" id="5884853">Open</span><span class="op" id="5884857">(</span><span class="ident" id="5884858">name</span><span class="op" id="5884862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5884865">if</span>&nbsp;<span class="ident" id="5884868">err</span>&nbsp;<span class="op" id="5884872">!=</span>&nbsp;<span class="ident" id="5884875">nil</span>&nbsp;<span class="op" id="5884879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5884883">return</span>&nbsp;<span class="ident" id="5884890">nil</span><span class="op" id="5884893">,</span>&nbsp;<span class="ident" id="5884895">err</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5884900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884903">fi</span><span class="op" id="5884905">,</span>&nbsp;<span class="ident" id="5884907">err</span>&nbsp;<span class="op" id="5884911">:=</span>&nbsp;<span class="ident" id="5884914">f</span><span class="op" id="5884915">.</span><span class="ident" id="5884916">Stat</span><span class="op" id="5884920">(</span><span class="op" id="5884921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5884924">if</span>&nbsp;<span class="ident" id="5884927">err</span>&nbsp;<span class="op" id="5884931">!=</span>&nbsp;<span class="ident" id="5884934">nil</span>&nbsp;<span class="op" id="5884938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884942">f</span><span class="op" id="5884943">.</span><span class="ident" id="5884944">Close</span><span class="op" id="5884949">(</span><span class="op" id="5884950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5884954">return</span>&nbsp;<span class="ident" id="5884961">nil</span><span class="op" id="5884964">,</span>&nbsp;<span class="ident" id="5884966">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5884971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5884974">r</span>&nbsp;<span class="op" id="5884976">:=</span>&nbsp;<span class="builtinfunc" id="5884979">new</span><span class="op" id="5884982">(</span><span class="ident" id="5884983">ReadCloser</span><span class="op" id="5884993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5884996">if</span>&nbsp;<span class="ident" id="5884999">err</span>&nbsp;<span class="op" id="5885003">:=</span>&nbsp;<span class="ident" id="5885006">r</span><span class="op" id="5885007">.</span><span class="ident" id="5885008">init</span><span class="op" id="5885012">(</span><span class="ident" id="5885013">f</span><span class="op" id="5885014">,</span>&nbsp;<span class="ident" id="5885016">fi</span><span class="op" id="5885018">.</span><span class="ident" id="5885019">Size</span><span class="op" id="5885023">(</span><span class="op" id="5885024">)</span><span class="op" id="5885025">)</span><span class="op" id="5885026">;</span>&nbsp;<span class="ident" id="5885028">err</span>&nbsp;<span class="op" id="5885032">!=</span>&nbsp;<span class="ident" id="5885035">nil</span>&nbsp;<span class="op" id="5885039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5885043">f</span><span class="op" id="5885044">.</span><span class="ident" id="5885045">Close</span><span class="op" id="5885050">(</span><span class="op" id="5885051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5885055">return</span>&nbsp;<span class="ident" id="5885062">nil</span><span class="op" id="5885065">,</span>&nbsp;<span class="ident" id="5885067">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5885072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5885075">r</span><span class="op" id="5885076">.</span><span class="ident" id="5885077">f</span>&nbsp;<span class="op" id="5885079">=</span>&nbsp;<span class="ident" id="5885081">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5885084">return</span>&nbsp;<span class="ident" id="5885091">r</span><span class="op" id="5885092">,</span>&nbsp;<span class="ident" id="5885094">nil</span><br>
<span class="lineno"></span><span class="op" id="5885098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="5885101">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r,&nbsp;which&nbsp;is&nbsp;assumed&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5885171">//&nbsp;have&nbsp;the&nbsp;given&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5885204">func</span>&nbsp;<span class="ident" id="5885209">NewReader</span><span class="op" id="5885218">(</span><span class="ident" id="5885219">r</span>&nbsp;<span class="ident" id="5885221">io</span><span class="op" id="5885223">.</span><span class="ident" id="5885224">ReaderAt</span><span class="op" id="5885232">,</span>&nbsp;<span class="ident" id="5885234">size</span>&nbsp;<span class="ident" id="5885239">int64</span><span class="op" id="5885244">)</span>&nbsp;<span class="op" id="5885246">(</span><span class="op" id="5885247">*</span><span class="ident" id="5885248">Reader</span><span class="op" id="5885254">,</span>&nbsp;<span class="builtintype" id="5885256">error</span><span class="op" id="5885261">)</span>&nbsp;<span class="op" id="5885263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5885266">zr</span>&nbsp;<span class="op" id="5885269">:=</span>&nbsp;<span class="builtinfunc" id="5885272">new</span><span class="op" id="5885275">(</span><span class="ident" id="5885276">Reader</span><span class="op" id="5885282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5885285">if</span>&nbsp;<span class="ident" id="5885288">err</span>&nbsp;<span class="op" id="5885292">:=</span>&nbsp;<span class="ident" id="5885295">zr</span><span class="op" id="5885297">.</span><span class="ident" id="5885298">init</span><span class="op" id="5885302">(</span><span class="ident" id="5885303">r</span><span class="op" id="5885304">,</span>&nbsp;<span class="ident" id="5885306">size</span><span class="op" id="5885310">)</span><span class="op" id="5885311">;</span>&nbsp;<span class="ident" id="5885313">err</span>&nbsp;<span class="op" id="5885317">!=</span>&nbsp;<span class="ident" id="5885320">nil</span>&nbsp;<span class="op" id="5885324">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5885328">return</span>&nbsp;<span class="ident" id="5885335">nil</span><span class="op" id="5885338">,</span>&nbsp;<span class="ident" id="5885340">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5885345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5885348">return</span>&nbsp;<span class="ident" id="5885355">zr</span><span class="op" id="5885357">,</span>&nbsp;<span class="ident" id="5885359">nil</span><br>
<span class="lineno"></span><span class="op" id="5885363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5885366">func</span>&nbsp;<span class="op" id="5885371">(</span><span class="ident" id="5885372">z</span>&nbsp;<span class="op" id="5885374">*</span><span class="ident" id="5885375">Reader</span><span class="op" id="5885381">)</span>&nbsp;<span class="ident" id="5885383">init</span><span class="op" id="5885387">(</span><span class="ident" id="5885388">r</span>&nbsp;<span class="ident" id="5885390">io</span><span class="op" id="5885392">.</span><span class="ident" id="5885393">ReaderAt</span><span class="op" id="5885401">,</span>&nbsp;<span class="ident" id="5885403">size</span>&nbsp;<span class="ident" id="5885408">int64</span><span class="op" id="5885413">)</span>&nbsp;<span class="builtintype" id="5885415">error</span>&nbsp;<span class="op" id="5885421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5885424">end</span><span class="op" id="5885427">,</span>&nbsp;<span class="ident" id="5885429">err</span>&nbsp;<span class="op" id="5885433">:=</span>&nbsp;<span class="ident" id="5885436">readDirectoryEnd</span><span class="op" id="5885452">(</span><span class="ident" id="5885453">r</span><span class="op" id="5885454">,</span>&nbsp;<span class="ident" id="5885456">size</span><span class="op" id="5885460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5885463">if</span>&nbsp;<span class="ident" id="5885466">err</span>&nbsp;<span class="op" id="5885470">!=</span>&nbsp;<span class="ident" id="5885473">nil</span>&nbsp;<span class="op" id="5885477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5885481">return</span>&nbsp;<span class="ident" id="5885488">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5885493">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5885496">z</span><span class="op" id="5885497">.</span><span class="ident" id="5885498">r</span>&nbsp;<span class="op" id="5885500">=</span>&nbsp;<span class="ident" id="5885502">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5885505">z</span><span class="op" id="5885506">.</span><span class="ident" id="5885507">File</span>&nbsp;<span class="op" id="5885512">=</span>&nbsp;<span class="builtinfunc" id="5885514">make</span><span class="op" id="5885518">(</span><span class="op" id="5885519">[</span><span class="op" id="5885520">]</span><span class="op" id="5885521">*</span><span class="ident" id="5885522">File</span><span class="op" id="5885526">,</span>&nbsp;<span class="num" id="5885528">0</span><span class="op" id="5885529">,</span>&nbsp;<span class="ident" id="5885531">end</span><span class="op" id="5885534">.</span><span class="ident" id="5885535">directoryRecords</span><span class="op" id="5885551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5885554">z</span><span class="op" id="5885555">.</span><span class="ident" id="5885556">Comment</span>&nbsp;<span class="op" id="5885564">=</span>&nbsp;<span class="ident" id="5885566">end</span><span class="op" id="5885569">.</span><span class="ident" id="5885570">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5885579">rs</span>&nbsp;<span class="op" id="5885582">:=</span>&nbsp;<span class="ident" id="5885585">io</span><span class="op" id="5885587">.</span><span class="ident" id="5885588">NewSectionReader</span><span class="op" id="5885604">(</span><span class="ident" id="5885605">r</span><span class="op" id="5885606">,</span>&nbsp;<span class="num" id="5885608">0</span><span class="op" id="5885609">,</span>&nbsp;<span class="ident" id="5885611">size</span><span class="op" id="5885615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5885618">if</span>&nbsp;<span class="ident" id="5885621">_</span><span class="op" id="5885622">,</span>&nbsp;<span class="ident" id="5885624">err</span>&nbsp;<span class="op" id="5885628">=</span>&nbsp;<span class="ident" id="5885630">rs</span><span class="op" id="5885632">.</span><span class="ident" id="5885633">Seek</span><span class="op" id="5885637">(</span><span class="ident" id="5885638">int64</span><span class="op" id="5885643">(</span><span class="ident" id="5885644">end</span><span class="op" id="5885647">.</span><span class="ident" id="5885648">directoryOffset</span><span class="op" id="5885663">)</span><span class="op" id="5885664">,</span>&nbsp;<span class="ident" id="5885666">os</span><span class="op" id="5885668">.</span><span class="ident" id="5885669">SEEK_SET</span><span class="op" id="5885677">)</span><span class="op" id="5885678">;</span>&nbsp;<span class="ident" id="5885680">err</span>&nbsp;<span class="op" id="5885684">!=</span>&nbsp;<span class="ident" id="5885687">nil</span>&nbsp;<span class="op" id="5885691">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5885695">return</span>&nbsp;<span class="ident" id="5885702">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5885707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5885710">buf</span>&nbsp;<span class="op" id="5885714">:=</span>&nbsp;<span class="ident" id="5885717">bufio</span><span class="op" id="5885722">.</span><span class="ident" id="5885723">NewReader</span><span class="op" id="5885732">(</span><span class="ident" id="5885733">rs</span><span class="op" id="5885735">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5885739">//&nbsp;The&nbsp;count&nbsp;of&nbsp;files&nbsp;inside&nbsp;a&nbsp;zip&nbsp;is&nbsp;truncated&nbsp;to&nbsp;fit&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5885808">//&nbsp;Gloss&nbsp;over&nbsp;this&nbsp;by&nbsp;reading&nbsp;headers&nbsp;until&nbsp;we&nbsp;encounter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5885866">//&nbsp;a&nbsp;bad&nbsp;one,&nbsp;and&nbsp;then&nbsp;only&nbsp;report&nbsp;a&nbsp;ErrFormat&nbsp;or&nbsp;UnexpectedEOF&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5885934">//&nbsp;the&nbsp;file&nbsp;count&nbsp;modulo&nbsp;65536&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5885980">for</span>&nbsp;<span class="op" id="5885984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5885988">f</span>&nbsp;<span class="op" id="5885990">:=</span>&nbsp;<span class="op" id="5885993">&amp;</span><span class="ident" id="5885994">File</span><span class="op" id="5885998">{</span><span class="ident" id="5885999">zipr</span><span class="op" id="5886003">:</span>&nbsp;<span class="ident" id="5886005">r</span><span class="op" id="5886006">,</span>&nbsp;<span class="ident" id="5886008">zipsize</span><span class="op" id="5886015">:</span>&nbsp;<span class="ident" id="5886017">size</span><span class="op" id="5886021">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5886025">err</span>&nbsp;<span class="op" id="5886029">=</span>&nbsp;<span class="ident" id="5886031">readDirectoryHeader</span><span class="op" id="5886050">(</span><span class="ident" id="5886051">f</span><span class="op" id="5886052">,</span>&nbsp;<span class="ident" id="5886054">buf</span><span class="op" id="5886057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5886061">if</span>&nbsp;<span class="ident" id="5886064">err</span>&nbsp;<span class="op" id="5886068">==</span>&nbsp;<span class="ident" id="5886071">ErrFormat</span>&nbsp;<span class="op" id="5886081">||</span>&nbsp;<span class="ident" id="5886084">err</span>&nbsp;<span class="op" id="5886088">==</span>&nbsp;<span class="ident" id="5886091">io</span><span class="op" id="5886093">.</span><span class="ident" id="5886094">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="5886111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5886116">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5886124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5886128">if</span>&nbsp;<span class="ident" id="5886131">err</span>&nbsp;<span class="op" id="5886135">!=</span>&nbsp;<span class="ident" id="5886138">nil</span>&nbsp;<span class="op" id="5886142">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5886147">return</span>&nbsp;<span class="ident" id="5886154">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5886160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5886164">z</span><span class="op" id="5886165">.</span><span class="ident" id="5886166">File</span>&nbsp;<span class="op" id="5886171">=</span>&nbsp;<span class="builtinfunc" id="5886173">append</span><span class="op" id="5886179">(</span><span class="ident" id="5886180">z</span><span class="op" id="5886181">.</span><span class="ident" id="5886182">File</span><span class="op" id="5886186">,</span>&nbsp;<span class="ident" id="5886188">f</span><span class="op" id="5886189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5886192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5886195">if</span>&nbsp;<span class="builtintype" id="5886198">uint16</span><span class="op" id="5886204">(</span><span class="builtinfunc" id="5886205">len</span><span class="op" id="5886208">(</span><span class="ident" id="5886209">z</span><span class="op" id="5886210">.</span><span class="ident" id="5886211">File</span><span class="op" id="5886215">)</span><span class="op" id="5886216">)</span>&nbsp;<span class="op" id="5886218">!=</span>&nbsp;<span class="builtintype" id="5886221">uint16</span><span class="op" id="5886227">(</span><span class="ident" id="5886228">end</span><span class="op" id="5886231">.</span><span class="ident" id="5886232">directoryRecords</span><span class="op" id="5886248">)</span>&nbsp;<span class="op" id="5886250">{</span>&nbsp;<span class="comment" id="5886252">//&nbsp;only&nbsp;compare&nbsp;16&nbsp;bits&nbsp;here</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5886283">//&nbsp;Return&nbsp;the&nbsp;readDirectoryHeader&nbsp;error&nbsp;if&nbsp;we&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5886336">//&nbsp;the&nbsp;wrong&nbsp;number&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5886380">return</span>&nbsp;<span class="ident" id="5886387">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5886392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5886395">return</span>&nbsp;<span class="ident" id="5886402">nil</span><br>
<span class="lineno">110</span><span class="op" id="5886406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5886409">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Zip&nbsp;file,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="5886470">func</span>&nbsp;<span class="op" id="5886475">(</span><span class="ident" id="5886476">rc</span>&nbsp;<span class="op" id="5886479">*</span><span class="ident" id="5886480">ReadCloser</span><span class="op" id="5886490">)</span>&nbsp;<span class="ident" id="5886492">Close</span><span class="op" id="5886497">(</span><span class="op" id="5886498">)</span>&nbsp;<span class="builtintype" id="5886500">error</span>&nbsp;<span class="op" id="5886506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5886509">return</span>&nbsp;<span class="ident" id="5886516">rc</span><span class="op" id="5886518">.</span><span class="ident" id="5886519">f</span><span class="op" id="5886520">.</span><span class="ident" id="5886521">Close</span><span class="op" id="5886526">(</span><span class="op" id="5886527">)</span><br>
<span class="lineno">115</span><span class="op" id="5886529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5886532">//&nbsp;DataOffset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;file&#39;s&nbsp;possibly-compressed</span><br>
<span class="lineno"></span><span class="comment" id="5886599">//&nbsp;data,&nbsp;relative&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5886651">//</span><br>
<span class="lineno">120</span><span class="comment" id="5886654">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;instead&nbsp;use&nbsp;Open,&nbsp;which&nbsp;transparently</span><br>
<span class="lineno"></span><span class="comment" id="5886715">//&nbsp;decompresses&nbsp;data&nbsp;and&nbsp;verifies&nbsp;checksums.</span><br>
<span class="lineno"></span><span class="keyword" id="5886760">func</span>&nbsp;<span class="op" id="5886765">(</span><span class="ident" id="5886766">f</span>&nbsp;<span class="op" id="5886768">*</span><span class="ident" id="5886769">File</span><span class="op" id="5886773">)</span>&nbsp;<span class="ident" id="5886775">DataOffset</span><span class="op" id="5886785">(</span><span class="op" id="5886786">)</span>&nbsp;<span class="op" id="5886788">(</span><span class="ident" id="5886789">offset</span>&nbsp;<span class="ident" id="5886796">int64</span><span class="op" id="5886801">,</span>&nbsp;<span class="ident" id="5886803">err</span>&nbsp;<span class="builtintype" id="5886807">error</span><span class="op" id="5886812">)</span>&nbsp;<span class="op" id="5886814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5886817">bodyOffset</span><span class="op" id="5886827">,</span>&nbsp;<span class="ident" id="5886829">err</span>&nbsp;<span class="op" id="5886833">:=</span>&nbsp;<span class="ident" id="5886836">f</span><span class="op" id="5886837">.</span><span class="ident" id="5886838">findBodyOffset</span><span class="op" id="5886852">(</span><span class="op" id="5886853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5886856">if</span>&nbsp;<span class="ident" id="5886859">err</span>&nbsp;<span class="op" id="5886863">!=</span>&nbsp;<span class="ident" id="5886866">nil</span>&nbsp;<span class="op" id="5886870">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5886874">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5886882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5886885">return</span>&nbsp;<span class="ident" id="5886892">f</span><span class="op" id="5886893">.</span><span class="ident" id="5886894">headerOffset</span>&nbsp;<span class="op" id="5886907">+</span>&nbsp;<span class="ident" id="5886909">bodyOffset</span><span class="op" id="5886919">,</span>&nbsp;<span class="ident" id="5886921">nil</span><br>
<span class="lineno"></span><span class="op" id="5886925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5886928">//&nbsp;Open&nbsp;returns&nbsp;a&nbsp;ReadCloser&nbsp;that&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;File&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="5887002">//&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;be&nbsp;read&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="keyword" id="5887046">func</span>&nbsp;<span class="op" id="5887051">(</span><span class="ident" id="5887052">f</span>&nbsp;<span class="op" id="5887054">*</span><span class="ident" id="5887055">File</span><span class="op" id="5887059">)</span>&nbsp;<span class="ident" id="5887061">Open</span><span class="op" id="5887065">(</span><span class="op" id="5887066">)</span>&nbsp;<span class="op" id="5887068">(</span><span class="ident" id="5887069">rc</span>&nbsp;<span class="ident" id="5887072">io</span><span class="op" id="5887074">.</span><span class="ident" id="5887075">ReadCloser</span><span class="op" id="5887085">,</span>&nbsp;<span class="ident" id="5887087">err</span>&nbsp;<span class="builtintype" id="5887091">error</span><span class="op" id="5887096">)</span>&nbsp;<span class="op" id="5887098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887101">bodyOffset</span><span class="op" id="5887111">,</span>&nbsp;<span class="ident" id="5887113">err</span>&nbsp;<span class="op" id="5887117">:=</span>&nbsp;<span class="ident" id="5887120">f</span><span class="op" id="5887121">.</span><span class="ident" id="5887122">findBodyOffset</span><span class="op" id="5887136">(</span><span class="op" id="5887137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5887140">if</span>&nbsp;<span class="ident" id="5887143">err</span>&nbsp;<span class="op" id="5887147">!=</span>&nbsp;<span class="ident" id="5887150">nil</span>&nbsp;<span class="op" id="5887154">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5887158">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5887166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887169">size</span>&nbsp;<span class="op" id="5887174">:=</span>&nbsp;<span class="ident" id="5887177">int64</span><span class="op" id="5887182">(</span><span class="ident" id="5887183">f</span><span class="op" id="5887184">.</span><span class="ident" id="5887185">CompressedSize64</span><span class="op" id="5887201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887204">r</span>&nbsp;<span class="op" id="5887206">:=</span>&nbsp;<span class="ident" id="5887209">io</span><span class="op" id="5887211">.</span><span class="ident" id="5887212">NewSectionReader</span><span class="op" id="5887228">(</span><span class="ident" id="5887229">f</span><span class="op" id="5887230">.</span><span class="ident" id="5887231">zipr</span><span class="op" id="5887235">,</span>&nbsp;<span class="ident" id="5887237">f</span><span class="op" id="5887238">.</span><span class="ident" id="5887239">headerOffset</span><span class="op" id="5887251">+</span><span class="ident" id="5887252">bodyOffset</span><span class="op" id="5887262">,</span>&nbsp;<span class="ident" id="5887264">size</span><span class="op" id="5887268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887271">dcomp</span>&nbsp;<span class="op" id="5887277">:=</span>&nbsp;<span class="ident" id="5887280">decompressor</span><span class="op" id="5887292">(</span><span class="ident" id="5887293">f</span><span class="op" id="5887294">.</span><span class="ident" id="5887295">Method</span><span class="op" id="5887301">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5887304">if</span>&nbsp;<span class="ident" id="5887307">dcomp</span>&nbsp;<span class="op" id="5887313">==</span>&nbsp;<span class="ident" id="5887316">nil</span>&nbsp;<span class="op" id="5887320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887324">err</span>&nbsp;<span class="op" id="5887328">=</span>&nbsp;<span class="ident" id="5887330">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5887345">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5887353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887356">rc</span>&nbsp;<span class="op" id="5887359">=</span>&nbsp;<span class="ident" id="5887361">dcomp</span><span class="op" id="5887366">(</span><span class="ident" id="5887367">r</span><span class="op" id="5887368">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5887371">var</span>&nbsp;<span class="ident" id="5887375">desr</span>&nbsp;<span class="ident" id="5887380">io</span><span class="op" id="5887382">.</span><span class="ident" id="5887383">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5887391">if</span>&nbsp;<span class="ident" id="5887394">f</span><span class="op" id="5887395">.</span><span class="ident" id="5887396">hasDataDescriptor</span><span class="op" id="5887413">(</span><span class="op" id="5887414">)</span>&nbsp;<span class="op" id="5887416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887420">desr</span>&nbsp;<span class="op" id="5887425">=</span>&nbsp;<span class="ident" id="5887427">io</span><span class="op" id="5887429">.</span><span class="ident" id="5887430">NewSectionReader</span><span class="op" id="5887446">(</span><span class="ident" id="5887447">f</span><span class="op" id="5887448">.</span><span class="ident" id="5887449">zipr</span><span class="op" id="5887453">,</span>&nbsp;<span class="ident" id="5887455">f</span><span class="op" id="5887456">.</span><span class="ident" id="5887457">headerOffset</span><span class="op" id="5887469">+</span><span class="ident" id="5887470">bodyOffset</span><span class="op" id="5887480">+</span><span class="ident" id="5887481">size</span><span class="op" id="5887485">,</span>&nbsp;<span class="ident" id="5887487">dataDescriptorLen</span><span class="op" id="5887504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5887507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887510">rc</span>&nbsp;<span class="op" id="5887513">=</span>&nbsp;<span class="op" id="5887515">&amp;</span><span class="ident" id="5887516">checksumReader</span><span class="op" id="5887530">{</span><span class="ident" id="5887531">rc</span><span class="op" id="5887533">,</span>&nbsp;<span class="ident" id="5887535">crc32</span><span class="op" id="5887540">.</span><span class="ident" id="5887541">NewIEEE</span><span class="op" id="5887548">(</span><span class="op" id="5887549">)</span><span class="op" id="5887550">,</span>&nbsp;<span class="ident" id="5887552">f</span><span class="op" id="5887553">,</span>&nbsp;<span class="ident" id="5887555">desr</span><span class="op" id="5887559">,</span>&nbsp;<span class="ident" id="5887561">nil</span><span class="op" id="5887564">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5887567">return</span><br>
<span class="lineno"></span><span class="op" id="5887574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5887577">type</span>&nbsp;<span class="ident" id="5887582">checksumReader</span>&nbsp;<span class="keyword" id="5887597">struct</span>&nbsp;<span class="op" id="5887604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887607">rc</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5887612">io</span><span class="op" id="5887614">.</span><span class="ident" id="5887615">ReadCloser</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887627">hash</span>&nbsp;<span class="ident" id="5887632">hash</span><span class="op" id="5887636">.</span><span class="ident" id="5887637">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887645">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5887650">*</span><span class="ident" id="5887651">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887657">desr</span>&nbsp;<span class="ident" id="5887662">io</span><span class="op" id="5887664">.</span><span class="ident" id="5887665">Reader</span>&nbsp;<span class="comment" id="5887672">//&nbsp;if&nbsp;non-nil,&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887722">err</span>&nbsp;&nbsp;<span class="builtintype" id="5887727">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5887737">//&nbsp;sticky&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="5887753">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="5887756">func</span>&nbsp;<span class="op" id="5887761">(</span><span class="ident" id="5887762">r</span>&nbsp;<span class="op" id="5887764">*</span><span class="ident" id="5887765">checksumReader</span><span class="op" id="5887779">)</span>&nbsp;<span class="ident" id="5887781">Read</span><span class="op" id="5887785">(</span><span class="ident" id="5887786">b</span>&nbsp;<span class="op" id="5887788">[</span><span class="op" id="5887789">]</span><span class="builtintype" id="5887790">byte</span><span class="op" id="5887794">)</span>&nbsp;<span class="op" id="5887796">(</span><span class="ident" id="5887797">n</span>&nbsp;<span class="builtintype" id="5887799">int</span><span class="op" id="5887802">,</span>&nbsp;<span class="ident" id="5887804">err</span>&nbsp;<span class="builtintype" id="5887808">error</span><span class="op" id="5887813">)</span>&nbsp;<span class="op" id="5887815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5887818">if</span>&nbsp;<span class="ident" id="5887821">r</span><span class="op" id="5887822">.</span><span class="ident" id="5887823">err</span>&nbsp;<span class="op" id="5887827">!=</span>&nbsp;<span class="ident" id="5887830">nil</span>&nbsp;<span class="op" id="5887834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5887838">return</span>&nbsp;<span class="num" id="5887845">0</span><span class="op" id="5887846">,</span>&nbsp;<span class="ident" id="5887848">r</span><span class="op" id="5887849">.</span><span class="ident" id="5887850">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5887855">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887858">n</span><span class="op" id="5887859">,</span>&nbsp;<span class="ident" id="5887861">err</span>&nbsp;<span class="op" id="5887865">=</span>&nbsp;<span class="ident" id="5887867">r</span><span class="op" id="5887868">.</span><span class="ident" id="5887869">rc</span><span class="op" id="5887871">.</span><span class="ident" id="5887872">Read</span><span class="op" id="5887876">(</span><span class="ident" id="5887877">b</span><span class="op" id="5887878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5887881">r</span><span class="op" id="5887882">.</span><span class="ident" id="5887883">hash</span><span class="op" id="5887887">.</span><span class="ident" id="5887888">Write</span><span class="op" id="5887893">(</span><span class="ident" id="5887894">b</span><span class="op" id="5887895">[</span><span class="op" id="5887896">:</span><span class="ident" id="5887897">n</span><span class="op" id="5887898">]</span><span class="op" id="5887899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5887902">if</span>&nbsp;<span class="ident" id="5887905">err</span>&nbsp;<span class="op" id="5887909">==</span>&nbsp;<span class="ident" id="5887912">nil</span>&nbsp;<span class="op" id="5887916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5887920">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5887928">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5887931">if</span>&nbsp;<span class="ident" id="5887934">err</span>&nbsp;<span class="op" id="5887938">==</span>&nbsp;<span class="ident" id="5887941">io</span><span class="op" id="5887943">.</span><span class="ident" id="5887944">EOF</span>&nbsp;<span class="op" id="5887948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5887952">if</span>&nbsp;<span class="ident" id="5887955">r</span><span class="op" id="5887956">.</span><span class="ident" id="5887957">desr</span>&nbsp;<span class="op" id="5887962">!=</span>&nbsp;<span class="ident" id="5887965">nil</span>&nbsp;<span class="op" id="5887969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5887974">if</span>&nbsp;<span class="ident" id="5887977">err1</span>&nbsp;<span class="op" id="5887982">:=</span>&nbsp;<span class="ident" id="5887985">readDataDescriptor</span><span class="op" id="5888003">(</span><span class="ident" id="5888004">r</span><span class="op" id="5888005">.</span><span class="ident" id="5888006">desr</span><span class="op" id="5888010">,</span>&nbsp;<span class="ident" id="5888012">r</span><span class="op" id="5888013">.</span><span class="ident" id="5888014">f</span><span class="op" id="5888015">)</span><span class="op" id="5888016">;</span>&nbsp;<span class="ident" id="5888018">err1</span>&nbsp;<span class="op" id="5888023">!=</span>&nbsp;<span class="ident" id="5888026">nil</span>&nbsp;<span class="op" id="5888030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888036">err</span>&nbsp;<span class="op" id="5888040">=</span>&nbsp;<span class="ident" id="5888042">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5888050">}</span>&nbsp;<span class="keyword" id="5888052">else</span>&nbsp;<span class="keyword" id="5888057">if</span>&nbsp;<span class="ident" id="5888060">r</span><span class="op" id="5888061">.</span><span class="ident" id="5888062">hash</span><span class="op" id="5888066">.</span><span class="ident" id="5888067">Sum32</span><span class="op" id="5888072">(</span><span class="op" id="5888073">)</span>&nbsp;<span class="op" id="5888075">!=</span>&nbsp;<span class="ident" id="5888078">r</span><span class="op" id="5888079">.</span><span class="ident" id="5888080">f</span><span class="op" id="5888081">.</span><span class="ident" id="5888082">CRC32</span>&nbsp;<span class="op" id="5888088">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888094">err</span>&nbsp;<span class="op" id="5888098">=</span>&nbsp;<span class="ident" id="5888100">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5888115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5888119">}</span>&nbsp;<span class="keyword" id="5888121">else</span>&nbsp;<span class="op" id="5888126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5888131">//&nbsp;If&nbsp;there&#39;s&nbsp;not&nbsp;a&nbsp;data&nbsp;descriptor,&nbsp;we&nbsp;still&nbsp;compare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5888188">//&nbsp;the&nbsp;CRC32&nbsp;of&nbsp;what&nbsp;we&#39;ve&nbsp;read&nbsp;against&nbsp;the&nbsp;file&nbsp;header</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5888247">//&nbsp;or&nbsp;TOC&#39;s&nbsp;CRC32,&nbsp;if&nbsp;it&nbsp;seems&nbsp;like&nbsp;it&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5888298">if</span>&nbsp;<span class="ident" id="5888301">r</span><span class="op" id="5888302">.</span><span class="ident" id="5888303">f</span><span class="op" id="5888304">.</span><span class="ident" id="5888305">CRC32</span>&nbsp;<span class="op" id="5888311">!=</span>&nbsp;<span class="num" id="5888314">0</span>&nbsp;<span class="op" id="5888316">&amp;&amp;</span>&nbsp;<span class="ident" id="5888319">r</span><span class="op" id="5888320">.</span><span class="ident" id="5888321">hash</span><span class="op" id="5888325">.</span><span class="ident" id="5888326">Sum32</span><span class="op" id="5888331">(</span><span class="op" id="5888332">)</span>&nbsp;<span class="op" id="5888334">!=</span>&nbsp;<span class="ident" id="5888337">r</span><span class="op" id="5888338">.</span><span class="ident" id="5888339">f</span><span class="op" id="5888340">.</span><span class="ident" id="5888341">CRC32</span>&nbsp;<span class="op" id="5888347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888353">err</span>&nbsp;<span class="op" id="5888357">=</span>&nbsp;<span class="ident" id="5888359">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5888374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5888378">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5888381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888384">r</span><span class="op" id="5888385">.</span><span class="ident" id="5888386">err</span>&nbsp;<span class="op" id="5888390">=</span>&nbsp;<span class="ident" id="5888392">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5888397">return</span><br>
<span class="lineno"></span><span class="op" id="5888404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="5888407">func</span>&nbsp;<span class="op" id="5888412">(</span><span class="ident" id="5888413">r</span>&nbsp;<span class="op" id="5888415">*</span><span class="ident" id="5888416">checksumReader</span><span class="op" id="5888430">)</span>&nbsp;<span class="ident" id="5888432">Close</span><span class="op" id="5888437">(</span><span class="op" id="5888438">)</span>&nbsp;<span class="builtintype" id="5888440">error</span>&nbsp;<span class="op" id="5888446">{</span>&nbsp;<span class="keyword" id="5888448">return</span>&nbsp;<span class="ident" id="5888455">r</span><span class="op" id="5888456">.</span><span class="ident" id="5888457">rc</span><span class="op" id="5888459">.</span><span class="ident" id="5888460">Close</span><span class="op" id="5888465">(</span><span class="op" id="5888466">)</span>&nbsp;<span class="op" id="5888468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5888471">//&nbsp;findBodyOffset&nbsp;does&nbsp;the&nbsp;minimum&nbsp;work&nbsp;to&nbsp;verify&nbsp;the&nbsp;file&nbsp;has&nbsp;a&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5888543">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;file&nbsp;body&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="5888580">func</span>&nbsp;<span class="op" id="5888585">(</span><span class="ident" id="5888586">f</span>&nbsp;<span class="op" id="5888588">*</span><span class="ident" id="5888589">File</span><span class="op" id="5888593">)</span>&nbsp;<span class="ident" id="5888595">findBodyOffset</span><span class="op" id="5888609">(</span><span class="op" id="5888610">)</span>&nbsp;<span class="op" id="5888612">(</span><span class="ident" id="5888613">int64</span><span class="op" id="5888618">,</span>&nbsp;<span class="builtintype" id="5888620">error</span><span class="op" id="5888625">)</span>&nbsp;<span class="op" id="5888627">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5888630">var</span>&nbsp;<span class="ident" id="5888634">buf</span>&nbsp;<span class="op" id="5888638">[</span><span class="ident" id="5888639">fileHeaderLen</span><span class="op" id="5888652">]</span><span class="builtintype" id="5888653">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5888659">if</span>&nbsp;<span class="ident" id="5888662">_</span><span class="op" id="5888663">,</span>&nbsp;<span class="ident" id="5888665">err</span>&nbsp;<span class="op" id="5888669">:=</span>&nbsp;<span class="ident" id="5888672">f</span><span class="op" id="5888673">.</span><span class="ident" id="5888674">zipr</span><span class="op" id="5888678">.</span><span class="ident" id="5888679">ReadAt</span><span class="op" id="5888685">(</span><span class="ident" id="5888686">buf</span><span class="op" id="5888689">[</span><span class="op" id="5888690">:</span><span class="op" id="5888691">]</span><span class="op" id="5888692">,</span>&nbsp;<span class="ident" id="5888694">f</span><span class="op" id="5888695">.</span><span class="ident" id="5888696">headerOffset</span><span class="op" id="5888708">)</span><span class="op" id="5888709">;</span>&nbsp;<span class="ident" id="5888711">err</span>&nbsp;<span class="op" id="5888715">!=</span>&nbsp;<span class="ident" id="5888718">nil</span>&nbsp;<span class="op" id="5888722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5888726">return</span>&nbsp;<span class="num" id="5888733">0</span><span class="op" id="5888734">,</span>&nbsp;<span class="ident" id="5888736">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5888741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888744">b</span>&nbsp;<span class="op" id="5888746">:=</span>&nbsp;<span class="ident" id="5888749">readBuf</span><span class="op" id="5888756">(</span><span class="ident" id="5888757">buf</span><span class="op" id="5888760">[</span><span class="op" id="5888761">:</span><span class="op" id="5888762">]</span><span class="op" id="5888763">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5888766">if</span>&nbsp;<span class="ident" id="5888769">sig</span>&nbsp;<span class="op" id="5888773">:=</span>&nbsp;<span class="ident" id="5888776">b</span><span class="op" id="5888777">.</span><span class="builtintype" id="5888778">uint32</span><span class="op" id="5888784">(</span><span class="op" id="5888785">)</span><span class="op" id="5888786">;</span>&nbsp;<span class="ident" id="5888788">sig</span>&nbsp;<span class="op" id="5888792">!=</span>&nbsp;<span class="ident" id="5888795">fileHeaderSignature</span>&nbsp;<span class="op" id="5888815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5888819">return</span>&nbsp;<span class="num" id="5888826">0</span><span class="op" id="5888827">,</span>&nbsp;<span class="ident" id="5888829">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5888840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888843">b</span>&nbsp;<span class="op" id="5888845">=</span>&nbsp;<span class="ident" id="5888847">b</span><span class="op" id="5888848">[</span><span class="num" id="5888849">22</span><span class="op" id="5888851">:</span><span class="op" id="5888852">]</span>&nbsp;<span class="comment" id="5888854">//&nbsp;skip&nbsp;over&nbsp;most&nbsp;of&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888887">filenameLen</span>&nbsp;<span class="op" id="5888899">:=</span>&nbsp;<span class="builtintype" id="5888902">int</span><span class="op" id="5888905">(</span><span class="ident" id="5888906">b</span><span class="op" id="5888907">.</span><span class="builtintype" id="5888908">uint16</span><span class="op" id="5888914">(</span><span class="op" id="5888915">)</span><span class="op" id="5888916">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5888919">extraLen</span>&nbsp;<span class="op" id="5888928">:=</span>&nbsp;<span class="builtintype" id="5888931">int</span><span class="op" id="5888934">(</span><span class="ident" id="5888935">b</span><span class="op" id="5888936">.</span><span class="builtintype" id="5888937">uint16</span><span class="op" id="5888943">(</span><span class="op" id="5888944">)</span><span class="op" id="5888945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5888948">return</span>&nbsp;<span class="ident" id="5888955">int64</span><span class="op" id="5888960">(</span><span class="ident" id="5888961">fileHeaderLen</span>&nbsp;<span class="op" id="5888975">+</span>&nbsp;<span class="ident" id="5888977">filenameLen</span>&nbsp;<span class="op" id="5888989">+</span>&nbsp;<span class="ident" id="5888991">extraLen</span><span class="op" id="5888999">)</span><span class="op" id="5889000">,</span>&nbsp;<span class="ident" id="5889002">nil</span><br>
<span class="lineno"></span><span class="op" id="5889006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5889009">//&nbsp;readDirectoryHeader&nbsp;attempts&nbsp;to&nbsp;read&nbsp;a&nbsp;directory&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno">210</span><span class="comment" id="5889076">//&nbsp;It&nbsp;returns&nbsp;io.ErrUnexpectedEOF&nbsp;if&nbsp;it&nbsp;cannot&nbsp;read&nbsp;a&nbsp;complete&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="5889147">//&nbsp;and&nbsp;ErrFormat&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;find&nbsp;a&nbsp;valid&nbsp;header&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="5889209">func</span>&nbsp;<span class="ident" id="5889214">readDirectoryHeader</span><span class="op" id="5889233">(</span><span class="ident" id="5889234">f</span>&nbsp;<span class="op" id="5889236">*</span><span class="ident" id="5889237">File</span><span class="op" id="5889241">,</span>&nbsp;<span class="ident" id="5889243">r</span>&nbsp;<span class="ident" id="5889245">io</span><span class="op" id="5889247">.</span><span class="ident" id="5889248">Reader</span><span class="op" id="5889254">)</span>&nbsp;<span class="builtintype" id="5889256">error</span>&nbsp;<span class="op" id="5889262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5889265">var</span>&nbsp;<span class="ident" id="5889269">buf</span>&nbsp;<span class="op" id="5889273">[</span><span class="ident" id="5889274">directoryHeaderLen</span><span class="op" id="5889292">]</span><span class="builtintype" id="5889293">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5889299">if</span>&nbsp;<span class="ident" id="5889302">_</span><span class="op" id="5889303">,</span>&nbsp;<span class="ident" id="5889305">err</span>&nbsp;<span class="op" id="5889309">:=</span>&nbsp;<span class="ident" id="5889312">io</span><span class="op" id="5889314">.</span><span class="ident" id="5889315">ReadFull</span><span class="op" id="5889323">(</span><span class="ident" id="5889324">r</span><span class="op" id="5889325">,</span>&nbsp;<span class="ident" id="5889327">buf</span><span class="op" id="5889330">[</span><span class="op" id="5889331">:</span><span class="op" id="5889332">]</span><span class="op" id="5889333">)</span><span class="op" id="5889334">;</span>&nbsp;<span class="ident" id="5889336">err</span>&nbsp;<span class="op" id="5889340">!=</span>&nbsp;<span class="ident" id="5889343">nil</span>&nbsp;<span class="op" id="5889347">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5889351">return</span>&nbsp;<span class="ident" id="5889358">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5889363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889366">b</span>&nbsp;<span class="op" id="5889368">:=</span>&nbsp;<span class="ident" id="5889371">readBuf</span><span class="op" id="5889378">(</span><span class="ident" id="5889379">buf</span><span class="op" id="5889382">[</span><span class="op" id="5889383">:</span><span class="op" id="5889384">]</span><span class="op" id="5889385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5889388">if</span>&nbsp;<span class="ident" id="5889391">sig</span>&nbsp;<span class="op" id="5889395">:=</span>&nbsp;<span class="ident" id="5889398">b</span><span class="op" id="5889399">.</span><span class="builtintype" id="5889400">uint32</span><span class="op" id="5889406">(</span><span class="op" id="5889407">)</span><span class="op" id="5889408">;</span>&nbsp;<span class="ident" id="5889410">sig</span>&nbsp;<span class="op" id="5889414">!=</span>&nbsp;<span class="ident" id="5889417">directoryHeaderSignature</span>&nbsp;<span class="op" id="5889442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5889446">return</span>&nbsp;<span class="ident" id="5889453">ErrFormat</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5889464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889467">f</span><span class="op" id="5889468">.</span><span class="ident" id="5889469">CreatorVersion</span>&nbsp;<span class="op" id="5889484">=</span>&nbsp;<span class="ident" id="5889486">b</span><span class="op" id="5889487">.</span><span class="builtintype" id="5889488">uint16</span><span class="op" id="5889494">(</span><span class="op" id="5889495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889498">f</span><span class="op" id="5889499">.</span><span class="ident" id="5889500">ReaderVersion</span>&nbsp;<span class="op" id="5889514">=</span>&nbsp;<span class="ident" id="5889516">b</span><span class="op" id="5889517">.</span><span class="builtintype" id="5889518">uint16</span><span class="op" id="5889524">(</span><span class="op" id="5889525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889528">f</span><span class="op" id="5889529">.</span><span class="ident" id="5889530">Flags</span>&nbsp;<span class="op" id="5889536">=</span>&nbsp;<span class="ident" id="5889538">b</span><span class="op" id="5889539">.</span><span class="builtintype" id="5889540">uint16</span><span class="op" id="5889546">(</span><span class="op" id="5889547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889550">f</span><span class="op" id="5889551">.</span><span class="ident" id="5889552">Method</span>&nbsp;<span class="op" id="5889559">=</span>&nbsp;<span class="ident" id="5889561">b</span><span class="op" id="5889562">.</span><span class="builtintype" id="5889563">uint16</span><span class="op" id="5889569">(</span><span class="op" id="5889570">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889573">f</span><span class="op" id="5889574">.</span><span class="ident" id="5889575">ModifiedTime</span>&nbsp;<span class="op" id="5889588">=</span>&nbsp;<span class="ident" id="5889590">b</span><span class="op" id="5889591">.</span><span class="builtintype" id="5889592">uint16</span><span class="op" id="5889598">(</span><span class="op" id="5889599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889602">f</span><span class="op" id="5889603">.</span><span class="ident" id="5889604">ModifiedDate</span>&nbsp;<span class="op" id="5889617">=</span>&nbsp;<span class="ident" id="5889619">b</span><span class="op" id="5889620">.</span><span class="builtintype" id="5889621">uint16</span><span class="op" id="5889627">(</span><span class="op" id="5889628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889631">f</span><span class="op" id="5889632">.</span><span class="ident" id="5889633">CRC32</span>&nbsp;<span class="op" id="5889639">=</span>&nbsp;<span class="ident" id="5889641">b</span><span class="op" id="5889642">.</span><span class="builtintype" id="5889643">uint32</span><span class="op" id="5889649">(</span><span class="op" id="5889650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889653">f</span><span class="op" id="5889654">.</span><span class="ident" id="5889655">CompressedSize</span>&nbsp;<span class="op" id="5889670">=</span>&nbsp;<span class="ident" id="5889672">b</span><span class="op" id="5889673">.</span><span class="builtintype" id="5889674">uint32</span><span class="op" id="5889680">(</span><span class="op" id="5889681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889684">f</span><span class="op" id="5889685">.</span><span class="ident" id="5889686">UncompressedSize</span>&nbsp;<span class="op" id="5889703">=</span>&nbsp;<span class="ident" id="5889705">b</span><span class="op" id="5889706">.</span><span class="builtintype" id="5889707">uint32</span><span class="op" id="5889713">(</span><span class="op" id="5889714">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889717">f</span><span class="op" id="5889718">.</span><span class="ident" id="5889719">CompressedSize64</span>&nbsp;<span class="op" id="5889736">=</span>&nbsp;<span class="ident" id="5889738">uint64</span><span class="op" id="5889744">(</span><span class="ident" id="5889745">f</span><span class="op" id="5889746">.</span><span class="ident" id="5889747">CompressedSize</span><span class="op" id="5889761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889764">f</span><span class="op" id="5889765">.</span><span class="ident" id="5889766">UncompressedSize64</span>&nbsp;<span class="op" id="5889785">=</span>&nbsp;<span class="ident" id="5889787">uint64</span><span class="op" id="5889793">(</span><span class="ident" id="5889794">f</span><span class="op" id="5889795">.</span><span class="ident" id="5889796">UncompressedSize</span><span class="op" id="5889812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889815">filenameLen</span>&nbsp;<span class="op" id="5889827">:=</span>&nbsp;<span class="builtintype" id="5889830">int</span><span class="op" id="5889833">(</span><span class="ident" id="5889834">b</span><span class="op" id="5889835">.</span><span class="builtintype" id="5889836">uint16</span><span class="op" id="5889842">(</span><span class="op" id="5889843">)</span><span class="op" id="5889844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889847">extraLen</span>&nbsp;<span class="op" id="5889856">:=</span>&nbsp;<span class="builtintype" id="5889859">int</span><span class="op" id="5889862">(</span><span class="ident" id="5889863">b</span><span class="op" id="5889864">.</span><span class="builtintype" id="5889865">uint16</span><span class="op" id="5889871">(</span><span class="op" id="5889872">)</span><span class="op" id="5889873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889876">commentLen</span>&nbsp;<span class="op" id="5889887">:=</span>&nbsp;<span class="builtintype" id="5889890">int</span><span class="op" id="5889893">(</span><span class="ident" id="5889894">b</span><span class="op" id="5889895">.</span><span class="builtintype" id="5889896">uint16</span><span class="op" id="5889902">(</span><span class="op" id="5889903">)</span><span class="op" id="5889904">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889907">b</span>&nbsp;<span class="op" id="5889909">=</span>&nbsp;<span class="ident" id="5889911">b</span><span class="op" id="5889912">[</span><span class="num" id="5889913">4</span><span class="op" id="5889914">:</span><span class="op" id="5889915">]</span>&nbsp;<span class="comment" id="5889917">//&nbsp;skipped&nbsp;start&nbsp;disk&nbsp;number&nbsp;and&nbsp;internal&nbsp;attributes&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5889983">f</span><span class="op" id="5889984">.</span><span class="ident" id="5889985">ExternalAttrs</span>&nbsp;<span class="op" id="5889999">=</span>&nbsp;<span class="ident" id="5890001">b</span><span class="op" id="5890002">.</span><span class="builtintype" id="5890003">uint32</span><span class="op" id="5890009">(</span><span class="op" id="5890010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890013">f</span><span class="op" id="5890014">.</span><span class="ident" id="5890015">headerOffset</span>&nbsp;<span class="op" id="5890028">=</span>&nbsp;<span class="ident" id="5890030">int64</span><span class="op" id="5890035">(</span><span class="ident" id="5890036">b</span><span class="op" id="5890037">.</span><span class="builtintype" id="5890038">uint32</span><span class="op" id="5890044">(</span><span class="op" id="5890045">)</span><span class="op" id="5890046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890049">d</span>&nbsp;<span class="op" id="5890051">:=</span>&nbsp;<span class="builtinfunc" id="5890054">make</span><span class="op" id="5890058">(</span><span class="op" id="5890059">[</span><span class="op" id="5890060">]</span><span class="builtintype" id="5890061">byte</span><span class="op" id="5890065">,</span>&nbsp;<span class="ident" id="5890067">filenameLen</span><span class="op" id="5890078">+</span><span class="ident" id="5890079">extraLen</span><span class="op" id="5890087">+</span><span class="ident" id="5890088">commentLen</span><span class="op" id="5890098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890101">if</span>&nbsp;<span class="ident" id="5890104">_</span><span class="op" id="5890105">,</span>&nbsp;<span class="ident" id="5890107">err</span>&nbsp;<span class="op" id="5890111">:=</span>&nbsp;<span class="ident" id="5890114">io</span><span class="op" id="5890116">.</span><span class="ident" id="5890117">ReadFull</span><span class="op" id="5890125">(</span><span class="ident" id="5890126">r</span><span class="op" id="5890127">,</span>&nbsp;<span class="ident" id="5890129">d</span><span class="op" id="5890130">)</span><span class="op" id="5890131">;</span>&nbsp;<span class="ident" id="5890133">err</span>&nbsp;<span class="op" id="5890137">!=</span>&nbsp;<span class="ident" id="5890140">nil</span>&nbsp;<span class="op" id="5890144">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890148">return</span>&nbsp;<span class="ident" id="5890155">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5890160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890163">f</span><span class="op" id="5890164">.</span><span class="ident" id="5890165">Name</span>&nbsp;<span class="op" id="5890170">=</span>&nbsp;<span class="builtintype" id="5890172">string</span><span class="op" id="5890178">(</span><span class="ident" id="5890179">d</span><span class="op" id="5890180">[</span><span class="op" id="5890181">:</span><span class="ident" id="5890182">filenameLen</span><span class="op" id="5890193">]</span><span class="op" id="5890194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890197">f</span><span class="op" id="5890198">.</span><span class="ident" id="5890199">Extra</span>&nbsp;<span class="op" id="5890205">=</span>&nbsp;<span class="ident" id="5890207">d</span><span class="op" id="5890208">[</span><span class="ident" id="5890209">filenameLen</span>&nbsp;<span class="op" id="5890221">:</span>&nbsp;<span class="ident" id="5890223">filenameLen</span><span class="op" id="5890234">+</span><span class="ident" id="5890235">extraLen</span><span class="op" id="5890243">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890246">f</span><span class="op" id="5890247">.</span><span class="ident" id="5890248">Comment</span>&nbsp;<span class="op" id="5890256">=</span>&nbsp;<span class="builtintype" id="5890258">string</span><span class="op" id="5890264">(</span><span class="ident" id="5890265">d</span><span class="op" id="5890266">[</span><span class="ident" id="5890267">filenameLen</span><span class="op" id="5890278">+</span><span class="ident" id="5890279">extraLen</span><span class="op" id="5890287">:</span><span class="op" id="5890288">]</span><span class="op" id="5890289">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890293">if</span>&nbsp;<span class="builtinfunc" id="5890296">len</span><span class="op" id="5890299">(</span><span class="ident" id="5890300">f</span><span class="op" id="5890301">.</span><span class="ident" id="5890302">Extra</span><span class="op" id="5890307">)</span>&nbsp;<span class="op" id="5890309">&gt;</span>&nbsp;<span class="num" id="5890311">0</span>&nbsp;<span class="op" id="5890313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890317">b</span>&nbsp;<span class="op" id="5890319">:=</span>&nbsp;<span class="ident" id="5890322">readBuf</span><span class="op" id="5890329">(</span><span class="ident" id="5890330">f</span><span class="op" id="5890331">.</span><span class="ident" id="5890332">Extra</span><span class="op" id="5890337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890341">for</span>&nbsp;<span class="builtinfunc" id="5890345">len</span><span class="op" id="5890348">(</span><span class="ident" id="5890349">b</span><span class="op" id="5890350">)</span>&nbsp;<span class="op" id="5890352">&gt;=</span>&nbsp;<span class="num" id="5890355">4</span>&nbsp;<span class="op" id="5890357">{</span>&nbsp;<span class="comment" id="5890359">//&nbsp;need&nbsp;at&nbsp;least&nbsp;tag&nbsp;and&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890392">tag</span>&nbsp;<span class="op" id="5890396">:=</span>&nbsp;<span class="ident" id="5890399">b</span><span class="op" id="5890400">.</span><span class="builtintype" id="5890401">uint16</span><span class="op" id="5890407">(</span><span class="op" id="5890408">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890413">size</span>&nbsp;<span class="op" id="5890418">:=</span>&nbsp;<span class="ident" id="5890421">b</span><span class="op" id="5890422">.</span><span class="builtintype" id="5890423">uint16</span><span class="op" id="5890429">(</span><span class="op" id="5890430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890435">if</span>&nbsp;<span class="builtintype" id="5890438">int</span><span class="op" id="5890441">(</span><span class="ident" id="5890442">size</span><span class="op" id="5890446">)</span>&nbsp;<span class="op" id="5890448">&gt;</span>&nbsp;<span class="builtinfunc" id="5890450">len</span><span class="op" id="5890453">(</span><span class="ident" id="5890454">b</span><span class="op" id="5890455">)</span>&nbsp;<span class="op" id="5890457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890463">return</span>&nbsp;<span class="ident" id="5890470">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5890483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890488">if</span>&nbsp;<span class="ident" id="5890491">tag</span>&nbsp;<span class="op" id="5890495">==</span>&nbsp;<span class="ident" id="5890498">zip64ExtraId</span>&nbsp;<span class="op" id="5890511">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5890517">//&nbsp;update&nbsp;directory&nbsp;values&nbsp;from&nbsp;the&nbsp;zip64&nbsp;extra&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890575">eb</span>&nbsp;<span class="op" id="5890578">:=</span>&nbsp;<span class="ident" id="5890581">readBuf</span><span class="op" id="5890588">(</span><span class="ident" id="5890589">b</span><span class="op" id="5890590">[</span><span class="op" id="5890591">:</span><span class="ident" id="5890592">size</span><span class="op" id="5890596">]</span><span class="op" id="5890597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890603">if</span>&nbsp;<span class="builtinfunc" id="5890606">len</span><span class="op" id="5890609">(</span><span class="ident" id="5890610">eb</span><span class="op" id="5890612">)</span>&nbsp;<span class="op" id="5890614">&gt;=</span>&nbsp;<span class="num" id="5890617">8</span>&nbsp;<span class="op" id="5890619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890626">f</span><span class="op" id="5890627">.</span><span class="ident" id="5890628">UncompressedSize64</span>&nbsp;<span class="op" id="5890647">=</span>&nbsp;<span class="ident" id="5890649">eb</span><span class="op" id="5890651">.</span><span class="ident" id="5890652">uint64</span><span class="op" id="5890658">(</span><span class="op" id="5890659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5890665">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890671">if</span>&nbsp;<span class="builtinfunc" id="5890674">len</span><span class="op" id="5890677">(</span><span class="ident" id="5890678">eb</span><span class="op" id="5890680">)</span>&nbsp;<span class="op" id="5890682">&gt;=</span>&nbsp;<span class="num" id="5890685">8</span>&nbsp;<span class="op" id="5890687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890694">f</span><span class="op" id="5890695">.</span><span class="ident" id="5890696">CompressedSize64</span>&nbsp;<span class="op" id="5890713">=</span>&nbsp;<span class="ident" id="5890715">eb</span><span class="op" id="5890717">.</span><span class="ident" id="5890718">uint64</span><span class="op" id="5890724">(</span><span class="op" id="5890725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5890731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5890737">if</span>&nbsp;<span class="builtinfunc" id="5890740">len</span><span class="op" id="5890743">(</span><span class="ident" id="5890744">eb</span><span class="op" id="5890746">)</span>&nbsp;<span class="op" id="5890748">&gt;=</span>&nbsp;<span class="num" id="5890751">8</span>&nbsp;<span class="op" id="5890753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890760">f</span><span class="op" id="5890761">.</span><span class="ident" id="5890762">headerOffset</span>&nbsp;<span class="op" id="5890775">=</span>&nbsp;<span class="ident" id="5890777">int64</span><span class="op" id="5890782">(</span><span class="ident" id="5890783">eb</span><span class="op" id="5890785">.</span><span class="ident" id="5890786">uint64</span><span class="op" id="5890792">(</span><span class="op" id="5890793">)</span><span class="op" id="5890794">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5890800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5890805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5890810">b</span>&nbsp;<span class="op" id="5890812">=</span>&nbsp;<span class="ident" id="5890814">b</span><span class="op" id="5890815">[</span><span class="ident" id="5890816">size</span><span class="op" id="5890820">:</span><span class="op" id="5890821">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5890825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5890829">//&nbsp;Should&nbsp;have&nbsp;consumed&nbsp;the&nbsp;whole&nbsp;header.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5890873">//&nbsp;But&nbsp;popular&nbsp;zip&nbsp;&amp;&nbsp;JAR&nbsp;creation&nbsp;tools&nbsp;are&nbsp;broken&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5890930">//&nbsp;may&nbsp;pad&nbsp;extra&nbsp;zeros&nbsp;at&nbsp;the&nbsp;end,&nbsp;so&nbsp;accept&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5890983">//&nbsp;too.&nbsp;See&nbsp;golang.org/issue/8186.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891020">for</span>&nbsp;<span class="ident" id="5891024">_</span><span class="op" id="5891025">,</span>&nbsp;<span class="ident" id="5891027">v</span>&nbsp;<span class="op" id="5891029">:=</span>&nbsp;<span class="keyword" id="5891032">range</span>&nbsp;<span class="ident" id="5891038">b</span>&nbsp;<span class="op" id="5891040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891045">if</span>&nbsp;<span class="ident" id="5891048">v</span>&nbsp;<span class="op" id="5891050">!=</span>&nbsp;<span class="num" id="5891053">0</span>&nbsp;<span class="op" id="5891055">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891061">return</span>&nbsp;<span class="ident" id="5891068">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5891081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5891085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5891088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891091">return</span>&nbsp;<span class="ident" id="5891098">nil</span><br>
<span class="lineno">280</span><span class="op" id="5891102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5891105">func</span>&nbsp;<span class="ident" id="5891110">readDataDescriptor</span><span class="op" id="5891128">(</span><span class="ident" id="5891129">r</span>&nbsp;<span class="ident" id="5891131">io</span><span class="op" id="5891133">.</span><span class="ident" id="5891134">Reader</span><span class="op" id="5891140">,</span>&nbsp;<span class="ident" id="5891142">f</span>&nbsp;<span class="op" id="5891144">*</span><span class="ident" id="5891145">File</span><span class="op" id="5891149">)</span>&nbsp;<span class="builtintype" id="5891151">error</span>&nbsp;<span class="op" id="5891157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891160">var</span>&nbsp;<span class="ident" id="5891164">buf</span>&nbsp;<span class="op" id="5891168">[</span><span class="ident" id="5891169">dataDescriptorLen</span><span class="op" id="5891186">]</span><span class="builtintype" id="5891187">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5891194">//&nbsp;The&nbsp;spec&nbsp;says:&nbsp;&#34;Although&nbsp;not&nbsp;originally&nbsp;assigned&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5891249">//&nbsp;signature,&nbsp;the&nbsp;value&nbsp;0x08074b50&nbsp;has&nbsp;commonly&nbsp;been&nbsp;adopted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5891311">//&nbsp;as&nbsp;a&nbsp;signature&nbsp;value&nbsp;for&nbsp;the&nbsp;data&nbsp;descriptor&nbsp;record.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5891368">//&nbsp;Implementers&nbsp;should&nbsp;be&nbsp;aware&nbsp;that&nbsp;ZIP&nbsp;files&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5891423">//&nbsp;encountered&nbsp;with&nbsp;or&nbsp;without&nbsp;this&nbsp;signature&nbsp;marking&nbsp;data</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5891483">//&nbsp;descriptors&nbsp;and&nbsp;should&nbsp;account&nbsp;for&nbsp;either&nbsp;case&nbsp;when&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5891547">//&nbsp;ZIP&nbsp;files&nbsp;to&nbsp;ensure&nbsp;compatibility.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5891587">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5891591">//&nbsp;dataDescriptorLen&nbsp;includes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;signature&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5891652">//&nbsp;first&nbsp;read&nbsp;just&nbsp;those&nbsp;4&nbsp;bytes&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;exists.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891707">if</span>&nbsp;<span class="ident" id="5891710">_</span><span class="op" id="5891711">,</span>&nbsp;<span class="ident" id="5891713">err</span>&nbsp;<span class="op" id="5891717">:=</span>&nbsp;<span class="ident" id="5891720">io</span><span class="op" id="5891722">.</span><span class="ident" id="5891723">ReadFull</span><span class="op" id="5891731">(</span><span class="ident" id="5891732">r</span><span class="op" id="5891733">,</span>&nbsp;<span class="ident" id="5891735">buf</span><span class="op" id="5891738">[</span><span class="op" id="5891739">:</span><span class="num" id="5891740">4</span><span class="op" id="5891741">]</span><span class="op" id="5891742">)</span><span class="op" id="5891743">;</span>&nbsp;<span class="ident" id="5891745">err</span>&nbsp;<span class="op" id="5891749">!=</span>&nbsp;<span class="ident" id="5891752">nil</span>&nbsp;<span class="op" id="5891756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891760">return</span>&nbsp;<span class="ident" id="5891767">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5891772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5891775">off</span>&nbsp;<span class="op" id="5891779">:=</span>&nbsp;<span class="num" id="5891782">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5891785">maybeSig</span>&nbsp;<span class="op" id="5891794">:=</span>&nbsp;<span class="ident" id="5891797">readBuf</span><span class="op" id="5891804">(</span><span class="ident" id="5891805">buf</span><span class="op" id="5891808">[</span><span class="op" id="5891809">:</span><span class="num" id="5891810">4</span><span class="op" id="5891811">]</span><span class="op" id="5891812">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891815">if</span>&nbsp;<span class="ident" id="5891818">maybeSig</span><span class="op" id="5891826">.</span><span class="builtintype" id="5891827">uint32</span><span class="op" id="5891833">(</span><span class="op" id="5891834">)</span>&nbsp;<span class="op" id="5891836">!=</span>&nbsp;<span class="ident" id="5891839">dataDescriptorSignature</span>&nbsp;<span class="op" id="5891863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5891867">//&nbsp;No&nbsp;data&nbsp;descriptor&nbsp;signature.&nbsp;Keep&nbsp;these&nbsp;four</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5891918">//&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5891930">off</span>&nbsp;<span class="op" id="5891934">+=</span>&nbsp;<span class="num" id="5891937">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5891940">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5891943">if</span>&nbsp;<span class="ident" id="5891946">_</span><span class="op" id="5891947">,</span>&nbsp;<span class="ident" id="5891949">err</span>&nbsp;<span class="op" id="5891953">:=</span>&nbsp;<span class="ident" id="5891956">io</span><span class="op" id="5891958">.</span><span class="ident" id="5891959">ReadFull</span><span class="op" id="5891967">(</span><span class="ident" id="5891968">r</span><span class="op" id="5891969">,</span>&nbsp;<span class="ident" id="5891971">buf</span><span class="op" id="5891974">[</span><span class="ident" id="5891975">off</span><span class="op" id="5891978">:</span><span class="num" id="5891979">12</span><span class="op" id="5891981">]</span><span class="op" id="5891982">)</span><span class="op" id="5891983">;</span>&nbsp;<span class="ident" id="5891985">err</span>&nbsp;<span class="op" id="5891989">!=</span>&nbsp;<span class="ident" id="5891992">nil</span>&nbsp;<span class="op" id="5891996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892000">return</span>&nbsp;<span class="ident" id="5892007">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5892012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892015">b</span>&nbsp;<span class="op" id="5892017">:=</span>&nbsp;<span class="ident" id="5892020">readBuf</span><span class="op" id="5892027">(</span><span class="ident" id="5892028">buf</span><span class="op" id="5892031">[</span><span class="op" id="5892032">:</span><span class="num" id="5892033">12</span><span class="op" id="5892035">]</span><span class="op" id="5892036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892039">if</span>&nbsp;<span class="ident" id="5892042">b</span><span class="op" id="5892043">.</span><span class="builtintype" id="5892044">uint32</span><span class="op" id="5892050">(</span><span class="op" id="5892051">)</span>&nbsp;<span class="op" id="5892053">!=</span>&nbsp;<span class="ident" id="5892056">f</span><span class="op" id="5892057">.</span><span class="ident" id="5892058">CRC32</span>&nbsp;<span class="op" id="5892064">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892068">return</span>&nbsp;<span class="ident" id="5892075">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5892088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5892092">//&nbsp;The&nbsp;two&nbsp;sizes&nbsp;that&nbsp;follow&nbsp;here&nbsp;can&nbsp;be&nbsp;either&nbsp;32&nbsp;bits&nbsp;or&nbsp;64&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5892160">//&nbsp;but&nbsp;the&nbsp;spec&nbsp;is&nbsp;not&nbsp;very&nbsp;clear&nbsp;on&nbsp;this&nbsp;and&nbsp;different</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5892217">//&nbsp;interpretations&nbsp;has&nbsp;been&nbsp;made&nbsp;causing&nbsp;incompatibilities.&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5892281">//&nbsp;already&nbsp;have&nbsp;the&nbsp;sizes&nbsp;from&nbsp;the&nbsp;central&nbsp;directory&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5892345">//&nbsp;just&nbsp;ignore&nbsp;these.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892369">return</span>&nbsp;<span class="ident" id="5892376">nil</span><br>
<span class="lineno">320</span><span class="op" id="5892380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5892383">func</span>&nbsp;<span class="ident" id="5892388">readDirectoryEnd</span><span class="op" id="5892404">(</span><span class="ident" id="5892405">r</span>&nbsp;<span class="ident" id="5892407">io</span><span class="op" id="5892409">.</span><span class="ident" id="5892410">ReaderAt</span><span class="op" id="5892418">,</span>&nbsp;<span class="ident" id="5892420">size</span>&nbsp;<span class="ident" id="5892425">int64</span><span class="op" id="5892430">)</span>&nbsp;<span class="op" id="5892432">(</span><span class="ident" id="5892433">dir</span>&nbsp;<span class="op" id="5892437">*</span><span class="ident" id="5892438">directoryEnd</span><span class="op" id="5892450">,</span>&nbsp;<span class="ident" id="5892452">err</span>&nbsp;<span class="builtintype" id="5892456">error</span><span class="op" id="5892461">)</span>&nbsp;<span class="op" id="5892463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5892466">//&nbsp;look&nbsp;for&nbsp;directoryEndSignature&nbsp;in&nbsp;the&nbsp;last&nbsp;1k,&nbsp;then&nbsp;in&nbsp;the&nbsp;last&nbsp;65k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892538">var</span>&nbsp;<span class="ident" id="5892542">buf</span>&nbsp;<span class="op" id="5892546">[</span><span class="op" id="5892547">]</span><span class="builtintype" id="5892548">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892554">var</span>&nbsp;<span class="ident" id="5892558">directoryEndOffset</span>&nbsp;<span class="ident" id="5892577">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892584">for</span>&nbsp;<span class="ident" id="5892588">i</span><span class="op" id="5892589">,</span>&nbsp;<span class="ident" id="5892591">bLen</span>&nbsp;<span class="op" id="5892596">:=</span>&nbsp;<span class="keyword" id="5892599">range</span>&nbsp;<span class="op" id="5892605">[</span><span class="op" id="5892606">]</span><span class="ident" id="5892607">int64</span><span class="op" id="5892612">{</span><span class="num" id="5892613">1024</span><span class="op" id="5892617">,</span>&nbsp;<span class="num" id="5892619">65</span>&nbsp;<span class="op" id="5892622">*</span>&nbsp;<span class="num" id="5892624">1024</span><span class="op" id="5892628">}</span>&nbsp;<span class="op" id="5892630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892634">if</span>&nbsp;<span class="ident" id="5892637">bLen</span>&nbsp;<span class="op" id="5892642">&gt;</span>&nbsp;<span class="ident" id="5892644">size</span>&nbsp;<span class="op" id="5892649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892654">bLen</span>&nbsp;<span class="op" id="5892659">=</span>&nbsp;<span class="ident" id="5892661">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5892668">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892672">buf</span>&nbsp;<span class="op" id="5892676">=</span>&nbsp;<span class="builtinfunc" id="5892678">make</span><span class="op" id="5892682">(</span><span class="op" id="5892683">[</span><span class="op" id="5892684">]</span><span class="builtintype" id="5892685">byte</span><span class="op" id="5892689">,</span>&nbsp;<span class="builtintype" id="5892691">int</span><span class="op" id="5892694">(</span><span class="ident" id="5892695">bLen</span><span class="op" id="5892699">)</span><span class="op" id="5892700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892704">if</span>&nbsp;<span class="ident" id="5892707">_</span><span class="op" id="5892708">,</span>&nbsp;<span class="ident" id="5892710">err</span>&nbsp;<span class="op" id="5892714">:=</span>&nbsp;<span class="ident" id="5892717">r</span><span class="op" id="5892718">.</span><span class="ident" id="5892719">ReadAt</span><span class="op" id="5892725">(</span><span class="ident" id="5892726">buf</span><span class="op" id="5892729">,</span>&nbsp;<span class="ident" id="5892731">size</span><span class="op" id="5892735">-</span><span class="ident" id="5892736">bLen</span><span class="op" id="5892740">)</span><span class="op" id="5892741">;</span>&nbsp;<span class="ident" id="5892743">err</span>&nbsp;<span class="op" id="5892747">!=</span>&nbsp;<span class="ident" id="5892750">nil</span>&nbsp;<span class="op" id="5892754">&amp;&amp;</span>&nbsp;<span class="ident" id="5892757">err</span>&nbsp;<span class="op" id="5892761">!=</span>&nbsp;<span class="ident" id="5892764">io</span><span class="op" id="5892766">.</span><span class="ident" id="5892767">EOF</span>&nbsp;<span class="op" id="5892771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892776">return</span>&nbsp;<span class="ident" id="5892783">nil</span><span class="op" id="5892786">,</span>&nbsp;<span class="ident" id="5892788">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5892794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892798">if</span>&nbsp;<span class="ident" id="5892801">p</span>&nbsp;<span class="op" id="5892803">:=</span>&nbsp;<span class="ident" id="5892806">findSignatureInBlock</span><span class="op" id="5892826">(</span><span class="ident" id="5892827">buf</span><span class="op" id="5892830">)</span><span class="op" id="5892831">;</span>&nbsp;<span class="ident" id="5892833">p</span>&nbsp;<span class="op" id="5892835">&gt;=</span>&nbsp;<span class="num" id="5892838">0</span>&nbsp;<span class="op" id="5892840">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892845">buf</span>&nbsp;<span class="op" id="5892849">=</span>&nbsp;<span class="ident" id="5892851">buf</span><span class="op" id="5892854">[</span><span class="ident" id="5892855">p</span><span class="op" id="5892856">:</span><span class="op" id="5892857">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5892862">directoryEndOffset</span>&nbsp;<span class="op" id="5892881">=</span>&nbsp;<span class="ident" id="5892883">size</span>&nbsp;<span class="op" id="5892888">-</span>&nbsp;<span class="ident" id="5892890">bLen</span>&nbsp;<span class="op" id="5892895">+</span>&nbsp;<span class="ident" id="5892897">int64</span><span class="op" id="5892902">(</span><span class="ident" id="5892903">p</span><span class="op" id="5892904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892909">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5892917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892921">if</span>&nbsp;<span class="ident" id="5892924">i</span>&nbsp;<span class="op" id="5892926">==</span>&nbsp;<span class="num" id="5892929">1</span>&nbsp;<span class="op" id="5892931">||</span>&nbsp;<span class="ident" id="5892934">bLen</span>&nbsp;<span class="op" id="5892939">==</span>&nbsp;<span class="ident" id="5892942">size</span>&nbsp;<span class="op" id="5892947">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5892952">return</span>&nbsp;<span class="ident" id="5892959">nil</span><span class="op" id="5892962">,</span>&nbsp;<span class="ident" id="5892964">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5892976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5892979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5892983">//&nbsp;read&nbsp;header&nbsp;into&nbsp;struct</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893011">b</span>&nbsp;<span class="op" id="5893013">:=</span>&nbsp;<span class="ident" id="5893016">readBuf</span><span class="op" id="5893023">(</span><span class="ident" id="5893024">buf</span><span class="op" id="5893027">[</span><span class="num" id="5893028">4</span><span class="op" id="5893029">:</span><span class="op" id="5893030">]</span><span class="op" id="5893031">)</span>&nbsp;<span class="comment" id="5893033">//&nbsp;skip&nbsp;signature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893052">d</span>&nbsp;<span class="op" id="5893054">:=</span>&nbsp;<span class="op" id="5893057">&amp;</span><span class="ident" id="5893058">directoryEnd</span><span class="op" id="5893070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893074">diskNbr</span><span class="op" id="5893081">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5893094">uint32</span><span class="op" id="5893100">(</span><span class="ident" id="5893101">b</span><span class="op" id="5893102">.</span><span class="builtintype" id="5893103">uint16</span><span class="op" id="5893109">(</span><span class="op" id="5893110">)</span><span class="op" id="5893111">)</span><span class="op" id="5893112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893116">dirDiskNbr</span><span class="op" id="5893126">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5893136">uint32</span><span class="op" id="5893142">(</span><span class="ident" id="5893143">b</span><span class="op" id="5893144">.</span><span class="builtintype" id="5893145">uint16</span><span class="op" id="5893151">(</span><span class="op" id="5893152">)</span><span class="op" id="5893153">)</span><span class="op" id="5893154">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893158">dirRecordsThisDisk</span><span class="op" id="5893176">:</span>&nbsp;<span class="ident" id="5893178">uint64</span><span class="op" id="5893184">(</span><span class="ident" id="5893185">b</span><span class="op" id="5893186">.</span><span class="builtintype" id="5893187">uint16</span><span class="op" id="5893193">(</span><span class="op" id="5893194">)</span><span class="op" id="5893195">)</span><span class="op" id="5893196">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893200">directoryRecords</span><span class="op" id="5893216">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5893220">uint64</span><span class="op" id="5893226">(</span><span class="ident" id="5893227">b</span><span class="op" id="5893228">.</span><span class="builtintype" id="5893229">uint16</span><span class="op" id="5893235">(</span><span class="op" id="5893236">)</span><span class="op" id="5893237">)</span><span class="op" id="5893238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893242">directorySize</span><span class="op" id="5893255">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893262">uint64</span><span class="op" id="5893268">(</span><span class="ident" id="5893269">b</span><span class="op" id="5893270">.</span><span class="builtintype" id="5893271">uint32</span><span class="op" id="5893277">(</span><span class="op" id="5893278">)</span><span class="op" id="5893279">)</span><span class="op" id="5893280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893284">directoryOffset</span><span class="op" id="5893299">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893304">uint64</span><span class="op" id="5893310">(</span><span class="ident" id="5893311">b</span><span class="op" id="5893312">.</span><span class="builtintype" id="5893313">uint32</span><span class="op" id="5893319">(</span><span class="op" id="5893320">)</span><span class="op" id="5893321">)</span><span class="op" id="5893322">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893326">commentLen</span><span class="op" id="5893336">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5893346">b</span><span class="op" id="5893347">.</span><span class="builtintype" id="5893348">uint16</span><span class="op" id="5893354">(</span><span class="op" id="5893355">)</span><span class="op" id="5893356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5893359">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893362">l</span>&nbsp;<span class="op" id="5893364">:=</span>&nbsp;<span class="builtintype" id="5893367">int</span><span class="op" id="5893370">(</span><span class="ident" id="5893371">d</span><span class="op" id="5893372">.</span><span class="ident" id="5893373">commentLen</span><span class="op" id="5893383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5893386">if</span>&nbsp;<span class="ident" id="5893389">l</span>&nbsp;<span class="op" id="5893391">&gt;</span>&nbsp;<span class="builtinfunc" id="5893393">len</span><span class="op" id="5893396">(</span><span class="ident" id="5893397">b</span><span class="op" id="5893398">)</span>&nbsp;<span class="op" id="5893400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5893404">return</span>&nbsp;<span class="ident" id="5893411">nil</span><span class="op" id="5893414">,</span>&nbsp;<span class="ident" id="5893416">errors</span><span class="op" id="5893422">.</span><span class="ident" id="5893423">New</span><span class="op" id="5893426">(</span><span class="string" id="5893427">&#34;zip:&nbsp;invalid&nbsp;comment&nbsp;length&#34;</span><span class="op" id="5893456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5893459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893462">d</span><span class="op" id="5893463">.</span><span class="ident" id="5893464">comment</span>&nbsp;<span class="op" id="5893472">=</span>&nbsp;<span class="builtintype" id="5893474">string</span><span class="op" id="5893480">(</span><span class="ident" id="5893481">b</span><span class="op" id="5893482">[</span><span class="op" id="5893483">:</span><span class="ident" id="5893484">l</span><span class="op" id="5893485">]</span><span class="op" id="5893486">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893490">p</span><span class="op" id="5893491">,</span>&nbsp;<span class="ident" id="5893493">err</span>&nbsp;<span class="op" id="5893497">:=</span>&nbsp;<span class="ident" id="5893500">findDirectory64End</span><span class="op" id="5893518">(</span><span class="ident" id="5893519">r</span><span class="op" id="5893520">,</span>&nbsp;<span class="ident" id="5893522">directoryEndOffset</span><span class="op" id="5893540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5893543">if</span>&nbsp;<span class="ident" id="5893546">err</span>&nbsp;<span class="op" id="5893550">==</span>&nbsp;<span class="ident" id="5893553">nil</span>&nbsp;<span class="op" id="5893557">&amp;&amp;</span>&nbsp;<span class="ident" id="5893560">p</span>&nbsp;<span class="op" id="5893562">&gt;=</span>&nbsp;<span class="num" id="5893565">0</span>&nbsp;<span class="op" id="5893567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5893571">err</span>&nbsp;<span class="op" id="5893575">=</span>&nbsp;<span class="ident" id="5893577">readDirectory64End</span><span class="op" id="5893595">(</span><span class="ident" id="5893596">r</span><span class="op" id="5893597">,</span>&nbsp;<span class="ident" id="5893599">p</span><span class="op" id="5893600">,</span>&nbsp;<span class="ident" id="5893602">d</span><span class="op" id="5893603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5893606">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5893609">if</span>&nbsp;<span class="ident" id="5893612">err</span>&nbsp;<span class="op" id="5893616">!=</span>&nbsp;<span class="ident" id="5893619">nil</span>&nbsp;<span class="op" id="5893623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5893627">return</span>&nbsp;<span class="ident" id="5893634">nil</span><span class="op" id="5893637">,</span>&nbsp;<span class="ident" id="5893639">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5893644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5893648">//&nbsp;Make&nbsp;sure&nbsp;directoryOffset&nbsp;points&nbsp;to&nbsp;somewhere&nbsp;in&nbsp;our&nbsp;file.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5893711">if</span>&nbsp;<span class="ident" id="5893714">o</span>&nbsp;<span class="op" id="5893716">:=</span>&nbsp;<span class="ident" id="5893719">int64</span><span class="op" id="5893724">(</span><span class="ident" id="5893725">d</span><span class="op" id="5893726">.</span><span class="ident" id="5893727">directoryOffset</span><span class="op" id="5893742">)</span><span class="op" id="5893743">;</span>&nbsp;<span class="ident" id="5893745">o</span>&nbsp;<span class="op" id="5893747">&lt;</span>&nbsp;<span class="num" id="5893749">0</span>&nbsp;<span class="op" id="5893751">||</span>&nbsp;<span class="ident" id="5893754">o</span>&nbsp;<span class="op" id="5893756">&gt;=</span>&nbsp;<span class="ident" id="5893759">size</span>&nbsp;<span class="op" id="5893764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5893768">return</span>&nbsp;<span class="ident" id="5893775">nil</span><span class="op" id="5893778">,</span>&nbsp;<span class="ident" id="5893780">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5893791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5893794">return</span>&nbsp;<span class="ident" id="5893801">d</span><span class="op" id="5893802">,</span>&nbsp;<span class="ident" id="5893804">nil</span><br>
<span class="lineno"></span><span class="op" id="5893808">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="5893811">//&nbsp;findDirectory64End&nbsp;tries&nbsp;to&nbsp;read&nbsp;the&nbsp;zip64&nbsp;locator&nbsp;just&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5893881">//&nbsp;directory&nbsp;end&nbsp;and&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5893951">//&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="5893961">func</span>&nbsp;<span class="ident" id="5893966">findDirectory64End</span><span class="op" id="5893984">(</span><span class="ident" id="5893985">r</span>&nbsp;<span class="ident" id="5893987">io</span><span class="op" id="5893989">.</span><span class="ident" id="5893990">ReaderAt</span><span class="op" id="5893998">,</span>&nbsp;<span class="ident" id="5894000">directoryEndOffset</span>&nbsp;<span class="ident" id="5894019">int64</span><span class="op" id="5894024">)</span>&nbsp;<span class="op" id="5894026">(</span><span class="ident" id="5894027">int64</span><span class="op" id="5894032">,</span>&nbsp;<span class="builtintype" id="5894034">error</span><span class="op" id="5894039">)</span>&nbsp;<span class="op" id="5894041">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894044">locOffset</span>&nbsp;<span class="op" id="5894054">:=</span>&nbsp;<span class="ident" id="5894057">directoryEndOffset</span>&nbsp;<span class="op" id="5894076">-</span>&nbsp;<span class="ident" id="5894078">directory64LocLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894097">if</span>&nbsp;<span class="ident" id="5894100">locOffset</span>&nbsp;<span class="op" id="5894110">&lt;</span>&nbsp;<span class="num" id="5894112">0</span>&nbsp;<span class="op" id="5894114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894118">return</span>&nbsp;<span class="op" id="5894125">-</span><span class="num" id="5894126">1</span><span class="op" id="5894127">,</span>&nbsp;<span class="ident" id="5894129">nil</span>&nbsp;<span class="comment" id="5894133">//&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;a&nbsp;header&nbsp;outside&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5894183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894186">buf</span>&nbsp;<span class="op" id="5894190">:=</span>&nbsp;<span class="builtinfunc" id="5894193">make</span><span class="op" id="5894197">(</span><span class="op" id="5894198">[</span><span class="op" id="5894199">]</span><span class="builtintype" id="5894200">byte</span><span class="op" id="5894204">,</span>&nbsp;<span class="ident" id="5894206">directory64LocLen</span><span class="op" id="5894223">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894226">if</span>&nbsp;<span class="ident" id="5894229">_</span><span class="op" id="5894230">,</span>&nbsp;<span class="ident" id="5894232">err</span>&nbsp;<span class="op" id="5894236">:=</span>&nbsp;<span class="ident" id="5894239">r</span><span class="op" id="5894240">.</span><span class="ident" id="5894241">ReadAt</span><span class="op" id="5894247">(</span><span class="ident" id="5894248">buf</span><span class="op" id="5894251">,</span>&nbsp;<span class="ident" id="5894253">locOffset</span><span class="op" id="5894262">)</span><span class="op" id="5894263">;</span>&nbsp;<span class="ident" id="5894265">err</span>&nbsp;<span class="op" id="5894269">!=</span>&nbsp;<span class="ident" id="5894272">nil</span>&nbsp;<span class="op" id="5894276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894280">return</span>&nbsp;<span class="op" id="5894287">-</span><span class="num" id="5894288">1</span><span class="op" id="5894289">,</span>&nbsp;<span class="ident" id="5894291">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5894296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894299">b</span>&nbsp;<span class="op" id="5894301">:=</span>&nbsp;<span class="ident" id="5894304">readBuf</span><span class="op" id="5894311">(</span><span class="ident" id="5894312">buf</span><span class="op" id="5894315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894318">if</span>&nbsp;<span class="ident" id="5894321">sig</span>&nbsp;<span class="op" id="5894325">:=</span>&nbsp;<span class="ident" id="5894328">b</span><span class="op" id="5894329">.</span><span class="builtintype" id="5894330">uint32</span><span class="op" id="5894336">(</span><span class="op" id="5894337">)</span><span class="op" id="5894338">;</span>&nbsp;<span class="ident" id="5894340">sig</span>&nbsp;<span class="op" id="5894344">!=</span>&nbsp;<span class="ident" id="5894347">directory64LocSignature</span>&nbsp;<span class="op" id="5894371">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894375">return</span>&nbsp;<span class="op" id="5894382">-</span><span class="num" id="5894383">1</span><span class="op" id="5894384">,</span>&nbsp;<span class="ident" id="5894386">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5894391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894394">b</span>&nbsp;<span class="op" id="5894396">=</span>&nbsp;<span class="ident" id="5894398">b</span><span class="op" id="5894399">[</span><span class="num" id="5894400">4</span><span class="op" id="5894401">:</span><span class="op" id="5894402">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5894410">//&nbsp;skip&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894491">p</span>&nbsp;<span class="op" id="5894493">:=</span>&nbsp;<span class="ident" id="5894496">b</span><span class="op" id="5894497">.</span><span class="ident" id="5894498">uint64</span><span class="op" id="5894504">(</span><span class="op" id="5894505">)</span>&nbsp;<span class="comment" id="5894507">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894572">return</span>&nbsp;<span class="ident" id="5894579">int64</span><span class="op" id="5894584">(</span><span class="ident" id="5894585">p</span><span class="op" id="5894586">)</span><span class="op" id="5894587">,</span>&nbsp;<span class="ident" id="5894589">nil</span><br>
<span class="lineno">395</span><span class="op" id="5894593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5894596">//&nbsp;readDirectory64End&nbsp;reads&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;and&nbsp;updates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5894664">//&nbsp;directory&nbsp;end&nbsp;with&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5894718">func</span>&nbsp;<span class="ident" id="5894723">readDirectory64End</span><span class="op" id="5894741">(</span><span class="ident" id="5894742">r</span>&nbsp;<span class="ident" id="5894744">io</span><span class="op" id="5894746">.</span><span class="ident" id="5894747">ReaderAt</span><span class="op" id="5894755">,</span>&nbsp;<span class="ident" id="5894757">offset</span>&nbsp;<span class="ident" id="5894764">int64</span><span class="op" id="5894769">,</span>&nbsp;<span class="ident" id="5894771">d</span>&nbsp;<span class="op" id="5894773">*</span><span class="ident" id="5894774">directoryEnd</span><span class="op" id="5894786">)</span>&nbsp;<span class="op" id="5894788">(</span><span class="ident" id="5894789">err</span>&nbsp;<span class="builtintype" id="5894793">error</span><span class="op" id="5894798">)</span>&nbsp;<span class="op" id="5894800">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894803">buf</span>&nbsp;<span class="op" id="5894807">:=</span>&nbsp;<span class="builtinfunc" id="5894810">make</span><span class="op" id="5894814">(</span><span class="op" id="5894815">[</span><span class="op" id="5894816">]</span><span class="builtintype" id="5894817">byte</span><span class="op" id="5894821">,</span>&nbsp;<span class="ident" id="5894823">directory64EndLen</span><span class="op" id="5894840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894843">if</span>&nbsp;<span class="ident" id="5894846">_</span><span class="op" id="5894847">,</span>&nbsp;<span class="ident" id="5894849">err</span>&nbsp;<span class="op" id="5894853">:=</span>&nbsp;<span class="ident" id="5894856">r</span><span class="op" id="5894857">.</span><span class="ident" id="5894858">ReadAt</span><span class="op" id="5894864">(</span><span class="ident" id="5894865">buf</span><span class="op" id="5894868">,</span>&nbsp;<span class="ident" id="5894870">offset</span><span class="op" id="5894876">)</span><span class="op" id="5894877">;</span>&nbsp;<span class="ident" id="5894879">err</span>&nbsp;<span class="op" id="5894883">!=</span>&nbsp;<span class="ident" id="5894886">nil</span>&nbsp;<span class="op" id="5894890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894894">return</span>&nbsp;<span class="ident" id="5894901">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5894906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5894910">b</span>&nbsp;<span class="op" id="5894912">:=</span>&nbsp;<span class="ident" id="5894915">readBuf</span><span class="op" id="5894922">(</span><span class="ident" id="5894923">buf</span><span class="op" id="5894926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894929">if</span>&nbsp;<span class="ident" id="5894932">sig</span>&nbsp;<span class="op" id="5894936">:=</span>&nbsp;<span class="ident" id="5894939">b</span><span class="op" id="5894940">.</span><span class="builtintype" id="5894941">uint32</span><span class="op" id="5894947">(</span><span class="op" id="5894948">)</span><span class="op" id="5894949">;</span>&nbsp;<span class="ident" id="5894951">sig</span>&nbsp;<span class="op" id="5894955">!=</span>&nbsp;<span class="ident" id="5894958">directory64EndSignature</span>&nbsp;<span class="op" id="5894982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5894986">return</span>&nbsp;<span class="ident" id="5894993">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5895004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5895008">b</span>&nbsp;<span class="op" id="5895010">=</span>&nbsp;<span class="ident" id="5895012">b</span><span class="op" id="5895013">[</span><span class="num" id="5895014">12</span><span class="op" id="5895016">:</span><span class="op" id="5895017">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895042">//&nbsp;skip&nbsp;dir&nbsp;size,&nbsp;version&nbsp;and&nbsp;version&nbsp;needed&nbsp;(uint64&nbsp;+&nbsp;2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5895109">d</span><span class="op" id="5895110">.</span><span class="ident" id="5895111">diskNbr</span>&nbsp;<span class="op" id="5895119">=</span>&nbsp;<span class="ident" id="5895121">b</span><span class="op" id="5895122">.</span><span class="builtintype" id="5895123">uint32</span><span class="op" id="5895129">(</span><span class="op" id="5895130">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895143">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5895167">d</span><span class="op" id="5895168">.</span><span class="ident" id="5895169">dirDiskNbr</span>&nbsp;<span class="op" id="5895180">=</span>&nbsp;<span class="ident" id="5895182">b</span><span class="op" id="5895183">.</span><span class="builtintype" id="5895184">uint32</span><span class="op" id="5895190">(</span><span class="op" id="5895191">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895201">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5895264">d</span><span class="op" id="5895265">.</span><span class="ident" id="5895266">dirRecordsThisDisk</span>&nbsp;<span class="op" id="5895285">=</span>&nbsp;<span class="ident" id="5895287">b</span><span class="op" id="5895288">.</span><span class="ident" id="5895289">uint64</span><span class="op" id="5895295">(</span><span class="op" id="5895296">)</span>&nbsp;<span class="comment" id="5895298">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5895364">d</span><span class="op" id="5895365">.</span><span class="ident" id="5895366">directoryRecords</span>&nbsp;<span class="op" id="5895383">=</span>&nbsp;<span class="ident" id="5895385">b</span><span class="op" id="5895386">.</span><span class="ident" id="5895387">uint64</span><span class="op" id="5895393">(</span><span class="op" id="5895394">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5895398">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5895451">d</span><span class="op" id="5895452">.</span><span class="ident" id="5895453">directorySize</span>&nbsp;<span class="op" id="5895467">=</span>&nbsp;<span class="ident" id="5895469">b</span><span class="op" id="5895470">.</span><span class="ident" id="5895471">uint64</span><span class="op" id="5895477">(</span><span class="op" id="5895478">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895485">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5895519">d</span><span class="op" id="5895520">.</span><span class="ident" id="5895521">directoryOffset</span>&nbsp;<span class="op" id="5895537">=</span>&nbsp;<span class="ident" id="5895539">b</span><span class="op" id="5895540">.</span><span class="ident" id="5895541">uint64</span><span class="op" id="5895547">(</span><span class="op" id="5895548">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5895553">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5895636">return</span>&nbsp;<span class="ident" id="5895643">nil</span><br>
<span class="lineno"></span><span class="op" id="5895647">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="5895650">func</span>&nbsp;<span class="ident" id="5895655">findSignatureInBlock</span><span class="op" id="5895675">(</span><span class="ident" id="5895676">b</span>&nbsp;<span class="op" id="5895678">[</span><span class="op" id="5895679">]</span><span class="builtintype" id="5895680">byte</span><span class="op" id="5895684">)</span>&nbsp;<span class="builtintype" id="5895686">int</span>&nbsp;<span class="op" id="5895690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5895693">for</span>&nbsp;<span class="ident" id="5895697">i</span>&nbsp;<span class="op" id="5895699">:=</span>&nbsp;<span class="builtinfunc" id="5895702">len</span><span class="op" id="5895705">(</span><span class="ident" id="5895706">b</span><span class="op" id="5895707">)</span>&nbsp;<span class="op" id="5895709">-</span>&nbsp;<span class="ident" id="5895711">directoryEndLen</span><span class="op" id="5895726">;</span>&nbsp;<span class="ident" id="5895728">i</span>&nbsp;<span class="op" id="5895730">&gt;=</span>&nbsp;<span class="num" id="5895733">0</span><span class="op" id="5895734">;</span>&nbsp;<span class="ident" id="5895736">i</span><span class="op" id="5895737">--</span>&nbsp;<span class="op" id="5895740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5895744">//&nbsp;defined&nbsp;from&nbsp;directoryEndSignature&nbsp;in&nbsp;struct.go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5895797">if</span>&nbsp;<span class="ident" id="5895800">b</span><span class="op" id="5895801">[</span><span class="ident" id="5895802">i</span><span class="op" id="5895803">]</span>&nbsp;<span class="op" id="5895805">==</span>&nbsp;<span class="string" id="5895808">&#39;P&#39;</span>&nbsp;<span class="op" id="5895812">&amp;&amp;</span>&nbsp;<span class="ident" id="5895815">b</span><span class="op" id="5895816">[</span><span class="ident" id="5895817">i</span><span class="op" id="5895818">+</span><span class="num" id="5895819">1</span><span class="op" id="5895820">]</span>&nbsp;<span class="op" id="5895822">==</span>&nbsp;<span class="string" id="5895825">&#39;K&#39;</span>&nbsp;<span class="op" id="5895829">&amp;&amp;</span>&nbsp;<span class="ident" id="5895832">b</span><span class="op" id="5895833">[</span><span class="ident" id="5895834">i</span><span class="op" id="5895835">+</span><span class="num" id="5895836">2</span><span class="op" id="5895837">]</span>&nbsp;<span class="op" id="5895839">==</span>&nbsp;<span class="num" id="5895842">0x05</span>&nbsp;<span class="op" id="5895847">&amp;&amp;</span>&nbsp;<span class="ident" id="5895850">b</span><span class="op" id="5895851">[</span><span class="ident" id="5895852">i</span><span class="op" id="5895853">+</span><span class="num" id="5895854">3</span><span class="op" id="5895855">]</span>&nbsp;<span class="op" id="5895857">==</span>&nbsp;<span class="num" id="5895860">0x06</span>&nbsp;<span class="op" id="5895865">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5895870">//&nbsp;n&nbsp;is&nbsp;length&nbsp;of&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5895899">n</span>&nbsp;<span class="op" id="5895901">:=</span>&nbsp;<span class="builtintype" id="5895904">int</span><span class="op" id="5895907">(</span><span class="ident" id="5895908">b</span><span class="op" id="5895909">[</span><span class="ident" id="5895910">i</span><span class="op" id="5895911">+</span><span class="ident" id="5895912">directoryEndLen</span><span class="op" id="5895927">-</span><span class="num" id="5895928">2</span><span class="op" id="5895929">]</span><span class="op" id="5895930">)</span>&nbsp;<span class="op" id="5895932">|</span>&nbsp;<span class="builtintype" id="5895934">int</span><span class="op" id="5895937">(</span><span class="ident" id="5895938">b</span><span class="op" id="5895939">[</span><span class="ident" id="5895940">i</span><span class="op" id="5895941">+</span><span class="ident" id="5895942">directoryEndLen</span><span class="op" id="5895957">-</span><span class="num" id="5895958">1</span><span class="op" id="5895959">]</span><span class="op" id="5895960">)</span><span class="op" id="5895961">&lt;&lt;</span><span class="num" id="5895963">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5895968">if</span>&nbsp;<span class="ident" id="5895971">n</span><span class="op" id="5895972">+</span><span class="ident" id="5895973">directoryEndLen</span><span class="op" id="5895988">+</span><span class="ident" id="5895989">i</span>&nbsp;<span class="op" id="5895991">&lt;=</span>&nbsp;<span class="builtinfunc" id="5895994">len</span><span class="op" id="5895997">(</span><span class="ident" id="5895998">b</span><span class="op" id="5895999">)</span>&nbsp;<span class="op" id="5896001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896007">return</span>&nbsp;<span class="ident" id="5896014">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5896019">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5896023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5896026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896029">return</span>&nbsp;<span class="op" id="5896036">-</span><span class="num" id="5896037">1</span><br>
<span class="lineno"></span><span class="op" id="5896039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="5896042">type</span>&nbsp;<span class="ident" id="5896047">readBuf</span>&nbsp;<span class="op" id="5896055">[</span><span class="op" id="5896056">]</span><span class="builtintype" id="5896057">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5896063">func</span>&nbsp;<span class="op" id="5896068">(</span><span class="ident" id="5896069">b</span>&nbsp;<span class="op" id="5896071">*</span><span class="ident" id="5896072">readBuf</span><span class="op" id="5896079">)</span>&nbsp;<span class="builtintype" id="5896081">uint16</span><span class="op" id="5896087">(</span><span class="op" id="5896088">)</span>&nbsp;<span class="builtintype" id="5896090">uint16</span>&nbsp;<span class="op" id="5896097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5896100">v</span>&nbsp;<span class="op" id="5896102">:=</span>&nbsp;<span class="ident" id="5896105">binary</span><span class="op" id="5896111">.</span><span class="ident" id="5896112">LittleEndian</span><span class="op" id="5896124">.</span><span class="ident" id="5896125">Uint16</span><span class="op" id="5896131">(</span><span class="op" id="5896132">*</span><span class="ident" id="5896133">b</span><span class="op" id="5896134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5896137">*</span><span class="ident" id="5896138">b</span>&nbsp;<span class="op" id="5896140">=</span>&nbsp;<span class="op" id="5896142">(</span><span class="op" id="5896143">*</span><span class="ident" id="5896144">b</span><span class="op" id="5896145">)</span><span class="op" id="5896146">[</span><span class="num" id="5896147">2</span><span class="op" id="5896148">:</span><span class="op" id="5896149">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896152">return</span>&nbsp;<span class="ident" id="5896159">v</span><br>
<span class="lineno"></span><span class="op" id="5896161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5896164">func</span>&nbsp;<span class="op" id="5896169">(</span><span class="ident" id="5896170">b</span>&nbsp;<span class="op" id="5896172">*</span><span class="ident" id="5896173">readBuf</span><span class="op" id="5896180">)</span>&nbsp;<span class="builtintype" id="5896182">uint32</span><span class="op" id="5896188">(</span><span class="op" id="5896189">)</span>&nbsp;<span class="builtintype" id="5896191">uint32</span>&nbsp;<span class="op" id="5896198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5896201">v</span>&nbsp;<span class="op" id="5896203">:=</span>&nbsp;<span class="ident" id="5896206">binary</span><span class="op" id="5896212">.</span><span class="ident" id="5896213">LittleEndian</span><span class="op" id="5896225">.</span><span class="ident" id="5896226">Uint32</span><span class="op" id="5896232">(</span><span class="op" id="5896233">*</span><span class="ident" id="5896234">b</span><span class="op" id="5896235">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5896238">*</span><span class="ident" id="5896239">b</span>&nbsp;<span class="op" id="5896241">=</span>&nbsp;<span class="op" id="5896243">(</span><span class="op" id="5896244">*</span><span class="ident" id="5896245">b</span><span class="op" id="5896246">)</span><span class="op" id="5896247">[</span><span class="num" id="5896248">4</span><span class="op" id="5896249">:</span><span class="op" id="5896250">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896253">return</span>&nbsp;<span class="ident" id="5896260">v</span><br>
<span class="lineno"></span><span class="op" id="5896262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5896265">func</span>&nbsp;<span class="op" id="5896270">(</span><span class="ident" id="5896271">b</span>&nbsp;<span class="op" id="5896273">*</span><span class="ident" id="5896274">readBuf</span><span class="op" id="5896281">)</span>&nbsp;<span class="ident" id="5896283">uint64</span><span class="op" id="5896289">(</span><span class="op" id="5896290">)</span>&nbsp;<span class="ident" id="5896292">uint64</span>&nbsp;<span class="op" id="5896299">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5896302">v</span>&nbsp;<span class="op" id="5896304">:=</span>&nbsp;<span class="ident" id="5896307">binary</span><span class="op" id="5896313">.</span><span class="ident" id="5896314">LittleEndian</span><span class="op" id="5896326">.</span><span class="ident" id="5896327">Uint64</span><span class="op" id="5896333">(</span><span class="op" id="5896334">*</span><span class="ident" id="5896335">b</span><span class="op" id="5896336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5896339">*</span><span class="ident" id="5896340">b</span>&nbsp;<span class="op" id="5896342">=</span>&nbsp;<span class="op" id="5896344">(</span><span class="op" id="5896345">*</span><span class="ident" id="5896346">b</span><span class="op" id="5896347">)</span><span class="op" id="5896348">[</span><span class="num" id="5896349">8</span><span class="op" id="5896350">:</span><span class="op" id="5896351">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5896354">return</span>&nbsp;<span class="ident" id="5896361">v</span><br>
<span class="lineno"></span><span class="op" id="5896363">}</span>
</div>
</body>
</html>
