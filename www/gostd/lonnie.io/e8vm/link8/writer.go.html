<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/link8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/link8/func.go.html">func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/layout.go.html">layout.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/link.go.html">link.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/linker.go.html">linker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/package.go.html">package.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/pkg_sym.go.html">pkg_sym.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/symbol.go.html">symbol.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/trace_used.go.html">trace_used.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/var.go.html">var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="3682570">package</span>&nbsp;<span class="ident" id="3682578">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3682585">import</span>&nbsp;<span class="op" id="3682592">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3682595">&#34;bytes&#34;</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3682605">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span><span class="op" id="3682623">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3682626">type</span>&nbsp;<span class="ident" id="3682631">writer</span>&nbsp;<span class="keyword" id="3682638">struct</span>&nbsp;<span class="op" id="3682645">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3682648">buf</span>&nbsp;<span class="op" id="3682652">*</span><span class="ident" id="3682653">bytes</span><span class="op" id="3682658">.</span><span class="ident" id="3682659">Buffer</span><br>
<span class="lineno"></span><span class="op" id="3682666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3682669">func</span>&nbsp;<span class="ident" id="3682674">newWriter</span><span class="op" id="3682683">(</span><span class="op" id="3682684">)</span>&nbsp;<span class="op" id="3682686">*</span><span class="ident" id="3682687">writer</span>&nbsp;<span class="op" id="3682694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3682697">ret</span>&nbsp;<span class="op" id="3682701">:=</span>&nbsp;<span class="builtinfunc" id="3682704">new</span><span class="op" id="3682707">(</span><span class="ident" id="3682708">writer</span><span class="op" id="3682714">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3682717">ret</span><span class="op" id="3682720">.</span><span class="ident" id="3682721">buf</span>&nbsp;<span class="op" id="3682725">=</span>&nbsp;<span class="builtinfunc" id="3682727">new</span><span class="op" id="3682730">(</span><span class="ident" id="3682731">bytes</span><span class="op" id="3682736">.</span><span class="ident" id="3682737">Buffer</span><span class="op" id="3682743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3682746">return</span>&nbsp;<span class="ident" id="3682753">ret</span><br>
<span class="lineno"></span><span class="op" id="3682757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3682760">func</span>&nbsp;<span class="op" id="3682765">(</span><span class="ident" id="3682766">w</span>&nbsp;<span class="op" id="3682768">*</span><span class="ident" id="3682769">writer</span><span class="op" id="3682775">)</span>&nbsp;<span class="ident" id="3682777">writeU32</span><span class="op" id="3682785">(</span><span class="ident" id="3682786">u</span>&nbsp;<span class="builtintype" id="3682788">uint32</span><span class="op" id="3682794">)</span>&nbsp;<span class="op" id="3682796">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3682799">var</span>&nbsp;<span class="ident" id="3682803">b</span>&nbsp;<span class="op" id="3682805">[</span><span class="num" id="3682806">4</span><span class="op" id="3682807">]</span><span class="builtintype" id="3682808">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3682814">binary</span><span class="op" id="3682820">.</span><span class="ident" id="3682821">LittleEndian</span><span class="op" id="3682833">.</span><span class="ident" id="3682834">PutUint32</span><span class="op" id="3682843">(</span><span class="ident" id="3682844">b</span><span class="op" id="3682845">[</span><span class="op" id="3682846">:</span><span class="op" id="3682847">]</span><span class="op" id="3682848">,</span>&nbsp;<span class="ident" id="3682850">u</span><span class="op" id="3682851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3682854">_</span><span class="op" id="3682855">,</span>&nbsp;<span class="ident" id="3682857">e</span>&nbsp;<span class="op" id="3682859">:=</span>&nbsp;<span class="ident" id="3682862">w</span><span class="op" id="3682863">.</span><span class="ident" id="3682864">buf</span><span class="op" id="3682867">.</span><span class="ident" id="3682868">Write</span><span class="op" id="3682873">(</span><span class="ident" id="3682874">b</span><span class="op" id="3682875">[</span><span class="op" id="3682876">:</span><span class="op" id="3682877">]</span><span class="op" id="3682878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3682881">if</span>&nbsp;<span class="ident" id="3682884">e</span>&nbsp;<span class="op" id="3682886">!=</span>&nbsp;<span class="ident" id="3682889">nil</span>&nbsp;<span class="op" id="3682893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3682897">panic</span><span class="op" id="3682902">(</span><span class="string" id="3682903">&#34;buf&nbsp;write&#34;</span><span class="op" id="3682914">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3682917">}</span><br>
<span class="lineno"></span><span class="op" id="3682919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3682922">func</span>&nbsp;<span class="op" id="3682927">(</span><span class="ident" id="3682928">w</span>&nbsp;<span class="op" id="3682930">*</span><span class="ident" id="3682931">writer</span><span class="op" id="3682937">)</span>&nbsp;<span class="ident" id="3682939">writeBareFunc</span><span class="op" id="3682952">(</span><span class="ident" id="3682953">f</span>&nbsp;<span class="op" id="3682955">*</span><span class="ident" id="3682956">Func</span><span class="op" id="3682960">)</span>&nbsp;<span class="op" id="3682962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3682965">if</span>&nbsp;<span class="builtinfunc" id="3682968">len</span><span class="op" id="3682971">(</span><span class="ident" id="3682972">f</span><span class="op" id="3682973">.</span><span class="ident" id="3682974">links</span><span class="op" id="3682979">)</span>&nbsp;<span class="op" id="3682981">!=</span>&nbsp;<span class="num" id="3682984">0</span>&nbsp;<span class="op" id="3682986">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3682990">panic</span><span class="op" id="3682995">(</span><span class="string" id="3682996">&#34;not&nbsp;a&nbsp;bare&nbsp;function&#34;</span><span class="op" id="3683017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3683020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683024">for</span>&nbsp;<span class="ident" id="3683028">_</span><span class="op" id="3683029">,</span>&nbsp;<span class="ident" id="3683031">i</span>&nbsp;<span class="op" id="3683033">:=</span>&nbsp;<span class="keyword" id="3683036">range</span>&nbsp;<span class="ident" id="3683042">f</span><span class="op" id="3683043">.</span><span class="ident" id="3683044">insts</span>&nbsp;<span class="op" id="3683050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683054">w</span><span class="op" id="3683055">.</span><span class="ident" id="3683056">writeU32</span><span class="op" id="3683064">(</span><span class="ident" id="3683065">i</span><span class="op" id="3683066">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3683069">}</span><br>
<span class="lineno"></span><span class="op" id="3683071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3683074">func</span>&nbsp;<span class="op" id="3683079">(</span><span class="ident" id="3683080">w</span>&nbsp;<span class="op" id="3683082">*</span><span class="ident" id="3683083">writer</span><span class="op" id="3683089">)</span>&nbsp;<span class="ident" id="3683091">bytes</span><span class="op" id="3683096">(</span><span class="op" id="3683097">)</span>&nbsp;<span class="op" id="3683099">[</span><span class="op" id="3683100">]</span><span class="builtintype" id="3683101">byte</span>&nbsp;<span class="op" id="3683106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683109">return</span>&nbsp;<span class="ident" id="3683116">w</span><span class="op" id="3683117">.</span><span class="ident" id="3683118">buf</span><span class="op" id="3683121">.</span><span class="ident" id="3683122">Bytes</span><span class="op" id="3683127">(</span><span class="op" id="3683128">)</span><br>
<span class="lineno">40</span><span class="op" id="3683130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3683133">func</span>&nbsp;<span class="ident" id="3683138">writeVar</span><span class="op" id="3683146">(</span><span class="ident" id="3683147">w</span>&nbsp;<span class="op" id="3683149">*</span><span class="ident" id="3683150">writer</span><span class="op" id="3683156">,</span>&nbsp;<span class="ident" id="3683158">v</span>&nbsp;<span class="op" id="3683160">*</span><span class="ident" id="3683161">Var</span><span class="op" id="3683164">)</span>&nbsp;<span class="op" id="3683166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683169">w</span><span class="op" id="3683170">.</span><span class="ident" id="3683171">buf</span><span class="op" id="3683174">.</span><span class="ident" id="3683175">Write</span><span class="op" id="3683180">(</span><span class="builtinfunc" id="3683181">make</span><span class="op" id="3683185">(</span><span class="op" id="3683186">[</span><span class="op" id="3683187">]</span><span class="builtintype" id="3683188">byte</span><span class="op" id="3683192">,</span>&nbsp;<span class="ident" id="3683194">v</span><span class="op" id="3683195">.</span><span class="ident" id="3683196">prePad</span><span class="op" id="3683202">)</span><span class="op" id="3683203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683206">w</span><span class="op" id="3683207">.</span><span class="ident" id="3683208">buf</span><span class="op" id="3683211">.</span><span class="ident" id="3683212">Write</span><span class="op" id="3683217">(</span><span class="ident" id="3683218">v</span><span class="op" id="3683219">.</span><span class="ident" id="3683220">buf</span><span class="op" id="3683223">.</span><span class="ident" id="3683224">Bytes</span><span class="op" id="3683229">(</span><span class="op" id="3683230">)</span><span class="op" id="3683231">)</span><br>
<span class="lineno">45</span><span class="op" id="3683233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3683236">func</span>&nbsp;<span class="ident" id="3683241">writeFunc</span><span class="op" id="3683250">(</span><span class="ident" id="3683251">w</span>&nbsp;<span class="op" id="3683253">*</span><span class="ident" id="3683254">writer</span><span class="op" id="3683260">,</span>&nbsp;<span class="ident" id="3683262">p</span>&nbsp;<span class="op" id="3683264">*</span><span class="ident" id="3683265">Package</span><span class="op" id="3683272">,</span>&nbsp;<span class="ident" id="3683274">f</span>&nbsp;<span class="op" id="3683276">*</span><span class="ident" id="3683277">Func</span><span class="op" id="3683281">)</span>&nbsp;<span class="op" id="3683283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683286">cur</span>&nbsp;<span class="op" id="3683290">:=</span>&nbsp;<span class="num" id="3683293">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683296">var</span>&nbsp;<span class="ident" id="3683300">curLink</span>&nbsp;<span class="op" id="3683308">*</span><span class="ident" id="3683309">link</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683315">var</span>&nbsp;<span class="ident" id="3683319">curIndex</span>&nbsp;<span class="builtintype" id="3683328">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683333">updateCur</span>&nbsp;<span class="op" id="3683343">:=</span>&nbsp;<span class="keyword" id="3683346">func</span><span class="op" id="3683350">(</span><span class="op" id="3683351">)</span>&nbsp;<span class="op" id="3683353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683357">if</span>&nbsp;<span class="ident" id="3683360">cur</span>&nbsp;<span class="op" id="3683364">&lt;</span>&nbsp;<span class="builtinfunc" id="3683366">len</span><span class="op" id="3683369">(</span><span class="ident" id="3683370">f</span><span class="op" id="3683371">.</span><span class="ident" id="3683372">links</span><span class="op" id="3683377">)</span>&nbsp;<span class="op" id="3683379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683384">curLink</span>&nbsp;<span class="op" id="3683392">=</span>&nbsp;<span class="ident" id="3683394">f</span><span class="op" id="3683395">.</span><span class="ident" id="3683396">links</span><span class="op" id="3683401">[</span><span class="ident" id="3683402">cur</span><span class="op" id="3683405">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683410">curIndex</span>&nbsp;<span class="op" id="3683419">=</span>&nbsp;<span class="builtintype" id="3683421">int</span><span class="op" id="3683424">(</span><span class="ident" id="3683425">curLink</span><span class="op" id="3683432">.</span><span class="ident" id="3683433">offset</span>&nbsp;<span class="op" id="3683440">&gt;&gt;</span>&nbsp;<span class="num" id="3683443">2</span><span class="op" id="3683444">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3683448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3683451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683455">updateCur</span><span class="op" id="3683464">(</span><span class="op" id="3683465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683468">for</span>&nbsp;<span class="ident" id="3683472">i</span><span class="op" id="3683473">,</span>&nbsp;<span class="ident" id="3683475">inst</span>&nbsp;<span class="op" id="3683480">:=</span>&nbsp;<span class="keyword" id="3683483">range</span>&nbsp;<span class="ident" id="3683489">f</span><span class="op" id="3683490">.</span><span class="ident" id="3683491">insts</span>&nbsp;<span class="op" id="3683497">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683501">if</span>&nbsp;<span class="ident" id="3683504">curLink</span>&nbsp;<span class="op" id="3683512">!=</span>&nbsp;<span class="ident" id="3683515">nil</span>&nbsp;<span class="op" id="3683519">&amp;&amp;</span>&nbsp;<span class="ident" id="3683522">i</span>&nbsp;<span class="op" id="3683524">==</span>&nbsp;<span class="ident" id="3683527">curIndex</span>&nbsp;<span class="op" id="3683536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683541">fill</span>&nbsp;<span class="op" id="3683546">:=</span>&nbsp;<span class="ident" id="3683549">curLink</span><span class="op" id="3683556">.</span><span class="ident" id="3683557">offset</span>&nbsp;<span class="op" id="3683564">&amp;</span>&nbsp;<span class="num" id="3683566">0x3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683573">if</span>&nbsp;<span class="ident" id="3683576">fill</span>&nbsp;<span class="op" id="3683581">==</span>&nbsp;<span class="ident" id="3683584">FillLink</span>&nbsp;<span class="op" id="3683593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683599">if</span>&nbsp;<span class="op" id="3683602">(</span><span class="ident" id="3683603">inst</span>&nbsp;<span class="op" id="3683608">&gt;&gt;</span>&nbsp;<span class="num" id="3683611">31</span><span class="op" id="3683613">)</span>&nbsp;<span class="op" id="3683615">!=</span>&nbsp;<span class="num" id="3683618">0x1</span>&nbsp;<span class="op" id="3683622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3683629">panic</span><span class="op" id="3683634">(</span><span class="string" id="3683635">&#34;not&nbsp;a&nbsp;jump&#34;</span><span class="op" id="3683647">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3683653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683659">if</span>&nbsp;<span class="op" id="3683662">(</span><span class="ident" id="3683663">inst</span>&nbsp;<span class="op" id="3683668">&amp;</span>&nbsp;<span class="num" id="3683670">0x3fffffff</span><span class="op" id="3683680">)</span>&nbsp;<span class="op" id="3683682">!=</span>&nbsp;<span class="num" id="3683685">0</span>&nbsp;<span class="op" id="3683687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3683694">panic</span><span class="op" id="3683699">(</span><span class="string" id="3683700">&#34;already&nbsp;filled&#34;</span><span class="op" id="3683716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3683722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683729">pc</span>&nbsp;<span class="op" id="3683732">:=</span>&nbsp;<span class="ident" id="3683735">f</span><span class="op" id="3683736">.</span><span class="ident" id="3683737">addr</span>&nbsp;<span class="op" id="3683742">+</span>&nbsp;<span class="builtintype" id="3683744">uint32</span><span class="op" id="3683750">(</span><span class="ident" id="3683751">i</span><span class="op" id="3683752">)</span><span class="op" id="3683753">*</span><span class="num" id="3683754">4</span>&nbsp;<span class="op" id="3683756">+</span>&nbsp;<span class="num" id="3683758">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683764">target</span>&nbsp;<span class="op" id="3683771">:=</span>&nbsp;<span class="ident" id="3683774">p</span><span class="op" id="3683775">.</span><span class="ident" id="3683776">requires</span><span class="op" id="3683784">[</span><span class="ident" id="3683785">curLink</span><span class="op" id="3683792">.</span><span class="ident" id="3683793">pkg</span><span class="op" id="3683796">]</span><span class="op" id="3683797">.</span><span class="ident" id="3683798">Func</span><span class="op" id="3683802">(</span><span class="ident" id="3683803">curLink</span><span class="op" id="3683810">.</span><span class="ident" id="3683811">sym</span><span class="op" id="3683814">)</span><span class="op" id="3683815">.</span><span class="ident" id="3683816">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683825">inst</span>&nbsp;<span class="op" id="3683830">|=</span>&nbsp;<span class="op" id="3683833">(</span><span class="ident" id="3683834">target</span>&nbsp;<span class="op" id="3683841">-</span>&nbsp;<span class="ident" id="3683843">pc</span><span class="op" id="3683845">)</span>&nbsp;<span class="op" id="3683847">&gt;&gt;</span>&nbsp;<span class="num" id="3683850">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3683855">}</span>&nbsp;<span class="keyword" id="3683857">else</span>&nbsp;<span class="keyword" id="3683862">if</span>&nbsp;<span class="ident" id="3683865">fill</span>&nbsp;<span class="op" id="3683870">==</span>&nbsp;<span class="ident" id="3683873">FillHigh</span>&nbsp;<span class="op" id="3683882">||</span>&nbsp;<span class="ident" id="3683885">fill</span>&nbsp;<span class="op" id="3683890">==</span>&nbsp;<span class="ident" id="3683893">FillLow</span>&nbsp;<span class="op" id="3683901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3683907">if</span>&nbsp;<span class="op" id="3683910">(</span><span class="ident" id="3683911">inst</span>&nbsp;<span class="op" id="3683916">&amp;</span>&nbsp;<span class="num" id="3683918">0xffff</span><span class="op" id="3683924">)</span>&nbsp;<span class="op" id="3683926">!=</span>&nbsp;<span class="num" id="3683929">0</span>&nbsp;<span class="op" id="3683931">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3683938">panic</span><span class="op" id="3683943">(</span><span class="string" id="3683944">&#34;already&nbsp;filled&#34;</span><span class="op" id="3683960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3683966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3683973">pkg</span>&nbsp;<span class="op" id="3683977">:=</span>&nbsp;<span class="ident" id="3683980">p</span><span class="op" id="3683981">.</span><span class="ident" id="3683982">requires</span><span class="op" id="3683990">[</span><span class="ident" id="3683991">curLink</span><span class="op" id="3683998">.</span><span class="ident" id="3683999">pkg</span><span class="op" id="3684002">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684008">sym</span>&nbsp;<span class="op" id="3684012">:=</span>&nbsp;<span class="ident" id="3684015">pkg</span><span class="op" id="3684018">.</span><span class="ident" id="3684019">symbols</span><span class="op" id="3684026">[</span><span class="ident" id="3684027">curLink</span><span class="op" id="3684034">.</span><span class="ident" id="3684035">sym</span><span class="op" id="3684038">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684044">var</span>&nbsp;<span class="ident" id="3684048">v</span>&nbsp;<span class="builtintype" id="3684050">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684061">switch</span>&nbsp;<span class="ident" id="3684068">sym</span><span class="op" id="3684071">.</span><span class="ident" id="3684072">Type</span>&nbsp;<span class="op" id="3684077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684083">case</span>&nbsp;<span class="ident" id="3684088">SymFunc</span><span class="op" id="3684095">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684102">v</span>&nbsp;<span class="op" id="3684104">=</span>&nbsp;<span class="ident" id="3684106">pkg</span><span class="op" id="3684109">.</span><span class="ident" id="3684110">Func</span><span class="op" id="3684114">(</span><span class="ident" id="3684115">curLink</span><span class="op" id="3684122">.</span><span class="ident" id="3684123">sym</span><span class="op" id="3684126">)</span><span class="op" id="3684127">.</span><span class="ident" id="3684128">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684137">case</span>&nbsp;<span class="ident" id="3684142">SymVar</span><span class="op" id="3684148">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684155">v</span>&nbsp;<span class="op" id="3684157">=</span>&nbsp;<span class="ident" id="3684159">pkg</span><span class="op" id="3684162">.</span><span class="ident" id="3684163">Var</span><span class="op" id="3684166">(</span><span class="ident" id="3684167">curLink</span><span class="op" id="3684174">.</span><span class="ident" id="3684175">sym</span><span class="op" id="3684178">)</span><span class="op" id="3684179">.</span><span class="ident" id="3684180">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684189">default</span><span class="op" id="3684196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3684203">panic</span><span class="op" id="3684208">(</span><span class="string" id="3684209">&#34;bug&#34;</span><span class="op" id="3684214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3684220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3684227">if</span>&nbsp;<span class="ident" id="3684230">fill</span>&nbsp;<span class="op" id="3684235">==</span>&nbsp;<span class="ident" id="3684238">FillHigh</span>&nbsp;<span class="op" id="3684247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684254">inst</span>&nbsp;<span class="op" id="3684259">|=</span>&nbsp;<span class="ident" id="3684262">v</span>&nbsp;<span class="op" id="3684264">&gt;&gt;</span>&nbsp;<span class="num" id="3684267">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3684274">}</span>&nbsp;<span class="keyword" id="3684276">else</span>&nbsp;<span class="op" id="3684281">{</span>&nbsp;<span class="comment" id="3684283">//&nbsp;fillLow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684299">inst</span>&nbsp;<span class="op" id="3684304">|=</span>&nbsp;<span class="ident" id="3684307">v</span>&nbsp;<span class="op" id="3684309">&amp;</span>&nbsp;<span class="num" id="3684311">0xffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3684322">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3684327">}</span>&nbsp;<span class="keyword" id="3684329">else</span>&nbsp;<span class="op" id="3684334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3684340">panic</span><span class="op" id="3684345">(</span><span class="string" id="3684346">&#34;invalid&nbsp;fill&#34;</span><span class="op" id="3684360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3684365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684371">cur</span><span class="op" id="3684374">++</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684380">updateCur</span><span class="op" id="3684389">(</span><span class="op" id="3684390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3684394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3684399">w</span><span class="op" id="3684400">.</span><span class="ident" id="3684401">writeU32</span><span class="op" id="3684409">(</span><span class="ident" id="3684410">inst</span><span class="op" id="3684414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3684417">}</span><br>
<span class="lineno">105</span><span class="op" id="3684419">}</span>
</div>
</body>
</html>
