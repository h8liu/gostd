<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html" class="current">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3834272">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3834328">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3834382">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3834433">package</span>&nbsp;<span class="ident" id="3834441">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3834446">import</span>&nbsp;<span class="op" id="3834453">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3834456">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3834466">&#34;time&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3834473">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3834476">//&nbsp;A&nbsp;Dialer&nbsp;contains&nbsp;options&nbsp;for&nbsp;connecting&nbsp;to&nbsp;an&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3834535">//</span><br>
<span class="lineno"></span><span class="comment" id="3834538">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;each&nbsp;field&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;dialing</span><br>
<span class="lineno">15</span><span class="comment" id="3834596">//&nbsp;without&nbsp;that&nbsp;option.&nbsp;Dialing&nbsp;with&nbsp;the&nbsp;zero&nbsp;value&nbsp;of&nbsp;Dialer</span><br>
<span class="lineno"></span><span class="comment" id="3834658">//&nbsp;is&nbsp;therefore&nbsp;equivalent&nbsp;to&nbsp;just&nbsp;calling&nbsp;the&nbsp;Dial&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="3834720">type</span>&nbsp;<span class="ident" id="3834725">Dialer</span>&nbsp;<span class="keyword" id="3834732">struct</span>&nbsp;<span class="op" id="3834739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3834742">//&nbsp;Timeout&nbsp;is&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;time&nbsp;a&nbsp;dial&nbsp;will&nbsp;wait&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3834805">//&nbsp;a&nbsp;connect&nbsp;to&nbsp;complete.&nbsp;If&nbsp;Deadline&nbsp;is&nbsp;also&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3834869">//&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3834882">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3834886">//&nbsp;The&nbsp;default&nbsp;is&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3834917">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3834921">//&nbsp;With&nbsp;or&nbsp;without&nbsp;a&nbsp;timeout,&nbsp;the&nbsp;operating&nbsp;system&nbsp;may&nbsp;impose</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3834984">//&nbsp;its&nbsp;own&nbsp;earlier&nbsp;timeout.&nbsp;For&nbsp;instance,&nbsp;TCP&nbsp;timeouts&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835044">//&nbsp;often&nbsp;around&nbsp;3&nbsp;minutes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3835072">Timeout</span>&nbsp;<span class="ident" id="3835080">time</span><span class="op" id="3835084">.</span><span class="ident" id="3835085">Duration</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835096">//&nbsp;Deadline&nbsp;is&nbsp;the&nbsp;absolute&nbsp;point&nbsp;in&nbsp;time&nbsp;after&nbsp;which&nbsp;dials</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835157">//&nbsp;will&nbsp;fail.&nbsp;If&nbsp;Timeout&nbsp;is&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835212">//&nbsp;Zero&nbsp;means&nbsp;no&nbsp;deadline,&nbsp;or&nbsp;dependent&nbsp;on&nbsp;the&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835277">//&nbsp;as&nbsp;with&nbsp;the&nbsp;Timeout&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3835309">Deadline</span>&nbsp;<span class="ident" id="3835318">time</span><span class="op" id="3835322">.</span><span class="ident" id="3835323">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835330">//&nbsp;LocalAddr&nbsp;is&nbsp;the&nbsp;local&nbsp;address&nbsp;to&nbsp;use&nbsp;when&nbsp;dialing&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835388">//&nbsp;address.&nbsp;The&nbsp;address&nbsp;must&nbsp;be&nbsp;of&nbsp;a&nbsp;compatible&nbsp;type&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835450">//&nbsp;network&nbsp;being&nbsp;dialed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835476">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;local&nbsp;address&nbsp;is&nbsp;automatically&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3835529">LocalAddr</span>&nbsp;<span class="ident" id="3835539">Addr</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835546">//&nbsp;DualStack&nbsp;allows&nbsp;a&nbsp;single&nbsp;dial&nbsp;to&nbsp;attempt&nbsp;to&nbsp;establish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835605">//&nbsp;multiple&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections&nbsp;and&nbsp;to&nbsp;return&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835668">//&nbsp;established&nbsp;connection&nbsp;when&nbsp;the&nbsp;network&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835729">//&nbsp;destination&nbsp;is&nbsp;a&nbsp;host&nbsp;name&nbsp;that&nbsp;has&nbsp;multiple&nbsp;address&nbsp;family</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835793">//&nbsp;DNS&nbsp;records.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3835810">DualStack</span>&nbsp;<span class="builtintype" id="3835820">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835827">//&nbsp;KeepAlive&nbsp;specifies&nbsp;the&nbsp;keep-alive&nbsp;period&nbsp;for&nbsp;an&nbsp;active</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835887">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835911">//&nbsp;If&nbsp;zero,&nbsp;keep-alives&nbsp;are&nbsp;not&nbsp;enabled.&nbsp;Network&nbsp;protocols</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3835971">//&nbsp;that&nbsp;do&nbsp;not&nbsp;support&nbsp;keep-alives&nbsp;ignore&nbsp;this&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836026">KeepAlive</span>&nbsp;<span class="ident" id="3836036">time</span><span class="op" id="3836040">.</span><span class="ident" id="3836041">Duration</span><br>
<span class="lineno"></span><span class="op" id="3836050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3836053">//&nbsp;Return&nbsp;either&nbsp;now+Timeout&nbsp;or&nbsp;Deadline,&nbsp;whichever&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="3836118">//&nbsp;Or&nbsp;zero,&nbsp;if&nbsp;neither&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3836149">func</span>&nbsp;<span class="op" id="3836154">(</span><span class="ident" id="3836155">d</span>&nbsp;<span class="op" id="3836157">*</span><span class="ident" id="3836158">Dialer</span><span class="op" id="3836164">)</span>&nbsp;<span class="ident" id="3836166">deadline</span><span class="op" id="3836174">(</span><span class="op" id="3836175">)</span>&nbsp;<span class="ident" id="3836177">time</span><span class="op" id="3836181">.</span><span class="ident" id="3836182">Time</span>&nbsp;<span class="op" id="3836187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836190">if</span>&nbsp;<span class="ident" id="3836193">d</span><span class="op" id="3836194">.</span><span class="ident" id="3836195">Timeout</span>&nbsp;<span class="op" id="3836203">==</span>&nbsp;<span class="num" id="3836206">0</span>&nbsp;<span class="op" id="3836208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836212">return</span>&nbsp;<span class="ident" id="3836219">d</span><span class="op" id="3836220">.</span><span class="ident" id="3836221">Deadline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836234">timeoutDeadline</span>&nbsp;<span class="op" id="3836250">:=</span>&nbsp;<span class="ident" id="3836253">time</span><span class="op" id="3836257">.</span><span class="ident" id="3836258">Now</span><span class="op" id="3836261">(</span><span class="op" id="3836262">)</span><span class="op" id="3836263">.</span><span class="ident" id="3836264">Add</span><span class="op" id="3836267">(</span><span class="ident" id="3836268">d</span><span class="op" id="3836269">.</span><span class="ident" id="3836270">Timeout</span><span class="op" id="3836277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836280">if</span>&nbsp;<span class="ident" id="3836283">d</span><span class="op" id="3836284">.</span><span class="ident" id="3836285">Deadline</span><span class="op" id="3836293">.</span><span class="ident" id="3836294">IsZero</span><span class="op" id="3836300">(</span><span class="op" id="3836301">)</span>&nbsp;<span class="op" id="3836303">||</span>&nbsp;<span class="ident" id="3836306">timeoutDeadline</span><span class="op" id="3836321">.</span><span class="ident" id="3836322">Before</span><span class="op" id="3836328">(</span><span class="ident" id="3836329">d</span><span class="op" id="3836330">.</span><span class="ident" id="3836331">Deadline</span><span class="op" id="3836339">)</span>&nbsp;<span class="op" id="3836341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836345">return</span>&nbsp;<span class="ident" id="3836352">timeoutDeadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836369">}</span>&nbsp;<span class="keyword" id="3836371">else</span>&nbsp;<span class="op" id="3836376">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836380">return</span>&nbsp;<span class="ident" id="3836387">d</span><span class="op" id="3836388">.</span><span class="ident" id="3836389">Deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836399">}</span><br>
<span class="lineno"></span><span class="op" id="3836401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3836404">func</span>&nbsp;<span class="ident" id="3836409">parseNetwork</span><span class="op" id="3836421">(</span><span class="ident" id="3836422">net</span>&nbsp;<span class="builtintype" id="3836426">string</span><span class="op" id="3836432">)</span>&nbsp;<span class="op" id="3836434">(</span><span class="ident" id="3836435">afnet</span>&nbsp;<span class="builtintype" id="3836441">string</span><span class="op" id="3836447">,</span>&nbsp;<span class="ident" id="3836449">proto</span>&nbsp;<span class="builtintype" id="3836455">int</span><span class="op" id="3836458">,</span>&nbsp;<span class="ident" id="3836460">err</span>&nbsp;<span class="builtintype" id="3836464">error</span><span class="op" id="3836469">)</span>&nbsp;<span class="op" id="3836471">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836474">i</span>&nbsp;<span class="op" id="3836476">:=</span>&nbsp;<span class="ident" id="3836479">last</span><span class="op" id="3836483">(</span><span class="ident" id="3836484">net</span><span class="op" id="3836487">,</span>&nbsp;<span class="string" id="3836489">&#39;:&#39;</span><span class="op" id="3836492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836495">if</span>&nbsp;<span class="ident" id="3836498">i</span>&nbsp;<span class="op" id="3836500">&lt;</span>&nbsp;<span class="num" id="3836502">0</span>&nbsp;<span class="op" id="3836504">{</span>&nbsp;<span class="comment" id="3836506">//&nbsp;no&nbsp;colon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836520">switch</span>&nbsp;<span class="ident" id="3836527">net</span>&nbsp;<span class="op" id="3836531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836535">case</span>&nbsp;<span class="string" id="3836540">&#34;tcp&#34;</span><span class="op" id="3836545">,</span>&nbsp;<span class="string" id="3836547">&#34;tcp4&#34;</span><span class="op" id="3836553">,</span>&nbsp;<span class="string" id="3836555">&#34;tcp6&#34;</span><span class="op" id="3836561">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836565">case</span>&nbsp;<span class="string" id="3836570">&#34;udp&#34;</span><span class="op" id="3836575">,</span>&nbsp;<span class="string" id="3836577">&#34;udp4&#34;</span><span class="op" id="3836583">,</span>&nbsp;<span class="string" id="3836585">&#34;udp6&#34;</span><span class="op" id="3836591">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836595">case</span>&nbsp;<span class="string" id="3836600">&#34;ip&#34;</span><span class="op" id="3836604">,</span>&nbsp;<span class="string" id="3836606">&#34;ip4&#34;</span><span class="op" id="3836611">,</span>&nbsp;<span class="string" id="3836613">&#34;ip6&#34;</span><span class="op" id="3836618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836622">case</span>&nbsp;<span class="string" id="3836627">&#34;unix&#34;</span><span class="op" id="3836633">,</span>&nbsp;<span class="string" id="3836635">&#34;unixgram&#34;</span><span class="op" id="3836645">,</span>&nbsp;<span class="string" id="3836647">&#34;unixpacket&#34;</span><span class="op" id="3836659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836663">default</span><span class="op" id="3836670">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836675">return</span>&nbsp;<span class="string" id="3836682">&#34;&#34;</span><span class="op" id="3836684">,</span>&nbsp;<span class="num" id="3836686">0</span><span class="op" id="3836687">,</span>&nbsp;<span class="ident" id="3836689">UnknownNetworkError</span><span class="op" id="3836708">(</span><span class="ident" id="3836709">net</span><span class="op" id="3836712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836716">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836720">return</span>&nbsp;<span class="ident" id="3836727">net</span><span class="op" id="3836730">,</span>&nbsp;<span class="num" id="3836732">0</span><span class="op" id="3836733">,</span>&nbsp;<span class="builtintype" id="3836735">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836743">afnet</span>&nbsp;<span class="op" id="3836749">=</span>&nbsp;<span class="ident" id="3836751">net</span><span class="op" id="3836754">[</span><span class="op" id="3836755">:</span><span class="ident" id="3836756">i</span><span class="op" id="3836757">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836760">switch</span>&nbsp;<span class="ident" id="3836767">afnet</span>&nbsp;<span class="op" id="3836773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836776">case</span>&nbsp;<span class="string" id="3836781">&#34;ip&#34;</span><span class="op" id="3836785">,</span>&nbsp;<span class="string" id="3836787">&#34;ip4&#34;</span><span class="op" id="3836792">,</span>&nbsp;<span class="string" id="3836794">&#34;ip6&#34;</span><span class="op" id="3836799">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836803">protostr</span>&nbsp;<span class="op" id="3836812">:=</span>&nbsp;<span class="ident" id="3836815">net</span><span class="op" id="3836818">[</span><span class="ident" id="3836819">i</span><span class="op" id="3836820">+</span><span class="num" id="3836821">1</span><span class="op" id="3836822">:</span><span class="op" id="3836823">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836827">proto</span><span class="op" id="3836832">,</span>&nbsp;<span class="ident" id="3836834">i</span><span class="op" id="3836835">,</span>&nbsp;<span class="ident" id="3836837">ok</span>&nbsp;<span class="op" id="3836840">:=</span>&nbsp;<span class="ident" id="3836843">dtoi</span><span class="op" id="3836847">(</span><span class="ident" id="3836848">protostr</span><span class="op" id="3836856">,</span>&nbsp;<span class="num" id="3836858">0</span><span class="op" id="3836859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836863">if</span>&nbsp;<span class="op" id="3836866">!</span><span class="ident" id="3836867">ok</span>&nbsp;<span class="op" id="3836870">||</span>&nbsp;<span class="ident" id="3836873">i</span>&nbsp;<span class="op" id="3836875">!=</span>&nbsp;<span class="builtinfunc" id="3836878">len</span><span class="op" id="3836881">(</span><span class="ident" id="3836882">protostr</span><span class="op" id="3836890">)</span>&nbsp;<span class="op" id="3836892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3836897">proto</span><span class="op" id="3836902">,</span>&nbsp;<span class="ident" id="3836904">err</span>&nbsp;<span class="op" id="3836908">=</span>&nbsp;<span class="ident" id="3836910">lookupProtocol</span><span class="op" id="3836924">(</span><span class="ident" id="3836925">protostr</span><span class="op" id="3836933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836938">if</span>&nbsp;<span class="ident" id="3836941">err</span>&nbsp;<span class="op" id="3836945">!=</span>&nbsp;<span class="builtintype" id="3836948">nil</span>&nbsp;<span class="op" id="3836952">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836958">return</span>&nbsp;<span class="string" id="3836965">&#34;&#34;</span><span class="op" id="3836967">,</span>&nbsp;<span class="num" id="3836969">0</span><span class="op" id="3836970">,</span>&nbsp;<span class="ident" id="3836972">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3836983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3836987">return</span>&nbsp;<span class="ident" id="3836994">afnet</span><span class="op" id="3836999">,</span>&nbsp;<span class="ident" id="3837001">proto</span><span class="op" id="3837006">,</span>&nbsp;<span class="builtintype" id="3837008">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3837013">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837016">return</span>&nbsp;<span class="string" id="3837023">&#34;&#34;</span><span class="op" id="3837025">,</span>&nbsp;<span class="num" id="3837027">0</span><span class="op" id="3837028">,</span>&nbsp;<span class="ident" id="3837030">UnknownNetworkError</span><span class="op" id="3837049">(</span><span class="ident" id="3837050">net</span><span class="op" id="3837053">)</span><br>
<span class="lineno"></span><span class="op" id="3837055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3837058">func</span>&nbsp;<span class="ident" id="3837063">resolveAddr</span><span class="op" id="3837074">(</span><span class="ident" id="3837075">op</span><span class="op" id="3837077">,</span>&nbsp;<span class="ident" id="3837079">net</span><span class="op" id="3837082">,</span>&nbsp;<span class="ident" id="3837084">addr</span>&nbsp;<span class="builtintype" id="3837089">string</span><span class="op" id="3837095">,</span>&nbsp;<span class="ident" id="3837097">deadline</span>&nbsp;<span class="ident" id="3837106">time</span><span class="op" id="3837110">.</span><span class="ident" id="3837111">Time</span><span class="op" id="3837115">)</span>&nbsp;<span class="op" id="3837117">(</span><span class="ident" id="3837118">netaddr</span><span class="op" id="3837125">,</span>&nbsp;<span class="builtintype" id="3837127">error</span><span class="op" id="3837132">)</span>&nbsp;<span class="op" id="3837134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3837137">afnet</span><span class="op" id="3837142">,</span>&nbsp;<span class="ident" id="3837144">_</span><span class="op" id="3837145">,</span>&nbsp;<span class="ident" id="3837147">err</span>&nbsp;<span class="op" id="3837151">:=</span>&nbsp;<span class="ident" id="3837154">parseNetwork</span><span class="op" id="3837166">(</span><span class="ident" id="3837167">net</span><span class="op" id="3837170">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837173">if</span>&nbsp;<span class="ident" id="3837176">err</span>&nbsp;<span class="op" id="3837180">!=</span>&nbsp;<span class="builtintype" id="3837183">nil</span>&nbsp;<span class="op" id="3837187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837191">return</span>&nbsp;<span class="builtintype" id="3837198">nil</span><span class="op" id="3837201">,</span>&nbsp;<span class="ident" id="3837203">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3837208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837211">if</span>&nbsp;<span class="ident" id="3837214">op</span>&nbsp;<span class="op" id="3837217">==</span>&nbsp;<span class="string" id="3837220">&#34;dial&#34;</span>&nbsp;<span class="op" id="3837227">&amp;&amp;</span>&nbsp;<span class="ident" id="3837230">addr</span>&nbsp;<span class="op" id="3837235">==</span>&nbsp;<span class="string" id="3837238">&#34;&#34;</span>&nbsp;<span class="op" id="3837241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837245">return</span>&nbsp;<span class="builtintype" id="3837252">nil</span><span class="op" id="3837255">,</span>&nbsp;<span class="ident" id="3837257">errMissingAddress</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3837276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837279">switch</span>&nbsp;<span class="ident" id="3837286">afnet</span>&nbsp;<span class="op" id="3837292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837295">case</span>&nbsp;<span class="string" id="3837300">&#34;unix&#34;</span><span class="op" id="3837306">,</span>&nbsp;<span class="string" id="3837308">&#34;unixgram&#34;</span><span class="op" id="3837318">,</span>&nbsp;<span class="string" id="3837320">&#34;unixpacket&#34;</span><span class="op" id="3837332">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837336">return</span>&nbsp;<span class="ident" id="3837343">ResolveUnixAddr</span><span class="op" id="3837358">(</span><span class="ident" id="3837359">afnet</span><span class="op" id="3837364">,</span>&nbsp;<span class="ident" id="3837366">addr</span><span class="op" id="3837370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3837373">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3837376">return</span>&nbsp;<span class="ident" id="3837383">resolveInternetAddr</span><span class="op" id="3837402">(</span><span class="ident" id="3837403">afnet</span><span class="op" id="3837408">,</span>&nbsp;<span class="ident" id="3837410">addr</span><span class="op" id="3837414">,</span>&nbsp;<span class="ident" id="3837416">deadline</span><span class="op" id="3837424">)</span><br>
<span class="lineno"></span><span class="op" id="3837426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3837429">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3837483">//</span><br>
<span class="lineno">115</span><span class="comment" id="3837486">//&nbsp;Known&nbsp;networks&nbsp;are&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;tcp6&#34;&nbsp;(IPv6-only),</span><br>
<span class="lineno"></span><span class="comment" id="3837555">//&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;udp6&#34;&nbsp;(IPv6-only),&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3837617">//&nbsp;(IPv4-only),&nbsp;&#34;ip6&#34;&nbsp;(IPv6-only),&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3837675">//&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3837692">//</span><br>
<span class="lineno">120</span><span class="comment" id="3837695">//&nbsp;For&nbsp;TCP&nbsp;and&nbsp;UDP&nbsp;networks,&nbsp;addresses&nbsp;have&nbsp;the&nbsp;form&nbsp;host:port.</span><br>
<span class="lineno"></span><span class="comment" id="3837759">//&nbsp;If&nbsp;host&nbsp;is&nbsp;a&nbsp;literal&nbsp;IPv6&nbsp;address&nbsp;it&nbsp;must&nbsp;be&nbsp;enclosed</span><br>
<span class="lineno"></span><span class="comment" id="3837816">//&nbsp;in&nbsp;square&nbsp;brackets&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3837881">//&nbsp;The&nbsp;functions&nbsp;JoinHostPort&nbsp;and&nbsp;SplitHostPort&nbsp;manipulate&nbsp;addresses</span><br>
<span class="lineno"></span><span class="comment" id="3837950">//&nbsp;in&nbsp;this&nbsp;form.</span><br>
<span class="lineno">125</span><span class="comment" id="3837967">//</span><br>
<span class="lineno"></span><span class="comment" id="3837970">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3837983">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;12.34.56.78:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3838016">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;google.com:http&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3838050">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;[2001:db8::1]:http&#34;)</span><br>
<span class="lineno">130</span><span class="comment" id="3838087">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;tcp&#34;,&nbsp;&#34;[fe80::1%lo0]:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3838122">//</span><br>
<span class="lineno"></span><span class="comment" id="3838125">//&nbsp;For&nbsp;IP&nbsp;networks,&nbsp;the&nbsp;network&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="3838195">//&nbsp;by&nbsp;a&nbsp;colon&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name&nbsp;and&nbsp;the&nbsp;addr&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3838262">//&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="3838285">//</span><br>
<span class="lineno"></span><span class="comment" id="3838288">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3838301">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;ip4:1&#34;,&nbsp;&#34;127.0.0.1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3838331">//&nbsp;&nbsp;&nbsp;&nbsp;Dial(&#34;ip6:ospf&#34;,&nbsp;&#34;::1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3838358">//</span><br>
<span class="lineno">140</span><span class="comment" id="3838361">//&nbsp;For&nbsp;Unix&nbsp;networks,&nbsp;the&nbsp;address&nbsp;must&nbsp;be&nbsp;a&nbsp;file&nbsp;system&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="3838423">func</span>&nbsp;<span class="ident" id="3838428">Dial</span><span class="op" id="3838432">(</span><span class="ident" id="3838433">network</span><span class="op" id="3838440">,</span>&nbsp;<span class="ident" id="3838442">address</span>&nbsp;<span class="builtintype" id="3838450">string</span><span class="op" id="3838456">)</span>&nbsp;<span class="op" id="3838458">(</span><span class="ident" id="3838459">Conn</span><span class="op" id="3838463">,</span>&nbsp;<span class="builtintype" id="3838465">error</span><span class="op" id="3838470">)</span>&nbsp;<span class="op" id="3838472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838475">var</span>&nbsp;<span class="ident" id="3838479">d</span>&nbsp;<span class="ident" id="3838481">Dialer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838489">return</span>&nbsp;<span class="ident" id="3838496">d</span><span class="op" id="3838497">.</span><span class="ident" id="3838498">Dial</span><span class="op" id="3838502">(</span><span class="ident" id="3838503">network</span><span class="op" id="3838510">,</span>&nbsp;<span class="ident" id="3838512">address</span><span class="op" id="3838519">)</span><br>
<span class="lineno"></span><span class="op" id="3838521">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="3838524">//&nbsp;DialTimeout&nbsp;acts&nbsp;like&nbsp;Dial&nbsp;but&nbsp;takes&nbsp;a&nbsp;timeout.</span><br>
<span class="lineno"></span><span class="comment" id="3838575">//&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;name&nbsp;resolution,&nbsp;if&nbsp;required.</span><br>
<span class="lineno"></span><span class="keyword" id="3838629">func</span>&nbsp;<span class="ident" id="3838634">DialTimeout</span><span class="op" id="3838645">(</span><span class="ident" id="3838646">network</span><span class="op" id="3838653">,</span>&nbsp;<span class="ident" id="3838655">address</span>&nbsp;<span class="builtintype" id="3838663">string</span><span class="op" id="3838669">,</span>&nbsp;<span class="ident" id="3838671">timeout</span>&nbsp;<span class="ident" id="3838679">time</span><span class="op" id="3838683">.</span><span class="ident" id="3838684">Duration</span><span class="op" id="3838692">)</span>&nbsp;<span class="op" id="3838694">(</span><span class="ident" id="3838695">Conn</span><span class="op" id="3838699">,</span>&nbsp;<span class="builtintype" id="3838701">error</span><span class="op" id="3838706">)</span>&nbsp;<span class="op" id="3838708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838711">d</span>&nbsp;<span class="op" id="3838713">:=</span>&nbsp;<span class="ident" id="3838716">Dialer</span><span class="op" id="3838722">{</span><span class="ident" id="3838723">Timeout</span><span class="op" id="3838730">:</span>&nbsp;<span class="ident" id="3838732">timeout</span><span class="op" id="3838739">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3838742">return</span>&nbsp;<span class="ident" id="3838749">d</span><span class="op" id="3838750">.</span><span class="ident" id="3838751">Dial</span><span class="op" id="3838755">(</span><span class="ident" id="3838756">network</span><span class="op" id="3838763">,</span>&nbsp;<span class="ident" id="3838765">address</span><span class="op" id="3838772">)</span><br>
<span class="lineno"></span><span class="op" id="3838774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3838777">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3838831">//</span><br>
<span class="lineno">155</span><span class="comment" id="3838834">//&nbsp;See&nbsp;func&nbsp;Dial&nbsp;for&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;network&nbsp;and&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3838896">//&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="3838911">func</span>&nbsp;<span class="op" id="3838916">(</span><span class="ident" id="3838917">d</span>&nbsp;<span class="op" id="3838919">*</span><span class="ident" id="3838920">Dialer</span><span class="op" id="3838926">)</span>&nbsp;<span class="ident" id="3838928">Dial</span><span class="op" id="3838932">(</span><span class="ident" id="3838933">network</span><span class="op" id="3838940">,</span>&nbsp;<span class="ident" id="3838942">address</span>&nbsp;<span class="builtintype" id="3838950">string</span><span class="op" id="3838956">)</span>&nbsp;<span class="op" id="3838958">(</span><span class="ident" id="3838959">Conn</span><span class="op" id="3838963">,</span>&nbsp;<span class="builtintype" id="3838965">error</span><span class="op" id="3838970">)</span>&nbsp;<span class="op" id="3838972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3838975">ra</span><span class="op" id="3838977">,</span>&nbsp;<span class="ident" id="3838979">err</span>&nbsp;<span class="op" id="3838983">:=</span>&nbsp;<span class="ident" id="3838986">resolveAddr</span><span class="op" id="3838997">(</span><span class="string" id="3838998">&#34;dial&#34;</span><span class="op" id="3839004">,</span>&nbsp;<span class="ident" id="3839006">network</span><span class="op" id="3839013">,</span>&nbsp;<span class="ident" id="3839015">address</span><span class="op" id="3839022">,</span>&nbsp;<span class="ident" id="3839024">d</span><span class="op" id="3839025">.</span><span class="ident" id="3839026">deadline</span><span class="op" id="3839034">(</span><span class="op" id="3839035">)</span><span class="op" id="3839036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839039">if</span>&nbsp;<span class="ident" id="3839042">err</span>&nbsp;<span class="op" id="3839046">!=</span>&nbsp;<span class="builtintype" id="3839049">nil</span>&nbsp;<span class="op" id="3839053">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839057">return</span>&nbsp;<span class="builtintype" id="3839064">nil</span><span class="op" id="3839067">,</span>&nbsp;<span class="op" id="3839069">&amp;</span><span class="ident" id="3839070">OpError</span><span class="op" id="3839077">{</span><span class="ident" id="3839078">Op</span><span class="op" id="3839080">:</span>&nbsp;<span class="string" id="3839082">&#34;dial&#34;</span><span class="op" id="3839088">,</span>&nbsp;<span class="ident" id="3839090">Net</span><span class="op" id="3839093">:</span>&nbsp;<span class="ident" id="3839095">network</span><span class="op" id="3839102">,</span>&nbsp;<span class="ident" id="3839104">Addr</span><span class="op" id="3839108">:</span>&nbsp;<span class="builtintype" id="3839110">nil</span><span class="op" id="3839113">,</span>&nbsp;<span class="ident" id="3839115">Err</span><span class="op" id="3839118">:</span>&nbsp;<span class="ident" id="3839120">err</span><span class="op" id="3839123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3839126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3839129">dialer</span>&nbsp;<span class="op" id="3839136">:=</span>&nbsp;<span class="keyword" id="3839139">func</span><span class="op" id="3839143">(</span><span class="ident" id="3839144">deadline</span>&nbsp;<span class="ident" id="3839153">time</span><span class="op" id="3839157">.</span><span class="ident" id="3839158">Time</span><span class="op" id="3839162">)</span>&nbsp;<span class="op" id="3839164">(</span><span class="ident" id="3839165">Conn</span><span class="op" id="3839169">,</span>&nbsp;<span class="builtintype" id="3839171">error</span><span class="op" id="3839176">)</span>&nbsp;<span class="op" id="3839178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839182">return</span>&nbsp;<span class="ident" id="3839189">dialSingle</span><span class="op" id="3839199">(</span><span class="ident" id="3839200">network</span><span class="op" id="3839207">,</span>&nbsp;<span class="ident" id="3839209">address</span><span class="op" id="3839216">,</span>&nbsp;<span class="ident" id="3839218">d</span><span class="op" id="3839219">.</span><span class="ident" id="3839220">LocalAddr</span><span class="op" id="3839229">,</span>&nbsp;<span class="ident" id="3839231">ra</span><span class="op" id="3839233">.</span><span class="ident" id="3839234">toAddr</span><span class="op" id="3839240">(</span><span class="op" id="3839241">)</span><span class="op" id="3839242">,</span>&nbsp;<span class="ident" id="3839244">deadline</span><span class="op" id="3839252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3839255">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839258">if</span>&nbsp;<span class="ident" id="3839261">ras</span><span class="op" id="3839264">,</span>&nbsp;<span class="ident" id="3839266">ok</span>&nbsp;<span class="op" id="3839269">:=</span>&nbsp;<span class="ident" id="3839272">ra</span><span class="op" id="3839274">.</span><span class="op" id="3839275">(</span><span class="ident" id="3839276">addrList</span><span class="op" id="3839284">)</span><span class="op" id="3839285">;</span>&nbsp;<span class="ident" id="3839287">ok</span>&nbsp;<span class="op" id="3839290">&amp;&amp;</span>&nbsp;<span class="ident" id="3839293">d</span><span class="op" id="3839294">.</span><span class="ident" id="3839295">DualStack</span>&nbsp;<span class="op" id="3839305">&amp;&amp;</span>&nbsp;<span class="ident" id="3839308">network</span>&nbsp;<span class="op" id="3839316">==</span>&nbsp;<span class="string" id="3839319">&#34;tcp&#34;</span>&nbsp;<span class="op" id="3839325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3839329">dialer</span>&nbsp;<span class="op" id="3839336">=</span>&nbsp;<span class="keyword" id="3839338">func</span><span class="op" id="3839342">(</span><span class="ident" id="3839343">deadline</span>&nbsp;<span class="ident" id="3839352">time</span><span class="op" id="3839356">.</span><span class="ident" id="3839357">Time</span><span class="op" id="3839361">)</span>&nbsp;<span class="op" id="3839363">(</span><span class="ident" id="3839364">Conn</span><span class="op" id="3839368">,</span>&nbsp;<span class="builtintype" id="3839370">error</span><span class="op" id="3839375">)</span>&nbsp;<span class="op" id="3839377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839382">return</span>&nbsp;<span class="ident" id="3839389">dialMulti</span><span class="op" id="3839398">(</span><span class="ident" id="3839399">network</span><span class="op" id="3839406">,</span>&nbsp;<span class="ident" id="3839408">address</span><span class="op" id="3839415">,</span>&nbsp;<span class="ident" id="3839417">d</span><span class="op" id="3839418">.</span><span class="ident" id="3839419">LocalAddr</span><span class="op" id="3839428">,</span>&nbsp;<span class="ident" id="3839430">ras</span><span class="op" id="3839433">,</span>&nbsp;<span class="ident" id="3839435">deadline</span><span class="op" id="3839443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3839447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3839450">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3839453">c</span><span class="op" id="3839454">,</span>&nbsp;<span class="ident" id="3839456">err</span>&nbsp;<span class="op" id="3839460">:=</span>&nbsp;<span class="ident" id="3839463">dial</span><span class="op" id="3839467">(</span><span class="ident" id="3839468">network</span><span class="op" id="3839475">,</span>&nbsp;<span class="ident" id="3839477">ra</span><span class="op" id="3839479">.</span><span class="ident" id="3839480">toAddr</span><span class="op" id="3839486">(</span><span class="op" id="3839487">)</span><span class="op" id="3839488">,</span>&nbsp;<span class="ident" id="3839490">dialer</span><span class="op" id="3839496">,</span>&nbsp;<span class="ident" id="3839498">d</span><span class="op" id="3839499">.</span><span class="ident" id="3839500">deadline</span><span class="op" id="3839508">(</span><span class="op" id="3839509">)</span><span class="op" id="3839510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839513">if</span>&nbsp;<span class="ident" id="3839516">d</span><span class="op" id="3839517">.</span><span class="ident" id="3839518">KeepAlive</span>&nbsp;<span class="op" id="3839528">&gt;</span>&nbsp;<span class="num" id="3839530">0</span>&nbsp;<span class="op" id="3839532">&amp;&amp;</span>&nbsp;<span class="ident" id="3839535">err</span>&nbsp;<span class="op" id="3839539">==</span>&nbsp;<span class="builtintype" id="3839542">nil</span>&nbsp;<span class="op" id="3839546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839550">if</span>&nbsp;<span class="ident" id="3839553">tc</span><span class="op" id="3839555">,</span>&nbsp;<span class="ident" id="3839557">ok</span>&nbsp;<span class="op" id="3839560">:=</span>&nbsp;<span class="ident" id="3839563">c</span><span class="op" id="3839564">.</span><span class="op" id="3839565">(</span><span class="op" id="3839566">*</span><span class="ident" id="3839567">TCPConn</span><span class="op" id="3839574">)</span><span class="op" id="3839575">;</span>&nbsp;<span class="ident" id="3839577">ok</span>&nbsp;<span class="op" id="3839580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3839585">tc</span><span class="op" id="3839587">.</span><span class="ident" id="3839588">SetKeepAlive</span><span class="op" id="3839600">(</span><span class="builtintype" id="3839601">true</span><span class="op" id="3839605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3839610">tc</span><span class="op" id="3839612">.</span><span class="ident" id="3839613">SetKeepAlivePeriod</span><span class="op" id="3839631">(</span><span class="ident" id="3839632">d</span><span class="op" id="3839633">.</span><span class="ident" id="3839634">KeepAlive</span><span class="op" id="3839643">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3839648">testHookSetKeepAlive</span><span class="op" id="3839668">(</span><span class="op" id="3839669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3839673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3839676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3839679">return</span>&nbsp;<span class="ident" id="3839686">c</span><span class="op" id="3839687">,</span>&nbsp;<span class="ident" id="3839689">err</span><br>
<span class="lineno"></span><span class="op" id="3839693">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="3839696">var</span>&nbsp;<span class="ident" id="3839700">testHookSetKeepAlive</span>&nbsp;<span class="op" id="3839721">=</span>&nbsp;<span class="keyword" id="3839723">func</span><span class="op" id="3839727">(</span><span class="op" id="3839728">)</span>&nbsp;<span class="op" id="3839730">{</span><span class="op" id="3839731">}</span>&nbsp;<span class="comment" id="3839733">//&nbsp;changed&nbsp;by&nbsp;dial_test.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3839761">//&nbsp;dialMulti&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;connections&nbsp;to&nbsp;each&nbsp;destination&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3839831">//&nbsp;the&nbsp;list&nbsp;of&nbsp;addresses.&nbsp;It&nbsp;will&nbsp;return&nbsp;the&nbsp;first&nbsp;established</span><br>
<span class="lineno">185</span><span class="comment" id="3839894">//&nbsp;connection&nbsp;and&nbsp;close&nbsp;the&nbsp;other&nbsp;connections.&nbsp;Otherwise&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3839962">//&nbsp;error&nbsp;on&nbsp;the&nbsp;last&nbsp;attempt.</span><br>
<span class="lineno"></span><span class="keyword" id="3839992">func</span>&nbsp;<span class="ident" id="3839997">dialMulti</span><span class="op" id="3840006">(</span><span class="ident" id="3840007">net</span><span class="op" id="3840010">,</span>&nbsp;<span class="ident" id="3840012">addr</span>&nbsp;<span class="builtintype" id="3840017">string</span><span class="op" id="3840023">,</span>&nbsp;<span class="ident" id="3840025">la</span>&nbsp;<span class="ident" id="3840028">Addr</span><span class="op" id="3840032">,</span>&nbsp;<span class="ident" id="3840034">ras</span>&nbsp;<span class="ident" id="3840038">addrList</span><span class="op" id="3840046">,</span>&nbsp;<span class="ident" id="3840048">deadline</span>&nbsp;<span class="ident" id="3840057">time</span><span class="op" id="3840061">.</span><span class="ident" id="3840062">Time</span><span class="op" id="3840066">)</span>&nbsp;<span class="op" id="3840068">(</span><span class="ident" id="3840069">Conn</span><span class="op" id="3840073">,</span>&nbsp;<span class="builtintype" id="3840075">error</span><span class="op" id="3840080">)</span>&nbsp;<span class="op" id="3840082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840085">type</span>&nbsp;<span class="ident" id="3840090">racer</span>&nbsp;<span class="keyword" id="3840096">struct</span>&nbsp;<span class="op" id="3840103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3840107">Conn</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3840114">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3840121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3840124">//&nbsp;Sig&nbsp;controls&nbsp;the&nbsp;flow&nbsp;of&nbsp;dial&nbsp;results&nbsp;on&nbsp;lane.&nbsp;It&nbsp;passes&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3840187">//&nbsp;token&nbsp;to&nbsp;the&nbsp;next&nbsp;racer&nbsp;and&nbsp;also&nbsp;indicates&nbsp;the&nbsp;end&nbsp;of&nbsp;flow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3840250">//&nbsp;by&nbsp;using&nbsp;closed&nbsp;channel.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3840279">sig</span>&nbsp;<span class="op" id="3840283">:=</span>&nbsp;<span class="builtinfunc" id="3840286">make</span><span class="op" id="3840290">(</span><span class="keyword" id="3840291">chan</span>&nbsp;<span class="builtintype" id="3840296">bool</span><span class="op" id="3840300">,</span>&nbsp;<span class="num" id="3840302">1</span><span class="op" id="3840303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3840306">lane</span>&nbsp;<span class="op" id="3840311">:=</span>&nbsp;<span class="builtinfunc" id="3840314">make</span><span class="op" id="3840318">(</span><span class="keyword" id="3840319">chan</span>&nbsp;<span class="ident" id="3840324">racer</span><span class="op" id="3840329">,</span>&nbsp;<span class="num" id="3840331">1</span><span class="op" id="3840332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840335">for</span>&nbsp;<span class="ident" id="3840339">_</span><span class="op" id="3840340">,</span>&nbsp;<span class="ident" id="3840342">ra</span>&nbsp;<span class="op" id="3840345">:=</span>&nbsp;<span class="keyword" id="3840348">range</span>&nbsp;<span class="ident" id="3840354">ras</span>&nbsp;<span class="op" id="3840358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840362">go</span>&nbsp;<span class="keyword" id="3840365">func</span><span class="op" id="3840369">(</span><span class="ident" id="3840370">ra</span>&nbsp;<span class="ident" id="3840373">Addr</span><span class="op" id="3840377">)</span>&nbsp;<span class="op" id="3840379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3840384">c</span><span class="op" id="3840385">,</span>&nbsp;<span class="ident" id="3840387">err</span>&nbsp;<span class="op" id="3840391">:=</span>&nbsp;<span class="ident" id="3840394">dialSingle</span><span class="op" id="3840404">(</span><span class="ident" id="3840405">net</span><span class="op" id="3840408">,</span>&nbsp;<span class="ident" id="3840410">addr</span><span class="op" id="3840414">,</span>&nbsp;<span class="ident" id="3840416">la</span><span class="op" id="3840418">,</span>&nbsp;<span class="ident" id="3840420">ra</span><span class="op" id="3840422">,</span>&nbsp;<span class="ident" id="3840424">deadline</span><span class="op" id="3840432">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840437">if</span>&nbsp;<span class="ident" id="3840440">_</span><span class="op" id="3840441">,</span>&nbsp;<span class="ident" id="3840443">ok</span>&nbsp;<span class="op" id="3840446">:=</span>&nbsp;<span class="op" id="3840449">&lt;-</span><span class="ident" id="3840451">sig</span><span class="op" id="3840454">;</span>&nbsp;<span class="ident" id="3840456">ok</span>&nbsp;<span class="op" id="3840459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3840465">lane</span>&nbsp;<span class="op" id="3840470">&lt;-</span>&nbsp;<span class="ident" id="3840473">racer</span><span class="op" id="3840478">{</span><span class="ident" id="3840479">c</span><span class="op" id="3840480">,</span>&nbsp;<span class="ident" id="3840482">err</span><span class="op" id="3840485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3840490">}</span>&nbsp;<span class="keyword" id="3840492">else</span>&nbsp;<span class="keyword" id="3840497">if</span>&nbsp;<span class="ident" id="3840500">err</span>&nbsp;<span class="op" id="3840504">==</span>&nbsp;<span class="builtintype" id="3840507">nil</span>&nbsp;<span class="op" id="3840511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3840517">//&nbsp;We&nbsp;have&nbsp;to&nbsp;return&nbsp;the&nbsp;resources</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3840556">//&nbsp;that&nbsp;belong&nbsp;to&nbsp;the&nbsp;other</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3840588">//&nbsp;connections&nbsp;here&nbsp;for&nbsp;avoiding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3840625">//&nbsp;unnecessary&nbsp;resource&nbsp;starvation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3840665">c</span><span class="op" id="3840666">.</span><span class="ident" id="3840667">Close</span><span class="op" id="3840672">(</span><span class="op" id="3840673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3840678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3840682">}</span><span class="op" id="3840683">(</span><span class="ident" id="3840684">ra</span><span class="op" id="3840686">.</span><span class="ident" id="3840687">toAddr</span><span class="op" id="3840693">(</span><span class="op" id="3840694">)</span><span class="op" id="3840695">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3840698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840701">defer</span>&nbsp;<span class="builtinfunc" id="3840707">close</span><span class="op" id="3840712">(</span><span class="ident" id="3840713">sig</span><span class="op" id="3840716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3840719">lastErr</span>&nbsp;<span class="op" id="3840727">:=</span>&nbsp;<span class="ident" id="3840730">errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3840742">nracers</span>&nbsp;<span class="op" id="3840750">:=</span>&nbsp;<span class="builtinfunc" id="3840753">len</span><span class="op" id="3840756">(</span><span class="ident" id="3840757">ras</span><span class="op" id="3840760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840763">for</span>&nbsp;<span class="ident" id="3840767">nracers</span>&nbsp;<span class="op" id="3840775">&gt;</span>&nbsp;<span class="num" id="3840777">0</span>&nbsp;<span class="op" id="3840779">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3840783">sig</span>&nbsp;<span class="op" id="3840787">&lt;-</span>&nbsp;<span class="builtintype" id="3840790">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3840797">racer</span>&nbsp;<span class="op" id="3840803">:=</span>&nbsp;<span class="op" id="3840806">&lt;-</span><span class="ident" id="3840808">lane</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840815">if</span>&nbsp;<span class="ident" id="3840818">racer</span><span class="op" id="3840823">.</span><span class="builtintype" id="3840824">error</span>&nbsp;<span class="op" id="3840830">==</span>&nbsp;<span class="builtintype" id="3840833">nil</span>&nbsp;<span class="op" id="3840837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840842">return</span>&nbsp;<span class="ident" id="3840849">racer</span><span class="op" id="3840854">.</span><span class="ident" id="3840855">Conn</span><span class="op" id="3840859">,</span>&nbsp;<span class="builtintype" id="3840861">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3840867">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3840871">lastErr</span>&nbsp;<span class="op" id="3840879">=</span>&nbsp;<span class="ident" id="3840881">racer</span><span class="op" id="3840886">.</span><span class="builtintype" id="3840887">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3840895">nracers</span><span class="op" id="3840902">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3840906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3840909">return</span>&nbsp;<span class="builtintype" id="3840916">nil</span><span class="op" id="3840919">,</span>&nbsp;<span class="ident" id="3840921">lastErr</span><br>
<span class="lineno"></span><span class="op" id="3840929">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="3840932">//&nbsp;dialSingle&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;connection&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3841003">//&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3841031">func</span>&nbsp;<span class="ident" id="3841036">dialSingle</span><span class="op" id="3841046">(</span><span class="ident" id="3841047">net</span><span class="op" id="3841050">,</span>&nbsp;<span class="ident" id="3841052">addr</span>&nbsp;<span class="builtintype" id="3841057">string</span><span class="op" id="3841063">,</span>&nbsp;<span class="ident" id="3841065">la</span><span class="op" id="3841067">,</span>&nbsp;<span class="ident" id="3841069">ra</span>&nbsp;<span class="ident" id="3841072">Addr</span><span class="op" id="3841076">,</span>&nbsp;<span class="ident" id="3841078">deadline</span>&nbsp;<span class="ident" id="3841087">time</span><span class="op" id="3841091">.</span><span class="ident" id="3841092">Time</span><span class="op" id="3841096">)</span>&nbsp;<span class="op" id="3841098">(</span><span class="ident" id="3841099">c</span>&nbsp;<span class="ident" id="3841101">Conn</span><span class="op" id="3841105">,</span>&nbsp;<span class="ident" id="3841107">err</span>&nbsp;<span class="builtintype" id="3841111">error</span><span class="op" id="3841116">)</span>&nbsp;<span class="op" id="3841118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841121">if</span>&nbsp;<span class="ident" id="3841124">la</span>&nbsp;<span class="op" id="3841127">!=</span>&nbsp;<span class="builtintype" id="3841130">nil</span>&nbsp;<span class="op" id="3841134">&amp;&amp;</span>&nbsp;<span class="ident" id="3841137">la</span><span class="op" id="3841139">.</span><span class="ident" id="3841140">Network</span><span class="op" id="3841147">(</span><span class="op" id="3841148">)</span>&nbsp;<span class="op" id="3841150">!=</span>&nbsp;<span class="ident" id="3841153">ra</span><span class="op" id="3841155">.</span><span class="ident" id="3841156">Network</span><span class="op" id="3841163">(</span><span class="op" id="3841164">)</span>&nbsp;<span class="op" id="3841166">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841170">return</span>&nbsp;<span class="builtintype" id="3841177">nil</span><span class="op" id="3841180">,</span>&nbsp;<span class="op" id="3841182">&amp;</span><span class="ident" id="3841183">OpError</span><span class="op" id="3841190">{</span><span class="ident" id="3841191">Op</span><span class="op" id="3841193">:</span>&nbsp;<span class="string" id="3841195">&#34;dial&#34;</span><span class="op" id="3841201">,</span>&nbsp;<span class="ident" id="3841203">Net</span><span class="op" id="3841206">:</span>&nbsp;<span class="ident" id="3841208">net</span><span class="op" id="3841211">,</span>&nbsp;<span class="ident" id="3841213">Addr</span><span class="op" id="3841217">:</span>&nbsp;<span class="ident" id="3841219">ra</span><span class="op" id="3841221">,</span>&nbsp;<span class="ident" id="3841223">Err</span><span class="op" id="3841226">:</span>&nbsp;<span class="ident" id="3841228">errors</span><span class="op" id="3841234">.</span><span class="ident" id="3841235">New</span><span class="op" id="3841238">(</span><span class="string" id="3841239">&#34;mismatched&nbsp;local&nbsp;address&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3841272">+</span>&nbsp;<span class="ident" id="3841274">la</span><span class="op" id="3841276">.</span><span class="ident" id="3841277">Network</span><span class="op" id="3841284">(</span><span class="op" id="3841285">)</span><span class="op" id="3841286">)</span><span class="op" id="3841287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3841290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841293">switch</span>&nbsp;<span class="ident" id="3841300">ra</span>&nbsp;<span class="op" id="3841303">:=</span>&nbsp;<span class="ident" id="3841306">ra</span><span class="op" id="3841308">.</span><span class="op" id="3841309">(</span><span class="keyword" id="3841310">type</span><span class="op" id="3841314">)</span>&nbsp;<span class="op" id="3841316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841319">case</span>&nbsp;<span class="op" id="3841324">*</span><span class="ident" id="3841325">TCPAddr</span><span class="op" id="3841332">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3841336">la</span><span class="op" id="3841338">,</span>&nbsp;<span class="ident" id="3841340">_</span>&nbsp;<span class="op" id="3841342">:=</span>&nbsp;<span class="ident" id="3841345">la</span><span class="op" id="3841347">.</span><span class="op" id="3841348">(</span><span class="op" id="3841349">*</span><span class="ident" id="3841350">TCPAddr</span><span class="op" id="3841357">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3841361">c</span><span class="op" id="3841362">,</span>&nbsp;<span class="ident" id="3841364">err</span>&nbsp;<span class="op" id="3841368">=</span>&nbsp;<span class="ident" id="3841370">dialTCP</span><span class="op" id="3841377">(</span><span class="ident" id="3841378">net</span><span class="op" id="3841381">,</span>&nbsp;<span class="ident" id="3841383">la</span><span class="op" id="3841385">,</span>&nbsp;<span class="ident" id="3841387">ra</span><span class="op" id="3841389">,</span>&nbsp;<span class="ident" id="3841391">deadline</span><span class="op" id="3841399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841402">case</span>&nbsp;<span class="op" id="3841407">*</span><span class="ident" id="3841408">UDPAddr</span><span class="op" id="3841415">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3841419">la</span><span class="op" id="3841421">,</span>&nbsp;<span class="ident" id="3841423">_</span>&nbsp;<span class="op" id="3841425">:=</span>&nbsp;<span class="ident" id="3841428">la</span><span class="op" id="3841430">.</span><span class="op" id="3841431">(</span><span class="op" id="3841432">*</span><span class="ident" id="3841433">UDPAddr</span><span class="op" id="3841440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3841444">c</span><span class="op" id="3841445">,</span>&nbsp;<span class="ident" id="3841447">err</span>&nbsp;<span class="op" id="3841451">=</span>&nbsp;<span class="ident" id="3841453">dialUDP</span><span class="op" id="3841460">(</span><span class="ident" id="3841461">net</span><span class="op" id="3841464">,</span>&nbsp;<span class="ident" id="3841466">la</span><span class="op" id="3841468">,</span>&nbsp;<span class="ident" id="3841470">ra</span><span class="op" id="3841472">,</span>&nbsp;<span class="ident" id="3841474">deadline</span><span class="op" id="3841482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841485">case</span>&nbsp;<span class="op" id="3841490">*</span><span class="ident" id="3841491">IPAddr</span><span class="op" id="3841497">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3841501">la</span><span class="op" id="3841503">,</span>&nbsp;<span class="ident" id="3841505">_</span>&nbsp;<span class="op" id="3841507">:=</span>&nbsp;<span class="ident" id="3841510">la</span><span class="op" id="3841512">.</span><span class="op" id="3841513">(</span><span class="op" id="3841514">*</span><span class="ident" id="3841515">IPAddr</span><span class="op" id="3841521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3841525">c</span><span class="op" id="3841526">,</span>&nbsp;<span class="ident" id="3841528">err</span>&nbsp;<span class="op" id="3841532">=</span>&nbsp;<span class="ident" id="3841534">dialIP</span><span class="op" id="3841540">(</span><span class="ident" id="3841541">net</span><span class="op" id="3841544">,</span>&nbsp;<span class="ident" id="3841546">la</span><span class="op" id="3841548">,</span>&nbsp;<span class="ident" id="3841550">ra</span><span class="op" id="3841552">,</span>&nbsp;<span class="ident" id="3841554">deadline</span><span class="op" id="3841562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841565">case</span>&nbsp;<span class="op" id="3841570">*</span><span class="ident" id="3841571">UnixAddr</span><span class="op" id="3841579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3841583">la</span><span class="op" id="3841585">,</span>&nbsp;<span class="ident" id="3841587">_</span>&nbsp;<span class="op" id="3841589">:=</span>&nbsp;<span class="ident" id="3841592">la</span><span class="op" id="3841594">.</span><span class="op" id="3841595">(</span><span class="op" id="3841596">*</span><span class="ident" id="3841597">UnixAddr</span><span class="op" id="3841605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3841609">c</span><span class="op" id="3841610">,</span>&nbsp;<span class="ident" id="3841612">err</span>&nbsp;<span class="op" id="3841616">=</span>&nbsp;<span class="ident" id="3841618">dialUnix</span><span class="op" id="3841626">(</span><span class="ident" id="3841627">net</span><span class="op" id="3841630">,</span>&nbsp;<span class="ident" id="3841632">la</span><span class="op" id="3841634">,</span>&nbsp;<span class="ident" id="3841636">ra</span><span class="op" id="3841638">,</span>&nbsp;<span class="ident" id="3841640">deadline</span><span class="op" id="3841648">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841651">default</span><span class="op" id="3841658">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841662">return</span>&nbsp;<span class="builtintype" id="3841669">nil</span><span class="op" id="3841672">,</span>&nbsp;<span class="op" id="3841674">&amp;</span><span class="ident" id="3841675">OpError</span><span class="op" id="3841682">{</span><span class="ident" id="3841683">Op</span><span class="op" id="3841685">:</span>&nbsp;<span class="string" id="3841687">&#34;dial&#34;</span><span class="op" id="3841693">,</span>&nbsp;<span class="ident" id="3841695">Net</span><span class="op" id="3841698">:</span>&nbsp;<span class="ident" id="3841700">net</span><span class="op" id="3841703">,</span>&nbsp;<span class="ident" id="3841705">Addr</span><span class="op" id="3841709">:</span>&nbsp;<span class="ident" id="3841711">ra</span><span class="op" id="3841713">,</span>&nbsp;<span class="ident" id="3841715">Err</span><span class="op" id="3841718">:</span>&nbsp;<span class="op" id="3841720">&amp;</span><span class="ident" id="3841721">AddrError</span><span class="op" id="3841730">{</span><span class="ident" id="3841731">Err</span><span class="op" id="3841734">:</span>&nbsp;<span class="string" id="3841736">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3841761">,</span>&nbsp;<span class="ident" id="3841763">Addr</span><span class="op" id="3841767">:</span>&nbsp;<span class="ident" id="3841769">addr</span><span class="op" id="3841773">}</span><span class="op" id="3841774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3841777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841780">if</span>&nbsp;<span class="ident" id="3841783">err</span>&nbsp;<span class="op" id="3841787">!=</span>&nbsp;<span class="builtintype" id="3841790">nil</span>&nbsp;<span class="op" id="3841794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841798">return</span>&nbsp;<span class="builtintype" id="3841805">nil</span><span class="op" id="3841808">,</span>&nbsp;<span class="ident" id="3841810">err</span>&nbsp;<span class="comment" id="3841814">//&nbsp;c&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3841864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3841867">return</span>&nbsp;<span class="ident" id="3841874">c</span><span class="op" id="3841875">,</span>&nbsp;<span class="builtintype" id="3841877">nil</span><br>
<span class="lineno"></span><span class="op" id="3841881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3841884">//&nbsp;Listen&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno">255</span><span class="comment" id="3841940">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;stream-oriented&nbsp;network:&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3842009">//&nbsp;&#34;tcp6&#34;,&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3842044">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3842081">func</span>&nbsp;<span class="ident" id="3842086">Listen</span><span class="op" id="3842092">(</span><span class="ident" id="3842093">net</span><span class="op" id="3842096">,</span>&nbsp;<span class="ident" id="3842098">laddr</span>&nbsp;<span class="builtintype" id="3842104">string</span><span class="op" id="3842110">)</span>&nbsp;<span class="op" id="3842112">(</span><span class="ident" id="3842113">Listener</span><span class="op" id="3842121">,</span>&nbsp;<span class="builtintype" id="3842123">error</span><span class="op" id="3842128">)</span>&nbsp;<span class="op" id="3842130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3842133">la</span><span class="op" id="3842135">,</span>&nbsp;<span class="ident" id="3842137">err</span>&nbsp;<span class="op" id="3842141">:=</span>&nbsp;<span class="ident" id="3842144">resolveAddr</span><span class="op" id="3842155">(</span><span class="string" id="3842156">&#34;listen&#34;</span><span class="op" id="3842164">,</span>&nbsp;<span class="ident" id="3842166">net</span><span class="op" id="3842169">,</span>&nbsp;<span class="ident" id="3842171">laddr</span><span class="op" id="3842176">,</span>&nbsp;<span class="ident" id="3842178">noDeadline</span><span class="op" id="3842188">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842191">if</span>&nbsp;<span class="ident" id="3842194">err</span>&nbsp;<span class="op" id="3842198">!=</span>&nbsp;<span class="builtintype" id="3842201">nil</span>&nbsp;<span class="op" id="3842205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842209">return</span>&nbsp;<span class="builtintype" id="3842216">nil</span><span class="op" id="3842219">,</span>&nbsp;<span class="op" id="3842221">&amp;</span><span class="ident" id="3842222">OpError</span><span class="op" id="3842229">{</span><span class="ident" id="3842230">Op</span><span class="op" id="3842232">:</span>&nbsp;<span class="string" id="3842234">&#34;listen&#34;</span><span class="op" id="3842242">,</span>&nbsp;<span class="ident" id="3842244">Net</span><span class="op" id="3842247">:</span>&nbsp;<span class="ident" id="3842249">net</span><span class="op" id="3842252">,</span>&nbsp;<span class="ident" id="3842254">Addr</span><span class="op" id="3842258">:</span>&nbsp;<span class="builtintype" id="3842260">nil</span><span class="op" id="3842263">,</span>&nbsp;<span class="ident" id="3842265">Err</span><span class="op" id="3842268">:</span>&nbsp;<span class="ident" id="3842270">err</span><span class="op" id="3842273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842279">var</span>&nbsp;<span class="ident" id="3842283">l</span>&nbsp;<span class="ident" id="3842285">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842295">switch</span>&nbsp;<span class="ident" id="3842302">la</span>&nbsp;<span class="op" id="3842305">:=</span>&nbsp;<span class="ident" id="3842308">la</span><span class="op" id="3842310">.</span><span class="ident" id="3842311">toAddr</span><span class="op" id="3842317">(</span><span class="op" id="3842318">)</span><span class="op" id="3842319">.</span><span class="op" id="3842320">(</span><span class="keyword" id="3842321">type</span><span class="op" id="3842325">)</span>&nbsp;<span class="op" id="3842327">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842330">case</span>&nbsp;<span class="op" id="3842335">*</span><span class="ident" id="3842336">TCPAddr</span><span class="op" id="3842343">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3842347">l</span><span class="op" id="3842348">,</span>&nbsp;<span class="ident" id="3842350">err</span>&nbsp;<span class="op" id="3842354">=</span>&nbsp;<span class="ident" id="3842356">ListenTCP</span><span class="op" id="3842365">(</span><span class="ident" id="3842366">net</span><span class="op" id="3842369">,</span>&nbsp;<span class="ident" id="3842371">la</span><span class="op" id="3842373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842376">case</span>&nbsp;<span class="op" id="3842381">*</span><span class="ident" id="3842382">UnixAddr</span><span class="op" id="3842390">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3842394">l</span><span class="op" id="3842395">,</span>&nbsp;<span class="ident" id="3842397">err</span>&nbsp;<span class="op" id="3842401">=</span>&nbsp;<span class="ident" id="3842403">ListenUnix</span><span class="op" id="3842413">(</span><span class="ident" id="3842414">net</span><span class="op" id="3842417">,</span>&nbsp;<span class="ident" id="3842419">la</span><span class="op" id="3842421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842424">default</span><span class="op" id="3842431">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842435">return</span>&nbsp;<span class="builtintype" id="3842442">nil</span><span class="op" id="3842445">,</span>&nbsp;<span class="op" id="3842447">&amp;</span><span class="ident" id="3842448">OpError</span><span class="op" id="3842455">{</span><span class="ident" id="3842456">Op</span><span class="op" id="3842458">:</span>&nbsp;<span class="string" id="3842460">&#34;listen&#34;</span><span class="op" id="3842468">,</span>&nbsp;<span class="ident" id="3842470">Net</span><span class="op" id="3842473">:</span>&nbsp;<span class="ident" id="3842475">net</span><span class="op" id="3842478">,</span>&nbsp;<span class="ident" id="3842480">Addr</span><span class="op" id="3842484">:</span>&nbsp;<span class="ident" id="3842486">la</span><span class="op" id="3842488">,</span>&nbsp;<span class="ident" id="3842490">Err</span><span class="op" id="3842493">:</span>&nbsp;<span class="op" id="3842495">&amp;</span><span class="ident" id="3842496">AddrError</span><span class="op" id="3842505">{</span><span class="ident" id="3842506">Err</span><span class="op" id="3842509">:</span>&nbsp;<span class="string" id="3842511">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3842536">,</span>&nbsp;<span class="ident" id="3842538">Addr</span><span class="op" id="3842542">:</span>&nbsp;<span class="ident" id="3842544">laddr</span><span class="op" id="3842549">}</span><span class="op" id="3842550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842556">if</span>&nbsp;<span class="ident" id="3842559">err</span>&nbsp;<span class="op" id="3842563">!=</span>&nbsp;<span class="builtintype" id="3842566">nil</span>&nbsp;<span class="op" id="3842570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842574">return</span>&nbsp;<span class="builtintype" id="3842581">nil</span><span class="op" id="3842584">,</span>&nbsp;<span class="ident" id="3842586">err</span>&nbsp;<span class="comment" id="3842590">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3842640">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842643">return</span>&nbsp;<span class="ident" id="3842650">l</span><span class="op" id="3842651">,</span>&nbsp;<span class="builtintype" id="3842653">nil</span><br>
<span class="lineno"></span><span class="op" id="3842657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3842660">//&nbsp;ListenPacket&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="comment" id="3842722">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;packet-oriented&nbsp;network:&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,</span><br>
<span class="lineno">280</span><span class="comment" id="3842791">//&nbsp;&#34;udp6&#34;,&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;&#34;ip6&#34;&nbsp;or&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3842836">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3842873">func</span>&nbsp;<span class="ident" id="3842878">ListenPacket</span><span class="op" id="3842890">(</span><span class="ident" id="3842891">net</span><span class="op" id="3842894">,</span>&nbsp;<span class="ident" id="3842896">laddr</span>&nbsp;<span class="builtintype" id="3842902">string</span><span class="op" id="3842908">)</span>&nbsp;<span class="op" id="3842910">(</span><span class="ident" id="3842911">PacketConn</span><span class="op" id="3842921">,</span>&nbsp;<span class="builtintype" id="3842923">error</span><span class="op" id="3842928">)</span>&nbsp;<span class="op" id="3842930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3842933">la</span><span class="op" id="3842935">,</span>&nbsp;<span class="ident" id="3842937">err</span>&nbsp;<span class="op" id="3842941">:=</span>&nbsp;<span class="ident" id="3842944">resolveAddr</span><span class="op" id="3842955">(</span><span class="string" id="3842956">&#34;listen&#34;</span><span class="op" id="3842964">,</span>&nbsp;<span class="ident" id="3842966">net</span><span class="op" id="3842969">,</span>&nbsp;<span class="ident" id="3842971">laddr</span><span class="op" id="3842976">,</span>&nbsp;<span class="ident" id="3842978">noDeadline</span><span class="op" id="3842988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3842991">if</span>&nbsp;<span class="ident" id="3842994">err</span>&nbsp;<span class="op" id="3842998">!=</span>&nbsp;<span class="builtintype" id="3843001">nil</span>&nbsp;<span class="op" id="3843005">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3843009">return</span>&nbsp;<span class="builtintype" id="3843016">nil</span><span class="op" id="3843019">,</span>&nbsp;<span class="op" id="3843021">&amp;</span><span class="ident" id="3843022">OpError</span><span class="op" id="3843029">{</span><span class="ident" id="3843030">Op</span><span class="op" id="3843032">:</span>&nbsp;<span class="string" id="3843034">&#34;listen&#34;</span><span class="op" id="3843042">,</span>&nbsp;<span class="ident" id="3843044">Net</span><span class="op" id="3843047">:</span>&nbsp;<span class="ident" id="3843049">net</span><span class="op" id="3843052">,</span>&nbsp;<span class="ident" id="3843054">Addr</span><span class="op" id="3843058">:</span>&nbsp;<span class="builtintype" id="3843060">nil</span><span class="op" id="3843063">,</span>&nbsp;<span class="ident" id="3843065">Err</span><span class="op" id="3843068">:</span>&nbsp;<span class="ident" id="3843070">err</span><span class="op" id="3843073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3843076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3843079">var</span>&nbsp;<span class="ident" id="3843083">l</span>&nbsp;<span class="ident" id="3843085">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3843097">switch</span>&nbsp;<span class="ident" id="3843104">la</span>&nbsp;<span class="op" id="3843107">:=</span>&nbsp;<span class="ident" id="3843110">la</span><span class="op" id="3843112">.</span><span class="ident" id="3843113">toAddr</span><span class="op" id="3843119">(</span><span class="op" id="3843120">)</span><span class="op" id="3843121">.</span><span class="op" id="3843122">(</span><span class="keyword" id="3843123">type</span><span class="op" id="3843127">)</span>&nbsp;<span class="op" id="3843129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3843132">case</span>&nbsp;<span class="op" id="3843137">*</span><span class="ident" id="3843138">UDPAddr</span><span class="op" id="3843145">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3843149">l</span><span class="op" id="3843150">,</span>&nbsp;<span class="ident" id="3843152">err</span>&nbsp;<span class="op" id="3843156">=</span>&nbsp;<span class="ident" id="3843158">ListenUDP</span><span class="op" id="3843167">(</span><span class="ident" id="3843168">net</span><span class="op" id="3843171">,</span>&nbsp;<span class="ident" id="3843173">la</span><span class="op" id="3843175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3843178">case</span>&nbsp;<span class="op" id="3843183">*</span><span class="ident" id="3843184">IPAddr</span><span class="op" id="3843190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3843194">l</span><span class="op" id="3843195">,</span>&nbsp;<span class="ident" id="3843197">err</span>&nbsp;<span class="op" id="3843201">=</span>&nbsp;<span class="ident" id="3843203">ListenIP</span><span class="op" id="3843211">(</span><span class="ident" id="3843212">net</span><span class="op" id="3843215">,</span>&nbsp;<span class="ident" id="3843217">la</span><span class="op" id="3843219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3843222">case</span>&nbsp;<span class="op" id="3843227">*</span><span class="ident" id="3843228">UnixAddr</span><span class="op" id="3843236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3843240">l</span><span class="op" id="3843241">,</span>&nbsp;<span class="ident" id="3843243">err</span>&nbsp;<span class="op" id="3843247">=</span>&nbsp;<span class="ident" id="3843249">ListenUnixgram</span><span class="op" id="3843263">(</span><span class="ident" id="3843264">net</span><span class="op" id="3843267">,</span>&nbsp;<span class="ident" id="3843269">la</span><span class="op" id="3843271">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3843274">default</span><span class="op" id="3843281">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3843285">return</span>&nbsp;<span class="builtintype" id="3843292">nil</span><span class="op" id="3843295">,</span>&nbsp;<span class="op" id="3843297">&amp;</span><span class="ident" id="3843298">OpError</span><span class="op" id="3843305">{</span><span class="ident" id="3843306">Op</span><span class="op" id="3843308">:</span>&nbsp;<span class="string" id="3843310">&#34;listen&#34;</span><span class="op" id="3843318">,</span>&nbsp;<span class="ident" id="3843320">Net</span><span class="op" id="3843323">:</span>&nbsp;<span class="ident" id="3843325">net</span><span class="op" id="3843328">,</span>&nbsp;<span class="ident" id="3843330">Addr</span><span class="op" id="3843334">:</span>&nbsp;<span class="ident" id="3843336">la</span><span class="op" id="3843338">,</span>&nbsp;<span class="ident" id="3843340">Err</span><span class="op" id="3843343">:</span>&nbsp;<span class="op" id="3843345">&amp;</span><span class="ident" id="3843346">AddrError</span><span class="op" id="3843355">{</span><span class="ident" id="3843356">Err</span><span class="op" id="3843359">:</span>&nbsp;<span class="string" id="3843361">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3843386">,</span>&nbsp;<span class="ident" id="3843388">Addr</span><span class="op" id="3843392">:</span>&nbsp;<span class="ident" id="3843394">laddr</span><span class="op" id="3843399">}</span><span class="op" id="3843400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3843403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3843406">if</span>&nbsp;<span class="ident" id="3843409">err</span>&nbsp;<span class="op" id="3843413">!=</span>&nbsp;<span class="builtintype" id="3843416">nil</span>&nbsp;<span class="op" id="3843420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3843424">return</span>&nbsp;<span class="builtintype" id="3843431">nil</span><span class="op" id="3843434">,</span>&nbsp;<span class="ident" id="3843436">err</span>&nbsp;<span class="comment" id="3843440">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3843490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3843493">return</span>&nbsp;<span class="ident" id="3843500">l</span><span class="op" id="3843501">,</span>&nbsp;<span class="builtintype" id="3843503">nil</span><br>
<span class="lineno"></span><span class="op" id="3843507">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
