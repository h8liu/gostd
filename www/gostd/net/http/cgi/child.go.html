<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html" class="current">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5689479">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5689534">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5689588">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5689639">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;CGI&nbsp;from&nbsp;the&nbsp;perspective&nbsp;of&nbsp;a&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="5689699">//&nbsp;process.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5689712">package</span>&nbsp;<span class="ident" id="5689720">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5689725">import</span>&nbsp;<span class="op" id="5689732">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5689735">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5689744">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5689758">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5689768">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5689775">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5689781">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5689794">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5689801">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5689813">&#34;net/url&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5689824">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5689830">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5689841">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5689851">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5689854">//&nbsp;Request&nbsp;returns&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;as&nbsp;represented&nbsp;in&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="5689920">//&nbsp;environment.&nbsp;This&nbsp;assumes&nbsp;the&nbsp;current&nbsp;program&nbsp;is&nbsp;being&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="5689982">//&nbsp;by&nbsp;a&nbsp;web&nbsp;server&nbsp;in&nbsp;a&nbsp;CGI&nbsp;environment.</span><br>
<span class="lineno"></span><span class="comment" id="5690023">//&nbsp;The&nbsp;returned&nbsp;Request&#39;s&nbsp;Body&nbsp;is&nbsp;populated,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span><span class="keyword" id="5690083">func</span>&nbsp;<span class="ident" id="5690088">Request</span><span class="op" id="5690095">(</span><span class="op" id="5690096">)</span>&nbsp;<span class="op" id="5690098">(</span><span class="op" id="5690099">*</span><span class="ident" id="5690100"><a href="/gostd/net/http/cgi/child.go.html#5689801">http</a></span><span class="op" id="5690104">.</span><span class="ident" id="5690105"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="5690112">,</span>&nbsp;<span class="builtintype" id="5690114">error</span><span class="op" id="5690119">)</span>&nbsp;<span class="op" id="5690121">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5690124">r</span><span class="op" id="5690125">,</span>&nbsp;<span class="ident" id="5690127">err</span>&nbsp;<span class="op" id="5690131">:=</span>&nbsp;<span class="ident" id="5690134"><a href="/gostd/net/http/cgi/child.go.html#5690647">RequestFromMap</a></span><span class="op" id="5690148">(</span><span class="ident" id="5690149"><a href="/gostd/net/http/cgi/child.go.html#5690332">envMap</a></span><span class="op" id="5690155">(</span><span class="ident" id="5690156"><a href="/gostd/net/http/cgi/child.go.html#5689824">os</a></span><span class="op" id="5690158">.</span><span class="ident" id="5690159"><a href="/gostd/os/env.go.html#2430342">Environ</a></span><span class="op" id="5690166">(</span><span class="op" id="5690167">)</span><span class="op" id="5690168">)</span><span class="op" id="5690169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5690172">if</span>&nbsp;<span class="ident" id="5690175"><a href="/gostd/net/http/cgi/child.go.html#5690127">err</a></span>&nbsp;<span class="op" id="5690179">!=</span>&nbsp;<span class="builtintype" id="5690182">nil</span>&nbsp;<span class="op" id="5690186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5690190">return</span>&nbsp;<span class="builtintype" id="5690197">nil</span><span class="op" id="5690200">,</span>&nbsp;<span class="ident" id="5690202"><a href="/gostd/net/http/cgi/child.go.html#5690127">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5690207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5690210">if</span>&nbsp;<span class="ident" id="5690213"><a href="/gostd/net/http/cgi/child.go.html#5690124">r</a></span><span class="op" id="5690214">.</span><span class="ident" id="5690215"><a href="/gostd/net/http/request.go.html#4138292">ContentLength</a></span>&nbsp;<span class="op" id="5690229">&gt;</span>&nbsp;<span class="num" id="5690231">0</span>&nbsp;<span class="op" id="5690233">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5690237"><a href="/gostd/net/http/cgi/child.go.html#5690124">r</a></span><span class="op" id="5690238">.</span><span class="ident" id="5690239"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span>&nbsp;<span class="op" id="5690244">=</span>&nbsp;<span class="ident" id="5690246"><a href="/gostd/net/http/cgi/child.go.html#5689781">ioutil</a></span><span class="op" id="5690252">.</span><span class="ident" id="5690253"><a href="/gostd/io/ioutil/ioutil.go.html#3767601">NopCloser</a></span><span class="op" id="5690262">(</span><span class="ident" id="5690263"><a href="/gostd/net/http/cgi/child.go.html#5689775">io</a></span><span class="op" id="5690265">.</span><span class="ident" id="5690266"><a href="/gostd/io/io.go.html#1431815">LimitReader</a></span><span class="op" id="5690277">(</span><span class="ident" id="5690278"><a href="/gostd/net/http/cgi/child.go.html#5689824">os</a></span><span class="op" id="5690280">.</span><span class="ident" id="5690281"><a href="/gostd/os/file.go.html#2441758">Stdin</a></span><span class="op" id="5690286">,</span>&nbsp;<span class="ident" id="5690288"><a href="/gostd/net/http/cgi/child.go.html#5690124">r</a></span><span class="op" id="5690289">.</span><span class="ident" id="5690290"><a href="/gostd/net/http/request.go.html#4138292">ContentLength</a></span><span class="op" id="5690303">)</span><span class="op" id="5690304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5690307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5690310">return</span>&nbsp;<span class="ident" id="5690317"><a href="/gostd/net/http/cgi/child.go.html#5690124">r</a></span><span class="op" id="5690318">,</span>&nbsp;<span class="builtintype" id="5690320">nil</span><br>
<span class="lineno"></span><span class="op" id="5690324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="5690327">func</span>&nbsp;<span class="ident" id="5690332">envMap</span><span class="op" id="5690338">(</span><span class="ident" id="5690339">env</span>&nbsp;<span class="op" id="5690343">[</span><span class="op" id="5690344">]</span><span class="builtintype" id="5690345">string</span><span class="op" id="5690351">)</span>&nbsp;<span class="keyword" id="5690353">map</span><span class="op" id="5690356">[</span><span class="builtintype" id="5690357">string</span><span class="op" id="5690363">]</span><span class="builtintype" id="5690364">string</span>&nbsp;<span class="op" id="5690371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5690374">m</span>&nbsp;<span class="op" id="5690376">:=</span>&nbsp;<span class="builtinfunc" id="5690379">make</span><span class="op" id="5690383">(</span><span class="keyword" id="5690384">map</span><span class="op" id="5690387">[</span><span class="builtintype" id="5690388">string</span><span class="op" id="5690394">]</span><span class="builtintype" id="5690395">string</span><span class="op" id="5690401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5690404">for</span>&nbsp;<span class="ident" id="5690408">_</span><span class="op" id="5690409">,</span>&nbsp;<span class="ident" id="5690411">kv</span>&nbsp;<span class="op" id="5690414">:=</span>&nbsp;<span class="keyword" id="5690417">range</span>&nbsp;<span class="ident" id="5690423"><a href="/gostd/net/http/cgi/child.go.html#5690339">env</a></span>&nbsp;<span class="op" id="5690427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5690431">if</span>&nbsp;<span class="ident" id="5690434">idx</span>&nbsp;<span class="op" id="5690438">:=</span>&nbsp;<span class="ident" id="5690441"><a href="/gostd/net/http/cgi/child.go.html#5689841">strings</a></span><span class="op" id="5690448">.</span><span class="ident" id="5690449"><a href="/gostd/strings/strings.go.html#2968883">Index</a></span><span class="op" id="5690454">(</span><span class="ident" id="5690455"><a href="/gostd/net/http/cgi/child.go.html#5690411">kv</a></span><span class="op" id="5690457">,</span>&nbsp;<span class="string" id="5690459">&#34;=&#34;</span><span class="op" id="5690462">)</span><span class="op" id="5690463">;</span>&nbsp;<span class="ident" id="5690465"><a href="/gostd/net/http/cgi/child.go.html#5690434">idx</a></span>&nbsp;<span class="op" id="5690469">!=</span>&nbsp;<span class="op" id="5690472">-</span><span class="num" id="5690473">1</span>&nbsp;<span class="op" id="5690475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5690480"><a href="/gostd/net/http/cgi/child.go.html#5690374">m</a></span><span class="op" id="5690481">[</span><span class="ident" id="5690482"><a href="/gostd/net/http/cgi/child.go.html#5690411">kv</a></span><span class="op" id="5690484">[</span><span class="op" id="5690485">:</span><span class="ident" id="5690486"><a href="/gostd/net/http/cgi/child.go.html#5690434">idx</a></span><span class="op" id="5690489">]</span><span class="op" id="5690490">]</span>&nbsp;<span class="op" id="5690492">=</span>&nbsp;<span class="ident" id="5690494"><a href="/gostd/net/http/cgi/child.go.html#5690411">kv</a></span><span class="op" id="5690496">[</span><span class="ident" id="5690497"><a href="/gostd/net/http/cgi/child.go.html#5690434">idx</a></span><span class="op" id="5690500">+</span><span class="num" id="5690501">1</span><span class="op" id="5690502">:</span><span class="op" id="5690503">]</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5690507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5690510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5690513">return</span>&nbsp;<span class="ident" id="5690520"><a href="/gostd/net/http/cgi/child.go.html#5690374">m</a></span><br>
<span class="lineno"></span><span class="op" id="5690522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5690525">//&nbsp;RequestFromMap&nbsp;creates&nbsp;an&nbsp;http.Request&nbsp;from&nbsp;CGI&nbsp;variables.</span><br>
<span class="lineno"></span><span class="comment" id="5690587">//&nbsp;The&nbsp;returned&nbsp;Request&#39;s&nbsp;Body&nbsp;field&nbsp;is&nbsp;not&nbsp;populated.</span><br>
<span class="lineno"></span><span class="keyword" id="5690642">func</span>&nbsp;<span class="ident" id="5690647">RequestFromMap</span><span class="op" id="5690661">(</span><span class="ident" id="5690662">params</span>&nbsp;<span class="keyword" id="5690669">map</span><span class="op" id="5690672">[</span><span class="builtintype" id="5690673">string</span><span class="op" id="5690679">]</span><span class="builtintype" id="5690680">string</span><span class="op" id="5690686">)</span>&nbsp;<span class="op" id="5690688">(</span><span class="op" id="5690689">*</span><span class="ident" id="5690690"><a href="/gostd/net/http/cgi/child.go.html#5689801">http</a></span><span class="op" id="5690694">.</span><span class="ident" id="5690695"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="5690702">,</span>&nbsp;<span class="builtintype" id="5690704">error</span><span class="op" id="5690709">)</span>&nbsp;<span class="op" id="5690711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5690714">r</span>&nbsp;<span class="op" id="5690716">:=</span>&nbsp;<span class="builtinfunc" id="5690719">new</span><span class="op" id="5690722">(</span><span class="ident" id="5690723"><a href="/gostd/net/http/cgi/child.go.html#5689801">http</a></span><span class="op" id="5690727">.</span><span class="ident" id="5690728"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="5690735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5690738"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5690739">.</span><span class="ident" id="5690740"><a href="/gostd/net/http/request.go.html#4136084">Method</a></span>&nbsp;<span class="op" id="5690747">=</span>&nbsp;<span class="ident" id="5690749"><a href="/gostd/net/http/cgi/child.go.html#5690662">params</a></span><span class="op" id="5690755">[</span><span class="string" id="5690756">&#34;REQUEST_METHOD&#34;</span><span class="op" id="5690772">]</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5690775">if</span>&nbsp;<span class="ident" id="5690778"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5690779">.</span><span class="ident" id="5690780"><a href="/gostd/net/http/request.go.html#4136084">Method</a></span>&nbsp;<span class="op" id="5690787">==</span>&nbsp;<span class="string" id="5690790">&#34;&#34;</span>&nbsp;<span class="op" id="5690793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5690797">return</span>&nbsp;<span class="builtintype" id="5690804">nil</span><span class="op" id="5690807">,</span>&nbsp;<span class="ident" id="5690809"><a href="/gostd/net/http/cgi/child.go.html#5689758">errors</a></span><span class="op" id="5690815">.</span><span class="ident" id="5690816"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5690819">(</span><span class="string" id="5690820">&#34;cgi:&nbsp;no&nbsp;REQUEST_METHOD&nbsp;in&nbsp;environment&#34;</span><span class="op" id="5690859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5690862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5690866"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5690867">.</span><span class="ident" id="5690868"><a href="/gostd/net/http/request.go.html#4136744">Proto</a></span>&nbsp;<span class="op" id="5690874">=</span>&nbsp;<span class="ident" id="5690876"><a href="/gostd/net/http/cgi/child.go.html#5690662">params</a></span><span class="op" id="5690882">[</span><span class="string" id="5690883">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="5690900">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5690903">var</span>&nbsp;<span class="ident" id="5690907">ok</span>&nbsp;<span class="builtintype" id="5690910">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5690916"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5690917">.</span><span class="ident" id="5690918"><a href="/gostd/net/http/request.go.html#4136777">ProtoMajor</a></span><span class="op" id="5690928">,</span>&nbsp;<span class="ident" id="5690930"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5690931">.</span><span class="ident" id="5690932"><a href="/gostd/net/http/request.go.html#4136801">ProtoMinor</a></span><span class="op" id="5690942">,</span>&nbsp;<span class="ident" id="5690944"><a href="/gostd/net/http/cgi/child.go.html#5690907">ok</a></span>&nbsp;<span class="op" id="5690947">=</span>&nbsp;<span class="ident" id="5690949"><a href="/gostd/net/http/cgi/child.go.html#5689801">http</a></span><span class="op" id="5690953">.</span><span class="ident" id="5690954"><a href="/gostd/net/http/request.go.html#4148677">ParseHTTPVersion</a></span><span class="op" id="5690970">(</span><span class="ident" id="5690971"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5690972">.</span><span class="ident" id="5690973"><a href="/gostd/net/http/request.go.html#4136744">Proto</a></span><span class="op" id="5690978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5690981">if</span>&nbsp;<span class="op" id="5690984">!</span><span class="ident" id="5690985"><a href="/gostd/net/http/cgi/child.go.html#5690907">ok</a></span>&nbsp;<span class="op" id="5690988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5690992">return</span>&nbsp;<span class="builtintype" id="5690999">nil</span><span class="op" id="5691002">,</span>&nbsp;<span class="ident" id="5691004"><a href="/gostd/net/http/cgi/child.go.html#5689758">errors</a></span><span class="op" id="5691010">.</span><span class="ident" id="5691011"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5691014">(</span><span class="string" id="5691015">&#34;cgi:&nbsp;invalid&nbsp;SERVER_PROTOCOL&nbsp;version&#34;</span><span class="op" id="5691053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5691056">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5691060"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5691061">.</span><span class="ident" id="5691062"><a href="/gostd/net/http/request.go.html#4138776">Close</a></span>&nbsp;<span class="op" id="5691068">=</span>&nbsp;<span class="builtintype" id="5691070">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5691076"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5691077">.</span><span class="ident" id="5691078"><a href="/gostd/net/http/request.go.html#4140820">Trailer</a></span>&nbsp;<span class="op" id="5691086">=</span>&nbsp;<span class="ident" id="5691088"><a href="/gostd/net/http/cgi/child.go.html#5689801">http</a></span><span class="op" id="5691092">.</span><span class="ident" id="5691093"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="5691099">{</span><span class="op" id="5691100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5691103"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5691104">.</span><span class="ident" id="5691105"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span>&nbsp;<span class="op" id="5691112">=</span>&nbsp;<span class="ident" id="5691114"><a href="/gostd/net/http/cgi/child.go.html#5689801">http</a></span><span class="op" id="5691118">.</span><span class="ident" id="5691119"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="5691125">{</span><span class="op" id="5691126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5691130"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5691131">.</span><span class="ident" id="5691132"><a href="/gostd/net/http/request.go.html#4139164">Host</a></span>&nbsp;<span class="op" id="5691137">=</span>&nbsp;<span class="ident" id="5691139"><a href="/gostd/net/http/cgi/child.go.html#5690662">params</a></span><span class="op" id="5691145">[</span><span class="string" id="5691146">&#34;HTTP_HOST&#34;</span><span class="op" id="5691157">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5691161">if</span>&nbsp;<span class="ident" id="5691164">lenstr</span>&nbsp;<span class="op" id="5691171">:=</span>&nbsp;<span class="ident" id="5691174"><a href="/gostd/net/http/cgi/child.go.html#5690662">params</a></span><span class="op" id="5691180">[</span><span class="string" id="5691181">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="5691197">]</span><span class="op" id="5691198">;</span>&nbsp;<span class="ident" id="5691200"><a href="/gostd/net/http/cgi/child.go.html#5691164">lenstr</a></span>&nbsp;<span class="op" id="5691207">!=</span>&nbsp;<span class="string" id="5691210">&#34;&#34;</span>&nbsp;<span class="op" id="5691213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5691217">clen</span><span class="op" id="5691221">,</span>&nbsp;<span class="ident" id="5691223">err</span>&nbsp;<span class="op" id="5691227">:=</span>&nbsp;<span class="ident" id="5691230"><a href="/gostd/net/http/cgi/child.go.html#5689830">strconv</a></span><span class="op" id="5691237">.</span><span class="ident" id="5691238"><a href="/gostd/strconv/atoi.go.html#2356133">ParseInt</a></span><span class="op" id="5691246">(</span><span class="ident" id="5691247"><a href="/gostd/net/http/cgi/child.go.html#5691164">lenstr</a></span><span class="op" id="5691253">,</span>&nbsp;<span class="num" id="5691255">10</span><span class="op" id="5691257">,</span>&nbsp;<span class="num" id="5691259">64</span><span class="op" id="5691261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5691265">if</span>&nbsp;<span class="ident" id="5691268"><a href="/gostd/net/http/cgi/child.go.html#5691223">err</a></span>&nbsp;<span class="op" id="5691272">!=</span>&nbsp;<span class="builtintype" id="5691275">nil</span>&nbsp;<span class="op" id="5691279">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5691284">return</span>&nbsp;<span class="builtintype" id="5691291">nil</span><span class="op" id="5691294">,</span>&nbsp;<span class="ident" id="5691296"><a href="/gostd/net/http/cgi/child.go.html#5689758">errors</a></span><span class="op" id="5691302">.</span><span class="ident" id="5691303"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5691306">(</span><span class="string" id="5691307">&#34;cgi:&nbsp;bad&nbsp;CONTENT_LENGTH&nbsp;in&nbsp;environment:&nbsp;&#34;</span>&nbsp;<span class="op" id="5691350">+</span>&nbsp;<span class="ident" id="5691352"><a href="/gostd/net/http/cgi/child.go.html#5691164">lenstr</a></span><span class="op" id="5691358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5691362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5691366"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5691367">.</span><span class="ident" id="5691368"><a href="/gostd/net/http/request.go.html#4138292">ContentLength</a></span>&nbsp;<span class="op" id="5691382">=</span>&nbsp;<span class="ident" id="5691384"><a href="/gostd/net/http/cgi/child.go.html#5691217">clen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5691390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5691394">if</span>&nbsp;<span class="ident" id="5691397">ct</span>&nbsp;<span class="op" id="5691400">:=</span>&nbsp;<span class="ident" id="5691403"><a href="/gostd/net/http/cgi/child.go.html#5690662">params</a></span><span class="op" id="5691409">[</span><span class="string" id="5691410">&#34;CONTENT_TYPE&#34;</span><span class="op" id="5691424">]</span><span class="op" id="5691425">;</span>&nbsp;<span class="ident" id="5691427"><a href="/gostd/net/http/cgi/child.go.html#5691397">ct</a></span>&nbsp;<span class="op" id="5691430">!=</span>&nbsp;<span class="string" id="5691433">&#34;&#34;</span>&nbsp;<span class="op" id="5691436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5691440"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5691441">.</span><span class="ident" id="5691442"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="5691448">.</span><span class="ident" id="5691449"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="5691452">(</span><span class="string" id="5691453">&#34;Content-Type&#34;</span><span class="op" id="5691467">,</span>&nbsp;<span class="ident" id="5691469"><a href="/gostd/net/http/cgi/child.go.html#5691397">ct</a></span><span class="op" id="5691471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5691474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5691478">//&nbsp;Copy&nbsp;&#34;HTTP_FOO_BAR&#34;&nbsp;variables&nbsp;to&nbsp;&#34;Foo-Bar&#34;&nbsp;Headers</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5691533">for</span>&nbsp;<span class="ident" id="5691537">k</span><span class="op" id="5691538">,</span>&nbsp;<span class="ident" id="5691540">v</span>&nbsp;<span class="op" id="5691542">:=</span>&nbsp;<span class="keyword" id="5691545">range</span>&nbsp;<span class="ident" id="5691551"><a href="/gostd/net/http/cgi/child.go.html#5690662">params</a></span>&nbsp;<span class="op" id="5691558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5691562">if</span>&nbsp;<span class="op" id="5691565">!</span><span class="ident" id="5691566"><a href="/gostd/net/http/cgi/child.go.html#5689841">strings</a></span><span class="op" id="5691573">.</span><span class="ident" id="5691574"><a href="/gostd/strings/strings.go.html#2975366">HasPrefix</a></span><span class="op" id="5691583">(</span><span class="ident" id="5691584"><a href="/gostd/net/http/cgi/child.go.html#5691537">k</a></span><span class="op" id="5691585">,</span>&nbsp;<span class="string" id="5691587">&#34;HTTP_&#34;</span><span class="op" id="5691594">)</span>&nbsp;<span class="op" id="5691596">||</span>&nbsp;<span class="ident" id="5691599"><a href="/gostd/net/http/cgi/child.go.html#5691537">k</a></span>&nbsp;<span class="op" id="5691601">==</span>&nbsp;<span class="string" id="5691604">&#34;HTTP_HOST&#34;</span>&nbsp;<span class="op" id="5691616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5691621">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5691632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5691636"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5691637">.</span><span class="ident" id="5691638"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="5691644">.</span><span class="ident" id="5691645"><a href="/gostd/net/http/header.go.html#4126266">Add</a></span><span class="op" id="5691648">(</span><span class="ident" id="5691649"><a href="/gostd/net/http/cgi/child.go.html#5689841">strings</a></span><span class="op" id="5691656">.</span><span class="ident" id="5691657"><a href="/gostd/strings/strings.go.html#2983409">Replace</a></span><span class="op" id="5691664">(</span><span class="ident" id="5691665"><a href="/gostd/net/http/cgi/child.go.html#5691537">k</a></span><span class="op" id="5691666">[</span><span class="num" id="5691667">5</span><span class="op" id="5691668">:</span><span class="op" id="5691669">]</span><span class="op" id="5691670">,</span>&nbsp;<span class="string" id="5691672">&#34;_&#34;</span><span class="op" id="5691675">,</span>&nbsp;<span class="string" id="5691677">&#34;-&#34;</span><span class="op" id="5691680">,</span>&nbsp;<span class="op" id="5691682">-</span><span class="num" id="5691683">1</span><span class="op" id="5691684">)</span><span class="op" id="5691685">,</span>&nbsp;<span class="ident" id="5691687"><a href="/gostd/net/http/cgi/child.go.html#5691540">v</a></span><span class="op" id="5691688">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5691691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5691695">//&nbsp;TODO:&nbsp;cookies.&nbsp;&nbsp;parsing&nbsp;them&nbsp;isn&#39;t&nbsp;exported,&nbsp;though.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5691753">uriStr</span>&nbsp;<span class="op" id="5691760">:=</span>&nbsp;<span class="ident" id="5691763"><a href="/gostd/net/http/cgi/child.go.html#5690662">params</a></span><span class="op" id="5691769">[</span><span class="string" id="5691770">&#34;REQUEST_URI&#34;</span><span class="op" id="5691783">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5691786">if</span>&nbsp;<span class="ident" id="5691789"><a href="/gostd/net/http/cgi/child.go.html#5691753">uriStr</a></span>&nbsp;<span class="op" id="5691796">==</span>&nbsp;<span class="string" id="5691799">&#34;&#34;</span>&nbsp;<span class="op" id="5691802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5691806">//&nbsp;Fallback&nbsp;to&nbsp;SCRIPT_NAME,&nbsp;PATH_INFO&nbsp;and&nbsp;QUERY_STRING.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5691864"><a href="/gostd/net/http/cgi/child.go.html#5691753">uriStr</a></span>&nbsp;<span class="op" id="5691871">=</span>&nbsp;<span class="ident" id="5691873"><a href="/gostd/net/http/cgi/child.go.html#5690662">params</a></span><span class="op" id="5691879">[</span><span class="string" id="5691880">&#34;SCRIPT_NAME&#34;</span><span class="op" id="5691893">]</span>&nbsp;<span class="op" id="5691895">+</span>&nbsp;<span class="ident" id="5691897"><a href="/gostd/net/http/cgi/child.go.html#5690662">params</a></span><span class="op" id="5691903">[</span><span class="string" id="5691904">&#34;PATH_INFO&#34;</span><span class="op" id="5691915">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5691919">s</span>&nbsp;<span class="op" id="5691921">:=</span>&nbsp;<span class="ident" id="5691924"><a href="/gostd/net/http/cgi/child.go.html#5690662">params</a></span><span class="op" id="5691930">[</span><span class="string" id="5691931">&#34;QUERY_STRING&#34;</span><span class="op" id="5691945">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5691949">if</span>&nbsp;<span class="ident" id="5691952"><a href="/gostd/net/http/cgi/child.go.html#5691919">s</a></span>&nbsp;<span class="op" id="5691954">!=</span>&nbsp;<span class="string" id="5691957">&#34;&#34;</span>&nbsp;<span class="op" id="5691960">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5691965"><a href="/gostd/net/http/cgi/child.go.html#5691753">uriStr</a></span>&nbsp;<span class="op" id="5691972">+=</span>&nbsp;<span class="string" id="5691975">&#34;?&#34;</span>&nbsp;<span class="op" id="5691979">+</span>&nbsp;<span class="ident" id="5691981"><a href="/gostd/net/http/cgi/child.go.html#5691919">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5691985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5691988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5691992">//&nbsp;There&#39;s&nbsp;apparently&nbsp;a&nbsp;de-facto&nbsp;standard&nbsp;for&nbsp;this.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692045">//&nbsp;http://docstore.mik.ua/orelly/linux/cgi/ch03_02.htm#ch03-35636</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5692112">if</span>&nbsp;<span class="ident" id="5692115">s</span>&nbsp;<span class="op" id="5692117">:=</span>&nbsp;<span class="ident" id="5692120"><a href="/gostd/net/http/cgi/child.go.html#5690662">params</a></span><span class="op" id="5692126">[</span><span class="string" id="5692127">&#34;HTTPS&#34;</span><span class="op" id="5692134">]</span><span class="op" id="5692135">;</span>&nbsp;<span class="ident" id="5692137"><a href="/gostd/net/http/cgi/child.go.html#5692115">s</a></span>&nbsp;<span class="op" id="5692139">==</span>&nbsp;<span class="string" id="5692142">&#34;on&#34;</span>&nbsp;<span class="op" id="5692147">||</span>&nbsp;<span class="ident" id="5692150"><a href="/gostd/net/http/cgi/child.go.html#5692115">s</a></span>&nbsp;<span class="op" id="5692152">==</span>&nbsp;<span class="string" id="5692155">&#34;ON&#34;</span>&nbsp;<span class="op" id="5692160">||</span>&nbsp;<span class="ident" id="5692163"><a href="/gostd/net/http/cgi/child.go.html#5692115">s</a></span>&nbsp;<span class="op" id="5692165">==</span>&nbsp;<span class="string" id="5692168">&#34;1&#34;</span>&nbsp;<span class="op" id="5692172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692176"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5692177">.</span><span class="ident" id="5692178"><a href="/gostd/net/http/request.go.html#4141858">TLS</a></span>&nbsp;<span class="op" id="5692182">=</span>&nbsp;<span class="op" id="5692184">&amp;</span><span class="ident" id="5692185"><a href="/gostd/net/http/cgi/child.go.html#5689744">tls</a></span><span class="op" id="5692188">.</span><span class="ident" id="5692189"><a href="/gostd/crypto/tls/common.go.html#4446494">ConnectionState</a></span><span class="op" id="5692204">{</span><span class="ident" id="5692205"><a href="/gostd/crypto/tls/common.go.html#4446628">HandshakeComplete</a></span><span class="op" id="5692222">:</span>&nbsp;<span class="builtintype" id="5692224">true</span><span class="op" id="5692228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5692231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5692235">if</span>&nbsp;<span class="ident" id="5692238"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5692239">.</span><span class="ident" id="5692240"><a href="/gostd/net/http/request.go.html#4139164">Host</a></span>&nbsp;<span class="op" id="5692245">!=</span>&nbsp;<span class="string" id="5692248">&#34;&#34;</span>&nbsp;<span class="op" id="5692251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692255">//&nbsp;Hostname&nbsp;is&nbsp;provided,&nbsp;so&nbsp;we&nbsp;can&nbsp;reasonably&nbsp;construct&nbsp;a&nbsp;URL.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692320">rawurl</span>&nbsp;<span class="op" id="5692327">:=</span>&nbsp;<span class="ident" id="5692330"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5692331">.</span><span class="ident" id="5692332"><a href="/gostd/net/http/request.go.html#4139164">Host</a></span>&nbsp;<span class="op" id="5692337">+</span>&nbsp;<span class="ident" id="5692339"><a href="/gostd/net/http/cgi/child.go.html#5691753">uriStr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5692348">if</span>&nbsp;<span class="ident" id="5692351"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5692352">.</span><span class="ident" id="5692353"><a href="/gostd/net/http/request.go.html#4141858">TLS</a></span>&nbsp;<span class="op" id="5692357">==</span>&nbsp;<span class="builtintype" id="5692360">nil</span>&nbsp;<span class="op" id="5692364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692369"><a href="/gostd/net/http/cgi/child.go.html#5692320">rawurl</a></span>&nbsp;<span class="op" id="5692376">=</span>&nbsp;<span class="string" id="5692378">&#34;http://&#34;</span>&nbsp;<span class="op" id="5692388">+</span>&nbsp;<span class="ident" id="5692390"><a href="/gostd/net/http/cgi/child.go.html#5692320">rawurl</a></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5692399">}</span>&nbsp;<span class="keyword" id="5692401">else</span>&nbsp;<span class="op" id="5692406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692411"><a href="/gostd/net/http/cgi/child.go.html#5692320">rawurl</a></span>&nbsp;<span class="op" id="5692418">=</span>&nbsp;<span class="string" id="5692420">&#34;https://&#34;</span>&nbsp;<span class="op" id="5692431">+</span>&nbsp;<span class="ident" id="5692433"><a href="/gostd/net/http/cgi/child.go.html#5692320">rawurl</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5692442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692446">url</span><span class="op" id="5692449">,</span>&nbsp;<span class="ident" id="5692451">err</span>&nbsp;<span class="op" id="5692455">:=</span>&nbsp;<span class="ident" id="5692458"><a href="/gostd/net/http/cgi/child.go.html#5689813">url</a></span><span class="op" id="5692461">.</span><span class="ident" id="5692462"><a href="/gostd/net/url/url.go.html#3754169">Parse</a></span><span class="op" id="5692467">(</span><span class="ident" id="5692468"><a href="/gostd/net/http/cgi/child.go.html#5692320">rawurl</a></span><span class="op" id="5692474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5692478">if</span>&nbsp;<span class="ident" id="5692481"><a href="/gostd/net/http/cgi/child.go.html#5692451">err</a></span>&nbsp;<span class="op" id="5692485">!=</span>&nbsp;<span class="builtintype" id="5692488">nil</span>&nbsp;<span class="op" id="5692492">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5692497">return</span>&nbsp;<span class="builtintype" id="5692504">nil</span><span class="op" id="5692507">,</span>&nbsp;<span class="ident" id="5692509"><a href="/gostd/net/http/cgi/child.go.html#5689758">errors</a></span><span class="op" id="5692515">.</span><span class="ident" id="5692516"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5692519">(</span><span class="string" id="5692520">&#34;cgi:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;host&nbsp;and&nbsp;REQUEST_URI&nbsp;into&nbsp;a&nbsp;URL:&nbsp;&#34;</span>&nbsp;<span class="op" id="5692577">+</span>&nbsp;<span class="ident" id="5692579"><a href="/gostd/net/http/cgi/child.go.html#5692320">rawurl</a></span><span class="op" id="5692585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5692589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692593"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5692594">.</span><span class="ident" id="5692595"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span>&nbsp;<span class="op" id="5692599">=</span>&nbsp;<span class="ident" id="5692601"><a href="/gostd/net/http/cgi/child.go.html#5692446">url</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5692606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692609">//&nbsp;Fallback&nbsp;logic&nbsp;if&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;Host&nbsp;header&nbsp;or&nbsp;the&nbsp;URL</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692670">//&nbsp;failed&nbsp;to&nbsp;parse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5692690">if</span>&nbsp;<span class="ident" id="5692693"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5692694">.</span><span class="ident" id="5692695"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span>&nbsp;<span class="op" id="5692699">==</span>&nbsp;<span class="builtintype" id="5692702">nil</span>&nbsp;<span class="op" id="5692706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692710">url</span><span class="op" id="5692713">,</span>&nbsp;<span class="ident" id="5692715">err</span>&nbsp;<span class="op" id="5692719">:=</span>&nbsp;<span class="ident" id="5692722"><a href="/gostd/net/http/cgi/child.go.html#5689813">url</a></span><span class="op" id="5692725">.</span><span class="ident" id="5692726"><a href="/gostd/net/url/url.go.html#3754169">Parse</a></span><span class="op" id="5692731">(</span><span class="ident" id="5692732"><a href="/gostd/net/http/cgi/child.go.html#5691753">uriStr</a></span><span class="op" id="5692738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5692742">if</span>&nbsp;<span class="ident" id="5692745"><a href="/gostd/net/http/cgi/child.go.html#5692715">err</a></span>&nbsp;<span class="op" id="5692749">!=</span>&nbsp;<span class="builtintype" id="5692752">nil</span>&nbsp;<span class="op" id="5692756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5692761">return</span>&nbsp;<span class="builtintype" id="5692768">nil</span><span class="op" id="5692771">,</span>&nbsp;<span class="ident" id="5692773"><a href="/gostd/net/http/cgi/child.go.html#5689758">errors</a></span><span class="op" id="5692779">.</span><span class="ident" id="5692780"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5692783">(</span><span class="string" id="5692784">&#34;cgi:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;REQUEST_URI&nbsp;into&nbsp;a&nbsp;URL:&nbsp;&#34;</span>&nbsp;<span class="op" id="5692832">+</span>&nbsp;<span class="ident" id="5692834"><a href="/gostd/net/http/cgi/child.go.html#5691753">uriStr</a></span><span class="op" id="5692840">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5692844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5692848"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5692849">.</span><span class="ident" id="5692850"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span>&nbsp;<span class="op" id="5692854">=</span>&nbsp;<span class="ident" id="5692856"><a href="/gostd/net/http/cgi/child.go.html#5692710">url</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5692861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692865">//&nbsp;Request.RemoteAddr&nbsp;has&nbsp;its&nbsp;port&nbsp;set&nbsp;by&nbsp;Go&#39;s&nbsp;standard&nbsp;http</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692927">//&nbsp;server,&nbsp;so&nbsp;we&nbsp;do&nbsp;here&nbsp;too.&nbsp;We&nbsp;don&#39;t&nbsp;have&nbsp;one,&nbsp;though,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5692991">//&nbsp;use&nbsp;a&nbsp;dummy&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693012"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5693013">.</span><span class="ident" id="5693014"><a href="/gostd/net/http/request.go.html#4141200">RemoteAddr</a></span>&nbsp;<span class="op" id="5693025">=</span>&nbsp;<span class="ident" id="5693027"><a href="/gostd/net/http/cgi/child.go.html#5689794">net</a></span><span class="op" id="5693030">.</span><span class="ident" id="5693031"><a href="/gostd/net/ipsock.go.html#3315078">JoinHostPort</a></span><span class="op" id="5693043">(</span><span class="ident" id="5693044"><a href="/gostd/net/http/cgi/child.go.html#5690662">params</a></span><span class="op" id="5693050">[</span><span class="string" id="5693051">&#34;REMOTE_ADDR&#34;</span><span class="op" id="5693064">]</span><span class="op" id="5693065">,</span>&nbsp;<span class="string" id="5693067">&#34;0&#34;</span><span class="op" id="5693070">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5693074">return</span>&nbsp;<span class="ident" id="5693081"><a href="/gostd/net/http/cgi/child.go.html#5690714">r</a></span><span class="op" id="5693082">,</span>&nbsp;<span class="builtintype" id="5693084">nil</span><br>
<span class="lineno">140</span><span class="op" id="5693088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5693091">//&nbsp;Serve&nbsp;executes&nbsp;the&nbsp;provided&nbsp;Handler&nbsp;on&nbsp;the&nbsp;currently&nbsp;active&nbsp;CGI</span><br>
<span class="lineno"></span><span class="comment" id="5693158">//&nbsp;request,&nbsp;if&nbsp;any.&nbsp;If&nbsp;there&#39;s&nbsp;no&nbsp;current&nbsp;CGI&nbsp;environment</span><br>
<span class="lineno"></span><span class="comment" id="5693216">//&nbsp;an&nbsp;error&nbsp;is&nbsp;returned.&nbsp;The&nbsp;provided&nbsp;handler&nbsp;may&nbsp;be&nbsp;nil&nbsp;to&nbsp;use</span><br>
<span class="lineno">145</span><span class="comment" id="5693280">//&nbsp;http.DefaultServeMux.</span><br>
<span class="lineno"></span><span class="keyword" id="5693305">func</span>&nbsp;<span class="ident" id="5693310">Serve</span><span class="op" id="5693315">(</span><span class="ident" id="5693316">handler</span>&nbsp;<span class="ident" id="5693324"><a href="/gostd/net/http/cgi/child.go.html#5689801">http</a></span><span class="op" id="5693328">.</span><span class="ident" id="5693329"><a href="/gostd/net/http/server.go.html#4170413">Handler</a></span><span class="op" id="5693336">)</span>&nbsp;<span class="builtintype" id="5693338">error</span>&nbsp;<span class="op" id="5693344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693347">req</span><span class="op" id="5693350">,</span>&nbsp;<span class="ident" id="5693352">err</span>&nbsp;<span class="op" id="5693356">:=</span>&nbsp;<span class="ident" id="5693359"><a href="/gostd/net/http/cgi/child.go.html#5690088">Request</a></span><span class="op" id="5693366">(</span><span class="op" id="5693367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5693370">if</span>&nbsp;<span class="ident" id="5693373"><a href="/gostd/net/http/cgi/child.go.html#5693352">err</a></span>&nbsp;<span class="op" id="5693377">!=</span>&nbsp;<span class="builtintype" id="5693380">nil</span>&nbsp;<span class="op" id="5693384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5693388">return</span>&nbsp;<span class="ident" id="5693395"><a href="/gostd/net/http/cgi/child.go.html#5693352">err</a></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5693400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5693403">if</span>&nbsp;<span class="ident" id="5693406"><a href="/gostd/net/http/cgi/child.go.html#5693316">handler</a></span>&nbsp;<span class="op" id="5693414">==</span>&nbsp;<span class="builtintype" id="5693417">nil</span>&nbsp;<span class="op" id="5693421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693425"><a href="/gostd/net/http/cgi/child.go.html#5693316">handler</a></span>&nbsp;<span class="op" id="5693433">=</span>&nbsp;<span class="ident" id="5693435"><a href="/gostd/net/http/cgi/child.go.html#5689801">http</a></span><span class="op" id="5693439">.</span><span class="ident" id="5693440"><a href="/gostd/net/http/server.go.html#4211381">DefaultServeMux</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5693457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693460">rw</span>&nbsp;<span class="op" id="5693463">:=</span>&nbsp;<span class="op" id="5693466">&amp;</span><span class="ident" id="5693467"><a href="/gostd/net/http/cgi/child.go.html#5693713">response</a></span><span class="op" id="5693475">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693479"><a href="/gostd/net/http/cgi/child.go.html#5693732">req</a></span><span class="op" id="5693482">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693487"><a href="/gostd/net/http/cgi/child.go.html#5693347">req</a></span><span class="op" id="5693490">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693494"><a href="/gostd/net/http/cgi/child.go.html#5693758">header</a></span><span class="op" id="5693500">:</span>&nbsp;<span class="builtinfunc" id="5693502">make</span><span class="op" id="5693506">(</span><span class="ident" id="5693507"><a href="/gostd/net/http/cgi/child.go.html#5689801">http</a></span><span class="op" id="5693511">.</span><span class="ident" id="5693512"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="5693518">)</span><span class="op" id="5693519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693523"><a href="/gostd/net/http/cgi/child.go.html#5693782">bufw</a></span><span class="op" id="5693527">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5693531"><a href="/gostd/net/http/cgi/child.go.html#5689735">bufio</a></span><span class="op" id="5693536">.</span><span class="ident" id="5693537"><a href="/gostd/bufio/bufio.go.html#1367149">NewWriter</a></span><span class="op" id="5693546">(</span><span class="ident" id="5693547"><a href="/gostd/net/http/cgi/child.go.html#5689824">os</a></span><span class="op" id="5693549">.</span><span class="ident" id="5693550"><a href="/gostd/os/file.go.html#2441814">Stdout</a></span><span class="op" id="5693556">)</span><span class="op" id="5693557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5693560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693563"><a href="/gostd/net/http/cgi/child.go.html#5693316">handler</a></span><span class="op" id="5693570">.</span><span class="ident" id="5693571"><a href="/gostd/net/http/server.go.html#4170434">ServeHTTP</a></span><span class="op" id="5693580">(</span><span class="ident" id="5693581"><a href="/gostd/net/http/cgi/child.go.html#5693460">rw</a></span><span class="op" id="5693583">,</span>&nbsp;<span class="ident" id="5693585"><a href="/gostd/net/http/cgi/child.go.html#5693347">req</a></span><span class="op" id="5693588">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693591"><a href="/gostd/net/http/cgi/child.go.html#5693460">rw</a></span><span class="op" id="5693593">.</span><span class="ident" id="5693594"><a href="/gostd/net/http/cgi/child.go.html#5693956">Write</a></span><span class="op" id="5693599">(</span><span class="builtintype" id="5693600">nil</span><span class="op" id="5693603">)</span>&nbsp;<span class="comment" id="5693605">//&nbsp;make&nbsp;sure&nbsp;a&nbsp;response&nbsp;is&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5693638">if</span>&nbsp;<span class="ident" id="5693641"><a href="/gostd/net/http/cgi/child.go.html#5693352">err</a></span>&nbsp;<span class="op" id="5693645">=</span>&nbsp;<span class="ident" id="5693647"><a href="/gostd/net/http/cgi/child.go.html#5693460">rw</a></span><span class="op" id="5693649">.</span><span class="ident" id="5693650"><a href="/gostd/net/http/cgi/child.go.html#5693782">bufw</a></span><span class="op" id="5693654">.</span><span class="ident" id="5693655"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="5693660">(</span><span class="op" id="5693661">)</span><span class="op" id="5693662">;</span>&nbsp;<span class="ident" id="5693664"><a href="/gostd/net/http/cgi/child.go.html#5693352">err</a></span>&nbsp;<span class="op" id="5693668">!=</span>&nbsp;<span class="builtintype" id="5693671">nil</span>&nbsp;<span class="op" id="5693675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5693679">return</span>&nbsp;<span class="ident" id="5693686"><a href="/gostd/net/http/cgi/child.go.html#5693352">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5693691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5693694">return</span>&nbsp;<span class="builtintype" id="5693701">nil</span><br>
<span class="lineno">165</span><span class="op" id="5693705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5693708">type</span>&nbsp;<span class="ident" id="5693713">response</span>&nbsp;<span class="keyword" id="5693722">struct</span>&nbsp;<span class="op" id="5693729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693732">req</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5693743">*</span><span class="ident" id="5693744"><a href="/gostd/net/http/cgi/child.go.html#5689801">http</a></span><span class="op" id="5693748">.</span><span class="ident" id="5693749"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693758">header</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693769"><a href="/gostd/net/http/cgi/child.go.html#5689801">http</a></span><span class="op" id="5693773">.</span><span class="ident" id="5693774"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693782">bufw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5693793">*</span><span class="ident" id="5693794"><a href="/gostd/net/http/cgi/child.go.html#5689735">bufio</a></span><span class="op" id="5693799">.</span><span class="ident" id="5693800"><a href="/gostd/bufio/bufio.go.html#1366565">Writer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693808">headerSent</span>&nbsp;<span class="builtintype" id="5693819">bool</span><br>
<span class="lineno"></span><span class="op" id="5693824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5693827">func</span>&nbsp;<span class="op" id="5693832">(</span><span class="ident" id="5693833">r</span>&nbsp;<span class="op" id="5693835">*</span><span class="ident" id="5693836"><a href="/gostd/net/http/cgi/child.go.html#5693713">response</a></span><span class="op" id="5693844">)</span>&nbsp;<span class="ident" id="5693846">Flush</span><span class="op" id="5693851">(</span><span class="op" id="5693852">)</span>&nbsp;<span class="op" id="5693854">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5693857"><a href="/gostd/net/http/cgi/child.go.html#5693833">r</a></span><span class="op" id="5693858">.</span><span class="ident" id="5693859"><a href="/gostd/net/http/cgi/child.go.html#5693782">bufw</a></span><span class="op" id="5693863">.</span><span class="ident" id="5693864"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="5693869">(</span><span class="op" id="5693870">)</span><br>
<span class="lineno"></span><span class="op" id="5693872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5693875">func</span>&nbsp;<span class="op" id="5693880">(</span><span class="ident" id="5693881">r</span>&nbsp;<span class="op" id="5693883">*</span><span class="ident" id="5693884"><a href="/gostd/net/http/cgi/child.go.html#5693713">response</a></span><span class="op" id="5693892">)</span>&nbsp;<span class="ident" id="5693894">Header</span><span class="op" id="5693900">(</span><span class="op" id="5693901">)</span>&nbsp;<span class="ident" id="5693903"><a href="/gostd/net/http/cgi/child.go.html#5689801">http</a></span><span class="op" id="5693907">.</span><span class="ident" id="5693908"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span>&nbsp;<span class="op" id="5693915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5693918">return</span>&nbsp;<span class="ident" id="5693925"><a href="/gostd/net/http/cgi/child.go.html#5693881">r</a></span><span class="op" id="5693926">.</span><span class="ident" id="5693927"><a href="/gostd/net/http/cgi/child.go.html#5693758">header</a></span><br>
<span class="lineno">180</span><span class="op" id="5693934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5693937">func</span>&nbsp;<span class="op" id="5693942">(</span><span class="ident" id="5693943">r</span>&nbsp;<span class="op" id="5693945">*</span><span class="ident" id="5693946"><a href="/gostd/net/http/cgi/child.go.html#5693713">response</a></span><span class="op" id="5693954">)</span>&nbsp;<span class="ident" id="5693956">Write</span><span class="op" id="5693961">(</span><span class="ident" id="5693962">p</span>&nbsp;<span class="op" id="5693964">[</span><span class="op" id="5693965">]</span><span class="builtintype" id="5693966">byte</span><span class="op" id="5693970">)</span>&nbsp;<span class="op" id="5693972">(</span><span class="ident" id="5693973">n</span>&nbsp;<span class="builtintype" id="5693975">int</span><span class="op" id="5693978">,</span>&nbsp;<span class="ident" id="5693980">err</span>&nbsp;<span class="builtintype" id="5693984">error</span><span class="op" id="5693989">)</span>&nbsp;<span class="op" id="5693991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5693994">if</span>&nbsp;<span class="op" id="5693997">!</span><span class="ident" id="5693998"><a href="/gostd/net/http/cgi/child.go.html#5693943">r</a></span><span class="op" id="5693999">.</span><span class="ident" id="5694000"><a href="/gostd/net/http/cgi/child.go.html#5693808">headerSent</a></span>&nbsp;<span class="op" id="5694011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5694015"><a href="/gostd/net/http/cgi/child.go.html#5693943">r</a></span><span class="op" id="5694016">.</span><span class="ident" id="5694017"><a href="/gostd/net/http/cgi/child.go.html#5694093">WriteHeader</a></span><span class="op" id="5694028">(</span><span class="ident" id="5694029"><a href="/gostd/net/http/cgi/child.go.html#5689801">http</a></span><span class="op" id="5694033">.</span><span class="ident" id="5694034"><a href="/gostd/net/http/status.go.html#4236210">StatusOK</a></span><span class="op" id="5694042">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5694045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5694048">return</span>&nbsp;<span class="ident" id="5694055"><a href="/gostd/net/http/cgi/child.go.html#5693943">r</a></span><span class="op" id="5694056">.</span><span class="ident" id="5694057"><a href="/gostd/net/http/cgi/child.go.html#5693782">bufw</a></span><span class="op" id="5694061">.</span><span class="ident" id="5694062"><a href="/gostd/bufio/bufio.go.html#1368329">Write</a></span><span class="op" id="5694067">(</span><span class="ident" id="5694068"><a href="/gostd/net/http/cgi/child.go.html#5693962">p</a></span><span class="op" id="5694069">)</span><br>
<span class="lineno"></span><span class="op" id="5694071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5694074">func</span>&nbsp;<span class="op" id="5694079">(</span><span class="ident" id="5694080">r</span>&nbsp;<span class="op" id="5694082">*</span><span class="ident" id="5694083"><a href="/gostd/net/http/cgi/child.go.html#5693713">response</a></span><span class="op" id="5694091">)</span>&nbsp;<span class="ident" id="5694093">WriteHeader</span><span class="op" id="5694104">(</span><span class="ident" id="5694105">code</span>&nbsp;<span class="builtintype" id="5694110">int</span><span class="op" id="5694113">)</span>&nbsp;<span class="op" id="5694115">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5694118">if</span>&nbsp;<span class="ident" id="5694121"><a href="/gostd/net/http/cgi/child.go.html#5694080">r</a></span><span class="op" id="5694122">.</span><span class="ident" id="5694123"><a href="/gostd/net/http/cgi/child.go.html#5693808">headerSent</a></span>&nbsp;<span class="op" id="5694134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5694138">//&nbsp;Note:&nbsp;explicitly&nbsp;using&nbsp;Stderr,&nbsp;as&nbsp;Stdout&nbsp;is&nbsp;our&nbsp;HTTP&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5694204"><a href="/gostd/net/http/cgi/child.go.html#5689768">fmt</a></span><span class="op" id="5694207">.</span><span class="ident" id="5694208"><a href="/gostd/fmt/print.go.html#2143118">Fprintf</a></span><span class="op" id="5694215">(</span><span class="ident" id="5694216"><a href="/gostd/net/http/cgi/child.go.html#5689824">os</a></span><span class="op" id="5694218">.</span><span class="ident" id="5694219"><a href="/gostd/os/file.go.html#2441872">Stderr</a></span><span class="op" id="5694225">,</span>&nbsp;<span class="string" id="5694227">&#34;CGI&nbsp;attempted&nbsp;to&nbsp;write&nbsp;header&nbsp;twice&nbsp;on&nbsp;request&nbsp;for&nbsp;%s&#34;</span><span class="op" id="5694282">,</span>&nbsp;<span class="ident" id="5694284"><a href="/gostd/net/http/cgi/child.go.html#5694080">r</a></span><span class="op" id="5694285">.</span><span class="ident" id="5694286"><a href="/gostd/net/http/cgi/child.go.html#5693732">req</a></span><span class="op" id="5694289">.</span><span class="ident" id="5694290"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="5694293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5694297">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5694305">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5694308"><a href="/gostd/net/http/cgi/child.go.html#5694080">r</a></span><span class="op" id="5694309">.</span><span class="ident" id="5694310"><a href="/gostd/net/http/cgi/child.go.html#5693808">headerSent</a></span>&nbsp;<span class="op" id="5694321">=</span>&nbsp;<span class="builtintype" id="5694323">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5694329"><a href="/gostd/net/http/cgi/child.go.html#5689768">fmt</a></span><span class="op" id="5694332">.</span><span class="ident" id="5694333"><a href="/gostd/fmt/print.go.html#2143118">Fprintf</a></span><span class="op" id="5694340">(</span><span class="ident" id="5694341"><a href="/gostd/net/http/cgi/child.go.html#5694080">r</a></span><span class="op" id="5694342">.</span><span class="ident" id="5694343"><a href="/gostd/net/http/cgi/child.go.html#5693782">bufw</a></span><span class="op" id="5694347">,</span>&nbsp;<span class="string" id="5694349">&#34;Status:&nbsp;%d&nbsp;%s\r\n&#34;</span><span class="op" id="5694368">,</span>&nbsp;<span class="ident" id="5694370"><a href="/gostd/net/http/cgi/child.go.html#5694105">code</a></span><span class="op" id="5694374">,</span>&nbsp;<span class="ident" id="5694376"><a href="/gostd/net/http/cgi/child.go.html#5689801">http</a></span><span class="op" id="5694380">.</span><span class="ident" id="5694381"><a href="/gostd/net/http/status.go.html#4240526">StatusText</a></span><span class="op" id="5694391">(</span><span class="ident" id="5694392"><a href="/gostd/net/http/cgi/child.go.html#5694105">code</a></span><span class="op" id="5694396">)</span><span class="op" id="5694397">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5694401">//&nbsp;Set&nbsp;a&nbsp;default&nbsp;Content-Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5694432">if</span>&nbsp;<span class="ident" id="5694435">_</span><span class="op" id="5694436">,</span>&nbsp;<span class="ident" id="5694438">hasType</span>&nbsp;<span class="op" id="5694446">:=</span>&nbsp;<span class="ident" id="5694449"><a href="/gostd/net/http/cgi/child.go.html#5694080">r</a></span><span class="op" id="5694450">.</span><span class="ident" id="5694451"><a href="/gostd/net/http/cgi/child.go.html#5693758">header</a></span><span class="op" id="5694457">[</span><span class="string" id="5694458">&#34;Content-Type&#34;</span><span class="op" id="5694472">]</span><span class="op" id="5694473">;</span>&nbsp;<span class="op" id="5694475">!</span><span class="ident" id="5694476"><a href="/gostd/net/http/cgi/child.go.html#5694438">hasType</a></span>&nbsp;<span class="op" id="5694484">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5694488"><a href="/gostd/net/http/cgi/child.go.html#5694080">r</a></span><span class="op" id="5694489">.</span><span class="ident" id="5694490"><a href="/gostd/net/http/cgi/child.go.html#5693758">header</a></span><span class="op" id="5694496">.</span><span class="ident" id="5694497"><a href="/gostd/net/http/header.go.html#4126266">Add</a></span><span class="op" id="5694500">(</span><span class="string" id="5694501">&#34;Content-Type&#34;</span><span class="op" id="5694515">,</span>&nbsp;<span class="string" id="5694517">&#34;text/html;&nbsp;charset=utf-8&#34;</span><span class="op" id="5694543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5694546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5694550"><a href="/gostd/net/http/cgi/child.go.html#5694080">r</a></span><span class="op" id="5694551">.</span><span class="ident" id="5694552"><a href="/gostd/net/http/cgi/child.go.html#5693758">header</a></span><span class="op" id="5694558">.</span><span class="ident" id="5694559"><a href="/gostd/net/http/header.go.html#4127211">Write</a></span><span class="op" id="5694564">(</span><span class="ident" id="5694565"><a href="/gostd/net/http/cgi/child.go.html#5694080">r</a></span><span class="op" id="5694566">.</span><span class="ident" id="5694567"><a href="/gostd/net/http/cgi/child.go.html#5693782">bufw</a></span><span class="op" id="5694571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5694574"><a href="/gostd/net/http/cgi/child.go.html#5694080">r</a></span><span class="op" id="5694575">.</span><span class="ident" id="5694576"><a href="/gostd/net/http/cgi/child.go.html#5693782">bufw</a></span><span class="op" id="5694580">.</span><span class="ident" id="5694581"><a href="/gostd/bufio/bufio.go.html#1369779">WriteString</a></span><span class="op" id="5694592">(</span><span class="string" id="5694593">&#34;\r\n&#34;</span><span class="op" id="5694599">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5694602"><a href="/gostd/net/http/cgi/child.go.html#5694080">r</a></span><span class="op" id="5694603">.</span><span class="ident" id="5694604"><a href="/gostd/net/http/cgi/child.go.html#5693782">bufw</a></span><span class="op" id="5694608">.</span><span class="ident" id="5694609"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="5694614">(</span><span class="op" id="5694615">)</span><br>
<span class="lineno"></span><span class="op" id="5694617">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
