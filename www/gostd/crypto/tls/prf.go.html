<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4198009">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4198064">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4198118">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4198169">package</span>&nbsp;<span class="ident" id="4198177">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4198182">import</span>&nbsp;<span class="op" id="4198189">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4198192">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4198202">&#34;crypto/hmac&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4198217">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4198231">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4198246">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4198263">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4198270">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4198273">//&nbsp;Split&nbsp;a&nbsp;premaster&nbsp;secret&nbsp;in&nbsp;two&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4198345">func</span>&nbsp;<span class="ident" id="4198350">splitPreMasterSecret</span><span class="op" id="4198370">(</span><span class="ident" id="4198371">secret</span>&nbsp;<span class="op" id="4198378">[</span><span class="op" id="4198379">]</span><span class="builtintype" id="4198380">byte</span><span class="op" id="4198384">)</span>&nbsp;<span class="op" id="4198386">(</span><span class="ident" id="4198387">s1</span><span class="op" id="4198389">,</span>&nbsp;<span class="ident" id="4198391">s2</span>&nbsp;<span class="op" id="4198394">[</span><span class="op" id="4198395">]</span><span class="builtintype" id="4198396">byte</span><span class="op" id="4198400">)</span>&nbsp;<span class="op" id="4198402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198405">s1</span>&nbsp;<span class="op" id="4198408">=</span>&nbsp;<span class="ident" id="4198410">secret</span><span class="op" id="4198416">[</span><span class="num" id="4198417">0</span>&nbsp;<span class="op" id="4198419">:</span>&nbsp;<span class="op" id="4198421">(</span><span class="builtinfunc" id="4198422">len</span><span class="op" id="4198425">(</span><span class="ident" id="4198426">secret</span><span class="op" id="4198432">)</span><span class="op" id="4198433">+</span><span class="num" id="4198434">1</span><span class="op" id="4198435">)</span><span class="op" id="4198436">/</span><span class="num" id="4198437">2</span><span class="op" id="4198438">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198441">s2</span>&nbsp;<span class="op" id="4198444">=</span>&nbsp;<span class="ident" id="4198446">secret</span><span class="op" id="4198452">[</span><span class="builtinfunc" id="4198453">len</span><span class="op" id="4198456">(</span><span class="ident" id="4198457">secret</span><span class="op" id="4198463">)</span><span class="op" id="4198464">/</span><span class="num" id="4198465">2</span><span class="op" id="4198466">:</span><span class="op" id="4198467">]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198470">return</span><br>
<span class="lineno"></span><span class="op" id="4198477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4198480">//&nbsp;pHash&nbsp;implements&nbsp;the&nbsp;P_hash&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4198556">func</span>&nbsp;<span class="ident" id="4198561">pHash</span><span class="op" id="4198566">(</span><span class="ident" id="4198567">result</span><span class="op" id="4198573">,</span>&nbsp;<span class="ident" id="4198575">secret</span><span class="op" id="4198581">,</span>&nbsp;<span class="ident" id="4198583">seed</span>&nbsp;<span class="op" id="4198588">[</span><span class="op" id="4198589">]</span><span class="builtintype" id="4198590">byte</span><span class="op" id="4198594">,</span>&nbsp;<span class="ident" id="4198596">hash</span>&nbsp;<span class="keyword" id="4198601">func</span><span class="op" id="4198605">(</span><span class="op" id="4198606">)</span>&nbsp;<span class="ident" id="4198608">hash</span><span class="op" id="4198612">.</span><span class="ident" id="4198613">Hash</span><span class="op" id="4198617">)</span>&nbsp;<span class="op" id="4198619">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198622">h</span>&nbsp;<span class="op" id="4198624">:=</span>&nbsp;<span class="ident" id="4198627">hmac</span><span class="op" id="4198631">.</span><span class="ident" id="4198632">New</span><span class="op" id="4198635">(</span><span class="ident" id="4198636">hash</span><span class="op" id="4198640">,</span>&nbsp;<span class="ident" id="4198642">secret</span><span class="op" id="4198648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198651">h</span><span class="op" id="4198652">.</span><span class="ident" id="4198653">Write</span><span class="op" id="4198658">(</span><span class="ident" id="4198659">seed</span><span class="op" id="4198663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198666">a</span>&nbsp;<span class="op" id="4198668">:=</span>&nbsp;<span class="ident" id="4198671">h</span><span class="op" id="4198672">.</span><span class="ident" id="4198673">Sum</span><span class="op" id="4198676">(</span><span class="ident" id="4198677">nil</span><span class="op" id="4198680">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198684">j</span>&nbsp;<span class="op" id="4198686">:=</span>&nbsp;<span class="num" id="4198689">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198692">for</span>&nbsp;<span class="ident" id="4198696">j</span>&nbsp;<span class="op" id="4198698">&lt;</span>&nbsp;<span class="builtinfunc" id="4198700">len</span><span class="op" id="4198703">(</span><span class="ident" id="4198704">result</span><span class="op" id="4198710">)</span>&nbsp;<span class="op" id="4198712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198716">h</span><span class="op" id="4198717">.</span><span class="ident" id="4198718">Reset</span><span class="op" id="4198723">(</span><span class="op" id="4198724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198728">h</span><span class="op" id="4198729">.</span><span class="ident" id="4198730">Write</span><span class="op" id="4198735">(</span><span class="ident" id="4198736">a</span><span class="op" id="4198737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198741">h</span><span class="op" id="4198742">.</span><span class="ident" id="4198743">Write</span><span class="op" id="4198748">(</span><span class="ident" id="4198749">seed</span><span class="op" id="4198753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198757">b</span>&nbsp;<span class="op" id="4198759">:=</span>&nbsp;<span class="ident" id="4198762">h</span><span class="op" id="4198763">.</span><span class="ident" id="4198764">Sum</span><span class="op" id="4198767">(</span><span class="ident" id="4198768">nil</span><span class="op" id="4198771">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198775">todo</span>&nbsp;<span class="op" id="4198780">:=</span>&nbsp;<span class="builtinfunc" id="4198783">len</span><span class="op" id="4198786">(</span><span class="ident" id="4198787">b</span><span class="op" id="4198788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4198792">if</span>&nbsp;<span class="ident" id="4198795">j</span><span class="op" id="4198796">+</span><span class="ident" id="4198797">todo</span>&nbsp;<span class="op" id="4198802">&gt;</span>&nbsp;<span class="builtinfunc" id="4198804">len</span><span class="op" id="4198807">(</span><span class="ident" id="4198808">result</span><span class="op" id="4198814">)</span>&nbsp;<span class="op" id="4198816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198821">todo</span>&nbsp;<span class="op" id="4198826">=</span>&nbsp;<span class="builtinfunc" id="4198828">len</span><span class="op" id="4198831">(</span><span class="ident" id="4198832">result</span><span class="op" id="4198838">)</span>&nbsp;<span class="op" id="4198840">-</span>&nbsp;<span class="ident" id="4198842">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4198846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4198850">copy</span><span class="op" id="4198854">(</span><span class="ident" id="4198855">result</span><span class="op" id="4198861">[</span><span class="ident" id="4198862">j</span><span class="op" id="4198863">:</span><span class="ident" id="4198864">j</span><span class="op" id="4198865">+</span><span class="ident" id="4198866">todo</span><span class="op" id="4198870">]</span><span class="op" id="4198871">,</span>&nbsp;<span class="ident" id="4198873">b</span><span class="op" id="4198874">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198878">j</span>&nbsp;<span class="op" id="4198880">+=</span>&nbsp;<span class="ident" id="4198883">todo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198891">h</span><span class="op" id="4198892">.</span><span class="ident" id="4198893">Reset</span><span class="op" id="4198898">(</span><span class="op" id="4198899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198903">h</span><span class="op" id="4198904">.</span><span class="ident" id="4198905">Write</span><span class="op" id="4198910">(</span><span class="ident" id="4198911">a</span><span class="op" id="4198912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198916">a</span>&nbsp;<span class="op" id="4198918">=</span>&nbsp;<span class="ident" id="4198920">h</span><span class="op" id="4198921">.</span><span class="ident" id="4198922">Sum</span><span class="op" id="4198925">(</span><span class="ident" id="4198926">nil</span><span class="op" id="4198929">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4198932">}</span><br>
<span class="lineno"></span><span class="op" id="4198934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4198937">//&nbsp;prf10&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4199028">func</span>&nbsp;<span class="ident" id="4199033">prf10</span><span class="op" id="4199038">(</span><span class="ident" id="4199039">result</span><span class="op" id="4199045">,</span>&nbsp;<span class="ident" id="4199047">secret</span><span class="op" id="4199053">,</span>&nbsp;<span class="ident" id="4199055">label</span><span class="op" id="4199060">,</span>&nbsp;<span class="ident" id="4199062">seed</span>&nbsp;<span class="op" id="4199067">[</span><span class="op" id="4199068">]</span><span class="builtintype" id="4199069">byte</span><span class="op" id="4199073">)</span>&nbsp;<span class="op" id="4199075">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199078">hashSHA1</span>&nbsp;<span class="op" id="4199087">:=</span>&nbsp;<span class="ident" id="4199090">sha1</span><span class="op" id="4199094">.</span><span class="ident" id="4199095">New</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199100">hashMD5</span>&nbsp;<span class="op" id="4199108">:=</span>&nbsp;<span class="ident" id="4199111">md5</span><span class="op" id="4199114">.</span><span class="ident" id="4199115">New</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199121">labelAndSeed</span>&nbsp;<span class="op" id="4199134">:=</span>&nbsp;<span class="builtinfunc" id="4199137">make</span><span class="op" id="4199141">(</span><span class="op" id="4199142">[</span><span class="op" id="4199143">]</span><span class="builtintype" id="4199144">byte</span><span class="op" id="4199148">,</span>&nbsp;<span class="builtinfunc" id="4199150">len</span><span class="op" id="4199153">(</span><span class="ident" id="4199154">label</span><span class="op" id="4199159">)</span><span class="op" id="4199160">+</span><span class="builtinfunc" id="4199161">len</span><span class="op" id="4199164">(</span><span class="ident" id="4199165">seed</span><span class="op" id="4199169">)</span><span class="op" id="4199170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4199173">copy</span><span class="op" id="4199177">(</span><span class="ident" id="4199178">labelAndSeed</span><span class="op" id="4199190">,</span>&nbsp;<span class="ident" id="4199192">label</span><span class="op" id="4199197">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4199200">copy</span><span class="op" id="4199204">(</span><span class="ident" id="4199205">labelAndSeed</span><span class="op" id="4199217">[</span><span class="builtinfunc" id="4199218">len</span><span class="op" id="4199221">(</span><span class="ident" id="4199222">label</span><span class="op" id="4199227">)</span><span class="op" id="4199228">:</span><span class="op" id="4199229">]</span><span class="op" id="4199230">,</span>&nbsp;<span class="ident" id="4199232">seed</span><span class="op" id="4199236">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199240">s1</span><span class="op" id="4199242">,</span>&nbsp;<span class="ident" id="4199244">s2</span>&nbsp;<span class="op" id="4199247">:=</span>&nbsp;<span class="ident" id="4199250">splitPreMasterSecret</span><span class="op" id="4199270">(</span><span class="ident" id="4199271">secret</span><span class="op" id="4199277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199280">pHash</span><span class="op" id="4199285">(</span><span class="ident" id="4199286">result</span><span class="op" id="4199292">,</span>&nbsp;<span class="ident" id="4199294">s1</span><span class="op" id="4199296">,</span>&nbsp;<span class="ident" id="4199298">labelAndSeed</span><span class="op" id="4199310">,</span>&nbsp;<span class="ident" id="4199312">hashMD5</span><span class="op" id="4199319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199322">result2</span>&nbsp;<span class="op" id="4199330">:=</span>&nbsp;<span class="builtinfunc" id="4199333">make</span><span class="op" id="4199337">(</span><span class="op" id="4199338">[</span><span class="op" id="4199339">]</span><span class="builtintype" id="4199340">byte</span><span class="op" id="4199344">,</span>&nbsp;<span class="builtinfunc" id="4199346">len</span><span class="op" id="4199349">(</span><span class="ident" id="4199350">result</span><span class="op" id="4199356">)</span><span class="op" id="4199357">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199360">pHash</span><span class="op" id="4199365">(</span><span class="ident" id="4199366">result2</span><span class="op" id="4199373">,</span>&nbsp;<span class="ident" id="4199375">s2</span><span class="op" id="4199377">,</span>&nbsp;<span class="ident" id="4199379">labelAndSeed</span><span class="op" id="4199391">,</span>&nbsp;<span class="ident" id="4199393">hashSHA1</span><span class="op" id="4199401">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4199405">for</span>&nbsp;<span class="ident" id="4199409">i</span><span class="op" id="4199410">,</span>&nbsp;<span class="ident" id="4199412">b</span>&nbsp;<span class="op" id="4199414">:=</span>&nbsp;<span class="keyword" id="4199417">range</span>&nbsp;<span class="ident" id="4199423">result2</span>&nbsp;<span class="op" id="4199431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199435">result</span><span class="op" id="4199441">[</span><span class="ident" id="4199442">i</span><span class="op" id="4199443">]</span>&nbsp;<span class="op" id="4199445">^=</span>&nbsp;<span class="ident" id="4199448">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4199451">}</span><br>
<span class="lineno">65</span><span class="op" id="4199453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4199456">//&nbsp;prf12&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.2&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4199547">func</span>&nbsp;<span class="ident" id="4199552">prf12</span><span class="op" id="4199557">(</span><span class="ident" id="4199558">result</span><span class="op" id="4199564">,</span>&nbsp;<span class="ident" id="4199566">secret</span><span class="op" id="4199572">,</span>&nbsp;<span class="ident" id="4199574">label</span><span class="op" id="4199579">,</span>&nbsp;<span class="ident" id="4199581">seed</span>&nbsp;<span class="op" id="4199586">[</span><span class="op" id="4199587">]</span><span class="builtintype" id="4199588">byte</span><span class="op" id="4199592">)</span>&nbsp;<span class="op" id="4199594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199597">labelAndSeed</span>&nbsp;<span class="op" id="4199610">:=</span>&nbsp;<span class="builtinfunc" id="4199613">make</span><span class="op" id="4199617">(</span><span class="op" id="4199618">[</span><span class="op" id="4199619">]</span><span class="builtintype" id="4199620">byte</span><span class="op" id="4199624">,</span>&nbsp;<span class="builtinfunc" id="4199626">len</span><span class="op" id="4199629">(</span><span class="ident" id="4199630">label</span><span class="op" id="4199635">)</span><span class="op" id="4199636">+</span><span class="builtinfunc" id="4199637">len</span><span class="op" id="4199640">(</span><span class="ident" id="4199641">seed</span><span class="op" id="4199645">)</span><span class="op" id="4199646">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4199649">copy</span><span class="op" id="4199653">(</span><span class="ident" id="4199654">labelAndSeed</span><span class="op" id="4199666">,</span>&nbsp;<span class="ident" id="4199668">label</span><span class="op" id="4199673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4199676">copy</span><span class="op" id="4199680">(</span><span class="ident" id="4199681">labelAndSeed</span><span class="op" id="4199693">[</span><span class="builtinfunc" id="4199694">len</span><span class="op" id="4199697">(</span><span class="ident" id="4199698">label</span><span class="op" id="4199703">)</span><span class="op" id="4199704">:</span><span class="op" id="4199705">]</span><span class="op" id="4199706">,</span>&nbsp;<span class="ident" id="4199708">seed</span><span class="op" id="4199712">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199716">pHash</span><span class="op" id="4199721">(</span><span class="ident" id="4199722">result</span><span class="op" id="4199728">,</span>&nbsp;<span class="ident" id="4199730">secret</span><span class="op" id="4199736">,</span>&nbsp;<span class="ident" id="4199738">labelAndSeed</span><span class="op" id="4199750">,</span>&nbsp;<span class="ident" id="4199752">sha256</span><span class="op" id="4199758">.</span><span class="ident" id="4199759">New</span><span class="op" id="4199762">)</span><br>
<span class="lineno"></span><span class="op" id="4199764">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4199767">//&nbsp;prf30&nbsp;implements&nbsp;the&nbsp;SSL&nbsp;3.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4199837">//&nbsp;www.mozilla.org/projects/security/pki/nss/ssl/draft302.txt&nbsp;section&nbsp;6.</span><br>
<span class="lineno"></span><span class="keyword" id="4199910">func</span>&nbsp;<span class="ident" id="4199915">prf30</span><span class="op" id="4199920">(</span><span class="ident" id="4199921">result</span><span class="op" id="4199927">,</span>&nbsp;<span class="ident" id="4199929">secret</span><span class="op" id="4199935">,</span>&nbsp;<span class="ident" id="4199937">label</span><span class="op" id="4199942">,</span>&nbsp;<span class="ident" id="4199944">seed</span>&nbsp;<span class="op" id="4199949">[</span><span class="op" id="4199950">]</span><span class="builtintype" id="4199951">byte</span><span class="op" id="4199955">)</span>&nbsp;<span class="op" id="4199957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199960">hashSHA1</span>&nbsp;<span class="op" id="4199969">:=</span>&nbsp;<span class="ident" id="4199972">sha1</span><span class="op" id="4199976">.</span><span class="ident" id="4199977">New</span><span class="op" id="4199980">(</span><span class="op" id="4199981">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199984">hashMD5</span>&nbsp;<span class="op" id="4199992">:=</span>&nbsp;<span class="ident" id="4199995">md5</span><span class="op" id="4199998">.</span><span class="ident" id="4199999">New</span><span class="op" id="4200002">(</span><span class="op" id="4200003">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200007">done</span>&nbsp;<span class="op" id="4200012">:=</span>&nbsp;<span class="num" id="4200015">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200018">i</span>&nbsp;<span class="op" id="4200020">:=</span>&nbsp;<span class="num" id="4200023">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4200026">//&nbsp;RFC5246&nbsp;section&nbsp;6.3&nbsp;says&nbsp;that&nbsp;the&nbsp;largest&nbsp;PRF&nbsp;output&nbsp;needed&nbsp;is&nbsp;128</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4200097">//&nbsp;bytes.&nbsp;Since&nbsp;no&nbsp;more&nbsp;ciphersuites&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;SSLv3,&nbsp;this&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4200169">//&nbsp;remain&nbsp;true.&nbsp;Each&nbsp;iteration&nbsp;gives&nbsp;us&nbsp;16&nbsp;bytes&nbsp;so&nbsp;10&nbsp;iterations&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4200241">//&nbsp;be&nbsp;sufficient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200260">var</span>&nbsp;<span class="ident" id="4200264">b</span>&nbsp;<span class="op" id="4200266">[</span><span class="num" id="4200267">11</span><span class="op" id="4200269">]</span><span class="builtintype" id="4200270">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200276">for</span>&nbsp;<span class="ident" id="4200280">done</span>&nbsp;<span class="op" id="4200285">&lt;</span>&nbsp;<span class="builtinfunc" id="4200287">len</span><span class="op" id="4200290">(</span><span class="ident" id="4200291">result</span><span class="op" id="4200297">)</span>&nbsp;<span class="op" id="4200299">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200303">for</span>&nbsp;<span class="ident" id="4200307">j</span>&nbsp;<span class="op" id="4200309">:=</span>&nbsp;<span class="num" id="4200312">0</span><span class="op" id="4200313">;</span>&nbsp;<span class="ident" id="4200315">j</span>&nbsp;<span class="op" id="4200317">&lt;=</span>&nbsp;<span class="ident" id="4200320">i</span><span class="op" id="4200321">;</span>&nbsp;<span class="ident" id="4200323">j</span><span class="op" id="4200324">++</span>&nbsp;<span class="op" id="4200327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200332">b</span><span class="op" id="4200333">[</span><span class="ident" id="4200334">j</span><span class="op" id="4200335">]</span>&nbsp;<span class="op" id="4200337">=</span>&nbsp;<span class="string" id="4200339">&#39;A&#39;</span>&nbsp;<span class="op" id="4200343">+</span>&nbsp;<span class="builtintype" id="4200345">byte</span><span class="op" id="4200349">(</span><span class="ident" id="4200350">i</span><span class="op" id="4200351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200360">hashSHA1</span><span class="op" id="4200368">.</span><span class="ident" id="4200369">Reset</span><span class="op" id="4200374">(</span><span class="op" id="4200375">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200379">hashSHA1</span><span class="op" id="4200387">.</span><span class="ident" id="4200388">Write</span><span class="op" id="4200393">(</span><span class="ident" id="4200394">b</span><span class="op" id="4200395">[</span><span class="op" id="4200396">:</span><span class="ident" id="4200397">i</span><span class="op" id="4200398">+</span><span class="num" id="4200399">1</span><span class="op" id="4200400">]</span><span class="op" id="4200401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200405">hashSHA1</span><span class="op" id="4200413">.</span><span class="ident" id="4200414">Write</span><span class="op" id="4200419">(</span><span class="ident" id="4200420">secret</span><span class="op" id="4200426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200430">hashSHA1</span><span class="op" id="4200438">.</span><span class="ident" id="4200439">Write</span><span class="op" id="4200444">(</span><span class="ident" id="4200445">seed</span><span class="op" id="4200449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200453">digest</span>&nbsp;<span class="op" id="4200460">:=</span>&nbsp;<span class="ident" id="4200463">hashSHA1</span><span class="op" id="4200471">.</span><span class="ident" id="4200472">Sum</span><span class="op" id="4200475">(</span><span class="ident" id="4200476">nil</span><span class="op" id="4200479">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200484">hashMD5</span><span class="op" id="4200491">.</span><span class="ident" id="4200492">Reset</span><span class="op" id="4200497">(</span><span class="op" id="4200498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200502">hashMD5</span><span class="op" id="4200509">.</span><span class="ident" id="4200510">Write</span><span class="op" id="4200515">(</span><span class="ident" id="4200516">secret</span><span class="op" id="4200522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200526">hashMD5</span><span class="op" id="4200533">.</span><span class="ident" id="4200534">Write</span><span class="op" id="4200539">(</span><span class="ident" id="4200540">digest</span><span class="op" id="4200546">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200551">done</span>&nbsp;<span class="op" id="4200556">+=</span>&nbsp;<span class="builtinfunc" id="4200559">copy</span><span class="op" id="4200563">(</span><span class="ident" id="4200564">result</span><span class="op" id="4200570">[</span><span class="ident" id="4200571">done</span><span class="op" id="4200575">:</span><span class="op" id="4200576">]</span><span class="op" id="4200577">,</span>&nbsp;<span class="ident" id="4200579">hashMD5</span><span class="op" id="4200586">.</span><span class="ident" id="4200587">Sum</span><span class="op" id="4200590">(</span><span class="ident" id="4200591">nil</span><span class="op" id="4200594">)</span><span class="op" id="4200595">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200599">i</span><span class="op" id="4200600">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200604">}</span><br>
<span class="lineno"></span><span class="op" id="4200606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4200609">const</span>&nbsp;<span class="op" id="4200615">(</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200618">tlsRandomLength</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4200639">=</span>&nbsp;<span class="num" id="4200641">32</span>&nbsp;<span class="comment" id="4200644">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;random&nbsp;nonce&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200685">masterSecretLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4200706">=</span>&nbsp;<span class="num" id="4200708">48</span>&nbsp;<span class="comment" id="4200711">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;master&nbsp;secret&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200753">finishedVerifyLength</span>&nbsp;<span class="op" id="4200774">=</span>&nbsp;<span class="num" id="4200776">12</span>&nbsp;<span class="comment" id="4200779">//&nbsp;Length&nbsp;of&nbsp;verify_data&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="op" id="4200827">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="4200830">var</span>&nbsp;<span class="ident" id="4200834">masterSecretLabel</span>&nbsp;<span class="op" id="4200852">=</span>&nbsp;<span class="op" id="4200854">[</span><span class="op" id="4200855">]</span><span class="builtintype" id="4200856">byte</span><span class="op" id="4200860">(</span><span class="string" id="4200861">&#34;master&nbsp;secret&#34;</span><span class="op" id="4200876">)</span><br>
<span class="lineno"></span><span class="keyword" id="4200878">var</span>&nbsp;<span class="ident" id="4200882">keyExpansionLabel</span>&nbsp;<span class="op" id="4200900">=</span>&nbsp;<span class="op" id="4200902">[</span><span class="op" id="4200903">]</span><span class="builtintype" id="4200904">byte</span><span class="op" id="4200908">(</span><span class="string" id="4200909">&#34;key&nbsp;expansion&#34;</span><span class="op" id="4200924">)</span><br>
<span class="lineno"></span><span class="keyword" id="4200926">var</span>&nbsp;<span class="ident" id="4200930">clientFinishedLabel</span>&nbsp;<span class="op" id="4200950">=</span>&nbsp;<span class="op" id="4200952">[</span><span class="op" id="4200953">]</span><span class="builtintype" id="4200954">byte</span><span class="op" id="4200958">(</span><span class="string" id="4200959">&#34;client&nbsp;finished&#34;</span><span class="op" id="4200976">)</span><br>
<span class="lineno"></span><span class="keyword" id="4200978">var</span>&nbsp;<span class="ident" id="4200982">serverFinishedLabel</span>&nbsp;<span class="op" id="4201002">=</span>&nbsp;<span class="op" id="4201004">[</span><span class="op" id="4201005">]</span><span class="builtintype" id="4201006">byte</span><span class="op" id="4201010">(</span><span class="string" id="4201011">&#34;server&nbsp;finished&#34;</span><span class="op" id="4201028">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="4201031">func</span>&nbsp;<span class="ident" id="4201036">prfForVersion</span><span class="op" id="4201049">(</span><span class="ident" id="4201050">version</span>&nbsp;<span class="builtintype" id="4201058">uint16</span><span class="op" id="4201064">)</span>&nbsp;<span class="keyword" id="4201066">func</span><span class="op" id="4201070">(</span><span class="ident" id="4201071">result</span><span class="op" id="4201077">,</span>&nbsp;<span class="ident" id="4201079">secret</span><span class="op" id="4201085">,</span>&nbsp;<span class="ident" id="4201087">label</span><span class="op" id="4201092">,</span>&nbsp;<span class="ident" id="4201094">seed</span>&nbsp;<span class="op" id="4201099">[</span><span class="op" id="4201100">]</span><span class="builtintype" id="4201101">byte</span><span class="op" id="4201105">)</span>&nbsp;<span class="op" id="4201107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201110">switch</span>&nbsp;<span class="ident" id="4201117">version</span>&nbsp;<span class="op" id="4201125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201128">case</span>&nbsp;<span class="ident" id="4201133">VersionSSL30</span><span class="op" id="4201145">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201149">return</span>&nbsp;<span class="ident" id="4201156">prf30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201163">case</span>&nbsp;<span class="ident" id="4201168">VersionTLS10</span><span class="op" id="4201180">,</span>&nbsp;<span class="ident" id="4201182">VersionTLS11</span><span class="op" id="4201194">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201198">return</span>&nbsp;<span class="ident" id="4201205">prf10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201212">case</span>&nbsp;<span class="ident" id="4201217">VersionTLS12</span><span class="op" id="4201229">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201233">return</span>&nbsp;<span class="ident" id="4201240">prf12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201247">default</span><span class="op" id="4201254">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4201258">panic</span><span class="op" id="4201263">(</span><span class="string" id="4201264">&#34;unknown&nbsp;version&#34;</span><span class="op" id="4201281">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201284">}</span><br>
<span class="lineno"></span><span class="op" id="4201286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4201289">//&nbsp;masterFromPreMasterSecret&nbsp;generates&nbsp;the&nbsp;master&nbsp;secret&nbsp;from&nbsp;the&nbsp;pre-master</span><br>
<span class="lineno"></span><span class="comment" id="4201366">//&nbsp;secret.&nbsp;See&nbsp;http://tools.ietf.org/html/rfc5246#section-8.1</span><br>
<span class="lineno">135</span><span class="keyword" id="4201428">func</span>&nbsp;<span class="ident" id="4201433">masterFromPreMasterSecret</span><span class="op" id="4201458">(</span><span class="ident" id="4201459">version</span>&nbsp;<span class="builtintype" id="4201467">uint16</span><span class="op" id="4201473">,</span>&nbsp;<span class="ident" id="4201475">preMasterSecret</span><span class="op" id="4201490">,</span>&nbsp;<span class="ident" id="4201492">clientRandom</span><span class="op" id="4201504">,</span>&nbsp;<span class="ident" id="4201506">serverRandom</span>&nbsp;<span class="op" id="4201519">[</span><span class="op" id="4201520">]</span><span class="builtintype" id="4201521">byte</span><span class="op" id="4201525">)</span>&nbsp;<span class="op" id="4201527">[</span><span class="op" id="4201528">]</span><span class="builtintype" id="4201529">byte</span>&nbsp;<span class="op" id="4201534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201537">var</span>&nbsp;<span class="ident" id="4201541">seed</span>&nbsp;<span class="op" id="4201546">[</span><span class="ident" id="4201547">tlsRandomLength</span>&nbsp;<span class="op" id="4201563">*</span>&nbsp;<span class="num" id="4201565">2</span><span class="op" id="4201566">]</span><span class="builtintype" id="4201567">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4201573">copy</span><span class="op" id="4201577">(</span><span class="ident" id="4201578">seed</span><span class="op" id="4201582">[</span><span class="num" id="4201583">0</span><span class="op" id="4201584">:</span><span class="builtinfunc" id="4201585">len</span><span class="op" id="4201588">(</span><span class="ident" id="4201589">clientRandom</span><span class="op" id="4201601">)</span><span class="op" id="4201602">]</span><span class="op" id="4201603">,</span>&nbsp;<span class="ident" id="4201605">clientRandom</span><span class="op" id="4201617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4201620">copy</span><span class="op" id="4201624">(</span><span class="ident" id="4201625">seed</span><span class="op" id="4201629">[</span><span class="builtinfunc" id="4201630">len</span><span class="op" id="4201633">(</span><span class="ident" id="4201634">clientRandom</span><span class="op" id="4201646">)</span><span class="op" id="4201647">:</span><span class="op" id="4201648">]</span><span class="op" id="4201649">,</span>&nbsp;<span class="ident" id="4201651">serverRandom</span><span class="op" id="4201663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201666">masterSecret</span>&nbsp;<span class="op" id="4201679">:=</span>&nbsp;<span class="builtinfunc" id="4201682">make</span><span class="op" id="4201686">(</span><span class="op" id="4201687">[</span><span class="op" id="4201688">]</span><span class="builtintype" id="4201689">byte</span><span class="op" id="4201693">,</span>&nbsp;<span class="ident" id="4201695">masterSecretLength</span><span class="op" id="4201713">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201716">prfForVersion</span><span class="op" id="4201729">(</span><span class="ident" id="4201730">version</span><span class="op" id="4201737">)</span><span class="op" id="4201738">(</span><span class="ident" id="4201739">masterSecret</span><span class="op" id="4201751">,</span>&nbsp;<span class="ident" id="4201753">preMasterSecret</span><span class="op" id="4201768">,</span>&nbsp;<span class="ident" id="4201770">masterSecretLabel</span><span class="op" id="4201787">,</span>&nbsp;<span class="ident" id="4201789">seed</span><span class="op" id="4201793">[</span><span class="num" id="4201794">0</span><span class="op" id="4201795">:</span><span class="op" id="4201796">]</span><span class="op" id="4201797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201800">return</span>&nbsp;<span class="ident" id="4201807">masterSecret</span><br>
<span class="lineno"></span><span class="op" id="4201820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4201823">//&nbsp;keysFromMasterSecret&nbsp;generates&nbsp;the&nbsp;connection&nbsp;keys&nbsp;from&nbsp;the&nbsp;master</span><br>
<span class="lineno">145</span><span class="comment" id="4201893">//&nbsp;secret,&nbsp;given&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MAC&nbsp;key,&nbsp;cipher&nbsp;key&nbsp;and&nbsp;IV,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4201971">//&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;6.3.</span><br>
<span class="lineno"></span><span class="keyword" id="4201997">func</span>&nbsp;<span class="ident" id="4202002">keysFromMasterSecret</span><span class="op" id="4202022">(</span><span class="ident" id="4202023">version</span>&nbsp;<span class="builtintype" id="4202031">uint16</span><span class="op" id="4202037">,</span>&nbsp;<span class="ident" id="4202039">masterSecret</span><span class="op" id="4202051">,</span>&nbsp;<span class="ident" id="4202053">clientRandom</span><span class="op" id="4202065">,</span>&nbsp;<span class="ident" id="4202067">serverRandom</span>&nbsp;<span class="op" id="4202080">[</span><span class="op" id="4202081">]</span><span class="builtintype" id="4202082">byte</span><span class="op" id="4202086">,</span>&nbsp;<span class="ident" id="4202088">macLen</span><span class="op" id="4202094">,</span>&nbsp;<span class="ident" id="4202096">keyLen</span><span class="op" id="4202102">,</span>&nbsp;<span class="ident" id="4202104">ivLen</span>&nbsp;<span class="builtintype" id="4202110">int</span><span class="op" id="4202113">)</span>&nbsp;<span class="op" id="4202115">(</span><span class="ident" id="4202116">clientMAC</span><span class="op" id="4202125">,</span>&nbsp;<span class="ident" id="4202127">serverMAC</span><span class="op" id="4202136">,</span>&nbsp;<span class="ident" id="4202138">clientKey</span><span class="op" id="4202147">,</span>&nbsp;<span class="ident" id="4202149">serverKey</span><span class="op" id="4202158">,</span>&nbsp;<span class="ident" id="4202160">clientIV</span><span class="op" id="4202168">,</span>&nbsp;<span class="ident" id="4202170">serverIV</span>&nbsp;<span class="op" id="4202179">[</span><span class="op" id="4202180">]</span><span class="builtintype" id="4202181">byte</span><span class="op" id="4202185">)</span>&nbsp;<span class="op" id="4202187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202190">var</span>&nbsp;<span class="ident" id="4202194">seed</span>&nbsp;<span class="op" id="4202199">[</span><span class="ident" id="4202200">tlsRandomLength</span>&nbsp;<span class="op" id="4202216">*</span>&nbsp;<span class="num" id="4202218">2</span><span class="op" id="4202219">]</span><span class="builtintype" id="4202220">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4202226">copy</span><span class="op" id="4202230">(</span><span class="ident" id="4202231">seed</span><span class="op" id="4202235">[</span><span class="num" id="4202236">0</span><span class="op" id="4202237">:</span><span class="builtinfunc" id="4202238">len</span><span class="op" id="4202241">(</span><span class="ident" id="4202242">clientRandom</span><span class="op" id="4202254">)</span><span class="op" id="4202255">]</span><span class="op" id="4202256">,</span>&nbsp;<span class="ident" id="4202258">serverRandom</span><span class="op" id="4202270">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4202273">copy</span><span class="op" id="4202277">(</span><span class="ident" id="4202278">seed</span><span class="op" id="4202282">[</span><span class="builtinfunc" id="4202283">len</span><span class="op" id="4202286">(</span><span class="ident" id="4202287">serverRandom</span><span class="op" id="4202299">)</span><span class="op" id="4202300">:</span><span class="op" id="4202301">]</span><span class="op" id="4202302">,</span>&nbsp;<span class="ident" id="4202304">clientRandom</span><span class="op" id="4202316">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202320">n</span>&nbsp;<span class="op" id="4202322">:=</span>&nbsp;<span class="num" id="4202325">2</span><span class="op" id="4202326">*</span><span class="ident" id="4202327">macLen</span>&nbsp;<span class="op" id="4202334">+</span>&nbsp;<span class="num" id="4202336">2</span><span class="op" id="4202337">*</span><span class="ident" id="4202338">keyLen</span>&nbsp;<span class="op" id="4202345">+</span>&nbsp;<span class="num" id="4202347">2</span><span class="op" id="4202348">*</span><span class="ident" id="4202349">ivLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202356">keyMaterial</span>&nbsp;<span class="op" id="4202368">:=</span>&nbsp;<span class="builtinfunc" id="4202371">make</span><span class="op" id="4202375">(</span><span class="op" id="4202376">[</span><span class="op" id="4202377">]</span><span class="builtintype" id="4202378">byte</span><span class="op" id="4202382">,</span>&nbsp;<span class="ident" id="4202384">n</span><span class="op" id="4202385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202388">prfForVersion</span><span class="op" id="4202401">(</span><span class="ident" id="4202402">version</span><span class="op" id="4202409">)</span><span class="op" id="4202410">(</span><span class="ident" id="4202411">keyMaterial</span><span class="op" id="4202422">,</span>&nbsp;<span class="ident" id="4202424">masterSecret</span><span class="op" id="4202436">,</span>&nbsp;<span class="ident" id="4202438">keyExpansionLabel</span><span class="op" id="4202455">,</span>&nbsp;<span class="ident" id="4202457">seed</span><span class="op" id="4202461">[</span><span class="num" id="4202462">0</span><span class="op" id="4202463">:</span><span class="op" id="4202464">]</span><span class="op" id="4202465">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202468">clientMAC</span>&nbsp;<span class="op" id="4202478">=</span>&nbsp;<span class="ident" id="4202480">keyMaterial</span><span class="op" id="4202491">[</span><span class="op" id="4202492">:</span><span class="ident" id="4202493">macLen</span><span class="op" id="4202499">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202502">keyMaterial</span>&nbsp;<span class="op" id="4202514">=</span>&nbsp;<span class="ident" id="4202516">keyMaterial</span><span class="op" id="4202527">[</span><span class="ident" id="4202528">macLen</span><span class="op" id="4202534">:</span><span class="op" id="4202535">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202538">serverMAC</span>&nbsp;<span class="op" id="4202548">=</span>&nbsp;<span class="ident" id="4202550">keyMaterial</span><span class="op" id="4202561">[</span><span class="op" id="4202562">:</span><span class="ident" id="4202563">macLen</span><span class="op" id="4202569">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202572">keyMaterial</span>&nbsp;<span class="op" id="4202584">=</span>&nbsp;<span class="ident" id="4202586">keyMaterial</span><span class="op" id="4202597">[</span><span class="ident" id="4202598">macLen</span><span class="op" id="4202604">:</span><span class="op" id="4202605">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202608">clientKey</span>&nbsp;<span class="op" id="4202618">=</span>&nbsp;<span class="ident" id="4202620">keyMaterial</span><span class="op" id="4202631">[</span><span class="op" id="4202632">:</span><span class="ident" id="4202633">keyLen</span><span class="op" id="4202639">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202642">keyMaterial</span>&nbsp;<span class="op" id="4202654">=</span>&nbsp;<span class="ident" id="4202656">keyMaterial</span><span class="op" id="4202667">[</span><span class="ident" id="4202668">keyLen</span><span class="op" id="4202674">:</span><span class="op" id="4202675">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202678">serverKey</span>&nbsp;<span class="op" id="4202688">=</span>&nbsp;<span class="ident" id="4202690">keyMaterial</span><span class="op" id="4202701">[</span><span class="op" id="4202702">:</span><span class="ident" id="4202703">keyLen</span><span class="op" id="4202709">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202712">keyMaterial</span>&nbsp;<span class="op" id="4202724">=</span>&nbsp;<span class="ident" id="4202726">keyMaterial</span><span class="op" id="4202737">[</span><span class="ident" id="4202738">keyLen</span><span class="op" id="4202744">:</span><span class="op" id="4202745">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202748">clientIV</span>&nbsp;<span class="op" id="4202757">=</span>&nbsp;<span class="ident" id="4202759">keyMaterial</span><span class="op" id="4202770">[</span><span class="op" id="4202771">:</span><span class="ident" id="4202772">ivLen</span><span class="op" id="4202777">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202780">keyMaterial</span>&nbsp;<span class="op" id="4202792">=</span>&nbsp;<span class="ident" id="4202794">keyMaterial</span><span class="op" id="4202805">[</span><span class="ident" id="4202806">ivLen</span><span class="op" id="4202811">:</span><span class="op" id="4202812">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202815">serverIV</span>&nbsp;<span class="op" id="4202824">=</span>&nbsp;<span class="ident" id="4202826">keyMaterial</span><span class="op" id="4202837">[</span><span class="op" id="4202838">:</span><span class="ident" id="4202839">ivLen</span><span class="op" id="4202844">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202847">return</span><br>
<span class="lineno"></span><span class="op" id="4202854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4202857">func</span>&nbsp;<span class="ident" id="4202862">newFinishedHash</span><span class="op" id="4202877">(</span><span class="ident" id="4202878">version</span>&nbsp;<span class="builtintype" id="4202886">uint16</span><span class="op" id="4202892">)</span>&nbsp;<span class="ident" id="4202894">finishedHash</span>&nbsp;<span class="op" id="4202907">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202910">if</span>&nbsp;<span class="ident" id="4202913">version</span>&nbsp;<span class="op" id="4202921">&gt;=</span>&nbsp;<span class="ident" id="4202924">VersionTLS12</span>&nbsp;<span class="op" id="4202937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202941">return</span>&nbsp;<span class="ident" id="4202948">finishedHash</span><span class="op" id="4202960">{</span><span class="ident" id="4202961">sha256</span><span class="op" id="4202967">.</span><span class="ident" id="4202968">New</span><span class="op" id="4202971">(</span><span class="op" id="4202972">)</span><span class="op" id="4202973">,</span>&nbsp;<span class="ident" id="4202975">sha256</span><span class="op" id="4202981">.</span><span class="ident" id="4202982">New</span><span class="op" id="4202985">(</span><span class="op" id="4202986">)</span><span class="op" id="4202987">,</span>&nbsp;<span class="ident" id="4202989">nil</span><span class="op" id="4202992">,</span>&nbsp;<span class="ident" id="4202994">nil</span><span class="op" id="4202997">,</span>&nbsp;<span class="ident" id="4202999">version</span><span class="op" id="4203006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4203009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203012">return</span>&nbsp;<span class="ident" id="4203019">finishedHash</span><span class="op" id="4203031">{</span><span class="ident" id="4203032">sha1</span><span class="op" id="4203036">.</span><span class="ident" id="4203037">New</span><span class="op" id="4203040">(</span><span class="op" id="4203041">)</span><span class="op" id="4203042">,</span>&nbsp;<span class="ident" id="4203044">sha1</span><span class="op" id="4203048">.</span><span class="ident" id="4203049">New</span><span class="op" id="4203052">(</span><span class="op" id="4203053">)</span><span class="op" id="4203054">,</span>&nbsp;<span class="ident" id="4203056">md5</span><span class="op" id="4203059">.</span><span class="ident" id="4203060">New</span><span class="op" id="4203063">(</span><span class="op" id="4203064">)</span><span class="op" id="4203065">,</span>&nbsp;<span class="ident" id="4203067">md5</span><span class="op" id="4203070">.</span><span class="ident" id="4203071">New</span><span class="op" id="4203074">(</span><span class="op" id="4203075">)</span><span class="op" id="4203076">,</span>&nbsp;<span class="ident" id="4203078">version</span><span class="op" id="4203085">}</span><br>
<span class="lineno"></span><span class="op" id="4203087">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4203090">//&nbsp;A&nbsp;finishedHash&nbsp;calculates&nbsp;the&nbsp;hash&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake&nbsp;messages&nbsp;suitable</span><br>
<span class="lineno"></span><span class="comment" id="4203168">//&nbsp;for&nbsp;including&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4203208">type</span>&nbsp;<span class="ident" id="4203213">finishedHash</span>&nbsp;<span class="keyword" id="4203226">struct</span>&nbsp;<span class="op" id="4203233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203236">client</span>&nbsp;<span class="ident" id="4203243">hash</span><span class="op" id="4203247">.</span><span class="ident" id="4203248">Hash</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203254">server</span>&nbsp;<span class="ident" id="4203261">hash</span><span class="op" id="4203265">.</span><span class="ident" id="4203266">Hash</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4203273">//&nbsp;Prior&nbsp;to&nbsp;TLS&nbsp;1.2,&nbsp;an&nbsp;additional&nbsp;MD5&nbsp;hash&nbsp;is&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203331">clientMD5</span>&nbsp;<span class="ident" id="4203341">hash</span><span class="op" id="4203345">.</span><span class="ident" id="4203346">Hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203352">serverMD5</span>&nbsp;<span class="ident" id="4203362">hash</span><span class="op" id="4203366">.</span><span class="ident" id="4203367">Hash</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203374">version</span>&nbsp;<span class="builtintype" id="4203382">uint16</span><br>
<span class="lineno"></span><span class="op" id="4203389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4203392">func</span>&nbsp;<span class="op" id="4203397">(</span><span class="ident" id="4203398">h</span>&nbsp;<span class="ident" id="4203400">finishedHash</span><span class="op" id="4203412">)</span>&nbsp;<span class="ident" id="4203414">Write</span><span class="op" id="4203419">(</span><span class="ident" id="4203420">msg</span>&nbsp;<span class="op" id="4203424">[</span><span class="op" id="4203425">]</span><span class="builtintype" id="4203426">byte</span><span class="op" id="4203430">)</span>&nbsp;<span class="op" id="4203432">(</span><span class="ident" id="4203433">n</span>&nbsp;<span class="builtintype" id="4203435">int</span><span class="op" id="4203438">,</span>&nbsp;<span class="ident" id="4203440">err</span>&nbsp;<span class="builtintype" id="4203444">error</span><span class="op" id="4203449">)</span>&nbsp;<span class="op" id="4203451">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203454">h</span><span class="op" id="4203455">.</span><span class="ident" id="4203456">client</span><span class="op" id="4203462">.</span><span class="ident" id="4203463">Write</span><span class="op" id="4203468">(</span><span class="ident" id="4203469">msg</span><span class="op" id="4203472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203475">h</span><span class="op" id="4203476">.</span><span class="ident" id="4203477">server</span><span class="op" id="4203483">.</span><span class="ident" id="4203484">Write</span><span class="op" id="4203489">(</span><span class="ident" id="4203490">msg</span><span class="op" id="4203493">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203497">if</span>&nbsp;<span class="ident" id="4203500">h</span><span class="op" id="4203501">.</span><span class="ident" id="4203502">version</span>&nbsp;<span class="op" id="4203510">&lt;</span>&nbsp;<span class="ident" id="4203512">VersionTLS12</span>&nbsp;<span class="op" id="4203525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203529">h</span><span class="op" id="4203530">.</span><span class="ident" id="4203531">clientMD5</span><span class="op" id="4203540">.</span><span class="ident" id="4203541">Write</span><span class="op" id="4203546">(</span><span class="ident" id="4203547">msg</span><span class="op" id="4203550">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203554">h</span><span class="op" id="4203555">.</span><span class="ident" id="4203556">serverMD5</span><span class="op" id="4203565">.</span><span class="ident" id="4203566">Write</span><span class="op" id="4203571">(</span><span class="ident" id="4203572">msg</span><span class="op" id="4203575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4203578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203581">return</span>&nbsp;<span class="builtinfunc" id="4203588">len</span><span class="op" id="4203591">(</span><span class="ident" id="4203592">msg</span><span class="op" id="4203595">)</span><span class="op" id="4203596">,</span>&nbsp;<span class="ident" id="4203598">nil</span><br>
<span class="lineno"></span><span class="op" id="4203602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="4203605">//&nbsp;finishedSum30&nbsp;calculates&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;SSLv3</span><br>
<span class="lineno"></span><span class="comment" id="4203683">//&nbsp;Finished&nbsp;message&nbsp;given&nbsp;the&nbsp;MD5&nbsp;and&nbsp;SHA1&nbsp;hashes&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake</span><br>
<span class="lineno"></span><span class="comment" id="4203755">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="4203768">func</span>&nbsp;<span class="ident" id="4203773">finishedSum30</span><span class="op" id="4203786">(</span><span class="ident" id="4203787">md5</span><span class="op" id="4203790">,</span>&nbsp;<span class="ident" id="4203792">sha1</span>&nbsp;<span class="ident" id="4203797">hash</span><span class="op" id="4203801">.</span><span class="ident" id="4203802">Hash</span><span class="op" id="4203806">,</span>&nbsp;<span class="ident" id="4203808">masterSecret</span>&nbsp;<span class="op" id="4203821">[</span><span class="op" id="4203822">]</span><span class="builtintype" id="4203823">byte</span><span class="op" id="4203827">,</span>&nbsp;<span class="ident" id="4203829">magic</span>&nbsp;<span class="op" id="4203835">[</span><span class="num" id="4203836">4</span><span class="op" id="4203837">]</span><span class="builtintype" id="4203838">byte</span><span class="op" id="4203842">)</span>&nbsp;<span class="op" id="4203844">[</span><span class="op" id="4203845">]</span><span class="builtintype" id="4203846">byte</span>&nbsp;<span class="op" id="4203851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203854">md5</span><span class="op" id="4203857">.</span><span class="ident" id="4203858">Write</span><span class="op" id="4203863">(</span><span class="ident" id="4203864">magic</span><span class="op" id="4203869">[</span><span class="op" id="4203870">:</span><span class="op" id="4203871">]</span><span class="op" id="4203872">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203875">md5</span><span class="op" id="4203878">.</span><span class="ident" id="4203879">Write</span><span class="op" id="4203884">(</span><span class="ident" id="4203885">masterSecret</span><span class="op" id="4203897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203900">md5</span><span class="op" id="4203903">.</span><span class="ident" id="4203904">Write</span><span class="op" id="4203909">(</span><span class="ident" id="4203910">ssl30Pad1</span><span class="op" id="4203919">[</span><span class="op" id="4203920">:</span><span class="op" id="4203921">]</span><span class="op" id="4203922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203925">md5Digest</span>&nbsp;<span class="op" id="4203935">:=</span>&nbsp;<span class="ident" id="4203938">md5</span><span class="op" id="4203941">.</span><span class="ident" id="4203942">Sum</span><span class="op" id="4203945">(</span><span class="ident" id="4203946">nil</span><span class="op" id="4203949">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203953">md5</span><span class="op" id="4203956">.</span><span class="ident" id="4203957">Reset</span><span class="op" id="4203962">(</span><span class="op" id="4203963">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203966">md5</span><span class="op" id="4203969">.</span><span class="ident" id="4203970">Write</span><span class="op" id="4203975">(</span><span class="ident" id="4203976">masterSecret</span><span class="op" id="4203988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203991">md5</span><span class="op" id="4203994">.</span><span class="ident" id="4203995">Write</span><span class="op" id="4204000">(</span><span class="ident" id="4204001">ssl30Pad2</span><span class="op" id="4204010">[</span><span class="op" id="4204011">:</span><span class="op" id="4204012">]</span><span class="op" id="4204013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204016">md5</span><span class="op" id="4204019">.</span><span class="ident" id="4204020">Write</span><span class="op" id="4204025">(</span><span class="ident" id="4204026">md5Digest</span><span class="op" id="4204035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204038">md5Digest</span>&nbsp;<span class="op" id="4204048">=</span>&nbsp;<span class="ident" id="4204050">md5</span><span class="op" id="4204053">.</span><span class="ident" id="4204054">Sum</span><span class="op" id="4204057">(</span><span class="ident" id="4204058">nil</span><span class="op" id="4204061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204065">sha1</span><span class="op" id="4204069">.</span><span class="ident" id="4204070">Write</span><span class="op" id="4204075">(</span><span class="ident" id="4204076">magic</span><span class="op" id="4204081">[</span><span class="op" id="4204082">:</span><span class="op" id="4204083">]</span><span class="op" id="4204084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204087">sha1</span><span class="op" id="4204091">.</span><span class="ident" id="4204092">Write</span><span class="op" id="4204097">(</span><span class="ident" id="4204098">masterSecret</span><span class="op" id="4204110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204113">sha1</span><span class="op" id="4204117">.</span><span class="ident" id="4204118">Write</span><span class="op" id="4204123">(</span><span class="ident" id="4204124">ssl30Pad1</span><span class="op" id="4204133">[</span><span class="op" id="4204134">:</span><span class="num" id="4204135">40</span><span class="op" id="4204137">]</span><span class="op" id="4204138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204141">sha1Digest</span>&nbsp;<span class="op" id="4204152">:=</span>&nbsp;<span class="ident" id="4204155">sha1</span><span class="op" id="4204159">.</span><span class="ident" id="4204160">Sum</span><span class="op" id="4204163">(</span><span class="ident" id="4204164">nil</span><span class="op" id="4204167">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204171">sha1</span><span class="op" id="4204175">.</span><span class="ident" id="4204176">Reset</span><span class="op" id="4204181">(</span><span class="op" id="4204182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204185">sha1</span><span class="op" id="4204189">.</span><span class="ident" id="4204190">Write</span><span class="op" id="4204195">(</span><span class="ident" id="4204196">masterSecret</span><span class="op" id="4204208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204211">sha1</span><span class="op" id="4204215">.</span><span class="ident" id="4204216">Write</span><span class="op" id="4204221">(</span><span class="ident" id="4204222">ssl30Pad2</span><span class="op" id="4204231">[</span><span class="op" id="4204232">:</span><span class="num" id="4204233">40</span><span class="op" id="4204235">]</span><span class="op" id="4204236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204239">sha1</span><span class="op" id="4204243">.</span><span class="ident" id="4204244">Write</span><span class="op" id="4204249">(</span><span class="ident" id="4204250">sha1Digest</span><span class="op" id="4204260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204263">sha1Digest</span>&nbsp;<span class="op" id="4204274">=</span>&nbsp;<span class="ident" id="4204276">sha1</span><span class="op" id="4204280">.</span><span class="ident" id="4204281">Sum</span><span class="op" id="4204284">(</span><span class="ident" id="4204285">nil</span><span class="op" id="4204288">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204292">ret</span>&nbsp;<span class="op" id="4204296">:=</span>&nbsp;<span class="builtinfunc" id="4204299">make</span><span class="op" id="4204303">(</span><span class="op" id="4204304">[</span><span class="op" id="4204305">]</span><span class="builtintype" id="4204306">byte</span><span class="op" id="4204310">,</span>&nbsp;<span class="builtinfunc" id="4204312">len</span><span class="op" id="4204315">(</span><span class="ident" id="4204316">md5Digest</span><span class="op" id="4204325">)</span><span class="op" id="4204326">+</span><span class="builtinfunc" id="4204327">len</span><span class="op" id="4204330">(</span><span class="ident" id="4204331">sha1Digest</span><span class="op" id="4204341">)</span><span class="op" id="4204342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4204345">copy</span><span class="op" id="4204349">(</span><span class="ident" id="4204350">ret</span><span class="op" id="4204353">,</span>&nbsp;<span class="ident" id="4204355">md5Digest</span><span class="op" id="4204364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4204367">copy</span><span class="op" id="4204371">(</span><span class="ident" id="4204372">ret</span><span class="op" id="4204375">[</span><span class="builtinfunc" id="4204376">len</span><span class="op" id="4204379">(</span><span class="ident" id="4204380">md5Digest</span><span class="op" id="4204389">)</span><span class="op" id="4204390">:</span><span class="op" id="4204391">]</span><span class="op" id="4204392">,</span>&nbsp;<span class="ident" id="4204394">sha1Digest</span><span class="op" id="4204404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204407">return</span>&nbsp;<span class="ident" id="4204414">ret</span><br>
<span class="lineno">230</span><span class="op" id="4204418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4204421">var</span>&nbsp;<span class="ident" id="4204425">ssl3ClientFinishedMagic</span>&nbsp;<span class="op" id="4204449">=</span>&nbsp;<span class="op" id="4204451">[</span><span class="num" id="4204452">4</span><span class="op" id="4204453">]</span><span class="builtintype" id="4204454">byte</span><span class="op" id="4204458">{</span><span class="num" id="4204459">0x43</span><span class="op" id="4204463">,</span>&nbsp;<span class="num" id="4204465">0x4c</span><span class="op" id="4204469">,</span>&nbsp;<span class="num" id="4204471">0x4e</span><span class="op" id="4204475">,</span>&nbsp;<span class="num" id="4204477">0x54</span><span class="op" id="4204481">}</span><br>
<span class="lineno"></span><span class="keyword" id="4204483">var</span>&nbsp;<span class="ident" id="4204487">ssl3ServerFinishedMagic</span>&nbsp;<span class="op" id="4204511">=</span>&nbsp;<span class="op" id="4204513">[</span><span class="num" id="4204514">4</span><span class="op" id="4204515">]</span><span class="builtintype" id="4204516">byte</span><span class="op" id="4204520">{</span><span class="num" id="4204521">0x53</span><span class="op" id="4204525">,</span>&nbsp;<span class="num" id="4204527">0x52</span><span class="op" id="4204531">,</span>&nbsp;<span class="num" id="4204533">0x56</span><span class="op" id="4204537">,</span>&nbsp;<span class="num" id="4204539">0x52</span><span class="op" id="4204543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4204546">//&nbsp;clientSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;client&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4204620">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4204641">func</span>&nbsp;<span class="op" id="4204646">(</span><span class="ident" id="4204647">h</span>&nbsp;<span class="ident" id="4204649">finishedHash</span><span class="op" id="4204661">)</span>&nbsp;<span class="ident" id="4204663">clientSum</span><span class="op" id="4204672">(</span><span class="ident" id="4204673">masterSecret</span>&nbsp;<span class="op" id="4204686">[</span><span class="op" id="4204687">]</span><span class="builtintype" id="4204688">byte</span><span class="op" id="4204692">)</span>&nbsp;<span class="op" id="4204694">[</span><span class="op" id="4204695">]</span><span class="builtintype" id="4204696">byte</span>&nbsp;<span class="op" id="4204701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204704">if</span>&nbsp;<span class="ident" id="4204707">h</span><span class="op" id="4204708">.</span><span class="ident" id="4204709">version</span>&nbsp;<span class="op" id="4204717">==</span>&nbsp;<span class="ident" id="4204720">VersionSSL30</span>&nbsp;<span class="op" id="4204733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204737">return</span>&nbsp;<span class="ident" id="4204744">finishedSum30</span><span class="op" id="4204757">(</span><span class="ident" id="4204758">h</span><span class="op" id="4204759">.</span><span class="ident" id="4204760">clientMD5</span><span class="op" id="4204769">,</span>&nbsp;<span class="ident" id="4204771">h</span><span class="op" id="4204772">.</span><span class="ident" id="4204773">client</span><span class="op" id="4204779">,</span>&nbsp;<span class="ident" id="4204781">masterSecret</span><span class="op" id="4204793">,</span>&nbsp;<span class="ident" id="4204795">ssl3ClientFinishedMagic</span><span class="op" id="4204818">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4204821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204825">out</span>&nbsp;<span class="op" id="4204829">:=</span>&nbsp;<span class="builtinfunc" id="4204832">make</span><span class="op" id="4204836">(</span><span class="op" id="4204837">[</span><span class="op" id="4204838">]</span><span class="builtintype" id="4204839">byte</span><span class="op" id="4204843">,</span>&nbsp;<span class="ident" id="4204845">finishedVerifyLength</span><span class="op" id="4204865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204868">if</span>&nbsp;<span class="ident" id="4204871">h</span><span class="op" id="4204872">.</span><span class="ident" id="4204873">version</span>&nbsp;<span class="op" id="4204881">&gt;=</span>&nbsp;<span class="ident" id="4204884">VersionTLS12</span>&nbsp;<span class="op" id="4204897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204901">seed</span>&nbsp;<span class="op" id="4204906">:=</span>&nbsp;<span class="ident" id="4204909">h</span><span class="op" id="4204910">.</span><span class="ident" id="4204911">client</span><span class="op" id="4204917">.</span><span class="ident" id="4204918">Sum</span><span class="op" id="4204921">(</span><span class="ident" id="4204922">nil</span><span class="op" id="4204925">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204929">prf12</span><span class="op" id="4204934">(</span><span class="ident" id="4204935">out</span><span class="op" id="4204938">,</span>&nbsp;<span class="ident" id="4204940">masterSecret</span><span class="op" id="4204952">,</span>&nbsp;<span class="ident" id="4204954">clientFinishedLabel</span><span class="op" id="4204973">,</span>&nbsp;<span class="ident" id="4204975">seed</span><span class="op" id="4204979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4204982">}</span>&nbsp;<span class="keyword" id="4204984">else</span>&nbsp;<span class="op" id="4204989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204993">seed</span>&nbsp;<span class="op" id="4204998">:=</span>&nbsp;<span class="builtinfunc" id="4205001">make</span><span class="op" id="4205005">(</span><span class="op" id="4205006">[</span><span class="op" id="4205007">]</span><span class="builtintype" id="4205008">byte</span><span class="op" id="4205012">,</span>&nbsp;<span class="num" id="4205014">0</span><span class="op" id="4205015">,</span>&nbsp;<span class="ident" id="4205017">md5</span><span class="op" id="4205020">.</span><span class="ident" id="4205021">Size</span><span class="op" id="4205025">+</span><span class="ident" id="4205026">sha1</span><span class="op" id="4205030">.</span><span class="ident" id="4205031">Size</span><span class="op" id="4205035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4205039">seed</span>&nbsp;<span class="op" id="4205044">=</span>&nbsp;<span class="ident" id="4205046">h</span><span class="op" id="4205047">.</span><span class="ident" id="4205048">clientMD5</span><span class="op" id="4205057">.</span><span class="ident" id="4205058">Sum</span><span class="op" id="4205061">(</span><span class="ident" id="4205062">seed</span><span class="op" id="4205066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4205070">seed</span>&nbsp;<span class="op" id="4205075">=</span>&nbsp;<span class="ident" id="4205077">h</span><span class="op" id="4205078">.</span><span class="ident" id="4205079">client</span><span class="op" id="4205085">.</span><span class="ident" id="4205086">Sum</span><span class="op" id="4205089">(</span><span class="ident" id="4205090">seed</span><span class="op" id="4205094">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4205098">prf10</span><span class="op" id="4205103">(</span><span class="ident" id="4205104">out</span><span class="op" id="4205107">,</span>&nbsp;<span class="ident" id="4205109">masterSecret</span><span class="op" id="4205121">,</span>&nbsp;<span class="ident" id="4205123">clientFinishedLabel</span><span class="op" id="4205142">,</span>&nbsp;<span class="ident" id="4205144">seed</span><span class="op" id="4205148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4205151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205154">return</span>&nbsp;<span class="ident" id="4205161">out</span><br>
<span class="lineno"></span><span class="op" id="4205165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="4205168">//&nbsp;serverSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;server&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4205242">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4205263">func</span>&nbsp;<span class="op" id="4205268">(</span><span class="ident" id="4205269">h</span>&nbsp;<span class="ident" id="4205271">finishedHash</span><span class="op" id="4205283">)</span>&nbsp;<span class="ident" id="4205285">serverSum</span><span class="op" id="4205294">(</span><span class="ident" id="4205295">masterSecret</span>&nbsp;<span class="op" id="4205308">[</span><span class="op" id="4205309">]</span><span class="builtintype" id="4205310">byte</span><span class="op" id="4205314">)</span>&nbsp;<span class="op" id="4205316">[</span><span class="op" id="4205317">]</span><span class="builtintype" id="4205318">byte</span>&nbsp;<span class="op" id="4205323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205326">if</span>&nbsp;<span class="ident" id="4205329">h</span><span class="op" id="4205330">.</span><span class="ident" id="4205331">version</span>&nbsp;<span class="op" id="4205339">==</span>&nbsp;<span class="ident" id="4205342">VersionSSL30</span>&nbsp;<span class="op" id="4205355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205359">return</span>&nbsp;<span class="ident" id="4205366">finishedSum30</span><span class="op" id="4205379">(</span><span class="ident" id="4205380">h</span><span class="op" id="4205381">.</span><span class="ident" id="4205382">serverMD5</span><span class="op" id="4205391">,</span>&nbsp;<span class="ident" id="4205393">h</span><span class="op" id="4205394">.</span><span class="ident" id="4205395">server</span><span class="op" id="4205401">,</span>&nbsp;<span class="ident" id="4205403">masterSecret</span><span class="op" id="4205415">,</span>&nbsp;<span class="ident" id="4205417">ssl3ServerFinishedMagic</span><span class="op" id="4205440">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4205443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4205447">out</span>&nbsp;<span class="op" id="4205451">:=</span>&nbsp;<span class="builtinfunc" id="4205454">make</span><span class="op" id="4205458">(</span><span class="op" id="4205459">[</span><span class="op" id="4205460">]</span><span class="builtintype" id="4205461">byte</span><span class="op" id="4205465">,</span>&nbsp;<span class="ident" id="4205467">finishedVerifyLength</span><span class="op" id="4205487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205490">if</span>&nbsp;<span class="ident" id="4205493">h</span><span class="op" id="4205494">.</span><span class="ident" id="4205495">version</span>&nbsp;<span class="op" id="4205503">&gt;=</span>&nbsp;<span class="ident" id="4205506">VersionTLS12</span>&nbsp;<span class="op" id="4205519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4205523">seed</span>&nbsp;<span class="op" id="4205528">:=</span>&nbsp;<span class="ident" id="4205531">h</span><span class="op" id="4205532">.</span><span class="ident" id="4205533">server</span><span class="op" id="4205539">.</span><span class="ident" id="4205540">Sum</span><span class="op" id="4205543">(</span><span class="ident" id="4205544">nil</span><span class="op" id="4205547">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4205551">prf12</span><span class="op" id="4205556">(</span><span class="ident" id="4205557">out</span><span class="op" id="4205560">,</span>&nbsp;<span class="ident" id="4205562">masterSecret</span><span class="op" id="4205574">,</span>&nbsp;<span class="ident" id="4205576">serverFinishedLabel</span><span class="op" id="4205595">,</span>&nbsp;<span class="ident" id="4205597">seed</span><span class="op" id="4205601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4205604">}</span>&nbsp;<span class="keyword" id="4205606">else</span>&nbsp;<span class="op" id="4205611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4205615">seed</span>&nbsp;<span class="op" id="4205620">:=</span>&nbsp;<span class="builtinfunc" id="4205623">make</span><span class="op" id="4205627">(</span><span class="op" id="4205628">[</span><span class="op" id="4205629">]</span><span class="builtintype" id="4205630">byte</span><span class="op" id="4205634">,</span>&nbsp;<span class="num" id="4205636">0</span><span class="op" id="4205637">,</span>&nbsp;<span class="ident" id="4205639">md5</span><span class="op" id="4205642">.</span><span class="ident" id="4205643">Size</span><span class="op" id="4205647">+</span><span class="ident" id="4205648">sha1</span><span class="op" id="4205652">.</span><span class="ident" id="4205653">Size</span><span class="op" id="4205657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4205661">seed</span>&nbsp;<span class="op" id="4205666">=</span>&nbsp;<span class="ident" id="4205668">h</span><span class="op" id="4205669">.</span><span class="ident" id="4205670">serverMD5</span><span class="op" id="4205679">.</span><span class="ident" id="4205680">Sum</span><span class="op" id="4205683">(</span><span class="ident" id="4205684">seed</span><span class="op" id="4205688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4205692">seed</span>&nbsp;<span class="op" id="4205697">=</span>&nbsp;<span class="ident" id="4205699">h</span><span class="op" id="4205700">.</span><span class="ident" id="4205701">server</span><span class="op" id="4205707">.</span><span class="ident" id="4205708">Sum</span><span class="op" id="4205711">(</span><span class="ident" id="4205712">seed</span><span class="op" id="4205716">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4205720">prf10</span><span class="op" id="4205725">(</span><span class="ident" id="4205726">out</span><span class="op" id="4205729">,</span>&nbsp;<span class="ident" id="4205731">masterSecret</span><span class="op" id="4205743">,</span>&nbsp;<span class="ident" id="4205745">serverFinishedLabel</span><span class="op" id="4205764">,</span>&nbsp;<span class="ident" id="4205766">seed</span><span class="op" id="4205770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4205773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4205776">return</span>&nbsp;<span class="ident" id="4205783">out</span><br>
<span class="lineno"></span><span class="op" id="4205787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="comment" id="4205790">//&nbsp;hashForClientCertificate&nbsp;returns&nbsp;a&nbsp;digest,&nbsp;hash&nbsp;function,&nbsp;and&nbsp;TLS&nbsp;1.2&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="4205868">//&nbsp;id&nbsp;suitable&nbsp;for&nbsp;signing&nbsp;by&nbsp;a&nbsp;TLS&nbsp;client&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="4205924">func</span>&nbsp;<span class="op" id="4205929">(</span><span class="ident" id="4205930">h</span>&nbsp;<span class="ident" id="4205932">finishedHash</span><span class="op" id="4205944">)</span>&nbsp;<span class="ident" id="4205946">hashForClientCertificate</span><span class="op" id="4205970">(</span><span class="ident" id="4205971">sigType</span>&nbsp;<span class="builtintype" id="4205979">uint8</span><span class="op" id="4205984">)</span>&nbsp;<span class="op" id="4205986">(</span><span class="op" id="4205987">[</span><span class="op" id="4205988">]</span><span class="builtintype" id="4205989">byte</span><span class="op" id="4205993">,</span>&nbsp;<span class="ident" id="4205995">crypto</span><span class="op" id="4206001">.</span><span class="ident" id="4206002">Hash</span><span class="op" id="4206006">,</span>&nbsp;<span class="builtintype" id="4206008">uint8</span><span class="op" id="4206013">)</span>&nbsp;<span class="op" id="4206015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4206018">if</span>&nbsp;<span class="ident" id="4206021">h</span><span class="op" id="4206022">.</span><span class="ident" id="4206023">version</span>&nbsp;<span class="op" id="4206031">&gt;=</span>&nbsp;<span class="ident" id="4206034">VersionTLS12</span>&nbsp;<span class="op" id="4206047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4206051">digest</span>&nbsp;<span class="op" id="4206058">:=</span>&nbsp;<span class="ident" id="4206061">h</span><span class="op" id="4206062">.</span><span class="ident" id="4206063">server</span><span class="op" id="4206069">.</span><span class="ident" id="4206070">Sum</span><span class="op" id="4206073">(</span><span class="ident" id="4206074">nil</span><span class="op" id="4206077">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4206081">return</span>&nbsp;<span class="ident" id="4206088">digest</span><span class="op" id="4206094">,</span>&nbsp;<span class="ident" id="4206096">crypto</span><span class="op" id="4206102">.</span><span class="ident" id="4206103">SHA256</span><span class="op" id="4206109">,</span>&nbsp;<span class="ident" id="4206111">hashSHA256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4206123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4206126">if</span>&nbsp;<span class="ident" id="4206129">sigType</span>&nbsp;<span class="op" id="4206137">==</span>&nbsp;<span class="ident" id="4206140">signatureECDSA</span>&nbsp;<span class="op" id="4206155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4206159">digest</span>&nbsp;<span class="op" id="4206166">:=</span>&nbsp;<span class="ident" id="4206169">h</span><span class="op" id="4206170">.</span><span class="ident" id="4206171">server</span><span class="op" id="4206177">.</span><span class="ident" id="4206178">Sum</span><span class="op" id="4206181">(</span><span class="ident" id="4206182">nil</span><span class="op" id="4206185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4206189">return</span>&nbsp;<span class="ident" id="4206196">digest</span><span class="op" id="4206202">,</span>&nbsp;<span class="ident" id="4206204">crypto</span><span class="op" id="4206210">.</span><span class="ident" id="4206211">SHA1</span><span class="op" id="4206215">,</span>&nbsp;<span class="ident" id="4206217">hashSHA1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4206227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4206231">digest</span>&nbsp;<span class="op" id="4206238">:=</span>&nbsp;<span class="builtinfunc" id="4206241">make</span><span class="op" id="4206245">(</span><span class="op" id="4206246">[</span><span class="op" id="4206247">]</span><span class="builtintype" id="4206248">byte</span><span class="op" id="4206252">,</span>&nbsp;<span class="num" id="4206254">0</span><span class="op" id="4206255">,</span>&nbsp;<span class="num" id="4206257">36</span><span class="op" id="4206259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4206262">digest</span>&nbsp;<span class="op" id="4206269">=</span>&nbsp;<span class="ident" id="4206271">h</span><span class="op" id="4206272">.</span><span class="ident" id="4206273">serverMD5</span><span class="op" id="4206282">.</span><span class="ident" id="4206283">Sum</span><span class="op" id="4206286">(</span><span class="ident" id="4206287">digest</span><span class="op" id="4206293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4206296">digest</span>&nbsp;<span class="op" id="4206303">=</span>&nbsp;<span class="ident" id="4206305">h</span><span class="op" id="4206306">.</span><span class="ident" id="4206307">server</span><span class="op" id="4206313">.</span><span class="ident" id="4206314">Sum</span><span class="op" id="4206317">(</span><span class="ident" id="4206318">digest</span><span class="op" id="4206324">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4206327">return</span>&nbsp;<span class="ident" id="4206334">digest</span><span class="op" id="4206340">,</span>&nbsp;<span class="ident" id="4206342">crypto</span><span class="op" id="4206348">.</span><span class="ident" id="4206349">MD5SHA1</span><span class="op" id="4206356">,</span>&nbsp;<span class="num" id="4206358">0</span>&nbsp;<span class="comment" id="4206360">/*&nbsp;not&nbsp;specified&nbsp;in&nbsp;TLS&nbsp;1.2.&nbsp;*/</span><br>
<span class="lineno"></span><span class="op" id="4206392">}</span>
</div>
</body>
</html>
