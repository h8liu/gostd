<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/xml</h2>
<ul>
<li><a href="/gostd/encoding/xml/atom_test.go.html">atom_test.go</a></li>
<li><a href="/gostd/encoding/xml/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/xml/marshal.go.html">marshal.go</a></li>
<li><a href="/gostd/encoding/xml/marshal_test.go.html">marshal_test.go</a></li>
<li><a href="/gostd/encoding/xml/read.go.html">read.go</a></li>
<li><a href="/gostd/encoding/xml/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/encoding/xml/typeinfo.go.html" class="current">typeinfo.go</a></li>
<li><a href="/gostd/encoding/xml/xml.go.html">xml.go</a></li>
<li><a href="/gostd/encoding/xml/xml_test.go.html">xml_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5857283">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5857339">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5857393">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5857444">package</span>&nbsp;<span class="ident" id="5857452">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5857457">import</span>&nbsp;<span class="op" id="5857464">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5857467">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5857474">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5857485">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5857496">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5857503">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5857506">//&nbsp;typeInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;type.</span><br>
<span class="lineno">15</span><span class="keyword" id="5857570">type</span>&nbsp;<span class="ident" id="5857575">typeInfo</span>&nbsp;<span class="keyword" id="5857584">struct</span>&nbsp;<span class="op" id="5857591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857594">xmlname</span>&nbsp;<span class="op" id="5857602">*</span><span class="ident" id="5857603">fieldInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857614">fields</span>&nbsp;&nbsp;<span class="op" id="5857622">[</span><span class="op" id="5857623">]</span><span class="ident" id="5857624">fieldInfo</span><br>
<span class="lineno"></span><span class="op" id="5857634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5857637">//&nbsp;fieldInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="5857710">type</span>&nbsp;<span class="ident" id="5857715">fieldInfo</span>&nbsp;<span class="keyword" id="5857725">struct</span>&nbsp;<span class="op" id="5857732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857735">idx</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5857743">[</span><span class="op" id="5857744">]</span><span class="builtintype" id="5857745">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857750">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5857758">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857766">xmlns</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5857774">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857782">flags</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5857790">fieldFlags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857802">parents</span>&nbsp;<span class="op" id="5857810">[</span><span class="op" id="5857811">]</span><span class="builtintype" id="5857812">string</span><br>
<span class="lineno"></span><span class="op" id="5857819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5857822">type</span>&nbsp;<span class="ident" id="5857827">fieldFlags</span>&nbsp;<span class="builtintype" id="5857838">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="5857843">const</span>&nbsp;<span class="op" id="5857849">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857852">fElement</span>&nbsp;<span class="ident" id="5857861">fieldFlags</span>&nbsp;<span class="op" id="5857872">=</span>&nbsp;<span class="num" id="5857874">1</span>&nbsp;<span class="op" id="5857876">&lt;&lt;</span>&nbsp;<span class="ident" id="5857879">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857885">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857892">fCharData</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857903">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857914">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857924">fAny</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857931">fOmitEmpty</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857944">fMode</span>&nbsp;<span class="op" id="5857950">=</span>&nbsp;<span class="ident" id="5857952">fElement</span>&nbsp;<span class="op" id="5857961">|</span>&nbsp;<span class="ident" id="5857963">fAttr</span>&nbsp;<span class="op" id="5857969">|</span>&nbsp;<span class="ident" id="5857971">fCharData</span>&nbsp;<span class="op" id="5857981">|</span>&nbsp;<span class="ident" id="5857983">fInnerXml</span>&nbsp;<span class="op" id="5857993">|</span>&nbsp;<span class="ident" id="5857995">fComment</span>&nbsp;<span class="op" id="5858004">|</span>&nbsp;<span class="ident" id="5858006">fAny</span><br>
<span class="lineno"></span><span class="op" id="5858011">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5858014">var</span>&nbsp;<span class="ident" id="5858018">tinfoMap</span>&nbsp;<span class="op" id="5858027">=</span>&nbsp;<span class="builtinfunc" id="5858029">make</span><span class="op" id="5858033">(</span><span class="keyword" id="5858034">map</span><span class="op" id="5858037">[</span><span class="ident" id="5858038">reflect</span><span class="op" id="5858045">.</span><span class="ident" id="5858046">Type</span><span class="op" id="5858050">]</span><span class="op" id="5858051">*</span><span class="ident" id="5858052">typeInfo</span><span class="op" id="5858060">)</span><br>
<span class="lineno">45</span><span class="keyword" id="5858062">var</span>&nbsp;<span class="ident" id="5858066">tinfoLock</span>&nbsp;<span class="ident" id="5858076">sync</span><span class="op" id="5858080">.</span><span class="ident" id="5858081">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5858090">var</span>&nbsp;<span class="ident" id="5858094">nameType</span>&nbsp;<span class="op" id="5858103">=</span>&nbsp;<span class="ident" id="5858105">reflect</span><span class="op" id="5858112">.</span><span class="ident" id="5858113">TypeOf</span><span class="op" id="5858119">(</span><span class="ident" id="5858120">Name</span><span class="op" id="5858124">{</span><span class="op" id="5858125">}</span><span class="op" id="5858126">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5858129">//&nbsp;getTypeInfo&nbsp;returns&nbsp;the&nbsp;typeInfo&nbsp;structure&nbsp;with&nbsp;details&nbsp;necessary</span><br>
<span class="lineno">50</span><span class="comment" id="5858198">//&nbsp;for&nbsp;marshalling&nbsp;and&nbsp;unmarshalling&nbsp;typ.</span><br>
<span class="lineno"></span><span class="keyword" id="5858240">func</span>&nbsp;<span class="ident" id="5858245">getTypeInfo</span><span class="op" id="5858256">(</span><span class="ident" id="5858257">typ</span>&nbsp;<span class="ident" id="5858261">reflect</span><span class="op" id="5858268">.</span><span class="ident" id="5858269">Type</span><span class="op" id="5858273">)</span>&nbsp;<span class="op" id="5858275">(</span><span class="op" id="5858276">*</span><span class="ident" id="5858277">typeInfo</span><span class="op" id="5858285">,</span>&nbsp;<span class="builtintype" id="5858287">error</span><span class="op" id="5858292">)</span>&nbsp;<span class="op" id="5858294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858297">tinfoLock</span><span class="op" id="5858306">.</span><span class="ident" id="5858307">RLock</span><span class="op" id="5858312">(</span><span class="op" id="5858313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858316">tinfo</span><span class="op" id="5858321">,</span>&nbsp;<span class="ident" id="5858323">ok</span>&nbsp;<span class="op" id="5858326">:=</span>&nbsp;<span class="ident" id="5858329">tinfoMap</span><span class="op" id="5858337">[</span><span class="ident" id="5858338">typ</span><span class="op" id="5858341">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858344">tinfoLock</span><span class="op" id="5858353">.</span><span class="ident" id="5858354">RUnlock</span><span class="op" id="5858361">(</span><span class="op" id="5858362">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858365">if</span>&nbsp;<span class="ident" id="5858368">ok</span>&nbsp;<span class="op" id="5858371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858375">return</span>&nbsp;<span class="ident" id="5858382">tinfo</span><span class="op" id="5858387">,</span>&nbsp;<span class="ident" id="5858389">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5858394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858397">tinfo</span>&nbsp;<span class="op" id="5858403">=</span>&nbsp;<span class="op" id="5858405">&amp;</span><span class="ident" id="5858406">typeInfo</span><span class="op" id="5858414">{</span><span class="op" id="5858415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858418">if</span>&nbsp;<span class="ident" id="5858421">typ</span><span class="op" id="5858424">.</span><span class="ident" id="5858425">Kind</span><span class="op" id="5858429">(</span><span class="op" id="5858430">)</span>&nbsp;<span class="op" id="5858432">==</span>&nbsp;<span class="ident" id="5858435">reflect</span><span class="op" id="5858442">.</span><span class="ident" id="5858443">Struct</span>&nbsp;<span class="op" id="5858450">&amp;&amp;</span>&nbsp;<span class="ident" id="5858453">typ</span>&nbsp;<span class="op" id="5858457">!=</span>&nbsp;<span class="ident" id="5858460">nameType</span>&nbsp;<span class="op" id="5858469">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858473">n</span>&nbsp;<span class="op" id="5858475">:=</span>&nbsp;<span class="ident" id="5858478">typ</span><span class="op" id="5858481">.</span><span class="ident" id="5858482">NumField</span><span class="op" id="5858490">(</span><span class="op" id="5858491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858495">for</span>&nbsp;<span class="ident" id="5858499">i</span>&nbsp;<span class="op" id="5858501">:=</span>&nbsp;<span class="num" id="5858504">0</span><span class="op" id="5858505">;</span>&nbsp;<span class="ident" id="5858507">i</span>&nbsp;<span class="op" id="5858509">&lt;</span>&nbsp;<span class="ident" id="5858511">n</span><span class="op" id="5858512">;</span>&nbsp;<span class="ident" id="5858514">i</span><span class="op" id="5858515">++</span>&nbsp;<span class="op" id="5858518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858523">f</span>&nbsp;<span class="op" id="5858525">:=</span>&nbsp;<span class="ident" id="5858528">typ</span><span class="op" id="5858531">.</span><span class="ident" id="5858532">Field</span><span class="op" id="5858537">(</span><span class="ident" id="5858538">i</span><span class="op" id="5858539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858544">if</span>&nbsp;<span class="ident" id="5858547">f</span><span class="op" id="5858548">.</span><span class="ident" id="5858549">PkgPath</span>&nbsp;<span class="op" id="5858557">!=</span>&nbsp;<span class="string" id="5858560">&#34;&#34;</span>&nbsp;<span class="op" id="5858563">||</span>&nbsp;<span class="ident" id="5858566">f</span><span class="op" id="5858567">.</span><span class="ident" id="5858568">Tag</span><span class="op" id="5858571">.</span><span class="ident" id="5858572">Get</span><span class="op" id="5858575">(</span><span class="string" id="5858576">&#34;xml&#34;</span><span class="op" id="5858581">)</span>&nbsp;<span class="op" id="5858583">==</span>&nbsp;<span class="string" id="5858586">&#34;-&#34;</span>&nbsp;<span class="op" id="5858590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858596">continue</span>&nbsp;<span class="comment" id="5858605">//&nbsp;Private&nbsp;field</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5858625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5858631">//&nbsp;For&nbsp;embedded&nbsp;structs,&nbsp;embed&nbsp;its&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858677">if</span>&nbsp;<span class="ident" id="5858680">f</span><span class="op" id="5858681">.</span><span class="ident" id="5858682">Anonymous</span>&nbsp;<span class="op" id="5858692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858698">t</span>&nbsp;<span class="op" id="5858700">:=</span>&nbsp;<span class="ident" id="5858703">f</span><span class="op" id="5858704">.</span><span class="ident" id="5858705">Type</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858714">if</span>&nbsp;<span class="ident" id="5858717">t</span><span class="op" id="5858718">.</span><span class="ident" id="5858719">Kind</span><span class="op" id="5858723">(</span><span class="op" id="5858724">)</span>&nbsp;<span class="op" id="5858726">==</span>&nbsp;<span class="ident" id="5858729">reflect</span><span class="op" id="5858736">.</span><span class="ident" id="5858737">Ptr</span>&nbsp;<span class="op" id="5858741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858748">t</span>&nbsp;<span class="op" id="5858750">=</span>&nbsp;<span class="ident" id="5858752">t</span><span class="op" id="5858753">.</span><span class="ident" id="5858754">Elem</span><span class="op" id="5858758">(</span><span class="op" id="5858759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5858765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858771">if</span>&nbsp;<span class="ident" id="5858774">t</span><span class="op" id="5858775">.</span><span class="ident" id="5858776">Kind</span><span class="op" id="5858780">(</span><span class="op" id="5858781">)</span>&nbsp;<span class="op" id="5858783">==</span>&nbsp;<span class="ident" id="5858786">reflect</span><span class="op" id="5858793">.</span><span class="ident" id="5858794">Struct</span>&nbsp;<span class="op" id="5858801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858808">inner</span><span class="op" id="5858813">,</span>&nbsp;<span class="ident" id="5858815">err</span>&nbsp;<span class="op" id="5858819">:=</span>&nbsp;<span class="ident" id="5858822">getTypeInfo</span><span class="op" id="5858833">(</span><span class="ident" id="5858834">t</span><span class="op" id="5858835">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858842">if</span>&nbsp;<span class="ident" id="5858845">err</span>&nbsp;<span class="op" id="5858849">!=</span>&nbsp;<span class="ident" id="5858852">nil</span>&nbsp;<span class="op" id="5858856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858864">return</span>&nbsp;<span class="ident" id="5858871">nil</span><span class="op" id="5858874">,</span>&nbsp;<span class="ident" id="5858876">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5858885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858892">if</span>&nbsp;<span class="ident" id="5858895">tinfo</span><span class="op" id="5858900">.</span><span class="ident" id="5858901">xmlname</span>&nbsp;<span class="op" id="5858909">==</span>&nbsp;<span class="ident" id="5858912">nil</span>&nbsp;<span class="op" id="5858916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858924">tinfo</span><span class="op" id="5858929">.</span><span class="ident" id="5858930">xmlname</span>&nbsp;<span class="op" id="5858938">=</span>&nbsp;<span class="ident" id="5858940">inner</span><span class="op" id="5858945">.</span><span class="ident" id="5858946">xmlname</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5858959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858966">for</span>&nbsp;<span class="ident" id="5858970">_</span><span class="op" id="5858971">,</span>&nbsp;<span class="ident" id="5858973">finfo</span>&nbsp;<span class="op" id="5858979">:=</span>&nbsp;<span class="keyword" id="5858982">range</span>&nbsp;<span class="ident" id="5858988">inner</span><span class="op" id="5858993">.</span><span class="ident" id="5858994">fields</span>&nbsp;<span class="op" id="5859001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859009">finfo</span><span class="op" id="5859014">.</span><span class="ident" id="5859015">idx</span>&nbsp;<span class="op" id="5859019">=</span>&nbsp;<span class="builtinfunc" id="5859021">append</span><span class="op" id="5859027">(</span><span class="op" id="5859028">[</span><span class="op" id="5859029">]</span><span class="builtintype" id="5859030">int</span><span class="op" id="5859033">{</span><span class="ident" id="5859034">i</span><span class="op" id="5859035">}</span><span class="op" id="5859036">,</span>&nbsp;<span class="ident" id="5859038">finfo</span><span class="op" id="5859043">.</span><span class="ident" id="5859044">idx</span><span class="op" id="5859047">...</span><span class="op" id="5859050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859058">if</span>&nbsp;<span class="ident" id="5859061">err</span>&nbsp;<span class="op" id="5859065">:=</span>&nbsp;<span class="ident" id="5859068">addFieldInfo</span><span class="op" id="5859080">(</span><span class="ident" id="5859081">typ</span><span class="op" id="5859084">,</span>&nbsp;<span class="ident" id="5859086">tinfo</span><span class="op" id="5859091">,</span>&nbsp;<span class="op" id="5859093">&amp;</span><span class="ident" id="5859094">finfo</span><span class="op" id="5859099">)</span><span class="op" id="5859100">;</span>&nbsp;<span class="ident" id="5859102">err</span>&nbsp;<span class="op" id="5859106">!=</span>&nbsp;<span class="ident" id="5859109">nil</span>&nbsp;<span class="op" id="5859113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859122">return</span>&nbsp;<span class="ident" id="5859129">nil</span><span class="op" id="5859132">,</span>&nbsp;<span class="ident" id="5859134">err</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5859144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5859151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859158">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5859171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5859176">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859182">finfo</span><span class="op" id="5859187">,</span>&nbsp;<span class="ident" id="5859189">err</span>&nbsp;<span class="op" id="5859193">:=</span>&nbsp;<span class="ident" id="5859196">structFieldInfo</span><span class="op" id="5859211">(</span><span class="ident" id="5859212">typ</span><span class="op" id="5859215">,</span>&nbsp;<span class="op" id="5859217">&amp;</span><span class="ident" id="5859218">f</span><span class="op" id="5859219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859224">if</span>&nbsp;<span class="ident" id="5859227">err</span>&nbsp;<span class="op" id="5859231">!=</span>&nbsp;<span class="ident" id="5859234">nil</span>&nbsp;<span class="op" id="5859238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859244">return</span>&nbsp;<span class="ident" id="5859251">nil</span><span class="op" id="5859254">,</span>&nbsp;<span class="ident" id="5859256">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5859263">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859269">if</span>&nbsp;<span class="ident" id="5859272">f</span><span class="op" id="5859273">.</span><span class="ident" id="5859274">Name</span>&nbsp;<span class="op" id="5859279">==</span>&nbsp;<span class="string" id="5859282">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5859292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859298">tinfo</span><span class="op" id="5859303">.</span><span class="ident" id="5859304">xmlname</span>&nbsp;<span class="op" id="5859312">=</span>&nbsp;<span class="ident" id="5859314">finfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859324">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5859336">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5859342">//&nbsp;Add&nbsp;the&nbsp;field&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;conflict&nbsp;with&nbsp;other&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859404">if</span>&nbsp;<span class="ident" id="5859407">err</span>&nbsp;<span class="op" id="5859411">:=</span>&nbsp;<span class="ident" id="5859414">addFieldInfo</span><span class="op" id="5859426">(</span><span class="ident" id="5859427">typ</span><span class="op" id="5859430">,</span>&nbsp;<span class="ident" id="5859432">tinfo</span><span class="op" id="5859437">,</span>&nbsp;<span class="ident" id="5859439">finfo</span><span class="op" id="5859444">)</span><span class="op" id="5859445">;</span>&nbsp;<span class="ident" id="5859447">err</span>&nbsp;<span class="op" id="5859451">!=</span>&nbsp;<span class="ident" id="5859454">nil</span>&nbsp;<span class="op" id="5859458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859464">return</span>&nbsp;<span class="ident" id="5859471">nil</span><span class="op" id="5859474">,</span>&nbsp;<span class="ident" id="5859476">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5859483">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5859487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5859490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859493">tinfoLock</span><span class="op" id="5859502">.</span><span class="ident" id="5859503">Lock</span><span class="op" id="5859507">(</span><span class="op" id="5859508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859511">tinfoMap</span><span class="op" id="5859519">[</span><span class="ident" id="5859520">typ</span><span class="op" id="5859523">]</span>&nbsp;<span class="op" id="5859525">=</span>&nbsp;<span class="ident" id="5859527">tinfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859534">tinfoLock</span><span class="op" id="5859543">.</span><span class="ident" id="5859544">Unlock</span><span class="op" id="5859550">(</span><span class="op" id="5859551">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859554">return</span>&nbsp;<span class="ident" id="5859561">tinfo</span><span class="op" id="5859566">,</span>&nbsp;<span class="ident" id="5859568">nil</span><br>
<span class="lineno"></span><span class="op" id="5859572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5859575">//&nbsp;structFieldInfo&nbsp;builds&nbsp;and&nbsp;returns&nbsp;a&nbsp;fieldInfo&nbsp;for&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="5859632">func</span>&nbsp;<span class="ident" id="5859637">structFieldInfo</span><span class="op" id="5859652">(</span><span class="ident" id="5859653">typ</span>&nbsp;<span class="ident" id="5859657">reflect</span><span class="op" id="5859664">.</span><span class="ident" id="5859665">Type</span><span class="op" id="5859669">,</span>&nbsp;<span class="ident" id="5859671">f</span>&nbsp;<span class="op" id="5859673">*</span><span class="ident" id="5859674">reflect</span><span class="op" id="5859681">.</span><span class="ident" id="5859682">StructField</span><span class="op" id="5859693">)</span>&nbsp;<span class="op" id="5859695">(</span><span class="op" id="5859696">*</span><span class="ident" id="5859697">fieldInfo</span><span class="op" id="5859706">,</span>&nbsp;<span class="builtintype" id="5859708">error</span><span class="op" id="5859713">)</span>&nbsp;<span class="op" id="5859715">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859718">finfo</span>&nbsp;<span class="op" id="5859724">:=</span>&nbsp;<span class="op" id="5859727">&amp;</span><span class="ident" id="5859728">fieldInfo</span><span class="op" id="5859737">{</span><span class="ident" id="5859738">idx</span><span class="op" id="5859741">:</span>&nbsp;<span class="ident" id="5859743">f</span><span class="op" id="5859744">.</span><span class="ident" id="5859745">Index</span><span class="op" id="5859750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5859754">//&nbsp;Split&nbsp;the&nbsp;tag&nbsp;from&nbsp;the&nbsp;xml&nbsp;namespace&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859809">tag</span>&nbsp;<span class="op" id="5859813">:=</span>&nbsp;<span class="ident" id="5859816">f</span><span class="op" id="5859817">.</span><span class="ident" id="5859818">Tag</span><span class="op" id="5859821">.</span><span class="ident" id="5859822">Get</span><span class="op" id="5859825">(</span><span class="string" id="5859826">&#34;xml&#34;</span><span class="op" id="5859831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859834">if</span>&nbsp;<span class="ident" id="5859837">i</span>&nbsp;<span class="op" id="5859839">:=</span>&nbsp;<span class="ident" id="5859842">strings</span><span class="op" id="5859849">.</span><span class="ident" id="5859850">Index</span><span class="op" id="5859855">(</span><span class="ident" id="5859856">tag</span><span class="op" id="5859859">,</span>&nbsp;<span class="string" id="5859861">&#34;&nbsp;&#34;</span><span class="op" id="5859864">)</span><span class="op" id="5859865">;</span>&nbsp;<span class="ident" id="5859867">i</span>&nbsp;<span class="op" id="5859869">&gt;=</span>&nbsp;<span class="num" id="5859872">0</span>&nbsp;<span class="op" id="5859874">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859878">finfo</span><span class="op" id="5859883">.</span><span class="ident" id="5859884">xmlns</span><span class="op" id="5859889">,</span>&nbsp;<span class="ident" id="5859891">tag</span>&nbsp;<span class="op" id="5859895">=</span>&nbsp;<span class="ident" id="5859897">tag</span><span class="op" id="5859900">[</span><span class="op" id="5859901">:</span><span class="ident" id="5859902">i</span><span class="op" id="5859903">]</span><span class="op" id="5859904">,</span>&nbsp;<span class="ident" id="5859906">tag</span><span class="op" id="5859909">[</span><span class="ident" id="5859910">i</span><span class="op" id="5859911">+</span><span class="num" id="5859912">1</span><span class="op" id="5859913">:</span><span class="op" id="5859914">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5859917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5859921">//&nbsp;Parse&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859938">tokens</span>&nbsp;<span class="op" id="5859945">:=</span>&nbsp;<span class="ident" id="5859948">strings</span><span class="op" id="5859955">.</span><span class="ident" id="5859956">Split</span><span class="op" id="5859961">(</span><span class="ident" id="5859962">tag</span><span class="op" id="5859965">,</span>&nbsp;<span class="string" id="5859967">&#34;,&#34;</span><span class="op" id="5859970">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859973">if</span>&nbsp;<span class="builtinfunc" id="5859976">len</span><span class="op" id="5859979">(</span><span class="ident" id="5859980">tokens</span><span class="op" id="5859986">)</span>&nbsp;<span class="op" id="5859988">==</span>&nbsp;<span class="num" id="5859991">1</span>&nbsp;<span class="op" id="5859993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859997">finfo</span><span class="op" id="5860002">.</span><span class="ident" id="5860003">flags</span>&nbsp;<span class="op" id="5860009">=</span>&nbsp;<span class="ident" id="5860011">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5860021">}</span>&nbsp;<span class="keyword" id="5860023">else</span>&nbsp;<span class="op" id="5860028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860032">tag</span>&nbsp;<span class="op" id="5860036">=</span>&nbsp;<span class="ident" id="5860038">tokens</span><span class="op" id="5860044">[</span><span class="num" id="5860045">0</span><span class="op" id="5860046">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860050">for</span>&nbsp;<span class="ident" id="5860054">_</span><span class="op" id="5860055">,</span>&nbsp;<span class="ident" id="5860057">flag</span>&nbsp;<span class="op" id="5860062">:=</span>&nbsp;<span class="keyword" id="5860065">range</span>&nbsp;<span class="ident" id="5860071">tokens</span><span class="op" id="5860077">[</span><span class="num" id="5860078">1</span><span class="op" id="5860079">:</span><span class="op" id="5860080">]</span>&nbsp;<span class="op" id="5860082">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860087">switch</span>&nbsp;<span class="ident" id="5860094">flag</span>&nbsp;<span class="op" id="5860099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860104">case</span>&nbsp;<span class="string" id="5860109">&#34;attr&#34;</span><span class="op" id="5860115">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860121">finfo</span><span class="op" id="5860126">.</span><span class="ident" id="5860127">flags</span>&nbsp;<span class="op" id="5860133">|=</span>&nbsp;<span class="ident" id="5860136">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860145">case</span>&nbsp;<span class="string" id="5860150">&#34;chardata&#34;</span><span class="op" id="5860160">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860166">finfo</span><span class="op" id="5860171">.</span><span class="ident" id="5860172">flags</span>&nbsp;<span class="op" id="5860178">|=</span>&nbsp;<span class="ident" id="5860181">fCharData</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860194">case</span>&nbsp;<span class="string" id="5860199">&#34;innerxml&#34;</span><span class="op" id="5860209">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860215">finfo</span><span class="op" id="5860220">.</span><span class="ident" id="5860221">flags</span>&nbsp;<span class="op" id="5860227">|=</span>&nbsp;<span class="ident" id="5860230">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860243">case</span>&nbsp;<span class="string" id="5860248">&#34;comment&#34;</span><span class="op" id="5860257">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860263">finfo</span><span class="op" id="5860268">.</span><span class="ident" id="5860269">flags</span>&nbsp;<span class="op" id="5860275">|=</span>&nbsp;<span class="ident" id="5860278">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860290">case</span>&nbsp;<span class="string" id="5860295">&#34;any&#34;</span><span class="op" id="5860300">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860306">finfo</span><span class="op" id="5860311">.</span><span class="ident" id="5860312">flags</span>&nbsp;<span class="op" id="5860318">|=</span>&nbsp;<span class="ident" id="5860321">fAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860329">case</span>&nbsp;<span class="string" id="5860334">&#34;omitempty&#34;</span><span class="op" id="5860345">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860351">finfo</span><span class="op" id="5860356">.</span><span class="ident" id="5860357">flags</span>&nbsp;<span class="op" id="5860363">|=</span>&nbsp;<span class="ident" id="5860366">fOmitEmpty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5860380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5860384">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5860389">//&nbsp;Validate&nbsp;the&nbsp;flags&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860419">valid</span>&nbsp;<span class="op" id="5860425">:=</span>&nbsp;<span class="builtintype" id="5860428">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860435">switch</span>&nbsp;<span class="ident" id="5860442">mode</span>&nbsp;<span class="op" id="5860447">:=</span>&nbsp;<span class="ident" id="5860450">finfo</span><span class="op" id="5860455">.</span><span class="ident" id="5860456">flags</span>&nbsp;<span class="op" id="5860462">&amp;</span>&nbsp;<span class="ident" id="5860464">fMode</span><span class="op" id="5860469">;</span>&nbsp;<span class="ident" id="5860471">mode</span>&nbsp;<span class="op" id="5860476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860480">case</span>&nbsp;<span class="num" id="5860485">0</span><span class="op" id="5860486">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860491">finfo</span><span class="op" id="5860496">.</span><span class="ident" id="5860497">flags</span>&nbsp;<span class="op" id="5860503">|=</span>&nbsp;<span class="ident" id="5860506">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860517">case</span>&nbsp;<span class="ident" id="5860522">fAttr</span><span class="op" id="5860527">,</span>&nbsp;<span class="ident" id="5860529">fCharData</span><span class="op" id="5860538">,</span>&nbsp;<span class="ident" id="5860540">fInnerXml</span><span class="op" id="5860549">,</span>&nbsp;<span class="ident" id="5860551">fComment</span><span class="op" id="5860559">,</span>&nbsp;<span class="ident" id="5860561">fAny</span><span class="op" id="5860565">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860570">if</span>&nbsp;<span class="ident" id="5860573">f</span><span class="op" id="5860574">.</span><span class="ident" id="5860575">Name</span>&nbsp;<span class="op" id="5860580">==</span>&nbsp;<span class="string" id="5860583">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5860593">||</span>&nbsp;<span class="ident" id="5860596">tag</span>&nbsp;<span class="op" id="5860600">!=</span>&nbsp;<span class="string" id="5860603">&#34;&#34;</span>&nbsp;<span class="op" id="5860606">&amp;&amp;</span>&nbsp;<span class="ident" id="5860609">mode</span>&nbsp;<span class="op" id="5860614">!=</span>&nbsp;<span class="ident" id="5860617">fAttr</span>&nbsp;<span class="op" id="5860623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860629">valid</span>&nbsp;<span class="op" id="5860635">=</span>&nbsp;<span class="builtintype" id="5860637">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5860646">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860650">default</span><span class="op" id="5860657">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5860662">//&nbsp;This&nbsp;will&nbsp;also&nbsp;catch&nbsp;multiple&nbsp;modes&nbsp;in&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860723">valid</span>&nbsp;<span class="op" id="5860729">=</span>&nbsp;<span class="builtintype" id="5860731">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5860739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860743">if</span>&nbsp;<span class="ident" id="5860746">finfo</span><span class="op" id="5860751">.</span><span class="ident" id="5860752">flags</span><span class="op" id="5860757">&amp;</span><span class="ident" id="5860758">fMode</span>&nbsp;<span class="op" id="5860764">==</span>&nbsp;<span class="ident" id="5860767">fAny</span>&nbsp;<span class="op" id="5860772">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860777">finfo</span><span class="op" id="5860782">.</span><span class="ident" id="5860783">flags</span>&nbsp;<span class="op" id="5860789">|=</span>&nbsp;<span class="ident" id="5860792">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5860803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860807">if</span>&nbsp;<span class="ident" id="5860810">finfo</span><span class="op" id="5860815">.</span><span class="ident" id="5860816">flags</span><span class="op" id="5860821">&amp;</span><span class="ident" id="5860822">fOmitEmpty</span>&nbsp;<span class="op" id="5860833">!=</span>&nbsp;<span class="num" id="5860836">0</span>&nbsp;<span class="op" id="5860838">&amp;&amp;</span>&nbsp;<span class="ident" id="5860841">finfo</span><span class="op" id="5860846">.</span><span class="ident" id="5860847">flags</span><span class="op" id="5860852">&amp;</span><span class="op" id="5860853">(</span><span class="ident" id="5860854">fElement</span><span class="op" id="5860862">|</span><span class="ident" id="5860863">fAttr</span><span class="op" id="5860868">)</span>&nbsp;<span class="op" id="5860870">==</span>&nbsp;<span class="num" id="5860873">0</span>&nbsp;<span class="op" id="5860875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860880">valid</span>&nbsp;<span class="op" id="5860886">=</span>&nbsp;<span class="builtintype" id="5860888">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5860896">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860900">if</span>&nbsp;<span class="op" id="5860903">!</span><span class="ident" id="5860904">valid</span>&nbsp;<span class="op" id="5860910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860915">return</span>&nbsp;<span class="ident" id="5860922">nil</span><span class="op" id="5860925">,</span>&nbsp;<span class="ident" id="5860927">fmt</span><span class="op" id="5860930">.</span><span class="ident" id="5860931">Errorf</span><span class="op" id="5860937">(</span><span class="string" id="5860938">&#34;xml:&nbsp;invalid&nbsp;tag&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="5860983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860989">f</span><span class="op" id="5860990">.</span><span class="ident" id="5860991">Name</span><span class="op" id="5860995">,</span>&nbsp;<span class="ident" id="5860997">typ</span><span class="op" id="5861000">,</span>&nbsp;<span class="ident" id="5861002">f</span><span class="op" id="5861003">.</span><span class="ident" id="5861004">Tag</span><span class="op" id="5861007">.</span><span class="ident" id="5861008">Get</span><span class="op" id="5861011">(</span><span class="string" id="5861012">&#34;xml&#34;</span><span class="op" id="5861017">)</span><span class="op" id="5861018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5861022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5861025">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5861029">//&nbsp;Use&nbsp;of&nbsp;xmlns&nbsp;without&nbsp;a&nbsp;name&nbsp;is&nbsp;not&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5861077">if</span>&nbsp;<span class="ident" id="5861080">finfo</span><span class="op" id="5861085">.</span><span class="ident" id="5861086">xmlns</span>&nbsp;<span class="op" id="5861092">!=</span>&nbsp;<span class="string" id="5861095">&#34;&#34;</span>&nbsp;<span class="op" id="5861098">&amp;&amp;</span>&nbsp;<span class="ident" id="5861101">tag</span>&nbsp;<span class="op" id="5861105">==</span>&nbsp;<span class="string" id="5861108">&#34;&#34;</span>&nbsp;<span class="op" id="5861111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5861115">return</span>&nbsp;<span class="ident" id="5861122">nil</span><span class="op" id="5861125">,</span>&nbsp;<span class="ident" id="5861127">fmt</span><span class="op" id="5861130">.</span><span class="ident" id="5861131">Errorf</span><span class="op" id="5861137">(</span><span class="string" id="5861138">&#34;xml:&nbsp;namespace&nbsp;without&nbsp;name&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="5861194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5861199">f</span><span class="op" id="5861200">.</span><span class="ident" id="5861201">Name</span><span class="op" id="5861205">,</span>&nbsp;<span class="ident" id="5861207">typ</span><span class="op" id="5861210">,</span>&nbsp;<span class="ident" id="5861212">f</span><span class="op" id="5861213">.</span><span class="ident" id="5861214">Tag</span><span class="op" id="5861217">.</span><span class="ident" id="5861218">Get</span><span class="op" id="5861221">(</span><span class="string" id="5861222">&#34;xml&#34;</span><span class="op" id="5861227">)</span><span class="op" id="5861228">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5861231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5861235">if</span>&nbsp;<span class="ident" id="5861238">f</span><span class="op" id="5861239">.</span><span class="ident" id="5861240">Name</span>&nbsp;<span class="op" id="5861245">==</span>&nbsp;<span class="string" id="5861248">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5861258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5861262">//&nbsp;The&nbsp;XMLName&nbsp;field&nbsp;records&nbsp;the&nbsp;XML&nbsp;element&nbsp;name.&nbsp;Don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5861321">//&nbsp;process&nbsp;it&nbsp;as&nbsp;usual&nbsp;because&nbsp;its&nbsp;name&nbsp;should&nbsp;default&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5861381">//&nbsp;empty&nbsp;rather&nbsp;than&nbsp;to&nbsp;the&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5861423">finfo</span><span class="op" id="5861428">.</span><span class="ident" id="5861429">name</span>&nbsp;<span class="op" id="5861434">=</span>&nbsp;<span class="ident" id="5861436">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5861442">return</span>&nbsp;<span class="ident" id="5861449">finfo</span><span class="op" id="5861454">,</span>&nbsp;<span class="ident" id="5861456">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5861461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5861465">if</span>&nbsp;<span class="ident" id="5861468">tag</span>&nbsp;<span class="op" id="5861472">==</span>&nbsp;<span class="string" id="5861475">&#34;&#34;</span>&nbsp;<span class="op" id="5861478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5861482">//&nbsp;If&nbsp;the&nbsp;name&nbsp;part&nbsp;of&nbsp;the&nbsp;tag&nbsp;is&nbsp;completely&nbsp;empty,&nbsp;get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5861540">//&nbsp;default&nbsp;from&nbsp;XMLName&nbsp;of&nbsp;underlying&nbsp;struct&nbsp;if&nbsp;feasible,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5861600">//&nbsp;or&nbsp;field&nbsp;name&nbsp;otherwise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5861630">if</span>&nbsp;<span class="ident" id="5861633">xmlname</span>&nbsp;<span class="op" id="5861641">:=</span>&nbsp;<span class="ident" id="5861644">lookupXMLName</span><span class="op" id="5861657">(</span><span class="ident" id="5861658">f</span><span class="op" id="5861659">.</span><span class="ident" id="5861660">Type</span><span class="op" id="5861664">)</span><span class="op" id="5861665">;</span>&nbsp;<span class="ident" id="5861667">xmlname</span>&nbsp;<span class="op" id="5861675">!=</span>&nbsp;<span class="ident" id="5861678">nil</span>&nbsp;<span class="op" id="5861682">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5861687">finfo</span><span class="op" id="5861692">.</span><span class="ident" id="5861693">xmlns</span><span class="op" id="5861698">,</span>&nbsp;<span class="ident" id="5861700">finfo</span><span class="op" id="5861705">.</span><span class="ident" id="5861706">name</span>&nbsp;<span class="op" id="5861711">=</span>&nbsp;<span class="ident" id="5861713">xmlname</span><span class="op" id="5861720">.</span><span class="ident" id="5861721">xmlns</span><span class="op" id="5861726">,</span>&nbsp;<span class="ident" id="5861728">xmlname</span><span class="op" id="5861735">.</span><span class="ident" id="5861736">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5861743">}</span>&nbsp;<span class="keyword" id="5861745">else</span>&nbsp;<span class="op" id="5861750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5861755">finfo</span><span class="op" id="5861760">.</span><span class="ident" id="5861761">name</span>&nbsp;<span class="op" id="5861766">=</span>&nbsp;<span class="ident" id="5861768">f</span><span class="op" id="5861769">.</span><span class="ident" id="5861770">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5861777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5861781">return</span>&nbsp;<span class="ident" id="5861788">finfo</span><span class="op" id="5861793">,</span>&nbsp;<span class="ident" id="5861795">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5861800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5861804">//&nbsp;Prepare&nbsp;field&nbsp;name&nbsp;and&nbsp;parents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5861840">parents</span>&nbsp;<span class="op" id="5861848">:=</span>&nbsp;<span class="ident" id="5861851">strings</span><span class="op" id="5861858">.</span><span class="ident" id="5861859">Split</span><span class="op" id="5861864">(</span><span class="ident" id="5861865">tag</span><span class="op" id="5861868">,</span>&nbsp;<span class="string" id="5861870">&#34;&gt;&#34;</span><span class="op" id="5861873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5861876">if</span>&nbsp;<span class="ident" id="5861879">parents</span><span class="op" id="5861886">[</span><span class="num" id="5861887">0</span><span class="op" id="5861888">]</span>&nbsp;<span class="op" id="5861890">==</span>&nbsp;<span class="string" id="5861893">&#34;&#34;</span>&nbsp;<span class="op" id="5861896">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5861900">parents</span><span class="op" id="5861907">[</span><span class="num" id="5861908">0</span><span class="op" id="5861909">]</span>&nbsp;<span class="op" id="5861911">=</span>&nbsp;<span class="ident" id="5861913">f</span><span class="op" id="5861914">.</span><span class="ident" id="5861915">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5861921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5861924">if</span>&nbsp;<span class="ident" id="5861927">parents</span><span class="op" id="5861934">[</span><span class="builtinfunc" id="5861935">len</span><span class="op" id="5861938">(</span><span class="ident" id="5861939">parents</span><span class="op" id="5861946">)</span><span class="op" id="5861947">-</span><span class="num" id="5861948">1</span><span class="op" id="5861949">]</span>&nbsp;<span class="op" id="5861951">==</span>&nbsp;<span class="string" id="5861954">&#34;&#34;</span>&nbsp;<span class="op" id="5861957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5861961">return</span>&nbsp;<span class="ident" id="5861968">nil</span><span class="op" id="5861971">,</span>&nbsp;<span class="ident" id="5861973">fmt</span><span class="op" id="5861976">.</span><span class="ident" id="5861977">Errorf</span><span class="op" id="5861983">(</span><span class="string" id="5861984">&#34;xml:&nbsp;trailing&nbsp;&#39;&gt;&#39;&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5862026">,</span>&nbsp;<span class="ident" id="5862028">f</span><span class="op" id="5862029">.</span><span class="ident" id="5862030">Name</span><span class="op" id="5862034">,</span>&nbsp;<span class="ident" id="5862036">typ</span><span class="op" id="5862039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5862042">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5862045">finfo</span><span class="op" id="5862050">.</span><span class="ident" id="5862051">name</span>&nbsp;<span class="op" id="5862056">=</span>&nbsp;<span class="ident" id="5862058">parents</span><span class="op" id="5862065">[</span><span class="builtinfunc" id="5862066">len</span><span class="op" id="5862069">(</span><span class="ident" id="5862070">parents</span><span class="op" id="5862077">)</span><span class="op" id="5862078">-</span><span class="num" id="5862079">1</span><span class="op" id="5862080">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862083">if</span>&nbsp;<span class="builtinfunc" id="5862086">len</span><span class="op" id="5862089">(</span><span class="ident" id="5862090">parents</span><span class="op" id="5862097">)</span>&nbsp;<span class="op" id="5862099">&gt;</span>&nbsp;<span class="num" id="5862101">1</span>&nbsp;<span class="op" id="5862103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862107">if</span>&nbsp;<span class="op" id="5862110">(</span><span class="ident" id="5862111">finfo</span><span class="op" id="5862116">.</span><span class="ident" id="5862117">flags</span>&nbsp;<span class="op" id="5862123">&amp;</span>&nbsp;<span class="ident" id="5862125">fElement</span><span class="op" id="5862133">)</span>&nbsp;<span class="op" id="5862135">==</span>&nbsp;<span class="num" id="5862138">0</span>&nbsp;<span class="op" id="5862140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862145">return</span>&nbsp;<span class="ident" id="5862152">nil</span><span class="op" id="5862155">,</span>&nbsp;<span class="ident" id="5862157">fmt</span><span class="op" id="5862160">.</span><span class="ident" id="5862161">Errorf</span><span class="op" id="5862167">(</span><span class="string" id="5862168">&#34;xml:&nbsp;%s&nbsp;chain&nbsp;not&nbsp;valid&nbsp;with&nbsp;%s&nbsp;flag&#34;</span><span class="op" id="5862206">,</span>&nbsp;<span class="ident" id="5862208">tag</span><span class="op" id="5862211">,</span>&nbsp;<span class="ident" id="5862213">strings</span><span class="op" id="5862220">.</span><span class="ident" id="5862221">Join</span><span class="op" id="5862225">(</span><span class="ident" id="5862226">tokens</span><span class="op" id="5862232">[</span><span class="num" id="5862233">1</span><span class="op" id="5862234">:</span><span class="op" id="5862235">]</span><span class="op" id="5862236">,</span>&nbsp;<span class="string" id="5862238">&#34;,&#34;</span><span class="op" id="5862241">)</span><span class="op" id="5862242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5862246">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5862250">finfo</span><span class="op" id="5862255">.</span><span class="ident" id="5862256">parents</span>&nbsp;<span class="op" id="5862264">=</span>&nbsp;<span class="ident" id="5862266">parents</span><span class="op" id="5862273">[</span><span class="op" id="5862274">:</span><span class="builtinfunc" id="5862275">len</span><span class="op" id="5862278">(</span><span class="ident" id="5862279">parents</span><span class="op" id="5862286">)</span><span class="op" id="5862287">-</span><span class="num" id="5862288">1</span><span class="op" id="5862289">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5862292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5862296">//&nbsp;If&nbsp;the&nbsp;field&nbsp;type&nbsp;has&nbsp;an&nbsp;XMLName&nbsp;field,&nbsp;the&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5862361">//&nbsp;so&nbsp;that&nbsp;the&nbsp;behavior&nbsp;of&nbsp;both&nbsp;marshalling&nbsp;and&nbsp;unmarshalling</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5862424">//&nbsp;is&nbsp;straightforward&nbsp;and&nbsp;unambiguous.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862464">if</span>&nbsp;<span class="ident" id="5862467">finfo</span><span class="op" id="5862472">.</span><span class="ident" id="5862473">flags</span><span class="op" id="5862478">&amp;</span><span class="ident" id="5862479">fElement</span>&nbsp;<span class="op" id="5862488">!=</span>&nbsp;<span class="num" id="5862491">0</span>&nbsp;<span class="op" id="5862493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5862497">ftyp</span>&nbsp;<span class="op" id="5862502">:=</span>&nbsp;<span class="ident" id="5862505">f</span><span class="op" id="5862506">.</span><span class="ident" id="5862507">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5862514">xmlname</span>&nbsp;<span class="op" id="5862522">:=</span>&nbsp;<span class="ident" id="5862525">lookupXMLName</span><span class="op" id="5862538">(</span><span class="ident" id="5862539">ftyp</span><span class="op" id="5862543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862547">if</span>&nbsp;<span class="ident" id="5862550">xmlname</span>&nbsp;<span class="op" id="5862558">!=</span>&nbsp;<span class="ident" id="5862561">nil</span>&nbsp;<span class="op" id="5862565">&amp;&amp;</span>&nbsp;<span class="ident" id="5862568">xmlname</span><span class="op" id="5862575">.</span><span class="ident" id="5862576">name</span>&nbsp;<span class="op" id="5862581">!=</span>&nbsp;<span class="ident" id="5862584">finfo</span><span class="op" id="5862589">.</span><span class="ident" id="5862590">name</span>&nbsp;<span class="op" id="5862595">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862600">return</span>&nbsp;<span class="ident" id="5862607">nil</span><span class="op" id="5862610">,</span>&nbsp;<span class="ident" id="5862612">fmt</span><span class="op" id="5862615">.</span><span class="ident" id="5862616">Errorf</span><span class="op" id="5862622">(</span><span class="string" id="5862623">&#34;xml:&nbsp;name&nbsp;%q&nbsp;in&nbsp;tag&nbsp;of&nbsp;%s.%s&nbsp;conflicts&nbsp;with&nbsp;name&nbsp;%q&nbsp;in&nbsp;%s.XMLName&#34;</span><span class="op" id="5862690">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5862696">finfo</span><span class="op" id="5862701">.</span><span class="ident" id="5862702">name</span><span class="op" id="5862706">,</span>&nbsp;<span class="ident" id="5862708">typ</span><span class="op" id="5862711">,</span>&nbsp;<span class="ident" id="5862713">f</span><span class="op" id="5862714">.</span><span class="ident" id="5862715">Name</span><span class="op" id="5862719">,</span>&nbsp;<span class="ident" id="5862721">xmlname</span><span class="op" id="5862728">.</span><span class="ident" id="5862729">name</span><span class="op" id="5862733">,</span>&nbsp;<span class="ident" id="5862735">ftyp</span><span class="op" id="5862739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5862743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5862746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862749">return</span>&nbsp;<span class="ident" id="5862756">finfo</span><span class="op" id="5862761">,</span>&nbsp;<span class="ident" id="5862763">nil</span><br>
<span class="lineno">225</span><span class="op" id="5862767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5862770">//&nbsp;lookupXMLName&nbsp;returns&nbsp;the&nbsp;fieldInfo&nbsp;for&nbsp;typ&#39;s&nbsp;XMLName&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5862833">//&nbsp;in&nbsp;case&nbsp;it&nbsp;exists&nbsp;and&nbsp;has&nbsp;a&nbsp;valid&nbsp;xml&nbsp;field&nbsp;tag,&nbsp;otherwise</span><br>
<span class="lineno"></span><span class="comment" id="5862895">//&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">230</span><span class="keyword" id="5862914">func</span>&nbsp;<span class="ident" id="5862919">lookupXMLName</span><span class="op" id="5862932">(</span><span class="ident" id="5862933">typ</span>&nbsp;<span class="ident" id="5862937">reflect</span><span class="op" id="5862944">.</span><span class="ident" id="5862945">Type</span><span class="op" id="5862949">)</span>&nbsp;<span class="op" id="5862951">(</span><span class="ident" id="5862952">xmlname</span>&nbsp;<span class="op" id="5862960">*</span><span class="ident" id="5862961">fieldInfo</span><span class="op" id="5862970">)</span>&nbsp;<span class="op" id="5862972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862975">for</span>&nbsp;<span class="ident" id="5862979">typ</span><span class="op" id="5862982">.</span><span class="ident" id="5862983">Kind</span><span class="op" id="5862987">(</span><span class="op" id="5862988">)</span>&nbsp;<span class="op" id="5862990">==</span>&nbsp;<span class="ident" id="5862993">reflect</span><span class="op" id="5863000">.</span><span class="ident" id="5863001">Ptr</span>&nbsp;<span class="op" id="5863005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5863009">typ</span>&nbsp;<span class="op" id="5863013">=</span>&nbsp;<span class="ident" id="5863015">typ</span><span class="op" id="5863018">.</span><span class="ident" id="5863019">Elem</span><span class="op" id="5863023">(</span><span class="op" id="5863024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5863027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863030">if</span>&nbsp;<span class="ident" id="5863033">typ</span><span class="op" id="5863036">.</span><span class="ident" id="5863037">Kind</span><span class="op" id="5863041">(</span><span class="op" id="5863042">)</span>&nbsp;<span class="op" id="5863044">!=</span>&nbsp;<span class="ident" id="5863047">reflect</span><span class="op" id="5863054">.</span><span class="ident" id="5863055">Struct</span>&nbsp;<span class="op" id="5863062">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863066">return</span>&nbsp;<span class="ident" id="5863073">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5863078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863081">for</span>&nbsp;<span class="ident" id="5863085">i</span><span class="op" id="5863086">,</span>&nbsp;<span class="ident" id="5863088">n</span>&nbsp;<span class="op" id="5863090">:=</span>&nbsp;<span class="num" id="5863093">0</span><span class="op" id="5863094">,</span>&nbsp;<span class="ident" id="5863096">typ</span><span class="op" id="5863099">.</span><span class="ident" id="5863100">NumField</span><span class="op" id="5863108">(</span><span class="op" id="5863109">)</span><span class="op" id="5863110">;</span>&nbsp;<span class="ident" id="5863112">i</span>&nbsp;<span class="op" id="5863114">&lt;</span>&nbsp;<span class="ident" id="5863116">n</span><span class="op" id="5863117">;</span>&nbsp;<span class="ident" id="5863119">i</span><span class="op" id="5863120">++</span>&nbsp;<span class="op" id="5863123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5863127">f</span>&nbsp;<span class="op" id="5863129">:=</span>&nbsp;<span class="ident" id="5863132">typ</span><span class="op" id="5863135">.</span><span class="ident" id="5863136">Field</span><span class="op" id="5863141">(</span><span class="ident" id="5863142">i</span><span class="op" id="5863143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863147">if</span>&nbsp;<span class="ident" id="5863150">f</span><span class="op" id="5863151">.</span><span class="ident" id="5863152">Name</span>&nbsp;<span class="op" id="5863157">!=</span>&nbsp;<span class="string" id="5863160">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5863170">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863175">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5863186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5863190">finfo</span><span class="op" id="5863195">,</span>&nbsp;<span class="ident" id="5863197">err</span>&nbsp;<span class="op" id="5863201">:=</span>&nbsp;<span class="ident" id="5863204">structFieldInfo</span><span class="op" id="5863219">(</span><span class="ident" id="5863220">typ</span><span class="op" id="5863223">,</span>&nbsp;<span class="op" id="5863225">&amp;</span><span class="ident" id="5863226">f</span><span class="op" id="5863227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863231">if</span>&nbsp;<span class="ident" id="5863234">finfo</span><span class="op" id="5863239">.</span><span class="ident" id="5863240">name</span>&nbsp;<span class="op" id="5863245">!=</span>&nbsp;<span class="string" id="5863248">&#34;&#34;</span>&nbsp;<span class="op" id="5863251">&amp;&amp;</span>&nbsp;<span class="ident" id="5863254">err</span>&nbsp;<span class="op" id="5863258">==</span>&nbsp;<span class="ident" id="5863261">nil</span>&nbsp;<span class="op" id="5863265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863270">return</span>&nbsp;<span class="ident" id="5863277">finfo</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5863285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5863289">//&nbsp;Also&nbsp;consider&nbsp;errors&nbsp;as&nbsp;a&nbsp;non-existent&nbsp;field&nbsp;tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5863343">//&nbsp;and&nbsp;let&nbsp;getTypeInfo&nbsp;itself&nbsp;report&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863393">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5863400">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863403">return</span>&nbsp;<span class="ident" id="5863410">nil</span><br>
<span class="lineno"></span><span class="op" id="5863414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5863417">func</span>&nbsp;<span class="ident" id="5863422">min</span><span class="op" id="5863425">(</span><span class="ident" id="5863426">a</span><span class="op" id="5863427">,</span>&nbsp;<span class="ident" id="5863429">b</span>&nbsp;<span class="builtintype" id="5863431">int</span><span class="op" id="5863434">)</span>&nbsp;<span class="builtintype" id="5863436">int</span>&nbsp;<span class="op" id="5863440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863443">if</span>&nbsp;<span class="ident" id="5863446">a</span>&nbsp;<span class="op" id="5863448">&lt;=</span>&nbsp;<span class="ident" id="5863451">b</span>&nbsp;<span class="op" id="5863453">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863457">return</span>&nbsp;<span class="ident" id="5863464">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5863467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863470">return</span>&nbsp;<span class="ident" id="5863477">b</span><br>
<span class="lineno"></span><span class="op" id="5863479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="5863482">//&nbsp;addFieldInfo&nbsp;adds&nbsp;finfo&nbsp;to&nbsp;tinfo.fields&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5863541">//&nbsp;conflicts,&nbsp;or&nbsp;if&nbsp;conflicts&nbsp;arise&nbsp;from&nbsp;previous&nbsp;fields&nbsp;that&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="5863608">//&nbsp;obtained&nbsp;from&nbsp;deeper&nbsp;embedded&nbsp;structures&nbsp;than&nbsp;finfo.&nbsp;In&nbsp;the&nbsp;latter</span><br>
<span class="lineno"></span><span class="comment" id="5863678">//&nbsp;case,&nbsp;the&nbsp;conflicting&nbsp;entries&nbsp;are&nbsp;dropped.</span><br>
<span class="lineno"></span><span class="comment" id="5863724">//&nbsp;A&nbsp;conflict&nbsp;occurs&nbsp;when&nbsp;the&nbsp;path&nbsp;(parent&nbsp;+&nbsp;name)&nbsp;to&nbsp;a&nbsp;field&nbsp;is</span><br>
<span class="lineno">265</span><span class="comment" id="5863789">//&nbsp;itself&nbsp;a&nbsp;prefix&nbsp;of&nbsp;another&nbsp;path,&nbsp;or&nbsp;when&nbsp;two&nbsp;paths&nbsp;match&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="comment" id="5863858">//&nbsp;It&nbsp;is&nbsp;okay&nbsp;for&nbsp;field&nbsp;paths&nbsp;to&nbsp;share&nbsp;a&nbsp;common,&nbsp;shorter&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="5863923">func</span>&nbsp;<span class="ident" id="5863928">addFieldInfo</span><span class="op" id="5863940">(</span><span class="ident" id="5863941">typ</span>&nbsp;<span class="ident" id="5863945">reflect</span><span class="op" id="5863952">.</span><span class="ident" id="5863953">Type</span><span class="op" id="5863957">,</span>&nbsp;<span class="ident" id="5863959">tinfo</span>&nbsp;<span class="op" id="5863965">*</span><span class="ident" id="5863966">typeInfo</span><span class="op" id="5863974">,</span>&nbsp;<span class="ident" id="5863976">newf</span>&nbsp;<span class="op" id="5863981">*</span><span class="ident" id="5863982">fieldInfo</span><span class="op" id="5863991">)</span>&nbsp;<span class="builtintype" id="5863993">error</span>&nbsp;<span class="op" id="5863999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864002">var</span>&nbsp;<span class="ident" id="5864006">conflicts</span>&nbsp;<span class="op" id="5864016">[</span><span class="op" id="5864017">]</span><span class="builtintype" id="5864018">int</span><br>
<span class="lineno"></span><span class="ident" id="5864022">Loop</span><span class="op" id="5864026">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5864029">//&nbsp;First,&nbsp;figure&nbsp;all&nbsp;conflicts.&nbsp;Most&nbsp;working&nbsp;code&nbsp;will&nbsp;have&nbsp;none.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864096">for</span>&nbsp;<span class="ident" id="5864100">i</span>&nbsp;<span class="op" id="5864102">:=</span>&nbsp;<span class="keyword" id="5864105">range</span>&nbsp;<span class="ident" id="5864111">tinfo</span><span class="op" id="5864116">.</span><span class="ident" id="5864117">fields</span>&nbsp;<span class="op" id="5864124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5864128">oldf</span>&nbsp;<span class="op" id="5864133">:=</span>&nbsp;<span class="op" id="5864136">&amp;</span><span class="ident" id="5864137">tinfo</span><span class="op" id="5864142">.</span><span class="ident" id="5864143">fields</span><span class="op" id="5864149">[</span><span class="ident" id="5864150">i</span><span class="op" id="5864151">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864155">if</span>&nbsp;<span class="ident" id="5864158">oldf</span><span class="op" id="5864162">.</span><span class="ident" id="5864163">flags</span><span class="op" id="5864168">&amp;</span><span class="ident" id="5864169">fMode</span>&nbsp;<span class="op" id="5864175">!=</span>&nbsp;<span class="ident" id="5864178">newf</span><span class="op" id="5864182">.</span><span class="ident" id="5864183">flags</span><span class="op" id="5864188">&amp;</span><span class="ident" id="5864189">fMode</span>&nbsp;<span class="op" id="5864195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864200">continue</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5864211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864215">if</span>&nbsp;<span class="ident" id="5864218">oldf</span><span class="op" id="5864222">.</span><span class="ident" id="5864223">xmlns</span>&nbsp;<span class="op" id="5864229">!=</span>&nbsp;<span class="string" id="5864232">&#34;&#34;</span>&nbsp;<span class="op" id="5864235">&amp;&amp;</span>&nbsp;<span class="ident" id="5864238">newf</span><span class="op" id="5864242">.</span><span class="ident" id="5864243">xmlns</span>&nbsp;<span class="op" id="5864249">!=</span>&nbsp;<span class="string" id="5864252">&#34;&#34;</span>&nbsp;<span class="op" id="5864255">&amp;&amp;</span>&nbsp;<span class="ident" id="5864258">oldf</span><span class="op" id="5864262">.</span><span class="ident" id="5864263">xmlns</span>&nbsp;<span class="op" id="5864269">!=</span>&nbsp;<span class="ident" id="5864272">newf</span><span class="op" id="5864276">.</span><span class="ident" id="5864277">xmlns</span>&nbsp;<span class="op" id="5864283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864288">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5864299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5864303">minl</span>&nbsp;<span class="op" id="5864308">:=</span>&nbsp;<span class="ident" id="5864311">min</span><span class="op" id="5864314">(</span><span class="builtinfunc" id="5864315">len</span><span class="op" id="5864318">(</span><span class="ident" id="5864319">newf</span><span class="op" id="5864323">.</span><span class="ident" id="5864324">parents</span><span class="op" id="5864331">)</span><span class="op" id="5864332">,</span>&nbsp;<span class="builtinfunc" id="5864334">len</span><span class="op" id="5864337">(</span><span class="ident" id="5864338">oldf</span><span class="op" id="5864342">.</span><span class="ident" id="5864343">parents</span><span class="op" id="5864350">)</span><span class="op" id="5864351">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864355">for</span>&nbsp;<span class="ident" id="5864359">p</span>&nbsp;<span class="op" id="5864361">:=</span>&nbsp;<span class="num" id="5864364">0</span><span class="op" id="5864365">;</span>&nbsp;<span class="ident" id="5864367">p</span>&nbsp;<span class="op" id="5864369">&lt;</span>&nbsp;<span class="ident" id="5864371">minl</span><span class="op" id="5864375">;</span>&nbsp;<span class="ident" id="5864377">p</span><span class="op" id="5864378">++</span>&nbsp;<span class="op" id="5864381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864386">if</span>&nbsp;<span class="ident" id="5864389">oldf</span><span class="op" id="5864393">.</span><span class="ident" id="5864394">parents</span><span class="op" id="5864401">[</span><span class="ident" id="5864402">p</span><span class="op" id="5864403">]</span>&nbsp;<span class="op" id="5864405">!=</span>&nbsp;<span class="ident" id="5864408">newf</span><span class="op" id="5864412">.</span><span class="ident" id="5864413">parents</span><span class="op" id="5864420">[</span><span class="ident" id="5864421">p</span><span class="op" id="5864422">]</span>&nbsp;<span class="op" id="5864424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864430">continue</span>&nbsp;<span class="ident" id="5864439">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5864447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5864451">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864455">if</span>&nbsp;<span class="builtinfunc" id="5864458">len</span><span class="op" id="5864461">(</span><span class="ident" id="5864462">oldf</span><span class="op" id="5864466">.</span><span class="ident" id="5864467">parents</span><span class="op" id="5864474">)</span>&nbsp;<span class="op" id="5864476">&gt;</span>&nbsp;<span class="builtinfunc" id="5864478">len</span><span class="op" id="5864481">(</span><span class="ident" id="5864482">newf</span><span class="op" id="5864486">.</span><span class="ident" id="5864487">parents</span><span class="op" id="5864494">)</span>&nbsp;<span class="op" id="5864496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864501">if</span>&nbsp;<span class="ident" id="5864504">oldf</span><span class="op" id="5864508">.</span><span class="ident" id="5864509">parents</span><span class="op" id="5864516">[</span><span class="builtinfunc" id="5864517">len</span><span class="op" id="5864520">(</span><span class="ident" id="5864521">newf</span><span class="op" id="5864525">.</span><span class="ident" id="5864526">parents</span><span class="op" id="5864533">)</span><span class="op" id="5864534">]</span>&nbsp;<span class="op" id="5864536">==</span>&nbsp;<span class="ident" id="5864539">newf</span><span class="op" id="5864543">.</span><span class="ident" id="5864544">name</span>&nbsp;<span class="op" id="5864549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5864555">conflicts</span>&nbsp;<span class="op" id="5864565">=</span>&nbsp;<span class="builtinfunc" id="5864567">append</span><span class="op" id="5864573">(</span><span class="ident" id="5864574">conflicts</span><span class="op" id="5864583">,</span>&nbsp;<span class="ident" id="5864585">i</span><span class="op" id="5864586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5864591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5864595">}</span>&nbsp;<span class="keyword" id="5864597">else</span>&nbsp;<span class="keyword" id="5864602">if</span>&nbsp;<span class="builtinfunc" id="5864605">len</span><span class="op" id="5864608">(</span><span class="ident" id="5864609">oldf</span><span class="op" id="5864613">.</span><span class="ident" id="5864614">parents</span><span class="op" id="5864621">)</span>&nbsp;<span class="op" id="5864623">&lt;</span>&nbsp;<span class="builtinfunc" id="5864625">len</span><span class="op" id="5864628">(</span><span class="ident" id="5864629">newf</span><span class="op" id="5864633">.</span><span class="ident" id="5864634">parents</span><span class="op" id="5864641">)</span>&nbsp;<span class="op" id="5864643">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864648">if</span>&nbsp;<span class="ident" id="5864651">newf</span><span class="op" id="5864655">.</span><span class="ident" id="5864656">parents</span><span class="op" id="5864663">[</span><span class="builtinfunc" id="5864664">len</span><span class="op" id="5864667">(</span><span class="ident" id="5864668">oldf</span><span class="op" id="5864672">.</span><span class="ident" id="5864673">parents</span><span class="op" id="5864680">)</span><span class="op" id="5864681">]</span>&nbsp;<span class="op" id="5864683">==</span>&nbsp;<span class="ident" id="5864686">oldf</span><span class="op" id="5864690">.</span><span class="ident" id="5864691">name</span>&nbsp;<span class="op" id="5864696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5864702">conflicts</span>&nbsp;<span class="op" id="5864712">=</span>&nbsp;<span class="builtinfunc" id="5864714">append</span><span class="op" id="5864720">(</span><span class="ident" id="5864721">conflicts</span><span class="op" id="5864730">,</span>&nbsp;<span class="ident" id="5864732">i</span><span class="op" id="5864733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5864738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5864742">}</span>&nbsp;<span class="keyword" id="5864744">else</span>&nbsp;<span class="op" id="5864749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864754">if</span>&nbsp;<span class="ident" id="5864757">newf</span><span class="op" id="5864761">.</span><span class="ident" id="5864762">name</span>&nbsp;<span class="op" id="5864767">==</span>&nbsp;<span class="ident" id="5864770">oldf</span><span class="op" id="5864774">.</span><span class="ident" id="5864775">name</span>&nbsp;<span class="op" id="5864780">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5864786">conflicts</span>&nbsp;<span class="op" id="5864796">=</span>&nbsp;<span class="builtinfunc" id="5864798">append</span><span class="op" id="5864804">(</span><span class="ident" id="5864805">conflicts</span><span class="op" id="5864814">,</span>&nbsp;<span class="ident" id="5864816">i</span><span class="op" id="5864817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5864822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5864826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5864829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5864832">//&nbsp;Without&nbsp;conflicts,&nbsp;add&nbsp;the&nbsp;new&nbsp;field&nbsp;and&nbsp;return.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864885">if</span>&nbsp;<span class="ident" id="5864888">conflicts</span>&nbsp;<span class="op" id="5864898">==</span>&nbsp;<span class="ident" id="5864901">nil</span>&nbsp;<span class="op" id="5864905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5864909">tinfo</span><span class="op" id="5864914">.</span><span class="ident" id="5864915">fields</span>&nbsp;<span class="op" id="5864922">=</span>&nbsp;<span class="builtinfunc" id="5864924">append</span><span class="op" id="5864930">(</span><span class="ident" id="5864931">tinfo</span><span class="op" id="5864936">.</span><span class="ident" id="5864937">fields</span><span class="op" id="5864943">,</span>&nbsp;<span class="op" id="5864945">*</span><span class="ident" id="5864946">newf</span><span class="op" id="5864950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864954">return</span>&nbsp;<span class="ident" id="5864961">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5864966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5864970">//&nbsp;If&nbsp;any&nbsp;conflict&nbsp;is&nbsp;shallower,&nbsp;ignore&nbsp;the&nbsp;new&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5865026">//&nbsp;This&nbsp;matches&nbsp;the&nbsp;Go&nbsp;field&nbsp;resolution&nbsp;on&nbsp;embedding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5865081">for</span>&nbsp;<span class="ident" id="5865085">_</span><span class="op" id="5865086">,</span>&nbsp;<span class="ident" id="5865088">i</span>&nbsp;<span class="op" id="5865090">:=</span>&nbsp;<span class="keyword" id="5865093">range</span>&nbsp;<span class="ident" id="5865099">conflicts</span>&nbsp;<span class="op" id="5865109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5865113">if</span>&nbsp;<span class="builtinfunc" id="5865116">len</span><span class="op" id="5865119">(</span><span class="ident" id="5865120">tinfo</span><span class="op" id="5865125">.</span><span class="ident" id="5865126">fields</span><span class="op" id="5865132">[</span><span class="ident" id="5865133">i</span><span class="op" id="5865134">]</span><span class="op" id="5865135">.</span><span class="ident" id="5865136">idx</span><span class="op" id="5865139">)</span>&nbsp;<span class="op" id="5865141">&lt;</span>&nbsp;<span class="builtinfunc" id="5865143">len</span><span class="op" id="5865146">(</span><span class="ident" id="5865147">newf</span><span class="op" id="5865151">.</span><span class="ident" id="5865152">idx</span><span class="op" id="5865155">)</span>&nbsp;<span class="op" id="5865157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5865162">return</span>&nbsp;<span class="ident" id="5865169">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5865175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5865178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5865182">//&nbsp;Otherwise,&nbsp;if&nbsp;any&nbsp;of&nbsp;them&nbsp;is&nbsp;at&nbsp;the&nbsp;same&nbsp;depth&nbsp;level,&nbsp;it&#39;s&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5865255">for</span>&nbsp;<span class="ident" id="5865259">_</span><span class="op" id="5865260">,</span>&nbsp;<span class="ident" id="5865262">i</span>&nbsp;<span class="op" id="5865264">:=</span>&nbsp;<span class="keyword" id="5865267">range</span>&nbsp;<span class="ident" id="5865273">conflicts</span>&nbsp;<span class="op" id="5865283">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5865287">oldf</span>&nbsp;<span class="op" id="5865292">:=</span>&nbsp;<span class="op" id="5865295">&amp;</span><span class="ident" id="5865296">tinfo</span><span class="op" id="5865301">.</span><span class="ident" id="5865302">fields</span><span class="op" id="5865308">[</span><span class="ident" id="5865309">i</span><span class="op" id="5865310">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5865314">if</span>&nbsp;<span class="builtinfunc" id="5865317">len</span><span class="op" id="5865320">(</span><span class="ident" id="5865321">oldf</span><span class="op" id="5865325">.</span><span class="ident" id="5865326">idx</span><span class="op" id="5865329">)</span>&nbsp;<span class="op" id="5865331">==</span>&nbsp;<span class="builtinfunc" id="5865334">len</span><span class="op" id="5865337">(</span><span class="ident" id="5865338">newf</span><span class="op" id="5865342">.</span><span class="ident" id="5865343">idx</span><span class="op" id="5865346">)</span>&nbsp;<span class="op" id="5865348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5865353">f1</span>&nbsp;<span class="op" id="5865356">:=</span>&nbsp;<span class="ident" id="5865359">typ</span><span class="op" id="5865362">.</span><span class="ident" id="5865363">FieldByIndex</span><span class="op" id="5865375">(</span><span class="ident" id="5865376">oldf</span><span class="op" id="5865380">.</span><span class="ident" id="5865381">idx</span><span class="op" id="5865384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5865389">f2</span>&nbsp;<span class="op" id="5865392">:=</span>&nbsp;<span class="ident" id="5865395">typ</span><span class="op" id="5865398">.</span><span class="ident" id="5865399">FieldByIndex</span><span class="op" id="5865411">(</span><span class="ident" id="5865412">newf</span><span class="op" id="5865416">.</span><span class="ident" id="5865417">idx</span><span class="op" id="5865420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5865425">return</span>&nbsp;<span class="op" id="5865432">&amp;</span><span class="ident" id="5865433">TagPathError</span><span class="op" id="5865445">{</span><span class="ident" id="5865446">typ</span><span class="op" id="5865449">,</span>&nbsp;<span class="ident" id="5865451">f1</span><span class="op" id="5865453">.</span><span class="ident" id="5865454">Name</span><span class="op" id="5865458">,</span>&nbsp;<span class="ident" id="5865460">f1</span><span class="op" id="5865462">.</span><span class="ident" id="5865463">Tag</span><span class="op" id="5865466">.</span><span class="ident" id="5865467">Get</span><span class="op" id="5865470">(</span><span class="string" id="5865471">&#34;xml&#34;</span><span class="op" id="5865476">)</span><span class="op" id="5865477">,</span>&nbsp;<span class="ident" id="5865479">f2</span><span class="op" id="5865481">.</span><span class="ident" id="5865482">Name</span><span class="op" id="5865486">,</span>&nbsp;<span class="ident" id="5865488">f2</span><span class="op" id="5865490">.</span><span class="ident" id="5865491">Tag</span><span class="op" id="5865494">.</span><span class="ident" id="5865495">Get</span><span class="op" id="5865498">(</span><span class="string" id="5865499">&#34;xml&#34;</span><span class="op" id="5865504">)</span><span class="op" id="5865505">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5865509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5865512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5865516">//&nbsp;Otherwise,&nbsp;the&nbsp;new&nbsp;field&nbsp;is&nbsp;shallower,&nbsp;and&nbsp;thus&nbsp;takes&nbsp;precedence,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5865586">//&nbsp;so&nbsp;drop&nbsp;the&nbsp;conflicting&nbsp;fields&nbsp;from&nbsp;tinfo&nbsp;and&nbsp;append&nbsp;the&nbsp;new&nbsp;one.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5865656">for</span>&nbsp;<span class="ident" id="5865660">c</span>&nbsp;<span class="op" id="5865662">:=</span>&nbsp;<span class="builtinfunc" id="5865665">len</span><span class="op" id="5865668">(</span><span class="ident" id="5865669">conflicts</span><span class="op" id="5865678">)</span>&nbsp;<span class="op" id="5865680">-</span>&nbsp;<span class="num" id="5865682">1</span><span class="op" id="5865683">;</span>&nbsp;<span class="ident" id="5865685">c</span>&nbsp;<span class="op" id="5865687">&gt;=</span>&nbsp;<span class="num" id="5865690">0</span><span class="op" id="5865691">;</span>&nbsp;<span class="ident" id="5865693">c</span><span class="op" id="5865694">--</span>&nbsp;<span class="op" id="5865697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5865701">i</span>&nbsp;<span class="op" id="5865703">:=</span>&nbsp;<span class="ident" id="5865706">conflicts</span><span class="op" id="5865715">[</span><span class="ident" id="5865716">c</span><span class="op" id="5865717">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5865721">copy</span><span class="op" id="5865725">(</span><span class="ident" id="5865726">tinfo</span><span class="op" id="5865731">.</span><span class="ident" id="5865732">fields</span><span class="op" id="5865738">[</span><span class="ident" id="5865739">i</span><span class="op" id="5865740">:</span><span class="op" id="5865741">]</span><span class="op" id="5865742">,</span>&nbsp;<span class="ident" id="5865744">tinfo</span><span class="op" id="5865749">.</span><span class="ident" id="5865750">fields</span><span class="op" id="5865756">[</span><span class="ident" id="5865757">i</span><span class="op" id="5865758">+</span><span class="num" id="5865759">1</span><span class="op" id="5865760">:</span><span class="op" id="5865761">]</span><span class="op" id="5865762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5865766">tinfo</span><span class="op" id="5865771">.</span><span class="ident" id="5865772">fields</span>&nbsp;<span class="op" id="5865779">=</span>&nbsp;<span class="ident" id="5865781">tinfo</span><span class="op" id="5865786">.</span><span class="ident" id="5865787">fields</span><span class="op" id="5865793">[</span><span class="op" id="5865794">:</span><span class="builtinfunc" id="5865795">len</span><span class="op" id="5865798">(</span><span class="ident" id="5865799">tinfo</span><span class="op" id="5865804">.</span><span class="ident" id="5865805">fields</span><span class="op" id="5865811">)</span><span class="op" id="5865812">-</span><span class="num" id="5865813">1</span><span class="op" id="5865814">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5865817">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5865820">tinfo</span><span class="op" id="5865825">.</span><span class="ident" id="5865826">fields</span>&nbsp;<span class="op" id="5865833">=</span>&nbsp;<span class="builtinfunc" id="5865835">append</span><span class="op" id="5865841">(</span><span class="ident" id="5865842">tinfo</span><span class="op" id="5865847">.</span><span class="ident" id="5865848">fields</span><span class="op" id="5865854">,</span>&nbsp;<span class="op" id="5865856">*</span><span class="ident" id="5865857">newf</span><span class="op" id="5865861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5865864">return</span>&nbsp;<span class="ident" id="5865871">nil</span><br>
<span class="lineno"></span><span class="op" id="5865875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5865878">//&nbsp;A&nbsp;TagPathError&nbsp;represents&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;unmarshalling&nbsp;process</span><br>
<span class="lineno">335</span><span class="comment" id="5865945">//&nbsp;caused&nbsp;by&nbsp;the&nbsp;use&nbsp;of&nbsp;field&nbsp;tags&nbsp;with&nbsp;conflicting&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="5866004">type</span>&nbsp;<span class="ident" id="5866009">TagPathError</span>&nbsp;<span class="keyword" id="5866022">struct</span>&nbsp;<span class="op" id="5866029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866032">Struct</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866045">reflect</span><span class="op" id="5866052">.</span><span class="ident" id="5866053">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866059">Field1</span><span class="op" id="5866065">,</span>&nbsp;<span class="ident" id="5866067">Tag1</span>&nbsp;<span class="builtintype" id="5866072">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866080">Field2</span><span class="op" id="5866086">,</span>&nbsp;<span class="ident" id="5866088">Tag2</span>&nbsp;<span class="builtintype" id="5866093">string</span><br>
<span class="lineno">340</span><span class="op" id="5866100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5866103">func</span>&nbsp;<span class="op" id="5866108">(</span><span class="ident" id="5866109">e</span>&nbsp;<span class="op" id="5866111">*</span><span class="ident" id="5866112">TagPathError</span><span class="op" id="5866124">)</span>&nbsp;<span class="ident" id="5866126">Error</span><span class="op" id="5866131">(</span><span class="op" id="5866132">)</span>&nbsp;<span class="builtintype" id="5866134">string</span>&nbsp;<span class="op" id="5866141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5866144">return</span>&nbsp;<span class="ident" id="5866151">fmt</span><span class="op" id="5866154">.</span><span class="ident" id="5866155">Sprintf</span><span class="op" id="5866162">(</span><span class="string" id="5866163">&#34;%s&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&nbsp;conflicts&nbsp;with&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&#34;</span><span class="op" id="5866224">,</span>&nbsp;<span class="ident" id="5866226">e</span><span class="op" id="5866227">.</span><span class="ident" id="5866228">Struct</span><span class="op" id="5866234">,</span>&nbsp;<span class="ident" id="5866236">e</span><span class="op" id="5866237">.</span><span class="ident" id="5866238">Field1</span><span class="op" id="5866244">,</span>&nbsp;<span class="ident" id="5866246">e</span><span class="op" id="5866247">.</span><span class="ident" id="5866248">Tag1</span><span class="op" id="5866252">,</span>&nbsp;<span class="ident" id="5866254">e</span><span class="op" id="5866255">.</span><span class="ident" id="5866256">Field2</span><span class="op" id="5866262">,</span>&nbsp;<span class="ident" id="5866264">e</span><span class="op" id="5866265">.</span><span class="ident" id="5866266">Tag2</span><span class="op" id="5866270">)</span><br>
<span class="lineno"></span><span class="op" id="5866272">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="comment" id="5866275">//&nbsp;value&nbsp;returns&nbsp;v&#39;s&nbsp;field&nbsp;value&nbsp;corresponding&nbsp;to&nbsp;finfo.</span><br>
<span class="lineno"></span><span class="comment" id="5866332">//&nbsp;It&#39;s&nbsp;equivalent&nbsp;to&nbsp;v.FieldByIndex(finfo.idx),&nbsp;but&nbsp;initializes</span><br>
<span class="lineno"></span><span class="comment" id="5866397">//&nbsp;and&nbsp;dereferences&nbsp;pointers&nbsp;as&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="5866440">func</span>&nbsp;<span class="op" id="5866445">(</span><span class="ident" id="5866446">finfo</span>&nbsp;<span class="op" id="5866452">*</span><span class="ident" id="5866453">fieldInfo</span><span class="op" id="5866462">)</span>&nbsp;<span class="ident" id="5866464">value</span><span class="op" id="5866469">(</span><span class="ident" id="5866470">v</span>&nbsp;<span class="ident" id="5866472">reflect</span><span class="op" id="5866479">.</span><span class="ident" id="5866480">Value</span><span class="op" id="5866485">)</span>&nbsp;<span class="ident" id="5866487">reflect</span><span class="op" id="5866494">.</span><span class="ident" id="5866495">Value</span>&nbsp;<span class="op" id="5866501">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5866504">for</span>&nbsp;<span class="ident" id="5866508">i</span><span class="op" id="5866509">,</span>&nbsp;<span class="ident" id="5866511">x</span>&nbsp;<span class="op" id="5866513">:=</span>&nbsp;<span class="keyword" id="5866516">range</span>&nbsp;<span class="ident" id="5866522">finfo</span><span class="op" id="5866527">.</span><span class="ident" id="5866528">idx</span>&nbsp;<span class="op" id="5866532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5866536">if</span>&nbsp;<span class="ident" id="5866539">i</span>&nbsp;<span class="op" id="5866541">&gt;</span>&nbsp;<span class="num" id="5866543">0</span>&nbsp;<span class="op" id="5866545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866550">t</span>&nbsp;<span class="op" id="5866552">:=</span>&nbsp;<span class="ident" id="5866555">v</span><span class="op" id="5866556">.</span><span class="ident" id="5866557">Type</span><span class="op" id="5866561">(</span><span class="op" id="5866562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5866567">if</span>&nbsp;<span class="ident" id="5866570">t</span><span class="op" id="5866571">.</span><span class="ident" id="5866572">Kind</span><span class="op" id="5866576">(</span><span class="op" id="5866577">)</span>&nbsp;<span class="op" id="5866579">==</span>&nbsp;<span class="ident" id="5866582">reflect</span><span class="op" id="5866589">.</span><span class="ident" id="5866590">Ptr</span>&nbsp;<span class="op" id="5866594">&amp;&amp;</span>&nbsp;<span class="ident" id="5866597">t</span><span class="op" id="5866598">.</span><span class="ident" id="5866599">Elem</span><span class="op" id="5866603">(</span><span class="op" id="5866604">)</span><span class="op" id="5866605">.</span><span class="ident" id="5866606">Kind</span><span class="op" id="5866610">(</span><span class="op" id="5866611">)</span>&nbsp;<span class="op" id="5866613">==</span>&nbsp;<span class="ident" id="5866616">reflect</span><span class="op" id="5866623">.</span><span class="ident" id="5866624">Struct</span>&nbsp;<span class="op" id="5866631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5866637">if</span>&nbsp;<span class="ident" id="5866640">v</span><span class="op" id="5866641">.</span><span class="ident" id="5866642">IsNil</span><span class="op" id="5866647">(</span><span class="op" id="5866648">)</span>&nbsp;<span class="op" id="5866650">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866657">v</span><span class="op" id="5866658">.</span><span class="ident" id="5866659">Set</span><span class="op" id="5866662">(</span><span class="ident" id="5866663">reflect</span><span class="op" id="5866670">.</span><span class="ident" id="5866671">New</span><span class="op" id="5866674">(</span><span class="ident" id="5866675">v</span><span class="op" id="5866676">.</span><span class="ident" id="5866677">Type</span><span class="op" id="5866681">(</span><span class="op" id="5866682">)</span><span class="op" id="5866683">.</span><span class="ident" id="5866684">Elem</span><span class="op" id="5866688">(</span><span class="op" id="5866689">)</span><span class="op" id="5866690">)</span><span class="op" id="5866691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5866697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866703">v</span>&nbsp;<span class="op" id="5866705">=</span>&nbsp;<span class="ident" id="5866707">v</span><span class="op" id="5866708">.</span><span class="ident" id="5866709">Elem</span><span class="op" id="5866713">(</span><span class="op" id="5866714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5866719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5866723">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866727">v</span>&nbsp;<span class="op" id="5866729">=</span>&nbsp;<span class="ident" id="5866731">v</span><span class="op" id="5866732">.</span><span class="ident" id="5866733">Field</span><span class="op" id="5866738">(</span><span class="ident" id="5866739">x</span><span class="op" id="5866740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5866743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5866746">return</span>&nbsp;<span class="ident" id="5866753">v</span><br>
<span class="lineno"></span><span class="op" id="5866755">}</span>
</div>
</body>
</html>
