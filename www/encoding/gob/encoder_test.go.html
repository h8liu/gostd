<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7332810">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7332865">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7332919">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7332970">package</span>&nbsp;<span class="ident" id="7332978">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7332983">import</span>&nbsp;<span class="op" id="7332990">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7332993">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7333002">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7333009">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7333015">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7333026">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7333037">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7333047">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7333050">//&nbsp;Test&nbsp;basic&nbsp;operations&nbsp;in&nbsp;a&nbsp;safe&nbsp;manner.</span><br>
<span class="lineno"></span><span class="keyword" id="7333093">func</span>&nbsp;<span class="ident" id="7333098">TestBasicEncoderDecoder</span><span class="op" id="7333121">(</span><span class="ident" id="7333122">t</span>&nbsp;<span class="op" id="7333124">*</span><span class="ident" id="7333125">testing</span><span class="op" id="7333132">.</span><span class="ident" id="7333133">T</span><span class="op" id="7333134">)</span>&nbsp;<span class="op" id="7333136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333139">var</span>&nbsp;<span class="ident" id="7333143">values</span>&nbsp;<span class="op" id="7333150">=</span>&nbsp;<span class="op" id="7333152">[</span><span class="op" id="7333153">]</span><span class="keyword" id="7333154">interface</span><span class="op" id="7333163">{</span><span class="op" id="7333164">}</span><span class="op" id="7333165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333169">true</span><span class="op" id="7333173">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7333177">int</span><span class="op" id="7333180">(</span><span class="num" id="7333181">123</span><span class="op" id="7333184">)</span><span class="op" id="7333185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7333189">int8</span><span class="op" id="7333193">(</span><span class="num" id="7333194">123</span><span class="op" id="7333197">)</span><span class="op" id="7333198">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7333202">int16</span><span class="op" id="7333207">(</span><span class="op" id="7333208">-</span><span class="num" id="7333209">12345</span><span class="op" id="7333214">)</span><span class="op" id="7333215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7333219">int32</span><span class="op" id="7333224">(</span><span class="num" id="7333225">123456</span><span class="op" id="7333231">)</span><span class="op" id="7333232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333236">int64</span><span class="op" id="7333241">(</span><span class="op" id="7333242">-</span><span class="num" id="7333243">1234567</span><span class="op" id="7333250">)</span><span class="op" id="7333251">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7333255">uint</span><span class="op" id="7333259">(</span><span class="num" id="7333260">123</span><span class="op" id="7333263">)</span><span class="op" id="7333264">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7333268">uint8</span><span class="op" id="7333273">(</span><span class="num" id="7333274">123</span><span class="op" id="7333277">)</span><span class="op" id="7333278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7333282">uint16</span><span class="op" id="7333288">(</span><span class="num" id="7333289">12345</span><span class="op" id="7333294">)</span><span class="op" id="7333295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7333299">uint32</span><span class="op" id="7333305">(</span><span class="num" id="7333306">123456</span><span class="op" id="7333312">)</span><span class="op" id="7333313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333317">uint64</span><span class="op" id="7333323">(</span><span class="num" id="7333324">1234567</span><span class="op" id="7333331">)</span><span class="op" id="7333332">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7333336">uintptr</span><span class="op" id="7333343">(</span><span class="num" id="7333344">12345678</span><span class="op" id="7333352">)</span><span class="op" id="7333353">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7333357">float32</span><span class="op" id="7333364">(</span><span class="num" id="7333365">1.2345</span><span class="op" id="7333371">)</span><span class="op" id="7333372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7333376">float64</span><span class="op" id="7333383">(</span><span class="num" id="7333384">1.2345678</span><span class="op" id="7333393">)</span><span class="op" id="7333394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7333398">complex64</span><span class="op" id="7333407">(</span><span class="num" id="7333408">1.2345</span>&nbsp;<span class="op" id="7333415">+</span>&nbsp;<span class="num" id="7333417">2.3456i</span><span class="op" id="7333424">)</span><span class="op" id="7333425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7333429">complex128</span><span class="op" id="7333439">(</span><span class="num" id="7333440">1.2345678</span>&nbsp;<span class="op" id="7333450">+</span>&nbsp;<span class="num" id="7333452">2.3456789i</span><span class="op" id="7333462">)</span><span class="op" id="7333463">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333467">[</span><span class="op" id="7333468">]</span><span class="builtintype" id="7333469">byte</span><span class="op" id="7333473">(</span><span class="string" id="7333474">&#34;hello&#34;</span><span class="op" id="7333481">)</span><span class="op" id="7333482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7333486">string</span><span class="op" id="7333492">(</span><span class="string" id="7333493">&#34;hello&#34;</span><span class="op" id="7333500">)</span><span class="op" id="7333501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333507">for</span>&nbsp;<span class="ident" id="7333511">_</span><span class="op" id="7333512">,</span>&nbsp;<span class="ident" id="7333514">value</span>&nbsp;<span class="op" id="7333520">:=</span>&nbsp;<span class="keyword" id="7333523">range</span>&nbsp;<span class="ident" id="7333529">values</span>&nbsp;<span class="op" id="7333536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333540">b</span>&nbsp;<span class="op" id="7333542">:=</span>&nbsp;<span class="builtinfunc" id="7333545">new</span><span class="op" id="7333548">(</span><span class="ident" id="7333549">bytes</span><span class="op" id="7333554">.</span><span class="ident" id="7333555">Buffer</span><span class="op" id="7333561">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333565">enc</span>&nbsp;<span class="op" id="7333569">:=</span>&nbsp;<span class="ident" id="7333572">NewEncoder</span><span class="op" id="7333582">(</span><span class="ident" id="7333583">b</span><span class="op" id="7333584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333588">err</span>&nbsp;<span class="op" id="7333592">:=</span>&nbsp;<span class="ident" id="7333595">enc</span><span class="op" id="7333598">.</span><span class="ident" id="7333599">Encode</span><span class="op" id="7333605">(</span><span class="ident" id="7333606">value</span><span class="op" id="7333611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333615">if</span>&nbsp;<span class="ident" id="7333618">err</span>&nbsp;<span class="op" id="7333622">!=</span>&nbsp;<span class="ident" id="7333625">nil</span>&nbsp;<span class="op" id="7333629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333634">t</span><span class="op" id="7333635">.</span><span class="ident" id="7333636">Error</span><span class="op" id="7333641">(</span><span class="string" id="7333642">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="7333657">,</span>&nbsp;<span class="ident" id="7333659">err</span><span class="op" id="7333662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333666">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333670">dec</span>&nbsp;<span class="op" id="7333674">:=</span>&nbsp;<span class="ident" id="7333677">NewDecoder</span><span class="op" id="7333687">(</span><span class="ident" id="7333688">b</span><span class="op" id="7333689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333693">result</span>&nbsp;<span class="op" id="7333700">:=</span>&nbsp;<span class="ident" id="7333703">reflect</span><span class="op" id="7333710">.</span><span class="ident" id="7333711">New</span><span class="op" id="7333714">(</span><span class="ident" id="7333715">reflect</span><span class="op" id="7333722">.</span><span class="ident" id="7333723">TypeOf</span><span class="op" id="7333729">(</span><span class="ident" id="7333730">value</span><span class="op" id="7333735">)</span><span class="op" id="7333736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333740">err</span>&nbsp;<span class="op" id="7333744">=</span>&nbsp;<span class="ident" id="7333746">dec</span><span class="op" id="7333749">.</span><span class="ident" id="7333750">Decode</span><span class="op" id="7333756">(</span><span class="ident" id="7333757">result</span><span class="op" id="7333763">.</span><span class="ident" id="7333764">Interface</span><span class="op" id="7333773">(</span><span class="op" id="7333774">)</span><span class="op" id="7333775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333779">if</span>&nbsp;<span class="ident" id="7333782">err</span>&nbsp;<span class="op" id="7333786">!=</span>&nbsp;<span class="ident" id="7333789">nil</span>&nbsp;<span class="op" id="7333793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333798">t</span><span class="op" id="7333799">.</span><span class="ident" id="7333800">Fatalf</span><span class="op" id="7333806">(</span><span class="string" id="7333807">&#34;error&nbsp;decoding&nbsp;%T:&nbsp;%v:&#34;</span><span class="op" id="7333831">,</span>&nbsp;<span class="ident" id="7333833">reflect</span><span class="op" id="7333840">.</span><span class="ident" id="7333841">TypeOf</span><span class="op" id="7333847">(</span><span class="ident" id="7333848">value</span><span class="op" id="7333853">)</span><span class="op" id="7333854">,</span>&nbsp;<span class="ident" id="7333856">err</span><span class="op" id="7333859">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7333863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7333867">if</span>&nbsp;<span class="op" id="7333870">!</span><span class="ident" id="7333871">reflect</span><span class="op" id="7333878">.</span><span class="ident" id="7333879">DeepEqual</span><span class="op" id="7333888">(</span><span class="ident" id="7333889">value</span><span class="op" id="7333894">,</span>&nbsp;<span class="ident" id="7333896">result</span><span class="op" id="7333902">.</span><span class="ident" id="7333903">Elem</span><span class="op" id="7333907">(</span><span class="op" id="7333908">)</span><span class="op" id="7333909">.</span><span class="ident" id="7333910">Interface</span><span class="op" id="7333919">(</span><span class="op" id="7333920">)</span><span class="op" id="7333921">)</span>&nbsp;<span class="op" id="7333923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7333928">t</span><span class="op" id="7333929">.</span><span class="ident" id="7333930">Fatalf</span><span class="op" id="7333936">(</span><span class="string" id="7333937">&#34;%T:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7333961">,</span>&nbsp;<span class="ident" id="7333963">value</span><span class="op" id="7333968">,</span>&nbsp;<span class="ident" id="7333970">value</span><span class="op" id="7333975">,</span>&nbsp;<span class="ident" id="7333977">result</span><span class="op" id="7333983">.</span><span class="ident" id="7333984">Elem</span><span class="op" id="7333988">(</span><span class="op" id="7333989">)</span><span class="op" id="7333990">.</span><span class="ident" id="7333991">Interface</span><span class="op" id="7334000">(</span><span class="op" id="7334001">)</span><span class="op" id="7334002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334009">}</span><br>
<span class="lineno">55</span><span class="op" id="7334011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7334014">type</span>&nbsp;<span class="ident" id="7334019">ET0</span>&nbsp;<span class="keyword" id="7334023">struct</span>&nbsp;<span class="op" id="7334030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334033">A</span>&nbsp;<span class="builtintype" id="7334035">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334040">B</span>&nbsp;<span class="builtintype" id="7334042">string</span><br>
<span class="lineno">60</span><span class="op" id="7334049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7334052">type</span>&nbsp;<span class="ident" id="7334057">ET2</span>&nbsp;<span class="keyword" id="7334061">struct</span>&nbsp;<span class="op" id="7334068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334071">X</span>&nbsp;<span class="builtintype" id="7334073">string</span><br>
<span class="lineno"></span><span class="op" id="7334080">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="7334083">type</span>&nbsp;<span class="ident" id="7334088">ET1</span>&nbsp;<span class="keyword" id="7334092">struct</span>&nbsp;<span class="op" id="7334099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334102">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7334107">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334112">Et2</span>&nbsp;&nbsp;<span class="op" id="7334117">*</span><span class="ident" id="7334118">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334123">Next</span>&nbsp;<span class="op" id="7334128">*</span><span class="ident" id="7334129">ET1</span><br>
<span class="lineno">70</span><span class="op" id="7334133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7334136">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;name&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno"></span><span class="keyword" id="7334186">type</span>&nbsp;<span class="ident" id="7334191">ET3</span>&nbsp;<span class="keyword" id="7334195">struct</span>&nbsp;<span class="op" id="7334202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334205">A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7334219">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334224">Et2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7334238">*</span><span class="ident" id="7334239">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334244">DifferentNext</span>&nbsp;<span class="op" id="7334258">*</span><span class="ident" id="7334259">ET1</span><br>
<span class="lineno"></span><span class="op" id="7334263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7334266">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;type&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno">80</span><span class="keyword" id="7334316">type</span>&nbsp;<span class="ident" id="7334321">ET4</span>&nbsp;<span class="keyword" id="7334325">struct</span>&nbsp;<span class="op" id="7334332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334335">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7334340">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334345">Et2</span>&nbsp;&nbsp;<span class="builtintype" id="7334350">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334359">Next</span>&nbsp;<span class="builtintype" id="7334364">int</span><br>
<span class="lineno"></span><span class="op" id="7334368">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="7334371">func</span>&nbsp;<span class="ident" id="7334376">TestEncoderDecoder</span><span class="op" id="7334394">(</span><span class="ident" id="7334395">t</span>&nbsp;<span class="op" id="7334397">*</span><span class="ident" id="7334398">testing</span><span class="op" id="7334405">.</span><span class="ident" id="7334406">T</span><span class="op" id="7334407">)</span>&nbsp;<span class="op" id="7334409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334412">b</span>&nbsp;<span class="op" id="7334414">:=</span>&nbsp;<span class="builtinfunc" id="7334417">new</span><span class="op" id="7334420">(</span><span class="ident" id="7334421">bytes</span><span class="op" id="7334426">.</span><span class="ident" id="7334427">Buffer</span><span class="op" id="7334433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334436">enc</span>&nbsp;<span class="op" id="7334440">:=</span>&nbsp;<span class="ident" id="7334443">NewEncoder</span><span class="op" id="7334453">(</span><span class="ident" id="7334454">b</span><span class="op" id="7334455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334458">et0</span>&nbsp;<span class="op" id="7334462">:=</span>&nbsp;<span class="builtinfunc" id="7334465">new</span><span class="op" id="7334468">(</span><span class="ident" id="7334469">ET0</span><span class="op" id="7334472">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334475">et0</span><span class="op" id="7334478">.</span><span class="ident" id="7334479">A</span>&nbsp;<span class="op" id="7334481">=</span>&nbsp;<span class="num" id="7334483">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334486">et0</span><span class="op" id="7334489">.</span><span class="ident" id="7334490">B</span>&nbsp;<span class="op" id="7334492">=</span>&nbsp;<span class="string" id="7334494">&#34;gobs&nbsp;of&nbsp;fun&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334509">err</span>&nbsp;<span class="op" id="7334513">:=</span>&nbsp;<span class="ident" id="7334516">enc</span><span class="op" id="7334519">.</span><span class="ident" id="7334520">Encode</span><span class="op" id="7334526">(</span><span class="ident" id="7334527">et0</span><span class="op" id="7334530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7334533">if</span>&nbsp;<span class="ident" id="7334536">err</span>&nbsp;<span class="op" id="7334540">!=</span>&nbsp;<span class="ident" id="7334543">nil</span>&nbsp;<span class="op" id="7334547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334551">t</span><span class="op" id="7334552">.</span><span class="ident" id="7334553">Error</span><span class="op" id="7334558">(</span><span class="string" id="7334559">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="7334574">,</span>&nbsp;<span class="ident" id="7334576">err</span><span class="op" id="7334579">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7334585">//fmt.Printf(&#34;%&nbsp;x&nbsp;%q\n&#34;,&nbsp;b,&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7334617">//Debug(b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334629">dec</span>&nbsp;<span class="op" id="7334633">:=</span>&nbsp;<span class="ident" id="7334636">NewDecoder</span><span class="op" id="7334646">(</span><span class="ident" id="7334647">b</span><span class="op" id="7334648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334651">newEt0</span>&nbsp;<span class="op" id="7334658">:=</span>&nbsp;<span class="builtinfunc" id="7334661">new</span><span class="op" id="7334664">(</span><span class="ident" id="7334665">ET0</span><span class="op" id="7334668">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334671">err</span>&nbsp;<span class="op" id="7334675">=</span>&nbsp;<span class="ident" id="7334677">dec</span><span class="op" id="7334680">.</span><span class="ident" id="7334681">Decode</span><span class="op" id="7334687">(</span><span class="ident" id="7334688">newEt0</span><span class="op" id="7334694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7334697">if</span>&nbsp;<span class="ident" id="7334700">err</span>&nbsp;<span class="op" id="7334704">!=</span>&nbsp;<span class="ident" id="7334707">nil</span>&nbsp;<span class="op" id="7334711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334715">t</span><span class="op" id="7334716">.</span><span class="ident" id="7334717">Fatal</span><span class="op" id="7334722">(</span><span class="string" id="7334723">&#34;error&nbsp;decoding&nbsp;ET0:&#34;</span><span class="op" id="7334744">,</span>&nbsp;<span class="ident" id="7334746">err</span><span class="op" id="7334749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7334756">if</span>&nbsp;<span class="op" id="7334759">!</span><span class="ident" id="7334760">reflect</span><span class="op" id="7334767">.</span><span class="ident" id="7334768">DeepEqual</span><span class="op" id="7334777">(</span><span class="ident" id="7334778">et0</span><span class="op" id="7334781">,</span>&nbsp;<span class="ident" id="7334783">newEt0</span><span class="op" id="7334789">)</span>&nbsp;<span class="op" id="7334791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334795">t</span><span class="op" id="7334796">.</span><span class="ident" id="7334797">Fatalf</span><span class="op" id="7334803">(</span><span class="string" id="7334804">&#34;invalid&nbsp;data&nbsp;for&nbsp;et0:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="7334849">,</span>&nbsp;<span class="op" id="7334851">*</span><span class="ident" id="7334852">et0</span><span class="op" id="7334855">,</span>&nbsp;<span class="op" id="7334857">*</span><span class="ident" id="7334858">newEt0</span><span class="op" id="7334864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7334870">if</span>&nbsp;<span class="ident" id="7334873">b</span><span class="op" id="7334874">.</span><span class="ident" id="7334875">Len</span><span class="op" id="7334878">(</span><span class="op" id="7334879">)</span>&nbsp;<span class="op" id="7334881">!=</span>&nbsp;<span class="num" id="7334884">0</span>&nbsp;<span class="op" id="7334886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334890">t</span><span class="op" id="7334891">.</span><span class="ident" id="7334892">Error</span><span class="op" id="7334897">(</span><span class="string" id="7334898">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="7334911">,</span>&nbsp;<span class="ident" id="7334913">b</span><span class="op" id="7334914">.</span><span class="ident" id="7334915">Len</span><span class="op" id="7334918">(</span><span class="op" id="7334919">)</span><span class="op" id="7334920">,</span>&nbsp;<span class="string" id="7334922">&#34;bytes&nbsp;left&#34;</span><span class="op" id="7334934">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7334937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7334940">//&nbsp;&nbsp;&nbsp;&nbspt.FailNow()</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334957">b</span>&nbsp;<span class="op" id="7334959">=</span>&nbsp;<span class="builtinfunc" id="7334961">new</span><span class="op" id="7334964">(</span><span class="ident" id="7334965">bytes</span><span class="op" id="7334970">.</span><span class="ident" id="7334971">Buffer</span><span class="op" id="7334977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7334980">enc</span>&nbsp;<span class="op" id="7334984">=</span>&nbsp;<span class="ident" id="7334986">NewEncoder</span><span class="op" id="7334996">(</span><span class="ident" id="7334997">b</span><span class="op" id="7334998">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335001">et1</span>&nbsp;<span class="op" id="7335005">:=</span>&nbsp;<span class="builtinfunc" id="7335008">new</span><span class="op" id="7335011">(</span><span class="ident" id="7335012">ET1</span><span class="op" id="7335015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335018">et1</span><span class="op" id="7335021">.</span><span class="ident" id="7335022">A</span>&nbsp;<span class="op" id="7335024">=</span>&nbsp;<span class="num" id="7335026">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335029">et1</span><span class="op" id="7335032">.</span><span class="ident" id="7335033">Et2</span>&nbsp;<span class="op" id="7335037">=</span>&nbsp;<span class="builtinfunc" id="7335039">new</span><span class="op" id="7335042">(</span><span class="ident" id="7335043">ET2</span><span class="op" id="7335046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335049">err</span>&nbsp;<span class="op" id="7335053">=</span>&nbsp;<span class="ident" id="7335055">enc</span><span class="op" id="7335058">.</span><span class="ident" id="7335059">Encode</span><span class="op" id="7335065">(</span><span class="ident" id="7335066">et1</span><span class="op" id="7335069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335072">if</span>&nbsp;<span class="ident" id="7335075">err</span>&nbsp;<span class="op" id="7335079">!=</span>&nbsp;<span class="ident" id="7335082">nil</span>&nbsp;<span class="op" id="7335086">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335090">t</span><span class="op" id="7335091">.</span><span class="ident" id="7335092">Error</span><span class="op" id="7335097">(</span><span class="string" id="7335098">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="7335113">,</span>&nbsp;<span class="ident" id="7335115">err</span><span class="op" id="7335118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335124">dec</span>&nbsp;<span class="op" id="7335128">=</span>&nbsp;<span class="ident" id="7335130">NewDecoder</span><span class="op" id="7335140">(</span><span class="ident" id="7335141">b</span><span class="op" id="7335142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335145">newEt1</span>&nbsp;<span class="op" id="7335152">:=</span>&nbsp;<span class="builtinfunc" id="7335155">new</span><span class="op" id="7335158">(</span><span class="ident" id="7335159">ET1</span><span class="op" id="7335162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335165">err</span>&nbsp;<span class="op" id="7335169">=</span>&nbsp;<span class="ident" id="7335171">dec</span><span class="op" id="7335174">.</span><span class="ident" id="7335175">Decode</span><span class="op" id="7335181">(</span><span class="ident" id="7335182">newEt1</span><span class="op" id="7335188">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335191">if</span>&nbsp;<span class="ident" id="7335194">err</span>&nbsp;<span class="op" id="7335198">!=</span>&nbsp;<span class="ident" id="7335201">nil</span>&nbsp;<span class="op" id="7335205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335209">t</span><span class="op" id="7335210">.</span><span class="ident" id="7335211">Fatal</span><span class="op" id="7335216">(</span><span class="string" id="7335217">&#34;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="7335238">,</span>&nbsp;<span class="ident" id="7335240">err</span><span class="op" id="7335243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335250">if</span>&nbsp;<span class="op" id="7335253">!</span><span class="ident" id="7335254">reflect</span><span class="op" id="7335261">.</span><span class="ident" id="7335262">DeepEqual</span><span class="op" id="7335271">(</span><span class="ident" id="7335272">et1</span><span class="op" id="7335275">,</span>&nbsp;<span class="ident" id="7335277">newEt1</span><span class="op" id="7335283">)</span>&nbsp;<span class="op" id="7335285">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335289">t</span><span class="op" id="7335290">.</span><span class="ident" id="7335291">Fatalf</span><span class="op" id="7335297">(</span><span class="string" id="7335298">&#34;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="7335343">,</span>&nbsp;<span class="op" id="7335345">*</span><span class="ident" id="7335346">et1</span><span class="op" id="7335349">,</span>&nbsp;<span class="op" id="7335351">*</span><span class="ident" id="7335352">newEt1</span><span class="op" id="7335358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335364">if</span>&nbsp;<span class="ident" id="7335367">b</span><span class="op" id="7335368">.</span><span class="ident" id="7335369">Len</span><span class="op" id="7335372">(</span><span class="op" id="7335373">)</span>&nbsp;<span class="op" id="7335375">!=</span>&nbsp;<span class="num" id="7335378">0</span>&nbsp;<span class="op" id="7335380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335384">t</span><span class="op" id="7335385">.</span><span class="ident" id="7335386">Error</span><span class="op" id="7335391">(</span><span class="string" id="7335392">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="7335405">,</span>&nbsp;<span class="ident" id="7335407">b</span><span class="op" id="7335408">.</span><span class="ident" id="7335409">Len</span><span class="op" id="7335412">(</span><span class="op" id="7335413">)</span><span class="op" id="7335414">,</span>&nbsp;<span class="string" id="7335416">&#34;bytes&nbsp;left&#34;</span><span class="op" id="7335428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335431">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335435">enc</span><span class="op" id="7335438">.</span><span class="ident" id="7335439">Encode</span><span class="op" id="7335445">(</span><span class="ident" id="7335446">et1</span><span class="op" id="7335449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335452">newEt1</span>&nbsp;<span class="op" id="7335459">=</span>&nbsp;<span class="builtinfunc" id="7335461">new</span><span class="op" id="7335464">(</span><span class="ident" id="7335465">ET1</span><span class="op" id="7335468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335471">err</span>&nbsp;<span class="op" id="7335475">=</span>&nbsp;<span class="ident" id="7335477">dec</span><span class="op" id="7335480">.</span><span class="ident" id="7335481">Decode</span><span class="op" id="7335487">(</span><span class="ident" id="7335488">newEt1</span><span class="op" id="7335494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335497">if</span>&nbsp;<span class="ident" id="7335500">err</span>&nbsp;<span class="op" id="7335504">!=</span>&nbsp;<span class="ident" id="7335507">nil</span>&nbsp;<span class="op" id="7335511">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335515">t</span><span class="op" id="7335516">.</span><span class="ident" id="7335517">Fatal</span><span class="op" id="7335522">(</span><span class="string" id="7335523">&#34;round&nbsp;2:&nbsp;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="7335553">,</span>&nbsp;<span class="ident" id="7335555">err</span><span class="op" id="7335558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335564">if</span>&nbsp;<span class="op" id="7335567">!</span><span class="ident" id="7335568">reflect</span><span class="op" id="7335575">.</span><span class="ident" id="7335576">DeepEqual</span><span class="op" id="7335585">(</span><span class="ident" id="7335586">et1</span><span class="op" id="7335589">,</span>&nbsp;<span class="ident" id="7335591">newEt1</span><span class="op" id="7335597">)</span>&nbsp;<span class="op" id="7335599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335603">t</span><span class="op" id="7335604">.</span><span class="ident" id="7335605">Fatalf</span><span class="op" id="7335611">(</span><span class="string" id="7335612">&#34;round&nbsp;2:&nbsp;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="7335666">,</span>&nbsp;<span class="op" id="7335668">*</span><span class="ident" id="7335669">et1</span><span class="op" id="7335672">,</span>&nbsp;<span class="op" id="7335674">*</span><span class="ident" id="7335675">newEt1</span><span class="op" id="7335681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335684">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335687">if</span>&nbsp;<span class="ident" id="7335690">b</span><span class="op" id="7335691">.</span><span class="ident" id="7335692">Len</span><span class="op" id="7335695">(</span><span class="op" id="7335696">)</span>&nbsp;<span class="op" id="7335698">!=</span>&nbsp;<span class="num" id="7335701">0</span>&nbsp;<span class="op" id="7335703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335707">t</span><span class="op" id="7335708">.</span><span class="ident" id="7335709">Error</span><span class="op" id="7335714">(</span><span class="string" id="7335715">&#34;round&nbsp;2:&nbsp;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="7335737">,</span>&nbsp;<span class="ident" id="7335739">b</span><span class="op" id="7335740">.</span><span class="ident" id="7335741">Len</span><span class="op" id="7335744">(</span><span class="op" id="7335745">)</span><span class="op" id="7335746">,</span>&nbsp;<span class="string" id="7335748">&#34;bytes&nbsp;left&#34;</span><span class="op" id="7335760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7335767">//&nbsp;Now&nbsp;test&nbsp;with&nbsp;a&nbsp;running&nbsp;encoder/decoder&nbsp;pair&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;type&nbsp;mismatch.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335851">err</span>&nbsp;<span class="op" id="7335855">=</span>&nbsp;<span class="ident" id="7335857">enc</span><span class="op" id="7335860">.</span><span class="ident" id="7335861">Encode</span><span class="op" id="7335867">(</span><span class="ident" id="7335868">et1</span><span class="op" id="7335871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335874">if</span>&nbsp;<span class="ident" id="7335877">err</span>&nbsp;<span class="op" id="7335881">!=</span>&nbsp;<span class="ident" id="7335884">nil</span>&nbsp;<span class="op" id="7335888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335892">t</span><span class="op" id="7335893">.</span><span class="ident" id="7335894">Error</span><span class="op" id="7335899">(</span><span class="string" id="7335900">&#34;round&nbsp;3:&nbsp;encoder&nbsp;fail:&#34;</span><span class="op" id="7335924">,</span>&nbsp;<span class="ident" id="7335926">err</span><span class="op" id="7335929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7335932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335935">newEt2</span>&nbsp;<span class="op" id="7335942">:=</span>&nbsp;<span class="builtinfunc" id="7335945">new</span><span class="op" id="7335948">(</span><span class="ident" id="7335949">ET2</span><span class="op" id="7335952">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335955">err</span>&nbsp;<span class="op" id="7335959">=</span>&nbsp;<span class="ident" id="7335961">dec</span><span class="op" id="7335964">.</span><span class="ident" id="7335965">Decode</span><span class="op" id="7335971">(</span><span class="ident" id="7335972">newEt2</span><span class="op" id="7335978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7335981">if</span>&nbsp;<span class="ident" id="7335984">err</span>&nbsp;<span class="op" id="7335988">==</span>&nbsp;<span class="ident" id="7335991">nil</span>&nbsp;<span class="op" id="7335995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7335999">t</span><span class="op" id="7336000">.</span><span class="ident" id="7336001">Fatal</span><span class="op" id="7336006">(</span><span class="string" id="7336007">&#34;round&nbsp;3:&nbsp;expected&nbsp;`bad&nbsp;type&#39;&nbsp;error&nbsp;decoding&nbsp;ET2&#34;</span><span class="op" id="7336056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7336059">}</span><br>
<span class="lineno"></span><span class="op" id="7336061">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="7336064">//&nbsp;Run&nbsp;one&nbsp;value&nbsp;through&nbsp;the&nbsp;encoder/decoder,&nbsp;but&nbsp;use&nbsp;the&nbsp;wrong&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="7336134">//&nbsp;Input&nbsp;is&nbsp;always&nbsp;an&nbsp;ET1;&nbsp;we&nbsp;compare&nbsp;it&nbsp;to&nbsp;whatever&nbsp;is&nbsp;under&nbsp;&#39;e&#39;.</span><br>
<span class="lineno"></span><span class="keyword" id="7336201">func</span>&nbsp;<span class="ident" id="7336206">badTypeCheck</span><span class="op" id="7336218">(</span><span class="ident" id="7336219">e</span>&nbsp;<span class="keyword" id="7336221">interface</span><span class="op" id="7336230">{</span><span class="op" id="7336231">}</span><span class="op" id="7336232">,</span>&nbsp;<span class="ident" id="7336234">shouldFail</span>&nbsp;<span class="builtintype" id="7336245">bool</span><span class="op" id="7336249">,</span>&nbsp;<span class="ident" id="7336251">msg</span>&nbsp;<span class="builtintype" id="7336255">string</span><span class="op" id="7336261">,</span>&nbsp;<span class="ident" id="7336263">t</span>&nbsp;<span class="op" id="7336265">*</span><span class="ident" id="7336266">testing</span><span class="op" id="7336273">.</span><span class="ident" id="7336274">T</span><span class="op" id="7336275">)</span>&nbsp;<span class="op" id="7336277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336280">b</span>&nbsp;<span class="op" id="7336282">:=</span>&nbsp;<span class="builtinfunc" id="7336285">new</span><span class="op" id="7336288">(</span><span class="ident" id="7336289">bytes</span><span class="op" id="7336294">.</span><span class="ident" id="7336295">Buffer</span><span class="op" id="7336301">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336304">enc</span>&nbsp;<span class="op" id="7336308">:=</span>&nbsp;<span class="ident" id="7336311">NewEncoder</span><span class="op" id="7336321">(</span><span class="ident" id="7336322">b</span><span class="op" id="7336323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336326">et1</span>&nbsp;<span class="op" id="7336330">:=</span>&nbsp;<span class="builtinfunc" id="7336333">new</span><span class="op" id="7336336">(</span><span class="ident" id="7336337">ET1</span><span class="op" id="7336340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336343">et1</span><span class="op" id="7336346">.</span><span class="ident" id="7336347">A</span>&nbsp;<span class="op" id="7336349">=</span>&nbsp;<span class="num" id="7336351">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336354">et1</span><span class="op" id="7336357">.</span><span class="ident" id="7336358">Et2</span>&nbsp;<span class="op" id="7336362">=</span>&nbsp;<span class="builtinfunc" id="7336364">new</span><span class="op" id="7336367">(</span><span class="ident" id="7336368">ET2</span><span class="op" id="7336371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336374">err</span>&nbsp;<span class="op" id="7336378">:=</span>&nbsp;<span class="ident" id="7336381">enc</span><span class="op" id="7336384">.</span><span class="ident" id="7336385">Encode</span><span class="op" id="7336391">(</span><span class="ident" id="7336392">et1</span><span class="op" id="7336395">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336398">if</span>&nbsp;<span class="ident" id="7336401">err</span>&nbsp;<span class="op" id="7336405">!=</span>&nbsp;<span class="ident" id="7336408">nil</span>&nbsp;<span class="op" id="7336412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336416">t</span><span class="op" id="7336417">.</span><span class="ident" id="7336418">Error</span><span class="op" id="7336423">(</span><span class="string" id="7336424">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="7336439">,</span>&nbsp;<span class="ident" id="7336441">err</span><span class="op" id="7336444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7336447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336450">dec</span>&nbsp;<span class="op" id="7336454">:=</span>&nbsp;<span class="ident" id="7336457">NewDecoder</span><span class="op" id="7336467">(</span><span class="ident" id="7336468">b</span><span class="op" id="7336469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336472">err</span>&nbsp;<span class="op" id="7336476">=</span>&nbsp;<span class="ident" id="7336478">dec</span><span class="op" id="7336481">.</span><span class="ident" id="7336482">Decode</span><span class="op" id="7336488">(</span><span class="ident" id="7336489">e</span><span class="op" id="7336490">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336493">if</span>&nbsp;<span class="ident" id="7336496">shouldFail</span>&nbsp;<span class="op" id="7336507">&amp;&amp;</span>&nbsp;<span class="ident" id="7336510">err</span>&nbsp;<span class="op" id="7336514">==</span>&nbsp;<span class="ident" id="7336517">nil</span>&nbsp;<span class="op" id="7336521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336525">t</span><span class="op" id="7336526">.</span><span class="ident" id="7336527">Error</span><span class="op" id="7336532">(</span><span class="string" id="7336533">&#34;expected&nbsp;error&nbsp;for&#34;</span><span class="op" id="7336553">,</span>&nbsp;<span class="ident" id="7336555">msg</span><span class="op" id="7336558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7336561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7336564">if</span>&nbsp;<span class="op" id="7336567">!</span><span class="ident" id="7336568">shouldFail</span>&nbsp;<span class="op" id="7336579">&amp;&amp;</span>&nbsp;<span class="ident" id="7336582">err</span>&nbsp;<span class="op" id="7336586">!=</span>&nbsp;<span class="ident" id="7336589">nil</span>&nbsp;<span class="op" id="7336593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336597">t</span><span class="op" id="7336598">.</span><span class="ident" id="7336599">Error</span><span class="op" id="7336604">(</span><span class="string" id="7336605">&#34;unexpected&nbsp;error&nbsp;for&#34;</span><span class="op" id="7336627">,</span>&nbsp;<span class="ident" id="7336629">msg</span><span class="op" id="7336632">,</span>&nbsp;<span class="ident" id="7336634">err</span><span class="op" id="7336637">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7336640">}</span><br>
<span class="lineno"></span><span class="op" id="7336642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7336645">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;bad&nbsp;type&nbsp;the&nbsp;first&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="7336698">func</span>&nbsp;<span class="ident" id="7336703">TestWrongTypeDecoder</span><span class="op" id="7336723">(</span><span class="ident" id="7336724">t</span>&nbsp;<span class="op" id="7336726">*</span><span class="ident" id="7336727">testing</span><span class="op" id="7336734">.</span><span class="ident" id="7336735">T</span><span class="op" id="7336736">)</span>&nbsp;<span class="op" id="7336738">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336741">badTypeCheck</span><span class="op" id="7336753">(</span><span class="builtinfunc" id="7336754">new</span><span class="op" id="7336757">(</span><span class="ident" id="7336758">ET2</span><span class="op" id="7336761">)</span><span class="op" id="7336762">,</span>&nbsp;<span class="ident" id="7336764">true</span><span class="op" id="7336768">,</span>&nbsp;<span class="string" id="7336770">&#34;no&nbsp;fields&nbsp;in&nbsp;common&#34;</span><span class="op" id="7336791">,</span>&nbsp;<span class="ident" id="7336793">t</span><span class="op" id="7336794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336797">badTypeCheck</span><span class="op" id="7336809">(</span><span class="builtinfunc" id="7336810">new</span><span class="op" id="7336813">(</span><span class="ident" id="7336814">ET3</span><span class="op" id="7336817">)</span><span class="op" id="7336818">,</span>&nbsp;<span class="ident" id="7336820">false</span><span class="op" id="7336825">,</span>&nbsp;<span class="string" id="7336827">&#34;different&nbsp;name&nbsp;of&nbsp;field&#34;</span><span class="op" id="7336852">,</span>&nbsp;<span class="ident" id="7336854">t</span><span class="op" id="7336855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336858">badTypeCheck</span><span class="op" id="7336870">(</span><span class="builtinfunc" id="7336871">new</span><span class="op" id="7336874">(</span><span class="ident" id="7336875">ET4</span><span class="op" id="7336878">)</span><span class="op" id="7336879">,</span>&nbsp;<span class="ident" id="7336881">true</span><span class="op" id="7336885">,</span>&nbsp;<span class="string" id="7336887">&#34;different&nbsp;type&nbsp;of&nbsp;field&#34;</span><span class="op" id="7336912">,</span>&nbsp;<span class="ident" id="7336914">t</span><span class="op" id="7336915">)</span><br>
<span class="lineno"></span><span class="op" id="7336917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="7336920">func</span>&nbsp;<span class="ident" id="7336925">corruptDataCheck</span><span class="op" id="7336941">(</span><span class="ident" id="7336942">s</span>&nbsp;<span class="builtintype" id="7336944">string</span><span class="op" id="7336950">,</span>&nbsp;<span class="ident" id="7336952">err</span>&nbsp;<span class="builtintype" id="7336956">error</span><span class="op" id="7336961">,</span>&nbsp;<span class="ident" id="7336963">t</span>&nbsp;<span class="op" id="7336965">*</span><span class="ident" id="7336966">testing</span><span class="op" id="7336973">.</span><span class="ident" id="7336974">T</span><span class="op" id="7336975">)</span>&nbsp;<span class="op" id="7336977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7336980">b</span>&nbsp;<span class="op" id="7336982">:=</span>&nbsp;<span class="ident" id="7336985">bytes</span><span class="op" id="7336990">.</span><span class="ident" id="7336991">NewBufferString</span><span class="op" id="7337006">(</span><span class="ident" id="7337007">s</span><span class="op" id="7337008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7337011">dec</span>&nbsp;<span class="op" id="7337015">:=</span>&nbsp;<span class="ident" id="7337018">NewDecoder</span><span class="op" id="7337028">(</span><span class="ident" id="7337029">b</span><span class="op" id="7337030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7337033">err1</span>&nbsp;<span class="op" id="7337038">:=</span>&nbsp;<span class="ident" id="7337041">dec</span><span class="op" id="7337044">.</span><span class="ident" id="7337045">Decode</span><span class="op" id="7337051">(</span><span class="builtinfunc" id="7337052">new</span><span class="op" id="7337055">(</span><span class="ident" id="7337056">ET2</span><span class="op" id="7337059">)</span><span class="op" id="7337060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7337063">if</span>&nbsp;<span class="ident" id="7337066">err1</span>&nbsp;<span class="op" id="7337071">!=</span>&nbsp;<span class="ident" id="7337074">err</span>&nbsp;<span class="op" id="7337078">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7337082">t</span><span class="op" id="7337083">.</span><span class="ident" id="7337084">Errorf</span><span class="op" id="7337090">(</span><span class="string" id="7337091">&#34;from&nbsp;%q&nbsp;expected&nbsp;error&nbsp;%s;&nbsp;got&nbsp;%s&#34;</span><span class="op" id="7337126">,</span>&nbsp;<span class="ident" id="7337128">s</span><span class="op" id="7337129">,</span>&nbsp;<span class="ident" id="7337131">err</span><span class="op" id="7337134">,</span>&nbsp;<span class="ident" id="7337136">err1</span><span class="op" id="7337140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7337143">}</span><br>
<span class="lineno"></span><span class="op" id="7337145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7337148">//&nbsp;Check&nbsp;that&nbsp;we&nbsp;survive&nbsp;bad&nbsp;data.</span><br>
<span class="lineno">200</span><span class="keyword" id="7337183">func</span>&nbsp;<span class="ident" id="7337188">TestBadData</span><span class="op" id="7337199">(</span><span class="ident" id="7337200">t</span>&nbsp;<span class="op" id="7337202">*</span><span class="ident" id="7337203">testing</span><span class="op" id="7337210">.</span><span class="ident" id="7337211">T</span><span class="op" id="7337212">)</span>&nbsp;<span class="op" id="7337214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7337217">corruptDataCheck</span><span class="op" id="7337233">(</span><span class="string" id="7337234">&#34;&#34;</span><span class="op" id="7337236">,</span>&nbsp;<span class="ident" id="7337238">io</span><span class="op" id="7337240">.</span><span class="ident" id="7337241">EOF</span><span class="op" id="7337244">,</span>&nbsp;<span class="ident" id="7337246">t</span><span class="op" id="7337247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7337250">corruptDataCheck</span><span class="op" id="7337266">(</span><span class="string" id="7337267">&#34;\x7Fhi&#34;</span><span class="op" id="7337275">,</span>&nbsp;<span class="ident" id="7337277">io</span><span class="op" id="7337279">.</span><span class="ident" id="7337280">ErrUnexpectedEOF</span><span class="op" id="7337296">,</span>&nbsp;<span class="ident" id="7337298">t</span><span class="op" id="7337299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7337302">corruptDataCheck</span><span class="op" id="7337318">(</span><span class="string" id="7337319">&#34;\x03now&nbsp;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&#34;</span><span class="op" id="7337357">,</span>&nbsp;<span class="ident" id="7337359">errBadType</span><span class="op" id="7337369">,</span>&nbsp;<span class="ident" id="7337371">t</span><span class="op" id="7337372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7337375">//&nbsp;issue&nbsp;6323.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7337391">corruptDataCheck</span><span class="op" id="7337407">(</span><span class="string" id="7337408">&#34;\x04\x24foo&#34;</span><span class="op" id="7337421">,</span>&nbsp;<span class="ident" id="7337423">errRange</span><span class="op" id="7337431">,</span>&nbsp;<span class="ident" id="7337433">t</span><span class="op" id="7337434">)</span><br>
<span class="lineno"></span><span class="op" id="7337436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7337439">//&nbsp;Types&nbsp;not&nbsp;supported&nbsp;at&nbsp;top&nbsp;level&nbsp;by&nbsp;the&nbsp;Encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="7337491">var</span>&nbsp;<span class="ident" id="7337495">unsupportedValues</span>&nbsp;<span class="op" id="7337513">=</span>&nbsp;<span class="op" id="7337515">[</span><span class="op" id="7337516">]</span><span class="keyword" id="7337517">interface</span><span class="op" id="7337526">{</span><span class="op" id="7337527">}</span><span class="op" id="7337528">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7337531">make</span><span class="op" id="7337535">(</span><span class="keyword" id="7337536">chan</span>&nbsp;<span class="builtintype" id="7337541">int</span><span class="op" id="7337544">)</span><span class="op" id="7337545">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7337548">func</span><span class="op" id="7337552">(</span><span class="ident" id="7337553">a</span>&nbsp;<span class="builtintype" id="7337555">int</span><span class="op" id="7337558">)</span>&nbsp;<span class="builtintype" id="7337560">bool</span>&nbsp;<span class="op" id="7337565">{</span>&nbsp;<span class="keyword" id="7337567">return</span>&nbsp;<span class="ident" id="7337574">true</span>&nbsp;<span class="op" id="7337579">}</span><span class="op" id="7337580">,</span><br>
<span class="lineno"></span><span class="op" id="7337582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7337585">func</span>&nbsp;<span class="ident" id="7337590">TestUnsupported</span><span class="op" id="7337605">(</span><span class="ident" id="7337606">t</span>&nbsp;<span class="op" id="7337608">*</span><span class="ident" id="7337609">testing</span><span class="op" id="7337616">.</span><span class="ident" id="7337617">T</span><span class="op" id="7337618">)</span>&nbsp;<span class="op" id="7337620">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7337623">var</span>&nbsp;<span class="ident" id="7337627">b</span>&nbsp;<span class="ident" id="7337629">bytes</span><span class="op" id="7337634">.</span><span class="ident" id="7337635">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7337643">enc</span>&nbsp;<span class="op" id="7337647">:=</span>&nbsp;<span class="ident" id="7337650">NewEncoder</span><span class="op" id="7337660">(</span><span class="op" id="7337661">&amp;</span><span class="ident" id="7337662">b</span><span class="op" id="7337663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7337666">for</span>&nbsp;<span class="ident" id="7337670">_</span><span class="op" id="7337671">,</span>&nbsp;<span class="ident" id="7337673">v</span>&nbsp;<span class="op" id="7337675">:=</span>&nbsp;<span class="keyword" id="7337678">range</span>&nbsp;<span class="ident" id="7337684">unsupportedValues</span>&nbsp;<span class="op" id="7337702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7337706">err</span>&nbsp;<span class="op" id="7337710">:=</span>&nbsp;<span class="ident" id="7337713">enc</span><span class="op" id="7337716">.</span><span class="ident" id="7337717">Encode</span><span class="op" id="7337723">(</span><span class="ident" id="7337724">v</span><span class="op" id="7337725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7337729">if</span>&nbsp;<span class="ident" id="7337732">err</span>&nbsp;<span class="op" id="7337736">==</span>&nbsp;<span class="ident" id="7337739">nil</span>&nbsp;<span class="op" id="7337743">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7337748">t</span><span class="op" id="7337749">.</span><span class="ident" id="7337750">Errorf</span><span class="op" id="7337756">(</span><span class="string" id="7337757">&#34;expected&nbsp;error&nbsp;for&nbsp;%T;&nbsp;got&nbsp;none&#34;</span><span class="op" id="7337790">,</span>&nbsp;<span class="ident" id="7337792">v</span><span class="op" id="7337793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7337797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7337800">}</span><br>
<span class="lineno"></span><span class="op" id="7337802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="7337805">func</span>&nbsp;<span class="ident" id="7337810">encAndDec</span><span class="op" id="7337819">(</span><span class="ident" id="7337820">in</span><span class="op" id="7337822">,</span>&nbsp;<span class="ident" id="7337824">out</span>&nbsp;<span class="keyword" id="7337828">interface</span><span class="op" id="7337837">{</span><span class="op" id="7337838">}</span><span class="op" id="7337839">)</span>&nbsp;<span class="builtintype" id="7337841">error</span>&nbsp;<span class="op" id="7337847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7337850">b</span>&nbsp;<span class="op" id="7337852">:=</span>&nbsp;<span class="builtinfunc" id="7337855">new</span><span class="op" id="7337858">(</span><span class="ident" id="7337859">bytes</span><span class="op" id="7337864">.</span><span class="ident" id="7337865">Buffer</span><span class="op" id="7337871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7337874">enc</span>&nbsp;<span class="op" id="7337878">:=</span>&nbsp;<span class="ident" id="7337881">NewEncoder</span><span class="op" id="7337891">(</span><span class="ident" id="7337892">b</span><span class="op" id="7337893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7337896">err</span>&nbsp;<span class="op" id="7337900">:=</span>&nbsp;<span class="ident" id="7337903">enc</span><span class="op" id="7337906">.</span><span class="ident" id="7337907">Encode</span><span class="op" id="7337913">(</span><span class="ident" id="7337914">in</span><span class="op" id="7337916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7337919">if</span>&nbsp;<span class="ident" id="7337922">err</span>&nbsp;<span class="op" id="7337926">!=</span>&nbsp;<span class="ident" id="7337929">nil</span>&nbsp;<span class="op" id="7337933">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7337937">return</span>&nbsp;<span class="ident" id="7337944">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7337949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7337952">dec</span>&nbsp;<span class="op" id="7337956">:=</span>&nbsp;<span class="ident" id="7337959">NewDecoder</span><span class="op" id="7337969">(</span><span class="ident" id="7337970">b</span><span class="op" id="7337971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7337974">err</span>&nbsp;<span class="op" id="7337978">=</span>&nbsp;<span class="ident" id="7337980">dec</span><span class="op" id="7337983">.</span><span class="ident" id="7337984">Decode</span><span class="op" id="7337990">(</span><span class="ident" id="7337991">out</span><span class="op" id="7337994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7337997">if</span>&nbsp;<span class="ident" id="7338000">err</span>&nbsp;<span class="op" id="7338004">!=</span>&nbsp;<span class="ident" id="7338007">nil</span>&nbsp;<span class="op" id="7338011">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7338015">return</span>&nbsp;<span class="ident" id="7338022">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7338027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7338030">return</span>&nbsp;<span class="ident" id="7338037">nil</span><br>
<span class="lineno"></span><span class="op" id="7338041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7338044">func</span>&nbsp;<span class="ident" id="7338049">TestTypeToPtrType</span><span class="op" id="7338066">(</span><span class="ident" id="7338067">t</span>&nbsp;<span class="op" id="7338069">*</span><span class="ident" id="7338070">testing</span><span class="op" id="7338077">.</span><span class="ident" id="7338078">T</span><span class="op" id="7338079">)</span>&nbsp;<span class="op" id="7338081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7338084">//&nbsp;Encode&nbsp;a&nbsp;T,&nbsp;decode&nbsp;a&nbsp;*T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7338112">type</span>&nbsp;<span class="ident" id="7338117">Type0</span>&nbsp;<span class="keyword" id="7338123">struct</span>&nbsp;<span class="op" id="7338130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7338134">A</span>&nbsp;<span class="builtintype" id="7338136">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7338141">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7338144">t0</span>&nbsp;<span class="op" id="7338147">:=</span>&nbsp;<span class="ident" id="7338150">Type0</span><span class="op" id="7338155">{</span><span class="num" id="7338156">7</span><span class="op" id="7338157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7338160">t0p</span>&nbsp;<span class="op" id="7338164">:=</span>&nbsp;<span class="builtinfunc" id="7338167">new</span><span class="op" id="7338170">(</span><span class="ident" id="7338171">Type0</span><span class="op" id="7338176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7338179">if</span>&nbsp;<span class="ident" id="7338182">err</span>&nbsp;<span class="op" id="7338186">:=</span>&nbsp;<span class="ident" id="7338189">encAndDec</span><span class="op" id="7338198">(</span><span class="ident" id="7338199">t0</span><span class="op" id="7338201">,</span>&nbsp;<span class="ident" id="7338203">t0p</span><span class="op" id="7338206">)</span><span class="op" id="7338207">;</span>&nbsp;<span class="ident" id="7338209">err</span>&nbsp;<span class="op" id="7338213">!=</span>&nbsp;<span class="ident" id="7338216">nil</span>&nbsp;<span class="op" id="7338220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7338224">t</span><span class="op" id="7338225">.</span><span class="ident" id="7338226">Error</span><span class="op" id="7338231">(</span><span class="ident" id="7338232">err</span><span class="op" id="7338235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7338238">}</span><br>
<span class="lineno">250</span><span class="op" id="7338240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7338243">func</span>&nbsp;<span class="ident" id="7338248">TestPtrTypeToType</span><span class="op" id="7338265">(</span><span class="ident" id="7338266">t</span>&nbsp;<span class="op" id="7338268">*</span><span class="ident" id="7338269">testing</span><span class="op" id="7338276">.</span><span class="ident" id="7338277">T</span><span class="op" id="7338278">)</span>&nbsp;<span class="op" id="7338280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7338283">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7338311">type</span>&nbsp;<span class="ident" id="7338316">Type1</span>&nbsp;<span class="keyword" id="7338322">struct</span>&nbsp;<span class="op" id="7338329">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7338333">A</span>&nbsp;<span class="builtintype" id="7338335">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7338341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7338344">t1p</span>&nbsp;<span class="op" id="7338348">:=</span>&nbsp;<span class="op" id="7338351">&amp;</span><span class="ident" id="7338352">Type1</span><span class="op" id="7338357">{</span><span class="num" id="7338358">17</span><span class="op" id="7338360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7338363">var</span>&nbsp;<span class="ident" id="7338367">t1</span>&nbsp;<span class="ident" id="7338370">Type1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7338377">if</span>&nbsp;<span class="ident" id="7338380">err</span>&nbsp;<span class="op" id="7338384">:=</span>&nbsp;<span class="ident" id="7338387">encAndDec</span><span class="op" id="7338396">(</span><span class="ident" id="7338397">t1</span><span class="op" id="7338399">,</span>&nbsp;<span class="ident" id="7338401">t1p</span><span class="op" id="7338404">)</span><span class="op" id="7338405">;</span>&nbsp;<span class="ident" id="7338407">err</span>&nbsp;<span class="op" id="7338411">!=</span>&nbsp;<span class="ident" id="7338414">nil</span>&nbsp;<span class="op" id="7338418">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7338422">t</span><span class="op" id="7338423">.</span><span class="ident" id="7338424">Error</span><span class="op" id="7338429">(</span><span class="ident" id="7338430">err</span><span class="op" id="7338433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7338436">}</span><br>
<span class="lineno"></span><span class="op" id="7338438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7338441">func</span>&nbsp;<span class="ident" id="7338446">TestTypeToPtrPtrPtrPtrType</span><span class="op" id="7338472">(</span><span class="ident" id="7338473">t</span>&nbsp;<span class="op" id="7338475">*</span><span class="ident" id="7338476">testing</span><span class="op" id="7338483">.</span><span class="ident" id="7338484">T</span><span class="op" id="7338485">)</span>&nbsp;<span class="op" id="7338487">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7338490">type</span>&nbsp;<span class="ident" id="7338495">Type2</span>&nbsp;<span class="keyword" id="7338501">struct</span>&nbsp;<span class="op" id="7338508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7338512">A</span>&nbsp;<span class="op" id="7338514">*</span><span class="op" id="7338515">*</span><span class="op" id="7338516">*</span><span class="op" id="7338517">*</span><span class="builtintype" id="7338518">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7338527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7338530">t2</span>&nbsp;<span class="op" id="7338533">:=</span>&nbsp;<span class="ident" id="7338536">Type2</span><span class="op" id="7338541">{</span><span class="op" id="7338542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7338545">t2</span><span class="op" id="7338547">.</span><span class="ident" id="7338548">A</span>&nbsp;<span class="op" id="7338550">=</span>&nbsp;<span class="builtinfunc" id="7338552">new</span><span class="op" id="7338555">(</span><span class="op" id="7338556">*</span><span class="op" id="7338557">*</span><span class="op" id="7338558">*</span><span class="builtintype" id="7338559">float64</span><span class="op" id="7338566">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7338569">*</span><span class="ident" id="7338570">t2</span><span class="op" id="7338572">.</span><span class="ident" id="7338573">A</span>&nbsp;<span class="op" id="7338575">=</span>&nbsp;<span class="builtinfunc" id="7338577">new</span><span class="op" id="7338580">(</span><span class="op" id="7338581">*</span><span class="op" id="7338582">*</span><span class="builtintype" id="7338583">float64</span><span class="op" id="7338590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7338593">*</span><span class="op" id="7338594">*</span><span class="ident" id="7338595">t2</span><span class="op" id="7338597">.</span><span class="ident" id="7338598">A</span>&nbsp;<span class="op" id="7338600">=</span>&nbsp;<span class="builtinfunc" id="7338602">new</span><span class="op" id="7338605">(</span><span class="op" id="7338606">*</span><span class="builtintype" id="7338607">float64</span><span class="op" id="7338614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7338617">*</span><span class="op" id="7338618">*</span><span class="op" id="7338619">*</span><span class="ident" id="7338620">t2</span><span class="op" id="7338622">.</span><span class="ident" id="7338623">A</span>&nbsp;<span class="op" id="7338625">=</span>&nbsp;<span class="builtinfunc" id="7338627">new</span><span class="op" id="7338630">(</span><span class="builtintype" id="7338631">float64</span><span class="op" id="7338638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7338641">*</span><span class="op" id="7338642">*</span><span class="op" id="7338643">*</span><span class="op" id="7338644">*</span><span class="ident" id="7338645">t2</span><span class="op" id="7338647">.</span><span class="ident" id="7338648">A</span>&nbsp;<span class="op" id="7338650">=</span>&nbsp;<span class="num" id="7338652">27.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7338658">t2pppp</span>&nbsp;<span class="op" id="7338665">:=</span>&nbsp;<span class="builtinfunc" id="7338668">new</span><span class="op" id="7338671">(</span><span class="op" id="7338672">*</span><span class="op" id="7338673">*</span><span class="op" id="7338674">*</span><span class="ident" id="7338675">Type2</span><span class="op" id="7338680">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7338683">if</span>&nbsp;<span class="ident" id="7338686">err</span>&nbsp;<span class="op" id="7338690">:=</span>&nbsp;<span class="ident" id="7338693">encAndDec</span><span class="op" id="7338702">(</span><span class="ident" id="7338703">t2</span><span class="op" id="7338705">,</span>&nbsp;<span class="ident" id="7338707">t2pppp</span><span class="op" id="7338713">)</span><span class="op" id="7338714">;</span>&nbsp;<span class="ident" id="7338716">err</span>&nbsp;<span class="op" id="7338720">!=</span>&nbsp;<span class="ident" id="7338723">nil</span>&nbsp;<span class="op" id="7338727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7338731">t</span><span class="op" id="7338732">.</span><span class="ident" id="7338733">Fatal</span><span class="op" id="7338738">(</span><span class="ident" id="7338739">err</span><span class="op" id="7338742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7338745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7338748">if</span>&nbsp;<span class="op" id="7338751">*</span><span class="op" id="7338752">*</span><span class="op" id="7338753">*</span><span class="op" id="7338754">*</span><span class="op" id="7338755">(</span><span class="op" id="7338756">*</span><span class="op" id="7338757">*</span><span class="op" id="7338758">*</span><span class="op" id="7338759">*</span><span class="ident" id="7338760">t2pppp</span><span class="op" id="7338766">)</span><span class="op" id="7338767">.</span><span class="ident" id="7338768">A</span>&nbsp;<span class="op" id="7338770">!=</span>&nbsp;<span class="op" id="7338773">*</span><span class="op" id="7338774">*</span><span class="op" id="7338775">*</span><span class="op" id="7338776">*</span><span class="ident" id="7338777">t2</span><span class="op" id="7338779">.</span><span class="ident" id="7338780">A</span>&nbsp;<span class="op" id="7338782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7338786">t</span><span class="op" id="7338787">.</span><span class="ident" id="7338788">Errorf</span><span class="op" id="7338794">(</span><span class="string" id="7338795">&#34;wrong&nbsp;value&nbsp;after&nbsp;decode:&nbsp;%g&nbsp;not&nbsp;%g&#34;</span><span class="op" id="7338832">,</span>&nbsp;<span class="op" id="7338834">*</span><span class="op" id="7338835">*</span><span class="op" id="7338836">*</span><span class="op" id="7338837">*</span><span class="op" id="7338838">(</span><span class="op" id="7338839">*</span><span class="op" id="7338840">*</span><span class="op" id="7338841">*</span><span class="op" id="7338842">*</span><span class="ident" id="7338843">t2pppp</span><span class="op" id="7338849">)</span><span class="op" id="7338850">.</span><span class="ident" id="7338851">A</span><span class="op" id="7338852">,</span>&nbsp;<span class="op" id="7338854">*</span><span class="op" id="7338855">*</span><span class="op" id="7338856">*</span><span class="op" id="7338857">*</span><span class="ident" id="7338858">t2</span><span class="op" id="7338860">.</span><span class="ident" id="7338861">A</span><span class="op" id="7338862">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7338865">}</span><br>
<span class="lineno"></span><span class="op" id="7338867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7338870">func</span>&nbsp;<span class="ident" id="7338875">TestSlice</span><span class="op" id="7338884">(</span><span class="ident" id="7338885">t</span>&nbsp;<span class="op" id="7338887">*</span><span class="ident" id="7338888">testing</span><span class="op" id="7338895">.</span><span class="ident" id="7338896">T</span><span class="op" id="7338897">)</span>&nbsp;<span class="op" id="7338899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7338902">type</span>&nbsp;<span class="ident" id="7338907">Type3</span>&nbsp;<span class="keyword" id="7338913">struct</span>&nbsp;<span class="op" id="7338920">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7338924">A</span>&nbsp;<span class="op" id="7338926">[</span><span class="op" id="7338927">]</span><span class="builtintype" id="7338928">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7338936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7338939">t3p</span>&nbsp;<span class="op" id="7338943">:=</span>&nbsp;<span class="op" id="7338946">&amp;</span><span class="ident" id="7338947">Type3</span><span class="op" id="7338952">{</span><span class="op" id="7338953">[</span><span class="op" id="7338954">]</span><span class="builtintype" id="7338955">string</span><span class="op" id="7338961">{</span><span class="string" id="7338962">&#34;hello&#34;</span><span class="op" id="7338969">,</span>&nbsp;<span class="string" id="7338971">&#34;world&#34;</span><span class="op" id="7338978">}</span><span class="op" id="7338979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7338982">var</span>&nbsp;<span class="ident" id="7338986">t3</span>&nbsp;<span class="ident" id="7338989">Type3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7338996">if</span>&nbsp;<span class="ident" id="7338999">err</span>&nbsp;<span class="op" id="7339003">:=</span>&nbsp;<span class="ident" id="7339006">encAndDec</span><span class="op" id="7339015">(</span><span class="ident" id="7339016">t3</span><span class="op" id="7339018">,</span>&nbsp;<span class="ident" id="7339020">t3p</span><span class="op" id="7339023">)</span><span class="op" id="7339024">;</span>&nbsp;<span class="ident" id="7339026">err</span>&nbsp;<span class="op" id="7339030">!=</span>&nbsp;<span class="ident" id="7339033">nil</span>&nbsp;<span class="op" id="7339037">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7339041">t</span><span class="op" id="7339042">.</span><span class="ident" id="7339043">Error</span><span class="op" id="7339048">(</span><span class="ident" id="7339049">err</span><span class="op" id="7339052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7339055">}</span><br>
<span class="lineno"></span><span class="op" id="7339057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7339060">func</span>&nbsp;<span class="ident" id="7339065">TestValueError</span><span class="op" id="7339079">(</span><span class="ident" id="7339080">t</span>&nbsp;<span class="op" id="7339082">*</span><span class="ident" id="7339083">testing</span><span class="op" id="7339090">.</span><span class="ident" id="7339091">T</span><span class="op" id="7339092">)</span>&nbsp;<span class="op" id="7339094">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7339097">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7339125">type</span>&nbsp;<span class="ident" id="7339130">Type4</span>&nbsp;<span class="keyword" id="7339136">struct</span>&nbsp;<span class="op" id="7339143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7339147">A</span>&nbsp;<span class="builtintype" id="7339149">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7339154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7339157">t4p</span>&nbsp;<span class="op" id="7339161">:=</span>&nbsp;<span class="op" id="7339164">&amp;</span><span class="ident" id="7339165">Type4</span><span class="op" id="7339170">{</span><span class="num" id="7339171">3</span><span class="op" id="7339172">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7339175">var</span>&nbsp;<span class="ident" id="7339179">t4</span>&nbsp;<span class="ident" id="7339182">Type4</span>&nbsp;<span class="comment" id="7339188">//&nbsp;note:&nbsp;not&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7339213">if</span>&nbsp;<span class="ident" id="7339216">err</span>&nbsp;<span class="op" id="7339220">:=</span>&nbsp;<span class="ident" id="7339223">encAndDec</span><span class="op" id="7339232">(</span><span class="ident" id="7339233">t4p</span><span class="op" id="7339236">,</span>&nbsp;<span class="ident" id="7339238">t4</span><span class="op" id="7339240">)</span><span class="op" id="7339241">;</span>&nbsp;<span class="ident" id="7339243">err</span>&nbsp;<span class="op" id="7339247">==</span>&nbsp;<span class="ident" id="7339250">nil</span>&nbsp;<span class="op" id="7339254">||</span>&nbsp;<span class="ident" id="7339257">strings</span><span class="op" id="7339264">.</span><span class="ident" id="7339265">Index</span><span class="op" id="7339270">(</span><span class="ident" id="7339271">err</span><span class="op" id="7339274">.</span><span class="ident" id="7339275">Error</span><span class="op" id="7339280">(</span><span class="op" id="7339281">)</span><span class="op" id="7339282">,</span>&nbsp;<span class="string" id="7339284">&#34;pointer&#34;</span><span class="op" id="7339293">)</span>&nbsp;<span class="op" id="7339295">&lt;</span>&nbsp;<span class="num" id="7339297">0</span>&nbsp;<span class="op" id="7339299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7339303">t</span><span class="op" id="7339304">.</span><span class="ident" id="7339305">Error</span><span class="op" id="7339310">(</span><span class="string" id="7339311">&#34;expected&nbsp;error&nbsp;about&nbsp;pointer;&nbsp;got&#34;</span><span class="op" id="7339346">,</span>&nbsp;<span class="ident" id="7339348">err</span><span class="op" id="7339351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7339354">}</span><br>
<span class="lineno"></span><span class="op" id="7339356">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="keyword" id="7339359">func</span>&nbsp;<span class="ident" id="7339364">TestArray</span><span class="op" id="7339373">(</span><span class="ident" id="7339374">t</span>&nbsp;<span class="op" id="7339376">*</span><span class="ident" id="7339377">testing</span><span class="op" id="7339384">.</span><span class="ident" id="7339385">T</span><span class="op" id="7339386">)</span>&nbsp;<span class="op" id="7339388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7339391">type</span>&nbsp;<span class="ident" id="7339396">Type5</span>&nbsp;<span class="keyword" id="7339402">struct</span>&nbsp;<span class="op" id="7339409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7339413">A</span>&nbsp;<span class="op" id="7339415">[</span><span class="num" id="7339416">3</span><span class="op" id="7339417">]</span><span class="builtintype" id="7339418">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7339427">B</span>&nbsp;<span class="op" id="7339429">[</span><span class="num" id="7339430">3</span><span class="op" id="7339431">]</span><span class="builtintype" id="7339432">byte</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7339438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7339441">type</span>&nbsp;<span class="ident" id="7339446">Type6</span>&nbsp;<span class="keyword" id="7339452">struct</span>&nbsp;<span class="op" id="7339459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7339463">A</span>&nbsp;<span class="op" id="7339465">[</span><span class="num" id="7339466">2</span><span class="op" id="7339467">]</span><span class="builtintype" id="7339468">string</span>&nbsp;<span class="comment" id="7339475">//&nbsp;can&#39;t&nbsp;hold&nbsp;t5.a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7339495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7339498">t5</span>&nbsp;<span class="op" id="7339501">:=</span>&nbsp;<span class="ident" id="7339504">Type5</span><span class="op" id="7339509">{</span><span class="op" id="7339510">[</span><span class="num" id="7339511">3</span><span class="op" id="7339512">]</span><span class="builtintype" id="7339513">string</span><span class="op" id="7339519">{</span><span class="string" id="7339520">&#34;hello&#34;</span><span class="op" id="7339527">,</span>&nbsp;<span class="string" id="7339529">&#34;,&#34;</span><span class="op" id="7339532">,</span>&nbsp;<span class="string" id="7339534">&#34;world&#34;</span><span class="op" id="7339541">}</span><span class="op" id="7339542">,</span>&nbsp;<span class="op" id="7339544">[</span><span class="num" id="7339545">3</span><span class="op" id="7339546">]</span><span class="builtintype" id="7339547">byte</span><span class="op" id="7339551">{</span><span class="num" id="7339552">1</span><span class="op" id="7339553">,</span>&nbsp;<span class="num" id="7339555">2</span><span class="op" id="7339556">,</span>&nbsp;<span class="num" id="7339558">3</span><span class="op" id="7339559">}</span><span class="op" id="7339560">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7339563">var</span>&nbsp;<span class="ident" id="7339567">t5p</span>&nbsp;<span class="ident" id="7339571">Type5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7339578">if</span>&nbsp;<span class="ident" id="7339581">err</span>&nbsp;<span class="op" id="7339585">:=</span>&nbsp;<span class="ident" id="7339588">encAndDec</span><span class="op" id="7339597">(</span><span class="ident" id="7339598">t5</span><span class="op" id="7339600">,</span>&nbsp;<span class="op" id="7339602">&amp;</span><span class="ident" id="7339603">t5p</span><span class="op" id="7339606">)</span><span class="op" id="7339607">;</span>&nbsp;<span class="ident" id="7339609">err</span>&nbsp;<span class="op" id="7339613">!=</span>&nbsp;<span class="ident" id="7339616">nil</span>&nbsp;<span class="op" id="7339620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7339624">t</span><span class="op" id="7339625">.</span><span class="ident" id="7339626">Error</span><span class="op" id="7339631">(</span><span class="ident" id="7339632">err</span><span class="op" id="7339635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7339638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7339641">var</span>&nbsp;<span class="ident" id="7339645">t6</span>&nbsp;<span class="ident" id="7339648">Type6</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7339655">if</span>&nbsp;<span class="ident" id="7339658">err</span>&nbsp;<span class="op" id="7339662">:=</span>&nbsp;<span class="ident" id="7339665">encAndDec</span><span class="op" id="7339674">(</span><span class="ident" id="7339675">t5</span><span class="op" id="7339677">,</span>&nbsp;<span class="op" id="7339679">&amp;</span><span class="ident" id="7339680">t6</span><span class="op" id="7339682">)</span><span class="op" id="7339683">;</span>&nbsp;<span class="ident" id="7339685">err</span>&nbsp;<span class="op" id="7339689">==</span>&nbsp;<span class="ident" id="7339692">nil</span>&nbsp;<span class="op" id="7339696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7339700">t</span><span class="op" id="7339701">.</span><span class="ident" id="7339702">Error</span><span class="op" id="7339707">(</span><span class="string" id="7339708">&#34;should&nbsp;fail&nbsp;with&nbsp;mismatched&nbsp;array&nbsp;sizes&#34;</span><span class="op" id="7339749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7339752">}</span><br>
<span class="lineno"></span><span class="op" id="7339754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="7339757">func</span>&nbsp;<span class="ident" id="7339762">TestRecursiveMapType</span><span class="op" id="7339782">(</span><span class="ident" id="7339783">t</span>&nbsp;<span class="op" id="7339785">*</span><span class="ident" id="7339786">testing</span><span class="op" id="7339793">.</span><span class="ident" id="7339794">T</span><span class="op" id="7339795">)</span>&nbsp;<span class="op" id="7339797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7339800">type</span>&nbsp;<span class="ident" id="7339805">recursiveMap</span>&nbsp;<span class="keyword" id="7339818">map</span><span class="op" id="7339821">[</span><span class="builtintype" id="7339822">string</span><span class="op" id="7339828">]</span><span class="ident" id="7339829">recursiveMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7339843">r1</span>&nbsp;<span class="op" id="7339846">:=</span>&nbsp;<span class="ident" id="7339849">recursiveMap</span><span class="op" id="7339861">{</span><span class="string" id="7339862">&#34;A&#34;</span><span class="op" id="7339865">:</span>&nbsp;<span class="ident" id="7339867">recursiveMap</span><span class="op" id="7339879">{</span><span class="string" id="7339880">&#34;B&#34;</span><span class="op" id="7339883">:</span>&nbsp;<span class="ident" id="7339885">nil</span><span class="op" id="7339888">,</span>&nbsp;<span class="string" id="7339890">&#34;C&#34;</span><span class="op" id="7339893">:</span>&nbsp;<span class="ident" id="7339895">nil</span><span class="op" id="7339898">}</span><span class="op" id="7339899">,</span>&nbsp;<span class="string" id="7339901">&#34;D&#34;</span><span class="op" id="7339904">:</span>&nbsp;<span class="ident" id="7339906">nil</span><span class="op" id="7339909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7339912">r2</span>&nbsp;<span class="op" id="7339915">:=</span>&nbsp;<span class="builtinfunc" id="7339918">make</span><span class="op" id="7339922">(</span><span class="ident" id="7339923">recursiveMap</span><span class="op" id="7339935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7339938">if</span>&nbsp;<span class="ident" id="7339941">err</span>&nbsp;<span class="op" id="7339945">:=</span>&nbsp;<span class="ident" id="7339948">encAndDec</span><span class="op" id="7339957">(</span><span class="ident" id="7339958">r1</span><span class="op" id="7339960">,</span>&nbsp;<span class="op" id="7339962">&amp;</span><span class="ident" id="7339963">r2</span><span class="op" id="7339965">)</span><span class="op" id="7339966">;</span>&nbsp;<span class="ident" id="7339968">err</span>&nbsp;<span class="op" id="7339972">!=</span>&nbsp;<span class="ident" id="7339975">nil</span>&nbsp;<span class="op" id="7339979">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7339983">t</span><span class="op" id="7339984">.</span><span class="ident" id="7339985">Error</span><span class="op" id="7339990">(</span><span class="ident" id="7339991">err</span><span class="op" id="7339994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7339997">}</span><br>
<span class="lineno"></span><span class="op" id="7339999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7340002">func</span>&nbsp;<span class="ident" id="7340007">TestRecursiveSliceType</span><span class="op" id="7340029">(</span><span class="ident" id="7340030">t</span>&nbsp;<span class="op" id="7340032">*</span><span class="ident" id="7340033">testing</span><span class="op" id="7340040">.</span><span class="ident" id="7340041">T</span><span class="op" id="7340042">)</span>&nbsp;<span class="op" id="7340044">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7340047">type</span>&nbsp;<span class="ident" id="7340052">recursiveSlice</span>&nbsp;<span class="op" id="7340067">[</span><span class="op" id="7340068">]</span><span class="ident" id="7340069">recursiveSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7340085">r1</span>&nbsp;<span class="op" id="7340088">:=</span>&nbsp;<span class="ident" id="7340091">recursiveSlice</span><span class="op" id="7340105">{</span><span class="num" id="7340106">0</span><span class="op" id="7340107">:</span>&nbsp;<span class="ident" id="7340109">recursiveSlice</span><span class="op" id="7340123">{</span><span class="num" id="7340124">0</span><span class="op" id="7340125">:</span>&nbsp;<span class="ident" id="7340127">nil</span><span class="op" id="7340130">}</span><span class="op" id="7340131">,</span>&nbsp;<span class="num" id="7340133">1</span><span class="op" id="7340134">:</span>&nbsp;<span class="ident" id="7340136">nil</span><span class="op" id="7340139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7340142">r2</span>&nbsp;<span class="op" id="7340145">:=</span>&nbsp;<span class="builtinfunc" id="7340148">make</span><span class="op" id="7340152">(</span><span class="ident" id="7340153">recursiveSlice</span><span class="op" id="7340167">,</span>&nbsp;<span class="num" id="7340169">0</span><span class="op" id="7340170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7340173">if</span>&nbsp;<span class="ident" id="7340176">err</span>&nbsp;<span class="op" id="7340180">:=</span>&nbsp;<span class="ident" id="7340183">encAndDec</span><span class="op" id="7340192">(</span><span class="ident" id="7340193">r1</span><span class="op" id="7340195">,</span>&nbsp;<span class="op" id="7340197">&amp;</span><span class="ident" id="7340198">r2</span><span class="op" id="7340200">)</span><span class="op" id="7340201">;</span>&nbsp;<span class="ident" id="7340203">err</span>&nbsp;<span class="op" id="7340207">!=</span>&nbsp;<span class="ident" id="7340210">nil</span>&nbsp;<span class="op" id="7340214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7340218">t</span><span class="op" id="7340219">.</span><span class="ident" id="7340220">Error</span><span class="op" id="7340225">(</span><span class="ident" id="7340226">err</span><span class="op" id="7340229">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7340232">}</span><br>
<span class="lineno"></span><span class="op" id="7340234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7340237">//&nbsp;Regression&nbsp;test&nbsp;for&nbsp;bug:&nbsp;must&nbsp;send&nbsp;zero&nbsp;values&nbsp;inside&nbsp;arrays</span><br>
<span class="lineno"></span><span class="keyword" id="7340301">func</span>&nbsp;<span class="ident" id="7340306">TestDefaultsInArray</span><span class="op" id="7340325">(</span><span class="ident" id="7340326">t</span>&nbsp;<span class="op" id="7340328">*</span><span class="ident" id="7340329">testing</span><span class="op" id="7340336">.</span><span class="ident" id="7340337">T</span><span class="op" id="7340338">)</span>&nbsp;<span class="op" id="7340340">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7340343">type</span>&nbsp;<span class="ident" id="7340348">Type7</span>&nbsp;<span class="keyword" id="7340354">struct</span>&nbsp;<span class="op" id="7340361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7340365">B</span>&nbsp;<span class="op" id="7340367">[</span><span class="op" id="7340368">]</span><span class="builtintype" id="7340369">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7340376">I</span>&nbsp;<span class="op" id="7340378">[</span><span class="op" id="7340379">]</span><span class="builtintype" id="7340380">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7340386">S</span>&nbsp;<span class="op" id="7340388">[</span><span class="op" id="7340389">]</span><span class="builtintype" id="7340390">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7340399">F</span>&nbsp;<span class="op" id="7340401">[</span><span class="op" id="7340402">]</span><span class="builtintype" id="7340403">float64</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7340412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7340415">t7</span>&nbsp;<span class="op" id="7340418">:=</span>&nbsp;<span class="ident" id="7340421">Type7</span><span class="op" id="7340426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7340430">[</span><span class="op" id="7340431">]</span><span class="builtintype" id="7340432">bool</span><span class="op" id="7340436">{</span><span class="ident" id="7340437">false</span><span class="op" id="7340442">,</span>&nbsp;<span class="ident" id="7340444">false</span><span class="op" id="7340449">,</span>&nbsp;<span class="ident" id="7340451">true</span><span class="op" id="7340455">}</span><span class="op" id="7340456">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7340460">[</span><span class="op" id="7340461">]</span><span class="builtintype" id="7340462">int</span><span class="op" id="7340465">{</span><span class="num" id="7340466">0</span><span class="op" id="7340467">,</span>&nbsp;<span class="num" id="7340469">0</span><span class="op" id="7340470">,</span>&nbsp;<span class="num" id="7340472">1</span><span class="op" id="7340473">}</span><span class="op" id="7340474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7340478">[</span><span class="op" id="7340479">]</span><span class="builtintype" id="7340480">string</span><span class="op" id="7340486">{</span><span class="string" id="7340487">&#34;hi&#34;</span><span class="op" id="7340491">,</span>&nbsp;<span class="string" id="7340493">&#34;&#34;</span><span class="op" id="7340495">,</span>&nbsp;<span class="string" id="7340497">&#34;there&#34;</span><span class="op" id="7340504">}</span><span class="op" id="7340505">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7340509">[</span><span class="op" id="7340510">]</span><span class="builtintype" id="7340511">float64</span><span class="op" id="7340518">{</span><span class="num" id="7340519">0</span><span class="op" id="7340520">,</span>&nbsp;<span class="num" id="7340522">0</span><span class="op" id="7340523">,</span>&nbsp;<span class="num" id="7340525">1</span><span class="op" id="7340526">}</span><span class="op" id="7340527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7340530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7340533">var</span>&nbsp;<span class="ident" id="7340537">t7p</span>&nbsp;<span class="ident" id="7340541">Type7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7340548">if</span>&nbsp;<span class="ident" id="7340551">err</span>&nbsp;<span class="op" id="7340555">:=</span>&nbsp;<span class="ident" id="7340558">encAndDec</span><span class="op" id="7340567">(</span><span class="ident" id="7340568">t7</span><span class="op" id="7340570">,</span>&nbsp;<span class="op" id="7340572">&amp;</span><span class="ident" id="7340573">t7p</span><span class="op" id="7340576">)</span><span class="op" id="7340577">;</span>&nbsp;<span class="ident" id="7340579">err</span>&nbsp;<span class="op" id="7340583">!=</span>&nbsp;<span class="ident" id="7340586">nil</span>&nbsp;<span class="op" id="7340590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7340594">t</span><span class="op" id="7340595">.</span><span class="ident" id="7340596">Error</span><span class="op" id="7340601">(</span><span class="ident" id="7340602">err</span><span class="op" id="7340605">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7340608">}</span><br>
<span class="lineno"></span><span class="op" id="7340610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7340613">var</span>&nbsp;<span class="ident" id="7340617">testInt</span>&nbsp;<span class="builtintype" id="7340625">int</span><br>
<span class="lineno"></span><span class="keyword" id="7340629">var</span>&nbsp;<span class="ident" id="7340633">testFloat32</span>&nbsp;<span class="builtintype" id="7340645">float32</span><br>
<span class="lineno">365</span><span class="keyword" id="7340653">var</span>&nbsp;<span class="ident" id="7340657">testString</span>&nbsp;<span class="builtintype" id="7340668">string</span><br>
<span class="lineno"></span><span class="keyword" id="7340675">var</span>&nbsp;<span class="ident" id="7340679">testSlice</span>&nbsp;<span class="op" id="7340689">[</span><span class="op" id="7340690">]</span><span class="builtintype" id="7340691">string</span><br>
<span class="lineno"></span><span class="keyword" id="7340698">var</span>&nbsp;<span class="ident" id="7340702">testMap</span>&nbsp;<span class="keyword" id="7340710">map</span><span class="op" id="7340713">[</span><span class="builtintype" id="7340714">string</span><span class="op" id="7340720">]</span><span class="builtintype" id="7340721">int</span><br>
<span class="lineno"></span><span class="keyword" id="7340725">var</span>&nbsp;<span class="ident" id="7340729">testArray</span>&nbsp;<span class="op" id="7340739">[</span><span class="num" id="7340740">7</span><span class="op" id="7340741">]</span><span class="builtintype" id="7340742">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="7340747">type</span>&nbsp;<span class="ident" id="7340752">SingleTest</span>&nbsp;<span class="keyword" id="7340763">struct</span>&nbsp;<span class="op" id="7340770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7340773">in</span>&nbsp;&nbsp;<span class="keyword" id="7340777">interface</span><span class="op" id="7340786">{</span><span class="op" id="7340787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7340790">out</span>&nbsp;<span class="keyword" id="7340794">interface</span><span class="op" id="7340803">{</span><span class="op" id="7340804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7340807">err</span>&nbsp;<span class="builtintype" id="7340811">string</span><br>
<span class="lineno"></span><span class="op" id="7340818">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="7340821">var</span>&nbsp;<span class="ident" id="7340825">singleTests</span>&nbsp;<span class="op" id="7340837">=</span>&nbsp;<span class="op" id="7340839">[</span><span class="op" id="7340840">]</span><span class="ident" id="7340841">SingleTest</span><span class="op" id="7340851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7340854">{</span><span class="num" id="7340855">17</span><span class="op" id="7340857">,</span>&nbsp;<span class="op" id="7340859">&amp;</span><span class="ident" id="7340860">testInt</span><span class="op" id="7340867">,</span>&nbsp;<span class="string" id="7340869">&#34;&#34;</span><span class="op" id="7340871">}</span><span class="op" id="7340872">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7340875">{</span><span class="builtintype" id="7340876">float32</span><span class="op" id="7340883">(</span><span class="num" id="7340884">17.5</span><span class="op" id="7340888">)</span><span class="op" id="7340889">,</span>&nbsp;<span class="op" id="7340891">&amp;</span><span class="ident" id="7340892">testFloat32</span><span class="op" id="7340903">,</span>&nbsp;<span class="string" id="7340905">&#34;&#34;</span><span class="op" id="7340907">}</span><span class="op" id="7340908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7340911">{</span><span class="string" id="7340912">&#34;bike&nbsp;shed&#34;</span><span class="op" id="7340923">,</span>&nbsp;<span class="op" id="7340925">&amp;</span><span class="ident" id="7340926">testString</span><span class="op" id="7340936">,</span>&nbsp;<span class="string" id="7340938">&#34;&#34;</span><span class="op" id="7340940">}</span><span class="op" id="7340941">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7340944">{</span><span class="op" id="7340945">[</span><span class="op" id="7340946">]</span><span class="builtintype" id="7340947">string</span><span class="op" id="7340953">{</span><span class="string" id="7340954">&#34;bike&#34;</span><span class="op" id="7340960">,</span>&nbsp;<span class="string" id="7340962">&#34;shed&#34;</span><span class="op" id="7340968">,</span>&nbsp;<span class="string" id="7340970">&#34;paint&#34;</span><span class="op" id="7340977">,</span>&nbsp;<span class="string" id="7340979">&#34;color&#34;</span><span class="op" id="7340986">}</span><span class="op" id="7340987">,</span>&nbsp;<span class="op" id="7340989">&amp;</span><span class="ident" id="7340990">testSlice</span><span class="op" id="7340999">,</span>&nbsp;<span class="string" id="7341001">&#34;&#34;</span><span class="op" id="7341003">}</span><span class="op" id="7341004">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7341007">{</span><span class="keyword" id="7341008">map</span><span class="op" id="7341011">[</span><span class="builtintype" id="7341012">string</span><span class="op" id="7341018">]</span><span class="builtintype" id="7341019">int</span><span class="op" id="7341022">{</span><span class="string" id="7341023">&#34;seven&#34;</span><span class="op" id="7341030">:</span>&nbsp;<span class="num" id="7341032">7</span><span class="op" id="7341033">,</span>&nbsp;<span class="string" id="7341035">&#34;twelve&#34;</span><span class="op" id="7341043">:</span>&nbsp;<span class="num" id="7341045">12</span><span class="op" id="7341047">}</span><span class="op" id="7341048">,</span>&nbsp;<span class="op" id="7341050">&amp;</span><span class="ident" id="7341051">testMap</span><span class="op" id="7341058">,</span>&nbsp;<span class="string" id="7341060">&#34;&#34;</span><span class="op" id="7341062">}</span><span class="op" id="7341063">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7341066">{</span><span class="op" id="7341067">[</span><span class="num" id="7341068">7</span><span class="op" id="7341069">]</span><span class="builtintype" id="7341070">int</span><span class="op" id="7341073">{</span><span class="num" id="7341074">4</span><span class="op" id="7341075">,</span>&nbsp;<span class="num" id="7341077">55</span><span class="op" id="7341079">,</span>&nbsp;<span class="num" id="7341081">0</span><span class="op" id="7341082">,</span>&nbsp;<span class="num" id="7341084">0</span><span class="op" id="7341085">,</span>&nbsp;<span class="num" id="7341087">0</span><span class="op" id="7341088">,</span>&nbsp;<span class="num" id="7341090">0</span><span class="op" id="7341091">,</span>&nbsp;<span class="num" id="7341093">0</span><span class="op" id="7341094">}</span><span class="op" id="7341095">,</span>&nbsp;<span class="op" id="7341097">&amp;</span><span class="ident" id="7341098">testArray</span><span class="op" id="7341107">,</span>&nbsp;<span class="string" id="7341109">&#34;&#34;</span><span class="op" id="7341111">}</span><span class="op" id="7341112">,</span>&nbsp;<span class="comment" id="7341114">//&nbsp;case&nbsp;that&nbsp;once&nbsp;triggered&nbsp;a&nbsp;bug</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7341149">{</span><span class="op" id="7341150">[</span><span class="num" id="7341151">7</span><span class="op" id="7341152">]</span><span class="builtintype" id="7341153">int</span><span class="op" id="7341156">{</span><span class="num" id="7341157">4</span><span class="op" id="7341158">,</span>&nbsp;<span class="num" id="7341160">55</span><span class="op" id="7341162">,</span>&nbsp;<span class="num" id="7341164">1</span><span class="op" id="7341165">,</span>&nbsp;<span class="num" id="7341167">44</span><span class="op" id="7341169">,</span>&nbsp;<span class="num" id="7341171">22</span><span class="op" id="7341173">,</span>&nbsp;<span class="num" id="7341175">66</span><span class="op" id="7341177">,</span>&nbsp;<span class="num" id="7341179">1234</span><span class="op" id="7341183">}</span><span class="op" id="7341184">,</span>&nbsp;<span class="op" id="7341186">&amp;</span><span class="ident" id="7341187">testArray</span><span class="op" id="7341196">,</span>&nbsp;<span class="string" id="7341198">&#34;&#34;</span><span class="op" id="7341200">}</span><span class="op" id="7341201">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7341205">//&nbsp;Decode&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7341223">{</span><span class="num" id="7341224">172</span><span class="op" id="7341227">,</span>&nbsp;<span class="op" id="7341229">&amp;</span><span class="ident" id="7341230">testFloat32</span><span class="op" id="7341241">,</span>&nbsp;<span class="string" id="7341243">&#34;type&#34;</span><span class="op" id="7341249">}</span><span class="op" id="7341250">,</span><br>
<span class="lineno"></span><span class="op" id="7341252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7341255">func</span>&nbsp;<span class="ident" id="7341260">TestSingletons</span><span class="op" id="7341274">(</span><span class="ident" id="7341275">t</span>&nbsp;<span class="op" id="7341277">*</span><span class="ident" id="7341278">testing</span><span class="op" id="7341285">.</span><span class="ident" id="7341286">T</span><span class="op" id="7341287">)</span>&nbsp;<span class="op" id="7341289">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7341292">b</span>&nbsp;<span class="op" id="7341294">:=</span>&nbsp;<span class="builtinfunc" id="7341297">new</span><span class="op" id="7341300">(</span><span class="ident" id="7341301">bytes</span><span class="op" id="7341306">.</span><span class="ident" id="7341307">Buffer</span><span class="op" id="7341313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7341316">enc</span>&nbsp;<span class="op" id="7341320">:=</span>&nbsp;<span class="ident" id="7341323">NewEncoder</span><span class="op" id="7341333">(</span><span class="ident" id="7341334">b</span><span class="op" id="7341335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7341338">dec</span>&nbsp;<span class="op" id="7341342">:=</span>&nbsp;<span class="ident" id="7341345">NewDecoder</span><span class="op" id="7341355">(</span><span class="ident" id="7341356">b</span><span class="op" id="7341357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7341360">for</span>&nbsp;<span class="ident" id="7341364">_</span><span class="op" id="7341365">,</span>&nbsp;<span class="ident" id="7341367">test</span>&nbsp;<span class="op" id="7341372">:=</span>&nbsp;<span class="keyword" id="7341375">range</span>&nbsp;<span class="ident" id="7341381">singleTests</span>&nbsp;<span class="op" id="7341393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7341397">b</span><span class="op" id="7341398">.</span><span class="ident" id="7341399">Reset</span><span class="op" id="7341404">(</span><span class="op" id="7341405">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7341409">err</span>&nbsp;<span class="op" id="7341413">:=</span>&nbsp;<span class="ident" id="7341416">enc</span><span class="op" id="7341419">.</span><span class="ident" id="7341420">Encode</span><span class="op" id="7341426">(</span><span class="ident" id="7341427">test</span><span class="op" id="7341431">.</span><span class="ident" id="7341432">in</span><span class="op" id="7341434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7341438">if</span>&nbsp;<span class="ident" id="7341441">err</span>&nbsp;<span class="op" id="7341445">!=</span>&nbsp;<span class="ident" id="7341448">nil</span>&nbsp;<span class="op" id="7341452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7341457">t</span><span class="op" id="7341458">.</span><span class="ident" id="7341459">Errorf</span><span class="op" id="7341465">(</span><span class="string" id="7341466">&#34;error&nbsp;encoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="7341489">,</span>&nbsp;<span class="ident" id="7341491">test</span><span class="op" id="7341495">.</span><span class="ident" id="7341496">in</span><span class="op" id="7341498">,</span>&nbsp;<span class="ident" id="7341500">err</span><span class="op" id="7341503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7341508">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7341519">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7341523">err</span>&nbsp;<span class="op" id="7341527">=</span>&nbsp;<span class="ident" id="7341529">dec</span><span class="op" id="7341532">.</span><span class="ident" id="7341533">Decode</span><span class="op" id="7341539">(</span><span class="ident" id="7341540">test</span><span class="op" id="7341544">.</span><span class="ident" id="7341545">out</span><span class="op" id="7341548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7341552">switch</span>&nbsp;<span class="op" id="7341559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7341563">case</span>&nbsp;<span class="ident" id="7341568">err</span>&nbsp;<span class="op" id="7341572">!=</span>&nbsp;<span class="ident" id="7341575">nil</span>&nbsp;<span class="op" id="7341579">&amp;&amp;</span>&nbsp;<span class="ident" id="7341582">test</span><span class="op" id="7341586">.</span><span class="ident" id="7341587">err</span>&nbsp;<span class="op" id="7341591">==</span>&nbsp;<span class="string" id="7341594">&#34;&#34;</span><span class="op" id="7341596">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7341601">t</span><span class="op" id="7341602">.</span><span class="ident" id="7341603">Errorf</span><span class="op" id="7341609">(</span><span class="string" id="7341610">&#34;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="7341633">,</span>&nbsp;<span class="ident" id="7341635">test</span><span class="op" id="7341639">.</span><span class="ident" id="7341640">in</span><span class="op" id="7341642">,</span>&nbsp;<span class="ident" id="7341644">err</span><span class="op" id="7341647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7341652">continue</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7341663">case</span>&nbsp;<span class="ident" id="7341668">err</span>&nbsp;<span class="op" id="7341672">==</span>&nbsp;<span class="ident" id="7341675">nil</span>&nbsp;<span class="op" id="7341679">&amp;&amp;</span>&nbsp;<span class="ident" id="7341682">test</span><span class="op" id="7341686">.</span><span class="ident" id="7341687">err</span>&nbsp;<span class="op" id="7341691">!=</span>&nbsp;<span class="string" id="7341694">&#34;&#34;</span><span class="op" id="7341696">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7341701">t</span><span class="op" id="7341702">.</span><span class="ident" id="7341703">Errorf</span><span class="op" id="7341709">(</span><span class="string" id="7341710">&#34;expected&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="7341742">,</span>&nbsp;<span class="ident" id="7341744">test</span><span class="op" id="7341748">.</span><span class="ident" id="7341749">in</span><span class="op" id="7341751">,</span>&nbsp;<span class="ident" id="7341753">test</span><span class="op" id="7341757">.</span><span class="ident" id="7341758">err</span><span class="op" id="7341761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7341766">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7341777">case</span>&nbsp;<span class="ident" id="7341782">err</span>&nbsp;<span class="op" id="7341786">!=</span>&nbsp;<span class="ident" id="7341789">nil</span>&nbsp;<span class="op" id="7341793">&amp;&amp;</span>&nbsp;<span class="ident" id="7341796">test</span><span class="op" id="7341800">.</span><span class="ident" id="7341801">err</span>&nbsp;<span class="op" id="7341805">!=</span>&nbsp;<span class="string" id="7341808">&#34;&#34;</span><span class="op" id="7341810">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7341815">if</span>&nbsp;<span class="ident" id="7341818">strings</span><span class="op" id="7341825">.</span><span class="ident" id="7341826">Index</span><span class="op" id="7341831">(</span><span class="ident" id="7341832">err</span><span class="op" id="7341835">.</span><span class="ident" id="7341836">Error</span><span class="op" id="7341841">(</span><span class="op" id="7341842">)</span><span class="op" id="7341843">,</span>&nbsp;<span class="ident" id="7341845">test</span><span class="op" id="7341849">.</span><span class="ident" id="7341850">err</span><span class="op" id="7341853">)</span>&nbsp;<span class="op" id="7341855">&lt;</span>&nbsp;<span class="num" id="7341857">0</span>&nbsp;<span class="op" id="7341859">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7341865">t</span><span class="op" id="7341866">.</span><span class="ident" id="7341867">Errorf</span><span class="op" id="7341873">(</span><span class="string" id="7341874">&#34;wrong&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;wanted&nbsp;%s,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7341918">,</span>&nbsp;<span class="ident" id="7341920">test</span><span class="op" id="7341924">.</span><span class="ident" id="7341925">in</span><span class="op" id="7341927">,</span>&nbsp;<span class="ident" id="7341929">test</span><span class="op" id="7341933">.</span><span class="ident" id="7341934">err</span><span class="op" id="7341937">,</span>&nbsp;<span class="ident" id="7341939">err</span><span class="op" id="7341942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7341947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7341952">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7341963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7341967">//&nbsp;Get&nbsp;rid&nbsp;of&nbsp;the&nbsp;pointer&nbsp;in&nbsp;the&nbsp;rhs</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7342006">val</span>&nbsp;<span class="op" id="7342010">:=</span>&nbsp;<span class="ident" id="7342013">reflect</span><span class="op" id="7342020">.</span><span class="ident" id="7342021">ValueOf</span><span class="op" id="7342028">(</span><span class="ident" id="7342029">test</span><span class="op" id="7342033">.</span><span class="ident" id="7342034">out</span><span class="op" id="7342037">)</span><span class="op" id="7342038">.</span><span class="ident" id="7342039">Elem</span><span class="op" id="7342043">(</span><span class="op" id="7342044">)</span><span class="op" id="7342045">.</span><span class="ident" id="7342046">Interface</span><span class="op" id="7342055">(</span><span class="op" id="7342056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7342060">if</span>&nbsp;<span class="op" id="7342063">!</span><span class="ident" id="7342064">reflect</span><span class="op" id="7342071">.</span><span class="ident" id="7342072">DeepEqual</span><span class="op" id="7342081">(</span><span class="ident" id="7342082">test</span><span class="op" id="7342086">.</span><span class="ident" id="7342087">in</span><span class="op" id="7342089">,</span>&nbsp;<span class="ident" id="7342091">val</span><span class="op" id="7342094">)</span>&nbsp;<span class="op" id="7342096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7342101">t</span><span class="op" id="7342102">.</span><span class="ident" id="7342103">Errorf</span><span class="op" id="7342109">(</span><span class="string" id="7342110">&#34;decoding&nbsp;singleton:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7342150">,</span>&nbsp;<span class="ident" id="7342152">test</span><span class="op" id="7342156">.</span><span class="ident" id="7342157">in</span><span class="op" id="7342159">,</span>&nbsp;<span class="ident" id="7342161">val</span><span class="op" id="7342164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7342168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7342171">}</span><br>
<span class="lineno">420</span><span class="op" id="7342173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7342176">func</span>&nbsp;<span class="ident" id="7342181">TestStructNonStruct</span><span class="op" id="7342200">(</span><span class="ident" id="7342201">t</span>&nbsp;<span class="op" id="7342203">*</span><span class="ident" id="7342204">testing</span><span class="op" id="7342211">.</span><span class="ident" id="7342212">T</span><span class="op" id="7342213">)</span>&nbsp;<span class="op" id="7342215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7342218">type</span>&nbsp;<span class="ident" id="7342223">Struct</span>&nbsp;<span class="keyword" id="7342230">struct</span>&nbsp;<span class="op" id="7342237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7342241">A</span>&nbsp;<span class="builtintype" id="7342243">string</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7342251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7342254">type</span>&nbsp;<span class="ident" id="7342259">NonStruct</span>&nbsp;<span class="builtintype" id="7342269">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7342277">s</span>&nbsp;<span class="op" id="7342279">:=</span>&nbsp;<span class="ident" id="7342282">Struct</span><span class="op" id="7342288">{</span><span class="string" id="7342289">&#34;hello&#34;</span><span class="op" id="7342296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7342299">var</span>&nbsp;<span class="ident" id="7342303">sp</span>&nbsp;<span class="ident" id="7342306">Struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7342314">if</span>&nbsp;<span class="ident" id="7342317">err</span>&nbsp;<span class="op" id="7342321">:=</span>&nbsp;<span class="ident" id="7342324">encAndDec</span><span class="op" id="7342333">(</span><span class="ident" id="7342334">s</span><span class="op" id="7342335">,</span>&nbsp;<span class="op" id="7342337">&amp;</span><span class="ident" id="7342338">sp</span><span class="op" id="7342340">)</span><span class="op" id="7342341">;</span>&nbsp;<span class="ident" id="7342343">err</span>&nbsp;<span class="op" id="7342347">!=</span>&nbsp;<span class="ident" id="7342350">nil</span>&nbsp;<span class="op" id="7342354">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7342358">t</span><span class="op" id="7342359">.</span><span class="ident" id="7342360">Error</span><span class="op" id="7342365">(</span><span class="ident" id="7342366">err</span><span class="op" id="7342369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7342372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7342375">var</span>&nbsp;<span class="ident" id="7342379">ns</span>&nbsp;<span class="ident" id="7342382">NonStruct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7342393">if</span>&nbsp;<span class="ident" id="7342396">err</span>&nbsp;<span class="op" id="7342400">:=</span>&nbsp;<span class="ident" id="7342403">encAndDec</span><span class="op" id="7342412">(</span><span class="ident" id="7342413">s</span><span class="op" id="7342414">,</span>&nbsp;<span class="op" id="7342416">&amp;</span><span class="ident" id="7342417">ns</span><span class="op" id="7342419">)</span><span class="op" id="7342420">;</span>&nbsp;<span class="ident" id="7342422">err</span>&nbsp;<span class="op" id="7342426">==</span>&nbsp;<span class="ident" id="7342429">nil</span>&nbsp;<span class="op" id="7342433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7342437">t</span><span class="op" id="7342438">.</span><span class="ident" id="7342439">Error</span><span class="op" id="7342444">(</span><span class="string" id="7342445">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;struct/non-struct&#34;</span><span class="op" id="7342485">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7342488">}</span>&nbsp;<span class="keyword" id="7342490">else</span>&nbsp;<span class="keyword" id="7342495">if</span>&nbsp;<span class="ident" id="7342498">strings</span><span class="op" id="7342505">.</span><span class="ident" id="7342506">Index</span><span class="op" id="7342511">(</span><span class="ident" id="7342512">err</span><span class="op" id="7342515">.</span><span class="ident" id="7342516">Error</span><span class="op" id="7342521">(</span><span class="op" id="7342522">)</span><span class="op" id="7342523">,</span>&nbsp;<span class="string" id="7342525">&#34;type&#34;</span><span class="op" id="7342531">)</span>&nbsp;<span class="op" id="7342533">&lt;</span>&nbsp;<span class="num" id="7342535">0</span>&nbsp;<span class="op" id="7342537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7342541">t</span><span class="op" id="7342542">.</span><span class="ident" id="7342543">Error</span><span class="op" id="7342548">(</span><span class="string" id="7342549">&#34;for&nbsp;struct/non-struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7342597">,</span>&nbsp;<span class="ident" id="7342599">err</span><span class="op" id="7342602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7342605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7342608">//&nbsp;Now&nbsp;try&nbsp;the&nbsp;other&nbsp;way</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7342634">var</span>&nbsp;<span class="ident" id="7342638">nsp</span>&nbsp;<span class="ident" id="7342642">NonStruct</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7342653">if</span>&nbsp;<span class="ident" id="7342656">err</span>&nbsp;<span class="op" id="7342660">:=</span>&nbsp;<span class="ident" id="7342663">encAndDec</span><span class="op" id="7342672">(</span><span class="ident" id="7342673">ns</span><span class="op" id="7342675">,</span>&nbsp;<span class="op" id="7342677">&amp;</span><span class="ident" id="7342678">nsp</span><span class="op" id="7342681">)</span><span class="op" id="7342682">;</span>&nbsp;<span class="ident" id="7342684">err</span>&nbsp;<span class="op" id="7342688">!=</span>&nbsp;<span class="ident" id="7342691">nil</span>&nbsp;<span class="op" id="7342695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7342699">t</span><span class="op" id="7342700">.</span><span class="ident" id="7342701">Error</span><span class="op" id="7342706">(</span><span class="ident" id="7342707">err</span><span class="op" id="7342710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7342713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7342716">if</span>&nbsp;<span class="ident" id="7342719">err</span>&nbsp;<span class="op" id="7342723">:=</span>&nbsp;<span class="ident" id="7342726">encAndDec</span><span class="op" id="7342735">(</span><span class="ident" id="7342736">ns</span><span class="op" id="7342738">,</span>&nbsp;<span class="op" id="7342740">&amp;</span><span class="ident" id="7342741">s</span><span class="op" id="7342742">)</span><span class="op" id="7342743">;</span>&nbsp;<span class="ident" id="7342745">err</span>&nbsp;<span class="op" id="7342749">==</span>&nbsp;<span class="ident" id="7342752">nil</span>&nbsp;<span class="op" id="7342756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7342760">t</span><span class="op" id="7342761">.</span><span class="ident" id="7342762">Error</span><span class="op" id="7342767">(</span><span class="string" id="7342768">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;non-struct/struct&#34;</span><span class="op" id="7342808">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7342811">}</span>&nbsp;<span class="keyword" id="7342813">else</span>&nbsp;<span class="keyword" id="7342818">if</span>&nbsp;<span class="ident" id="7342821">strings</span><span class="op" id="7342828">.</span><span class="ident" id="7342829">Index</span><span class="op" id="7342834">(</span><span class="ident" id="7342835">err</span><span class="op" id="7342838">.</span><span class="ident" id="7342839">Error</span><span class="op" id="7342844">(</span><span class="op" id="7342845">)</span><span class="op" id="7342846">,</span>&nbsp;<span class="string" id="7342848">&#34;type&#34;</span><span class="op" id="7342854">)</span>&nbsp;<span class="op" id="7342856">&lt;</span>&nbsp;<span class="num" id="7342858">0</span>&nbsp;<span class="op" id="7342860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7342864">t</span><span class="op" id="7342865">.</span><span class="ident" id="7342866">Error</span><span class="op" id="7342871">(</span><span class="string" id="7342872">&#34;for&nbsp;non-struct/struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7342920">,</span>&nbsp;<span class="ident" id="7342922">err</span><span class="op" id="7342925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7342928">}</span><br>
<span class="lineno"></span><span class="op" id="7342930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="7342933">type</span>&nbsp;<span class="ident" id="7342938">interfaceIndirectTestI</span>&nbsp;<span class="keyword" id="7342961">interface</span>&nbsp;<span class="op" id="7342971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7342974">F</span><span class="op" id="7342975">(</span><span class="op" id="7342976">)</span>&nbsp;<span class="builtintype" id="7342978">bool</span><br>
<span class="lineno"></span><span class="op" id="7342983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7342986">type</span>&nbsp;<span class="ident" id="7342991">interfaceIndirectTestT</span>&nbsp;<span class="keyword" id="7343014">struct</span><span class="op" id="7343020">{</span><span class="op" id="7343021">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="7343024">func</span>&nbsp;<span class="op" id="7343029">(</span><span class="ident" id="7343030">this</span>&nbsp;<span class="op" id="7343035">*</span><span class="ident" id="7343036">interfaceIndirectTestT</span><span class="op" id="7343058">)</span>&nbsp;<span class="ident" id="7343060">F</span><span class="op" id="7343061">(</span><span class="op" id="7343062">)</span>&nbsp;<span class="builtintype" id="7343064">bool</span>&nbsp;<span class="op" id="7343069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7343072">return</span>&nbsp;<span class="ident" id="7343079">true</span><br>
<span class="lineno"></span><span class="op" id="7343084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="comment" id="7343087">//&nbsp;A&nbsp;version&nbsp;of&nbsp;a&nbsp;bug&nbsp;reported&nbsp;on&nbsp;golang-nuts.&nbsp;&nbsp;Also&nbsp;tests&nbsp;top-level</span><br>
<span class="lineno"></span><span class="comment" id="7343156">//&nbsp;slice&nbsp;of&nbsp;interfaces.&nbsp;&nbsp;The&nbsp;issue&nbsp;was&nbsp;registering&nbsp;*T&nbsp;caused&nbsp;T&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="7343225">//&nbsp;stored&nbsp;as&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="7343257">func</span>&nbsp;<span class="ident" id="7343262">TestInterfaceIndirect</span><span class="op" id="7343283">(</span><span class="ident" id="7343284">t</span>&nbsp;<span class="op" id="7343286">*</span><span class="ident" id="7343287">testing</span><span class="op" id="7343294">.</span><span class="ident" id="7343295">T</span><span class="op" id="7343296">)</span>&nbsp;<span class="op" id="7343298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7343301">Register</span><span class="op" id="7343309">(</span><span class="op" id="7343310">&amp;</span><span class="ident" id="7343311">interfaceIndirectTestT</span><span class="op" id="7343333">{</span><span class="op" id="7343334">}</span><span class="op" id="7343335">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7343338">b</span>&nbsp;<span class="op" id="7343340">:=</span>&nbsp;<span class="builtinfunc" id="7343343">new</span><span class="op" id="7343346">(</span><span class="ident" id="7343347">bytes</span><span class="op" id="7343352">.</span><span class="ident" id="7343353">Buffer</span><span class="op" id="7343359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7343362">w</span>&nbsp;<span class="op" id="7343364">:=</span>&nbsp;<span class="op" id="7343367">[</span><span class="op" id="7343368">]</span><span class="ident" id="7343369">interfaceIndirectTestI</span><span class="op" id="7343391">{</span><span class="op" id="7343392">&amp;</span><span class="ident" id="7343393">interfaceIndirectTestT</span><span class="op" id="7343415">{</span><span class="op" id="7343416">}</span><span class="op" id="7343417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7343420">err</span>&nbsp;<span class="op" id="7343424">:=</span>&nbsp;<span class="ident" id="7343427">NewEncoder</span><span class="op" id="7343437">(</span><span class="ident" id="7343438">b</span><span class="op" id="7343439">)</span><span class="op" id="7343440">.</span><span class="ident" id="7343441">Encode</span><span class="op" id="7343447">(</span><span class="ident" id="7343448">w</span><span class="op" id="7343449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7343452">if</span>&nbsp;<span class="ident" id="7343455">err</span>&nbsp;<span class="op" id="7343459">!=</span>&nbsp;<span class="ident" id="7343462">nil</span>&nbsp;<span class="op" id="7343466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7343470">t</span><span class="op" id="7343471">.</span><span class="ident" id="7343472">Fatal</span><span class="op" id="7343477">(</span><span class="string" id="7343478">&#34;encode&nbsp;error:&#34;</span><span class="op" id="7343493">,</span>&nbsp;<span class="ident" id="7343495">err</span><span class="op" id="7343498">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7343501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7343505">var</span>&nbsp;<span class="ident" id="7343509">r</span>&nbsp;<span class="op" id="7343511">[</span><span class="op" id="7343512">]</span><span class="ident" id="7343513">interfaceIndirectTestI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7343537">err</span>&nbsp;<span class="op" id="7343541">=</span>&nbsp;<span class="ident" id="7343543">NewDecoder</span><span class="op" id="7343553">(</span><span class="ident" id="7343554">b</span><span class="op" id="7343555">)</span><span class="op" id="7343556">.</span><span class="ident" id="7343557">Decode</span><span class="op" id="7343563">(</span><span class="op" id="7343564">&amp;</span><span class="ident" id="7343565">r</span><span class="op" id="7343566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7343569">if</span>&nbsp;<span class="ident" id="7343572">err</span>&nbsp;<span class="op" id="7343576">!=</span>&nbsp;<span class="ident" id="7343579">nil</span>&nbsp;<span class="op" id="7343583">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7343587">t</span><span class="op" id="7343588">.</span><span class="ident" id="7343589">Fatal</span><span class="op" id="7343594">(</span><span class="string" id="7343595">&#34;decode&nbsp;error:&#34;</span><span class="op" id="7343610">,</span>&nbsp;<span class="ident" id="7343612">err</span><span class="op" id="7343615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7343618">}</span><br>
<span class="lineno"></span><span class="op" id="7343620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7343623">//&nbsp;Now&nbsp;follow&nbsp;various&nbsp;tests&nbsp;that&nbsp;decode&nbsp;into&nbsp;things&nbsp;that&nbsp;can&#39;t&nbsp;represent&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="7343700">//&nbsp;encoded&nbsp;value,&nbsp;all&nbsp;of&nbsp;which&nbsp;should&nbsp;be&nbsp;legal.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7343749">//&nbsp;Also,&nbsp;when&nbsp;the&nbsp;ignored&nbsp;object&nbsp;contains&nbsp;an&nbsp;interface&nbsp;value,&nbsp;it&nbsp;may&nbsp;define</span><br>
<span class="lineno"></span><span class="comment" id="7343825">//&nbsp;types.&nbsp;Make&nbsp;sure&nbsp;that&nbsp;skipping&nbsp;the&nbsp;value&nbsp;still&nbsp;defines&nbsp;the&nbsp;types&nbsp;by&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="7343902">//&nbsp;the&nbsp;encoder/decoder&nbsp;pair&nbsp;to&nbsp;send&nbsp;a&nbsp;value&nbsp;afterwards.&nbsp;&nbsp;If&nbsp;an&nbsp;interface</span><br>
<span class="lineno">485</span><span class="comment" id="7343975">//&nbsp;is&nbsp;sent,&nbsp;its&nbsp;type&nbsp;in&nbsp;the&nbsp;test&nbsp;is&nbsp;always&nbsp;NewType0,&nbsp;so&nbsp;this&nbsp;checks&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7344052">//&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;don&#39;t&nbsp;skew&nbsp;with&nbsp;respect&nbsp;to&nbsp;type&nbsp;definitions.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7344121">type</span>&nbsp;<span class="ident" id="7344126">Struct0</span>&nbsp;<span class="keyword" id="7344134">struct</span>&nbsp;<span class="op" id="7344141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7344144">I</span>&nbsp;<span class="keyword" id="7344146">interface</span><span class="op" id="7344155">{</span><span class="op" id="7344156">}</span><br>
<span class="lineno">490</span><span class="op" id="7344158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7344161">type</span>&nbsp;<span class="ident" id="7344166">NewType0</span>&nbsp;<span class="keyword" id="7344175">struct</span>&nbsp;<span class="op" id="7344182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7344185">S</span>&nbsp;<span class="builtintype" id="7344187">string</span><br>
<span class="lineno"></span><span class="op" id="7344194">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="7344197">type</span>&nbsp;<span class="ident" id="7344202">ignoreTest</span>&nbsp;<span class="keyword" id="7344213">struct</span>&nbsp;<span class="op" id="7344220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7344223">in</span><span class="op" id="7344225">,</span>&nbsp;<span class="ident" id="7344227">out</span>&nbsp;<span class="keyword" id="7344231">interface</span><span class="op" id="7344240">{</span><span class="op" id="7344241">}</span><br>
<span class="lineno"></span><span class="op" id="7344243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="7344246">var</span>&nbsp;<span class="ident" id="7344250">ignoreTests</span>&nbsp;<span class="op" id="7344262">=</span>&nbsp;<span class="op" id="7344264">[</span><span class="op" id="7344265">]</span><span class="ident" id="7344266">ignoreTest</span><span class="op" id="7344276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7344279">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;an&nbsp;empty&nbsp;struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7344325">{</span><span class="op" id="7344326">&amp;</span><span class="keyword" id="7344327">struct</span><span class="op" id="7344333">{</span>&nbsp;<span class="ident" id="7344335">A</span>&nbsp;<span class="builtintype" id="7344337">int</span>&nbsp;<span class="op" id="7344341">}</span><span class="op" id="7344342">{</span><span class="num" id="7344343">23</span><span class="op" id="7344345">}</span><span class="op" id="7344346">,</span>&nbsp;<span class="op" id="7344348">&amp;</span><span class="keyword" id="7344349">struct</span><span class="op" id="7344355">{</span><span class="op" id="7344356">}</span><span class="op" id="7344357">{</span><span class="op" id="7344358">}</span><span class="op" id="7344359">}</span><span class="op" id="7344360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7344363">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7344400">{</span><span class="op" id="7344401">&amp;</span><span class="keyword" id="7344402">struct</span><span class="op" id="7344408">{</span>&nbsp;<span class="ident" id="7344410">A</span>&nbsp;<span class="builtintype" id="7344412">int</span>&nbsp;<span class="op" id="7344416">}</span><span class="op" id="7344417">{</span><span class="num" id="7344418">23</span><span class="op" id="7344420">}</span><span class="op" id="7344421">,</span>&nbsp;<span class="ident" id="7344423">nil</span><span class="op" id="7344426">}</span><span class="op" id="7344427">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7344430">//&nbsp;Decode&nbsp;singleton&nbsp;string&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7344470">{</span><span class="string" id="7344471">&#34;hello,&nbsp;world&#34;</span><span class="op" id="7344485">,</span>&nbsp;<span class="ident" id="7344487">nil</span><span class="op" id="7344490">}</span><span class="op" id="7344491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7344494">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7344533">{</span><span class="op" id="7344534">[</span><span class="op" id="7344535">]</span><span class="builtintype" id="7344536">int</span><span class="op" id="7344539">{</span><span class="num" id="7344540">1</span><span class="op" id="7344541">,</span>&nbsp;<span class="num" id="7344543">2</span><span class="op" id="7344544">,</span>&nbsp;<span class="num" id="7344546">3</span><span class="op" id="7344547">,</span>&nbsp;<span class="num" id="7344549">4</span><span class="op" id="7344550">}</span><span class="op" id="7344551">,</span>&nbsp;<span class="ident" id="7344553">nil</span><span class="op" id="7344556">}</span><span class="op" id="7344557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7344560">//&nbsp;Decode&nbsp;struct&nbsp;containing&nbsp;an&nbsp;interface&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7344614">{</span><span class="op" id="7344615">&amp;</span><span class="ident" id="7344616">Struct0</span><span class="op" id="7344623">{</span><span class="op" id="7344624">&amp;</span><span class="ident" id="7344625">NewType0</span><span class="op" id="7344633">{</span><span class="string" id="7344634">&#34;value0&#34;</span><span class="op" id="7344642">}</span><span class="op" id="7344643">}</span><span class="op" id="7344644">,</span>&nbsp;<span class="ident" id="7344646">nil</span><span class="op" id="7344649">}</span><span class="op" id="7344650">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7344653">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;of&nbsp;interfaces&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7344706">{</span><span class="op" id="7344707">[</span><span class="op" id="7344708">]</span><span class="keyword" id="7344709">interface</span><span class="op" id="7344718">{</span><span class="op" id="7344719">}</span><span class="op" id="7344720">{</span><span class="string" id="7344721">&#34;hi&#34;</span><span class="op" id="7344725">,</span>&nbsp;<span class="op" id="7344727">&amp;</span><span class="ident" id="7344728">NewType0</span><span class="op" id="7344736">{</span><span class="string" id="7344737">&#34;value1&#34;</span><span class="op" id="7344745">}</span><span class="op" id="7344746">,</span>&nbsp;<span class="num" id="7344748">23</span><span class="op" id="7344750">}</span><span class="op" id="7344751">,</span>&nbsp;<span class="ident" id="7344753">nil</span><span class="op" id="7344756">}</span><span class="op" id="7344757">,</span><br>
<span class="lineno"></span><span class="op" id="7344759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="7344762">func</span>&nbsp;<span class="ident" id="7344767">TestDecodeIntoNothing</span><span class="op" id="7344788">(</span><span class="ident" id="7344789">t</span>&nbsp;<span class="op" id="7344791">*</span><span class="ident" id="7344792">testing</span><span class="op" id="7344799">.</span><span class="ident" id="7344800">T</span><span class="op" id="7344801">)</span>&nbsp;<span class="op" id="7344803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7344806">Register</span><span class="op" id="7344814">(</span><span class="builtinfunc" id="7344815">new</span><span class="op" id="7344818">(</span><span class="ident" id="7344819">NewType0</span><span class="op" id="7344827">)</span><span class="op" id="7344828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7344831">for</span>&nbsp;<span class="ident" id="7344835">i</span><span class="op" id="7344836">,</span>&nbsp;<span class="ident" id="7344838">test</span>&nbsp;<span class="op" id="7344843">:=</span>&nbsp;<span class="keyword" id="7344846">range</span>&nbsp;<span class="ident" id="7344852">ignoreTests</span>&nbsp;<span class="op" id="7344864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7344868">b</span>&nbsp;<span class="op" id="7344870">:=</span>&nbsp;<span class="builtinfunc" id="7344873">new</span><span class="op" id="7344876">(</span><span class="ident" id="7344877">bytes</span><span class="op" id="7344882">.</span><span class="ident" id="7344883">Buffer</span><span class="op" id="7344889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7344893">enc</span>&nbsp;<span class="op" id="7344897">:=</span>&nbsp;<span class="ident" id="7344900">NewEncoder</span><span class="op" id="7344910">(</span><span class="ident" id="7344911">b</span><span class="op" id="7344912">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7344916">err</span>&nbsp;<span class="op" id="7344920">:=</span>&nbsp;<span class="ident" id="7344923">enc</span><span class="op" id="7344926">.</span><span class="ident" id="7344927">Encode</span><span class="op" id="7344933">(</span><span class="ident" id="7344934">test</span><span class="op" id="7344938">.</span><span class="ident" id="7344939">in</span><span class="op" id="7344941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7344945">if</span>&nbsp;<span class="ident" id="7344948">err</span>&nbsp;<span class="op" id="7344952">!=</span>&nbsp;<span class="ident" id="7344955">nil</span>&nbsp;<span class="op" id="7344959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7344964">t</span><span class="op" id="7344965">.</span><span class="ident" id="7344966">Errorf</span><span class="op" id="7344972">(</span><span class="string" id="7344973">&#34;%d:&nbsp;encode&nbsp;error&nbsp;%s:&#34;</span><span class="op" id="7344995">,</span>&nbsp;<span class="ident" id="7344997">i</span><span class="op" id="7344998">,</span>&nbsp;<span class="ident" id="7345000">err</span><span class="op" id="7345003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7345008">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7345019">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345023">dec</span>&nbsp;<span class="op" id="7345027">:=</span>&nbsp;<span class="ident" id="7345030">NewDecoder</span><span class="op" id="7345040">(</span><span class="ident" id="7345041">b</span><span class="op" id="7345042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345046">err</span>&nbsp;<span class="op" id="7345050">=</span>&nbsp;<span class="ident" id="7345052">dec</span><span class="op" id="7345055">.</span><span class="ident" id="7345056">Decode</span><span class="op" id="7345062">(</span><span class="ident" id="7345063">test</span><span class="op" id="7345067">.</span><span class="ident" id="7345068">out</span><span class="op" id="7345071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7345075">if</span>&nbsp;<span class="ident" id="7345078">err</span>&nbsp;<span class="op" id="7345082">!=</span>&nbsp;<span class="ident" id="7345085">nil</span>&nbsp;<span class="op" id="7345089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345094">t</span><span class="op" id="7345095">.</span><span class="ident" id="7345096">Errorf</span><span class="op" id="7345102">(</span><span class="string" id="7345103">&#34;%d:&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7345125">,</span>&nbsp;<span class="ident" id="7345127">i</span><span class="op" id="7345128">,</span>&nbsp;<span class="ident" id="7345130">err</span><span class="op" id="7345133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7345138">continue</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7345149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7345153">//&nbsp;Now&nbsp;see&nbsp;if&nbsp;the&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;are&nbsp;in&nbsp;a&nbsp;consistent&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345220">str</span>&nbsp;<span class="op" id="7345224">:=</span>&nbsp;<span class="ident" id="7345227">fmt</span><span class="op" id="7345230">.</span><span class="ident" id="7345231">Sprintf</span><span class="op" id="7345238">(</span><span class="string" id="7345239">&#34;Value&nbsp;%d&#34;</span><span class="op" id="7345249">,</span>&nbsp;<span class="ident" id="7345251">i</span><span class="op" id="7345252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345256">err</span>&nbsp;<span class="op" id="7345260">=</span>&nbsp;<span class="ident" id="7345262">enc</span><span class="op" id="7345265">.</span><span class="ident" id="7345266">Encode</span><span class="op" id="7345272">(</span><span class="op" id="7345273">&amp;</span><span class="ident" id="7345274">NewType0</span><span class="op" id="7345282">{</span><span class="ident" id="7345283">str</span><span class="op" id="7345286">}</span><span class="op" id="7345287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7345291">if</span>&nbsp;<span class="ident" id="7345294">err</span>&nbsp;<span class="op" id="7345298">!=</span>&nbsp;<span class="ident" id="7345301">nil</span>&nbsp;<span class="op" id="7345305">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345310">t</span><span class="op" id="7345311">.</span><span class="ident" id="7345312">Fatalf</span><span class="op" id="7345318">(</span><span class="string" id="7345319">&#34;%d:&nbsp;NewType0&nbsp;encode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7345350">,</span>&nbsp;<span class="ident" id="7345352">i</span><span class="op" id="7345353">,</span>&nbsp;<span class="ident" id="7345355">err</span><span class="op" id="7345358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7345362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345366">ns</span>&nbsp;<span class="op" id="7345369">:=</span>&nbsp;<span class="builtinfunc" id="7345372">new</span><span class="op" id="7345375">(</span><span class="ident" id="7345376">NewType0</span><span class="op" id="7345384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345388">err</span>&nbsp;<span class="op" id="7345392">=</span>&nbsp;<span class="ident" id="7345394">dec</span><span class="op" id="7345397">.</span><span class="ident" id="7345398">Decode</span><span class="op" id="7345404">(</span><span class="ident" id="7345405">ns</span><span class="op" id="7345407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7345411">if</span>&nbsp;<span class="ident" id="7345414">err</span>&nbsp;<span class="op" id="7345418">!=</span>&nbsp;<span class="ident" id="7345421">nil</span>&nbsp;<span class="op" id="7345425">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345430">t</span><span class="op" id="7345431">.</span><span class="ident" id="7345432">Fatalf</span><span class="op" id="7345438">(</span><span class="string" id="7345439">&#34;%d:&nbsp;NewType0&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7345470">,</span>&nbsp;<span class="ident" id="7345472">i</span><span class="op" id="7345473">,</span>&nbsp;<span class="ident" id="7345475">err</span><span class="op" id="7345478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7345482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7345486">if</span>&nbsp;<span class="ident" id="7345489">ns</span><span class="op" id="7345491">.</span><span class="ident" id="7345492">S</span>&nbsp;<span class="op" id="7345494">!=</span>&nbsp;<span class="ident" id="7345497">str</span>&nbsp;<span class="op" id="7345501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345506">t</span><span class="op" id="7345507">.</span><span class="ident" id="7345508">Fatalf</span><span class="op" id="7345514">(</span><span class="string" id="7345515">&#34;%d:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7345539">,</span>&nbsp;<span class="ident" id="7345541">i</span><span class="op" id="7345542">,</span>&nbsp;<span class="ident" id="7345544">str</span><span class="op" id="7345547">,</span>&nbsp;<span class="ident" id="7345549">ns</span><span class="op" id="7345551">.</span><span class="ident" id="7345552">S</span><span class="op" id="7345553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7345557">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7345560">}</span><br>
<span class="lineno"></span><span class="op" id="7345562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7345565">//&nbsp;Another&nbsp;bug&nbsp;from&nbsp;golang-nuts,&nbsp;involving&nbsp;nested&nbsp;interfaces.</span><br>
<span class="lineno"></span><span class="keyword" id="7345627">type</span>&nbsp;<span class="ident" id="7345632">Bug0Outer</span>&nbsp;<span class="keyword" id="7345642">struct</span>&nbsp;<span class="op" id="7345649">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345652">Bug0Field</span>&nbsp;<span class="keyword" id="7345662">interface</span><span class="op" id="7345671">{</span><span class="op" id="7345672">}</span><br>
<span class="lineno"></span><span class="op" id="7345674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7345677">type</span>&nbsp;<span class="ident" id="7345682">Bug0Inner</span>&nbsp;<span class="keyword" id="7345692">struct</span>&nbsp;<span class="op" id="7345699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345702">A</span>&nbsp;<span class="builtintype" id="7345704">int</span><br>
<span class="lineno">555</span><span class="op" id="7345708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7345711">func</span>&nbsp;<span class="ident" id="7345716">TestNestedInterfaces</span><span class="op" id="7345736">(</span><span class="ident" id="7345737">t</span>&nbsp;<span class="op" id="7345739">*</span><span class="ident" id="7345740">testing</span><span class="op" id="7345747">.</span><span class="ident" id="7345748">T</span><span class="op" id="7345749">)</span>&nbsp;<span class="op" id="7345751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7345754">var</span>&nbsp;<span class="ident" id="7345758">buf</span>&nbsp;<span class="ident" id="7345762">bytes</span><span class="op" id="7345767">.</span><span class="ident" id="7345768">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345776">e</span>&nbsp;<span class="op" id="7345778">:=</span>&nbsp;<span class="ident" id="7345781">NewEncoder</span><span class="op" id="7345791">(</span><span class="op" id="7345792">&amp;</span><span class="ident" id="7345793">buf</span><span class="op" id="7345796">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345799">d</span>&nbsp;<span class="op" id="7345801">:=</span>&nbsp;<span class="ident" id="7345804">NewDecoder</span><span class="op" id="7345814">(</span><span class="op" id="7345815">&amp;</span><span class="ident" id="7345816">buf</span><span class="op" id="7345819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345822">Register</span><span class="op" id="7345830">(</span><span class="builtinfunc" id="7345831">new</span><span class="op" id="7345834">(</span><span class="ident" id="7345835">Bug0Outer</span><span class="op" id="7345844">)</span><span class="op" id="7345845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345848">Register</span><span class="op" id="7345856">(</span><span class="builtinfunc" id="7345857">new</span><span class="op" id="7345860">(</span><span class="ident" id="7345861">Bug0Inner</span><span class="op" id="7345870">)</span><span class="op" id="7345871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345874">f</span>&nbsp;<span class="op" id="7345876">:=</span>&nbsp;<span class="op" id="7345879">&amp;</span><span class="ident" id="7345880">Bug0Outer</span><span class="op" id="7345889">{</span><span class="op" id="7345890">&amp;</span><span class="ident" id="7345891">Bug0Outer</span><span class="op" id="7345900">{</span><span class="op" id="7345901">&amp;</span><span class="ident" id="7345902">Bug0Inner</span><span class="op" id="7345911">{</span><span class="num" id="7345912">7</span><span class="op" id="7345913">}</span><span class="op" id="7345914">}</span><span class="op" id="7345915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7345918">var</span>&nbsp;<span class="ident" id="7345922">v</span>&nbsp;<span class="keyword" id="7345924">interface</span><span class="op" id="7345933">{</span><span class="op" id="7345934">}</span>&nbsp;<span class="op" id="7345936">=</span>&nbsp;<span class="ident" id="7345938">f</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345941">err</span>&nbsp;<span class="op" id="7345945">:=</span>&nbsp;<span class="ident" id="7345948">e</span><span class="op" id="7345949">.</span><span class="ident" id="7345950">Encode</span><span class="op" id="7345956">(</span><span class="op" id="7345957">&amp;</span><span class="ident" id="7345958">v</span><span class="op" id="7345959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7345962">if</span>&nbsp;<span class="ident" id="7345965">err</span>&nbsp;<span class="op" id="7345969">!=</span>&nbsp;<span class="ident" id="7345972">nil</span>&nbsp;<span class="op" id="7345976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345980">t</span><span class="op" id="7345981">.</span><span class="ident" id="7345982">Fatal</span><span class="op" id="7345987">(</span><span class="string" id="7345988">&#34;Encode:&#34;</span><span class="op" id="7345997">,</span>&nbsp;<span class="ident" id="7345999">err</span><span class="op" id="7346002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346008">err</span>&nbsp;<span class="op" id="7346012">=</span>&nbsp;<span class="ident" id="7346014">d</span><span class="op" id="7346015">.</span><span class="ident" id="7346016">Decode</span><span class="op" id="7346022">(</span><span class="op" id="7346023">&amp;</span><span class="ident" id="7346024">v</span><span class="op" id="7346025">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346028">if</span>&nbsp;<span class="ident" id="7346031">err</span>&nbsp;<span class="op" id="7346035">!=</span>&nbsp;<span class="ident" id="7346038">nil</span>&nbsp;<span class="op" id="7346042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346046">t</span><span class="op" id="7346047">.</span><span class="ident" id="7346048">Fatal</span><span class="op" id="7346053">(</span><span class="string" id="7346054">&#34;Decode:&#34;</span><span class="op" id="7346063">,</span>&nbsp;<span class="ident" id="7346065">err</span><span class="op" id="7346068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7346074">//&nbsp;Make&nbsp;sure&nbsp;it&nbsp;decoded&nbsp;correctly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346110">outer1</span><span class="op" id="7346116">,</span>&nbsp;<span class="ident" id="7346118">ok</span>&nbsp;<span class="op" id="7346121">:=</span>&nbsp;<span class="ident" id="7346124">v</span><span class="op" id="7346125">.</span><span class="op" id="7346126">(</span><span class="op" id="7346127">*</span><span class="ident" id="7346128">Bug0Outer</span><span class="op" id="7346137">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346140">if</span>&nbsp;<span class="op" id="7346143">!</span><span class="ident" id="7346144">ok</span>&nbsp;<span class="op" id="7346147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346151">t</span><span class="op" id="7346152">.</span><span class="ident" id="7346153">Fatalf</span><span class="op" id="7346159">(</span><span class="string" id="7346160">&#34;v&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="7346181">,</span>&nbsp;<span class="ident" id="7346183">v</span><span class="op" id="7346184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346190">outer2</span><span class="op" id="7346196">,</span>&nbsp;<span class="ident" id="7346198">ok</span>&nbsp;<span class="op" id="7346201">:=</span>&nbsp;<span class="ident" id="7346204">outer1</span><span class="op" id="7346210">.</span><span class="ident" id="7346211">Bug0Field</span><span class="op" id="7346220">.</span><span class="op" id="7346221">(</span><span class="op" id="7346222">*</span><span class="ident" id="7346223">Bug0Outer</span><span class="op" id="7346232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346235">if</span>&nbsp;<span class="op" id="7346238">!</span><span class="ident" id="7346239">ok</span>&nbsp;<span class="op" id="7346242">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346246">t</span><span class="op" id="7346247">.</span><span class="ident" id="7346248">Fatalf</span><span class="op" id="7346254">(</span><span class="string" id="7346255">&#34;v.Bug0Field&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="7346286">,</span>&nbsp;<span class="ident" id="7346288">outer1</span><span class="op" id="7346294">.</span><span class="ident" id="7346295">Bug0Field</span><span class="op" id="7346304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346310">inner</span><span class="op" id="7346315">,</span>&nbsp;<span class="ident" id="7346317">ok</span>&nbsp;<span class="op" id="7346320">:=</span>&nbsp;<span class="ident" id="7346323">outer2</span><span class="op" id="7346329">.</span><span class="ident" id="7346330">Bug0Field</span><span class="op" id="7346339">.</span><span class="op" id="7346340">(</span><span class="op" id="7346341">*</span><span class="ident" id="7346342">Bug0Inner</span><span class="op" id="7346351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346354">if</span>&nbsp;<span class="op" id="7346357">!</span><span class="ident" id="7346358">ok</span>&nbsp;<span class="op" id="7346361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346365">t</span><span class="op" id="7346366">.</span><span class="ident" id="7346367">Fatalf</span><span class="op" id="7346373">(</span><span class="string" id="7346374">&#34;v.Bug0Field.Bug0Field&nbsp;not&nbsp;Bug0Inner:&nbsp;%T&#34;</span><span class="op" id="7346415">,</span>&nbsp;<span class="ident" id="7346417">outer2</span><span class="op" id="7346423">.</span><span class="ident" id="7346424">Bug0Field</span><span class="op" id="7346433">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346439">if</span>&nbsp;<span class="ident" id="7346442">inner</span><span class="op" id="7346447">.</span><span class="ident" id="7346448">A</span>&nbsp;<span class="op" id="7346450">!=</span>&nbsp;<span class="num" id="7346453">7</span>&nbsp;<span class="op" id="7346455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346459">t</span><span class="op" id="7346460">.</span><span class="ident" id="7346461">Fatalf</span><span class="op" id="7346467">(</span><span class="string" id="7346468">&#34;final&nbsp;value&nbsp;%d;&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7346497">,</span>&nbsp;<span class="ident" id="7346499">inner</span><span class="op" id="7346504">.</span><span class="ident" id="7346505">A</span><span class="op" id="7346506">,</span>&nbsp;<span class="num" id="7346508">7</span><span class="op" id="7346509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346512">}</span><br>
<span class="lineno"></span><span class="op" id="7346514">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="7346517">//&nbsp;The&nbsp;bugs&nbsp;keep&nbsp;coming.&nbsp;We&nbsp;forgot&nbsp;to&nbsp;send&nbsp;map&nbsp;subtypes&nbsp;before&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7346590">type</span>&nbsp;<span class="ident" id="7346595">Bug1Elem</span>&nbsp;<span class="keyword" id="7346604">struct</span>&nbsp;<span class="op" id="7346611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346614">Name</span>&nbsp;<span class="builtintype" id="7346619">string</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346627">Id</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7346632">int</span><br>
<span class="lineno"></span><span class="op" id="7346636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7346639">type</span>&nbsp;<span class="ident" id="7346644">Bug1StructMap</span>&nbsp;<span class="keyword" id="7346658">map</span><span class="op" id="7346661">[</span><span class="builtintype" id="7346662">string</span><span class="op" id="7346668">]</span><span class="ident" id="7346669">Bug1Elem</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="keyword" id="7346679">func</span>&nbsp;<span class="ident" id="7346684">bug1EncDec</span><span class="op" id="7346694">(</span><span class="ident" id="7346695">in</span>&nbsp;<span class="ident" id="7346698">Bug1StructMap</span><span class="op" id="7346711">,</span>&nbsp;<span class="ident" id="7346713">out</span>&nbsp;<span class="op" id="7346717">*</span><span class="ident" id="7346718">Bug1StructMap</span><span class="op" id="7346731">)</span>&nbsp;<span class="builtintype" id="7346733">error</span>&nbsp;<span class="op" id="7346739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346742">return</span>&nbsp;<span class="ident" id="7346749">nil</span><br>
<span class="lineno"></span><span class="op" id="7346753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7346756">func</span>&nbsp;<span class="ident" id="7346761">TestMapBug1</span><span class="op" id="7346772">(</span><span class="ident" id="7346773">t</span>&nbsp;<span class="op" id="7346775">*</span><span class="ident" id="7346776">testing</span><span class="op" id="7346783">.</span><span class="ident" id="7346784">T</span><span class="op" id="7346785">)</span>&nbsp;<span class="op" id="7346787">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346790">in</span>&nbsp;<span class="op" id="7346793">:=</span>&nbsp;<span class="builtinfunc" id="7346796">make</span><span class="op" id="7346800">(</span><span class="ident" id="7346801">Bug1StructMap</span><span class="op" id="7346814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346817">in</span><span class="op" id="7346819">[</span><span class="string" id="7346820">&#34;val1&#34;</span><span class="op" id="7346826">]</span>&nbsp;<span class="op" id="7346828">=</span>&nbsp;<span class="ident" id="7346830">Bug1Elem</span><span class="op" id="7346838">{</span><span class="string" id="7346839">&#34;elem1&#34;</span><span class="op" id="7346846">,</span>&nbsp;<span class="num" id="7346848">1</span><span class="op" id="7346849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346852">in</span><span class="op" id="7346854">[</span><span class="string" id="7346855">&#34;val2&#34;</span><span class="op" id="7346861">]</span>&nbsp;<span class="op" id="7346863">=</span>&nbsp;<span class="ident" id="7346865">Bug1Elem</span><span class="op" id="7346873">{</span><span class="string" id="7346874">&#34;elem2&#34;</span><span class="op" id="7346881">,</span>&nbsp;<span class="num" id="7346883">2</span><span class="op" id="7346884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346888">b</span>&nbsp;<span class="op" id="7346890">:=</span>&nbsp;<span class="builtinfunc" id="7346893">new</span><span class="op" id="7346896">(</span><span class="ident" id="7346897">bytes</span><span class="op" id="7346902">.</span><span class="ident" id="7346903">Buffer</span><span class="op" id="7346909">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346912">enc</span>&nbsp;<span class="op" id="7346916">:=</span>&nbsp;<span class="ident" id="7346919">NewEncoder</span><span class="op" id="7346929">(</span><span class="ident" id="7346930">b</span><span class="op" id="7346931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346934">err</span>&nbsp;<span class="op" id="7346938">:=</span>&nbsp;<span class="ident" id="7346941">enc</span><span class="op" id="7346944">.</span><span class="ident" id="7346945">Encode</span><span class="op" id="7346951">(</span><span class="ident" id="7346952">in</span><span class="op" id="7346954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346957">if</span>&nbsp;<span class="ident" id="7346960">err</span>&nbsp;<span class="op" id="7346964">!=</span>&nbsp;<span class="ident" id="7346967">nil</span>&nbsp;<span class="op" id="7346971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346975">t</span><span class="op" id="7346976">.</span><span class="ident" id="7346977">Fatal</span><span class="op" id="7346982">(</span><span class="string" id="7346983">&#34;encode:&#34;</span><span class="op" id="7346992">,</span>&nbsp;<span class="ident" id="7346994">err</span><span class="op" id="7346997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347000">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347003">dec</span>&nbsp;<span class="op" id="7347007">:=</span>&nbsp;<span class="ident" id="7347010">NewDecoder</span><span class="op" id="7347020">(</span><span class="ident" id="7347021">b</span><span class="op" id="7347022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347025">out</span>&nbsp;<span class="op" id="7347029">:=</span>&nbsp;<span class="builtinfunc" id="7347032">make</span><span class="op" id="7347036">(</span><span class="ident" id="7347037">Bug1StructMap</span><span class="op" id="7347050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347053">err</span>&nbsp;<span class="op" id="7347057">=</span>&nbsp;<span class="ident" id="7347059">dec</span><span class="op" id="7347062">.</span><span class="ident" id="7347063">Decode</span><span class="op" id="7347069">(</span><span class="op" id="7347070">&amp;</span><span class="ident" id="7347071">out</span><span class="op" id="7347074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7347077">if</span>&nbsp;<span class="ident" id="7347080">err</span>&nbsp;<span class="op" id="7347084">!=</span>&nbsp;<span class="ident" id="7347087">nil</span>&nbsp;<span class="op" id="7347091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347095">t</span><span class="op" id="7347096">.</span><span class="ident" id="7347097">Fatal</span><span class="op" id="7347102">(</span><span class="string" id="7347103">&#34;decode:&#34;</span><span class="op" id="7347112">,</span>&nbsp;<span class="ident" id="7347114">err</span><span class="op" id="7347117">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7347123">if</span>&nbsp;<span class="op" id="7347126">!</span><span class="ident" id="7347127">reflect</span><span class="op" id="7347134">.</span><span class="ident" id="7347135">DeepEqual</span><span class="op" id="7347144">(</span><span class="ident" id="7347145">in</span><span class="op" id="7347147">,</span>&nbsp;<span class="ident" id="7347149">out</span><span class="op" id="7347152">)</span>&nbsp;<span class="op" id="7347154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347158">t</span><span class="op" id="7347159">.</span><span class="ident" id="7347160">Errorf</span><span class="op" id="7347166">(</span><span class="string" id="7347167">&#34;mismatch:&nbsp;%v&nbsp;%v&#34;</span><span class="op" id="7347184">,</span>&nbsp;<span class="ident" id="7347186">in</span><span class="op" id="7347188">,</span>&nbsp;<span class="ident" id="7347190">out</span><span class="op" id="7347193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347196">}</span><br>
<span class="lineno"></span><span class="op" id="7347198">}</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span><span class="keyword" id="7347201">func</span>&nbsp;<span class="ident" id="7347206">TestGobMapInterfaceEncode</span><span class="op" id="7347231">(</span><span class="ident" id="7347232">t</span>&nbsp;<span class="op" id="7347234">*</span><span class="ident" id="7347235">testing</span><span class="op" id="7347242">.</span><span class="ident" id="7347243">T</span><span class="op" id="7347244">)</span>&nbsp;<span class="op" id="7347246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347249">m</span>&nbsp;<span class="op" id="7347251">:=</span>&nbsp;<span class="keyword" id="7347254">map</span><span class="op" id="7347257">[</span><span class="builtintype" id="7347258">string</span><span class="op" id="7347264">]</span><span class="keyword" id="7347265">interface</span><span class="op" id="7347274">{</span><span class="op" id="7347275">}</span><span class="op" id="7347276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347280">&#34;up&#34;</span><span class="op" id="7347284">:</span>&nbsp;<span class="builtintype" id="7347286">uintptr</span><span class="op" id="7347293">(</span><span class="num" id="7347294">0</span><span class="op" id="7347295">)</span><span class="op" id="7347296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347300">&#34;i0&#34;</span><span class="op" id="7347304">:</span>&nbsp;<span class="op" id="7347306">[</span><span class="op" id="7347307">]</span><span class="builtintype" id="7347308">int</span><span class="op" id="7347311">{</span><span class="op" id="7347312">-</span><span class="num" id="7347313">1</span><span class="op" id="7347314">}</span><span class="op" id="7347315">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347319">&#34;i1&#34;</span><span class="op" id="7347323">:</span>&nbsp;<span class="op" id="7347325">[</span><span class="op" id="7347326">]</span><span class="builtintype" id="7347327">int8</span><span class="op" id="7347331">{</span><span class="op" id="7347332">-</span><span class="num" id="7347333">1</span><span class="op" id="7347334">}</span><span class="op" id="7347335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347339">&#34;i2&#34;</span><span class="op" id="7347343">:</span>&nbsp;<span class="op" id="7347345">[</span><span class="op" id="7347346">]</span><span class="builtintype" id="7347347">int16</span><span class="op" id="7347352">{</span><span class="op" id="7347353">-</span><span class="num" id="7347354">1</span><span class="op" id="7347355">}</span><span class="op" id="7347356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347360">&#34;i3&#34;</span><span class="op" id="7347364">:</span>&nbsp;<span class="op" id="7347366">[</span><span class="op" id="7347367">]</span><span class="builtintype" id="7347368">int32</span><span class="op" id="7347373">{</span><span class="op" id="7347374">-</span><span class="num" id="7347375">1</span><span class="op" id="7347376">}</span><span class="op" id="7347377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347381">&#34;i4&#34;</span><span class="op" id="7347385">:</span>&nbsp;<span class="op" id="7347387">[</span><span class="op" id="7347388">]</span><span class="ident" id="7347389">int64</span><span class="op" id="7347394">{</span><span class="op" id="7347395">-</span><span class="num" id="7347396">1</span><span class="op" id="7347397">}</span><span class="op" id="7347398">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347402">&#34;u0&#34;</span><span class="op" id="7347406">:</span>&nbsp;<span class="op" id="7347408">[</span><span class="op" id="7347409">]</span><span class="builtintype" id="7347410">uint</span><span class="op" id="7347414">{</span><span class="num" id="7347415">1</span><span class="op" id="7347416">}</span><span class="op" id="7347417">,</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347421">&#34;u1&#34;</span><span class="op" id="7347425">:</span>&nbsp;<span class="op" id="7347427">[</span><span class="op" id="7347428">]</span><span class="builtintype" id="7347429">uint8</span><span class="op" id="7347434">{</span><span class="num" id="7347435">1</span><span class="op" id="7347436">}</span><span class="op" id="7347437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347441">&#34;u2&#34;</span><span class="op" id="7347445">:</span>&nbsp;<span class="op" id="7347447">[</span><span class="op" id="7347448">]</span><span class="builtintype" id="7347449">uint16</span><span class="op" id="7347455">{</span><span class="num" id="7347456">1</span><span class="op" id="7347457">}</span><span class="op" id="7347458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347462">&#34;u3&#34;</span><span class="op" id="7347466">:</span>&nbsp;<span class="op" id="7347468">[</span><span class="op" id="7347469">]</span><span class="builtintype" id="7347470">uint32</span><span class="op" id="7347476">{</span><span class="num" id="7347477">1</span><span class="op" id="7347478">}</span><span class="op" id="7347479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347483">&#34;u4&#34;</span><span class="op" id="7347487">:</span>&nbsp;<span class="op" id="7347489">[</span><span class="op" id="7347490">]</span><span class="ident" id="7347491">uint64</span><span class="op" id="7347497">{</span><span class="num" id="7347498">1</span><span class="op" id="7347499">}</span><span class="op" id="7347500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347504">&#34;f0&#34;</span><span class="op" id="7347508">:</span>&nbsp;<span class="op" id="7347510">[</span><span class="op" id="7347511">]</span><span class="builtintype" id="7347512">float32</span><span class="op" id="7347519">{</span><span class="num" id="7347520">1</span><span class="op" id="7347521">}</span><span class="op" id="7347522">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347526">&#34;f1&#34;</span><span class="op" id="7347530">:</span>&nbsp;<span class="op" id="7347532">[</span><span class="op" id="7347533">]</span><span class="builtintype" id="7347534">float64</span><span class="op" id="7347541">{</span><span class="num" id="7347542">1</span><span class="op" id="7347543">}</span><span class="op" id="7347544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347548">&#34;c0&#34;</span><span class="op" id="7347552">:</span>&nbsp;<span class="op" id="7347554">[</span><span class="op" id="7347555">]</span><span class="builtintype" id="7347556">complex64</span><span class="op" id="7347565">{</span><span class="builtinfunc" id="7347566">complex</span><span class="op" id="7347573">(</span><span class="num" id="7347574">2</span><span class="op" id="7347575">,</span>&nbsp;<span class="op" id="7347577">-</span><span class="num" id="7347578">2</span><span class="op" id="7347579">)</span><span class="op" id="7347580">}</span><span class="op" id="7347581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347585">&#34;c1&#34;</span><span class="op" id="7347589">:</span>&nbsp;<span class="op" id="7347591">[</span><span class="op" id="7347592">]</span><span class="builtintype" id="7347593">complex128</span><span class="op" id="7347603">{</span><span class="builtinfunc" id="7347604">complex</span><span class="op" id="7347611">(</span><span class="num" id="7347612">2</span><span class="op" id="7347613">,</span>&nbsp;<span class="builtintype" id="7347615">float64</span><span class="op" id="7347622">(</span><span class="op" id="7347623">-</span><span class="num" id="7347624">2</span><span class="op" id="7347625">)</span><span class="op" id="7347626">)</span><span class="op" id="7347627">}</span><span class="op" id="7347628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347632">&#34;us&#34;</span><span class="op" id="7347636">:</span>&nbsp;<span class="op" id="7347638">[</span><span class="op" id="7347639">]</span><span class="builtintype" id="7347640">uintptr</span><span class="op" id="7347647">{</span><span class="num" id="7347648">0</span><span class="op" id="7347649">}</span><span class="op" id="7347650">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347654">&#34;bo&#34;</span><span class="op" id="7347658">:</span>&nbsp;<span class="op" id="7347660">[</span><span class="op" id="7347661">]</span><span class="builtintype" id="7347662">bool</span><span class="op" id="7347666">{</span><span class="ident" id="7347667">false</span><span class="op" id="7347672">}</span><span class="op" id="7347673">,</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347677">&#34;st&#34;</span><span class="op" id="7347681">:</span>&nbsp;<span class="op" id="7347683">[</span><span class="op" id="7347684">]</span><span class="builtintype" id="7347685">string</span><span class="op" id="7347691">{</span><span class="string" id="7347692">&#34;s&#34;</span><span class="op" id="7347695">}</span><span class="op" id="7347696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347702">enc</span>&nbsp;<span class="op" id="7347706">:=</span>&nbsp;<span class="ident" id="7347709">NewEncoder</span><span class="op" id="7347719">(</span><span class="builtinfunc" id="7347720">new</span><span class="op" id="7347723">(</span><span class="ident" id="7347724">bytes</span><span class="op" id="7347729">.</span><span class="ident" id="7347730">Buffer</span><span class="op" id="7347736">)</span><span class="op" id="7347737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347740">err</span>&nbsp;<span class="op" id="7347744">:=</span>&nbsp;<span class="ident" id="7347747">enc</span><span class="op" id="7347750">.</span><span class="ident" id="7347751">Encode</span><span class="op" id="7347757">(</span><span class="ident" id="7347758">m</span><span class="op" id="7347759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7347762">if</span>&nbsp;<span class="ident" id="7347765">err</span>&nbsp;<span class="op" id="7347769">!=</span>&nbsp;<span class="ident" id="7347772">nil</span>&nbsp;<span class="op" id="7347776">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347780">t</span><span class="op" id="7347781">.</span><span class="ident" id="7347782">Errorf</span><span class="op" id="7347788">(</span><span class="string" id="7347789">&#34;encode&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="7347805">,</span>&nbsp;<span class="ident" id="7347807">err</span><span class="op" id="7347810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347813">}</span><br>
<span class="lineno"></span><span class="op" id="7347815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7347818">func</span>&nbsp;<span class="ident" id="7347823">TestSliceReusesMemory</span><span class="op" id="7347844">(</span><span class="ident" id="7347845">t</span>&nbsp;<span class="op" id="7347847">*</span><span class="ident" id="7347848">testing</span><span class="op" id="7347855">.</span><span class="ident" id="7347856">T</span><span class="op" id="7347857">)</span>&nbsp;<span class="op" id="7347859">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347862">buf</span>&nbsp;<span class="op" id="7347866">:=</span>&nbsp;<span class="builtinfunc" id="7347869">new</span><span class="op" id="7347872">(</span><span class="ident" id="7347873">bytes</span><span class="op" id="7347878">.</span><span class="ident" id="7347879">Buffer</span><span class="op" id="7347885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7347888">//&nbsp;Bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347902">x</span>&nbsp;<span class="op" id="7347904">:=</span>&nbsp;<span class="op" id="7347907">[</span><span class="op" id="7347908">]</span><span class="builtintype" id="7347909">byte</span><span class="op" id="7347913">(</span><span class="string" id="7347914">&#34;abcd&#34;</span><span class="op" id="7347920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347924">enc</span>&nbsp;<span class="op" id="7347928">:=</span>&nbsp;<span class="ident" id="7347931">NewEncoder</span><span class="op" id="7347941">(</span><span class="ident" id="7347942">buf</span><span class="op" id="7347945">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347949">err</span>&nbsp;<span class="op" id="7347953">:=</span>&nbsp;<span class="ident" id="7347956">enc</span><span class="op" id="7347959">.</span><span class="ident" id="7347960">Encode</span><span class="op" id="7347966">(</span><span class="ident" id="7347967">x</span><span class="op" id="7347968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7347972">if</span>&nbsp;<span class="ident" id="7347975">err</span>&nbsp;<span class="op" id="7347979">!=</span>&nbsp;<span class="ident" id="7347982">nil</span>&nbsp;<span class="op" id="7347986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347991">t</span><span class="op" id="7347992">.</span><span class="ident" id="7347993">Errorf</span><span class="op" id="7347999">(</span><span class="string" id="7348000">&#34;bytes:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="7348019">,</span>&nbsp;<span class="ident" id="7348021">err</span><span class="op" id="7348024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7348028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7348032">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348073">y</span>&nbsp;<span class="op" id="7348075">:=</span>&nbsp;<span class="op" id="7348078">[</span><span class="op" id="7348079">]</span><span class="builtintype" id="7348080">byte</span><span class="op" id="7348084">(</span><span class="string" id="7348085">&#34;ABCDE&#34;</span><span class="op" id="7348092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348096">addr</span>&nbsp;<span class="op" id="7348101">:=</span>&nbsp;<span class="op" id="7348104">&amp;</span><span class="ident" id="7348105">y</span><span class="op" id="7348106">[</span><span class="num" id="7348107">0</span><span class="op" id="7348108">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348112">dec</span>&nbsp;<span class="op" id="7348116">:=</span>&nbsp;<span class="ident" id="7348119">NewDecoder</span><span class="op" id="7348129">(</span><span class="ident" id="7348130">buf</span><span class="op" id="7348133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348137">err</span>&nbsp;<span class="op" id="7348141">=</span>&nbsp;<span class="ident" id="7348143">dec</span><span class="op" id="7348146">.</span><span class="ident" id="7348147">Decode</span><span class="op" id="7348153">(</span><span class="op" id="7348154">&amp;</span><span class="ident" id="7348155">y</span><span class="op" id="7348156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7348160">if</span>&nbsp;<span class="ident" id="7348163">err</span>&nbsp;<span class="op" id="7348167">!=</span>&nbsp;<span class="ident" id="7348170">nil</span>&nbsp;<span class="op" id="7348174">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348179">t</span><span class="op" id="7348180">.</span><span class="ident" id="7348181">Fatal</span><span class="op" id="7348186">(</span><span class="string" id="7348187">&#34;bytes:&nbsp;decode:&#34;</span><span class="op" id="7348203">,</span>&nbsp;<span class="ident" id="7348205">err</span><span class="op" id="7348208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7348212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7348216">if</span>&nbsp;<span class="op" id="7348219">!</span><span class="ident" id="7348220">bytes</span><span class="op" id="7348225">.</span><span class="ident" id="7348226">Equal</span><span class="op" id="7348231">(</span><span class="ident" id="7348232">x</span><span class="op" id="7348233">,</span>&nbsp;<span class="ident" id="7348235">y</span><span class="op" id="7348236">)</span>&nbsp;<span class="op" id="7348238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348243">t</span><span class="op" id="7348244">.</span><span class="ident" id="7348245">Errorf</span><span class="op" id="7348251">(</span><span class="string" id="7348252">&#34;bytes:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="7348281">,</span>&nbsp;<span class="ident" id="7348283">x</span><span class="op" id="7348284">,</span>&nbsp;<span class="ident" id="7348286">y</span><span class="op" id="7348287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7348291">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7348295">if</span>&nbsp;<span class="ident" id="7348298">addr</span>&nbsp;<span class="op" id="7348303">!=</span>&nbsp;<span class="op" id="7348306">&amp;</span><span class="ident" id="7348307">y</span><span class="op" id="7348308">[</span><span class="num" id="7348309">0</span><span class="op" id="7348310">]</span>&nbsp;<span class="op" id="7348312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348317">t</span><span class="op" id="7348318">.</span><span class="ident" id="7348319">Errorf</span><span class="op" id="7348325">(</span><span class="string" id="7348326">&#34;bytes:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="7348359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7348363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7348366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7348369">//&nbsp;general&nbsp;slice</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7348387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348391">x</span>&nbsp;<span class="op" id="7348393">:=</span>&nbsp;<span class="op" id="7348396">[</span><span class="op" id="7348397">]</span><span class="builtintype" id="7348398">rune</span><span class="op" id="7348402">(</span><span class="string" id="7348403">&#34;abcd&#34;</span><span class="op" id="7348409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348413">enc</span>&nbsp;<span class="op" id="7348417">:=</span>&nbsp;<span class="ident" id="7348420">NewEncoder</span><span class="op" id="7348430">(</span><span class="ident" id="7348431">buf</span><span class="op" id="7348434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348438">err</span>&nbsp;<span class="op" id="7348442">:=</span>&nbsp;<span class="ident" id="7348445">enc</span><span class="op" id="7348448">.</span><span class="ident" id="7348449">Encode</span><span class="op" id="7348455">(</span><span class="ident" id="7348456">x</span><span class="op" id="7348457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7348461">if</span>&nbsp;<span class="ident" id="7348464">err</span>&nbsp;<span class="op" id="7348468">!=</span>&nbsp;<span class="ident" id="7348471">nil</span>&nbsp;<span class="op" id="7348475">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348480">t</span><span class="op" id="7348481">.</span><span class="ident" id="7348482">Errorf</span><span class="op" id="7348488">(</span><span class="string" id="7348489">&#34;ints:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="7348507">,</span>&nbsp;<span class="ident" id="7348509">err</span><span class="op" id="7348512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7348516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7348520">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348561">y</span>&nbsp;<span class="op" id="7348563">:=</span>&nbsp;<span class="op" id="7348566">[</span><span class="op" id="7348567">]</span><span class="builtintype" id="7348568">rune</span><span class="op" id="7348572">(</span><span class="string" id="7348573">&#34;ABCDE&#34;</span><span class="op" id="7348580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348584">addr</span>&nbsp;<span class="op" id="7348589">:=</span>&nbsp;<span class="op" id="7348592">&amp;</span><span class="ident" id="7348593">y</span><span class="op" id="7348594">[</span><span class="num" id="7348595">0</span><span class="op" id="7348596">]</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348600">dec</span>&nbsp;<span class="op" id="7348604">:=</span>&nbsp;<span class="ident" id="7348607">NewDecoder</span><span class="op" id="7348617">(</span><span class="ident" id="7348618">buf</span><span class="op" id="7348621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348625">err</span>&nbsp;<span class="op" id="7348629">=</span>&nbsp;<span class="ident" id="7348631">dec</span><span class="op" id="7348634">.</span><span class="ident" id="7348635">Decode</span><span class="op" id="7348641">(</span><span class="op" id="7348642">&amp;</span><span class="ident" id="7348643">y</span><span class="op" id="7348644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7348648">if</span>&nbsp;<span class="ident" id="7348651">err</span>&nbsp;<span class="op" id="7348655">!=</span>&nbsp;<span class="ident" id="7348658">nil</span>&nbsp;<span class="op" id="7348662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348667">t</span><span class="op" id="7348668">.</span><span class="ident" id="7348669">Fatal</span><span class="op" id="7348674">(</span><span class="string" id="7348675">&#34;ints:&nbsp;decode:&#34;</span><span class="op" id="7348690">,</span>&nbsp;<span class="ident" id="7348692">err</span><span class="op" id="7348695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7348699">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7348703">if</span>&nbsp;<span class="op" id="7348706">!</span><span class="ident" id="7348707">reflect</span><span class="op" id="7348714">.</span><span class="ident" id="7348715">DeepEqual</span><span class="op" id="7348724">(</span><span class="ident" id="7348725">x</span><span class="op" id="7348726">,</span>&nbsp;<span class="ident" id="7348728">y</span><span class="op" id="7348729">)</span>&nbsp;<span class="op" id="7348731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348736">t</span><span class="op" id="7348737">.</span><span class="ident" id="7348738">Errorf</span><span class="op" id="7348744">(</span><span class="string" id="7348745">&#34;ints:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="7348773">,</span>&nbsp;<span class="ident" id="7348775">x</span><span class="op" id="7348776">,</span>&nbsp;<span class="ident" id="7348778">y</span><span class="op" id="7348779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7348783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7348787">if</span>&nbsp;<span class="ident" id="7348790">addr</span>&nbsp;<span class="op" id="7348795">!=</span>&nbsp;<span class="op" id="7348798">&amp;</span><span class="ident" id="7348799">y</span><span class="op" id="7348800">[</span><span class="num" id="7348801">0</span><span class="op" id="7348802">]</span>&nbsp;<span class="op" id="7348804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348809">t</span><span class="op" id="7348810">.</span><span class="ident" id="7348811">Errorf</span><span class="op" id="7348817">(</span><span class="string" id="7348818">&#34;ints:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="7348850">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7348854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7348857">}</span><br>
<span class="lineno"></span><span class="op" id="7348859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7348862">//&nbsp;Used&nbsp;to&nbsp;crash:&nbsp;negative&nbsp;count&nbsp;in&nbsp;recvMessage.</span><br>
<span class="lineno">705</span><span class="keyword" id="7348911">func</span>&nbsp;<span class="ident" id="7348916">TestBadCount</span><span class="op" id="7348928">(</span><span class="ident" id="7348929">t</span>&nbsp;<span class="op" id="7348931">*</span><span class="ident" id="7348932">testing</span><span class="op" id="7348939">.</span><span class="ident" id="7348940">T</span><span class="op" id="7348941">)</span>&nbsp;<span class="op" id="7348943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7348946">b</span>&nbsp;<span class="op" id="7348948">:=</span>&nbsp;<span class="op" id="7348951">[</span><span class="op" id="7348952">]</span><span class="builtintype" id="7348953">byte</span><span class="op" id="7348957">{</span><span class="num" id="7348958">0xfb</span><span class="op" id="7348962">,</span>&nbsp;<span class="num" id="7348964">0xa5</span><span class="op" id="7348968">,</span>&nbsp;<span class="num" id="7348970">0x82</span><span class="op" id="7348974">,</span>&nbsp;<span class="num" id="7348976">0x2f</span><span class="op" id="7348980">,</span>&nbsp;<span class="num" id="7348982">0xca</span><span class="op" id="7348986">,</span>&nbsp;<span class="num" id="7348988">0x1</span><span class="op" id="7348991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7348994">if</span>&nbsp;<span class="ident" id="7348997">err</span>&nbsp;<span class="op" id="7349001">:=</span>&nbsp;<span class="ident" id="7349004">NewDecoder</span><span class="op" id="7349014">(</span><span class="ident" id="7349015">bytes</span><span class="op" id="7349020">.</span><span class="ident" id="7349021">NewReader</span><span class="op" id="7349030">(</span><span class="ident" id="7349031">b</span><span class="op" id="7349032">)</span><span class="op" id="7349033">)</span><span class="op" id="7349034">.</span><span class="ident" id="7349035">Decode</span><span class="op" id="7349041">(</span><span class="ident" id="7349042">nil</span><span class="op" id="7349045">)</span><span class="op" id="7349046">;</span>&nbsp;<span class="ident" id="7349048">err</span>&nbsp;<span class="op" id="7349052">==</span>&nbsp;<span class="ident" id="7349055">nil</span>&nbsp;<span class="op" id="7349059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349063">t</span><span class="op" id="7349064">.</span><span class="ident" id="7349065">Error</span><span class="op" id="7349070">(</span><span class="string" id="7349071">&#34;expected&nbsp;error&nbsp;from&nbsp;bad&nbsp;count&#34;</span><span class="op" id="7349102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7349105">}</span>&nbsp;<span class="keyword" id="7349107">else</span>&nbsp;<span class="keyword" id="7349112">if</span>&nbsp;<span class="ident" id="7349115">err</span><span class="op" id="7349118">.</span><span class="ident" id="7349119">Error</span><span class="op" id="7349124">(</span><span class="op" id="7349125">)</span>&nbsp;<span class="op" id="7349127">!=</span>&nbsp;<span class="ident" id="7349130">errBadCount</span><span class="op" id="7349141">.</span><span class="ident" id="7349142">Error</span><span class="op" id="7349147">(</span><span class="op" id="7349148">)</span>&nbsp;<span class="op" id="7349150">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349154">t</span><span class="op" id="7349155">.</span><span class="ident" id="7349156">Error</span><span class="op" id="7349161">(</span><span class="string" id="7349162">&#34;expected&nbsp;bad&nbsp;count&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7349193">,</span>&nbsp;<span class="ident" id="7349195">err</span><span class="op" id="7349198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7349201">}</span><br>
<span class="lineno"></span><span class="op" id="7349203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7349206">//&nbsp;Verify&nbsp;that&nbsp;sequential&nbsp;Decoders&nbsp;built&nbsp;on&nbsp;a&nbsp;single&nbsp;input&nbsp;will</span><br>
<span class="lineno">715</span><span class="comment" id="7349270">//&nbsp;succeed&nbsp;if&nbsp;the&nbsp;input&nbsp;implements&nbsp;ReadByte&nbsp;and&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="7349330">//&nbsp;type&nbsp;information&nbsp;in&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="7349365">func</span>&nbsp;<span class="ident" id="7349370">TestSequentialDecoder</span><span class="op" id="7349391">(</span><span class="ident" id="7349392">t</span>&nbsp;<span class="op" id="7349394">*</span><span class="ident" id="7349395">testing</span><span class="op" id="7349402">.</span><span class="ident" id="7349403">T</span><span class="op" id="7349404">)</span>&nbsp;<span class="op" id="7349406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349409">b</span>&nbsp;<span class="op" id="7349411">:=</span>&nbsp;<span class="builtinfunc" id="7349414">new</span><span class="op" id="7349417">(</span><span class="ident" id="7349418">bytes</span><span class="op" id="7349423">.</span><span class="ident" id="7349424">Buffer</span><span class="op" id="7349430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349433">enc</span>&nbsp;<span class="op" id="7349437">:=</span>&nbsp;<span class="ident" id="7349440">NewEncoder</span><span class="op" id="7349450">(</span><span class="ident" id="7349451">b</span><span class="op" id="7349452">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7349455">const</span>&nbsp;<span class="ident" id="7349461">count</span>&nbsp;<span class="op" id="7349467">=</span>&nbsp;<span class="num" id="7349469">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7349473">for</span>&nbsp;<span class="ident" id="7349477">i</span>&nbsp;<span class="op" id="7349479">:=</span>&nbsp;<span class="num" id="7349482">0</span><span class="op" id="7349483">;</span>&nbsp;<span class="ident" id="7349485">i</span>&nbsp;<span class="op" id="7349487">&lt;</span>&nbsp;<span class="ident" id="7349489">count</span><span class="op" id="7349494">;</span>&nbsp;<span class="ident" id="7349496">i</span><span class="op" id="7349497">++</span>&nbsp;<span class="op" id="7349500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349504">s</span>&nbsp;<span class="op" id="7349506">:=</span>&nbsp;<span class="ident" id="7349509">fmt</span><span class="op" id="7349512">.</span><span class="ident" id="7349513">Sprintf</span><span class="op" id="7349520">(</span><span class="string" id="7349521">&#34;%d&#34;</span><span class="op" id="7349525">,</span>&nbsp;<span class="ident" id="7349527">i</span><span class="op" id="7349528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7349532">if</span>&nbsp;<span class="ident" id="7349535">err</span>&nbsp;<span class="op" id="7349539">:=</span>&nbsp;<span class="ident" id="7349542">enc</span><span class="op" id="7349545">.</span><span class="ident" id="7349546">Encode</span><span class="op" id="7349552">(</span><span class="ident" id="7349553">s</span><span class="op" id="7349554">)</span><span class="op" id="7349555">;</span>&nbsp;<span class="ident" id="7349557">err</span>&nbsp;<span class="op" id="7349561">!=</span>&nbsp;<span class="ident" id="7349564">nil</span>&nbsp;<span class="op" id="7349568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349573">t</span><span class="op" id="7349574">.</span><span class="ident" id="7349575">Error</span><span class="op" id="7349580">(</span><span class="string" id="7349581">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="7349596">,</span>&nbsp;<span class="ident" id="7349598">err</span><span class="op" id="7349601">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7349605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7349608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7349611">for</span>&nbsp;<span class="ident" id="7349615">i</span>&nbsp;<span class="op" id="7349617">:=</span>&nbsp;<span class="num" id="7349620">0</span><span class="op" id="7349621">;</span>&nbsp;<span class="ident" id="7349623">i</span>&nbsp;<span class="op" id="7349625">&lt;</span>&nbsp;<span class="ident" id="7349627">count</span><span class="op" id="7349632">;</span>&nbsp;<span class="ident" id="7349634">i</span><span class="op" id="7349635">++</span>&nbsp;<span class="op" id="7349638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349642">dec</span>&nbsp;<span class="op" id="7349646">:=</span>&nbsp;<span class="ident" id="7349649">NewDecoder</span><span class="op" id="7349659">(</span><span class="ident" id="7349660">b</span><span class="op" id="7349661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7349665">var</span>&nbsp;<span class="ident" id="7349669">s</span>&nbsp;<span class="builtintype" id="7349671">string</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7349680">if</span>&nbsp;<span class="ident" id="7349683">err</span>&nbsp;<span class="op" id="7349687">:=</span>&nbsp;<span class="ident" id="7349690">dec</span><span class="op" id="7349693">.</span><span class="ident" id="7349694">Decode</span><span class="op" id="7349700">(</span><span class="op" id="7349701">&amp;</span><span class="ident" id="7349702">s</span><span class="op" id="7349703">)</span><span class="op" id="7349704">;</span>&nbsp;<span class="ident" id="7349706">err</span>&nbsp;<span class="op" id="7349710">!=</span>&nbsp;<span class="ident" id="7349713">nil</span>&nbsp;<span class="op" id="7349717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349722">t</span><span class="op" id="7349723">.</span><span class="ident" id="7349724">Fatal</span><span class="op" id="7349729">(</span><span class="string" id="7349730">&#34;decoder&nbsp;fail:&#34;</span><span class="op" id="7349745">,</span>&nbsp;<span class="ident" id="7349747">err</span><span class="op" id="7349750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7349754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7349758">if</span>&nbsp;<span class="ident" id="7349761">s</span>&nbsp;<span class="op" id="7349763">!=</span>&nbsp;<span class="ident" id="7349766">fmt</span><span class="op" id="7349769">.</span><span class="ident" id="7349770">Sprintf</span><span class="op" id="7349777">(</span><span class="string" id="7349778">&#34;%d&#34;</span><span class="op" id="7349782">,</span>&nbsp;<span class="ident" id="7349784">i</span><span class="op" id="7349785">)</span>&nbsp;<span class="op" id="7349787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349792">t</span><span class="op" id="7349793">.</span><span class="ident" id="7349794">Fatalf</span><span class="op" id="7349800">(</span><span class="string" id="7349801">&#34;decode&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%s&#34;</span><span class="op" id="7349828">,</span>&nbsp;<span class="ident" id="7349830">i</span><span class="op" id="7349831">,</span>&nbsp;<span class="ident" id="7349833">s</span><span class="op" id="7349834">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7349838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7349841">}</span><br>
<span class="lineno"></span><span class="op" id="7349843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7349846">//&nbsp;Should&nbsp;be&nbsp;able&nbsp;to&nbsp;have&nbsp;unrepresentable&nbsp;fields&nbsp;(chan,&nbsp;func,&nbsp;*chan&nbsp;etc.);&nbsp;we&nbsp;just&nbsp;ignore&nbsp;them.</span><br>
<span class="lineno">740</span><span class="keyword" id="7349942">type</span>&nbsp;<span class="ident" id="7349947">Bug2</span>&nbsp;<span class="keyword" id="7349952">struct</span>&nbsp;<span class="op" id="7349959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349962">A</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7349966">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349971">C</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="7349975">chan</span>&nbsp;<span class="builtintype" id="7349980">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349985">CP</span>&nbsp;&nbsp;<span class="op" id="7349989">*</span><span class="keyword" id="7349990">chan</span>&nbsp;<span class="builtintype" id="7349995">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350000">F</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="7350004">func</span><span class="op" id="7350008">(</span><span class="op" id="7350009">)</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350012">FPP</span>&nbsp;<span class="op" id="7350016">*</span><span class="op" id="7350017">*</span><span class="keyword" id="7350018">func</span><span class="op" id="7350022">(</span><span class="op" id="7350023">)</span><br>
<span class="lineno"></span><span class="op" id="7350025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7350028">func</span>&nbsp;<span class="ident" id="7350033">TestChanFuncIgnored</span><span class="op" id="7350052">(</span><span class="ident" id="7350053">t</span>&nbsp;<span class="op" id="7350055">*</span><span class="ident" id="7350056">testing</span><span class="op" id="7350063">.</span><span class="ident" id="7350064">T</span><span class="op" id="7350065">)</span>&nbsp;<span class="op" id="7350067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350070">c</span>&nbsp;<span class="op" id="7350072">:=</span>&nbsp;<span class="builtinfunc" id="7350075">make</span><span class="op" id="7350079">(</span><span class="keyword" id="7350080">chan</span>&nbsp;<span class="builtintype" id="7350085">int</span><span class="op" id="7350088">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350091">f</span>&nbsp;<span class="op" id="7350093">:=</span>&nbsp;<span class="keyword" id="7350096">func</span><span class="op" id="7350100">(</span><span class="op" id="7350101">)</span>&nbsp;<span class="op" id="7350103">{</span><span class="op" id="7350104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350107">fp</span>&nbsp;<span class="op" id="7350110">:=</span>&nbsp;<span class="op" id="7350113">&amp;</span><span class="ident" id="7350114">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350117">b0</span>&nbsp;<span class="op" id="7350120">:=</span>&nbsp;<span class="ident" id="7350123">Bug2</span><span class="op" id="7350127">{</span><span class="num" id="7350128">23</span><span class="op" id="7350130">,</span>&nbsp;<span class="ident" id="7350132">c</span><span class="op" id="7350133">,</span>&nbsp;<span class="op" id="7350135">&amp;</span><span class="ident" id="7350136">c</span><span class="op" id="7350137">,</span>&nbsp;<span class="ident" id="7350139">f</span><span class="op" id="7350140">,</span>&nbsp;<span class="op" id="7350142">&amp;</span><span class="ident" id="7350143">fp</span><span class="op" id="7350145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7350148">var</span>&nbsp;<span class="ident" id="7350152">buf</span>&nbsp;<span class="ident" id="7350156">bytes</span><span class="op" id="7350161">.</span><span class="ident" id="7350162">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350170">enc</span>&nbsp;<span class="op" id="7350174">:=</span>&nbsp;<span class="ident" id="7350177">NewEncoder</span><span class="op" id="7350187">(</span><span class="op" id="7350188">&amp;</span><span class="ident" id="7350189">buf</span><span class="op" id="7350192">)</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7350195">if</span>&nbsp;<span class="ident" id="7350198">err</span>&nbsp;<span class="op" id="7350202">:=</span>&nbsp;<span class="ident" id="7350205">enc</span><span class="op" id="7350208">.</span><span class="ident" id="7350209">Encode</span><span class="op" id="7350215">(</span><span class="ident" id="7350216">b0</span><span class="op" id="7350218">)</span><span class="op" id="7350219">;</span>&nbsp;<span class="ident" id="7350221">err</span>&nbsp;<span class="op" id="7350225">!=</span>&nbsp;<span class="ident" id="7350228">nil</span>&nbsp;<span class="op" id="7350232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350236">t</span><span class="op" id="7350237">.</span><span class="ident" id="7350238">Fatal</span><span class="op" id="7350243">(</span><span class="string" id="7350244">&#34;error&nbsp;encoding:&#34;</span><span class="op" id="7350261">,</span>&nbsp;<span class="ident" id="7350263">err</span><span class="op" id="7350266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7350269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7350272">var</span>&nbsp;<span class="ident" id="7350276">b1</span>&nbsp;<span class="ident" id="7350279">Bug2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350285">err</span>&nbsp;<span class="op" id="7350289">:=</span>&nbsp;<span class="ident" id="7350292">NewDecoder</span><span class="op" id="7350302">(</span><span class="op" id="7350303">&amp;</span><span class="ident" id="7350304">buf</span><span class="op" id="7350307">)</span><span class="op" id="7350308">.</span><span class="ident" id="7350309">Decode</span><span class="op" id="7350315">(</span><span class="op" id="7350316">&amp;</span><span class="ident" id="7350317">b1</span><span class="op" id="7350319">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7350322">if</span>&nbsp;<span class="ident" id="7350325">err</span>&nbsp;<span class="op" id="7350329">!=</span>&nbsp;<span class="ident" id="7350332">nil</span>&nbsp;<span class="op" id="7350336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350340">t</span><span class="op" id="7350341">.</span><span class="ident" id="7350342">Fatal</span><span class="op" id="7350347">(</span><span class="string" id="7350348">&#34;decode:&#34;</span><span class="op" id="7350357">,</span>&nbsp;<span class="ident" id="7350359">err</span><span class="op" id="7350362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7350365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7350368">if</span>&nbsp;<span class="ident" id="7350371">b1</span><span class="op" id="7350373">.</span><span class="ident" id="7350374">A</span>&nbsp;<span class="op" id="7350376">!=</span>&nbsp;<span class="ident" id="7350379">b0</span><span class="op" id="7350381">.</span><span class="ident" id="7350382">A</span>&nbsp;<span class="op" id="7350384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350388">t</span><span class="op" id="7350389">.</span><span class="ident" id="7350390">Fatalf</span><span class="op" id="7350396">(</span><span class="string" id="7350397">&#34;got&nbsp;%d&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7350413">,</span>&nbsp;<span class="ident" id="7350415">b1</span><span class="op" id="7350417">.</span><span class="ident" id="7350418">A</span><span class="op" id="7350419">,</span>&nbsp;<span class="ident" id="7350421">b0</span><span class="op" id="7350423">.</span><span class="ident" id="7350424">A</span><span class="op" id="7350425">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7350428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7350431">if</span>&nbsp;<span class="ident" id="7350434">b1</span><span class="op" id="7350436">.</span><span class="ident" id="7350437">C</span>&nbsp;<span class="op" id="7350439">!=</span>&nbsp;<span class="ident" id="7350442">nil</span>&nbsp;<span class="op" id="7350446">||</span>&nbsp;<span class="ident" id="7350449">b1</span><span class="op" id="7350451">.</span><span class="ident" id="7350452">CP</span>&nbsp;<span class="op" id="7350455">!=</span>&nbsp;<span class="ident" id="7350458">nil</span>&nbsp;<span class="op" id="7350462">||</span>&nbsp;<span class="ident" id="7350465">b1</span><span class="op" id="7350467">.</span><span class="ident" id="7350468">F</span>&nbsp;<span class="op" id="7350470">!=</span>&nbsp;<span class="ident" id="7350473">nil</span>&nbsp;<span class="op" id="7350477">||</span>&nbsp;<span class="ident" id="7350480">b1</span><span class="op" id="7350482">.</span><span class="ident" id="7350483">FPP</span>&nbsp;<span class="op" id="7350487">!=</span>&nbsp;<span class="ident" id="7350490">nil</span>&nbsp;<span class="op" id="7350494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350498">t</span><span class="op" id="7350499">.</span><span class="ident" id="7350500">Fatal</span><span class="op" id="7350505">(</span><span class="string" id="7350506">&#34;unexpected&nbsp;value&nbsp;for&nbsp;chan&nbsp;or&nbsp;func&#34;</span><span class="op" id="7350541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7350544">}</span><br>
<span class="lineno"></span><span class="op" id="7350546">}</span><br>
<span class="lineno">770</span><br>
<span class="lineno"></span><span class="keyword" id="7350549">func</span>&nbsp;<span class="ident" id="7350554">TestSliceIncompatibility</span><span class="op" id="7350578">(</span><span class="ident" id="7350579">t</span>&nbsp;<span class="op" id="7350581">*</span><span class="ident" id="7350582">testing</span><span class="op" id="7350589">.</span><span class="ident" id="7350590">T</span><span class="op" id="7350591">)</span>&nbsp;<span class="op" id="7350593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7350596">var</span>&nbsp;<span class="ident" id="7350600">in</span>&nbsp;<span class="op" id="7350603">=</span>&nbsp;<span class="op" id="7350605">[</span><span class="op" id="7350606">]</span><span class="builtintype" id="7350607">byte</span><span class="op" id="7350611">{</span><span class="num" id="7350612">1</span><span class="op" id="7350613">,</span>&nbsp;<span class="num" id="7350615">2</span><span class="op" id="7350616">,</span>&nbsp;<span class="num" id="7350618">3</span><span class="op" id="7350619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7350622">var</span>&nbsp;<span class="ident" id="7350626">out</span>&nbsp;<span class="op" id="7350630">[</span><span class="op" id="7350631">]</span><span class="builtintype" id="7350632">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7350637">if</span>&nbsp;<span class="ident" id="7350640">err</span>&nbsp;<span class="op" id="7350644">:=</span>&nbsp;<span class="ident" id="7350647">encAndDec</span><span class="op" id="7350656">(</span><span class="ident" id="7350657">in</span><span class="op" id="7350659">,</span>&nbsp;<span class="op" id="7350661">&amp;</span><span class="ident" id="7350662">out</span><span class="op" id="7350665">)</span><span class="op" id="7350666">;</span>&nbsp;<span class="ident" id="7350668">err</span>&nbsp;<span class="op" id="7350672">==</span>&nbsp;<span class="ident" id="7350675">nil</span>&nbsp;<span class="op" id="7350679">{</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350683">t</span><span class="op" id="7350684">.</span><span class="ident" id="7350685">Error</span><span class="op" id="7350690">(</span><span class="string" id="7350691">&#34;expected&nbsp;compatibility&nbsp;error&#34;</span><span class="op" id="7350721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7350724">}</span><br>
<span class="lineno"></span><span class="op" id="7350726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7350729">//&nbsp;Mutually&nbsp;recursive&nbsp;slices&nbsp;of&nbsp;structs&nbsp;caused&nbsp;problems.</span><br>
<span class="lineno">780</span><span class="keyword" id="7350786">type</span>&nbsp;<span class="ident" id="7350791">Bug3</span>&nbsp;<span class="keyword" id="7350796">struct</span>&nbsp;<span class="op" id="7350803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350806">Num</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7350815">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350820">Children</span>&nbsp;<span class="op" id="7350829">[</span><span class="op" id="7350830">]</span><span class="op" id="7350831">*</span><span class="ident" id="7350832">Bug3</span><br>
<span class="lineno"></span><span class="op" id="7350837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">785</span><span class="keyword" id="7350840">func</span>&nbsp;<span class="ident" id="7350845">TestGobPtrSlices</span><span class="op" id="7350861">(</span><span class="ident" id="7350862">t</span>&nbsp;<span class="op" id="7350864">*</span><span class="ident" id="7350865">testing</span><span class="op" id="7350872">.</span><span class="ident" id="7350873">T</span><span class="op" id="7350874">)</span>&nbsp;<span class="op" id="7350876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350879">in</span>&nbsp;<span class="op" id="7350882">:=</span>&nbsp;<span class="op" id="7350885">[</span><span class="op" id="7350886">]</span><span class="op" id="7350887">*</span><span class="ident" id="7350888">Bug3</span><span class="op" id="7350892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7350896">{</span><span class="num" id="7350897">1</span><span class="op" id="7350898">,</span>&nbsp;<span class="ident" id="7350900">nil</span><span class="op" id="7350903">}</span><span class="op" id="7350904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7350908">{</span><span class="num" id="7350909">2</span><span class="op" id="7350910">,</span>&nbsp;<span class="ident" id="7350912">nil</span><span class="op" id="7350915">}</span><span class="op" id="7350916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7350919">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350922">b</span>&nbsp;<span class="op" id="7350924">:=</span>&nbsp;<span class="builtinfunc" id="7350927">new</span><span class="op" id="7350930">(</span><span class="ident" id="7350931">bytes</span><span class="op" id="7350936">.</span><span class="ident" id="7350937">Buffer</span><span class="op" id="7350943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350946">err</span>&nbsp;<span class="op" id="7350950">:=</span>&nbsp;<span class="ident" id="7350953">NewEncoder</span><span class="op" id="7350963">(</span><span class="ident" id="7350964">b</span><span class="op" id="7350965">)</span><span class="op" id="7350966">.</span><span class="ident" id="7350967">Encode</span><span class="op" id="7350973">(</span><span class="op" id="7350974">&amp;</span><span class="ident" id="7350975">in</span><span class="op" id="7350977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7350980">if</span>&nbsp;<span class="ident" id="7350983">err</span>&nbsp;<span class="op" id="7350987">!=</span>&nbsp;<span class="ident" id="7350990">nil</span>&nbsp;<span class="op" id="7350994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350998">t</span><span class="op" id="7350999">.</span><span class="ident" id="7351000">Fatal</span><span class="op" id="7351005">(</span><span class="string" id="7351006">&#34;encode:&#34;</span><span class="op" id="7351015">,</span>&nbsp;<span class="ident" id="7351017">err</span><span class="op" id="7351020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7351023">}</span><br>
<span class="lineno">795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7351027">var</span>&nbsp;<span class="ident" id="7351031">out</span>&nbsp;<span class="op" id="7351035">[</span><span class="op" id="7351036">]</span><span class="op" id="7351037">*</span><span class="ident" id="7351038">Bug3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351044">err</span>&nbsp;<span class="op" id="7351048">=</span>&nbsp;<span class="ident" id="7351050">NewDecoder</span><span class="op" id="7351060">(</span><span class="ident" id="7351061">b</span><span class="op" id="7351062">)</span><span class="op" id="7351063">.</span><span class="ident" id="7351064">Decode</span><span class="op" id="7351070">(</span><span class="op" id="7351071">&amp;</span><span class="ident" id="7351072">out</span><span class="op" id="7351075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7351078">if</span>&nbsp;<span class="ident" id="7351081">err</span>&nbsp;<span class="op" id="7351085">!=</span>&nbsp;<span class="ident" id="7351088">nil</span>&nbsp;<span class="op" id="7351092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351096">t</span><span class="op" id="7351097">.</span><span class="ident" id="7351098">Fatal</span><span class="op" id="7351103">(</span><span class="string" id="7351104">&#34;decode:&#34;</span><span class="op" id="7351113">,</span>&nbsp;<span class="ident" id="7351115">err</span><span class="op" id="7351118">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7351121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7351124">if</span>&nbsp;<span class="op" id="7351127">!</span><span class="ident" id="7351128">reflect</span><span class="op" id="7351135">.</span><span class="ident" id="7351136">DeepEqual</span><span class="op" id="7351145">(</span><span class="ident" id="7351146">in</span><span class="op" id="7351148">,</span>&nbsp;<span class="ident" id="7351150">out</span><span class="op" id="7351153">)</span>&nbsp;<span class="op" id="7351155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351159">t</span><span class="op" id="7351160">.</span><span class="ident" id="7351161">Fatalf</span><span class="op" id="7351167">(</span><span class="string" id="7351168">&#34;got&nbsp;%v;&nbsp;wanted&nbsp;%v&#34;</span><span class="op" id="7351187">,</span>&nbsp;<span class="ident" id="7351189">out</span><span class="op" id="7351192">,</span>&nbsp;<span class="ident" id="7351194">in</span><span class="op" id="7351196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7351199">}</span><br>
<span class="lineno"></span><span class="op" id="7351201">}</span><br>
<span class="lineno">805</span><br>
<span class="lineno"></span><span class="comment" id="7351204">//&nbsp;getDecEnginePtr&nbsp;cached&nbsp;engine&nbsp;for&nbsp;ut.base&nbsp;instead&nbsp;of&nbsp;ut.user&nbsp;so&nbsp;we&nbsp;passed</span><br>
<span class="lineno"></span><span class="comment" id="7351281">//&nbsp;a&nbsp;*map&nbsp;and&nbsp;then&nbsp;tried&nbsp;to&nbsp;reuse&nbsp;its&nbsp;engine&nbsp;to&nbsp;decode&nbsp;the&nbsp;inner&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="7351351">func</span>&nbsp;<span class="ident" id="7351356">TestPtrToMapOfMap</span><span class="op" id="7351373">(</span><span class="ident" id="7351374">t</span>&nbsp;<span class="op" id="7351376">*</span><span class="ident" id="7351377">testing</span><span class="op" id="7351384">.</span><span class="ident" id="7351385">T</span><span class="op" id="7351386">)</span>&nbsp;<span class="op" id="7351388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351391">Register</span><span class="op" id="7351399">(</span><span class="builtinfunc" id="7351400">make</span><span class="op" id="7351404">(</span><span class="keyword" id="7351405">map</span><span class="op" id="7351408">[</span><span class="builtintype" id="7351409">string</span><span class="op" id="7351415">]</span><span class="keyword" id="7351416">interface</span><span class="op" id="7351425">{</span><span class="op" id="7351426">}</span><span class="op" id="7351427">)</span><span class="op" id="7351428">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351431">subdata</span>&nbsp;<span class="op" id="7351439">:=</span>&nbsp;<span class="builtinfunc" id="7351442">make</span><span class="op" id="7351446">(</span><span class="keyword" id="7351447">map</span><span class="op" id="7351450">[</span><span class="builtintype" id="7351451">string</span><span class="op" id="7351457">]</span><span class="keyword" id="7351458">interface</span><span class="op" id="7351467">{</span><span class="op" id="7351468">}</span><span class="op" id="7351469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351472">subdata</span><span class="op" id="7351479">[</span><span class="string" id="7351480">&#34;bar&#34;</span><span class="op" id="7351485">]</span>&nbsp;<span class="op" id="7351487">=</span>&nbsp;<span class="string" id="7351489">&#34;baz&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351496">data</span>&nbsp;<span class="op" id="7351501">:=</span>&nbsp;<span class="builtinfunc" id="7351504">make</span><span class="op" id="7351508">(</span><span class="keyword" id="7351509">map</span><span class="op" id="7351512">[</span><span class="builtintype" id="7351513">string</span><span class="op" id="7351519">]</span><span class="keyword" id="7351520">interface</span><span class="op" id="7351529">{</span><span class="op" id="7351530">}</span><span class="op" id="7351531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351534">data</span><span class="op" id="7351538">[</span><span class="string" id="7351539">&#34;foo&#34;</span><span class="op" id="7351544">]</span>&nbsp;<span class="op" id="7351546">=</span>&nbsp;<span class="ident" id="7351548">subdata</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351558">b</span>&nbsp;<span class="op" id="7351560">:=</span>&nbsp;<span class="builtinfunc" id="7351563">new</span><span class="op" id="7351566">(</span><span class="ident" id="7351567">bytes</span><span class="op" id="7351572">.</span><span class="ident" id="7351573">Buffer</span><span class="op" id="7351579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351582">err</span>&nbsp;<span class="op" id="7351586">:=</span>&nbsp;<span class="ident" id="7351589">NewEncoder</span><span class="op" id="7351599">(</span><span class="ident" id="7351600">b</span><span class="op" id="7351601">)</span><span class="op" id="7351602">.</span><span class="ident" id="7351603">Encode</span><span class="op" id="7351609">(</span><span class="ident" id="7351610">data</span><span class="op" id="7351614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7351617">if</span>&nbsp;<span class="ident" id="7351620">err</span>&nbsp;<span class="op" id="7351624">!=</span>&nbsp;<span class="ident" id="7351627">nil</span>&nbsp;<span class="op" id="7351631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351635">t</span><span class="op" id="7351636">.</span><span class="ident" id="7351637">Fatal</span><span class="op" id="7351642">(</span><span class="string" id="7351643">&#34;encode:&#34;</span><span class="op" id="7351652">,</span>&nbsp;<span class="ident" id="7351654">err</span><span class="op" id="7351657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7351660">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7351663">var</span>&nbsp;<span class="ident" id="7351667">newData</span>&nbsp;<span class="keyword" id="7351675">map</span><span class="op" id="7351678">[</span><span class="builtintype" id="7351679">string</span><span class="op" id="7351685">]</span><span class="keyword" id="7351686">interface</span><span class="op" id="7351695">{</span><span class="op" id="7351696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351699">err</span>&nbsp;<span class="op" id="7351703">=</span>&nbsp;<span class="ident" id="7351705">NewDecoder</span><span class="op" id="7351715">(</span><span class="ident" id="7351716">b</span><span class="op" id="7351717">)</span><span class="op" id="7351718">.</span><span class="ident" id="7351719">Decode</span><span class="op" id="7351725">(</span><span class="op" id="7351726">&amp;</span><span class="ident" id="7351727">newData</span><span class="op" id="7351734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7351737">if</span>&nbsp;<span class="ident" id="7351740">err</span>&nbsp;<span class="op" id="7351744">!=</span>&nbsp;<span class="ident" id="7351747">nil</span>&nbsp;<span class="op" id="7351751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351755">t</span><span class="op" id="7351756">.</span><span class="ident" id="7351757">Fatal</span><span class="op" id="7351762">(</span><span class="string" id="7351763">&#34;decode:&#34;</span><span class="op" id="7351772">,</span>&nbsp;<span class="ident" id="7351774">err</span><span class="op" id="7351777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7351780">}</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7351783">if</span>&nbsp;<span class="op" id="7351786">!</span><span class="ident" id="7351787">reflect</span><span class="op" id="7351794">.</span><span class="ident" id="7351795">DeepEqual</span><span class="op" id="7351804">(</span><span class="ident" id="7351805">data</span><span class="op" id="7351809">,</span>&nbsp;<span class="ident" id="7351811">newData</span><span class="op" id="7351818">)</span>&nbsp;<span class="op" id="7351820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351824">t</span><span class="op" id="7351825">.</span><span class="ident" id="7351826">Fatalf</span><span class="op" id="7351832">(</span><span class="string" id="7351833">&#34;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7351853">,</span>&nbsp;<span class="ident" id="7351855">data</span><span class="op" id="7351859">,</span>&nbsp;<span class="ident" id="7351861">newData</span><span class="op" id="7351868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7351871">}</span><br>
<span class="lineno"></span><span class="op" id="7351873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">830</span><span class="comment" id="7351876">//&nbsp;A&nbsp;top-level&nbsp;nil&nbsp;pointer&nbsp;generates&nbsp;a&nbsp;panic&nbsp;with&nbsp;a&nbsp;helpful&nbsp;string-valued&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="7351959">func</span>&nbsp;<span class="ident" id="7351964">TestTopLevelNilPointer</span><span class="op" id="7351986">(</span><span class="ident" id="7351987">t</span>&nbsp;<span class="op" id="7351989">*</span><span class="ident" id="7351990">testing</span><span class="op" id="7351997">.</span><span class="ident" id="7351998">T</span><span class="op" id="7351999">)</span>&nbsp;<span class="op" id="7352001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352004">errMsg</span>&nbsp;<span class="op" id="7352011">:=</span>&nbsp;<span class="ident" id="7352014">topLevelNilPanic</span><span class="op" id="7352030">(</span><span class="ident" id="7352031">t</span><span class="op" id="7352032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352035">if</span>&nbsp;<span class="ident" id="7352038">errMsg</span>&nbsp;<span class="op" id="7352045">==</span>&nbsp;<span class="string" id="7352048">&#34;&#34;</span>&nbsp;<span class="op" id="7352051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352055">t</span><span class="op" id="7352056">.</span><span class="ident" id="7352057">Fatal</span><span class="op" id="7352062">(</span><span class="string" id="7352063">&#34;top-level&nbsp;nil&nbsp;pointer&nbsp;did&nbsp;not&nbsp;panic&#34;</span><span class="op" id="7352100">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7352103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352106">if</span>&nbsp;<span class="op" id="7352109">!</span><span class="ident" id="7352110">strings</span><span class="op" id="7352117">.</span><span class="ident" id="7352118">Contains</span><span class="op" id="7352126">(</span><span class="ident" id="7352127">errMsg</span><span class="op" id="7352133">,</span>&nbsp;<span class="string" id="7352135">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="7352148">)</span>&nbsp;<span class="op" id="7352150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352154">t</span><span class="op" id="7352155">.</span><span class="ident" id="7352156">Fatal</span><span class="op" id="7352161">(</span><span class="string" id="7352162">&#34;expected&nbsp;nil&nbsp;pointer&nbsp;error,&nbsp;got:&#34;</span><span class="op" id="7352196">,</span>&nbsp;<span class="ident" id="7352198">errMsg</span><span class="op" id="7352204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7352207">}</span><br>
<span class="lineno"></span><span class="op" id="7352209">}</span><br>
<span class="lineno">840</span><br>
<span class="lineno"></span><span class="keyword" id="7352212">func</span>&nbsp;<span class="ident" id="7352217">topLevelNilPanic</span><span class="op" id="7352233">(</span><span class="ident" id="7352234">t</span>&nbsp;<span class="op" id="7352236">*</span><span class="ident" id="7352237">testing</span><span class="op" id="7352244">.</span><span class="ident" id="7352245">T</span><span class="op" id="7352246">)</span>&nbsp;<span class="op" id="7352248">(</span><span class="ident" id="7352249">panicErr</span>&nbsp;<span class="builtintype" id="7352258">string</span><span class="op" id="7352264">)</span>&nbsp;<span class="op" id="7352266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352269">defer</span>&nbsp;<span class="keyword" id="7352275">func</span><span class="op" id="7352279">(</span><span class="op" id="7352280">)</span>&nbsp;<span class="op" id="7352282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352286">e</span>&nbsp;<span class="op" id="7352288">:=</span>&nbsp;<span class="builtinfunc" id="7352291">recover</span><span class="op" id="7352298">(</span><span class="op" id="7352299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352303">if</span>&nbsp;<span class="ident" id="7352306">err</span><span class="op" id="7352309">,</span>&nbsp;<span class="ident" id="7352311">ok</span>&nbsp;<span class="op" id="7352314">:=</span>&nbsp;<span class="ident" id="7352317">e</span><span class="op" id="7352318">.</span><span class="op" id="7352319">(</span><span class="builtintype" id="7352320">string</span><span class="op" id="7352326">)</span><span class="op" id="7352327">;</span>&nbsp;<span class="ident" id="7352329">ok</span>&nbsp;<span class="op" id="7352332">{</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352337">panicErr</span>&nbsp;<span class="op" id="7352346">=</span>&nbsp;<span class="ident" id="7352348">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7352354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7352357">}</span><span class="op" id="7352358">(</span><span class="op" id="7352359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352362">var</span>&nbsp;<span class="ident" id="7352366">ip</span>&nbsp;<span class="op" id="7352369">*</span><span class="builtintype" id="7352370">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352375">buf</span>&nbsp;<span class="op" id="7352379">:=</span>&nbsp;<span class="builtinfunc" id="7352382">new</span><span class="op" id="7352385">(</span><span class="ident" id="7352386">bytes</span><span class="op" id="7352391">.</span><span class="ident" id="7352392">Buffer</span><span class="op" id="7352398">)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352401">if</span>&nbsp;<span class="ident" id="7352404">err</span>&nbsp;<span class="op" id="7352408">:=</span>&nbsp;<span class="ident" id="7352411">NewEncoder</span><span class="op" id="7352421">(</span><span class="ident" id="7352422">buf</span><span class="op" id="7352425">)</span><span class="op" id="7352426">.</span><span class="ident" id="7352427">Encode</span><span class="op" id="7352433">(</span><span class="ident" id="7352434">ip</span><span class="op" id="7352436">)</span><span class="op" id="7352437">;</span>&nbsp;<span class="ident" id="7352439">err</span>&nbsp;<span class="op" id="7352443">!=</span>&nbsp;<span class="ident" id="7352446">nil</span>&nbsp;<span class="op" id="7352450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352454">t</span><span class="op" id="7352455">.</span><span class="ident" id="7352456">Fatal</span><span class="op" id="7352461">(</span><span class="string" id="7352462">&#34;error&nbsp;in&nbsp;encode:&#34;</span><span class="op" id="7352480">,</span>&nbsp;<span class="ident" id="7352482">err</span><span class="op" id="7352485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7352488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352491">return</span><br>
<span class="lineno"></span><span class="op" id="7352498">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span><span class="keyword" id="7352501">func</span>&nbsp;<span class="ident" id="7352506">TestNilPointerInsideInterface</span><span class="op" id="7352535">(</span><span class="ident" id="7352536">t</span>&nbsp;<span class="op" id="7352538">*</span><span class="ident" id="7352539">testing</span><span class="op" id="7352546">.</span><span class="ident" id="7352547">T</span><span class="op" id="7352548">)</span>&nbsp;<span class="op" id="7352550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352553">var</span>&nbsp;<span class="ident" id="7352557">ip</span>&nbsp;<span class="op" id="7352560">*</span><span class="builtintype" id="7352561">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352566">si</span>&nbsp;<span class="op" id="7352569">:=</span>&nbsp;<span class="keyword" id="7352572">struct</span>&nbsp;<span class="op" id="7352579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352583">I</span>&nbsp;<span class="keyword" id="7352585">interface</span><span class="op" id="7352594">{</span><span class="op" id="7352595">}</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7352598">}</span><span class="op" id="7352599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352603">I</span><span class="op" id="7352604">:</span>&nbsp;<span class="ident" id="7352606">ip</span><span class="op" id="7352608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7352611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352614">buf</span>&nbsp;<span class="op" id="7352618">:=</span>&nbsp;<span class="builtinfunc" id="7352621">new</span><span class="op" id="7352624">(</span><span class="ident" id="7352625">bytes</span><span class="op" id="7352630">.</span><span class="ident" id="7352631">Buffer</span><span class="op" id="7352637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352640">err</span>&nbsp;<span class="op" id="7352644">:=</span>&nbsp;<span class="ident" id="7352647">NewEncoder</span><span class="op" id="7352657">(</span><span class="ident" id="7352658">buf</span><span class="op" id="7352661">)</span><span class="op" id="7352662">.</span><span class="ident" id="7352663">Encode</span><span class="op" id="7352669">(</span><span class="ident" id="7352670">si</span><span class="op" id="7352672">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352675">if</span>&nbsp;<span class="ident" id="7352678">err</span>&nbsp;<span class="op" id="7352682">==</span>&nbsp;<span class="ident" id="7352685">nil</span>&nbsp;<span class="op" id="7352689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352693">t</span><span class="op" id="7352694">.</span><span class="ident" id="7352695">Fatal</span><span class="op" id="7352700">(</span><span class="string" id="7352701">&#34;expected&nbsp;error,&nbsp;got&nbsp;none&#34;</span><span class="op" id="7352727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7352730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352733">errMsg</span>&nbsp;<span class="op" id="7352740">:=</span>&nbsp;<span class="ident" id="7352743">err</span><span class="op" id="7352746">.</span><span class="ident" id="7352747">Error</span><span class="op" id="7352752">(</span><span class="op" id="7352753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352756">if</span>&nbsp;<span class="op" id="7352759">!</span><span class="ident" id="7352760">strings</span><span class="op" id="7352767">.</span><span class="ident" id="7352768">Contains</span><span class="op" id="7352776">(</span><span class="ident" id="7352777">errMsg</span><span class="op" id="7352783">,</span>&nbsp;<span class="string" id="7352785">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="7352798">)</span>&nbsp;<span class="op" id="7352800">||</span>&nbsp;<span class="op" id="7352803">!</span><span class="ident" id="7352804">strings</span><span class="op" id="7352811">.</span><span class="ident" id="7352812">Contains</span><span class="op" id="7352820">(</span><span class="ident" id="7352821">errMsg</span><span class="op" id="7352827">,</span>&nbsp;<span class="string" id="7352829">&#34;interface&#34;</span><span class="op" id="7352840">)</span>&nbsp;<span class="op" id="7352842">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352846">t</span><span class="op" id="7352847">.</span><span class="ident" id="7352848">Fatal</span><span class="op" id="7352853">(</span><span class="string" id="7352854">&#34;expected&nbsp;error&nbsp;about&nbsp;nil&nbsp;pointer&nbsp;and&nbsp;interface,&nbsp;got:&#34;</span><span class="op" id="7352908">,</span>&nbsp;<span class="ident" id="7352910">errMsg</span><span class="op" id="7352916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7352919">}</span><br>
<span class="lineno"></span><span class="op" id="7352921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7352924">type</span>&nbsp;<span class="ident" id="7352929">Bug4Public</span>&nbsp;<span class="keyword" id="7352940">struct</span>&nbsp;<span class="op" id="7352947">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352950">Name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7352957">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352965">Secret</span>&nbsp;<span class="ident" id="7352972">Bug4Secret</span><br>
<span class="lineno"></span><span class="op" id="7352983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7352986">type</span>&nbsp;<span class="ident" id="7352991">Bug4Secret</span>&nbsp;<span class="keyword" id="7353002">struct</span>&nbsp;<span class="op" id="7353009">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353012">a</span>&nbsp;<span class="builtintype" id="7353014">int</span>&nbsp;<span class="comment" id="7353018">//&nbsp;error:&nbsp;no&nbsp;exported&nbsp;fields.</span><br>
<span class="lineno"></span><span class="op" id="7353048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7353051">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;failed&nbsp;compilation&nbsp;doesn&#39;t&nbsp;leave&nbsp;around&nbsp;an&nbsp;executable&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="7353129">//&nbsp;Issue&nbsp;3273.</span><br>
<span class="lineno">885</span><span class="keyword" id="7353144">func</span>&nbsp;<span class="ident" id="7353149">TestMutipleEncodingsOfBadType</span><span class="op" id="7353178">(</span><span class="ident" id="7353179">t</span>&nbsp;<span class="op" id="7353181">*</span><span class="ident" id="7353182">testing</span><span class="op" id="7353189">.</span><span class="ident" id="7353190">T</span><span class="op" id="7353191">)</span>&nbsp;<span class="op" id="7353193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353196">x</span>&nbsp;<span class="op" id="7353198">:=</span>&nbsp;<span class="ident" id="7353201">Bug4Public</span><span class="op" id="7353211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353215">Name</span><span class="op" id="7353219">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7353223">&#34;name&#34;</span><span class="op" id="7353229">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353233">Secret</span><span class="op" id="7353239">:</span>&nbsp;<span class="ident" id="7353241">Bug4Secret</span><span class="op" id="7353251">{</span><span class="num" id="7353252">1</span><span class="op" id="7353253">}</span><span class="op" id="7353254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7353257">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353260">buf</span>&nbsp;<span class="op" id="7353264">:=</span>&nbsp;<span class="builtinfunc" id="7353267">new</span><span class="op" id="7353270">(</span><span class="ident" id="7353271">bytes</span><span class="op" id="7353276">.</span><span class="ident" id="7353277">Buffer</span><span class="op" id="7353283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353286">enc</span>&nbsp;<span class="op" id="7353290">:=</span>&nbsp;<span class="ident" id="7353293">NewEncoder</span><span class="op" id="7353303">(</span><span class="ident" id="7353304">buf</span><span class="op" id="7353307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353310">err</span>&nbsp;<span class="op" id="7353314">:=</span>&nbsp;<span class="ident" id="7353317">enc</span><span class="op" id="7353320">.</span><span class="ident" id="7353321">Encode</span><span class="op" id="7353327">(</span><span class="ident" id="7353328">x</span><span class="op" id="7353329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353332">if</span>&nbsp;<span class="ident" id="7353335">err</span>&nbsp;<span class="op" id="7353339">==</span>&nbsp;<span class="ident" id="7353342">nil</span>&nbsp;<span class="op" id="7353346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353350">t</span><span class="op" id="7353351">.</span><span class="ident" id="7353352">Fatal</span><span class="op" id="7353357">(</span><span class="string" id="7353358">&#34;first&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7353390">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7353393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353396">buf</span><span class="op" id="7353399">.</span><span class="ident" id="7353400">Reset</span><span class="op" id="7353405">(</span><span class="op" id="7353406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353409">enc</span>&nbsp;<span class="op" id="7353413">=</span>&nbsp;<span class="ident" id="7353415">NewEncoder</span><span class="op" id="7353425">(</span><span class="ident" id="7353426">buf</span><span class="op" id="7353429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353432">err</span>&nbsp;<span class="op" id="7353436">=</span>&nbsp;<span class="ident" id="7353438">enc</span><span class="op" id="7353441">.</span><span class="ident" id="7353442">Encode</span><span class="op" id="7353448">(</span><span class="ident" id="7353449">x</span><span class="op" id="7353450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353453">if</span>&nbsp;<span class="ident" id="7353456">err</span>&nbsp;<span class="op" id="7353460">==</span>&nbsp;<span class="ident" id="7353463">nil</span>&nbsp;<span class="op" id="7353467">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353471">t</span><span class="op" id="7353472">.</span><span class="ident" id="7353473">Fatal</span><span class="op" id="7353478">(</span><span class="string" id="7353479">&#34;second&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7353512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7353515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353518">if</span>&nbsp;<span class="op" id="7353521">!</span><span class="ident" id="7353522">strings</span><span class="op" id="7353529">.</span><span class="ident" id="7353530">Contains</span><span class="op" id="7353538">(</span><span class="ident" id="7353539">err</span><span class="op" id="7353542">.</span><span class="ident" id="7353543">Error</span><span class="op" id="7353548">(</span><span class="op" id="7353549">)</span><span class="op" id="7353550">,</span>&nbsp;<span class="string" id="7353552">&#34;no&nbsp;exported&nbsp;fields&#34;</span><span class="op" id="7353572">)</span>&nbsp;<span class="op" id="7353574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353578">t</span><span class="op" id="7353579">.</span><span class="ident" id="7353580">Errorf</span><span class="op" id="7353586">(</span><span class="string" id="7353587">&#34;expected&nbsp;error&nbsp;about&nbsp;no&nbsp;exported&nbsp;fields;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7353636">,</span>&nbsp;<span class="ident" id="7353638">err</span><span class="op" id="7353641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7353644">}</span><br>
<span class="lineno">905</span><span class="op" id="7353646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7353649">//&nbsp;There&nbsp;was&nbsp;an&nbsp;error&nbsp;check&nbsp;comparing&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7353720">//&nbsp;length&nbsp;of&nbsp;the&nbsp;slice&nbsp;being&nbsp;decoded.&nbsp;It&nbsp;was&nbsp;wrong&nbsp;because&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="7353788">//&nbsp;thing&nbsp;in&nbsp;the&nbsp;input&nbsp;might&nbsp;be&nbsp;a&nbsp;type&nbsp;definition,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to</span><br>
<span class="lineno">910</span><span class="comment" id="7353858">//&nbsp;an&nbsp;incorrect&nbsp;length&nbsp;check.&nbsp;&nbsp;This&nbsp;test&nbsp;reproduces&nbsp;the&nbsp;corner&nbsp;case.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7353928">type</span>&nbsp;<span class="ident" id="7353933">Z</span>&nbsp;<span class="keyword" id="7353935">struct</span>&nbsp;<span class="op" id="7353942">{</span><br>
<span class="lineno"></span><span class="op" id="7353944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="7353947">func</span>&nbsp;<span class="ident" id="7353952">Test29ElementSlice</span><span class="op" id="7353970">(</span><span class="ident" id="7353971">t</span>&nbsp;<span class="op" id="7353973">*</span><span class="ident" id="7353974">testing</span><span class="op" id="7353981">.</span><span class="ident" id="7353982">T</span><span class="op" id="7353983">)</span>&nbsp;<span class="op" id="7353985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353988">Register</span><span class="op" id="7353996">(</span><span class="ident" id="7353997">Z</span><span class="op" id="7353998">{</span><span class="op" id="7353999">}</span><span class="op" id="7354000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354003">src</span>&nbsp;<span class="op" id="7354007">:=</span>&nbsp;<span class="builtinfunc" id="7354010">make</span><span class="op" id="7354014">(</span><span class="op" id="7354015">[</span><span class="op" id="7354016">]</span><span class="keyword" id="7354017">interface</span><span class="op" id="7354026">{</span><span class="op" id="7354027">}</span><span class="op" id="7354028">,</span>&nbsp;<span class="num" id="7354030">100</span><span class="op" id="7354033">)</span>&nbsp;<span class="comment" id="7354035">//&nbsp;Size&nbsp;needs&nbsp;to&nbsp;be&nbsp;bigger&nbsp;than&nbsp;size&nbsp;of&nbsp;type&nbsp;definition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354093">for</span>&nbsp;<span class="ident" id="7354097">i</span>&nbsp;<span class="op" id="7354099">:=</span>&nbsp;<span class="keyword" id="7354102">range</span>&nbsp;<span class="ident" id="7354108">src</span>&nbsp;<span class="op" id="7354112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354116">src</span><span class="op" id="7354119">[</span><span class="ident" id="7354120">i</span><span class="op" id="7354121">]</span>&nbsp;<span class="op" id="7354123">=</span>&nbsp;<span class="ident" id="7354125">Z</span><span class="op" id="7354126">{</span><span class="op" id="7354127">}</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7354130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354133">buf</span>&nbsp;<span class="op" id="7354137">:=</span>&nbsp;<span class="builtinfunc" id="7354140">new</span><span class="op" id="7354143">(</span><span class="ident" id="7354144">bytes</span><span class="op" id="7354149">.</span><span class="ident" id="7354150">Buffer</span><span class="op" id="7354156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354159">err</span>&nbsp;<span class="op" id="7354163">:=</span>&nbsp;<span class="ident" id="7354166">NewEncoder</span><span class="op" id="7354176">(</span><span class="ident" id="7354177">buf</span><span class="op" id="7354180">)</span><span class="op" id="7354181">.</span><span class="ident" id="7354182">Encode</span><span class="op" id="7354188">(</span><span class="ident" id="7354189">src</span><span class="op" id="7354192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354195">if</span>&nbsp;<span class="ident" id="7354198">err</span>&nbsp;<span class="op" id="7354202">!=</span>&nbsp;<span class="ident" id="7354205">nil</span>&nbsp;<span class="op" id="7354209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354213">t</span><span class="op" id="7354214">.</span><span class="ident" id="7354215">Fatalf</span><span class="op" id="7354221">(</span><span class="string" id="7354222">&#34;encode:&nbsp;%v&#34;</span><span class="op" id="7354234">,</span>&nbsp;<span class="ident" id="7354236">err</span><span class="op" id="7354239">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354243">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7354251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354255">var</span>&nbsp;<span class="ident" id="7354259">dst</span>&nbsp;<span class="op" id="7354263">[</span><span class="op" id="7354264">]</span><span class="keyword" id="7354265">interface</span><span class="op" id="7354274">{</span><span class="op" id="7354275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354278">err</span>&nbsp;<span class="op" id="7354282">=</span>&nbsp;<span class="ident" id="7354284">NewDecoder</span><span class="op" id="7354294">(</span><span class="ident" id="7354295">buf</span><span class="op" id="7354298">)</span><span class="op" id="7354299">.</span><span class="ident" id="7354300">Decode</span><span class="op" id="7354306">(</span><span class="op" id="7354307">&amp;</span><span class="ident" id="7354308">dst</span><span class="op" id="7354311">)</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354314">if</span>&nbsp;<span class="ident" id="7354317">err</span>&nbsp;<span class="op" id="7354321">!=</span>&nbsp;<span class="ident" id="7354324">nil</span>&nbsp;<span class="op" id="7354328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354332">t</span><span class="op" id="7354333">.</span><span class="ident" id="7354334">Errorf</span><span class="op" id="7354340">(</span><span class="string" id="7354341">&#34;decode:&nbsp;%v&#34;</span><span class="op" id="7354353">,</span>&nbsp;<span class="ident" id="7354355">err</span><span class="op" id="7354358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354362">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7354370">}</span><br>
<span class="lineno"></span><span class="op" id="7354372">}</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span><span class="comment" id="7354375">//&nbsp;Don&#39;t&nbsp;crash,&nbsp;just&nbsp;give&nbsp;error&nbsp;when&nbsp;allocating&nbsp;a&nbsp;huge&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="7354437">//&nbsp;Issue&nbsp;8084.</span><br>
<span class="lineno"></span><span class="keyword" id="7354452">func</span>&nbsp;<span class="ident" id="7354457">TestErrorForHugeSlice</span><span class="op" id="7354478">(</span><span class="ident" id="7354479">t</span>&nbsp;<span class="op" id="7354481">*</span><span class="ident" id="7354482">testing</span><span class="op" id="7354489">.</span><span class="ident" id="7354490">T</span><span class="op" id="7354491">)</span>&nbsp;<span class="op" id="7354493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7354496">//&nbsp;Encode&nbsp;an&nbsp;int&nbsp;slice.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354521">buf</span>&nbsp;<span class="op" id="7354525">:=</span>&nbsp;<span class="builtinfunc" id="7354528">new</span><span class="op" id="7354531">(</span><span class="ident" id="7354532">bytes</span><span class="op" id="7354537">.</span><span class="ident" id="7354538">Buffer</span><span class="op" id="7354544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354547">slice</span>&nbsp;<span class="op" id="7354553">:=</span>&nbsp;<span class="op" id="7354556">[</span><span class="op" id="7354557">]</span><span class="builtintype" id="7354558">int</span><span class="op" id="7354561">{</span><span class="num" id="7354562">1</span><span class="op" id="7354563">,</span>&nbsp;<span class="num" id="7354565">1</span><span class="op" id="7354566">,</span>&nbsp;<span class="num" id="7354568">1</span><span class="op" id="7354569">,</span>&nbsp;<span class="num" id="7354571">1</span><span class="op" id="7354572">,</span>&nbsp;<span class="num" id="7354574">1</span><span class="op" id="7354575">,</span>&nbsp;<span class="num" id="7354577">1</span><span class="op" id="7354578">,</span>&nbsp;<span class="num" id="7354580">1</span><span class="op" id="7354581">,</span>&nbsp;<span class="num" id="7354583">1</span><span class="op" id="7354584">,</span>&nbsp;<span class="num" id="7354586">1</span><span class="op" id="7354587">,</span>&nbsp;<span class="num" id="7354589">1</span><span class="op" id="7354590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354593">err</span>&nbsp;<span class="op" id="7354597">:=</span>&nbsp;<span class="ident" id="7354600">NewEncoder</span><span class="op" id="7354610">(</span><span class="ident" id="7354611">buf</span><span class="op" id="7354614">)</span><span class="op" id="7354615">.</span><span class="ident" id="7354616">Encode</span><span class="op" id="7354622">(</span><span class="ident" id="7354623">slice</span><span class="op" id="7354628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354631">if</span>&nbsp;<span class="ident" id="7354634">err</span>&nbsp;<span class="op" id="7354638">!=</span>&nbsp;<span class="ident" id="7354641">nil</span>&nbsp;<span class="op" id="7354645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354649">t</span><span class="op" id="7354650">.</span><span class="ident" id="7354651">Fatal</span><span class="op" id="7354656">(</span><span class="string" id="7354657">&#34;encode:&#34;</span><span class="op" id="7354666">,</span>&nbsp;<span class="ident" id="7354668">err</span><span class="op" id="7354671">)</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7354674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7354677">//&nbsp;Reach&nbsp;into&nbsp;the&nbsp;buffer&nbsp;and&nbsp;smash&nbsp;the&nbsp;count&nbsp;to&nbsp;make&nbsp;the&nbsp;encoded&nbsp;slice&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354760">buf</span><span class="op" id="7354763">.</span><span class="ident" id="7354764">Bytes</span><span class="op" id="7354769">(</span><span class="op" id="7354770">)</span><span class="op" id="7354771">[</span><span class="ident" id="7354772">buf</span><span class="op" id="7354775">.</span><span class="ident" id="7354776">Len</span><span class="op" id="7354779">(</span><span class="op" id="7354780">)</span><span class="op" id="7354781">-</span><span class="builtinfunc" id="7354782">len</span><span class="op" id="7354785">(</span><span class="ident" id="7354786">slice</span><span class="op" id="7354791">)</span><span class="op" id="7354792">-</span><span class="num" id="7354793">1</span><span class="op" id="7354794">]</span>&nbsp;<span class="op" id="7354796">=</span>&nbsp;<span class="num" id="7354798">0xfa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7354804">//&nbsp;Decode&nbsp;and&nbsp;see&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354830">err</span>&nbsp;<span class="op" id="7354834">=</span>&nbsp;<span class="ident" id="7354836">NewDecoder</span><span class="op" id="7354846">(</span><span class="ident" id="7354847">buf</span><span class="op" id="7354850">)</span><span class="op" id="7354851">.</span><span class="ident" id="7354852">Decode</span><span class="op" id="7354858">(</span><span class="op" id="7354859">&amp;</span><span class="ident" id="7354860">slice</span><span class="op" id="7354865">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354868">if</span>&nbsp;<span class="ident" id="7354871">err</span>&nbsp;<span class="op" id="7354875">==</span>&nbsp;<span class="ident" id="7354878">nil</span>&nbsp;<span class="op" id="7354882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354886">t</span><span class="op" id="7354887">.</span><span class="ident" id="7354888">Fatal</span><span class="op" id="7354893">(</span><span class="string" id="7354894">&#34;decode:&nbsp;no&nbsp;error&#34;</span><span class="op" id="7354912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7354915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354918">if</span>&nbsp;<span class="op" id="7354921">!</span><span class="ident" id="7354922">strings</span><span class="op" id="7354929">.</span><span class="ident" id="7354930">Contains</span><span class="op" id="7354938">(</span><span class="ident" id="7354939">err</span><span class="op" id="7354942">.</span><span class="ident" id="7354943">Error</span><span class="op" id="7354948">(</span><span class="op" id="7354949">)</span><span class="op" id="7354950">,</span>&nbsp;<span class="string" id="7354952">&#34;slice&nbsp;too&nbsp;big&#34;</span><span class="op" id="7354967">)</span>&nbsp;<span class="op" id="7354969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354973">t</span><span class="op" id="7354974">.</span><span class="ident" id="7354975">Fatal</span><span class="op" id="7354980">(</span><span class="string" id="7354981">&#34;decode:&nbsp;expected&nbsp;slice&nbsp;too&nbsp;big&nbsp;error,&nbsp;got&nbsp;%s&#34;</span><span class="op" id="7355027">,</span>&nbsp;<span class="ident" id="7355029">err</span><span class="op" id="7355032">.</span><span class="ident" id="7355033">Error</span><span class="op" id="7355038">(</span><span class="op" id="7355039">)</span><span class="op" id="7355040">)</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7355043">}</span><br>
<span class="lineno"></span><span class="op" id="7355045">}</span>
</div>
</body>
</html>
