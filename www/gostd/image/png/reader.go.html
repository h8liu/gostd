<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5577653">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5577708">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5577762">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5577813">//&nbsp;Package&nbsp;png&nbsp;implements&nbsp;a&nbsp;PNG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5577872">//</span><br>
<span class="lineno"></span><span class="comment" id="5577875">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/TR/PNG/.</span><br>
<span class="lineno"></span><span class="keyword" id="5577933">package</span>&nbsp;<span class="ident" id="5577941">png</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5577946">import</span>&nbsp;<span class="op" id="5577953">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5577956">&#34;compress/zlib&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5577973">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5577992">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5577999">&#34;hash&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5578007">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5578021">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5578030">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5578045">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5578050">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5578053">//&nbsp;Color&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5578089">const</span>&nbsp;<span class="op" id="5578095">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578098">ctGrayscale</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578115">=</span>&nbsp;<span class="num" id="5578117">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578120">ctTrueColor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578137">=</span>&nbsp;<span class="num" id="5578139">2</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578142">ctPaletted</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578159">=</span>&nbsp;<span class="num" id="5578161">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578164">ctGrayscaleAlpha</span>&nbsp;<span class="op" id="5578181">=</span>&nbsp;<span class="num" id="5578183">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578186">ctTrueColorAlpha</span>&nbsp;<span class="op" id="5578203">=</span>&nbsp;<span class="num" id="5578205">6</span><br>
<span class="lineno"></span><span class="op" id="5578207">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5578210">//&nbsp;A&nbsp;cb&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;color&nbsp;type&nbsp;and&nbsp;bit&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5578264">const</span>&nbsp;<span class="op" id="5578270">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578273">cbInvalid</span>&nbsp;<span class="op" id="5578283">=</span>&nbsp;<span class="ident" id="5578285">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578291">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578297">cbG2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578303">cbG4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578309">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578315">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578322">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578329">cbP1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578335">cbP2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578341">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578347">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578353">cbTCA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578361">cbG16</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578368">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578376">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578384">cbTCA16</span><br>
<span class="lineno"></span><span class="op" id="5578392">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5578395">//&nbsp;Filter&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5578432">const</span>&nbsp;<span class="op" id="5578438">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578441">ftNone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578451">=</span>&nbsp;<span class="num" id="5578453">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578456">ftSub</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578466">=</span>&nbsp;<span class="num" id="5578468">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578471">ftUp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5578481">=</span>&nbsp;<span class="num" id="5578483">2</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578486">ftAverage</span>&nbsp;<span class="op" id="5578496">=</span>&nbsp;<span class="num" id="5578498">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578501">ftPaeth</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5578511">=</span>&nbsp;<span class="num" id="5578513">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578516">nFilter</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5578526">=</span>&nbsp;<span class="num" id="5578528">5</span><br>
<span class="lineno"></span><span class="op" id="5578530">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5578533">//&nbsp;Interlace&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5578552">const</span>&nbsp;<span class="op" id="5578558">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578561">itNone</span>&nbsp;&nbsp;<span class="op" id="5578569">=</span>&nbsp;<span class="num" id="5578571">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578574">itAdam7</span>&nbsp;<span class="op" id="5578582">=</span>&nbsp;<span class="num" id="5578584">1</span><br>
<span class="lineno"></span><span class="op" id="5578586">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="5578589">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;placement&nbsp;and&nbsp;size&nbsp;of&nbsp;a&nbsp;pass&nbsp;for&nbsp;Adam7&nbsp;interlacing.</span><br>
<span class="lineno"></span><span class="keyword" id="5578670">type</span>&nbsp;<span class="ident" id="5578675">interlaceScan</span>&nbsp;<span class="keyword" id="5578689">struct</span>&nbsp;<span class="op" id="5578696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578699">xFactor</span><span class="op" id="5578706">,</span>&nbsp;<span class="ident" id="5578708">yFactor</span><span class="op" id="5578715">,</span>&nbsp;<span class="ident" id="5578717">xOffset</span><span class="op" id="5578724">,</span>&nbsp;<span class="ident" id="5578726">yOffset</span>&nbsp;<span class="builtintype" id="5578734">int</span><br>
<span class="lineno"></span><span class="op" id="5578738">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="5578741">//&nbsp;interlacing&nbsp;defines&nbsp;Adam7&nbsp;interlacing,&nbsp;with&nbsp;7&nbsp;passes&nbsp;of&nbsp;reduced&nbsp;images.</span><br>
<span class="lineno"></span><span class="comment" id="5578816">//&nbsp;See&nbsp;http://www.w3.org/TR/PNG/#8Interlace</span><br>
<span class="lineno"></span><span class="keyword" id="5578860">var</span>&nbsp;<span class="ident" id="5578864">interlacing</span>&nbsp;<span class="op" id="5578876">=</span>&nbsp;<span class="op" id="5578878">[</span><span class="op" id="5578879">]</span><span class="ident" id="5578880">interlaceScan</span><span class="op" id="5578893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5578896">{</span><span class="num" id="5578897">8</span><span class="op" id="5578898">,</span>&nbsp;<span class="num" id="5578900">8</span><span class="op" id="5578901">,</span>&nbsp;<span class="num" id="5578903">0</span><span class="op" id="5578904">,</span>&nbsp;<span class="num" id="5578906">0</span><span class="op" id="5578907">}</span><span class="op" id="5578908">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5578911">{</span><span class="num" id="5578912">8</span><span class="op" id="5578913">,</span>&nbsp;<span class="num" id="5578915">8</span><span class="op" id="5578916">,</span>&nbsp;<span class="num" id="5578918">4</span><span class="op" id="5578919">,</span>&nbsp;<span class="num" id="5578921">0</span><span class="op" id="5578922">}</span><span class="op" id="5578923">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5578926">{</span><span class="num" id="5578927">4</span><span class="op" id="5578928">,</span>&nbsp;<span class="num" id="5578930">8</span><span class="op" id="5578931">,</span>&nbsp;<span class="num" id="5578933">0</span><span class="op" id="5578934">,</span>&nbsp;<span class="num" id="5578936">4</span><span class="op" id="5578937">}</span><span class="op" id="5578938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5578941">{</span><span class="num" id="5578942">4</span><span class="op" id="5578943">,</span>&nbsp;<span class="num" id="5578945">4</span><span class="op" id="5578946">,</span>&nbsp;<span class="num" id="5578948">2</span><span class="op" id="5578949">,</span>&nbsp;<span class="num" id="5578951">0</span><span class="op" id="5578952">}</span><span class="op" id="5578953">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5578956">{</span><span class="num" id="5578957">2</span><span class="op" id="5578958">,</span>&nbsp;<span class="num" id="5578960">4</span><span class="op" id="5578961">,</span>&nbsp;<span class="num" id="5578963">0</span><span class="op" id="5578964">,</span>&nbsp;<span class="num" id="5578966">2</span><span class="op" id="5578967">}</span><span class="op" id="5578968">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5578971">{</span><span class="num" id="5578972">2</span><span class="op" id="5578973">,</span>&nbsp;<span class="num" id="5578975">2</span><span class="op" id="5578976">,</span>&nbsp;<span class="num" id="5578978">1</span><span class="op" id="5578979">,</span>&nbsp;<span class="num" id="5578981">0</span><span class="op" id="5578982">}</span><span class="op" id="5578983">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5578986">{</span><span class="num" id="5578987">1</span><span class="op" id="5578988">,</span>&nbsp;<span class="num" id="5578990">2</span><span class="op" id="5578991">,</span>&nbsp;<span class="num" id="5578993">0</span><span class="op" id="5578994">,</span>&nbsp;<span class="num" id="5578996">1</span><span class="op" id="5578997">}</span><span class="op" id="5578998">,</span><br>
<span class="lineno"></span><span class="op" id="5579000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5579003">//&nbsp;Decoding&nbsp;stage.</span><br>
<span class="lineno"></span><span class="comment" id="5579022">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;says&nbsp;that&nbsp;the&nbsp;IHDR,&nbsp;PLTE&nbsp;(if&nbsp;present),&nbsp;IDAT&nbsp;and&nbsp;IEND</span><br>
<span class="lineno">85</span><span class="comment" id="5579100">//&nbsp;chunks&nbsp;must&nbsp;appear&nbsp;in&nbsp;that&nbsp;order.&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;IDAT&nbsp;chunks,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5579176">//&nbsp;IDAT&nbsp;chunks&nbsp;must&nbsp;be&nbsp;sequential&nbsp;(i.e.&nbsp;they&nbsp;may&nbsp;not&nbsp;have&nbsp;any&nbsp;other&nbsp;chunks</span><br>
<span class="lineno"></span><span class="comment" id="5579251">//&nbsp;between&nbsp;them).</span><br>
<span class="lineno"></span><span class="comment" id="5579269">//&nbsp;http://www.w3.org/TR/PNG/#5ChunkOrdering</span><br>
<span class="lineno"></span><span class="keyword" id="5579313">const</span>&nbsp;<span class="op" id="5579319">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579322">dsStart</span>&nbsp;<span class="op" id="5579330">=</span>&nbsp;<span class="ident" id="5579332">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579338">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579350">dsSeenPLTE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579362">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579374">dsSeenIEND</span><br>
<span class="lineno">95</span><span class="op" id="5579385">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5579388">const</span>&nbsp;<span class="ident" id="5579394">pngHeader</span>&nbsp;<span class="op" id="5579404">=</span>&nbsp;<span class="string" id="5579406">&#34;\x89PNG\r\n\x1a\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5579427">type</span>&nbsp;<span class="ident" id="5579432">decoder</span>&nbsp;<span class="keyword" id="5579440">struct</span>&nbsp;<span class="op" id="5579447">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579450">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579464">io</span><span class="op" id="5579466">.</span><span class="ident" id="5579467">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579475">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579489">image</span><span class="op" id="5579494">.</span><span class="ident" id="5579495">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579502">crc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579516">hash</span><span class="op" id="5579520">.</span><span class="ident" id="5579521">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579529">width</span><span class="op" id="5579534">,</span>&nbsp;<span class="ident" id="5579536">height</span>&nbsp;<span class="builtintype" id="5579543">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579548">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5579562">int</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579567">palette</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5579581">color</span><span class="op" id="5579586">.</span><span class="ident" id="5579587">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579596">cb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5579610">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579615">stage</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5579629">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579634">idatLength</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5579648">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579656">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5579670">[</span><span class="num" id="5579671">3</span>&nbsp;<span class="op" id="5579673">*</span>&nbsp;<span class="num" id="5579675">256</span><span class="op" id="5579678">]</span><span class="builtintype" id="5579679">byte</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579685">interlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5579699">int</span><br>
<span class="lineno"></span><span class="op" id="5579703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5579706">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;PNG.</span><br>
<span class="lineno"></span><span class="keyword" id="5579766">type</span>&nbsp;<span class="ident" id="5579771">FormatError</span>&nbsp;<span class="builtintype" id="5579783">string</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="5579791">func</span>&nbsp;<span class="op" id="5579796">(</span><span class="ident" id="5579797">e</span>&nbsp;<span class="ident" id="5579799">FormatError</span><span class="op" id="5579810">)</span>&nbsp;<span class="ident" id="5579812">Error</span><span class="op" id="5579817">(</span><span class="op" id="5579818">)</span>&nbsp;<span class="builtintype" id="5579820">string</span>&nbsp;<span class="op" id="5579827">{</span>&nbsp;<span class="keyword" id="5579829">return</span>&nbsp;<span class="string" id="5579836">&#34;png:&nbsp;invalid&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="5579860">+</span>&nbsp;<span class="builtintype" id="5579862">string</span><span class="op" id="5579868">(</span><span class="ident" id="5579869">e</span><span class="op" id="5579870">)</span>&nbsp;<span class="op" id="5579872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5579875">var</span>&nbsp;<span class="ident" id="5579879">chunkOrderError</span>&nbsp;<span class="op" id="5579895">=</span>&nbsp;<span class="ident" id="5579897">FormatError</span><span class="op" id="5579908">(</span><span class="string" id="5579909">&#34;chunk&nbsp;out&nbsp;of&nbsp;order&#34;</span><span class="op" id="5579929">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="5579932">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;PNG&nbsp;feature.</span><br>
<span class="lineno"></span><span class="keyword" id="5580022">type</span>&nbsp;<span class="ident" id="5580027">UnsupportedError</span>&nbsp;<span class="builtintype" id="5580044">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5580052">func</span>&nbsp;<span class="op" id="5580057">(</span><span class="ident" id="5580058">e</span>&nbsp;<span class="ident" id="5580060">UnsupportedError</span><span class="op" id="5580076">)</span>&nbsp;<span class="ident" id="5580078">Error</span><span class="op" id="5580083">(</span><span class="op" id="5580084">)</span>&nbsp;<span class="builtintype" id="5580086">string</span>&nbsp;<span class="op" id="5580093">{</span>&nbsp;<span class="keyword" id="5580095">return</span>&nbsp;<span class="string" id="5580102">&#34;png:&nbsp;unsupported&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="5580131">+</span>&nbsp;<span class="builtintype" id="5580133">string</span><span class="op" id="5580139">(</span><span class="ident" id="5580140">e</span><span class="op" id="5580141">)</span>&nbsp;<span class="op" id="5580143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="5580146">func</span>&nbsp;<span class="ident" id="5580151">min</span><span class="op" id="5580154">(</span><span class="ident" id="5580155">a</span><span class="op" id="5580156">,</span>&nbsp;<span class="ident" id="5580158">b</span>&nbsp;<span class="builtintype" id="5580160">int</span><span class="op" id="5580163">)</span>&nbsp;<span class="builtintype" id="5580165">int</span>&nbsp;<span class="op" id="5580169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580172">if</span>&nbsp;<span class="ident" id="5580175">a</span>&nbsp;<span class="op" id="5580177">&lt;</span>&nbsp;<span class="ident" id="5580179">b</span>&nbsp;<span class="op" id="5580181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580185">return</span>&nbsp;<span class="ident" id="5580192">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5580195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580198">return</span>&nbsp;<span class="ident" id="5580205">b</span><br>
<span class="lineno">130</span><span class="op" id="5580207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5580210">func</span>&nbsp;<span class="op" id="5580215">(</span><span class="ident" id="5580216">d</span>&nbsp;<span class="op" id="5580218">*</span><span class="ident" id="5580219">decoder</span><span class="op" id="5580226">)</span>&nbsp;<span class="ident" id="5580228">parseIHDR</span><span class="op" id="5580237">(</span><span class="ident" id="5580238">length</span>&nbsp;<span class="builtintype" id="5580245">uint32</span><span class="op" id="5580251">)</span>&nbsp;<span class="builtintype" id="5580253">error</span>&nbsp;<span class="op" id="5580259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580262">if</span>&nbsp;<span class="ident" id="5580265">length</span>&nbsp;<span class="op" id="5580272">!=</span>&nbsp;<span class="num" id="5580275">13</span>&nbsp;<span class="op" id="5580278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580282">return</span>&nbsp;<span class="ident" id="5580289">FormatError</span><span class="op" id="5580300">(</span><span class="string" id="5580301">&#34;bad&nbsp;IHDR&nbsp;length&#34;</span><span class="op" id="5580318">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5580321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580324">if</span>&nbsp;<span class="ident" id="5580327">_</span><span class="op" id="5580328">,</span>&nbsp;<span class="ident" id="5580330">err</span>&nbsp;<span class="op" id="5580334">:=</span>&nbsp;<span class="ident" id="5580337">io</span><span class="op" id="5580339">.</span><span class="ident" id="5580340">ReadFull</span><span class="op" id="5580348">(</span><span class="ident" id="5580349">d</span><span class="op" id="5580350">.</span><span class="ident" id="5580351">r</span><span class="op" id="5580352">,</span>&nbsp;<span class="ident" id="5580354">d</span><span class="op" id="5580355">.</span><span class="ident" id="5580356">tmp</span><span class="op" id="5580359">[</span><span class="op" id="5580360">:</span><span class="num" id="5580361">13</span><span class="op" id="5580363">]</span><span class="op" id="5580364">)</span><span class="op" id="5580365">;</span>&nbsp;<span class="ident" id="5580367">err</span>&nbsp;<span class="op" id="5580371">!=</span>&nbsp;<span class="ident" id="5580374">nil</span>&nbsp;<span class="op" id="5580378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580382">return</span>&nbsp;<span class="ident" id="5580389">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5580394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580397">d</span><span class="op" id="5580398">.</span><span class="ident" id="5580399">crc</span><span class="op" id="5580402">.</span><span class="ident" id="5580403">Write</span><span class="op" id="5580408">(</span><span class="ident" id="5580409">d</span><span class="op" id="5580410">.</span><span class="ident" id="5580411">tmp</span><span class="op" id="5580414">[</span><span class="op" id="5580415">:</span><span class="num" id="5580416">13</span><span class="op" id="5580418">]</span><span class="op" id="5580419">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580422">if</span>&nbsp;<span class="ident" id="5580425">d</span><span class="op" id="5580426">.</span><span class="ident" id="5580427">tmp</span><span class="op" id="5580430">[</span><span class="num" id="5580431">10</span><span class="op" id="5580433">]</span>&nbsp;<span class="op" id="5580435">!=</span>&nbsp;<span class="num" id="5580438">0</span>&nbsp;<span class="op" id="5580440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580444">return</span>&nbsp;<span class="ident" id="5580451">UnsupportedError</span><span class="op" id="5580467">(</span><span class="string" id="5580468">&#34;compression&nbsp;method&#34;</span><span class="op" id="5580488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5580491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580494">if</span>&nbsp;<span class="ident" id="5580497">d</span><span class="op" id="5580498">.</span><span class="ident" id="5580499">tmp</span><span class="op" id="5580502">[</span><span class="num" id="5580503">11</span><span class="op" id="5580505">]</span>&nbsp;<span class="op" id="5580507">!=</span>&nbsp;<span class="num" id="5580510">0</span>&nbsp;<span class="op" id="5580512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580516">return</span>&nbsp;<span class="ident" id="5580523">UnsupportedError</span><span class="op" id="5580539">(</span><span class="string" id="5580540">&#34;filter&nbsp;method&#34;</span><span class="op" id="5580555">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5580558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580561">if</span>&nbsp;<span class="ident" id="5580564">d</span><span class="op" id="5580565">.</span><span class="ident" id="5580566">tmp</span><span class="op" id="5580569">[</span><span class="num" id="5580570">12</span><span class="op" id="5580572">]</span>&nbsp;<span class="op" id="5580574">!=</span>&nbsp;<span class="ident" id="5580577">itNone</span>&nbsp;<span class="op" id="5580584">&amp;&amp;</span>&nbsp;<span class="ident" id="5580587">d</span><span class="op" id="5580588">.</span><span class="ident" id="5580589">tmp</span><span class="op" id="5580592">[</span><span class="num" id="5580593">12</span><span class="op" id="5580595">]</span>&nbsp;<span class="op" id="5580597">!=</span>&nbsp;<span class="ident" id="5580600">itAdam7</span>&nbsp;<span class="op" id="5580608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580612">return</span>&nbsp;<span class="ident" id="5580619">FormatError</span><span class="op" id="5580630">(</span><span class="string" id="5580631">&#34;invalid&nbsp;interlace&nbsp;method&#34;</span><span class="op" id="5580657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5580660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580663">d</span><span class="op" id="5580664">.</span><span class="ident" id="5580665">interlace</span>&nbsp;<span class="op" id="5580675">=</span>&nbsp;<span class="builtintype" id="5580677">int</span><span class="op" id="5580680">(</span><span class="ident" id="5580681">d</span><span class="op" id="5580682">.</span><span class="ident" id="5580683">tmp</span><span class="op" id="5580686">[</span><span class="num" id="5580687">12</span><span class="op" id="5580689">]</span><span class="op" id="5580690">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580693">w</span>&nbsp;<span class="op" id="5580695">:=</span>&nbsp;<span class="builtintype" id="5580698">int32</span><span class="op" id="5580703">(</span><span class="ident" id="5580704">binary</span><span class="op" id="5580710">.</span><span class="ident" id="5580711">BigEndian</span><span class="op" id="5580720">.</span><span class="ident" id="5580721">Uint32</span><span class="op" id="5580727">(</span><span class="ident" id="5580728">d</span><span class="op" id="5580729">.</span><span class="ident" id="5580730">tmp</span><span class="op" id="5580733">[</span><span class="num" id="5580734">0</span><span class="op" id="5580735">:</span><span class="num" id="5580736">4</span><span class="op" id="5580737">]</span><span class="op" id="5580738">)</span><span class="op" id="5580739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580742">h</span>&nbsp;<span class="op" id="5580744">:=</span>&nbsp;<span class="builtintype" id="5580747">int32</span><span class="op" id="5580752">(</span><span class="ident" id="5580753">binary</span><span class="op" id="5580759">.</span><span class="ident" id="5580760">BigEndian</span><span class="op" id="5580769">.</span><span class="ident" id="5580770">Uint32</span><span class="op" id="5580776">(</span><span class="ident" id="5580777">d</span><span class="op" id="5580778">.</span><span class="ident" id="5580779">tmp</span><span class="op" id="5580782">[</span><span class="num" id="5580783">4</span><span class="op" id="5580784">:</span><span class="num" id="5580785">8</span><span class="op" id="5580786">]</span><span class="op" id="5580787">)</span><span class="op" id="5580788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580791">if</span>&nbsp;<span class="ident" id="5580794">w</span>&nbsp;<span class="op" id="5580796">&lt;</span>&nbsp;<span class="num" id="5580798">0</span>&nbsp;<span class="op" id="5580800">||</span>&nbsp;<span class="ident" id="5580803">h</span>&nbsp;<span class="op" id="5580805">&lt;</span>&nbsp;<span class="num" id="5580807">0</span>&nbsp;<span class="op" id="5580809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580813">return</span>&nbsp;<span class="ident" id="5580820">FormatError</span><span class="op" id="5580831">(</span><span class="string" id="5580832">&#34;negative&nbsp;dimension&#34;</span><span class="op" id="5580852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5580855">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580858">nPixels</span>&nbsp;<span class="op" id="5580866">:=</span>&nbsp;<span class="ident" id="5580869">int64</span><span class="op" id="5580874">(</span><span class="ident" id="5580875">w</span><span class="op" id="5580876">)</span>&nbsp;<span class="op" id="5580878">*</span>&nbsp;<span class="ident" id="5580880">int64</span><span class="op" id="5580885">(</span><span class="ident" id="5580886">h</span><span class="op" id="5580887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580890">if</span>&nbsp;<span class="ident" id="5580893">nPixels</span>&nbsp;<span class="op" id="5580901">!=</span>&nbsp;<span class="ident" id="5580904">int64</span><span class="op" id="5580909">(</span><span class="builtintype" id="5580910">int</span><span class="op" id="5580913">(</span><span class="ident" id="5580914">nPixels</span><span class="op" id="5580921">)</span><span class="op" id="5580922">)</span>&nbsp;<span class="op" id="5580924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580928">return</span>&nbsp;<span class="ident" id="5580935">UnsupportedError</span><span class="op" id="5580951">(</span><span class="string" id="5580952">&#34;dimension&nbsp;overflow&#34;</span><span class="op" id="5580972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5580975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580978">d</span><span class="op" id="5580979">.</span><span class="ident" id="5580980">cb</span>&nbsp;<span class="op" id="5580983">=</span>&nbsp;<span class="ident" id="5580985">cbInvalid</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580996">d</span><span class="op" id="5580997">.</span><span class="ident" id="5580998">depth</span>&nbsp;<span class="op" id="5581004">=</span>&nbsp;<span class="builtintype" id="5581006">int</span><span class="op" id="5581009">(</span><span class="ident" id="5581010">d</span><span class="op" id="5581011">.</span><span class="ident" id="5581012">tmp</span><span class="op" id="5581015">[</span><span class="num" id="5581016">8</span><span class="op" id="5581017">]</span><span class="op" id="5581018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581021">switch</span>&nbsp;<span class="ident" id="5581028">d</span><span class="op" id="5581029">.</span><span class="ident" id="5581030">depth</span>&nbsp;<span class="op" id="5581036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581039">case</span>&nbsp;<span class="num" id="5581044">1</span><span class="op" id="5581045">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581049">switch</span>&nbsp;<span class="ident" id="5581056">d</span><span class="op" id="5581057">.</span><span class="ident" id="5581058">tmp</span><span class="op" id="5581061">[</span><span class="num" id="5581062">9</span><span class="op" id="5581063">]</span>&nbsp;<span class="op" id="5581065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581069">case</span>&nbsp;<span class="ident" id="5581074">ctGrayscale</span><span class="op" id="5581085">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581090">d</span><span class="op" id="5581091">.</span><span class="ident" id="5581092">cb</span>&nbsp;<span class="op" id="5581095">=</span>&nbsp;<span class="ident" id="5581097">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581104">case</span>&nbsp;<span class="ident" id="5581109">ctPaletted</span><span class="op" id="5581119">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581124">d</span><span class="op" id="5581125">.</span><span class="ident" id="5581126">cb</span>&nbsp;<span class="op" id="5581129">=</span>&nbsp;<span class="ident" id="5581131">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5581138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581141">case</span>&nbsp;<span class="num" id="5581146">2</span><span class="op" id="5581147">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581151">switch</span>&nbsp;<span class="ident" id="5581158">d</span><span class="op" id="5581159">.</span><span class="ident" id="5581160">tmp</span><span class="op" id="5581163">[</span><span class="num" id="5581164">9</span><span class="op" id="5581165">]</span>&nbsp;<span class="op" id="5581167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581171">case</span>&nbsp;<span class="ident" id="5581176">ctGrayscale</span><span class="op" id="5581187">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581192">d</span><span class="op" id="5581193">.</span><span class="ident" id="5581194">cb</span>&nbsp;<span class="op" id="5581197">=</span>&nbsp;<span class="ident" id="5581199">cbG2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581206">case</span>&nbsp;<span class="ident" id="5581211">ctPaletted</span><span class="op" id="5581221">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581226">d</span><span class="op" id="5581227">.</span><span class="ident" id="5581228">cb</span>&nbsp;<span class="op" id="5581231">=</span>&nbsp;<span class="ident" id="5581233">cbP2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5581240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581243">case</span>&nbsp;<span class="num" id="5581248">4</span><span class="op" id="5581249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581253">switch</span>&nbsp;<span class="ident" id="5581260">d</span><span class="op" id="5581261">.</span><span class="ident" id="5581262">tmp</span><span class="op" id="5581265">[</span><span class="num" id="5581266">9</span><span class="op" id="5581267">]</span>&nbsp;<span class="op" id="5581269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581273">case</span>&nbsp;<span class="ident" id="5581278">ctGrayscale</span><span class="op" id="5581289">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581294">d</span><span class="op" id="5581295">.</span><span class="ident" id="5581296">cb</span>&nbsp;<span class="op" id="5581299">=</span>&nbsp;<span class="ident" id="5581301">cbG4</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581308">case</span>&nbsp;<span class="ident" id="5581313">ctPaletted</span><span class="op" id="5581323">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581328">d</span><span class="op" id="5581329">.</span><span class="ident" id="5581330">cb</span>&nbsp;<span class="op" id="5581333">=</span>&nbsp;<span class="ident" id="5581335">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5581342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581345">case</span>&nbsp;<span class="num" id="5581350">8</span><span class="op" id="5581351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581355">switch</span>&nbsp;<span class="ident" id="5581362">d</span><span class="op" id="5581363">.</span><span class="ident" id="5581364">tmp</span><span class="op" id="5581367">[</span><span class="num" id="5581368">9</span><span class="op" id="5581369">]</span>&nbsp;<span class="op" id="5581371">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581375">case</span>&nbsp;<span class="ident" id="5581380">ctGrayscale</span><span class="op" id="5581391">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581396">d</span><span class="op" id="5581397">.</span><span class="ident" id="5581398">cb</span>&nbsp;<span class="op" id="5581401">=</span>&nbsp;<span class="ident" id="5581403">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581410">case</span>&nbsp;<span class="ident" id="5581415">ctTrueColor</span><span class="op" id="5581426">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581431">d</span><span class="op" id="5581432">.</span><span class="ident" id="5581433">cb</span>&nbsp;<span class="op" id="5581436">=</span>&nbsp;<span class="ident" id="5581438">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581446">case</span>&nbsp;<span class="ident" id="5581451">ctPaletted</span><span class="op" id="5581461">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581466">d</span><span class="op" id="5581467">.</span><span class="ident" id="5581468">cb</span>&nbsp;<span class="op" id="5581471">=</span>&nbsp;<span class="ident" id="5581473">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581480">case</span>&nbsp;<span class="ident" id="5581485">ctGrayscaleAlpha</span><span class="op" id="5581501">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581506">d</span><span class="op" id="5581507">.</span><span class="ident" id="5581508">cb</span>&nbsp;<span class="op" id="5581511">=</span>&nbsp;<span class="ident" id="5581513">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581521">case</span>&nbsp;<span class="ident" id="5581526">ctTrueColorAlpha</span><span class="op" id="5581542">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581547">d</span><span class="op" id="5581548">.</span><span class="ident" id="5581549">cb</span>&nbsp;<span class="op" id="5581552">=</span>&nbsp;<span class="ident" id="5581554">cbTCA8</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5581563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581566">case</span>&nbsp;<span class="num" id="5581571">16</span><span class="op" id="5581573">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581577">switch</span>&nbsp;<span class="ident" id="5581584">d</span><span class="op" id="5581585">.</span><span class="ident" id="5581586">tmp</span><span class="op" id="5581589">[</span><span class="num" id="5581590">9</span><span class="op" id="5581591">]</span>&nbsp;<span class="op" id="5581593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581597">case</span>&nbsp;<span class="ident" id="5581602">ctGrayscale</span><span class="op" id="5581613">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581618">d</span><span class="op" id="5581619">.</span><span class="ident" id="5581620">cb</span>&nbsp;<span class="op" id="5581623">=</span>&nbsp;<span class="ident" id="5581625">cbG16</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581633">case</span>&nbsp;<span class="ident" id="5581638">ctTrueColor</span><span class="op" id="5581649">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581654">d</span><span class="op" id="5581655">.</span><span class="ident" id="5581656">cb</span>&nbsp;<span class="op" id="5581659">=</span>&nbsp;<span class="ident" id="5581661">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581670">case</span>&nbsp;<span class="ident" id="5581675">ctGrayscaleAlpha</span><span class="op" id="5581691">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581696">d</span><span class="op" id="5581697">.</span><span class="ident" id="5581698">cb</span>&nbsp;<span class="op" id="5581701">=</span>&nbsp;<span class="ident" id="5581703">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581712">case</span>&nbsp;<span class="ident" id="5581717">ctTrueColorAlpha</span><span class="op" id="5581733">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581738">d</span><span class="op" id="5581739">.</span><span class="ident" id="5581740">cb</span>&nbsp;<span class="op" id="5581743">=</span>&nbsp;<span class="ident" id="5581745">cbTCA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5581755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5581758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581761">if</span>&nbsp;<span class="ident" id="5581764">d</span><span class="op" id="5581765">.</span><span class="ident" id="5581766">cb</span>&nbsp;<span class="op" id="5581769">==</span>&nbsp;<span class="ident" id="5581772">cbInvalid</span>&nbsp;<span class="op" id="5581782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581786">return</span>&nbsp;<span class="ident" id="5581793">UnsupportedError</span><span class="op" id="5581809">(</span><span class="ident" id="5581810">fmt</span><span class="op" id="5581813">.</span><span class="ident" id="5581814">Sprintf</span><span class="op" id="5581821">(</span><span class="string" id="5581822">&#34;bit&nbsp;depth&nbsp;%d,&nbsp;color&nbsp;type&nbsp;%d&#34;</span><span class="op" id="5581851">,</span>&nbsp;<span class="ident" id="5581853">d</span><span class="op" id="5581854">.</span><span class="ident" id="5581855">tmp</span><span class="op" id="5581858">[</span><span class="num" id="5581859">8</span><span class="op" id="5581860">]</span><span class="op" id="5581861">,</span>&nbsp;<span class="ident" id="5581863">d</span><span class="op" id="5581864">.</span><span class="ident" id="5581865">tmp</span><span class="op" id="5581868">[</span><span class="num" id="5581869">9</span><span class="op" id="5581870">]</span><span class="op" id="5581871">)</span><span class="op" id="5581872">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5581875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581878">d</span><span class="op" id="5581879">.</span><span class="ident" id="5581880">width</span><span class="op" id="5581885">,</span>&nbsp;<span class="ident" id="5581887">d</span><span class="op" id="5581888">.</span><span class="ident" id="5581889">height</span>&nbsp;<span class="op" id="5581896">=</span>&nbsp;<span class="builtintype" id="5581898">int</span><span class="op" id="5581901">(</span><span class="ident" id="5581902">w</span><span class="op" id="5581903">)</span><span class="op" id="5581904">,</span>&nbsp;<span class="builtintype" id="5581906">int</span><span class="op" id="5581909">(</span><span class="ident" id="5581910">h</span><span class="op" id="5581911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581914">return</span>&nbsp;<span class="ident" id="5581921">d</span><span class="op" id="5581922">.</span><span class="ident" id="5581923">verifyChecksum</span><span class="op" id="5581937">(</span><span class="op" id="5581938">)</span><br>
<span class="lineno"></span><span class="op" id="5581940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="5581943">func</span>&nbsp;<span class="op" id="5581948">(</span><span class="ident" id="5581949">d</span>&nbsp;<span class="op" id="5581951">*</span><span class="ident" id="5581952">decoder</span><span class="op" id="5581959">)</span>&nbsp;<span class="ident" id="5581961">parsePLTE</span><span class="op" id="5581970">(</span><span class="ident" id="5581971">length</span>&nbsp;<span class="builtintype" id="5581978">uint32</span><span class="op" id="5581984">)</span>&nbsp;<span class="builtintype" id="5581986">error</span>&nbsp;<span class="op" id="5581992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581995">np</span>&nbsp;<span class="op" id="5581998">:=</span>&nbsp;<span class="builtintype" id="5582001">int</span><span class="op" id="5582004">(</span><span class="ident" id="5582005">length</span>&nbsp;<span class="op" id="5582012">/</span>&nbsp;<span class="num" id="5582014">3</span><span class="op" id="5582015">)</span>&nbsp;<span class="comment" id="5582017">//&nbsp;The&nbsp;number&nbsp;of&nbsp;palette&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5582052">if</span>&nbsp;<span class="ident" id="5582055">length</span><span class="op" id="5582061">%</span><span class="num" id="5582062">3</span>&nbsp;<span class="op" id="5582064">!=</span>&nbsp;<span class="num" id="5582067">0</span>&nbsp;<span class="op" id="5582069">||</span>&nbsp;<span class="ident" id="5582072">np</span>&nbsp;<span class="op" id="5582075">&lt;=</span>&nbsp;<span class="num" id="5582078">0</span>&nbsp;<span class="op" id="5582080">||</span>&nbsp;<span class="ident" id="5582083">np</span>&nbsp;<span class="op" id="5582086">&gt;</span>&nbsp;<span class="num" id="5582088">256</span>&nbsp;<span class="op" id="5582092">||</span>&nbsp;<span class="ident" id="5582095">np</span>&nbsp;<span class="op" id="5582098">&gt;</span>&nbsp;<span class="num" id="5582100">1</span><span class="op" id="5582101">&lt;&lt;</span><span class="builtintype" id="5582103">uint</span><span class="op" id="5582107">(</span><span class="ident" id="5582108">d</span><span class="op" id="5582109">.</span><span class="ident" id="5582110">depth</span><span class="op" id="5582115">)</span>&nbsp;<span class="op" id="5582117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5582121">return</span>&nbsp;<span class="ident" id="5582128">FormatError</span><span class="op" id="5582139">(</span><span class="string" id="5582140">&#34;bad&nbsp;PLTE&nbsp;length&#34;</span><span class="op" id="5582157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5582160">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5582163">n</span><span class="op" id="5582164">,</span>&nbsp;<span class="ident" id="5582166">err</span>&nbsp;<span class="op" id="5582170">:=</span>&nbsp;<span class="ident" id="5582173">io</span><span class="op" id="5582175">.</span><span class="ident" id="5582176">ReadFull</span><span class="op" id="5582184">(</span><span class="ident" id="5582185">d</span><span class="op" id="5582186">.</span><span class="ident" id="5582187">r</span><span class="op" id="5582188">,</span>&nbsp;<span class="ident" id="5582190">d</span><span class="op" id="5582191">.</span><span class="ident" id="5582192">tmp</span><span class="op" id="5582195">[</span><span class="op" id="5582196">:</span><span class="num" id="5582197">3</span><span class="op" id="5582198">*</span><span class="ident" id="5582199">np</span><span class="op" id="5582201">]</span><span class="op" id="5582202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5582205">if</span>&nbsp;<span class="ident" id="5582208">err</span>&nbsp;<span class="op" id="5582212">!=</span>&nbsp;<span class="ident" id="5582215">nil</span>&nbsp;<span class="op" id="5582219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5582223">return</span>&nbsp;<span class="ident" id="5582230">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5582235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5582238">d</span><span class="op" id="5582239">.</span><span class="ident" id="5582240">crc</span><span class="op" id="5582243">.</span><span class="ident" id="5582244">Write</span><span class="op" id="5582249">(</span><span class="ident" id="5582250">d</span><span class="op" id="5582251">.</span><span class="ident" id="5582252">tmp</span><span class="op" id="5582255">[</span><span class="op" id="5582256">:</span><span class="ident" id="5582257">n</span><span class="op" id="5582258">]</span><span class="op" id="5582259">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5582262">switch</span>&nbsp;<span class="ident" id="5582269">d</span><span class="op" id="5582270">.</span><span class="ident" id="5582271">cb</span>&nbsp;<span class="op" id="5582274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5582277">case</span>&nbsp;<span class="ident" id="5582282">cbP1</span><span class="op" id="5582286">,</span>&nbsp;<span class="ident" id="5582288">cbP2</span><span class="op" id="5582292">,</span>&nbsp;<span class="ident" id="5582294">cbP4</span><span class="op" id="5582298">,</span>&nbsp;<span class="ident" id="5582300">cbP8</span><span class="op" id="5582304">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5582308">d</span><span class="op" id="5582309">.</span><span class="ident" id="5582310">palette</span>&nbsp;<span class="op" id="5582318">=</span>&nbsp;<span class="builtinfunc" id="5582320">make</span><span class="op" id="5582324">(</span><span class="ident" id="5582325">color</span><span class="op" id="5582330">.</span><span class="ident" id="5582331">Palette</span><span class="op" id="5582338">,</span>&nbsp;<span class="num" id="5582340">256</span><span class="op" id="5582343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5582347">for</span>&nbsp;<span class="ident" id="5582351">i</span>&nbsp;<span class="op" id="5582353">:=</span>&nbsp;<span class="num" id="5582356">0</span><span class="op" id="5582357">;</span>&nbsp;<span class="ident" id="5582359">i</span>&nbsp;<span class="op" id="5582361">&lt;</span>&nbsp;<span class="ident" id="5582363">np</span><span class="op" id="5582365">;</span>&nbsp;<span class="ident" id="5582367">i</span><span class="op" id="5582368">++</span>&nbsp;<span class="op" id="5582371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5582376">d</span><span class="op" id="5582377">.</span><span class="ident" id="5582378">palette</span><span class="op" id="5582385">[</span><span class="ident" id="5582386">i</span><span class="op" id="5582387">]</span>&nbsp;<span class="op" id="5582389">=</span>&nbsp;<span class="ident" id="5582391">color</span><span class="op" id="5582396">.</span><span class="ident" id="5582397">RGBA</span><span class="op" id="5582401">{</span><span class="ident" id="5582402">d</span><span class="op" id="5582403">.</span><span class="ident" id="5582404">tmp</span><span class="op" id="5582407">[</span><span class="num" id="5582408">3</span><span class="op" id="5582409">*</span><span class="ident" id="5582410">i</span><span class="op" id="5582411">+</span><span class="num" id="5582412">0</span><span class="op" id="5582413">]</span><span class="op" id="5582414">,</span>&nbsp;<span class="ident" id="5582416">d</span><span class="op" id="5582417">.</span><span class="ident" id="5582418">tmp</span><span class="op" id="5582421">[</span><span class="num" id="5582422">3</span><span class="op" id="5582423">*</span><span class="ident" id="5582424">i</span><span class="op" id="5582425">+</span><span class="num" id="5582426">1</span><span class="op" id="5582427">]</span><span class="op" id="5582428">,</span>&nbsp;<span class="ident" id="5582430">d</span><span class="op" id="5582431">.</span><span class="ident" id="5582432">tmp</span><span class="op" id="5582435">[</span><span class="num" id="5582436">3</span><span class="op" id="5582437">*</span><span class="ident" id="5582438">i</span><span class="op" id="5582439">+</span><span class="num" id="5582440">2</span><span class="op" id="5582441">]</span><span class="op" id="5582442">,</span>&nbsp;<span class="num" id="5582444">0xff</span><span class="op" id="5582448">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5582452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5582456">for</span>&nbsp;<span class="ident" id="5582460">i</span>&nbsp;<span class="op" id="5582462">:=</span>&nbsp;<span class="ident" id="5582465">np</span><span class="op" id="5582467">;</span>&nbsp;<span class="ident" id="5582469">i</span>&nbsp;<span class="op" id="5582471">&lt;</span>&nbsp;<span class="num" id="5582473">256</span><span class="op" id="5582476">;</span>&nbsp;<span class="ident" id="5582478">i</span><span class="op" id="5582479">++</span>&nbsp;<span class="op" id="5582482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582487">//&nbsp;Initialize&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;palette&nbsp;to&nbsp;opaque&nbsp;black.&nbsp;The&nbsp;spec&nbsp;(section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582563">//&nbsp;11.2.3)&nbsp;says&nbsp;that&nbsp;&#34;any&nbsp;out-of-range&nbsp;pixel&nbsp;value&nbsp;found&nbsp;in&nbsp;the&nbsp;image&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582641">//&nbsp;is&nbsp;an&nbsp;error&#34;,&nbsp;but&nbsp;some&nbsp;real-world&nbsp;PNG&nbsp;files&nbsp;have&nbsp;out-of-range&nbsp;pixel</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582715">//&nbsp;values.&nbsp;We&nbsp;fall&nbsp;back&nbsp;to&nbsp;opaque&nbsp;black,&nbsp;the&nbsp;same&nbsp;as&nbsp;libpng&nbsp;1.5.13;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582786">//&nbsp;ImageMagick&nbsp;6.5.7&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5582828">d</span><span class="op" id="5582829">.</span><span class="ident" id="5582830">palette</span><span class="op" id="5582837">[</span><span class="ident" id="5582838">i</span><span class="op" id="5582839">]</span>&nbsp;<span class="op" id="5582841">=</span>&nbsp;<span class="ident" id="5582843">color</span><span class="op" id="5582848">.</span><span class="ident" id="5582849">RGBA</span><span class="op" id="5582853">{</span><span class="num" id="5582854">0x00</span><span class="op" id="5582858">,</span>&nbsp;<span class="num" id="5582860">0x00</span><span class="op" id="5582864">,</span>&nbsp;<span class="num" id="5582866">0x00</span><span class="op" id="5582870">,</span>&nbsp;<span class="num" id="5582872">0xff</span><span class="op" id="5582876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5582880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5582884">d</span><span class="op" id="5582885">.</span><span class="ident" id="5582886">palette</span>&nbsp;<span class="op" id="5582894">=</span>&nbsp;<span class="ident" id="5582896">d</span><span class="op" id="5582897">.</span><span class="ident" id="5582898">palette</span><span class="op" id="5582905">[</span><span class="op" id="5582906">:</span><span class="ident" id="5582907">np</span><span class="op" id="5582909">]</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5582912">case</span>&nbsp;<span class="ident" id="5582917">cbTC8</span><span class="op" id="5582922">,</span>&nbsp;<span class="ident" id="5582924">cbTCA8</span><span class="op" id="5582930">,</span>&nbsp;<span class="ident" id="5582932">cbTC16</span><span class="op" id="5582938">,</span>&nbsp;<span class="ident" id="5582940">cbTCA16</span><span class="op" id="5582947">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582951">//&nbsp;As&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec,&nbsp;a&nbsp;PLTE&nbsp;chunk&nbsp;is&nbsp;optional&nbsp;(and&nbsp;for&nbsp;practical&nbsp;purposes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5583031">//&nbsp;ignorable)&nbsp;for&nbsp;the&nbsp;ctTrueColor&nbsp;and&nbsp;ctTrueColorAlpha&nbsp;color&nbsp;types&nbsp;(section&nbsp;4.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583116">default</span><span class="op" id="5583123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583127">return</span>&nbsp;<span class="ident" id="5583134">FormatError</span><span class="op" id="5583145">(</span><span class="string" id="5583146">&#34;PLTE,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="5583173">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5583176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583179">return</span>&nbsp;<span class="ident" id="5583186">d</span><span class="op" id="5583187">.</span><span class="ident" id="5583188">verifyChecksum</span><span class="op" id="5583202">(</span><span class="op" id="5583203">)</span><br>
<span class="lineno"></span><span class="op" id="5583205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5583208">func</span>&nbsp;<span class="op" id="5583213">(</span><span class="ident" id="5583214">d</span>&nbsp;<span class="op" id="5583216">*</span><span class="ident" id="5583217">decoder</span><span class="op" id="5583224">)</span>&nbsp;<span class="ident" id="5583226">parsetRNS</span><span class="op" id="5583235">(</span><span class="ident" id="5583236">length</span>&nbsp;<span class="builtintype" id="5583243">uint32</span><span class="op" id="5583249">)</span>&nbsp;<span class="builtintype" id="5583251">error</span>&nbsp;<span class="op" id="5583257">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583260">if</span>&nbsp;<span class="ident" id="5583263">length</span>&nbsp;<span class="op" id="5583270">&gt;</span>&nbsp;<span class="num" id="5583272">256</span>&nbsp;<span class="op" id="5583276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583280">return</span>&nbsp;<span class="ident" id="5583287">FormatError</span><span class="op" id="5583298">(</span><span class="string" id="5583299">&#34;bad&nbsp;tRNS&nbsp;length&#34;</span><span class="op" id="5583316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5583319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583322">n</span><span class="op" id="5583323">,</span>&nbsp;<span class="ident" id="5583325">err</span>&nbsp;<span class="op" id="5583329">:=</span>&nbsp;<span class="ident" id="5583332">io</span><span class="op" id="5583334">.</span><span class="ident" id="5583335">ReadFull</span><span class="op" id="5583343">(</span><span class="ident" id="5583344">d</span><span class="op" id="5583345">.</span><span class="ident" id="5583346">r</span><span class="op" id="5583347">,</span>&nbsp;<span class="ident" id="5583349">d</span><span class="op" id="5583350">.</span><span class="ident" id="5583351">tmp</span><span class="op" id="5583354">[</span><span class="op" id="5583355">:</span><span class="ident" id="5583356">length</span><span class="op" id="5583362">]</span><span class="op" id="5583363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583366">if</span>&nbsp;<span class="ident" id="5583369">err</span>&nbsp;<span class="op" id="5583373">!=</span>&nbsp;<span class="ident" id="5583376">nil</span>&nbsp;<span class="op" id="5583380">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583384">return</span>&nbsp;<span class="ident" id="5583391">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5583396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583399">d</span><span class="op" id="5583400">.</span><span class="ident" id="5583401">crc</span><span class="op" id="5583404">.</span><span class="ident" id="5583405">Write</span><span class="op" id="5583410">(</span><span class="ident" id="5583411">d</span><span class="op" id="5583412">.</span><span class="ident" id="5583413">tmp</span><span class="op" id="5583416">[</span><span class="op" id="5583417">:</span><span class="ident" id="5583418">n</span><span class="op" id="5583419">]</span><span class="op" id="5583420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583423">switch</span>&nbsp;<span class="ident" id="5583430">d</span><span class="op" id="5583431">.</span><span class="ident" id="5583432">cb</span>&nbsp;<span class="op" id="5583435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583438">case</span>&nbsp;<span class="ident" id="5583443">cbG8</span><span class="op" id="5583447">,</span>&nbsp;<span class="ident" id="5583449">cbG16</span><span class="op" id="5583454">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583458">return</span>&nbsp;<span class="ident" id="5583465">UnsupportedError</span><span class="op" id="5583481">(</span><span class="string" id="5583482">&#34;grayscale&nbsp;transparency&#34;</span><span class="op" id="5583506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583509">case</span>&nbsp;<span class="ident" id="5583514">cbTC8</span><span class="op" id="5583519">,</span>&nbsp;<span class="ident" id="5583521">cbTC16</span><span class="op" id="5583527">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583531">return</span>&nbsp;<span class="ident" id="5583538">UnsupportedError</span><span class="op" id="5583554">(</span><span class="string" id="5583555">&#34;truecolor&nbsp;transparency&#34;</span><span class="op" id="5583579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583582">case</span>&nbsp;<span class="ident" id="5583587">cbP1</span><span class="op" id="5583591">,</span>&nbsp;<span class="ident" id="5583593">cbP2</span><span class="op" id="5583597">,</span>&nbsp;<span class="ident" id="5583599">cbP4</span><span class="op" id="5583603">,</span>&nbsp;<span class="ident" id="5583605">cbP8</span><span class="op" id="5583609">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583613">if</span>&nbsp;<span class="builtinfunc" id="5583616">len</span><span class="op" id="5583619">(</span><span class="ident" id="5583620">d</span><span class="op" id="5583621">.</span><span class="ident" id="5583622">palette</span><span class="op" id="5583629">)</span>&nbsp;<span class="op" id="5583631">&lt;</span>&nbsp;<span class="ident" id="5583633">n</span>&nbsp;<span class="op" id="5583635">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583640">d</span><span class="op" id="5583641">.</span><span class="ident" id="5583642">palette</span>&nbsp;<span class="op" id="5583650">=</span>&nbsp;<span class="ident" id="5583652">d</span><span class="op" id="5583653">.</span><span class="ident" id="5583654">palette</span><span class="op" id="5583661">[</span><span class="op" id="5583662">:</span><span class="ident" id="5583663">n</span><span class="op" id="5583664">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5583668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583672">for</span>&nbsp;<span class="ident" id="5583676">i</span>&nbsp;<span class="op" id="5583678">:=</span>&nbsp;<span class="num" id="5583681">0</span><span class="op" id="5583682">;</span>&nbsp;<span class="ident" id="5583684">i</span>&nbsp;<span class="op" id="5583686">&lt;</span>&nbsp;<span class="ident" id="5583688">n</span><span class="op" id="5583689">;</span>&nbsp;<span class="ident" id="5583691">i</span><span class="op" id="5583692">++</span>&nbsp;<span class="op" id="5583695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583700">rgba</span>&nbsp;<span class="op" id="5583705">:=</span>&nbsp;<span class="ident" id="5583708">d</span><span class="op" id="5583709">.</span><span class="ident" id="5583710">palette</span><span class="op" id="5583717">[</span><span class="ident" id="5583718">i</span><span class="op" id="5583719">]</span><span class="op" id="5583720">.</span><span class="op" id="5583721">(</span><span class="ident" id="5583722">color</span><span class="op" id="5583727">.</span><span class="ident" id="5583728">RGBA</span><span class="op" id="5583732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583737">d</span><span class="op" id="5583738">.</span><span class="ident" id="5583739">palette</span><span class="op" id="5583746">[</span><span class="ident" id="5583747">i</span><span class="op" id="5583748">]</span>&nbsp;<span class="op" id="5583750">=</span>&nbsp;<span class="ident" id="5583752">color</span><span class="op" id="5583757">.</span><span class="ident" id="5583758">NRGBA</span><span class="op" id="5583763">{</span><span class="ident" id="5583764">rgba</span><span class="op" id="5583768">.</span><span class="ident" id="5583769">R</span><span class="op" id="5583770">,</span>&nbsp;<span class="ident" id="5583772">rgba</span><span class="op" id="5583776">.</span><span class="ident" id="5583777">G</span><span class="op" id="5583778">,</span>&nbsp;<span class="ident" id="5583780">rgba</span><span class="op" id="5583784">.</span><span class="ident" id="5583785">B</span><span class="op" id="5583786">,</span>&nbsp;<span class="ident" id="5583788">d</span><span class="op" id="5583789">.</span><span class="ident" id="5583790">tmp</span><span class="op" id="5583793">[</span><span class="ident" id="5583794">i</span><span class="op" id="5583795">]</span><span class="op" id="5583796">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5583800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583803">case</span>&nbsp;<span class="ident" id="5583808">cbGA8</span><span class="op" id="5583813">,</span>&nbsp;<span class="ident" id="5583815">cbGA16</span><span class="op" id="5583821">,</span>&nbsp;<span class="ident" id="5583823">cbTCA8</span><span class="op" id="5583829">,</span>&nbsp;<span class="ident" id="5583831">cbTCA16</span><span class="op" id="5583838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583842">return</span>&nbsp;<span class="ident" id="5583849">FormatError</span><span class="op" id="5583860">(</span><span class="string" id="5583861">&#34;tRNS,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="5583888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5583891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583894">return</span>&nbsp;<span class="ident" id="5583901">d</span><span class="op" id="5583902">.</span><span class="ident" id="5583903">verifyChecksum</span><span class="op" id="5583917">(</span><span class="op" id="5583918">)</span><br>
<span class="lineno">275</span><span class="op" id="5583920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5583923">//&nbsp;Read&nbsp;presents&nbsp;one&nbsp;or&nbsp;more&nbsp;IDAT&nbsp;chunks&nbsp;as&nbsp;one&nbsp;continuous&nbsp;stream&nbsp;(minus&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5584000">//&nbsp;intermediate&nbsp;chunk&nbsp;headers&nbsp;and&nbsp;footers).&nbsp;If&nbsp;the&nbsp;PNG&nbsp;data&nbsp;looked&nbsp;like:</span><br>
<span class="lineno"></span><span class="comment" id="5584073">//&nbsp;&nbsp;&nbsp;...&nbsp;len0&nbsp;IDAT&nbsp;xxx&nbsp;crc0&nbsp;len1&nbsp;IDAT&nbsp;yy&nbsp;crc1&nbsp;len2&nbsp;IEND&nbsp;crc2</span><br>
<span class="lineno">280</span><span class="comment" id="5584134">//&nbsp;then&nbsp;this&nbsp;reader&nbsp;presents&nbsp;xxxyy.&nbsp;For&nbsp;well-formed&nbsp;PNG&nbsp;data,&nbsp;the&nbsp;decoder&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="5584214">//&nbsp;immediately&nbsp;before&nbsp;the&nbsp;first&nbsp;Read&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5584294">//&nbsp;first&nbsp;IDAT&nbsp;and&nbsp;xxx,&nbsp;and&nbsp;the&nbsp;decoder&nbsp;state&nbsp;immediately&nbsp;after&nbsp;the&nbsp;last&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="5584371">//&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;yy&nbsp;and&nbsp;crc1.</span><br>
<span class="lineno"></span><span class="keyword" id="5584426">func</span>&nbsp;<span class="op" id="5584431">(</span><span class="ident" id="5584432">d</span>&nbsp;<span class="op" id="5584434">*</span><span class="ident" id="5584435">decoder</span><span class="op" id="5584442">)</span>&nbsp;<span class="ident" id="5584444">Read</span><span class="op" id="5584448">(</span><span class="ident" id="5584449">p</span>&nbsp;<span class="op" id="5584451">[</span><span class="op" id="5584452">]</span><span class="builtintype" id="5584453">byte</span><span class="op" id="5584457">)</span>&nbsp;<span class="op" id="5584459">(</span><span class="builtintype" id="5584460">int</span><span class="op" id="5584463">,</span>&nbsp;<span class="builtintype" id="5584465">error</span><span class="op" id="5584470">)</span>&nbsp;<span class="op" id="5584472">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584475">if</span>&nbsp;<span class="builtinfunc" id="5584478">len</span><span class="op" id="5584481">(</span><span class="ident" id="5584482">p</span><span class="op" id="5584483">)</span>&nbsp;<span class="op" id="5584485">==</span>&nbsp;<span class="num" id="5584488">0</span>&nbsp;<span class="op" id="5584490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584494">return</span>&nbsp;<span class="num" id="5584501">0</span><span class="op" id="5584502">,</span>&nbsp;<span class="ident" id="5584504">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5584509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584512">for</span>&nbsp;<span class="ident" id="5584516">d</span><span class="op" id="5584517">.</span><span class="ident" id="5584518">idatLength</span>&nbsp;<span class="op" id="5584529">==</span>&nbsp;<span class="num" id="5584532">0</span>&nbsp;<span class="op" id="5584534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5584538">//&nbsp;We&nbsp;have&nbsp;exhausted&nbsp;an&nbsp;IDAT&nbsp;chunk.&nbsp;Verify&nbsp;the&nbsp;checksum&nbsp;of&nbsp;that&nbsp;chunk.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584611">if</span>&nbsp;<span class="ident" id="5584614">err</span>&nbsp;<span class="op" id="5584618">:=</span>&nbsp;<span class="ident" id="5584621">d</span><span class="op" id="5584622">.</span><span class="ident" id="5584623">verifyChecksum</span><span class="op" id="5584637">(</span><span class="op" id="5584638">)</span><span class="op" id="5584639">;</span>&nbsp;<span class="ident" id="5584641">err</span>&nbsp;<span class="op" id="5584645">!=</span>&nbsp;<span class="ident" id="5584648">nil</span>&nbsp;<span class="op" id="5584652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584657">return</span>&nbsp;<span class="num" id="5584664">0</span><span class="op" id="5584665">,</span>&nbsp;<span class="ident" id="5584667">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5584673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5584677">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type&nbsp;of&nbsp;the&nbsp;next&nbsp;chunk,&nbsp;and&nbsp;check&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5584747">//&nbsp;it&nbsp;is&nbsp;an&nbsp;IDAT&nbsp;chunk.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584773">if</span>&nbsp;<span class="ident" id="5584776">_</span><span class="op" id="5584777">,</span>&nbsp;<span class="ident" id="5584779">err</span>&nbsp;<span class="op" id="5584783">:=</span>&nbsp;<span class="ident" id="5584786">io</span><span class="op" id="5584788">.</span><span class="ident" id="5584789">ReadFull</span><span class="op" id="5584797">(</span><span class="ident" id="5584798">d</span><span class="op" id="5584799">.</span><span class="ident" id="5584800">r</span><span class="op" id="5584801">,</span>&nbsp;<span class="ident" id="5584803">d</span><span class="op" id="5584804">.</span><span class="ident" id="5584805">tmp</span><span class="op" id="5584808">[</span><span class="op" id="5584809">:</span><span class="num" id="5584810">8</span><span class="op" id="5584811">]</span><span class="op" id="5584812">)</span><span class="op" id="5584813">;</span>&nbsp;<span class="ident" id="5584815">err</span>&nbsp;<span class="op" id="5584819">!=</span>&nbsp;<span class="ident" id="5584822">nil</span>&nbsp;<span class="op" id="5584826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584831">return</span>&nbsp;<span class="num" id="5584838">0</span><span class="op" id="5584839">,</span>&nbsp;<span class="ident" id="5584841">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5584847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5584851">d</span><span class="op" id="5584852">.</span><span class="ident" id="5584853">idatLength</span>&nbsp;<span class="op" id="5584864">=</span>&nbsp;<span class="ident" id="5584866">binary</span><span class="op" id="5584872">.</span><span class="ident" id="5584873">BigEndian</span><span class="op" id="5584882">.</span><span class="ident" id="5584883">Uint32</span><span class="op" id="5584889">(</span><span class="ident" id="5584890">d</span><span class="op" id="5584891">.</span><span class="ident" id="5584892">tmp</span><span class="op" id="5584895">[</span><span class="op" id="5584896">:</span><span class="num" id="5584897">4</span><span class="op" id="5584898">]</span><span class="op" id="5584899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584903">if</span>&nbsp;<span class="builtintype" id="5584906">string</span><span class="op" id="5584912">(</span><span class="ident" id="5584913">d</span><span class="op" id="5584914">.</span><span class="ident" id="5584915">tmp</span><span class="op" id="5584918">[</span><span class="num" id="5584919">4</span><span class="op" id="5584920">:</span><span class="num" id="5584921">8</span><span class="op" id="5584922">]</span><span class="op" id="5584923">)</span>&nbsp;<span class="op" id="5584925">!=</span>&nbsp;<span class="string" id="5584928">&#34;IDAT&#34;</span>&nbsp;<span class="op" id="5584935">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584940">return</span>&nbsp;<span class="num" id="5584947">0</span><span class="op" id="5584948">,</span>&nbsp;<span class="ident" id="5584950">FormatError</span><span class="op" id="5584961">(</span><span class="string" id="5584962">&#34;not&nbsp;enough&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="5584985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5584989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5584993">d</span><span class="op" id="5584994">.</span><span class="ident" id="5584995">crc</span><span class="op" id="5584998">.</span><span class="ident" id="5584999">Reset</span><span class="op" id="5585004">(</span><span class="op" id="5585005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585009">d</span><span class="op" id="5585010">.</span><span class="ident" id="5585011">crc</span><span class="op" id="5585014">.</span><span class="ident" id="5585015">Write</span><span class="op" id="5585020">(</span><span class="ident" id="5585021">d</span><span class="op" id="5585022">.</span><span class="ident" id="5585023">tmp</span><span class="op" id="5585026">[</span><span class="num" id="5585027">4</span><span class="op" id="5585028">:</span><span class="num" id="5585029">8</span><span class="op" id="5585030">]</span><span class="op" id="5585031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5585034">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585037">if</span>&nbsp;<span class="builtintype" id="5585040">int</span><span class="op" id="5585043">(</span><span class="ident" id="5585044">d</span><span class="op" id="5585045">.</span><span class="ident" id="5585046">idatLength</span><span class="op" id="5585056">)</span>&nbsp;<span class="op" id="5585058">&lt;</span>&nbsp;<span class="num" id="5585060">0</span>&nbsp;<span class="op" id="5585062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585066">return</span>&nbsp;<span class="num" id="5585073">0</span><span class="op" id="5585074">,</span>&nbsp;<span class="ident" id="5585076">UnsupportedError</span><span class="op" id="5585092">(</span><span class="string" id="5585093">&#34;IDAT&nbsp;chunk&nbsp;length&nbsp;overflow&#34;</span><span class="op" id="5585121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5585124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585127">n</span><span class="op" id="5585128">,</span>&nbsp;<span class="ident" id="5585130">err</span>&nbsp;<span class="op" id="5585134">:=</span>&nbsp;<span class="ident" id="5585137">d</span><span class="op" id="5585138">.</span><span class="ident" id="5585139">r</span><span class="op" id="5585140">.</span><span class="ident" id="5585141">Read</span><span class="op" id="5585145">(</span><span class="ident" id="5585146">p</span><span class="op" id="5585147">[</span><span class="op" id="5585148">:</span><span class="ident" id="5585149">min</span><span class="op" id="5585152">(</span><span class="builtinfunc" id="5585153">len</span><span class="op" id="5585156">(</span><span class="ident" id="5585157">p</span><span class="op" id="5585158">)</span><span class="op" id="5585159">,</span>&nbsp;<span class="builtintype" id="5585161">int</span><span class="op" id="5585164">(</span><span class="ident" id="5585165">d</span><span class="op" id="5585166">.</span><span class="ident" id="5585167">idatLength</span><span class="op" id="5585177">)</span><span class="op" id="5585178">)</span><span class="op" id="5585179">]</span><span class="op" id="5585180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585183">d</span><span class="op" id="5585184">.</span><span class="ident" id="5585185">crc</span><span class="op" id="5585188">.</span><span class="ident" id="5585189">Write</span><span class="op" id="5585194">(</span><span class="ident" id="5585195">p</span><span class="op" id="5585196">[</span><span class="op" id="5585197">:</span><span class="ident" id="5585198">n</span><span class="op" id="5585199">]</span><span class="op" id="5585200">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585203">d</span><span class="op" id="5585204">.</span><span class="ident" id="5585205">idatLength</span>&nbsp;<span class="op" id="5585216">-=</span>&nbsp;<span class="builtintype" id="5585219">uint32</span><span class="op" id="5585225">(</span><span class="ident" id="5585226">n</span><span class="op" id="5585227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585230">return</span>&nbsp;<span class="ident" id="5585237">n</span><span class="op" id="5585238">,</span>&nbsp;<span class="ident" id="5585240">err</span><br>
<span class="lineno"></span><span class="op" id="5585244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5585247">//&nbsp;decode&nbsp;decodes&nbsp;the&nbsp;IDAT&nbsp;data&nbsp;into&nbsp;an&nbsp;image.</span><br>
<span class="lineno">315</span><span class="keyword" id="5585294">func</span>&nbsp;<span class="op" id="5585299">(</span><span class="ident" id="5585300">d</span>&nbsp;<span class="op" id="5585302">*</span><span class="ident" id="5585303">decoder</span><span class="op" id="5585310">)</span>&nbsp;<span class="ident" id="5585312">decode</span><span class="op" id="5585318">(</span><span class="op" id="5585319">)</span>&nbsp;<span class="op" id="5585321">(</span><span class="ident" id="5585322">image</span><span class="op" id="5585327">.</span><span class="ident" id="5585328">Image</span><span class="op" id="5585333">,</span>&nbsp;<span class="builtintype" id="5585335">error</span><span class="op" id="5585340">)</span>&nbsp;<span class="op" id="5585342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585345">r</span><span class="op" id="5585346">,</span>&nbsp;<span class="ident" id="5585348">err</span>&nbsp;<span class="op" id="5585352">:=</span>&nbsp;<span class="ident" id="5585355">zlib</span><span class="op" id="5585359">.</span><span class="ident" id="5585360">NewReader</span><span class="op" id="5585369">(</span><span class="ident" id="5585370">d</span><span class="op" id="5585371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585374">if</span>&nbsp;<span class="ident" id="5585377">err</span>&nbsp;<span class="op" id="5585381">!=</span>&nbsp;<span class="ident" id="5585384">nil</span>&nbsp;<span class="op" id="5585388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585392">return</span>&nbsp;<span class="ident" id="5585399">nil</span><span class="op" id="5585402">,</span>&nbsp;<span class="ident" id="5585404">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5585409">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585412">defer</span>&nbsp;<span class="ident" id="5585418">r</span><span class="op" id="5585419">.</span><span class="ident" id="5585420">Close</span><span class="op" id="5585425">(</span><span class="op" id="5585426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585429">var</span>&nbsp;<span class="ident" id="5585433">img</span>&nbsp;<span class="ident" id="5585437">image</span><span class="op" id="5585442">.</span><span class="ident" id="5585443">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585450">if</span>&nbsp;<span class="ident" id="5585453">d</span><span class="op" id="5585454">.</span><span class="ident" id="5585455">interlace</span>&nbsp;<span class="op" id="5585465">==</span>&nbsp;<span class="ident" id="5585468">itNone</span>&nbsp;<span class="op" id="5585475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585479">img</span><span class="op" id="5585482">,</span>&nbsp;<span class="ident" id="5585484">err</span>&nbsp;<span class="op" id="5585488">=</span>&nbsp;<span class="ident" id="5585490">d</span><span class="op" id="5585491">.</span><span class="ident" id="5585492">readImagePass</span><span class="op" id="5585505">(</span><span class="ident" id="5585506">r</span><span class="op" id="5585507">,</span>&nbsp;<span class="num" id="5585509">0</span><span class="op" id="5585510">,</span>&nbsp;<span class="builtintype" id="5585512">false</span><span class="op" id="5585517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5585520">}</span>&nbsp;<span class="keyword" id="5585522">else</span>&nbsp;<span class="keyword" id="5585527">if</span>&nbsp;<span class="ident" id="5585530">d</span><span class="op" id="5585531">.</span><span class="ident" id="5585532">interlace</span>&nbsp;<span class="op" id="5585542">==</span>&nbsp;<span class="ident" id="5585545">itAdam7</span>&nbsp;<span class="op" id="5585553">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5585557">//&nbsp;Allocate&nbsp;a&nbsp;blank&nbsp;image&nbsp;of&nbsp;the&nbsp;full&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585603">img</span><span class="op" id="5585606">,</span>&nbsp;<span class="ident" id="5585608">err</span>&nbsp;<span class="op" id="5585612">=</span>&nbsp;<span class="ident" id="5585614">d</span><span class="op" id="5585615">.</span><span class="ident" id="5585616">readImagePass</span><span class="op" id="5585629">(</span><span class="ident" id="5585630">nil</span><span class="op" id="5585633">,</span>&nbsp;<span class="num" id="5585635">0</span><span class="op" id="5585636">,</span>&nbsp;<span class="builtintype" id="5585638">true</span><span class="op" id="5585642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585646">for</span>&nbsp;<span class="ident" id="5585650">pass</span>&nbsp;<span class="op" id="5585655">:=</span>&nbsp;<span class="num" id="5585658">0</span><span class="op" id="5585659">;</span>&nbsp;<span class="ident" id="5585661">pass</span>&nbsp;<span class="op" id="5585666">&lt;</span>&nbsp;<span class="num" id="5585668">7</span><span class="op" id="5585669">;</span>&nbsp;<span class="ident" id="5585671">pass</span><span class="op" id="5585675">++</span>&nbsp;<span class="op" id="5585678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585683">imagePass</span><span class="op" id="5585692">,</span>&nbsp;<span class="ident" id="5585694">err</span>&nbsp;<span class="op" id="5585698">:=</span>&nbsp;<span class="ident" id="5585701">d</span><span class="op" id="5585702">.</span><span class="ident" id="5585703">readImagePass</span><span class="op" id="5585716">(</span><span class="ident" id="5585717">r</span><span class="op" id="5585718">,</span>&nbsp;<span class="ident" id="5585720">pass</span><span class="op" id="5585724">,</span>&nbsp;<span class="builtintype" id="5585726">false</span><span class="op" id="5585731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585736">if</span>&nbsp;<span class="ident" id="5585739">err</span>&nbsp;<span class="op" id="5585743">!=</span>&nbsp;<span class="ident" id="5585746">nil</span>&nbsp;<span class="op" id="5585750">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585756">return</span>&nbsp;<span class="ident" id="5585763">nil</span><span class="op" id="5585766">,</span>&nbsp;<span class="ident" id="5585768">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5585775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585780">d</span><span class="op" id="5585781">.</span><span class="ident" id="5585782">mergePassInto</span><span class="op" id="5585795">(</span><span class="ident" id="5585796">img</span><span class="op" id="5585799">,</span>&nbsp;<span class="ident" id="5585801">imagePass</span><span class="op" id="5585810">,</span>&nbsp;<span class="ident" id="5585812">pass</span><span class="op" id="5585816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5585820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5585823">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5585827">//&nbsp;Check&nbsp;for&nbsp;EOF,&nbsp;to&nbsp;verify&nbsp;the&nbsp;zlib&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585875">n</span>&nbsp;<span class="op" id="5585877">:=</span>&nbsp;<span class="num" id="5585880">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585883">for</span>&nbsp;<span class="ident" id="5585887">i</span>&nbsp;<span class="op" id="5585889">:=</span>&nbsp;<span class="num" id="5585892">0</span><span class="op" id="5585893">;</span>&nbsp;<span class="ident" id="5585895">n</span>&nbsp;<span class="op" id="5585897">==</span>&nbsp;<span class="num" id="5585900">0</span>&nbsp;<span class="op" id="5585902">&amp;&amp;</span>&nbsp;<span class="ident" id="5585905">err</span>&nbsp;<span class="op" id="5585909">==</span>&nbsp;<span class="ident" id="5585912">nil</span><span class="op" id="5585915">;</span>&nbsp;<span class="ident" id="5585917">i</span><span class="op" id="5585918">++</span>&nbsp;<span class="op" id="5585921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585925">if</span>&nbsp;<span class="ident" id="5585928">i</span>&nbsp;<span class="op" id="5585930">==</span>&nbsp;<span class="num" id="5585933">100</span>&nbsp;<span class="op" id="5585937">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585942">return</span>&nbsp;<span class="ident" id="5585949">nil</span><span class="op" id="5585952">,</span>&nbsp;<span class="ident" id="5585954">io</span><span class="op" id="5585956">.</span><span class="ident" id="5585957">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5585973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585977">n</span><span class="op" id="5585978">,</span>&nbsp;<span class="ident" id="5585980">err</span>&nbsp;<span class="op" id="5585984">=</span>&nbsp;<span class="ident" id="5585986">r</span><span class="op" id="5585987">.</span><span class="ident" id="5585988">Read</span><span class="op" id="5585992">(</span><span class="ident" id="5585993">d</span><span class="op" id="5585994">.</span><span class="ident" id="5585995">tmp</span><span class="op" id="5585998">[</span><span class="op" id="5585999">:</span><span class="num" id="5586000">1</span><span class="op" id="5586001">]</span><span class="op" id="5586002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5586005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586008">if</span>&nbsp;<span class="ident" id="5586011">err</span>&nbsp;<span class="op" id="5586015">!=</span>&nbsp;<span class="ident" id="5586018">nil</span>&nbsp;<span class="op" id="5586022">&amp;&amp;</span>&nbsp;<span class="ident" id="5586025">err</span>&nbsp;<span class="op" id="5586029">!=</span>&nbsp;<span class="ident" id="5586032">io</span><span class="op" id="5586034">.</span><span class="ident" id="5586035">EOF</span>&nbsp;<span class="op" id="5586039">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586043">return</span>&nbsp;<span class="ident" id="5586050">nil</span><span class="op" id="5586053">,</span>&nbsp;<span class="ident" id="5586055">FormatError</span><span class="op" id="5586066">(</span><span class="ident" id="5586067">err</span><span class="op" id="5586070">.</span><span class="ident" id="5586071">Error</span><span class="op" id="5586076">(</span><span class="op" id="5586077">)</span><span class="op" id="5586078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5586081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586084">if</span>&nbsp;<span class="ident" id="5586087">n</span>&nbsp;<span class="op" id="5586089">!=</span>&nbsp;<span class="num" id="5586092">0</span>&nbsp;<span class="op" id="5586094">||</span>&nbsp;<span class="ident" id="5586097">d</span><span class="op" id="5586098">.</span><span class="ident" id="5586099">idatLength</span>&nbsp;<span class="op" id="5586110">!=</span>&nbsp;<span class="num" id="5586113">0</span>&nbsp;<span class="op" id="5586115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586119">return</span>&nbsp;<span class="ident" id="5586126">nil</span><span class="op" id="5586129">,</span>&nbsp;<span class="ident" id="5586131">FormatError</span><span class="op" id="5586142">(</span><span class="string" id="5586143">&#34;too&nbsp;much&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="5586164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5586167">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586171">return</span>&nbsp;<span class="ident" id="5586178">img</span><span class="op" id="5586181">,</span>&nbsp;<span class="ident" id="5586183">nil</span><br>
<span class="lineno"></span><span class="op" id="5586187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5586190">//&nbsp;readImagePass&nbsp;reads&nbsp;a&nbsp;single&nbsp;image&nbsp;pass,&nbsp;sized&nbsp;according&nbsp;to&nbsp;the&nbsp;pass&nbsp;number.</span><br>
<span class="lineno">355</span><span class="keyword" id="5586270">func</span>&nbsp;<span class="op" id="5586275">(</span><span class="ident" id="5586276">d</span>&nbsp;<span class="op" id="5586278">*</span><span class="ident" id="5586279">decoder</span><span class="op" id="5586286">)</span>&nbsp;<span class="ident" id="5586288">readImagePass</span><span class="op" id="5586301">(</span><span class="ident" id="5586302">r</span>&nbsp;<span class="ident" id="5586304">io</span><span class="op" id="5586306">.</span><span class="ident" id="5586307">Reader</span><span class="op" id="5586313">,</span>&nbsp;<span class="ident" id="5586315">pass</span>&nbsp;<span class="builtintype" id="5586320">int</span><span class="op" id="5586323">,</span>&nbsp;<span class="ident" id="5586325">allocateOnly</span>&nbsp;<span class="builtintype" id="5586338">bool</span><span class="op" id="5586342">)</span>&nbsp;<span class="op" id="5586344">(</span><span class="ident" id="5586345">image</span><span class="op" id="5586350">.</span><span class="ident" id="5586351">Image</span><span class="op" id="5586356">,</span>&nbsp;<span class="builtintype" id="5586358">error</span><span class="op" id="5586363">)</span>&nbsp;<span class="op" id="5586365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586368">var</span>&nbsp;<span class="ident" id="5586372">bitsPerPixel</span>&nbsp;<span class="builtintype" id="5586385">int</span>&nbsp;<span class="op" id="5586389">=</span>&nbsp;<span class="num" id="5586391">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586394">pixOffset</span>&nbsp;<span class="op" id="5586404">:=</span>&nbsp;<span class="num" id="5586407">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586410">var</span>&nbsp;<span class="op" id="5586414">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586418">gray</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586427">*</span><span class="ident" id="5586428">image</span><span class="op" id="5586433">.</span><span class="ident" id="5586434">Gray</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586441">rgba</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586450">*</span><span class="ident" id="5586451">image</span><span class="op" id="5586456">.</span><span class="ident" id="5586457">RGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586464">paletted</span>&nbsp;<span class="op" id="5586473">*</span><span class="ident" id="5586474">image</span><span class="op" id="5586479">.</span><span class="ident" id="5586480">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586491">nrgba</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586500">*</span><span class="ident" id="5586501">image</span><span class="op" id="5586506">.</span><span class="ident" id="5586507">NRGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586515">gray16</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5586524">*</span><span class="ident" id="5586525">image</span><span class="op" id="5586530">.</span><span class="ident" id="5586531">Gray16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586540">rgba64</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5586549">*</span><span class="ident" id="5586550">image</span><span class="op" id="5586555">.</span><span class="ident" id="5586556">RGBA64</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586565">nrgba64</span>&nbsp;&nbsp;<span class="op" id="5586574">*</span><span class="ident" id="5586575">image</span><span class="op" id="5586580">.</span><span class="ident" id="5586581">NRGBA64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586591">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586600">image</span><span class="op" id="5586605">.</span><span class="ident" id="5586606">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5586613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586616">width</span><span class="op" id="5586621">,</span>&nbsp;<span class="ident" id="5586623">height</span>&nbsp;<span class="op" id="5586630">:=</span>&nbsp;<span class="ident" id="5586633">d</span><span class="op" id="5586634">.</span><span class="ident" id="5586635">width</span><span class="op" id="5586640">,</span>&nbsp;<span class="ident" id="5586642">d</span><span class="op" id="5586643">.</span><span class="ident" id="5586644">height</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586652">if</span>&nbsp;<span class="ident" id="5586655">d</span><span class="op" id="5586656">.</span><span class="ident" id="5586657">interlace</span>&nbsp;<span class="op" id="5586667">==</span>&nbsp;<span class="ident" id="5586670">itAdam7</span>&nbsp;<span class="op" id="5586678">&amp;&amp;</span>&nbsp;<span class="op" id="5586681">!</span><span class="ident" id="5586682">allocateOnly</span>&nbsp;<span class="op" id="5586695">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586699">p</span>&nbsp;<span class="op" id="5586701">:=</span>&nbsp;<span class="ident" id="5586704">interlacing</span><span class="op" id="5586715">[</span><span class="ident" id="5586716">pass</span><span class="op" id="5586720">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5586724">//&nbsp;Add&nbsp;the&nbsp;multiplication&nbsp;factor&nbsp;and&nbsp;subtract&nbsp;one,&nbsp;effectively&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586802">width</span>&nbsp;<span class="op" id="5586808">=</span>&nbsp;<span class="op" id="5586810">(</span><span class="ident" id="5586811">width</span>&nbsp;<span class="op" id="5586817">-</span>&nbsp;<span class="ident" id="5586819">p</span><span class="op" id="5586820">.</span><span class="ident" id="5586821">xOffset</span>&nbsp;<span class="op" id="5586829">+</span>&nbsp;<span class="ident" id="5586831">p</span><span class="op" id="5586832">.</span><span class="ident" id="5586833">xFactor</span>&nbsp;<span class="op" id="5586841">-</span>&nbsp;<span class="num" id="5586843">1</span><span class="op" id="5586844">)</span>&nbsp;<span class="op" id="5586846">/</span>&nbsp;<span class="ident" id="5586848">p</span><span class="op" id="5586849">.</span><span class="ident" id="5586850">xFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586860">height</span>&nbsp;<span class="op" id="5586867">=</span>&nbsp;<span class="op" id="5586869">(</span><span class="ident" id="5586870">height</span>&nbsp;<span class="op" id="5586877">-</span>&nbsp;<span class="ident" id="5586879">p</span><span class="op" id="5586880">.</span><span class="ident" id="5586881">yOffset</span>&nbsp;<span class="op" id="5586889">+</span>&nbsp;<span class="ident" id="5586891">p</span><span class="op" id="5586892">.</span><span class="ident" id="5586893">yFactor</span>&nbsp;<span class="op" id="5586901">-</span>&nbsp;<span class="num" id="5586903">1</span><span class="op" id="5586904">)</span>&nbsp;<span class="op" id="5586906">/</span>&nbsp;<span class="ident" id="5586908">p</span><span class="op" id="5586909">.</span><span class="ident" id="5586910">yFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5586919">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586922">switch</span>&nbsp;<span class="ident" id="5586929">d</span><span class="op" id="5586930">.</span><span class="ident" id="5586931">cb</span>&nbsp;<span class="op" id="5586934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586937">case</span>&nbsp;<span class="ident" id="5586942">cbG1</span><span class="op" id="5586946">,</span>&nbsp;<span class="ident" id="5586948">cbG2</span><span class="op" id="5586952">,</span>&nbsp;<span class="ident" id="5586954">cbG4</span><span class="op" id="5586958">,</span>&nbsp;<span class="ident" id="5586960">cbG8</span><span class="op" id="5586964">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586968">bitsPerPixel</span>&nbsp;<span class="op" id="5586981">=</span>&nbsp;<span class="ident" id="5586983">d</span><span class="op" id="5586984">.</span><span class="ident" id="5586985">depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586993">gray</span>&nbsp;<span class="op" id="5586998">=</span>&nbsp;<span class="ident" id="5587000">image</span><span class="op" id="5587005">.</span><span class="ident" id="5587006">NewGray</span><span class="op" id="5587013">(</span><span class="ident" id="5587014">image</span><span class="op" id="5587019">.</span><span class="ident" id="5587020">Rect</span><span class="op" id="5587024">(</span><span class="num" id="5587025">0</span><span class="op" id="5587026">,</span>&nbsp;<span class="num" id="5587028">0</span><span class="op" id="5587029">,</span>&nbsp;<span class="ident" id="5587031">width</span><span class="op" id="5587036">,</span>&nbsp;<span class="ident" id="5587038">height</span><span class="op" id="5587044">)</span><span class="op" id="5587045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587049">img</span>&nbsp;<span class="op" id="5587053">=</span>&nbsp;<span class="ident" id="5587055">gray</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587061">case</span>&nbsp;<span class="ident" id="5587066">cbGA8</span><span class="op" id="5587071">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587075">bitsPerPixel</span>&nbsp;<span class="op" id="5587088">=</span>&nbsp;<span class="num" id="5587090">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587095">nrgba</span>&nbsp;<span class="op" id="5587101">=</span>&nbsp;<span class="ident" id="5587103">image</span><span class="op" id="5587108">.</span><span class="ident" id="5587109">NewNRGBA</span><span class="op" id="5587117">(</span><span class="ident" id="5587118">image</span><span class="op" id="5587123">.</span><span class="ident" id="5587124">Rect</span><span class="op" id="5587128">(</span><span class="num" id="5587129">0</span><span class="op" id="5587130">,</span>&nbsp;<span class="num" id="5587132">0</span><span class="op" id="5587133">,</span>&nbsp;<span class="ident" id="5587135">width</span><span class="op" id="5587140">,</span>&nbsp;<span class="ident" id="5587142">height</span><span class="op" id="5587148">)</span><span class="op" id="5587149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587153">img</span>&nbsp;<span class="op" id="5587157">=</span>&nbsp;<span class="ident" id="5587159">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587166">case</span>&nbsp;<span class="ident" id="5587171">cbTC8</span><span class="op" id="5587176">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587180">bitsPerPixel</span>&nbsp;<span class="op" id="5587193">=</span>&nbsp;<span class="num" id="5587195">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587200">rgba</span>&nbsp;<span class="op" id="5587205">=</span>&nbsp;<span class="ident" id="5587207">image</span><span class="op" id="5587212">.</span><span class="ident" id="5587213">NewRGBA</span><span class="op" id="5587220">(</span><span class="ident" id="5587221">image</span><span class="op" id="5587226">.</span><span class="ident" id="5587227">Rect</span><span class="op" id="5587231">(</span><span class="num" id="5587232">0</span><span class="op" id="5587233">,</span>&nbsp;<span class="num" id="5587235">0</span><span class="op" id="5587236">,</span>&nbsp;<span class="ident" id="5587238">width</span><span class="op" id="5587243">,</span>&nbsp;<span class="ident" id="5587245">height</span><span class="op" id="5587251">)</span><span class="op" id="5587252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587256">img</span>&nbsp;<span class="op" id="5587260">=</span>&nbsp;<span class="ident" id="5587262">rgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587268">case</span>&nbsp;<span class="ident" id="5587273">cbP1</span><span class="op" id="5587277">,</span>&nbsp;<span class="ident" id="5587279">cbP2</span><span class="op" id="5587283">,</span>&nbsp;<span class="ident" id="5587285">cbP4</span><span class="op" id="5587289">,</span>&nbsp;<span class="ident" id="5587291">cbP8</span><span class="op" id="5587295">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587299">bitsPerPixel</span>&nbsp;<span class="op" id="5587312">=</span>&nbsp;<span class="ident" id="5587314">d</span><span class="op" id="5587315">.</span><span class="ident" id="5587316">depth</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587324">paletted</span>&nbsp;<span class="op" id="5587333">=</span>&nbsp;<span class="ident" id="5587335">image</span><span class="op" id="5587340">.</span><span class="ident" id="5587341">NewPaletted</span><span class="op" id="5587352">(</span><span class="ident" id="5587353">image</span><span class="op" id="5587358">.</span><span class="ident" id="5587359">Rect</span><span class="op" id="5587363">(</span><span class="num" id="5587364">0</span><span class="op" id="5587365">,</span>&nbsp;<span class="num" id="5587367">0</span><span class="op" id="5587368">,</span>&nbsp;<span class="ident" id="5587370">width</span><span class="op" id="5587375">,</span>&nbsp;<span class="ident" id="5587377">height</span><span class="op" id="5587383">)</span><span class="op" id="5587384">,</span>&nbsp;<span class="ident" id="5587386">d</span><span class="op" id="5587387">.</span><span class="ident" id="5587388">palette</span><span class="op" id="5587395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587399">img</span>&nbsp;<span class="op" id="5587403">=</span>&nbsp;<span class="ident" id="5587405">paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587415">case</span>&nbsp;<span class="ident" id="5587420">cbTCA8</span><span class="op" id="5587426">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587430">bitsPerPixel</span>&nbsp;<span class="op" id="5587443">=</span>&nbsp;<span class="num" id="5587445">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587450">nrgba</span>&nbsp;<span class="op" id="5587456">=</span>&nbsp;<span class="ident" id="5587458">image</span><span class="op" id="5587463">.</span><span class="ident" id="5587464">NewNRGBA</span><span class="op" id="5587472">(</span><span class="ident" id="5587473">image</span><span class="op" id="5587478">.</span><span class="ident" id="5587479">Rect</span><span class="op" id="5587483">(</span><span class="num" id="5587484">0</span><span class="op" id="5587485">,</span>&nbsp;<span class="num" id="5587487">0</span><span class="op" id="5587488">,</span>&nbsp;<span class="ident" id="5587490">width</span><span class="op" id="5587495">,</span>&nbsp;<span class="ident" id="5587497">height</span><span class="op" id="5587503">)</span><span class="op" id="5587504">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587508">img</span>&nbsp;<span class="op" id="5587512">=</span>&nbsp;<span class="ident" id="5587514">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587521">case</span>&nbsp;<span class="ident" id="5587526">cbG16</span><span class="op" id="5587531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587535">bitsPerPixel</span>&nbsp;<span class="op" id="5587548">=</span>&nbsp;<span class="num" id="5587550">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587555">gray16</span>&nbsp;<span class="op" id="5587562">=</span>&nbsp;<span class="ident" id="5587564">image</span><span class="op" id="5587569">.</span><span class="ident" id="5587570">NewGray16</span><span class="op" id="5587579">(</span><span class="ident" id="5587580">image</span><span class="op" id="5587585">.</span><span class="ident" id="5587586">Rect</span><span class="op" id="5587590">(</span><span class="num" id="5587591">0</span><span class="op" id="5587592">,</span>&nbsp;<span class="num" id="5587594">0</span><span class="op" id="5587595">,</span>&nbsp;<span class="ident" id="5587597">width</span><span class="op" id="5587602">,</span>&nbsp;<span class="ident" id="5587604">height</span><span class="op" id="5587610">)</span><span class="op" id="5587611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587615">img</span>&nbsp;<span class="op" id="5587619">=</span>&nbsp;<span class="ident" id="5587621">gray16</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587629">case</span>&nbsp;<span class="ident" id="5587634">cbGA16</span><span class="op" id="5587640">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587644">bitsPerPixel</span>&nbsp;<span class="op" id="5587657">=</span>&nbsp;<span class="num" id="5587659">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587664">nrgba64</span>&nbsp;<span class="op" id="5587672">=</span>&nbsp;<span class="ident" id="5587674">image</span><span class="op" id="5587679">.</span><span class="ident" id="5587680">NewNRGBA64</span><span class="op" id="5587690">(</span><span class="ident" id="5587691">image</span><span class="op" id="5587696">.</span><span class="ident" id="5587697">Rect</span><span class="op" id="5587701">(</span><span class="num" id="5587702">0</span><span class="op" id="5587703">,</span>&nbsp;<span class="num" id="5587705">0</span><span class="op" id="5587706">,</span>&nbsp;<span class="ident" id="5587708">width</span><span class="op" id="5587713">,</span>&nbsp;<span class="ident" id="5587715">height</span><span class="op" id="5587721">)</span><span class="op" id="5587722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587726">img</span>&nbsp;<span class="op" id="5587730">=</span>&nbsp;<span class="ident" id="5587732">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587741">case</span>&nbsp;<span class="ident" id="5587746">cbTC16</span><span class="op" id="5587752">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587756">bitsPerPixel</span>&nbsp;<span class="op" id="5587769">=</span>&nbsp;<span class="num" id="5587771">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587776">rgba64</span>&nbsp;<span class="op" id="5587783">=</span>&nbsp;<span class="ident" id="5587785">image</span><span class="op" id="5587790">.</span><span class="ident" id="5587791">NewRGBA64</span><span class="op" id="5587800">(</span><span class="ident" id="5587801">image</span><span class="op" id="5587806">.</span><span class="ident" id="5587807">Rect</span><span class="op" id="5587811">(</span><span class="num" id="5587812">0</span><span class="op" id="5587813">,</span>&nbsp;<span class="num" id="5587815">0</span><span class="op" id="5587816">,</span>&nbsp;<span class="ident" id="5587818">width</span><span class="op" id="5587823">,</span>&nbsp;<span class="ident" id="5587825">height</span><span class="op" id="5587831">)</span><span class="op" id="5587832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587836">img</span>&nbsp;<span class="op" id="5587840">=</span>&nbsp;<span class="ident" id="5587842">rgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587850">case</span>&nbsp;<span class="ident" id="5587855">cbTCA16</span><span class="op" id="5587862">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587866">bitsPerPixel</span>&nbsp;<span class="op" id="5587879">=</span>&nbsp;<span class="num" id="5587881">64</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587886">nrgba64</span>&nbsp;<span class="op" id="5587894">=</span>&nbsp;<span class="ident" id="5587896">image</span><span class="op" id="5587901">.</span><span class="ident" id="5587902">NewNRGBA64</span><span class="op" id="5587912">(</span><span class="ident" id="5587913">image</span><span class="op" id="5587918">.</span><span class="ident" id="5587919">Rect</span><span class="op" id="5587923">(</span><span class="num" id="5587924">0</span><span class="op" id="5587925">,</span>&nbsp;<span class="num" id="5587927">0</span><span class="op" id="5587928">,</span>&nbsp;<span class="ident" id="5587930">width</span><span class="op" id="5587935">,</span>&nbsp;<span class="ident" id="5587937">height</span><span class="op" id="5587943">)</span><span class="op" id="5587944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587948">img</span>&nbsp;<span class="op" id="5587952">=</span>&nbsp;<span class="ident" id="5587954">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5587963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587966">if</span>&nbsp;<span class="ident" id="5587969">allocateOnly</span>&nbsp;<span class="op" id="5587982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587986">return</span>&nbsp;<span class="ident" id="5587993">img</span><span class="op" id="5587996">,</span>&nbsp;<span class="ident" id="5587998">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5588003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588006">bytesPerPixel</span>&nbsp;<span class="op" id="5588020">:=</span>&nbsp;<span class="op" id="5588023">(</span><span class="ident" id="5588024">bitsPerPixel</span>&nbsp;<span class="op" id="5588037">+</span>&nbsp;<span class="num" id="5588039">7</span><span class="op" id="5588040">)</span>&nbsp;<span class="op" id="5588042">/</span>&nbsp;<span class="num" id="5588044">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5588048">//&nbsp;The&nbsp;+1&nbsp;is&nbsp;for&nbsp;the&nbsp;per-row&nbsp;filter&nbsp;type,&nbsp;which&nbsp;is&nbsp;at&nbsp;cr[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588110">rowSize</span>&nbsp;<span class="op" id="5588118">:=</span>&nbsp;<span class="num" id="5588121">1</span>&nbsp;<span class="op" id="5588123">+</span>&nbsp;<span class="op" id="5588125">(</span><span class="ident" id="5588126">bitsPerPixel</span><span class="op" id="5588138">*</span><span class="ident" id="5588139">width</span><span class="op" id="5588144">+</span><span class="num" id="5588145">7</span><span class="op" id="5588146">)</span><span class="op" id="5588147">/</span><span class="num" id="5588148">8</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5588151">//&nbsp;cr&nbsp;and&nbsp;pr&nbsp;are&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;current&nbsp;and&nbsp;previous&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588213">cr</span>&nbsp;<span class="op" id="5588216">:=</span>&nbsp;<span class="builtinfunc" id="5588219">make</span><span class="op" id="5588223">(</span><span class="op" id="5588224">[</span><span class="op" id="5588225">]</span><span class="builtintype" id="5588226">uint8</span><span class="op" id="5588231">,</span>&nbsp;<span class="ident" id="5588233">rowSize</span><span class="op" id="5588240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588243">pr</span>&nbsp;<span class="op" id="5588246">:=</span>&nbsp;<span class="builtinfunc" id="5588249">make</span><span class="op" id="5588253">(</span><span class="op" id="5588254">[</span><span class="op" id="5588255">]</span><span class="builtintype" id="5588256">uint8</span><span class="op" id="5588261">,</span>&nbsp;<span class="ident" id="5588263">rowSize</span><span class="op" id="5588270">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588274">for</span>&nbsp;<span class="ident" id="5588278">y</span>&nbsp;<span class="op" id="5588280">:=</span>&nbsp;<span class="num" id="5588283">0</span><span class="op" id="5588284">;</span>&nbsp;<span class="ident" id="5588286">y</span>&nbsp;<span class="op" id="5588288">&lt;</span>&nbsp;<span class="ident" id="5588290">height</span><span class="op" id="5588296">;</span>&nbsp;<span class="ident" id="5588298">y</span><span class="op" id="5588299">++</span>&nbsp;<span class="op" id="5588302">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5588306">//&nbsp;Read&nbsp;the&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588340">_</span><span class="op" id="5588341">,</span>&nbsp;<span class="ident" id="5588343">err</span>&nbsp;<span class="op" id="5588347">:=</span>&nbsp;<span class="ident" id="5588350">io</span><span class="op" id="5588352">.</span><span class="ident" id="5588353">ReadFull</span><span class="op" id="5588361">(</span><span class="ident" id="5588362">r</span><span class="op" id="5588363">,</span>&nbsp;<span class="ident" id="5588365">cr</span><span class="op" id="5588367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588371">if</span>&nbsp;<span class="ident" id="5588374">err</span>&nbsp;<span class="op" id="5588378">!=</span>&nbsp;<span class="ident" id="5588381">nil</span>&nbsp;<span class="op" id="5588385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588390">return</span>&nbsp;<span class="ident" id="5588397">nil</span><span class="op" id="5588400">,</span>&nbsp;<span class="ident" id="5588402">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5588408">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5588413">//&nbsp;Apply&nbsp;the&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588436">cdat</span>&nbsp;<span class="op" id="5588441">:=</span>&nbsp;<span class="ident" id="5588444">cr</span><span class="op" id="5588446">[</span><span class="num" id="5588447">1</span><span class="op" id="5588448">:</span><span class="op" id="5588449">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588453">pdat</span>&nbsp;<span class="op" id="5588458">:=</span>&nbsp;<span class="ident" id="5588461">pr</span><span class="op" id="5588463">[</span><span class="num" id="5588464">1</span><span class="op" id="5588465">:</span><span class="op" id="5588466">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588470">switch</span>&nbsp;<span class="ident" id="5588477">cr</span><span class="op" id="5588479">[</span><span class="num" id="5588480">0</span><span class="op" id="5588481">]</span>&nbsp;<span class="op" id="5588483">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588487">case</span>&nbsp;<span class="ident" id="5588492">ftNone</span><span class="op" id="5588498">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5588503">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588515">case</span>&nbsp;<span class="ident" id="5588520">ftSub</span><span class="op" id="5588525">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588530">for</span>&nbsp;<span class="ident" id="5588534">i</span>&nbsp;<span class="op" id="5588536">:=</span>&nbsp;<span class="ident" id="5588539">bytesPerPixel</span><span class="op" id="5588552">;</span>&nbsp;<span class="ident" id="5588554">i</span>&nbsp;<span class="op" id="5588556">&lt;</span>&nbsp;<span class="builtinfunc" id="5588558">len</span><span class="op" id="5588561">(</span><span class="ident" id="5588562">cdat</span><span class="op" id="5588566">)</span><span class="op" id="5588567">;</span>&nbsp;<span class="ident" id="5588569">i</span><span class="op" id="5588570">++</span>&nbsp;<span class="op" id="5588573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588579">cdat</span><span class="op" id="5588583">[</span><span class="ident" id="5588584">i</span><span class="op" id="5588585">]</span>&nbsp;<span class="op" id="5588587">+=</span>&nbsp;<span class="ident" id="5588590">cdat</span><span class="op" id="5588594">[</span><span class="ident" id="5588595">i</span><span class="op" id="5588596">-</span><span class="ident" id="5588597">bytesPerPixel</span><span class="op" id="5588610">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5588615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588619">case</span>&nbsp;<span class="ident" id="5588624">ftUp</span><span class="op" id="5588628">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588633">for</span>&nbsp;<span class="ident" id="5588637">i</span><span class="op" id="5588638">,</span>&nbsp;<span class="ident" id="5588640">p</span>&nbsp;<span class="op" id="5588642">:=</span>&nbsp;<span class="keyword" id="5588645">range</span>&nbsp;<span class="ident" id="5588651">pdat</span>&nbsp;<span class="op" id="5588656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588662">cdat</span><span class="op" id="5588666">[</span><span class="ident" id="5588667">i</span><span class="op" id="5588668">]</span>&nbsp;<span class="op" id="5588670">+=</span>&nbsp;<span class="ident" id="5588673">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5588678">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588682">case</span>&nbsp;<span class="ident" id="5588687">ftAverage</span><span class="op" id="5588696">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588701">for</span>&nbsp;<span class="ident" id="5588705">i</span>&nbsp;<span class="op" id="5588707">:=</span>&nbsp;<span class="num" id="5588710">0</span><span class="op" id="5588711">;</span>&nbsp;<span class="ident" id="5588713">i</span>&nbsp;<span class="op" id="5588715">&lt;</span>&nbsp;<span class="ident" id="5588717">bytesPerPixel</span><span class="op" id="5588730">;</span>&nbsp;<span class="ident" id="5588732">i</span><span class="op" id="5588733">++</span>&nbsp;<span class="op" id="5588736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588742">cdat</span><span class="op" id="5588746">[</span><span class="ident" id="5588747">i</span><span class="op" id="5588748">]</span>&nbsp;<span class="op" id="5588750">+=</span>&nbsp;<span class="ident" id="5588753">pdat</span><span class="op" id="5588757">[</span><span class="ident" id="5588758">i</span><span class="op" id="5588759">]</span>&nbsp;<span class="op" id="5588761">/</span>&nbsp;<span class="num" id="5588763">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5588768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588773">for</span>&nbsp;<span class="ident" id="5588777">i</span>&nbsp;<span class="op" id="5588779">:=</span>&nbsp;<span class="ident" id="5588782">bytesPerPixel</span><span class="op" id="5588795">;</span>&nbsp;<span class="ident" id="5588797">i</span>&nbsp;<span class="op" id="5588799">&lt;</span>&nbsp;<span class="builtinfunc" id="5588801">len</span><span class="op" id="5588804">(</span><span class="ident" id="5588805">cdat</span><span class="op" id="5588809">)</span><span class="op" id="5588810">;</span>&nbsp;<span class="ident" id="5588812">i</span><span class="op" id="5588813">++</span>&nbsp;<span class="op" id="5588816">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588822">cdat</span><span class="op" id="5588826">[</span><span class="ident" id="5588827">i</span><span class="op" id="5588828">]</span>&nbsp;<span class="op" id="5588830">+=</span>&nbsp;<span class="builtintype" id="5588833">uint8</span><span class="op" id="5588838">(</span><span class="op" id="5588839">(</span><span class="builtintype" id="5588840">int</span><span class="op" id="5588843">(</span><span class="ident" id="5588844">cdat</span><span class="op" id="5588848">[</span><span class="ident" id="5588849">i</span><span class="op" id="5588850">-</span><span class="ident" id="5588851">bytesPerPixel</span><span class="op" id="5588864">]</span><span class="op" id="5588865">)</span>&nbsp;<span class="op" id="5588867">+</span>&nbsp;<span class="builtintype" id="5588869">int</span><span class="op" id="5588872">(</span><span class="ident" id="5588873">pdat</span><span class="op" id="5588877">[</span><span class="ident" id="5588878">i</span><span class="op" id="5588879">]</span><span class="op" id="5588880">)</span><span class="op" id="5588881">)</span>&nbsp;<span class="op" id="5588883">/</span>&nbsp;<span class="num" id="5588885">2</span><span class="op" id="5588886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5588891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588895">case</span>&nbsp;<span class="ident" id="5588900">ftPaeth</span><span class="op" id="5588907">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588912">filterPaeth</span><span class="op" id="5588923">(</span><span class="ident" id="5588924">cdat</span><span class="op" id="5588928">,</span>&nbsp;<span class="ident" id="5588930">pdat</span><span class="op" id="5588934">,</span>&nbsp;<span class="ident" id="5588936">bytesPerPixel</span><span class="op" id="5588949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588953">default</span><span class="op" id="5588960">:</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588965">return</span>&nbsp;<span class="ident" id="5588972">nil</span><span class="op" id="5588975">,</span>&nbsp;<span class="ident" id="5588977">FormatError</span><span class="op" id="5588988">(</span><span class="string" id="5588989">&#34;bad&nbsp;filter&nbsp;type&#34;</span><span class="op" id="5589006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5589010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5589015">//&nbsp;Convert&nbsp;from&nbsp;bytes&nbsp;to&nbsp;colors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589050">switch</span>&nbsp;<span class="ident" id="5589057">d</span><span class="op" id="5589058">.</span><span class="ident" id="5589059">cb</span>&nbsp;<span class="op" id="5589062">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589066">case</span>&nbsp;<span class="ident" id="5589071">cbG1</span><span class="op" id="5589075">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589080">for</span>&nbsp;<span class="ident" id="5589084">x</span>&nbsp;<span class="op" id="5589086">:=</span>&nbsp;<span class="num" id="5589089">0</span><span class="op" id="5589090">;</span>&nbsp;<span class="ident" id="5589092">x</span>&nbsp;<span class="op" id="5589094">&lt;</span>&nbsp;<span class="ident" id="5589096">width</span><span class="op" id="5589101">;</span>&nbsp;<span class="ident" id="5589103">x</span>&nbsp;<span class="op" id="5589105">+=</span>&nbsp;<span class="num" id="5589108">8</span>&nbsp;<span class="op" id="5589110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589116">b</span>&nbsp;<span class="op" id="5589118">:=</span>&nbsp;<span class="ident" id="5589121">cdat</span><span class="op" id="5589125">[</span><span class="ident" id="5589126">x</span><span class="op" id="5589127">/</span><span class="num" id="5589128">8</span><span class="op" id="5589129">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589135">for</span>&nbsp;<span class="ident" id="5589139">x2</span>&nbsp;<span class="op" id="5589142">:=</span>&nbsp;<span class="num" id="5589145">0</span><span class="op" id="5589146">;</span>&nbsp;<span class="ident" id="5589148">x2</span>&nbsp;<span class="op" id="5589151">&lt;</span>&nbsp;<span class="num" id="5589153">8</span>&nbsp;<span class="op" id="5589155">&amp;&amp;</span>&nbsp;<span class="ident" id="5589158">x</span><span class="op" id="5589159">+</span><span class="ident" id="5589160">x2</span>&nbsp;<span class="op" id="5589163">&lt;</span>&nbsp;<span class="ident" id="5589165">width</span><span class="op" id="5589170">;</span>&nbsp;<span class="ident" id="5589172">x2</span><span class="op" id="5589174">++</span>&nbsp;<span class="op" id="5589177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589184">gray</span><span class="op" id="5589188">.</span><span class="ident" id="5589189">SetGray</span><span class="op" id="5589196">(</span><span class="ident" id="5589197">x</span><span class="op" id="5589198">+</span><span class="ident" id="5589199">x2</span><span class="op" id="5589201">,</span>&nbsp;<span class="ident" id="5589203">y</span><span class="op" id="5589204">,</span>&nbsp;<span class="ident" id="5589206">color</span><span class="op" id="5589211">.</span><span class="ident" id="5589212">Gray</span><span class="op" id="5589216">{</span><span class="op" id="5589217">(</span><span class="ident" id="5589218">b</span>&nbsp;<span class="op" id="5589220">&gt;&gt;</span>&nbsp;<span class="num" id="5589223">7</span><span class="op" id="5589224">)</span>&nbsp;<span class="op" id="5589226">*</span>&nbsp;<span class="num" id="5589228">0xff</span><span class="op" id="5589232">}</span><span class="op" id="5589233">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589240">b</span>&nbsp;<span class="op" id="5589242">&lt;&lt;=</span>&nbsp;<span class="num" id="5589246">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5589252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5589257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589261">case</span>&nbsp;<span class="ident" id="5589266">cbG2</span><span class="op" id="5589270">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589275">for</span>&nbsp;<span class="ident" id="5589279">x</span>&nbsp;<span class="op" id="5589281">:=</span>&nbsp;<span class="num" id="5589284">0</span><span class="op" id="5589285">;</span>&nbsp;<span class="ident" id="5589287">x</span>&nbsp;<span class="op" id="5589289">&lt;</span>&nbsp;<span class="ident" id="5589291">width</span><span class="op" id="5589296">;</span>&nbsp;<span class="ident" id="5589298">x</span>&nbsp;<span class="op" id="5589300">+=</span>&nbsp;<span class="num" id="5589303">4</span>&nbsp;<span class="op" id="5589305">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589311">b</span>&nbsp;<span class="op" id="5589313">:=</span>&nbsp;<span class="ident" id="5589316">cdat</span><span class="op" id="5589320">[</span><span class="ident" id="5589321">x</span><span class="op" id="5589322">/</span><span class="num" id="5589323">4</span><span class="op" id="5589324">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589330">for</span>&nbsp;<span class="ident" id="5589334">x2</span>&nbsp;<span class="op" id="5589337">:=</span>&nbsp;<span class="num" id="5589340">0</span><span class="op" id="5589341">;</span>&nbsp;<span class="ident" id="5589343">x2</span>&nbsp;<span class="op" id="5589346">&lt;</span>&nbsp;<span class="num" id="5589348">4</span>&nbsp;<span class="op" id="5589350">&amp;&amp;</span>&nbsp;<span class="ident" id="5589353">x</span><span class="op" id="5589354">+</span><span class="ident" id="5589355">x2</span>&nbsp;<span class="op" id="5589358">&lt;</span>&nbsp;<span class="ident" id="5589360">width</span><span class="op" id="5589365">;</span>&nbsp;<span class="ident" id="5589367">x2</span><span class="op" id="5589369">++</span>&nbsp;<span class="op" id="5589372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589379">gray</span><span class="op" id="5589383">.</span><span class="ident" id="5589384">SetGray</span><span class="op" id="5589391">(</span><span class="ident" id="5589392">x</span><span class="op" id="5589393">+</span><span class="ident" id="5589394">x2</span><span class="op" id="5589396">,</span>&nbsp;<span class="ident" id="5589398">y</span><span class="op" id="5589399">,</span>&nbsp;<span class="ident" id="5589401">color</span><span class="op" id="5589406">.</span><span class="ident" id="5589407">Gray</span><span class="op" id="5589411">{</span><span class="op" id="5589412">(</span><span class="ident" id="5589413">b</span>&nbsp;<span class="op" id="5589415">&gt;&gt;</span>&nbsp;<span class="num" id="5589418">6</span><span class="op" id="5589419">)</span>&nbsp;<span class="op" id="5589421">*</span>&nbsp;<span class="num" id="5589423">0x55</span><span class="op" id="5589427">}</span><span class="op" id="5589428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589435">b</span>&nbsp;<span class="op" id="5589437">&lt;&lt;=</span>&nbsp;<span class="num" id="5589441">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5589447">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5589452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589456">case</span>&nbsp;<span class="ident" id="5589461">cbG4</span><span class="op" id="5589465">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589470">for</span>&nbsp;<span class="ident" id="5589474">x</span>&nbsp;<span class="op" id="5589476">:=</span>&nbsp;<span class="num" id="5589479">0</span><span class="op" id="5589480">;</span>&nbsp;<span class="ident" id="5589482">x</span>&nbsp;<span class="op" id="5589484">&lt;</span>&nbsp;<span class="ident" id="5589486">width</span><span class="op" id="5589491">;</span>&nbsp;<span class="ident" id="5589493">x</span>&nbsp;<span class="op" id="5589495">+=</span>&nbsp;<span class="num" id="5589498">2</span>&nbsp;<span class="op" id="5589500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589506">b</span>&nbsp;<span class="op" id="5589508">:=</span>&nbsp;<span class="ident" id="5589511">cdat</span><span class="op" id="5589515">[</span><span class="ident" id="5589516">x</span><span class="op" id="5589517">/</span><span class="num" id="5589518">2</span><span class="op" id="5589519">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589525">for</span>&nbsp;<span class="ident" id="5589529">x2</span>&nbsp;<span class="op" id="5589532">:=</span>&nbsp;<span class="num" id="5589535">0</span><span class="op" id="5589536">;</span>&nbsp;<span class="ident" id="5589538">x2</span>&nbsp;<span class="op" id="5589541">&lt;</span>&nbsp;<span class="num" id="5589543">2</span>&nbsp;<span class="op" id="5589545">&amp;&amp;</span>&nbsp;<span class="ident" id="5589548">x</span><span class="op" id="5589549">+</span><span class="ident" id="5589550">x2</span>&nbsp;<span class="op" id="5589553">&lt;</span>&nbsp;<span class="ident" id="5589555">width</span><span class="op" id="5589560">;</span>&nbsp;<span class="ident" id="5589562">x2</span><span class="op" id="5589564">++</span>&nbsp;<span class="op" id="5589567">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589574">gray</span><span class="op" id="5589578">.</span><span class="ident" id="5589579">SetGray</span><span class="op" id="5589586">(</span><span class="ident" id="5589587">x</span><span class="op" id="5589588">+</span><span class="ident" id="5589589">x2</span><span class="op" id="5589591">,</span>&nbsp;<span class="ident" id="5589593">y</span><span class="op" id="5589594">,</span>&nbsp;<span class="ident" id="5589596">color</span><span class="op" id="5589601">.</span><span class="ident" id="5589602">Gray</span><span class="op" id="5589606">{</span><span class="op" id="5589607">(</span><span class="ident" id="5589608">b</span>&nbsp;<span class="op" id="5589610">&gt;&gt;</span>&nbsp;<span class="num" id="5589613">4</span><span class="op" id="5589614">)</span>&nbsp;<span class="op" id="5589616">*</span>&nbsp;<span class="num" id="5589618">0x11</span><span class="op" id="5589622">}</span><span class="op" id="5589623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589630">b</span>&nbsp;<span class="op" id="5589632">&lt;&lt;=</span>&nbsp;<span class="num" id="5589636">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5589642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5589647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589651">case</span>&nbsp;<span class="ident" id="5589656">cbG8</span><span class="op" id="5589660">:</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5589665">copy</span><span class="op" id="5589669">(</span><span class="ident" id="5589670">gray</span><span class="op" id="5589674">.</span><span class="ident" id="5589675">Pix</span><span class="op" id="5589678">[</span><span class="ident" id="5589679">pixOffset</span><span class="op" id="5589688">:</span><span class="op" id="5589689">]</span><span class="op" id="5589690">,</span>&nbsp;<span class="ident" id="5589692">cdat</span><span class="op" id="5589696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589701">pixOffset</span>&nbsp;<span class="op" id="5589711">+=</span>&nbsp;<span class="ident" id="5589714">gray</span><span class="op" id="5589718">.</span><span class="ident" id="5589719">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589728">case</span>&nbsp;<span class="ident" id="5589733">cbGA8</span><span class="op" id="5589738">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589743">for</span>&nbsp;<span class="ident" id="5589747">x</span>&nbsp;<span class="op" id="5589749">:=</span>&nbsp;<span class="num" id="5589752">0</span><span class="op" id="5589753">;</span>&nbsp;<span class="ident" id="5589755">x</span>&nbsp;<span class="op" id="5589757">&lt;</span>&nbsp;<span class="ident" id="5589759">width</span><span class="op" id="5589764">;</span>&nbsp;<span class="ident" id="5589766">x</span><span class="op" id="5589767">++</span>&nbsp;<span class="op" id="5589770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589776">ycol</span>&nbsp;<span class="op" id="5589781">:=</span>&nbsp;<span class="ident" id="5589784">cdat</span><span class="op" id="5589788">[</span><span class="num" id="5589789">2</span><span class="op" id="5589790">*</span><span class="ident" id="5589791">x</span><span class="op" id="5589792">+</span><span class="num" id="5589793">0</span><span class="op" id="5589794">]</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589800">nrgba</span><span class="op" id="5589805">.</span><span class="ident" id="5589806">SetNRGBA</span><span class="op" id="5589814">(</span><span class="ident" id="5589815">x</span><span class="op" id="5589816">,</span>&nbsp;<span class="ident" id="5589818">y</span><span class="op" id="5589819">,</span>&nbsp;<span class="ident" id="5589821">color</span><span class="op" id="5589826">.</span><span class="ident" id="5589827">NRGBA</span><span class="op" id="5589832">{</span><span class="ident" id="5589833">ycol</span><span class="op" id="5589837">,</span>&nbsp;<span class="ident" id="5589839">ycol</span><span class="op" id="5589843">,</span>&nbsp;<span class="ident" id="5589845">ycol</span><span class="op" id="5589849">,</span>&nbsp;<span class="ident" id="5589851">cdat</span><span class="op" id="5589855">[</span><span class="num" id="5589856">2</span><span class="op" id="5589857">*</span><span class="ident" id="5589858">x</span><span class="op" id="5589859">+</span><span class="num" id="5589860">1</span><span class="op" id="5589861">]</span><span class="op" id="5589862">}</span><span class="op" id="5589863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5589868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589872">case</span>&nbsp;<span class="ident" id="5589877">cbTC8</span><span class="op" id="5589882">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589887">pix</span><span class="op" id="5589890">,</span>&nbsp;<span class="ident" id="5589892">i</span><span class="op" id="5589893">,</span>&nbsp;<span class="ident" id="5589895">j</span>&nbsp;<span class="op" id="5589897">:=</span>&nbsp;<span class="ident" id="5589900">rgba</span><span class="op" id="5589904">.</span><span class="ident" id="5589905">Pix</span><span class="op" id="5589908">,</span>&nbsp;<span class="ident" id="5589910">pixOffset</span><span class="op" id="5589919">,</span>&nbsp;<span class="num" id="5589921">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589926">for</span>&nbsp;<span class="ident" id="5589930">x</span>&nbsp;<span class="op" id="5589932">:=</span>&nbsp;<span class="num" id="5589935">0</span><span class="op" id="5589936">;</span>&nbsp;<span class="ident" id="5589938">x</span>&nbsp;<span class="op" id="5589940">&lt;</span>&nbsp;<span class="ident" id="5589942">width</span><span class="op" id="5589947">;</span>&nbsp;<span class="ident" id="5589949">x</span><span class="op" id="5589950">++</span>&nbsp;<span class="op" id="5589953">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589959">pix</span><span class="op" id="5589962">[</span><span class="ident" id="5589963">i</span><span class="op" id="5589964">+</span><span class="num" id="5589965">0</span><span class="op" id="5589966">]</span>&nbsp;<span class="op" id="5589968">=</span>&nbsp;<span class="ident" id="5589970">cdat</span><span class="op" id="5589974">[</span><span class="ident" id="5589975">j</span><span class="op" id="5589976">+</span><span class="num" id="5589977">0</span><span class="op" id="5589978">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589984">pix</span><span class="op" id="5589987">[</span><span class="ident" id="5589988">i</span><span class="op" id="5589989">+</span><span class="num" id="5589990">1</span><span class="op" id="5589991">]</span>&nbsp;<span class="op" id="5589993">=</span>&nbsp;<span class="ident" id="5589995">cdat</span><span class="op" id="5589999">[</span><span class="ident" id="5590000">j</span><span class="op" id="5590001">+</span><span class="num" id="5590002">1</span><span class="op" id="5590003">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590009">pix</span><span class="op" id="5590012">[</span><span class="ident" id="5590013">i</span><span class="op" id="5590014">+</span><span class="num" id="5590015">2</span><span class="op" id="5590016">]</span>&nbsp;<span class="op" id="5590018">=</span>&nbsp;<span class="ident" id="5590020">cdat</span><span class="op" id="5590024">[</span><span class="ident" id="5590025">j</span><span class="op" id="5590026">+</span><span class="num" id="5590027">2</span><span class="op" id="5590028">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590034">pix</span><span class="op" id="5590037">[</span><span class="ident" id="5590038">i</span><span class="op" id="5590039">+</span><span class="num" id="5590040">3</span><span class="op" id="5590041">]</span>&nbsp;<span class="op" id="5590043">=</span>&nbsp;<span class="num" id="5590045">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590054">i</span>&nbsp;<span class="op" id="5590056">+=</span>&nbsp;<span class="num" id="5590059">4</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590065">j</span>&nbsp;<span class="op" id="5590067">+=</span>&nbsp;<span class="num" id="5590070">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590080">pixOffset</span>&nbsp;<span class="op" id="5590090">+=</span>&nbsp;<span class="ident" id="5590093">rgba</span><span class="op" id="5590097">.</span><span class="ident" id="5590098">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590107">case</span>&nbsp;<span class="ident" id="5590112">cbP1</span><span class="op" id="5590116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590121">for</span>&nbsp;<span class="ident" id="5590125">x</span>&nbsp;<span class="op" id="5590127">:=</span>&nbsp;<span class="num" id="5590130">0</span><span class="op" id="5590131">;</span>&nbsp;<span class="ident" id="5590133">x</span>&nbsp;<span class="op" id="5590135">&lt;</span>&nbsp;<span class="ident" id="5590137">width</span><span class="op" id="5590142">;</span>&nbsp;<span class="ident" id="5590144">x</span>&nbsp;<span class="op" id="5590146">+=</span>&nbsp;<span class="num" id="5590149">8</span>&nbsp;<span class="op" id="5590151">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590157">b</span>&nbsp;<span class="op" id="5590159">:=</span>&nbsp;<span class="ident" id="5590162">cdat</span><span class="op" id="5590166">[</span><span class="ident" id="5590167">x</span><span class="op" id="5590168">/</span><span class="num" id="5590169">8</span><span class="op" id="5590170">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590176">for</span>&nbsp;<span class="ident" id="5590180">x2</span>&nbsp;<span class="op" id="5590183">:=</span>&nbsp;<span class="num" id="5590186">0</span><span class="op" id="5590187">;</span>&nbsp;<span class="ident" id="5590189">x2</span>&nbsp;<span class="op" id="5590192">&lt;</span>&nbsp;<span class="num" id="5590194">8</span>&nbsp;<span class="op" id="5590196">&amp;&amp;</span>&nbsp;<span class="ident" id="5590199">x</span><span class="op" id="5590200">+</span><span class="ident" id="5590201">x2</span>&nbsp;<span class="op" id="5590204">&lt;</span>&nbsp;<span class="ident" id="5590206">width</span><span class="op" id="5590211">;</span>&nbsp;<span class="ident" id="5590213">x2</span><span class="op" id="5590215">++</span>&nbsp;<span class="op" id="5590218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590225">idx</span>&nbsp;<span class="op" id="5590229">:=</span>&nbsp;<span class="ident" id="5590232">b</span>&nbsp;<span class="op" id="5590234">&gt;&gt;</span>&nbsp;<span class="num" id="5590237">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590244">if</span>&nbsp;<span class="builtinfunc" id="5590247">len</span><span class="op" id="5590250">(</span><span class="ident" id="5590251">paletted</span><span class="op" id="5590259">.</span><span class="ident" id="5590260">Palette</span><span class="op" id="5590267">)</span>&nbsp;<span class="op" id="5590269">&lt;=</span>&nbsp;<span class="builtintype" id="5590272">int</span><span class="op" id="5590275">(</span><span class="ident" id="5590276">idx</span><span class="op" id="5590279">)</span>&nbsp;<span class="op" id="5590281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590289">paletted</span><span class="op" id="5590297">.</span><span class="ident" id="5590298">Palette</span>&nbsp;<span class="op" id="5590306">=</span>&nbsp;<span class="ident" id="5590308">paletted</span><span class="op" id="5590316">.</span><span class="ident" id="5590317">Palette</span><span class="op" id="5590324">[</span><span class="op" id="5590325">:</span><span class="builtintype" id="5590326">int</span><span class="op" id="5590329">(</span><span class="ident" id="5590330">idx</span><span class="op" id="5590333">)</span><span class="op" id="5590334">+</span><span class="num" id="5590335">1</span><span class="op" id="5590336">]</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590350">paletted</span><span class="op" id="5590358">.</span><span class="ident" id="5590359">SetColorIndex</span><span class="op" id="5590372">(</span><span class="ident" id="5590373">x</span><span class="op" id="5590374">+</span><span class="ident" id="5590375">x2</span><span class="op" id="5590377">,</span>&nbsp;<span class="ident" id="5590379">y</span><span class="op" id="5590380">,</span>&nbsp;<span class="ident" id="5590382">idx</span><span class="op" id="5590385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590392">b</span>&nbsp;<span class="op" id="5590394">&lt;&lt;=</span>&nbsp;<span class="num" id="5590398">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590409">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590413">case</span>&nbsp;<span class="ident" id="5590418">cbP2</span><span class="op" id="5590422">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590427">for</span>&nbsp;<span class="ident" id="5590431">x</span>&nbsp;<span class="op" id="5590433">:=</span>&nbsp;<span class="num" id="5590436">0</span><span class="op" id="5590437">;</span>&nbsp;<span class="ident" id="5590439">x</span>&nbsp;<span class="op" id="5590441">&lt;</span>&nbsp;<span class="ident" id="5590443">width</span><span class="op" id="5590448">;</span>&nbsp;<span class="ident" id="5590450">x</span>&nbsp;<span class="op" id="5590452">+=</span>&nbsp;<span class="num" id="5590455">4</span>&nbsp;<span class="op" id="5590457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590463">b</span>&nbsp;<span class="op" id="5590465">:=</span>&nbsp;<span class="ident" id="5590468">cdat</span><span class="op" id="5590472">[</span><span class="ident" id="5590473">x</span><span class="op" id="5590474">/</span><span class="num" id="5590475">4</span><span class="op" id="5590476">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590482">for</span>&nbsp;<span class="ident" id="5590486">x2</span>&nbsp;<span class="op" id="5590489">:=</span>&nbsp;<span class="num" id="5590492">0</span><span class="op" id="5590493">;</span>&nbsp;<span class="ident" id="5590495">x2</span>&nbsp;<span class="op" id="5590498">&lt;</span>&nbsp;<span class="num" id="5590500">4</span>&nbsp;<span class="op" id="5590502">&amp;&amp;</span>&nbsp;<span class="ident" id="5590505">x</span><span class="op" id="5590506">+</span><span class="ident" id="5590507">x2</span>&nbsp;<span class="op" id="5590510">&lt;</span>&nbsp;<span class="ident" id="5590512">width</span><span class="op" id="5590517">;</span>&nbsp;<span class="ident" id="5590519">x2</span><span class="op" id="5590521">++</span>&nbsp;<span class="op" id="5590524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590531">idx</span>&nbsp;<span class="op" id="5590535">:=</span>&nbsp;<span class="ident" id="5590538">b</span>&nbsp;<span class="op" id="5590540">&gt;&gt;</span>&nbsp;<span class="num" id="5590543">6</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590550">if</span>&nbsp;<span class="builtinfunc" id="5590553">len</span><span class="op" id="5590556">(</span><span class="ident" id="5590557">paletted</span><span class="op" id="5590565">.</span><span class="ident" id="5590566">Palette</span><span class="op" id="5590573">)</span>&nbsp;<span class="op" id="5590575">&lt;=</span>&nbsp;<span class="builtintype" id="5590578">int</span><span class="op" id="5590581">(</span><span class="ident" id="5590582">idx</span><span class="op" id="5590585">)</span>&nbsp;<span class="op" id="5590587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590595">paletted</span><span class="op" id="5590603">.</span><span class="ident" id="5590604">Palette</span>&nbsp;<span class="op" id="5590612">=</span>&nbsp;<span class="ident" id="5590614">paletted</span><span class="op" id="5590622">.</span><span class="ident" id="5590623">Palette</span><span class="op" id="5590630">[</span><span class="op" id="5590631">:</span><span class="builtintype" id="5590632">int</span><span class="op" id="5590635">(</span><span class="ident" id="5590636">idx</span><span class="op" id="5590639">)</span><span class="op" id="5590640">+</span><span class="num" id="5590641">1</span><span class="op" id="5590642">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590656">paletted</span><span class="op" id="5590664">.</span><span class="ident" id="5590665">SetColorIndex</span><span class="op" id="5590678">(</span><span class="ident" id="5590679">x</span><span class="op" id="5590680">+</span><span class="ident" id="5590681">x2</span><span class="op" id="5590683">,</span>&nbsp;<span class="ident" id="5590685">y</span><span class="op" id="5590686">,</span>&nbsp;<span class="ident" id="5590688">idx</span><span class="op" id="5590691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590698">b</span>&nbsp;<span class="op" id="5590700">&lt;&lt;=</span>&nbsp;<span class="num" id="5590704">2</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590719">case</span>&nbsp;<span class="ident" id="5590724">cbP4</span><span class="op" id="5590728">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590733">for</span>&nbsp;<span class="ident" id="5590737">x</span>&nbsp;<span class="op" id="5590739">:=</span>&nbsp;<span class="num" id="5590742">0</span><span class="op" id="5590743">;</span>&nbsp;<span class="ident" id="5590745">x</span>&nbsp;<span class="op" id="5590747">&lt;</span>&nbsp;<span class="ident" id="5590749">width</span><span class="op" id="5590754">;</span>&nbsp;<span class="ident" id="5590756">x</span>&nbsp;<span class="op" id="5590758">+=</span>&nbsp;<span class="num" id="5590761">2</span>&nbsp;<span class="op" id="5590763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590769">b</span>&nbsp;<span class="op" id="5590771">:=</span>&nbsp;<span class="ident" id="5590774">cdat</span><span class="op" id="5590778">[</span><span class="ident" id="5590779">x</span><span class="op" id="5590780">/</span><span class="num" id="5590781">2</span><span class="op" id="5590782">]</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590788">for</span>&nbsp;<span class="ident" id="5590792">x2</span>&nbsp;<span class="op" id="5590795">:=</span>&nbsp;<span class="num" id="5590798">0</span><span class="op" id="5590799">;</span>&nbsp;<span class="ident" id="5590801">x2</span>&nbsp;<span class="op" id="5590804">&lt;</span>&nbsp;<span class="num" id="5590806">2</span>&nbsp;<span class="op" id="5590808">&amp;&amp;</span>&nbsp;<span class="ident" id="5590811">x</span><span class="op" id="5590812">+</span><span class="ident" id="5590813">x2</span>&nbsp;<span class="op" id="5590816">&lt;</span>&nbsp;<span class="ident" id="5590818">width</span><span class="op" id="5590823">;</span>&nbsp;<span class="ident" id="5590825">x2</span><span class="op" id="5590827">++</span>&nbsp;<span class="op" id="5590830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590837">idx</span>&nbsp;<span class="op" id="5590841">:=</span>&nbsp;<span class="ident" id="5590844">b</span>&nbsp;<span class="op" id="5590846">&gt;&gt;</span>&nbsp;<span class="num" id="5590849">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590856">if</span>&nbsp;<span class="builtinfunc" id="5590859">len</span><span class="op" id="5590862">(</span><span class="ident" id="5590863">paletted</span><span class="op" id="5590871">.</span><span class="ident" id="5590872">Palette</span><span class="op" id="5590879">)</span>&nbsp;<span class="op" id="5590881">&lt;=</span>&nbsp;<span class="builtintype" id="5590884">int</span><span class="op" id="5590887">(</span><span class="ident" id="5590888">idx</span><span class="op" id="5590891">)</span>&nbsp;<span class="op" id="5590893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590901">paletted</span><span class="op" id="5590909">.</span><span class="ident" id="5590910">Palette</span>&nbsp;<span class="op" id="5590918">=</span>&nbsp;<span class="ident" id="5590920">paletted</span><span class="op" id="5590928">.</span><span class="ident" id="5590929">Palette</span><span class="op" id="5590936">[</span><span class="op" id="5590937">:</span><span class="builtintype" id="5590938">int</span><span class="op" id="5590941">(</span><span class="ident" id="5590942">idx</span><span class="op" id="5590945">)</span><span class="op" id="5590946">+</span><span class="num" id="5590947">1</span><span class="op" id="5590948">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590955">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590962">paletted</span><span class="op" id="5590970">.</span><span class="ident" id="5590971">SetColorIndex</span><span class="op" id="5590984">(</span><span class="ident" id="5590985">x</span><span class="op" id="5590986">+</span><span class="ident" id="5590987">x2</span><span class="op" id="5590989">,</span>&nbsp;<span class="ident" id="5590991">y</span><span class="op" id="5590992">,</span>&nbsp;<span class="ident" id="5590994">idx</span><span class="op" id="5590997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5591004">b</span>&nbsp;<span class="op" id="5591006">&lt;&lt;=</span>&nbsp;<span class="num" id="5591010">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5591016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5591021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591025">case</span>&nbsp;<span class="ident" id="5591030">cbP8</span><span class="op" id="5591034">:</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591039">if</span>&nbsp;<span class="builtinfunc" id="5591042">len</span><span class="op" id="5591045">(</span><span class="ident" id="5591046">paletted</span><span class="op" id="5591054">.</span><span class="ident" id="5591055">Palette</span><span class="op" id="5591062">)</span>&nbsp;<span class="op" id="5591064">!=</span>&nbsp;<span class="num" id="5591067">255</span>&nbsp;<span class="op" id="5591071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591077">for</span>&nbsp;<span class="ident" id="5591081">x</span>&nbsp;<span class="op" id="5591083">:=</span>&nbsp;<span class="num" id="5591086">0</span><span class="op" id="5591087">;</span>&nbsp;<span class="ident" id="5591089">x</span>&nbsp;<span class="op" id="5591091">&lt;</span>&nbsp;<span class="ident" id="5591093">width</span><span class="op" id="5591098">;</span>&nbsp;<span class="ident" id="5591100">x</span><span class="op" id="5591101">++</span>&nbsp;<span class="op" id="5591104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591111">if</span>&nbsp;<span class="builtinfunc" id="5591114">len</span><span class="op" id="5591117">(</span><span class="ident" id="5591118">paletted</span><span class="op" id="5591126">.</span><span class="ident" id="5591127">Palette</span><span class="op" id="5591134">)</span>&nbsp;<span class="op" id="5591136">&lt;=</span>&nbsp;<span class="builtintype" id="5591139">int</span><span class="op" id="5591142">(</span><span class="ident" id="5591143">cdat</span><span class="op" id="5591147">[</span><span class="ident" id="5591148">x</span><span class="op" id="5591149">]</span><span class="op" id="5591150">)</span>&nbsp;<span class="op" id="5591152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5591160">paletted</span><span class="op" id="5591168">.</span><span class="ident" id="5591169">Palette</span>&nbsp;<span class="op" id="5591177">=</span>&nbsp;<span class="ident" id="5591179">paletted</span><span class="op" id="5591187">.</span><span class="ident" id="5591188">Palette</span><span class="op" id="5591195">[</span><span class="op" id="5591196">:</span><span class="builtintype" id="5591197">int</span><span class="op" id="5591200">(</span><span class="ident" id="5591201">cdat</span><span class="op" id="5591205">[</span><span class="ident" id="5591206">x</span><span class="op" id="5591207">]</span><span class="op" id="5591208">)</span><span class="op" id="5591209">+</span><span class="num" id="5591210">1</span><span class="op" id="5591211">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5591218">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5591224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5591229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5591234">copy</span><span class="op" id="5591238">(</span><span class="ident" id="5591239">paletted</span><span class="op" id="5591247">.</span><span class="ident" id="5591248">Pix</span><span class="op" id="5591251">[</span><span class="ident" id="5591252">pixOffset</span><span class="op" id="5591261">:</span><span class="op" id="5591262">]</span><span class="op" id="5591263">,</span>&nbsp;<span class="ident" id="5591265">cdat</span><span class="op" id="5591269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5591274">pixOffset</span>&nbsp;<span class="op" id="5591284">+=</span>&nbsp;<span class="ident" id="5591287">paletted</span><span class="op" id="5591295">.</span><span class="ident" id="5591296">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591305">case</span>&nbsp;<span class="ident" id="5591310">cbTCA8</span><span class="op" id="5591316">:</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5591321">copy</span><span class="op" id="5591325">(</span><span class="ident" id="5591326">nrgba</span><span class="op" id="5591331">.</span><span class="ident" id="5591332">Pix</span><span class="op" id="5591335">[</span><span class="ident" id="5591336">pixOffset</span><span class="op" id="5591345">:</span><span class="op" id="5591346">]</span><span class="op" id="5591347">,</span>&nbsp;<span class="ident" id="5591349">cdat</span><span class="op" id="5591353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5591358">pixOffset</span>&nbsp;<span class="op" id="5591368">+=</span>&nbsp;<span class="ident" id="5591371">nrgba</span><span class="op" id="5591376">.</span><span class="ident" id="5591377">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591386">case</span>&nbsp;<span class="ident" id="5591391">cbG16</span><span class="op" id="5591396">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591401">for</span>&nbsp;<span class="ident" id="5591405">x</span>&nbsp;<span class="op" id="5591407">:=</span>&nbsp;<span class="num" id="5591410">0</span><span class="op" id="5591411">;</span>&nbsp;<span class="ident" id="5591413">x</span>&nbsp;<span class="op" id="5591415">&lt;</span>&nbsp;<span class="ident" id="5591417">width</span><span class="op" id="5591422">;</span>&nbsp;<span class="ident" id="5591424">x</span><span class="op" id="5591425">++</span>&nbsp;<span class="op" id="5591428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5591434">ycol</span>&nbsp;<span class="op" id="5591439">:=</span>&nbsp;<span class="builtintype" id="5591442">uint16</span><span class="op" id="5591448">(</span><span class="ident" id="5591449">cdat</span><span class="op" id="5591453">[</span><span class="num" id="5591454">2</span><span class="op" id="5591455">*</span><span class="ident" id="5591456">x</span><span class="op" id="5591457">+</span><span class="num" id="5591458">0</span><span class="op" id="5591459">]</span><span class="op" id="5591460">)</span><span class="op" id="5591461">&lt;&lt;</span><span class="num" id="5591463">8</span>&nbsp;<span class="op" id="5591465">|</span>&nbsp;<span class="builtintype" id="5591467">uint16</span><span class="op" id="5591473">(</span><span class="ident" id="5591474">cdat</span><span class="op" id="5591478">[</span><span class="num" id="5591479">2</span><span class="op" id="5591480">*</span><span class="ident" id="5591481">x</span><span class="op" id="5591482">+</span><span class="num" id="5591483">1</span><span class="op" id="5591484">]</span><span class="op" id="5591485">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5591491">gray16</span><span class="op" id="5591497">.</span><span class="ident" id="5591498">SetGray16</span><span class="op" id="5591507">(</span><span class="ident" id="5591508">x</span><span class="op" id="5591509">,</span>&nbsp;<span class="ident" id="5591511">y</span><span class="op" id="5591512">,</span>&nbsp;<span class="ident" id="5591514">color</span><span class="op" id="5591519">.</span><span class="ident" id="5591520">Gray16</span><span class="op" id="5591526">{</span><span class="ident" id="5591527">ycol</span><span class="op" id="5591531">}</span><span class="op" id="5591532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5591537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591541">case</span>&nbsp;<span class="ident" id="5591546">cbGA16</span><span class="op" id="5591552">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591557">for</span>&nbsp;<span class="ident" id="5591561">x</span>&nbsp;<span class="op" id="5591563">:=</span>&nbsp;<span class="num" id="5591566">0</span><span class="op" id="5591567">;</span>&nbsp;<span class="ident" id="5591569">x</span>&nbsp;<span class="op" id="5591571">&lt;</span>&nbsp;<span class="ident" id="5591573">width</span><span class="op" id="5591578">;</span>&nbsp;<span class="ident" id="5591580">x</span><span class="op" id="5591581">++</span>&nbsp;<span class="op" id="5591584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5591590">ycol</span>&nbsp;<span class="op" id="5591595">:=</span>&nbsp;<span class="builtintype" id="5591598">uint16</span><span class="op" id="5591604">(</span><span class="ident" id="5591605">cdat</span><span class="op" id="5591609">[</span><span class="num" id="5591610">4</span><span class="op" id="5591611">*</span><span class="ident" id="5591612">x</span><span class="op" id="5591613">+</span><span class="num" id="5591614">0</span><span class="op" id="5591615">]</span><span class="op" id="5591616">)</span><span class="op" id="5591617">&lt;&lt;</span><span class="num" id="5591619">8</span>&nbsp;<span class="op" id="5591621">|</span>&nbsp;<span class="builtintype" id="5591623">uint16</span><span class="op" id="5591629">(</span><span class="ident" id="5591630">cdat</span><span class="op" id="5591634">[</span><span class="num" id="5591635">4</span><span class="op" id="5591636">*</span><span class="ident" id="5591637">x</span><span class="op" id="5591638">+</span><span class="num" id="5591639">1</span><span class="op" id="5591640">]</span><span class="op" id="5591641">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5591647">acol</span>&nbsp;<span class="op" id="5591652">:=</span>&nbsp;<span class="builtintype" id="5591655">uint16</span><span class="op" id="5591661">(</span><span class="ident" id="5591662">cdat</span><span class="op" id="5591666">[</span><span class="num" id="5591667">4</span><span class="op" id="5591668">*</span><span class="ident" id="5591669">x</span><span class="op" id="5591670">+</span><span class="num" id="5591671">2</span><span class="op" id="5591672">]</span><span class="op" id="5591673">)</span><span class="op" id="5591674">&lt;&lt;</span><span class="num" id="5591676">8</span>&nbsp;<span class="op" id="5591678">|</span>&nbsp;<span class="builtintype" id="5591680">uint16</span><span class="op" id="5591686">(</span><span class="ident" id="5591687">cdat</span><span class="op" id="5591691">[</span><span class="num" id="5591692">4</span><span class="op" id="5591693">*</span><span class="ident" id="5591694">x</span><span class="op" id="5591695">+</span><span class="num" id="5591696">3</span><span class="op" id="5591697">]</span><span class="op" id="5591698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5591704">nrgba64</span><span class="op" id="5591711">.</span><span class="ident" id="5591712">SetNRGBA64</span><span class="op" id="5591722">(</span><span class="ident" id="5591723">x</span><span class="op" id="5591724">,</span>&nbsp;<span class="ident" id="5591726">y</span><span class="op" id="5591727">,</span>&nbsp;<span class="ident" id="5591729">color</span><span class="op" id="5591734">.</span><span class="ident" id="5591735">NRGBA64</span><span class="op" id="5591742">{</span><span class="ident" id="5591743">ycol</span><span class="op" id="5591747">,</span>&nbsp;<span class="ident" id="5591749">ycol</span><span class="op" id="5591753">,</span>&nbsp;<span class="ident" id="5591755">ycol</span><span class="op" id="5591759">,</span>&nbsp;<span class="ident" id="5591761">acol</span><span class="op" id="5591765">}</span><span class="op" id="5591766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5591771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591775">case</span>&nbsp;<span class="ident" id="5591780">cbTC16</span><span class="op" id="5591786">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591791">for</span>&nbsp;<span class="ident" id="5591795">x</span>&nbsp;<span class="op" id="5591797">:=</span>&nbsp;<span class="num" id="5591800">0</span><span class="op" id="5591801">;</span>&nbsp;<span class="ident" id="5591803">x</span>&nbsp;<span class="op" id="5591805">&lt;</span>&nbsp;<span class="ident" id="5591807">width</span><span class="op" id="5591812">;</span>&nbsp;<span class="ident" id="5591814">x</span><span class="op" id="5591815">++</span>&nbsp;<span class="op" id="5591818">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5591824">rcol</span>&nbsp;<span class="op" id="5591829">:=</span>&nbsp;<span class="builtintype" id="5591832">uint16</span><span class="op" id="5591838">(</span><span class="ident" id="5591839">cdat</span><span class="op" id="5591843">[</span><span class="num" id="5591844">6</span><span class="op" id="5591845">*</span><span class="ident" id="5591846">x</span><span class="op" id="5591847">+</span><span class="num" id="5591848">0</span><span class="op" id="5591849">]</span><span class="op" id="5591850">)</span><span class="op" id="5591851">&lt;&lt;</span><span class="num" id="5591853">8</span>&nbsp;<span class="op" id="5591855">|</span>&nbsp;<span class="builtintype" id="5591857">uint16</span><span class="op" id="5591863">(</span><span class="ident" id="5591864">cdat</span><span class="op" id="5591868">[</span><span class="num" id="5591869">6</span><span class="op" id="5591870">*</span><span class="ident" id="5591871">x</span><span class="op" id="5591872">+</span><span class="num" id="5591873">1</span><span class="op" id="5591874">]</span><span class="op" id="5591875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5591881">gcol</span>&nbsp;<span class="op" id="5591886">:=</span>&nbsp;<span class="builtintype" id="5591889">uint16</span><span class="op" id="5591895">(</span><span class="ident" id="5591896">cdat</span><span class="op" id="5591900">[</span><span class="num" id="5591901">6</span><span class="op" id="5591902">*</span><span class="ident" id="5591903">x</span><span class="op" id="5591904">+</span><span class="num" id="5591905">2</span><span class="op" id="5591906">]</span><span class="op" id="5591907">)</span><span class="op" id="5591908">&lt;&lt;</span><span class="num" id="5591910">8</span>&nbsp;<span class="op" id="5591912">|</span>&nbsp;<span class="builtintype" id="5591914">uint16</span><span class="op" id="5591920">(</span><span class="ident" id="5591921">cdat</span><span class="op" id="5591925">[</span><span class="num" id="5591926">6</span><span class="op" id="5591927">*</span><span class="ident" id="5591928">x</span><span class="op" id="5591929">+</span><span class="num" id="5591930">3</span><span class="op" id="5591931">]</span><span class="op" id="5591932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5591938">bcol</span>&nbsp;<span class="op" id="5591943">:=</span>&nbsp;<span class="builtintype" id="5591946">uint16</span><span class="op" id="5591952">(</span><span class="ident" id="5591953">cdat</span><span class="op" id="5591957">[</span><span class="num" id="5591958">6</span><span class="op" id="5591959">*</span><span class="ident" id="5591960">x</span><span class="op" id="5591961">+</span><span class="num" id="5591962">4</span><span class="op" id="5591963">]</span><span class="op" id="5591964">)</span><span class="op" id="5591965">&lt;&lt;</span><span class="num" id="5591967">8</span>&nbsp;<span class="op" id="5591969">|</span>&nbsp;<span class="builtintype" id="5591971">uint16</span><span class="op" id="5591977">(</span><span class="ident" id="5591978">cdat</span><span class="op" id="5591982">[</span><span class="num" id="5591983">6</span><span class="op" id="5591984">*</span><span class="ident" id="5591985">x</span><span class="op" id="5591986">+</span><span class="num" id="5591987">5</span><span class="op" id="5591988">]</span><span class="op" id="5591989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5591995">rgba64</span><span class="op" id="5592001">.</span><span class="ident" id="5592002">SetRGBA64</span><span class="op" id="5592011">(</span><span class="ident" id="5592012">x</span><span class="op" id="5592013">,</span>&nbsp;<span class="ident" id="5592015">y</span><span class="op" id="5592016">,</span>&nbsp;<span class="ident" id="5592018">color</span><span class="op" id="5592023">.</span><span class="ident" id="5592024">RGBA64</span><span class="op" id="5592030">{</span><span class="ident" id="5592031">rcol</span><span class="op" id="5592035">,</span>&nbsp;<span class="ident" id="5592037">gcol</span><span class="op" id="5592041">,</span>&nbsp;<span class="ident" id="5592043">bcol</span><span class="op" id="5592047">,</span>&nbsp;<span class="num" id="5592049">0xffff</span><span class="op" id="5592055">}</span><span class="op" id="5592056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5592061">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592065">case</span>&nbsp;<span class="ident" id="5592070">cbTCA16</span><span class="op" id="5592077">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592082">for</span>&nbsp;<span class="ident" id="5592086">x</span>&nbsp;<span class="op" id="5592088">:=</span>&nbsp;<span class="num" id="5592091">0</span><span class="op" id="5592092">;</span>&nbsp;<span class="ident" id="5592094">x</span>&nbsp;<span class="op" id="5592096">&lt;</span>&nbsp;<span class="ident" id="5592098">width</span><span class="op" id="5592103">;</span>&nbsp;<span class="ident" id="5592105">x</span><span class="op" id="5592106">++</span>&nbsp;<span class="op" id="5592109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592115">rcol</span>&nbsp;<span class="op" id="5592120">:=</span>&nbsp;<span class="builtintype" id="5592123">uint16</span><span class="op" id="5592129">(</span><span class="ident" id="5592130">cdat</span><span class="op" id="5592134">[</span><span class="num" id="5592135">8</span><span class="op" id="5592136">*</span><span class="ident" id="5592137">x</span><span class="op" id="5592138">+</span><span class="num" id="5592139">0</span><span class="op" id="5592140">]</span><span class="op" id="5592141">)</span><span class="op" id="5592142">&lt;&lt;</span><span class="num" id="5592144">8</span>&nbsp;<span class="op" id="5592146">|</span>&nbsp;<span class="builtintype" id="5592148">uint16</span><span class="op" id="5592154">(</span><span class="ident" id="5592155">cdat</span><span class="op" id="5592159">[</span><span class="num" id="5592160">8</span><span class="op" id="5592161">*</span><span class="ident" id="5592162">x</span><span class="op" id="5592163">+</span><span class="num" id="5592164">1</span><span class="op" id="5592165">]</span><span class="op" id="5592166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592172">gcol</span>&nbsp;<span class="op" id="5592177">:=</span>&nbsp;<span class="builtintype" id="5592180">uint16</span><span class="op" id="5592186">(</span><span class="ident" id="5592187">cdat</span><span class="op" id="5592191">[</span><span class="num" id="5592192">8</span><span class="op" id="5592193">*</span><span class="ident" id="5592194">x</span><span class="op" id="5592195">+</span><span class="num" id="5592196">2</span><span class="op" id="5592197">]</span><span class="op" id="5592198">)</span><span class="op" id="5592199">&lt;&lt;</span><span class="num" id="5592201">8</span>&nbsp;<span class="op" id="5592203">|</span>&nbsp;<span class="builtintype" id="5592205">uint16</span><span class="op" id="5592211">(</span><span class="ident" id="5592212">cdat</span><span class="op" id="5592216">[</span><span class="num" id="5592217">8</span><span class="op" id="5592218">*</span><span class="ident" id="5592219">x</span><span class="op" id="5592220">+</span><span class="num" id="5592221">3</span><span class="op" id="5592222">]</span><span class="op" id="5592223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592229">bcol</span>&nbsp;<span class="op" id="5592234">:=</span>&nbsp;<span class="builtintype" id="5592237">uint16</span><span class="op" id="5592243">(</span><span class="ident" id="5592244">cdat</span><span class="op" id="5592248">[</span><span class="num" id="5592249">8</span><span class="op" id="5592250">*</span><span class="ident" id="5592251">x</span><span class="op" id="5592252">+</span><span class="num" id="5592253">4</span><span class="op" id="5592254">]</span><span class="op" id="5592255">)</span><span class="op" id="5592256">&lt;&lt;</span><span class="num" id="5592258">8</span>&nbsp;<span class="op" id="5592260">|</span>&nbsp;<span class="builtintype" id="5592262">uint16</span><span class="op" id="5592268">(</span><span class="ident" id="5592269">cdat</span><span class="op" id="5592273">[</span><span class="num" id="5592274">8</span><span class="op" id="5592275">*</span><span class="ident" id="5592276">x</span><span class="op" id="5592277">+</span><span class="num" id="5592278">5</span><span class="op" id="5592279">]</span><span class="op" id="5592280">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592286">acol</span>&nbsp;<span class="op" id="5592291">:=</span>&nbsp;<span class="builtintype" id="5592294">uint16</span><span class="op" id="5592300">(</span><span class="ident" id="5592301">cdat</span><span class="op" id="5592305">[</span><span class="num" id="5592306">8</span><span class="op" id="5592307">*</span><span class="ident" id="5592308">x</span><span class="op" id="5592309">+</span><span class="num" id="5592310">6</span><span class="op" id="5592311">]</span><span class="op" id="5592312">)</span><span class="op" id="5592313">&lt;&lt;</span><span class="num" id="5592315">8</span>&nbsp;<span class="op" id="5592317">|</span>&nbsp;<span class="builtintype" id="5592319">uint16</span><span class="op" id="5592325">(</span><span class="ident" id="5592326">cdat</span><span class="op" id="5592330">[</span><span class="num" id="5592331">8</span><span class="op" id="5592332">*</span><span class="ident" id="5592333">x</span><span class="op" id="5592334">+</span><span class="num" id="5592335">7</span><span class="op" id="5592336">]</span><span class="op" id="5592337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592343">nrgba64</span><span class="op" id="5592350">.</span><span class="ident" id="5592351">SetNRGBA64</span><span class="op" id="5592361">(</span><span class="ident" id="5592362">x</span><span class="op" id="5592363">,</span>&nbsp;<span class="ident" id="5592365">y</span><span class="op" id="5592366">,</span>&nbsp;<span class="ident" id="5592368">color</span><span class="op" id="5592373">.</span><span class="ident" id="5592374">NRGBA64</span><span class="op" id="5592381">{</span><span class="ident" id="5592382">rcol</span><span class="op" id="5592386">,</span>&nbsp;<span class="ident" id="5592388">gcol</span><span class="op" id="5592392">,</span>&nbsp;<span class="ident" id="5592394">bcol</span><span class="op" id="5592398">,</span>&nbsp;<span class="ident" id="5592400">acol</span><span class="op" id="5592404">}</span><span class="op" id="5592405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5592410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5592414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5592419">//&nbsp;The&nbsp;current&nbsp;row&nbsp;for&nbsp;y&nbsp;is&nbsp;the&nbsp;previous&nbsp;row&nbsp;for&nbsp;y+1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592475">pr</span><span class="op" id="5592477">,</span>&nbsp;<span class="ident" id="5592479">cr</span>&nbsp;<span class="op" id="5592482">=</span>&nbsp;<span class="ident" id="5592484">cr</span><span class="op" id="5592486">,</span>&nbsp;<span class="ident" id="5592488">pr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5592492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592496">return</span>&nbsp;<span class="ident" id="5592503">img</span><span class="op" id="5592506">,</span>&nbsp;<span class="ident" id="5592508">nil</span><br>
<span class="lineno">585</span><span class="op" id="5592512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5592515">//&nbsp;mergePassInto&nbsp;merges&nbsp;a&nbsp;single&nbsp;pass&nbsp;into&nbsp;a&nbsp;full&nbsp;sized&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5592578">func</span>&nbsp;<span class="op" id="5592583">(</span><span class="ident" id="5592584">d</span>&nbsp;<span class="op" id="5592586">*</span><span class="ident" id="5592587">decoder</span><span class="op" id="5592594">)</span>&nbsp;<span class="ident" id="5592596">mergePassInto</span><span class="op" id="5592609">(</span><span class="ident" id="5592610">dst</span>&nbsp;<span class="ident" id="5592614">image</span><span class="op" id="5592619">.</span><span class="ident" id="5592620">Image</span><span class="op" id="5592625">,</span>&nbsp;<span class="ident" id="5592627">src</span>&nbsp;<span class="ident" id="5592631">image</span><span class="op" id="5592636">.</span><span class="ident" id="5592637">Image</span><span class="op" id="5592642">,</span>&nbsp;<span class="ident" id="5592644">pass</span>&nbsp;<span class="builtintype" id="5592649">int</span><span class="op" id="5592652">)</span>&nbsp;<span class="op" id="5592654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592657">p</span>&nbsp;<span class="op" id="5592659">:=</span>&nbsp;<span class="ident" id="5592662">interlacing</span><span class="op" id="5592673">[</span><span class="ident" id="5592674">pass</span><span class="op" id="5592678">]</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592681">var</span>&nbsp;<span class="op" id="5592685">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592689">srcPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5592703">[</span><span class="op" id="5592704">]</span><span class="builtintype" id="5592705">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592713">dstPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5592727">[</span><span class="op" id="5592728">]</span><span class="builtintype" id="5592729">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592737">stride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5592751">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592757">rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592771">image</span><span class="op" id="5592776">.</span><span class="ident" id="5592777">Rectangle</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592789">bytesPerPixel</span>&nbsp;<span class="builtintype" id="5592803">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5592808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592811">switch</span>&nbsp;<span class="ident" id="5592818">target</span>&nbsp;<span class="op" id="5592825">:=</span>&nbsp;<span class="ident" id="5592828">dst</span><span class="op" id="5592831">.</span><span class="op" id="5592832">(</span><span class="keyword" id="5592833">type</span><span class="op" id="5592837">)</span>&nbsp;<span class="op" id="5592839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592842">case</span>&nbsp;<span class="op" id="5592847">*</span><span class="ident" id="5592848">image</span><span class="op" id="5592853">.</span><span class="ident" id="5592854">Alpha</span><span class="op" id="5592859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592863">srcPix</span>&nbsp;<span class="op" id="5592870">=</span>&nbsp;<span class="ident" id="5592872">src</span><span class="op" id="5592875">.</span><span class="op" id="5592876">(</span><span class="op" id="5592877">*</span><span class="ident" id="5592878">image</span><span class="op" id="5592883">.</span><span class="ident" id="5592884">Alpha</span><span class="op" id="5592889">)</span><span class="op" id="5592890">.</span><span class="ident" id="5592891">Pix</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592897">dstPix</span><span class="op" id="5592903">,</span>&nbsp;<span class="ident" id="5592905">stride</span><span class="op" id="5592911">,</span>&nbsp;<span class="ident" id="5592913">rect</span>&nbsp;<span class="op" id="5592918">=</span>&nbsp;<span class="ident" id="5592920">target</span><span class="op" id="5592926">.</span><span class="ident" id="5592927">Pix</span><span class="op" id="5592930">,</span>&nbsp;<span class="ident" id="5592932">target</span><span class="op" id="5592938">.</span><span class="ident" id="5592939">Stride</span><span class="op" id="5592945">,</span>&nbsp;<span class="ident" id="5592947">target</span><span class="op" id="5592953">.</span><span class="ident" id="5592954">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592961">bytesPerPixel</span>&nbsp;<span class="op" id="5592975">=</span>&nbsp;<span class="num" id="5592977">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592980">case</span>&nbsp;<span class="op" id="5592985">*</span><span class="ident" id="5592986">image</span><span class="op" id="5592991">.</span><span class="ident" id="5592992">Alpha16</span><span class="op" id="5592999">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593003">srcPix</span>&nbsp;<span class="op" id="5593010">=</span>&nbsp;<span class="ident" id="5593012">src</span><span class="op" id="5593015">.</span><span class="op" id="5593016">(</span><span class="op" id="5593017">*</span><span class="ident" id="5593018">image</span><span class="op" id="5593023">.</span><span class="ident" id="5593024">Alpha16</span><span class="op" id="5593031">)</span><span class="op" id="5593032">.</span><span class="ident" id="5593033">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593039">dstPix</span><span class="op" id="5593045">,</span>&nbsp;<span class="ident" id="5593047">stride</span><span class="op" id="5593053">,</span>&nbsp;<span class="ident" id="5593055">rect</span>&nbsp;<span class="op" id="5593060">=</span>&nbsp;<span class="ident" id="5593062">target</span><span class="op" id="5593068">.</span><span class="ident" id="5593069">Pix</span><span class="op" id="5593072">,</span>&nbsp;<span class="ident" id="5593074">target</span><span class="op" id="5593080">.</span><span class="ident" id="5593081">Stride</span><span class="op" id="5593087">,</span>&nbsp;<span class="ident" id="5593089">target</span><span class="op" id="5593095">.</span><span class="ident" id="5593096">Rect</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593103">bytesPerPixel</span>&nbsp;<span class="op" id="5593117">=</span>&nbsp;<span class="num" id="5593119">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5593122">case</span>&nbsp;<span class="op" id="5593127">*</span><span class="ident" id="5593128">image</span><span class="op" id="5593133">.</span><span class="ident" id="5593134">Gray</span><span class="op" id="5593138">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593142">srcPix</span>&nbsp;<span class="op" id="5593149">=</span>&nbsp;<span class="ident" id="5593151">src</span><span class="op" id="5593154">.</span><span class="op" id="5593155">(</span><span class="op" id="5593156">*</span><span class="ident" id="5593157">image</span><span class="op" id="5593162">.</span><span class="ident" id="5593163">Gray</span><span class="op" id="5593167">)</span><span class="op" id="5593168">.</span><span class="ident" id="5593169">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593175">dstPix</span><span class="op" id="5593181">,</span>&nbsp;<span class="ident" id="5593183">stride</span><span class="op" id="5593189">,</span>&nbsp;<span class="ident" id="5593191">rect</span>&nbsp;<span class="op" id="5593196">=</span>&nbsp;<span class="ident" id="5593198">target</span><span class="op" id="5593204">.</span><span class="ident" id="5593205">Pix</span><span class="op" id="5593208">,</span>&nbsp;<span class="ident" id="5593210">target</span><span class="op" id="5593216">.</span><span class="ident" id="5593217">Stride</span><span class="op" id="5593223">,</span>&nbsp;<span class="ident" id="5593225">target</span><span class="op" id="5593231">.</span><span class="ident" id="5593232">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593239">bytesPerPixel</span>&nbsp;<span class="op" id="5593253">=</span>&nbsp;<span class="num" id="5593255">1</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5593258">case</span>&nbsp;<span class="op" id="5593263">*</span><span class="ident" id="5593264">image</span><span class="op" id="5593269">.</span><span class="ident" id="5593270">Gray16</span><span class="op" id="5593276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593280">srcPix</span>&nbsp;<span class="op" id="5593287">=</span>&nbsp;<span class="ident" id="5593289">src</span><span class="op" id="5593292">.</span><span class="op" id="5593293">(</span><span class="op" id="5593294">*</span><span class="ident" id="5593295">image</span><span class="op" id="5593300">.</span><span class="ident" id="5593301">Gray16</span><span class="op" id="5593307">)</span><span class="op" id="5593308">.</span><span class="ident" id="5593309">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593315">dstPix</span><span class="op" id="5593321">,</span>&nbsp;<span class="ident" id="5593323">stride</span><span class="op" id="5593329">,</span>&nbsp;<span class="ident" id="5593331">rect</span>&nbsp;<span class="op" id="5593336">=</span>&nbsp;<span class="ident" id="5593338">target</span><span class="op" id="5593344">.</span><span class="ident" id="5593345">Pix</span><span class="op" id="5593348">,</span>&nbsp;<span class="ident" id="5593350">target</span><span class="op" id="5593356">.</span><span class="ident" id="5593357">Stride</span><span class="op" id="5593363">,</span>&nbsp;<span class="ident" id="5593365">target</span><span class="op" id="5593371">.</span><span class="ident" id="5593372">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593379">bytesPerPixel</span>&nbsp;<span class="op" id="5593393">=</span>&nbsp;<span class="num" id="5593395">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5593398">case</span>&nbsp;<span class="op" id="5593403">*</span><span class="ident" id="5593404">image</span><span class="op" id="5593409">.</span><span class="ident" id="5593410">NRGBA</span><span class="op" id="5593415">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593419">srcPix</span>&nbsp;<span class="op" id="5593426">=</span>&nbsp;<span class="ident" id="5593428">src</span><span class="op" id="5593431">.</span><span class="op" id="5593432">(</span><span class="op" id="5593433">*</span><span class="ident" id="5593434">image</span><span class="op" id="5593439">.</span><span class="ident" id="5593440">NRGBA</span><span class="op" id="5593445">)</span><span class="op" id="5593446">.</span><span class="ident" id="5593447">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593453">dstPix</span><span class="op" id="5593459">,</span>&nbsp;<span class="ident" id="5593461">stride</span><span class="op" id="5593467">,</span>&nbsp;<span class="ident" id="5593469">rect</span>&nbsp;<span class="op" id="5593474">=</span>&nbsp;<span class="ident" id="5593476">target</span><span class="op" id="5593482">.</span><span class="ident" id="5593483">Pix</span><span class="op" id="5593486">,</span>&nbsp;<span class="ident" id="5593488">target</span><span class="op" id="5593494">.</span><span class="ident" id="5593495">Stride</span><span class="op" id="5593501">,</span>&nbsp;<span class="ident" id="5593503">target</span><span class="op" id="5593509">.</span><span class="ident" id="5593510">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593517">bytesPerPixel</span>&nbsp;<span class="op" id="5593531">=</span>&nbsp;<span class="num" id="5593533">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5593536">case</span>&nbsp;<span class="op" id="5593541">*</span><span class="ident" id="5593542">image</span><span class="op" id="5593547">.</span><span class="ident" id="5593548">NRGBA64</span><span class="op" id="5593555">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593559">srcPix</span>&nbsp;<span class="op" id="5593566">=</span>&nbsp;<span class="ident" id="5593568">src</span><span class="op" id="5593571">.</span><span class="op" id="5593572">(</span><span class="op" id="5593573">*</span><span class="ident" id="5593574">image</span><span class="op" id="5593579">.</span><span class="ident" id="5593580">NRGBA64</span><span class="op" id="5593587">)</span><span class="op" id="5593588">.</span><span class="ident" id="5593589">Pix</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593595">dstPix</span><span class="op" id="5593601">,</span>&nbsp;<span class="ident" id="5593603">stride</span><span class="op" id="5593609">,</span>&nbsp;<span class="ident" id="5593611">rect</span>&nbsp;<span class="op" id="5593616">=</span>&nbsp;<span class="ident" id="5593618">target</span><span class="op" id="5593624">.</span><span class="ident" id="5593625">Pix</span><span class="op" id="5593628">,</span>&nbsp;<span class="ident" id="5593630">target</span><span class="op" id="5593636">.</span><span class="ident" id="5593637">Stride</span><span class="op" id="5593643">,</span>&nbsp;<span class="ident" id="5593645">target</span><span class="op" id="5593651">.</span><span class="ident" id="5593652">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593659">bytesPerPixel</span>&nbsp;<span class="op" id="5593673">=</span>&nbsp;<span class="num" id="5593675">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5593678">case</span>&nbsp;<span class="op" id="5593683">*</span><span class="ident" id="5593684">image</span><span class="op" id="5593689">.</span><span class="ident" id="5593690">Paletted</span><span class="op" id="5593698">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593702">srcPix</span>&nbsp;<span class="op" id="5593709">=</span>&nbsp;<span class="ident" id="5593711">src</span><span class="op" id="5593714">.</span><span class="op" id="5593715">(</span><span class="op" id="5593716">*</span><span class="ident" id="5593717">image</span><span class="op" id="5593722">.</span><span class="ident" id="5593723">Paletted</span><span class="op" id="5593731">)</span><span class="op" id="5593732">.</span><span class="ident" id="5593733">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593739">dstPix</span><span class="op" id="5593745">,</span>&nbsp;<span class="ident" id="5593747">stride</span><span class="op" id="5593753">,</span>&nbsp;<span class="ident" id="5593755">rect</span>&nbsp;<span class="op" id="5593760">=</span>&nbsp;<span class="ident" id="5593762">target</span><span class="op" id="5593768">.</span><span class="ident" id="5593769">Pix</span><span class="op" id="5593772">,</span>&nbsp;<span class="ident" id="5593774">target</span><span class="op" id="5593780">.</span><span class="ident" id="5593781">Stride</span><span class="op" id="5593787">,</span>&nbsp;<span class="ident" id="5593789">target</span><span class="op" id="5593795">.</span><span class="ident" id="5593796">Rect</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593803">bytesPerPixel</span>&nbsp;<span class="op" id="5593817">=</span>&nbsp;<span class="num" id="5593819">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5593822">case</span>&nbsp;<span class="op" id="5593827">*</span><span class="ident" id="5593828">image</span><span class="op" id="5593833">.</span><span class="ident" id="5593834">RGBA</span><span class="op" id="5593838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593842">srcPix</span>&nbsp;<span class="op" id="5593849">=</span>&nbsp;<span class="ident" id="5593851">src</span><span class="op" id="5593854">.</span><span class="op" id="5593855">(</span><span class="op" id="5593856">*</span><span class="ident" id="5593857">image</span><span class="op" id="5593862">.</span><span class="ident" id="5593863">RGBA</span><span class="op" id="5593867">)</span><span class="op" id="5593868">.</span><span class="ident" id="5593869">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593875">dstPix</span><span class="op" id="5593881">,</span>&nbsp;<span class="ident" id="5593883">stride</span><span class="op" id="5593889">,</span>&nbsp;<span class="ident" id="5593891">rect</span>&nbsp;<span class="op" id="5593896">=</span>&nbsp;<span class="ident" id="5593898">target</span><span class="op" id="5593904">.</span><span class="ident" id="5593905">Pix</span><span class="op" id="5593908">,</span>&nbsp;<span class="ident" id="5593910">target</span><span class="op" id="5593916">.</span><span class="ident" id="5593917">Stride</span><span class="op" id="5593923">,</span>&nbsp;<span class="ident" id="5593925">target</span><span class="op" id="5593931">.</span><span class="ident" id="5593932">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593939">bytesPerPixel</span>&nbsp;<span class="op" id="5593953">=</span>&nbsp;<span class="num" id="5593955">4</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5593958">case</span>&nbsp;<span class="op" id="5593963">*</span><span class="ident" id="5593964">image</span><span class="op" id="5593969">.</span><span class="ident" id="5593970">RGBA64</span><span class="op" id="5593976">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593980">srcPix</span>&nbsp;<span class="op" id="5593987">=</span>&nbsp;<span class="ident" id="5593989">src</span><span class="op" id="5593992">.</span><span class="op" id="5593993">(</span><span class="op" id="5593994">*</span><span class="ident" id="5593995">image</span><span class="op" id="5594000">.</span><span class="ident" id="5594001">RGBA64</span><span class="op" id="5594007">)</span><span class="op" id="5594008">.</span><span class="ident" id="5594009">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594015">dstPix</span><span class="op" id="5594021">,</span>&nbsp;<span class="ident" id="5594023">stride</span><span class="op" id="5594029">,</span>&nbsp;<span class="ident" id="5594031">rect</span>&nbsp;<span class="op" id="5594036">=</span>&nbsp;<span class="ident" id="5594038">target</span><span class="op" id="5594044">.</span><span class="ident" id="5594045">Pix</span><span class="op" id="5594048">,</span>&nbsp;<span class="ident" id="5594050">target</span><span class="op" id="5594056">.</span><span class="ident" id="5594057">Stride</span><span class="op" id="5594063">,</span>&nbsp;<span class="ident" id="5594065">target</span><span class="op" id="5594071">.</span><span class="ident" id="5594072">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594079">bytesPerPixel</span>&nbsp;<span class="op" id="5594093">=</span>&nbsp;<span class="num" id="5594095">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5594098">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594101">s</span><span class="op" id="5594102">,</span>&nbsp;<span class="ident" id="5594104">bounds</span>&nbsp;<span class="op" id="5594111">:=</span>&nbsp;<span class="num" id="5594114">0</span><span class="op" id="5594115">,</span>&nbsp;<span class="ident" id="5594117">src</span><span class="op" id="5594120">.</span><span class="ident" id="5594121">Bounds</span><span class="op" id="5594127">(</span><span class="op" id="5594128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594131">for</span>&nbsp;<span class="ident" id="5594135">y</span>&nbsp;<span class="op" id="5594137">:=</span>&nbsp;<span class="ident" id="5594140">bounds</span><span class="op" id="5594146">.</span><span class="ident" id="5594147">Min</span><span class="op" id="5594150">.</span><span class="ident" id="5594151">Y</span><span class="op" id="5594152">;</span>&nbsp;<span class="ident" id="5594154">y</span>&nbsp;<span class="op" id="5594156">&lt;</span>&nbsp;<span class="ident" id="5594158">bounds</span><span class="op" id="5594164">.</span><span class="ident" id="5594165">Max</span><span class="op" id="5594168">.</span><span class="ident" id="5594169">Y</span><span class="op" id="5594170">;</span>&nbsp;<span class="ident" id="5594172">y</span><span class="op" id="5594173">++</span>&nbsp;<span class="op" id="5594176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594180">dBase</span>&nbsp;<span class="op" id="5594186">:=</span>&nbsp;<span class="op" id="5594189">(</span><span class="ident" id="5594190">y</span><span class="op" id="5594191">*</span><span class="ident" id="5594192">p</span><span class="op" id="5594193">.</span><span class="ident" id="5594194">yFactor</span><span class="op" id="5594201">+</span><span class="ident" id="5594202">p</span><span class="op" id="5594203">.</span><span class="ident" id="5594204">yOffset</span><span class="op" id="5594211">-</span><span class="ident" id="5594212">rect</span><span class="op" id="5594216">.</span><span class="ident" id="5594217">Min</span><span class="op" id="5594220">.</span><span class="ident" id="5594221">Y</span><span class="op" id="5594222">)</span><span class="op" id="5594223">*</span><span class="ident" id="5594224">stride</span>&nbsp;<span class="op" id="5594231">+</span>&nbsp;<span class="op" id="5594233">(</span><span class="ident" id="5594234">p</span><span class="op" id="5594235">.</span><span class="ident" id="5594236">xOffset</span><span class="op" id="5594243">-</span><span class="ident" id="5594244">rect</span><span class="op" id="5594248">.</span><span class="ident" id="5594249">Min</span><span class="op" id="5594252">.</span><span class="ident" id="5594253">X</span><span class="op" id="5594254">)</span><span class="op" id="5594255">*</span><span class="ident" id="5594256">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594272">for</span>&nbsp;<span class="ident" id="5594276">x</span>&nbsp;<span class="op" id="5594278">:=</span>&nbsp;<span class="ident" id="5594281">bounds</span><span class="op" id="5594287">.</span><span class="ident" id="5594288">Min</span><span class="op" id="5594291">.</span><span class="ident" id="5594292">X</span><span class="op" id="5594293">;</span>&nbsp;<span class="ident" id="5594295">x</span>&nbsp;<span class="op" id="5594297">&lt;</span>&nbsp;<span class="ident" id="5594299">bounds</span><span class="op" id="5594305">.</span><span class="ident" id="5594306">Max</span><span class="op" id="5594309">.</span><span class="ident" id="5594310">X</span><span class="op" id="5594311">;</span>&nbsp;<span class="ident" id="5594313">x</span><span class="op" id="5594314">++</span>&nbsp;<span class="op" id="5594317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594322">d</span>&nbsp;<span class="op" id="5594324">:=</span>&nbsp;<span class="ident" id="5594327">dBase</span>&nbsp;<span class="op" id="5594333">+</span>&nbsp;<span class="ident" id="5594335">x</span><span class="op" id="5594336">*</span><span class="ident" id="5594337">p</span><span class="op" id="5594338">.</span><span class="ident" id="5594339">xFactor</span><span class="op" id="5594346">*</span><span class="ident" id="5594347">bytesPerPixel</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5594364">copy</span><span class="op" id="5594368">(</span><span class="ident" id="5594369">dstPix</span><span class="op" id="5594375">[</span><span class="ident" id="5594376">d</span><span class="op" id="5594377">:</span><span class="op" id="5594378">]</span><span class="op" id="5594379">,</span>&nbsp;<span class="ident" id="5594381">srcPix</span><span class="op" id="5594387">[</span><span class="ident" id="5594388">s</span><span class="op" id="5594389">:</span><span class="ident" id="5594390">s</span><span class="op" id="5594391">+</span><span class="ident" id="5594392">bytesPerPixel</span><span class="op" id="5594405">]</span><span class="op" id="5594406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594411">s</span>&nbsp;<span class="op" id="5594413">+=</span>&nbsp;<span class="ident" id="5594416">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5594432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5594435">}</span><br>
<span class="lineno"></span><span class="op" id="5594437">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span><span class="keyword" id="5594440">func</span>&nbsp;<span class="op" id="5594445">(</span><span class="ident" id="5594446">d</span>&nbsp;<span class="op" id="5594448">*</span><span class="ident" id="5594449">decoder</span><span class="op" id="5594456">)</span>&nbsp;<span class="ident" id="5594458">parseIDAT</span><span class="op" id="5594467">(</span><span class="ident" id="5594468">length</span>&nbsp;<span class="builtintype" id="5594475">uint32</span><span class="op" id="5594481">)</span>&nbsp;<span class="op" id="5594483">(</span><span class="ident" id="5594484">err</span>&nbsp;<span class="builtintype" id="5594488">error</span><span class="op" id="5594493">)</span>&nbsp;<span class="op" id="5594495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594498">d</span><span class="op" id="5594499">.</span><span class="ident" id="5594500">idatLength</span>&nbsp;<span class="op" id="5594511">=</span>&nbsp;<span class="ident" id="5594513">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594521">d</span><span class="op" id="5594522">.</span><span class="ident" id="5594523">img</span><span class="op" id="5594526">,</span>&nbsp;<span class="ident" id="5594528">err</span>&nbsp;<span class="op" id="5594532">=</span>&nbsp;<span class="ident" id="5594534">d</span><span class="op" id="5594535">.</span><span class="ident" id="5594536">decode</span><span class="op" id="5594542">(</span><span class="op" id="5594543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594546">if</span>&nbsp;<span class="ident" id="5594549">err</span>&nbsp;<span class="op" id="5594553">!=</span>&nbsp;<span class="ident" id="5594556">nil</span>&nbsp;<span class="op" id="5594560">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594564">return</span>&nbsp;<span class="ident" id="5594571">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5594576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594579">return</span>&nbsp;<span class="ident" id="5594586">d</span><span class="op" id="5594587">.</span><span class="ident" id="5594588">verifyChecksum</span><span class="op" id="5594602">(</span><span class="op" id="5594603">)</span><br>
<span class="lineno"></span><span class="op" id="5594605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">655</span><span class="keyword" id="5594608">func</span>&nbsp;<span class="op" id="5594613">(</span><span class="ident" id="5594614">d</span>&nbsp;<span class="op" id="5594616">*</span><span class="ident" id="5594617">decoder</span><span class="op" id="5594624">)</span>&nbsp;<span class="ident" id="5594626">parseIEND</span><span class="op" id="5594635">(</span><span class="ident" id="5594636">length</span>&nbsp;<span class="builtintype" id="5594643">uint32</span><span class="op" id="5594649">)</span>&nbsp;<span class="builtintype" id="5594651">error</span>&nbsp;<span class="op" id="5594657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594660">if</span>&nbsp;<span class="ident" id="5594663">length</span>&nbsp;<span class="op" id="5594670">!=</span>&nbsp;<span class="num" id="5594673">0</span>&nbsp;<span class="op" id="5594675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594679">return</span>&nbsp;<span class="ident" id="5594686">FormatError</span><span class="op" id="5594697">(</span><span class="string" id="5594698">&#34;bad&nbsp;IEND&nbsp;length&#34;</span><span class="op" id="5594715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5594718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594721">return</span>&nbsp;<span class="ident" id="5594728">d</span><span class="op" id="5594729">.</span><span class="ident" id="5594730">verifyChecksum</span><span class="op" id="5594744">(</span><span class="op" id="5594745">)</span><br>
<span class="lineno">660</span><span class="op" id="5594747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5594750">func</span>&nbsp;<span class="op" id="5594755">(</span><span class="ident" id="5594756">d</span>&nbsp;<span class="op" id="5594758">*</span><span class="ident" id="5594759">decoder</span><span class="op" id="5594766">)</span>&nbsp;<span class="ident" id="5594768">parseChunk</span><span class="op" id="5594778">(</span><span class="op" id="5594779">)</span>&nbsp;<span class="builtintype" id="5594781">error</span>&nbsp;<span class="op" id="5594787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5594790">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594826">n</span><span class="op" id="5594827">,</span>&nbsp;<span class="ident" id="5594829">err</span>&nbsp;<span class="op" id="5594833">:=</span>&nbsp;<span class="ident" id="5594836">io</span><span class="op" id="5594838">.</span><span class="ident" id="5594839">ReadFull</span><span class="op" id="5594847">(</span><span class="ident" id="5594848">d</span><span class="op" id="5594849">.</span><span class="ident" id="5594850">r</span><span class="op" id="5594851">,</span>&nbsp;<span class="ident" id="5594853">d</span><span class="op" id="5594854">.</span><span class="ident" id="5594855">tmp</span><span class="op" id="5594858">[</span><span class="op" id="5594859">:</span><span class="num" id="5594860">8</span><span class="op" id="5594861">]</span><span class="op" id="5594862">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594865">if</span>&nbsp;<span class="ident" id="5594868">err</span>&nbsp;<span class="op" id="5594872">!=</span>&nbsp;<span class="ident" id="5594875">nil</span>&nbsp;<span class="op" id="5594879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594883">return</span>&nbsp;<span class="ident" id="5594890">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5594895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594898">length</span>&nbsp;<span class="op" id="5594905">:=</span>&nbsp;<span class="ident" id="5594908">binary</span><span class="op" id="5594914">.</span><span class="ident" id="5594915">BigEndian</span><span class="op" id="5594924">.</span><span class="ident" id="5594925">Uint32</span><span class="op" id="5594931">(</span><span class="ident" id="5594932">d</span><span class="op" id="5594933">.</span><span class="ident" id="5594934">tmp</span><span class="op" id="5594937">[</span><span class="op" id="5594938">:</span><span class="num" id="5594939">4</span><span class="op" id="5594940">]</span><span class="op" id="5594941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594944">d</span><span class="op" id="5594945">.</span><span class="ident" id="5594946">crc</span><span class="op" id="5594949">.</span><span class="ident" id="5594950">Reset</span><span class="op" id="5594955">(</span><span class="op" id="5594956">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594959">d</span><span class="op" id="5594960">.</span><span class="ident" id="5594961">crc</span><span class="op" id="5594964">.</span><span class="ident" id="5594965">Write</span><span class="op" id="5594970">(</span><span class="ident" id="5594971">d</span><span class="op" id="5594972">.</span><span class="ident" id="5594973">tmp</span><span class="op" id="5594976">[</span><span class="num" id="5594977">4</span><span class="op" id="5594978">:</span><span class="num" id="5594979">8</span><span class="op" id="5594980">]</span><span class="op" id="5594981">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5594985">//&nbsp;Read&nbsp;the&nbsp;chunk&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595010">switch</span>&nbsp;<span class="builtintype" id="5595017">string</span><span class="op" id="5595023">(</span><span class="ident" id="5595024">d</span><span class="op" id="5595025">.</span><span class="ident" id="5595026">tmp</span><span class="op" id="5595029">[</span><span class="num" id="5595030">4</span><span class="op" id="5595031">:</span><span class="num" id="5595032">8</span><span class="op" id="5595033">]</span><span class="op" id="5595034">)</span>&nbsp;<span class="op" id="5595036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595039">case</span>&nbsp;<span class="string" id="5595044">&#34;IHDR&#34;</span><span class="op" id="5595050">:</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595054">if</span>&nbsp;<span class="ident" id="5595057">d</span><span class="op" id="5595058">.</span><span class="ident" id="5595059">stage</span>&nbsp;<span class="op" id="5595065">!=</span>&nbsp;<span class="ident" id="5595068">dsStart</span>&nbsp;<span class="op" id="5595076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595081">return</span>&nbsp;<span class="ident" id="5595088">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5595106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595110">d</span><span class="op" id="5595111">.</span><span class="ident" id="5595112">stage</span>&nbsp;<span class="op" id="5595118">=</span>&nbsp;<span class="ident" id="5595120">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595133">return</span>&nbsp;<span class="ident" id="5595140">d</span><span class="op" id="5595141">.</span><span class="ident" id="5595142">parseIHDR</span><span class="op" id="5595151">(</span><span class="ident" id="5595152">length</span><span class="op" id="5595158">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595161">case</span>&nbsp;<span class="string" id="5595166">&#34;PLTE&#34;</span><span class="op" id="5595172">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595176">if</span>&nbsp;<span class="ident" id="5595179">d</span><span class="op" id="5595180">.</span><span class="ident" id="5595181">stage</span>&nbsp;<span class="op" id="5595187">!=</span>&nbsp;<span class="ident" id="5595190">dsSeenIHDR</span>&nbsp;<span class="op" id="5595201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595206">return</span>&nbsp;<span class="ident" id="5595213">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5595231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595235">d</span><span class="op" id="5595236">.</span><span class="ident" id="5595237">stage</span>&nbsp;<span class="op" id="5595243">=</span>&nbsp;<span class="ident" id="5595245">dsSeenPLTE</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595258">return</span>&nbsp;<span class="ident" id="5595265">d</span><span class="op" id="5595266">.</span><span class="ident" id="5595267">parsePLTE</span><span class="op" id="5595276">(</span><span class="ident" id="5595277">length</span><span class="op" id="5595283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595286">case</span>&nbsp;<span class="string" id="5595291">&#34;tRNS&#34;</span><span class="op" id="5595297">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595301">if</span>&nbsp;<span class="ident" id="5595304">d</span><span class="op" id="5595305">.</span><span class="ident" id="5595306">stage</span>&nbsp;<span class="op" id="5595312">!=</span>&nbsp;<span class="ident" id="5595315">dsSeenPLTE</span>&nbsp;<span class="op" id="5595326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595331">return</span>&nbsp;<span class="ident" id="5595338">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5595356">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595360">return</span>&nbsp;<span class="ident" id="5595367">d</span><span class="op" id="5595368">.</span><span class="ident" id="5595369">parsetRNS</span><span class="op" id="5595378">(</span><span class="ident" id="5595379">length</span><span class="op" id="5595385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595388">case</span>&nbsp;<span class="string" id="5595393">&#34;IDAT&#34;</span><span class="op" id="5595399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595403">if</span>&nbsp;<span class="ident" id="5595406">d</span><span class="op" id="5595407">.</span><span class="ident" id="5595408">stage</span>&nbsp;<span class="op" id="5595414">&lt;</span>&nbsp;<span class="ident" id="5595416">dsSeenIHDR</span>&nbsp;<span class="op" id="5595427">||</span>&nbsp;<span class="ident" id="5595430">d</span><span class="op" id="5595431">.</span><span class="ident" id="5595432">stage</span>&nbsp;<span class="op" id="5595438">&gt;</span>&nbsp;<span class="ident" id="5595440">dsSeenIDAT</span>&nbsp;<span class="op" id="5595451">||</span>&nbsp;<span class="op" id="5595454">(</span><span class="ident" id="5595455">d</span><span class="op" id="5595456">.</span><span class="ident" id="5595457">cb</span>&nbsp;<span class="op" id="5595460">==</span>&nbsp;<span class="ident" id="5595463">cbP8</span>&nbsp;<span class="op" id="5595468">&amp;&amp;</span>&nbsp;<span class="ident" id="5595471">d</span><span class="op" id="5595472">.</span><span class="ident" id="5595473">stage</span>&nbsp;<span class="op" id="5595479">==</span>&nbsp;<span class="ident" id="5595482">dsSeenIHDR</span><span class="op" id="5595492">)</span>&nbsp;<span class="op" id="5595494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595499">return</span>&nbsp;<span class="ident" id="5595506">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5595524">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595528">d</span><span class="op" id="5595529">.</span><span class="ident" id="5595530">stage</span>&nbsp;<span class="op" id="5595536">=</span>&nbsp;<span class="ident" id="5595538">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595551">return</span>&nbsp;<span class="ident" id="5595558">d</span><span class="op" id="5595559">.</span><span class="ident" id="5595560">parseIDAT</span><span class="op" id="5595569">(</span><span class="ident" id="5595570">length</span><span class="op" id="5595576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595579">case</span>&nbsp;<span class="string" id="5595584">&#34;IEND&#34;</span><span class="op" id="5595590">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595594">if</span>&nbsp;<span class="ident" id="5595597">d</span><span class="op" id="5595598">.</span><span class="ident" id="5595599">stage</span>&nbsp;<span class="op" id="5595605">!=</span>&nbsp;<span class="ident" id="5595608">dsSeenIDAT</span>&nbsp;<span class="op" id="5595619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595624">return</span>&nbsp;<span class="ident" id="5595631">chunkOrderError</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5595649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595653">d</span><span class="op" id="5595654">.</span><span class="ident" id="5595655">stage</span>&nbsp;<span class="op" id="5595661">=</span>&nbsp;<span class="ident" id="5595663">dsSeenIEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595676">return</span>&nbsp;<span class="ident" id="5595683">d</span><span class="op" id="5595684">.</span><span class="ident" id="5595685">parseIEND</span><span class="op" id="5595694">(</span><span class="ident" id="5595695">length</span><span class="op" id="5595701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5595704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5595707">//&nbsp;Ignore&nbsp;this&nbsp;chunk&nbsp;(of&nbsp;a&nbsp;known&nbsp;length).</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595750">var</span>&nbsp;<span class="ident" id="5595754">ignored</span>&nbsp;<span class="op" id="5595762">[</span><span class="num" id="5595763">4096</span><span class="op" id="5595767">]</span><span class="builtintype" id="5595768">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595774">for</span>&nbsp;<span class="ident" id="5595778">length</span>&nbsp;<span class="op" id="5595785">&gt;</span>&nbsp;<span class="num" id="5595787">0</span>&nbsp;<span class="op" id="5595789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595793">n</span><span class="op" id="5595794">,</span>&nbsp;<span class="ident" id="5595796">err</span>&nbsp;<span class="op" id="5595800">=</span>&nbsp;<span class="ident" id="5595802">io</span><span class="op" id="5595804">.</span><span class="ident" id="5595805">ReadFull</span><span class="op" id="5595813">(</span><span class="ident" id="5595814">d</span><span class="op" id="5595815">.</span><span class="ident" id="5595816">r</span><span class="op" id="5595817">,</span>&nbsp;<span class="ident" id="5595819">ignored</span><span class="op" id="5595826">[</span><span class="op" id="5595827">:</span><span class="ident" id="5595828">min</span><span class="op" id="5595831">(</span><span class="builtinfunc" id="5595832">len</span><span class="op" id="5595835">(</span><span class="ident" id="5595836">ignored</span><span class="op" id="5595843">)</span><span class="op" id="5595844">,</span>&nbsp;<span class="builtintype" id="5595846">int</span><span class="op" id="5595849">(</span><span class="ident" id="5595850">length</span><span class="op" id="5595856">)</span><span class="op" id="5595857">)</span><span class="op" id="5595858">]</span><span class="op" id="5595859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595863">if</span>&nbsp;<span class="ident" id="5595866">err</span>&nbsp;<span class="op" id="5595870">!=</span>&nbsp;<span class="ident" id="5595873">nil</span>&nbsp;<span class="op" id="5595877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595882">return</span>&nbsp;<span class="ident" id="5595889">err</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5595895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595899">d</span><span class="op" id="5595900">.</span><span class="ident" id="5595901">crc</span><span class="op" id="5595904">.</span><span class="ident" id="5595905">Write</span><span class="op" id="5595910">(</span><span class="ident" id="5595911">ignored</span><span class="op" id="5595918">[</span><span class="op" id="5595919">:</span><span class="ident" id="5595920">n</span><span class="op" id="5595921">]</span><span class="op" id="5595922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595926">length</span>&nbsp;<span class="op" id="5595933">-=</span>&nbsp;<span class="builtintype" id="5595936">uint32</span><span class="op" id="5595942">(</span><span class="ident" id="5595943">n</span><span class="op" id="5595944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5595947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595950">return</span>&nbsp;<span class="ident" id="5595957">d</span><span class="op" id="5595958">.</span><span class="ident" id="5595959">verifyChecksum</span><span class="op" id="5595973">(</span><span class="op" id="5595974">)</span><br>
<span class="lineno">715</span><span class="op" id="5595976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5595979">func</span>&nbsp;<span class="op" id="5595984">(</span><span class="ident" id="5595985">d</span>&nbsp;<span class="op" id="5595987">*</span><span class="ident" id="5595988">decoder</span><span class="op" id="5595995">)</span>&nbsp;<span class="ident" id="5595997">verifyChecksum</span><span class="op" id="5596011">(</span><span class="op" id="5596012">)</span>&nbsp;<span class="builtintype" id="5596014">error</span>&nbsp;<span class="op" id="5596020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596023">if</span>&nbsp;<span class="ident" id="5596026">_</span><span class="op" id="5596027">,</span>&nbsp;<span class="ident" id="5596029">err</span>&nbsp;<span class="op" id="5596033">:=</span>&nbsp;<span class="ident" id="5596036">io</span><span class="op" id="5596038">.</span><span class="ident" id="5596039">ReadFull</span><span class="op" id="5596047">(</span><span class="ident" id="5596048">d</span><span class="op" id="5596049">.</span><span class="ident" id="5596050">r</span><span class="op" id="5596051">,</span>&nbsp;<span class="ident" id="5596053">d</span><span class="op" id="5596054">.</span><span class="ident" id="5596055">tmp</span><span class="op" id="5596058">[</span><span class="op" id="5596059">:</span><span class="num" id="5596060">4</span><span class="op" id="5596061">]</span><span class="op" id="5596062">)</span><span class="op" id="5596063">;</span>&nbsp;<span class="ident" id="5596065">err</span>&nbsp;<span class="op" id="5596069">!=</span>&nbsp;<span class="ident" id="5596072">nil</span>&nbsp;<span class="op" id="5596076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596080">return</span>&nbsp;<span class="ident" id="5596087">err</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596095">if</span>&nbsp;<span class="ident" id="5596098">binary</span><span class="op" id="5596104">.</span><span class="ident" id="5596105">BigEndian</span><span class="op" id="5596114">.</span><span class="ident" id="5596115">Uint32</span><span class="op" id="5596121">(</span><span class="ident" id="5596122">d</span><span class="op" id="5596123">.</span><span class="ident" id="5596124">tmp</span><span class="op" id="5596127">[</span><span class="op" id="5596128">:</span><span class="num" id="5596129">4</span><span class="op" id="5596130">]</span><span class="op" id="5596131">)</span>&nbsp;<span class="op" id="5596133">!=</span>&nbsp;<span class="ident" id="5596136">d</span><span class="op" id="5596137">.</span><span class="ident" id="5596138">crc</span><span class="op" id="5596141">.</span><span class="ident" id="5596142">Sum32</span><span class="op" id="5596147">(</span><span class="op" id="5596148">)</span>&nbsp;<span class="op" id="5596150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596154">return</span>&nbsp;<span class="ident" id="5596161">FormatError</span><span class="op" id="5596172">(</span><span class="string" id="5596173">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="5596191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596197">return</span>&nbsp;<span class="ident" id="5596204">nil</span><br>
<span class="lineno">725</span><span class="op" id="5596208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5596211">func</span>&nbsp;<span class="op" id="5596216">(</span><span class="ident" id="5596217">d</span>&nbsp;<span class="op" id="5596219">*</span><span class="ident" id="5596220">decoder</span><span class="op" id="5596227">)</span>&nbsp;<span class="ident" id="5596229">checkHeader</span><span class="op" id="5596240">(</span><span class="op" id="5596241">)</span>&nbsp;<span class="builtintype" id="5596243">error</span>&nbsp;<span class="op" id="5596249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596252">_</span><span class="op" id="5596253">,</span>&nbsp;<span class="ident" id="5596255">err</span>&nbsp;<span class="op" id="5596259">:=</span>&nbsp;<span class="ident" id="5596262">io</span><span class="op" id="5596264">.</span><span class="ident" id="5596265">ReadFull</span><span class="op" id="5596273">(</span><span class="ident" id="5596274">d</span><span class="op" id="5596275">.</span><span class="ident" id="5596276">r</span><span class="op" id="5596277">,</span>&nbsp;<span class="ident" id="5596279">d</span><span class="op" id="5596280">.</span><span class="ident" id="5596281">tmp</span><span class="op" id="5596284">[</span><span class="op" id="5596285">:</span><span class="builtinfunc" id="5596286">len</span><span class="op" id="5596289">(</span><span class="ident" id="5596290">pngHeader</span><span class="op" id="5596299">)</span><span class="op" id="5596300">]</span><span class="op" id="5596301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596304">if</span>&nbsp;<span class="ident" id="5596307">err</span>&nbsp;<span class="op" id="5596311">!=</span>&nbsp;<span class="ident" id="5596314">nil</span>&nbsp;<span class="op" id="5596318">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596322">return</span>&nbsp;<span class="ident" id="5596329">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596337">if</span>&nbsp;<span class="builtintype" id="5596340">string</span><span class="op" id="5596346">(</span><span class="ident" id="5596347">d</span><span class="op" id="5596348">.</span><span class="ident" id="5596349">tmp</span><span class="op" id="5596352">[</span><span class="op" id="5596353">:</span><span class="builtinfunc" id="5596354">len</span><span class="op" id="5596357">(</span><span class="ident" id="5596358">pngHeader</span><span class="op" id="5596367">)</span><span class="op" id="5596368">]</span><span class="op" id="5596369">)</span>&nbsp;<span class="op" id="5596371">!=</span>&nbsp;<span class="ident" id="5596374">pngHeader</span>&nbsp;<span class="op" id="5596384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596388">return</span>&nbsp;<span class="ident" id="5596395">FormatError</span><span class="op" id="5596406">(</span><span class="string" id="5596407">&#34;not&nbsp;a&nbsp;PNG&nbsp;file&#34;</span><span class="op" id="5596423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596426">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596429">return</span>&nbsp;<span class="ident" id="5596436">nil</span><br>
<span class="lineno"></span><span class="op" id="5596440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5596443">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;PNG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="comment" id="5596512">//&nbsp;The&nbsp;type&nbsp;of&nbsp;Image&nbsp;returned&nbsp;depends&nbsp;on&nbsp;the&nbsp;PNG&nbsp;contents.</span><br>
<span class="lineno">740</span><span class="keyword" id="5596571">func</span>&nbsp;<span class="ident" id="5596576">Decode</span><span class="op" id="5596582">(</span><span class="ident" id="5596583">r</span>&nbsp;<span class="ident" id="5596585">io</span><span class="op" id="5596587">.</span><span class="ident" id="5596588">Reader</span><span class="op" id="5596594">)</span>&nbsp;<span class="op" id="5596596">(</span><span class="ident" id="5596597">image</span><span class="op" id="5596602">.</span><span class="ident" id="5596603">Image</span><span class="op" id="5596608">,</span>&nbsp;<span class="builtintype" id="5596610">error</span><span class="op" id="5596615">)</span>&nbsp;<span class="op" id="5596617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596620">d</span>&nbsp;<span class="op" id="5596622">:=</span>&nbsp;<span class="op" id="5596625">&amp;</span><span class="ident" id="5596626">decoder</span><span class="op" id="5596633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596637">r</span><span class="op" id="5596638">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5596642">r</span><span class="op" id="5596643">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596647">crc</span><span class="op" id="5596650">:</span>&nbsp;<span class="ident" id="5596652">crc32</span><span class="op" id="5596657">.</span><span class="ident" id="5596658">NewIEEE</span><span class="op" id="5596665">(</span><span class="op" id="5596666">)</span><span class="op" id="5596667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596670">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596673">if</span>&nbsp;<span class="ident" id="5596676">err</span>&nbsp;<span class="op" id="5596680">:=</span>&nbsp;<span class="ident" id="5596683">d</span><span class="op" id="5596684">.</span><span class="ident" id="5596685">checkHeader</span><span class="op" id="5596696">(</span><span class="op" id="5596697">)</span><span class="op" id="5596698">;</span>&nbsp;<span class="ident" id="5596700">err</span>&nbsp;<span class="op" id="5596704">!=</span>&nbsp;<span class="ident" id="5596707">nil</span>&nbsp;<span class="op" id="5596711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596715">if</span>&nbsp;<span class="ident" id="5596718">err</span>&nbsp;<span class="op" id="5596722">==</span>&nbsp;<span class="ident" id="5596725">io</span><span class="op" id="5596727">.</span><span class="ident" id="5596728">EOF</span>&nbsp;<span class="op" id="5596732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596737">err</span>&nbsp;<span class="op" id="5596741">=</span>&nbsp;<span class="ident" id="5596743">io</span><span class="op" id="5596745">.</span><span class="ident" id="5596746">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596769">return</span>&nbsp;<span class="ident" id="5596776">nil</span><span class="op" id="5596779">,</span>&nbsp;<span class="ident" id="5596781">err</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596789">for</span>&nbsp;<span class="ident" id="5596793">d</span><span class="op" id="5596794">.</span><span class="ident" id="5596795">stage</span>&nbsp;<span class="op" id="5596801">!=</span>&nbsp;<span class="ident" id="5596804">dsSeenIEND</span>&nbsp;<span class="op" id="5596815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596819">if</span>&nbsp;<span class="ident" id="5596822">err</span>&nbsp;<span class="op" id="5596826">:=</span>&nbsp;<span class="ident" id="5596829">d</span><span class="op" id="5596830">.</span><span class="ident" id="5596831">parseChunk</span><span class="op" id="5596841">(</span><span class="op" id="5596842">)</span><span class="op" id="5596843">;</span>&nbsp;<span class="ident" id="5596845">err</span>&nbsp;<span class="op" id="5596849">!=</span>&nbsp;<span class="ident" id="5596852">nil</span>&nbsp;<span class="op" id="5596856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596861">if</span>&nbsp;<span class="ident" id="5596864">err</span>&nbsp;<span class="op" id="5596868">==</span>&nbsp;<span class="ident" id="5596871">io</span><span class="op" id="5596873">.</span><span class="ident" id="5596874">EOF</span>&nbsp;<span class="op" id="5596878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596884">err</span>&nbsp;<span class="op" id="5596888">=</span>&nbsp;<span class="ident" id="5596890">io</span><span class="op" id="5596892">.</span><span class="ident" id="5596893">ErrUnexpectedEOF</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596918">return</span>&nbsp;<span class="ident" id="5596925">nil</span><span class="op" id="5596928">,</span>&nbsp;<span class="ident" id="5596930">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596942">return</span>&nbsp;<span class="ident" id="5596949">d</span><span class="op" id="5596950">.</span><span class="ident" id="5596951">img</span><span class="op" id="5596954">,</span>&nbsp;<span class="ident" id="5596956">nil</span><br>
<span class="lineno">760</span><span class="op" id="5596960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5596963">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;PNG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5597041">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5597071">func</span>&nbsp;<span class="ident" id="5597076">DecodeConfig</span><span class="op" id="5597088">(</span><span class="ident" id="5597089">r</span>&nbsp;<span class="ident" id="5597091">io</span><span class="op" id="5597093">.</span><span class="ident" id="5597094">Reader</span><span class="op" id="5597100">)</span>&nbsp;<span class="op" id="5597102">(</span><span class="ident" id="5597103">image</span><span class="op" id="5597108">.</span><span class="ident" id="5597109">Config</span><span class="op" id="5597115">,</span>&nbsp;<span class="builtintype" id="5597117">error</span><span class="op" id="5597122">)</span>&nbsp;<span class="op" id="5597124">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597127">d</span>&nbsp;<span class="op" id="5597129">:=</span>&nbsp;<span class="op" id="5597132">&amp;</span><span class="ident" id="5597133">decoder</span><span class="op" id="5597140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597144">r</span><span class="op" id="5597145">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5597149">r</span><span class="op" id="5597150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597154">crc</span><span class="op" id="5597157">:</span>&nbsp;<span class="ident" id="5597159">crc32</span><span class="op" id="5597164">.</span><span class="ident" id="5597165">NewIEEE</span><span class="op" id="5597172">(</span><span class="op" id="5597173">)</span><span class="op" id="5597174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597180">if</span>&nbsp;<span class="ident" id="5597183">err</span>&nbsp;<span class="op" id="5597187">:=</span>&nbsp;<span class="ident" id="5597190">d</span><span class="op" id="5597191">.</span><span class="ident" id="5597192">checkHeader</span><span class="op" id="5597203">(</span><span class="op" id="5597204">)</span><span class="op" id="5597205">;</span>&nbsp;<span class="ident" id="5597207">err</span>&nbsp;<span class="op" id="5597211">!=</span>&nbsp;<span class="ident" id="5597214">nil</span>&nbsp;<span class="op" id="5597218">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597222">if</span>&nbsp;<span class="ident" id="5597225">err</span>&nbsp;<span class="op" id="5597229">==</span>&nbsp;<span class="ident" id="5597232">io</span><span class="op" id="5597234">.</span><span class="ident" id="5597235">EOF</span>&nbsp;<span class="op" id="5597239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597244">err</span>&nbsp;<span class="op" id="5597248">=</span>&nbsp;<span class="ident" id="5597250">io</span><span class="op" id="5597252">.</span><span class="ident" id="5597253">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597276">return</span>&nbsp;<span class="ident" id="5597283">image</span><span class="op" id="5597288">.</span><span class="ident" id="5597289">Config</span><span class="op" id="5597295">{</span><span class="op" id="5597296">}</span><span class="op" id="5597297">,</span>&nbsp;<span class="ident" id="5597299">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597304">}</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597307">for</span>&nbsp;<span class="op" id="5597311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597315">if</span>&nbsp;<span class="ident" id="5597318">err</span>&nbsp;<span class="op" id="5597322">:=</span>&nbsp;<span class="ident" id="5597325">d</span><span class="op" id="5597326">.</span><span class="ident" id="5597327">parseChunk</span><span class="op" id="5597337">(</span><span class="op" id="5597338">)</span><span class="op" id="5597339">;</span>&nbsp;<span class="ident" id="5597341">err</span>&nbsp;<span class="op" id="5597345">!=</span>&nbsp;<span class="ident" id="5597348">nil</span>&nbsp;<span class="op" id="5597352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597357">if</span>&nbsp;<span class="ident" id="5597360">err</span>&nbsp;<span class="op" id="5597364">==</span>&nbsp;<span class="ident" id="5597367">io</span><span class="op" id="5597369">.</span><span class="ident" id="5597370">EOF</span>&nbsp;<span class="op" id="5597374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597380">err</span>&nbsp;<span class="op" id="5597384">=</span>&nbsp;<span class="ident" id="5597386">io</span><span class="op" id="5597388">.</span><span class="ident" id="5597389">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597409">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597414">return</span>&nbsp;<span class="ident" id="5597421">image</span><span class="op" id="5597426">.</span><span class="ident" id="5597427">Config</span><span class="op" id="5597433">{</span><span class="op" id="5597434">}</span><span class="op" id="5597435">,</span>&nbsp;<span class="ident" id="5597437">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597447">paletted</span>&nbsp;<span class="op" id="5597456">:=</span>&nbsp;<span class="ident" id="5597459">d</span><span class="op" id="5597460">.</span><span class="ident" id="5597461">cb</span>&nbsp;<span class="op" id="5597464">==</span>&nbsp;<span class="ident" id="5597467">cbP8</span>&nbsp;<span class="op" id="5597472">||</span>&nbsp;<span class="ident" id="5597475">d</span><span class="op" id="5597476">.</span><span class="ident" id="5597477">cb</span>&nbsp;<span class="op" id="5597480">==</span>&nbsp;<span class="ident" id="5597483">cbP4</span>&nbsp;<span class="op" id="5597488">||</span>&nbsp;<span class="ident" id="5597491">d</span><span class="op" id="5597492">.</span><span class="ident" id="5597493">cb</span>&nbsp;<span class="op" id="5597496">==</span>&nbsp;<span class="ident" id="5597499">cbP2</span>&nbsp;<span class="op" id="5597504">||</span>&nbsp;<span class="ident" id="5597507">d</span><span class="op" id="5597508">.</span><span class="ident" id="5597509">cb</span>&nbsp;<span class="op" id="5597512">==</span>&nbsp;<span class="ident" id="5597515">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597522">if</span>&nbsp;<span class="ident" id="5597525">d</span><span class="op" id="5597526">.</span><span class="ident" id="5597527">stage</span>&nbsp;<span class="op" id="5597533">==</span>&nbsp;<span class="ident" id="5597536">dsSeenIHDR</span>&nbsp;<span class="op" id="5597547">&amp;&amp;</span>&nbsp;<span class="op" id="5597550">!</span><span class="ident" id="5597551">paletted</span>&nbsp;<span class="op" id="5597560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597565">break</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597577">if</span>&nbsp;<span class="ident" id="5597580">d</span><span class="op" id="5597581">.</span><span class="ident" id="5597582">stage</span>&nbsp;<span class="op" id="5597588">==</span>&nbsp;<span class="ident" id="5597591">dsSeenPLTE</span>&nbsp;<span class="op" id="5597602">&amp;&amp;</span>&nbsp;<span class="ident" id="5597605">paletted</span>&nbsp;<span class="op" id="5597614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597619">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597630">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597633">var</span>&nbsp;<span class="ident" id="5597637">cm</span>&nbsp;<span class="ident" id="5597640">color</span><span class="op" id="5597645">.</span><span class="ident" id="5597646">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597653">switch</span>&nbsp;<span class="ident" id="5597660">d</span><span class="op" id="5597661">.</span><span class="ident" id="5597662">cb</span>&nbsp;<span class="op" id="5597665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597668">case</span>&nbsp;<span class="ident" id="5597673">cbG1</span><span class="op" id="5597677">,</span>&nbsp;<span class="ident" id="5597679">cbG2</span><span class="op" id="5597683">,</span>&nbsp;<span class="ident" id="5597685">cbG4</span><span class="op" id="5597689">,</span>&nbsp;<span class="ident" id="5597691">cbG8</span><span class="op" id="5597695">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597699">cm</span>&nbsp;<span class="op" id="5597702">=</span>&nbsp;<span class="ident" id="5597704">color</span><span class="op" id="5597709">.</span><span class="ident" id="5597710">GrayModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597721">case</span>&nbsp;<span class="ident" id="5597726">cbGA8</span><span class="op" id="5597731">:</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597735">cm</span>&nbsp;<span class="op" id="5597738">=</span>&nbsp;<span class="ident" id="5597740">color</span><span class="op" id="5597745">.</span><span class="ident" id="5597746">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597758">case</span>&nbsp;<span class="ident" id="5597763">cbTC8</span><span class="op" id="5597768">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597772">cm</span>&nbsp;<span class="op" id="5597775">=</span>&nbsp;<span class="ident" id="5597777">color</span><span class="op" id="5597782">.</span><span class="ident" id="5597783">RGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597794">case</span>&nbsp;<span class="ident" id="5597799">cbP1</span><span class="op" id="5597803">,</span>&nbsp;<span class="ident" id="5597805">cbP2</span><span class="op" id="5597809">,</span>&nbsp;<span class="ident" id="5597811">cbP4</span><span class="op" id="5597815">,</span>&nbsp;<span class="ident" id="5597817">cbP8</span><span class="op" id="5597821">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597825">cm</span>&nbsp;<span class="op" id="5597828">=</span>&nbsp;<span class="ident" id="5597830">d</span><span class="op" id="5597831">.</span><span class="ident" id="5597832">palette</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597841">case</span>&nbsp;<span class="ident" id="5597846">cbTCA8</span><span class="op" id="5597852">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597856">cm</span>&nbsp;<span class="op" id="5597859">=</span>&nbsp;<span class="ident" id="5597861">color</span><span class="op" id="5597866">.</span><span class="ident" id="5597867">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597879">case</span>&nbsp;<span class="ident" id="5597884">cbG16</span><span class="op" id="5597889">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597893">cm</span>&nbsp;<span class="op" id="5597896">=</span>&nbsp;<span class="ident" id="5597898">color</span><span class="op" id="5597903">.</span><span class="ident" id="5597904">Gray16Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597917">case</span>&nbsp;<span class="ident" id="5597922">cbGA16</span><span class="op" id="5597928">:</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597932">cm</span>&nbsp;<span class="op" id="5597935">=</span>&nbsp;<span class="ident" id="5597937">color</span><span class="op" id="5597942">.</span><span class="ident" id="5597943">NRGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597957">case</span>&nbsp;<span class="ident" id="5597962">cbTC16</span><span class="op" id="5597968">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597972">cm</span>&nbsp;<span class="op" id="5597975">=</span>&nbsp;<span class="ident" id="5597977">color</span><span class="op" id="5597982">.</span><span class="ident" id="5597983">RGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597996">case</span>&nbsp;<span class="ident" id="5598001">cbTCA16</span><span class="op" id="5598008">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598012">cm</span>&nbsp;<span class="op" id="5598015">=</span>&nbsp;<span class="ident" id="5598017">color</span><span class="op" id="5598022">.</span><span class="ident" id="5598023">NRGBA64Model</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5598037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598040">return</span>&nbsp;<span class="ident" id="5598047">image</span><span class="op" id="5598052">.</span><span class="ident" id="5598053">Config</span><span class="op" id="5598059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598063">ColorModel</span><span class="op" id="5598073">:</span>&nbsp;<span class="ident" id="5598075">cm</span><span class="op" id="5598077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598081">Width</span><span class="op" id="5598086">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598093">d</span><span class="op" id="5598094">.</span><span class="ident" id="5598095">width</span><span class="op" id="5598100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598104">Height</span><span class="op" id="5598110">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5598116">d</span><span class="op" id="5598117">.</span><span class="ident" id="5598118">height</span><span class="op" id="5598124">,</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5598127">}</span><span class="op" id="5598128">,</span>&nbsp;<span class="ident" id="5598130">nil</span><br>
<span class="lineno"></span><span class="op" id="5598134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5598137">func</span>&nbsp;<span class="ident" id="5598142">init</span><span class="op" id="5598146">(</span><span class="op" id="5598147">)</span>&nbsp;<span class="op" id="5598149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598152">image</span><span class="op" id="5598157">.</span><span class="ident" id="5598158">RegisterFormat</span><span class="op" id="5598172">(</span><span class="string" id="5598173">&#34;png&#34;</span><span class="op" id="5598178">,</span>&nbsp;<span class="ident" id="5598180">pngHeader</span><span class="op" id="5598189">,</span>&nbsp;<span class="ident" id="5598191">Decode</span><span class="op" id="5598197">,</span>&nbsp;<span class="ident" id="5598199">DecodeConfig</span><span class="op" id="5598211">)</span><br>
<span class="lineno">820</span><span class="op" id="5598213">}</span>
</div>
</body>
</html>
