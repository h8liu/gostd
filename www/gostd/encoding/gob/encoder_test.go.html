<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8315752">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8315807">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8315861">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8315912">package</span>&nbsp;<span class="ident" id="8315920">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8315925">import</span>&nbsp;<span class="op" id="8315932">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8315935">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8315944">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8315951">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8315957">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8315968">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8315979">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8315989">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="8315992">//&nbsp;Test&nbsp;basic&nbsp;operations&nbsp;in&nbsp;a&nbsp;safe&nbsp;manner.</span><br>
<span class="lineno"></span><span class="keyword" id="8316035">func</span>&nbsp;<span class="ident" id="8316040">TestBasicEncoderDecoder</span><span class="op" id="8316063">(</span><span class="ident" id="8316064">t</span>&nbsp;<span class="op" id="8316066">*</span><span class="ident" id="8316067">testing</span><span class="op" id="8316074">.</span><span class="ident" id="8316075">T</span><span class="op" id="8316076">)</span>&nbsp;<span class="op" id="8316078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8316081">var</span>&nbsp;<span class="ident" id="8316085">values</span>&nbsp;<span class="op" id="8316092">=</span>&nbsp;<span class="op" id="8316094">[</span><span class="op" id="8316095">]</span><span class="keyword" id="8316096">interface</span><span class="op" id="8316105">{</span><span class="op" id="8316106">}</span><span class="op" id="8316107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8316111">true</span><span class="op" id="8316115">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8316119">int</span><span class="op" id="8316122">(</span><span class="num" id="8316123">123</span><span class="op" id="8316126">)</span><span class="op" id="8316127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8316131">int8</span><span class="op" id="8316135">(</span><span class="num" id="8316136">123</span><span class="op" id="8316139">)</span><span class="op" id="8316140">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8316144">int16</span><span class="op" id="8316149">(</span><span class="op" id="8316150">-</span><span class="num" id="8316151">12345</span><span class="op" id="8316156">)</span><span class="op" id="8316157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8316161">int32</span><span class="op" id="8316166">(</span><span class="num" id="8316167">123456</span><span class="op" id="8316173">)</span><span class="op" id="8316174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8316178">int64</span><span class="op" id="8316183">(</span><span class="op" id="8316184">-</span><span class="num" id="8316185">1234567</span><span class="op" id="8316192">)</span><span class="op" id="8316193">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8316197">uint</span><span class="op" id="8316201">(</span><span class="num" id="8316202">123</span><span class="op" id="8316205">)</span><span class="op" id="8316206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8316210">uint8</span><span class="op" id="8316215">(</span><span class="num" id="8316216">123</span><span class="op" id="8316219">)</span><span class="op" id="8316220">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8316224">uint16</span><span class="op" id="8316230">(</span><span class="num" id="8316231">12345</span><span class="op" id="8316236">)</span><span class="op" id="8316237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8316241">uint32</span><span class="op" id="8316247">(</span><span class="num" id="8316248">123456</span><span class="op" id="8316254">)</span><span class="op" id="8316255">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8316259">uint64</span><span class="op" id="8316265">(</span><span class="num" id="8316266">1234567</span><span class="op" id="8316273">)</span><span class="op" id="8316274">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8316278">uintptr</span><span class="op" id="8316285">(</span><span class="num" id="8316286">12345678</span><span class="op" id="8316294">)</span><span class="op" id="8316295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8316299">float32</span><span class="op" id="8316306">(</span><span class="num" id="8316307">1.2345</span><span class="op" id="8316313">)</span><span class="op" id="8316314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8316318">float64</span><span class="op" id="8316325">(</span><span class="num" id="8316326">1.2345678</span><span class="op" id="8316335">)</span><span class="op" id="8316336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8316340">complex64</span><span class="op" id="8316349">(</span><span class="num" id="8316350">1.2345</span>&nbsp;<span class="op" id="8316357">+</span>&nbsp;<span class="num" id="8316359">2.3456i</span><span class="op" id="8316366">)</span><span class="op" id="8316367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8316371">complex128</span><span class="op" id="8316381">(</span><span class="num" id="8316382">1.2345678</span>&nbsp;<span class="op" id="8316392">+</span>&nbsp;<span class="num" id="8316394">2.3456789i</span><span class="op" id="8316404">)</span><span class="op" id="8316405">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8316409">[</span><span class="op" id="8316410">]</span><span class="builtintype" id="8316411">byte</span><span class="op" id="8316415">(</span><span class="string" id="8316416">&#34;hello&#34;</span><span class="op" id="8316423">)</span><span class="op" id="8316424">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8316428">string</span><span class="op" id="8316434">(</span><span class="string" id="8316435">&#34;hello&#34;</span><span class="op" id="8316442">)</span><span class="op" id="8316443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8316446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8316449">for</span>&nbsp;<span class="ident" id="8316453">_</span><span class="op" id="8316454">,</span>&nbsp;<span class="ident" id="8316456">value</span>&nbsp;<span class="op" id="8316462">:=</span>&nbsp;<span class="keyword" id="8316465">range</span>&nbsp;<span class="ident" id="8316471">values</span>&nbsp;<span class="op" id="8316478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8316482">b</span>&nbsp;<span class="op" id="8316484">:=</span>&nbsp;<span class="builtinfunc" id="8316487">new</span><span class="op" id="8316490">(</span><span class="ident" id="8316491">bytes</span><span class="op" id="8316496">.</span><span class="ident" id="8316497">Buffer</span><span class="op" id="8316503">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8316507">enc</span>&nbsp;<span class="op" id="8316511">:=</span>&nbsp;<span class="ident" id="8316514">NewEncoder</span><span class="op" id="8316524">(</span><span class="ident" id="8316525">b</span><span class="op" id="8316526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8316530">err</span>&nbsp;<span class="op" id="8316534">:=</span>&nbsp;<span class="ident" id="8316537">enc</span><span class="op" id="8316540">.</span><span class="ident" id="8316541">Encode</span><span class="op" id="8316547">(</span><span class="ident" id="8316548">value</span><span class="op" id="8316553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8316557">if</span>&nbsp;<span class="ident" id="8316560">err</span>&nbsp;<span class="op" id="8316564">!=</span>&nbsp;<span class="ident" id="8316567">nil</span>&nbsp;<span class="op" id="8316571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8316576">t</span><span class="op" id="8316577">.</span><span class="ident" id="8316578">Error</span><span class="op" id="8316583">(</span><span class="string" id="8316584">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8316599">,</span>&nbsp;<span class="ident" id="8316601">err</span><span class="op" id="8316604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8316608">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8316612">dec</span>&nbsp;<span class="op" id="8316616">:=</span>&nbsp;<span class="ident" id="8316619">NewDecoder</span><span class="op" id="8316629">(</span><span class="ident" id="8316630">b</span><span class="op" id="8316631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8316635">result</span>&nbsp;<span class="op" id="8316642">:=</span>&nbsp;<span class="ident" id="8316645">reflect</span><span class="op" id="8316652">.</span><span class="ident" id="8316653">New</span><span class="op" id="8316656">(</span><span class="ident" id="8316657">reflect</span><span class="op" id="8316664">.</span><span class="ident" id="8316665">TypeOf</span><span class="op" id="8316671">(</span><span class="ident" id="8316672">value</span><span class="op" id="8316677">)</span><span class="op" id="8316678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8316682">err</span>&nbsp;<span class="op" id="8316686">=</span>&nbsp;<span class="ident" id="8316688">dec</span><span class="op" id="8316691">.</span><span class="ident" id="8316692">Decode</span><span class="op" id="8316698">(</span><span class="ident" id="8316699">result</span><span class="op" id="8316705">.</span><span class="ident" id="8316706">Interface</span><span class="op" id="8316715">(</span><span class="op" id="8316716">)</span><span class="op" id="8316717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8316721">if</span>&nbsp;<span class="ident" id="8316724">err</span>&nbsp;<span class="op" id="8316728">!=</span>&nbsp;<span class="ident" id="8316731">nil</span>&nbsp;<span class="op" id="8316735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8316740">t</span><span class="op" id="8316741">.</span><span class="ident" id="8316742">Fatalf</span><span class="op" id="8316748">(</span><span class="string" id="8316749">&#34;error&nbsp;decoding&nbsp;%T:&nbsp;%v:&#34;</span><span class="op" id="8316773">,</span>&nbsp;<span class="ident" id="8316775">reflect</span><span class="op" id="8316782">.</span><span class="ident" id="8316783">TypeOf</span><span class="op" id="8316789">(</span><span class="ident" id="8316790">value</span><span class="op" id="8316795">)</span><span class="op" id="8316796">,</span>&nbsp;<span class="ident" id="8316798">err</span><span class="op" id="8316801">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8316805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8316809">if</span>&nbsp;<span class="op" id="8316812">!</span><span class="ident" id="8316813">reflect</span><span class="op" id="8316820">.</span><span class="ident" id="8316821">DeepEqual</span><span class="op" id="8316830">(</span><span class="ident" id="8316831">value</span><span class="op" id="8316836">,</span>&nbsp;<span class="ident" id="8316838">result</span><span class="op" id="8316844">.</span><span class="ident" id="8316845">Elem</span><span class="op" id="8316849">(</span><span class="op" id="8316850">)</span><span class="op" id="8316851">.</span><span class="ident" id="8316852">Interface</span><span class="op" id="8316861">(</span><span class="op" id="8316862">)</span><span class="op" id="8316863">)</span>&nbsp;<span class="op" id="8316865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8316870">t</span><span class="op" id="8316871">.</span><span class="ident" id="8316872">Fatalf</span><span class="op" id="8316878">(</span><span class="string" id="8316879">&#34;%T:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8316903">,</span>&nbsp;<span class="ident" id="8316905">value</span><span class="op" id="8316910">,</span>&nbsp;<span class="ident" id="8316912">value</span><span class="op" id="8316917">,</span>&nbsp;<span class="ident" id="8316919">result</span><span class="op" id="8316925">.</span><span class="ident" id="8316926">Elem</span><span class="op" id="8316930">(</span><span class="op" id="8316931">)</span><span class="op" id="8316932">.</span><span class="ident" id="8316933">Interface</span><span class="op" id="8316942">(</span><span class="op" id="8316943">)</span><span class="op" id="8316944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8316948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8316951">}</span><br>
<span class="lineno">55</span><span class="op" id="8316953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8316956">type</span>&nbsp;<span class="ident" id="8316961">ET0</span>&nbsp;<span class="keyword" id="8316965">struct</span>&nbsp;<span class="op" id="8316972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8316975">A</span>&nbsp;<span class="builtintype" id="8316977">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8316982">B</span>&nbsp;<span class="builtintype" id="8316984">string</span><br>
<span class="lineno">60</span><span class="op" id="8316991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8316994">type</span>&nbsp;<span class="ident" id="8316999">ET2</span>&nbsp;<span class="keyword" id="8317003">struct</span>&nbsp;<span class="op" id="8317010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317013">X</span>&nbsp;<span class="builtintype" id="8317015">string</span><br>
<span class="lineno"></span><span class="op" id="8317022">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="8317025">type</span>&nbsp;<span class="ident" id="8317030">ET1</span>&nbsp;<span class="keyword" id="8317034">struct</span>&nbsp;<span class="op" id="8317041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317044">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8317049">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317054">Et2</span>&nbsp;&nbsp;<span class="op" id="8317059">*</span><span class="ident" id="8317060">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317065">Next</span>&nbsp;<span class="op" id="8317070">*</span><span class="ident" id="8317071">ET1</span><br>
<span class="lineno">70</span><span class="op" id="8317075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8317078">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;name&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno"></span><span class="keyword" id="8317128">type</span>&nbsp;<span class="ident" id="8317133">ET3</span>&nbsp;<span class="keyword" id="8317137">struct</span>&nbsp;<span class="op" id="8317144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317147">A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8317161">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317166">Et2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8317180">*</span><span class="ident" id="8317181">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317186">DifferentNext</span>&nbsp;<span class="op" id="8317200">*</span><span class="ident" id="8317201">ET1</span><br>
<span class="lineno"></span><span class="op" id="8317205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8317208">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;type&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno">80</span><span class="keyword" id="8317258">type</span>&nbsp;<span class="ident" id="8317263">ET4</span>&nbsp;<span class="keyword" id="8317267">struct</span>&nbsp;<span class="op" id="8317274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317277">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8317282">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317287">Et2</span>&nbsp;&nbsp;<span class="builtintype" id="8317292">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317301">Next</span>&nbsp;<span class="builtintype" id="8317306">int</span><br>
<span class="lineno"></span><span class="op" id="8317310">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="8317313">func</span>&nbsp;<span class="ident" id="8317318">TestEncoderDecoder</span><span class="op" id="8317336">(</span><span class="ident" id="8317337">t</span>&nbsp;<span class="op" id="8317339">*</span><span class="ident" id="8317340">testing</span><span class="op" id="8317347">.</span><span class="ident" id="8317348">T</span><span class="op" id="8317349">)</span>&nbsp;<span class="op" id="8317351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317354">b</span>&nbsp;<span class="op" id="8317356">:=</span>&nbsp;<span class="builtinfunc" id="8317359">new</span><span class="op" id="8317362">(</span><span class="ident" id="8317363">bytes</span><span class="op" id="8317368">.</span><span class="ident" id="8317369">Buffer</span><span class="op" id="8317375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317378">enc</span>&nbsp;<span class="op" id="8317382">:=</span>&nbsp;<span class="ident" id="8317385">NewEncoder</span><span class="op" id="8317395">(</span><span class="ident" id="8317396">b</span><span class="op" id="8317397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317400">et0</span>&nbsp;<span class="op" id="8317404">:=</span>&nbsp;<span class="builtinfunc" id="8317407">new</span><span class="op" id="8317410">(</span><span class="ident" id="8317411">ET0</span><span class="op" id="8317414">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317417">et0</span><span class="op" id="8317420">.</span><span class="ident" id="8317421">A</span>&nbsp;<span class="op" id="8317423">=</span>&nbsp;<span class="num" id="8317425">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317428">et0</span><span class="op" id="8317431">.</span><span class="ident" id="8317432">B</span>&nbsp;<span class="op" id="8317434">=</span>&nbsp;<span class="string" id="8317436">&#34;gobs&nbsp;of&nbsp;fun&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317451">err</span>&nbsp;<span class="op" id="8317455">:=</span>&nbsp;<span class="ident" id="8317458">enc</span><span class="op" id="8317461">.</span><span class="ident" id="8317462">Encode</span><span class="op" id="8317468">(</span><span class="ident" id="8317469">et0</span><span class="op" id="8317472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317475">if</span>&nbsp;<span class="ident" id="8317478">err</span>&nbsp;<span class="op" id="8317482">!=</span>&nbsp;<span class="ident" id="8317485">nil</span>&nbsp;<span class="op" id="8317489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317493">t</span><span class="op" id="8317494">.</span><span class="ident" id="8317495">Error</span><span class="op" id="8317500">(</span><span class="string" id="8317501">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8317516">,</span>&nbsp;<span class="ident" id="8317518">err</span><span class="op" id="8317521">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8317527">//fmt.Printf(&#34;%&nbsp;x&nbsp;%q\n&#34;,&nbsp;b,&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8317559">//Debug(b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317571">dec</span>&nbsp;<span class="op" id="8317575">:=</span>&nbsp;<span class="ident" id="8317578">NewDecoder</span><span class="op" id="8317588">(</span><span class="ident" id="8317589">b</span><span class="op" id="8317590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317593">newEt0</span>&nbsp;<span class="op" id="8317600">:=</span>&nbsp;<span class="builtinfunc" id="8317603">new</span><span class="op" id="8317606">(</span><span class="ident" id="8317607">ET0</span><span class="op" id="8317610">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317613">err</span>&nbsp;<span class="op" id="8317617">=</span>&nbsp;<span class="ident" id="8317619">dec</span><span class="op" id="8317622">.</span><span class="ident" id="8317623">Decode</span><span class="op" id="8317629">(</span><span class="ident" id="8317630">newEt0</span><span class="op" id="8317636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317639">if</span>&nbsp;<span class="ident" id="8317642">err</span>&nbsp;<span class="op" id="8317646">!=</span>&nbsp;<span class="ident" id="8317649">nil</span>&nbsp;<span class="op" id="8317653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317657">t</span><span class="op" id="8317658">.</span><span class="ident" id="8317659">Fatal</span><span class="op" id="8317664">(</span><span class="string" id="8317665">&#34;error&nbsp;decoding&nbsp;ET0:&#34;</span><span class="op" id="8317686">,</span>&nbsp;<span class="ident" id="8317688">err</span><span class="op" id="8317691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317698">if</span>&nbsp;<span class="op" id="8317701">!</span><span class="ident" id="8317702">reflect</span><span class="op" id="8317709">.</span><span class="ident" id="8317710">DeepEqual</span><span class="op" id="8317719">(</span><span class="ident" id="8317720">et0</span><span class="op" id="8317723">,</span>&nbsp;<span class="ident" id="8317725">newEt0</span><span class="op" id="8317731">)</span>&nbsp;<span class="op" id="8317733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317737">t</span><span class="op" id="8317738">.</span><span class="ident" id="8317739">Fatalf</span><span class="op" id="8317745">(</span><span class="string" id="8317746">&#34;invalid&nbsp;data&nbsp;for&nbsp;et0:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="8317791">,</span>&nbsp;<span class="op" id="8317793">*</span><span class="ident" id="8317794">et0</span><span class="op" id="8317797">,</span>&nbsp;<span class="op" id="8317799">*</span><span class="ident" id="8317800">newEt0</span><span class="op" id="8317806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317812">if</span>&nbsp;<span class="ident" id="8317815">b</span><span class="op" id="8317816">.</span><span class="ident" id="8317817">Len</span><span class="op" id="8317820">(</span><span class="op" id="8317821">)</span>&nbsp;<span class="op" id="8317823">!=</span>&nbsp;<span class="num" id="8317826">0</span>&nbsp;<span class="op" id="8317828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317832">t</span><span class="op" id="8317833">.</span><span class="ident" id="8317834">Error</span><span class="op" id="8317839">(</span><span class="string" id="8317840">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="8317853">,</span>&nbsp;<span class="ident" id="8317855">b</span><span class="op" id="8317856">.</span><span class="ident" id="8317857">Len</span><span class="op" id="8317860">(</span><span class="op" id="8317861">)</span><span class="op" id="8317862">,</span>&nbsp;<span class="string" id="8317864">&#34;bytes&nbsp;left&#34;</span><span class="op" id="8317876">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8317882">//&nbsp;&nbsp;&nbsp;&nbspt.FailNow()</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317899">b</span>&nbsp;<span class="op" id="8317901">=</span>&nbsp;<span class="builtinfunc" id="8317903">new</span><span class="op" id="8317906">(</span><span class="ident" id="8317907">bytes</span><span class="op" id="8317912">.</span><span class="ident" id="8317913">Buffer</span><span class="op" id="8317919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317922">enc</span>&nbsp;<span class="op" id="8317926">=</span>&nbsp;<span class="ident" id="8317928">NewEncoder</span><span class="op" id="8317938">(</span><span class="ident" id="8317939">b</span><span class="op" id="8317940">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317943">et1</span>&nbsp;<span class="op" id="8317947">:=</span>&nbsp;<span class="builtinfunc" id="8317950">new</span><span class="op" id="8317953">(</span><span class="ident" id="8317954">ET1</span><span class="op" id="8317957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317960">et1</span><span class="op" id="8317963">.</span><span class="ident" id="8317964">A</span>&nbsp;<span class="op" id="8317966">=</span>&nbsp;<span class="num" id="8317968">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317971">et1</span><span class="op" id="8317974">.</span><span class="ident" id="8317975">Et2</span>&nbsp;<span class="op" id="8317979">=</span>&nbsp;<span class="builtinfunc" id="8317981">new</span><span class="op" id="8317984">(</span><span class="ident" id="8317985">ET2</span><span class="op" id="8317988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317991">err</span>&nbsp;<span class="op" id="8317995">=</span>&nbsp;<span class="ident" id="8317997">enc</span><span class="op" id="8318000">.</span><span class="ident" id="8318001">Encode</span><span class="op" id="8318007">(</span><span class="ident" id="8318008">et1</span><span class="op" id="8318011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8318014">if</span>&nbsp;<span class="ident" id="8318017">err</span>&nbsp;<span class="op" id="8318021">!=</span>&nbsp;<span class="ident" id="8318024">nil</span>&nbsp;<span class="op" id="8318028">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318032">t</span><span class="op" id="8318033">.</span><span class="ident" id="8318034">Error</span><span class="op" id="8318039">(</span><span class="string" id="8318040">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8318055">,</span>&nbsp;<span class="ident" id="8318057">err</span><span class="op" id="8318060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318066">dec</span>&nbsp;<span class="op" id="8318070">=</span>&nbsp;<span class="ident" id="8318072">NewDecoder</span><span class="op" id="8318082">(</span><span class="ident" id="8318083">b</span><span class="op" id="8318084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318087">newEt1</span>&nbsp;<span class="op" id="8318094">:=</span>&nbsp;<span class="builtinfunc" id="8318097">new</span><span class="op" id="8318100">(</span><span class="ident" id="8318101">ET1</span><span class="op" id="8318104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318107">err</span>&nbsp;<span class="op" id="8318111">=</span>&nbsp;<span class="ident" id="8318113">dec</span><span class="op" id="8318116">.</span><span class="ident" id="8318117">Decode</span><span class="op" id="8318123">(</span><span class="ident" id="8318124">newEt1</span><span class="op" id="8318130">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8318133">if</span>&nbsp;<span class="ident" id="8318136">err</span>&nbsp;<span class="op" id="8318140">!=</span>&nbsp;<span class="ident" id="8318143">nil</span>&nbsp;<span class="op" id="8318147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318151">t</span><span class="op" id="8318152">.</span><span class="ident" id="8318153">Fatal</span><span class="op" id="8318158">(</span><span class="string" id="8318159">&#34;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="8318180">,</span>&nbsp;<span class="ident" id="8318182">err</span><span class="op" id="8318185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8318192">if</span>&nbsp;<span class="op" id="8318195">!</span><span class="ident" id="8318196">reflect</span><span class="op" id="8318203">.</span><span class="ident" id="8318204">DeepEqual</span><span class="op" id="8318213">(</span><span class="ident" id="8318214">et1</span><span class="op" id="8318217">,</span>&nbsp;<span class="ident" id="8318219">newEt1</span><span class="op" id="8318225">)</span>&nbsp;<span class="op" id="8318227">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318231">t</span><span class="op" id="8318232">.</span><span class="ident" id="8318233">Fatalf</span><span class="op" id="8318239">(</span><span class="string" id="8318240">&#34;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="8318285">,</span>&nbsp;<span class="op" id="8318287">*</span><span class="ident" id="8318288">et1</span><span class="op" id="8318291">,</span>&nbsp;<span class="op" id="8318293">*</span><span class="ident" id="8318294">newEt1</span><span class="op" id="8318300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8318306">if</span>&nbsp;<span class="ident" id="8318309">b</span><span class="op" id="8318310">.</span><span class="ident" id="8318311">Len</span><span class="op" id="8318314">(</span><span class="op" id="8318315">)</span>&nbsp;<span class="op" id="8318317">!=</span>&nbsp;<span class="num" id="8318320">0</span>&nbsp;<span class="op" id="8318322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318326">t</span><span class="op" id="8318327">.</span><span class="ident" id="8318328">Error</span><span class="op" id="8318333">(</span><span class="string" id="8318334">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="8318347">,</span>&nbsp;<span class="ident" id="8318349">b</span><span class="op" id="8318350">.</span><span class="ident" id="8318351">Len</span><span class="op" id="8318354">(</span><span class="op" id="8318355">)</span><span class="op" id="8318356">,</span>&nbsp;<span class="string" id="8318358">&#34;bytes&nbsp;left&#34;</span><span class="op" id="8318370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318373">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318377">enc</span><span class="op" id="8318380">.</span><span class="ident" id="8318381">Encode</span><span class="op" id="8318387">(</span><span class="ident" id="8318388">et1</span><span class="op" id="8318391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318394">newEt1</span>&nbsp;<span class="op" id="8318401">=</span>&nbsp;<span class="builtinfunc" id="8318403">new</span><span class="op" id="8318406">(</span><span class="ident" id="8318407">ET1</span><span class="op" id="8318410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318413">err</span>&nbsp;<span class="op" id="8318417">=</span>&nbsp;<span class="ident" id="8318419">dec</span><span class="op" id="8318422">.</span><span class="ident" id="8318423">Decode</span><span class="op" id="8318429">(</span><span class="ident" id="8318430">newEt1</span><span class="op" id="8318436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8318439">if</span>&nbsp;<span class="ident" id="8318442">err</span>&nbsp;<span class="op" id="8318446">!=</span>&nbsp;<span class="ident" id="8318449">nil</span>&nbsp;<span class="op" id="8318453">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318457">t</span><span class="op" id="8318458">.</span><span class="ident" id="8318459">Fatal</span><span class="op" id="8318464">(</span><span class="string" id="8318465">&#34;round&nbsp;2:&nbsp;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="8318495">,</span>&nbsp;<span class="ident" id="8318497">err</span><span class="op" id="8318500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8318506">if</span>&nbsp;<span class="op" id="8318509">!</span><span class="ident" id="8318510">reflect</span><span class="op" id="8318517">.</span><span class="ident" id="8318518">DeepEqual</span><span class="op" id="8318527">(</span><span class="ident" id="8318528">et1</span><span class="op" id="8318531">,</span>&nbsp;<span class="ident" id="8318533">newEt1</span><span class="op" id="8318539">)</span>&nbsp;<span class="op" id="8318541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318545">t</span><span class="op" id="8318546">.</span><span class="ident" id="8318547">Fatalf</span><span class="op" id="8318553">(</span><span class="string" id="8318554">&#34;round&nbsp;2:&nbsp;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="8318608">,</span>&nbsp;<span class="op" id="8318610">*</span><span class="ident" id="8318611">et1</span><span class="op" id="8318614">,</span>&nbsp;<span class="op" id="8318616">*</span><span class="ident" id="8318617">newEt1</span><span class="op" id="8318623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318626">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8318629">if</span>&nbsp;<span class="ident" id="8318632">b</span><span class="op" id="8318633">.</span><span class="ident" id="8318634">Len</span><span class="op" id="8318637">(</span><span class="op" id="8318638">)</span>&nbsp;<span class="op" id="8318640">!=</span>&nbsp;<span class="num" id="8318643">0</span>&nbsp;<span class="op" id="8318645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318649">t</span><span class="op" id="8318650">.</span><span class="ident" id="8318651">Error</span><span class="op" id="8318656">(</span><span class="string" id="8318657">&#34;round&nbsp;2:&nbsp;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="8318679">,</span>&nbsp;<span class="ident" id="8318681">b</span><span class="op" id="8318682">.</span><span class="ident" id="8318683">Len</span><span class="op" id="8318686">(</span><span class="op" id="8318687">)</span><span class="op" id="8318688">,</span>&nbsp;<span class="string" id="8318690">&#34;bytes&nbsp;left&#34;</span><span class="op" id="8318702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8318709">//&nbsp;Now&nbsp;test&nbsp;with&nbsp;a&nbsp;running&nbsp;encoder/decoder&nbsp;pair&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;type&nbsp;mismatch.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318793">err</span>&nbsp;<span class="op" id="8318797">=</span>&nbsp;<span class="ident" id="8318799">enc</span><span class="op" id="8318802">.</span><span class="ident" id="8318803">Encode</span><span class="op" id="8318809">(</span><span class="ident" id="8318810">et1</span><span class="op" id="8318813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8318816">if</span>&nbsp;<span class="ident" id="8318819">err</span>&nbsp;<span class="op" id="8318823">!=</span>&nbsp;<span class="ident" id="8318826">nil</span>&nbsp;<span class="op" id="8318830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318834">t</span><span class="op" id="8318835">.</span><span class="ident" id="8318836">Error</span><span class="op" id="8318841">(</span><span class="string" id="8318842">&#34;round&nbsp;3:&nbsp;encoder&nbsp;fail:&#34;</span><span class="op" id="8318866">,</span>&nbsp;<span class="ident" id="8318868">err</span><span class="op" id="8318871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318877">newEt2</span>&nbsp;<span class="op" id="8318884">:=</span>&nbsp;<span class="builtinfunc" id="8318887">new</span><span class="op" id="8318890">(</span><span class="ident" id="8318891">ET2</span><span class="op" id="8318894">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318897">err</span>&nbsp;<span class="op" id="8318901">=</span>&nbsp;<span class="ident" id="8318903">dec</span><span class="op" id="8318906">.</span><span class="ident" id="8318907">Decode</span><span class="op" id="8318913">(</span><span class="ident" id="8318914">newEt2</span><span class="op" id="8318920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8318923">if</span>&nbsp;<span class="ident" id="8318926">err</span>&nbsp;<span class="op" id="8318930">==</span>&nbsp;<span class="ident" id="8318933">nil</span>&nbsp;<span class="op" id="8318937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318941">t</span><span class="op" id="8318942">.</span><span class="ident" id="8318943">Fatal</span><span class="op" id="8318948">(</span><span class="string" id="8318949">&#34;round&nbsp;3:&nbsp;expected&nbsp;`bad&nbsp;type&#39;&nbsp;error&nbsp;decoding&nbsp;ET2&#34;</span><span class="op" id="8318998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8319001">}</span><br>
<span class="lineno"></span><span class="op" id="8319003">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="8319006">//&nbsp;Run&nbsp;one&nbsp;value&nbsp;through&nbsp;the&nbsp;encoder/decoder,&nbsp;but&nbsp;use&nbsp;the&nbsp;wrong&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="8319076">//&nbsp;Input&nbsp;is&nbsp;always&nbsp;an&nbsp;ET1;&nbsp;we&nbsp;compare&nbsp;it&nbsp;to&nbsp;whatever&nbsp;is&nbsp;under&nbsp;&#39;e&#39;.</span><br>
<span class="lineno"></span><span class="keyword" id="8319143">func</span>&nbsp;<span class="ident" id="8319148">badTypeCheck</span><span class="op" id="8319160">(</span><span class="ident" id="8319161">e</span>&nbsp;<span class="keyword" id="8319163">interface</span><span class="op" id="8319172">{</span><span class="op" id="8319173">}</span><span class="op" id="8319174">,</span>&nbsp;<span class="ident" id="8319176">shouldFail</span>&nbsp;<span class="builtintype" id="8319187">bool</span><span class="op" id="8319191">,</span>&nbsp;<span class="ident" id="8319193">msg</span>&nbsp;<span class="builtintype" id="8319197">string</span><span class="op" id="8319203">,</span>&nbsp;<span class="ident" id="8319205">t</span>&nbsp;<span class="op" id="8319207">*</span><span class="ident" id="8319208">testing</span><span class="op" id="8319215">.</span><span class="ident" id="8319216">T</span><span class="op" id="8319217">)</span>&nbsp;<span class="op" id="8319219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8319222">b</span>&nbsp;<span class="op" id="8319224">:=</span>&nbsp;<span class="builtinfunc" id="8319227">new</span><span class="op" id="8319230">(</span><span class="ident" id="8319231">bytes</span><span class="op" id="8319236">.</span><span class="ident" id="8319237">Buffer</span><span class="op" id="8319243">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8319246">enc</span>&nbsp;<span class="op" id="8319250">:=</span>&nbsp;<span class="ident" id="8319253">NewEncoder</span><span class="op" id="8319263">(</span><span class="ident" id="8319264">b</span><span class="op" id="8319265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8319268">et1</span>&nbsp;<span class="op" id="8319272">:=</span>&nbsp;<span class="builtinfunc" id="8319275">new</span><span class="op" id="8319278">(</span><span class="ident" id="8319279">ET1</span><span class="op" id="8319282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8319285">et1</span><span class="op" id="8319288">.</span><span class="ident" id="8319289">A</span>&nbsp;<span class="op" id="8319291">=</span>&nbsp;<span class="num" id="8319293">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8319296">et1</span><span class="op" id="8319299">.</span><span class="ident" id="8319300">Et2</span>&nbsp;<span class="op" id="8319304">=</span>&nbsp;<span class="builtinfunc" id="8319306">new</span><span class="op" id="8319309">(</span><span class="ident" id="8319310">ET2</span><span class="op" id="8319313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8319316">err</span>&nbsp;<span class="op" id="8319320">:=</span>&nbsp;<span class="ident" id="8319323">enc</span><span class="op" id="8319326">.</span><span class="ident" id="8319327">Encode</span><span class="op" id="8319333">(</span><span class="ident" id="8319334">et1</span><span class="op" id="8319337">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8319340">if</span>&nbsp;<span class="ident" id="8319343">err</span>&nbsp;<span class="op" id="8319347">!=</span>&nbsp;<span class="ident" id="8319350">nil</span>&nbsp;<span class="op" id="8319354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8319358">t</span><span class="op" id="8319359">.</span><span class="ident" id="8319360">Error</span><span class="op" id="8319365">(</span><span class="string" id="8319366">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8319381">,</span>&nbsp;<span class="ident" id="8319383">err</span><span class="op" id="8319386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8319389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8319392">dec</span>&nbsp;<span class="op" id="8319396">:=</span>&nbsp;<span class="ident" id="8319399">NewDecoder</span><span class="op" id="8319409">(</span><span class="ident" id="8319410">b</span><span class="op" id="8319411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8319414">err</span>&nbsp;<span class="op" id="8319418">=</span>&nbsp;<span class="ident" id="8319420">dec</span><span class="op" id="8319423">.</span><span class="ident" id="8319424">Decode</span><span class="op" id="8319430">(</span><span class="ident" id="8319431">e</span><span class="op" id="8319432">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8319435">if</span>&nbsp;<span class="ident" id="8319438">shouldFail</span>&nbsp;<span class="op" id="8319449">&amp;&amp;</span>&nbsp;<span class="ident" id="8319452">err</span>&nbsp;<span class="op" id="8319456">==</span>&nbsp;<span class="ident" id="8319459">nil</span>&nbsp;<span class="op" id="8319463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8319467">t</span><span class="op" id="8319468">.</span><span class="ident" id="8319469">Error</span><span class="op" id="8319474">(</span><span class="string" id="8319475">&#34;expected&nbsp;error&nbsp;for&#34;</span><span class="op" id="8319495">,</span>&nbsp;<span class="ident" id="8319497">msg</span><span class="op" id="8319500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8319503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8319506">if</span>&nbsp;<span class="op" id="8319509">!</span><span class="ident" id="8319510">shouldFail</span>&nbsp;<span class="op" id="8319521">&amp;&amp;</span>&nbsp;<span class="ident" id="8319524">err</span>&nbsp;<span class="op" id="8319528">!=</span>&nbsp;<span class="ident" id="8319531">nil</span>&nbsp;<span class="op" id="8319535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8319539">t</span><span class="op" id="8319540">.</span><span class="ident" id="8319541">Error</span><span class="op" id="8319546">(</span><span class="string" id="8319547">&#34;unexpected&nbsp;error&nbsp;for&#34;</span><span class="op" id="8319569">,</span>&nbsp;<span class="ident" id="8319571">msg</span><span class="op" id="8319574">,</span>&nbsp;<span class="ident" id="8319576">err</span><span class="op" id="8319579">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8319582">}</span><br>
<span class="lineno"></span><span class="op" id="8319584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8319587">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;bad&nbsp;type&nbsp;the&nbsp;first&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="8319640">func</span>&nbsp;<span class="ident" id="8319645">TestWrongTypeDecoder</span><span class="op" id="8319665">(</span><span class="ident" id="8319666">t</span>&nbsp;<span class="op" id="8319668">*</span><span class="ident" id="8319669">testing</span><span class="op" id="8319676">.</span><span class="ident" id="8319677">T</span><span class="op" id="8319678">)</span>&nbsp;<span class="op" id="8319680">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8319683">badTypeCheck</span><span class="op" id="8319695">(</span><span class="builtinfunc" id="8319696">new</span><span class="op" id="8319699">(</span><span class="ident" id="8319700">ET2</span><span class="op" id="8319703">)</span><span class="op" id="8319704">,</span>&nbsp;<span class="builtintype" id="8319706">true</span><span class="op" id="8319710">,</span>&nbsp;<span class="string" id="8319712">&#34;no&nbsp;fields&nbsp;in&nbsp;common&#34;</span><span class="op" id="8319733">,</span>&nbsp;<span class="ident" id="8319735">t</span><span class="op" id="8319736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8319739">badTypeCheck</span><span class="op" id="8319751">(</span><span class="builtinfunc" id="8319752">new</span><span class="op" id="8319755">(</span><span class="ident" id="8319756">ET3</span><span class="op" id="8319759">)</span><span class="op" id="8319760">,</span>&nbsp;<span class="builtintype" id="8319762">false</span><span class="op" id="8319767">,</span>&nbsp;<span class="string" id="8319769">&#34;different&nbsp;name&nbsp;of&nbsp;field&#34;</span><span class="op" id="8319794">,</span>&nbsp;<span class="ident" id="8319796">t</span><span class="op" id="8319797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8319800">badTypeCheck</span><span class="op" id="8319812">(</span><span class="builtinfunc" id="8319813">new</span><span class="op" id="8319816">(</span><span class="ident" id="8319817">ET4</span><span class="op" id="8319820">)</span><span class="op" id="8319821">,</span>&nbsp;<span class="builtintype" id="8319823">true</span><span class="op" id="8319827">,</span>&nbsp;<span class="string" id="8319829">&#34;different&nbsp;type&nbsp;of&nbsp;field&#34;</span><span class="op" id="8319854">,</span>&nbsp;<span class="ident" id="8319856">t</span><span class="op" id="8319857">)</span><br>
<span class="lineno"></span><span class="op" id="8319859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="8319862">func</span>&nbsp;<span class="ident" id="8319867">corruptDataCheck</span><span class="op" id="8319883">(</span><span class="ident" id="8319884">s</span>&nbsp;<span class="builtintype" id="8319886">string</span><span class="op" id="8319892">,</span>&nbsp;<span class="ident" id="8319894">err</span>&nbsp;<span class="builtintype" id="8319898">error</span><span class="op" id="8319903">,</span>&nbsp;<span class="ident" id="8319905">t</span>&nbsp;<span class="op" id="8319907">*</span><span class="ident" id="8319908">testing</span><span class="op" id="8319915">.</span><span class="ident" id="8319916">T</span><span class="op" id="8319917">)</span>&nbsp;<span class="op" id="8319919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8319922">b</span>&nbsp;<span class="op" id="8319924">:=</span>&nbsp;<span class="ident" id="8319927">bytes</span><span class="op" id="8319932">.</span><span class="ident" id="8319933">NewBufferString</span><span class="op" id="8319948">(</span><span class="ident" id="8319949">s</span><span class="op" id="8319950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8319953">dec</span>&nbsp;<span class="op" id="8319957">:=</span>&nbsp;<span class="ident" id="8319960">NewDecoder</span><span class="op" id="8319970">(</span><span class="ident" id="8319971">b</span><span class="op" id="8319972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8319975">err1</span>&nbsp;<span class="op" id="8319980">:=</span>&nbsp;<span class="ident" id="8319983">dec</span><span class="op" id="8319986">.</span><span class="ident" id="8319987">Decode</span><span class="op" id="8319993">(</span><span class="builtinfunc" id="8319994">new</span><span class="op" id="8319997">(</span><span class="ident" id="8319998">ET2</span><span class="op" id="8320001">)</span><span class="op" id="8320002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320005">if</span>&nbsp;<span class="ident" id="8320008">err1</span>&nbsp;<span class="op" id="8320013">!=</span>&nbsp;<span class="ident" id="8320016">err</span>&nbsp;<span class="op" id="8320020">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320024">t</span><span class="op" id="8320025">.</span><span class="ident" id="8320026">Errorf</span><span class="op" id="8320032">(</span><span class="string" id="8320033">&#34;from&nbsp;%q&nbsp;expected&nbsp;error&nbsp;%s;&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8320068">,</span>&nbsp;<span class="ident" id="8320070">s</span><span class="op" id="8320071">,</span>&nbsp;<span class="ident" id="8320073">err</span><span class="op" id="8320076">,</span>&nbsp;<span class="ident" id="8320078">err1</span><span class="op" id="8320082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8320085">}</span><br>
<span class="lineno"></span><span class="op" id="8320087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8320090">//&nbsp;Check&nbsp;that&nbsp;we&nbsp;survive&nbsp;bad&nbsp;data.</span><br>
<span class="lineno">200</span><span class="keyword" id="8320125">func</span>&nbsp;<span class="ident" id="8320130">TestBadData</span><span class="op" id="8320141">(</span><span class="ident" id="8320142">t</span>&nbsp;<span class="op" id="8320144">*</span><span class="ident" id="8320145">testing</span><span class="op" id="8320152">.</span><span class="ident" id="8320153">T</span><span class="op" id="8320154">)</span>&nbsp;<span class="op" id="8320156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320159">corruptDataCheck</span><span class="op" id="8320175">(</span><span class="string" id="8320176">&#34;&#34;</span><span class="op" id="8320178">,</span>&nbsp;<span class="ident" id="8320180">io</span><span class="op" id="8320182">.</span><span class="ident" id="8320183">EOF</span><span class="op" id="8320186">,</span>&nbsp;<span class="ident" id="8320188">t</span><span class="op" id="8320189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320192">corruptDataCheck</span><span class="op" id="8320208">(</span><span class="string" id="8320209">&#34;\x7Fhi&#34;</span><span class="op" id="8320217">,</span>&nbsp;<span class="ident" id="8320219">io</span><span class="op" id="8320221">.</span><span class="ident" id="8320222">ErrUnexpectedEOF</span><span class="op" id="8320238">,</span>&nbsp;<span class="ident" id="8320240">t</span><span class="op" id="8320241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320244">corruptDataCheck</span><span class="op" id="8320260">(</span><span class="string" id="8320261">&#34;\x03now&nbsp;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&#34;</span><span class="op" id="8320299">,</span>&nbsp;<span class="ident" id="8320301">errBadType</span><span class="op" id="8320311">,</span>&nbsp;<span class="ident" id="8320313">t</span><span class="op" id="8320314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8320317">//&nbsp;issue&nbsp;6323.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320333">corruptDataCheck</span><span class="op" id="8320349">(</span><span class="string" id="8320350">&#34;\x04\x24foo&#34;</span><span class="op" id="8320363">,</span>&nbsp;<span class="ident" id="8320365">errRange</span><span class="op" id="8320373">,</span>&nbsp;<span class="ident" id="8320375">t</span><span class="op" id="8320376">)</span><br>
<span class="lineno"></span><span class="op" id="8320378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8320381">//&nbsp;Types&nbsp;not&nbsp;supported&nbsp;at&nbsp;top&nbsp;level&nbsp;by&nbsp;the&nbsp;Encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="8320433">var</span>&nbsp;<span class="ident" id="8320437">unsupportedValues</span>&nbsp;<span class="op" id="8320455">=</span>&nbsp;<span class="op" id="8320457">[</span><span class="op" id="8320458">]</span><span class="keyword" id="8320459">interface</span><span class="op" id="8320468">{</span><span class="op" id="8320469">}</span><span class="op" id="8320470">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8320473">make</span><span class="op" id="8320477">(</span><span class="keyword" id="8320478">chan</span>&nbsp;<span class="builtintype" id="8320483">int</span><span class="op" id="8320486">)</span><span class="op" id="8320487">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320490">func</span><span class="op" id="8320494">(</span><span class="ident" id="8320495">a</span>&nbsp;<span class="builtintype" id="8320497">int</span><span class="op" id="8320500">)</span>&nbsp;<span class="builtintype" id="8320502">bool</span>&nbsp;<span class="op" id="8320507">{</span>&nbsp;<span class="keyword" id="8320509">return</span>&nbsp;<span class="builtintype" id="8320516">true</span>&nbsp;<span class="op" id="8320521">}</span><span class="op" id="8320522">,</span><br>
<span class="lineno"></span><span class="op" id="8320524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8320527">func</span>&nbsp;<span class="ident" id="8320532">TestUnsupported</span><span class="op" id="8320547">(</span><span class="ident" id="8320548">t</span>&nbsp;<span class="op" id="8320550">*</span><span class="ident" id="8320551">testing</span><span class="op" id="8320558">.</span><span class="ident" id="8320559">T</span><span class="op" id="8320560">)</span>&nbsp;<span class="op" id="8320562">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320565">var</span>&nbsp;<span class="ident" id="8320569">b</span>&nbsp;<span class="ident" id="8320571">bytes</span><span class="op" id="8320576">.</span><span class="ident" id="8320577">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320585">enc</span>&nbsp;<span class="op" id="8320589">:=</span>&nbsp;<span class="ident" id="8320592">NewEncoder</span><span class="op" id="8320602">(</span><span class="op" id="8320603">&amp;</span><span class="ident" id="8320604">b</span><span class="op" id="8320605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320608">for</span>&nbsp;<span class="ident" id="8320612">_</span><span class="op" id="8320613">,</span>&nbsp;<span class="ident" id="8320615">v</span>&nbsp;<span class="op" id="8320617">:=</span>&nbsp;<span class="keyword" id="8320620">range</span>&nbsp;<span class="ident" id="8320626">unsupportedValues</span>&nbsp;<span class="op" id="8320644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320648">err</span>&nbsp;<span class="op" id="8320652">:=</span>&nbsp;<span class="ident" id="8320655">enc</span><span class="op" id="8320658">.</span><span class="ident" id="8320659">Encode</span><span class="op" id="8320665">(</span><span class="ident" id="8320666">v</span><span class="op" id="8320667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320671">if</span>&nbsp;<span class="ident" id="8320674">err</span>&nbsp;<span class="op" id="8320678">==</span>&nbsp;<span class="ident" id="8320681">nil</span>&nbsp;<span class="op" id="8320685">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320690">t</span><span class="op" id="8320691">.</span><span class="ident" id="8320692">Errorf</span><span class="op" id="8320698">(</span><span class="string" id="8320699">&#34;expected&nbsp;error&nbsp;for&nbsp;%T;&nbsp;got&nbsp;none&#34;</span><span class="op" id="8320732">,</span>&nbsp;<span class="ident" id="8320734">v</span><span class="op" id="8320735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8320739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8320742">}</span><br>
<span class="lineno"></span><span class="op" id="8320744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="8320747">func</span>&nbsp;<span class="ident" id="8320752">encAndDec</span><span class="op" id="8320761">(</span><span class="ident" id="8320762">in</span><span class="op" id="8320764">,</span>&nbsp;<span class="ident" id="8320766">out</span>&nbsp;<span class="keyword" id="8320770">interface</span><span class="op" id="8320779">{</span><span class="op" id="8320780">}</span><span class="op" id="8320781">)</span>&nbsp;<span class="builtintype" id="8320783">error</span>&nbsp;<span class="op" id="8320789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320792">b</span>&nbsp;<span class="op" id="8320794">:=</span>&nbsp;<span class="builtinfunc" id="8320797">new</span><span class="op" id="8320800">(</span><span class="ident" id="8320801">bytes</span><span class="op" id="8320806">.</span><span class="ident" id="8320807">Buffer</span><span class="op" id="8320813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320816">enc</span>&nbsp;<span class="op" id="8320820">:=</span>&nbsp;<span class="ident" id="8320823">NewEncoder</span><span class="op" id="8320833">(</span><span class="ident" id="8320834">b</span><span class="op" id="8320835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320838">err</span>&nbsp;<span class="op" id="8320842">:=</span>&nbsp;<span class="ident" id="8320845">enc</span><span class="op" id="8320848">.</span><span class="ident" id="8320849">Encode</span><span class="op" id="8320855">(</span><span class="ident" id="8320856">in</span><span class="op" id="8320858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320861">if</span>&nbsp;<span class="ident" id="8320864">err</span>&nbsp;<span class="op" id="8320868">!=</span>&nbsp;<span class="ident" id="8320871">nil</span>&nbsp;<span class="op" id="8320875">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320879">return</span>&nbsp;<span class="ident" id="8320886">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8320891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320894">dec</span>&nbsp;<span class="op" id="8320898">:=</span>&nbsp;<span class="ident" id="8320901">NewDecoder</span><span class="op" id="8320911">(</span><span class="ident" id="8320912">b</span><span class="op" id="8320913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320916">err</span>&nbsp;<span class="op" id="8320920">=</span>&nbsp;<span class="ident" id="8320922">dec</span><span class="op" id="8320925">.</span><span class="ident" id="8320926">Decode</span><span class="op" id="8320932">(</span><span class="ident" id="8320933">out</span><span class="op" id="8320936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320939">if</span>&nbsp;<span class="ident" id="8320942">err</span>&nbsp;<span class="op" id="8320946">!=</span>&nbsp;<span class="ident" id="8320949">nil</span>&nbsp;<span class="op" id="8320953">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320957">return</span>&nbsp;<span class="ident" id="8320964">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8320969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320972">return</span>&nbsp;<span class="ident" id="8320979">nil</span><br>
<span class="lineno"></span><span class="op" id="8320983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="8320986">func</span>&nbsp;<span class="ident" id="8320991">TestTypeToPtrType</span><span class="op" id="8321008">(</span><span class="ident" id="8321009">t</span>&nbsp;<span class="op" id="8321011">*</span><span class="ident" id="8321012">testing</span><span class="op" id="8321019">.</span><span class="ident" id="8321020">T</span><span class="op" id="8321021">)</span>&nbsp;<span class="op" id="8321023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8321026">//&nbsp;Encode&nbsp;a&nbsp;T,&nbsp;decode&nbsp;a&nbsp;*T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321054">type</span>&nbsp;<span class="ident" id="8321059">Type0</span>&nbsp;<span class="keyword" id="8321065">struct</span>&nbsp;<span class="op" id="8321072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321076">A</span>&nbsp;<span class="builtintype" id="8321078">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321083">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321086">t0</span>&nbsp;<span class="op" id="8321089">:=</span>&nbsp;<span class="ident" id="8321092">Type0</span><span class="op" id="8321097">{</span><span class="num" id="8321098">7</span><span class="op" id="8321099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321102">t0p</span>&nbsp;<span class="op" id="8321106">:=</span>&nbsp;<span class="builtinfunc" id="8321109">new</span><span class="op" id="8321112">(</span><span class="ident" id="8321113">Type0</span><span class="op" id="8321118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321121">if</span>&nbsp;<span class="ident" id="8321124">err</span>&nbsp;<span class="op" id="8321128">:=</span>&nbsp;<span class="ident" id="8321131">encAndDec</span><span class="op" id="8321140">(</span><span class="ident" id="8321141">t0</span><span class="op" id="8321143">,</span>&nbsp;<span class="ident" id="8321145">t0p</span><span class="op" id="8321148">)</span><span class="op" id="8321149">;</span>&nbsp;<span class="ident" id="8321151">err</span>&nbsp;<span class="op" id="8321155">!=</span>&nbsp;<span class="ident" id="8321158">nil</span>&nbsp;<span class="op" id="8321162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321166">t</span><span class="op" id="8321167">.</span><span class="ident" id="8321168">Error</span><span class="op" id="8321173">(</span><span class="ident" id="8321174">err</span><span class="op" id="8321177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321180">}</span><br>
<span class="lineno">250</span><span class="op" id="8321182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8321185">func</span>&nbsp;<span class="ident" id="8321190">TestPtrTypeToType</span><span class="op" id="8321207">(</span><span class="ident" id="8321208">t</span>&nbsp;<span class="op" id="8321210">*</span><span class="ident" id="8321211">testing</span><span class="op" id="8321218">.</span><span class="ident" id="8321219">T</span><span class="op" id="8321220">)</span>&nbsp;<span class="op" id="8321222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8321225">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321253">type</span>&nbsp;<span class="ident" id="8321258">Type1</span>&nbsp;<span class="keyword" id="8321264">struct</span>&nbsp;<span class="op" id="8321271">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321275">A</span>&nbsp;<span class="builtintype" id="8321277">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321286">t1p</span>&nbsp;<span class="op" id="8321290">:=</span>&nbsp;<span class="op" id="8321293">&amp;</span><span class="ident" id="8321294">Type1</span><span class="op" id="8321299">{</span><span class="num" id="8321300">17</span><span class="op" id="8321302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321305">var</span>&nbsp;<span class="ident" id="8321309">t1</span>&nbsp;<span class="ident" id="8321312">Type1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321319">if</span>&nbsp;<span class="ident" id="8321322">err</span>&nbsp;<span class="op" id="8321326">:=</span>&nbsp;<span class="ident" id="8321329">encAndDec</span><span class="op" id="8321338">(</span><span class="ident" id="8321339">t1</span><span class="op" id="8321341">,</span>&nbsp;<span class="ident" id="8321343">t1p</span><span class="op" id="8321346">)</span><span class="op" id="8321347">;</span>&nbsp;<span class="ident" id="8321349">err</span>&nbsp;<span class="op" id="8321353">!=</span>&nbsp;<span class="ident" id="8321356">nil</span>&nbsp;<span class="op" id="8321360">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321364">t</span><span class="op" id="8321365">.</span><span class="ident" id="8321366">Error</span><span class="op" id="8321371">(</span><span class="ident" id="8321372">err</span><span class="op" id="8321375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321378">}</span><br>
<span class="lineno"></span><span class="op" id="8321380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8321383">func</span>&nbsp;<span class="ident" id="8321388">TestTypeToPtrPtrPtrPtrType</span><span class="op" id="8321414">(</span><span class="ident" id="8321415">t</span>&nbsp;<span class="op" id="8321417">*</span><span class="ident" id="8321418">testing</span><span class="op" id="8321425">.</span><span class="ident" id="8321426">T</span><span class="op" id="8321427">)</span>&nbsp;<span class="op" id="8321429">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321432">type</span>&nbsp;<span class="ident" id="8321437">Type2</span>&nbsp;<span class="keyword" id="8321443">struct</span>&nbsp;<span class="op" id="8321450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321454">A</span>&nbsp;<span class="op" id="8321456">*</span><span class="op" id="8321457">*</span><span class="op" id="8321458">*</span><span class="op" id="8321459">*</span><span class="builtintype" id="8321460">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321472">t2</span>&nbsp;<span class="op" id="8321475">:=</span>&nbsp;<span class="ident" id="8321478">Type2</span><span class="op" id="8321483">{</span><span class="op" id="8321484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321487">t2</span><span class="op" id="8321489">.</span><span class="ident" id="8321490">A</span>&nbsp;<span class="op" id="8321492">=</span>&nbsp;<span class="builtinfunc" id="8321494">new</span><span class="op" id="8321497">(</span><span class="op" id="8321498">*</span><span class="op" id="8321499">*</span><span class="op" id="8321500">*</span><span class="builtintype" id="8321501">float64</span><span class="op" id="8321508">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321511">*</span><span class="ident" id="8321512">t2</span><span class="op" id="8321514">.</span><span class="ident" id="8321515">A</span>&nbsp;<span class="op" id="8321517">=</span>&nbsp;<span class="builtinfunc" id="8321519">new</span><span class="op" id="8321522">(</span><span class="op" id="8321523">*</span><span class="op" id="8321524">*</span><span class="builtintype" id="8321525">float64</span><span class="op" id="8321532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321535">*</span><span class="op" id="8321536">*</span><span class="ident" id="8321537">t2</span><span class="op" id="8321539">.</span><span class="ident" id="8321540">A</span>&nbsp;<span class="op" id="8321542">=</span>&nbsp;<span class="builtinfunc" id="8321544">new</span><span class="op" id="8321547">(</span><span class="op" id="8321548">*</span><span class="builtintype" id="8321549">float64</span><span class="op" id="8321556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321559">*</span><span class="op" id="8321560">*</span><span class="op" id="8321561">*</span><span class="ident" id="8321562">t2</span><span class="op" id="8321564">.</span><span class="ident" id="8321565">A</span>&nbsp;<span class="op" id="8321567">=</span>&nbsp;<span class="builtinfunc" id="8321569">new</span><span class="op" id="8321572">(</span><span class="builtintype" id="8321573">float64</span><span class="op" id="8321580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321583">*</span><span class="op" id="8321584">*</span><span class="op" id="8321585">*</span><span class="op" id="8321586">*</span><span class="ident" id="8321587">t2</span><span class="op" id="8321589">.</span><span class="ident" id="8321590">A</span>&nbsp;<span class="op" id="8321592">=</span>&nbsp;<span class="num" id="8321594">27.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321600">t2pppp</span>&nbsp;<span class="op" id="8321607">:=</span>&nbsp;<span class="builtinfunc" id="8321610">new</span><span class="op" id="8321613">(</span><span class="op" id="8321614">*</span><span class="op" id="8321615">*</span><span class="op" id="8321616">*</span><span class="ident" id="8321617">Type2</span><span class="op" id="8321622">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321625">if</span>&nbsp;<span class="ident" id="8321628">err</span>&nbsp;<span class="op" id="8321632">:=</span>&nbsp;<span class="ident" id="8321635">encAndDec</span><span class="op" id="8321644">(</span><span class="ident" id="8321645">t2</span><span class="op" id="8321647">,</span>&nbsp;<span class="ident" id="8321649">t2pppp</span><span class="op" id="8321655">)</span><span class="op" id="8321656">;</span>&nbsp;<span class="ident" id="8321658">err</span>&nbsp;<span class="op" id="8321662">!=</span>&nbsp;<span class="ident" id="8321665">nil</span>&nbsp;<span class="op" id="8321669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321673">t</span><span class="op" id="8321674">.</span><span class="ident" id="8321675">Fatal</span><span class="op" id="8321680">(</span><span class="ident" id="8321681">err</span><span class="op" id="8321684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321690">if</span>&nbsp;<span class="op" id="8321693">*</span><span class="op" id="8321694">*</span><span class="op" id="8321695">*</span><span class="op" id="8321696">*</span><span class="op" id="8321697">(</span><span class="op" id="8321698">*</span><span class="op" id="8321699">*</span><span class="op" id="8321700">*</span><span class="op" id="8321701">*</span><span class="ident" id="8321702">t2pppp</span><span class="op" id="8321708">)</span><span class="op" id="8321709">.</span><span class="ident" id="8321710">A</span>&nbsp;<span class="op" id="8321712">!=</span>&nbsp;<span class="op" id="8321715">*</span><span class="op" id="8321716">*</span><span class="op" id="8321717">*</span><span class="op" id="8321718">*</span><span class="ident" id="8321719">t2</span><span class="op" id="8321721">.</span><span class="ident" id="8321722">A</span>&nbsp;<span class="op" id="8321724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321728">t</span><span class="op" id="8321729">.</span><span class="ident" id="8321730">Errorf</span><span class="op" id="8321736">(</span><span class="string" id="8321737">&#34;wrong&nbsp;value&nbsp;after&nbsp;decode:&nbsp;%g&nbsp;not&nbsp;%g&#34;</span><span class="op" id="8321774">,</span>&nbsp;<span class="op" id="8321776">*</span><span class="op" id="8321777">*</span><span class="op" id="8321778">*</span><span class="op" id="8321779">*</span><span class="op" id="8321780">(</span><span class="op" id="8321781">*</span><span class="op" id="8321782">*</span><span class="op" id="8321783">*</span><span class="op" id="8321784">*</span><span class="ident" id="8321785">t2pppp</span><span class="op" id="8321791">)</span><span class="op" id="8321792">.</span><span class="ident" id="8321793">A</span><span class="op" id="8321794">,</span>&nbsp;<span class="op" id="8321796">*</span><span class="op" id="8321797">*</span><span class="op" id="8321798">*</span><span class="op" id="8321799">*</span><span class="ident" id="8321800">t2</span><span class="op" id="8321802">.</span><span class="ident" id="8321803">A</span><span class="op" id="8321804">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321807">}</span><br>
<span class="lineno"></span><span class="op" id="8321809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8321812">func</span>&nbsp;<span class="ident" id="8321817">TestSlice</span><span class="op" id="8321826">(</span><span class="ident" id="8321827">t</span>&nbsp;<span class="op" id="8321829">*</span><span class="ident" id="8321830">testing</span><span class="op" id="8321837">.</span><span class="ident" id="8321838">T</span><span class="op" id="8321839">)</span>&nbsp;<span class="op" id="8321841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321844">type</span>&nbsp;<span class="ident" id="8321849">Type3</span>&nbsp;<span class="keyword" id="8321855">struct</span>&nbsp;<span class="op" id="8321862">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321866">A</span>&nbsp;<span class="op" id="8321868">[</span><span class="op" id="8321869">]</span><span class="builtintype" id="8321870">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321881">t3p</span>&nbsp;<span class="op" id="8321885">:=</span>&nbsp;<span class="op" id="8321888">&amp;</span><span class="ident" id="8321889">Type3</span><span class="op" id="8321894">{</span><span class="op" id="8321895">[</span><span class="op" id="8321896">]</span><span class="builtintype" id="8321897">string</span><span class="op" id="8321903">{</span><span class="string" id="8321904">&#34;hello&#34;</span><span class="op" id="8321911">,</span>&nbsp;<span class="string" id="8321913">&#34;world&#34;</span><span class="op" id="8321920">}</span><span class="op" id="8321921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321924">var</span>&nbsp;<span class="ident" id="8321928">t3</span>&nbsp;<span class="ident" id="8321931">Type3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321938">if</span>&nbsp;<span class="ident" id="8321941">err</span>&nbsp;<span class="op" id="8321945">:=</span>&nbsp;<span class="ident" id="8321948">encAndDec</span><span class="op" id="8321957">(</span><span class="ident" id="8321958">t3</span><span class="op" id="8321960">,</span>&nbsp;<span class="ident" id="8321962">t3p</span><span class="op" id="8321965">)</span><span class="op" id="8321966">;</span>&nbsp;<span class="ident" id="8321968">err</span>&nbsp;<span class="op" id="8321972">!=</span>&nbsp;<span class="ident" id="8321975">nil</span>&nbsp;<span class="op" id="8321979">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321983">t</span><span class="op" id="8321984">.</span><span class="ident" id="8321985">Error</span><span class="op" id="8321990">(</span><span class="ident" id="8321991">err</span><span class="op" id="8321994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321997">}</span><br>
<span class="lineno"></span><span class="op" id="8321999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8322002">func</span>&nbsp;<span class="ident" id="8322007">TestValueError</span><span class="op" id="8322021">(</span><span class="ident" id="8322022">t</span>&nbsp;<span class="op" id="8322024">*</span><span class="ident" id="8322025">testing</span><span class="op" id="8322032">.</span><span class="ident" id="8322033">T</span><span class="op" id="8322034">)</span>&nbsp;<span class="op" id="8322036">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8322039">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322067">type</span>&nbsp;<span class="ident" id="8322072">Type4</span>&nbsp;<span class="keyword" id="8322078">struct</span>&nbsp;<span class="op" id="8322085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322089">A</span>&nbsp;<span class="builtintype" id="8322091">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322099">t4p</span>&nbsp;<span class="op" id="8322103">:=</span>&nbsp;<span class="op" id="8322106">&amp;</span><span class="ident" id="8322107">Type4</span><span class="op" id="8322112">{</span><span class="num" id="8322113">3</span><span class="op" id="8322114">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322117">var</span>&nbsp;<span class="ident" id="8322121">t4</span>&nbsp;<span class="ident" id="8322124">Type4</span>&nbsp;<span class="comment" id="8322130">//&nbsp;note:&nbsp;not&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322155">if</span>&nbsp;<span class="ident" id="8322158">err</span>&nbsp;<span class="op" id="8322162">:=</span>&nbsp;<span class="ident" id="8322165">encAndDec</span><span class="op" id="8322174">(</span><span class="ident" id="8322175">t4p</span><span class="op" id="8322178">,</span>&nbsp;<span class="ident" id="8322180">t4</span><span class="op" id="8322182">)</span><span class="op" id="8322183">;</span>&nbsp;<span class="ident" id="8322185">err</span>&nbsp;<span class="op" id="8322189">==</span>&nbsp;<span class="ident" id="8322192">nil</span>&nbsp;<span class="op" id="8322196">||</span>&nbsp;<span class="ident" id="8322199">strings</span><span class="op" id="8322206">.</span><span class="ident" id="8322207">Index</span><span class="op" id="8322212">(</span><span class="ident" id="8322213">err</span><span class="op" id="8322216">.</span><span class="ident" id="8322217">Error</span><span class="op" id="8322222">(</span><span class="op" id="8322223">)</span><span class="op" id="8322224">,</span>&nbsp;<span class="string" id="8322226">&#34;pointer&#34;</span><span class="op" id="8322235">)</span>&nbsp;<span class="op" id="8322237">&lt;</span>&nbsp;<span class="num" id="8322239">0</span>&nbsp;<span class="op" id="8322241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322245">t</span><span class="op" id="8322246">.</span><span class="ident" id="8322247">Error</span><span class="op" id="8322252">(</span><span class="string" id="8322253">&#34;expected&nbsp;error&nbsp;about&nbsp;pointer;&nbsp;got&#34;</span><span class="op" id="8322288">,</span>&nbsp;<span class="ident" id="8322290">err</span><span class="op" id="8322293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322296">}</span><br>
<span class="lineno"></span><span class="op" id="8322298">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="keyword" id="8322301">func</span>&nbsp;<span class="ident" id="8322306">TestArray</span><span class="op" id="8322315">(</span><span class="ident" id="8322316">t</span>&nbsp;<span class="op" id="8322318">*</span><span class="ident" id="8322319">testing</span><span class="op" id="8322326">.</span><span class="ident" id="8322327">T</span><span class="op" id="8322328">)</span>&nbsp;<span class="op" id="8322330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322333">type</span>&nbsp;<span class="ident" id="8322338">Type5</span>&nbsp;<span class="keyword" id="8322344">struct</span>&nbsp;<span class="op" id="8322351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322355">A</span>&nbsp;<span class="op" id="8322357">[</span><span class="num" id="8322358">3</span><span class="op" id="8322359">]</span><span class="builtintype" id="8322360">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322369">B</span>&nbsp;<span class="op" id="8322371">[</span><span class="num" id="8322372">3</span><span class="op" id="8322373">]</span><span class="builtintype" id="8322374">byte</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322383">type</span>&nbsp;<span class="ident" id="8322388">Type6</span>&nbsp;<span class="keyword" id="8322394">struct</span>&nbsp;<span class="op" id="8322401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322405">A</span>&nbsp;<span class="op" id="8322407">[</span><span class="num" id="8322408">2</span><span class="op" id="8322409">]</span><span class="builtintype" id="8322410">string</span>&nbsp;<span class="comment" id="8322417">//&nbsp;can&#39;t&nbsp;hold&nbsp;t5.a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322440">t5</span>&nbsp;<span class="op" id="8322443">:=</span>&nbsp;<span class="ident" id="8322446">Type5</span><span class="op" id="8322451">{</span><span class="op" id="8322452">[</span><span class="num" id="8322453">3</span><span class="op" id="8322454">]</span><span class="builtintype" id="8322455">string</span><span class="op" id="8322461">{</span><span class="string" id="8322462">&#34;hello&#34;</span><span class="op" id="8322469">,</span>&nbsp;<span class="string" id="8322471">&#34;,&#34;</span><span class="op" id="8322474">,</span>&nbsp;<span class="string" id="8322476">&#34;world&#34;</span><span class="op" id="8322483">}</span><span class="op" id="8322484">,</span>&nbsp;<span class="op" id="8322486">[</span><span class="num" id="8322487">3</span><span class="op" id="8322488">]</span><span class="builtintype" id="8322489">byte</span><span class="op" id="8322493">{</span><span class="num" id="8322494">1</span><span class="op" id="8322495">,</span>&nbsp;<span class="num" id="8322497">2</span><span class="op" id="8322498">,</span>&nbsp;<span class="num" id="8322500">3</span><span class="op" id="8322501">}</span><span class="op" id="8322502">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322505">var</span>&nbsp;<span class="ident" id="8322509">t5p</span>&nbsp;<span class="ident" id="8322513">Type5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322520">if</span>&nbsp;<span class="ident" id="8322523">err</span>&nbsp;<span class="op" id="8322527">:=</span>&nbsp;<span class="ident" id="8322530">encAndDec</span><span class="op" id="8322539">(</span><span class="ident" id="8322540">t5</span><span class="op" id="8322542">,</span>&nbsp;<span class="op" id="8322544">&amp;</span><span class="ident" id="8322545">t5p</span><span class="op" id="8322548">)</span><span class="op" id="8322549">;</span>&nbsp;<span class="ident" id="8322551">err</span>&nbsp;<span class="op" id="8322555">!=</span>&nbsp;<span class="ident" id="8322558">nil</span>&nbsp;<span class="op" id="8322562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322566">t</span><span class="op" id="8322567">.</span><span class="ident" id="8322568">Error</span><span class="op" id="8322573">(</span><span class="ident" id="8322574">err</span><span class="op" id="8322577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322583">var</span>&nbsp;<span class="ident" id="8322587">t6</span>&nbsp;<span class="ident" id="8322590">Type6</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322597">if</span>&nbsp;<span class="ident" id="8322600">err</span>&nbsp;<span class="op" id="8322604">:=</span>&nbsp;<span class="ident" id="8322607">encAndDec</span><span class="op" id="8322616">(</span><span class="ident" id="8322617">t5</span><span class="op" id="8322619">,</span>&nbsp;<span class="op" id="8322621">&amp;</span><span class="ident" id="8322622">t6</span><span class="op" id="8322624">)</span><span class="op" id="8322625">;</span>&nbsp;<span class="ident" id="8322627">err</span>&nbsp;<span class="op" id="8322631">==</span>&nbsp;<span class="ident" id="8322634">nil</span>&nbsp;<span class="op" id="8322638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322642">t</span><span class="op" id="8322643">.</span><span class="ident" id="8322644">Error</span><span class="op" id="8322649">(</span><span class="string" id="8322650">&#34;should&nbsp;fail&nbsp;with&nbsp;mismatched&nbsp;array&nbsp;sizes&#34;</span><span class="op" id="8322691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322694">}</span><br>
<span class="lineno"></span><span class="op" id="8322696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="8322699">func</span>&nbsp;<span class="ident" id="8322704">TestRecursiveMapType</span><span class="op" id="8322724">(</span><span class="ident" id="8322725">t</span>&nbsp;<span class="op" id="8322727">*</span><span class="ident" id="8322728">testing</span><span class="op" id="8322735">.</span><span class="ident" id="8322736">T</span><span class="op" id="8322737">)</span>&nbsp;<span class="op" id="8322739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322742">type</span>&nbsp;<span class="ident" id="8322747">recursiveMap</span>&nbsp;<span class="keyword" id="8322760">map</span><span class="op" id="8322763">[</span><span class="builtintype" id="8322764">string</span><span class="op" id="8322770">]</span><span class="ident" id="8322771">recursiveMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322785">r1</span>&nbsp;<span class="op" id="8322788">:=</span>&nbsp;<span class="ident" id="8322791">recursiveMap</span><span class="op" id="8322803">{</span><span class="string" id="8322804">&#34;A&#34;</span><span class="op" id="8322807">:</span>&nbsp;<span class="ident" id="8322809">recursiveMap</span><span class="op" id="8322821">{</span><span class="string" id="8322822">&#34;B&#34;</span><span class="op" id="8322825">:</span>&nbsp;<span class="ident" id="8322827">nil</span><span class="op" id="8322830">,</span>&nbsp;<span class="string" id="8322832">&#34;C&#34;</span><span class="op" id="8322835">:</span>&nbsp;<span class="ident" id="8322837">nil</span><span class="op" id="8322840">}</span><span class="op" id="8322841">,</span>&nbsp;<span class="string" id="8322843">&#34;D&#34;</span><span class="op" id="8322846">:</span>&nbsp;<span class="ident" id="8322848">nil</span><span class="op" id="8322851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322854">r2</span>&nbsp;<span class="op" id="8322857">:=</span>&nbsp;<span class="builtinfunc" id="8322860">make</span><span class="op" id="8322864">(</span><span class="ident" id="8322865">recursiveMap</span><span class="op" id="8322877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322880">if</span>&nbsp;<span class="ident" id="8322883">err</span>&nbsp;<span class="op" id="8322887">:=</span>&nbsp;<span class="ident" id="8322890">encAndDec</span><span class="op" id="8322899">(</span><span class="ident" id="8322900">r1</span><span class="op" id="8322902">,</span>&nbsp;<span class="op" id="8322904">&amp;</span><span class="ident" id="8322905">r2</span><span class="op" id="8322907">)</span><span class="op" id="8322908">;</span>&nbsp;<span class="ident" id="8322910">err</span>&nbsp;<span class="op" id="8322914">!=</span>&nbsp;<span class="ident" id="8322917">nil</span>&nbsp;<span class="op" id="8322921">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322925">t</span><span class="op" id="8322926">.</span><span class="ident" id="8322927">Error</span><span class="op" id="8322932">(</span><span class="ident" id="8322933">err</span><span class="op" id="8322936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322939">}</span><br>
<span class="lineno"></span><span class="op" id="8322941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8322944">func</span>&nbsp;<span class="ident" id="8322949">TestRecursiveSliceType</span><span class="op" id="8322971">(</span><span class="ident" id="8322972">t</span>&nbsp;<span class="op" id="8322974">*</span><span class="ident" id="8322975">testing</span><span class="op" id="8322982">.</span><span class="ident" id="8322983">T</span><span class="op" id="8322984">)</span>&nbsp;<span class="op" id="8322986">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322989">type</span>&nbsp;<span class="ident" id="8322994">recursiveSlice</span>&nbsp;<span class="op" id="8323009">[</span><span class="op" id="8323010">]</span><span class="ident" id="8323011">recursiveSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323027">r1</span>&nbsp;<span class="op" id="8323030">:=</span>&nbsp;<span class="ident" id="8323033">recursiveSlice</span><span class="op" id="8323047">{</span><span class="num" id="8323048">0</span><span class="op" id="8323049">:</span>&nbsp;<span class="ident" id="8323051">recursiveSlice</span><span class="op" id="8323065">{</span><span class="num" id="8323066">0</span><span class="op" id="8323067">:</span>&nbsp;<span class="ident" id="8323069">nil</span><span class="op" id="8323072">}</span><span class="op" id="8323073">,</span>&nbsp;<span class="num" id="8323075">1</span><span class="op" id="8323076">:</span>&nbsp;<span class="ident" id="8323078">nil</span><span class="op" id="8323081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323084">r2</span>&nbsp;<span class="op" id="8323087">:=</span>&nbsp;<span class="builtinfunc" id="8323090">make</span><span class="op" id="8323094">(</span><span class="ident" id="8323095">recursiveSlice</span><span class="op" id="8323109">,</span>&nbsp;<span class="num" id="8323111">0</span><span class="op" id="8323112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323115">if</span>&nbsp;<span class="ident" id="8323118">err</span>&nbsp;<span class="op" id="8323122">:=</span>&nbsp;<span class="ident" id="8323125">encAndDec</span><span class="op" id="8323134">(</span><span class="ident" id="8323135">r1</span><span class="op" id="8323137">,</span>&nbsp;<span class="op" id="8323139">&amp;</span><span class="ident" id="8323140">r2</span><span class="op" id="8323142">)</span><span class="op" id="8323143">;</span>&nbsp;<span class="ident" id="8323145">err</span>&nbsp;<span class="op" id="8323149">!=</span>&nbsp;<span class="ident" id="8323152">nil</span>&nbsp;<span class="op" id="8323156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323160">t</span><span class="op" id="8323161">.</span><span class="ident" id="8323162">Error</span><span class="op" id="8323167">(</span><span class="ident" id="8323168">err</span><span class="op" id="8323171">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323174">}</span><br>
<span class="lineno"></span><span class="op" id="8323176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8323179">//&nbsp;Regression&nbsp;test&nbsp;for&nbsp;bug:&nbsp;must&nbsp;send&nbsp;zero&nbsp;values&nbsp;inside&nbsp;arrays</span><br>
<span class="lineno"></span><span class="keyword" id="8323243">func</span>&nbsp;<span class="ident" id="8323248">TestDefaultsInArray</span><span class="op" id="8323267">(</span><span class="ident" id="8323268">t</span>&nbsp;<span class="op" id="8323270">*</span><span class="ident" id="8323271">testing</span><span class="op" id="8323278">.</span><span class="ident" id="8323279">T</span><span class="op" id="8323280">)</span>&nbsp;<span class="op" id="8323282">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323285">type</span>&nbsp;<span class="ident" id="8323290">Type7</span>&nbsp;<span class="keyword" id="8323296">struct</span>&nbsp;<span class="op" id="8323303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323307">B</span>&nbsp;<span class="op" id="8323309">[</span><span class="op" id="8323310">]</span><span class="builtintype" id="8323311">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323318">I</span>&nbsp;<span class="op" id="8323320">[</span><span class="op" id="8323321">]</span><span class="builtintype" id="8323322">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323328">S</span>&nbsp;<span class="op" id="8323330">[</span><span class="op" id="8323331">]</span><span class="builtintype" id="8323332">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323341">F</span>&nbsp;<span class="op" id="8323343">[</span><span class="op" id="8323344">]</span><span class="builtintype" id="8323345">float64</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323357">t7</span>&nbsp;<span class="op" id="8323360">:=</span>&nbsp;<span class="ident" id="8323363">Type7</span><span class="op" id="8323368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323372">[</span><span class="op" id="8323373">]</span><span class="builtintype" id="8323374">bool</span><span class="op" id="8323378">{</span><span class="builtintype" id="8323379">false</span><span class="op" id="8323384">,</span>&nbsp;<span class="builtintype" id="8323386">false</span><span class="op" id="8323391">,</span>&nbsp;<span class="builtintype" id="8323393">true</span><span class="op" id="8323397">}</span><span class="op" id="8323398">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323402">[</span><span class="op" id="8323403">]</span><span class="builtintype" id="8323404">int</span><span class="op" id="8323407">{</span><span class="num" id="8323408">0</span><span class="op" id="8323409">,</span>&nbsp;<span class="num" id="8323411">0</span><span class="op" id="8323412">,</span>&nbsp;<span class="num" id="8323414">1</span><span class="op" id="8323415">}</span><span class="op" id="8323416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323420">[</span><span class="op" id="8323421">]</span><span class="builtintype" id="8323422">string</span><span class="op" id="8323428">{</span><span class="string" id="8323429">&#34;hi&#34;</span><span class="op" id="8323433">,</span>&nbsp;<span class="string" id="8323435">&#34;&#34;</span><span class="op" id="8323437">,</span>&nbsp;<span class="string" id="8323439">&#34;there&#34;</span><span class="op" id="8323446">}</span><span class="op" id="8323447">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323451">[</span><span class="op" id="8323452">]</span><span class="builtintype" id="8323453">float64</span><span class="op" id="8323460">{</span><span class="num" id="8323461">0</span><span class="op" id="8323462">,</span>&nbsp;<span class="num" id="8323464">0</span><span class="op" id="8323465">,</span>&nbsp;<span class="num" id="8323467">1</span><span class="op" id="8323468">}</span><span class="op" id="8323469">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323475">var</span>&nbsp;<span class="ident" id="8323479">t7p</span>&nbsp;<span class="ident" id="8323483">Type7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323490">if</span>&nbsp;<span class="ident" id="8323493">err</span>&nbsp;<span class="op" id="8323497">:=</span>&nbsp;<span class="ident" id="8323500">encAndDec</span><span class="op" id="8323509">(</span><span class="ident" id="8323510">t7</span><span class="op" id="8323512">,</span>&nbsp;<span class="op" id="8323514">&amp;</span><span class="ident" id="8323515">t7p</span><span class="op" id="8323518">)</span><span class="op" id="8323519">;</span>&nbsp;<span class="ident" id="8323521">err</span>&nbsp;<span class="op" id="8323525">!=</span>&nbsp;<span class="ident" id="8323528">nil</span>&nbsp;<span class="op" id="8323532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323536">t</span><span class="op" id="8323537">.</span><span class="ident" id="8323538">Error</span><span class="op" id="8323543">(</span><span class="ident" id="8323544">err</span><span class="op" id="8323547">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323550">}</span><br>
<span class="lineno"></span><span class="op" id="8323552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8323555">var</span>&nbsp;<span class="ident" id="8323559">testInt</span>&nbsp;<span class="builtintype" id="8323567">int</span><br>
<span class="lineno"></span><span class="keyword" id="8323571">var</span>&nbsp;<span class="ident" id="8323575">testFloat32</span>&nbsp;<span class="builtintype" id="8323587">float32</span><br>
<span class="lineno">365</span><span class="keyword" id="8323595">var</span>&nbsp;<span class="ident" id="8323599">testString</span>&nbsp;<span class="builtintype" id="8323610">string</span><br>
<span class="lineno"></span><span class="keyword" id="8323617">var</span>&nbsp;<span class="ident" id="8323621">testSlice</span>&nbsp;<span class="op" id="8323631">[</span><span class="op" id="8323632">]</span><span class="builtintype" id="8323633">string</span><br>
<span class="lineno"></span><span class="keyword" id="8323640">var</span>&nbsp;<span class="ident" id="8323644">testMap</span>&nbsp;<span class="keyword" id="8323652">map</span><span class="op" id="8323655">[</span><span class="builtintype" id="8323656">string</span><span class="op" id="8323662">]</span><span class="builtintype" id="8323663">int</span><br>
<span class="lineno"></span><span class="keyword" id="8323667">var</span>&nbsp;<span class="ident" id="8323671">testArray</span>&nbsp;<span class="op" id="8323681">[</span><span class="num" id="8323682">7</span><span class="op" id="8323683">]</span><span class="builtintype" id="8323684">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="8323689">type</span>&nbsp;<span class="ident" id="8323694">SingleTest</span>&nbsp;<span class="keyword" id="8323705">struct</span>&nbsp;<span class="op" id="8323712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323715">in</span>&nbsp;&nbsp;<span class="keyword" id="8323719">interface</span><span class="op" id="8323728">{</span><span class="op" id="8323729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323732">out</span>&nbsp;<span class="keyword" id="8323736">interface</span><span class="op" id="8323745">{</span><span class="op" id="8323746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323749">err</span>&nbsp;<span class="builtintype" id="8323753">string</span><br>
<span class="lineno"></span><span class="op" id="8323760">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="8323763">var</span>&nbsp;<span class="ident" id="8323767">singleTests</span>&nbsp;<span class="op" id="8323779">=</span>&nbsp;<span class="op" id="8323781">[</span><span class="op" id="8323782">]</span><span class="ident" id="8323783">SingleTest</span><span class="op" id="8323793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323796">{</span><span class="num" id="8323797">17</span><span class="op" id="8323799">,</span>&nbsp;<span class="op" id="8323801">&amp;</span><span class="ident" id="8323802">testInt</span><span class="op" id="8323809">,</span>&nbsp;<span class="string" id="8323811">&#34;&#34;</span><span class="op" id="8323813">}</span><span class="op" id="8323814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323817">{</span><span class="builtintype" id="8323818">float32</span><span class="op" id="8323825">(</span><span class="num" id="8323826">17.5</span><span class="op" id="8323830">)</span><span class="op" id="8323831">,</span>&nbsp;<span class="op" id="8323833">&amp;</span><span class="ident" id="8323834">testFloat32</span><span class="op" id="8323845">,</span>&nbsp;<span class="string" id="8323847">&#34;&#34;</span><span class="op" id="8323849">}</span><span class="op" id="8323850">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323853">{</span><span class="string" id="8323854">&#34;bike&nbsp;shed&#34;</span><span class="op" id="8323865">,</span>&nbsp;<span class="op" id="8323867">&amp;</span><span class="ident" id="8323868">testString</span><span class="op" id="8323878">,</span>&nbsp;<span class="string" id="8323880">&#34;&#34;</span><span class="op" id="8323882">}</span><span class="op" id="8323883">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323886">{</span><span class="op" id="8323887">[</span><span class="op" id="8323888">]</span><span class="builtintype" id="8323889">string</span><span class="op" id="8323895">{</span><span class="string" id="8323896">&#34;bike&#34;</span><span class="op" id="8323902">,</span>&nbsp;<span class="string" id="8323904">&#34;shed&#34;</span><span class="op" id="8323910">,</span>&nbsp;<span class="string" id="8323912">&#34;paint&#34;</span><span class="op" id="8323919">,</span>&nbsp;<span class="string" id="8323921">&#34;color&#34;</span><span class="op" id="8323928">}</span><span class="op" id="8323929">,</span>&nbsp;<span class="op" id="8323931">&amp;</span><span class="ident" id="8323932">testSlice</span><span class="op" id="8323941">,</span>&nbsp;<span class="string" id="8323943">&#34;&#34;</span><span class="op" id="8323945">}</span><span class="op" id="8323946">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323949">{</span><span class="keyword" id="8323950">map</span><span class="op" id="8323953">[</span><span class="builtintype" id="8323954">string</span><span class="op" id="8323960">]</span><span class="builtintype" id="8323961">int</span><span class="op" id="8323964">{</span><span class="string" id="8323965">&#34;seven&#34;</span><span class="op" id="8323972">:</span>&nbsp;<span class="num" id="8323974">7</span><span class="op" id="8323975">,</span>&nbsp;<span class="string" id="8323977">&#34;twelve&#34;</span><span class="op" id="8323985">:</span>&nbsp;<span class="num" id="8323987">12</span><span class="op" id="8323989">}</span><span class="op" id="8323990">,</span>&nbsp;<span class="op" id="8323992">&amp;</span><span class="ident" id="8323993">testMap</span><span class="op" id="8324000">,</span>&nbsp;<span class="string" id="8324002">&#34;&#34;</span><span class="op" id="8324004">}</span><span class="op" id="8324005">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324008">{</span><span class="op" id="8324009">[</span><span class="num" id="8324010">7</span><span class="op" id="8324011">]</span><span class="builtintype" id="8324012">int</span><span class="op" id="8324015">{</span><span class="num" id="8324016">4</span><span class="op" id="8324017">,</span>&nbsp;<span class="num" id="8324019">55</span><span class="op" id="8324021">,</span>&nbsp;<span class="num" id="8324023">0</span><span class="op" id="8324024">,</span>&nbsp;<span class="num" id="8324026">0</span><span class="op" id="8324027">,</span>&nbsp;<span class="num" id="8324029">0</span><span class="op" id="8324030">,</span>&nbsp;<span class="num" id="8324032">0</span><span class="op" id="8324033">,</span>&nbsp;<span class="num" id="8324035">0</span><span class="op" id="8324036">}</span><span class="op" id="8324037">,</span>&nbsp;<span class="op" id="8324039">&amp;</span><span class="ident" id="8324040">testArray</span><span class="op" id="8324049">,</span>&nbsp;<span class="string" id="8324051">&#34;&#34;</span><span class="op" id="8324053">}</span><span class="op" id="8324054">,</span>&nbsp;<span class="comment" id="8324056">//&nbsp;case&nbsp;that&nbsp;once&nbsp;triggered&nbsp;a&nbsp;bug</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324091">{</span><span class="op" id="8324092">[</span><span class="num" id="8324093">7</span><span class="op" id="8324094">]</span><span class="builtintype" id="8324095">int</span><span class="op" id="8324098">{</span><span class="num" id="8324099">4</span><span class="op" id="8324100">,</span>&nbsp;<span class="num" id="8324102">55</span><span class="op" id="8324104">,</span>&nbsp;<span class="num" id="8324106">1</span><span class="op" id="8324107">,</span>&nbsp;<span class="num" id="8324109">44</span><span class="op" id="8324111">,</span>&nbsp;<span class="num" id="8324113">22</span><span class="op" id="8324115">,</span>&nbsp;<span class="num" id="8324117">66</span><span class="op" id="8324119">,</span>&nbsp;<span class="num" id="8324121">1234</span><span class="op" id="8324125">}</span><span class="op" id="8324126">,</span>&nbsp;<span class="op" id="8324128">&amp;</span><span class="ident" id="8324129">testArray</span><span class="op" id="8324138">,</span>&nbsp;<span class="string" id="8324140">&#34;&#34;</span><span class="op" id="8324142">}</span><span class="op" id="8324143">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8324147">//&nbsp;Decode&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324165">{</span><span class="num" id="8324166">172</span><span class="op" id="8324169">,</span>&nbsp;<span class="op" id="8324171">&amp;</span><span class="ident" id="8324172">testFloat32</span><span class="op" id="8324183">,</span>&nbsp;<span class="string" id="8324185">&#34;type&#34;</span><span class="op" id="8324191">}</span><span class="op" id="8324192">,</span><br>
<span class="lineno"></span><span class="op" id="8324194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8324197">func</span>&nbsp;<span class="ident" id="8324202">TestSingletons</span><span class="op" id="8324216">(</span><span class="ident" id="8324217">t</span>&nbsp;<span class="op" id="8324219">*</span><span class="ident" id="8324220">testing</span><span class="op" id="8324227">.</span><span class="ident" id="8324228">T</span><span class="op" id="8324229">)</span>&nbsp;<span class="op" id="8324231">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324234">b</span>&nbsp;<span class="op" id="8324236">:=</span>&nbsp;<span class="builtinfunc" id="8324239">new</span><span class="op" id="8324242">(</span><span class="ident" id="8324243">bytes</span><span class="op" id="8324248">.</span><span class="ident" id="8324249">Buffer</span><span class="op" id="8324255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324258">enc</span>&nbsp;<span class="op" id="8324262">:=</span>&nbsp;<span class="ident" id="8324265">NewEncoder</span><span class="op" id="8324275">(</span><span class="ident" id="8324276">b</span><span class="op" id="8324277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324280">dec</span>&nbsp;<span class="op" id="8324284">:=</span>&nbsp;<span class="ident" id="8324287">NewDecoder</span><span class="op" id="8324297">(</span><span class="ident" id="8324298">b</span><span class="op" id="8324299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324302">for</span>&nbsp;<span class="ident" id="8324306">_</span><span class="op" id="8324307">,</span>&nbsp;<span class="ident" id="8324309">test</span>&nbsp;<span class="op" id="8324314">:=</span>&nbsp;<span class="keyword" id="8324317">range</span>&nbsp;<span class="ident" id="8324323">singleTests</span>&nbsp;<span class="op" id="8324335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324339">b</span><span class="op" id="8324340">.</span><span class="ident" id="8324341">Reset</span><span class="op" id="8324346">(</span><span class="op" id="8324347">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324351">err</span>&nbsp;<span class="op" id="8324355">:=</span>&nbsp;<span class="ident" id="8324358">enc</span><span class="op" id="8324361">.</span><span class="ident" id="8324362">Encode</span><span class="op" id="8324368">(</span><span class="ident" id="8324369">test</span><span class="op" id="8324373">.</span><span class="ident" id="8324374">in</span><span class="op" id="8324376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324380">if</span>&nbsp;<span class="ident" id="8324383">err</span>&nbsp;<span class="op" id="8324387">!=</span>&nbsp;<span class="ident" id="8324390">nil</span>&nbsp;<span class="op" id="8324394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324399">t</span><span class="op" id="8324400">.</span><span class="ident" id="8324401">Errorf</span><span class="op" id="8324407">(</span><span class="string" id="8324408">&#34;error&nbsp;encoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="8324431">,</span>&nbsp;<span class="ident" id="8324433">test</span><span class="op" id="8324437">.</span><span class="ident" id="8324438">in</span><span class="op" id="8324440">,</span>&nbsp;<span class="ident" id="8324442">err</span><span class="op" id="8324445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324450">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324461">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324465">err</span>&nbsp;<span class="op" id="8324469">=</span>&nbsp;<span class="ident" id="8324471">dec</span><span class="op" id="8324474">.</span><span class="ident" id="8324475">Decode</span><span class="op" id="8324481">(</span><span class="ident" id="8324482">test</span><span class="op" id="8324486">.</span><span class="ident" id="8324487">out</span><span class="op" id="8324490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324494">switch</span>&nbsp;<span class="op" id="8324501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324505">case</span>&nbsp;<span class="ident" id="8324510">err</span>&nbsp;<span class="op" id="8324514">!=</span>&nbsp;<span class="ident" id="8324517">nil</span>&nbsp;<span class="op" id="8324521">&amp;&amp;</span>&nbsp;<span class="ident" id="8324524">test</span><span class="op" id="8324528">.</span><span class="ident" id="8324529">err</span>&nbsp;<span class="op" id="8324533">==</span>&nbsp;<span class="string" id="8324536">&#34;&#34;</span><span class="op" id="8324538">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324543">t</span><span class="op" id="8324544">.</span><span class="ident" id="8324545">Errorf</span><span class="op" id="8324551">(</span><span class="string" id="8324552">&#34;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="8324575">,</span>&nbsp;<span class="ident" id="8324577">test</span><span class="op" id="8324581">.</span><span class="ident" id="8324582">in</span><span class="op" id="8324584">,</span>&nbsp;<span class="ident" id="8324586">err</span><span class="op" id="8324589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324594">continue</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324605">case</span>&nbsp;<span class="ident" id="8324610">err</span>&nbsp;<span class="op" id="8324614">==</span>&nbsp;<span class="ident" id="8324617">nil</span>&nbsp;<span class="op" id="8324621">&amp;&amp;</span>&nbsp;<span class="ident" id="8324624">test</span><span class="op" id="8324628">.</span><span class="ident" id="8324629">err</span>&nbsp;<span class="op" id="8324633">!=</span>&nbsp;<span class="string" id="8324636">&#34;&#34;</span><span class="op" id="8324638">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324643">t</span><span class="op" id="8324644">.</span><span class="ident" id="8324645">Errorf</span><span class="op" id="8324651">(</span><span class="string" id="8324652">&#34;expected&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="8324684">,</span>&nbsp;<span class="ident" id="8324686">test</span><span class="op" id="8324690">.</span><span class="ident" id="8324691">in</span><span class="op" id="8324693">,</span>&nbsp;<span class="ident" id="8324695">test</span><span class="op" id="8324699">.</span><span class="ident" id="8324700">err</span><span class="op" id="8324703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324708">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324719">case</span>&nbsp;<span class="ident" id="8324724">err</span>&nbsp;<span class="op" id="8324728">!=</span>&nbsp;<span class="ident" id="8324731">nil</span>&nbsp;<span class="op" id="8324735">&amp;&amp;</span>&nbsp;<span class="ident" id="8324738">test</span><span class="op" id="8324742">.</span><span class="ident" id="8324743">err</span>&nbsp;<span class="op" id="8324747">!=</span>&nbsp;<span class="string" id="8324750">&#34;&#34;</span><span class="op" id="8324752">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324757">if</span>&nbsp;<span class="ident" id="8324760">strings</span><span class="op" id="8324767">.</span><span class="ident" id="8324768">Index</span><span class="op" id="8324773">(</span><span class="ident" id="8324774">err</span><span class="op" id="8324777">.</span><span class="ident" id="8324778">Error</span><span class="op" id="8324783">(</span><span class="op" id="8324784">)</span><span class="op" id="8324785">,</span>&nbsp;<span class="ident" id="8324787">test</span><span class="op" id="8324791">.</span><span class="ident" id="8324792">err</span><span class="op" id="8324795">)</span>&nbsp;<span class="op" id="8324797">&lt;</span>&nbsp;<span class="num" id="8324799">0</span>&nbsp;<span class="op" id="8324801">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324807">t</span><span class="op" id="8324808">.</span><span class="ident" id="8324809">Errorf</span><span class="op" id="8324815">(</span><span class="string" id="8324816">&#34;wrong&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;wanted&nbsp;%s,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8324860">,</span>&nbsp;<span class="ident" id="8324862">test</span><span class="op" id="8324866">.</span><span class="ident" id="8324867">in</span><span class="op" id="8324869">,</span>&nbsp;<span class="ident" id="8324871">test</span><span class="op" id="8324875">.</span><span class="ident" id="8324876">err</span><span class="op" id="8324879">,</span>&nbsp;<span class="ident" id="8324881">err</span><span class="op" id="8324884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324894">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8324909">//&nbsp;Get&nbsp;rid&nbsp;of&nbsp;the&nbsp;pointer&nbsp;in&nbsp;the&nbsp;rhs</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324948">val</span>&nbsp;<span class="op" id="8324952">:=</span>&nbsp;<span class="ident" id="8324955">reflect</span><span class="op" id="8324962">.</span><span class="ident" id="8324963">ValueOf</span><span class="op" id="8324970">(</span><span class="ident" id="8324971">test</span><span class="op" id="8324975">.</span><span class="ident" id="8324976">out</span><span class="op" id="8324979">)</span><span class="op" id="8324980">.</span><span class="ident" id="8324981">Elem</span><span class="op" id="8324985">(</span><span class="op" id="8324986">)</span><span class="op" id="8324987">.</span><span class="ident" id="8324988">Interface</span><span class="op" id="8324997">(</span><span class="op" id="8324998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325002">if</span>&nbsp;<span class="op" id="8325005">!</span><span class="ident" id="8325006">reflect</span><span class="op" id="8325013">.</span><span class="ident" id="8325014">DeepEqual</span><span class="op" id="8325023">(</span><span class="ident" id="8325024">test</span><span class="op" id="8325028">.</span><span class="ident" id="8325029">in</span><span class="op" id="8325031">,</span>&nbsp;<span class="ident" id="8325033">val</span><span class="op" id="8325036">)</span>&nbsp;<span class="op" id="8325038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325043">t</span><span class="op" id="8325044">.</span><span class="ident" id="8325045">Errorf</span><span class="op" id="8325051">(</span><span class="string" id="8325052">&#34;decoding&nbsp;singleton:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8325092">,</span>&nbsp;<span class="ident" id="8325094">test</span><span class="op" id="8325098">.</span><span class="ident" id="8325099">in</span><span class="op" id="8325101">,</span>&nbsp;<span class="ident" id="8325103">val</span><span class="op" id="8325106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325113">}</span><br>
<span class="lineno">420</span><span class="op" id="8325115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8325118">func</span>&nbsp;<span class="ident" id="8325123">TestStructNonStruct</span><span class="op" id="8325142">(</span><span class="ident" id="8325143">t</span>&nbsp;<span class="op" id="8325145">*</span><span class="ident" id="8325146">testing</span><span class="op" id="8325153">.</span><span class="ident" id="8325154">T</span><span class="op" id="8325155">)</span>&nbsp;<span class="op" id="8325157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325160">type</span>&nbsp;<span class="ident" id="8325165">Struct</span>&nbsp;<span class="keyword" id="8325172">struct</span>&nbsp;<span class="op" id="8325179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325183">A</span>&nbsp;<span class="builtintype" id="8325185">string</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325196">type</span>&nbsp;<span class="ident" id="8325201">NonStruct</span>&nbsp;<span class="builtintype" id="8325211">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325219">s</span>&nbsp;<span class="op" id="8325221">:=</span>&nbsp;<span class="ident" id="8325224">Struct</span><span class="op" id="8325230">{</span><span class="string" id="8325231">&#34;hello&#34;</span><span class="op" id="8325238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325241">var</span>&nbsp;<span class="ident" id="8325245">sp</span>&nbsp;<span class="ident" id="8325248">Struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325256">if</span>&nbsp;<span class="ident" id="8325259">err</span>&nbsp;<span class="op" id="8325263">:=</span>&nbsp;<span class="ident" id="8325266">encAndDec</span><span class="op" id="8325275">(</span><span class="ident" id="8325276">s</span><span class="op" id="8325277">,</span>&nbsp;<span class="op" id="8325279">&amp;</span><span class="ident" id="8325280">sp</span><span class="op" id="8325282">)</span><span class="op" id="8325283">;</span>&nbsp;<span class="ident" id="8325285">err</span>&nbsp;<span class="op" id="8325289">!=</span>&nbsp;<span class="ident" id="8325292">nil</span>&nbsp;<span class="op" id="8325296">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325300">t</span><span class="op" id="8325301">.</span><span class="ident" id="8325302">Error</span><span class="op" id="8325307">(</span><span class="ident" id="8325308">err</span><span class="op" id="8325311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325317">var</span>&nbsp;<span class="ident" id="8325321">ns</span>&nbsp;<span class="ident" id="8325324">NonStruct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325335">if</span>&nbsp;<span class="ident" id="8325338">err</span>&nbsp;<span class="op" id="8325342">:=</span>&nbsp;<span class="ident" id="8325345">encAndDec</span><span class="op" id="8325354">(</span><span class="ident" id="8325355">s</span><span class="op" id="8325356">,</span>&nbsp;<span class="op" id="8325358">&amp;</span><span class="ident" id="8325359">ns</span><span class="op" id="8325361">)</span><span class="op" id="8325362">;</span>&nbsp;<span class="ident" id="8325364">err</span>&nbsp;<span class="op" id="8325368">==</span>&nbsp;<span class="ident" id="8325371">nil</span>&nbsp;<span class="op" id="8325375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325379">t</span><span class="op" id="8325380">.</span><span class="ident" id="8325381">Error</span><span class="op" id="8325386">(</span><span class="string" id="8325387">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;struct/non-struct&#34;</span><span class="op" id="8325427">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325430">}</span>&nbsp;<span class="keyword" id="8325432">else</span>&nbsp;<span class="keyword" id="8325437">if</span>&nbsp;<span class="ident" id="8325440">strings</span><span class="op" id="8325447">.</span><span class="ident" id="8325448">Index</span><span class="op" id="8325453">(</span><span class="ident" id="8325454">err</span><span class="op" id="8325457">.</span><span class="ident" id="8325458">Error</span><span class="op" id="8325463">(</span><span class="op" id="8325464">)</span><span class="op" id="8325465">,</span>&nbsp;<span class="string" id="8325467">&#34;type&#34;</span><span class="op" id="8325473">)</span>&nbsp;<span class="op" id="8325475">&lt;</span>&nbsp;<span class="num" id="8325477">0</span>&nbsp;<span class="op" id="8325479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325483">t</span><span class="op" id="8325484">.</span><span class="ident" id="8325485">Error</span><span class="op" id="8325490">(</span><span class="string" id="8325491">&#34;for&nbsp;struct/non-struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8325539">,</span>&nbsp;<span class="ident" id="8325541">err</span><span class="op" id="8325544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8325550">//&nbsp;Now&nbsp;try&nbsp;the&nbsp;other&nbsp;way</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325576">var</span>&nbsp;<span class="ident" id="8325580">nsp</span>&nbsp;<span class="ident" id="8325584">NonStruct</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325595">if</span>&nbsp;<span class="ident" id="8325598">err</span>&nbsp;<span class="op" id="8325602">:=</span>&nbsp;<span class="ident" id="8325605">encAndDec</span><span class="op" id="8325614">(</span><span class="ident" id="8325615">ns</span><span class="op" id="8325617">,</span>&nbsp;<span class="op" id="8325619">&amp;</span><span class="ident" id="8325620">nsp</span><span class="op" id="8325623">)</span><span class="op" id="8325624">;</span>&nbsp;<span class="ident" id="8325626">err</span>&nbsp;<span class="op" id="8325630">!=</span>&nbsp;<span class="ident" id="8325633">nil</span>&nbsp;<span class="op" id="8325637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325641">t</span><span class="op" id="8325642">.</span><span class="ident" id="8325643">Error</span><span class="op" id="8325648">(</span><span class="ident" id="8325649">err</span><span class="op" id="8325652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325658">if</span>&nbsp;<span class="ident" id="8325661">err</span>&nbsp;<span class="op" id="8325665">:=</span>&nbsp;<span class="ident" id="8325668">encAndDec</span><span class="op" id="8325677">(</span><span class="ident" id="8325678">ns</span><span class="op" id="8325680">,</span>&nbsp;<span class="op" id="8325682">&amp;</span><span class="ident" id="8325683">s</span><span class="op" id="8325684">)</span><span class="op" id="8325685">;</span>&nbsp;<span class="ident" id="8325687">err</span>&nbsp;<span class="op" id="8325691">==</span>&nbsp;<span class="ident" id="8325694">nil</span>&nbsp;<span class="op" id="8325698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325702">t</span><span class="op" id="8325703">.</span><span class="ident" id="8325704">Error</span><span class="op" id="8325709">(</span><span class="string" id="8325710">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;non-struct/struct&#34;</span><span class="op" id="8325750">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325753">}</span>&nbsp;<span class="keyword" id="8325755">else</span>&nbsp;<span class="keyword" id="8325760">if</span>&nbsp;<span class="ident" id="8325763">strings</span><span class="op" id="8325770">.</span><span class="ident" id="8325771">Index</span><span class="op" id="8325776">(</span><span class="ident" id="8325777">err</span><span class="op" id="8325780">.</span><span class="ident" id="8325781">Error</span><span class="op" id="8325786">(</span><span class="op" id="8325787">)</span><span class="op" id="8325788">,</span>&nbsp;<span class="string" id="8325790">&#34;type&#34;</span><span class="op" id="8325796">)</span>&nbsp;<span class="op" id="8325798">&lt;</span>&nbsp;<span class="num" id="8325800">0</span>&nbsp;<span class="op" id="8325802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325806">t</span><span class="op" id="8325807">.</span><span class="ident" id="8325808">Error</span><span class="op" id="8325813">(</span><span class="string" id="8325814">&#34;for&nbsp;non-struct/struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8325862">,</span>&nbsp;<span class="ident" id="8325864">err</span><span class="op" id="8325867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325870">}</span><br>
<span class="lineno"></span><span class="op" id="8325872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="8325875">type</span>&nbsp;<span class="ident" id="8325880">interfaceIndirectTestI</span>&nbsp;<span class="keyword" id="8325903">interface</span>&nbsp;<span class="op" id="8325913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325916">F</span><span class="op" id="8325917">(</span><span class="op" id="8325918">)</span>&nbsp;<span class="builtintype" id="8325920">bool</span><br>
<span class="lineno"></span><span class="op" id="8325925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8325928">type</span>&nbsp;<span class="ident" id="8325933">interfaceIndirectTestT</span>&nbsp;<span class="keyword" id="8325956">struct</span><span class="op" id="8325962">{</span><span class="op" id="8325963">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="8325966">func</span>&nbsp;<span class="op" id="8325971">(</span><span class="ident" id="8325972">this</span>&nbsp;<span class="op" id="8325977">*</span><span class="ident" id="8325978">interfaceIndirectTestT</span><span class="op" id="8326000">)</span>&nbsp;<span class="ident" id="8326002">F</span><span class="op" id="8326003">(</span><span class="op" id="8326004">)</span>&nbsp;<span class="builtintype" id="8326006">bool</span>&nbsp;<span class="op" id="8326011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326014">return</span>&nbsp;<span class="builtintype" id="8326021">true</span><br>
<span class="lineno"></span><span class="op" id="8326026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="comment" id="8326029">//&nbsp;A&nbsp;version&nbsp;of&nbsp;a&nbsp;bug&nbsp;reported&nbsp;on&nbsp;golang-nuts.&nbsp;&nbsp;Also&nbsp;tests&nbsp;top-level</span><br>
<span class="lineno"></span><span class="comment" id="8326098">//&nbsp;slice&nbsp;of&nbsp;interfaces.&nbsp;&nbsp;The&nbsp;issue&nbsp;was&nbsp;registering&nbsp;*T&nbsp;caused&nbsp;T&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="8326167">//&nbsp;stored&nbsp;as&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="8326199">func</span>&nbsp;<span class="ident" id="8326204">TestInterfaceIndirect</span><span class="op" id="8326225">(</span><span class="ident" id="8326226">t</span>&nbsp;<span class="op" id="8326228">*</span><span class="ident" id="8326229">testing</span><span class="op" id="8326236">.</span><span class="ident" id="8326237">T</span><span class="op" id="8326238">)</span>&nbsp;<span class="op" id="8326240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326243">Register</span><span class="op" id="8326251">(</span><span class="op" id="8326252">&amp;</span><span class="ident" id="8326253">interfaceIndirectTestT</span><span class="op" id="8326275">{</span><span class="op" id="8326276">}</span><span class="op" id="8326277">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326280">b</span>&nbsp;<span class="op" id="8326282">:=</span>&nbsp;<span class="builtinfunc" id="8326285">new</span><span class="op" id="8326288">(</span><span class="ident" id="8326289">bytes</span><span class="op" id="8326294">.</span><span class="ident" id="8326295">Buffer</span><span class="op" id="8326301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326304">w</span>&nbsp;<span class="op" id="8326306">:=</span>&nbsp;<span class="op" id="8326309">[</span><span class="op" id="8326310">]</span><span class="ident" id="8326311">interfaceIndirectTestI</span><span class="op" id="8326333">{</span><span class="op" id="8326334">&amp;</span><span class="ident" id="8326335">interfaceIndirectTestT</span><span class="op" id="8326357">{</span><span class="op" id="8326358">}</span><span class="op" id="8326359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326362">err</span>&nbsp;<span class="op" id="8326366">:=</span>&nbsp;<span class="ident" id="8326369">NewEncoder</span><span class="op" id="8326379">(</span><span class="ident" id="8326380">b</span><span class="op" id="8326381">)</span><span class="op" id="8326382">.</span><span class="ident" id="8326383">Encode</span><span class="op" id="8326389">(</span><span class="ident" id="8326390">w</span><span class="op" id="8326391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326394">if</span>&nbsp;<span class="ident" id="8326397">err</span>&nbsp;<span class="op" id="8326401">!=</span>&nbsp;<span class="ident" id="8326404">nil</span>&nbsp;<span class="op" id="8326408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326412">t</span><span class="op" id="8326413">.</span><span class="ident" id="8326414">Fatal</span><span class="op" id="8326419">(</span><span class="string" id="8326420">&#34;encode&nbsp;error:&#34;</span><span class="op" id="8326435">,</span>&nbsp;<span class="ident" id="8326437">err</span><span class="op" id="8326440">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8326443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326447">var</span>&nbsp;<span class="ident" id="8326451">r</span>&nbsp;<span class="op" id="8326453">[</span><span class="op" id="8326454">]</span><span class="ident" id="8326455">interfaceIndirectTestI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326479">err</span>&nbsp;<span class="op" id="8326483">=</span>&nbsp;<span class="ident" id="8326485">NewDecoder</span><span class="op" id="8326495">(</span><span class="ident" id="8326496">b</span><span class="op" id="8326497">)</span><span class="op" id="8326498">.</span><span class="ident" id="8326499">Decode</span><span class="op" id="8326505">(</span><span class="op" id="8326506">&amp;</span><span class="ident" id="8326507">r</span><span class="op" id="8326508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326511">if</span>&nbsp;<span class="ident" id="8326514">err</span>&nbsp;<span class="op" id="8326518">!=</span>&nbsp;<span class="ident" id="8326521">nil</span>&nbsp;<span class="op" id="8326525">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326529">t</span><span class="op" id="8326530">.</span><span class="ident" id="8326531">Fatal</span><span class="op" id="8326536">(</span><span class="string" id="8326537">&#34;decode&nbsp;error:&#34;</span><span class="op" id="8326552">,</span>&nbsp;<span class="ident" id="8326554">err</span><span class="op" id="8326557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8326560">}</span><br>
<span class="lineno"></span><span class="op" id="8326562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8326565">//&nbsp;Now&nbsp;follow&nbsp;various&nbsp;tests&nbsp;that&nbsp;decode&nbsp;into&nbsp;things&nbsp;that&nbsp;can&#39;t&nbsp;represent&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="8326642">//&nbsp;encoded&nbsp;value,&nbsp;all&nbsp;of&nbsp;which&nbsp;should&nbsp;be&nbsp;legal.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8326691">//&nbsp;Also,&nbsp;when&nbsp;the&nbsp;ignored&nbsp;object&nbsp;contains&nbsp;an&nbsp;interface&nbsp;value,&nbsp;it&nbsp;may&nbsp;define</span><br>
<span class="lineno"></span><span class="comment" id="8326767">//&nbsp;types.&nbsp;Make&nbsp;sure&nbsp;that&nbsp;skipping&nbsp;the&nbsp;value&nbsp;still&nbsp;defines&nbsp;the&nbsp;types&nbsp;by&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="8326844">//&nbsp;the&nbsp;encoder/decoder&nbsp;pair&nbsp;to&nbsp;send&nbsp;a&nbsp;value&nbsp;afterwards.&nbsp;&nbsp;If&nbsp;an&nbsp;interface</span><br>
<span class="lineno">485</span><span class="comment" id="8326917">//&nbsp;is&nbsp;sent,&nbsp;its&nbsp;type&nbsp;in&nbsp;the&nbsp;test&nbsp;is&nbsp;always&nbsp;NewType0,&nbsp;so&nbsp;this&nbsp;checks&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8326994">//&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;don&#39;t&nbsp;skew&nbsp;with&nbsp;respect&nbsp;to&nbsp;type&nbsp;definitions.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8327063">type</span>&nbsp;<span class="ident" id="8327068">Struct0</span>&nbsp;<span class="keyword" id="8327076">struct</span>&nbsp;<span class="op" id="8327083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327086">I</span>&nbsp;<span class="keyword" id="8327088">interface</span><span class="op" id="8327097">{</span><span class="op" id="8327098">}</span><br>
<span class="lineno">490</span><span class="op" id="8327100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8327103">type</span>&nbsp;<span class="ident" id="8327108">NewType0</span>&nbsp;<span class="keyword" id="8327117">struct</span>&nbsp;<span class="op" id="8327124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327127">S</span>&nbsp;<span class="builtintype" id="8327129">string</span><br>
<span class="lineno"></span><span class="op" id="8327136">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="8327139">type</span>&nbsp;<span class="ident" id="8327144">ignoreTest</span>&nbsp;<span class="keyword" id="8327155">struct</span>&nbsp;<span class="op" id="8327162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327165">in</span><span class="op" id="8327167">,</span>&nbsp;<span class="ident" id="8327169">out</span>&nbsp;<span class="keyword" id="8327173">interface</span><span class="op" id="8327182">{</span><span class="op" id="8327183">}</span><br>
<span class="lineno"></span><span class="op" id="8327185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="8327188">var</span>&nbsp;<span class="ident" id="8327192">ignoreTests</span>&nbsp;<span class="op" id="8327204">=</span>&nbsp;<span class="op" id="8327206">[</span><span class="op" id="8327207">]</span><span class="ident" id="8327208">ignoreTest</span><span class="op" id="8327218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8327221">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;an&nbsp;empty&nbsp;struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8327267">{</span><span class="op" id="8327268">&amp;</span><span class="keyword" id="8327269">struct</span><span class="op" id="8327275">{</span>&nbsp;<span class="ident" id="8327277">A</span>&nbsp;<span class="builtintype" id="8327279">int</span>&nbsp;<span class="op" id="8327283">}</span><span class="op" id="8327284">{</span><span class="num" id="8327285">23</span><span class="op" id="8327287">}</span><span class="op" id="8327288">,</span>&nbsp;<span class="op" id="8327290">&amp;</span><span class="keyword" id="8327291">struct</span><span class="op" id="8327297">{</span><span class="op" id="8327298">}</span><span class="op" id="8327299">{</span><span class="op" id="8327300">}</span><span class="op" id="8327301">}</span><span class="op" id="8327302">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8327305">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8327342">{</span><span class="op" id="8327343">&amp;</span><span class="keyword" id="8327344">struct</span><span class="op" id="8327350">{</span>&nbsp;<span class="ident" id="8327352">A</span>&nbsp;<span class="builtintype" id="8327354">int</span>&nbsp;<span class="op" id="8327358">}</span><span class="op" id="8327359">{</span><span class="num" id="8327360">23</span><span class="op" id="8327362">}</span><span class="op" id="8327363">,</span>&nbsp;<span class="ident" id="8327365">nil</span><span class="op" id="8327368">}</span><span class="op" id="8327369">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8327372">//&nbsp;Decode&nbsp;singleton&nbsp;string&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8327412">{</span><span class="string" id="8327413">&#34;hello,&nbsp;world&#34;</span><span class="op" id="8327427">,</span>&nbsp;<span class="ident" id="8327429">nil</span><span class="op" id="8327432">}</span><span class="op" id="8327433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8327436">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8327475">{</span><span class="op" id="8327476">[</span><span class="op" id="8327477">]</span><span class="builtintype" id="8327478">int</span><span class="op" id="8327481">{</span><span class="num" id="8327482">1</span><span class="op" id="8327483">,</span>&nbsp;<span class="num" id="8327485">2</span><span class="op" id="8327486">,</span>&nbsp;<span class="num" id="8327488">3</span><span class="op" id="8327489">,</span>&nbsp;<span class="num" id="8327491">4</span><span class="op" id="8327492">}</span><span class="op" id="8327493">,</span>&nbsp;<span class="ident" id="8327495">nil</span><span class="op" id="8327498">}</span><span class="op" id="8327499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8327502">//&nbsp;Decode&nbsp;struct&nbsp;containing&nbsp;an&nbsp;interface&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8327556">{</span><span class="op" id="8327557">&amp;</span><span class="ident" id="8327558">Struct0</span><span class="op" id="8327565">{</span><span class="op" id="8327566">&amp;</span><span class="ident" id="8327567">NewType0</span><span class="op" id="8327575">{</span><span class="string" id="8327576">&#34;value0&#34;</span><span class="op" id="8327584">}</span><span class="op" id="8327585">}</span><span class="op" id="8327586">,</span>&nbsp;<span class="ident" id="8327588">nil</span><span class="op" id="8327591">}</span><span class="op" id="8327592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8327595">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;of&nbsp;interfaces&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8327648">{</span><span class="op" id="8327649">[</span><span class="op" id="8327650">]</span><span class="keyword" id="8327651">interface</span><span class="op" id="8327660">{</span><span class="op" id="8327661">}</span><span class="op" id="8327662">{</span><span class="string" id="8327663">&#34;hi&#34;</span><span class="op" id="8327667">,</span>&nbsp;<span class="op" id="8327669">&amp;</span><span class="ident" id="8327670">NewType0</span><span class="op" id="8327678">{</span><span class="string" id="8327679">&#34;value1&#34;</span><span class="op" id="8327687">}</span><span class="op" id="8327688">,</span>&nbsp;<span class="num" id="8327690">23</span><span class="op" id="8327692">}</span><span class="op" id="8327693">,</span>&nbsp;<span class="ident" id="8327695">nil</span><span class="op" id="8327698">}</span><span class="op" id="8327699">,</span><br>
<span class="lineno"></span><span class="op" id="8327701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="8327704">func</span>&nbsp;<span class="ident" id="8327709">TestDecodeIntoNothing</span><span class="op" id="8327730">(</span><span class="ident" id="8327731">t</span>&nbsp;<span class="op" id="8327733">*</span><span class="ident" id="8327734">testing</span><span class="op" id="8327741">.</span><span class="ident" id="8327742">T</span><span class="op" id="8327743">)</span>&nbsp;<span class="op" id="8327745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327748">Register</span><span class="op" id="8327756">(</span><span class="builtinfunc" id="8327757">new</span><span class="op" id="8327760">(</span><span class="ident" id="8327761">NewType0</span><span class="op" id="8327769">)</span><span class="op" id="8327770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8327773">for</span>&nbsp;<span class="ident" id="8327777">i</span><span class="op" id="8327778">,</span>&nbsp;<span class="ident" id="8327780">test</span>&nbsp;<span class="op" id="8327785">:=</span>&nbsp;<span class="keyword" id="8327788">range</span>&nbsp;<span class="ident" id="8327794">ignoreTests</span>&nbsp;<span class="op" id="8327806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327810">b</span>&nbsp;<span class="op" id="8327812">:=</span>&nbsp;<span class="builtinfunc" id="8327815">new</span><span class="op" id="8327818">(</span><span class="ident" id="8327819">bytes</span><span class="op" id="8327824">.</span><span class="ident" id="8327825">Buffer</span><span class="op" id="8327831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327835">enc</span>&nbsp;<span class="op" id="8327839">:=</span>&nbsp;<span class="ident" id="8327842">NewEncoder</span><span class="op" id="8327852">(</span><span class="ident" id="8327853">b</span><span class="op" id="8327854">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327858">err</span>&nbsp;<span class="op" id="8327862">:=</span>&nbsp;<span class="ident" id="8327865">enc</span><span class="op" id="8327868">.</span><span class="ident" id="8327869">Encode</span><span class="op" id="8327875">(</span><span class="ident" id="8327876">test</span><span class="op" id="8327880">.</span><span class="ident" id="8327881">in</span><span class="op" id="8327883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8327887">if</span>&nbsp;<span class="ident" id="8327890">err</span>&nbsp;<span class="op" id="8327894">!=</span>&nbsp;<span class="ident" id="8327897">nil</span>&nbsp;<span class="op" id="8327901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327906">t</span><span class="op" id="8327907">.</span><span class="ident" id="8327908">Errorf</span><span class="op" id="8327914">(</span><span class="string" id="8327915">&#34;%d:&nbsp;encode&nbsp;error&nbsp;%s:&#34;</span><span class="op" id="8327937">,</span>&nbsp;<span class="ident" id="8327939">i</span><span class="op" id="8327940">,</span>&nbsp;<span class="ident" id="8327942">err</span><span class="op" id="8327945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8327950">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8327961">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327965">dec</span>&nbsp;<span class="op" id="8327969">:=</span>&nbsp;<span class="ident" id="8327972">NewDecoder</span><span class="op" id="8327982">(</span><span class="ident" id="8327983">b</span><span class="op" id="8327984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327988">err</span>&nbsp;<span class="op" id="8327992">=</span>&nbsp;<span class="ident" id="8327994">dec</span><span class="op" id="8327997">.</span><span class="ident" id="8327998">Decode</span><span class="op" id="8328004">(</span><span class="ident" id="8328005">test</span><span class="op" id="8328009">.</span><span class="ident" id="8328010">out</span><span class="op" id="8328013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328017">if</span>&nbsp;<span class="ident" id="8328020">err</span>&nbsp;<span class="op" id="8328024">!=</span>&nbsp;<span class="ident" id="8328027">nil</span>&nbsp;<span class="op" id="8328031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328036">t</span><span class="op" id="8328037">.</span><span class="ident" id="8328038">Errorf</span><span class="op" id="8328044">(</span><span class="string" id="8328045">&#34;%d:&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8328067">,</span>&nbsp;<span class="ident" id="8328069">i</span><span class="op" id="8328070">,</span>&nbsp;<span class="ident" id="8328072">err</span><span class="op" id="8328075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328080">continue</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8328091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8328095">//&nbsp;Now&nbsp;see&nbsp;if&nbsp;the&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;are&nbsp;in&nbsp;a&nbsp;consistent&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328162">str</span>&nbsp;<span class="op" id="8328166">:=</span>&nbsp;<span class="ident" id="8328169">fmt</span><span class="op" id="8328172">.</span><span class="ident" id="8328173">Sprintf</span><span class="op" id="8328180">(</span><span class="string" id="8328181">&#34;Value&nbsp;%d&#34;</span><span class="op" id="8328191">,</span>&nbsp;<span class="ident" id="8328193">i</span><span class="op" id="8328194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328198">err</span>&nbsp;<span class="op" id="8328202">=</span>&nbsp;<span class="ident" id="8328204">enc</span><span class="op" id="8328207">.</span><span class="ident" id="8328208">Encode</span><span class="op" id="8328214">(</span><span class="op" id="8328215">&amp;</span><span class="ident" id="8328216">NewType0</span><span class="op" id="8328224">{</span><span class="ident" id="8328225">str</span><span class="op" id="8328228">}</span><span class="op" id="8328229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328233">if</span>&nbsp;<span class="ident" id="8328236">err</span>&nbsp;<span class="op" id="8328240">!=</span>&nbsp;<span class="ident" id="8328243">nil</span>&nbsp;<span class="op" id="8328247">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328252">t</span><span class="op" id="8328253">.</span><span class="ident" id="8328254">Fatalf</span><span class="op" id="8328260">(</span><span class="string" id="8328261">&#34;%d:&nbsp;NewType0&nbsp;encode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8328292">,</span>&nbsp;<span class="ident" id="8328294">i</span><span class="op" id="8328295">,</span>&nbsp;<span class="ident" id="8328297">err</span><span class="op" id="8328300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8328304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328308">ns</span>&nbsp;<span class="op" id="8328311">:=</span>&nbsp;<span class="builtinfunc" id="8328314">new</span><span class="op" id="8328317">(</span><span class="ident" id="8328318">NewType0</span><span class="op" id="8328326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328330">err</span>&nbsp;<span class="op" id="8328334">=</span>&nbsp;<span class="ident" id="8328336">dec</span><span class="op" id="8328339">.</span><span class="ident" id="8328340">Decode</span><span class="op" id="8328346">(</span><span class="ident" id="8328347">ns</span><span class="op" id="8328349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328353">if</span>&nbsp;<span class="ident" id="8328356">err</span>&nbsp;<span class="op" id="8328360">!=</span>&nbsp;<span class="ident" id="8328363">nil</span>&nbsp;<span class="op" id="8328367">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328372">t</span><span class="op" id="8328373">.</span><span class="ident" id="8328374">Fatalf</span><span class="op" id="8328380">(</span><span class="string" id="8328381">&#34;%d:&nbsp;NewType0&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8328412">,</span>&nbsp;<span class="ident" id="8328414">i</span><span class="op" id="8328415">,</span>&nbsp;<span class="ident" id="8328417">err</span><span class="op" id="8328420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8328424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328428">if</span>&nbsp;<span class="ident" id="8328431">ns</span><span class="op" id="8328433">.</span><span class="ident" id="8328434">S</span>&nbsp;<span class="op" id="8328436">!=</span>&nbsp;<span class="ident" id="8328439">str</span>&nbsp;<span class="op" id="8328443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328448">t</span><span class="op" id="8328449">.</span><span class="ident" id="8328450">Fatalf</span><span class="op" id="8328456">(</span><span class="string" id="8328457">&#34;%d:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8328481">,</span>&nbsp;<span class="ident" id="8328483">i</span><span class="op" id="8328484">,</span>&nbsp;<span class="ident" id="8328486">str</span><span class="op" id="8328489">,</span>&nbsp;<span class="ident" id="8328491">ns</span><span class="op" id="8328493">.</span><span class="ident" id="8328494">S</span><span class="op" id="8328495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8328499">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8328502">}</span><br>
<span class="lineno"></span><span class="op" id="8328504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8328507">//&nbsp;Another&nbsp;bug&nbsp;from&nbsp;golang-nuts,&nbsp;involving&nbsp;nested&nbsp;interfaces.</span><br>
<span class="lineno"></span><span class="keyword" id="8328569">type</span>&nbsp;<span class="ident" id="8328574">Bug0Outer</span>&nbsp;<span class="keyword" id="8328584">struct</span>&nbsp;<span class="op" id="8328591">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328594">Bug0Field</span>&nbsp;<span class="keyword" id="8328604">interface</span><span class="op" id="8328613">{</span><span class="op" id="8328614">}</span><br>
<span class="lineno"></span><span class="op" id="8328616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8328619">type</span>&nbsp;<span class="ident" id="8328624">Bug0Inner</span>&nbsp;<span class="keyword" id="8328634">struct</span>&nbsp;<span class="op" id="8328641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328644">A</span>&nbsp;<span class="builtintype" id="8328646">int</span><br>
<span class="lineno">555</span><span class="op" id="8328650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8328653">func</span>&nbsp;<span class="ident" id="8328658">TestNestedInterfaces</span><span class="op" id="8328678">(</span><span class="ident" id="8328679">t</span>&nbsp;<span class="op" id="8328681">*</span><span class="ident" id="8328682">testing</span><span class="op" id="8328689">.</span><span class="ident" id="8328690">T</span><span class="op" id="8328691">)</span>&nbsp;<span class="op" id="8328693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328696">var</span>&nbsp;<span class="ident" id="8328700">buf</span>&nbsp;<span class="ident" id="8328704">bytes</span><span class="op" id="8328709">.</span><span class="ident" id="8328710">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328718">e</span>&nbsp;<span class="op" id="8328720">:=</span>&nbsp;<span class="ident" id="8328723">NewEncoder</span><span class="op" id="8328733">(</span><span class="op" id="8328734">&amp;</span><span class="ident" id="8328735">buf</span><span class="op" id="8328738">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328741">d</span>&nbsp;<span class="op" id="8328743">:=</span>&nbsp;<span class="ident" id="8328746">NewDecoder</span><span class="op" id="8328756">(</span><span class="op" id="8328757">&amp;</span><span class="ident" id="8328758">buf</span><span class="op" id="8328761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328764">Register</span><span class="op" id="8328772">(</span><span class="builtinfunc" id="8328773">new</span><span class="op" id="8328776">(</span><span class="ident" id="8328777">Bug0Outer</span><span class="op" id="8328786">)</span><span class="op" id="8328787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328790">Register</span><span class="op" id="8328798">(</span><span class="builtinfunc" id="8328799">new</span><span class="op" id="8328802">(</span><span class="ident" id="8328803">Bug0Inner</span><span class="op" id="8328812">)</span><span class="op" id="8328813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328816">f</span>&nbsp;<span class="op" id="8328818">:=</span>&nbsp;<span class="op" id="8328821">&amp;</span><span class="ident" id="8328822">Bug0Outer</span><span class="op" id="8328831">{</span><span class="op" id="8328832">&amp;</span><span class="ident" id="8328833">Bug0Outer</span><span class="op" id="8328842">{</span><span class="op" id="8328843">&amp;</span><span class="ident" id="8328844">Bug0Inner</span><span class="op" id="8328853">{</span><span class="num" id="8328854">7</span><span class="op" id="8328855">}</span><span class="op" id="8328856">}</span><span class="op" id="8328857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328860">var</span>&nbsp;<span class="ident" id="8328864">v</span>&nbsp;<span class="keyword" id="8328866">interface</span><span class="op" id="8328875">{</span><span class="op" id="8328876">}</span>&nbsp;<span class="op" id="8328878">=</span>&nbsp;<span class="ident" id="8328880">f</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328883">err</span>&nbsp;<span class="op" id="8328887">:=</span>&nbsp;<span class="ident" id="8328890">e</span><span class="op" id="8328891">.</span><span class="ident" id="8328892">Encode</span><span class="op" id="8328898">(</span><span class="op" id="8328899">&amp;</span><span class="ident" id="8328900">v</span><span class="op" id="8328901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328904">if</span>&nbsp;<span class="ident" id="8328907">err</span>&nbsp;<span class="op" id="8328911">!=</span>&nbsp;<span class="ident" id="8328914">nil</span>&nbsp;<span class="op" id="8328918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328922">t</span><span class="op" id="8328923">.</span><span class="ident" id="8328924">Fatal</span><span class="op" id="8328929">(</span><span class="string" id="8328930">&#34;Encode:&#34;</span><span class="op" id="8328939">,</span>&nbsp;<span class="ident" id="8328941">err</span><span class="op" id="8328944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8328947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328950">err</span>&nbsp;<span class="op" id="8328954">=</span>&nbsp;<span class="ident" id="8328956">d</span><span class="op" id="8328957">.</span><span class="ident" id="8328958">Decode</span><span class="op" id="8328964">(</span><span class="op" id="8328965">&amp;</span><span class="ident" id="8328966">v</span><span class="op" id="8328967">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328970">if</span>&nbsp;<span class="ident" id="8328973">err</span>&nbsp;<span class="op" id="8328977">!=</span>&nbsp;<span class="ident" id="8328980">nil</span>&nbsp;<span class="op" id="8328984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328988">t</span><span class="op" id="8328989">.</span><span class="ident" id="8328990">Fatal</span><span class="op" id="8328995">(</span><span class="string" id="8328996">&#34;Decode:&#34;</span><span class="op" id="8329005">,</span>&nbsp;<span class="ident" id="8329007">err</span><span class="op" id="8329010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8329013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8329016">//&nbsp;Make&nbsp;sure&nbsp;it&nbsp;decoded&nbsp;correctly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329052">outer1</span><span class="op" id="8329058">,</span>&nbsp;<span class="ident" id="8329060">ok</span>&nbsp;<span class="op" id="8329063">:=</span>&nbsp;<span class="ident" id="8329066">v</span><span class="op" id="8329067">.</span><span class="op" id="8329068">(</span><span class="op" id="8329069">*</span><span class="ident" id="8329070">Bug0Outer</span><span class="op" id="8329079">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329082">if</span>&nbsp;<span class="op" id="8329085">!</span><span class="ident" id="8329086">ok</span>&nbsp;<span class="op" id="8329089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329093">t</span><span class="op" id="8329094">.</span><span class="ident" id="8329095">Fatalf</span><span class="op" id="8329101">(</span><span class="string" id="8329102">&#34;v&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="8329123">,</span>&nbsp;<span class="ident" id="8329125">v</span><span class="op" id="8329126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8329129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329132">outer2</span><span class="op" id="8329138">,</span>&nbsp;<span class="ident" id="8329140">ok</span>&nbsp;<span class="op" id="8329143">:=</span>&nbsp;<span class="ident" id="8329146">outer1</span><span class="op" id="8329152">.</span><span class="ident" id="8329153">Bug0Field</span><span class="op" id="8329162">.</span><span class="op" id="8329163">(</span><span class="op" id="8329164">*</span><span class="ident" id="8329165">Bug0Outer</span><span class="op" id="8329174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329177">if</span>&nbsp;<span class="op" id="8329180">!</span><span class="ident" id="8329181">ok</span>&nbsp;<span class="op" id="8329184">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329188">t</span><span class="op" id="8329189">.</span><span class="ident" id="8329190">Fatalf</span><span class="op" id="8329196">(</span><span class="string" id="8329197">&#34;v.Bug0Field&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="8329228">,</span>&nbsp;<span class="ident" id="8329230">outer1</span><span class="op" id="8329236">.</span><span class="ident" id="8329237">Bug0Field</span><span class="op" id="8329246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8329249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329252">inner</span><span class="op" id="8329257">,</span>&nbsp;<span class="ident" id="8329259">ok</span>&nbsp;<span class="op" id="8329262">:=</span>&nbsp;<span class="ident" id="8329265">outer2</span><span class="op" id="8329271">.</span><span class="ident" id="8329272">Bug0Field</span><span class="op" id="8329281">.</span><span class="op" id="8329282">(</span><span class="op" id="8329283">*</span><span class="ident" id="8329284">Bug0Inner</span><span class="op" id="8329293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329296">if</span>&nbsp;<span class="op" id="8329299">!</span><span class="ident" id="8329300">ok</span>&nbsp;<span class="op" id="8329303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329307">t</span><span class="op" id="8329308">.</span><span class="ident" id="8329309">Fatalf</span><span class="op" id="8329315">(</span><span class="string" id="8329316">&#34;v.Bug0Field.Bug0Field&nbsp;not&nbsp;Bug0Inner:&nbsp;%T&#34;</span><span class="op" id="8329357">,</span>&nbsp;<span class="ident" id="8329359">outer2</span><span class="op" id="8329365">.</span><span class="ident" id="8329366">Bug0Field</span><span class="op" id="8329375">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8329378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329381">if</span>&nbsp;<span class="ident" id="8329384">inner</span><span class="op" id="8329389">.</span><span class="ident" id="8329390">A</span>&nbsp;<span class="op" id="8329392">!=</span>&nbsp;<span class="num" id="8329395">7</span>&nbsp;<span class="op" id="8329397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329401">t</span><span class="op" id="8329402">.</span><span class="ident" id="8329403">Fatalf</span><span class="op" id="8329409">(</span><span class="string" id="8329410">&#34;final&nbsp;value&nbsp;%d;&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8329439">,</span>&nbsp;<span class="ident" id="8329441">inner</span><span class="op" id="8329446">.</span><span class="ident" id="8329447">A</span><span class="op" id="8329448">,</span>&nbsp;<span class="num" id="8329450">7</span><span class="op" id="8329451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8329454">}</span><br>
<span class="lineno"></span><span class="op" id="8329456">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="8329459">//&nbsp;The&nbsp;bugs&nbsp;keep&nbsp;coming.&nbsp;We&nbsp;forgot&nbsp;to&nbsp;send&nbsp;map&nbsp;subtypes&nbsp;before&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8329532">type</span>&nbsp;<span class="ident" id="8329537">Bug1Elem</span>&nbsp;<span class="keyword" id="8329546">struct</span>&nbsp;<span class="op" id="8329553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329556">Name</span>&nbsp;<span class="builtintype" id="8329561">string</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329569">Id</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8329574">int</span><br>
<span class="lineno"></span><span class="op" id="8329578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8329581">type</span>&nbsp;<span class="ident" id="8329586">Bug1StructMap</span>&nbsp;<span class="keyword" id="8329600">map</span><span class="op" id="8329603">[</span><span class="builtintype" id="8329604">string</span><span class="op" id="8329610">]</span><span class="ident" id="8329611">Bug1Elem</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="keyword" id="8329621">func</span>&nbsp;<span class="ident" id="8329626">bug1EncDec</span><span class="op" id="8329636">(</span><span class="ident" id="8329637">in</span>&nbsp;<span class="ident" id="8329640">Bug1StructMap</span><span class="op" id="8329653">,</span>&nbsp;<span class="ident" id="8329655">out</span>&nbsp;<span class="op" id="8329659">*</span><span class="ident" id="8329660">Bug1StructMap</span><span class="op" id="8329673">)</span>&nbsp;<span class="builtintype" id="8329675">error</span>&nbsp;<span class="op" id="8329681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329684">return</span>&nbsp;<span class="ident" id="8329691">nil</span><br>
<span class="lineno"></span><span class="op" id="8329695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8329698">func</span>&nbsp;<span class="ident" id="8329703">TestMapBug1</span><span class="op" id="8329714">(</span><span class="ident" id="8329715">t</span>&nbsp;<span class="op" id="8329717">*</span><span class="ident" id="8329718">testing</span><span class="op" id="8329725">.</span><span class="ident" id="8329726">T</span><span class="op" id="8329727">)</span>&nbsp;<span class="op" id="8329729">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329732">in</span>&nbsp;<span class="op" id="8329735">:=</span>&nbsp;<span class="builtinfunc" id="8329738">make</span><span class="op" id="8329742">(</span><span class="ident" id="8329743">Bug1StructMap</span><span class="op" id="8329756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329759">in</span><span class="op" id="8329761">[</span><span class="string" id="8329762">&#34;val1&#34;</span><span class="op" id="8329768">]</span>&nbsp;<span class="op" id="8329770">=</span>&nbsp;<span class="ident" id="8329772">Bug1Elem</span><span class="op" id="8329780">{</span><span class="string" id="8329781">&#34;elem1&#34;</span><span class="op" id="8329788">,</span>&nbsp;<span class="num" id="8329790">1</span><span class="op" id="8329791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329794">in</span><span class="op" id="8329796">[</span><span class="string" id="8329797">&#34;val2&#34;</span><span class="op" id="8329803">]</span>&nbsp;<span class="op" id="8329805">=</span>&nbsp;<span class="ident" id="8329807">Bug1Elem</span><span class="op" id="8329815">{</span><span class="string" id="8329816">&#34;elem2&#34;</span><span class="op" id="8329823">,</span>&nbsp;<span class="num" id="8329825">2</span><span class="op" id="8329826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329830">b</span>&nbsp;<span class="op" id="8329832">:=</span>&nbsp;<span class="builtinfunc" id="8329835">new</span><span class="op" id="8329838">(</span><span class="ident" id="8329839">bytes</span><span class="op" id="8329844">.</span><span class="ident" id="8329845">Buffer</span><span class="op" id="8329851">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329854">enc</span>&nbsp;<span class="op" id="8329858">:=</span>&nbsp;<span class="ident" id="8329861">NewEncoder</span><span class="op" id="8329871">(</span><span class="ident" id="8329872">b</span><span class="op" id="8329873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329876">err</span>&nbsp;<span class="op" id="8329880">:=</span>&nbsp;<span class="ident" id="8329883">enc</span><span class="op" id="8329886">.</span><span class="ident" id="8329887">Encode</span><span class="op" id="8329893">(</span><span class="ident" id="8329894">in</span><span class="op" id="8329896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329899">if</span>&nbsp;<span class="ident" id="8329902">err</span>&nbsp;<span class="op" id="8329906">!=</span>&nbsp;<span class="ident" id="8329909">nil</span>&nbsp;<span class="op" id="8329913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329917">t</span><span class="op" id="8329918">.</span><span class="ident" id="8329919">Fatal</span><span class="op" id="8329924">(</span><span class="string" id="8329925">&#34;encode:&#34;</span><span class="op" id="8329934">,</span>&nbsp;<span class="ident" id="8329936">err</span><span class="op" id="8329939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8329942">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329945">dec</span>&nbsp;<span class="op" id="8329949">:=</span>&nbsp;<span class="ident" id="8329952">NewDecoder</span><span class="op" id="8329962">(</span><span class="ident" id="8329963">b</span><span class="op" id="8329964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329967">out</span>&nbsp;<span class="op" id="8329971">:=</span>&nbsp;<span class="builtinfunc" id="8329974">make</span><span class="op" id="8329978">(</span><span class="ident" id="8329979">Bug1StructMap</span><span class="op" id="8329992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329995">err</span>&nbsp;<span class="op" id="8329999">=</span>&nbsp;<span class="ident" id="8330001">dec</span><span class="op" id="8330004">.</span><span class="ident" id="8330005">Decode</span><span class="op" id="8330011">(</span><span class="op" id="8330012">&amp;</span><span class="ident" id="8330013">out</span><span class="op" id="8330016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330019">if</span>&nbsp;<span class="ident" id="8330022">err</span>&nbsp;<span class="op" id="8330026">!=</span>&nbsp;<span class="ident" id="8330029">nil</span>&nbsp;<span class="op" id="8330033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330037">t</span><span class="op" id="8330038">.</span><span class="ident" id="8330039">Fatal</span><span class="op" id="8330044">(</span><span class="string" id="8330045">&#34;decode:&#34;</span><span class="op" id="8330054">,</span>&nbsp;<span class="ident" id="8330056">err</span><span class="op" id="8330059">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8330062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330065">if</span>&nbsp;<span class="op" id="8330068">!</span><span class="ident" id="8330069">reflect</span><span class="op" id="8330076">.</span><span class="ident" id="8330077">DeepEqual</span><span class="op" id="8330086">(</span><span class="ident" id="8330087">in</span><span class="op" id="8330089">,</span>&nbsp;<span class="ident" id="8330091">out</span><span class="op" id="8330094">)</span>&nbsp;<span class="op" id="8330096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330100">t</span><span class="op" id="8330101">.</span><span class="ident" id="8330102">Errorf</span><span class="op" id="8330108">(</span><span class="string" id="8330109">&#34;mismatch:&nbsp;%v&nbsp;%v&#34;</span><span class="op" id="8330126">,</span>&nbsp;<span class="ident" id="8330128">in</span><span class="op" id="8330130">,</span>&nbsp;<span class="ident" id="8330132">out</span><span class="op" id="8330135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8330138">}</span><br>
<span class="lineno"></span><span class="op" id="8330140">}</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span><span class="keyword" id="8330143">func</span>&nbsp;<span class="ident" id="8330148">TestGobMapInterfaceEncode</span><span class="op" id="8330173">(</span><span class="ident" id="8330174">t</span>&nbsp;<span class="op" id="8330176">*</span><span class="ident" id="8330177">testing</span><span class="op" id="8330184">.</span><span class="ident" id="8330185">T</span><span class="op" id="8330186">)</span>&nbsp;<span class="op" id="8330188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330191">m</span>&nbsp;<span class="op" id="8330193">:=</span>&nbsp;<span class="keyword" id="8330196">map</span><span class="op" id="8330199">[</span><span class="builtintype" id="8330200">string</span><span class="op" id="8330206">]</span><span class="keyword" id="8330207">interface</span><span class="op" id="8330216">{</span><span class="op" id="8330217">}</span><span class="op" id="8330218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330222">&#34;up&#34;</span><span class="op" id="8330226">:</span>&nbsp;<span class="builtintype" id="8330228">uintptr</span><span class="op" id="8330235">(</span><span class="num" id="8330236">0</span><span class="op" id="8330237">)</span><span class="op" id="8330238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330242">&#34;i0&#34;</span><span class="op" id="8330246">:</span>&nbsp;<span class="op" id="8330248">[</span><span class="op" id="8330249">]</span><span class="builtintype" id="8330250">int</span><span class="op" id="8330253">{</span><span class="op" id="8330254">-</span><span class="num" id="8330255">1</span><span class="op" id="8330256">}</span><span class="op" id="8330257">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330261">&#34;i1&#34;</span><span class="op" id="8330265">:</span>&nbsp;<span class="op" id="8330267">[</span><span class="op" id="8330268">]</span><span class="builtintype" id="8330269">int8</span><span class="op" id="8330273">{</span><span class="op" id="8330274">-</span><span class="num" id="8330275">1</span><span class="op" id="8330276">}</span><span class="op" id="8330277">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330281">&#34;i2&#34;</span><span class="op" id="8330285">:</span>&nbsp;<span class="op" id="8330287">[</span><span class="op" id="8330288">]</span><span class="builtintype" id="8330289">int16</span><span class="op" id="8330294">{</span><span class="op" id="8330295">-</span><span class="num" id="8330296">1</span><span class="op" id="8330297">}</span><span class="op" id="8330298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330302">&#34;i3&#34;</span><span class="op" id="8330306">:</span>&nbsp;<span class="op" id="8330308">[</span><span class="op" id="8330309">]</span><span class="builtintype" id="8330310">int32</span><span class="op" id="8330315">{</span><span class="op" id="8330316">-</span><span class="num" id="8330317">1</span><span class="op" id="8330318">}</span><span class="op" id="8330319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330323">&#34;i4&#34;</span><span class="op" id="8330327">:</span>&nbsp;<span class="op" id="8330329">[</span><span class="op" id="8330330">]</span><span class="ident" id="8330331">int64</span><span class="op" id="8330336">{</span><span class="op" id="8330337">-</span><span class="num" id="8330338">1</span><span class="op" id="8330339">}</span><span class="op" id="8330340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330344">&#34;u0&#34;</span><span class="op" id="8330348">:</span>&nbsp;<span class="op" id="8330350">[</span><span class="op" id="8330351">]</span><span class="builtintype" id="8330352">uint</span><span class="op" id="8330356">{</span><span class="num" id="8330357">1</span><span class="op" id="8330358">}</span><span class="op" id="8330359">,</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330363">&#34;u1&#34;</span><span class="op" id="8330367">:</span>&nbsp;<span class="op" id="8330369">[</span><span class="op" id="8330370">]</span><span class="builtintype" id="8330371">uint8</span><span class="op" id="8330376">{</span><span class="num" id="8330377">1</span><span class="op" id="8330378">}</span><span class="op" id="8330379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330383">&#34;u2&#34;</span><span class="op" id="8330387">:</span>&nbsp;<span class="op" id="8330389">[</span><span class="op" id="8330390">]</span><span class="builtintype" id="8330391">uint16</span><span class="op" id="8330397">{</span><span class="num" id="8330398">1</span><span class="op" id="8330399">}</span><span class="op" id="8330400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330404">&#34;u3&#34;</span><span class="op" id="8330408">:</span>&nbsp;<span class="op" id="8330410">[</span><span class="op" id="8330411">]</span><span class="builtintype" id="8330412">uint32</span><span class="op" id="8330418">{</span><span class="num" id="8330419">1</span><span class="op" id="8330420">}</span><span class="op" id="8330421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330425">&#34;u4&#34;</span><span class="op" id="8330429">:</span>&nbsp;<span class="op" id="8330431">[</span><span class="op" id="8330432">]</span><span class="ident" id="8330433">uint64</span><span class="op" id="8330439">{</span><span class="num" id="8330440">1</span><span class="op" id="8330441">}</span><span class="op" id="8330442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330446">&#34;f0&#34;</span><span class="op" id="8330450">:</span>&nbsp;<span class="op" id="8330452">[</span><span class="op" id="8330453">]</span><span class="builtintype" id="8330454">float32</span><span class="op" id="8330461">{</span><span class="num" id="8330462">1</span><span class="op" id="8330463">}</span><span class="op" id="8330464">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330468">&#34;f1&#34;</span><span class="op" id="8330472">:</span>&nbsp;<span class="op" id="8330474">[</span><span class="op" id="8330475">]</span><span class="builtintype" id="8330476">float64</span><span class="op" id="8330483">{</span><span class="num" id="8330484">1</span><span class="op" id="8330485">}</span><span class="op" id="8330486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330490">&#34;c0&#34;</span><span class="op" id="8330494">:</span>&nbsp;<span class="op" id="8330496">[</span><span class="op" id="8330497">]</span><span class="builtintype" id="8330498">complex64</span><span class="op" id="8330507">{</span><span class="builtinfunc" id="8330508">complex</span><span class="op" id="8330515">(</span><span class="num" id="8330516">2</span><span class="op" id="8330517">,</span>&nbsp;<span class="op" id="8330519">-</span><span class="num" id="8330520">2</span><span class="op" id="8330521">)</span><span class="op" id="8330522">}</span><span class="op" id="8330523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330527">&#34;c1&#34;</span><span class="op" id="8330531">:</span>&nbsp;<span class="op" id="8330533">[</span><span class="op" id="8330534">]</span><span class="builtintype" id="8330535">complex128</span><span class="op" id="8330545">{</span><span class="builtinfunc" id="8330546">complex</span><span class="op" id="8330553">(</span><span class="num" id="8330554">2</span><span class="op" id="8330555">,</span>&nbsp;<span class="builtintype" id="8330557">float64</span><span class="op" id="8330564">(</span><span class="op" id="8330565">-</span><span class="num" id="8330566">2</span><span class="op" id="8330567">)</span><span class="op" id="8330568">)</span><span class="op" id="8330569">}</span><span class="op" id="8330570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330574">&#34;us&#34;</span><span class="op" id="8330578">:</span>&nbsp;<span class="op" id="8330580">[</span><span class="op" id="8330581">]</span><span class="builtintype" id="8330582">uintptr</span><span class="op" id="8330589">{</span><span class="num" id="8330590">0</span><span class="op" id="8330591">}</span><span class="op" id="8330592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330596">&#34;bo&#34;</span><span class="op" id="8330600">:</span>&nbsp;<span class="op" id="8330602">[</span><span class="op" id="8330603">]</span><span class="builtintype" id="8330604">bool</span><span class="op" id="8330608">{</span><span class="builtintype" id="8330609">false</span><span class="op" id="8330614">}</span><span class="op" id="8330615">,</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8330619">&#34;st&#34;</span><span class="op" id="8330623">:</span>&nbsp;<span class="op" id="8330625">[</span><span class="op" id="8330626">]</span><span class="builtintype" id="8330627">string</span><span class="op" id="8330633">{</span><span class="string" id="8330634">&#34;s&#34;</span><span class="op" id="8330637">}</span><span class="op" id="8330638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8330641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330644">enc</span>&nbsp;<span class="op" id="8330648">:=</span>&nbsp;<span class="ident" id="8330651">NewEncoder</span><span class="op" id="8330661">(</span><span class="builtinfunc" id="8330662">new</span><span class="op" id="8330665">(</span><span class="ident" id="8330666">bytes</span><span class="op" id="8330671">.</span><span class="ident" id="8330672">Buffer</span><span class="op" id="8330678">)</span><span class="op" id="8330679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330682">err</span>&nbsp;<span class="op" id="8330686">:=</span>&nbsp;<span class="ident" id="8330689">enc</span><span class="op" id="8330692">.</span><span class="ident" id="8330693">Encode</span><span class="op" id="8330699">(</span><span class="ident" id="8330700">m</span><span class="op" id="8330701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330704">if</span>&nbsp;<span class="ident" id="8330707">err</span>&nbsp;<span class="op" id="8330711">!=</span>&nbsp;<span class="ident" id="8330714">nil</span>&nbsp;<span class="op" id="8330718">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330722">t</span><span class="op" id="8330723">.</span><span class="ident" id="8330724">Errorf</span><span class="op" id="8330730">(</span><span class="string" id="8330731">&#34;encode&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="8330747">,</span>&nbsp;<span class="ident" id="8330749">err</span><span class="op" id="8330752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8330755">}</span><br>
<span class="lineno"></span><span class="op" id="8330757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8330760">func</span>&nbsp;<span class="ident" id="8330765">TestSliceReusesMemory</span><span class="op" id="8330786">(</span><span class="ident" id="8330787">t</span>&nbsp;<span class="op" id="8330789">*</span><span class="ident" id="8330790">testing</span><span class="op" id="8330797">.</span><span class="ident" id="8330798">T</span><span class="op" id="8330799">)</span>&nbsp;<span class="op" id="8330801">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330804">buf</span>&nbsp;<span class="op" id="8330808">:=</span>&nbsp;<span class="builtinfunc" id="8330811">new</span><span class="op" id="8330814">(</span><span class="ident" id="8330815">bytes</span><span class="op" id="8330820">.</span><span class="ident" id="8330821">Buffer</span><span class="op" id="8330827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8330830">//&nbsp;Bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8330840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330844">x</span>&nbsp;<span class="op" id="8330846">:=</span>&nbsp;<span class="op" id="8330849">[</span><span class="op" id="8330850">]</span><span class="builtintype" id="8330851">byte</span><span class="op" id="8330855">(</span><span class="string" id="8330856">&#34;abcd&#34;</span><span class="op" id="8330862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330866">enc</span>&nbsp;<span class="op" id="8330870">:=</span>&nbsp;<span class="ident" id="8330873">NewEncoder</span><span class="op" id="8330883">(</span><span class="ident" id="8330884">buf</span><span class="op" id="8330887">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330891">err</span>&nbsp;<span class="op" id="8330895">:=</span>&nbsp;<span class="ident" id="8330898">enc</span><span class="op" id="8330901">.</span><span class="ident" id="8330902">Encode</span><span class="op" id="8330908">(</span><span class="ident" id="8330909">x</span><span class="op" id="8330910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330914">if</span>&nbsp;<span class="ident" id="8330917">err</span>&nbsp;<span class="op" id="8330921">!=</span>&nbsp;<span class="ident" id="8330924">nil</span>&nbsp;<span class="op" id="8330928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330933">t</span><span class="op" id="8330934">.</span><span class="ident" id="8330935">Errorf</span><span class="op" id="8330941">(</span><span class="string" id="8330942">&#34;bytes:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="8330961">,</span>&nbsp;<span class="ident" id="8330963">err</span><span class="op" id="8330966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8330970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8330974">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331015">y</span>&nbsp;<span class="op" id="8331017">:=</span>&nbsp;<span class="op" id="8331020">[</span><span class="op" id="8331021">]</span><span class="builtintype" id="8331022">byte</span><span class="op" id="8331026">(</span><span class="string" id="8331027">&#34;ABCDE&#34;</span><span class="op" id="8331034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331038">addr</span>&nbsp;<span class="op" id="8331043">:=</span>&nbsp;<span class="op" id="8331046">&amp;</span><span class="ident" id="8331047">y</span><span class="op" id="8331048">[</span><span class="num" id="8331049">0</span><span class="op" id="8331050">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331054">dec</span>&nbsp;<span class="op" id="8331058">:=</span>&nbsp;<span class="ident" id="8331061">NewDecoder</span><span class="op" id="8331071">(</span><span class="ident" id="8331072">buf</span><span class="op" id="8331075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331079">err</span>&nbsp;<span class="op" id="8331083">=</span>&nbsp;<span class="ident" id="8331085">dec</span><span class="op" id="8331088">.</span><span class="ident" id="8331089">Decode</span><span class="op" id="8331095">(</span><span class="op" id="8331096">&amp;</span><span class="ident" id="8331097">y</span><span class="op" id="8331098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8331102">if</span>&nbsp;<span class="ident" id="8331105">err</span>&nbsp;<span class="op" id="8331109">!=</span>&nbsp;<span class="ident" id="8331112">nil</span>&nbsp;<span class="op" id="8331116">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331121">t</span><span class="op" id="8331122">.</span><span class="ident" id="8331123">Fatal</span><span class="op" id="8331128">(</span><span class="string" id="8331129">&#34;bytes:&nbsp;decode:&#34;</span><span class="op" id="8331145">,</span>&nbsp;<span class="ident" id="8331147">err</span><span class="op" id="8331150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8331154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8331158">if</span>&nbsp;<span class="op" id="8331161">!</span><span class="ident" id="8331162">bytes</span><span class="op" id="8331167">.</span><span class="ident" id="8331168">Equal</span><span class="op" id="8331173">(</span><span class="ident" id="8331174">x</span><span class="op" id="8331175">,</span>&nbsp;<span class="ident" id="8331177">y</span><span class="op" id="8331178">)</span>&nbsp;<span class="op" id="8331180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331185">t</span><span class="op" id="8331186">.</span><span class="ident" id="8331187">Errorf</span><span class="op" id="8331193">(</span><span class="string" id="8331194">&#34;bytes:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="8331223">,</span>&nbsp;<span class="ident" id="8331225">x</span><span class="op" id="8331226">,</span>&nbsp;<span class="ident" id="8331228">y</span><span class="op" id="8331229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8331233">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8331237">if</span>&nbsp;<span class="ident" id="8331240">addr</span>&nbsp;<span class="op" id="8331245">!=</span>&nbsp;<span class="op" id="8331248">&amp;</span><span class="ident" id="8331249">y</span><span class="op" id="8331250">[</span><span class="num" id="8331251">0</span><span class="op" id="8331252">]</span>&nbsp;<span class="op" id="8331254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331259">t</span><span class="op" id="8331260">.</span><span class="ident" id="8331261">Errorf</span><span class="op" id="8331267">(</span><span class="string" id="8331268">&#34;bytes:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="8331301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8331305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8331308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8331311">//&nbsp;general&nbsp;slice</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8331329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331333">x</span>&nbsp;<span class="op" id="8331335">:=</span>&nbsp;<span class="op" id="8331338">[</span><span class="op" id="8331339">]</span><span class="builtintype" id="8331340">rune</span><span class="op" id="8331344">(</span><span class="string" id="8331345">&#34;abcd&#34;</span><span class="op" id="8331351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331355">enc</span>&nbsp;<span class="op" id="8331359">:=</span>&nbsp;<span class="ident" id="8331362">NewEncoder</span><span class="op" id="8331372">(</span><span class="ident" id="8331373">buf</span><span class="op" id="8331376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331380">err</span>&nbsp;<span class="op" id="8331384">:=</span>&nbsp;<span class="ident" id="8331387">enc</span><span class="op" id="8331390">.</span><span class="ident" id="8331391">Encode</span><span class="op" id="8331397">(</span><span class="ident" id="8331398">x</span><span class="op" id="8331399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8331403">if</span>&nbsp;<span class="ident" id="8331406">err</span>&nbsp;<span class="op" id="8331410">!=</span>&nbsp;<span class="ident" id="8331413">nil</span>&nbsp;<span class="op" id="8331417">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331422">t</span><span class="op" id="8331423">.</span><span class="ident" id="8331424">Errorf</span><span class="op" id="8331430">(</span><span class="string" id="8331431">&#34;ints:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="8331449">,</span>&nbsp;<span class="ident" id="8331451">err</span><span class="op" id="8331454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8331458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8331462">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331503">y</span>&nbsp;<span class="op" id="8331505">:=</span>&nbsp;<span class="op" id="8331508">[</span><span class="op" id="8331509">]</span><span class="builtintype" id="8331510">rune</span><span class="op" id="8331514">(</span><span class="string" id="8331515">&#34;ABCDE&#34;</span><span class="op" id="8331522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331526">addr</span>&nbsp;<span class="op" id="8331531">:=</span>&nbsp;<span class="op" id="8331534">&amp;</span><span class="ident" id="8331535">y</span><span class="op" id="8331536">[</span><span class="num" id="8331537">0</span><span class="op" id="8331538">]</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331542">dec</span>&nbsp;<span class="op" id="8331546">:=</span>&nbsp;<span class="ident" id="8331549">NewDecoder</span><span class="op" id="8331559">(</span><span class="ident" id="8331560">buf</span><span class="op" id="8331563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331567">err</span>&nbsp;<span class="op" id="8331571">=</span>&nbsp;<span class="ident" id="8331573">dec</span><span class="op" id="8331576">.</span><span class="ident" id="8331577">Decode</span><span class="op" id="8331583">(</span><span class="op" id="8331584">&amp;</span><span class="ident" id="8331585">y</span><span class="op" id="8331586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8331590">if</span>&nbsp;<span class="ident" id="8331593">err</span>&nbsp;<span class="op" id="8331597">!=</span>&nbsp;<span class="ident" id="8331600">nil</span>&nbsp;<span class="op" id="8331604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331609">t</span><span class="op" id="8331610">.</span><span class="ident" id="8331611">Fatal</span><span class="op" id="8331616">(</span><span class="string" id="8331617">&#34;ints:&nbsp;decode:&#34;</span><span class="op" id="8331632">,</span>&nbsp;<span class="ident" id="8331634">err</span><span class="op" id="8331637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8331641">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8331645">if</span>&nbsp;<span class="op" id="8331648">!</span><span class="ident" id="8331649">reflect</span><span class="op" id="8331656">.</span><span class="ident" id="8331657">DeepEqual</span><span class="op" id="8331666">(</span><span class="ident" id="8331667">x</span><span class="op" id="8331668">,</span>&nbsp;<span class="ident" id="8331670">y</span><span class="op" id="8331671">)</span>&nbsp;<span class="op" id="8331673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331678">t</span><span class="op" id="8331679">.</span><span class="ident" id="8331680">Errorf</span><span class="op" id="8331686">(</span><span class="string" id="8331687">&#34;ints:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="8331715">,</span>&nbsp;<span class="ident" id="8331717">x</span><span class="op" id="8331718">,</span>&nbsp;<span class="ident" id="8331720">y</span><span class="op" id="8331721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8331725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8331729">if</span>&nbsp;<span class="ident" id="8331732">addr</span>&nbsp;<span class="op" id="8331737">!=</span>&nbsp;<span class="op" id="8331740">&amp;</span><span class="ident" id="8331741">y</span><span class="op" id="8331742">[</span><span class="num" id="8331743">0</span><span class="op" id="8331744">]</span>&nbsp;<span class="op" id="8331746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331751">t</span><span class="op" id="8331752">.</span><span class="ident" id="8331753">Errorf</span><span class="op" id="8331759">(</span><span class="string" id="8331760">&#34;ints:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="8331792">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8331796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8331799">}</span><br>
<span class="lineno"></span><span class="op" id="8331801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8331804">//&nbsp;Used&nbsp;to&nbsp;crash:&nbsp;negative&nbsp;count&nbsp;in&nbsp;recvMessage.</span><br>
<span class="lineno">705</span><span class="keyword" id="8331853">func</span>&nbsp;<span class="ident" id="8331858">TestBadCount</span><span class="op" id="8331870">(</span><span class="ident" id="8331871">t</span>&nbsp;<span class="op" id="8331873">*</span><span class="ident" id="8331874">testing</span><span class="op" id="8331881">.</span><span class="ident" id="8331882">T</span><span class="op" id="8331883">)</span>&nbsp;<span class="op" id="8331885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331888">b</span>&nbsp;<span class="op" id="8331890">:=</span>&nbsp;<span class="op" id="8331893">[</span><span class="op" id="8331894">]</span><span class="builtintype" id="8331895">byte</span><span class="op" id="8331899">{</span><span class="num" id="8331900">0xfb</span><span class="op" id="8331904">,</span>&nbsp;<span class="num" id="8331906">0xa5</span><span class="op" id="8331910">,</span>&nbsp;<span class="num" id="8331912">0x82</span><span class="op" id="8331916">,</span>&nbsp;<span class="num" id="8331918">0x2f</span><span class="op" id="8331922">,</span>&nbsp;<span class="num" id="8331924">0xca</span><span class="op" id="8331928">,</span>&nbsp;<span class="num" id="8331930">0x1</span><span class="op" id="8331933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8331936">if</span>&nbsp;<span class="ident" id="8331939">err</span>&nbsp;<span class="op" id="8331943">:=</span>&nbsp;<span class="ident" id="8331946">NewDecoder</span><span class="op" id="8331956">(</span><span class="ident" id="8331957">bytes</span><span class="op" id="8331962">.</span><span class="ident" id="8331963">NewReader</span><span class="op" id="8331972">(</span><span class="ident" id="8331973">b</span><span class="op" id="8331974">)</span><span class="op" id="8331975">)</span><span class="op" id="8331976">.</span><span class="ident" id="8331977">Decode</span><span class="op" id="8331983">(</span><span class="ident" id="8331984">nil</span><span class="op" id="8331987">)</span><span class="op" id="8331988">;</span>&nbsp;<span class="ident" id="8331990">err</span>&nbsp;<span class="op" id="8331994">==</span>&nbsp;<span class="ident" id="8331997">nil</span>&nbsp;<span class="op" id="8332001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332005">t</span><span class="op" id="8332006">.</span><span class="ident" id="8332007">Error</span><span class="op" id="8332012">(</span><span class="string" id="8332013">&#34;expected&nbsp;error&nbsp;from&nbsp;bad&nbsp;count&#34;</span><span class="op" id="8332044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8332047">}</span>&nbsp;<span class="keyword" id="8332049">else</span>&nbsp;<span class="keyword" id="8332054">if</span>&nbsp;<span class="ident" id="8332057">err</span><span class="op" id="8332060">.</span><span class="ident" id="8332061">Error</span><span class="op" id="8332066">(</span><span class="op" id="8332067">)</span>&nbsp;<span class="op" id="8332069">!=</span>&nbsp;<span class="ident" id="8332072">errBadCount</span><span class="op" id="8332083">.</span><span class="ident" id="8332084">Error</span><span class="op" id="8332089">(</span><span class="op" id="8332090">)</span>&nbsp;<span class="op" id="8332092">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332096">t</span><span class="op" id="8332097">.</span><span class="ident" id="8332098">Error</span><span class="op" id="8332103">(</span><span class="string" id="8332104">&#34;expected&nbsp;bad&nbsp;count&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8332135">,</span>&nbsp;<span class="ident" id="8332137">err</span><span class="op" id="8332140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8332143">}</span><br>
<span class="lineno"></span><span class="op" id="8332145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8332148">//&nbsp;Verify&nbsp;that&nbsp;sequential&nbsp;Decoders&nbsp;built&nbsp;on&nbsp;a&nbsp;single&nbsp;input&nbsp;will</span><br>
<span class="lineno">715</span><span class="comment" id="8332212">//&nbsp;succeed&nbsp;if&nbsp;the&nbsp;input&nbsp;implements&nbsp;ReadByte&nbsp;and&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="8332272">//&nbsp;type&nbsp;information&nbsp;in&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="8332307">func</span>&nbsp;<span class="ident" id="8332312">TestSequentialDecoder</span><span class="op" id="8332333">(</span><span class="ident" id="8332334">t</span>&nbsp;<span class="op" id="8332336">*</span><span class="ident" id="8332337">testing</span><span class="op" id="8332344">.</span><span class="ident" id="8332345">T</span><span class="op" id="8332346">)</span>&nbsp;<span class="op" id="8332348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332351">b</span>&nbsp;<span class="op" id="8332353">:=</span>&nbsp;<span class="builtinfunc" id="8332356">new</span><span class="op" id="8332359">(</span><span class="ident" id="8332360">bytes</span><span class="op" id="8332365">.</span><span class="ident" id="8332366">Buffer</span><span class="op" id="8332372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332375">enc</span>&nbsp;<span class="op" id="8332379">:=</span>&nbsp;<span class="ident" id="8332382">NewEncoder</span><span class="op" id="8332392">(</span><span class="ident" id="8332393">b</span><span class="op" id="8332394">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332397">const</span>&nbsp;<span class="ident" id="8332403">count</span>&nbsp;<span class="op" id="8332409">=</span>&nbsp;<span class="num" id="8332411">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332415">for</span>&nbsp;<span class="ident" id="8332419">i</span>&nbsp;<span class="op" id="8332421">:=</span>&nbsp;<span class="num" id="8332424">0</span><span class="op" id="8332425">;</span>&nbsp;<span class="ident" id="8332427">i</span>&nbsp;<span class="op" id="8332429">&lt;</span>&nbsp;<span class="ident" id="8332431">count</span><span class="op" id="8332436">;</span>&nbsp;<span class="ident" id="8332438">i</span><span class="op" id="8332439">++</span>&nbsp;<span class="op" id="8332442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332446">s</span>&nbsp;<span class="op" id="8332448">:=</span>&nbsp;<span class="ident" id="8332451">fmt</span><span class="op" id="8332454">.</span><span class="ident" id="8332455">Sprintf</span><span class="op" id="8332462">(</span><span class="string" id="8332463">&#34;%d&#34;</span><span class="op" id="8332467">,</span>&nbsp;<span class="ident" id="8332469">i</span><span class="op" id="8332470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332474">if</span>&nbsp;<span class="ident" id="8332477">err</span>&nbsp;<span class="op" id="8332481">:=</span>&nbsp;<span class="ident" id="8332484">enc</span><span class="op" id="8332487">.</span><span class="ident" id="8332488">Encode</span><span class="op" id="8332494">(</span><span class="ident" id="8332495">s</span><span class="op" id="8332496">)</span><span class="op" id="8332497">;</span>&nbsp;<span class="ident" id="8332499">err</span>&nbsp;<span class="op" id="8332503">!=</span>&nbsp;<span class="ident" id="8332506">nil</span>&nbsp;<span class="op" id="8332510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332515">t</span><span class="op" id="8332516">.</span><span class="ident" id="8332517">Error</span><span class="op" id="8332522">(</span><span class="string" id="8332523">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8332538">,</span>&nbsp;<span class="ident" id="8332540">err</span><span class="op" id="8332543">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8332547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8332550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332553">for</span>&nbsp;<span class="ident" id="8332557">i</span>&nbsp;<span class="op" id="8332559">:=</span>&nbsp;<span class="num" id="8332562">0</span><span class="op" id="8332563">;</span>&nbsp;<span class="ident" id="8332565">i</span>&nbsp;<span class="op" id="8332567">&lt;</span>&nbsp;<span class="ident" id="8332569">count</span><span class="op" id="8332574">;</span>&nbsp;<span class="ident" id="8332576">i</span><span class="op" id="8332577">++</span>&nbsp;<span class="op" id="8332580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332584">dec</span>&nbsp;<span class="op" id="8332588">:=</span>&nbsp;<span class="ident" id="8332591">NewDecoder</span><span class="op" id="8332601">(</span><span class="ident" id="8332602">b</span><span class="op" id="8332603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332607">var</span>&nbsp;<span class="ident" id="8332611">s</span>&nbsp;<span class="builtintype" id="8332613">string</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332622">if</span>&nbsp;<span class="ident" id="8332625">err</span>&nbsp;<span class="op" id="8332629">:=</span>&nbsp;<span class="ident" id="8332632">dec</span><span class="op" id="8332635">.</span><span class="ident" id="8332636">Decode</span><span class="op" id="8332642">(</span><span class="op" id="8332643">&amp;</span><span class="ident" id="8332644">s</span><span class="op" id="8332645">)</span><span class="op" id="8332646">;</span>&nbsp;<span class="ident" id="8332648">err</span>&nbsp;<span class="op" id="8332652">!=</span>&nbsp;<span class="ident" id="8332655">nil</span>&nbsp;<span class="op" id="8332659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332664">t</span><span class="op" id="8332665">.</span><span class="ident" id="8332666">Fatal</span><span class="op" id="8332671">(</span><span class="string" id="8332672">&#34;decoder&nbsp;fail:&#34;</span><span class="op" id="8332687">,</span>&nbsp;<span class="ident" id="8332689">err</span><span class="op" id="8332692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8332696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332700">if</span>&nbsp;<span class="ident" id="8332703">s</span>&nbsp;<span class="op" id="8332705">!=</span>&nbsp;<span class="ident" id="8332708">fmt</span><span class="op" id="8332711">.</span><span class="ident" id="8332712">Sprintf</span><span class="op" id="8332719">(</span><span class="string" id="8332720">&#34;%d&#34;</span><span class="op" id="8332724">,</span>&nbsp;<span class="ident" id="8332726">i</span><span class="op" id="8332727">)</span>&nbsp;<span class="op" id="8332729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332734">t</span><span class="op" id="8332735">.</span><span class="ident" id="8332736">Fatalf</span><span class="op" id="8332742">(</span><span class="string" id="8332743">&#34;decode&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8332770">,</span>&nbsp;<span class="ident" id="8332772">i</span><span class="op" id="8332773">,</span>&nbsp;<span class="ident" id="8332775">s</span><span class="op" id="8332776">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8332780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8332783">}</span><br>
<span class="lineno"></span><span class="op" id="8332785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8332788">//&nbsp;Should&nbsp;be&nbsp;able&nbsp;to&nbsp;have&nbsp;unrepresentable&nbsp;fields&nbsp;(chan,&nbsp;func,&nbsp;*chan&nbsp;etc.);&nbsp;we&nbsp;just&nbsp;ignore&nbsp;them.</span><br>
<span class="lineno">740</span><span class="keyword" id="8332884">type</span>&nbsp;<span class="ident" id="8332889">Bug2</span>&nbsp;<span class="keyword" id="8332894">struct</span>&nbsp;<span class="op" id="8332901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332904">A</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8332908">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332913">C</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="8332917">chan</span>&nbsp;<span class="builtintype" id="8332922">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332927">CP</span>&nbsp;&nbsp;<span class="op" id="8332931">*</span><span class="keyword" id="8332932">chan</span>&nbsp;<span class="builtintype" id="8332937">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332942">F</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="8332946">func</span><span class="op" id="8332950">(</span><span class="op" id="8332951">)</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332954">FPP</span>&nbsp;<span class="op" id="8332958">*</span><span class="op" id="8332959">*</span><span class="keyword" id="8332960">func</span><span class="op" id="8332964">(</span><span class="op" id="8332965">)</span><br>
<span class="lineno"></span><span class="op" id="8332967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8332970">func</span>&nbsp;<span class="ident" id="8332975">TestChanFuncIgnored</span><span class="op" id="8332994">(</span><span class="ident" id="8332995">t</span>&nbsp;<span class="op" id="8332997">*</span><span class="ident" id="8332998">testing</span><span class="op" id="8333005">.</span><span class="ident" id="8333006">T</span><span class="op" id="8333007">)</span>&nbsp;<span class="op" id="8333009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333012">c</span>&nbsp;<span class="op" id="8333014">:=</span>&nbsp;<span class="builtinfunc" id="8333017">make</span><span class="op" id="8333021">(</span><span class="keyword" id="8333022">chan</span>&nbsp;<span class="builtintype" id="8333027">int</span><span class="op" id="8333030">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333033">f</span>&nbsp;<span class="op" id="8333035">:=</span>&nbsp;<span class="keyword" id="8333038">func</span><span class="op" id="8333042">(</span><span class="op" id="8333043">)</span>&nbsp;<span class="op" id="8333045">{</span><span class="op" id="8333046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333049">fp</span>&nbsp;<span class="op" id="8333052">:=</span>&nbsp;<span class="op" id="8333055">&amp;</span><span class="ident" id="8333056">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333059">b0</span>&nbsp;<span class="op" id="8333062">:=</span>&nbsp;<span class="ident" id="8333065">Bug2</span><span class="op" id="8333069">{</span><span class="num" id="8333070">23</span><span class="op" id="8333072">,</span>&nbsp;<span class="ident" id="8333074">c</span><span class="op" id="8333075">,</span>&nbsp;<span class="op" id="8333077">&amp;</span><span class="ident" id="8333078">c</span><span class="op" id="8333079">,</span>&nbsp;<span class="ident" id="8333081">f</span><span class="op" id="8333082">,</span>&nbsp;<span class="op" id="8333084">&amp;</span><span class="ident" id="8333085">fp</span><span class="op" id="8333087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333090">var</span>&nbsp;<span class="ident" id="8333094">buf</span>&nbsp;<span class="ident" id="8333098">bytes</span><span class="op" id="8333103">.</span><span class="ident" id="8333104">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333112">enc</span>&nbsp;<span class="op" id="8333116">:=</span>&nbsp;<span class="ident" id="8333119">NewEncoder</span><span class="op" id="8333129">(</span><span class="op" id="8333130">&amp;</span><span class="ident" id="8333131">buf</span><span class="op" id="8333134">)</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333137">if</span>&nbsp;<span class="ident" id="8333140">err</span>&nbsp;<span class="op" id="8333144">:=</span>&nbsp;<span class="ident" id="8333147">enc</span><span class="op" id="8333150">.</span><span class="ident" id="8333151">Encode</span><span class="op" id="8333157">(</span><span class="ident" id="8333158">b0</span><span class="op" id="8333160">)</span><span class="op" id="8333161">;</span>&nbsp;<span class="ident" id="8333163">err</span>&nbsp;<span class="op" id="8333167">!=</span>&nbsp;<span class="ident" id="8333170">nil</span>&nbsp;<span class="op" id="8333174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333178">t</span><span class="op" id="8333179">.</span><span class="ident" id="8333180">Fatal</span><span class="op" id="8333185">(</span><span class="string" id="8333186">&#34;error&nbsp;encoding:&#34;</span><span class="op" id="8333203">,</span>&nbsp;<span class="ident" id="8333205">err</span><span class="op" id="8333208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333214">var</span>&nbsp;<span class="ident" id="8333218">b1</span>&nbsp;<span class="ident" id="8333221">Bug2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333227">err</span>&nbsp;<span class="op" id="8333231">:=</span>&nbsp;<span class="ident" id="8333234">NewDecoder</span><span class="op" id="8333244">(</span><span class="op" id="8333245">&amp;</span><span class="ident" id="8333246">buf</span><span class="op" id="8333249">)</span><span class="op" id="8333250">.</span><span class="ident" id="8333251">Decode</span><span class="op" id="8333257">(</span><span class="op" id="8333258">&amp;</span><span class="ident" id="8333259">b1</span><span class="op" id="8333261">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333264">if</span>&nbsp;<span class="ident" id="8333267">err</span>&nbsp;<span class="op" id="8333271">!=</span>&nbsp;<span class="ident" id="8333274">nil</span>&nbsp;<span class="op" id="8333278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333282">t</span><span class="op" id="8333283">.</span><span class="ident" id="8333284">Fatal</span><span class="op" id="8333289">(</span><span class="string" id="8333290">&#34;decode:&#34;</span><span class="op" id="8333299">,</span>&nbsp;<span class="ident" id="8333301">err</span><span class="op" id="8333304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333310">if</span>&nbsp;<span class="ident" id="8333313">b1</span><span class="op" id="8333315">.</span><span class="ident" id="8333316">A</span>&nbsp;<span class="op" id="8333318">!=</span>&nbsp;<span class="ident" id="8333321">b0</span><span class="op" id="8333323">.</span><span class="ident" id="8333324">A</span>&nbsp;<span class="op" id="8333326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333330">t</span><span class="op" id="8333331">.</span><span class="ident" id="8333332">Fatalf</span><span class="op" id="8333338">(</span><span class="string" id="8333339">&#34;got&nbsp;%d&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8333355">,</span>&nbsp;<span class="ident" id="8333357">b1</span><span class="op" id="8333359">.</span><span class="ident" id="8333360">A</span><span class="op" id="8333361">,</span>&nbsp;<span class="ident" id="8333363">b0</span><span class="op" id="8333365">.</span><span class="ident" id="8333366">A</span><span class="op" id="8333367">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333373">if</span>&nbsp;<span class="ident" id="8333376">b1</span><span class="op" id="8333378">.</span><span class="ident" id="8333379">C</span>&nbsp;<span class="op" id="8333381">!=</span>&nbsp;<span class="ident" id="8333384">nil</span>&nbsp;<span class="op" id="8333388">||</span>&nbsp;<span class="ident" id="8333391">b1</span><span class="op" id="8333393">.</span><span class="ident" id="8333394">CP</span>&nbsp;<span class="op" id="8333397">!=</span>&nbsp;<span class="ident" id="8333400">nil</span>&nbsp;<span class="op" id="8333404">||</span>&nbsp;<span class="ident" id="8333407">b1</span><span class="op" id="8333409">.</span><span class="ident" id="8333410">F</span>&nbsp;<span class="op" id="8333412">!=</span>&nbsp;<span class="ident" id="8333415">nil</span>&nbsp;<span class="op" id="8333419">||</span>&nbsp;<span class="ident" id="8333422">b1</span><span class="op" id="8333424">.</span><span class="ident" id="8333425">FPP</span>&nbsp;<span class="op" id="8333429">!=</span>&nbsp;<span class="ident" id="8333432">nil</span>&nbsp;<span class="op" id="8333436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333440">t</span><span class="op" id="8333441">.</span><span class="ident" id="8333442">Fatal</span><span class="op" id="8333447">(</span><span class="string" id="8333448">&#34;unexpected&nbsp;value&nbsp;for&nbsp;chan&nbsp;or&nbsp;func&#34;</span><span class="op" id="8333483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333486">}</span><br>
<span class="lineno"></span><span class="op" id="8333488">}</span><br>
<span class="lineno">770</span><br>
<span class="lineno"></span><span class="keyword" id="8333491">func</span>&nbsp;<span class="ident" id="8333496">TestSliceIncompatibility</span><span class="op" id="8333520">(</span><span class="ident" id="8333521">t</span>&nbsp;<span class="op" id="8333523">*</span><span class="ident" id="8333524">testing</span><span class="op" id="8333531">.</span><span class="ident" id="8333532">T</span><span class="op" id="8333533">)</span>&nbsp;<span class="op" id="8333535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333538">var</span>&nbsp;<span class="ident" id="8333542">in</span>&nbsp;<span class="op" id="8333545">=</span>&nbsp;<span class="op" id="8333547">[</span><span class="op" id="8333548">]</span><span class="builtintype" id="8333549">byte</span><span class="op" id="8333553">{</span><span class="num" id="8333554">1</span><span class="op" id="8333555">,</span>&nbsp;<span class="num" id="8333557">2</span><span class="op" id="8333558">,</span>&nbsp;<span class="num" id="8333560">3</span><span class="op" id="8333561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333564">var</span>&nbsp;<span class="ident" id="8333568">out</span>&nbsp;<span class="op" id="8333572">[</span><span class="op" id="8333573">]</span><span class="builtintype" id="8333574">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333579">if</span>&nbsp;<span class="ident" id="8333582">err</span>&nbsp;<span class="op" id="8333586">:=</span>&nbsp;<span class="ident" id="8333589">encAndDec</span><span class="op" id="8333598">(</span><span class="ident" id="8333599">in</span><span class="op" id="8333601">,</span>&nbsp;<span class="op" id="8333603">&amp;</span><span class="ident" id="8333604">out</span><span class="op" id="8333607">)</span><span class="op" id="8333608">;</span>&nbsp;<span class="ident" id="8333610">err</span>&nbsp;<span class="op" id="8333614">==</span>&nbsp;<span class="ident" id="8333617">nil</span>&nbsp;<span class="op" id="8333621">{</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333625">t</span><span class="op" id="8333626">.</span><span class="ident" id="8333627">Error</span><span class="op" id="8333632">(</span><span class="string" id="8333633">&#34;expected&nbsp;compatibility&nbsp;error&#34;</span><span class="op" id="8333663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333666">}</span><br>
<span class="lineno"></span><span class="op" id="8333668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8333671">//&nbsp;Mutually&nbsp;recursive&nbsp;slices&nbsp;of&nbsp;structs&nbsp;caused&nbsp;problems.</span><br>
<span class="lineno">780</span><span class="keyword" id="8333728">type</span>&nbsp;<span class="ident" id="8333733">Bug3</span>&nbsp;<span class="keyword" id="8333738">struct</span>&nbsp;<span class="op" id="8333745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333748">Num</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8333757">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333762">Children</span>&nbsp;<span class="op" id="8333771">[</span><span class="op" id="8333772">]</span><span class="op" id="8333773">*</span><span class="ident" id="8333774">Bug3</span><br>
<span class="lineno"></span><span class="op" id="8333779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">785</span><span class="keyword" id="8333782">func</span>&nbsp;<span class="ident" id="8333787">TestGobPtrSlices</span><span class="op" id="8333803">(</span><span class="ident" id="8333804">t</span>&nbsp;<span class="op" id="8333806">*</span><span class="ident" id="8333807">testing</span><span class="op" id="8333814">.</span><span class="ident" id="8333815">T</span><span class="op" id="8333816">)</span>&nbsp;<span class="op" id="8333818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333821">in</span>&nbsp;<span class="op" id="8333824">:=</span>&nbsp;<span class="op" id="8333827">[</span><span class="op" id="8333828">]</span><span class="op" id="8333829">*</span><span class="ident" id="8333830">Bug3</span><span class="op" id="8333834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333838">{</span><span class="num" id="8333839">1</span><span class="op" id="8333840">,</span>&nbsp;<span class="ident" id="8333842">nil</span><span class="op" id="8333845">}</span><span class="op" id="8333846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333850">{</span><span class="num" id="8333851">2</span><span class="op" id="8333852">,</span>&nbsp;<span class="ident" id="8333854">nil</span><span class="op" id="8333857">}</span><span class="op" id="8333858">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333861">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333864">b</span>&nbsp;<span class="op" id="8333866">:=</span>&nbsp;<span class="builtinfunc" id="8333869">new</span><span class="op" id="8333872">(</span><span class="ident" id="8333873">bytes</span><span class="op" id="8333878">.</span><span class="ident" id="8333879">Buffer</span><span class="op" id="8333885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333888">err</span>&nbsp;<span class="op" id="8333892">:=</span>&nbsp;<span class="ident" id="8333895">NewEncoder</span><span class="op" id="8333905">(</span><span class="ident" id="8333906">b</span><span class="op" id="8333907">)</span><span class="op" id="8333908">.</span><span class="ident" id="8333909">Encode</span><span class="op" id="8333915">(</span><span class="op" id="8333916">&amp;</span><span class="ident" id="8333917">in</span><span class="op" id="8333919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333922">if</span>&nbsp;<span class="ident" id="8333925">err</span>&nbsp;<span class="op" id="8333929">!=</span>&nbsp;<span class="ident" id="8333932">nil</span>&nbsp;<span class="op" id="8333936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333940">t</span><span class="op" id="8333941">.</span><span class="ident" id="8333942">Fatal</span><span class="op" id="8333947">(</span><span class="string" id="8333948">&#34;encode:&#34;</span><span class="op" id="8333957">,</span>&nbsp;<span class="ident" id="8333959">err</span><span class="op" id="8333962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333965">}</span><br>
<span class="lineno">795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333969">var</span>&nbsp;<span class="ident" id="8333973">out</span>&nbsp;<span class="op" id="8333977">[</span><span class="op" id="8333978">]</span><span class="op" id="8333979">*</span><span class="ident" id="8333980">Bug3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333986">err</span>&nbsp;<span class="op" id="8333990">=</span>&nbsp;<span class="ident" id="8333992">NewDecoder</span><span class="op" id="8334002">(</span><span class="ident" id="8334003">b</span><span class="op" id="8334004">)</span><span class="op" id="8334005">.</span><span class="ident" id="8334006">Decode</span><span class="op" id="8334012">(</span><span class="op" id="8334013">&amp;</span><span class="ident" id="8334014">out</span><span class="op" id="8334017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334020">if</span>&nbsp;<span class="ident" id="8334023">err</span>&nbsp;<span class="op" id="8334027">!=</span>&nbsp;<span class="ident" id="8334030">nil</span>&nbsp;<span class="op" id="8334034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334038">t</span><span class="op" id="8334039">.</span><span class="ident" id="8334040">Fatal</span><span class="op" id="8334045">(</span><span class="string" id="8334046">&#34;decode:&#34;</span><span class="op" id="8334055">,</span>&nbsp;<span class="ident" id="8334057">err</span><span class="op" id="8334060">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334066">if</span>&nbsp;<span class="op" id="8334069">!</span><span class="ident" id="8334070">reflect</span><span class="op" id="8334077">.</span><span class="ident" id="8334078">DeepEqual</span><span class="op" id="8334087">(</span><span class="ident" id="8334088">in</span><span class="op" id="8334090">,</span>&nbsp;<span class="ident" id="8334092">out</span><span class="op" id="8334095">)</span>&nbsp;<span class="op" id="8334097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334101">t</span><span class="op" id="8334102">.</span><span class="ident" id="8334103">Fatalf</span><span class="op" id="8334109">(</span><span class="string" id="8334110">&#34;got&nbsp;%v;&nbsp;wanted&nbsp;%v&#34;</span><span class="op" id="8334129">,</span>&nbsp;<span class="ident" id="8334131">out</span><span class="op" id="8334134">,</span>&nbsp;<span class="ident" id="8334136">in</span><span class="op" id="8334138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334141">}</span><br>
<span class="lineno"></span><span class="op" id="8334143">}</span><br>
<span class="lineno">805</span><br>
<span class="lineno"></span><span class="comment" id="8334146">//&nbsp;getDecEnginePtr&nbsp;cached&nbsp;engine&nbsp;for&nbsp;ut.base&nbsp;instead&nbsp;of&nbsp;ut.user&nbsp;so&nbsp;we&nbsp;passed</span><br>
<span class="lineno"></span><span class="comment" id="8334223">//&nbsp;a&nbsp;*map&nbsp;and&nbsp;then&nbsp;tried&nbsp;to&nbsp;reuse&nbsp;its&nbsp;engine&nbsp;to&nbsp;decode&nbsp;the&nbsp;inner&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="8334293">func</span>&nbsp;<span class="ident" id="8334298">TestPtrToMapOfMap</span><span class="op" id="8334315">(</span><span class="ident" id="8334316">t</span>&nbsp;<span class="op" id="8334318">*</span><span class="ident" id="8334319">testing</span><span class="op" id="8334326">.</span><span class="ident" id="8334327">T</span><span class="op" id="8334328">)</span>&nbsp;<span class="op" id="8334330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334333">Register</span><span class="op" id="8334341">(</span><span class="builtinfunc" id="8334342">make</span><span class="op" id="8334346">(</span><span class="keyword" id="8334347">map</span><span class="op" id="8334350">[</span><span class="builtintype" id="8334351">string</span><span class="op" id="8334357">]</span><span class="keyword" id="8334358">interface</span><span class="op" id="8334367">{</span><span class="op" id="8334368">}</span><span class="op" id="8334369">)</span><span class="op" id="8334370">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334373">subdata</span>&nbsp;<span class="op" id="8334381">:=</span>&nbsp;<span class="builtinfunc" id="8334384">make</span><span class="op" id="8334388">(</span><span class="keyword" id="8334389">map</span><span class="op" id="8334392">[</span><span class="builtintype" id="8334393">string</span><span class="op" id="8334399">]</span><span class="keyword" id="8334400">interface</span><span class="op" id="8334409">{</span><span class="op" id="8334410">}</span><span class="op" id="8334411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334414">subdata</span><span class="op" id="8334421">[</span><span class="string" id="8334422">&#34;bar&#34;</span><span class="op" id="8334427">]</span>&nbsp;<span class="op" id="8334429">=</span>&nbsp;<span class="string" id="8334431">&#34;baz&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334438">data</span>&nbsp;<span class="op" id="8334443">:=</span>&nbsp;<span class="builtinfunc" id="8334446">make</span><span class="op" id="8334450">(</span><span class="keyword" id="8334451">map</span><span class="op" id="8334454">[</span><span class="builtintype" id="8334455">string</span><span class="op" id="8334461">]</span><span class="keyword" id="8334462">interface</span><span class="op" id="8334471">{</span><span class="op" id="8334472">}</span><span class="op" id="8334473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334476">data</span><span class="op" id="8334480">[</span><span class="string" id="8334481">&#34;foo&#34;</span><span class="op" id="8334486">]</span>&nbsp;<span class="op" id="8334488">=</span>&nbsp;<span class="ident" id="8334490">subdata</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334500">b</span>&nbsp;<span class="op" id="8334502">:=</span>&nbsp;<span class="builtinfunc" id="8334505">new</span><span class="op" id="8334508">(</span><span class="ident" id="8334509">bytes</span><span class="op" id="8334514">.</span><span class="ident" id="8334515">Buffer</span><span class="op" id="8334521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334524">err</span>&nbsp;<span class="op" id="8334528">:=</span>&nbsp;<span class="ident" id="8334531">NewEncoder</span><span class="op" id="8334541">(</span><span class="ident" id="8334542">b</span><span class="op" id="8334543">)</span><span class="op" id="8334544">.</span><span class="ident" id="8334545">Encode</span><span class="op" id="8334551">(</span><span class="ident" id="8334552">data</span><span class="op" id="8334556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334559">if</span>&nbsp;<span class="ident" id="8334562">err</span>&nbsp;<span class="op" id="8334566">!=</span>&nbsp;<span class="ident" id="8334569">nil</span>&nbsp;<span class="op" id="8334573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334577">t</span><span class="op" id="8334578">.</span><span class="ident" id="8334579">Fatal</span><span class="op" id="8334584">(</span><span class="string" id="8334585">&#34;encode:&#34;</span><span class="op" id="8334594">,</span>&nbsp;<span class="ident" id="8334596">err</span><span class="op" id="8334599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334602">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334605">var</span>&nbsp;<span class="ident" id="8334609">newData</span>&nbsp;<span class="keyword" id="8334617">map</span><span class="op" id="8334620">[</span><span class="builtintype" id="8334621">string</span><span class="op" id="8334627">]</span><span class="keyword" id="8334628">interface</span><span class="op" id="8334637">{</span><span class="op" id="8334638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334641">err</span>&nbsp;<span class="op" id="8334645">=</span>&nbsp;<span class="ident" id="8334647">NewDecoder</span><span class="op" id="8334657">(</span><span class="ident" id="8334658">b</span><span class="op" id="8334659">)</span><span class="op" id="8334660">.</span><span class="ident" id="8334661">Decode</span><span class="op" id="8334667">(</span><span class="op" id="8334668">&amp;</span><span class="ident" id="8334669">newData</span><span class="op" id="8334676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334679">if</span>&nbsp;<span class="ident" id="8334682">err</span>&nbsp;<span class="op" id="8334686">!=</span>&nbsp;<span class="ident" id="8334689">nil</span>&nbsp;<span class="op" id="8334693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334697">t</span><span class="op" id="8334698">.</span><span class="ident" id="8334699">Fatal</span><span class="op" id="8334704">(</span><span class="string" id="8334705">&#34;decode:&#34;</span><span class="op" id="8334714">,</span>&nbsp;<span class="ident" id="8334716">err</span><span class="op" id="8334719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334722">}</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334725">if</span>&nbsp;<span class="op" id="8334728">!</span><span class="ident" id="8334729">reflect</span><span class="op" id="8334736">.</span><span class="ident" id="8334737">DeepEqual</span><span class="op" id="8334746">(</span><span class="ident" id="8334747">data</span><span class="op" id="8334751">,</span>&nbsp;<span class="ident" id="8334753">newData</span><span class="op" id="8334760">)</span>&nbsp;<span class="op" id="8334762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334766">t</span><span class="op" id="8334767">.</span><span class="ident" id="8334768">Fatalf</span><span class="op" id="8334774">(</span><span class="string" id="8334775">&#34;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8334795">,</span>&nbsp;<span class="ident" id="8334797">data</span><span class="op" id="8334801">,</span>&nbsp;<span class="ident" id="8334803">newData</span><span class="op" id="8334810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334813">}</span><br>
<span class="lineno"></span><span class="op" id="8334815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">830</span><span class="comment" id="8334818">//&nbsp;A&nbsp;top-level&nbsp;nil&nbsp;pointer&nbsp;generates&nbsp;a&nbsp;panic&nbsp;with&nbsp;a&nbsp;helpful&nbsp;string-valued&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="8334901">func</span>&nbsp;<span class="ident" id="8334906">TestTopLevelNilPointer</span><span class="op" id="8334928">(</span><span class="ident" id="8334929">t</span>&nbsp;<span class="op" id="8334931">*</span><span class="ident" id="8334932">testing</span><span class="op" id="8334939">.</span><span class="ident" id="8334940">T</span><span class="op" id="8334941">)</span>&nbsp;<span class="op" id="8334943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334946">errMsg</span>&nbsp;<span class="op" id="8334953">:=</span>&nbsp;<span class="ident" id="8334956">topLevelNilPanic</span><span class="op" id="8334972">(</span><span class="ident" id="8334973">t</span><span class="op" id="8334974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334977">if</span>&nbsp;<span class="ident" id="8334980">errMsg</span>&nbsp;<span class="op" id="8334987">==</span>&nbsp;<span class="string" id="8334990">&#34;&#34;</span>&nbsp;<span class="op" id="8334993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334997">t</span><span class="op" id="8334998">.</span><span class="ident" id="8334999">Fatal</span><span class="op" id="8335004">(</span><span class="string" id="8335005">&#34;top-level&nbsp;nil&nbsp;pointer&nbsp;did&nbsp;not&nbsp;panic&#34;</span><span class="op" id="8335042">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335048">if</span>&nbsp;<span class="op" id="8335051">!</span><span class="ident" id="8335052">strings</span><span class="op" id="8335059">.</span><span class="ident" id="8335060">Contains</span><span class="op" id="8335068">(</span><span class="ident" id="8335069">errMsg</span><span class="op" id="8335075">,</span>&nbsp;<span class="string" id="8335077">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="8335090">)</span>&nbsp;<span class="op" id="8335092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335096">t</span><span class="op" id="8335097">.</span><span class="ident" id="8335098">Fatal</span><span class="op" id="8335103">(</span><span class="string" id="8335104">&#34;expected&nbsp;nil&nbsp;pointer&nbsp;error,&nbsp;got:&#34;</span><span class="op" id="8335138">,</span>&nbsp;<span class="ident" id="8335140">errMsg</span><span class="op" id="8335146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335149">}</span><br>
<span class="lineno"></span><span class="op" id="8335151">}</span><br>
<span class="lineno">840</span><br>
<span class="lineno"></span><span class="keyword" id="8335154">func</span>&nbsp;<span class="ident" id="8335159">topLevelNilPanic</span><span class="op" id="8335175">(</span><span class="ident" id="8335176">t</span>&nbsp;<span class="op" id="8335178">*</span><span class="ident" id="8335179">testing</span><span class="op" id="8335186">.</span><span class="ident" id="8335187">T</span><span class="op" id="8335188">)</span>&nbsp;<span class="op" id="8335190">(</span><span class="ident" id="8335191">panicErr</span>&nbsp;<span class="builtintype" id="8335200">string</span><span class="op" id="8335206">)</span>&nbsp;<span class="op" id="8335208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335211">defer</span>&nbsp;<span class="keyword" id="8335217">func</span><span class="op" id="8335221">(</span><span class="op" id="8335222">)</span>&nbsp;<span class="op" id="8335224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335228">e</span>&nbsp;<span class="op" id="8335230">:=</span>&nbsp;<span class="builtinfunc" id="8335233">recover</span><span class="op" id="8335240">(</span><span class="op" id="8335241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335245">if</span>&nbsp;<span class="ident" id="8335248">err</span><span class="op" id="8335251">,</span>&nbsp;<span class="ident" id="8335253">ok</span>&nbsp;<span class="op" id="8335256">:=</span>&nbsp;<span class="ident" id="8335259">e</span><span class="op" id="8335260">.</span><span class="op" id="8335261">(</span><span class="builtintype" id="8335262">string</span><span class="op" id="8335268">)</span><span class="op" id="8335269">;</span>&nbsp;<span class="ident" id="8335271">ok</span>&nbsp;<span class="op" id="8335274">{</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335279">panicErr</span>&nbsp;<span class="op" id="8335288">=</span>&nbsp;<span class="ident" id="8335290">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335299">}</span><span class="op" id="8335300">(</span><span class="op" id="8335301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335304">var</span>&nbsp;<span class="ident" id="8335308">ip</span>&nbsp;<span class="op" id="8335311">*</span><span class="builtintype" id="8335312">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335317">buf</span>&nbsp;<span class="op" id="8335321">:=</span>&nbsp;<span class="builtinfunc" id="8335324">new</span><span class="op" id="8335327">(</span><span class="ident" id="8335328">bytes</span><span class="op" id="8335333">.</span><span class="ident" id="8335334">Buffer</span><span class="op" id="8335340">)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335343">if</span>&nbsp;<span class="ident" id="8335346">err</span>&nbsp;<span class="op" id="8335350">:=</span>&nbsp;<span class="ident" id="8335353">NewEncoder</span><span class="op" id="8335363">(</span><span class="ident" id="8335364">buf</span><span class="op" id="8335367">)</span><span class="op" id="8335368">.</span><span class="ident" id="8335369">Encode</span><span class="op" id="8335375">(</span><span class="ident" id="8335376">ip</span><span class="op" id="8335378">)</span><span class="op" id="8335379">;</span>&nbsp;<span class="ident" id="8335381">err</span>&nbsp;<span class="op" id="8335385">!=</span>&nbsp;<span class="ident" id="8335388">nil</span>&nbsp;<span class="op" id="8335392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335396">t</span><span class="op" id="8335397">.</span><span class="ident" id="8335398">Fatal</span><span class="op" id="8335403">(</span><span class="string" id="8335404">&#34;error&nbsp;in&nbsp;encode:&#34;</span><span class="op" id="8335422">,</span>&nbsp;<span class="ident" id="8335424">err</span><span class="op" id="8335427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335433">return</span><br>
<span class="lineno"></span><span class="op" id="8335440">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span><span class="keyword" id="8335443">func</span>&nbsp;<span class="ident" id="8335448">TestNilPointerInsideInterface</span><span class="op" id="8335477">(</span><span class="ident" id="8335478">t</span>&nbsp;<span class="op" id="8335480">*</span><span class="ident" id="8335481">testing</span><span class="op" id="8335488">.</span><span class="ident" id="8335489">T</span><span class="op" id="8335490">)</span>&nbsp;<span class="op" id="8335492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335495">var</span>&nbsp;<span class="ident" id="8335499">ip</span>&nbsp;<span class="op" id="8335502">*</span><span class="builtintype" id="8335503">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335508">si</span>&nbsp;<span class="op" id="8335511">:=</span>&nbsp;<span class="keyword" id="8335514">struct</span>&nbsp;<span class="op" id="8335521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335525">I</span>&nbsp;<span class="keyword" id="8335527">interface</span><span class="op" id="8335536">{</span><span class="op" id="8335537">}</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335540">}</span><span class="op" id="8335541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335545">I</span><span class="op" id="8335546">:</span>&nbsp;<span class="ident" id="8335548">ip</span><span class="op" id="8335550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335556">buf</span>&nbsp;<span class="op" id="8335560">:=</span>&nbsp;<span class="builtinfunc" id="8335563">new</span><span class="op" id="8335566">(</span><span class="ident" id="8335567">bytes</span><span class="op" id="8335572">.</span><span class="ident" id="8335573">Buffer</span><span class="op" id="8335579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335582">err</span>&nbsp;<span class="op" id="8335586">:=</span>&nbsp;<span class="ident" id="8335589">NewEncoder</span><span class="op" id="8335599">(</span><span class="ident" id="8335600">buf</span><span class="op" id="8335603">)</span><span class="op" id="8335604">.</span><span class="ident" id="8335605">Encode</span><span class="op" id="8335611">(</span><span class="ident" id="8335612">si</span><span class="op" id="8335614">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335617">if</span>&nbsp;<span class="ident" id="8335620">err</span>&nbsp;<span class="op" id="8335624">==</span>&nbsp;<span class="ident" id="8335627">nil</span>&nbsp;<span class="op" id="8335631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335635">t</span><span class="op" id="8335636">.</span><span class="ident" id="8335637">Fatal</span><span class="op" id="8335642">(</span><span class="string" id="8335643">&#34;expected&nbsp;error,&nbsp;got&nbsp;none&#34;</span><span class="op" id="8335669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335675">errMsg</span>&nbsp;<span class="op" id="8335682">:=</span>&nbsp;<span class="ident" id="8335685">err</span><span class="op" id="8335688">.</span><span class="ident" id="8335689">Error</span><span class="op" id="8335694">(</span><span class="op" id="8335695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335698">if</span>&nbsp;<span class="op" id="8335701">!</span><span class="ident" id="8335702">strings</span><span class="op" id="8335709">.</span><span class="ident" id="8335710">Contains</span><span class="op" id="8335718">(</span><span class="ident" id="8335719">errMsg</span><span class="op" id="8335725">,</span>&nbsp;<span class="string" id="8335727">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="8335740">)</span>&nbsp;<span class="op" id="8335742">||</span>&nbsp;<span class="op" id="8335745">!</span><span class="ident" id="8335746">strings</span><span class="op" id="8335753">.</span><span class="ident" id="8335754">Contains</span><span class="op" id="8335762">(</span><span class="ident" id="8335763">errMsg</span><span class="op" id="8335769">,</span>&nbsp;<span class="string" id="8335771">&#34;interface&#34;</span><span class="op" id="8335782">)</span>&nbsp;<span class="op" id="8335784">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335788">t</span><span class="op" id="8335789">.</span><span class="ident" id="8335790">Fatal</span><span class="op" id="8335795">(</span><span class="string" id="8335796">&#34;expected&nbsp;error&nbsp;about&nbsp;nil&nbsp;pointer&nbsp;and&nbsp;interface,&nbsp;got:&#34;</span><span class="op" id="8335850">,</span>&nbsp;<span class="ident" id="8335852">errMsg</span><span class="op" id="8335858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335861">}</span><br>
<span class="lineno"></span><span class="op" id="8335863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8335866">type</span>&nbsp;<span class="ident" id="8335871">Bug4Public</span>&nbsp;<span class="keyword" id="8335882">struct</span>&nbsp;<span class="op" id="8335889">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335892">Name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8335899">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335907">Secret</span>&nbsp;<span class="ident" id="8335914">Bug4Secret</span><br>
<span class="lineno"></span><span class="op" id="8335925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8335928">type</span>&nbsp;<span class="ident" id="8335933">Bug4Secret</span>&nbsp;<span class="keyword" id="8335944">struct</span>&nbsp;<span class="op" id="8335951">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335954">a</span>&nbsp;<span class="builtintype" id="8335956">int</span>&nbsp;<span class="comment" id="8335960">//&nbsp;error:&nbsp;no&nbsp;exported&nbsp;fields.</span><br>
<span class="lineno"></span><span class="op" id="8335990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8335993">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;failed&nbsp;compilation&nbsp;doesn&#39;t&nbsp;leave&nbsp;around&nbsp;an&nbsp;executable&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="8336071">//&nbsp;Issue&nbsp;3273.</span><br>
<span class="lineno">885</span><span class="keyword" id="8336086">func</span>&nbsp;<span class="ident" id="8336091">TestMutipleEncodingsOfBadType</span><span class="op" id="8336120">(</span><span class="ident" id="8336121">t</span>&nbsp;<span class="op" id="8336123">*</span><span class="ident" id="8336124">testing</span><span class="op" id="8336131">.</span><span class="ident" id="8336132">T</span><span class="op" id="8336133">)</span>&nbsp;<span class="op" id="8336135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336138">x</span>&nbsp;<span class="op" id="8336140">:=</span>&nbsp;<span class="ident" id="8336143">Bug4Public</span><span class="op" id="8336153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336157">Name</span><span class="op" id="8336161">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8336165">&#34;name&#34;</span><span class="op" id="8336171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336175">Secret</span><span class="op" id="8336181">:</span>&nbsp;<span class="ident" id="8336183">Bug4Secret</span><span class="op" id="8336193">{</span><span class="num" id="8336194">1</span><span class="op" id="8336195">}</span><span class="op" id="8336196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336199">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336202">buf</span>&nbsp;<span class="op" id="8336206">:=</span>&nbsp;<span class="builtinfunc" id="8336209">new</span><span class="op" id="8336212">(</span><span class="ident" id="8336213">bytes</span><span class="op" id="8336218">.</span><span class="ident" id="8336219">Buffer</span><span class="op" id="8336225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336228">enc</span>&nbsp;<span class="op" id="8336232">:=</span>&nbsp;<span class="ident" id="8336235">NewEncoder</span><span class="op" id="8336245">(</span><span class="ident" id="8336246">buf</span><span class="op" id="8336249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336252">err</span>&nbsp;<span class="op" id="8336256">:=</span>&nbsp;<span class="ident" id="8336259">enc</span><span class="op" id="8336262">.</span><span class="ident" id="8336263">Encode</span><span class="op" id="8336269">(</span><span class="ident" id="8336270">x</span><span class="op" id="8336271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336274">if</span>&nbsp;<span class="ident" id="8336277">err</span>&nbsp;<span class="op" id="8336281">==</span>&nbsp;<span class="ident" id="8336284">nil</span>&nbsp;<span class="op" id="8336288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336292">t</span><span class="op" id="8336293">.</span><span class="ident" id="8336294">Fatal</span><span class="op" id="8336299">(</span><span class="string" id="8336300">&#34;first&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8336332">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336338">buf</span><span class="op" id="8336341">.</span><span class="ident" id="8336342">Reset</span><span class="op" id="8336347">(</span><span class="op" id="8336348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336351">enc</span>&nbsp;<span class="op" id="8336355">=</span>&nbsp;<span class="ident" id="8336357">NewEncoder</span><span class="op" id="8336367">(</span><span class="ident" id="8336368">buf</span><span class="op" id="8336371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336374">err</span>&nbsp;<span class="op" id="8336378">=</span>&nbsp;<span class="ident" id="8336380">enc</span><span class="op" id="8336383">.</span><span class="ident" id="8336384">Encode</span><span class="op" id="8336390">(</span><span class="ident" id="8336391">x</span><span class="op" id="8336392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336395">if</span>&nbsp;<span class="ident" id="8336398">err</span>&nbsp;<span class="op" id="8336402">==</span>&nbsp;<span class="ident" id="8336405">nil</span>&nbsp;<span class="op" id="8336409">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336413">t</span><span class="op" id="8336414">.</span><span class="ident" id="8336415">Fatal</span><span class="op" id="8336420">(</span><span class="string" id="8336421">&#34;second&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8336454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336460">if</span>&nbsp;<span class="op" id="8336463">!</span><span class="ident" id="8336464">strings</span><span class="op" id="8336471">.</span><span class="ident" id="8336472">Contains</span><span class="op" id="8336480">(</span><span class="ident" id="8336481">err</span><span class="op" id="8336484">.</span><span class="ident" id="8336485">Error</span><span class="op" id="8336490">(</span><span class="op" id="8336491">)</span><span class="op" id="8336492">,</span>&nbsp;<span class="string" id="8336494">&#34;no&nbsp;exported&nbsp;fields&#34;</span><span class="op" id="8336514">)</span>&nbsp;<span class="op" id="8336516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336520">t</span><span class="op" id="8336521">.</span><span class="ident" id="8336522">Errorf</span><span class="op" id="8336528">(</span><span class="string" id="8336529">&#34;expected&nbsp;error&nbsp;about&nbsp;no&nbsp;exported&nbsp;fields;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8336578">,</span>&nbsp;<span class="ident" id="8336580">err</span><span class="op" id="8336583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336586">}</span><br>
<span class="lineno">905</span><span class="op" id="8336588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8336591">//&nbsp;There&nbsp;was&nbsp;an&nbsp;error&nbsp;check&nbsp;comparing&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8336662">//&nbsp;length&nbsp;of&nbsp;the&nbsp;slice&nbsp;being&nbsp;decoded.&nbsp;It&nbsp;was&nbsp;wrong&nbsp;because&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="8336730">//&nbsp;thing&nbsp;in&nbsp;the&nbsp;input&nbsp;might&nbsp;be&nbsp;a&nbsp;type&nbsp;definition,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to</span><br>
<span class="lineno">910</span><span class="comment" id="8336800">//&nbsp;an&nbsp;incorrect&nbsp;length&nbsp;check.&nbsp;&nbsp;This&nbsp;test&nbsp;reproduces&nbsp;the&nbsp;corner&nbsp;case.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8336870">type</span>&nbsp;<span class="ident" id="8336875">Z</span>&nbsp;<span class="keyword" id="8336877">struct</span>&nbsp;<span class="op" id="8336884">{</span><br>
<span class="lineno"></span><span class="op" id="8336886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="8336889">func</span>&nbsp;<span class="ident" id="8336894">Test29ElementSlice</span><span class="op" id="8336912">(</span><span class="ident" id="8336913">t</span>&nbsp;<span class="op" id="8336915">*</span><span class="ident" id="8336916">testing</span><span class="op" id="8336923">.</span><span class="ident" id="8336924">T</span><span class="op" id="8336925">)</span>&nbsp;<span class="op" id="8336927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336930">Register</span><span class="op" id="8336938">(</span><span class="ident" id="8336939">Z</span><span class="op" id="8336940">{</span><span class="op" id="8336941">}</span><span class="op" id="8336942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336945">src</span>&nbsp;<span class="op" id="8336949">:=</span>&nbsp;<span class="builtinfunc" id="8336952">make</span><span class="op" id="8336956">(</span><span class="op" id="8336957">[</span><span class="op" id="8336958">]</span><span class="keyword" id="8336959">interface</span><span class="op" id="8336968">{</span><span class="op" id="8336969">}</span><span class="op" id="8336970">,</span>&nbsp;<span class="num" id="8336972">100</span><span class="op" id="8336975">)</span>&nbsp;<span class="comment" id="8336977">//&nbsp;Size&nbsp;needs&nbsp;to&nbsp;be&nbsp;bigger&nbsp;than&nbsp;size&nbsp;of&nbsp;type&nbsp;definition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337035">for</span>&nbsp;<span class="ident" id="8337039">i</span>&nbsp;<span class="op" id="8337041">:=</span>&nbsp;<span class="keyword" id="8337044">range</span>&nbsp;<span class="ident" id="8337050">src</span>&nbsp;<span class="op" id="8337054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337058">src</span><span class="op" id="8337061">[</span><span class="ident" id="8337062">i</span><span class="op" id="8337063">]</span>&nbsp;<span class="op" id="8337065">=</span>&nbsp;<span class="ident" id="8337067">Z</span><span class="op" id="8337068">{</span><span class="op" id="8337069">}</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337075">buf</span>&nbsp;<span class="op" id="8337079">:=</span>&nbsp;<span class="builtinfunc" id="8337082">new</span><span class="op" id="8337085">(</span><span class="ident" id="8337086">bytes</span><span class="op" id="8337091">.</span><span class="ident" id="8337092">Buffer</span><span class="op" id="8337098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337101">err</span>&nbsp;<span class="op" id="8337105">:=</span>&nbsp;<span class="ident" id="8337108">NewEncoder</span><span class="op" id="8337118">(</span><span class="ident" id="8337119">buf</span><span class="op" id="8337122">)</span><span class="op" id="8337123">.</span><span class="ident" id="8337124">Encode</span><span class="op" id="8337130">(</span><span class="ident" id="8337131">src</span><span class="op" id="8337134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337137">if</span>&nbsp;<span class="ident" id="8337140">err</span>&nbsp;<span class="op" id="8337144">!=</span>&nbsp;<span class="ident" id="8337147">nil</span>&nbsp;<span class="op" id="8337151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337155">t</span><span class="op" id="8337156">.</span><span class="ident" id="8337157">Fatalf</span><span class="op" id="8337163">(</span><span class="string" id="8337164">&#34;encode:&nbsp;%v&#34;</span><span class="op" id="8337176">,</span>&nbsp;<span class="ident" id="8337178">err</span><span class="op" id="8337181">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337185">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337197">var</span>&nbsp;<span class="ident" id="8337201">dst</span>&nbsp;<span class="op" id="8337205">[</span><span class="op" id="8337206">]</span><span class="keyword" id="8337207">interface</span><span class="op" id="8337216">{</span><span class="op" id="8337217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337220">err</span>&nbsp;<span class="op" id="8337224">=</span>&nbsp;<span class="ident" id="8337226">NewDecoder</span><span class="op" id="8337236">(</span><span class="ident" id="8337237">buf</span><span class="op" id="8337240">)</span><span class="op" id="8337241">.</span><span class="ident" id="8337242">Decode</span><span class="op" id="8337248">(</span><span class="op" id="8337249">&amp;</span><span class="ident" id="8337250">dst</span><span class="op" id="8337253">)</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337256">if</span>&nbsp;<span class="ident" id="8337259">err</span>&nbsp;<span class="op" id="8337263">!=</span>&nbsp;<span class="ident" id="8337266">nil</span>&nbsp;<span class="op" id="8337270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337274">t</span><span class="op" id="8337275">.</span><span class="ident" id="8337276">Errorf</span><span class="op" id="8337282">(</span><span class="string" id="8337283">&#34;decode:&nbsp;%v&#34;</span><span class="op" id="8337295">,</span>&nbsp;<span class="ident" id="8337297">err</span><span class="op" id="8337300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337304">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337312">}</span><br>
<span class="lineno"></span><span class="op" id="8337314">}</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span><span class="comment" id="8337317">//&nbsp;Don&#39;t&nbsp;crash,&nbsp;just&nbsp;give&nbsp;error&nbsp;when&nbsp;allocating&nbsp;a&nbsp;huge&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="8337379">//&nbsp;Issue&nbsp;8084.</span><br>
<span class="lineno"></span><span class="keyword" id="8337394">func</span>&nbsp;<span class="ident" id="8337399">TestErrorForHugeSlice</span><span class="op" id="8337420">(</span><span class="ident" id="8337421">t</span>&nbsp;<span class="op" id="8337423">*</span><span class="ident" id="8337424">testing</span><span class="op" id="8337431">.</span><span class="ident" id="8337432">T</span><span class="op" id="8337433">)</span>&nbsp;<span class="op" id="8337435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8337438">//&nbsp;Encode&nbsp;an&nbsp;int&nbsp;slice.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337463">buf</span>&nbsp;<span class="op" id="8337467">:=</span>&nbsp;<span class="builtinfunc" id="8337470">new</span><span class="op" id="8337473">(</span><span class="ident" id="8337474">bytes</span><span class="op" id="8337479">.</span><span class="ident" id="8337480">Buffer</span><span class="op" id="8337486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337489">slice</span>&nbsp;<span class="op" id="8337495">:=</span>&nbsp;<span class="op" id="8337498">[</span><span class="op" id="8337499">]</span><span class="builtintype" id="8337500">int</span><span class="op" id="8337503">{</span><span class="num" id="8337504">1</span><span class="op" id="8337505">,</span>&nbsp;<span class="num" id="8337507">1</span><span class="op" id="8337508">,</span>&nbsp;<span class="num" id="8337510">1</span><span class="op" id="8337511">,</span>&nbsp;<span class="num" id="8337513">1</span><span class="op" id="8337514">,</span>&nbsp;<span class="num" id="8337516">1</span><span class="op" id="8337517">,</span>&nbsp;<span class="num" id="8337519">1</span><span class="op" id="8337520">,</span>&nbsp;<span class="num" id="8337522">1</span><span class="op" id="8337523">,</span>&nbsp;<span class="num" id="8337525">1</span><span class="op" id="8337526">,</span>&nbsp;<span class="num" id="8337528">1</span><span class="op" id="8337529">,</span>&nbsp;<span class="num" id="8337531">1</span><span class="op" id="8337532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337535">err</span>&nbsp;<span class="op" id="8337539">:=</span>&nbsp;<span class="ident" id="8337542">NewEncoder</span><span class="op" id="8337552">(</span><span class="ident" id="8337553">buf</span><span class="op" id="8337556">)</span><span class="op" id="8337557">.</span><span class="ident" id="8337558">Encode</span><span class="op" id="8337564">(</span><span class="ident" id="8337565">slice</span><span class="op" id="8337570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337573">if</span>&nbsp;<span class="ident" id="8337576">err</span>&nbsp;<span class="op" id="8337580">!=</span>&nbsp;<span class="ident" id="8337583">nil</span>&nbsp;<span class="op" id="8337587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337591">t</span><span class="op" id="8337592">.</span><span class="ident" id="8337593">Fatal</span><span class="op" id="8337598">(</span><span class="string" id="8337599">&#34;encode:&#34;</span><span class="op" id="8337608">,</span>&nbsp;<span class="ident" id="8337610">err</span><span class="op" id="8337613">)</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8337619">//&nbsp;Reach&nbsp;into&nbsp;the&nbsp;buffer&nbsp;and&nbsp;smash&nbsp;the&nbsp;count&nbsp;to&nbsp;make&nbsp;the&nbsp;encoded&nbsp;slice&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337702">buf</span><span class="op" id="8337705">.</span><span class="ident" id="8337706">Bytes</span><span class="op" id="8337711">(</span><span class="op" id="8337712">)</span><span class="op" id="8337713">[</span><span class="ident" id="8337714">buf</span><span class="op" id="8337717">.</span><span class="ident" id="8337718">Len</span><span class="op" id="8337721">(</span><span class="op" id="8337722">)</span><span class="op" id="8337723">-</span><span class="builtinfunc" id="8337724">len</span><span class="op" id="8337727">(</span><span class="ident" id="8337728">slice</span><span class="op" id="8337733">)</span><span class="op" id="8337734">-</span><span class="num" id="8337735">1</span><span class="op" id="8337736">]</span>&nbsp;<span class="op" id="8337738">=</span>&nbsp;<span class="num" id="8337740">0xfa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8337746">//&nbsp;Decode&nbsp;and&nbsp;see&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337772">err</span>&nbsp;<span class="op" id="8337776">=</span>&nbsp;<span class="ident" id="8337778">NewDecoder</span><span class="op" id="8337788">(</span><span class="ident" id="8337789">buf</span><span class="op" id="8337792">)</span><span class="op" id="8337793">.</span><span class="ident" id="8337794">Decode</span><span class="op" id="8337800">(</span><span class="op" id="8337801">&amp;</span><span class="ident" id="8337802">slice</span><span class="op" id="8337807">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337810">if</span>&nbsp;<span class="ident" id="8337813">err</span>&nbsp;<span class="op" id="8337817">==</span>&nbsp;<span class="ident" id="8337820">nil</span>&nbsp;<span class="op" id="8337824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337828">t</span><span class="op" id="8337829">.</span><span class="ident" id="8337830">Fatal</span><span class="op" id="8337835">(</span><span class="string" id="8337836">&#34;decode:&nbsp;no&nbsp;error&#34;</span><span class="op" id="8337854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337860">if</span>&nbsp;<span class="op" id="8337863">!</span><span class="ident" id="8337864">strings</span><span class="op" id="8337871">.</span><span class="ident" id="8337872">Contains</span><span class="op" id="8337880">(</span><span class="ident" id="8337881">err</span><span class="op" id="8337884">.</span><span class="ident" id="8337885">Error</span><span class="op" id="8337890">(</span><span class="op" id="8337891">)</span><span class="op" id="8337892">,</span>&nbsp;<span class="string" id="8337894">&#34;slice&nbsp;too&nbsp;big&#34;</span><span class="op" id="8337909">)</span>&nbsp;<span class="op" id="8337911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337915">t</span><span class="op" id="8337916">.</span><span class="ident" id="8337917">Fatal</span><span class="op" id="8337922">(</span><span class="string" id="8337923">&#34;decode:&nbsp;expected&nbsp;slice&nbsp;too&nbsp;big&nbsp;error,&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8337969">,</span>&nbsp;<span class="ident" id="8337971">err</span><span class="op" id="8337974">.</span><span class="ident" id="8337975">Error</span><span class="op" id="8337980">(</span><span class="op" id="8337981">)</span><span class="op" id="8337982">)</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337985">}</span><br>
<span class="lineno"></span><span class="op" id="8337987">}</span>
</div>
</body>
</html>
