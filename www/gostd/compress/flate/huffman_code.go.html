<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4284645">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4284700">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4284754">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4284805">package</span>&nbsp;<span class="ident" id="4284813">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4284820">import</span>&nbsp;<span class="op" id="4284827">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4284830">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4284838">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4284845">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4284848">type</span>&nbsp;<span class="ident" id="4284853">huffmanEncoder</span>&nbsp;<span class="keyword" id="4284868">struct</span>&nbsp;<span class="op" id="4284875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284878">codeBits</span>&nbsp;<span class="op" id="4284887">[</span><span class="op" id="4284888">]</span><span class="builtintype" id="4284889">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284896">code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284905">[</span><span class="op" id="4284906">]</span><span class="builtintype" id="4284907">uint16</span><br>
<span class="lineno">15</span><span class="op" id="4284914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4284917">type</span>&nbsp;<span class="ident" id="4284922">literalNode</span>&nbsp;<span class="keyword" id="4284934">struct</span>&nbsp;<span class="op" id="4284941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284944">literal</span>&nbsp;<span class="builtintype" id="4284952">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284960">freq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4284968">int32</span><br>
<span class="lineno">20</span><span class="op" id="4284974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4284977">//&nbsp;A&nbsp;levelInfo&nbsp;describes&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;constructed&nbsp;tree&nbsp;for&nbsp;a&nbsp;given&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="4285055">type</span>&nbsp;<span class="ident" id="4285060">levelInfo</span>&nbsp;<span class="keyword" id="4285070">struct</span>&nbsp;<span class="op" id="4285077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4285080">//&nbsp;Our&nbsp;level.&nbsp;&nbsp;for&nbsp;better&nbsp;printing</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285116">level</span>&nbsp;<span class="builtintype" id="4285122">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4285130">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;last&nbsp;node&nbsp;at&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285179">lastFreq</span>&nbsp;<span class="builtintype" id="4285188">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4285196">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;character&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285257">nextCharFreq</span>&nbsp;<span class="builtintype" id="4285270">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4285278">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;pair&nbsp;(from&nbsp;level&nbsp;below)&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4285354">//&nbsp;Only&nbsp;valid&nbsp;if&nbsp;the&nbsp;&#34;needed&#34;&nbsp;value&nbsp;of&nbsp;the&nbsp;next&nbsp;lower&nbsp;level&nbsp;is&nbsp;0.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285421">nextPairFreq</span>&nbsp;<span class="builtintype" id="4285434">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4285442">//&nbsp;The&nbsp;number&nbsp;of&nbsp;chains&nbsp;remaining&nbsp;to&nbsp;generate&nbsp;for&nbsp;this&nbsp;level&nbsp;before&nbsp;moving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4285518">//&nbsp;up&nbsp;to&nbsp;the&nbsp;next&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285543">needed</span>&nbsp;<span class="builtintype" id="4285550">int32</span><br>
<span class="lineno">40</span><span class="op" id="4285556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4285559">func</span>&nbsp;<span class="ident" id="4285564">maxNode</span><span class="op" id="4285571">(</span><span class="op" id="4285572">)</span>&nbsp;<span class="ident" id="4285574">literalNode</span>&nbsp;<span class="op" id="4285586">{</span>&nbsp;<span class="keyword" id="4285588">return</span>&nbsp;<span class="ident" id="4285595">literalNode</span><span class="op" id="4285606">{</span><span class="ident" id="4285607">math</span><span class="op" id="4285611">.</span><span class="ident" id="4285612">MaxUint16</span><span class="op" id="4285621">,</span>&nbsp;<span class="ident" id="4285623">math</span><span class="op" id="4285627">.</span><span class="ident" id="4285628">MaxInt32</span><span class="op" id="4285636">}</span>&nbsp;<span class="op" id="4285638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4285641">func</span>&nbsp;<span class="ident" id="4285646">newHuffmanEncoder</span><span class="op" id="4285663">(</span><span class="ident" id="4285664">size</span>&nbsp;<span class="builtintype" id="4285669">int</span><span class="op" id="4285672">)</span>&nbsp;<span class="op" id="4285674">*</span><span class="ident" id="4285675">huffmanEncoder</span>&nbsp;<span class="op" id="4285690">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285693">return</span>&nbsp;<span class="op" id="4285700">&amp;</span><span class="ident" id="4285701">huffmanEncoder</span><span class="op" id="4285715">{</span><span class="builtinfunc" id="4285716">make</span><span class="op" id="4285720">(</span><span class="op" id="4285721">[</span><span class="op" id="4285722">]</span><span class="builtintype" id="4285723">uint8</span><span class="op" id="4285728">,</span>&nbsp;<span class="ident" id="4285730">size</span><span class="op" id="4285734">)</span><span class="op" id="4285735">,</span>&nbsp;<span class="builtinfunc" id="4285737">make</span><span class="op" id="4285741">(</span><span class="op" id="4285742">[</span><span class="op" id="4285743">]</span><span class="builtintype" id="4285744">uint16</span><span class="op" id="4285750">,</span>&nbsp;<span class="ident" id="4285752">size</span><span class="op" id="4285756">)</span><span class="op" id="4285757">}</span><br>
<span class="lineno"></span><span class="op" id="4285759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4285762">//&nbsp;Generates&nbsp;a&nbsp;HuffmanCode&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;fixed&nbsp;literal&nbsp;table</span><br>
<span class="lineno"></span><span class="keyword" id="4285830">func</span>&nbsp;<span class="ident" id="4285835">generateFixedLiteralEncoding</span><span class="op" id="4285863">(</span><span class="op" id="4285864">)</span>&nbsp;<span class="op" id="4285866">*</span><span class="ident" id="4285867">huffmanEncoder</span>&nbsp;<span class="op" id="4285882">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285885">h</span>&nbsp;<span class="op" id="4285887">:=</span>&nbsp;<span class="ident" id="4285890">newHuffmanEncoder</span><span class="op" id="4285907">(</span><span class="ident" id="4285908">maxLit</span><span class="op" id="4285914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285917">codeBits</span>&nbsp;<span class="op" id="4285926">:=</span>&nbsp;<span class="ident" id="4285929">h</span><span class="op" id="4285930">.</span><span class="ident" id="4285931">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285941">code</span>&nbsp;<span class="op" id="4285946">:=</span>&nbsp;<span class="ident" id="4285949">h</span><span class="op" id="4285950">.</span><span class="ident" id="4285951">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285957">var</span>&nbsp;<span class="ident" id="4285961">ch</span>&nbsp;<span class="builtintype" id="4285964">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285972">for</span>&nbsp;<span class="ident" id="4285976">ch</span>&nbsp;<span class="op" id="4285979">=</span>&nbsp;<span class="num" id="4285981">0</span><span class="op" id="4285982">;</span>&nbsp;<span class="ident" id="4285984">ch</span>&nbsp;<span class="op" id="4285987">&lt;</span>&nbsp;<span class="ident" id="4285989">maxLit</span><span class="op" id="4285995">;</span>&nbsp;<span class="ident" id="4285997">ch</span><span class="op" id="4285999">++</span>&nbsp;<span class="op" id="4286002">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286006">var</span>&nbsp;<span class="ident" id="4286010">bits</span>&nbsp;<span class="builtintype" id="4286015">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286024">var</span>&nbsp;<span class="ident" id="4286028">size</span>&nbsp;<span class="builtintype" id="4286033">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286041">switch</span>&nbsp;<span class="op" id="4286048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286052">case</span>&nbsp;<span class="ident" id="4286057">ch</span>&nbsp;<span class="op" id="4286060">&lt;</span>&nbsp;<span class="num" id="4286062">144</span><span class="op" id="4286065">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4286070">//&nbsp;size&nbsp;8,&nbsp;000110000&nbsp;&nbsp;..&nbsp;10111111</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286107">bits</span>&nbsp;<span class="op" id="4286112">=</span>&nbsp;<span class="ident" id="4286114">ch</span>&nbsp;<span class="op" id="4286117">+</span>&nbsp;<span class="num" id="4286119">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286125">size</span>&nbsp;<span class="op" id="4286130">=</span>&nbsp;<span class="num" id="4286132">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286137">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286145">case</span>&nbsp;<span class="ident" id="4286150">ch</span>&nbsp;<span class="op" id="4286153">&lt;</span>&nbsp;<span class="num" id="4286155">256</span><span class="op" id="4286158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4286163">//&nbsp;size&nbsp;9,&nbsp;110010000&nbsp;..&nbsp;111111111</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286200">bits</span>&nbsp;<span class="op" id="4286205">=</span>&nbsp;<span class="ident" id="4286207">ch</span>&nbsp;<span class="op" id="4286210">+</span>&nbsp;<span class="num" id="4286212">400</span>&nbsp;<span class="op" id="4286216">-</span>&nbsp;<span class="num" id="4286218">144</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286225">size</span>&nbsp;<span class="op" id="4286230">=</span>&nbsp;<span class="num" id="4286232">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286237">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286245">case</span>&nbsp;<span class="ident" id="4286250">ch</span>&nbsp;<span class="op" id="4286253">&lt;</span>&nbsp;<span class="num" id="4286255">280</span><span class="op" id="4286258">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4286263">//&nbsp;size&nbsp;7,&nbsp;0000000&nbsp;..&nbsp;0010111</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286296">bits</span>&nbsp;<span class="op" id="4286301">=</span>&nbsp;<span class="ident" id="4286303">ch</span>&nbsp;<span class="op" id="4286306">-</span>&nbsp;<span class="num" id="4286308">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286315">size</span>&nbsp;<span class="op" id="4286320">=</span>&nbsp;<span class="num" id="4286322">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286327">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286335">default</span><span class="op" id="4286342">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4286347">//&nbsp;size&nbsp;8,&nbsp;11000000&nbsp;..&nbsp;11000111</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286382">bits</span>&nbsp;<span class="op" id="4286387">=</span>&nbsp;<span class="ident" id="4286389">ch</span>&nbsp;<span class="op" id="4286392">+</span>&nbsp;<span class="num" id="4286394">192</span>&nbsp;<span class="op" id="4286398">-</span>&nbsp;<span class="num" id="4286400">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286407">size</span>&nbsp;<span class="op" id="4286412">=</span>&nbsp;<span class="num" id="4286414">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4286418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286422">codeBits</span><span class="op" id="4286430">[</span><span class="ident" id="4286431">ch</span><span class="op" id="4286433">]</span>&nbsp;<span class="op" id="4286435">=</span>&nbsp;<span class="ident" id="4286437">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286444">code</span><span class="op" id="4286448">[</span><span class="ident" id="4286449">ch</span><span class="op" id="4286451">]</span>&nbsp;<span class="op" id="4286453">=</span>&nbsp;<span class="ident" id="4286455">reverseBits</span><span class="op" id="4286466">(</span><span class="ident" id="4286467">bits</span><span class="op" id="4286471">,</span>&nbsp;<span class="ident" id="4286473">size</span><span class="op" id="4286477">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4286480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286483">return</span>&nbsp;<span class="ident" id="4286490">h</span><br>
<span class="lineno"></span><span class="op" id="4286492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4286495">func</span>&nbsp;<span class="ident" id="4286500">generateFixedOffsetEncoding</span><span class="op" id="4286527">(</span><span class="op" id="4286528">)</span>&nbsp;<span class="op" id="4286530">*</span><span class="ident" id="4286531">huffmanEncoder</span>&nbsp;<span class="op" id="4286546">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286549">h</span>&nbsp;<span class="op" id="4286551">:=</span>&nbsp;<span class="ident" id="4286554">newHuffmanEncoder</span><span class="op" id="4286571">(</span><span class="num" id="4286572">30</span><span class="op" id="4286574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286577">codeBits</span>&nbsp;<span class="op" id="4286586">:=</span>&nbsp;<span class="ident" id="4286589">h</span><span class="op" id="4286590">.</span><span class="ident" id="4286591">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286601">code</span>&nbsp;<span class="op" id="4286606">:=</span>&nbsp;<span class="ident" id="4286609">h</span><span class="op" id="4286610">.</span><span class="ident" id="4286611">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286617">for</span>&nbsp;<span class="ident" id="4286621">ch</span>&nbsp;<span class="op" id="4286624">:=</span>&nbsp;<span class="builtintype" id="4286627">uint16</span><span class="op" id="4286633">(</span><span class="num" id="4286634">0</span><span class="op" id="4286635">)</span><span class="op" id="4286636">;</span>&nbsp;<span class="ident" id="4286638">ch</span>&nbsp;<span class="op" id="4286641">&lt;</span>&nbsp;<span class="num" id="4286643">30</span><span class="op" id="4286645">;</span>&nbsp;<span class="ident" id="4286647">ch</span><span class="op" id="4286649">++</span>&nbsp;<span class="op" id="4286652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286656">codeBits</span><span class="op" id="4286664">[</span><span class="ident" id="4286665">ch</span><span class="op" id="4286667">]</span>&nbsp;<span class="op" id="4286669">=</span>&nbsp;<span class="num" id="4286671">5</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286675">code</span><span class="op" id="4286679">[</span><span class="ident" id="4286680">ch</span><span class="op" id="4286682">]</span>&nbsp;<span class="op" id="4286684">=</span>&nbsp;<span class="ident" id="4286686">reverseBits</span><span class="op" id="4286697">(</span><span class="ident" id="4286698">ch</span><span class="op" id="4286700">,</span>&nbsp;<span class="num" id="4286702">5</span><span class="op" id="4286703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4286706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286709">return</span>&nbsp;<span class="ident" id="4286716">h</span><br>
<span class="lineno"></span><span class="op" id="4286718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4286721">var</span>&nbsp;<span class="ident" id="4286725">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4286746">*</span><span class="ident" id="4286747">huffmanEncoder</span>&nbsp;<span class="op" id="4286762">=</span>&nbsp;<span class="ident" id="4286764">generateFixedLiteralEncoding</span><span class="op" id="4286792">(</span><span class="op" id="4286793">)</span><br>
<span class="lineno"></span><span class="keyword" id="4286795">var</span>&nbsp;<span class="ident" id="4286799">fixedOffsetEncoding</span>&nbsp;<span class="op" id="4286819">*</span><span class="ident" id="4286820">huffmanEncoder</span>&nbsp;<span class="op" id="4286835">=</span>&nbsp;<span class="ident" id="4286837">generateFixedOffsetEncoding</span><span class="op" id="4286864">(</span><span class="op" id="4286865">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4286868">func</span>&nbsp;<span class="op" id="4286873">(</span><span class="ident" id="4286874">h</span>&nbsp;<span class="op" id="4286876">*</span><span class="ident" id="4286877">huffmanEncoder</span><span class="op" id="4286891">)</span>&nbsp;<span class="ident" id="4286893">bitLength</span><span class="op" id="4286902">(</span><span class="ident" id="4286903">freq</span>&nbsp;<span class="op" id="4286908">[</span><span class="op" id="4286909">]</span><span class="builtintype" id="4286910">int32</span><span class="op" id="4286915">)</span>&nbsp;<span class="ident" id="4286917">int64</span>&nbsp;<span class="op" id="4286923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286926">var</span>&nbsp;<span class="ident" id="4286930">total</span>&nbsp;<span class="ident" id="4286936">int64</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286943">for</span>&nbsp;<span class="ident" id="4286947">i</span><span class="op" id="4286948">,</span>&nbsp;<span class="ident" id="4286950">f</span>&nbsp;<span class="op" id="4286952">:=</span>&nbsp;<span class="keyword" id="4286955">range</span>&nbsp;<span class="ident" id="4286961">freq</span>&nbsp;<span class="op" id="4286966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286970">if</span>&nbsp;<span class="ident" id="4286973">f</span>&nbsp;<span class="op" id="4286975">!=</span>&nbsp;<span class="num" id="4286978">0</span>&nbsp;<span class="op" id="4286980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286985">total</span>&nbsp;<span class="op" id="4286991">+=</span>&nbsp;<span class="ident" id="4286994">int64</span><span class="op" id="4286999">(</span><span class="ident" id="4287000">f</span><span class="op" id="4287001">)</span>&nbsp;<span class="op" id="4287003">*</span>&nbsp;<span class="ident" id="4287005">int64</span><span class="op" id="4287010">(</span><span class="ident" id="4287011">h</span><span class="op" id="4287012">.</span><span class="ident" id="4287013">codeBits</span><span class="op" id="4287021">[</span><span class="ident" id="4287022">i</span><span class="op" id="4287023">]</span><span class="op" id="4287024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4287028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4287031">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4287034">return</span>&nbsp;<span class="ident" id="4287041">total</span><br>
<span class="lineno"></span><span class="op" id="4287047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4287050">const</span>&nbsp;<span class="ident" id="4287056">maxBitsLimit</span>&nbsp;<span class="op" id="4287069">=</span>&nbsp;<span class="num" id="4287071">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="4287075">//&nbsp;Return&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;assigned&nbsp;to&nbsp;each&nbsp;bit&nbsp;size&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="4287158">//</span><br>
<span class="lineno"></span><span class="comment" id="4287161">//&nbsp;This&nbsp;method&nbsp;is&nbsp;only&nbsp;called&nbsp;when&nbsp;list.length&nbsp;&gt;=&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="4287213">//&nbsp;The&nbsp;cases&nbsp;of&nbsp;0,&nbsp;1,&nbsp;and&nbsp;2&nbsp;literals&nbsp;are&nbsp;handled&nbsp;by&nbsp;special&nbsp;case&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4287284">//</span><br>
<span class="lineno">115</span><span class="comment" id="4287287">//&nbsp;list&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;the&nbsp;literals&nbsp;with&nbsp;non-zero&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4287347">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;their&nbsp;associated&nbsp;frequencies.&nbsp;&nbsp;The&nbsp;array&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing</span><br>
<span class="lineno"></span><span class="comment" id="4287433">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frequency,&nbsp;and&nbsp;has&nbsp;as&nbsp;its&nbsp;last&nbsp;element&nbsp;a&nbsp;special&nbsp;element&nbsp;with&nbsp;frequency</span><br>
<span class="lineno"></span><span class="comment" id="4287520">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MaxInt32</span><br>
<span class="lineno"></span><span class="comment" id="4287544">//&nbsp;maxBits&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;that&nbsp;should&nbsp;be&nbsp;used&nbsp;to&nbsp;encode&nbsp;any&nbsp;literal.</span><br>
<span class="lineno">120</span><span class="comment" id="4287629">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Must&nbsp;be&nbsp;less&nbsp;than&nbsp;16.</span><br>
<span class="lineno"></span><span class="comment" id="4287666">//&nbsp;return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An&nbsp;integer&nbsp;array&nbsp;in&nbsp;which&nbsp;array[i]&nbsp;indicates&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span><span class="comment" id="4287749">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;should&nbsp;be&nbsp;encoded&nbsp;in&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4287798">func</span>&nbsp;<span class="op" id="4287803">(</span><span class="ident" id="4287804">h</span>&nbsp;<span class="op" id="4287806">*</span><span class="ident" id="4287807">huffmanEncoder</span><span class="op" id="4287821">)</span>&nbsp;<span class="ident" id="4287823">bitCounts</span><span class="op" id="4287832">(</span><span class="ident" id="4287833">list</span>&nbsp;<span class="op" id="4287838">[</span><span class="op" id="4287839">]</span><span class="ident" id="4287840">literalNode</span><span class="op" id="4287851">,</span>&nbsp;<span class="ident" id="4287853">maxBits</span>&nbsp;<span class="builtintype" id="4287861">int32</span><span class="op" id="4287866">)</span>&nbsp;<span class="op" id="4287868">[</span><span class="op" id="4287869">]</span><span class="builtintype" id="4287870">int32</span>&nbsp;<span class="op" id="4287876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4287879">if</span>&nbsp;<span class="ident" id="4287882">maxBits</span>&nbsp;<span class="op" id="4287890">&gt;=</span>&nbsp;<span class="ident" id="4287893">maxBitsLimit</span>&nbsp;<span class="op" id="4287906">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4287910">panic</span><span class="op" id="4287915">(</span><span class="string" id="4287916">&#34;flate:&nbsp;maxBits&nbsp;too&nbsp;large&#34;</span><span class="op" id="4287942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4287945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287948">n</span>&nbsp;<span class="op" id="4287950">:=</span>&nbsp;<span class="builtintype" id="4287953">int32</span><span class="op" id="4287958">(</span><span class="builtinfunc" id="4287959">len</span><span class="op" id="4287962">(</span><span class="ident" id="4287963">list</span><span class="op" id="4287967">)</span><span class="op" id="4287968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287971">list</span>&nbsp;<span class="op" id="4287976">=</span>&nbsp;<span class="ident" id="4287978">list</span><span class="op" id="4287982">[</span><span class="num" id="4287983">0</span>&nbsp;<span class="op" id="4287985">:</span>&nbsp;<span class="ident" id="4287987">n</span><span class="op" id="4287988">+</span><span class="num" id="4287989">1</span><span class="op" id="4287990">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287993">list</span><span class="op" id="4287997">[</span><span class="ident" id="4287998">n</span><span class="op" id="4287999">]</span>&nbsp;<span class="op" id="4288001">=</span>&nbsp;<span class="ident" id="4288003">maxNode</span><span class="op" id="4288010">(</span><span class="op" id="4288011">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4288015">//&nbsp;The&nbsp;tree&nbsp;can&#39;t&nbsp;have&nbsp;greater&nbsp;depth&nbsp;than&nbsp;n&nbsp;-&nbsp;1,&nbsp;no&nbsp;matter&nbsp;what.&nbsp;&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4288087">//&nbsp;saves&nbsp;a&nbsp;little&nbsp;bit&nbsp;of&nbsp;work&nbsp;in&nbsp;some&nbsp;small&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288138">if</span>&nbsp;<span class="ident" id="4288141">maxBits</span>&nbsp;<span class="op" id="4288149">&gt;</span>&nbsp;<span class="ident" id="4288151">n</span><span class="op" id="4288152">-</span><span class="num" id="4288153">1</span>&nbsp;<span class="op" id="4288155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288159">maxBits</span>&nbsp;<span class="op" id="4288167">=</span>&nbsp;<span class="ident" id="4288169">n</span>&nbsp;<span class="op" id="4288171">-</span>&nbsp;<span class="num" id="4288173">1</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4288176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4288180">//&nbsp;Create&nbsp;information&nbsp;about&nbsp;each&nbsp;of&nbsp;the&nbsp;levels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4288229">//&nbsp;A&nbsp;bogus&nbsp;&#34;Level&nbsp;0&#34;&nbsp;whose&nbsp;sole&nbsp;purpose&nbsp;is&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4288281">//&nbsp;level1.prev.needed==0.&nbsp;&nbsp;This&nbsp;makes&nbsp;level1.nextPairFreq</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4288340">//&nbsp;be&nbsp;a&nbsp;legitimate&nbsp;value&nbsp;that&nbsp;never&nbsp;gets&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288390">var</span>&nbsp;<span class="ident" id="4288394">levels</span>&nbsp;<span class="op" id="4288401">[</span><span class="ident" id="4288402">maxBitsLimit</span><span class="op" id="4288414">]</span><span class="ident" id="4288415">levelInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4288426">//&nbsp;leafCounts[i]&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4288486">//&nbsp;of&nbsp;ancestors&nbsp;of&nbsp;the&nbsp;rightmost&nbsp;node&nbsp;at&nbsp;level&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4288537">//&nbsp;leafCounts[i][j]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4288596">//&nbsp;of&nbsp;the&nbsp;level&nbsp;j&nbsp;ancestor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288625">var</span>&nbsp;<span class="ident" id="4288629">leafCounts</span>&nbsp;<span class="op" id="4288640">[</span><span class="ident" id="4288641">maxBitsLimit</span><span class="op" id="4288653">]</span><span class="op" id="4288654">[</span><span class="ident" id="4288655">maxBitsLimit</span><span class="op" id="4288667">]</span><span class="builtintype" id="4288668">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288676">for</span>&nbsp;<span class="ident" id="4288680">level</span>&nbsp;<span class="op" id="4288686">:=</span>&nbsp;<span class="builtintype" id="4288689">int32</span><span class="op" id="4288694">(</span><span class="num" id="4288695">1</span><span class="op" id="4288696">)</span><span class="op" id="4288697">;</span>&nbsp;<span class="ident" id="4288699">level</span>&nbsp;<span class="op" id="4288705">&lt;=</span>&nbsp;<span class="ident" id="4288708">maxBits</span><span class="op" id="4288715">;</span>&nbsp;<span class="ident" id="4288717">level</span><span class="op" id="4288722">++</span>&nbsp;<span class="op" id="4288725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4288729">//&nbsp;For&nbsp;every&nbsp;level,&nbsp;the&nbsp;first&nbsp;two&nbsp;items&nbsp;are&nbsp;the&nbsp;first&nbsp;two&nbsp;characters.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4288801">//&nbsp;We&nbsp;initialize&nbsp;the&nbsp;levels&nbsp;as&nbsp;if&nbsp;we&nbsp;had&nbsp;already&nbsp;figured&nbsp;this&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288870">levels</span><span class="op" id="4288876">[</span><span class="ident" id="4288877">level</span><span class="op" id="4288882">]</span>&nbsp;<span class="op" id="4288884">=</span>&nbsp;<span class="ident" id="4288886">levelInfo</span><span class="op" id="4288895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288900">level</span><span class="op" id="4288905">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4288914">level</span><span class="op" id="4288919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288924">lastFreq</span><span class="op" id="4288932">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4288938">list</span><span class="op" id="4288942">[</span><span class="num" id="4288943">1</span><span class="op" id="4288944">]</span><span class="op" id="4288945">.</span><span class="ident" id="4288946">freq</span><span class="op" id="4288950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288955">nextCharFreq</span><span class="op" id="4288967">:</span>&nbsp;<span class="ident" id="4288969">list</span><span class="op" id="4288973">[</span><span class="num" id="4288974">2</span><span class="op" id="4288975">]</span><span class="op" id="4288976">.</span><span class="ident" id="4288977">freq</span><span class="op" id="4288981">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288986">nextPairFreq</span><span class="op" id="4288998">:</span>&nbsp;<span class="ident" id="4289000">list</span><span class="op" id="4289004">[</span><span class="num" id="4289005">0</span><span class="op" id="4289006">]</span><span class="op" id="4289007">.</span><span class="ident" id="4289008">freq</span>&nbsp;<span class="op" id="4289013">+</span>&nbsp;<span class="ident" id="4289015">list</span><span class="op" id="4289019">[</span><span class="num" id="4289020">1</span><span class="op" id="4289021">]</span><span class="op" id="4289022">.</span><span class="ident" id="4289023">freq</span><span class="op" id="4289027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289035">leafCounts</span><span class="op" id="4289045">[</span><span class="ident" id="4289046">level</span><span class="op" id="4289051">]</span><span class="op" id="4289052">[</span><span class="ident" id="4289053">level</span><span class="op" id="4289058">]</span>&nbsp;<span class="op" id="4289060">=</span>&nbsp;<span class="num" id="4289062">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289066">if</span>&nbsp;<span class="ident" id="4289069">level</span>&nbsp;<span class="op" id="4289075">==</span>&nbsp;<span class="num" id="4289078">1</span>&nbsp;<span class="op" id="4289080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289085">levels</span><span class="op" id="4289091">[</span><span class="ident" id="4289092">level</span><span class="op" id="4289097">]</span><span class="op" id="4289098">.</span><span class="ident" id="4289099">nextPairFreq</span>&nbsp;<span class="op" id="4289112">=</span>&nbsp;<span class="ident" id="4289114">math</span><span class="op" id="4289118">.</span><span class="ident" id="4289119">MaxInt32</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4289137">//&nbsp;We&nbsp;need&nbsp;a&nbsp;total&nbsp;of&nbsp;2*n&nbsp;-&nbsp;2&nbsp;items&nbsp;at&nbsp;top&nbsp;level&nbsp;and&nbsp;have&nbsp;already&nbsp;generated&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289217">levels</span><span class="op" id="4289223">[</span><span class="ident" id="4289224">maxBits</span><span class="op" id="4289231">]</span><span class="op" id="4289232">.</span><span class="ident" id="4289233">needed</span>&nbsp;<span class="op" id="4289240">=</span>&nbsp;<span class="num" id="4289242">2</span><span class="op" id="4289243">*</span><span class="ident" id="4289244">n</span>&nbsp;<span class="op" id="4289246">-</span>&nbsp;<span class="num" id="4289248">4</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289252">level</span>&nbsp;<span class="op" id="4289258">:=</span>&nbsp;<span class="ident" id="4289261">maxBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289270">for</span>&nbsp;<span class="op" id="4289274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289278">l</span>&nbsp;<span class="op" id="4289280">:=</span>&nbsp;<span class="op" id="4289283">&amp;</span><span class="ident" id="4289284">levels</span><span class="op" id="4289290">[</span><span class="ident" id="4289291">level</span><span class="op" id="4289296">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289300">if</span>&nbsp;<span class="ident" id="4289303">l</span><span class="op" id="4289304">.</span><span class="ident" id="4289305">nextPairFreq</span>&nbsp;<span class="op" id="4289318">==</span>&nbsp;<span class="ident" id="4289321">math</span><span class="op" id="4289325">.</span><span class="ident" id="4289326">MaxInt32</span>&nbsp;<span class="op" id="4289335">&amp;&amp;</span>&nbsp;<span class="ident" id="4289338">l</span><span class="op" id="4289339">.</span><span class="ident" id="4289340">nextCharFreq</span>&nbsp;<span class="op" id="4289353">==</span>&nbsp;<span class="ident" id="4289356">math</span><span class="op" id="4289360">.</span><span class="ident" id="4289361">MaxInt32</span>&nbsp;<span class="op" id="4289370">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4289375">//&nbsp;We&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;both&nbsp;leafs&nbsp;and&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4289420">//&nbsp;End&nbsp;all&nbsp;calculations&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4289463">//&nbsp;To&nbsp;make&nbsp;sure&nbsp;we&nbsp;never&nbsp;come&nbsp;back&nbsp;to&nbsp;this&nbsp;level&nbsp;or&nbsp;any&nbsp;lower&nbsp;level,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4289535">//&nbsp;set&nbsp;nextPairFreq&nbsp;impossibly&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289576">l</span><span class="op" id="4289577">.</span><span class="ident" id="4289578">needed</span>&nbsp;<span class="op" id="4289585">=</span>&nbsp;<span class="num" id="4289587">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289592">levels</span><span class="op" id="4289598">[</span><span class="ident" id="4289599">level</span><span class="op" id="4289604">+</span><span class="num" id="4289605">1</span><span class="op" id="4289606">]</span><span class="op" id="4289607">.</span><span class="ident" id="4289608">nextPairFreq</span>&nbsp;<span class="op" id="4289621">=</span>&nbsp;<span class="ident" id="4289623">math</span><span class="op" id="4289627">.</span><span class="ident" id="4289628">MaxInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289640">level</span><span class="op" id="4289645">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289651">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289667">prevFreq</span>&nbsp;<span class="op" id="4289676">:=</span>&nbsp;<span class="ident" id="4289679">l</span><span class="op" id="4289680">.</span><span class="ident" id="4289681">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289692">if</span>&nbsp;<span class="ident" id="4289695">l</span><span class="op" id="4289696">.</span><span class="ident" id="4289697">nextCharFreq</span>&nbsp;<span class="op" id="4289710">&lt;</span>&nbsp;<span class="ident" id="4289712">l</span><span class="op" id="4289713">.</span><span class="ident" id="4289714">nextPairFreq</span>&nbsp;<span class="op" id="4289727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4289732">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;leaf&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289780">n</span>&nbsp;<span class="op" id="4289782">:=</span>&nbsp;<span class="ident" id="4289785">leafCounts</span><span class="op" id="4289795">[</span><span class="ident" id="4289796">level</span><span class="op" id="4289801">]</span><span class="op" id="4289802">[</span><span class="ident" id="4289803">level</span><span class="op" id="4289808">]</span>&nbsp;<span class="op" id="4289810">+</span>&nbsp;<span class="num" id="4289812">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289817">l</span><span class="op" id="4289818">.</span><span class="ident" id="4289819">lastFreq</span>&nbsp;<span class="op" id="4289828">=</span>&nbsp;<span class="ident" id="4289830">l</span><span class="op" id="4289831">.</span><span class="ident" id="4289832">nextCharFreq</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4289848">//&nbsp;Lower&nbsp;leafCounts&nbsp;are&nbsp;the&nbsp;same&nbsp;of&nbsp;the&nbsp;previous&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289906">leafCounts</span><span class="op" id="4289916">[</span><span class="ident" id="4289917">level</span><span class="op" id="4289922">]</span><span class="op" id="4289923">[</span><span class="ident" id="4289924">level</span><span class="op" id="4289929">]</span>&nbsp;<span class="op" id="4289931">=</span>&nbsp;<span class="ident" id="4289933">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289938">l</span><span class="op" id="4289939">.</span><span class="ident" id="4289940">nextCharFreq</span>&nbsp;<span class="op" id="4289953">=</span>&nbsp;<span class="ident" id="4289955">list</span><span class="op" id="4289959">[</span><span class="ident" id="4289960">n</span><span class="op" id="4289961">]</span><span class="op" id="4289962">.</span><span class="ident" id="4289963">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289970">}</span>&nbsp;<span class="keyword" id="4289972">else</span>&nbsp;<span class="op" id="4289977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4289982">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;pair&nbsp;from&nbsp;the&nbsp;previous&nbsp;row.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4290047">//&nbsp;nextPairFreq&nbsp;isn&#39;t&nbsp;valid&nbsp;until&nbsp;we&nbsp;generate&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4290100">//&nbsp;more&nbsp;values&nbsp;in&nbsp;the&nbsp;level&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290137">l</span><span class="op" id="4290138">.</span><span class="ident" id="4290139">lastFreq</span>&nbsp;<span class="op" id="4290148">=</span>&nbsp;<span class="ident" id="4290150">l</span><span class="op" id="4290151">.</span><span class="ident" id="4290152">nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4290168">//&nbsp;Take&nbsp;leaf&nbsp;counts&nbsp;from&nbsp;the&nbsp;lower&nbsp;level,&nbsp;except&nbsp;counts[level]&nbsp;remains&nbsp;the&nbsp;same.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4290252">copy</span><span class="op" id="4290256">(</span><span class="ident" id="4290257">leafCounts</span><span class="op" id="4290267">[</span><span class="ident" id="4290268">level</span><span class="op" id="4290273">]</span><span class="op" id="4290274">[</span><span class="op" id="4290275">:</span><span class="ident" id="4290276">level</span><span class="op" id="4290281">]</span><span class="op" id="4290282">,</span>&nbsp;<span class="ident" id="4290284">leafCounts</span><span class="op" id="4290294">[</span><span class="ident" id="4290295">level</span><span class="op" id="4290300">-</span><span class="num" id="4290301">1</span><span class="op" id="4290302">]</span><span class="op" id="4290303">[</span><span class="op" id="4290304">:</span><span class="ident" id="4290305">level</span><span class="op" id="4290310">]</span><span class="op" id="4290311">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290316">levels</span><span class="op" id="4290322">[</span><span class="ident" id="4290323">l</span><span class="op" id="4290324">.</span><span class="ident" id="4290325">level</span><span class="op" id="4290330">-</span><span class="num" id="4290331">1</span><span class="op" id="4290332">]</span><span class="op" id="4290333">.</span><span class="ident" id="4290334">needed</span>&nbsp;<span class="op" id="4290341">=</span>&nbsp;<span class="num" id="4290343">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290352">if</span>&nbsp;<span class="ident" id="4290355">l</span><span class="op" id="4290356">.</span><span class="ident" id="4290357">needed</span><span class="op" id="4290363">--</span><span class="op" id="4290365">;</span>&nbsp;<span class="ident" id="4290367">l</span><span class="op" id="4290368">.</span><span class="ident" id="4290369">needed</span>&nbsp;<span class="op" id="4290376">==</span>&nbsp;<span class="num" id="4290379">0</span>&nbsp;<span class="op" id="4290381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4290386">//&nbsp;We&#39;ve&nbsp;done&nbsp;everything&nbsp;we&nbsp;need&nbsp;to&nbsp;do&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4290444">//&nbsp;Continue&nbsp;calculating&nbsp;one&nbsp;level&nbsp;up.&nbsp;&nbsp;Fill&nbsp;in&nbsp;nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4290507">//&nbsp;of&nbsp;that&nbsp;level&nbsp;with&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;two&nbsp;nodes&nbsp;we&#39;ve&nbsp;just&nbsp;calculated&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4290582">//&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290600">if</span>&nbsp;<span class="ident" id="4290603">l</span><span class="op" id="4290604">.</span><span class="ident" id="4290605">level</span>&nbsp;<span class="op" id="4290611">==</span>&nbsp;<span class="ident" id="4290614">maxBits</span>&nbsp;<span class="op" id="4290622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4290628">//&nbsp;All&nbsp;done!</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290645">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290659">levels</span><span class="op" id="4290665">[</span><span class="ident" id="4290666">l</span><span class="op" id="4290667">.</span><span class="ident" id="4290668">level</span><span class="op" id="4290673">+</span><span class="num" id="4290674">1</span><span class="op" id="4290675">]</span><span class="op" id="4290676">.</span><span class="ident" id="4290677">nextPairFreq</span>&nbsp;<span class="op" id="4290690">=</span>&nbsp;<span class="ident" id="4290692">prevFreq</span>&nbsp;<span class="op" id="4290701">+</span>&nbsp;<span class="ident" id="4290703">l</span><span class="op" id="4290704">.</span><span class="ident" id="4290705">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290717">level</span><span class="op" id="4290722">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290727">}</span>&nbsp;<span class="keyword" id="4290729">else</span>&nbsp;<span class="op" id="4290734">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4290739">//&nbsp;If&nbsp;we&nbsp;stole&nbsp;from&nbsp;below,&nbsp;move&nbsp;down&nbsp;temporarily&nbsp;to&nbsp;replenish&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290808">for</span>&nbsp;<span class="ident" id="4290812">levels</span><span class="op" id="4290818">[</span><span class="ident" id="4290819">level</span><span class="op" id="4290824">-</span><span class="num" id="4290825">1</span><span class="op" id="4290826">]</span><span class="op" id="4290827">.</span><span class="ident" id="4290828">needed</span>&nbsp;<span class="op" id="4290835">&gt;</span>&nbsp;<span class="num" id="4290837">0</span>&nbsp;<span class="op" id="4290839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290845">level</span><span class="op" id="4290850">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290860">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4290867">//&nbsp;Somethings&nbsp;is&nbsp;wrong&nbsp;if&nbsp;at&nbsp;the&nbsp;end,&nbsp;the&nbsp;top&nbsp;level&nbsp;is&nbsp;null&nbsp;or&nbsp;hasn&#39;t&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4290943">//&nbsp;all&nbsp;of&nbsp;the&nbsp;leaves.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290966">if</span>&nbsp;<span class="ident" id="4290969">leafCounts</span><span class="op" id="4290979">[</span><span class="ident" id="4290980">maxBits</span><span class="op" id="4290987">]</span><span class="op" id="4290988">[</span><span class="ident" id="4290989">maxBits</span><span class="op" id="4290996">]</span>&nbsp;<span class="op" id="4290998">!=</span>&nbsp;<span class="ident" id="4291001">n</span>&nbsp;<span class="op" id="4291003">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4291007">panic</span><span class="op" id="4291012">(</span><span class="string" id="4291013">&#34;leafCounts[maxBits][maxBits]&nbsp;!=&nbsp;n&#34;</span><span class="op" id="4291048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4291051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291055">bitCount</span>&nbsp;<span class="op" id="4291064">:=</span>&nbsp;<span class="builtinfunc" id="4291067">make</span><span class="op" id="4291071">(</span><span class="op" id="4291072">[</span><span class="op" id="4291073">]</span><span class="builtintype" id="4291074">int32</span><span class="op" id="4291079">,</span>&nbsp;<span class="ident" id="4291081">maxBits</span><span class="op" id="4291088">+</span><span class="num" id="4291089">1</span><span class="op" id="4291090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291093">bits</span>&nbsp;<span class="op" id="4291098">:=</span>&nbsp;<span class="num" id="4291101">1</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291104">counts</span>&nbsp;<span class="op" id="4291111">:=</span>&nbsp;<span class="op" id="4291114">&amp;</span><span class="ident" id="4291115">leafCounts</span><span class="op" id="4291125">[</span><span class="ident" id="4291126">maxBits</span><span class="op" id="4291133">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291136">for</span>&nbsp;<span class="ident" id="4291140">level</span>&nbsp;<span class="op" id="4291146">:=</span>&nbsp;<span class="ident" id="4291149">maxBits</span><span class="op" id="4291156">;</span>&nbsp;<span class="ident" id="4291158">level</span>&nbsp;<span class="op" id="4291164">&gt;</span>&nbsp;<span class="num" id="4291166">0</span><span class="op" id="4291167">;</span>&nbsp;<span class="ident" id="4291169">level</span><span class="op" id="4291174">--</span>&nbsp;<span class="op" id="4291177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4291181">//&nbsp;chain.leafCount&nbsp;gives&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;requiring&nbsp;at&nbsp;least&nbsp;&#34;bits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4291257">//&nbsp;bits&nbsp;to&nbsp;encode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291278">bitCount</span><span class="op" id="4291286">[</span><span class="ident" id="4291287">bits</span><span class="op" id="4291291">]</span>&nbsp;<span class="op" id="4291293">=</span>&nbsp;<span class="ident" id="4291295">counts</span><span class="op" id="4291301">[</span><span class="ident" id="4291302">level</span><span class="op" id="4291307">]</span>&nbsp;<span class="op" id="4291309">-</span>&nbsp;<span class="ident" id="4291311">counts</span><span class="op" id="4291317">[</span><span class="ident" id="4291318">level</span><span class="op" id="4291323">-</span><span class="num" id="4291324">1</span><span class="op" id="4291325">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291329">bits</span><span class="op" id="4291333">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4291337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291340">return</span>&nbsp;<span class="ident" id="4291347">bitCount</span><br>
<span class="lineno"></span><span class="op" id="4291356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4291359">//&nbsp;Look&nbsp;at&nbsp;the&nbsp;leaves&nbsp;and&nbsp;assign&nbsp;them&nbsp;a&nbsp;bit&nbsp;count&nbsp;and&nbsp;an&nbsp;encoding&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="4291438">//&nbsp;in&nbsp;RFC&nbsp;1951&nbsp;3.2.2</span><br>
<span class="lineno"></span><span class="keyword" id="4291459">func</span>&nbsp;<span class="op" id="4291464">(</span><span class="ident" id="4291465">h</span>&nbsp;<span class="op" id="4291467">*</span><span class="ident" id="4291468">huffmanEncoder</span><span class="op" id="4291482">)</span>&nbsp;<span class="ident" id="4291484">assignEncodingAndSize</span><span class="op" id="4291505">(</span><span class="ident" id="4291506">bitCount</span>&nbsp;<span class="op" id="4291515">[</span><span class="op" id="4291516">]</span><span class="builtintype" id="4291517">int32</span><span class="op" id="4291522">,</span>&nbsp;<span class="ident" id="4291524">list</span>&nbsp;<span class="op" id="4291529">[</span><span class="op" id="4291530">]</span><span class="ident" id="4291531">literalNode</span><span class="op" id="4291542">)</span>&nbsp;<span class="op" id="4291544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291547">code</span>&nbsp;<span class="op" id="4291552">:=</span>&nbsp;<span class="builtintype" id="4291555">uint16</span><span class="op" id="4291561">(</span><span class="num" id="4291562">0</span><span class="op" id="4291563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291566">for</span>&nbsp;<span class="ident" id="4291570">n</span><span class="op" id="4291571">,</span>&nbsp;<span class="ident" id="4291573">bits</span>&nbsp;<span class="op" id="4291578">:=</span>&nbsp;<span class="keyword" id="4291581">range</span>&nbsp;<span class="ident" id="4291587">bitCount</span>&nbsp;<span class="op" id="4291596">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291600">code</span>&nbsp;<span class="op" id="4291605">&lt;&lt;=</span>&nbsp;<span class="num" id="4291609">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291613">if</span>&nbsp;<span class="ident" id="4291616">n</span>&nbsp;<span class="op" id="4291618">==</span>&nbsp;<span class="num" id="4291621">0</span>&nbsp;<span class="op" id="4291623">||</span>&nbsp;<span class="ident" id="4291626">bits</span>&nbsp;<span class="op" id="4291631">==</span>&nbsp;<span class="num" id="4291634">0</span>&nbsp;<span class="op" id="4291636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291641">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4291652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4291656">//&nbsp;The&nbsp;literals&nbsp;list[len(list)-bits]&nbsp;..&nbsp;list[len(list)-bits]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4291719">//&nbsp;are&nbsp;encoded&nbsp;using&nbsp;&#34;bits&#34;&nbsp;bits,&nbsp;and&nbsp;get&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4291774">//&nbsp;code,&nbsp;code&nbsp;+&nbsp;1,&nbsp;....&nbsp;&nbsp;The&nbsp;code&nbsp;values&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4291821">//&nbsp;assigned&nbsp;in&nbsp;literal&nbsp;order&nbsp;(not&nbsp;frequency&nbsp;order).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291875">chunk</span>&nbsp;<span class="op" id="4291881">:=</span>&nbsp;<span class="ident" id="4291884">list</span><span class="op" id="4291888">[</span><span class="builtinfunc" id="4291889">len</span><span class="op" id="4291892">(</span><span class="ident" id="4291893">list</span><span class="op" id="4291897">)</span><span class="op" id="4291898">-</span><span class="builtintype" id="4291899">int</span><span class="op" id="4291902">(</span><span class="ident" id="4291903">bits</span><span class="op" id="4291907">)</span><span class="op" id="4291908">:</span><span class="op" id="4291909">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291913">sortByLiteral</span><span class="op" id="4291926">(</span><span class="ident" id="4291927">chunk</span><span class="op" id="4291932">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291936">for</span>&nbsp;<span class="ident" id="4291940">_</span><span class="op" id="4291941">,</span>&nbsp;<span class="ident" id="4291943">node</span>&nbsp;<span class="op" id="4291948">:=</span>&nbsp;<span class="keyword" id="4291951">range</span>&nbsp;<span class="ident" id="4291957">chunk</span>&nbsp;<span class="op" id="4291963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291968">h</span><span class="op" id="4291969">.</span><span class="ident" id="4291970">codeBits</span><span class="op" id="4291978">[</span><span class="ident" id="4291979">node</span><span class="op" id="4291983">.</span><span class="ident" id="4291984">literal</span><span class="op" id="4291991">]</span>&nbsp;<span class="op" id="4291993">=</span>&nbsp;<span class="builtintype" id="4291995">uint8</span><span class="op" id="4292000">(</span><span class="ident" id="4292001">n</span><span class="op" id="4292002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292007">h</span><span class="op" id="4292008">.</span><span class="ident" id="4292009">code</span><span class="op" id="4292013">[</span><span class="ident" id="4292014">node</span><span class="op" id="4292018">.</span><span class="ident" id="4292019">literal</span><span class="op" id="4292026">]</span>&nbsp;<span class="op" id="4292028">=</span>&nbsp;<span class="ident" id="4292030">reverseBits</span><span class="op" id="4292041">(</span><span class="ident" id="4292042">code</span><span class="op" id="4292046">,</span>&nbsp;<span class="builtintype" id="4292048">uint8</span><span class="op" id="4292053">(</span><span class="ident" id="4292054">n</span><span class="op" id="4292055">)</span><span class="op" id="4292056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292061">code</span><span class="op" id="4292065">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4292070">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292074">list</span>&nbsp;<span class="op" id="4292079">=</span>&nbsp;<span class="ident" id="4292081">list</span><span class="op" id="4292085">[</span><span class="num" id="4292086">0</span>&nbsp;<span class="op" id="4292088">:</span>&nbsp;<span class="builtinfunc" id="4292090">len</span><span class="op" id="4292093">(</span><span class="ident" id="4292094">list</span><span class="op" id="4292098">)</span><span class="op" id="4292099">-</span><span class="builtintype" id="4292100">int</span><span class="op" id="4292103">(</span><span class="ident" id="4292104">bits</span><span class="op" id="4292108">)</span><span class="op" id="4292109">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4292112">}</span><br>
<span class="lineno"></span><span class="op" id="4292114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4292117">//&nbsp;Update&nbsp;this&nbsp;Huffman&nbsp;Code&nbsp;object&nbsp;to&nbsp;be&nbsp;the&nbsp;minimum&nbsp;code&nbsp;for&nbsp;the&nbsp;specified&nbsp;frequency&nbsp;count.</span><br>
<span class="lineno">260</span><span class="comment" id="4292210">//</span><br>
<span class="lineno"></span><span class="comment" id="4292213">//&nbsp;freq&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;frequencies,&nbsp;in&nbsp;which&nbsp;frequency[i]&nbsp;gives&nbsp;the&nbsp;frequency&nbsp;of&nbsp;literal&nbsp;i.</span><br>
<span class="lineno"></span><span class="comment" id="4292303">//&nbsp;maxBits&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;any&nbsp;literal.</span><br>
<span class="lineno"></span><span class="keyword" id="4292366">func</span>&nbsp;<span class="op" id="4292371">(</span><span class="ident" id="4292372">h</span>&nbsp;<span class="op" id="4292374">*</span><span class="ident" id="4292375">huffmanEncoder</span><span class="op" id="4292389">)</span>&nbsp;<span class="ident" id="4292391">generate</span><span class="op" id="4292399">(</span><span class="ident" id="4292400">freq</span>&nbsp;<span class="op" id="4292405">[</span><span class="op" id="4292406">]</span><span class="builtintype" id="4292407">int32</span><span class="op" id="4292412">,</span>&nbsp;<span class="ident" id="4292414">maxBits</span>&nbsp;<span class="builtintype" id="4292422">int32</span><span class="op" id="4292427">)</span>&nbsp;<span class="op" id="4292429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292432">list</span>&nbsp;<span class="op" id="4292437">:=</span>&nbsp;<span class="builtinfunc" id="4292440">make</span><span class="op" id="4292444">(</span><span class="op" id="4292445">[</span><span class="op" id="4292446">]</span><span class="ident" id="4292447">literalNode</span><span class="op" id="4292458">,</span>&nbsp;<span class="builtinfunc" id="4292460">len</span><span class="op" id="4292463">(</span><span class="ident" id="4292464">freq</span><span class="op" id="4292468">)</span><span class="op" id="4292469">+</span><span class="num" id="4292470">1</span><span class="op" id="4292471">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4292474">//&nbsp;Number&nbsp;of&nbsp;non-zero&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292506">count</span>&nbsp;<span class="op" id="4292512">:=</span>&nbsp;<span class="num" id="4292515">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4292518">//&nbsp;Set&nbsp;list&nbsp;to&nbsp;be&nbsp;the&nbsp;set&nbsp;of&nbsp;all&nbsp;non-zero&nbsp;literals&nbsp;and&nbsp;their&nbsp;frequencies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292592">for</span>&nbsp;<span class="ident" id="4292596">i</span><span class="op" id="4292597">,</span>&nbsp;<span class="ident" id="4292599">f</span>&nbsp;<span class="op" id="4292601">:=</span>&nbsp;<span class="keyword" id="4292604">range</span>&nbsp;<span class="ident" id="4292610">freq</span>&nbsp;<span class="op" id="4292615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292619">if</span>&nbsp;<span class="ident" id="4292622">f</span>&nbsp;<span class="op" id="4292624">!=</span>&nbsp;<span class="num" id="4292627">0</span>&nbsp;<span class="op" id="4292629">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292634">list</span><span class="op" id="4292638">[</span><span class="ident" id="4292639">count</span><span class="op" id="4292644">]</span>&nbsp;<span class="op" id="4292646">=</span>&nbsp;<span class="ident" id="4292648">literalNode</span><span class="op" id="4292659">{</span><span class="builtintype" id="4292660">uint16</span><span class="op" id="4292666">(</span><span class="ident" id="4292667">i</span><span class="op" id="4292668">)</span><span class="op" id="4292669">,</span>&nbsp;<span class="ident" id="4292671">f</span><span class="op" id="4292672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292677">count</span><span class="op" id="4292682">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4292687">}</span>&nbsp;<span class="keyword" id="4292689">else</span>&nbsp;<span class="op" id="4292694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292699">h</span><span class="op" id="4292700">.</span><span class="ident" id="4292701">codeBits</span><span class="op" id="4292709">[</span><span class="ident" id="4292710">i</span><span class="op" id="4292711">]</span>&nbsp;<span class="op" id="4292713">=</span>&nbsp;<span class="num" id="4292715">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4292719">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4292722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4292725">//&nbsp;If&nbsp;freq[]&nbsp;is&nbsp;shorter&nbsp;than&nbsp;codeBits[],&nbsp;fill&nbsp;rest&nbsp;of&nbsp;codeBits[]&nbsp;with&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292802">h</span><span class="op" id="4292803">.</span><span class="ident" id="4292804">codeBits</span>&nbsp;<span class="op" id="4292813">=</span>&nbsp;<span class="ident" id="4292815">h</span><span class="op" id="4292816">.</span><span class="ident" id="4292817">codeBits</span><span class="op" id="4292825">[</span><span class="num" id="4292826">0</span><span class="op" id="4292827">:</span><span class="builtinfunc" id="4292828">len</span><span class="op" id="4292831">(</span><span class="ident" id="4292832">freq</span><span class="op" id="4292836">)</span><span class="op" id="4292837">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4292840">list</span>&nbsp;<span class="op" id="4292845">=</span>&nbsp;<span class="ident" id="4292847">list</span><span class="op" id="4292851">[</span><span class="num" id="4292852">0</span><span class="op" id="4292853">:</span><span class="ident" id="4292854">count</span><span class="op" id="4292859">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4292862">if</span>&nbsp;<span class="ident" id="4292865">count</span>&nbsp;<span class="op" id="4292871">&lt;=</span>&nbsp;<span class="num" id="4292874">2</span>&nbsp;<span class="op" id="4292876">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4292880">//&nbsp;Handle&nbsp;the&nbsp;small&nbsp;cases&nbsp;here,&nbsp;because&nbsp;they&nbsp;are&nbsp;awkward&nbsp;for&nbsp;the&nbsp;general&nbsp;case&nbsp;code.&nbsp;&nbsp;With</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4292972">//&nbsp;two&nbsp;or&nbsp;fewer&nbsp;literals,&nbsp;everything&nbsp;has&nbsp;bit&nbsp;length&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293029">for</span>&nbsp;<span class="ident" id="4293033">i</span><span class="op" id="4293034">,</span>&nbsp;<span class="ident" id="4293036">node</span>&nbsp;<span class="op" id="4293041">:=</span>&nbsp;<span class="keyword" id="4293044">range</span>&nbsp;<span class="ident" id="4293050">list</span>&nbsp;<span class="op" id="4293055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4293060">//&nbsp;&#34;list&#34;&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing&nbsp;literal&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293114">h</span><span class="op" id="4293115">.</span><span class="ident" id="4293116">codeBits</span><span class="op" id="4293124">[</span><span class="ident" id="4293125">node</span><span class="op" id="4293129">.</span><span class="ident" id="4293130">literal</span><span class="op" id="4293137">]</span>&nbsp;<span class="op" id="4293139">=</span>&nbsp;<span class="num" id="4293141">1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293146">h</span><span class="op" id="4293147">.</span><span class="ident" id="4293148">code</span><span class="op" id="4293152">[</span><span class="ident" id="4293153">node</span><span class="op" id="4293157">.</span><span class="ident" id="4293158">literal</span><span class="op" id="4293165">]</span>&nbsp;<span class="op" id="4293167">=</span>&nbsp;<span class="builtintype" id="4293169">uint16</span><span class="op" id="4293175">(</span><span class="ident" id="4293176">i</span><span class="op" id="4293177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293185">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293196">sortByFreq</span><span class="op" id="4293206">(</span><span class="ident" id="4293207">list</span><span class="op" id="4293211">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4293215">//&nbsp;Get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;for&nbsp;each&nbsp;bit&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293265">bitCount</span>&nbsp;<span class="op" id="4293274">:=</span>&nbsp;<span class="ident" id="4293277">h</span><span class="op" id="4293278">.</span><span class="ident" id="4293279">bitCounts</span><span class="op" id="4293288">(</span><span class="ident" id="4293289">list</span><span class="op" id="4293293">,</span>&nbsp;<span class="ident" id="4293295">maxBits</span><span class="op" id="4293302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4293305">//&nbsp;And&nbsp;do&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293331">h</span><span class="op" id="4293332">.</span><span class="ident" id="4293333">assignEncodingAndSize</span><span class="op" id="4293354">(</span><span class="ident" id="4293355">bitCount</span><span class="op" id="4293363">,</span>&nbsp;<span class="ident" id="4293365">list</span><span class="op" id="4293369">)</span><br>
<span class="lineno">295</span><span class="op" id="4293371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4293374">type</span>&nbsp;<span class="ident" id="4293379">literalNodeSorter</span>&nbsp;<span class="keyword" id="4293397">struct</span>&nbsp;<span class="op" id="4293404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293407">a</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4293412">[</span><span class="op" id="4293413">]</span><span class="ident" id="4293414">literalNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293427">less</span>&nbsp;<span class="keyword" id="4293432">func</span><span class="op" id="4293436">(</span><span class="ident" id="4293437">i</span><span class="op" id="4293438">,</span>&nbsp;<span class="ident" id="4293440">j</span>&nbsp;<span class="builtintype" id="4293442">int</span><span class="op" id="4293445">)</span>&nbsp;<span class="builtintype" id="4293447">bool</span><br>
<span class="lineno">300</span><span class="op" id="4293452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4293455">func</span>&nbsp;<span class="op" id="4293460">(</span><span class="ident" id="4293461">s</span>&nbsp;<span class="ident" id="4293463">literalNodeSorter</span><span class="op" id="4293480">)</span>&nbsp;<span class="ident" id="4293482">Len</span><span class="op" id="4293485">(</span><span class="op" id="4293486">)</span>&nbsp;<span class="builtintype" id="4293488">int</span>&nbsp;<span class="op" id="4293492">{</span>&nbsp;<span class="keyword" id="4293494">return</span>&nbsp;<span class="builtinfunc" id="4293501">len</span><span class="op" id="4293504">(</span><span class="ident" id="4293505">s</span><span class="op" id="4293506">.</span><span class="ident" id="4293507">a</span><span class="op" id="4293508">)</span>&nbsp;<span class="op" id="4293510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4293513">func</span>&nbsp;<span class="op" id="4293518">(</span><span class="ident" id="4293519">s</span>&nbsp;<span class="ident" id="4293521">literalNodeSorter</span><span class="op" id="4293538">)</span>&nbsp;<span class="ident" id="4293540">Less</span><span class="op" id="4293544">(</span><span class="ident" id="4293545">i</span><span class="op" id="4293546">,</span>&nbsp;<span class="ident" id="4293548">j</span>&nbsp;<span class="builtintype" id="4293550">int</span><span class="op" id="4293553">)</span>&nbsp;<span class="builtintype" id="4293555">bool</span>&nbsp;<span class="op" id="4293560">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293563">return</span>&nbsp;<span class="ident" id="4293570">s</span><span class="op" id="4293571">.</span><span class="ident" id="4293572">less</span><span class="op" id="4293576">(</span><span class="ident" id="4293577">i</span><span class="op" id="4293578">,</span>&nbsp;<span class="ident" id="4293580">j</span><span class="op" id="4293581">)</span><br>
<span class="lineno"></span><span class="op" id="4293583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4293586">func</span>&nbsp;<span class="op" id="4293591">(</span><span class="ident" id="4293592">s</span>&nbsp;<span class="ident" id="4293594">literalNodeSorter</span><span class="op" id="4293611">)</span>&nbsp;<span class="ident" id="4293613">Swap</span><span class="op" id="4293617">(</span><span class="ident" id="4293618">i</span><span class="op" id="4293619">,</span>&nbsp;<span class="ident" id="4293621">j</span>&nbsp;<span class="builtintype" id="4293623">int</span><span class="op" id="4293626">)</span>&nbsp;<span class="op" id="4293628">{</span>&nbsp;<span class="ident" id="4293630">s</span><span class="op" id="4293631">.</span><span class="ident" id="4293632">a</span><span class="op" id="4293633">[</span><span class="ident" id="4293634">i</span><span class="op" id="4293635">]</span><span class="op" id="4293636">,</span>&nbsp;<span class="ident" id="4293638">s</span><span class="op" id="4293639">.</span><span class="ident" id="4293640">a</span><span class="op" id="4293641">[</span><span class="ident" id="4293642">j</span><span class="op" id="4293643">]</span>&nbsp;<span class="op" id="4293645">=</span>&nbsp;<span class="ident" id="4293647">s</span><span class="op" id="4293648">.</span><span class="ident" id="4293649">a</span><span class="op" id="4293650">[</span><span class="ident" id="4293651">j</span><span class="op" id="4293652">]</span><span class="op" id="4293653">,</span>&nbsp;<span class="ident" id="4293655">s</span><span class="op" id="4293656">.</span><span class="ident" id="4293657">a</span><span class="op" id="4293658">[</span><span class="ident" id="4293659">i</span><span class="op" id="4293660">]</span>&nbsp;<span class="op" id="4293662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="keyword" id="4293665">func</span>&nbsp;<span class="ident" id="4293670">sortByFreq</span><span class="op" id="4293680">(</span><span class="ident" id="4293681">a</span>&nbsp;<span class="op" id="4293683">[</span><span class="op" id="4293684">]</span><span class="ident" id="4293685">literalNode</span><span class="op" id="4293696">)</span>&nbsp;<span class="op" id="4293698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293701">s</span>&nbsp;<span class="op" id="4293703">:=</span>&nbsp;<span class="op" id="4293706">&amp;</span><span class="ident" id="4293707">literalNodeSorter</span><span class="op" id="4293724">{</span><span class="ident" id="4293725">a</span><span class="op" id="4293726">,</span>&nbsp;<span class="keyword" id="4293728">func</span><span class="op" id="4293732">(</span><span class="ident" id="4293733">i</span><span class="op" id="4293734">,</span>&nbsp;<span class="ident" id="4293736">j</span>&nbsp;<span class="builtintype" id="4293738">int</span><span class="op" id="4293741">)</span>&nbsp;<span class="builtintype" id="4293743">bool</span>&nbsp;<span class="op" id="4293748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293752">if</span>&nbsp;<span class="ident" id="4293755">a</span><span class="op" id="4293756">[</span><span class="ident" id="4293757">i</span><span class="op" id="4293758">]</span><span class="op" id="4293759">.</span><span class="ident" id="4293760">freq</span>&nbsp;<span class="op" id="4293765">==</span>&nbsp;<span class="ident" id="4293768">a</span><span class="op" id="4293769">[</span><span class="ident" id="4293770">j</span><span class="op" id="4293771">]</span><span class="op" id="4293772">.</span><span class="ident" id="4293773">freq</span>&nbsp;<span class="op" id="4293778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293783">return</span>&nbsp;<span class="ident" id="4293790">a</span><span class="op" id="4293791">[</span><span class="ident" id="4293792">i</span><span class="op" id="4293793">]</span><span class="op" id="4293794">.</span><span class="ident" id="4293795">literal</span>&nbsp;<span class="op" id="4293803">&lt;</span>&nbsp;<span class="ident" id="4293805">a</span><span class="op" id="4293806">[</span><span class="ident" id="4293807">j</span><span class="op" id="4293808">]</span><span class="op" id="4293809">.</span><span class="ident" id="4293810">literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293820">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4293824">return</span>&nbsp;<span class="ident" id="4293831">a</span><span class="op" id="4293832">[</span><span class="ident" id="4293833">i</span><span class="op" id="4293834">]</span><span class="op" id="4293835">.</span><span class="ident" id="4293836">freq</span>&nbsp;<span class="op" id="4293841">&lt;</span>&nbsp;<span class="ident" id="4293843">a</span><span class="op" id="4293844">[</span><span class="ident" id="4293845">j</span><span class="op" id="4293846">]</span><span class="op" id="4293847">.</span><span class="ident" id="4293848">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4293854">}</span><span class="op" id="4293855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293858">sort</span><span class="op" id="4293862">.</span><span class="ident" id="4293863">Sort</span><span class="op" id="4293867">(</span><span class="ident" id="4293868">s</span><span class="op" id="4293869">)</span><br>
<span class="lineno"></span><span class="op" id="4293871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="keyword" id="4293874">func</span>&nbsp;<span class="ident" id="4293879">sortByLiteral</span><span class="op" id="4293892">(</span><span class="ident" id="4293893">a</span>&nbsp;<span class="op" id="4293895">[</span><span class="op" id="4293896">]</span><span class="ident" id="4293897">literalNode</span><span class="op" id="4293908">)</span>&nbsp;<span class="op" id="4293910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4293913">s</span>&nbsp;<span class="op" id="4293915">:=</span>&nbsp;<span class="op" id="4293918">&amp;</span><span class="ident" id="4293919">literalNodeSorter</span><span class="op" id="4293936">{</span><span class="ident" id="4293937">a</span><span class="op" id="4293938">,</span>&nbsp;<span class="keyword" id="4293940">func</span><span class="op" id="4293944">(</span><span class="ident" id="4293945">i</span><span class="op" id="4293946">,</span>&nbsp;<span class="ident" id="4293948">j</span>&nbsp;<span class="builtintype" id="4293950">int</span><span class="op" id="4293953">)</span>&nbsp;<span class="builtintype" id="4293955">bool</span>&nbsp;<span class="op" id="4293960">{</span>&nbsp;<span class="keyword" id="4293962">return</span>&nbsp;<span class="ident" id="4293969">a</span><span class="op" id="4293970">[</span><span class="ident" id="4293971">i</span><span class="op" id="4293972">]</span><span class="op" id="4293973">.</span><span class="ident" id="4293974">literal</span>&nbsp;<span class="op" id="4293982">&lt;</span>&nbsp;<span class="ident" id="4293984">a</span><span class="op" id="4293985">[</span><span class="ident" id="4293986">j</span><span class="op" id="4293987">]</span><span class="op" id="4293988">.</span><span class="ident" id="4293989">literal</span>&nbsp;<span class="op" id="4293997">}</span><span class="op" id="4293998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294001">sort</span><span class="op" id="4294005">.</span><span class="ident" id="4294006">Sort</span><span class="op" id="4294010">(</span><span class="ident" id="4294011">s</span><span class="op" id="4294012">)</span><br>
<span class="lineno"></span><span class="op" id="4294014">}</span>
</div>
</body>
</html>
