<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8163049">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8163104">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8163158">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8163209">package</span>&nbsp;<span class="ident" id="8163217">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8163227">import</span>&nbsp;<span class="op" id="8163234">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8163237">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8163244">&#34;net/http&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8163256">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8163266">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8163269">func</span>&nbsp;<span class="ident" id="8163274">TestRecorder</span><span class="op" id="8163286">(</span><span class="ident" id="8163287">t</span>&nbsp;<span class="op" id="8163289">*</span><span class="ident" id="8163290">testing</span><span class="op" id="8163297">.</span><span class="ident" id="8163298">T</span><span class="op" id="8163299">)</span>&nbsp;<span class="op" id="8163301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163304">type</span>&nbsp;<span class="ident" id="8163309">checkFunc</span>&nbsp;<span class="keyword" id="8163319">func</span><span class="op" id="8163323">(</span><span class="op" id="8163324">*</span><span class="ident" id="8163325">ResponseRecorder</span><span class="op" id="8163341">)</span>&nbsp;<span class="builtintype" id="8163343">error</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8163350">check</span>&nbsp;<span class="op" id="8163356">:=</span>&nbsp;<span class="keyword" id="8163359">func</span><span class="op" id="8163363">(</span><span class="ident" id="8163364">fns</span>&nbsp;<span class="op" id="8163368">...</span><span class="ident" id="8163371">checkFunc</span><span class="op" id="8163380">)</span>&nbsp;<span class="op" id="8163382">[</span><span class="op" id="8163383">]</span><span class="ident" id="8163384">checkFunc</span>&nbsp;<span class="op" id="8163394">{</span>&nbsp;<span class="keyword" id="8163396">return</span>&nbsp;<span class="ident" id="8163403">fns</span>&nbsp;<span class="op" id="8163407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8163411">hasStatus</span>&nbsp;<span class="op" id="8163421">:=</span>&nbsp;<span class="keyword" id="8163424">func</span><span class="op" id="8163428">(</span><span class="ident" id="8163429">wantCode</span>&nbsp;<span class="builtintype" id="8163438">int</span><span class="op" id="8163441">)</span>&nbsp;<span class="ident" id="8163443">checkFunc</span>&nbsp;<span class="op" id="8163453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163457">return</span>&nbsp;<span class="keyword" id="8163464">func</span><span class="op" id="8163468">(</span><span class="ident" id="8163469">rec</span>&nbsp;<span class="op" id="8163473">*</span><span class="ident" id="8163474">ResponseRecorder</span><span class="op" id="8163490">)</span>&nbsp;<span class="builtintype" id="8163492">error</span>&nbsp;<span class="op" id="8163498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163503">if</span>&nbsp;<span class="ident" id="8163506">rec</span><span class="op" id="8163509">.</span><span class="ident" id="8163510">Code</span>&nbsp;<span class="op" id="8163515">!=</span>&nbsp;<span class="ident" id="8163518">wantCode</span>&nbsp;<span class="op" id="8163527">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163533">return</span>&nbsp;<span class="ident" id="8163540">fmt</span><span class="op" id="8163543">.</span><span class="ident" id="8163544">Errorf</span><span class="op" id="8163550">(</span><span class="string" id="8163551">&#34;Status&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8163573">,</span>&nbsp;<span class="ident" id="8163575">rec</span><span class="op" id="8163578">.</span><span class="ident" id="8163579">Code</span><span class="op" id="8163583">,</span>&nbsp;<span class="ident" id="8163585">wantCode</span><span class="op" id="8163593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8163598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163603">return</span>&nbsp;<span class="ident" id="8163610">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8163616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8163619">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8163622">hasContents</span>&nbsp;<span class="op" id="8163634">:=</span>&nbsp;<span class="keyword" id="8163637">func</span><span class="op" id="8163641">(</span><span class="ident" id="8163642">want</span>&nbsp;<span class="builtintype" id="8163647">string</span><span class="op" id="8163653">)</span>&nbsp;<span class="ident" id="8163655">checkFunc</span>&nbsp;<span class="op" id="8163665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163669">return</span>&nbsp;<span class="keyword" id="8163676">func</span><span class="op" id="8163680">(</span><span class="ident" id="8163681">rec</span>&nbsp;<span class="op" id="8163685">*</span><span class="ident" id="8163686">ResponseRecorder</span><span class="op" id="8163702">)</span>&nbsp;<span class="builtintype" id="8163704">error</span>&nbsp;<span class="op" id="8163710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163715">if</span>&nbsp;<span class="ident" id="8163718">rec</span><span class="op" id="8163721">.</span><span class="ident" id="8163722">Body</span><span class="op" id="8163726">.</span><span class="ident" id="8163727">String</span><span class="op" id="8163733">(</span><span class="op" id="8163734">)</span>&nbsp;<span class="op" id="8163736">!=</span>&nbsp;<span class="ident" id="8163739">want</span>&nbsp;<span class="op" id="8163744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163750">return</span>&nbsp;<span class="ident" id="8163757">fmt</span><span class="op" id="8163760">.</span><span class="ident" id="8163761">Errorf</span><span class="op" id="8163767">(</span><span class="string" id="8163768">&#34;wrote&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8163789">,</span>&nbsp;<span class="ident" id="8163791">rec</span><span class="op" id="8163794">.</span><span class="ident" id="8163795">Body</span><span class="op" id="8163799">.</span><span class="ident" id="8163800">String</span><span class="op" id="8163806">(</span><span class="op" id="8163807">)</span><span class="op" id="8163808">,</span>&nbsp;<span class="ident" id="8163810">want</span><span class="op" id="8163814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8163819">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163824">return</span>&nbsp;<span class="ident" id="8163831">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8163837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8163840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8163843">hasFlush</span>&nbsp;<span class="op" id="8163852">:=</span>&nbsp;<span class="keyword" id="8163855">func</span><span class="op" id="8163859">(</span><span class="ident" id="8163860">want</span>&nbsp;<span class="builtintype" id="8163865">bool</span><span class="op" id="8163869">)</span>&nbsp;<span class="ident" id="8163871">checkFunc</span>&nbsp;<span class="op" id="8163881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163885">return</span>&nbsp;<span class="keyword" id="8163892">func</span><span class="op" id="8163896">(</span><span class="ident" id="8163897">rec</span>&nbsp;<span class="op" id="8163901">*</span><span class="ident" id="8163902">ResponseRecorder</span><span class="op" id="8163918">)</span>&nbsp;<span class="builtintype" id="8163920">error</span>&nbsp;<span class="op" id="8163926">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163931">if</span>&nbsp;<span class="ident" id="8163934">rec</span><span class="op" id="8163937">.</span><span class="ident" id="8163938">Flushed</span>&nbsp;<span class="op" id="8163946">!=</span>&nbsp;<span class="ident" id="8163949">want</span>&nbsp;<span class="op" id="8163954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163960">return</span>&nbsp;<span class="ident" id="8163967">fmt</span><span class="op" id="8163970">.</span><span class="ident" id="8163971">Errorf</span><span class="op" id="8163977">(</span><span class="string" id="8163978">&#34;Flushed&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8164001">,</span>&nbsp;<span class="ident" id="8164003">rec</span><span class="op" id="8164006">.</span><span class="ident" id="8164007">Flushed</span><span class="op" id="8164014">,</span>&nbsp;<span class="ident" id="8164016">want</span><span class="op" id="8164020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164030">return</span>&nbsp;<span class="ident" id="8164037">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164043">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164050">tests</span>&nbsp;<span class="op" id="8164056">:=</span>&nbsp;<span class="op" id="8164059">[</span><span class="op" id="8164060">]</span><span class="keyword" id="8164061">struct</span>&nbsp;<span class="op" id="8164068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164072">name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8164079">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164088">h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8164095">func</span><span class="op" id="8164099">(</span><span class="ident" id="8164100">w</span>&nbsp;<span class="ident" id="8164102">http</span><span class="op" id="8164106">.</span><span class="ident" id="8164107">ResponseWriter</span><span class="op" id="8164121">,</span>&nbsp;<span class="ident" id="8164123">r</span>&nbsp;<span class="op" id="8164125">*</span><span class="ident" id="8164126">http</span><span class="op" id="8164130">.</span><span class="ident" id="8164131">Request</span><span class="op" id="8164138">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164142">checks</span>&nbsp;<span class="op" id="8164149">[</span><span class="op" id="8164150">]</span><span class="ident" id="8164151">checkFunc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164162">}</span><span class="op" id="8164163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8164172">&#34;200&nbsp;default&#34;</span><span class="op" id="8164185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164190">func</span><span class="op" id="8164194">(</span><span class="ident" id="8164195">w</span>&nbsp;<span class="ident" id="8164197">http</span><span class="op" id="8164201">.</span><span class="ident" id="8164202">ResponseWriter</span><span class="op" id="8164216">,</span>&nbsp;<span class="ident" id="8164218">r</span>&nbsp;<span class="op" id="8164220">*</span><span class="ident" id="8164221">http</span><span class="op" id="8164225">.</span><span class="ident" id="8164226">Request</span><span class="op" id="8164233">)</span>&nbsp;<span class="op" id="8164235">{</span><span class="op" id="8164236">}</span><span class="op" id="8164237">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164242">check</span><span class="op" id="8164247">(</span><span class="ident" id="8164248">hasStatus</span><span class="op" id="8164257">(</span><span class="num" id="8164258">200</span><span class="op" id="8164261">)</span><span class="op" id="8164262">,</span>&nbsp;<span class="ident" id="8164264">hasContents</span><span class="op" id="8164275">(</span><span class="string" id="8164276">&#34;&#34;</span><span class="op" id="8164278">)</span><span class="op" id="8164279">)</span><span class="op" id="8164280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164284">}</span><span class="op" id="8164285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8164294">&#34;first&nbsp;code&nbsp;only&#34;</span><span class="op" id="8164311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164316">func</span><span class="op" id="8164320">(</span><span class="ident" id="8164321">w</span>&nbsp;<span class="ident" id="8164323">http</span><span class="op" id="8164327">.</span><span class="ident" id="8164328">ResponseWriter</span><span class="op" id="8164342">,</span>&nbsp;<span class="ident" id="8164344">r</span>&nbsp;<span class="op" id="8164346">*</span><span class="ident" id="8164347">http</span><span class="op" id="8164351">.</span><span class="ident" id="8164352">Request</span><span class="op" id="8164359">)</span>&nbsp;<span class="op" id="8164361">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164367">w</span><span class="op" id="8164368">.</span><span class="ident" id="8164369">WriteHeader</span><span class="op" id="8164380">(</span><span class="num" id="8164381">201</span><span class="op" id="8164384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164390">w</span><span class="op" id="8164391">.</span><span class="ident" id="8164392">WriteHeader</span><span class="op" id="8164403">(</span><span class="num" id="8164404">202</span><span class="op" id="8164407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164413">w</span><span class="op" id="8164414">.</span><span class="ident" id="8164415">Write</span><span class="op" id="8164420">(</span><span class="op" id="8164421">[</span><span class="op" id="8164422">]</span><span class="builtintype" id="8164423">byte</span><span class="op" id="8164427">(</span><span class="string" id="8164428">&#34;hi&#34;</span><span class="op" id="8164432">)</span><span class="op" id="8164433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164438">}</span><span class="op" id="8164439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164444">check</span><span class="op" id="8164449">(</span><span class="ident" id="8164450">hasStatus</span><span class="op" id="8164459">(</span><span class="num" id="8164460">201</span><span class="op" id="8164463">)</span><span class="op" id="8164464">,</span>&nbsp;<span class="ident" id="8164466">hasContents</span><span class="op" id="8164477">(</span><span class="string" id="8164478">&#34;hi&#34;</span><span class="op" id="8164482">)</span><span class="op" id="8164483">)</span><span class="op" id="8164484">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164488">}</span><span class="op" id="8164489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8164498">&#34;write&nbsp;sends&nbsp;200&#34;</span><span class="op" id="8164515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164520">func</span><span class="op" id="8164524">(</span><span class="ident" id="8164525">w</span>&nbsp;<span class="ident" id="8164527">http</span><span class="op" id="8164531">.</span><span class="ident" id="8164532">ResponseWriter</span><span class="op" id="8164546">,</span>&nbsp;<span class="ident" id="8164548">r</span>&nbsp;<span class="op" id="8164550">*</span><span class="ident" id="8164551">http</span><span class="op" id="8164555">.</span><span class="ident" id="8164556">Request</span><span class="op" id="8164563">)</span>&nbsp;<span class="op" id="8164565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164571">w</span><span class="op" id="8164572">.</span><span class="ident" id="8164573">Write</span><span class="op" id="8164578">(</span><span class="op" id="8164579">[</span><span class="op" id="8164580">]</span><span class="builtintype" id="8164581">byte</span><span class="op" id="8164585">(</span><span class="string" id="8164586">&#34;hi&nbsp;first&#34;</span><span class="op" id="8164596">)</span><span class="op" id="8164597">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164603">w</span><span class="op" id="8164604">.</span><span class="ident" id="8164605">WriteHeader</span><span class="op" id="8164616">(</span><span class="num" id="8164617">201</span><span class="op" id="8164620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164626">w</span><span class="op" id="8164627">.</span><span class="ident" id="8164628">WriteHeader</span><span class="op" id="8164639">(</span><span class="num" id="8164640">202</span><span class="op" id="8164643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164648">}</span><span class="op" id="8164649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164654">check</span><span class="op" id="8164659">(</span><span class="ident" id="8164660">hasStatus</span><span class="op" id="8164669">(</span><span class="num" id="8164670">200</span><span class="op" id="8164673">)</span><span class="op" id="8164674">,</span>&nbsp;<span class="ident" id="8164676">hasContents</span><span class="op" id="8164687">(</span><span class="string" id="8164688">&#34;hi&nbsp;first&#34;</span><span class="op" id="8164698">)</span><span class="op" id="8164699">,</span>&nbsp;<span class="ident" id="8164701">hasFlush</span><span class="op" id="8164709">(</span><span class="builtintype" id="8164710">false</span><span class="op" id="8164715">)</span><span class="op" id="8164716">)</span><span class="op" id="8164717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164721">}</span><span class="op" id="8164722">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8164731">&#34;flush&#34;</span><span class="op" id="8164738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164743">func</span><span class="op" id="8164747">(</span><span class="ident" id="8164748">w</span>&nbsp;<span class="ident" id="8164750">http</span><span class="op" id="8164754">.</span><span class="ident" id="8164755">ResponseWriter</span><span class="op" id="8164769">,</span>&nbsp;<span class="ident" id="8164771">r</span>&nbsp;<span class="op" id="8164773">*</span><span class="ident" id="8164774">http</span><span class="op" id="8164778">.</span><span class="ident" id="8164779">Request</span><span class="op" id="8164786">)</span>&nbsp;<span class="op" id="8164788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164794">w</span><span class="op" id="8164795">.</span><span class="op" id="8164796">(</span><span class="ident" id="8164797">http</span><span class="op" id="8164801">.</span><span class="ident" id="8164802">Flusher</span><span class="op" id="8164809">)</span><span class="op" id="8164810">.</span><span class="ident" id="8164811">Flush</span><span class="op" id="8164816">(</span><span class="op" id="8164817">)</span>&nbsp;<span class="comment" id="8164819">//&nbsp;also&nbsp;sends&nbsp;a&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164843">w</span><span class="op" id="8164844">.</span><span class="ident" id="8164845">WriteHeader</span><span class="op" id="8164856">(</span><span class="num" id="8164857">201</span><span class="op" id="8164860">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164865">}</span><span class="op" id="8164866">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164871">check</span><span class="op" id="8164876">(</span><span class="ident" id="8164877">hasStatus</span><span class="op" id="8164886">(</span><span class="num" id="8164887">200</span><span class="op" id="8164890">)</span><span class="op" id="8164891">,</span>&nbsp;<span class="ident" id="8164893">hasFlush</span><span class="op" id="8164901">(</span><span class="builtintype" id="8164902">true</span><span class="op" id="8164906">)</span><span class="op" id="8164907">)</span><span class="op" id="8164908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164912">}</span><span class="op" id="8164913">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164919">r</span><span class="op" id="8164920">,</span>&nbsp;<span class="ident" id="8164922">_</span>&nbsp;<span class="op" id="8164924">:=</span>&nbsp;<span class="ident" id="8164927">http</span><span class="op" id="8164931">.</span><span class="ident" id="8164932">NewRequest</span><span class="op" id="8164942">(</span><span class="string" id="8164943">&#34;GET&#34;</span><span class="op" id="8164948">,</span>&nbsp;<span class="string" id="8164950">&#34;http://foo.com/&#34;</span><span class="op" id="8164967">,</span>&nbsp;<span class="ident" id="8164969">nil</span><span class="op" id="8164972">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164975">for</span>&nbsp;<span class="ident" id="8164979">_</span><span class="op" id="8164980">,</span>&nbsp;<span class="ident" id="8164982">tt</span>&nbsp;<span class="op" id="8164985">:=</span>&nbsp;<span class="keyword" id="8164988">range</span>&nbsp;<span class="ident" id="8164994">tests</span>&nbsp;<span class="op" id="8165000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165004">h</span>&nbsp;<span class="op" id="8165006">:=</span>&nbsp;<span class="ident" id="8165009">http</span><span class="op" id="8165013">.</span><span class="ident" id="8165014">HandlerFunc</span><span class="op" id="8165025">(</span><span class="ident" id="8165026">tt</span><span class="op" id="8165028">.</span><span class="ident" id="8165029">h</span><span class="op" id="8165030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165034">rec</span>&nbsp;<span class="op" id="8165038">:=</span>&nbsp;<span class="ident" id="8165041">NewRecorder</span><span class="op" id="8165052">(</span><span class="op" id="8165053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165057">h</span><span class="op" id="8165058">.</span><span class="ident" id="8165059">ServeHTTP</span><span class="op" id="8165068">(</span><span class="ident" id="8165069">rec</span><span class="op" id="8165072">,</span>&nbsp;<span class="ident" id="8165074">r</span><span class="op" id="8165075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165079">for</span>&nbsp;<span class="ident" id="8165083">_</span><span class="op" id="8165084">,</span>&nbsp;<span class="ident" id="8165086">check</span>&nbsp;<span class="op" id="8165092">:=</span>&nbsp;<span class="keyword" id="8165095">range</span>&nbsp;<span class="ident" id="8165101">tt</span><span class="op" id="8165103">.</span><span class="ident" id="8165104">checks</span>&nbsp;<span class="op" id="8165111">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165116">if</span>&nbsp;<span class="ident" id="8165119">err</span>&nbsp;<span class="op" id="8165123">:=</span>&nbsp;<span class="ident" id="8165126">check</span><span class="op" id="8165131">(</span><span class="ident" id="8165132">rec</span><span class="op" id="8165135">)</span><span class="op" id="8165136">;</span>&nbsp;<span class="ident" id="8165138">err</span>&nbsp;<span class="op" id="8165142">!=</span>&nbsp;<span class="ident" id="8165145">nil</span>&nbsp;<span class="op" id="8165149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165155">t</span><span class="op" id="8165156">.</span><span class="ident" id="8165157">Errorf</span><span class="op" id="8165163">(</span><span class="string" id="8165164">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="8165172">,</span>&nbsp;<span class="ident" id="8165174">tt</span><span class="op" id="8165176">.</span><span class="ident" id="8165177">name</span><span class="op" id="8165181">,</span>&nbsp;<span class="ident" id="8165183">err</span><span class="op" id="8165186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165198">}</span><br>
<span class="lineno">90</span><span class="op" id="8165200">}</span>
</div>
</body>
</html>
