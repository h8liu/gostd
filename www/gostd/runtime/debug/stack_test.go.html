<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7132913">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7132968">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7133022">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7133073">package</span>&nbsp;<span class="ident" id="7133081">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7133088">import</span>&nbsp;<span class="op" id="7133095">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7133098">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7133109">&#34;testing&#34;</span><br>
<span class="lineno">10</span><span class="op" id="7133119">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7133122">type</span>&nbsp;<span class="ident" id="7133127">T</span>&nbsp;<span class="builtintype" id="7133129">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7133134">func</span>&nbsp;<span class="op" id="7133139">(</span><span class="ident" id="7133140">t</span>&nbsp;<span class="op" id="7133142">*</span><span class="ident" id="7133143">T</span><span class="op" id="7133144">)</span>&nbsp;<span class="ident" id="7133146">ptrmethod</span><span class="op" id="7133155">(</span><span class="op" id="7133156">)</span>&nbsp;<span class="op" id="7133158">[</span><span class="op" id="7133159">]</span><span class="builtintype" id="7133160">byte</span>&nbsp;<span class="op" id="7133165">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7133168">return</span>&nbsp;<span class="ident" id="7133175">Stack</span><span class="op" id="7133180">(</span><span class="op" id="7133181">)</span><br>
<span class="lineno"></span><span class="op" id="7133183">}</span><br>
<span class="lineno"></span><span class="keyword" id="7133185">func</span>&nbsp;<span class="op" id="7133190">(</span><span class="ident" id="7133191">t</span>&nbsp;<span class="ident" id="7133193">T</span><span class="op" id="7133194">)</span>&nbsp;<span class="ident" id="7133196">method</span><span class="op" id="7133202">(</span><span class="op" id="7133203">)</span>&nbsp;<span class="op" id="7133205">[</span><span class="op" id="7133206">]</span><span class="builtintype" id="7133207">byte</span>&nbsp;<span class="op" id="7133212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7133215">return</span>&nbsp;<span class="ident" id="7133222">t</span><span class="op" id="7133223">.</span><span class="ident" id="7133224">ptrmethod</span><span class="op" id="7133233">(</span><span class="op" id="7133234">)</span><br>
<span class="lineno"></span><span class="op" id="7133236">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="7133239">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;traceback&nbsp;should&nbsp;look&nbsp;something&nbsp;like&nbsp;this,&nbsp;modulo&nbsp;line&nbsp;numbers&nbsp;and&nbsp;hex&nbsp;constants.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspDon&#39;t&nbsp;worry&nbsp;much&nbsp;about&nbsp;the&nbsp;base&nbsp;levels,&nbsp;but&nbsp;check&nbsp;the&nbsp;ones&nbsp;in&nbsp;our&nbsp;own&nbsp;package.<br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:15&nbsp;(0x13878)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(*T).ptrmethod:&nbsp;return&nbsp;Stack()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:18&nbsp;(0x138dd)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspT.method:&nbsp;return&nbsp;t.ptrmethod()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:23&nbsp;(0x13920)<br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/testing/testing.go:132&nbsp;(0x14a7a)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptRunner:&nbsp;test.F(t)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/proc.c:145&nbsp;(0xc970)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp???:&nbsp;runtime·unlock(&amp;runtime·sched);<br>
<span class="lineno">35</span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="7133852">func</span>&nbsp;<span class="ident" id="7133857">TestStack</span><span class="op" id="7133866">(</span><span class="ident" id="7133867">t</span>&nbsp;<span class="op" id="7133869">*</span><span class="ident" id="7133870">testing</span><span class="op" id="7133877">.</span><span class="ident" id="7133878">T</span><span class="op" id="7133879">)</span>&nbsp;<span class="op" id="7133881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133884">b</span>&nbsp;<span class="op" id="7133886">:=</span>&nbsp;<span class="ident" id="7133889">T</span><span class="op" id="7133890">(</span><span class="num" id="7133891">0</span><span class="op" id="7133892">)</span><span class="op" id="7133893">.</span><span class="ident" id="7133894">method</span><span class="op" id="7133900">(</span><span class="op" id="7133901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133904">lines</span>&nbsp;<span class="op" id="7133910">:=</span>&nbsp;<span class="ident" id="7133913">strings</span><span class="op" id="7133920">.</span><span class="ident" id="7133921">Split</span><span class="op" id="7133926">(</span><span class="builtintype" id="7133927">string</span><span class="op" id="7133933">(</span><span class="ident" id="7133934">b</span><span class="op" id="7133935">)</span><span class="op" id="7133936">,</span>&nbsp;<span class="string" id="7133938">&#34;\n&#34;</span><span class="op" id="7133942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7133945">if</span>&nbsp;<span class="builtinfunc" id="7133948">len</span><span class="op" id="7133951">(</span><span class="ident" id="7133952">lines</span><span class="op" id="7133957">)</span>&nbsp;<span class="op" id="7133959">&lt;</span>&nbsp;<span class="num" id="7133961">6</span>&nbsp;<span class="op" id="7133963">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133967">t</span><span class="op" id="7133968">.</span><span class="ident" id="7133969">Fatal</span><span class="op" id="7133974">(</span><span class="string" id="7133975">&#34;too&nbsp;few&nbsp;lines&#34;</span><span class="op" id="7133990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7133993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133996">n</span>&nbsp;<span class="op" id="7133998">:=</span>&nbsp;<span class="num" id="7134001">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134004">frame</span>&nbsp;<span class="op" id="7134010">:=</span>&nbsp;<span class="keyword" id="7134013">func</span><span class="op" id="7134017">(</span><span class="ident" id="7134018">line</span><span class="op" id="7134022">,</span>&nbsp;<span class="ident" id="7134024">code</span>&nbsp;<span class="builtintype" id="7134029">string</span><span class="op" id="7134035">)</span>&nbsp;<span class="op" id="7134037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134041">check</span><span class="op" id="7134046">(</span><span class="ident" id="7134047">t</span><span class="op" id="7134048">,</span>&nbsp;<span class="ident" id="7134050">lines</span><span class="op" id="7134055">[</span><span class="ident" id="7134056">n</span><span class="op" id="7134057">]</span><span class="op" id="7134058">,</span>&nbsp;<span class="ident" id="7134060">line</span><span class="op" id="7134064">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134068">n</span><span class="op" id="7134069">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7134074">//&nbsp;The&nbsp;source&nbsp;might&nbsp;not&nbsp;be&nbsp;available&nbsp;while&nbsp;running&nbsp;the&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134137">if</span>&nbsp;<span class="ident" id="7134140">strings</span><span class="op" id="7134147">.</span><span class="ident" id="7134148">HasPrefix</span><span class="op" id="7134157">(</span><span class="ident" id="7134158">lines</span><span class="op" id="7134163">[</span><span class="ident" id="7134164">n</span><span class="op" id="7134165">]</span><span class="op" id="7134166">,</span>&nbsp;<span class="string" id="7134168">&#34;\t&#34;</span><span class="op" id="7134172">)</span>&nbsp;<span class="op" id="7134174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134179">check</span><span class="op" id="7134184">(</span><span class="ident" id="7134185">t</span><span class="op" id="7134186">,</span>&nbsp;<span class="ident" id="7134188">lines</span><span class="op" id="7134193">[</span><span class="ident" id="7134194">n</span><span class="op" id="7134195">]</span><span class="op" id="7134196">,</span>&nbsp;<span class="ident" id="7134198">code</span><span class="op" id="7134202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134207">n</span><span class="op" id="7134208">++</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134219">frame</span><span class="op" id="7134224">(</span><span class="string" id="7134225">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="7134258">,</span>&nbsp;<span class="string" id="7134260">&#34;\t(*T).ptrmethod:&nbsp;return&nbsp;Stack()&#34;</span><span class="op" id="7134294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134297">frame</span><span class="op" id="7134302">(</span><span class="string" id="7134303">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="7134336">,</span>&nbsp;<span class="string" id="7134338">&#34;\tT.method:&nbsp;return&nbsp;t.ptrmethod()&#34;</span><span class="op" id="7134372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134375">frame</span><span class="op" id="7134380">(</span><span class="string" id="7134381">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="7134414">,</span>&nbsp;<span class="string" id="7134416">&#34;\tTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()&#34;</span><span class="op" id="7134449">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134452">frame</span><span class="op" id="7134457">(</span><span class="string" id="7134458">&#34;src/testing/testing.go&#34;</span><span class="op" id="7134482">,</span>&nbsp;<span class="string" id="7134484">&#34;&#34;</span><span class="op" id="7134486">)</span><br>
<span class="lineno"></span><span class="op" id="7134488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7134491">func</span>&nbsp;<span class="ident" id="7134496">check</span><span class="op" id="7134501">(</span><span class="ident" id="7134502">t</span>&nbsp;<span class="op" id="7134504">*</span><span class="ident" id="7134505">testing</span><span class="op" id="7134512">.</span><span class="ident" id="7134513">T</span><span class="op" id="7134514">,</span>&nbsp;<span class="ident" id="7134516">line</span><span class="op" id="7134520">,</span>&nbsp;<span class="ident" id="7134522">has</span>&nbsp;<span class="builtintype" id="7134526">string</span><span class="op" id="7134532">)</span>&nbsp;<span class="op" id="7134534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134537">if</span>&nbsp;<span class="ident" id="7134540">strings</span><span class="op" id="7134547">.</span><span class="ident" id="7134548">Index</span><span class="op" id="7134553">(</span><span class="ident" id="7134554">line</span><span class="op" id="7134558">,</span>&nbsp;<span class="ident" id="7134560">has</span><span class="op" id="7134563">)</span>&nbsp;<span class="op" id="7134565">&lt;</span>&nbsp;<span class="num" id="7134567">0</span>&nbsp;<span class="op" id="7134569">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134573">t</span><span class="op" id="7134574">.</span><span class="ident" id="7134575">Errorf</span><span class="op" id="7134581">(</span><span class="string" id="7134582">&#34;expected&nbsp;%q&nbsp;in&nbsp;%q&#34;</span><span class="op" id="7134601">,</span>&nbsp;<span class="ident" id="7134603">has</span><span class="op" id="7134606">,</span>&nbsp;<span class="ident" id="7134608">line</span><span class="op" id="7134612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134615">}</span><br>
<span class="lineno"></span><span class="op" id="7134617">}</span>
</div>
</body>
</html>
