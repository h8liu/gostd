<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4435581">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4435636">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4435690">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4435741">package</span>&nbsp;<span class="ident" id="4435749">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4435759">import</span>&nbsp;<span class="op" id="4435766">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4435769">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4435778">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4435785">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4435796">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4435811">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4435814">//&nbsp;htmlNospaceEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;unquoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno">15</span><span class="keyword" id="4435888">func</span>&nbsp;<span class="ident" id="4435893">htmlNospaceEscaper</span><span class="op" id="4435911">(</span><span class="ident" id="4435912">args</span>&nbsp;<span class="op" id="4435917">...</span><span class="keyword" id="4435920">interface</span><span class="op" id="4435929">{</span><span class="op" id="4435930">}</span><span class="op" id="4435931">)</span>&nbsp;<span class="builtintype" id="4435933">string</span>&nbsp;<span class="op" id="4435940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435943">s</span><span class="op" id="4435944">,</span>&nbsp;<span class="ident" id="4435946">t</span>&nbsp;<span class="op" id="4435948">:=</span>&nbsp;<span class="ident" id="4435951">stringify</span><span class="op" id="4435960">(</span><span class="ident" id="4435961">args</span><span class="op" id="4435965">...</span><span class="op" id="4435968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435971">if</span>&nbsp;<span class="ident" id="4435974">t</span>&nbsp;<span class="op" id="4435976">==</span>&nbsp;<span class="ident" id="4435979">contentTypeHTML</span>&nbsp;<span class="op" id="4435995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435999">return</span>&nbsp;<span class="ident" id="4436006">htmlReplacer</span><span class="op" id="4436018">(</span><span class="ident" id="4436019">stripTags</span><span class="op" id="4436028">(</span><span class="ident" id="4436029">s</span><span class="op" id="4436030">)</span><span class="op" id="4436031">,</span>&nbsp;<span class="ident" id="4436033">htmlNospaceNormReplacementTable</span><span class="op" id="4436064">,</span>&nbsp;<span class="ident" id="4436066">false</span><span class="op" id="4436071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436074">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436077">return</span>&nbsp;<span class="ident" id="4436084">htmlReplacer</span><span class="op" id="4436096">(</span><span class="ident" id="4436097">s</span><span class="op" id="4436098">,</span>&nbsp;<span class="ident" id="4436100">htmlNospaceReplacementTable</span><span class="op" id="4436127">,</span>&nbsp;<span class="ident" id="4436129">false</span><span class="op" id="4436134">)</span><br>
<span class="lineno"></span><span class="op" id="4436136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4436139">//&nbsp;attrEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;quoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4436204">func</span>&nbsp;<span class="ident" id="4436209">attrEscaper</span><span class="op" id="4436220">(</span><span class="ident" id="4436221">args</span>&nbsp;<span class="op" id="4436226">...</span><span class="keyword" id="4436229">interface</span><span class="op" id="4436238">{</span><span class="op" id="4436239">}</span><span class="op" id="4436240">)</span>&nbsp;<span class="builtintype" id="4436242">string</span>&nbsp;<span class="op" id="4436249">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436252">s</span><span class="op" id="4436253">,</span>&nbsp;<span class="ident" id="4436255">t</span>&nbsp;<span class="op" id="4436257">:=</span>&nbsp;<span class="ident" id="4436260">stringify</span><span class="op" id="4436269">(</span><span class="ident" id="4436270">args</span><span class="op" id="4436274">...</span><span class="op" id="4436277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436280">if</span>&nbsp;<span class="ident" id="4436283">t</span>&nbsp;<span class="op" id="4436285">==</span>&nbsp;<span class="ident" id="4436288">contentTypeHTML</span>&nbsp;<span class="op" id="4436304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436308">return</span>&nbsp;<span class="ident" id="4436315">htmlReplacer</span><span class="op" id="4436327">(</span><span class="ident" id="4436328">stripTags</span><span class="op" id="4436337">(</span><span class="ident" id="4436338">s</span><span class="op" id="4436339">)</span><span class="op" id="4436340">,</span>&nbsp;<span class="ident" id="4436342">htmlNormReplacementTable</span><span class="op" id="4436366">,</span>&nbsp;<span class="ident" id="4436368">true</span><span class="op" id="4436372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436378">return</span>&nbsp;<span class="ident" id="4436385">htmlReplacer</span><span class="op" id="4436397">(</span><span class="ident" id="4436398">s</span><span class="op" id="4436399">,</span>&nbsp;<span class="ident" id="4436401">htmlReplacementTable</span><span class="op" id="4436421">,</span>&nbsp;<span class="ident" id="4436423">true</span><span class="op" id="4436427">)</span><br>
<span class="lineno">30</span><span class="op" id="4436429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4436432">//&nbsp;rcdataEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;RCDATA&nbsp;element&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="4436498">func</span>&nbsp;<span class="ident" id="4436503">rcdataEscaper</span><span class="op" id="4436516">(</span><span class="ident" id="4436517">args</span>&nbsp;<span class="op" id="4436522">...</span><span class="keyword" id="4436525">interface</span><span class="op" id="4436534">{</span><span class="op" id="4436535">}</span><span class="op" id="4436536">)</span>&nbsp;<span class="builtintype" id="4436538">string</span>&nbsp;<span class="op" id="4436545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436548">s</span><span class="op" id="4436549">,</span>&nbsp;<span class="ident" id="4436551">t</span>&nbsp;<span class="op" id="4436553">:=</span>&nbsp;<span class="ident" id="4436556">stringify</span><span class="op" id="4436565">(</span><span class="ident" id="4436566">args</span><span class="op" id="4436570">...</span><span class="op" id="4436573">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436576">if</span>&nbsp;<span class="ident" id="4436579">t</span>&nbsp;<span class="op" id="4436581">==</span>&nbsp;<span class="ident" id="4436584">contentTypeHTML</span>&nbsp;<span class="op" id="4436600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436604">return</span>&nbsp;<span class="ident" id="4436611">htmlReplacer</span><span class="op" id="4436623">(</span><span class="ident" id="4436624">s</span><span class="op" id="4436625">,</span>&nbsp;<span class="ident" id="4436627">htmlNormReplacementTable</span><span class="op" id="4436651">,</span>&nbsp;<span class="ident" id="4436653">true</span><span class="op" id="4436657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436663">return</span>&nbsp;<span class="ident" id="4436670">htmlReplacer</span><span class="op" id="4436682">(</span><span class="ident" id="4436683">s</span><span class="op" id="4436684">,</span>&nbsp;<span class="ident" id="4436686">htmlReplacementTable</span><span class="op" id="4436706">,</span>&nbsp;<span class="ident" id="4436708">true</span><span class="op" id="4436712">)</span><br>
<span class="lineno"></span><span class="op" id="4436714">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="4436717">//&nbsp;htmlEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="4436768">func</span>&nbsp;<span class="ident" id="4436773">htmlEscaper</span><span class="op" id="4436784">(</span><span class="ident" id="4436785">args</span>&nbsp;<span class="op" id="4436790">...</span><span class="keyword" id="4436793">interface</span><span class="op" id="4436802">{</span><span class="op" id="4436803">}</span><span class="op" id="4436804">)</span>&nbsp;<span class="builtintype" id="4436806">string</span>&nbsp;<span class="op" id="4436813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436816">s</span><span class="op" id="4436817">,</span>&nbsp;<span class="ident" id="4436819">t</span>&nbsp;<span class="op" id="4436821">:=</span>&nbsp;<span class="ident" id="4436824">stringify</span><span class="op" id="4436833">(</span><span class="ident" id="4436834">args</span><span class="op" id="4436838">...</span><span class="op" id="4436841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436844">if</span>&nbsp;<span class="ident" id="4436847">t</span>&nbsp;<span class="op" id="4436849">==</span>&nbsp;<span class="ident" id="4436852">contentTypeHTML</span>&nbsp;<span class="op" id="4436868">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436872">return</span>&nbsp;<span class="ident" id="4436879">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436885">return</span>&nbsp;<span class="ident" id="4436892">htmlReplacer</span><span class="op" id="4436904">(</span><span class="ident" id="4436905">s</span><span class="op" id="4436906">,</span>&nbsp;<span class="ident" id="4436908">htmlReplacementTable</span><span class="op" id="4436928">,</span>&nbsp;<span class="ident" id="4436930">true</span><span class="op" id="4436934">)</span><br>
<span class="lineno"></span><span class="op" id="4436936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4436939">//&nbsp;htmlReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno"></span><span class="comment" id="4437006">//&nbsp;inside&nbsp;a&nbsp;quoted&nbsp;attribute&nbsp;value&nbsp;or&nbsp;in&nbsp;a&nbsp;text&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4437060">var</span>&nbsp;<span class="ident" id="4437064">htmlReplacementTable</span>&nbsp;<span class="op" id="4437085">=</span>&nbsp;<span class="op" id="4437087">[</span><span class="op" id="4437088">]</span><span class="builtintype" id="4437089">string</span><span class="op" id="4437095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4437098">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4437174">//&nbsp;U+0000&nbsp;NULL&nbsp;Parse&nbsp;error.&nbsp;Append&nbsp;a&nbsp;U+FFFD&nbsp;REPLACEMENT</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4437231">//&nbsp;CHARACTER&nbsp;character&nbsp;to&nbsp;the&nbsp;current&nbsp;attribute&#39;s&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4437289">//&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4437295">//&nbsp;and&nbsp;similarly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4437313">//&nbsp;http://www.w3.org/TR/html5/syntax.html#before-attribute-value-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4437385">0</span><span class="op" id="4437386">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4437391">&#34;\uFFFD&#34;</span><span class="op" id="4437399">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4437402">&#39;&#34;&#39;</span><span class="op" id="4437405">:</span>&nbsp;&nbsp;<span class="string" id="4437408">&#34;&amp;#34;&#34;</span><span class="op" id="4437415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4437418">&#39;&amp;&#39;</span><span class="op" id="4437421">:</span>&nbsp;&nbsp;<span class="string" id="4437424">&#34;&amp;amp;&#34;</span><span class="op" id="4437431">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4437434">&#39;\&#39;&#39;</span><span class="op" id="4437438">:</span>&nbsp;<span class="string" id="4437440">&#34;&amp;#39;&#34;</span><span class="op" id="4437447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4437450">&#39;+&#39;</span><span class="op" id="4437453">:</span>&nbsp;&nbsp;<span class="string" id="4437456">&#34;&amp;#43;&#34;</span><span class="op" id="4437463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4437466">&#39;&lt;&#39;</span><span class="op" id="4437469">:</span>&nbsp;&nbsp;<span class="string" id="4437472">&#34;&amp;lt;&#34;</span><span class="op" id="4437478">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4437481">&#39;&gt;&#39;</span><span class="op" id="4437484">:</span>&nbsp;&nbsp;<span class="string" id="4437487">&#34;&amp;gt;&#34;</span><span class="op" id="4437493">,</span><br>
<span class="lineno"></span><span class="op" id="4437495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4437498">//&nbsp;htmlNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlReplacementTable&nbsp;but&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4437574">//&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno">70</span><span class="keyword" id="4437616">var</span>&nbsp;<span class="ident" id="4437620">htmlNormReplacementTable</span>&nbsp;<span class="op" id="4437645">=</span>&nbsp;<span class="op" id="4437647">[</span><span class="op" id="4437648">]</span><span class="builtintype" id="4437649">string</span><span class="op" id="4437655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4437658">0</span><span class="op" id="4437659">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4437664">&#34;\uFFFD&#34;</span><span class="op" id="4437672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4437675">&#39;&#34;&#39;</span><span class="op" id="4437678">:</span>&nbsp;&nbsp;<span class="string" id="4437681">&#34;&amp;#34;&#34;</span><span class="op" id="4437688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4437691">&#39;\&#39;&#39;</span><span class="op" id="4437695">:</span>&nbsp;<span class="string" id="4437697">&#34;&amp;#39;&#34;</span><span class="op" id="4437704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4437707">&#39;+&#39;</span><span class="op" id="4437710">:</span>&nbsp;&nbsp;<span class="string" id="4437713">&#34;&amp;#43;&#34;</span><span class="op" id="4437720">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4437723">&#39;&lt;&#39;</span><span class="op" id="4437726">:</span>&nbsp;&nbsp;<span class="string" id="4437729">&#34;&amp;lt;&#34;</span><span class="op" id="4437735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4437738">&#39;&gt;&#39;</span><span class="op" id="4437741">:</span>&nbsp;&nbsp;<span class="string" id="4437744">&#34;&amp;gt;&#34;</span><span class="op" id="4437750">,</span><br>
<span class="lineno"></span><span class="op" id="4437752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4437755">//&nbsp;htmlNospaceReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno">80</span><span class="comment" id="4437829">//&nbsp;inside&nbsp;an&nbsp;unquoted&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4437868">//&nbsp;The&nbsp;set&nbsp;of&nbsp;runes&nbsp;escaped&nbsp;is&nbsp;the&nbsp;union&nbsp;of&nbsp;the&nbsp;HTML&nbsp;specials&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4437934">//&nbsp;those&nbsp;determined&nbsp;by&nbsp;running&nbsp;the&nbsp;JS&nbsp;below&nbsp;in&nbsp;browsers:</span><br>
<span class="lineno"></span><span class="comment" id="4437991">//&nbsp;&lt;div&nbsp;id=d&gt;&lt;/div&gt;</span><br>
<span class="lineno"></span><span class="comment" id="4438011">//&nbsp;&lt;script&gt;(function&nbsp;()&nbsp;{</span><br>
<span class="lineno">85</span><span class="comment" id="4438037">//&nbsp;var&nbsp;a&nbsp;=&nbsp;[],&nbsp;d&nbsp;=&nbsp;document.getElementById(&#34;d&#34;),&nbsp;i,&nbsp;c,&nbsp;s;</span><br>
<span class="lineno"></span><span class="comment" id="4438095">//&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="4438130">//&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;String.fromCharCode(i);</span><br>
<span class="lineno"></span><span class="comment" id="4438163">//&nbsp;&nbsp;&nbsp;d.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;&gt;&lt;/span&gt;&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4438225">//&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;d.getElementsByTagName(&#34;SPAN&#34;)[0];</span><br>
<span class="lineno">90</span><span class="comment" id="4438269">//&nbsp;&nbsp;&nbsp;if&nbsp;(!s&nbsp;||&nbsp;s.title&nbsp;!==&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c)&nbsp;{&nbsp;a.push(i.toString(16));&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="4438338">//&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="4438343">//&nbsp;document.write(a.join(&#34;,&nbsp;&#34;));</span><br>
<span class="lineno"></span><span class="comment" id="4438376">//&nbsp;})()&lt;/script&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="4438393">var</span>&nbsp;<span class="ident" id="4438397">htmlNospaceReplacementTable</span>&nbsp;<span class="op" id="4438425">=</span>&nbsp;<span class="op" id="4438427">[</span><span class="op" id="4438428">]</span><span class="builtintype" id="4438429">string</span><span class="op" id="4438435">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4438438">0</span><span class="op" id="4438439">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4438444">&#34;&amp;#xfffd;&#34;</span><span class="op" id="4438454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4438457">&#39;\t&#39;</span><span class="op" id="4438461">:</span>&nbsp;<span class="string" id="4438463">&#34;&amp;#9;&#34;</span><span class="op" id="4438469">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4438472">&#39;\n&#39;</span><span class="op" id="4438476">:</span>&nbsp;<span class="string" id="4438478">&#34;&amp;#10;&#34;</span><span class="op" id="4438485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4438488">&#39;\v&#39;</span><span class="op" id="4438492">:</span>&nbsp;<span class="string" id="4438494">&#34;&amp;#11;&#34;</span><span class="op" id="4438501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4438504">&#39;\f&#39;</span><span class="op" id="4438508">:</span>&nbsp;<span class="string" id="4438510">&#34;&amp;#12;&#34;</span><span class="op" id="4438517">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4438520">&#39;\r&#39;</span><span class="op" id="4438524">:</span>&nbsp;<span class="string" id="4438526">&#34;&amp;#13;&#34;</span><span class="op" id="4438533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4438536">&#39;&nbsp;&#39;</span><span class="op" id="4438539">:</span>&nbsp;&nbsp;<span class="string" id="4438542">&#34;&amp;#32;&#34;</span><span class="op" id="4438549">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4438552">&#39;&#34;&#39;</span><span class="op" id="4438555">:</span>&nbsp;&nbsp;<span class="string" id="4438558">&#34;&amp;#34;&#34;</span><span class="op" id="4438565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4438568">&#39;&amp;&#39;</span><span class="op" id="4438571">:</span>&nbsp;&nbsp;<span class="string" id="4438574">&#34;&amp;amp;&#34;</span><span class="op" id="4438581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4438584">&#39;\&#39;&#39;</span><span class="op" id="4438588">:</span>&nbsp;<span class="string" id="4438590">&#34;&amp;#39;&#34;</span><span class="op" id="4438597">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4438600">&#39;+&#39;</span><span class="op" id="4438603">:</span>&nbsp;&nbsp;<span class="string" id="4438606">&#34;&amp;#43;&#34;</span><span class="op" id="4438613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4438616">&#39;&lt;&#39;</span><span class="op" id="4438619">:</span>&nbsp;&nbsp;<span class="string" id="4438622">&#34;&amp;lt;&#34;</span><span class="op" id="4438628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4438631">&#39;=&#39;</span><span class="op" id="4438634">:</span>&nbsp;&nbsp;<span class="string" id="4438637">&#34;&amp;#61;&#34;</span><span class="op" id="4438644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4438647">&#39;&gt;&#39;</span><span class="op" id="4438650">:</span>&nbsp;&nbsp;<span class="string" id="4438653">&#34;&amp;gt;&#34;</span><span class="op" id="4438659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4438662">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4438718">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4438753">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4438795">&#39;`&#39;</span><span class="op" id="4438798">:</span>&nbsp;<span class="string" id="4438800">&#34;&amp;#96;&#34;</span><span class="op" id="4438807">,</span><br>
<span class="lineno"></span><span class="op" id="4438809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="4438812">//&nbsp;htmlNospaceNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlNospaceReplacementTable&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="4438887">//&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno"></span><span class="keyword" id="4438944">var</span>&nbsp;<span class="ident" id="4438948">htmlNospaceNormReplacementTable</span>&nbsp;<span class="op" id="4438980">=</span>&nbsp;<span class="op" id="4438982">[</span><span class="op" id="4438983">]</span><span class="builtintype" id="4438984">string</span><span class="op" id="4438990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4438993">0</span><span class="op" id="4438994">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4438999">&#34;&amp;#xfffd;&#34;</span><span class="op" id="4439009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4439012">&#39;\t&#39;</span><span class="op" id="4439016">:</span>&nbsp;<span class="string" id="4439018">&#34;&amp;#9;&#34;</span><span class="op" id="4439024">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4439027">&#39;\n&#39;</span><span class="op" id="4439031">:</span>&nbsp;<span class="string" id="4439033">&#34;&amp;#10;&#34;</span><span class="op" id="4439040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4439043">&#39;\v&#39;</span><span class="op" id="4439047">:</span>&nbsp;<span class="string" id="4439049">&#34;&amp;#11;&#34;</span><span class="op" id="4439056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4439059">&#39;\f&#39;</span><span class="op" id="4439063">:</span>&nbsp;<span class="string" id="4439065">&#34;&amp;#12;&#34;</span><span class="op" id="4439072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4439075">&#39;\r&#39;</span><span class="op" id="4439079">:</span>&nbsp;<span class="string" id="4439081">&#34;&amp;#13;&#34;</span><span class="op" id="4439088">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4439091">&#39;&nbsp;&#39;</span><span class="op" id="4439094">:</span>&nbsp;&nbsp;<span class="string" id="4439097">&#34;&amp;#32;&#34;</span><span class="op" id="4439104">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4439107">&#39;&#34;&#39;</span><span class="op" id="4439110">:</span>&nbsp;&nbsp;<span class="string" id="4439113">&#34;&amp;#34;&#34;</span><span class="op" id="4439120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4439123">&#39;\&#39;&#39;</span><span class="op" id="4439127">:</span>&nbsp;<span class="string" id="4439129">&#34;&amp;#39;&#34;</span><span class="op" id="4439136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4439139">&#39;+&#39;</span><span class="op" id="4439142">:</span>&nbsp;&nbsp;<span class="string" id="4439145">&#34;&amp;#43;&#34;</span><span class="op" id="4439152">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4439155">&#39;&lt;&#39;</span><span class="op" id="4439158">:</span>&nbsp;&nbsp;<span class="string" id="4439161">&#34;&amp;lt;&#34;</span><span class="op" id="4439167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4439170">&#39;=&#39;</span><span class="op" id="4439173">:</span>&nbsp;&nbsp;<span class="string" id="4439176">&#34;&amp;#61;&#34;</span><span class="op" id="4439183">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4439186">&#39;&gt;&#39;</span><span class="op" id="4439189">:</span>&nbsp;&nbsp;<span class="string" id="4439192">&#34;&amp;gt;&#34;</span><span class="op" id="4439198">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439201">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439257">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439292">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4439334">&#39;`&#39;</span><span class="op" id="4439337">:</span>&nbsp;<span class="string" id="4439339">&#34;&amp;#96;&#34;</span><span class="op" id="4439346">,</span><br>
<span class="lineno">135</span><span class="op" id="4439348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4439351">//&nbsp;htmlReplacer&nbsp;returns&nbsp;s&nbsp;with&nbsp;runes&nbsp;replaced&nbsp;according&nbsp;to&nbsp;replacementTable</span><br>
<span class="lineno"></span><span class="comment" id="4439427">//&nbsp;and&nbsp;when&nbsp;badRunes&nbsp;is&nbsp;true,&nbsp;certain&nbsp;bad&nbsp;runes&nbsp;are&nbsp;allowed&nbsp;through&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="4439506">func</span>&nbsp;<span class="ident" id="4439511">htmlReplacer</span><span class="op" id="4439523">(</span><span class="ident" id="4439524">s</span>&nbsp;<span class="builtintype" id="4439526">string</span><span class="op" id="4439532">,</span>&nbsp;<span class="ident" id="4439534">replacementTable</span>&nbsp;<span class="op" id="4439551">[</span><span class="op" id="4439552">]</span><span class="builtintype" id="4439553">string</span><span class="op" id="4439559">,</span>&nbsp;<span class="ident" id="4439561">badRunes</span>&nbsp;<span class="builtintype" id="4439570">bool</span><span class="op" id="4439574">)</span>&nbsp;<span class="builtintype" id="4439576">string</span>&nbsp;<span class="op" id="4439583">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439586">written</span><span class="op" id="4439593">,</span>&nbsp;<span class="ident" id="4439595">b</span>&nbsp;<span class="op" id="4439597">:=</span>&nbsp;<span class="num" id="4439600">0</span><span class="op" id="4439601">,</span>&nbsp;<span class="builtinfunc" id="4439603">new</span><span class="op" id="4439606">(</span><span class="ident" id="4439607">bytes</span><span class="op" id="4439612">.</span><span class="ident" id="4439613">Buffer</span><span class="op" id="4439619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439622">for</span>&nbsp;<span class="ident" id="4439626">i</span><span class="op" id="4439627">,</span>&nbsp;<span class="ident" id="4439629">r</span>&nbsp;<span class="op" id="4439631">:=</span>&nbsp;<span class="keyword" id="4439634">range</span>&nbsp;<span class="ident" id="4439640">s</span>&nbsp;<span class="op" id="4439642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439646">if</span>&nbsp;<span class="builtintype" id="4439649">int</span><span class="op" id="4439652">(</span><span class="ident" id="4439653">r</span><span class="op" id="4439654">)</span>&nbsp;<span class="op" id="4439656">&lt;</span>&nbsp;<span class="builtinfunc" id="4439658">len</span><span class="op" id="4439661">(</span><span class="ident" id="4439662">replacementTable</span><span class="op" id="4439678">)</span>&nbsp;<span class="op" id="4439680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439685">if</span>&nbsp;<span class="ident" id="4439688">repl</span>&nbsp;<span class="op" id="4439693">:=</span>&nbsp;<span class="ident" id="4439696">replacementTable</span><span class="op" id="4439712">[</span><span class="ident" id="4439713">r</span><span class="op" id="4439714">]</span><span class="op" id="4439715">;</span>&nbsp;<span class="builtinfunc" id="4439717">len</span><span class="op" id="4439720">(</span><span class="ident" id="4439721">repl</span><span class="op" id="4439725">)</span>&nbsp;<span class="op" id="4439727">!=</span>&nbsp;<span class="num" id="4439730">0</span>&nbsp;<span class="op" id="4439732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439738">b</span><span class="op" id="4439739">.</span><span class="ident" id="4439740">WriteString</span><span class="op" id="4439751">(</span><span class="ident" id="4439752">s</span><span class="op" id="4439753">[</span><span class="ident" id="4439754">written</span><span class="op" id="4439761">:</span><span class="ident" id="4439762">i</span><span class="op" id="4439763">]</span><span class="op" id="4439764">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439770">b</span><span class="op" id="4439771">.</span><span class="ident" id="4439772">WriteString</span><span class="op" id="4439783">(</span><span class="ident" id="4439784">repl</span><span class="op" id="4439788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439794">//&nbsp;Valid&nbsp;as&nbsp;long&nbsp;as&nbsp;replacementTable&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439843">//&nbsp;include&nbsp;anything&nbsp;above&nbsp;0x7f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439879">written</span>&nbsp;<span class="op" id="4439887">=</span>&nbsp;<span class="ident" id="4439889">i</span>&nbsp;<span class="op" id="4439891">+</span>&nbsp;<span class="ident" id="4439893">utf8</span><span class="op" id="4439897">.</span><span class="ident" id="4439898">RuneLen</span><span class="op" id="4439905">(</span><span class="ident" id="4439906">r</span><span class="op" id="4439907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439912">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439916">}</span>&nbsp;<span class="keyword" id="4439918">else</span>&nbsp;<span class="keyword" id="4439923">if</span>&nbsp;<span class="ident" id="4439926">badRunes</span>&nbsp;<span class="op" id="4439935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439940">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439953">//&nbsp;IE&nbsp;does&nbsp;not&nbsp;allow&nbsp;these&nbsp;ranges&nbsp;in&nbsp;unquoted&nbsp;attrs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440008">}</span>&nbsp;<span class="keyword" id="4440010">else</span>&nbsp;<span class="keyword" id="4440015">if</span>&nbsp;<span class="num" id="4440018">0xfdd0</span>&nbsp;<span class="op" id="4440025">&lt;=</span>&nbsp;<span class="ident" id="4440028">r</span>&nbsp;<span class="op" id="4440030">&amp;&amp;</span>&nbsp;<span class="ident" id="4440033">r</span>&nbsp;<span class="op" id="4440035">&lt;=</span>&nbsp;<span class="num" id="4440038">0xfdef</span>&nbsp;<span class="op" id="4440045">||</span>&nbsp;<span class="num" id="4440048">0xfff0</span>&nbsp;<span class="op" id="4440055">&lt;=</span>&nbsp;<span class="ident" id="4440058">r</span>&nbsp;<span class="op" id="4440060">&amp;&amp;</span>&nbsp;<span class="ident" id="4440063">r</span>&nbsp;<span class="op" id="4440065">&lt;=</span>&nbsp;<span class="num" id="4440068">0xffff</span>&nbsp;<span class="op" id="4440075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440080">fmt</span><span class="op" id="4440083">.</span><span class="ident" id="4440084">Fprintf</span><span class="op" id="4440091">(</span><span class="ident" id="4440092">b</span><span class="op" id="4440093">,</span>&nbsp;<span class="string" id="4440095">&#34;%s&amp;#x%x;&#34;</span><span class="op" id="4440105">,</span>&nbsp;<span class="ident" id="4440107">s</span><span class="op" id="4440108">[</span><span class="ident" id="4440109">written</span><span class="op" id="4440116">:</span><span class="ident" id="4440117">i</span><span class="op" id="4440118">]</span><span class="op" id="4440119">,</span>&nbsp;<span class="ident" id="4440121">r</span><span class="op" id="4440122">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440127">written</span>&nbsp;<span class="op" id="4440135">=</span>&nbsp;<span class="ident" id="4440137">i</span>&nbsp;<span class="op" id="4440139">+</span>&nbsp;<span class="ident" id="4440141">utf8</span><span class="op" id="4440145">.</span><span class="ident" id="4440146">RuneLen</span><span class="op" id="4440153">(</span><span class="ident" id="4440154">r</span><span class="op" id="4440155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440165">if</span>&nbsp;<span class="ident" id="4440168">written</span>&nbsp;<span class="op" id="4440176">==</span>&nbsp;<span class="num" id="4440179">0</span>&nbsp;<span class="op" id="4440181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440185">return</span>&nbsp;<span class="ident" id="4440192">s</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440198">b</span><span class="op" id="4440199">.</span><span class="ident" id="4440200">WriteString</span><span class="op" id="4440211">(</span><span class="ident" id="4440212">s</span><span class="op" id="4440213">[</span><span class="ident" id="4440214">written</span><span class="op" id="4440221">:</span><span class="op" id="4440222">]</span><span class="op" id="4440223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440226">return</span>&nbsp;<span class="ident" id="4440233">b</span><span class="op" id="4440234">.</span><span class="ident" id="4440235">String</span><span class="op" id="4440241">(</span><span class="op" id="4440242">)</span><br>
<span class="lineno"></span><span class="op" id="4440244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="4440247">//&nbsp;stripTags&nbsp;takes&nbsp;a&nbsp;snippet&nbsp;of&nbsp;HTML&nbsp;and&nbsp;returns&nbsp;only&nbsp;the&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="4440319">//&nbsp;For&nbsp;example,&nbsp;`&lt;b&gt;&amp;iexcl;Hi!&lt;/b&gt;&nbsp;&lt;script&gt;...&lt;/script&gt;`&nbsp;-&gt;&nbsp;`&amp;iexcl;Hi!&nbsp;`.</span><br>
<span class="lineno"></span><span class="keyword" id="4440394">func</span>&nbsp;<span class="ident" id="4440399">stripTags</span><span class="op" id="4440408">(</span><span class="ident" id="4440409">html</span>&nbsp;<span class="builtintype" id="4440414">string</span><span class="op" id="4440420">)</span>&nbsp;<span class="builtintype" id="4440422">string</span>&nbsp;<span class="op" id="4440429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440432">var</span>&nbsp;<span class="ident" id="4440436">b</span>&nbsp;<span class="ident" id="4440438">bytes</span><span class="op" id="4440443">.</span><span class="ident" id="4440444">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440452">s</span><span class="op" id="4440453">,</span>&nbsp;<span class="ident" id="4440455">c</span><span class="op" id="4440456">,</span>&nbsp;<span class="ident" id="4440458">i</span><span class="op" id="4440459">,</span>&nbsp;<span class="ident" id="4440461">allText</span>&nbsp;<span class="op" id="4440469">:=</span>&nbsp;<span class="op" id="4440472">[</span><span class="op" id="4440473">]</span><span class="builtintype" id="4440474">byte</span><span class="op" id="4440478">(</span><span class="ident" id="4440479">html</span><span class="op" id="4440483">)</span><span class="op" id="4440484">,</span>&nbsp;<span class="ident" id="4440486">context</span><span class="op" id="4440493">{</span><span class="op" id="4440494">}</span><span class="op" id="4440495">,</span>&nbsp;<span class="num" id="4440497">0</span><span class="op" id="4440498">,</span>&nbsp;<span class="ident" id="4440500">true</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440506">//&nbsp;Using&nbsp;the&nbsp;transition&nbsp;funcs&nbsp;helps&nbsp;us&nbsp;avoid&nbsp;mangling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440561">//&nbsp;`&lt;div&nbsp;title=&#34;1&gt;2&#34;&gt;`&nbsp;or&nbsp;`I&nbsp;&lt;3&nbsp;Ponies!`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440604">for</span>&nbsp;<span class="ident" id="4440608">i</span>&nbsp;<span class="op" id="4440610">!=</span>&nbsp;<span class="builtinfunc" id="4440613">len</span><span class="op" id="4440616">(</span><span class="ident" id="4440617">s</span><span class="op" id="4440618">)</span>&nbsp;<span class="op" id="4440620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440624">if</span>&nbsp;<span class="ident" id="4440627">c</span><span class="op" id="4440628">.</span><span class="ident" id="4440629">delim</span>&nbsp;<span class="op" id="4440635">==</span>&nbsp;<span class="ident" id="4440638">delimNone</span>&nbsp;<span class="op" id="4440648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440653">st</span>&nbsp;<span class="op" id="4440656">:=</span>&nbsp;<span class="ident" id="4440659">c</span><span class="op" id="4440660">.</span><span class="ident" id="4440661">state</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440670">//&nbsp;Use&nbsp;RCDATA&nbsp;instead&nbsp;of&nbsp;parsing&nbsp;into&nbsp;JS&nbsp;or&nbsp;CSS&nbsp;styles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440729">if</span>&nbsp;<span class="ident" id="4440732">c</span><span class="op" id="4440733">.</span><span class="ident" id="4440734">element</span>&nbsp;<span class="op" id="4440742">!=</span>&nbsp;<span class="ident" id="4440745">elementNone</span>&nbsp;<span class="op" id="4440757">&amp;&amp;</span>&nbsp;<span class="op" id="4440760">!</span><span class="ident" id="4440761">isInTag</span><span class="op" id="4440768">(</span><span class="ident" id="4440769">st</span><span class="op" id="4440771">)</span>&nbsp;<span class="op" id="4440773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440779">st</span>&nbsp;<span class="op" id="4440782">=</span>&nbsp;<span class="ident" id="4440784">stateRCDATA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4440799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440804">d</span><span class="op" id="4440805">,</span>&nbsp;<span class="ident" id="4440807">nread</span>&nbsp;<span class="op" id="4440813">:=</span>&nbsp;<span class="ident" id="4440816">transitionFunc</span><span class="op" id="4440830">[</span><span class="ident" id="4440831">st</span><span class="op" id="4440833">]</span><span class="op" id="4440834">(</span><span class="ident" id="4440835">c</span><span class="op" id="4440836">,</span>&nbsp;<span class="ident" id="4440838">s</span><span class="op" id="4440839">[</span><span class="ident" id="4440840">i</span><span class="op" id="4440841">:</span><span class="op" id="4440842">]</span><span class="op" id="4440843">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440848">i1</span>&nbsp;<span class="op" id="4440851">:=</span>&nbsp;<span class="ident" id="4440854">i</span>&nbsp;<span class="op" id="4440856">+</span>&nbsp;<span class="ident" id="4440858">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440867">if</span>&nbsp;<span class="ident" id="4440870">c</span><span class="op" id="4440871">.</span><span class="ident" id="4440872">state</span>&nbsp;<span class="op" id="4440878">==</span>&nbsp;<span class="ident" id="4440881">stateText</span>&nbsp;<span class="op" id="4440891">||</span>&nbsp;<span class="ident" id="4440894">c</span><span class="op" id="4440895">.</span><span class="ident" id="4440896">state</span>&nbsp;<span class="op" id="4440902">==</span>&nbsp;<span class="ident" id="4440905">stateRCDATA</span>&nbsp;<span class="op" id="4440917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4440923">//&nbsp;Emit&nbsp;text&nbsp;up&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;tag&nbsp;or&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4440979">j</span>&nbsp;<span class="op" id="4440981">:=</span>&nbsp;<span class="ident" id="4440984">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440991">if</span>&nbsp;<span class="ident" id="4440994">d</span><span class="op" id="4440995">.</span><span class="ident" id="4440996">state</span>&nbsp;<span class="op" id="4441002">!=</span>&nbsp;<span class="ident" id="4441005">c</span><span class="op" id="4441006">.</span><span class="ident" id="4441007">state</span>&nbsp;<span class="op" id="4441013">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441020">for</span>&nbsp;<span class="ident" id="4441024">j1</span>&nbsp;<span class="op" id="4441027">:=</span>&nbsp;<span class="ident" id="4441030">j</span>&nbsp;<span class="op" id="4441032">-</span>&nbsp;<span class="num" id="4441034">1</span><span class="op" id="4441035">;</span>&nbsp;<span class="ident" id="4441037">j1</span>&nbsp;<span class="op" id="4441040">&gt;=</span>&nbsp;<span class="ident" id="4441043">i</span><span class="op" id="4441044">;</span>&nbsp;<span class="ident" id="4441046">j1</span><span class="op" id="4441048">--</span>&nbsp;<span class="op" id="4441051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441059">if</span>&nbsp;<span class="ident" id="4441062">s</span><span class="op" id="4441063">[</span><span class="ident" id="4441064">j1</span><span class="op" id="4441066">]</span>&nbsp;<span class="op" id="4441068">==</span>&nbsp;<span class="string" id="4441071">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4441075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441084">j</span>&nbsp;<span class="op" id="4441086">=</span>&nbsp;<span class="ident" id="4441088">j1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441098">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441110">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441129">b</span><span class="op" id="4441130">.</span><span class="ident" id="4441131">Write</span><span class="op" id="4441136">(</span><span class="ident" id="4441137">s</span><span class="op" id="4441138">[</span><span class="ident" id="4441139">i</span><span class="op" id="4441140">:</span><span class="ident" id="4441141">j</span><span class="op" id="4441142">]</span><span class="op" id="4441143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441148">}</span>&nbsp;<span class="keyword" id="4441150">else</span>&nbsp;<span class="op" id="4441155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441161">allText</span>&nbsp;<span class="op" id="4441169">=</span>&nbsp;<span class="ident" id="4441171">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441185">c</span><span class="op" id="4441186">,</span>&nbsp;<span class="ident" id="4441188">i</span>&nbsp;<span class="op" id="4441190">=</span>&nbsp;<span class="ident" id="4441192">d</span><span class="op" id="4441193">,</span>&nbsp;<span class="ident" id="4441195">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441201">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441216">i1</span>&nbsp;<span class="op" id="4441219">:=</span>&nbsp;<span class="ident" id="4441222">i</span>&nbsp;<span class="op" id="4441224">+</span>&nbsp;<span class="ident" id="4441226">bytes</span><span class="op" id="4441231">.</span><span class="ident" id="4441232">IndexAny</span><span class="op" id="4441240">(</span><span class="ident" id="4441241">s</span><span class="op" id="4441242">[</span><span class="ident" id="4441243">i</span><span class="op" id="4441244">:</span><span class="op" id="4441245">]</span><span class="op" id="4441246">,</span>&nbsp;<span class="ident" id="4441248">delimEnds</span><span class="op" id="4441257">[</span><span class="ident" id="4441258">c</span><span class="op" id="4441259">.</span><span class="ident" id="4441260">delim</span><span class="op" id="4441265">]</span><span class="op" id="4441266">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441270">if</span>&nbsp;<span class="ident" id="4441273">i1</span>&nbsp;<span class="op" id="4441276">&lt;</span>&nbsp;<span class="ident" id="4441278">i</span>&nbsp;<span class="op" id="4441280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441285">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441297">if</span>&nbsp;<span class="ident" id="4441300">c</span><span class="op" id="4441301">.</span><span class="ident" id="4441302">delim</span>&nbsp;<span class="op" id="4441308">!=</span>&nbsp;<span class="ident" id="4441311">delimSpaceOrTagEnd</span>&nbsp;<span class="op" id="4441330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4441335">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441360">i1</span><span class="op" id="4441362">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441371">c</span><span class="op" id="4441372">,</span>&nbsp;<span class="ident" id="4441374">i</span>&nbsp;<span class="op" id="4441376">=</span>&nbsp;<span class="ident" id="4441378">context</span><span class="op" id="4441385">{</span><span class="ident" id="4441386">state</span><span class="op" id="4441391">:</span>&nbsp;<span class="ident" id="4441393">stateTag</span><span class="op" id="4441401">,</span>&nbsp;<span class="ident" id="4441403">element</span><span class="op" id="4441410">:</span>&nbsp;<span class="ident" id="4441412">c</span><span class="op" id="4441413">.</span><span class="ident" id="4441414">element</span><span class="op" id="4441421">}</span><span class="op" id="4441422">,</span>&nbsp;<span class="ident" id="4441424">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441431">if</span>&nbsp;<span class="ident" id="4441434">allText</span>&nbsp;<span class="op" id="4441442">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441446">return</span>&nbsp;<span class="ident" id="4441453">html</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441459">}</span>&nbsp;<span class="keyword" id="4441461">else</span>&nbsp;<span class="keyword" id="4441466">if</span>&nbsp;<span class="ident" id="4441469">c</span><span class="op" id="4441470">.</span><span class="ident" id="4441471">state</span>&nbsp;<span class="op" id="4441477">==</span>&nbsp;<span class="ident" id="4441480">stateText</span>&nbsp;<span class="op" id="4441490">||</span>&nbsp;<span class="ident" id="4441493">c</span><span class="op" id="4441494">.</span><span class="ident" id="4441495">state</span>&nbsp;<span class="op" id="4441501">==</span>&nbsp;<span class="ident" id="4441504">stateRCDATA</span>&nbsp;<span class="op" id="4441516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441520">b</span><span class="op" id="4441521">.</span><span class="ident" id="4441522">Write</span><span class="op" id="4441527">(</span><span class="ident" id="4441528">s</span><span class="op" id="4441529">[</span><span class="ident" id="4441530">i</span><span class="op" id="4441531">:</span><span class="op" id="4441532">]</span><span class="op" id="4441533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441539">return</span>&nbsp;<span class="ident" id="4441546">b</span><span class="op" id="4441547">.</span><span class="ident" id="4441548">String</span><span class="op" id="4441554">(</span><span class="op" id="4441555">)</span><br>
<span class="lineno">215</span><span class="op" id="4441557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4441560">//&nbsp;htmlNameFilter&nbsp;accepts&nbsp;valid&nbsp;parts&nbsp;of&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;or&nbsp;tag&nbsp;name&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4441634">//&nbsp;a&nbsp;known-safe&nbsp;HTML&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="4441666">func</span>&nbsp;<span class="ident" id="4441671">htmlNameFilter</span><span class="op" id="4441685">(</span><span class="ident" id="4441686">args</span>&nbsp;<span class="op" id="4441691">...</span><span class="keyword" id="4441694">interface</span><span class="op" id="4441703">{</span><span class="op" id="4441704">}</span><span class="op" id="4441705">)</span>&nbsp;<span class="builtintype" id="4441707">string</span>&nbsp;<span class="op" id="4441714">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4441717">s</span><span class="op" id="4441718">,</span>&nbsp;<span class="ident" id="4441720">t</span>&nbsp;<span class="op" id="4441722">:=</span>&nbsp;<span class="ident" id="4441725">stringify</span><span class="op" id="4441734">(</span><span class="ident" id="4441735">args</span><span class="op" id="4441739">...</span><span class="op" id="4441742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441745">if</span>&nbsp;<span class="ident" id="4441748">t</span>&nbsp;<span class="op" id="4441750">==</span>&nbsp;<span class="ident" id="4441753">contentTypeHTMLAttr</span>&nbsp;<span class="op" id="4441773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441777">return</span>&nbsp;<span class="ident" id="4441784">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4441787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4441790">if</span>&nbsp;<span class="builtinfunc" id="4441793">len</span><span class="op" id="4441796">(</span><span class="ident" id="4441797">s</span><span class="op" id="4441798">)</span>&nbsp;<span class="op" id="4441800">==</span>&nbsp;<span class="num" id="4441803">0</span>&nbsp;<span class="op" id="4441805">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4441809">//&nbsp;Avoid&nbsp;violation&nbsp;of&nbsp;structure&nbsp;preservation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4441857">//&nbsp;&lt;input&nbsp;checked&nbsp;{{.K}}={{.V}}&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4441893">//&nbsp;Without&nbsp;this,&nbsp;if&nbsp;.K&nbsp;is&nbsp;empty&nbsp;then&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4441951">//&nbsp;checked,&nbsp;but&nbsp;otherwise&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;attribute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4442012">//&nbsp;named&nbsp;.K.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442027">return</span>&nbsp;<span class="ident" id="4442034">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4442053">s</span>&nbsp;<span class="op" id="4442055">=</span>&nbsp;<span class="ident" id="4442057">strings</span><span class="op" id="4442064">.</span><span class="ident" id="4442065">ToLower</span><span class="op" id="4442072">(</span><span class="ident" id="4442073">s</span><span class="op" id="4442074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442077">if</span>&nbsp;<span class="ident" id="4442080">t</span>&nbsp;<span class="op" id="4442082">:=</span>&nbsp;<span class="ident" id="4442085">attrType</span><span class="op" id="4442093">(</span><span class="ident" id="4442094">s</span><span class="op" id="4442095">)</span><span class="op" id="4442096">;</span>&nbsp;<span class="ident" id="4442098">t</span>&nbsp;<span class="op" id="4442100">!=</span>&nbsp;<span class="ident" id="4442103">contentTypePlain</span>&nbsp;<span class="op" id="4442120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4442124">//&nbsp;TODO:&nbsp;Split&nbsp;attr&nbsp;and&nbsp;element&nbsp;name&nbsp;part&nbsp;filters&nbsp;so&nbsp;we&nbsp;can&nbsp;whitelist</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4442196">//&nbsp;attributes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442213">return</span>&nbsp;<span class="ident" id="4442220">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442239">for</span>&nbsp;<span class="ident" id="4442243">_</span><span class="op" id="4442244">,</span>&nbsp;<span class="ident" id="4442246">r</span>&nbsp;<span class="op" id="4442248">:=</span>&nbsp;<span class="keyword" id="4442251">range</span>&nbsp;<span class="ident" id="4442257">s</span>&nbsp;<span class="op" id="4442259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442263">switch</span>&nbsp;<span class="op" id="4442270">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442274">case</span>&nbsp;<span class="string" id="4442279">&#39;0&#39;</span>&nbsp;<span class="op" id="4442283">&lt;=</span>&nbsp;<span class="ident" id="4442286">r</span>&nbsp;<span class="op" id="4442288">&amp;&amp;</span>&nbsp;<span class="ident" id="4442291">r</span>&nbsp;<span class="op" id="4442293">&lt;=</span>&nbsp;<span class="string" id="4442296">&#39;9&#39;</span><span class="op" id="4442299">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442303">case</span>&nbsp;<span class="string" id="4442308">&#39;a&#39;</span>&nbsp;<span class="op" id="4442312">&lt;=</span>&nbsp;<span class="ident" id="4442315">r</span>&nbsp;<span class="op" id="4442317">&amp;&amp;</span>&nbsp;<span class="ident" id="4442320">r</span>&nbsp;<span class="op" id="4442322">&lt;=</span>&nbsp;<span class="string" id="4442325">&#39;z&#39;</span><span class="op" id="4442328">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442332">default</span><span class="op" id="4442339">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442344">return</span>&nbsp;<span class="ident" id="4442351">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442368">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4442371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442374">return</span>&nbsp;<span class="ident" id="4442381">s</span><br>
<span class="lineno"></span><span class="op" id="4442383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4442386">//&nbsp;commentEscaper&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string&nbsp;regardless&nbsp;of&nbsp;input.</span><br>
<span class="lineno">250</span><span class="comment" id="4442450">//&nbsp;Comment&nbsp;content&nbsp;does&nbsp;not&nbsp;correspond&nbsp;to&nbsp;any&nbsp;parsed&nbsp;structure&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4442516">//&nbsp;human-readable&nbsp;content,&nbsp;so&nbsp;the&nbsp;simplest&nbsp;and&nbsp;most&nbsp;secure&nbsp;policy&nbsp;is&nbsp;to&nbsp;drop</span><br>
<span class="lineno"></span><span class="comment" id="4442593">//&nbsp;content&nbsp;interpolated&nbsp;into&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="4442632">//&nbsp;This&nbsp;approach&nbsp;is&nbsp;equally&nbsp;valid&nbsp;whether&nbsp;or&nbsp;not&nbsp;static&nbsp;comment&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4442707">//&nbsp;removed&nbsp;from&nbsp;the&nbsp;template.</span><br>
<span class="lineno">255</span><span class="keyword" id="4442737">func</span>&nbsp;<span class="ident" id="4442742">commentEscaper</span><span class="op" id="4442756">(</span><span class="ident" id="4442757">args</span>&nbsp;<span class="op" id="4442762">...</span><span class="keyword" id="4442765">interface</span><span class="op" id="4442774">{</span><span class="op" id="4442775">}</span><span class="op" id="4442776">)</span>&nbsp;<span class="builtintype" id="4442778">string</span>&nbsp;<span class="op" id="4442785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4442788">return</span>&nbsp;<span class="string" id="4442795">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="4442798">}</span>
</div>
</body>
</html>
