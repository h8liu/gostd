<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8287273">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8287329">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8287383">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8287434">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;API&nbsp;tests&nbsp;across&nbsp;platforms&nbsp;and&nbsp;will&nbsp;never&nbsp;have&nbsp;a&nbsp;build</span><br>
<span class="lineno"></span><span class="comment" id="8287513">//&nbsp;tag.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8287522">package</span>&nbsp;<span class="ident" id="8287530">net</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="8287535">import</span>&nbsp;<span class="op" id="8287542">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8287545">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8287558">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8287564">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8287575">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8287586">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8287593">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8287596">//&nbsp;testUnixAddr&nbsp;uses&nbsp;ioutil.TempFile&nbsp;to&nbsp;get&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;unique.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="8287666">//&nbsp;also&nbsp;uses&nbsp;/tmp&nbsp;directory&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;prohibited&nbsp;to&nbsp;create&nbsp;UNIX</span><br>
<span class="lineno">20</span><span class="comment" id="8287734">//&nbsp;sockets&nbsp;in&nbsp;TMPDIR.</span><br>
<span class="lineno"></span><span class="keyword" id="8287756">func</span>&nbsp;<span class="ident" id="8287761">testUnixAddr</span><span class="op" id="8287773">(</span><span class="op" id="8287774">)</span>&nbsp;<span class="builtintype" id="8287776">string</span>&nbsp;<span class="op" id="8287783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287786">f</span><span class="op" id="8287787">,</span>&nbsp;<span class="ident" id="8287789">err</span>&nbsp;<span class="op" id="8287793">:=</span>&nbsp;<span class="ident" id="8287796">ioutil</span><span class="op" id="8287802">.</span><span class="ident" id="8287803">TempFile</span><span class="op" id="8287811">(</span><span class="string" id="8287812">&#34;&#34;</span><span class="op" id="8287814">,</span>&nbsp;<span class="string" id="8287816">&#34;nettest&#34;</span><span class="op" id="8287825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287828">if</span>&nbsp;<span class="ident" id="8287831">err</span>&nbsp;<span class="op" id="8287835">!=</span>&nbsp;<span class="ident" id="8287838">nil</span>&nbsp;<span class="op" id="8287842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8287846">panic</span><span class="op" id="8287851">(</span><span class="ident" id="8287852">err</span><span class="op" id="8287855">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8287858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287861">addr</span>&nbsp;<span class="op" id="8287866">:=</span>&nbsp;<span class="ident" id="8287869">f</span><span class="op" id="8287870">.</span><span class="ident" id="8287871">Name</span><span class="op" id="8287875">(</span><span class="op" id="8287876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287879">f</span><span class="op" id="8287880">.</span><span class="ident" id="8287881">Close</span><span class="op" id="8287886">(</span><span class="op" id="8287887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287890">os</span><span class="op" id="8287892">.</span><span class="ident" id="8287893">Remove</span><span class="op" id="8287899">(</span><span class="ident" id="8287900">addr</span><span class="op" id="8287904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287907">return</span>&nbsp;<span class="ident" id="8287914">addr</span><br>
<span class="lineno">30</span><span class="op" id="8287919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8287922">var</span>&nbsp;<span class="ident" id="8287926">condFatalf</span>&nbsp;<span class="op" id="8287937">=</span>&nbsp;<span class="keyword" id="8287939">func</span><span class="op" id="8287943">(</span><span class="op" id="8287944">)</span>&nbsp;<span class="keyword" id="8287946">func</span><span class="op" id="8287950">(</span><span class="op" id="8287951">*</span><span class="ident" id="8287952">testing</span><span class="op" id="8287959">.</span><span class="ident" id="8287960">T</span><span class="op" id="8287961">,</span>&nbsp;<span class="builtintype" id="8287963">string</span><span class="op" id="8287969">,</span>&nbsp;<span class="op" id="8287971">...</span><span class="keyword" id="8287974">interface</span><span class="op" id="8287983">{</span><span class="op" id="8287984">}</span><span class="op" id="8287985">)</span>&nbsp;<span class="op" id="8287987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8287990">//&nbsp;A&nbsp;few&nbsp;APIs&nbsp;are&nbsp;not&nbsp;implemented&nbsp;yet&nbsp;on&nbsp;both&nbsp;Plan&nbsp;9&nbsp;and&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288057">switch</span>&nbsp;<span class="ident" id="8288064">runtime</span><span class="op" id="8288071">.</span><span class="ident" id="8288072">GOOS</span>&nbsp;<span class="op" id="8288077">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288080">case</span>&nbsp;<span class="string" id="8288085">&#34;plan9&#34;</span><span class="op" id="8288092">,</span>&nbsp;<span class="string" id="8288094">&#34;windows&#34;</span><span class="op" id="8288103">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288107">return</span>&nbsp;<span class="op" id="8288114">(</span><span class="op" id="8288115">*</span><span class="ident" id="8288116">testing</span><span class="op" id="8288123">.</span><span class="ident" id="8288124">T</span><span class="op" id="8288125">)</span><span class="op" id="8288126">.</span><span class="ident" id="8288127">Logf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288136">return</span>&nbsp;<span class="op" id="8288143">(</span><span class="op" id="8288144">*</span><span class="ident" id="8288145">testing</span><span class="op" id="8288152">.</span><span class="ident" id="8288153">T</span><span class="op" id="8288154">)</span><span class="op" id="8288155">.</span><span class="ident" id="8288156">Fatalf</span><br>
<span class="lineno"></span><span class="op" id="8288163">}</span><span class="op" id="8288164">(</span><span class="op" id="8288165">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="8288168">func</span>&nbsp;<span class="ident" id="8288173">TestTCPListenerSpecificMethods</span><span class="op" id="8288203">(</span><span class="ident" id="8288204">t</span>&nbsp;<span class="op" id="8288206">*</span><span class="ident" id="8288207">testing</span><span class="op" id="8288214">.</span><span class="ident" id="8288215">T</span><span class="op" id="8288216">)</span>&nbsp;<span class="op" id="8288218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288221">switch</span>&nbsp;<span class="ident" id="8288228">runtime</span><span class="op" id="8288235">.</span><span class="ident" id="8288236">GOOS</span>&nbsp;<span class="op" id="8288241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288244">case</span>&nbsp;<span class="string" id="8288249">&#34;plan9&#34;</span><span class="op" id="8288256">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288260">t</span><span class="op" id="8288261">.</span><span class="ident" id="8288262">Skipf</span><span class="op" id="8288267">(</span><span class="string" id="8288268">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8288289">,</span>&nbsp;<span class="ident" id="8288291">runtime</span><span class="op" id="8288298">.</span><span class="ident" id="8288299">GOOS</span><span class="op" id="8288303">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288310">la</span><span class="op" id="8288312">,</span>&nbsp;<span class="ident" id="8288314">err</span>&nbsp;<span class="op" id="8288318">:=</span>&nbsp;<span class="ident" id="8288321">ResolveTCPAddr</span><span class="op" id="8288335">(</span><span class="string" id="8288336">&#34;tcp4&#34;</span><span class="op" id="8288342">,</span>&nbsp;<span class="string" id="8288344">&#34;127.0.0.1:0&#34;</span><span class="op" id="8288357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288360">if</span>&nbsp;<span class="ident" id="8288363">err</span>&nbsp;<span class="op" id="8288367">!=</span>&nbsp;<span class="ident" id="8288370">nil</span>&nbsp;<span class="op" id="8288374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288378">t</span><span class="op" id="8288379">.</span><span class="ident" id="8288380">Fatalf</span><span class="op" id="8288386">(</span><span class="string" id="8288387">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8288414">,</span>&nbsp;<span class="ident" id="8288416">err</span><span class="op" id="8288419">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288425">ln</span><span class="op" id="8288427">,</span>&nbsp;<span class="ident" id="8288429">err</span>&nbsp;<span class="op" id="8288433">:=</span>&nbsp;<span class="ident" id="8288436">ListenTCP</span><span class="op" id="8288445">(</span><span class="string" id="8288446">&#34;tcp4&#34;</span><span class="op" id="8288452">,</span>&nbsp;<span class="ident" id="8288454">la</span><span class="op" id="8288456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288459">if</span>&nbsp;<span class="ident" id="8288462">err</span>&nbsp;<span class="op" id="8288466">!=</span>&nbsp;<span class="ident" id="8288469">nil</span>&nbsp;<span class="op" id="8288473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288477">t</span><span class="op" id="8288478">.</span><span class="ident" id="8288479">Fatalf</span><span class="op" id="8288485">(</span><span class="string" id="8288486">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8288508">,</span>&nbsp;<span class="ident" id="8288510">err</span><span class="op" id="8288513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288516">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288519">defer</span>&nbsp;<span class="ident" id="8288525">ln</span><span class="op" id="8288527">.</span><span class="ident" id="8288528">Close</span><span class="op" id="8288533">(</span><span class="op" id="8288534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288537">ln</span><span class="op" id="8288539">.</span><span class="ident" id="8288540">Addr</span><span class="op" id="8288544">(</span><span class="op" id="8288545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288548">ln</span><span class="op" id="8288550">.</span><span class="ident" id="8288551">SetDeadline</span><span class="op" id="8288562">(</span><span class="ident" id="8288563">time</span><span class="op" id="8288567">.</span><span class="ident" id="8288568">Now</span><span class="op" id="8288571">(</span><span class="op" id="8288572">)</span><span class="op" id="8288573">.</span><span class="ident" id="8288574">Add</span><span class="op" id="8288577">(</span><span class="num" id="8288578">30</span>&nbsp;<span class="op" id="8288581">*</span>&nbsp;<span class="ident" id="8288583">time</span><span class="op" id="8288587">.</span><span class="ident" id="8288588">Nanosecond</span><span class="op" id="8288598">)</span><span class="op" id="8288599">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288603">if</span>&nbsp;<span class="ident" id="8288606">c</span><span class="op" id="8288607">,</span>&nbsp;<span class="ident" id="8288609">err</span>&nbsp;<span class="op" id="8288613">:=</span>&nbsp;<span class="ident" id="8288616">ln</span><span class="op" id="8288618">.</span><span class="ident" id="8288619">Accept</span><span class="op" id="8288625">(</span><span class="op" id="8288626">)</span><span class="op" id="8288627">;</span>&nbsp;<span class="ident" id="8288629">err</span>&nbsp;<span class="op" id="8288633">!=</span>&nbsp;<span class="ident" id="8288636">nil</span>&nbsp;<span class="op" id="8288640">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288644">if</span>&nbsp;<span class="op" id="8288647">!</span><span class="ident" id="8288648">err</span><span class="op" id="8288651">.</span><span class="op" id="8288652">(</span><span class="ident" id="8288653">Error</span><span class="op" id="8288658">)</span><span class="op" id="8288659">.</span><span class="ident" id="8288660">Timeout</span><span class="op" id="8288667">(</span><span class="op" id="8288668">)</span>&nbsp;<span class="op" id="8288670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288675">t</span><span class="op" id="8288676">.</span><span class="ident" id="8288677">Fatalf</span><span class="op" id="8288683">(</span><span class="string" id="8288684">&#34;TCPListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8288715">,</span>&nbsp;<span class="ident" id="8288717">err</span><span class="op" id="8288720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288727">}</span>&nbsp;<span class="keyword" id="8288729">else</span>&nbsp;<span class="op" id="8288734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288738">c</span><span class="op" id="8288739">.</span><span class="ident" id="8288740">Close</span><span class="op" id="8288745">(</span><span class="op" id="8288746">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288752">if</span>&nbsp;<span class="ident" id="8288755">c</span><span class="op" id="8288756">,</span>&nbsp;<span class="ident" id="8288758">err</span>&nbsp;<span class="op" id="8288762">:=</span>&nbsp;<span class="ident" id="8288765">ln</span><span class="op" id="8288767">.</span><span class="ident" id="8288768">AcceptTCP</span><span class="op" id="8288777">(</span><span class="op" id="8288778">)</span><span class="op" id="8288779">;</span>&nbsp;<span class="ident" id="8288781">err</span>&nbsp;<span class="op" id="8288785">!=</span>&nbsp;<span class="ident" id="8288788">nil</span>&nbsp;<span class="op" id="8288792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288796">if</span>&nbsp;<span class="op" id="8288799">!</span><span class="ident" id="8288800">err</span><span class="op" id="8288803">.</span><span class="op" id="8288804">(</span><span class="ident" id="8288805">Error</span><span class="op" id="8288810">)</span><span class="op" id="8288811">.</span><span class="ident" id="8288812">Timeout</span><span class="op" id="8288819">(</span><span class="op" id="8288820">)</span>&nbsp;<span class="op" id="8288822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288827">t</span><span class="op" id="8288828">.</span><span class="ident" id="8288829">Fatalf</span><span class="op" id="8288835">(</span><span class="string" id="8288836">&#34;TCPListener.AcceptTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8288870">,</span>&nbsp;<span class="ident" id="8288872">err</span><span class="op" id="8288875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288879">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288882">}</span>&nbsp;<span class="keyword" id="8288884">else</span>&nbsp;<span class="op" id="8288889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288893">c</span><span class="op" id="8288894">.</span><span class="ident" id="8288895">Close</span><span class="op" id="8288900">(</span><span class="op" id="8288901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288908">if</span>&nbsp;<span class="ident" id="8288911">f</span><span class="op" id="8288912">,</span>&nbsp;<span class="ident" id="8288914">err</span>&nbsp;<span class="op" id="8288918">:=</span>&nbsp;<span class="ident" id="8288921">ln</span><span class="op" id="8288923">.</span><span class="ident" id="8288924">File</span><span class="op" id="8288928">(</span><span class="op" id="8288929">)</span><span class="op" id="8288930">;</span>&nbsp;<span class="ident" id="8288932">err</span>&nbsp;<span class="op" id="8288936">!=</span>&nbsp;<span class="ident" id="8288939">nil</span>&nbsp;<span class="op" id="8288943">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288947">condFatalf</span><span class="op" id="8288957">(</span><span class="ident" id="8288958">t</span><span class="op" id="8288959">,</span>&nbsp;<span class="string" id="8288961">&#34;TCPListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8288990">,</span>&nbsp;<span class="ident" id="8288992">err</span><span class="op" id="8288995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288998">}</span>&nbsp;<span class="keyword" id="8289000">else</span>&nbsp;<span class="op" id="8289005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289009">f</span><span class="op" id="8289010">.</span><span class="ident" id="8289011">Close</span><span class="op" id="8289016">(</span><span class="op" id="8289017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8289020">}</span><br>
<span class="lineno"></span><span class="op" id="8289022">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="8289025">func</span>&nbsp;<span class="ident" id="8289030">TestTCPConnSpecificMethods</span><span class="op" id="8289056">(</span><span class="ident" id="8289057">t</span>&nbsp;<span class="op" id="8289059">*</span><span class="ident" id="8289060">testing</span><span class="op" id="8289067">.</span><span class="ident" id="8289068">T</span><span class="op" id="8289069">)</span>&nbsp;<span class="op" id="8289071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289074">la</span><span class="op" id="8289076">,</span>&nbsp;<span class="ident" id="8289078">err</span>&nbsp;<span class="op" id="8289082">:=</span>&nbsp;<span class="ident" id="8289085">ResolveTCPAddr</span><span class="op" id="8289099">(</span><span class="string" id="8289100">&#34;tcp4&#34;</span><span class="op" id="8289106">,</span>&nbsp;<span class="string" id="8289108">&#34;127.0.0.1:0&#34;</span><span class="op" id="8289121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8289124">if</span>&nbsp;<span class="ident" id="8289127">err</span>&nbsp;<span class="op" id="8289131">!=</span>&nbsp;<span class="ident" id="8289134">nil</span>&nbsp;<span class="op" id="8289138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289142">t</span><span class="op" id="8289143">.</span><span class="ident" id="8289144">Fatalf</span><span class="op" id="8289150">(</span><span class="string" id="8289151">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8289178">,</span>&nbsp;<span class="ident" id="8289180">err</span><span class="op" id="8289183">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8289186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289189">ln</span><span class="op" id="8289191">,</span>&nbsp;<span class="ident" id="8289193">err</span>&nbsp;<span class="op" id="8289197">:=</span>&nbsp;<span class="ident" id="8289200">ListenTCP</span><span class="op" id="8289209">(</span><span class="string" id="8289210">&#34;tcp4&#34;</span><span class="op" id="8289216">,</span>&nbsp;<span class="ident" id="8289218">la</span><span class="op" id="8289220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8289223">if</span>&nbsp;<span class="ident" id="8289226">err</span>&nbsp;<span class="op" id="8289230">!=</span>&nbsp;<span class="ident" id="8289233">nil</span>&nbsp;<span class="op" id="8289237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289241">t</span><span class="op" id="8289242">.</span><span class="ident" id="8289243">Fatalf</span><span class="op" id="8289249">(</span><span class="string" id="8289250">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8289272">,</span>&nbsp;<span class="ident" id="8289274">err</span><span class="op" id="8289277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8289280">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8289283">defer</span>&nbsp;<span class="ident" id="8289289">ln</span><span class="op" id="8289291">.</span><span class="ident" id="8289292">Close</span><span class="op" id="8289297">(</span><span class="op" id="8289298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289301">ln</span><span class="op" id="8289303">.</span><span class="ident" id="8289304">Addr</span><span class="op" id="8289308">(</span><span class="op" id="8289309">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289313">done</span>&nbsp;<span class="op" id="8289318">:=</span>&nbsp;<span class="builtinfunc" id="8289321">make</span><span class="op" id="8289325">(</span><span class="keyword" id="8289326">chan</span>&nbsp;<span class="builtintype" id="8289331">int</span><span class="op" id="8289334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8289337">go</span>&nbsp;<span class="ident" id="8289340">transponder</span><span class="op" id="8289351">(</span><span class="ident" id="8289352">t</span><span class="op" id="8289353">,</span>&nbsp;<span class="ident" id="8289355">ln</span><span class="op" id="8289357">,</span>&nbsp;<span class="ident" id="8289359">done</span><span class="op" id="8289363">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289367">ra</span><span class="op" id="8289369">,</span>&nbsp;<span class="ident" id="8289371">err</span>&nbsp;<span class="op" id="8289375">:=</span>&nbsp;<span class="ident" id="8289378">ResolveTCPAddr</span><span class="op" id="8289392">(</span><span class="string" id="8289393">&#34;tcp4&#34;</span><span class="op" id="8289399">,</span>&nbsp;<span class="ident" id="8289401">ln</span><span class="op" id="8289403">.</span><span class="ident" id="8289404">Addr</span><span class="op" id="8289408">(</span><span class="op" id="8289409">)</span><span class="op" id="8289410">.</span><span class="ident" id="8289411">String</span><span class="op" id="8289417">(</span><span class="op" id="8289418">)</span><span class="op" id="8289419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8289422">if</span>&nbsp;<span class="ident" id="8289425">err</span>&nbsp;<span class="op" id="8289429">!=</span>&nbsp;<span class="ident" id="8289432">nil</span>&nbsp;<span class="op" id="8289436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289440">t</span><span class="op" id="8289441">.</span><span class="ident" id="8289442">Fatalf</span><span class="op" id="8289448">(</span><span class="string" id="8289449">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8289476">,</span>&nbsp;<span class="ident" id="8289478">err</span><span class="op" id="8289481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8289484">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289487">c</span><span class="op" id="8289488">,</span>&nbsp;<span class="ident" id="8289490">err</span>&nbsp;<span class="op" id="8289494">:=</span>&nbsp;<span class="ident" id="8289497">DialTCP</span><span class="op" id="8289504">(</span><span class="string" id="8289505">&#34;tcp4&#34;</span><span class="op" id="8289511">,</span>&nbsp;<span class="ident" id="8289513">nil</span><span class="op" id="8289516">,</span>&nbsp;<span class="ident" id="8289518">ra</span><span class="op" id="8289520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8289523">if</span>&nbsp;<span class="ident" id="8289526">err</span>&nbsp;<span class="op" id="8289530">!=</span>&nbsp;<span class="ident" id="8289533">nil</span>&nbsp;<span class="op" id="8289537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289541">t</span><span class="op" id="8289542">.</span><span class="ident" id="8289543">Fatalf</span><span class="op" id="8289549">(</span><span class="string" id="8289550">&#34;DialTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8289570">,</span>&nbsp;<span class="ident" id="8289572">err</span><span class="op" id="8289575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8289578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8289581">defer</span>&nbsp;<span class="ident" id="8289587">c</span><span class="op" id="8289588">.</span><span class="ident" id="8289589">Close</span><span class="op" id="8289594">(</span><span class="op" id="8289595">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289598">c</span><span class="op" id="8289599">.</span><span class="ident" id="8289600">SetKeepAlive</span><span class="op" id="8289612">(</span><span class="builtintype" id="8289613">false</span><span class="op" id="8289618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289621">c</span><span class="op" id="8289622">.</span><span class="ident" id="8289623">SetKeepAlivePeriod</span><span class="op" id="8289641">(</span><span class="num" id="8289642">3</span>&nbsp;<span class="op" id="8289644">*</span>&nbsp;<span class="ident" id="8289646">time</span><span class="op" id="8289650">.</span><span class="ident" id="8289651">Second</span><span class="op" id="8289657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289660">c</span><span class="op" id="8289661">.</span><span class="ident" id="8289662">SetLinger</span><span class="op" id="8289671">(</span><span class="num" id="8289672">0</span><span class="op" id="8289673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289676">c</span><span class="op" id="8289677">.</span><span class="ident" id="8289678">SetNoDelay</span><span class="op" id="8289688">(</span><span class="builtintype" id="8289689">false</span><span class="op" id="8289694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289697">c</span><span class="op" id="8289698">.</span><span class="ident" id="8289699">LocalAddr</span><span class="op" id="8289708">(</span><span class="op" id="8289709">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289712">c</span><span class="op" id="8289713">.</span><span class="ident" id="8289714">RemoteAddr</span><span class="op" id="8289724">(</span><span class="op" id="8289725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289728">c</span><span class="op" id="8289729">.</span><span class="ident" id="8289730">SetDeadline</span><span class="op" id="8289741">(</span><span class="ident" id="8289742">time</span><span class="op" id="8289746">.</span><span class="ident" id="8289747">Now</span><span class="op" id="8289750">(</span><span class="op" id="8289751">)</span><span class="op" id="8289752">.</span><span class="ident" id="8289753">Add</span><span class="op" id="8289756">(</span><span class="ident" id="8289757">someTimeout</span><span class="op" id="8289768">)</span><span class="op" id="8289769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289772">c</span><span class="op" id="8289773">.</span><span class="ident" id="8289774">SetReadDeadline</span><span class="op" id="8289789">(</span><span class="ident" id="8289790">time</span><span class="op" id="8289794">.</span><span class="ident" id="8289795">Now</span><span class="op" id="8289798">(</span><span class="op" id="8289799">)</span><span class="op" id="8289800">.</span><span class="ident" id="8289801">Add</span><span class="op" id="8289804">(</span><span class="ident" id="8289805">someTimeout</span><span class="op" id="8289816">)</span><span class="op" id="8289817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289820">c</span><span class="op" id="8289821">.</span><span class="ident" id="8289822">SetWriteDeadline</span><span class="op" id="8289838">(</span><span class="ident" id="8289839">time</span><span class="op" id="8289843">.</span><span class="ident" id="8289844">Now</span><span class="op" id="8289847">(</span><span class="op" id="8289848">)</span><span class="op" id="8289849">.</span><span class="ident" id="8289850">Add</span><span class="op" id="8289853">(</span><span class="ident" id="8289854">someTimeout</span><span class="op" id="8289865">)</span><span class="op" id="8289866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8289870">if</span>&nbsp;<span class="ident" id="8289873">_</span><span class="op" id="8289874">,</span>&nbsp;<span class="ident" id="8289876">err</span>&nbsp;<span class="op" id="8289880">:=</span>&nbsp;<span class="ident" id="8289883">c</span><span class="op" id="8289884">.</span><span class="ident" id="8289885">Write</span><span class="op" id="8289890">(</span><span class="op" id="8289891">[</span><span class="op" id="8289892">]</span><span class="builtintype" id="8289893">byte</span><span class="op" id="8289897">(</span><span class="string" id="8289898">&#34;TCPCONN&nbsp;TEST&#34;</span><span class="op" id="8289912">)</span><span class="op" id="8289913">)</span><span class="op" id="8289914">;</span>&nbsp;<span class="ident" id="8289916">err</span>&nbsp;<span class="op" id="8289920">!=</span>&nbsp;<span class="ident" id="8289923">nil</span>&nbsp;<span class="op" id="8289927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289931">t</span><span class="op" id="8289932">.</span><span class="ident" id="8289933">Fatalf</span><span class="op" id="8289939">(</span><span class="string" id="8289940">&#34;TCPConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8289966">,</span>&nbsp;<span class="ident" id="8289968">err</span><span class="op" id="8289971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8289974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289977">rb</span>&nbsp;<span class="op" id="8289980">:=</span>&nbsp;<span class="builtinfunc" id="8289983">make</span><span class="op" id="8289987">(</span><span class="op" id="8289988">[</span><span class="op" id="8289989">]</span><span class="builtintype" id="8289990">byte</span><span class="op" id="8289994">,</span>&nbsp;<span class="num" id="8289996">128</span><span class="op" id="8289999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8290002">if</span>&nbsp;<span class="ident" id="8290005">_</span><span class="op" id="8290006">,</span>&nbsp;<span class="ident" id="8290008">err</span>&nbsp;<span class="op" id="8290012">:=</span>&nbsp;<span class="ident" id="8290015">c</span><span class="op" id="8290016">.</span><span class="ident" id="8290017">Read</span><span class="op" id="8290021">(</span><span class="ident" id="8290022">rb</span><span class="op" id="8290024">)</span><span class="op" id="8290025">;</span>&nbsp;<span class="ident" id="8290027">err</span>&nbsp;<span class="op" id="8290031">!=</span>&nbsp;<span class="ident" id="8290034">nil</span>&nbsp;<span class="op" id="8290038">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290042">t</span><span class="op" id="8290043">.</span><span class="ident" id="8290044">Fatalf</span><span class="op" id="8290050">(</span><span class="string" id="8290051">&#34;TCPConn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8290076">,</span>&nbsp;<span class="ident" id="8290078">err</span><span class="op" id="8290081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8290084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8290088">&lt;-</span><span class="ident" id="8290090">done</span><br>
<span class="lineno"></span><span class="op" id="8290095">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="8290098">func</span>&nbsp;<span class="ident" id="8290103">TestUDPConnSpecificMethods</span><span class="op" id="8290129">(</span><span class="ident" id="8290130">t</span>&nbsp;<span class="op" id="8290132">*</span><span class="ident" id="8290133">testing</span><span class="op" id="8290140">.</span><span class="ident" id="8290141">T</span><span class="op" id="8290142">)</span>&nbsp;<span class="op" id="8290144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290147">la</span><span class="op" id="8290149">,</span>&nbsp;<span class="ident" id="8290151">err</span>&nbsp;<span class="op" id="8290155">:=</span>&nbsp;<span class="ident" id="8290158">ResolveUDPAddr</span><span class="op" id="8290172">(</span><span class="string" id="8290173">&#34;udp4&#34;</span><span class="op" id="8290179">,</span>&nbsp;<span class="string" id="8290181">&#34;127.0.0.1:0&#34;</span><span class="op" id="8290194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8290197">if</span>&nbsp;<span class="ident" id="8290200">err</span>&nbsp;<span class="op" id="8290204">!=</span>&nbsp;<span class="ident" id="8290207">nil</span>&nbsp;<span class="op" id="8290211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290215">t</span><span class="op" id="8290216">.</span><span class="ident" id="8290217">Fatalf</span><span class="op" id="8290223">(</span><span class="string" id="8290224">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8290251">,</span>&nbsp;<span class="ident" id="8290253">err</span><span class="op" id="8290256">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8290259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290262">c</span><span class="op" id="8290263">,</span>&nbsp;<span class="ident" id="8290265">err</span>&nbsp;<span class="op" id="8290269">:=</span>&nbsp;<span class="ident" id="8290272">ListenUDP</span><span class="op" id="8290281">(</span><span class="string" id="8290282">&#34;udp4&#34;</span><span class="op" id="8290288">,</span>&nbsp;<span class="ident" id="8290290">la</span><span class="op" id="8290292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8290295">if</span>&nbsp;<span class="ident" id="8290298">err</span>&nbsp;<span class="op" id="8290302">!=</span>&nbsp;<span class="ident" id="8290305">nil</span>&nbsp;<span class="op" id="8290309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290313">t</span><span class="op" id="8290314">.</span><span class="ident" id="8290315">Fatalf</span><span class="op" id="8290321">(</span><span class="string" id="8290322">&#34;ListenUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8290344">,</span>&nbsp;<span class="ident" id="8290346">err</span><span class="op" id="8290349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8290352">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8290355">defer</span>&nbsp;<span class="ident" id="8290361">c</span><span class="op" id="8290362">.</span><span class="ident" id="8290363">Close</span><span class="op" id="8290368">(</span><span class="op" id="8290369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290372">c</span><span class="op" id="8290373">.</span><span class="ident" id="8290374">LocalAddr</span><span class="op" id="8290383">(</span><span class="op" id="8290384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290387">c</span><span class="op" id="8290388">.</span><span class="ident" id="8290389">RemoteAddr</span><span class="op" id="8290399">(</span><span class="op" id="8290400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290403">c</span><span class="op" id="8290404">.</span><span class="ident" id="8290405">SetDeadline</span><span class="op" id="8290416">(</span><span class="ident" id="8290417">time</span><span class="op" id="8290421">.</span><span class="ident" id="8290422">Now</span><span class="op" id="8290425">(</span><span class="op" id="8290426">)</span><span class="op" id="8290427">.</span><span class="ident" id="8290428">Add</span><span class="op" id="8290431">(</span><span class="ident" id="8290432">someTimeout</span><span class="op" id="8290443">)</span><span class="op" id="8290444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290447">c</span><span class="op" id="8290448">.</span><span class="ident" id="8290449">SetReadDeadline</span><span class="op" id="8290464">(</span><span class="ident" id="8290465">time</span><span class="op" id="8290469">.</span><span class="ident" id="8290470">Now</span><span class="op" id="8290473">(</span><span class="op" id="8290474">)</span><span class="op" id="8290475">.</span><span class="ident" id="8290476">Add</span><span class="op" id="8290479">(</span><span class="ident" id="8290480">someTimeout</span><span class="op" id="8290491">)</span><span class="op" id="8290492">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290495">c</span><span class="op" id="8290496">.</span><span class="ident" id="8290497">SetWriteDeadline</span><span class="op" id="8290513">(</span><span class="ident" id="8290514">time</span><span class="op" id="8290518">.</span><span class="ident" id="8290519">Now</span><span class="op" id="8290522">(</span><span class="op" id="8290523">)</span><span class="op" id="8290524">.</span><span class="ident" id="8290525">Add</span><span class="op" id="8290528">(</span><span class="ident" id="8290529">someTimeout</span><span class="op" id="8290540">)</span><span class="op" id="8290541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290544">c</span><span class="op" id="8290545">.</span><span class="ident" id="8290546">SetReadBuffer</span><span class="op" id="8290559">(</span><span class="num" id="8290560">2048</span><span class="op" id="8290564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290567">c</span><span class="op" id="8290568">.</span><span class="ident" id="8290569">SetWriteBuffer</span><span class="op" id="8290583">(</span><span class="num" id="8290584">2048</span><span class="op" id="8290588">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290592">wb</span>&nbsp;<span class="op" id="8290595">:=</span>&nbsp;<span class="op" id="8290598">[</span><span class="op" id="8290599">]</span><span class="builtintype" id="8290600">byte</span><span class="op" id="8290604">(</span><span class="string" id="8290605">&#34;UDPCONN&nbsp;TEST&#34;</span><span class="op" id="8290619">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290622">rb</span>&nbsp;<span class="op" id="8290625">:=</span>&nbsp;<span class="builtinfunc" id="8290628">make</span><span class="op" id="8290632">(</span><span class="op" id="8290633">[</span><span class="op" id="8290634">]</span><span class="builtintype" id="8290635">byte</span><span class="op" id="8290639">,</span>&nbsp;<span class="num" id="8290641">128</span><span class="op" id="8290644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8290647">if</span>&nbsp;<span class="ident" id="8290650">_</span><span class="op" id="8290651">,</span>&nbsp;<span class="ident" id="8290653">err</span>&nbsp;<span class="op" id="8290657">:=</span>&nbsp;<span class="ident" id="8290660">c</span><span class="op" id="8290661">.</span><span class="ident" id="8290662">WriteToUDP</span><span class="op" id="8290672">(</span><span class="ident" id="8290673">wb</span><span class="op" id="8290675">,</span>&nbsp;<span class="ident" id="8290677">c</span><span class="op" id="8290678">.</span><span class="ident" id="8290679">LocalAddr</span><span class="op" id="8290688">(</span><span class="op" id="8290689">)</span><span class="op" id="8290690">.</span><span class="op" id="8290691">(</span><span class="op" id="8290692">*</span><span class="ident" id="8290693">UDPAddr</span><span class="op" id="8290700">)</span><span class="op" id="8290701">)</span><span class="op" id="8290702">;</span>&nbsp;<span class="ident" id="8290704">err</span>&nbsp;<span class="op" id="8290708">!=</span>&nbsp;<span class="ident" id="8290711">nil</span>&nbsp;<span class="op" id="8290715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290719">t</span><span class="op" id="8290720">.</span><span class="ident" id="8290721">Fatalf</span><span class="op" id="8290727">(</span><span class="string" id="8290728">&#34;UDPConn.WriteToUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8290759">,</span>&nbsp;<span class="ident" id="8290761">err</span><span class="op" id="8290764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8290767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8290770">if</span>&nbsp;<span class="ident" id="8290773">_</span><span class="op" id="8290774">,</span>&nbsp;<span class="ident" id="8290776">_</span><span class="op" id="8290777">,</span>&nbsp;<span class="ident" id="8290779">err</span>&nbsp;<span class="op" id="8290783">:=</span>&nbsp;<span class="ident" id="8290786">c</span><span class="op" id="8290787">.</span><span class="ident" id="8290788">ReadFromUDP</span><span class="op" id="8290799">(</span><span class="ident" id="8290800">rb</span><span class="op" id="8290802">)</span><span class="op" id="8290803">;</span>&nbsp;<span class="ident" id="8290805">err</span>&nbsp;<span class="op" id="8290809">!=</span>&nbsp;<span class="ident" id="8290812">nil</span>&nbsp;<span class="op" id="8290816">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290820">t</span><span class="op" id="8290821">.</span><span class="ident" id="8290822">Fatalf</span><span class="op" id="8290828">(</span><span class="string" id="8290829">&#34;UDPConn.ReadFromUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8290861">,</span>&nbsp;<span class="ident" id="8290863">err</span><span class="op" id="8290866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8290869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8290872">if</span>&nbsp;<span class="ident" id="8290875">_</span><span class="op" id="8290876">,</span>&nbsp;<span class="ident" id="8290878">_</span><span class="op" id="8290879">,</span>&nbsp;<span class="ident" id="8290881">err</span>&nbsp;<span class="op" id="8290885">:=</span>&nbsp;<span class="ident" id="8290888">c</span><span class="op" id="8290889">.</span><span class="ident" id="8290890">WriteMsgUDP</span><span class="op" id="8290901">(</span><span class="ident" id="8290902">wb</span><span class="op" id="8290904">,</span>&nbsp;<span class="ident" id="8290906">nil</span><span class="op" id="8290909">,</span>&nbsp;<span class="ident" id="8290911">c</span><span class="op" id="8290912">.</span><span class="ident" id="8290913">LocalAddr</span><span class="op" id="8290922">(</span><span class="op" id="8290923">)</span><span class="op" id="8290924">.</span><span class="op" id="8290925">(</span><span class="op" id="8290926">*</span><span class="ident" id="8290927">UDPAddr</span><span class="op" id="8290934">)</span><span class="op" id="8290935">)</span><span class="op" id="8290936">;</span>&nbsp;<span class="ident" id="8290938">err</span>&nbsp;<span class="op" id="8290942">!=</span>&nbsp;<span class="ident" id="8290945">nil</span>&nbsp;<span class="op" id="8290949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290953">condFatalf</span><span class="op" id="8290963">(</span><span class="ident" id="8290964">t</span><span class="op" id="8290965">,</span>&nbsp;<span class="string" id="8290967">&#34;UDPConn.WriteMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8290999">,</span>&nbsp;<span class="ident" id="8291001">err</span><span class="op" id="8291004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291007">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291010">if</span>&nbsp;<span class="ident" id="8291013">_</span><span class="op" id="8291014">,</span>&nbsp;<span class="ident" id="8291016">_</span><span class="op" id="8291017">,</span>&nbsp;<span class="ident" id="8291019">_</span><span class="op" id="8291020">,</span>&nbsp;<span class="ident" id="8291022">_</span><span class="op" id="8291023">,</span>&nbsp;<span class="ident" id="8291025">err</span>&nbsp;<span class="op" id="8291029">:=</span>&nbsp;<span class="ident" id="8291032">c</span><span class="op" id="8291033">.</span><span class="ident" id="8291034">ReadMsgUDP</span><span class="op" id="8291044">(</span><span class="ident" id="8291045">rb</span><span class="op" id="8291047">,</span>&nbsp;<span class="ident" id="8291049">nil</span><span class="op" id="8291052">)</span><span class="op" id="8291053">;</span>&nbsp;<span class="ident" id="8291055">err</span>&nbsp;<span class="op" id="8291059">!=</span>&nbsp;<span class="ident" id="8291062">nil</span>&nbsp;<span class="op" id="8291066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291070">condFatalf</span><span class="op" id="8291080">(</span><span class="ident" id="8291081">t</span><span class="op" id="8291082">,</span>&nbsp;<span class="string" id="8291084">&#34;UDPConn.ReadMsgUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8291115">,</span>&nbsp;<span class="ident" id="8291117">err</span><span class="op" id="8291120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291127">if</span>&nbsp;<span class="ident" id="8291130">f</span><span class="op" id="8291131">,</span>&nbsp;<span class="ident" id="8291133">err</span>&nbsp;<span class="op" id="8291137">:=</span>&nbsp;<span class="ident" id="8291140">c</span><span class="op" id="8291141">.</span><span class="ident" id="8291142">File</span><span class="op" id="8291146">(</span><span class="op" id="8291147">)</span><span class="op" id="8291148">;</span>&nbsp;<span class="ident" id="8291150">err</span>&nbsp;<span class="op" id="8291154">!=</span>&nbsp;<span class="ident" id="8291157">nil</span>&nbsp;<span class="op" id="8291161">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291165">condFatalf</span><span class="op" id="8291175">(</span><span class="ident" id="8291176">t</span><span class="op" id="8291177">,</span>&nbsp;<span class="string" id="8291179">&#34;UDPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8291204">,</span>&nbsp;<span class="ident" id="8291206">err</span><span class="op" id="8291209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291212">}</span>&nbsp;<span class="keyword" id="8291214">else</span>&nbsp;<span class="op" id="8291219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291223">f</span><span class="op" id="8291224">.</span><span class="ident" id="8291225">Close</span><span class="op" id="8291230">(</span><span class="op" id="8291231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291238">defer</span>&nbsp;<span class="keyword" id="8291244">func</span><span class="op" id="8291248">(</span><span class="op" id="8291249">)</span>&nbsp;<span class="op" id="8291251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291255">if</span>&nbsp;<span class="ident" id="8291258">p</span>&nbsp;<span class="op" id="8291260">:=</span>&nbsp;<span class="builtinfunc" id="8291263">recover</span><span class="op" id="8291270">(</span><span class="op" id="8291271">)</span><span class="op" id="8291272">;</span>&nbsp;<span class="ident" id="8291274">p</span>&nbsp;<span class="op" id="8291276">!=</span>&nbsp;<span class="ident" id="8291279">nil</span>&nbsp;<span class="op" id="8291283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291288">t</span><span class="op" id="8291289">.</span><span class="ident" id="8291290">Fatalf</span><span class="op" id="8291296">(</span><span class="string" id="8291297">&#34;UDPConn.WriteToUDP&nbsp;or&nbsp;WriteMsgUDP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="8291345">,</span>&nbsp;<span class="ident" id="8291347">p</span><span class="op" id="8291348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291355">}</span><span class="op" id="8291356">(</span><span class="op" id="8291357">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291361">c</span><span class="op" id="8291362">.</span><span class="ident" id="8291363">WriteToUDP</span><span class="op" id="8291373">(</span><span class="ident" id="8291374">wb</span><span class="op" id="8291376">,</span>&nbsp;<span class="ident" id="8291378">nil</span><span class="op" id="8291381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291384">c</span><span class="op" id="8291385">.</span><span class="ident" id="8291386">WriteMsgUDP</span><span class="op" id="8291397">(</span><span class="ident" id="8291398">wb</span><span class="op" id="8291400">,</span>&nbsp;<span class="ident" id="8291402">nil</span><span class="op" id="8291405">,</span>&nbsp;<span class="ident" id="8291407">nil</span><span class="op" id="8291410">)</span><br>
<span class="lineno"></span><span class="op" id="8291412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="8291415">func</span>&nbsp;<span class="ident" id="8291420">TestIPConnSpecificMethods</span><span class="op" id="8291445">(</span><span class="ident" id="8291446">t</span>&nbsp;<span class="op" id="8291448">*</span><span class="ident" id="8291449">testing</span><span class="op" id="8291456">.</span><span class="ident" id="8291457">T</span><span class="op" id="8291458">)</span>&nbsp;<span class="op" id="8291460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291463">if</span>&nbsp;<span class="ident" id="8291466">skip</span><span class="op" id="8291470">,</span>&nbsp;<span class="ident" id="8291472">skipmsg</span>&nbsp;<span class="op" id="8291480">:=</span>&nbsp;<span class="ident" id="8291483">skipRawSocketTest</span><span class="op" id="8291500">(</span><span class="ident" id="8291501">t</span><span class="op" id="8291502">)</span><span class="op" id="8291503">;</span>&nbsp;<span class="ident" id="8291505">skip</span>&nbsp;<span class="op" id="8291510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291514">t</span><span class="op" id="8291515">.</span><span class="ident" id="8291516">Skip</span><span class="op" id="8291520">(</span><span class="ident" id="8291521">skipmsg</span><span class="op" id="8291528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291535">la</span><span class="op" id="8291537">,</span>&nbsp;<span class="ident" id="8291539">err</span>&nbsp;<span class="op" id="8291543">:=</span>&nbsp;<span class="ident" id="8291546">ResolveIPAddr</span><span class="op" id="8291559">(</span><span class="string" id="8291560">&#34;ip4&#34;</span><span class="op" id="8291565">,</span>&nbsp;<span class="string" id="8291567">&#34;127.0.0.1&#34;</span><span class="op" id="8291578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291581">if</span>&nbsp;<span class="ident" id="8291584">err</span>&nbsp;<span class="op" id="8291588">!=</span>&nbsp;<span class="ident" id="8291591">nil</span>&nbsp;<span class="op" id="8291595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291599">t</span><span class="op" id="8291600">.</span><span class="ident" id="8291601">Fatalf</span><span class="op" id="8291607">(</span><span class="string" id="8291608">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8291634">,</span>&nbsp;<span class="ident" id="8291636">err</span><span class="op" id="8291639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291645">c</span><span class="op" id="8291646">,</span>&nbsp;<span class="ident" id="8291648">err</span>&nbsp;<span class="op" id="8291652">:=</span>&nbsp;<span class="ident" id="8291655">ListenIP</span><span class="op" id="8291663">(</span><span class="string" id="8291664">&#34;ip4:icmp&#34;</span><span class="op" id="8291674">,</span>&nbsp;<span class="ident" id="8291676">la</span><span class="op" id="8291678">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291681">if</span>&nbsp;<span class="ident" id="8291684">err</span>&nbsp;<span class="op" id="8291688">!=</span>&nbsp;<span class="ident" id="8291691">nil</span>&nbsp;<span class="op" id="8291695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291699">t</span><span class="op" id="8291700">.</span><span class="ident" id="8291701">Fatalf</span><span class="op" id="8291707">(</span><span class="string" id="8291708">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8291729">,</span>&nbsp;<span class="ident" id="8291731">err</span><span class="op" id="8291734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291740">defer</span>&nbsp;<span class="ident" id="8291746">c</span><span class="op" id="8291747">.</span><span class="ident" id="8291748">Close</span><span class="op" id="8291753">(</span><span class="op" id="8291754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291757">c</span><span class="op" id="8291758">.</span><span class="ident" id="8291759">LocalAddr</span><span class="op" id="8291768">(</span><span class="op" id="8291769">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291772">c</span><span class="op" id="8291773">.</span><span class="ident" id="8291774">RemoteAddr</span><span class="op" id="8291784">(</span><span class="op" id="8291785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291788">c</span><span class="op" id="8291789">.</span><span class="ident" id="8291790">SetDeadline</span><span class="op" id="8291801">(</span><span class="ident" id="8291802">time</span><span class="op" id="8291806">.</span><span class="ident" id="8291807">Now</span><span class="op" id="8291810">(</span><span class="op" id="8291811">)</span><span class="op" id="8291812">.</span><span class="ident" id="8291813">Add</span><span class="op" id="8291816">(</span><span class="ident" id="8291817">someTimeout</span><span class="op" id="8291828">)</span><span class="op" id="8291829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291832">c</span><span class="op" id="8291833">.</span><span class="ident" id="8291834">SetReadDeadline</span><span class="op" id="8291849">(</span><span class="ident" id="8291850">time</span><span class="op" id="8291854">.</span><span class="ident" id="8291855">Now</span><span class="op" id="8291858">(</span><span class="op" id="8291859">)</span><span class="op" id="8291860">.</span><span class="ident" id="8291861">Add</span><span class="op" id="8291864">(</span><span class="ident" id="8291865">someTimeout</span><span class="op" id="8291876">)</span><span class="op" id="8291877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291880">c</span><span class="op" id="8291881">.</span><span class="ident" id="8291882">SetWriteDeadline</span><span class="op" id="8291898">(</span><span class="ident" id="8291899">time</span><span class="op" id="8291903">.</span><span class="ident" id="8291904">Now</span><span class="op" id="8291907">(</span><span class="op" id="8291908">)</span><span class="op" id="8291909">.</span><span class="ident" id="8291910">Add</span><span class="op" id="8291913">(</span><span class="ident" id="8291914">someTimeout</span><span class="op" id="8291925">)</span><span class="op" id="8291926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291929">c</span><span class="op" id="8291930">.</span><span class="ident" id="8291931">SetReadBuffer</span><span class="op" id="8291944">(</span><span class="num" id="8291945">2048</span><span class="op" id="8291949">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291952">c</span><span class="op" id="8291953">.</span><span class="ident" id="8291954">SetWriteBuffer</span><span class="op" id="8291968">(</span><span class="num" id="8291969">2048</span><span class="op" id="8291973">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291977">wb</span><span class="op" id="8291979">,</span>&nbsp;<span class="ident" id="8291981">err</span>&nbsp;<span class="op" id="8291985">:=</span>&nbsp;<span class="op" id="8291988">(</span><span class="op" id="8291989">&amp;</span><span class="ident" id="8291990">icmpMessage</span><span class="op" id="8292001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292005">Type</span><span class="op" id="8292009">:</span>&nbsp;<span class="ident" id="8292011">icmpv4EchoRequest</span><span class="op" id="8292028">,</span>&nbsp;<span class="ident" id="8292030">Code</span><span class="op" id="8292034">:</span>&nbsp;<span class="num" id="8292036">0</span><span class="op" id="8292037">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292041">Body</span><span class="op" id="8292045">:</span>&nbsp;<span class="op" id="8292047">&amp;</span><span class="ident" id="8292048">icmpEcho</span><span class="op" id="8292056">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292061">ID</span><span class="op" id="8292063">:</span>&nbsp;<span class="ident" id="8292065">os</span><span class="op" id="8292067">.</span><span class="ident" id="8292068">Getpid</span><span class="op" id="8292074">(</span><span class="op" id="8292075">)</span>&nbsp;<span class="op" id="8292077">&amp;</span>&nbsp;<span class="num" id="8292079">0xffff</span><span class="op" id="8292085">,</span>&nbsp;<span class="ident" id="8292087">Seq</span><span class="op" id="8292090">:</span>&nbsp;<span class="num" id="8292092">1</span><span class="op" id="8292093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292098">Data</span><span class="op" id="8292102">:</span>&nbsp;<span class="op" id="8292104">[</span><span class="op" id="8292105">]</span><span class="builtintype" id="8292106">byte</span><span class="op" id="8292110">(</span><span class="string" id="8292111">&#34;IPCONN&nbsp;TEST&nbsp;&#34;</span><span class="op" id="8292125">)</span><span class="op" id="8292126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292130">}</span><span class="op" id="8292131">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292134">}</span><span class="op" id="8292135">)</span><span class="op" id="8292136">.</span><span class="ident" id="8292137">Marshal</span><span class="op" id="8292144">(</span><span class="op" id="8292145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292148">if</span>&nbsp;<span class="ident" id="8292151">err</span>&nbsp;<span class="op" id="8292155">!=</span>&nbsp;<span class="ident" id="8292158">nil</span>&nbsp;<span class="op" id="8292162">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292166">t</span><span class="op" id="8292167">.</span><span class="ident" id="8292168">Fatalf</span><span class="op" id="8292174">(</span><span class="string" id="8292175">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8292207">,</span>&nbsp;<span class="ident" id="8292209">err</span><span class="op" id="8292212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292218">rb</span>&nbsp;<span class="op" id="8292221">:=</span>&nbsp;<span class="builtinfunc" id="8292224">make</span><span class="op" id="8292228">(</span><span class="op" id="8292229">[</span><span class="op" id="8292230">]</span><span class="builtintype" id="8292231">byte</span><span class="op" id="8292235">,</span>&nbsp;<span class="num" id="8292237">20</span><span class="op" id="8292239">+</span><span class="builtinfunc" id="8292240">len</span><span class="op" id="8292243">(</span><span class="ident" id="8292244">wb</span><span class="op" id="8292246">)</span><span class="op" id="8292247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292250">if</span>&nbsp;<span class="ident" id="8292253">_</span><span class="op" id="8292254">,</span>&nbsp;<span class="ident" id="8292256">err</span>&nbsp;<span class="op" id="8292260">:=</span>&nbsp;<span class="ident" id="8292263">c</span><span class="op" id="8292264">.</span><span class="ident" id="8292265">WriteToIP</span><span class="op" id="8292274">(</span><span class="ident" id="8292275">wb</span><span class="op" id="8292277">,</span>&nbsp;<span class="ident" id="8292279">c</span><span class="op" id="8292280">.</span><span class="ident" id="8292281">LocalAddr</span><span class="op" id="8292290">(</span><span class="op" id="8292291">)</span><span class="op" id="8292292">.</span><span class="op" id="8292293">(</span><span class="op" id="8292294">*</span><span class="ident" id="8292295">IPAddr</span><span class="op" id="8292301">)</span><span class="op" id="8292302">)</span><span class="op" id="8292303">;</span>&nbsp;<span class="ident" id="8292305">err</span>&nbsp;<span class="op" id="8292309">!=</span>&nbsp;<span class="ident" id="8292312">nil</span>&nbsp;<span class="op" id="8292316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292320">t</span><span class="op" id="8292321">.</span><span class="ident" id="8292322">Fatalf</span><span class="op" id="8292328">(</span><span class="string" id="8292329">&#34;IPConn.WriteToIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8292358">,</span>&nbsp;<span class="ident" id="8292360">err</span><span class="op" id="8292363">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292369">if</span>&nbsp;<span class="ident" id="8292372">_</span><span class="op" id="8292373">,</span>&nbsp;<span class="ident" id="8292375">_</span><span class="op" id="8292376">,</span>&nbsp;<span class="ident" id="8292378">err</span>&nbsp;<span class="op" id="8292382">:=</span>&nbsp;<span class="ident" id="8292385">c</span><span class="op" id="8292386">.</span><span class="ident" id="8292387">ReadFromIP</span><span class="op" id="8292397">(</span><span class="ident" id="8292398">rb</span><span class="op" id="8292400">)</span><span class="op" id="8292401">;</span>&nbsp;<span class="ident" id="8292403">err</span>&nbsp;<span class="op" id="8292407">!=</span>&nbsp;<span class="ident" id="8292410">nil</span>&nbsp;<span class="op" id="8292414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292418">t</span><span class="op" id="8292419">.</span><span class="ident" id="8292420">Fatalf</span><span class="op" id="8292426">(</span><span class="string" id="8292427">&#34;IPConn.ReadFromIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8292457">,</span>&nbsp;<span class="ident" id="8292459">err</span><span class="op" id="8292462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292468">if</span>&nbsp;<span class="ident" id="8292471">_</span><span class="op" id="8292472">,</span>&nbsp;<span class="ident" id="8292474">_</span><span class="op" id="8292475">,</span>&nbsp;<span class="ident" id="8292477">err</span>&nbsp;<span class="op" id="8292481">:=</span>&nbsp;<span class="ident" id="8292484">c</span><span class="op" id="8292485">.</span><span class="ident" id="8292486">WriteMsgIP</span><span class="op" id="8292496">(</span><span class="ident" id="8292497">wb</span><span class="op" id="8292499">,</span>&nbsp;<span class="ident" id="8292501">nil</span><span class="op" id="8292504">,</span>&nbsp;<span class="ident" id="8292506">c</span><span class="op" id="8292507">.</span><span class="ident" id="8292508">LocalAddr</span><span class="op" id="8292517">(</span><span class="op" id="8292518">)</span><span class="op" id="8292519">.</span><span class="op" id="8292520">(</span><span class="op" id="8292521">*</span><span class="ident" id="8292522">IPAddr</span><span class="op" id="8292528">)</span><span class="op" id="8292529">)</span><span class="op" id="8292530">;</span>&nbsp;<span class="ident" id="8292532">err</span>&nbsp;<span class="op" id="8292536">!=</span>&nbsp;<span class="ident" id="8292539">nil</span>&nbsp;<span class="op" id="8292543">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292547">condFatalf</span><span class="op" id="8292557">(</span><span class="ident" id="8292558">t</span><span class="op" id="8292559">,</span>&nbsp;<span class="string" id="8292561">&#34;IPConn.WriteMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8292591">,</span>&nbsp;<span class="ident" id="8292593">err</span><span class="op" id="8292596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292602">if</span>&nbsp;<span class="ident" id="8292605">_</span><span class="op" id="8292606">,</span>&nbsp;<span class="ident" id="8292608">_</span><span class="op" id="8292609">,</span>&nbsp;<span class="ident" id="8292611">_</span><span class="op" id="8292612">,</span>&nbsp;<span class="ident" id="8292614">_</span><span class="op" id="8292615">,</span>&nbsp;<span class="ident" id="8292617">err</span>&nbsp;<span class="op" id="8292621">:=</span>&nbsp;<span class="ident" id="8292624">c</span><span class="op" id="8292625">.</span><span class="ident" id="8292626">ReadMsgIP</span><span class="op" id="8292635">(</span><span class="ident" id="8292636">rb</span><span class="op" id="8292638">,</span>&nbsp;<span class="ident" id="8292640">nil</span><span class="op" id="8292643">)</span><span class="op" id="8292644">;</span>&nbsp;<span class="ident" id="8292646">err</span>&nbsp;<span class="op" id="8292650">!=</span>&nbsp;<span class="ident" id="8292653">nil</span>&nbsp;<span class="op" id="8292657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292661">condFatalf</span><span class="op" id="8292671">(</span><span class="ident" id="8292672">t</span><span class="op" id="8292673">,</span>&nbsp;<span class="string" id="8292675">&#34;IPConn.ReadMsgIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8292704">,</span>&nbsp;<span class="ident" id="8292706">err</span><span class="op" id="8292709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292712">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292716">if</span>&nbsp;<span class="ident" id="8292719">f</span><span class="op" id="8292720">,</span>&nbsp;<span class="ident" id="8292722">err</span>&nbsp;<span class="op" id="8292726">:=</span>&nbsp;<span class="ident" id="8292729">c</span><span class="op" id="8292730">.</span><span class="ident" id="8292731">File</span><span class="op" id="8292735">(</span><span class="op" id="8292736">)</span><span class="op" id="8292737">;</span>&nbsp;<span class="ident" id="8292739">err</span>&nbsp;<span class="op" id="8292743">!=</span>&nbsp;<span class="ident" id="8292746">nil</span>&nbsp;<span class="op" id="8292750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292754">condFatalf</span><span class="op" id="8292764">(</span><span class="ident" id="8292765">t</span><span class="op" id="8292766">,</span>&nbsp;<span class="string" id="8292768">&#34;IPConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8292792">,</span>&nbsp;<span class="ident" id="8292794">err</span><span class="op" id="8292797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292800">}</span>&nbsp;<span class="keyword" id="8292802">else</span>&nbsp;<span class="op" id="8292807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292811">f</span><span class="op" id="8292812">.</span><span class="ident" id="8292813">Close</span><span class="op" id="8292818">(</span><span class="op" id="8292819">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292826">defer</span>&nbsp;<span class="keyword" id="8292832">func</span><span class="op" id="8292836">(</span><span class="op" id="8292837">)</span>&nbsp;<span class="op" id="8292839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292843">if</span>&nbsp;<span class="ident" id="8292846">p</span>&nbsp;<span class="op" id="8292848">:=</span>&nbsp;<span class="builtinfunc" id="8292851">recover</span><span class="op" id="8292858">(</span><span class="op" id="8292859">)</span><span class="op" id="8292860">;</span>&nbsp;<span class="ident" id="8292862">p</span>&nbsp;<span class="op" id="8292864">!=</span>&nbsp;<span class="ident" id="8292867">nil</span>&nbsp;<span class="op" id="8292871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292876">t</span><span class="op" id="8292877">.</span><span class="ident" id="8292878">Fatalf</span><span class="op" id="8292884">(</span><span class="string" id="8292885">&#34;IPConn.WriteToIP&nbsp;or&nbsp;WriteMsgIP&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="8292930">,</span>&nbsp;<span class="ident" id="8292932">p</span><span class="op" id="8292933">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292940">}</span><span class="op" id="8292941">(</span><span class="op" id="8292942">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292946">c</span><span class="op" id="8292947">.</span><span class="ident" id="8292948">WriteToIP</span><span class="op" id="8292957">(</span><span class="ident" id="8292958">wb</span><span class="op" id="8292960">,</span>&nbsp;<span class="ident" id="8292962">nil</span><span class="op" id="8292965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292968">c</span><span class="op" id="8292969">.</span><span class="ident" id="8292970">WriteMsgIP</span><span class="op" id="8292980">(</span><span class="ident" id="8292981">wb</span><span class="op" id="8292983">,</span>&nbsp;<span class="ident" id="8292985">nil</span><span class="op" id="8292988">,</span>&nbsp;<span class="ident" id="8292990">nil</span><span class="op" id="8292993">)</span><br>
<span class="lineno">235</span><span class="op" id="8292995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8292998">func</span>&nbsp;<span class="ident" id="8293003">TestUnixListenerSpecificMethods</span><span class="op" id="8293034">(</span><span class="ident" id="8293035">t</span>&nbsp;<span class="op" id="8293037">*</span><span class="ident" id="8293038">testing</span><span class="op" id="8293045">.</span><span class="ident" id="8293046">T</span><span class="op" id="8293047">)</span>&nbsp;<span class="op" id="8293049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293052">switch</span>&nbsp;<span class="ident" id="8293059">runtime</span><span class="op" id="8293066">.</span><span class="ident" id="8293067">GOOS</span>&nbsp;<span class="op" id="8293072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293075">case</span>&nbsp;<span class="string" id="8293080">&#34;nacl&#34;</span><span class="op" id="8293086">,</span>&nbsp;<span class="string" id="8293088">&#34;plan9&#34;</span><span class="op" id="8293095">,</span>&nbsp;<span class="string" id="8293097">&#34;windows&#34;</span><span class="op" id="8293106">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293110">t</span><span class="op" id="8293111">.</span><span class="ident" id="8293112">Skipf</span><span class="op" id="8293117">(</span><span class="string" id="8293118">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8293139">,</span>&nbsp;<span class="ident" id="8293141">runtime</span><span class="op" id="8293148">.</span><span class="ident" id="8293149">GOOS</span><span class="op" id="8293153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293160">addr</span>&nbsp;<span class="op" id="8293165">:=</span>&nbsp;<span class="ident" id="8293168">testUnixAddr</span><span class="op" id="8293180">(</span><span class="op" id="8293181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293184">la</span><span class="op" id="8293186">,</span>&nbsp;<span class="ident" id="8293188">err</span>&nbsp;<span class="op" id="8293192">:=</span>&nbsp;<span class="ident" id="8293195">ResolveUnixAddr</span><span class="op" id="8293210">(</span><span class="string" id="8293211">&#34;unix&#34;</span><span class="op" id="8293217">,</span>&nbsp;<span class="ident" id="8293219">addr</span><span class="op" id="8293223">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293226">if</span>&nbsp;<span class="ident" id="8293229">err</span>&nbsp;<span class="op" id="8293233">!=</span>&nbsp;<span class="ident" id="8293236">nil</span>&nbsp;<span class="op" id="8293240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293244">t</span><span class="op" id="8293245">.</span><span class="ident" id="8293246">Fatalf</span><span class="op" id="8293252">(</span><span class="string" id="8293253">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8293281">,</span>&nbsp;<span class="ident" id="8293283">err</span><span class="op" id="8293286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293292">ln</span><span class="op" id="8293294">,</span>&nbsp;<span class="ident" id="8293296">err</span>&nbsp;<span class="op" id="8293300">:=</span>&nbsp;<span class="ident" id="8293303">ListenUnix</span><span class="op" id="8293313">(</span><span class="string" id="8293314">&#34;unix&#34;</span><span class="op" id="8293320">,</span>&nbsp;<span class="ident" id="8293322">la</span><span class="op" id="8293324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293327">if</span>&nbsp;<span class="ident" id="8293330">err</span>&nbsp;<span class="op" id="8293334">!=</span>&nbsp;<span class="ident" id="8293337">nil</span>&nbsp;<span class="op" id="8293341">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293345">t</span><span class="op" id="8293346">.</span><span class="ident" id="8293347">Fatalf</span><span class="op" id="8293353">(</span><span class="string" id="8293354">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8293377">,</span>&nbsp;<span class="ident" id="8293379">err</span><span class="op" id="8293382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293388">defer</span>&nbsp;<span class="ident" id="8293394">ln</span><span class="op" id="8293396">.</span><span class="ident" id="8293397">Close</span><span class="op" id="8293402">(</span><span class="op" id="8293403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293406">defer</span>&nbsp;<span class="ident" id="8293412">os</span><span class="op" id="8293414">.</span><span class="ident" id="8293415">Remove</span><span class="op" id="8293421">(</span><span class="ident" id="8293422">addr</span><span class="op" id="8293426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293429">ln</span><span class="op" id="8293431">.</span><span class="ident" id="8293432">Addr</span><span class="op" id="8293436">(</span><span class="op" id="8293437">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293440">ln</span><span class="op" id="8293442">.</span><span class="ident" id="8293443">SetDeadline</span><span class="op" id="8293454">(</span><span class="ident" id="8293455">time</span><span class="op" id="8293459">.</span><span class="ident" id="8293460">Now</span><span class="op" id="8293463">(</span><span class="op" id="8293464">)</span><span class="op" id="8293465">.</span><span class="ident" id="8293466">Add</span><span class="op" id="8293469">(</span><span class="num" id="8293470">30</span>&nbsp;<span class="op" id="8293473">*</span>&nbsp;<span class="ident" id="8293475">time</span><span class="op" id="8293479">.</span><span class="ident" id="8293480">Nanosecond</span><span class="op" id="8293490">)</span><span class="op" id="8293491">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293495">if</span>&nbsp;<span class="ident" id="8293498">c</span><span class="op" id="8293499">,</span>&nbsp;<span class="ident" id="8293501">err</span>&nbsp;<span class="op" id="8293505">:=</span>&nbsp;<span class="ident" id="8293508">ln</span><span class="op" id="8293510">.</span><span class="ident" id="8293511">Accept</span><span class="op" id="8293517">(</span><span class="op" id="8293518">)</span><span class="op" id="8293519">;</span>&nbsp;<span class="ident" id="8293521">err</span>&nbsp;<span class="op" id="8293525">!=</span>&nbsp;<span class="ident" id="8293528">nil</span>&nbsp;<span class="op" id="8293532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293536">if</span>&nbsp;<span class="op" id="8293539">!</span><span class="ident" id="8293540">err</span><span class="op" id="8293543">.</span><span class="op" id="8293544">(</span><span class="ident" id="8293545">Error</span><span class="op" id="8293550">)</span><span class="op" id="8293551">.</span><span class="ident" id="8293552">Timeout</span><span class="op" id="8293559">(</span><span class="op" id="8293560">)</span>&nbsp;<span class="op" id="8293562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293567">t</span><span class="op" id="8293568">.</span><span class="ident" id="8293569">Fatalf</span><span class="op" id="8293575">(</span><span class="string" id="8293576">&#34;UnixListener.Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8293608">,</span>&nbsp;<span class="ident" id="8293610">err</span><span class="op" id="8293613">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293620">}</span>&nbsp;<span class="keyword" id="8293622">else</span>&nbsp;<span class="op" id="8293627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293631">c</span><span class="op" id="8293632">.</span><span class="ident" id="8293633">Close</span><span class="op" id="8293638">(</span><span class="op" id="8293639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293645">if</span>&nbsp;<span class="ident" id="8293648">c</span><span class="op" id="8293649">,</span>&nbsp;<span class="ident" id="8293651">err</span>&nbsp;<span class="op" id="8293655">:=</span>&nbsp;<span class="ident" id="8293658">ln</span><span class="op" id="8293660">.</span><span class="ident" id="8293661">AcceptUnix</span><span class="op" id="8293671">(</span><span class="op" id="8293672">)</span><span class="op" id="8293673">;</span>&nbsp;<span class="ident" id="8293675">err</span>&nbsp;<span class="op" id="8293679">!=</span>&nbsp;<span class="ident" id="8293682">nil</span>&nbsp;<span class="op" id="8293686">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293690">if</span>&nbsp;<span class="op" id="8293693">!</span><span class="ident" id="8293694">err</span><span class="op" id="8293697">.</span><span class="op" id="8293698">(</span><span class="ident" id="8293699">Error</span><span class="op" id="8293704">)</span><span class="op" id="8293705">.</span><span class="ident" id="8293706">Timeout</span><span class="op" id="8293713">(</span><span class="op" id="8293714">)</span>&nbsp;<span class="op" id="8293716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293721">t</span><span class="op" id="8293722">.</span><span class="ident" id="8293723">Fatalf</span><span class="op" id="8293729">(</span><span class="string" id="8293730">&#34;UnixListener.AcceptUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8293766">,</span>&nbsp;<span class="ident" id="8293768">err</span><span class="op" id="8293771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293778">}</span>&nbsp;<span class="keyword" id="8293780">else</span>&nbsp;<span class="op" id="8293785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293789">c</span><span class="op" id="8293790">.</span><span class="ident" id="8293791">Close</span><span class="op" id="8293796">(</span><span class="op" id="8293797">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293804">if</span>&nbsp;<span class="ident" id="8293807">f</span><span class="op" id="8293808">,</span>&nbsp;<span class="ident" id="8293810">err</span>&nbsp;<span class="op" id="8293814">:=</span>&nbsp;<span class="ident" id="8293817">ln</span><span class="op" id="8293819">.</span><span class="ident" id="8293820">File</span><span class="op" id="8293824">(</span><span class="op" id="8293825">)</span><span class="op" id="8293826">;</span>&nbsp;<span class="ident" id="8293828">err</span>&nbsp;<span class="op" id="8293832">!=</span>&nbsp;<span class="ident" id="8293835">nil</span>&nbsp;<span class="op" id="8293839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293843">t</span><span class="op" id="8293844">.</span><span class="ident" id="8293845">Fatalf</span><span class="op" id="8293851">(</span><span class="string" id="8293852">&#34;UnixListener.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8293882">,</span>&nbsp;<span class="ident" id="8293884">err</span><span class="op" id="8293887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293890">}</span>&nbsp;<span class="keyword" id="8293892">else</span>&nbsp;<span class="op" id="8293897">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293901">f</span><span class="op" id="8293902">.</span><span class="ident" id="8293903">Close</span><span class="op" id="8293908">(</span><span class="op" id="8293909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293912">}</span><br>
<span class="lineno"></span><span class="op" id="8293914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8293917">func</span>&nbsp;<span class="ident" id="8293922">TestUnixConnSpecificMethods</span><span class="op" id="8293949">(</span><span class="ident" id="8293950">t</span>&nbsp;<span class="op" id="8293952">*</span><span class="ident" id="8293953">testing</span><span class="op" id="8293960">.</span><span class="ident" id="8293961">T</span><span class="op" id="8293962">)</span>&nbsp;<span class="op" id="8293964">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293967">switch</span>&nbsp;<span class="ident" id="8293974">runtime</span><span class="op" id="8293981">.</span><span class="ident" id="8293982">GOOS</span>&nbsp;<span class="op" id="8293987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293990">case</span>&nbsp;<span class="string" id="8293995">&#34;nacl&#34;</span><span class="op" id="8294001">,</span>&nbsp;<span class="string" id="8294003">&#34;plan9&#34;</span><span class="op" id="8294010">,</span>&nbsp;<span class="string" id="8294012">&#34;windows&#34;</span><span class="op" id="8294021">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294025">t</span><span class="op" id="8294026">.</span><span class="ident" id="8294027">Skipf</span><span class="op" id="8294032">(</span><span class="string" id="8294033">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8294054">,</span>&nbsp;<span class="ident" id="8294056">runtime</span><span class="op" id="8294063">.</span><span class="ident" id="8294064">GOOS</span><span class="op" id="8294068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294075">addr1</span><span class="op" id="8294080">,</span>&nbsp;<span class="ident" id="8294082">addr2</span><span class="op" id="8294087">,</span>&nbsp;<span class="ident" id="8294089">addr3</span>&nbsp;<span class="op" id="8294095">:=</span>&nbsp;<span class="ident" id="8294098">testUnixAddr</span><span class="op" id="8294110">(</span><span class="op" id="8294111">)</span><span class="op" id="8294112">,</span>&nbsp;<span class="ident" id="8294114">testUnixAddr</span><span class="op" id="8294126">(</span><span class="op" id="8294127">)</span><span class="op" id="8294128">,</span>&nbsp;<span class="ident" id="8294130">testUnixAddr</span><span class="op" id="8294142">(</span><span class="op" id="8294143">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294147">a1</span><span class="op" id="8294149">,</span>&nbsp;<span class="ident" id="8294151">err</span>&nbsp;<span class="op" id="8294155">:=</span>&nbsp;<span class="ident" id="8294158">ResolveUnixAddr</span><span class="op" id="8294173">(</span><span class="string" id="8294174">&#34;unixgram&#34;</span><span class="op" id="8294184">,</span>&nbsp;<span class="ident" id="8294186">addr1</span><span class="op" id="8294191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294194">if</span>&nbsp;<span class="ident" id="8294197">err</span>&nbsp;<span class="op" id="8294201">!=</span>&nbsp;<span class="ident" id="8294204">nil</span>&nbsp;<span class="op" id="8294208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294212">t</span><span class="op" id="8294213">.</span><span class="ident" id="8294214">Fatalf</span><span class="op" id="8294220">(</span><span class="string" id="8294221">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8294249">,</span>&nbsp;<span class="ident" id="8294251">err</span><span class="op" id="8294254">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294260">c1</span><span class="op" id="8294262">,</span>&nbsp;<span class="ident" id="8294264">err</span>&nbsp;<span class="op" id="8294268">:=</span>&nbsp;<span class="ident" id="8294271">DialUnix</span><span class="op" id="8294279">(</span><span class="string" id="8294280">&#34;unixgram&#34;</span><span class="op" id="8294290">,</span>&nbsp;<span class="ident" id="8294292">a1</span><span class="op" id="8294294">,</span>&nbsp;<span class="ident" id="8294296">nil</span><span class="op" id="8294299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294302">if</span>&nbsp;<span class="ident" id="8294305">err</span>&nbsp;<span class="op" id="8294309">!=</span>&nbsp;<span class="ident" id="8294312">nil</span>&nbsp;<span class="op" id="8294316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294320">t</span><span class="op" id="8294321">.</span><span class="ident" id="8294322">Fatalf</span><span class="op" id="8294328">(</span><span class="string" id="8294329">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8294350">,</span>&nbsp;<span class="ident" id="8294352">err</span><span class="op" id="8294355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294358">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294361">defer</span>&nbsp;<span class="ident" id="8294367">c1</span><span class="op" id="8294369">.</span><span class="ident" id="8294370">Close</span><span class="op" id="8294375">(</span><span class="op" id="8294376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294379">defer</span>&nbsp;<span class="ident" id="8294385">os</span><span class="op" id="8294387">.</span><span class="ident" id="8294388">Remove</span><span class="op" id="8294394">(</span><span class="ident" id="8294395">addr1</span><span class="op" id="8294400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294403">c1</span><span class="op" id="8294405">.</span><span class="ident" id="8294406">LocalAddr</span><span class="op" id="8294415">(</span><span class="op" id="8294416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294419">c1</span><span class="op" id="8294421">.</span><span class="ident" id="8294422">RemoteAddr</span><span class="op" id="8294432">(</span><span class="op" id="8294433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294436">c1</span><span class="op" id="8294438">.</span><span class="ident" id="8294439">SetDeadline</span><span class="op" id="8294450">(</span><span class="ident" id="8294451">time</span><span class="op" id="8294455">.</span><span class="ident" id="8294456">Now</span><span class="op" id="8294459">(</span><span class="op" id="8294460">)</span><span class="op" id="8294461">.</span><span class="ident" id="8294462">Add</span><span class="op" id="8294465">(</span><span class="ident" id="8294466">someTimeout</span><span class="op" id="8294477">)</span><span class="op" id="8294478">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294481">c1</span><span class="op" id="8294483">.</span><span class="ident" id="8294484">SetReadDeadline</span><span class="op" id="8294499">(</span><span class="ident" id="8294500">time</span><span class="op" id="8294504">.</span><span class="ident" id="8294505">Now</span><span class="op" id="8294508">(</span><span class="op" id="8294509">)</span><span class="op" id="8294510">.</span><span class="ident" id="8294511">Add</span><span class="op" id="8294514">(</span><span class="ident" id="8294515">someTimeout</span><span class="op" id="8294526">)</span><span class="op" id="8294527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294530">c1</span><span class="op" id="8294532">.</span><span class="ident" id="8294533">SetWriteDeadline</span><span class="op" id="8294549">(</span><span class="ident" id="8294550">time</span><span class="op" id="8294554">.</span><span class="ident" id="8294555">Now</span><span class="op" id="8294558">(</span><span class="op" id="8294559">)</span><span class="op" id="8294560">.</span><span class="ident" id="8294561">Add</span><span class="op" id="8294564">(</span><span class="ident" id="8294565">someTimeout</span><span class="op" id="8294576">)</span><span class="op" id="8294577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294580">c1</span><span class="op" id="8294582">.</span><span class="ident" id="8294583">SetReadBuffer</span><span class="op" id="8294596">(</span><span class="num" id="8294597">2048</span><span class="op" id="8294601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294604">c1</span><span class="op" id="8294606">.</span><span class="ident" id="8294607">SetWriteBuffer</span><span class="op" id="8294621">(</span><span class="num" id="8294622">2048</span><span class="op" id="8294626">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294630">a2</span><span class="op" id="8294632">,</span>&nbsp;<span class="ident" id="8294634">err</span>&nbsp;<span class="op" id="8294638">:=</span>&nbsp;<span class="ident" id="8294641">ResolveUnixAddr</span><span class="op" id="8294656">(</span><span class="string" id="8294657">&#34;unixgram&#34;</span><span class="op" id="8294667">,</span>&nbsp;<span class="ident" id="8294669">addr2</span><span class="op" id="8294674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294677">if</span>&nbsp;<span class="ident" id="8294680">err</span>&nbsp;<span class="op" id="8294684">!=</span>&nbsp;<span class="ident" id="8294687">nil</span>&nbsp;<span class="op" id="8294691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294695">t</span><span class="op" id="8294696">.</span><span class="ident" id="8294697">Fatalf</span><span class="op" id="8294703">(</span><span class="string" id="8294704">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8294732">,</span>&nbsp;<span class="ident" id="8294734">err</span><span class="op" id="8294737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294743">c2</span><span class="op" id="8294745">,</span>&nbsp;<span class="ident" id="8294747">err</span>&nbsp;<span class="op" id="8294751">:=</span>&nbsp;<span class="ident" id="8294754">DialUnix</span><span class="op" id="8294762">(</span><span class="string" id="8294763">&#34;unixgram&#34;</span><span class="op" id="8294773">,</span>&nbsp;<span class="ident" id="8294775">a2</span><span class="op" id="8294777">,</span>&nbsp;<span class="ident" id="8294779">nil</span><span class="op" id="8294782">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294785">if</span>&nbsp;<span class="ident" id="8294788">err</span>&nbsp;<span class="op" id="8294792">!=</span>&nbsp;<span class="ident" id="8294795">nil</span>&nbsp;<span class="op" id="8294799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294803">t</span><span class="op" id="8294804">.</span><span class="ident" id="8294805">Fatalf</span><span class="op" id="8294811">(</span><span class="string" id="8294812">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8294833">,</span>&nbsp;<span class="ident" id="8294835">err</span><span class="op" id="8294838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294844">defer</span>&nbsp;<span class="ident" id="8294850">c2</span><span class="op" id="8294852">.</span><span class="ident" id="8294853">Close</span><span class="op" id="8294858">(</span><span class="op" id="8294859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294862">defer</span>&nbsp;<span class="ident" id="8294868">os</span><span class="op" id="8294870">.</span><span class="ident" id="8294871">Remove</span><span class="op" id="8294877">(</span><span class="ident" id="8294878">addr2</span><span class="op" id="8294883">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294886">c2</span><span class="op" id="8294888">.</span><span class="ident" id="8294889">LocalAddr</span><span class="op" id="8294898">(</span><span class="op" id="8294899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294902">c2</span><span class="op" id="8294904">.</span><span class="ident" id="8294905">RemoteAddr</span><span class="op" id="8294915">(</span><span class="op" id="8294916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294919">c2</span><span class="op" id="8294921">.</span><span class="ident" id="8294922">SetDeadline</span><span class="op" id="8294933">(</span><span class="ident" id="8294934">time</span><span class="op" id="8294938">.</span><span class="ident" id="8294939">Now</span><span class="op" id="8294942">(</span><span class="op" id="8294943">)</span><span class="op" id="8294944">.</span><span class="ident" id="8294945">Add</span><span class="op" id="8294948">(</span><span class="ident" id="8294949">someTimeout</span><span class="op" id="8294960">)</span><span class="op" id="8294961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294964">c2</span><span class="op" id="8294966">.</span><span class="ident" id="8294967">SetReadDeadline</span><span class="op" id="8294982">(</span><span class="ident" id="8294983">time</span><span class="op" id="8294987">.</span><span class="ident" id="8294988">Now</span><span class="op" id="8294991">(</span><span class="op" id="8294992">)</span><span class="op" id="8294993">.</span><span class="ident" id="8294994">Add</span><span class="op" id="8294997">(</span><span class="ident" id="8294998">someTimeout</span><span class="op" id="8295009">)</span><span class="op" id="8295010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295013">c2</span><span class="op" id="8295015">.</span><span class="ident" id="8295016">SetWriteDeadline</span><span class="op" id="8295032">(</span><span class="ident" id="8295033">time</span><span class="op" id="8295037">.</span><span class="ident" id="8295038">Now</span><span class="op" id="8295041">(</span><span class="op" id="8295042">)</span><span class="op" id="8295043">.</span><span class="ident" id="8295044">Add</span><span class="op" id="8295047">(</span><span class="ident" id="8295048">someTimeout</span><span class="op" id="8295059">)</span><span class="op" id="8295060">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295063">c2</span><span class="op" id="8295065">.</span><span class="ident" id="8295066">SetReadBuffer</span><span class="op" id="8295079">(</span><span class="num" id="8295080">2048</span><span class="op" id="8295084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295087">c2</span><span class="op" id="8295089">.</span><span class="ident" id="8295090">SetWriteBuffer</span><span class="op" id="8295104">(</span><span class="num" id="8295105">2048</span><span class="op" id="8295109">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295113">a3</span><span class="op" id="8295115">,</span>&nbsp;<span class="ident" id="8295117">err</span>&nbsp;<span class="op" id="8295121">:=</span>&nbsp;<span class="ident" id="8295124">ResolveUnixAddr</span><span class="op" id="8295139">(</span><span class="string" id="8295140">&#34;unixgram&#34;</span><span class="op" id="8295150">,</span>&nbsp;<span class="ident" id="8295152">addr3</span><span class="op" id="8295157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8295160">if</span>&nbsp;<span class="ident" id="8295163">err</span>&nbsp;<span class="op" id="8295167">!=</span>&nbsp;<span class="ident" id="8295170">nil</span>&nbsp;<span class="op" id="8295174">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295178">t</span><span class="op" id="8295179">.</span><span class="ident" id="8295180">Fatalf</span><span class="op" id="8295186">(</span><span class="string" id="8295187">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8295215">,</span>&nbsp;<span class="ident" id="8295217">err</span><span class="op" id="8295220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8295223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295226">c3</span><span class="op" id="8295228">,</span>&nbsp;<span class="ident" id="8295230">err</span>&nbsp;<span class="op" id="8295234">:=</span>&nbsp;<span class="ident" id="8295237">ListenUnixgram</span><span class="op" id="8295251">(</span><span class="string" id="8295252">&#34;unixgram&#34;</span><span class="op" id="8295262">,</span>&nbsp;<span class="ident" id="8295264">a3</span><span class="op" id="8295266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8295269">if</span>&nbsp;<span class="ident" id="8295272">err</span>&nbsp;<span class="op" id="8295276">!=</span>&nbsp;<span class="ident" id="8295279">nil</span>&nbsp;<span class="op" id="8295283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295287">t</span><span class="op" id="8295288">.</span><span class="ident" id="8295289">Fatalf</span><span class="op" id="8295295">(</span><span class="string" id="8295296">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8295323">,</span>&nbsp;<span class="ident" id="8295325">err</span><span class="op" id="8295328">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8295331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8295334">defer</span>&nbsp;<span class="ident" id="8295340">c3</span><span class="op" id="8295342">.</span><span class="ident" id="8295343">Close</span><span class="op" id="8295348">(</span><span class="op" id="8295349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8295352">defer</span>&nbsp;<span class="ident" id="8295358">os</span><span class="op" id="8295360">.</span><span class="ident" id="8295361">Remove</span><span class="op" id="8295367">(</span><span class="ident" id="8295368">addr3</span><span class="op" id="8295373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295376">c3</span><span class="op" id="8295378">.</span><span class="ident" id="8295379">LocalAddr</span><span class="op" id="8295388">(</span><span class="op" id="8295389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295392">c3</span><span class="op" id="8295394">.</span><span class="ident" id="8295395">RemoteAddr</span><span class="op" id="8295405">(</span><span class="op" id="8295406">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295409">c3</span><span class="op" id="8295411">.</span><span class="ident" id="8295412">SetDeadline</span><span class="op" id="8295423">(</span><span class="ident" id="8295424">time</span><span class="op" id="8295428">.</span><span class="ident" id="8295429">Now</span><span class="op" id="8295432">(</span><span class="op" id="8295433">)</span><span class="op" id="8295434">.</span><span class="ident" id="8295435">Add</span><span class="op" id="8295438">(</span><span class="ident" id="8295439">someTimeout</span><span class="op" id="8295450">)</span><span class="op" id="8295451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295454">c3</span><span class="op" id="8295456">.</span><span class="ident" id="8295457">SetReadDeadline</span><span class="op" id="8295472">(</span><span class="ident" id="8295473">time</span><span class="op" id="8295477">.</span><span class="ident" id="8295478">Now</span><span class="op" id="8295481">(</span><span class="op" id="8295482">)</span><span class="op" id="8295483">.</span><span class="ident" id="8295484">Add</span><span class="op" id="8295487">(</span><span class="ident" id="8295488">someTimeout</span><span class="op" id="8295499">)</span><span class="op" id="8295500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295503">c3</span><span class="op" id="8295505">.</span><span class="ident" id="8295506">SetWriteDeadline</span><span class="op" id="8295522">(</span><span class="ident" id="8295523">time</span><span class="op" id="8295527">.</span><span class="ident" id="8295528">Now</span><span class="op" id="8295531">(</span><span class="op" id="8295532">)</span><span class="op" id="8295533">.</span><span class="ident" id="8295534">Add</span><span class="op" id="8295537">(</span><span class="ident" id="8295538">someTimeout</span><span class="op" id="8295549">)</span><span class="op" id="8295550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295553">c3</span><span class="op" id="8295555">.</span><span class="ident" id="8295556">SetReadBuffer</span><span class="op" id="8295569">(</span><span class="num" id="8295570">2048</span><span class="op" id="8295574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295577">c3</span><span class="op" id="8295579">.</span><span class="ident" id="8295580">SetWriteBuffer</span><span class="op" id="8295594">(</span><span class="num" id="8295595">2048</span><span class="op" id="8295599">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295603">wb</span>&nbsp;<span class="op" id="8295606">:=</span>&nbsp;<span class="op" id="8295609">[</span><span class="op" id="8295610">]</span><span class="builtintype" id="8295611">byte</span><span class="op" id="8295615">(</span><span class="string" id="8295616">&#34;UNIXCONN&nbsp;TEST&#34;</span><span class="op" id="8295631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295634">rb1</span>&nbsp;<span class="op" id="8295638">:=</span>&nbsp;<span class="builtinfunc" id="8295641">make</span><span class="op" id="8295645">(</span><span class="op" id="8295646">[</span><span class="op" id="8295647">]</span><span class="builtintype" id="8295648">byte</span><span class="op" id="8295652">,</span>&nbsp;<span class="num" id="8295654">128</span><span class="op" id="8295657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295660">rb2</span>&nbsp;<span class="op" id="8295664">:=</span>&nbsp;<span class="builtinfunc" id="8295667">make</span><span class="op" id="8295671">(</span><span class="op" id="8295672">[</span><span class="op" id="8295673">]</span><span class="builtintype" id="8295674">byte</span><span class="op" id="8295678">,</span>&nbsp;<span class="num" id="8295680">128</span><span class="op" id="8295683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295686">rb3</span>&nbsp;<span class="op" id="8295690">:=</span>&nbsp;<span class="builtinfunc" id="8295693">make</span><span class="op" id="8295697">(</span><span class="op" id="8295698">[</span><span class="op" id="8295699">]</span><span class="builtintype" id="8295700">byte</span><span class="op" id="8295704">,</span>&nbsp;<span class="num" id="8295706">128</span><span class="op" id="8295709">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8295712">if</span>&nbsp;<span class="ident" id="8295715">_</span><span class="op" id="8295716">,</span>&nbsp;<span class="ident" id="8295718">_</span><span class="op" id="8295719">,</span>&nbsp;<span class="ident" id="8295721">err</span>&nbsp;<span class="op" id="8295725">:=</span>&nbsp;<span class="ident" id="8295728">c1</span><span class="op" id="8295730">.</span><span class="ident" id="8295731">WriteMsgUnix</span><span class="op" id="8295743">(</span><span class="ident" id="8295744">wb</span><span class="op" id="8295746">,</span>&nbsp;<span class="ident" id="8295748">nil</span><span class="op" id="8295751">,</span>&nbsp;<span class="ident" id="8295753">a2</span><span class="op" id="8295755">)</span><span class="op" id="8295756">;</span>&nbsp;<span class="ident" id="8295758">err</span>&nbsp;<span class="op" id="8295762">!=</span>&nbsp;<span class="ident" id="8295765">nil</span>&nbsp;<span class="op" id="8295769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295773">t</span><span class="op" id="8295774">.</span><span class="ident" id="8295775">Fatalf</span><span class="op" id="8295781">(</span><span class="string" id="8295782">&#34;UnixConn.WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8295816">,</span>&nbsp;<span class="ident" id="8295818">err</span><span class="op" id="8295821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8295824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8295827">if</span>&nbsp;<span class="ident" id="8295830">_</span><span class="op" id="8295831">,</span>&nbsp;<span class="ident" id="8295833">_</span><span class="op" id="8295834">,</span>&nbsp;<span class="ident" id="8295836">_</span><span class="op" id="8295837">,</span>&nbsp;<span class="ident" id="8295839">_</span><span class="op" id="8295840">,</span>&nbsp;<span class="ident" id="8295842">err</span>&nbsp;<span class="op" id="8295846">:=</span>&nbsp;<span class="ident" id="8295849">c2</span><span class="op" id="8295851">.</span><span class="ident" id="8295852">ReadMsgUnix</span><span class="op" id="8295863">(</span><span class="ident" id="8295864">rb2</span><span class="op" id="8295867">,</span>&nbsp;<span class="ident" id="8295869">nil</span><span class="op" id="8295872">)</span><span class="op" id="8295873">;</span>&nbsp;<span class="ident" id="8295875">err</span>&nbsp;<span class="op" id="8295879">!=</span>&nbsp;<span class="ident" id="8295882">nil</span>&nbsp;<span class="op" id="8295886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295890">t</span><span class="op" id="8295891">.</span><span class="ident" id="8295892">Fatalf</span><span class="op" id="8295898">(</span><span class="string" id="8295899">&#34;UnixConn.ReadMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8295932">,</span>&nbsp;<span class="ident" id="8295934">err</span><span class="op" id="8295937">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8295940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8295943">if</span>&nbsp;<span class="ident" id="8295946">_</span><span class="op" id="8295947">,</span>&nbsp;<span class="ident" id="8295949">err</span>&nbsp;<span class="op" id="8295953">:=</span>&nbsp;<span class="ident" id="8295956">c2</span><span class="op" id="8295958">.</span><span class="ident" id="8295959">WriteToUnix</span><span class="op" id="8295970">(</span><span class="ident" id="8295971">wb</span><span class="op" id="8295973">,</span>&nbsp;<span class="ident" id="8295975">a1</span><span class="op" id="8295977">)</span><span class="op" id="8295978">;</span>&nbsp;<span class="ident" id="8295980">err</span>&nbsp;<span class="op" id="8295984">!=</span>&nbsp;<span class="ident" id="8295987">nil</span>&nbsp;<span class="op" id="8295991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295995">t</span><span class="op" id="8295996">.</span><span class="ident" id="8295997">Fatalf</span><span class="op" id="8296003">(</span><span class="string" id="8296004">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8296037">,</span>&nbsp;<span class="ident" id="8296039">err</span><span class="op" id="8296042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8296045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8296048">if</span>&nbsp;<span class="ident" id="8296051">_</span><span class="op" id="8296052">,</span>&nbsp;<span class="ident" id="8296054">_</span><span class="op" id="8296055">,</span>&nbsp;<span class="ident" id="8296057">err</span>&nbsp;<span class="op" id="8296061">:=</span>&nbsp;<span class="ident" id="8296064">c1</span><span class="op" id="8296066">.</span><span class="ident" id="8296067">ReadFromUnix</span><span class="op" id="8296079">(</span><span class="ident" id="8296080">rb1</span><span class="op" id="8296083">)</span><span class="op" id="8296084">;</span>&nbsp;<span class="ident" id="8296086">err</span>&nbsp;<span class="op" id="8296090">!=</span>&nbsp;<span class="ident" id="8296093">nil</span>&nbsp;<span class="op" id="8296097">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296101">t</span><span class="op" id="8296102">.</span><span class="ident" id="8296103">Fatalf</span><span class="op" id="8296109">(</span><span class="string" id="8296110">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8296144">,</span>&nbsp;<span class="ident" id="8296146">err</span><span class="op" id="8296149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8296152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8296155">if</span>&nbsp;<span class="ident" id="8296158">_</span><span class="op" id="8296159">,</span>&nbsp;<span class="ident" id="8296161">err</span>&nbsp;<span class="op" id="8296165">:=</span>&nbsp;<span class="ident" id="8296168">c3</span><span class="op" id="8296170">.</span><span class="ident" id="8296171">WriteToUnix</span><span class="op" id="8296182">(</span><span class="ident" id="8296183">wb</span><span class="op" id="8296185">,</span>&nbsp;<span class="ident" id="8296187">a1</span><span class="op" id="8296189">)</span><span class="op" id="8296190">;</span>&nbsp;<span class="ident" id="8296192">err</span>&nbsp;<span class="op" id="8296196">!=</span>&nbsp;<span class="ident" id="8296199">nil</span>&nbsp;<span class="op" id="8296203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296207">t</span><span class="op" id="8296208">.</span><span class="ident" id="8296209">Fatalf</span><span class="op" id="8296215">(</span><span class="string" id="8296216">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8296249">,</span>&nbsp;<span class="ident" id="8296251">err</span><span class="op" id="8296254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8296257">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8296260">if</span>&nbsp;<span class="ident" id="8296263">_</span><span class="op" id="8296264">,</span>&nbsp;<span class="ident" id="8296266">_</span><span class="op" id="8296267">,</span>&nbsp;<span class="ident" id="8296269">err</span>&nbsp;<span class="op" id="8296273">:=</span>&nbsp;<span class="ident" id="8296276">c1</span><span class="op" id="8296278">.</span><span class="ident" id="8296279">ReadFromUnix</span><span class="op" id="8296291">(</span><span class="ident" id="8296292">rb1</span><span class="op" id="8296295">)</span><span class="op" id="8296296">;</span>&nbsp;<span class="ident" id="8296298">err</span>&nbsp;<span class="op" id="8296302">!=</span>&nbsp;<span class="ident" id="8296305">nil</span>&nbsp;<span class="op" id="8296309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296313">t</span><span class="op" id="8296314">.</span><span class="ident" id="8296315">Fatalf</span><span class="op" id="8296321">(</span><span class="string" id="8296322">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8296356">,</span>&nbsp;<span class="ident" id="8296358">err</span><span class="op" id="8296361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8296364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8296367">if</span>&nbsp;<span class="ident" id="8296370">_</span><span class="op" id="8296371">,</span>&nbsp;<span class="ident" id="8296373">err</span>&nbsp;<span class="op" id="8296377">:=</span>&nbsp;<span class="ident" id="8296380">c2</span><span class="op" id="8296382">.</span><span class="ident" id="8296383">WriteToUnix</span><span class="op" id="8296394">(</span><span class="ident" id="8296395">wb</span><span class="op" id="8296397">,</span>&nbsp;<span class="ident" id="8296399">a3</span><span class="op" id="8296401">)</span><span class="op" id="8296402">;</span>&nbsp;<span class="ident" id="8296404">err</span>&nbsp;<span class="op" id="8296408">!=</span>&nbsp;<span class="ident" id="8296411">nil</span>&nbsp;<span class="op" id="8296415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296419">t</span><span class="op" id="8296420">.</span><span class="ident" id="8296421">Fatalf</span><span class="op" id="8296427">(</span><span class="string" id="8296428">&#34;UnixConn.WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8296461">,</span>&nbsp;<span class="ident" id="8296463">err</span><span class="op" id="8296466">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8296469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8296472">if</span>&nbsp;<span class="ident" id="8296475">_</span><span class="op" id="8296476">,</span>&nbsp;<span class="ident" id="8296478">_</span><span class="op" id="8296479">,</span>&nbsp;<span class="ident" id="8296481">err</span>&nbsp;<span class="op" id="8296485">:=</span>&nbsp;<span class="ident" id="8296488">c3</span><span class="op" id="8296490">.</span><span class="ident" id="8296491">ReadFromUnix</span><span class="op" id="8296503">(</span><span class="ident" id="8296504">rb3</span><span class="op" id="8296507">)</span><span class="op" id="8296508">;</span>&nbsp;<span class="ident" id="8296510">err</span>&nbsp;<span class="op" id="8296514">!=</span>&nbsp;<span class="ident" id="8296517">nil</span>&nbsp;<span class="op" id="8296521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296525">t</span><span class="op" id="8296526">.</span><span class="ident" id="8296527">Fatalf</span><span class="op" id="8296533">(</span><span class="string" id="8296534">&#34;UnixConn.ReadFromUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8296568">,</span>&nbsp;<span class="ident" id="8296570">err</span><span class="op" id="8296573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8296576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8296580">if</span>&nbsp;<span class="ident" id="8296583">f</span><span class="op" id="8296584">,</span>&nbsp;<span class="ident" id="8296586">err</span>&nbsp;<span class="op" id="8296590">:=</span>&nbsp;<span class="ident" id="8296593">c1</span><span class="op" id="8296595">.</span><span class="ident" id="8296596">File</span><span class="op" id="8296600">(</span><span class="op" id="8296601">)</span><span class="op" id="8296602">;</span>&nbsp;<span class="ident" id="8296604">err</span>&nbsp;<span class="op" id="8296608">!=</span>&nbsp;<span class="ident" id="8296611">nil</span>&nbsp;<span class="op" id="8296615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296619">t</span><span class="op" id="8296620">.</span><span class="ident" id="8296621">Fatalf</span><span class="op" id="8296627">(</span><span class="string" id="8296628">&#34;UnixConn.File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8296654">,</span>&nbsp;<span class="ident" id="8296656">err</span><span class="op" id="8296659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8296662">}</span>&nbsp;<span class="keyword" id="8296664">else</span>&nbsp;<span class="op" id="8296669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296673">f</span><span class="op" id="8296674">.</span><span class="ident" id="8296675">Close</span><span class="op" id="8296680">(</span><span class="op" id="8296681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8296684">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8296688">defer</span>&nbsp;<span class="keyword" id="8296694">func</span><span class="op" id="8296698">(</span><span class="op" id="8296699">)</span>&nbsp;<span class="op" id="8296701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8296705">if</span>&nbsp;<span class="ident" id="8296708">p</span>&nbsp;<span class="op" id="8296710">:=</span>&nbsp;<span class="builtinfunc" id="8296713">recover</span><span class="op" id="8296720">(</span><span class="op" id="8296721">)</span><span class="op" id="8296722">;</span>&nbsp;<span class="ident" id="8296724">p</span>&nbsp;<span class="op" id="8296726">!=</span>&nbsp;<span class="ident" id="8296729">nil</span>&nbsp;<span class="op" id="8296733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296738">t</span><span class="op" id="8296739">.</span><span class="ident" id="8296740">Fatalf</span><span class="op" id="8296746">(</span><span class="string" id="8296747">&#34;UnixConn.WriteToUnix&nbsp;or&nbsp;WriteMsgUnix&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="8296798">,</span>&nbsp;<span class="ident" id="8296800">p</span><span class="op" id="8296801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8296805">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8296808">}</span><span class="op" id="8296809">(</span><span class="op" id="8296810">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296814">c1</span><span class="op" id="8296816">.</span><span class="ident" id="8296817">WriteToUnix</span><span class="op" id="8296828">(</span><span class="ident" id="8296829">wb</span><span class="op" id="8296831">,</span>&nbsp;<span class="ident" id="8296833">nil</span><span class="op" id="8296836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296839">c1</span><span class="op" id="8296841">.</span><span class="ident" id="8296842">WriteMsgUnix</span><span class="op" id="8296854">(</span><span class="ident" id="8296855">wb</span><span class="op" id="8296857">,</span>&nbsp;<span class="ident" id="8296859">nil</span><span class="op" id="8296862">,</span>&nbsp;<span class="ident" id="8296864">nil</span><span class="op" id="8296867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296870">c3</span><span class="op" id="8296872">.</span><span class="ident" id="8296873">WriteToUnix</span><span class="op" id="8296884">(</span><span class="ident" id="8296885">wb</span><span class="op" id="8296887">,</span>&nbsp;<span class="ident" id="8296889">nil</span><span class="op" id="8296892">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296895">c3</span><span class="op" id="8296897">.</span><span class="ident" id="8296898">WriteMsgUnix</span><span class="op" id="8296910">(</span><span class="ident" id="8296911">wb</span><span class="op" id="8296913">,</span>&nbsp;<span class="ident" id="8296915">nil</span><span class="op" id="8296918">,</span>&nbsp;<span class="ident" id="8296920">nil</span><span class="op" id="8296923">)</span><br>
<span class="lineno"></span><span class="op" id="8296925">}</span>
</div>
</body>
</html>
