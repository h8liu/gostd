<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7691000">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7691055">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7691109">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7691160">package</span>&nbsp;<span class="ident" id="7691168">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7691173">import</span>&nbsp;<span class="op" id="7691180">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7691183">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7691192">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7691208">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7691217">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7691232">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7691243">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7691253">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7691256">//&nbsp;header,&nbsp;palette&nbsp;and&nbsp;trailer&nbsp;are&nbsp;parts&nbsp;of&nbsp;a&nbsp;valid&nbsp;2x1&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="7691323">const</span>&nbsp;<span class="op" id="7691329">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691332">headerStr</span>&nbsp;<span class="op" id="7691342">=</span>&nbsp;<span class="string" id="7691344">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="7691353">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7691357">&#34;\x02\x00\x01\x00&#34;</span>&nbsp;<span class="op" id="7691376">+</span>&nbsp;<span class="comment" id="7691378">//&nbsp;width=2,&nbsp;height=1</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7691401">&#34;\x80\x00\x00&#34;</span>&nbsp;<span class="comment" id="7691416">//&nbsp;headerFields=(a&nbsp;color&nbsp;map&nbsp;of&nbsp;2&nbsp;pixels),&nbsp;backgroundIndex,&nbsp;aspect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691484">paletteStr</span>&nbsp;<span class="op" id="7691495">=</span>&nbsp;<span class="string" id="7691497">&#34;\x10\x20\x30\x40\x50\x60&#34;</span>&nbsp;<span class="comment" id="7691524">//&nbsp;the&nbsp;color&nbsp;map,&nbsp;also&nbsp;known&nbsp;as&nbsp;a&nbsp;palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691567">trailerStr</span>&nbsp;<span class="op" id="7691578">=</span>&nbsp;<span class="string" id="7691580">&#34;\x3b&#34;</span><br>
<span class="lineno"></span><span class="op" id="7691587">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="7691590">//&nbsp;lzwEncode&nbsp;returns&nbsp;an&nbsp;LZW&nbsp;encoding&nbsp;(with&nbsp;2-bit&nbsp;literals)&nbsp;of&nbsp;n&nbsp;zeroes.</span><br>
<span class="lineno"></span><span class="keyword" id="7691662">func</span>&nbsp;<span class="ident" id="7691667">lzwEncode</span><span class="op" id="7691676">(</span><span class="ident" id="7691677">n</span>&nbsp;<span class="builtintype" id="7691679">int</span><span class="op" id="7691682">)</span>&nbsp;<span class="op" id="7691684">[</span><span class="op" id="7691685">]</span><span class="builtintype" id="7691686">byte</span>&nbsp;<span class="op" id="7691691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691694">b</span>&nbsp;<span class="op" id="7691696">:=</span>&nbsp;<span class="op" id="7691699">&amp;</span><span class="ident" id="7691700">bytes</span><span class="op" id="7691705">.</span><span class="ident" id="7691706">Buffer</span><span class="op" id="7691712">{</span><span class="op" id="7691713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691716">w</span>&nbsp;<span class="op" id="7691718">:=</span>&nbsp;<span class="ident" id="7691721">lzw</span><span class="op" id="7691724">.</span><span class="ident" id="7691725">NewWriter</span><span class="op" id="7691734">(</span><span class="ident" id="7691735">b</span><span class="op" id="7691736">,</span>&nbsp;<span class="ident" id="7691738">lzw</span><span class="op" id="7691741">.</span><span class="ident" id="7691742">LSB</span><span class="op" id="7691745">,</span>&nbsp;<span class="num" id="7691747">2</span><span class="op" id="7691748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691751">w</span><span class="op" id="7691752">.</span><span class="ident" id="7691753">Write</span><span class="op" id="7691758">(</span><span class="builtinfunc" id="7691759">make</span><span class="op" id="7691763">(</span><span class="op" id="7691764">[</span><span class="op" id="7691765">]</span><span class="builtintype" id="7691766">byte</span><span class="op" id="7691770">,</span>&nbsp;<span class="ident" id="7691772">n</span><span class="op" id="7691773">)</span><span class="op" id="7691774">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691777">w</span><span class="op" id="7691778">.</span><span class="ident" id="7691779">Close</span><span class="op" id="7691784">(</span><span class="op" id="7691785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7691788">return</span>&nbsp;<span class="ident" id="7691795">b</span><span class="op" id="7691796">.</span><span class="ident" id="7691797">Bytes</span><span class="op" id="7691802">(</span><span class="op" id="7691803">)</span><br>
<span class="lineno"></span><span class="op" id="7691805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7691808">func</span>&nbsp;<span class="ident" id="7691813">TestDecode</span><span class="op" id="7691823">(</span><span class="ident" id="7691824">t</span>&nbsp;<span class="op" id="7691826">*</span><span class="ident" id="7691827">testing</span><span class="op" id="7691834">.</span><span class="ident" id="7691835">T</span><span class="op" id="7691836">)</span>&nbsp;<span class="op" id="7691838">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691841">testCases</span>&nbsp;<span class="op" id="7691851">:=</span>&nbsp;<span class="op" id="7691854">[</span><span class="op" id="7691855">]</span><span class="keyword" id="7691856">struct</span>&nbsp;<span class="op" id="7691863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691867">nPix</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7691875">int</span>&nbsp;&nbsp;<span class="comment" id="7691880">//&nbsp;The&nbsp;number&nbsp;of&nbsp;pixels&nbsp;in&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691925">extra</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7691933">bool</span>&nbsp;<span class="comment" id="7691938">//&nbsp;Whether&nbsp;to&nbsp;write&nbsp;an&nbsp;extra&nbsp;block&nbsp;after&nbsp;the&nbsp;LZW-encoded&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692003">wantErr</span>&nbsp;<span class="builtintype" id="7692011">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7692018">}</span><span class="op" id="7692019">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7692023">{</span><span class="num" id="7692024">0</span><span class="op" id="7692025">,</span>&nbsp;<span class="builtintype" id="7692027">false</span><span class="op" id="7692032">,</span>&nbsp;<span class="ident" id="7692034">errNotEnough</span><span class="op" id="7692046">}</span><span class="op" id="7692047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7692051">{</span><span class="num" id="7692052">1</span><span class="op" id="7692053">,</span>&nbsp;<span class="builtintype" id="7692055">false</span><span class="op" id="7692060">,</span>&nbsp;<span class="ident" id="7692062">errNotEnough</span><span class="op" id="7692074">}</span><span class="op" id="7692075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7692079">{</span><span class="num" id="7692080">2</span><span class="op" id="7692081">,</span>&nbsp;<span class="builtintype" id="7692083">false</span><span class="op" id="7692088">,</span>&nbsp;<span class="ident" id="7692090">nil</span><span class="op" id="7692093">}</span><span class="op" id="7692094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7692098">{</span><span class="num" id="7692099">2</span><span class="op" id="7692100">,</span>&nbsp;<span class="builtintype" id="7692102">true</span><span class="op" id="7692106">,</span>&nbsp;<span class="ident" id="7692108">errTooMuch</span><span class="op" id="7692118">}</span><span class="op" id="7692119">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7692123">{</span><span class="num" id="7692124">3</span><span class="op" id="7692125">,</span>&nbsp;<span class="builtintype" id="7692127">false</span><span class="op" id="7692132">,</span>&nbsp;<span class="ident" id="7692134">errTooMuch</span><span class="op" id="7692144">}</span><span class="op" id="7692145">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7692148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7692151">for</span>&nbsp;<span class="ident" id="7692155">_</span><span class="op" id="7692156">,</span>&nbsp;<span class="ident" id="7692158">tc</span>&nbsp;<span class="op" id="7692161">:=</span>&nbsp;<span class="keyword" id="7692164">range</span>&nbsp;<span class="ident" id="7692170">testCases</span>&nbsp;<span class="op" id="7692180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692184">b</span>&nbsp;<span class="op" id="7692186">:=</span>&nbsp;<span class="op" id="7692189">&amp;</span><span class="ident" id="7692190">bytes</span><span class="op" id="7692195">.</span><span class="ident" id="7692196">Buffer</span><span class="op" id="7692202">{</span><span class="op" id="7692203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692207">b</span><span class="op" id="7692208">.</span><span class="ident" id="7692209">WriteString</span><span class="op" id="7692220">(</span><span class="ident" id="7692221">headerStr</span><span class="op" id="7692230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692234">b</span><span class="op" id="7692235">.</span><span class="ident" id="7692236">WriteString</span><span class="op" id="7692247">(</span><span class="ident" id="7692248">paletteStr</span><span class="op" id="7692258">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7692262">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1&nbsp;but&nbsp;tc.nPix&nbsp;pixels.&nbsp;If&nbsp;tc.nPix&nbsp;!=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7692334">//&nbsp;then&nbsp;this&nbsp;should&nbsp;result&nbsp;in&nbsp;an&nbsp;invalid&nbsp;GIF&nbsp;image.&nbsp;First,&nbsp;write&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7692403">//&nbsp;magic&nbsp;0x2c&nbsp;(image&nbsp;descriptor)&nbsp;byte,&nbsp;bounds=(0,0)-(2,1),&nbsp;a&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7692472">//&nbsp;byte,&nbsp;and&nbsp;2-bit&nbsp;LZW&nbsp;literals.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692507">b</span><span class="op" id="7692508">.</span><span class="ident" id="7692509">WriteString</span><span class="op" id="7692520">(</span><span class="string" id="7692521">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7692567">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7692571">if</span>&nbsp;<span class="ident" id="7692574">tc</span><span class="op" id="7692576">.</span><span class="ident" id="7692577">nPix</span>&nbsp;<span class="op" id="7692582">&gt;</span>&nbsp;<span class="num" id="7692584">0</span>&nbsp;<span class="op" id="7692586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692591">enc</span>&nbsp;<span class="op" id="7692595">:=</span>&nbsp;<span class="ident" id="7692598">lzwEncode</span><span class="op" id="7692607">(</span><span class="ident" id="7692608">tc</span><span class="op" id="7692610">.</span><span class="ident" id="7692611">nPix</span><span class="op" id="7692615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7692620">if</span>&nbsp;<span class="builtinfunc" id="7692623">len</span><span class="op" id="7692626">(</span><span class="ident" id="7692627">enc</span><span class="op" id="7692630">)</span>&nbsp;<span class="op" id="7692632">&gt;</span>&nbsp;<span class="num" id="7692634">0xff</span>&nbsp;<span class="op" id="7692639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692645">t</span><span class="op" id="7692646">.</span><span class="ident" id="7692647">Errorf</span><span class="op" id="7692653">(</span><span class="string" id="7692654">&#34;nPix=%d,&nbsp;extra=%t:&nbsp;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="7692708">,</span>&nbsp;<span class="ident" id="7692710">tc</span><span class="op" id="7692712">.</span><span class="ident" id="7692713">nPix</span><span class="op" id="7692717">,</span>&nbsp;<span class="ident" id="7692719">tc</span><span class="op" id="7692721">.</span><span class="ident" id="7692722">extra</span><span class="op" id="7692727">,</span>&nbsp;<span class="builtinfunc" id="7692729">len</span><span class="op" id="7692732">(</span><span class="ident" id="7692733">enc</span><span class="op" id="7692736">)</span><span class="op" id="7692737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7692743">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7692755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692760">b</span><span class="op" id="7692761">.</span><span class="ident" id="7692762">WriteByte</span><span class="op" id="7692771">(</span><span class="builtintype" id="7692772">byte</span><span class="op" id="7692776">(</span><span class="builtinfunc" id="7692777">len</span><span class="op" id="7692780">(</span><span class="ident" id="7692781">enc</span><span class="op" id="7692784">)</span><span class="op" id="7692785">)</span><span class="op" id="7692786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692791">b</span><span class="op" id="7692792">.</span><span class="ident" id="7692793">Write</span><span class="op" id="7692798">(</span><span class="ident" id="7692799">enc</span><span class="op" id="7692802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7692806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7692810">if</span>&nbsp;<span class="ident" id="7692813">tc</span><span class="op" id="7692815">.</span><span class="ident" id="7692816">extra</span>&nbsp;<span class="op" id="7692822">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692827">b</span><span class="op" id="7692828">.</span><span class="ident" id="7692829">WriteString</span><span class="op" id="7692840">(</span><span class="string" id="7692841">&#34;\x01\x02&#34;</span><span class="op" id="7692851">)</span>&nbsp;<span class="comment" id="7692853">//&nbsp;A&nbsp;1-byte&nbsp;payload&nbsp;with&nbsp;an&nbsp;0x02&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7692894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692898">b</span><span class="op" id="7692899">.</span><span class="ident" id="7692900">WriteByte</span><span class="op" id="7692909">(</span><span class="num" id="7692910">0x00</span><span class="op" id="7692914">)</span>&nbsp;<span class="comment" id="7692916">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692973">b</span><span class="op" id="7692974">.</span><span class="ident" id="7692975">WriteString</span><span class="op" id="7692986">(</span><span class="ident" id="7692987">trailerStr</span><span class="op" id="7692997">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693002">got</span><span class="op" id="7693005">,</span>&nbsp;<span class="ident" id="7693007">err</span>&nbsp;<span class="op" id="7693011">:=</span>&nbsp;<span class="ident" id="7693014">Decode</span><span class="op" id="7693020">(</span><span class="ident" id="7693021">b</span><span class="op" id="7693022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7693026">if</span>&nbsp;<span class="ident" id="7693029">err</span>&nbsp;<span class="op" id="7693033">!=</span>&nbsp;<span class="ident" id="7693036">tc</span><span class="op" id="7693038">.</span><span class="ident" id="7693039">wantErr</span>&nbsp;<span class="op" id="7693047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693052">t</span><span class="op" id="7693053">.</span><span class="ident" id="7693054">Errorf</span><span class="op" id="7693060">(</span><span class="string" id="7693061">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7693098">,</span>&nbsp;<span class="ident" id="7693100">tc</span><span class="op" id="7693102">.</span><span class="ident" id="7693103">nPix</span><span class="op" id="7693107">,</span>&nbsp;<span class="ident" id="7693109">tc</span><span class="op" id="7693111">.</span><span class="ident" id="7693112">extra</span><span class="op" id="7693117">,</span>&nbsp;<span class="ident" id="7693119">err</span><span class="op" id="7693122">,</span>&nbsp;<span class="ident" id="7693124">tc</span><span class="op" id="7693126">.</span><span class="ident" id="7693127">wantErr</span><span class="op" id="7693134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7693143">if</span>&nbsp;<span class="ident" id="7693146">tc</span><span class="op" id="7693148">.</span><span class="ident" id="7693149">wantErr</span>&nbsp;<span class="op" id="7693157">!=</span>&nbsp;<span class="ident" id="7693160">nil</span>&nbsp;<span class="op" id="7693164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7693169">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693184">want</span>&nbsp;<span class="op" id="7693189">:=</span>&nbsp;<span class="op" id="7693192">&amp;</span><span class="ident" id="7693193">image</span><span class="op" id="7693198">.</span><span class="ident" id="7693199">Paletted</span><span class="op" id="7693207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693212">Pix</span><span class="op" id="7693215">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7693220">[</span><span class="op" id="7693221">]</span><span class="builtintype" id="7693222">uint8</span><span class="op" id="7693227">{</span><span class="num" id="7693228">0</span><span class="op" id="7693229">,</span>&nbsp;<span class="num" id="7693231">0</span><span class="op" id="7693232">}</span><span class="op" id="7693233">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693238">Stride</span><span class="op" id="7693244">:</span>&nbsp;<span class="num" id="7693246">2</span><span class="op" id="7693247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693252">Rect</span><span class="op" id="7693256">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7693260">image</span><span class="op" id="7693265">.</span><span class="ident" id="7693266">Rect</span><span class="op" id="7693270">(</span><span class="num" id="7693271">0</span><span class="op" id="7693272">,</span>&nbsp;<span class="num" id="7693274">0</span><span class="op" id="7693275">,</span>&nbsp;<span class="num" id="7693277">2</span><span class="op" id="7693278">,</span>&nbsp;<span class="num" id="7693280">1</span><span class="op" id="7693281">)</span><span class="op" id="7693282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693287">Palette</span><span class="op" id="7693294">:</span>&nbsp;<span class="ident" id="7693296">color</span><span class="op" id="7693301">.</span><span class="ident" id="7693302">Palette</span><span class="op" id="7693309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693315">color</span><span class="op" id="7693320">.</span><span class="ident" id="7693321">RGBA</span><span class="op" id="7693325">{</span><span class="num" id="7693326">0x10</span><span class="op" id="7693330">,</span>&nbsp;<span class="num" id="7693332">0x20</span><span class="op" id="7693336">,</span>&nbsp;<span class="num" id="7693338">0x30</span><span class="op" id="7693342">,</span>&nbsp;<span class="num" id="7693344">0xff</span><span class="op" id="7693348">}</span><span class="op" id="7693349">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693355">color</span><span class="op" id="7693360">.</span><span class="ident" id="7693361">RGBA</span><span class="op" id="7693365">{</span><span class="num" id="7693366">0x40</span><span class="op" id="7693370">,</span>&nbsp;<span class="num" id="7693372">0x50</span><span class="op" id="7693376">,</span>&nbsp;<span class="num" id="7693378">0x60</span><span class="op" id="7693382">,</span>&nbsp;<span class="num" id="7693384">0xff</span><span class="op" id="7693388">}</span><span class="op" id="7693389">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693394">}</span><span class="op" id="7693395">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7693403">if</span>&nbsp;<span class="op" id="7693406">!</span><span class="ident" id="7693407">reflect</span><span class="op" id="7693414">.</span><span class="ident" id="7693415">DeepEqual</span><span class="op" id="7693424">(</span><span class="ident" id="7693425">got</span><span class="op" id="7693428">,</span>&nbsp;<span class="ident" id="7693430">want</span><span class="op" id="7693434">)</span>&nbsp;<span class="op" id="7693436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693441">t</span><span class="op" id="7693442">.</span><span class="ident" id="7693443">Errorf</span><span class="op" id="7693449">(</span><span class="string" id="7693450">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7693487">,</span>&nbsp;<span class="ident" id="7693489">tc</span><span class="op" id="7693491">.</span><span class="ident" id="7693492">nPix</span><span class="op" id="7693496">,</span>&nbsp;<span class="ident" id="7693498">tc</span><span class="op" id="7693500">.</span><span class="ident" id="7693501">extra</span><span class="op" id="7693506">,</span>&nbsp;<span class="ident" id="7693508">got</span><span class="op" id="7693511">,</span>&nbsp;<span class="ident" id="7693513">want</span><span class="op" id="7693517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693521">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693524">}</span><br>
<span class="lineno"></span><span class="op" id="7693526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7693529">func</span>&nbsp;<span class="ident" id="7693534">TestTransparentIndex</span><span class="op" id="7693554">(</span><span class="ident" id="7693555">t</span>&nbsp;<span class="op" id="7693557">*</span><span class="ident" id="7693558">testing</span><span class="op" id="7693565">.</span><span class="ident" id="7693566">T</span><span class="op" id="7693567">)</span>&nbsp;<span class="op" id="7693569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693572">b</span>&nbsp;<span class="op" id="7693574">:=</span>&nbsp;<span class="op" id="7693577">&amp;</span><span class="ident" id="7693578">bytes</span><span class="op" id="7693583">.</span><span class="ident" id="7693584">Buffer</span><span class="op" id="7693590">{</span><span class="op" id="7693591">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693594">b</span><span class="op" id="7693595">.</span><span class="ident" id="7693596">WriteString</span><span class="op" id="7693607">(</span><span class="ident" id="7693608">headerStr</span><span class="op" id="7693617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693620">b</span><span class="op" id="7693621">.</span><span class="ident" id="7693622">WriteString</span><span class="op" id="7693633">(</span><span class="ident" id="7693634">paletteStr</span><span class="op" id="7693644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7693647">for</span>&nbsp;<span class="ident" id="7693651">transparentIndex</span>&nbsp;<span class="op" id="7693668">:=</span>&nbsp;<span class="num" id="7693671">0</span><span class="op" id="7693672">;</span>&nbsp;<span class="ident" id="7693674">transparentIndex</span>&nbsp;<span class="op" id="7693691">&lt;</span>&nbsp;<span class="num" id="7693693">3</span><span class="op" id="7693694">;</span>&nbsp;<span class="ident" id="7693696">transparentIndex</span><span class="op" id="7693712">++</span>&nbsp;<span class="op" id="7693715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7693719">if</span>&nbsp;<span class="ident" id="7693722">transparentIndex</span>&nbsp;<span class="op" id="7693739">&lt;</span>&nbsp;<span class="num" id="7693741">2</span>&nbsp;<span class="op" id="7693743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7693748">//&nbsp;Write&nbsp;the&nbsp;graphic&nbsp;control&nbsp;for&nbsp;the&nbsp;transparent&nbsp;index.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693807">b</span><span class="op" id="7693808">.</span><span class="ident" id="7693809">WriteString</span><span class="op" id="7693820">(</span><span class="string" id="7693821">&#34;\x21\xf9\x00\x01\x00\x00&#34;</span><span class="op" id="7693847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693852">b</span><span class="op" id="7693853">.</span><span class="ident" id="7693854">WriteByte</span><span class="op" id="7693863">(</span><span class="builtintype" id="7693864">byte</span><span class="op" id="7693868">(</span><span class="ident" id="7693869">transparentIndex</span><span class="op" id="7693885">)</span><span class="op" id="7693886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693891">b</span><span class="op" id="7693892">.</span><span class="ident" id="7693893">WriteByte</span><span class="op" id="7693902">(</span><span class="num" id="7693903">0</span><span class="op" id="7693904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7693912">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1,&nbsp;as&nbsp;per&nbsp;TestDecode.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693968">b</span><span class="op" id="7693969">.</span><span class="ident" id="7693970">WriteString</span><span class="op" id="7693981">(</span><span class="string" id="7693982">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7694028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694032">enc</span>&nbsp;<span class="op" id="7694036">:=</span>&nbsp;<span class="ident" id="7694039">lzwEncode</span><span class="op" id="7694048">(</span><span class="num" id="7694049">2</span><span class="op" id="7694050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694054">if</span>&nbsp;<span class="builtinfunc" id="7694057">len</span><span class="op" id="7694060">(</span><span class="ident" id="7694061">enc</span><span class="op" id="7694064">)</span>&nbsp;<span class="op" id="7694066">&gt;</span>&nbsp;<span class="num" id="7694068">0xff</span>&nbsp;<span class="op" id="7694073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694078">t</span><span class="op" id="7694079">.</span><span class="ident" id="7694080">Fatalf</span><span class="op" id="7694086">(</span><span class="string" id="7694087">&#34;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="7694122">,</span>&nbsp;<span class="builtinfunc" id="7694124">len</span><span class="op" id="7694127">(</span><span class="ident" id="7694128">enc</span><span class="op" id="7694131">)</span><span class="op" id="7694132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7694136">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694140">b</span><span class="op" id="7694141">.</span><span class="ident" id="7694142">WriteByte</span><span class="op" id="7694151">(</span><span class="builtintype" id="7694152">byte</span><span class="op" id="7694156">(</span><span class="builtinfunc" id="7694157">len</span><span class="op" id="7694160">(</span><span class="ident" id="7694161">enc</span><span class="op" id="7694164">)</span><span class="op" id="7694165">)</span><span class="op" id="7694166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694170">b</span><span class="op" id="7694171">.</span><span class="ident" id="7694172">Write</span><span class="op" id="7694177">(</span><span class="ident" id="7694178">enc</span><span class="op" id="7694181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694185">b</span><span class="op" id="7694186">.</span><span class="ident" id="7694187">WriteByte</span><span class="op" id="7694196">(</span><span class="num" id="7694197">0x00</span><span class="op" id="7694201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7694204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694207">b</span><span class="op" id="7694208">.</span><span class="ident" id="7694209">WriteString</span><span class="op" id="7694220">(</span><span class="ident" id="7694221">trailerStr</span><span class="op" id="7694231">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694235">g</span><span class="op" id="7694236">,</span>&nbsp;<span class="ident" id="7694238">err</span>&nbsp;<span class="op" id="7694242">:=</span>&nbsp;<span class="ident" id="7694245">DecodeAll</span><span class="op" id="7694254">(</span><span class="ident" id="7694255">b</span><span class="op" id="7694256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694259">if</span>&nbsp;<span class="ident" id="7694262">err</span>&nbsp;<span class="op" id="7694266">!=</span>&nbsp;<span class="ident" id="7694269">nil</span>&nbsp;<span class="op" id="7694273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694277">t</span><span class="op" id="7694278">.</span><span class="ident" id="7694279">Fatalf</span><span class="op" id="7694285">(</span><span class="string" id="7694286">&#34;DecodeAll:&nbsp;%v&#34;</span><span class="op" id="7694301">,</span>&nbsp;<span class="ident" id="7694303">err</span><span class="op" id="7694306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7694309">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694312">c0</span>&nbsp;<span class="op" id="7694315">:=</span>&nbsp;<span class="ident" id="7694318">color</span><span class="op" id="7694323">.</span><span class="ident" id="7694324">RGBA</span><span class="op" id="7694328">{</span><span class="ident" id="7694329">paletteStr</span><span class="op" id="7694339">[</span><span class="num" id="7694340">0</span><span class="op" id="7694341">]</span><span class="op" id="7694342">,</span>&nbsp;<span class="ident" id="7694344">paletteStr</span><span class="op" id="7694354">[</span><span class="num" id="7694355">1</span><span class="op" id="7694356">]</span><span class="op" id="7694357">,</span>&nbsp;<span class="ident" id="7694359">paletteStr</span><span class="op" id="7694369">[</span><span class="num" id="7694370">2</span><span class="op" id="7694371">]</span><span class="op" id="7694372">,</span>&nbsp;<span class="num" id="7694374">0xff</span><span class="op" id="7694378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694381">c1</span>&nbsp;<span class="op" id="7694384">:=</span>&nbsp;<span class="ident" id="7694387">color</span><span class="op" id="7694392">.</span><span class="ident" id="7694393">RGBA</span><span class="op" id="7694397">{</span><span class="ident" id="7694398">paletteStr</span><span class="op" id="7694408">[</span><span class="num" id="7694409">3</span><span class="op" id="7694410">]</span><span class="op" id="7694411">,</span>&nbsp;<span class="ident" id="7694413">paletteStr</span><span class="op" id="7694423">[</span><span class="num" id="7694424">4</span><span class="op" id="7694425">]</span><span class="op" id="7694426">,</span>&nbsp;<span class="ident" id="7694428">paletteStr</span><span class="op" id="7694438">[</span><span class="num" id="7694439">5</span><span class="op" id="7694440">]</span><span class="op" id="7694441">,</span>&nbsp;<span class="num" id="7694443">0xff</span><span class="op" id="7694447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694450">cz</span>&nbsp;<span class="op" id="7694453">:=</span>&nbsp;<span class="ident" id="7694456">color</span><span class="op" id="7694461">.</span><span class="ident" id="7694462">RGBA</span><span class="op" id="7694466">{</span><span class="op" id="7694467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694470">wants</span>&nbsp;<span class="op" id="7694476">:=</span>&nbsp;<span class="op" id="7694479">[</span><span class="op" id="7694480">]</span><span class="ident" id="7694481">color</span><span class="op" id="7694486">.</span><span class="ident" id="7694487">Palette</span><span class="op" id="7694494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7694498">{</span><span class="ident" id="7694499">cz</span><span class="op" id="7694501">,</span>&nbsp;<span class="ident" id="7694503">c1</span><span class="op" id="7694505">}</span><span class="op" id="7694506">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7694510">{</span><span class="ident" id="7694511">c0</span><span class="op" id="7694513">,</span>&nbsp;<span class="ident" id="7694515">cz</span><span class="op" id="7694517">}</span><span class="op" id="7694518">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7694522">{</span><span class="ident" id="7694523">c0</span><span class="op" id="7694525">,</span>&nbsp;<span class="ident" id="7694527">c1</span><span class="op" id="7694529">}</span><span class="op" id="7694530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7694533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694536">if</span>&nbsp;<span class="builtinfunc" id="7694539">len</span><span class="op" id="7694542">(</span><span class="ident" id="7694543">g</span><span class="op" id="7694544">.</span><span class="ident" id="7694545">Image</span><span class="op" id="7694550">)</span>&nbsp;<span class="op" id="7694552">!=</span>&nbsp;<span class="builtinfunc" id="7694555">len</span><span class="op" id="7694558">(</span><span class="ident" id="7694559">wants</span><span class="op" id="7694564">)</span>&nbsp;<span class="op" id="7694566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694570">t</span><span class="op" id="7694571">.</span><span class="ident" id="7694572">Fatalf</span><span class="op" id="7694578">(</span><span class="string" id="7694579">&#34;got&nbsp;%d&nbsp;images,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7694603">,</span>&nbsp;<span class="builtinfunc" id="7694605">len</span><span class="op" id="7694608">(</span><span class="ident" id="7694609">g</span><span class="op" id="7694610">.</span><span class="ident" id="7694611">Image</span><span class="op" id="7694616">)</span><span class="op" id="7694617">,</span>&nbsp;<span class="builtinfunc" id="7694619">len</span><span class="op" id="7694622">(</span><span class="ident" id="7694623">wants</span><span class="op" id="7694628">)</span><span class="op" id="7694629">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7694632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694635">for</span>&nbsp;<span class="ident" id="7694639">i</span><span class="op" id="7694640">,</span>&nbsp;<span class="ident" id="7694642">want</span>&nbsp;<span class="op" id="7694647">:=</span>&nbsp;<span class="keyword" id="7694650">range</span>&nbsp;<span class="ident" id="7694656">wants</span>&nbsp;<span class="op" id="7694662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694666">got</span>&nbsp;<span class="op" id="7694670">:=</span>&nbsp;<span class="ident" id="7694673">g</span><span class="op" id="7694674">.</span><span class="ident" id="7694675">Image</span><span class="op" id="7694680">[</span><span class="ident" id="7694681">i</span><span class="op" id="7694682">]</span><span class="op" id="7694683">.</span><span class="ident" id="7694684">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694694">if</span>&nbsp;<span class="op" id="7694697">!</span><span class="ident" id="7694698">reflect</span><span class="op" id="7694705">.</span><span class="ident" id="7694706">DeepEqual</span><span class="op" id="7694715">(</span><span class="ident" id="7694716">got</span><span class="op" id="7694719">,</span>&nbsp;<span class="ident" id="7694721">want</span><span class="op" id="7694725">)</span>&nbsp;<span class="op" id="7694727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694732">t</span><span class="op" id="7694733">.</span><span class="ident" id="7694734">Errorf</span><span class="op" id="7694740">(</span><span class="string" id="7694741">&#34;palette&nbsp;#%d:\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7694773">,</span>&nbsp;<span class="ident" id="7694775">i</span><span class="op" id="7694776">,</span>&nbsp;<span class="ident" id="7694778">got</span><span class="op" id="7694781">,</span>&nbsp;<span class="ident" id="7694783">want</span><span class="op" id="7694787">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7694791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7694794">}</span><br>
<span class="lineno"></span><span class="op" id="7694796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7694799">//&nbsp;testGIF&nbsp;is&nbsp;a&nbsp;simple&nbsp;GIF&nbsp;that&nbsp;we&nbsp;can&nbsp;modify&nbsp;to&nbsp;test&nbsp;different&nbsp;scenarios.</span><br>
<span class="lineno">140</span><span class="keyword" id="7694874">var</span>&nbsp;<span class="ident" id="7694878">testGIF</span>&nbsp;<span class="op" id="7694886">=</span>&nbsp;<span class="op" id="7694888">[</span><span class="op" id="7694889">]</span><span class="builtintype" id="7694890">byte</span><span class="op" id="7694894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7694897">&#39;G&#39;</span><span class="op" id="7694900">,</span>&nbsp;<span class="string" id="7694902">&#39;I&#39;</span><span class="op" id="7694905">,</span>&nbsp;<span class="string" id="7694907">&#39;F&#39;</span><span class="op" id="7694910">,</span>&nbsp;<span class="string" id="7694912">&#39;8&#39;</span><span class="op" id="7694915">,</span>&nbsp;<span class="string" id="7694917">&#39;9&#39;</span><span class="op" id="7694920">,</span>&nbsp;<span class="string" id="7694922">&#39;a&#39;</span><span class="op" id="7694925">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7694928">1</span><span class="op" id="7694929">,</span>&nbsp;<span class="num" id="7694931">0</span><span class="op" id="7694932">,</span>&nbsp;<span class="num" id="7694934">1</span><span class="op" id="7694935">,</span>&nbsp;<span class="num" id="7694937">0</span><span class="op" id="7694938">,</span>&nbsp;<span class="comment" id="7694940">//&nbsp;w=1,&nbsp;h=1&nbsp;(6)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7694957">128</span><span class="op" id="7694960">,</span>&nbsp;<span class="num" id="7694962">0</span><span class="op" id="7694963">,</span>&nbsp;<span class="num" id="7694965">0</span><span class="op" id="7694966">,</span>&nbsp;<span class="comment" id="7694968">//&nbsp;headerFields,&nbsp;bg,&nbsp;aspect&nbsp;(10)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7695002">0</span><span class="op" id="7695003">,</span>&nbsp;<span class="num" id="7695005">0</span><span class="op" id="7695006">,</span>&nbsp;<span class="num" id="7695008">0</span><span class="op" id="7695009">,</span>&nbsp;<span class="num" id="7695011">1</span><span class="op" id="7695012">,</span>&nbsp;<span class="num" id="7695014">1</span><span class="op" id="7695015">,</span>&nbsp;<span class="num" id="7695017">1</span><span class="op" id="7695018">,</span>&nbsp;<span class="comment" id="7695020">//&nbsp;color&nbsp;map&nbsp;and&nbsp;graphics&nbsp;control&nbsp;(13)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7695060">0x21</span><span class="op" id="7695064">,</span>&nbsp;<span class="num" id="7695066">0xf9</span><span class="op" id="7695070">,</span>&nbsp;<span class="num" id="7695072">0x04</span><span class="op" id="7695076">,</span>&nbsp;<span class="num" id="7695078">0x00</span><span class="op" id="7695082">,</span>&nbsp;<span class="num" id="7695084">0x00</span><span class="op" id="7695088">,</span>&nbsp;<span class="num" id="7695090">0x00</span><span class="op" id="7695094">,</span>&nbsp;<span class="num" id="7695096">0xff</span><span class="op" id="7695100">,</span>&nbsp;<span class="num" id="7695102">0x00</span><span class="op" id="7695106">,</span>&nbsp;<span class="comment" id="7695108">//&nbsp;(19)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7695117">//&nbsp;frame&nbsp;1&nbsp;(0,0&nbsp;-&nbsp;1,1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7695141">0x2c</span><span class="op" id="7695145">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7695148">0x00</span><span class="op" id="7695152">,</span>&nbsp;<span class="num" id="7695154">0x00</span><span class="op" id="7695158">,</span>&nbsp;<span class="num" id="7695160">0x00</span><span class="op" id="7695164">,</span>&nbsp;<span class="num" id="7695166">0x00</span><span class="op" id="7695170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7695173">0x01</span><span class="op" id="7695177">,</span>&nbsp;<span class="num" id="7695179">0x00</span><span class="op" id="7695183">,</span>&nbsp;<span class="num" id="7695185">0x01</span><span class="op" id="7695189">,</span>&nbsp;<span class="num" id="7695191">0x00</span><span class="op" id="7695195">,</span>&nbsp;<span class="comment" id="7695197">//&nbsp;(32)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7695206">0x00</span><span class="op" id="7695210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7695213">0x02</span><span class="op" id="7695217">,</span>&nbsp;<span class="num" id="7695219">0x02</span><span class="op" id="7695223">,</span>&nbsp;<span class="num" id="7695225">0x4c</span><span class="op" id="7695229">,</span>&nbsp;<span class="num" id="7695231">0x01</span><span class="op" id="7695235">,</span>&nbsp;<span class="num" id="7695237">0x00</span><span class="op" id="7695241">,</span>&nbsp;<span class="comment" id="7695243">//&nbsp;lzw&nbsp;pixels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7695258">//&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7695270">0x3b</span><span class="op" id="7695274">,</span><br>
<span class="lineno"></span><span class="op" id="7695276">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="7695279">func</span>&nbsp;<span class="ident" id="7695284">try</span><span class="op" id="7695287">(</span><span class="ident" id="7695288">t</span>&nbsp;<span class="op" id="7695290">*</span><span class="ident" id="7695291">testing</span><span class="op" id="7695298">.</span><span class="ident" id="7695299">T</span><span class="op" id="7695300">,</span>&nbsp;<span class="ident" id="7695302">b</span>&nbsp;<span class="op" id="7695304">[</span><span class="op" id="7695305">]</span><span class="builtintype" id="7695306">byte</span><span class="op" id="7695310">,</span>&nbsp;<span class="ident" id="7695312">want</span>&nbsp;<span class="builtintype" id="7695317">string</span><span class="op" id="7695323">)</span>&nbsp;<span class="op" id="7695325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695328">_</span><span class="op" id="7695329">,</span>&nbsp;<span class="ident" id="7695331">err</span>&nbsp;<span class="op" id="7695335">:=</span>&nbsp;<span class="ident" id="7695338">DecodeAll</span><span class="op" id="7695347">(</span><span class="ident" id="7695348">bytes</span><span class="op" id="7695353">.</span><span class="ident" id="7695354">NewReader</span><span class="op" id="7695363">(</span><span class="ident" id="7695364">b</span><span class="op" id="7695365">)</span><span class="op" id="7695366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7695369">var</span>&nbsp;<span class="ident" id="7695373">got</span>&nbsp;<span class="builtintype" id="7695377">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7695385">if</span>&nbsp;<span class="ident" id="7695388">err</span>&nbsp;<span class="op" id="7695392">!=</span>&nbsp;<span class="ident" id="7695395">nil</span>&nbsp;<span class="op" id="7695399">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695403">got</span>&nbsp;<span class="op" id="7695407">=</span>&nbsp;<span class="ident" id="7695409">err</span><span class="op" id="7695412">.</span><span class="ident" id="7695413">Error</span><span class="op" id="7695418">(</span><span class="op" id="7695419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7695422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7695425">if</span>&nbsp;<span class="ident" id="7695428">got</span>&nbsp;<span class="op" id="7695432">!=</span>&nbsp;<span class="ident" id="7695435">want</span>&nbsp;<span class="op" id="7695440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695444">t</span><span class="op" id="7695445">.</span><span class="ident" id="7695446">Fatalf</span><span class="op" id="7695452">(</span><span class="string" id="7695453">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7695470">,</span>&nbsp;<span class="ident" id="7695472">got</span><span class="op" id="7695475">,</span>&nbsp;<span class="ident" id="7695477">want</span><span class="op" id="7695481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7695484">}</span><br>
<span class="lineno">165</span><span class="op" id="7695486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7695489">func</span>&nbsp;<span class="ident" id="7695494">TestBounds</span><span class="op" id="7695504">(</span><span class="ident" id="7695505">t</span>&nbsp;<span class="op" id="7695507">*</span><span class="ident" id="7695508">testing</span><span class="op" id="7695515">.</span><span class="ident" id="7695516">T</span><span class="op" id="7695517">)</span>&nbsp;<span class="op" id="7695519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7695522">//&nbsp;Make&nbsp;a&nbsp;local&nbsp;copy&nbsp;of&nbsp;testGIF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695556">gif</span>&nbsp;<span class="op" id="7695560">:=</span>&nbsp;<span class="builtinfunc" id="7695563">make</span><span class="op" id="7695567">(</span><span class="op" id="7695568">[</span><span class="op" id="7695569">]</span><span class="builtintype" id="7695570">byte</span><span class="op" id="7695574">,</span>&nbsp;<span class="builtinfunc" id="7695576">len</span><span class="op" id="7695579">(</span><span class="ident" id="7695580">testGIF</span><span class="op" id="7695587">)</span><span class="op" id="7695588">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7695591">copy</span><span class="op" id="7695595">(</span><span class="ident" id="7695596">gif</span><span class="op" id="7695599">,</span>&nbsp;<span class="ident" id="7695601">testGIF</span><span class="op" id="7695608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7695611">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;big,&nbsp;just&nbsp;by&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695653">gif</span><span class="op" id="7695656">[</span><span class="num" id="7695657">32</span><span class="op" id="7695659">]</span>&nbsp;<span class="op" id="7695661">=</span>&nbsp;<span class="num" id="7695663">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695666">want</span>&nbsp;<span class="op" id="7695671">:=</span>&nbsp;<span class="string" id="7695674">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695720">try</span><span class="op" id="7695723">(</span><span class="ident" id="7695724">t</span><span class="op" id="7695725">,</span>&nbsp;<span class="ident" id="7695727">gif</span><span class="op" id="7695730">,</span>&nbsp;<span class="ident" id="7695732">want</span><span class="op" id="7695736">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7695740">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;small;&nbsp;does&nbsp;not&nbsp;trigger&nbsp;bounds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7695795">//&nbsp;check,&nbsp;but&nbsp;now&nbsp;there&#39;s&nbsp;too&nbsp;much&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695837">gif</span><span class="op" id="7695840">[</span><span class="num" id="7695841">32</span><span class="op" id="7695843">]</span>&nbsp;<span class="op" id="7695845">=</span>&nbsp;<span class="num" id="7695847">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695850">want</span>&nbsp;<span class="op" id="7695855">=</span>&nbsp;<span class="string" id="7695857">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695885">try</span><span class="op" id="7695888">(</span><span class="ident" id="7695889">t</span><span class="op" id="7695890">,</span>&nbsp;<span class="ident" id="7695892">gif</span><span class="op" id="7695895">,</span>&nbsp;<span class="ident" id="7695897">want</span><span class="op" id="7695901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695904">gif</span><span class="op" id="7695907">[</span><span class="num" id="7695908">32</span><span class="op" id="7695910">]</span>&nbsp;<span class="op" id="7695912">=</span>&nbsp;<span class="num" id="7695914">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7695918">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;really&nbsp;big,&nbsp;expect&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695967">want</span>&nbsp;<span class="op" id="7695972">=</span>&nbsp;<span class="string" id="7695974">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7696020">for</span>&nbsp;<span class="ident" id="7696024">i</span>&nbsp;<span class="op" id="7696026">:=</span>&nbsp;<span class="num" id="7696029">0</span><span class="op" id="7696030">;</span>&nbsp;<span class="ident" id="7696032">i</span>&nbsp;<span class="op" id="7696034">&lt;</span>&nbsp;<span class="num" id="7696036">4</span><span class="op" id="7696037">;</span>&nbsp;<span class="ident" id="7696039">i</span><span class="op" id="7696040">++</span>&nbsp;<span class="op" id="7696043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696047">gif</span><span class="op" id="7696050">[</span><span class="num" id="7696051">32</span><span class="op" id="7696053">+</span><span class="ident" id="7696054">i</span><span class="op" id="7696055">]</span>&nbsp;<span class="op" id="7696057">=</span>&nbsp;<span class="num" id="7696059">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696068">try</span><span class="op" id="7696071">(</span><span class="ident" id="7696072">t</span><span class="op" id="7696073">,</span>&nbsp;<span class="ident" id="7696075">gif</span><span class="op" id="7696078">,</span>&nbsp;<span class="ident" id="7696080">want</span><span class="op" id="7696084">)</span><br>
<span class="lineno"></span><span class="op" id="7696086">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="7696089">func</span>&nbsp;<span class="ident" id="7696094">TestNoPalette</span><span class="op" id="7696107">(</span><span class="ident" id="7696108">t</span>&nbsp;<span class="op" id="7696110">*</span><span class="ident" id="7696111">testing</span><span class="op" id="7696118">.</span><span class="ident" id="7696119">T</span><span class="op" id="7696120">)</span>&nbsp;<span class="op" id="7696122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696125">b</span>&nbsp;<span class="op" id="7696127">:=</span>&nbsp;<span class="op" id="7696130">&amp;</span><span class="ident" id="7696131">bytes</span><span class="op" id="7696136">.</span><span class="ident" id="7696137">Buffer</span><span class="op" id="7696143">{</span><span class="op" id="7696144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7696148">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;no&nbsp;palette,&nbsp;so&nbsp;any&nbsp;pixel&nbsp;at&nbsp;all</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7696207">//&nbsp;will&nbsp;be&nbsp;invalid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696228">b</span><span class="op" id="7696229">.</span><span class="ident" id="7696230">WriteString</span><span class="op" id="7696241">(</span><span class="ident" id="7696242">headerStr</span><span class="op" id="7696251">[</span><span class="op" id="7696252">:</span><span class="builtinfunc" id="7696253">len</span><span class="op" id="7696256">(</span><span class="ident" id="7696257">headerStr</span><span class="op" id="7696266">)</span><span class="op" id="7696267">-</span><span class="num" id="7696268">3</span><span class="op" id="7696269">]</span><span class="op" id="7696270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696273">b</span><span class="op" id="7696274">.</span><span class="ident" id="7696275">WriteString</span><span class="op" id="7696286">(</span><span class="string" id="7696287">&#34;\x00\x00\x00&#34;</span><span class="op" id="7696301">)</span>&nbsp;<span class="comment" id="7696303">//&nbsp;No&nbsp;global&nbsp;palette.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7696327">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696372">b</span><span class="op" id="7696373">.</span><span class="ident" id="7696374">WriteString</span><span class="op" id="7696385">(</span><span class="string" id="7696386">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7696432">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7696436">//&nbsp;Encode&nbsp;the&nbsp;pixels:&nbsp;neither&nbsp;is&nbsp;in&nbsp;range,&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696509">pix</span>&nbsp;<span class="op" id="7696513">:=</span>&nbsp;<span class="op" id="7696516">[</span><span class="op" id="7696517">]</span><span class="builtintype" id="7696518">byte</span><span class="op" id="7696522">{</span><span class="num" id="7696523">0</span><span class="op" id="7696524">,</span>&nbsp;<span class="num" id="7696526">128</span><span class="op" id="7696529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696532">enc</span>&nbsp;<span class="op" id="7696536">:=</span>&nbsp;<span class="op" id="7696539">&amp;</span><span class="ident" id="7696540">bytes</span><span class="op" id="7696545">.</span><span class="ident" id="7696546">Buffer</span><span class="op" id="7696552">{</span><span class="op" id="7696553">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696556">w</span>&nbsp;<span class="op" id="7696558">:=</span>&nbsp;<span class="ident" id="7696561">lzw</span><span class="op" id="7696564">.</span><span class="ident" id="7696565">NewWriter</span><span class="op" id="7696574">(</span><span class="ident" id="7696575">enc</span><span class="op" id="7696578">,</span>&nbsp;<span class="ident" id="7696580">lzw</span><span class="op" id="7696583">.</span><span class="ident" id="7696584">LSB</span><span class="op" id="7696587">,</span>&nbsp;<span class="num" id="7696589">2</span><span class="op" id="7696590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696593">w</span><span class="op" id="7696594">.</span><span class="ident" id="7696595">Write</span><span class="op" id="7696600">(</span><span class="ident" id="7696601">pix</span><span class="op" id="7696604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696607">w</span><span class="op" id="7696608">.</span><span class="ident" id="7696609">Close</span><span class="op" id="7696614">(</span><span class="op" id="7696615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696618">b</span><span class="op" id="7696619">.</span><span class="ident" id="7696620">WriteByte</span><span class="op" id="7696629">(</span><span class="builtintype" id="7696630">byte</span><span class="op" id="7696634">(</span><span class="builtinfunc" id="7696635">len</span><span class="op" id="7696638">(</span><span class="ident" id="7696639">enc</span><span class="op" id="7696642">.</span><span class="ident" id="7696643">Bytes</span><span class="op" id="7696648">(</span><span class="op" id="7696649">)</span><span class="op" id="7696650">)</span><span class="op" id="7696651">)</span><span class="op" id="7696652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696655">b</span><span class="op" id="7696656">.</span><span class="ident" id="7696657">Write</span><span class="op" id="7696662">(</span><span class="ident" id="7696663">enc</span><span class="op" id="7696666">.</span><span class="ident" id="7696667">Bytes</span><span class="op" id="7696672">(</span><span class="op" id="7696673">)</span><span class="op" id="7696674">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696677">b</span><span class="op" id="7696678">.</span><span class="ident" id="7696679">WriteByte</span><span class="op" id="7696688">(</span><span class="num" id="7696689">0x00</span><span class="op" id="7696693">)</span>&nbsp;<span class="comment" id="7696695">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696752">b</span><span class="op" id="7696753">.</span><span class="ident" id="7696754">WriteString</span><span class="op" id="7696765">(</span><span class="ident" id="7696766">trailerStr</span><span class="op" id="7696776">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696780">try</span><span class="op" id="7696783">(</span><span class="ident" id="7696784">t</span><span class="op" id="7696785">,</span>&nbsp;<span class="ident" id="7696787">b</span><span class="op" id="7696788">.</span><span class="ident" id="7696789">Bytes</span><span class="op" id="7696794">(</span><span class="op" id="7696795">)</span><span class="op" id="7696796">,</span>&nbsp;<span class="string" id="7696798">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="7696824">)</span><br>
<span class="lineno">215</span><span class="op" id="7696826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7696829">func</span>&nbsp;<span class="ident" id="7696834">TestPixelOutsidePaletteRange</span><span class="op" id="7696862">(</span><span class="ident" id="7696863">t</span>&nbsp;<span class="op" id="7696865">*</span><span class="ident" id="7696866">testing</span><span class="op" id="7696873">.</span><span class="ident" id="7696874">T</span><span class="op" id="7696875">)</span>&nbsp;<span class="op" id="7696877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7696880">for</span>&nbsp;<span class="ident" id="7696884">_</span><span class="op" id="7696885">,</span>&nbsp;<span class="ident" id="7696887">pval</span>&nbsp;<span class="op" id="7696892">:=</span>&nbsp;<span class="keyword" id="7696895">range</span>&nbsp;<span class="op" id="7696901">[</span><span class="op" id="7696902">]</span><span class="builtintype" id="7696903">byte</span><span class="op" id="7696907">{</span><span class="num" id="7696908">0</span><span class="op" id="7696909">,</span>&nbsp;<span class="num" id="7696911">1</span><span class="op" id="7696912">,</span>&nbsp;<span class="num" id="7696914">2</span><span class="op" id="7696915">,</span>&nbsp;<span class="num" id="7696917">3</span><span class="op" id="7696918">,</span>&nbsp;<span class="num" id="7696920">255</span><span class="op" id="7696923">}</span>&nbsp;<span class="op" id="7696925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696929">b</span>&nbsp;<span class="op" id="7696931">:=</span>&nbsp;<span class="op" id="7696934">&amp;</span><span class="ident" id="7696935">bytes</span><span class="op" id="7696940">.</span><span class="ident" id="7696941">Buffer</span><span class="op" id="7696947">{</span><span class="op" id="7696948">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7696953">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;a&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697000">b</span><span class="op" id="7697001">.</span><span class="ident" id="7697002">WriteString</span><span class="op" id="7697013">(</span><span class="ident" id="7697014">headerStr</span><span class="op" id="7697023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697027">b</span><span class="op" id="7697028">.</span><span class="ident" id="7697029">WriteString</span><span class="op" id="7697040">(</span><span class="ident" id="7697041">paletteStr</span><span class="op" id="7697051">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7697056">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697102">b</span><span class="op" id="7697103">.</span><span class="ident" id="7697104">WriteString</span><span class="op" id="7697115">(</span><span class="string" id="7697116">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7697162">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7697167">//&nbsp;Encode&nbsp;the&nbsp;pixels;&nbsp;some&nbsp;pvals&nbsp;trigger&nbsp;the&nbsp;expected&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697230">pix</span>&nbsp;<span class="op" id="7697234">:=</span>&nbsp;<span class="op" id="7697237">[</span><span class="op" id="7697238">]</span><span class="builtintype" id="7697239">byte</span><span class="op" id="7697243">{</span><span class="ident" id="7697244">pval</span><span class="op" id="7697248">,</span>&nbsp;<span class="ident" id="7697250">pval</span><span class="op" id="7697254">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697258">enc</span>&nbsp;<span class="op" id="7697262">:=</span>&nbsp;<span class="op" id="7697265">&amp;</span><span class="ident" id="7697266">bytes</span><span class="op" id="7697271">.</span><span class="ident" id="7697272">Buffer</span><span class="op" id="7697278">{</span><span class="op" id="7697279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697283">w</span>&nbsp;<span class="op" id="7697285">:=</span>&nbsp;<span class="ident" id="7697288">lzw</span><span class="op" id="7697291">.</span><span class="ident" id="7697292">NewWriter</span><span class="op" id="7697301">(</span><span class="ident" id="7697302">enc</span><span class="op" id="7697305">,</span>&nbsp;<span class="ident" id="7697307">lzw</span><span class="op" id="7697310">.</span><span class="ident" id="7697311">LSB</span><span class="op" id="7697314">,</span>&nbsp;<span class="num" id="7697316">2</span><span class="op" id="7697317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697321">w</span><span class="op" id="7697322">.</span><span class="ident" id="7697323">Write</span><span class="op" id="7697328">(</span><span class="ident" id="7697329">pix</span><span class="op" id="7697332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697336">w</span><span class="op" id="7697337">.</span><span class="ident" id="7697338">Close</span><span class="op" id="7697343">(</span><span class="op" id="7697344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697348">b</span><span class="op" id="7697349">.</span><span class="ident" id="7697350">WriteByte</span><span class="op" id="7697359">(</span><span class="builtintype" id="7697360">byte</span><span class="op" id="7697364">(</span><span class="builtinfunc" id="7697365">len</span><span class="op" id="7697368">(</span><span class="ident" id="7697369">enc</span><span class="op" id="7697372">.</span><span class="ident" id="7697373">Bytes</span><span class="op" id="7697378">(</span><span class="op" id="7697379">)</span><span class="op" id="7697380">)</span><span class="op" id="7697381">)</span><span class="op" id="7697382">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697386">b</span><span class="op" id="7697387">.</span><span class="ident" id="7697388">Write</span><span class="op" id="7697393">(</span><span class="ident" id="7697394">enc</span><span class="op" id="7697397">.</span><span class="ident" id="7697398">Bytes</span><span class="op" id="7697403">(</span><span class="op" id="7697404">)</span><span class="op" id="7697405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697409">b</span><span class="op" id="7697410">.</span><span class="ident" id="7697411">WriteByte</span><span class="op" id="7697420">(</span><span class="num" id="7697421">0x00</span><span class="op" id="7697425">)</span>&nbsp;<span class="comment" id="7697427">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697485">b</span><span class="op" id="7697486">.</span><span class="ident" id="7697487">WriteString</span><span class="op" id="7697498">(</span><span class="ident" id="7697499">trailerStr</span><span class="op" id="7697509">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7697514">//&nbsp;No&nbsp;error&nbsp;expected,&nbsp;unless&nbsp;the&nbsp;pixels&nbsp;are&nbsp;beyond&nbsp;the&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697588">want</span>&nbsp;<span class="op" id="7697593">:=</span>&nbsp;<span class="string" id="7697596">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697601">if</span>&nbsp;<span class="ident" id="7697604">pval</span>&nbsp;<span class="op" id="7697609">&gt;=</span>&nbsp;<span class="num" id="7697612">2</span>&nbsp;<span class="op" id="7697614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697619">want</span>&nbsp;<span class="op" id="7697624">=</span>&nbsp;<span class="string" id="7697626">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697655">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697659">try</span><span class="op" id="7697662">(</span><span class="ident" id="7697663">t</span><span class="op" id="7697664">,</span>&nbsp;<span class="ident" id="7697666">b</span><span class="op" id="7697667">.</span><span class="ident" id="7697668">Bytes</span><span class="op" id="7697673">(</span><span class="op" id="7697674">)</span><span class="op" id="7697675">,</span>&nbsp;<span class="ident" id="7697677">want</span><span class="op" id="7697681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697684">}</span><br>
<span class="lineno"></span><span class="op" id="7697686">}</span>
</div>
</body>
</html>
