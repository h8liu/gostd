<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html" class="current">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4241274">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4241329">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4241383">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4241434">package</span>&nbsp;<span class="ident" id="4241442">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4241449">import</span>&nbsp;<span class="op" id="4241456">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4241459">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4241467">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4241474">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4241477">type</span>&nbsp;<span class="ident" id="4241482">huffmanEncoder</span>&nbsp;<span class="keyword" id="4241497">struct</span>&nbsp;<span class="op" id="4241504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241507">codeBits</span>&nbsp;<span class="op" id="4241516">[</span><span class="op" id="4241517">]</span><span class="builtintype" id="4241518">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241525">code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4241534">[</span><span class="op" id="4241535">]</span><span class="builtintype" id="4241536">uint16</span><br>
<span class="lineno">15</span><span class="op" id="4241543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4241546">type</span>&nbsp;<span class="ident" id="4241551">literalNode</span>&nbsp;<span class="keyword" id="4241563">struct</span>&nbsp;<span class="op" id="4241570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241573">literal</span>&nbsp;<span class="builtintype" id="4241581">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241589">freq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4241597">int32</span><br>
<span class="lineno">20</span><span class="op" id="4241603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4241606">//&nbsp;A&nbsp;levelInfo&nbsp;describes&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;constructed&nbsp;tree&nbsp;for&nbsp;a&nbsp;given&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="4241684">type</span>&nbsp;<span class="ident" id="4241689">levelInfo</span>&nbsp;<span class="keyword" id="4241699">struct</span>&nbsp;<span class="op" id="4241706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4241709">//&nbsp;Our&nbsp;level.&nbsp;&nbsp;for&nbsp;better&nbsp;printing</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241745">level</span>&nbsp;<span class="builtintype" id="4241751">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4241759">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;last&nbsp;node&nbsp;at&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241808">lastFreq</span>&nbsp;<span class="builtintype" id="4241817">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4241825">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;character&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4241886">nextCharFreq</span>&nbsp;<span class="builtintype" id="4241899">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4241907">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;pair&nbsp;(from&nbsp;level&nbsp;below)&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4241983">//&nbsp;Only&nbsp;valid&nbsp;if&nbsp;the&nbsp;&#34;needed&#34;&nbsp;value&nbsp;of&nbsp;the&nbsp;next&nbsp;lower&nbsp;level&nbsp;is&nbsp;0.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242050">nextPairFreq</span>&nbsp;<span class="builtintype" id="4242063">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4242071">//&nbsp;The&nbsp;number&nbsp;of&nbsp;chains&nbsp;remaining&nbsp;to&nbsp;generate&nbsp;for&nbsp;this&nbsp;level&nbsp;before&nbsp;moving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4242147">//&nbsp;up&nbsp;to&nbsp;the&nbsp;next&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242172">needed</span>&nbsp;<span class="builtintype" id="4242179">int32</span><br>
<span class="lineno">40</span><span class="op" id="4242185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4242188">func</span>&nbsp;<span class="ident" id="4242193">maxNode</span><span class="op" id="4242200">(</span><span class="op" id="4242201">)</span>&nbsp;<span class="ident" id="4242203">literalNode</span>&nbsp;<span class="op" id="4242215">{</span>&nbsp;<span class="keyword" id="4242217">return</span>&nbsp;<span class="ident" id="4242224">literalNode</span><span class="op" id="4242235">{</span><span class="ident" id="4242236">math</span><span class="op" id="4242240">.</span><span class="ident" id="4242241">MaxUint16</span><span class="op" id="4242250">,</span>&nbsp;<span class="ident" id="4242252">math</span><span class="op" id="4242256">.</span><span class="ident" id="4242257">MaxInt32</span><span class="op" id="4242265">}</span>&nbsp;<span class="op" id="4242267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4242270">func</span>&nbsp;<span class="ident" id="4242275">newHuffmanEncoder</span><span class="op" id="4242292">(</span><span class="ident" id="4242293">size</span>&nbsp;<span class="builtintype" id="4242298">int</span><span class="op" id="4242301">)</span>&nbsp;<span class="op" id="4242303">*</span><span class="ident" id="4242304">huffmanEncoder</span>&nbsp;<span class="op" id="4242319">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242322">return</span>&nbsp;<span class="op" id="4242329">&amp;</span><span class="ident" id="4242330">huffmanEncoder</span><span class="op" id="4242344">{</span><span class="builtinfunc" id="4242345">make</span><span class="op" id="4242349">(</span><span class="op" id="4242350">[</span><span class="op" id="4242351">]</span><span class="builtintype" id="4242352">uint8</span><span class="op" id="4242357">,</span>&nbsp;<span class="ident" id="4242359">size</span><span class="op" id="4242363">)</span><span class="op" id="4242364">,</span>&nbsp;<span class="builtinfunc" id="4242366">make</span><span class="op" id="4242370">(</span><span class="op" id="4242371">[</span><span class="op" id="4242372">]</span><span class="builtintype" id="4242373">uint16</span><span class="op" id="4242379">,</span>&nbsp;<span class="ident" id="4242381">size</span><span class="op" id="4242385">)</span><span class="op" id="4242386">}</span><br>
<span class="lineno"></span><span class="op" id="4242388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4242391">//&nbsp;Generates&nbsp;a&nbsp;HuffmanCode&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;fixed&nbsp;literal&nbsp;table</span><br>
<span class="lineno"></span><span class="keyword" id="4242459">func</span>&nbsp;<span class="ident" id="4242464">generateFixedLiteralEncoding</span><span class="op" id="4242492">(</span><span class="op" id="4242493">)</span>&nbsp;<span class="op" id="4242495">*</span><span class="ident" id="4242496">huffmanEncoder</span>&nbsp;<span class="op" id="4242511">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242514">h</span>&nbsp;<span class="op" id="4242516">:=</span>&nbsp;<span class="ident" id="4242519">newHuffmanEncoder</span><span class="op" id="4242536">(</span><span class="ident" id="4242537">maxLit</span><span class="op" id="4242543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242546">codeBits</span>&nbsp;<span class="op" id="4242555">:=</span>&nbsp;<span class="ident" id="4242558">h</span><span class="op" id="4242559">.</span><span class="ident" id="4242560">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242570">code</span>&nbsp;<span class="op" id="4242575">:=</span>&nbsp;<span class="ident" id="4242578">h</span><span class="op" id="4242579">.</span><span class="ident" id="4242580">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242586">var</span>&nbsp;<span class="ident" id="4242590">ch</span>&nbsp;<span class="builtintype" id="4242593">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242601">for</span>&nbsp;<span class="ident" id="4242605">ch</span>&nbsp;<span class="op" id="4242608">=</span>&nbsp;<span class="num" id="4242610">0</span><span class="op" id="4242611">;</span>&nbsp;<span class="ident" id="4242613">ch</span>&nbsp;<span class="op" id="4242616">&lt;</span>&nbsp;<span class="ident" id="4242618">maxLit</span><span class="op" id="4242624">;</span>&nbsp;<span class="ident" id="4242626">ch</span><span class="op" id="4242628">++</span>&nbsp;<span class="op" id="4242631">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242635">var</span>&nbsp;<span class="ident" id="4242639">bits</span>&nbsp;<span class="builtintype" id="4242644">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242653">var</span>&nbsp;<span class="ident" id="4242657">size</span>&nbsp;<span class="builtintype" id="4242662">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242670">switch</span>&nbsp;<span class="op" id="4242677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242681">case</span>&nbsp;<span class="ident" id="4242686">ch</span>&nbsp;<span class="op" id="4242689">&lt;</span>&nbsp;<span class="num" id="4242691">144</span><span class="op" id="4242694">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4242699">//&nbsp;size&nbsp;8,&nbsp;000110000&nbsp;&nbsp;..&nbsp;10111111</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242736">bits</span>&nbsp;<span class="op" id="4242741">=</span>&nbsp;<span class="ident" id="4242743">ch</span>&nbsp;<span class="op" id="4242746">+</span>&nbsp;<span class="num" id="4242748">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242754">size</span>&nbsp;<span class="op" id="4242759">=</span>&nbsp;<span class="num" id="4242761">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242766">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242774">case</span>&nbsp;<span class="ident" id="4242779">ch</span>&nbsp;<span class="op" id="4242782">&lt;</span>&nbsp;<span class="num" id="4242784">256</span><span class="op" id="4242787">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4242792">//&nbsp;size&nbsp;9,&nbsp;110010000&nbsp;..&nbsp;111111111</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242829">bits</span>&nbsp;<span class="op" id="4242834">=</span>&nbsp;<span class="ident" id="4242836">ch</span>&nbsp;<span class="op" id="4242839">+</span>&nbsp;<span class="num" id="4242841">400</span>&nbsp;<span class="op" id="4242845">-</span>&nbsp;<span class="num" id="4242847">144</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242854">size</span>&nbsp;<span class="op" id="4242859">=</span>&nbsp;<span class="num" id="4242861">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242866">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242874">case</span>&nbsp;<span class="ident" id="4242879">ch</span>&nbsp;<span class="op" id="4242882">&lt;</span>&nbsp;<span class="num" id="4242884">280</span><span class="op" id="4242887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4242892">//&nbsp;size&nbsp;7,&nbsp;0000000&nbsp;..&nbsp;0010111</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242925">bits</span>&nbsp;<span class="op" id="4242930">=</span>&nbsp;<span class="ident" id="4242932">ch</span>&nbsp;<span class="op" id="4242935">-</span>&nbsp;<span class="num" id="4242937">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4242944">size</span>&nbsp;<span class="op" id="4242949">=</span>&nbsp;<span class="num" id="4242951">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242956">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4242964">default</span><span class="op" id="4242971">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4242976">//&nbsp;size&nbsp;8,&nbsp;11000000&nbsp;..&nbsp;11000111</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243011">bits</span>&nbsp;<span class="op" id="4243016">=</span>&nbsp;<span class="ident" id="4243018">ch</span>&nbsp;<span class="op" id="4243021">+</span>&nbsp;<span class="num" id="4243023">192</span>&nbsp;<span class="op" id="4243027">-</span>&nbsp;<span class="num" id="4243029">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243036">size</span>&nbsp;<span class="op" id="4243041">=</span>&nbsp;<span class="num" id="4243043">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4243047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243051">codeBits</span><span class="op" id="4243059">[</span><span class="ident" id="4243060">ch</span><span class="op" id="4243062">]</span>&nbsp;<span class="op" id="4243064">=</span>&nbsp;<span class="ident" id="4243066">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243073">code</span><span class="op" id="4243077">[</span><span class="ident" id="4243078">ch</span><span class="op" id="4243080">]</span>&nbsp;<span class="op" id="4243082">=</span>&nbsp;<span class="ident" id="4243084">reverseBits</span><span class="op" id="4243095">(</span><span class="ident" id="4243096">bits</span><span class="op" id="4243100">,</span>&nbsp;<span class="ident" id="4243102">size</span><span class="op" id="4243106">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4243109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4243112">return</span>&nbsp;<span class="ident" id="4243119">h</span><br>
<span class="lineno"></span><span class="op" id="4243121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4243124">func</span>&nbsp;<span class="ident" id="4243129">generateFixedOffsetEncoding</span><span class="op" id="4243156">(</span><span class="op" id="4243157">)</span>&nbsp;<span class="op" id="4243159">*</span><span class="ident" id="4243160">huffmanEncoder</span>&nbsp;<span class="op" id="4243175">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243178">h</span>&nbsp;<span class="op" id="4243180">:=</span>&nbsp;<span class="ident" id="4243183">newHuffmanEncoder</span><span class="op" id="4243200">(</span><span class="num" id="4243201">30</span><span class="op" id="4243203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243206">codeBits</span>&nbsp;<span class="op" id="4243215">:=</span>&nbsp;<span class="ident" id="4243218">h</span><span class="op" id="4243219">.</span><span class="ident" id="4243220">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243230">code</span>&nbsp;<span class="op" id="4243235">:=</span>&nbsp;<span class="ident" id="4243238">h</span><span class="op" id="4243239">.</span><span class="ident" id="4243240">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4243246">for</span>&nbsp;<span class="ident" id="4243250">ch</span>&nbsp;<span class="op" id="4243253">:=</span>&nbsp;<span class="builtintype" id="4243256">uint16</span><span class="op" id="4243262">(</span><span class="num" id="4243263">0</span><span class="op" id="4243264">)</span><span class="op" id="4243265">;</span>&nbsp;<span class="ident" id="4243267">ch</span>&nbsp;<span class="op" id="4243270">&lt;</span>&nbsp;<span class="num" id="4243272">30</span><span class="op" id="4243274">;</span>&nbsp;<span class="ident" id="4243276">ch</span><span class="op" id="4243278">++</span>&nbsp;<span class="op" id="4243281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243285">codeBits</span><span class="op" id="4243293">[</span><span class="ident" id="4243294">ch</span><span class="op" id="4243296">]</span>&nbsp;<span class="op" id="4243298">=</span>&nbsp;<span class="num" id="4243300">5</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243304">code</span><span class="op" id="4243308">[</span><span class="ident" id="4243309">ch</span><span class="op" id="4243311">]</span>&nbsp;<span class="op" id="4243313">=</span>&nbsp;<span class="ident" id="4243315">reverseBits</span><span class="op" id="4243326">(</span><span class="ident" id="4243327">ch</span><span class="op" id="4243329">,</span>&nbsp;<span class="num" id="4243331">5</span><span class="op" id="4243332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4243335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4243338">return</span>&nbsp;<span class="ident" id="4243345">h</span><br>
<span class="lineno"></span><span class="op" id="4243347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4243350">var</span>&nbsp;<span class="ident" id="4243354">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4243375">*</span><span class="ident" id="4243376">huffmanEncoder</span>&nbsp;<span class="op" id="4243391">=</span>&nbsp;<span class="ident" id="4243393">generateFixedLiteralEncoding</span><span class="op" id="4243421">(</span><span class="op" id="4243422">)</span><br>
<span class="lineno"></span><span class="keyword" id="4243424">var</span>&nbsp;<span class="ident" id="4243428">fixedOffsetEncoding</span>&nbsp;<span class="op" id="4243448">*</span><span class="ident" id="4243449">huffmanEncoder</span>&nbsp;<span class="op" id="4243464">=</span>&nbsp;<span class="ident" id="4243466">generateFixedOffsetEncoding</span><span class="op" id="4243493">(</span><span class="op" id="4243494">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4243497">func</span>&nbsp;<span class="op" id="4243502">(</span><span class="ident" id="4243503">h</span>&nbsp;<span class="op" id="4243505">*</span><span class="ident" id="4243506">huffmanEncoder</span><span class="op" id="4243520">)</span>&nbsp;<span class="ident" id="4243522">bitLength</span><span class="op" id="4243531">(</span><span class="ident" id="4243532">freq</span>&nbsp;<span class="op" id="4243537">[</span><span class="op" id="4243538">]</span><span class="builtintype" id="4243539">int32</span><span class="op" id="4243544">)</span>&nbsp;<span class="ident" id="4243546">int64</span>&nbsp;<span class="op" id="4243552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4243555">var</span>&nbsp;<span class="ident" id="4243559">total</span>&nbsp;<span class="ident" id="4243565">int64</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4243572">for</span>&nbsp;<span class="ident" id="4243576">i</span><span class="op" id="4243577">,</span>&nbsp;<span class="ident" id="4243579">f</span>&nbsp;<span class="op" id="4243581">:=</span>&nbsp;<span class="keyword" id="4243584">range</span>&nbsp;<span class="ident" id="4243590">freq</span>&nbsp;<span class="op" id="4243595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4243599">if</span>&nbsp;<span class="ident" id="4243602">f</span>&nbsp;<span class="op" id="4243604">!=</span>&nbsp;<span class="num" id="4243607">0</span>&nbsp;<span class="op" id="4243609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4243614">total</span>&nbsp;<span class="op" id="4243620">+=</span>&nbsp;<span class="ident" id="4243623">int64</span><span class="op" id="4243628">(</span><span class="ident" id="4243629">f</span><span class="op" id="4243630">)</span>&nbsp;<span class="op" id="4243632">*</span>&nbsp;<span class="ident" id="4243634">int64</span><span class="op" id="4243639">(</span><span class="ident" id="4243640">h</span><span class="op" id="4243641">.</span><span class="ident" id="4243642">codeBits</span><span class="op" id="4243650">[</span><span class="ident" id="4243651">i</span><span class="op" id="4243652">]</span><span class="op" id="4243653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4243657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4243660">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4243663">return</span>&nbsp;<span class="ident" id="4243670">total</span><br>
<span class="lineno"></span><span class="op" id="4243676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4243679">const</span>&nbsp;<span class="ident" id="4243685">maxBitsLimit</span>&nbsp;<span class="op" id="4243698">=</span>&nbsp;<span class="num" id="4243700">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="4243704">//&nbsp;Return&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;assigned&nbsp;to&nbsp;each&nbsp;bit&nbsp;size&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="4243787">//</span><br>
<span class="lineno"></span><span class="comment" id="4243790">//&nbsp;This&nbsp;method&nbsp;is&nbsp;only&nbsp;called&nbsp;when&nbsp;list.length&nbsp;&gt;=&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="4243842">//&nbsp;The&nbsp;cases&nbsp;of&nbsp;0,&nbsp;1,&nbsp;and&nbsp;2&nbsp;literals&nbsp;are&nbsp;handled&nbsp;by&nbsp;special&nbsp;case&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4243913">//</span><br>
<span class="lineno">115</span><span class="comment" id="4243916">//&nbsp;list&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;the&nbsp;literals&nbsp;with&nbsp;non-zero&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4243976">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;their&nbsp;associated&nbsp;frequencies.&nbsp;&nbsp;The&nbsp;array&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing</span><br>
<span class="lineno"></span><span class="comment" id="4244062">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frequency,&nbsp;and&nbsp;has&nbsp;as&nbsp;its&nbsp;last&nbsp;element&nbsp;a&nbsp;special&nbsp;element&nbsp;with&nbsp;frequency</span><br>
<span class="lineno"></span><span class="comment" id="4244149">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MaxInt32</span><br>
<span class="lineno"></span><span class="comment" id="4244173">//&nbsp;maxBits&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;that&nbsp;should&nbsp;be&nbsp;used&nbsp;to&nbsp;encode&nbsp;any&nbsp;literal.</span><br>
<span class="lineno">120</span><span class="comment" id="4244258">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Must&nbsp;be&nbsp;less&nbsp;than&nbsp;16.</span><br>
<span class="lineno"></span><span class="comment" id="4244295">//&nbsp;return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An&nbsp;integer&nbsp;array&nbsp;in&nbsp;which&nbsp;array[i]&nbsp;indicates&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span><span class="comment" id="4244378">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;should&nbsp;be&nbsp;encoded&nbsp;in&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4244427">func</span>&nbsp;<span class="op" id="4244432">(</span><span class="ident" id="4244433">h</span>&nbsp;<span class="op" id="4244435">*</span><span class="ident" id="4244436">huffmanEncoder</span><span class="op" id="4244450">)</span>&nbsp;<span class="ident" id="4244452">bitCounts</span><span class="op" id="4244461">(</span><span class="ident" id="4244462">list</span>&nbsp;<span class="op" id="4244467">[</span><span class="op" id="4244468">]</span><span class="ident" id="4244469">literalNode</span><span class="op" id="4244480">,</span>&nbsp;<span class="ident" id="4244482">maxBits</span>&nbsp;<span class="builtintype" id="4244490">int32</span><span class="op" id="4244495">)</span>&nbsp;<span class="op" id="4244497">[</span><span class="op" id="4244498">]</span><span class="builtintype" id="4244499">int32</span>&nbsp;<span class="op" id="4244505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244508">if</span>&nbsp;<span class="ident" id="4244511">maxBits</span>&nbsp;<span class="op" id="4244519">&gt;=</span>&nbsp;<span class="ident" id="4244522">maxBitsLimit</span>&nbsp;<span class="op" id="4244535">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4244539">panic</span><span class="op" id="4244544">(</span><span class="string" id="4244545">&#34;flate:&nbsp;maxBits&nbsp;too&nbsp;large&#34;</span><span class="op" id="4244571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4244574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4244577">n</span>&nbsp;<span class="op" id="4244579">:=</span>&nbsp;<span class="builtintype" id="4244582">int32</span><span class="op" id="4244587">(</span><span class="builtinfunc" id="4244588">len</span><span class="op" id="4244591">(</span><span class="ident" id="4244592">list</span><span class="op" id="4244596">)</span><span class="op" id="4244597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4244600">list</span>&nbsp;<span class="op" id="4244605">=</span>&nbsp;<span class="ident" id="4244607">list</span><span class="op" id="4244611">[</span><span class="num" id="4244612">0</span>&nbsp;<span class="op" id="4244614">:</span>&nbsp;<span class="ident" id="4244616">n</span><span class="op" id="4244617">+</span><span class="num" id="4244618">1</span><span class="op" id="4244619">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4244622">list</span><span class="op" id="4244626">[</span><span class="ident" id="4244627">n</span><span class="op" id="4244628">]</span>&nbsp;<span class="op" id="4244630">=</span>&nbsp;<span class="ident" id="4244632">maxNode</span><span class="op" id="4244639">(</span><span class="op" id="4244640">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4244644">//&nbsp;The&nbsp;tree&nbsp;can&#39;t&nbsp;have&nbsp;greater&nbsp;depth&nbsp;than&nbsp;n&nbsp;-&nbsp;1,&nbsp;no&nbsp;matter&nbsp;what.&nbsp;&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4244716">//&nbsp;saves&nbsp;a&nbsp;little&nbsp;bit&nbsp;of&nbsp;work&nbsp;in&nbsp;some&nbsp;small&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4244767">if</span>&nbsp;<span class="ident" id="4244770">maxBits</span>&nbsp;<span class="op" id="4244778">&gt;</span>&nbsp;<span class="ident" id="4244780">n</span><span class="op" id="4244781">-</span><span class="num" id="4244782">1</span>&nbsp;<span class="op" id="4244784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4244788">maxBits</span>&nbsp;<span class="op" id="4244796">=</span>&nbsp;<span class="ident" id="4244798">n</span>&nbsp;<span class="op" id="4244800">-</span>&nbsp;<span class="num" id="4244802">1</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4244805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4244809">//&nbsp;Create&nbsp;information&nbsp;about&nbsp;each&nbsp;of&nbsp;the&nbsp;levels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4244858">//&nbsp;A&nbsp;bogus&nbsp;&#34;Level&nbsp;0&#34;&nbsp;whose&nbsp;sole&nbsp;purpose&nbsp;is&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4244910">//&nbsp;level1.prev.needed==0.&nbsp;&nbsp;This&nbsp;makes&nbsp;level1.nextPairFreq</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4244969">//&nbsp;be&nbsp;a&nbsp;legitimate&nbsp;value&nbsp;that&nbsp;never&nbsp;gets&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245019">var</span>&nbsp;<span class="ident" id="4245023">levels</span>&nbsp;<span class="op" id="4245030">[</span><span class="ident" id="4245031">maxBitsLimit</span><span class="op" id="4245043">]</span><span class="ident" id="4245044">levelInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4245055">//&nbsp;leafCounts[i]&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4245115">//&nbsp;of&nbsp;ancestors&nbsp;of&nbsp;the&nbsp;rightmost&nbsp;node&nbsp;at&nbsp;level&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4245166">//&nbsp;leafCounts[i][j]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4245225">//&nbsp;of&nbsp;the&nbsp;level&nbsp;j&nbsp;ancestor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245254">var</span>&nbsp;<span class="ident" id="4245258">leafCounts</span>&nbsp;<span class="op" id="4245269">[</span><span class="ident" id="4245270">maxBitsLimit</span><span class="op" id="4245282">]</span><span class="op" id="4245283">[</span><span class="ident" id="4245284">maxBitsLimit</span><span class="op" id="4245296">]</span><span class="builtintype" id="4245297">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245305">for</span>&nbsp;<span class="ident" id="4245309">level</span>&nbsp;<span class="op" id="4245315">:=</span>&nbsp;<span class="builtintype" id="4245318">int32</span><span class="op" id="4245323">(</span><span class="num" id="4245324">1</span><span class="op" id="4245325">)</span><span class="op" id="4245326">;</span>&nbsp;<span class="ident" id="4245328">level</span>&nbsp;<span class="op" id="4245334">&lt;=</span>&nbsp;<span class="ident" id="4245337">maxBits</span><span class="op" id="4245344">;</span>&nbsp;<span class="ident" id="4245346">level</span><span class="op" id="4245351">++</span>&nbsp;<span class="op" id="4245354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4245358">//&nbsp;For&nbsp;every&nbsp;level,&nbsp;the&nbsp;first&nbsp;two&nbsp;items&nbsp;are&nbsp;the&nbsp;first&nbsp;two&nbsp;characters.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4245430">//&nbsp;We&nbsp;initialize&nbsp;the&nbsp;levels&nbsp;as&nbsp;if&nbsp;we&nbsp;had&nbsp;already&nbsp;figured&nbsp;this&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245499">levels</span><span class="op" id="4245505">[</span><span class="ident" id="4245506">level</span><span class="op" id="4245511">]</span>&nbsp;<span class="op" id="4245513">=</span>&nbsp;<span class="ident" id="4245515">levelInfo</span><span class="op" id="4245524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245529">level</span><span class="op" id="4245534">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245543">level</span><span class="op" id="4245548">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245553">lastFreq</span><span class="op" id="4245561">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245567">list</span><span class="op" id="4245571">[</span><span class="num" id="4245572">1</span><span class="op" id="4245573">]</span><span class="op" id="4245574">.</span><span class="ident" id="4245575">freq</span><span class="op" id="4245579">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245584">nextCharFreq</span><span class="op" id="4245596">:</span>&nbsp;<span class="ident" id="4245598">list</span><span class="op" id="4245602">[</span><span class="num" id="4245603">2</span><span class="op" id="4245604">]</span><span class="op" id="4245605">.</span><span class="ident" id="4245606">freq</span><span class="op" id="4245610">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245615">nextPairFreq</span><span class="op" id="4245627">:</span>&nbsp;<span class="ident" id="4245629">list</span><span class="op" id="4245633">[</span><span class="num" id="4245634">0</span><span class="op" id="4245635">]</span><span class="op" id="4245636">.</span><span class="ident" id="4245637">freq</span>&nbsp;<span class="op" id="4245642">+</span>&nbsp;<span class="ident" id="4245644">list</span><span class="op" id="4245648">[</span><span class="num" id="4245649">1</span><span class="op" id="4245650">]</span><span class="op" id="4245651">.</span><span class="ident" id="4245652">freq</span><span class="op" id="4245656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4245660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245664">leafCounts</span><span class="op" id="4245674">[</span><span class="ident" id="4245675">level</span><span class="op" id="4245680">]</span><span class="op" id="4245681">[</span><span class="ident" id="4245682">level</span><span class="op" id="4245687">]</span>&nbsp;<span class="op" id="4245689">=</span>&nbsp;<span class="num" id="4245691">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245695">if</span>&nbsp;<span class="ident" id="4245698">level</span>&nbsp;<span class="op" id="4245704">==</span>&nbsp;<span class="num" id="4245707">1</span>&nbsp;<span class="op" id="4245709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245714">levels</span><span class="op" id="4245720">[</span><span class="ident" id="4245721">level</span><span class="op" id="4245726">]</span><span class="op" id="4245727">.</span><span class="ident" id="4245728">nextPairFreq</span>&nbsp;<span class="op" id="4245741">=</span>&nbsp;<span class="ident" id="4245743">math</span><span class="op" id="4245747">.</span><span class="ident" id="4245748">MaxInt32</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4245759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4245762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4245766">//&nbsp;We&nbsp;need&nbsp;a&nbsp;total&nbsp;of&nbsp;2*n&nbsp;-&nbsp;2&nbsp;items&nbsp;at&nbsp;top&nbsp;level&nbsp;and&nbsp;have&nbsp;already&nbsp;generated&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245846">levels</span><span class="op" id="4245852">[</span><span class="ident" id="4245853">maxBits</span><span class="op" id="4245860">]</span><span class="op" id="4245861">.</span><span class="ident" id="4245862">needed</span>&nbsp;<span class="op" id="4245869">=</span>&nbsp;<span class="num" id="4245871">2</span><span class="op" id="4245872">*</span><span class="ident" id="4245873">n</span>&nbsp;<span class="op" id="4245875">-</span>&nbsp;<span class="num" id="4245877">4</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245881">level</span>&nbsp;<span class="op" id="4245887">:=</span>&nbsp;<span class="ident" id="4245890">maxBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245899">for</span>&nbsp;<span class="op" id="4245903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4245907">l</span>&nbsp;<span class="op" id="4245909">:=</span>&nbsp;<span class="op" id="4245912">&amp;</span><span class="ident" id="4245913">levels</span><span class="op" id="4245919">[</span><span class="ident" id="4245920">level</span><span class="op" id="4245925">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4245929">if</span>&nbsp;<span class="ident" id="4245932">l</span><span class="op" id="4245933">.</span><span class="ident" id="4245934">nextPairFreq</span>&nbsp;<span class="op" id="4245947">==</span>&nbsp;<span class="ident" id="4245950">math</span><span class="op" id="4245954">.</span><span class="ident" id="4245955">MaxInt32</span>&nbsp;<span class="op" id="4245964">&amp;&amp;</span>&nbsp;<span class="ident" id="4245967">l</span><span class="op" id="4245968">.</span><span class="ident" id="4245969">nextCharFreq</span>&nbsp;<span class="op" id="4245982">==</span>&nbsp;<span class="ident" id="4245985">math</span><span class="op" id="4245989">.</span><span class="ident" id="4245990">MaxInt32</span>&nbsp;<span class="op" id="4245999">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4246004">//&nbsp;We&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;both&nbsp;leafs&nbsp;and&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4246049">//&nbsp;End&nbsp;all&nbsp;calculations&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4246092">//&nbsp;To&nbsp;make&nbsp;sure&nbsp;we&nbsp;never&nbsp;come&nbsp;back&nbsp;to&nbsp;this&nbsp;level&nbsp;or&nbsp;any&nbsp;lower&nbsp;level,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4246164">//&nbsp;set&nbsp;nextPairFreq&nbsp;impossibly&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246205">l</span><span class="op" id="4246206">.</span><span class="ident" id="4246207">needed</span>&nbsp;<span class="op" id="4246214">=</span>&nbsp;<span class="num" id="4246216">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246221">levels</span><span class="op" id="4246227">[</span><span class="ident" id="4246228">level</span><span class="op" id="4246233">+</span><span class="num" id="4246234">1</span><span class="op" id="4246235">]</span><span class="op" id="4246236">.</span><span class="ident" id="4246237">nextPairFreq</span>&nbsp;<span class="op" id="4246250">=</span>&nbsp;<span class="ident" id="4246252">math</span><span class="op" id="4246256">.</span><span class="ident" id="4246257">MaxInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246269">level</span><span class="op" id="4246274">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4246280">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4246291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246296">prevFreq</span>&nbsp;<span class="op" id="4246305">:=</span>&nbsp;<span class="ident" id="4246308">l</span><span class="op" id="4246309">.</span><span class="ident" id="4246310">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4246321">if</span>&nbsp;<span class="ident" id="4246324">l</span><span class="op" id="4246325">.</span><span class="ident" id="4246326">nextCharFreq</span>&nbsp;<span class="op" id="4246339">&lt;</span>&nbsp;<span class="ident" id="4246341">l</span><span class="op" id="4246342">.</span><span class="ident" id="4246343">nextPairFreq</span>&nbsp;<span class="op" id="4246356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4246361">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;leaf&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246409">n</span>&nbsp;<span class="op" id="4246411">:=</span>&nbsp;<span class="ident" id="4246414">leafCounts</span><span class="op" id="4246424">[</span><span class="ident" id="4246425">level</span><span class="op" id="4246430">]</span><span class="op" id="4246431">[</span><span class="ident" id="4246432">level</span><span class="op" id="4246437">]</span>&nbsp;<span class="op" id="4246439">+</span>&nbsp;<span class="num" id="4246441">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246446">l</span><span class="op" id="4246447">.</span><span class="ident" id="4246448">lastFreq</span>&nbsp;<span class="op" id="4246457">=</span>&nbsp;<span class="ident" id="4246459">l</span><span class="op" id="4246460">.</span><span class="ident" id="4246461">nextCharFreq</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4246477">//&nbsp;Lower&nbsp;leafCounts&nbsp;are&nbsp;the&nbsp;same&nbsp;of&nbsp;the&nbsp;previous&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246535">leafCounts</span><span class="op" id="4246545">[</span><span class="ident" id="4246546">level</span><span class="op" id="4246551">]</span><span class="op" id="4246552">[</span><span class="ident" id="4246553">level</span><span class="op" id="4246558">]</span>&nbsp;<span class="op" id="4246560">=</span>&nbsp;<span class="ident" id="4246562">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246567">l</span><span class="op" id="4246568">.</span><span class="ident" id="4246569">nextCharFreq</span>&nbsp;<span class="op" id="4246582">=</span>&nbsp;<span class="ident" id="4246584">list</span><span class="op" id="4246588">[</span><span class="ident" id="4246589">n</span><span class="op" id="4246590">]</span><span class="op" id="4246591">.</span><span class="ident" id="4246592">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4246599">}</span>&nbsp;<span class="keyword" id="4246601">else</span>&nbsp;<span class="op" id="4246606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4246611">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;pair&nbsp;from&nbsp;the&nbsp;previous&nbsp;row.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4246676">//&nbsp;nextPairFreq&nbsp;isn&#39;t&nbsp;valid&nbsp;until&nbsp;we&nbsp;generate&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4246729">//&nbsp;more&nbsp;values&nbsp;in&nbsp;the&nbsp;level&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246766">l</span><span class="op" id="4246767">.</span><span class="ident" id="4246768">lastFreq</span>&nbsp;<span class="op" id="4246777">=</span>&nbsp;<span class="ident" id="4246779">l</span><span class="op" id="4246780">.</span><span class="ident" id="4246781">nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4246797">//&nbsp;Take&nbsp;leaf&nbsp;counts&nbsp;from&nbsp;the&nbsp;lower&nbsp;level,&nbsp;except&nbsp;counts[level]&nbsp;remains&nbsp;the&nbsp;same.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4246881">copy</span><span class="op" id="4246885">(</span><span class="ident" id="4246886">leafCounts</span><span class="op" id="4246896">[</span><span class="ident" id="4246897">level</span><span class="op" id="4246902">]</span><span class="op" id="4246903">[</span><span class="op" id="4246904">:</span><span class="ident" id="4246905">level</span><span class="op" id="4246910">]</span><span class="op" id="4246911">,</span>&nbsp;<span class="ident" id="4246913">leafCounts</span><span class="op" id="4246923">[</span><span class="ident" id="4246924">level</span><span class="op" id="4246929">-</span><span class="num" id="4246930">1</span><span class="op" id="4246931">]</span><span class="op" id="4246932">[</span><span class="op" id="4246933">:</span><span class="ident" id="4246934">level</span><span class="op" id="4246939">]</span><span class="op" id="4246940">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4246945">levels</span><span class="op" id="4246951">[</span><span class="ident" id="4246952">l</span><span class="op" id="4246953">.</span><span class="ident" id="4246954">level</span><span class="op" id="4246959">-</span><span class="num" id="4246960">1</span><span class="op" id="4246961">]</span><span class="op" id="4246962">.</span><span class="ident" id="4246963">needed</span>&nbsp;<span class="op" id="4246970">=</span>&nbsp;<span class="num" id="4246972">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4246976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4246981">if</span>&nbsp;<span class="ident" id="4246984">l</span><span class="op" id="4246985">.</span><span class="ident" id="4246986">needed</span><span class="op" id="4246992">--</span><span class="op" id="4246994">;</span>&nbsp;<span class="ident" id="4246996">l</span><span class="op" id="4246997">.</span><span class="ident" id="4246998">needed</span>&nbsp;<span class="op" id="4247005">==</span>&nbsp;<span class="num" id="4247008">0</span>&nbsp;<span class="op" id="4247010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4247015">//&nbsp;We&#39;ve&nbsp;done&nbsp;everything&nbsp;we&nbsp;need&nbsp;to&nbsp;do&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4247073">//&nbsp;Continue&nbsp;calculating&nbsp;one&nbsp;level&nbsp;up.&nbsp;&nbsp;Fill&nbsp;in&nbsp;nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4247136">//&nbsp;of&nbsp;that&nbsp;level&nbsp;with&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;two&nbsp;nodes&nbsp;we&#39;ve&nbsp;just&nbsp;calculated&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4247211">//&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247229">if</span>&nbsp;<span class="ident" id="4247232">l</span><span class="op" id="4247233">.</span><span class="ident" id="4247234">level</span>&nbsp;<span class="op" id="4247240">==</span>&nbsp;<span class="ident" id="4247243">maxBits</span>&nbsp;<span class="op" id="4247251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4247257">//&nbsp;All&nbsp;done!</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247274">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4247283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4247288">levels</span><span class="op" id="4247294">[</span><span class="ident" id="4247295">l</span><span class="op" id="4247296">.</span><span class="ident" id="4247297">level</span><span class="op" id="4247302">+</span><span class="num" id="4247303">1</span><span class="op" id="4247304">]</span><span class="op" id="4247305">.</span><span class="ident" id="4247306">nextPairFreq</span>&nbsp;<span class="op" id="4247319">=</span>&nbsp;<span class="ident" id="4247321">prevFreq</span>&nbsp;<span class="op" id="4247330">+</span>&nbsp;<span class="ident" id="4247332">l</span><span class="op" id="4247333">.</span><span class="ident" id="4247334">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4247346">level</span><span class="op" id="4247351">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4247356">}</span>&nbsp;<span class="keyword" id="4247358">else</span>&nbsp;<span class="op" id="4247363">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4247368">//&nbsp;If&nbsp;we&nbsp;stole&nbsp;from&nbsp;below,&nbsp;move&nbsp;down&nbsp;temporarily&nbsp;to&nbsp;replenish&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247437">for</span>&nbsp;<span class="ident" id="4247441">levels</span><span class="op" id="4247447">[</span><span class="ident" id="4247448">level</span><span class="op" id="4247453">-</span><span class="num" id="4247454">1</span><span class="op" id="4247455">]</span><span class="op" id="4247456">.</span><span class="ident" id="4247457">needed</span>&nbsp;<span class="op" id="4247464">&gt;</span>&nbsp;<span class="num" id="4247466">0</span>&nbsp;<span class="op" id="4247468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4247474">level</span><span class="op" id="4247479">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4247485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4247489">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4247492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4247496">//&nbsp;Somethings&nbsp;is&nbsp;wrong&nbsp;if&nbsp;at&nbsp;the&nbsp;end,&nbsp;the&nbsp;top&nbsp;level&nbsp;is&nbsp;null&nbsp;or&nbsp;hasn&#39;t&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4247572">//&nbsp;all&nbsp;of&nbsp;the&nbsp;leaves.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247595">if</span>&nbsp;<span class="ident" id="4247598">leafCounts</span><span class="op" id="4247608">[</span><span class="ident" id="4247609">maxBits</span><span class="op" id="4247616">]</span><span class="op" id="4247617">[</span><span class="ident" id="4247618">maxBits</span><span class="op" id="4247625">]</span>&nbsp;<span class="op" id="4247627">!=</span>&nbsp;<span class="ident" id="4247630">n</span>&nbsp;<span class="op" id="4247632">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4247636">panic</span><span class="op" id="4247641">(</span><span class="string" id="4247642">&#34;leafCounts[maxBits][maxBits]&nbsp;!=&nbsp;n&#34;</span><span class="op" id="4247677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4247680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4247684">bitCount</span>&nbsp;<span class="op" id="4247693">:=</span>&nbsp;<span class="builtinfunc" id="4247696">make</span><span class="op" id="4247700">(</span><span class="op" id="4247701">[</span><span class="op" id="4247702">]</span><span class="builtintype" id="4247703">int32</span><span class="op" id="4247708">,</span>&nbsp;<span class="ident" id="4247710">maxBits</span><span class="op" id="4247717">+</span><span class="num" id="4247718">1</span><span class="op" id="4247719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4247722">bits</span>&nbsp;<span class="op" id="4247727">:=</span>&nbsp;<span class="num" id="4247730">1</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4247733">counts</span>&nbsp;<span class="op" id="4247740">:=</span>&nbsp;<span class="op" id="4247743">&amp;</span><span class="ident" id="4247744">leafCounts</span><span class="op" id="4247754">[</span><span class="ident" id="4247755">maxBits</span><span class="op" id="4247762">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247765">for</span>&nbsp;<span class="ident" id="4247769">level</span>&nbsp;<span class="op" id="4247775">:=</span>&nbsp;<span class="ident" id="4247778">maxBits</span><span class="op" id="4247785">;</span>&nbsp;<span class="ident" id="4247787">level</span>&nbsp;<span class="op" id="4247793">&gt;</span>&nbsp;<span class="num" id="4247795">0</span><span class="op" id="4247796">;</span>&nbsp;<span class="ident" id="4247798">level</span><span class="op" id="4247803">--</span>&nbsp;<span class="op" id="4247806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4247810">//&nbsp;chain.leafCount&nbsp;gives&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;requiring&nbsp;at&nbsp;least&nbsp;&#34;bits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4247886">//&nbsp;bits&nbsp;to&nbsp;encode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4247907">bitCount</span><span class="op" id="4247915">[</span><span class="ident" id="4247916">bits</span><span class="op" id="4247920">]</span>&nbsp;<span class="op" id="4247922">=</span>&nbsp;<span class="ident" id="4247924">counts</span><span class="op" id="4247930">[</span><span class="ident" id="4247931">level</span><span class="op" id="4247936">]</span>&nbsp;<span class="op" id="4247938">-</span>&nbsp;<span class="ident" id="4247940">counts</span><span class="op" id="4247946">[</span><span class="ident" id="4247947">level</span><span class="op" id="4247952">-</span><span class="num" id="4247953">1</span><span class="op" id="4247954">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4247958">bits</span><span class="op" id="4247962">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4247966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4247969">return</span>&nbsp;<span class="ident" id="4247976">bitCount</span><br>
<span class="lineno"></span><span class="op" id="4247985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4247988">//&nbsp;Look&nbsp;at&nbsp;the&nbsp;leaves&nbsp;and&nbsp;assign&nbsp;them&nbsp;a&nbsp;bit&nbsp;count&nbsp;and&nbsp;an&nbsp;encoding&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="4248067">//&nbsp;in&nbsp;RFC&nbsp;1951&nbsp;3.2.2</span><br>
<span class="lineno"></span><span class="keyword" id="4248088">func</span>&nbsp;<span class="op" id="4248093">(</span><span class="ident" id="4248094">h</span>&nbsp;<span class="op" id="4248096">*</span><span class="ident" id="4248097">huffmanEncoder</span><span class="op" id="4248111">)</span>&nbsp;<span class="ident" id="4248113">assignEncodingAndSize</span><span class="op" id="4248134">(</span><span class="ident" id="4248135">bitCount</span>&nbsp;<span class="op" id="4248144">[</span><span class="op" id="4248145">]</span><span class="builtintype" id="4248146">int32</span><span class="op" id="4248151">,</span>&nbsp;<span class="ident" id="4248153">list</span>&nbsp;<span class="op" id="4248158">[</span><span class="op" id="4248159">]</span><span class="ident" id="4248160">literalNode</span><span class="op" id="4248171">)</span>&nbsp;<span class="op" id="4248173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248176">code</span>&nbsp;<span class="op" id="4248181">:=</span>&nbsp;<span class="builtintype" id="4248184">uint16</span><span class="op" id="4248190">(</span><span class="num" id="4248191">0</span><span class="op" id="4248192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4248195">for</span>&nbsp;<span class="ident" id="4248199">n</span><span class="op" id="4248200">,</span>&nbsp;<span class="ident" id="4248202">bits</span>&nbsp;<span class="op" id="4248207">:=</span>&nbsp;<span class="keyword" id="4248210">range</span>&nbsp;<span class="ident" id="4248216">bitCount</span>&nbsp;<span class="op" id="4248225">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248229">code</span>&nbsp;<span class="op" id="4248234">&lt;&lt;=</span>&nbsp;<span class="num" id="4248238">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4248242">if</span>&nbsp;<span class="ident" id="4248245">n</span>&nbsp;<span class="op" id="4248247">==</span>&nbsp;<span class="num" id="4248250">0</span>&nbsp;<span class="op" id="4248252">||</span>&nbsp;<span class="ident" id="4248255">bits</span>&nbsp;<span class="op" id="4248260">==</span>&nbsp;<span class="num" id="4248263">0</span>&nbsp;<span class="op" id="4248265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4248270">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4248281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4248285">//&nbsp;The&nbsp;literals&nbsp;list[len(list)-bits]&nbsp;..&nbsp;list[len(list)-bits]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4248348">//&nbsp;are&nbsp;encoded&nbsp;using&nbsp;&#34;bits&#34;&nbsp;bits,&nbsp;and&nbsp;get&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4248403">//&nbsp;code,&nbsp;code&nbsp;+&nbsp;1,&nbsp;....&nbsp;&nbsp;The&nbsp;code&nbsp;values&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4248450">//&nbsp;assigned&nbsp;in&nbsp;literal&nbsp;order&nbsp;(not&nbsp;frequency&nbsp;order).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248504">chunk</span>&nbsp;<span class="op" id="4248510">:=</span>&nbsp;<span class="ident" id="4248513">list</span><span class="op" id="4248517">[</span><span class="builtinfunc" id="4248518">len</span><span class="op" id="4248521">(</span><span class="ident" id="4248522">list</span><span class="op" id="4248526">)</span><span class="op" id="4248527">-</span><span class="builtintype" id="4248528">int</span><span class="op" id="4248531">(</span><span class="ident" id="4248532">bits</span><span class="op" id="4248536">)</span><span class="op" id="4248537">:</span><span class="op" id="4248538">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248542">sortByLiteral</span><span class="op" id="4248555">(</span><span class="ident" id="4248556">chunk</span><span class="op" id="4248561">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4248565">for</span>&nbsp;<span class="ident" id="4248569">_</span><span class="op" id="4248570">,</span>&nbsp;<span class="ident" id="4248572">node</span>&nbsp;<span class="op" id="4248577">:=</span>&nbsp;<span class="keyword" id="4248580">range</span>&nbsp;<span class="ident" id="4248586">chunk</span>&nbsp;<span class="op" id="4248592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248597">h</span><span class="op" id="4248598">.</span><span class="ident" id="4248599">codeBits</span><span class="op" id="4248607">[</span><span class="ident" id="4248608">node</span><span class="op" id="4248612">.</span><span class="ident" id="4248613">literal</span><span class="op" id="4248620">]</span>&nbsp;<span class="op" id="4248622">=</span>&nbsp;<span class="builtintype" id="4248624">uint8</span><span class="op" id="4248629">(</span><span class="ident" id="4248630">n</span><span class="op" id="4248631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248636">h</span><span class="op" id="4248637">.</span><span class="ident" id="4248638">code</span><span class="op" id="4248642">[</span><span class="ident" id="4248643">node</span><span class="op" id="4248647">.</span><span class="ident" id="4248648">literal</span><span class="op" id="4248655">]</span>&nbsp;<span class="op" id="4248657">=</span>&nbsp;<span class="ident" id="4248659">reverseBits</span><span class="op" id="4248670">(</span><span class="ident" id="4248671">code</span><span class="op" id="4248675">,</span>&nbsp;<span class="builtintype" id="4248677">uint8</span><span class="op" id="4248682">(</span><span class="ident" id="4248683">n</span><span class="op" id="4248684">)</span><span class="op" id="4248685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248690">code</span><span class="op" id="4248694">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4248699">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4248703">list</span>&nbsp;<span class="op" id="4248708">=</span>&nbsp;<span class="ident" id="4248710">list</span><span class="op" id="4248714">[</span><span class="num" id="4248715">0</span>&nbsp;<span class="op" id="4248717">:</span>&nbsp;<span class="builtinfunc" id="4248719">len</span><span class="op" id="4248722">(</span><span class="ident" id="4248723">list</span><span class="op" id="4248727">)</span><span class="op" id="4248728">-</span><span class="builtintype" id="4248729">int</span><span class="op" id="4248732">(</span><span class="ident" id="4248733">bits</span><span class="op" id="4248737">)</span><span class="op" id="4248738">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4248741">}</span><br>
<span class="lineno"></span><span class="op" id="4248743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4248746">//&nbsp;Update&nbsp;this&nbsp;Huffman&nbsp;Code&nbsp;object&nbsp;to&nbsp;be&nbsp;the&nbsp;minimum&nbsp;code&nbsp;for&nbsp;the&nbsp;specified&nbsp;frequency&nbsp;count.</span><br>
<span class="lineno">260</span><span class="comment" id="4248839">//</span><br>
<span class="lineno"></span><span class="comment" id="4248842">//&nbsp;freq&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;frequencies,&nbsp;in&nbsp;which&nbsp;frequency[i]&nbsp;gives&nbsp;the&nbsp;frequency&nbsp;of&nbsp;literal&nbsp;i.</span><br>
<span class="lineno"></span><span class="comment" id="4248932">//&nbsp;maxBits&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;any&nbsp;literal.</span><br>
<span class="lineno"></span><span class="keyword" id="4248995">func</span>&nbsp;<span class="op" id="4249000">(</span><span class="ident" id="4249001">h</span>&nbsp;<span class="op" id="4249003">*</span><span class="ident" id="4249004">huffmanEncoder</span><span class="op" id="4249018">)</span>&nbsp;<span class="ident" id="4249020">generate</span><span class="op" id="4249028">(</span><span class="ident" id="4249029">freq</span>&nbsp;<span class="op" id="4249034">[</span><span class="op" id="4249035">]</span><span class="builtintype" id="4249036">int32</span><span class="op" id="4249041">,</span>&nbsp;<span class="ident" id="4249043">maxBits</span>&nbsp;<span class="builtintype" id="4249051">int32</span><span class="op" id="4249056">)</span>&nbsp;<span class="op" id="4249058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249061">list</span>&nbsp;<span class="op" id="4249066">:=</span>&nbsp;<span class="builtinfunc" id="4249069">make</span><span class="op" id="4249073">(</span><span class="op" id="4249074">[</span><span class="op" id="4249075">]</span><span class="ident" id="4249076">literalNode</span><span class="op" id="4249087">,</span>&nbsp;<span class="builtinfunc" id="4249089">len</span><span class="op" id="4249092">(</span><span class="ident" id="4249093">freq</span><span class="op" id="4249097">)</span><span class="op" id="4249098">+</span><span class="num" id="4249099">1</span><span class="op" id="4249100">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4249103">//&nbsp;Number&nbsp;of&nbsp;non-zero&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249135">count</span>&nbsp;<span class="op" id="4249141">:=</span>&nbsp;<span class="num" id="4249144">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4249147">//&nbsp;Set&nbsp;list&nbsp;to&nbsp;be&nbsp;the&nbsp;set&nbsp;of&nbsp;all&nbsp;non-zero&nbsp;literals&nbsp;and&nbsp;their&nbsp;frequencies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4249221">for</span>&nbsp;<span class="ident" id="4249225">i</span><span class="op" id="4249226">,</span>&nbsp;<span class="ident" id="4249228">f</span>&nbsp;<span class="op" id="4249230">:=</span>&nbsp;<span class="keyword" id="4249233">range</span>&nbsp;<span class="ident" id="4249239">freq</span>&nbsp;<span class="op" id="4249244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4249248">if</span>&nbsp;<span class="ident" id="4249251">f</span>&nbsp;<span class="op" id="4249253">!=</span>&nbsp;<span class="num" id="4249256">0</span>&nbsp;<span class="op" id="4249258">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249263">list</span><span class="op" id="4249267">[</span><span class="ident" id="4249268">count</span><span class="op" id="4249273">]</span>&nbsp;<span class="op" id="4249275">=</span>&nbsp;<span class="ident" id="4249277">literalNode</span><span class="op" id="4249288">{</span><span class="builtintype" id="4249289">uint16</span><span class="op" id="4249295">(</span><span class="ident" id="4249296">i</span><span class="op" id="4249297">)</span><span class="op" id="4249298">,</span>&nbsp;<span class="ident" id="4249300">f</span><span class="op" id="4249301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249306">count</span><span class="op" id="4249311">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4249316">}</span>&nbsp;<span class="keyword" id="4249318">else</span>&nbsp;<span class="op" id="4249323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249328">h</span><span class="op" id="4249329">.</span><span class="ident" id="4249330">codeBits</span><span class="op" id="4249338">[</span><span class="ident" id="4249339">i</span><span class="op" id="4249340">]</span>&nbsp;<span class="op" id="4249342">=</span>&nbsp;<span class="num" id="4249344">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4249348">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4249351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4249354">//&nbsp;If&nbsp;freq[]&nbsp;is&nbsp;shorter&nbsp;than&nbsp;codeBits[],&nbsp;fill&nbsp;rest&nbsp;of&nbsp;codeBits[]&nbsp;with&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249431">h</span><span class="op" id="4249432">.</span><span class="ident" id="4249433">codeBits</span>&nbsp;<span class="op" id="4249442">=</span>&nbsp;<span class="ident" id="4249444">h</span><span class="op" id="4249445">.</span><span class="ident" id="4249446">codeBits</span><span class="op" id="4249454">[</span><span class="num" id="4249455">0</span><span class="op" id="4249456">:</span><span class="builtinfunc" id="4249457">len</span><span class="op" id="4249460">(</span><span class="ident" id="4249461">freq</span><span class="op" id="4249465">)</span><span class="op" id="4249466">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249469">list</span>&nbsp;<span class="op" id="4249474">=</span>&nbsp;<span class="ident" id="4249476">list</span><span class="op" id="4249480">[</span><span class="num" id="4249481">0</span><span class="op" id="4249482">:</span><span class="ident" id="4249483">count</span><span class="op" id="4249488">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4249491">if</span>&nbsp;<span class="ident" id="4249494">count</span>&nbsp;<span class="op" id="4249500">&lt;=</span>&nbsp;<span class="num" id="4249503">2</span>&nbsp;<span class="op" id="4249505">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4249509">//&nbsp;Handle&nbsp;the&nbsp;small&nbsp;cases&nbsp;here,&nbsp;because&nbsp;they&nbsp;are&nbsp;awkward&nbsp;for&nbsp;the&nbsp;general&nbsp;case&nbsp;code.&nbsp;&nbsp;With</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4249601">//&nbsp;two&nbsp;or&nbsp;fewer&nbsp;literals,&nbsp;everything&nbsp;has&nbsp;bit&nbsp;length&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4249658">for</span>&nbsp;<span class="ident" id="4249662">i</span><span class="op" id="4249663">,</span>&nbsp;<span class="ident" id="4249665">node</span>&nbsp;<span class="op" id="4249670">:=</span>&nbsp;<span class="keyword" id="4249673">range</span>&nbsp;<span class="ident" id="4249679">list</span>&nbsp;<span class="op" id="4249684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4249689">//&nbsp;&#34;list&#34;&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing&nbsp;literal&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249743">h</span><span class="op" id="4249744">.</span><span class="ident" id="4249745">codeBits</span><span class="op" id="4249753">[</span><span class="ident" id="4249754">node</span><span class="op" id="4249758">.</span><span class="ident" id="4249759">literal</span><span class="op" id="4249766">]</span>&nbsp;<span class="op" id="4249768">=</span>&nbsp;<span class="num" id="4249770">1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249775">h</span><span class="op" id="4249776">.</span><span class="ident" id="4249777">code</span><span class="op" id="4249781">[</span><span class="ident" id="4249782">node</span><span class="op" id="4249786">.</span><span class="ident" id="4249787">literal</span><span class="op" id="4249794">]</span>&nbsp;<span class="op" id="4249796">=</span>&nbsp;<span class="builtintype" id="4249798">uint16</span><span class="op" id="4249804">(</span><span class="ident" id="4249805">i</span><span class="op" id="4249806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4249810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4249814">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4249822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249825">sortByFreq</span><span class="op" id="4249835">(</span><span class="ident" id="4249836">list</span><span class="op" id="4249840">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4249844">//&nbsp;Get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;for&nbsp;each&nbsp;bit&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249894">bitCount</span>&nbsp;<span class="op" id="4249903">:=</span>&nbsp;<span class="ident" id="4249906">h</span><span class="op" id="4249907">.</span><span class="ident" id="4249908">bitCounts</span><span class="op" id="4249917">(</span><span class="ident" id="4249918">list</span><span class="op" id="4249922">,</span>&nbsp;<span class="ident" id="4249924">maxBits</span><span class="op" id="4249931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4249934">//&nbsp;And&nbsp;do&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4249960">h</span><span class="op" id="4249961">.</span><span class="ident" id="4249962">assignEncodingAndSize</span><span class="op" id="4249983">(</span><span class="ident" id="4249984">bitCount</span><span class="op" id="4249992">,</span>&nbsp;<span class="ident" id="4249994">list</span><span class="op" id="4249998">)</span><br>
<span class="lineno">295</span><span class="op" id="4250000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4250003">type</span>&nbsp;<span class="ident" id="4250008">literalNodeSorter</span>&nbsp;<span class="keyword" id="4250026">struct</span>&nbsp;<span class="op" id="4250033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250036">a</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4250041">[</span><span class="op" id="4250042">]</span><span class="ident" id="4250043">literalNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250056">less</span>&nbsp;<span class="keyword" id="4250061">func</span><span class="op" id="4250065">(</span><span class="ident" id="4250066">i</span><span class="op" id="4250067">,</span>&nbsp;<span class="ident" id="4250069">j</span>&nbsp;<span class="builtintype" id="4250071">int</span><span class="op" id="4250074">)</span>&nbsp;<span class="builtintype" id="4250076">bool</span><br>
<span class="lineno">300</span><span class="op" id="4250081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4250084">func</span>&nbsp;<span class="op" id="4250089">(</span><span class="ident" id="4250090">s</span>&nbsp;<span class="ident" id="4250092">literalNodeSorter</span><span class="op" id="4250109">)</span>&nbsp;<span class="ident" id="4250111">Len</span><span class="op" id="4250114">(</span><span class="op" id="4250115">)</span>&nbsp;<span class="builtintype" id="4250117">int</span>&nbsp;<span class="op" id="4250121">{</span>&nbsp;<span class="keyword" id="4250123">return</span>&nbsp;<span class="builtinfunc" id="4250130">len</span><span class="op" id="4250133">(</span><span class="ident" id="4250134">s</span><span class="op" id="4250135">.</span><span class="ident" id="4250136">a</span><span class="op" id="4250137">)</span>&nbsp;<span class="op" id="4250139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4250142">func</span>&nbsp;<span class="op" id="4250147">(</span><span class="ident" id="4250148">s</span>&nbsp;<span class="ident" id="4250150">literalNodeSorter</span><span class="op" id="4250167">)</span>&nbsp;<span class="ident" id="4250169">Less</span><span class="op" id="4250173">(</span><span class="ident" id="4250174">i</span><span class="op" id="4250175">,</span>&nbsp;<span class="ident" id="4250177">j</span>&nbsp;<span class="builtintype" id="4250179">int</span><span class="op" id="4250182">)</span>&nbsp;<span class="builtintype" id="4250184">bool</span>&nbsp;<span class="op" id="4250189">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4250192">return</span>&nbsp;<span class="ident" id="4250199">s</span><span class="op" id="4250200">.</span><span class="ident" id="4250201">less</span><span class="op" id="4250205">(</span><span class="ident" id="4250206">i</span><span class="op" id="4250207">,</span>&nbsp;<span class="ident" id="4250209">j</span><span class="op" id="4250210">)</span><br>
<span class="lineno"></span><span class="op" id="4250212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4250215">func</span>&nbsp;<span class="op" id="4250220">(</span><span class="ident" id="4250221">s</span>&nbsp;<span class="ident" id="4250223">literalNodeSorter</span><span class="op" id="4250240">)</span>&nbsp;<span class="ident" id="4250242">Swap</span><span class="op" id="4250246">(</span><span class="ident" id="4250247">i</span><span class="op" id="4250248">,</span>&nbsp;<span class="ident" id="4250250">j</span>&nbsp;<span class="builtintype" id="4250252">int</span><span class="op" id="4250255">)</span>&nbsp;<span class="op" id="4250257">{</span>&nbsp;<span class="ident" id="4250259">s</span><span class="op" id="4250260">.</span><span class="ident" id="4250261">a</span><span class="op" id="4250262">[</span><span class="ident" id="4250263">i</span><span class="op" id="4250264">]</span><span class="op" id="4250265">,</span>&nbsp;<span class="ident" id="4250267">s</span><span class="op" id="4250268">.</span><span class="ident" id="4250269">a</span><span class="op" id="4250270">[</span><span class="ident" id="4250271">j</span><span class="op" id="4250272">]</span>&nbsp;<span class="op" id="4250274">=</span>&nbsp;<span class="ident" id="4250276">s</span><span class="op" id="4250277">.</span><span class="ident" id="4250278">a</span><span class="op" id="4250279">[</span><span class="ident" id="4250280">j</span><span class="op" id="4250281">]</span><span class="op" id="4250282">,</span>&nbsp;<span class="ident" id="4250284">s</span><span class="op" id="4250285">.</span><span class="ident" id="4250286">a</span><span class="op" id="4250287">[</span><span class="ident" id="4250288">i</span><span class="op" id="4250289">]</span>&nbsp;<span class="op" id="4250291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="keyword" id="4250294">func</span>&nbsp;<span class="ident" id="4250299">sortByFreq</span><span class="op" id="4250309">(</span><span class="ident" id="4250310">a</span>&nbsp;<span class="op" id="4250312">[</span><span class="op" id="4250313">]</span><span class="ident" id="4250314">literalNode</span><span class="op" id="4250325">)</span>&nbsp;<span class="op" id="4250327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250330">s</span>&nbsp;<span class="op" id="4250332">:=</span>&nbsp;<span class="op" id="4250335">&amp;</span><span class="ident" id="4250336">literalNodeSorter</span><span class="op" id="4250353">{</span><span class="ident" id="4250354">a</span><span class="op" id="4250355">,</span>&nbsp;<span class="keyword" id="4250357">func</span><span class="op" id="4250361">(</span><span class="ident" id="4250362">i</span><span class="op" id="4250363">,</span>&nbsp;<span class="ident" id="4250365">j</span>&nbsp;<span class="builtintype" id="4250367">int</span><span class="op" id="4250370">)</span>&nbsp;<span class="builtintype" id="4250372">bool</span>&nbsp;<span class="op" id="4250377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4250381">if</span>&nbsp;<span class="ident" id="4250384">a</span><span class="op" id="4250385">[</span><span class="ident" id="4250386">i</span><span class="op" id="4250387">]</span><span class="op" id="4250388">.</span><span class="ident" id="4250389">freq</span>&nbsp;<span class="op" id="4250394">==</span>&nbsp;<span class="ident" id="4250397">a</span><span class="op" id="4250398">[</span><span class="ident" id="4250399">j</span><span class="op" id="4250400">]</span><span class="op" id="4250401">.</span><span class="ident" id="4250402">freq</span>&nbsp;<span class="op" id="4250407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4250412">return</span>&nbsp;<span class="ident" id="4250419">a</span><span class="op" id="4250420">[</span><span class="ident" id="4250421">i</span><span class="op" id="4250422">]</span><span class="op" id="4250423">.</span><span class="ident" id="4250424">literal</span>&nbsp;<span class="op" id="4250432">&lt;</span>&nbsp;<span class="ident" id="4250434">a</span><span class="op" id="4250435">[</span><span class="ident" id="4250436">j</span><span class="op" id="4250437">]</span><span class="op" id="4250438">.</span><span class="ident" id="4250439">literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4250449">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4250453">return</span>&nbsp;<span class="ident" id="4250460">a</span><span class="op" id="4250461">[</span><span class="ident" id="4250462">i</span><span class="op" id="4250463">]</span><span class="op" id="4250464">.</span><span class="ident" id="4250465">freq</span>&nbsp;<span class="op" id="4250470">&lt;</span>&nbsp;<span class="ident" id="4250472">a</span><span class="op" id="4250473">[</span><span class="ident" id="4250474">j</span><span class="op" id="4250475">]</span><span class="op" id="4250476">.</span><span class="ident" id="4250477">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4250483">}</span><span class="op" id="4250484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250487">sort</span><span class="op" id="4250491">.</span><span class="ident" id="4250492">Sort</span><span class="op" id="4250496">(</span><span class="ident" id="4250497">s</span><span class="op" id="4250498">)</span><br>
<span class="lineno"></span><span class="op" id="4250500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="keyword" id="4250503">func</span>&nbsp;<span class="ident" id="4250508">sortByLiteral</span><span class="op" id="4250521">(</span><span class="ident" id="4250522">a</span>&nbsp;<span class="op" id="4250524">[</span><span class="op" id="4250525">]</span><span class="ident" id="4250526">literalNode</span><span class="op" id="4250537">)</span>&nbsp;<span class="op" id="4250539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250542">s</span>&nbsp;<span class="op" id="4250544">:=</span>&nbsp;<span class="op" id="4250547">&amp;</span><span class="ident" id="4250548">literalNodeSorter</span><span class="op" id="4250565">{</span><span class="ident" id="4250566">a</span><span class="op" id="4250567">,</span>&nbsp;<span class="keyword" id="4250569">func</span><span class="op" id="4250573">(</span><span class="ident" id="4250574">i</span><span class="op" id="4250575">,</span>&nbsp;<span class="ident" id="4250577">j</span>&nbsp;<span class="builtintype" id="4250579">int</span><span class="op" id="4250582">)</span>&nbsp;<span class="builtintype" id="4250584">bool</span>&nbsp;<span class="op" id="4250589">{</span>&nbsp;<span class="keyword" id="4250591">return</span>&nbsp;<span class="ident" id="4250598">a</span><span class="op" id="4250599">[</span><span class="ident" id="4250600">i</span><span class="op" id="4250601">]</span><span class="op" id="4250602">.</span><span class="ident" id="4250603">literal</span>&nbsp;<span class="op" id="4250611">&lt;</span>&nbsp;<span class="ident" id="4250613">a</span><span class="op" id="4250614">[</span><span class="ident" id="4250615">j</span><span class="op" id="4250616">]</span><span class="op" id="4250617">.</span><span class="ident" id="4250618">literal</span>&nbsp;<span class="op" id="4250626">}</span><span class="op" id="4250627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4250630">sort</span><span class="op" id="4250634">.</span><span class="ident" id="4250635">Sort</span><span class="op" id="4250639">(</span><span class="ident" id="4250640">s</span><span class="op" id="4250641">)</span><br>
<span class="lineno"></span><span class="op" id="4250643">}</span>
</div>
</body>
</html>
