<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7497457">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7497512">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7497566">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7497617">package</span>&nbsp;<span class="ident" id="7497625">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7497630">import</span>&nbsp;<span class="op" id="7497637">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497640">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497649">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497656">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497665">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497680">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497686">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497699">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497705">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497716">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7497726">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7497729">var</span>&nbsp;<span class="ident" id="7497733">filenames</span>&nbsp;<span class="op" id="7497743">=</span>&nbsp;<span class="op" id="7497745">[</span><span class="op" id="7497746">]</span><span class="builtintype" id="7497747">string</span><span class="op" id="7497753">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497756">&#34;basn0g01&#34;</span><span class="op" id="7497766">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497769">&#34;basn0g01-30&#34;</span><span class="op" id="7497782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497785">&#34;basn0g02&#34;</span><span class="op" id="7497795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497798">&#34;basn0g02-29&#34;</span><span class="op" id="7497811">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497814">&#34;basn0g04&#34;</span><span class="op" id="7497824">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497827">&#34;basn0g04-31&#34;</span><span class="op" id="7497840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497843">&#34;basn0g08&#34;</span><span class="op" id="7497853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497856">&#34;basn0g16&#34;</span><span class="op" id="7497866">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497869">&#34;basn2c08&#34;</span><span class="op" id="7497879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497882">&#34;basn2c16&#34;</span><span class="op" id="7497892">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497895">&#34;basn3p01&#34;</span><span class="op" id="7497905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497908">&#34;basn3p02&#34;</span><span class="op" id="7497918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497921">&#34;basn3p04&#34;</span><span class="op" id="7497931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497934">&#34;basn3p04-31i&#34;</span><span class="op" id="7497948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497951">&#34;basn3p08&#34;</span><span class="op" id="7497961">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497964">&#34;basn3p08-trns&#34;</span><span class="op" id="7497979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497982">&#34;basn4a08&#34;</span><span class="op" id="7497992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7497995">&#34;basn4a16&#34;</span><span class="op" id="7498005">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7498008">&#34;basn6a08&#34;</span><span class="op" id="7498018">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7498021">&#34;basn6a16&#34;</span><span class="op" id="7498031">,</span><br>
<span class="lineno">40</span><span class="op" id="7498033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7498036">var</span>&nbsp;<span class="ident" id="7498040">filenamesPaletted</span>&nbsp;<span class="op" id="7498058">=</span>&nbsp;<span class="op" id="7498060">[</span><span class="op" id="7498061">]</span><span class="builtintype" id="7498062">string</span><span class="op" id="7498068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7498071">&#34;basn3p01&#34;</span><span class="op" id="7498081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7498084">&#34;basn3p02&#34;</span><span class="op" id="7498094">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7498097">&#34;basn3p04&#34;</span><span class="op" id="7498107">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7498110">&#34;basn3p08&#34;</span><span class="op" id="7498120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7498123">&#34;basn3p08-trns&#34;</span><span class="op" id="7498138">,</span><br>
<span class="lineno"></span><span class="op" id="7498140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="7498143">var</span>&nbsp;<span class="ident" id="7498147">filenamesShort</span>&nbsp;<span class="op" id="7498162">=</span>&nbsp;<span class="op" id="7498164">[</span><span class="op" id="7498165">]</span><span class="builtintype" id="7498166">string</span><span class="op" id="7498172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7498175">&#34;basn0g01&#34;</span><span class="op" id="7498185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7498188">&#34;basn0g04-31&#34;</span><span class="op" id="7498201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7498204">&#34;basn6a16&#34;</span><span class="op" id="7498214">,</span><br>
<span class="lineno"></span><span class="op" id="7498216">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="7498219">func</span>&nbsp;<span class="ident" id="7498224">readPNG</span><span class="op" id="7498231">(</span><span class="ident" id="7498232">filename</span>&nbsp;<span class="builtintype" id="7498241">string</span><span class="op" id="7498247">)</span>&nbsp;<span class="op" id="7498249">(</span><span class="ident" id="7498250">image</span><span class="op" id="7498255">.</span><span class="ident" id="7498256">Image</span><span class="op" id="7498261">,</span>&nbsp;<span class="builtintype" id="7498263">error</span><span class="op" id="7498268">)</span>&nbsp;<span class="op" id="7498270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7498273">f</span><span class="op" id="7498274">,</span>&nbsp;<span class="ident" id="7498276">err</span>&nbsp;<span class="op" id="7498280">:=</span>&nbsp;<span class="ident" id="7498283">os</span><span class="op" id="7498285">.</span><span class="ident" id="7498286">Open</span><span class="op" id="7498290">(</span><span class="ident" id="7498291">filename</span><span class="op" id="7498299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7498302">if</span>&nbsp;<span class="ident" id="7498305">err</span>&nbsp;<span class="op" id="7498309">!=</span>&nbsp;<span class="ident" id="7498312">nil</span>&nbsp;<span class="op" id="7498316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7498320">return</span>&nbsp;<span class="ident" id="7498327">nil</span><span class="op" id="7498330">,</span>&nbsp;<span class="ident" id="7498332">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7498337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7498340">defer</span>&nbsp;<span class="ident" id="7498346">f</span><span class="op" id="7498347">.</span><span class="ident" id="7498348">Close</span><span class="op" id="7498353">(</span><span class="op" id="7498354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7498357">return</span>&nbsp;<span class="ident" id="7498364">Decode</span><span class="op" id="7498370">(</span><span class="ident" id="7498371">f</span><span class="op" id="7498372">)</span><br>
<span class="lineno"></span><span class="op" id="7498374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="7498377">//&nbsp;An&nbsp;approximation&nbsp;of&nbsp;the&nbsp;sng&nbsp;command-line&nbsp;tool.</span><br>
<span class="lineno"></span><span class="keyword" id="7498427">func</span>&nbsp;<span class="ident" id="7498432">sng</span><span class="op" id="7498435">(</span><span class="ident" id="7498436">w</span>&nbsp;<span class="ident" id="7498438">io</span><span class="op" id="7498440">.</span><span class="ident" id="7498441">WriteCloser</span><span class="op" id="7498452">,</span>&nbsp;<span class="ident" id="7498454">filename</span>&nbsp;<span class="builtintype" id="7498463">string</span><span class="op" id="7498469">,</span>&nbsp;<span class="ident" id="7498471">png</span>&nbsp;<span class="ident" id="7498475">image</span><span class="op" id="7498480">.</span><span class="ident" id="7498481">Image</span><span class="op" id="7498486">)</span>&nbsp;<span class="op" id="7498488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7498491">defer</span>&nbsp;<span class="ident" id="7498497">w</span><span class="op" id="7498498">.</span><span class="ident" id="7498499">Close</span><span class="op" id="7498504">(</span><span class="op" id="7498505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7498508">bounds</span>&nbsp;<span class="op" id="7498515">:=</span>&nbsp;<span class="ident" id="7498518">png</span><span class="op" id="7498521">.</span><span class="ident" id="7498522">Bounds</span><span class="op" id="7498528">(</span><span class="op" id="7498529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7498532">cm</span>&nbsp;<span class="op" id="7498535">:=</span>&nbsp;<span class="ident" id="7498538">png</span><span class="op" id="7498541">.</span><span class="ident" id="7498542">ColorModel</span><span class="op" id="7498552">(</span><span class="op" id="7498553">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7498556">var</span>&nbsp;<span class="ident" id="7498560">bitdepth</span>&nbsp;<span class="builtintype" id="7498569">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7498574">switch</span>&nbsp;<span class="ident" id="7498581">cm</span>&nbsp;<span class="op" id="7498584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7498587">case</span>&nbsp;<span class="ident" id="7498592">color</span><span class="op" id="7498597">.</span><span class="ident" id="7498598">RGBAModel</span><span class="op" id="7498607">,</span>&nbsp;<span class="ident" id="7498609">color</span><span class="op" id="7498614">.</span><span class="ident" id="7498615">NRGBAModel</span><span class="op" id="7498625">,</span>&nbsp;<span class="ident" id="7498627">color</span><span class="op" id="7498632">.</span><span class="ident" id="7498633">AlphaModel</span><span class="op" id="7498643">,</span>&nbsp;<span class="ident" id="7498645">color</span><span class="op" id="7498650">.</span><span class="ident" id="7498651">GrayModel</span><span class="op" id="7498660">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7498664">bitdepth</span>&nbsp;<span class="op" id="7498673">=</span>&nbsp;<span class="num" id="7498675">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7498678">default</span><span class="op" id="7498685">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7498689">bitdepth</span>&nbsp;<span class="op" id="7498698">=</span>&nbsp;<span class="num" id="7498700">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7498704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7498707">cpm</span><span class="op" id="7498710">,</span>&nbsp;<span class="ident" id="7498712">_</span>&nbsp;<span class="op" id="7498714">:=</span>&nbsp;<span class="ident" id="7498717">cm</span><span class="op" id="7498719">.</span><span class="op" id="7498720">(</span><span class="ident" id="7498721">color</span><span class="op" id="7498726">.</span><span class="ident" id="7498727">Palette</span><span class="op" id="7498734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7498737">var</span>&nbsp;<span class="ident" id="7498741">paletted</span>&nbsp;<span class="op" id="7498750">*</span><span class="ident" id="7498751">image</span><span class="op" id="7498756">.</span><span class="ident" id="7498757">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7498767">if</span>&nbsp;<span class="ident" id="7498770">cpm</span>&nbsp;<span class="op" id="7498774">!=</span>&nbsp;<span class="ident" id="7498777">nil</span>&nbsp;<span class="op" id="7498781">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7498785">switch</span>&nbsp;<span class="op" id="7498792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7498796">case</span>&nbsp;<span class="builtinfunc" id="7498801">len</span><span class="op" id="7498804">(</span><span class="ident" id="7498805">cpm</span><span class="op" id="7498808">)</span>&nbsp;<span class="op" id="7498810">&lt;=</span>&nbsp;<span class="num" id="7498813">2</span><span class="op" id="7498814">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7498819">bitdepth</span>&nbsp;<span class="op" id="7498828">=</span>&nbsp;<span class="num" id="7498830">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7498834">case</span>&nbsp;<span class="builtinfunc" id="7498839">len</span><span class="op" id="7498842">(</span><span class="ident" id="7498843">cpm</span><span class="op" id="7498846">)</span>&nbsp;<span class="op" id="7498848">&lt;=</span>&nbsp;<span class="num" id="7498851">4</span><span class="op" id="7498852">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7498857">bitdepth</span>&nbsp;<span class="op" id="7498866">=</span>&nbsp;<span class="num" id="7498868">2</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7498872">case</span>&nbsp;<span class="builtinfunc" id="7498877">len</span><span class="op" id="7498880">(</span><span class="ident" id="7498881">cpm</span><span class="op" id="7498884">)</span>&nbsp;<span class="op" id="7498886">&lt;=</span>&nbsp;<span class="num" id="7498889">16</span><span class="op" id="7498891">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7498896">bitdepth</span>&nbsp;<span class="op" id="7498905">=</span>&nbsp;<span class="num" id="7498907">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7498911">default</span><span class="op" id="7498918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7498923">bitdepth</span>&nbsp;<span class="op" id="7498932">=</span>&nbsp;<span class="num" id="7498934">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7498938">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7498942">paletted</span>&nbsp;<span class="op" id="7498951">=</span>&nbsp;<span class="ident" id="7498953">png</span><span class="op" id="7498956">.</span><span class="op" id="7498957">(</span><span class="op" id="7498958">*</span><span class="ident" id="7498959">image</span><span class="op" id="7498964">.</span><span class="ident" id="7498965">Paletted</span><span class="op" id="7498973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7498976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7498980">//&nbsp;Write&nbsp;the&nbsp;filename&nbsp;and&nbsp;IHDR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7499013">io</span><span class="op" id="7499015">.</span><span class="ident" id="7499016">WriteString</span><span class="op" id="7499027">(</span><span class="ident" id="7499028">w</span><span class="op" id="7499029">,</span>&nbsp;<span class="string" id="7499031">&#34;#SNG:&nbsp;from&nbsp;&#34;</span><span class="op" id="7499044">+</span><span class="ident" id="7499045">filename</span><span class="op" id="7499053">+</span><span class="string" id="7499054">&#34;.png\nIHDR&nbsp;{\n&#34;</span><span class="op" id="7499070">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7499073">fmt</span><span class="op" id="7499076">.</span><span class="ident" id="7499077">Fprintf</span><span class="op" id="7499084">(</span><span class="ident" id="7499085">w</span><span class="op" id="7499086">,</span>&nbsp;<span class="string" id="7499088">&#34;&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;%d;&nbsp;height:&nbsp;%d;&nbsp;bitdepth:&nbsp;%d;\n&#34;</span><span class="op" id="7499132">,</span>&nbsp;<span class="ident" id="7499134">bounds</span><span class="op" id="7499140">.</span><span class="ident" id="7499141">Dx</span><span class="op" id="7499143">(</span><span class="op" id="7499144">)</span><span class="op" id="7499145">,</span>&nbsp;<span class="ident" id="7499147">bounds</span><span class="op" id="7499153">.</span><span class="ident" id="7499154">Dy</span><span class="op" id="7499156">(</span><span class="op" id="7499157">)</span><span class="op" id="7499158">,</span>&nbsp;<span class="ident" id="7499160">bitdepth</span><span class="op" id="7499168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7499171">switch</span>&nbsp;<span class="op" id="7499178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7499181">case</span>&nbsp;<span class="ident" id="7499186">cm</span>&nbsp;<span class="op" id="7499189">==</span>&nbsp;<span class="ident" id="7499192">color</span><span class="op" id="7499197">.</span><span class="ident" id="7499198">RGBAModel</span><span class="op" id="7499207">,</span>&nbsp;<span class="ident" id="7499209">cm</span>&nbsp;<span class="op" id="7499212">==</span>&nbsp;<span class="ident" id="7499215">color</span><span class="op" id="7499220">.</span><span class="ident" id="7499221">RGBA64Model</span><span class="op" id="7499232">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7499236">io</span><span class="op" id="7499238">.</span><span class="ident" id="7499239">WriteString</span><span class="op" id="7499250">(</span><span class="ident" id="7499251">w</span><span class="op" id="7499252">,</span>&nbsp;<span class="string" id="7499254">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color;\n&#34;</span><span class="op" id="7499274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7499277">case</span>&nbsp;<span class="ident" id="7499282">cm</span>&nbsp;<span class="op" id="7499285">==</span>&nbsp;<span class="ident" id="7499288">color</span><span class="op" id="7499293">.</span><span class="ident" id="7499294">NRGBAModel</span><span class="op" id="7499304">,</span>&nbsp;<span class="ident" id="7499306">cm</span>&nbsp;<span class="op" id="7499309">==</span>&nbsp;<span class="ident" id="7499312">color</span><span class="op" id="7499317">.</span><span class="ident" id="7499318">NRGBA64Model</span><span class="op" id="7499330">:</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7499334">io</span><span class="op" id="7499336">.</span><span class="ident" id="7499337">WriteString</span><span class="op" id="7499348">(</span><span class="ident" id="7499349">w</span><span class="op" id="7499350">,</span>&nbsp;<span class="string" id="7499352">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;alpha;\n&#34;</span><span class="op" id="7499378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7499381">case</span>&nbsp;<span class="ident" id="7499386">cm</span>&nbsp;<span class="op" id="7499389">==</span>&nbsp;<span class="ident" id="7499392">color</span><span class="op" id="7499397">.</span><span class="ident" id="7499398">GrayModel</span><span class="op" id="7499407">,</span>&nbsp;<span class="ident" id="7499409">cm</span>&nbsp;<span class="op" id="7499412">==</span>&nbsp;<span class="ident" id="7499415">color</span><span class="op" id="7499420">.</span><span class="ident" id="7499421">Gray16Model</span><span class="op" id="7499432">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7499436">io</span><span class="op" id="7499438">.</span><span class="ident" id="7499439">WriteString</span><span class="op" id="7499450">(</span><span class="ident" id="7499451">w</span><span class="op" id="7499452">,</span>&nbsp;<span class="string" id="7499454">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;grayscale;\n&#34;</span><span class="op" id="7499478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7499481">case</span>&nbsp;<span class="ident" id="7499486">cpm</span>&nbsp;<span class="op" id="7499490">!=</span>&nbsp;<span class="ident" id="7499493">nil</span><span class="op" id="7499496">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7499500">io</span><span class="op" id="7499502">.</span><span class="ident" id="7499503">WriteString</span><span class="op" id="7499514">(</span><span class="ident" id="7499515">w</span><span class="op" id="7499516">,</span>&nbsp;<span class="string" id="7499518">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;palette;\n&#34;</span><span class="op" id="7499546">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7499549">default</span><span class="op" id="7499556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7499560">io</span><span class="op" id="7499562">.</span><span class="ident" id="7499563">WriteString</span><span class="op" id="7499574">(</span><span class="ident" id="7499575">w</span><span class="op" id="7499576">,</span>&nbsp;<span class="string" id="7499578">&#34;unknown&nbsp;PNG&nbsp;decoder&nbsp;color&nbsp;model\n&#34;</span><span class="op" id="7499613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7499616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7499619">io</span><span class="op" id="7499621">.</span><span class="ident" id="7499622">WriteString</span><span class="op" id="7499633">(</span><span class="ident" id="7499634">w</span><span class="op" id="7499635">,</span>&nbsp;<span class="string" id="7499637">&#34;}\n&#34;</span><span class="op" id="7499642">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7499646">//&nbsp;We&nbsp;fake&nbsp;a&nbsp;gAMA&nbsp;output.&nbsp;The&nbsp;test&nbsp;files&nbsp;have&nbsp;a&nbsp;gAMA&nbsp;chunk&nbsp;but&nbsp;the&nbsp;go&nbsp;PNG&nbsp;parser&nbsp;ignores&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7499739">//&nbsp;(the&nbsp;PNG&nbsp;spec&nbsp;section&nbsp;11.3&nbsp;says&nbsp;&#34;Ancillary&nbsp;chunks&nbsp;may&nbsp;be&nbsp;ignored&nbsp;by&nbsp;a&nbsp;decoder&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7499824">io</span><span class="op" id="7499826">.</span><span class="ident" id="7499827">WriteString</span><span class="op" id="7499838">(</span><span class="ident" id="7499839">w</span><span class="op" id="7499840">,</span>&nbsp;<span class="string" id="7499842">&#34;gAMA&nbsp;{1.0000}\n&#34;</span><span class="op" id="7499859">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7499863">//&nbsp;Write&nbsp;the&nbsp;PLTE&nbsp;and&nbsp;tRNS&nbsp;(if&nbsp;applicable).</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7499908">if</span>&nbsp;<span class="ident" id="7499911">cpm</span>&nbsp;<span class="op" id="7499915">!=</span>&nbsp;<span class="ident" id="7499918">nil</span>&nbsp;<span class="op" id="7499922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7499926">lastAlpha</span>&nbsp;<span class="op" id="7499936">:=</span>&nbsp;<span class="op" id="7499939">-</span><span class="num" id="7499940">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7499944">io</span><span class="op" id="7499946">.</span><span class="ident" id="7499947">WriteString</span><span class="op" id="7499958">(</span><span class="ident" id="7499959">w</span><span class="op" id="7499960">,</span>&nbsp;<span class="string" id="7499962">&#34;PLTE&nbsp;{\n&#34;</span><span class="op" id="7499972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7499976">for</span>&nbsp;<span class="ident" id="7499980">i</span><span class="op" id="7499981">,</span>&nbsp;<span class="ident" id="7499983">c</span>&nbsp;<span class="op" id="7499985">:=</span>&nbsp;<span class="keyword" id="7499988">range</span>&nbsp;<span class="ident" id="7499994">cpm</span>&nbsp;<span class="op" id="7499998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7500003">var</span>&nbsp;<span class="ident" id="7500007">r</span><span class="op" id="7500008">,</span>&nbsp;<span class="ident" id="7500010">g</span><span class="op" id="7500011">,</span>&nbsp;<span class="ident" id="7500013">b</span><span class="op" id="7500014">,</span>&nbsp;<span class="ident" id="7500016">a</span>&nbsp;<span class="builtintype" id="7500018">uint8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7500027">switch</span>&nbsp;<span class="ident" id="7500034">c</span>&nbsp;<span class="op" id="7500036">:=</span>&nbsp;<span class="ident" id="7500039">c</span><span class="op" id="7500040">.</span><span class="op" id="7500041">(</span><span class="keyword" id="7500042">type</span><span class="op" id="7500046">)</span>&nbsp;<span class="op" id="7500048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7500053">case</span>&nbsp;<span class="ident" id="7500058">color</span><span class="op" id="7500063">.</span><span class="ident" id="7500064">RGBA</span><span class="op" id="7500068">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7500074">r</span><span class="op" id="7500075">,</span>&nbsp;<span class="ident" id="7500077">g</span><span class="op" id="7500078">,</span>&nbsp;<span class="ident" id="7500080">b</span><span class="op" id="7500081">,</span>&nbsp;<span class="ident" id="7500083">a</span>&nbsp;<span class="op" id="7500085">=</span>&nbsp;<span class="ident" id="7500087">c</span><span class="op" id="7500088">.</span><span class="ident" id="7500089">R</span><span class="op" id="7500090">,</span>&nbsp;<span class="ident" id="7500092">c</span><span class="op" id="7500093">.</span><span class="ident" id="7500094">G</span><span class="op" id="7500095">,</span>&nbsp;<span class="ident" id="7500097">c</span><span class="op" id="7500098">.</span><span class="ident" id="7500099">B</span><span class="op" id="7500100">,</span>&nbsp;<span class="num" id="7500102">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7500110">case</span>&nbsp;<span class="ident" id="7500115">color</span><span class="op" id="7500120">.</span><span class="ident" id="7500121">NRGBA</span><span class="op" id="7500126">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7500132">r</span><span class="op" id="7500133">,</span>&nbsp;<span class="ident" id="7500135">g</span><span class="op" id="7500136">,</span>&nbsp;<span class="ident" id="7500138">b</span><span class="op" id="7500139">,</span>&nbsp;<span class="ident" id="7500141">a</span>&nbsp;<span class="op" id="7500143">=</span>&nbsp;<span class="ident" id="7500145">c</span><span class="op" id="7500146">.</span><span class="ident" id="7500147">R</span><span class="op" id="7500148">,</span>&nbsp;<span class="ident" id="7500150">c</span><span class="op" id="7500151">.</span><span class="ident" id="7500152">G</span><span class="op" id="7500153">,</span>&nbsp;<span class="ident" id="7500155">c</span><span class="op" id="7500156">.</span><span class="ident" id="7500157">B</span><span class="op" id="7500158">,</span>&nbsp;<span class="ident" id="7500160">c</span><span class="op" id="7500161">.</span><span class="ident" id="7500162">A</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7500167">default</span><span class="op" id="7500174">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7500180">panic</span><span class="op" id="7500185">(</span><span class="string" id="7500186">&#34;unknown&nbsp;palette&nbsp;color&nbsp;type&#34;</span><span class="op" id="7500214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7500219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7500224">if</span>&nbsp;<span class="ident" id="7500227">a</span>&nbsp;<span class="op" id="7500229">!=</span>&nbsp;<span class="num" id="7500232">0xff</span>&nbsp;<span class="op" id="7500237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7500243">lastAlpha</span>&nbsp;<span class="op" id="7500253">=</span>&nbsp;<span class="ident" id="7500255">i</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7500260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7500265">fmt</span><span class="op" id="7500268">.</span><span class="ident" id="7500269">Fprintf</span><span class="op" id="7500276">(</span><span class="ident" id="7500277">w</span><span class="op" id="7500278">,</span>&nbsp;<span class="string" id="7500280">&#34;&nbsp;&nbsp;&nbsp;&nbsp;(%3d,%3d,%3d)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;rgb&nbsp;=&nbsp;(0x%02x,0x%02x,0x%02x)\n&#34;</span><span class="op" id="7500336">,</span>&nbsp;<span class="ident" id="7500338">r</span><span class="op" id="7500339">,</span>&nbsp;<span class="ident" id="7500341">g</span><span class="op" id="7500342">,</span>&nbsp;<span class="ident" id="7500344">b</span><span class="op" id="7500345">,</span>&nbsp;<span class="ident" id="7500347">r</span><span class="op" id="7500348">,</span>&nbsp;<span class="ident" id="7500350">g</span><span class="op" id="7500351">,</span>&nbsp;<span class="ident" id="7500353">b</span><span class="op" id="7500354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7500358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7500362">io</span><span class="op" id="7500364">.</span><span class="ident" id="7500365">WriteString</span><span class="op" id="7500376">(</span><span class="ident" id="7500377">w</span><span class="op" id="7500378">,</span>&nbsp;<span class="string" id="7500380">&#34;}\n&#34;</span><span class="op" id="7500385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7500389">if</span>&nbsp;<span class="ident" id="7500392">lastAlpha</span>&nbsp;<span class="op" id="7500402">!=</span>&nbsp;<span class="op" id="7500405">-</span><span class="num" id="7500406">1</span>&nbsp;<span class="op" id="7500408">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7500413">io</span><span class="op" id="7500415">.</span><span class="ident" id="7500416">WriteString</span><span class="op" id="7500427">(</span><span class="ident" id="7500428">w</span><span class="op" id="7500429">,</span>&nbsp;<span class="string" id="7500431">&#34;tRNS&nbsp;{\n&#34;</span><span class="op" id="7500441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7500446">for</span>&nbsp;<span class="ident" id="7500450">i</span>&nbsp;<span class="op" id="7500452">:=</span>&nbsp;<span class="num" id="7500455">0</span><span class="op" id="7500456">;</span>&nbsp;<span class="ident" id="7500458">i</span>&nbsp;<span class="op" id="7500460">&lt;=</span>&nbsp;<span class="ident" id="7500463">lastAlpha</span><span class="op" id="7500472">;</span>&nbsp;<span class="ident" id="7500474">i</span><span class="op" id="7500475">++</span>&nbsp;<span class="op" id="7500478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7500484">_</span><span class="op" id="7500485">,</span>&nbsp;<span class="ident" id="7500487">_</span><span class="op" id="7500488">,</span>&nbsp;<span class="ident" id="7500490">_</span><span class="op" id="7500491">,</span>&nbsp;<span class="ident" id="7500493">a</span>&nbsp;<span class="op" id="7500495">:=</span>&nbsp;<span class="ident" id="7500498">cpm</span><span class="op" id="7500501">[</span><span class="ident" id="7500502">i</span><span class="op" id="7500503">]</span><span class="op" id="7500504">.</span><span class="ident" id="7500505">RGBA</span><span class="op" id="7500509">(</span><span class="op" id="7500510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7500516">a</span>&nbsp;<span class="op" id="7500518">&gt;&gt;=</span>&nbsp;<span class="num" id="7500522">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7500528">fmt</span><span class="op" id="7500531">.</span><span class="ident" id="7500532">Fprintf</span><span class="op" id="7500539">(</span><span class="ident" id="7500540">w</span><span class="op" id="7500541">,</span>&nbsp;<span class="string" id="7500543">&#34;&nbsp;%d&#34;</span><span class="op" id="7500548">,</span>&nbsp;<span class="ident" id="7500550">a</span><span class="op" id="7500551">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7500556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7500561">io</span><span class="op" id="7500563">.</span><span class="ident" id="7500564">WriteString</span><span class="op" id="7500575">(</span><span class="ident" id="7500576">w</span><span class="op" id="7500577">,</span>&nbsp;<span class="string" id="7500579">&#34;}\n&#34;</span><span class="op" id="7500584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7500588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7500591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7500595">//&nbsp;Write&nbsp;the&nbsp;IMAGE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7500616">io</span><span class="op" id="7500618">.</span><span class="ident" id="7500619">WriteString</span><span class="op" id="7500630">(</span><span class="ident" id="7500631">w</span><span class="op" id="7500632">,</span>&nbsp;<span class="string" id="7500634">&#34;IMAGE&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;pixels&nbsp;hex\n&#34;</span><span class="op" id="7500661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7500664">for</span>&nbsp;<span class="ident" id="7500668">y</span>&nbsp;<span class="op" id="7500670">:=</span>&nbsp;<span class="ident" id="7500673">bounds</span><span class="op" id="7500679">.</span><span class="ident" id="7500680">Min</span><span class="op" id="7500683">.</span><span class="ident" id="7500684">Y</span><span class="op" id="7500685">;</span>&nbsp;<span class="ident" id="7500687">y</span>&nbsp;<span class="op" id="7500689">&lt;</span>&nbsp;<span class="ident" id="7500691">bounds</span><span class="op" id="7500697">.</span><span class="ident" id="7500698">Max</span><span class="op" id="7500701">.</span><span class="ident" id="7500702">Y</span><span class="op" id="7500703">;</span>&nbsp;<span class="ident" id="7500705">y</span><span class="op" id="7500706">++</span>&nbsp;<span class="op" id="7500709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7500713">switch</span>&nbsp;<span class="op" id="7500720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7500724">case</span>&nbsp;<span class="ident" id="7500729">cm</span>&nbsp;<span class="op" id="7500732">==</span>&nbsp;<span class="ident" id="7500735">color</span><span class="op" id="7500740">.</span><span class="ident" id="7500741">GrayModel</span><span class="op" id="7500750">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7500755">for</span>&nbsp;<span class="ident" id="7500759">x</span>&nbsp;<span class="op" id="7500761">:=</span>&nbsp;<span class="ident" id="7500764">bounds</span><span class="op" id="7500770">.</span><span class="ident" id="7500771">Min</span><span class="op" id="7500774">.</span><span class="ident" id="7500775">X</span><span class="op" id="7500776">;</span>&nbsp;<span class="ident" id="7500778">x</span>&nbsp;<span class="op" id="7500780">&lt;</span>&nbsp;<span class="ident" id="7500782">bounds</span><span class="op" id="7500788">.</span><span class="ident" id="7500789">Max</span><span class="op" id="7500792">.</span><span class="ident" id="7500793">X</span><span class="op" id="7500794">;</span>&nbsp;<span class="ident" id="7500796">x</span><span class="op" id="7500797">++</span>&nbsp;<span class="op" id="7500800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7500806">gray</span>&nbsp;<span class="op" id="7500811">:=</span>&nbsp;<span class="ident" id="7500814">png</span><span class="op" id="7500817">.</span><span class="ident" id="7500818">At</span><span class="op" id="7500820">(</span><span class="ident" id="7500821">x</span><span class="op" id="7500822">,</span>&nbsp;<span class="ident" id="7500824">y</span><span class="op" id="7500825">)</span><span class="op" id="7500826">.</span><span class="op" id="7500827">(</span><span class="ident" id="7500828">color</span><span class="op" id="7500833">.</span><span class="ident" id="7500834">Gray</span><span class="op" id="7500838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7500844">fmt</span><span class="op" id="7500847">.</span><span class="ident" id="7500848">Fprintf</span><span class="op" id="7500855">(</span><span class="ident" id="7500856">w</span><span class="op" id="7500857">,</span>&nbsp;<span class="string" id="7500859">&#34;%02x&#34;</span><span class="op" id="7500865">,</span>&nbsp;<span class="ident" id="7500867">gray</span><span class="op" id="7500871">.</span><span class="ident" id="7500872">Y</span><span class="op" id="7500873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7500878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7500882">case</span>&nbsp;<span class="ident" id="7500887">cm</span>&nbsp;<span class="op" id="7500890">==</span>&nbsp;<span class="ident" id="7500893">color</span><span class="op" id="7500898">.</span><span class="ident" id="7500899">Gray16Model</span><span class="op" id="7500910">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7500915">for</span>&nbsp;<span class="ident" id="7500919">x</span>&nbsp;<span class="op" id="7500921">:=</span>&nbsp;<span class="ident" id="7500924">bounds</span><span class="op" id="7500930">.</span><span class="ident" id="7500931">Min</span><span class="op" id="7500934">.</span><span class="ident" id="7500935">X</span><span class="op" id="7500936">;</span>&nbsp;<span class="ident" id="7500938">x</span>&nbsp;<span class="op" id="7500940">&lt;</span>&nbsp;<span class="ident" id="7500942">bounds</span><span class="op" id="7500948">.</span><span class="ident" id="7500949">Max</span><span class="op" id="7500952">.</span><span class="ident" id="7500953">X</span><span class="op" id="7500954">;</span>&nbsp;<span class="ident" id="7500956">x</span><span class="op" id="7500957">++</span>&nbsp;<span class="op" id="7500960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7500966">gray16</span>&nbsp;<span class="op" id="7500973">:=</span>&nbsp;<span class="ident" id="7500976">png</span><span class="op" id="7500979">.</span><span class="ident" id="7500980">At</span><span class="op" id="7500982">(</span><span class="ident" id="7500983">x</span><span class="op" id="7500984">,</span>&nbsp;<span class="ident" id="7500986">y</span><span class="op" id="7500987">)</span><span class="op" id="7500988">.</span><span class="op" id="7500989">(</span><span class="ident" id="7500990">color</span><span class="op" id="7500995">.</span><span class="ident" id="7500996">Gray16</span><span class="op" id="7501002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7501008">fmt</span><span class="op" id="7501011">.</span><span class="ident" id="7501012">Fprintf</span><span class="op" id="7501019">(</span><span class="ident" id="7501020">w</span><span class="op" id="7501021">,</span>&nbsp;<span class="string" id="7501023">&#34;%04x&nbsp;&#34;</span><span class="op" id="7501030">,</span>&nbsp;<span class="ident" id="7501032">gray16</span><span class="op" id="7501038">.</span><span class="ident" id="7501039">Y</span><span class="op" id="7501040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7501045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7501049">case</span>&nbsp;<span class="ident" id="7501054">cm</span>&nbsp;<span class="op" id="7501057">==</span>&nbsp;<span class="ident" id="7501060">color</span><span class="op" id="7501065">.</span><span class="ident" id="7501066">RGBAModel</span><span class="op" id="7501075">:</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7501080">for</span>&nbsp;<span class="ident" id="7501084">x</span>&nbsp;<span class="op" id="7501086">:=</span>&nbsp;<span class="ident" id="7501089">bounds</span><span class="op" id="7501095">.</span><span class="ident" id="7501096">Min</span><span class="op" id="7501099">.</span><span class="ident" id="7501100">X</span><span class="op" id="7501101">;</span>&nbsp;<span class="ident" id="7501103">x</span>&nbsp;<span class="op" id="7501105">&lt;</span>&nbsp;<span class="ident" id="7501107">bounds</span><span class="op" id="7501113">.</span><span class="ident" id="7501114">Max</span><span class="op" id="7501117">.</span><span class="ident" id="7501118">X</span><span class="op" id="7501119">;</span>&nbsp;<span class="ident" id="7501121">x</span><span class="op" id="7501122">++</span>&nbsp;<span class="op" id="7501125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7501131">rgba</span>&nbsp;<span class="op" id="7501136">:=</span>&nbsp;<span class="ident" id="7501139">png</span><span class="op" id="7501142">.</span><span class="ident" id="7501143">At</span><span class="op" id="7501145">(</span><span class="ident" id="7501146">x</span><span class="op" id="7501147">,</span>&nbsp;<span class="ident" id="7501149">y</span><span class="op" id="7501150">)</span><span class="op" id="7501151">.</span><span class="op" id="7501152">(</span><span class="ident" id="7501153">color</span><span class="op" id="7501158">.</span><span class="ident" id="7501159">RGBA</span><span class="op" id="7501163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7501169">fmt</span><span class="op" id="7501172">.</span><span class="ident" id="7501173">Fprintf</span><span class="op" id="7501180">(</span><span class="ident" id="7501181">w</span><span class="op" id="7501182">,</span>&nbsp;<span class="string" id="7501184">&#34;%02x%02x%02x&nbsp;&#34;</span><span class="op" id="7501199">,</span>&nbsp;<span class="ident" id="7501201">rgba</span><span class="op" id="7501205">.</span><span class="ident" id="7501206">R</span><span class="op" id="7501207">,</span>&nbsp;<span class="ident" id="7501209">rgba</span><span class="op" id="7501213">.</span><span class="ident" id="7501214">G</span><span class="op" id="7501215">,</span>&nbsp;<span class="ident" id="7501217">rgba</span><span class="op" id="7501221">.</span><span class="ident" id="7501222">B</span><span class="op" id="7501223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7501228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7501232">case</span>&nbsp;<span class="ident" id="7501237">cm</span>&nbsp;<span class="op" id="7501240">==</span>&nbsp;<span class="ident" id="7501243">color</span><span class="op" id="7501248">.</span><span class="ident" id="7501249">RGBA64Model</span><span class="op" id="7501260">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7501265">for</span>&nbsp;<span class="ident" id="7501269">x</span>&nbsp;<span class="op" id="7501271">:=</span>&nbsp;<span class="ident" id="7501274">bounds</span><span class="op" id="7501280">.</span><span class="ident" id="7501281">Min</span><span class="op" id="7501284">.</span><span class="ident" id="7501285">X</span><span class="op" id="7501286">;</span>&nbsp;<span class="ident" id="7501288">x</span>&nbsp;<span class="op" id="7501290">&lt;</span>&nbsp;<span class="ident" id="7501292">bounds</span><span class="op" id="7501298">.</span><span class="ident" id="7501299">Max</span><span class="op" id="7501302">.</span><span class="ident" id="7501303">X</span><span class="op" id="7501304">;</span>&nbsp;<span class="ident" id="7501306">x</span><span class="op" id="7501307">++</span>&nbsp;<span class="op" id="7501310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7501316">rgba64</span>&nbsp;<span class="op" id="7501323">:=</span>&nbsp;<span class="ident" id="7501326">png</span><span class="op" id="7501329">.</span><span class="ident" id="7501330">At</span><span class="op" id="7501332">(</span><span class="ident" id="7501333">x</span><span class="op" id="7501334">,</span>&nbsp;<span class="ident" id="7501336">y</span><span class="op" id="7501337">)</span><span class="op" id="7501338">.</span><span class="op" id="7501339">(</span><span class="ident" id="7501340">color</span><span class="op" id="7501345">.</span><span class="ident" id="7501346">RGBA64</span><span class="op" id="7501352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7501358">fmt</span><span class="op" id="7501361">.</span><span class="ident" id="7501362">Fprintf</span><span class="op" id="7501369">(</span><span class="ident" id="7501370">w</span><span class="op" id="7501371">,</span>&nbsp;<span class="string" id="7501373">&#34;%04x%04x%04x&nbsp;&#34;</span><span class="op" id="7501388">,</span>&nbsp;<span class="ident" id="7501390">rgba64</span><span class="op" id="7501396">.</span><span class="ident" id="7501397">R</span><span class="op" id="7501398">,</span>&nbsp;<span class="ident" id="7501400">rgba64</span><span class="op" id="7501406">.</span><span class="ident" id="7501407">G</span><span class="op" id="7501408">,</span>&nbsp;<span class="ident" id="7501410">rgba64</span><span class="op" id="7501416">.</span><span class="ident" id="7501417">B</span><span class="op" id="7501418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7501423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7501427">case</span>&nbsp;<span class="ident" id="7501432">cm</span>&nbsp;<span class="op" id="7501435">==</span>&nbsp;<span class="ident" id="7501438">color</span><span class="op" id="7501443">.</span><span class="ident" id="7501444">NRGBAModel</span><span class="op" id="7501454">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7501459">for</span>&nbsp;<span class="ident" id="7501463">x</span>&nbsp;<span class="op" id="7501465">:=</span>&nbsp;<span class="ident" id="7501468">bounds</span><span class="op" id="7501474">.</span><span class="ident" id="7501475">Min</span><span class="op" id="7501478">.</span><span class="ident" id="7501479">X</span><span class="op" id="7501480">;</span>&nbsp;<span class="ident" id="7501482">x</span>&nbsp;<span class="op" id="7501484">&lt;</span>&nbsp;<span class="ident" id="7501486">bounds</span><span class="op" id="7501492">.</span><span class="ident" id="7501493">Max</span><span class="op" id="7501496">.</span><span class="ident" id="7501497">X</span><span class="op" id="7501498">;</span>&nbsp;<span class="ident" id="7501500">x</span><span class="op" id="7501501">++</span>&nbsp;<span class="op" id="7501504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7501510">nrgba</span>&nbsp;<span class="op" id="7501516">:=</span>&nbsp;<span class="ident" id="7501519">png</span><span class="op" id="7501522">.</span><span class="ident" id="7501523">At</span><span class="op" id="7501525">(</span><span class="ident" id="7501526">x</span><span class="op" id="7501527">,</span>&nbsp;<span class="ident" id="7501529">y</span><span class="op" id="7501530">)</span><span class="op" id="7501531">.</span><span class="op" id="7501532">(</span><span class="ident" id="7501533">color</span><span class="op" id="7501538">.</span><span class="ident" id="7501539">NRGBA</span><span class="op" id="7501544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7501550">fmt</span><span class="op" id="7501553">.</span><span class="ident" id="7501554">Fprintf</span><span class="op" id="7501561">(</span><span class="ident" id="7501562">w</span><span class="op" id="7501563">,</span>&nbsp;<span class="string" id="7501565">&#34;%02x%02x%02x%02x&nbsp;&#34;</span><span class="op" id="7501584">,</span>&nbsp;<span class="ident" id="7501586">nrgba</span><span class="op" id="7501591">.</span><span class="ident" id="7501592">R</span><span class="op" id="7501593">,</span>&nbsp;<span class="ident" id="7501595">nrgba</span><span class="op" id="7501600">.</span><span class="ident" id="7501601">G</span><span class="op" id="7501602">,</span>&nbsp;<span class="ident" id="7501604">nrgba</span><span class="op" id="7501609">.</span><span class="ident" id="7501610">B</span><span class="op" id="7501611">,</span>&nbsp;<span class="ident" id="7501613">nrgba</span><span class="op" id="7501618">.</span><span class="ident" id="7501619">A</span><span class="op" id="7501620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7501625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7501629">case</span>&nbsp;<span class="ident" id="7501634">cm</span>&nbsp;<span class="op" id="7501637">==</span>&nbsp;<span class="ident" id="7501640">color</span><span class="op" id="7501645">.</span><span class="ident" id="7501646">NRGBA64Model</span><span class="op" id="7501658">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7501663">for</span>&nbsp;<span class="ident" id="7501667">x</span>&nbsp;<span class="op" id="7501669">:=</span>&nbsp;<span class="ident" id="7501672">bounds</span><span class="op" id="7501678">.</span><span class="ident" id="7501679">Min</span><span class="op" id="7501682">.</span><span class="ident" id="7501683">X</span><span class="op" id="7501684">;</span>&nbsp;<span class="ident" id="7501686">x</span>&nbsp;<span class="op" id="7501688">&lt;</span>&nbsp;<span class="ident" id="7501690">bounds</span><span class="op" id="7501696">.</span><span class="ident" id="7501697">Max</span><span class="op" id="7501700">.</span><span class="ident" id="7501701">X</span><span class="op" id="7501702">;</span>&nbsp;<span class="ident" id="7501704">x</span><span class="op" id="7501705">++</span>&nbsp;<span class="op" id="7501708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7501714">nrgba64</span>&nbsp;<span class="op" id="7501722">:=</span>&nbsp;<span class="ident" id="7501725">png</span><span class="op" id="7501728">.</span><span class="ident" id="7501729">At</span><span class="op" id="7501731">(</span><span class="ident" id="7501732">x</span><span class="op" id="7501733">,</span>&nbsp;<span class="ident" id="7501735">y</span><span class="op" id="7501736">)</span><span class="op" id="7501737">.</span><span class="op" id="7501738">(</span><span class="ident" id="7501739">color</span><span class="op" id="7501744">.</span><span class="ident" id="7501745">NRGBA64</span><span class="op" id="7501752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7501758">fmt</span><span class="op" id="7501761">.</span><span class="ident" id="7501762">Fprintf</span><span class="op" id="7501769">(</span><span class="ident" id="7501770">w</span><span class="op" id="7501771">,</span>&nbsp;<span class="string" id="7501773">&#34;%04x%04x%04x%04x&nbsp;&#34;</span><span class="op" id="7501792">,</span>&nbsp;<span class="ident" id="7501794">nrgba64</span><span class="op" id="7501801">.</span><span class="ident" id="7501802">R</span><span class="op" id="7501803">,</span>&nbsp;<span class="ident" id="7501805">nrgba64</span><span class="op" id="7501812">.</span><span class="ident" id="7501813">G</span><span class="op" id="7501814">,</span>&nbsp;<span class="ident" id="7501816">nrgba64</span><span class="op" id="7501823">.</span><span class="ident" id="7501824">B</span><span class="op" id="7501825">,</span>&nbsp;<span class="ident" id="7501827">nrgba64</span><span class="op" id="7501834">.</span><span class="ident" id="7501835">A</span><span class="op" id="7501836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7501841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7501845">case</span>&nbsp;<span class="ident" id="7501850">cpm</span>&nbsp;<span class="op" id="7501854">!=</span>&nbsp;<span class="ident" id="7501857">nil</span><span class="op" id="7501860">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7501865">var</span>&nbsp;<span class="ident" id="7501869">b</span><span class="op" id="7501870">,</span>&nbsp;<span class="ident" id="7501872">c</span>&nbsp;<span class="builtintype" id="7501874">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7501881">for</span>&nbsp;<span class="ident" id="7501885">x</span>&nbsp;<span class="op" id="7501887">:=</span>&nbsp;<span class="ident" id="7501890">bounds</span><span class="op" id="7501896">.</span><span class="ident" id="7501897">Min</span><span class="op" id="7501900">.</span><span class="ident" id="7501901">X</span><span class="op" id="7501902">;</span>&nbsp;<span class="ident" id="7501904">x</span>&nbsp;<span class="op" id="7501906">&lt;</span>&nbsp;<span class="ident" id="7501908">bounds</span><span class="op" id="7501914">.</span><span class="ident" id="7501915">Max</span><span class="op" id="7501918">.</span><span class="ident" id="7501919">X</span><span class="op" id="7501920">;</span>&nbsp;<span class="ident" id="7501922">x</span><span class="op" id="7501923">++</span>&nbsp;<span class="op" id="7501926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7501932">b</span>&nbsp;<span class="op" id="7501934">=</span>&nbsp;<span class="ident" id="7501936">b</span><span class="op" id="7501937">&lt;&lt;</span><span class="builtintype" id="7501939">uint</span><span class="op" id="7501943">(</span><span class="ident" id="7501944">bitdepth</span><span class="op" id="7501952">)</span>&nbsp;<span class="op" id="7501954">|</span>&nbsp;<span class="builtintype" id="7501956">int</span><span class="op" id="7501959">(</span><span class="ident" id="7501960">paletted</span><span class="op" id="7501968">.</span><span class="ident" id="7501969">ColorIndexAt</span><span class="op" id="7501981">(</span><span class="ident" id="7501982">x</span><span class="op" id="7501983">,</span>&nbsp;<span class="ident" id="7501985">y</span><span class="op" id="7501986">)</span><span class="op" id="7501987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7501993">c</span><span class="op" id="7501994">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7502001">if</span>&nbsp;<span class="ident" id="7502004">c</span>&nbsp;<span class="op" id="7502006">==</span>&nbsp;<span class="num" id="7502009">8</span><span class="op" id="7502010">/</span><span class="ident" id="7502011">bitdepth</span>&nbsp;<span class="op" id="7502020">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7502027">fmt</span><span class="op" id="7502030">.</span><span class="ident" id="7502031">Fprintf</span><span class="op" id="7502038">(</span><span class="ident" id="7502039">w</span><span class="op" id="7502040">,</span>&nbsp;<span class="string" id="7502042">&#34;%02x&#34;</span><span class="op" id="7502048">,</span>&nbsp;<span class="ident" id="7502050">b</span><span class="op" id="7502051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7502058">b</span>&nbsp;<span class="op" id="7502060">=</span>&nbsp;<span class="num" id="7502062">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7502069">c</span>&nbsp;<span class="op" id="7502071">=</span>&nbsp;<span class="num" id="7502073">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7502079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7502084">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7502089">if</span>&nbsp;<span class="ident" id="7502092">c</span>&nbsp;<span class="op" id="7502094">!=</span>&nbsp;<span class="num" id="7502097">0</span>&nbsp;<span class="op" id="7502099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7502105">for</span>&nbsp;<span class="ident" id="7502109">c</span>&nbsp;<span class="op" id="7502111">!=</span>&nbsp;<span class="num" id="7502114">8</span><span class="op" id="7502115">/</span><span class="ident" id="7502116">bitdepth</span>&nbsp;<span class="op" id="7502125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7502132">b</span>&nbsp;<span class="op" id="7502134">=</span>&nbsp;<span class="ident" id="7502136">b</span>&nbsp;<span class="op" id="7502138">&lt;&lt;</span>&nbsp;<span class="builtintype" id="7502141">uint</span><span class="op" id="7502145">(</span><span class="ident" id="7502146">bitdepth</span><span class="op" id="7502154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7502161">c</span><span class="op" id="7502162">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7502169">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7502175">fmt</span><span class="op" id="7502178">.</span><span class="ident" id="7502179">Fprintf</span><span class="op" id="7502186">(</span><span class="ident" id="7502187">w</span><span class="op" id="7502188">,</span>&nbsp;<span class="string" id="7502190">&#34;%02x&#34;</span><span class="op" id="7502196">,</span>&nbsp;<span class="ident" id="7502198">b</span><span class="op" id="7502199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7502204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7502208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7502212">io</span><span class="op" id="7502214">.</span><span class="ident" id="7502215">WriteString</span><span class="op" id="7502226">(</span><span class="ident" id="7502227">w</span><span class="op" id="7502228">,</span>&nbsp;<span class="string" id="7502230">&#34;\n&#34;</span><span class="op" id="7502234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7502237">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7502240">io</span><span class="op" id="7502242">.</span><span class="ident" id="7502243">WriteString</span><span class="op" id="7502254">(</span><span class="ident" id="7502255">w</span><span class="op" id="7502256">,</span>&nbsp;<span class="string" id="7502258">&#34;}\n&#34;</span><span class="op" id="7502263">)</span><br>
<span class="lineno"></span><span class="op" id="7502265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7502268">func</span>&nbsp;<span class="ident" id="7502273">TestReader</span><span class="op" id="7502283">(</span><span class="ident" id="7502284">t</span>&nbsp;<span class="op" id="7502286">*</span><span class="ident" id="7502287">testing</span><span class="op" id="7502294">.</span><span class="ident" id="7502295">T</span><span class="op" id="7502296">)</span>&nbsp;<span class="op" id="7502298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7502301">names</span>&nbsp;<span class="op" id="7502307">:=</span>&nbsp;<span class="ident" id="7502310">filenames</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7502321">if</span>&nbsp;<span class="ident" id="7502324">testing</span><span class="op" id="7502331">.</span><span class="ident" id="7502332">Short</span><span class="op" id="7502337">(</span><span class="op" id="7502338">)</span>&nbsp;<span class="op" id="7502340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7502344">names</span>&nbsp;<span class="op" id="7502350">=</span>&nbsp;<span class="ident" id="7502352">filenamesShort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7502368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7502371">for</span>&nbsp;<span class="ident" id="7502375">_</span><span class="op" id="7502376">,</span>&nbsp;<span class="ident" id="7502378">fn</span>&nbsp;<span class="op" id="7502381">:=</span>&nbsp;<span class="keyword" id="7502384">range</span>&nbsp;<span class="ident" id="7502390">names</span>&nbsp;<span class="op" id="7502396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7502400">//&nbsp;Read&nbsp;the&nbsp;.png&nbsp;file.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7502425">img</span><span class="op" id="7502428">,</span>&nbsp;<span class="ident" id="7502430">err</span>&nbsp;<span class="op" id="7502434">:=</span>&nbsp;<span class="ident" id="7502437">readPNG</span><span class="op" id="7502444">(</span><span class="string" id="7502445">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="7502466">+</span>&nbsp;<span class="ident" id="7502468">fn</span>&nbsp;<span class="op" id="7502471">+</span>&nbsp;<span class="string" id="7502473">&#34;.png&#34;</span><span class="op" id="7502479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7502483">if</span>&nbsp;<span class="ident" id="7502486">err</span>&nbsp;<span class="op" id="7502490">!=</span>&nbsp;<span class="ident" id="7502493">nil</span>&nbsp;<span class="op" id="7502497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7502502">t</span><span class="op" id="7502503">.</span><span class="ident" id="7502504">Error</span><span class="op" id="7502509">(</span><span class="ident" id="7502510">fn</span><span class="op" id="7502512">,</span>&nbsp;<span class="ident" id="7502514">err</span><span class="op" id="7502517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7502522">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7502533">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7502538">if</span>&nbsp;<span class="ident" id="7502541">fn</span>&nbsp;<span class="op" id="7502544">==</span>&nbsp;<span class="string" id="7502547">&#34;basn4a16&#34;</span>&nbsp;<span class="op" id="7502558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7502563">//&nbsp;basn4a16.sng&nbsp;is&nbsp;gray&nbsp;+&nbsp;alpha&nbsp;but&nbsp;sng()&nbsp;will&nbsp;produce&nbsp;true&nbsp;color&nbsp;+&nbsp;alpha</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7502640">//&nbsp;so&nbsp;we&nbsp;just&nbsp;check&nbsp;a&nbsp;single&nbsp;random&nbsp;pixel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7502686">c</span>&nbsp;<span class="op" id="7502688">:=</span>&nbsp;<span class="ident" id="7502691">img</span><span class="op" id="7502694">.</span><span class="ident" id="7502695">At</span><span class="op" id="7502697">(</span><span class="num" id="7502698">2</span><span class="op" id="7502699">,</span>&nbsp;<span class="num" id="7502701">1</span><span class="op" id="7502702">)</span><span class="op" id="7502703">.</span><span class="op" id="7502704">(</span><span class="ident" id="7502705">color</span><span class="op" id="7502710">.</span><span class="ident" id="7502711">NRGBA64</span><span class="op" id="7502718">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7502723">if</span>&nbsp;<span class="ident" id="7502726">c</span><span class="op" id="7502727">.</span><span class="ident" id="7502728">R</span>&nbsp;<span class="op" id="7502730">!=</span>&nbsp;<span class="num" id="7502733">0x11a7</span>&nbsp;<span class="op" id="7502740">||</span>&nbsp;<span class="ident" id="7502743">c</span><span class="op" id="7502744">.</span><span class="ident" id="7502745">G</span>&nbsp;<span class="op" id="7502747">!=</span>&nbsp;<span class="num" id="7502750">0x11a7</span>&nbsp;<span class="op" id="7502757">||</span>&nbsp;<span class="ident" id="7502760">c</span><span class="op" id="7502761">.</span><span class="ident" id="7502762">B</span>&nbsp;<span class="op" id="7502764">!=</span>&nbsp;<span class="num" id="7502767">0x11a7</span>&nbsp;<span class="op" id="7502774">||</span>&nbsp;<span class="ident" id="7502777">c</span><span class="op" id="7502778">.</span><span class="ident" id="7502779">A</span>&nbsp;<span class="op" id="7502781">!=</span>&nbsp;<span class="num" id="7502784">0x1085</span>&nbsp;<span class="op" id="7502791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7502797">t</span><span class="op" id="7502798">.</span><span class="ident" id="7502799">Error</span><span class="op" id="7502804">(</span><span class="ident" id="7502805">fn</span><span class="op" id="7502807">,</span>&nbsp;<span class="ident" id="7502809">fmt</span><span class="op" id="7502812">.</span><span class="ident" id="7502813">Errorf</span><span class="op" id="7502819">(</span><span class="string" id="7502820">&#34;wrong&nbsp;pixel&nbsp;value&nbsp;at&nbsp;(2,&nbsp;1):&nbsp;%x&#34;</span><span class="op" id="7502853">,</span>&nbsp;<span class="ident" id="7502855">c</span><span class="op" id="7502856">)</span><span class="op" id="7502857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7502862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7502867">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7502878">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7502883">piper</span><span class="op" id="7502888">,</span>&nbsp;<span class="ident" id="7502890">pipew</span>&nbsp;<span class="op" id="7502896">:=</span>&nbsp;<span class="ident" id="7502899">io</span><span class="op" id="7502901">.</span><span class="ident" id="7502902">Pipe</span><span class="op" id="7502906">(</span><span class="op" id="7502907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7502911">pb</span>&nbsp;<span class="op" id="7502914">:=</span>&nbsp;<span class="ident" id="7502917">bufio</span><span class="op" id="7502922">.</span><span class="ident" id="7502923">NewScanner</span><span class="op" id="7502933">(</span><span class="ident" id="7502934">piper</span><span class="op" id="7502939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7502943">go</span>&nbsp;<span class="ident" id="7502946">sng</span><span class="op" id="7502949">(</span><span class="ident" id="7502950">pipew</span><span class="op" id="7502955">,</span>&nbsp;<span class="ident" id="7502957">fn</span><span class="op" id="7502959">,</span>&nbsp;<span class="ident" id="7502961">img</span><span class="op" id="7502964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7502968">defer</span>&nbsp;<span class="ident" id="7502974">piper</span><span class="op" id="7502979">.</span><span class="ident" id="7502980">Close</span><span class="op" id="7502985">(</span><span class="op" id="7502986">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7502991">//&nbsp;Read&nbsp;the&nbsp;.sng&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7503016">sf</span><span class="op" id="7503018">,</span>&nbsp;<span class="ident" id="7503020">err</span>&nbsp;<span class="op" id="7503024">:=</span>&nbsp;<span class="ident" id="7503027">os</span><span class="op" id="7503029">.</span><span class="ident" id="7503030">Open</span><span class="op" id="7503034">(</span><span class="string" id="7503035">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="7503056">+</span>&nbsp;<span class="ident" id="7503058">fn</span>&nbsp;<span class="op" id="7503061">+</span>&nbsp;<span class="string" id="7503063">&#34;.sng&#34;</span><span class="op" id="7503069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7503073">if</span>&nbsp;<span class="ident" id="7503076">err</span>&nbsp;<span class="op" id="7503080">!=</span>&nbsp;<span class="ident" id="7503083">nil</span>&nbsp;<span class="op" id="7503087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7503092">t</span><span class="op" id="7503093">.</span><span class="ident" id="7503094">Error</span><span class="op" id="7503099">(</span><span class="ident" id="7503100">fn</span><span class="op" id="7503102">,</span>&nbsp;<span class="ident" id="7503104">err</span><span class="op" id="7503107">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7503112">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7503123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7503127">defer</span>&nbsp;<span class="ident" id="7503133">sf</span><span class="op" id="7503135">.</span><span class="ident" id="7503136">Close</span><span class="op" id="7503141">(</span><span class="op" id="7503142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7503146">sb</span>&nbsp;<span class="op" id="7503149">:=</span>&nbsp;<span class="ident" id="7503152">bufio</span><span class="op" id="7503157">.</span><span class="ident" id="7503158">NewScanner</span><span class="op" id="7503168">(</span><span class="ident" id="7503169">sf</span><span class="op" id="7503171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7503175">if</span>&nbsp;<span class="ident" id="7503178">err</span>&nbsp;<span class="op" id="7503182">!=</span>&nbsp;<span class="ident" id="7503185">nil</span>&nbsp;<span class="op" id="7503189">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7503194">t</span><span class="op" id="7503195">.</span><span class="ident" id="7503196">Error</span><span class="op" id="7503201">(</span><span class="ident" id="7503202">fn</span><span class="op" id="7503204">,</span>&nbsp;<span class="ident" id="7503206">err</span><span class="op" id="7503209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7503214">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7503225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7503230">//&nbsp;Compare&nbsp;the&nbsp;two,&nbsp;in&nbsp;SNG&nbsp;format,&nbsp;line&nbsp;by&nbsp;line.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7503281">for</span>&nbsp;<span class="op" id="7503285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7503290">pdone</span>&nbsp;<span class="op" id="7503296">:=</span>&nbsp;<span class="op" id="7503299">!</span><span class="ident" id="7503300">pb</span><span class="op" id="7503302">.</span><span class="ident" id="7503303">Scan</span><span class="op" id="7503307">(</span><span class="op" id="7503308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7503313">sdone</span>&nbsp;<span class="op" id="7503319">:=</span>&nbsp;<span class="op" id="7503322">!</span><span class="ident" id="7503323">sb</span><span class="op" id="7503325">.</span><span class="ident" id="7503326">Scan</span><span class="op" id="7503330">(</span><span class="op" id="7503331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7503336">if</span>&nbsp;<span class="ident" id="7503339">pdone</span>&nbsp;<span class="op" id="7503345">&amp;&amp;</span>&nbsp;<span class="ident" id="7503348">sdone</span>&nbsp;<span class="op" id="7503354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7503360">break</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7503369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7503374">if</span>&nbsp;<span class="ident" id="7503377">pdone</span>&nbsp;<span class="op" id="7503383">||</span>&nbsp;<span class="ident" id="7503386">sdone</span>&nbsp;<span class="op" id="7503392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7503398">t</span><span class="op" id="7503399">.</span><span class="ident" id="7503400">Errorf</span><span class="op" id="7503406">(</span><span class="string" id="7503407">&#34;%s:&nbsp;Different&nbsp;sizes&#34;</span><span class="op" id="7503428">,</span>&nbsp;<span class="ident" id="7503430">fn</span><span class="op" id="7503432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7503438">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7503447">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7503452">ps</span>&nbsp;<span class="op" id="7503455">:=</span>&nbsp;<span class="ident" id="7503458">pb</span><span class="op" id="7503460">.</span><span class="ident" id="7503461">Text</span><span class="op" id="7503465">(</span><span class="op" id="7503466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7503471">ss</span>&nbsp;<span class="op" id="7503474">:=</span>&nbsp;<span class="ident" id="7503477">sb</span><span class="op" id="7503479">.</span><span class="ident" id="7503480">Text</span><span class="op" id="7503484">(</span><span class="op" id="7503485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7503490">if</span>&nbsp;<span class="ident" id="7503493">ps</span>&nbsp;<span class="op" id="7503496">!=</span>&nbsp;<span class="ident" id="7503499">ss</span>&nbsp;<span class="op" id="7503502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7503508">t</span><span class="op" id="7503509">.</span><span class="ident" id="7503510">Errorf</span><span class="op" id="7503516">(</span><span class="string" id="7503517">&#34;%s:&nbsp;Mismatch\n%sversus\n%s\n&#34;</span><span class="op" id="7503547">,</span>&nbsp;<span class="ident" id="7503549">fn</span><span class="op" id="7503551">,</span>&nbsp;<span class="ident" id="7503553">ps</span><span class="op" id="7503555">,</span>&nbsp;<span class="ident" id="7503557">ss</span><span class="op" id="7503559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7503565">break</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7503574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7503578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7503582">if</span>&nbsp;<span class="ident" id="7503585">pb</span><span class="op" id="7503587">.</span><span class="ident" id="7503588">Err</span><span class="op" id="7503591">(</span><span class="op" id="7503592">)</span>&nbsp;<span class="op" id="7503594">!=</span>&nbsp;<span class="ident" id="7503597">nil</span>&nbsp;<span class="op" id="7503601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7503606">t</span><span class="op" id="7503607">.</span><span class="ident" id="7503608">Error</span><span class="op" id="7503613">(</span><span class="ident" id="7503614">fn</span><span class="op" id="7503616">,</span>&nbsp;<span class="ident" id="7503618">pb</span><span class="op" id="7503620">.</span><span class="ident" id="7503621">Err</span><span class="op" id="7503624">(</span><span class="op" id="7503625">)</span><span class="op" id="7503626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7503630">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7503634">if</span>&nbsp;<span class="ident" id="7503637">sb</span><span class="op" id="7503639">.</span><span class="ident" id="7503640">Err</span><span class="op" id="7503643">(</span><span class="op" id="7503644">)</span>&nbsp;<span class="op" id="7503646">!=</span>&nbsp;<span class="ident" id="7503649">nil</span>&nbsp;<span class="op" id="7503653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7503658">t</span><span class="op" id="7503659">.</span><span class="ident" id="7503660">Error</span><span class="op" id="7503665">(</span><span class="ident" id="7503666">fn</span><span class="op" id="7503668">,</span>&nbsp;<span class="ident" id="7503670">sb</span><span class="op" id="7503672">.</span><span class="ident" id="7503673">Err</span><span class="op" id="7503676">(</span><span class="op" id="7503677">)</span><span class="op" id="7503678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7503682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7503685">}</span><br>
<span class="lineno"></span><span class="op" id="7503687">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="7503690">var</span>&nbsp;<span class="ident" id="7503694">readerErrors</span>&nbsp;<span class="op" id="7503707">=</span>&nbsp;<span class="op" id="7503709">[</span><span class="op" id="7503710">]</span><span class="keyword" id="7503711">struct</span>&nbsp;<span class="op" id="7503718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7503721">file</span>&nbsp;<span class="builtintype" id="7503726">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7503734">err</span>&nbsp;&nbsp;<span class="builtintype" id="7503739">string</span><br>
<span class="lineno"></span><span class="op" id="7503746">}</span><span class="op" id="7503747">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7503750">{</span><span class="string" id="7503751">&#34;invalid-zlib.png&#34;</span><span class="op" id="7503769">,</span>&nbsp;<span class="string" id="7503771">&#34;zlib:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="7503795">}</span><span class="op" id="7503796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7503799">{</span><span class="string" id="7503800">&#34;invalid-crc32.png&#34;</span><span class="op" id="7503819">,</span>&nbsp;<span class="string" id="7503821">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="7503839">}</span><span class="op" id="7503840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7503843">{</span><span class="string" id="7503844">&#34;invalid-noend.png&#34;</span><span class="op" id="7503863">,</span>&nbsp;<span class="string" id="7503865">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="7503881">}</span><span class="op" id="7503882">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7503885">{</span><span class="string" id="7503886">&#34;invalid-trunc.png&#34;</span><span class="op" id="7503905">,</span>&nbsp;<span class="string" id="7503907">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="7503923">}</span><span class="op" id="7503924">,</span><br>
<span class="lineno"></span><span class="op" id="7503926">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="7503929">func</span>&nbsp;<span class="ident" id="7503934">TestReaderError</span><span class="op" id="7503949">(</span><span class="ident" id="7503950">t</span>&nbsp;<span class="op" id="7503952">*</span><span class="ident" id="7503953">testing</span><span class="op" id="7503960">.</span><span class="ident" id="7503961">T</span><span class="op" id="7503962">)</span>&nbsp;<span class="op" id="7503964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7503967">for</span>&nbsp;<span class="ident" id="7503971">_</span><span class="op" id="7503972">,</span>&nbsp;<span class="ident" id="7503974">tt</span>&nbsp;<span class="op" id="7503977">:=</span>&nbsp;<span class="keyword" id="7503980">range</span>&nbsp;<span class="ident" id="7503986">readerErrors</span>&nbsp;<span class="op" id="7503999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7504003">img</span><span class="op" id="7504006">,</span>&nbsp;<span class="ident" id="7504008">err</span>&nbsp;<span class="op" id="7504012">:=</span>&nbsp;<span class="ident" id="7504015">readPNG</span><span class="op" id="7504022">(</span><span class="string" id="7504023">&#34;testdata/&#34;</span>&nbsp;<span class="op" id="7504035">+</span>&nbsp;<span class="ident" id="7504037">tt</span><span class="op" id="7504039">.</span><span class="ident" id="7504040">file</span><span class="op" id="7504044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7504048">if</span>&nbsp;<span class="ident" id="7504051">err</span>&nbsp;<span class="op" id="7504055">==</span>&nbsp;<span class="ident" id="7504058">nil</span>&nbsp;<span class="op" id="7504062">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7504067">t</span><span class="op" id="7504068">.</span><span class="ident" id="7504069">Errorf</span><span class="op" id="7504075">(</span><span class="string" id="7504076">&#34;decoding&nbsp;%s:&nbsp;missing&nbsp;error&#34;</span><span class="op" id="7504104">,</span>&nbsp;<span class="ident" id="7504106">tt</span><span class="op" id="7504108">.</span><span class="ident" id="7504109">file</span><span class="op" id="7504113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7504118">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7504129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7504133">if</span>&nbsp;<span class="op" id="7504136">!</span><span class="ident" id="7504137">strings</span><span class="op" id="7504144">.</span><span class="ident" id="7504145">Contains</span><span class="op" id="7504153">(</span><span class="ident" id="7504154">err</span><span class="op" id="7504157">.</span><span class="ident" id="7504158">Error</span><span class="op" id="7504163">(</span><span class="op" id="7504164">)</span><span class="op" id="7504165">,</span>&nbsp;<span class="ident" id="7504167">tt</span><span class="op" id="7504169">.</span><span class="ident" id="7504170">err</span><span class="op" id="7504173">)</span>&nbsp;<span class="op" id="7504175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7504180">t</span><span class="op" id="7504181">.</span><span class="ident" id="7504182">Errorf</span><span class="op" id="7504188">(</span><span class="string" id="7504189">&#34;decoding&nbsp;%s:&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7504215">,</span>&nbsp;<span class="ident" id="7504217">tt</span><span class="op" id="7504219">.</span><span class="ident" id="7504220">file</span><span class="op" id="7504224">,</span>&nbsp;<span class="ident" id="7504226">err</span><span class="op" id="7504229">,</span>&nbsp;<span class="ident" id="7504231">tt</span><span class="op" id="7504233">.</span><span class="ident" id="7504234">err</span><span class="op" id="7504237">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7504241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7504245">if</span>&nbsp;<span class="ident" id="7504248">img</span>&nbsp;<span class="op" id="7504252">!=</span>&nbsp;<span class="ident" id="7504255">nil</span>&nbsp;<span class="op" id="7504259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7504264">t</span><span class="op" id="7504265">.</span><span class="ident" id="7504266">Errorf</span><span class="op" id="7504272">(</span><span class="string" id="7504273">&#34;decoding&nbsp;%s:&nbsp;have&nbsp;image&nbsp;+&nbsp;error&#34;</span><span class="op" id="7504306">,</span>&nbsp;<span class="ident" id="7504308">tt</span><span class="op" id="7504310">.</span><span class="ident" id="7504311">file</span><span class="op" id="7504315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7504319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7504322">}</span><br>
<span class="lineno">295</span><span class="op" id="7504324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7504327">func</span>&nbsp;<span class="ident" id="7504332">TestPalettedDecodeConfig</span><span class="op" id="7504356">(</span><span class="ident" id="7504357">t</span>&nbsp;<span class="op" id="7504359">*</span><span class="ident" id="7504360">testing</span><span class="op" id="7504367">.</span><span class="ident" id="7504368">T</span><span class="op" id="7504369">)</span>&nbsp;<span class="op" id="7504371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7504374">for</span>&nbsp;<span class="ident" id="7504378">_</span><span class="op" id="7504379">,</span>&nbsp;<span class="ident" id="7504381">fn</span>&nbsp;<span class="op" id="7504384">:=</span>&nbsp;<span class="keyword" id="7504387">range</span>&nbsp;<span class="ident" id="7504393">filenamesPaletted</span>&nbsp;<span class="op" id="7504411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7504415">f</span><span class="op" id="7504416">,</span>&nbsp;<span class="ident" id="7504418">err</span>&nbsp;<span class="op" id="7504422">:=</span>&nbsp;<span class="ident" id="7504425">os</span><span class="op" id="7504427">.</span><span class="ident" id="7504428">Open</span><span class="op" id="7504432">(</span><span class="string" id="7504433">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="7504454">+</span>&nbsp;<span class="ident" id="7504456">fn</span>&nbsp;<span class="op" id="7504459">+</span>&nbsp;<span class="string" id="7504461">&#34;.png&#34;</span><span class="op" id="7504467">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7504471">if</span>&nbsp;<span class="ident" id="7504474">err</span>&nbsp;<span class="op" id="7504478">!=</span>&nbsp;<span class="ident" id="7504481">nil</span>&nbsp;<span class="op" id="7504485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7504490">t</span><span class="op" id="7504491">.</span><span class="ident" id="7504492">Errorf</span><span class="op" id="7504498">(</span><span class="string" id="7504499">&#34;%s:&nbsp;open&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7504520">,</span>&nbsp;<span class="ident" id="7504522">fn</span><span class="op" id="7504524">,</span>&nbsp;<span class="ident" id="7504526">err</span><span class="op" id="7504529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7504534">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7504545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7504549">defer</span>&nbsp;<span class="ident" id="7504555">f</span><span class="op" id="7504556">.</span><span class="ident" id="7504557">Close</span><span class="op" id="7504562">(</span><span class="op" id="7504563">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7504567">cfg</span><span class="op" id="7504570">,</span>&nbsp;<span class="ident" id="7504572">err</span>&nbsp;<span class="op" id="7504576">:=</span>&nbsp;<span class="ident" id="7504579">DecodeConfig</span><span class="op" id="7504591">(</span><span class="ident" id="7504592">f</span><span class="op" id="7504593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7504597">if</span>&nbsp;<span class="ident" id="7504600">err</span>&nbsp;<span class="op" id="7504604">!=</span>&nbsp;<span class="ident" id="7504607">nil</span>&nbsp;<span class="op" id="7504611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7504616">t</span><span class="op" id="7504617">.</span><span class="ident" id="7504618">Errorf</span><span class="op" id="7504624">(</span><span class="string" id="7504625">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7504633">,</span>&nbsp;<span class="ident" id="7504635">fn</span><span class="op" id="7504637">,</span>&nbsp;<span class="ident" id="7504639">err</span><span class="op" id="7504642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7504647">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7504658">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7504662">pal</span><span class="op" id="7504665">,</span>&nbsp;<span class="ident" id="7504667">ok</span>&nbsp;<span class="op" id="7504670">:=</span>&nbsp;<span class="ident" id="7504673">cfg</span><span class="op" id="7504676">.</span><span class="ident" id="7504677">ColorModel</span><span class="op" id="7504687">.</span><span class="op" id="7504688">(</span><span class="ident" id="7504689">color</span><span class="op" id="7504694">.</span><span class="ident" id="7504695">Palette</span><span class="op" id="7504702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7504706">if</span>&nbsp;<span class="op" id="7504709">!</span><span class="ident" id="7504710">ok</span>&nbsp;<span class="op" id="7504713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7504718">t</span><span class="op" id="7504719">.</span><span class="ident" id="7504720">Errorf</span><span class="op" id="7504726">(</span><span class="string" id="7504727">&#34;%s:&nbsp;expected&nbsp;paletted&nbsp;color&nbsp;model&#34;</span><span class="op" id="7504762">,</span>&nbsp;<span class="ident" id="7504764">fn</span><span class="op" id="7504766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7504771">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7504782">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7504786">if</span>&nbsp;<span class="ident" id="7504789">pal</span>&nbsp;<span class="op" id="7504793">==</span>&nbsp;<span class="ident" id="7504796">nil</span>&nbsp;<span class="op" id="7504800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7504805">t</span><span class="op" id="7504806">.</span><span class="ident" id="7504807">Errorf</span><span class="op" id="7504813">(</span><span class="string" id="7504814">&#34;%s:&nbsp;palette&nbsp;not&nbsp;initialized&#34;</span><span class="op" id="7504843">,</span>&nbsp;<span class="ident" id="7504845">fn</span><span class="op" id="7504847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7504852">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7504863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7504866">}</span><br>
<span class="lineno">320</span><span class="op" id="7504868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7504871">func</span>&nbsp;<span class="ident" id="7504876">benchmarkDecode</span><span class="op" id="7504891">(</span><span class="ident" id="7504892">b</span>&nbsp;<span class="op" id="7504894">*</span><span class="ident" id="7504895">testing</span><span class="op" id="7504902">.</span><span class="ident" id="7504903">B</span><span class="op" id="7504904">,</span>&nbsp;<span class="ident" id="7504906">filename</span>&nbsp;<span class="builtintype" id="7504915">string</span><span class="op" id="7504921">,</span>&nbsp;<span class="ident" id="7504923">bytesPerPixel</span>&nbsp;<span class="builtintype" id="7504937">int</span><span class="op" id="7504940">)</span>&nbsp;<span class="op" id="7504942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7504945">b</span><span class="op" id="7504946">.</span><span class="ident" id="7504947">StopTimer</span><span class="op" id="7504956">(</span><span class="op" id="7504957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7504960">data</span><span class="op" id="7504964">,</span>&nbsp;<span class="ident" id="7504966">err</span>&nbsp;<span class="op" id="7504970">:=</span>&nbsp;<span class="ident" id="7504973">ioutil</span><span class="op" id="7504979">.</span><span class="ident" id="7504980">ReadFile</span><span class="op" id="7504988">(</span><span class="ident" id="7504989">filename</span><span class="op" id="7504997">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7505000">if</span>&nbsp;<span class="ident" id="7505003">err</span>&nbsp;<span class="op" id="7505007">!=</span>&nbsp;<span class="ident" id="7505010">nil</span>&nbsp;<span class="op" id="7505014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7505018">b</span><span class="op" id="7505019">.</span><span class="ident" id="7505020">Fatal</span><span class="op" id="7505025">(</span><span class="ident" id="7505026">err</span><span class="op" id="7505029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7505032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7505035">s</span>&nbsp;<span class="op" id="7505037">:=</span>&nbsp;<span class="builtintype" id="7505040">string</span><span class="op" id="7505046">(</span><span class="ident" id="7505047">data</span><span class="op" id="7505051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7505054">cfg</span><span class="op" id="7505057">,</span>&nbsp;<span class="ident" id="7505059">err</span>&nbsp;<span class="op" id="7505063">:=</span>&nbsp;<span class="ident" id="7505066">DecodeConfig</span><span class="op" id="7505078">(</span><span class="ident" id="7505079">strings</span><span class="op" id="7505086">.</span><span class="ident" id="7505087">NewReader</span><span class="op" id="7505096">(</span><span class="ident" id="7505097">s</span><span class="op" id="7505098">)</span><span class="op" id="7505099">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7505102">if</span>&nbsp;<span class="ident" id="7505105">err</span>&nbsp;<span class="op" id="7505109">!=</span>&nbsp;<span class="ident" id="7505112">nil</span>&nbsp;<span class="op" id="7505116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7505120">b</span><span class="op" id="7505121">.</span><span class="ident" id="7505122">Fatal</span><span class="op" id="7505127">(</span><span class="ident" id="7505128">err</span><span class="op" id="7505131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7505134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7505137">b</span><span class="op" id="7505138">.</span><span class="ident" id="7505139">SetBytes</span><span class="op" id="7505147">(</span><span class="ident" id="7505148">int64</span><span class="op" id="7505153">(</span><span class="ident" id="7505154">cfg</span><span class="op" id="7505157">.</span><span class="ident" id="7505158">Width</span>&nbsp;<span class="op" id="7505164">*</span>&nbsp;<span class="ident" id="7505166">cfg</span><span class="op" id="7505169">.</span><span class="ident" id="7505170">Height</span>&nbsp;<span class="op" id="7505177">*</span>&nbsp;<span class="ident" id="7505179">bytesPerPixel</span><span class="op" id="7505192">)</span><span class="op" id="7505193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7505196">b</span><span class="op" id="7505197">.</span><span class="ident" id="7505198">StartTimer</span><span class="op" id="7505208">(</span><span class="op" id="7505209">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7505212">for</span>&nbsp;<span class="ident" id="7505216">i</span>&nbsp;<span class="op" id="7505218">:=</span>&nbsp;<span class="num" id="7505221">0</span><span class="op" id="7505222">;</span>&nbsp;<span class="ident" id="7505224">i</span>&nbsp;<span class="op" id="7505226">&lt;</span>&nbsp;<span class="ident" id="7505228">b</span><span class="op" id="7505229">.</span><span class="ident" id="7505230">N</span><span class="op" id="7505231">;</span>&nbsp;<span class="ident" id="7505233">i</span><span class="op" id="7505234">++</span>&nbsp;<span class="op" id="7505237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7505241">Decode</span><span class="op" id="7505247">(</span><span class="ident" id="7505248">strings</span><span class="op" id="7505255">.</span><span class="ident" id="7505256">NewReader</span><span class="op" id="7505265">(</span><span class="ident" id="7505266">s</span><span class="op" id="7505267">)</span><span class="op" id="7505268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7505271">}</span><br>
<span class="lineno"></span><span class="op" id="7505273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="7505276">func</span>&nbsp;<span class="ident" id="7505281">BenchmarkDecodeGray</span><span class="op" id="7505300">(</span><span class="ident" id="7505301">b</span>&nbsp;<span class="op" id="7505303">*</span><span class="ident" id="7505304">testing</span><span class="op" id="7505311">.</span><span class="ident" id="7505312">B</span><span class="op" id="7505313">)</span>&nbsp;<span class="op" id="7505315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7505318">benchmarkDecode</span><span class="op" id="7505333">(</span><span class="ident" id="7505334">b</span><span class="op" id="7505335">,</span>&nbsp;<span class="string" id="7505337">&#34;testdata/benchGray.png&#34;</span><span class="op" id="7505361">,</span>&nbsp;<span class="num" id="7505363">1</span><span class="op" id="7505364">)</span><br>
<span class="lineno"></span><span class="op" id="7505366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7505369">func</span>&nbsp;<span class="ident" id="7505374">BenchmarkDecodeNRGBAGradient</span><span class="op" id="7505402">(</span><span class="ident" id="7505403">b</span>&nbsp;<span class="op" id="7505405">*</span><span class="ident" id="7505406">testing</span><span class="op" id="7505413">.</span><span class="ident" id="7505414">B</span><span class="op" id="7505415">)</span>&nbsp;<span class="op" id="7505417">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7505420">benchmarkDecode</span><span class="op" id="7505435">(</span><span class="ident" id="7505436">b</span><span class="op" id="7505437">,</span>&nbsp;<span class="string" id="7505439">&#34;testdata/benchNRGBA-gradient.png&#34;</span><span class="op" id="7505473">,</span>&nbsp;<span class="num" id="7505475">4</span><span class="op" id="7505476">)</span><br>
<span class="lineno"></span><span class="op" id="7505478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7505481">func</span>&nbsp;<span class="ident" id="7505486">BenchmarkDecodeNRGBAOpaque</span><span class="op" id="7505512">(</span><span class="ident" id="7505513">b</span>&nbsp;<span class="op" id="7505515">*</span><span class="ident" id="7505516">testing</span><span class="op" id="7505523">.</span><span class="ident" id="7505524">B</span><span class="op" id="7505525">)</span>&nbsp;<span class="op" id="7505527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7505530">benchmarkDecode</span><span class="op" id="7505545">(</span><span class="ident" id="7505546">b</span><span class="op" id="7505547">,</span>&nbsp;<span class="string" id="7505549">&#34;testdata/benchNRGBA-opaque.png&#34;</span><span class="op" id="7505581">,</span>&nbsp;<span class="num" id="7505583">4</span><span class="op" id="7505584">)</span><br>
<span class="lineno">350</span><span class="op" id="7505586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7505589">func</span>&nbsp;<span class="ident" id="7505594">BenchmarkDecodePaletted</span><span class="op" id="7505617">(</span><span class="ident" id="7505618">b</span>&nbsp;<span class="op" id="7505620">*</span><span class="ident" id="7505621">testing</span><span class="op" id="7505628">.</span><span class="ident" id="7505629">B</span><span class="op" id="7505630">)</span>&nbsp;<span class="op" id="7505632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7505635">benchmarkDecode</span><span class="op" id="7505650">(</span><span class="ident" id="7505651">b</span><span class="op" id="7505652">,</span>&nbsp;<span class="string" id="7505654">&#34;testdata/benchPaletted.png&#34;</span><span class="op" id="7505682">,</span>&nbsp;<span class="num" id="7505684">1</span><span class="op" id="7505685">)</span><br>
<span class="lineno"></span><span class="op" id="7505687">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="7505690">func</span>&nbsp;<span class="ident" id="7505695">BenchmarkDecodeRGB</span><span class="op" id="7505713">(</span><span class="ident" id="7505714">b</span>&nbsp;<span class="op" id="7505716">*</span><span class="ident" id="7505717">testing</span><span class="op" id="7505724">.</span><span class="ident" id="7505725">B</span><span class="op" id="7505726">)</span>&nbsp;<span class="op" id="7505728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7505731">benchmarkDecode</span><span class="op" id="7505746">(</span><span class="ident" id="7505747">b</span><span class="op" id="7505748">,</span>&nbsp;<span class="string" id="7505750">&#34;testdata/benchRGB.png&#34;</span><span class="op" id="7505773">,</span>&nbsp;<span class="num" id="7505775">4</span><span class="op" id="7505776">)</span><br>
<span class="lineno"></span><span class="op" id="7505778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="keyword" id="7505781">func</span>&nbsp;<span class="ident" id="7505786">BenchmarkDecodeInterlacing</span><span class="op" id="7505812">(</span><span class="ident" id="7505813">b</span>&nbsp;<span class="op" id="7505815">*</span><span class="ident" id="7505816">testing</span><span class="op" id="7505823">.</span><span class="ident" id="7505824">B</span><span class="op" id="7505825">)</span>&nbsp;<span class="op" id="7505827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7505830">benchmarkDecode</span><span class="op" id="7505845">(</span><span class="ident" id="7505846">b</span><span class="op" id="7505847">,</span>&nbsp;<span class="string" id="7505849">&#34;testdata/benchRGB-interlace.png&#34;</span><span class="op" id="7505882">,</span>&nbsp;<span class="num" id="7505884">4</span><span class="op" id="7505885">)</span><br>
<span class="lineno"></span><span class="op" id="7505887">}</span>
</div>
</body>
</html>
