<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html" class="current">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5673072">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5673127">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5673181">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5673232">//&nbsp;Support&nbsp;for&nbsp;test&nbsp;coverage.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5673263">package</span>&nbsp;<span class="ident" id="5673271">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5673280">import</span>&nbsp;<span class="op" id="5673287">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5673290">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5673297">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5673303">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span><span class="op" id="5673317">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5673320">//&nbsp;CoverBlock&nbsp;records&nbsp;the&nbsp;coverage&nbsp;data&nbsp;for&nbsp;a&nbsp;single&nbsp;basic&nbsp;block.</span><br>
<span class="lineno"></span><span class="comment" id="5673386">//&nbsp;NOTE:&nbsp;This&nbsp;struct&nbsp;is&nbsp;internal&nbsp;to&nbsp;the&nbsp;testing&nbsp;infrastructure&nbsp;and&nbsp;may&nbsp;change.</span><br>
<span class="lineno"></span><span class="comment" id="5673465">//&nbsp;It&nbsp;is&nbsp;not&nbsp;covered&nbsp;(yet)&nbsp;by&nbsp;the&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;guidelines.</span><br>
<span class="lineno"></span><span class="keyword" id="5673530">type</span>&nbsp;<span class="ident" id="5673535">CoverBlock</span>&nbsp;<span class="keyword" id="5673546">struct</span>&nbsp;<span class="op" id="5673553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673556">Line0</span>&nbsp;<span class="builtintype" id="5673562">uint32</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673570">Col0</span>&nbsp;&nbsp;<span class="builtintype" id="5673576">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673584">Line1</span>&nbsp;<span class="builtintype" id="5673590">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673598">Col1</span>&nbsp;&nbsp;<span class="builtintype" id="5673604">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673612">Stmts</span>&nbsp;<span class="builtintype" id="5673618">uint16</span><br>
<span class="lineno"></span><span class="op" id="5673625">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5673628">var</span>&nbsp;<span class="ident" id="5673632">cover</span>&nbsp;<span class="ident" id="5673638">Cover</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5673645">//&nbsp;Cover&nbsp;records&nbsp;information&nbsp;about&nbsp;test&nbsp;coverage&nbsp;checking.</span><br>
<span class="lineno"></span><span class="comment" id="5673704">//&nbsp;NOTE:&nbsp;This&nbsp;struct&nbsp;is&nbsp;internal&nbsp;to&nbsp;the&nbsp;testing&nbsp;infrastructure&nbsp;and&nbsp;may&nbsp;change.</span><br>
<span class="lineno">30</span><span class="comment" id="5673783">//&nbsp;It&nbsp;is&nbsp;not&nbsp;covered&nbsp;(yet)&nbsp;by&nbsp;the&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;guidelines.</span><br>
<span class="lineno"></span><span class="keyword" id="5673848">type</span>&nbsp;<span class="ident" id="5673853">Cover</span>&nbsp;<span class="keyword" id="5673859">struct</span>&nbsp;<span class="op" id="5673866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673869">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5673885">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673893">Counters</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5673909">map</span><span class="op" id="5673912">[</span><span class="builtintype" id="5673913">string</span><span class="op" id="5673919">]</span><span class="op" id="5673920">[</span><span class="op" id="5673921">]</span><span class="builtintype" id="5673922">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673930">Blocks</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5673946">map</span><span class="op" id="5673949">[</span><span class="builtintype" id="5673950">string</span><span class="op" id="5673956">]</span><span class="op" id="5673957">[</span><span class="op" id="5673958">]</span><span class="ident" id="5673959">CoverBlock</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673971">CoveredPackages</span>&nbsp;<span class="builtintype" id="5673987">string</span><br>
<span class="lineno"></span><span class="op" id="5673994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5673997">//&nbsp;Coverage&nbsp;reports&nbsp;the&nbsp;current&nbsp;code&nbsp;coverage&nbsp;as&nbsp;a&nbsp;fraction&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;1].</span><br>
<span class="lineno"></span><span class="comment" id="5674078">//&nbsp;If&nbsp;coverage&nbsp;is&nbsp;not&nbsp;enabled,&nbsp;Coverage&nbsp;returns&nbsp;0.</span><br>
<span class="lineno">40</span><span class="comment" id="5674129">//</span><br>
<span class="lineno"></span><span class="comment" id="5674132">//&nbsp;When&nbsp;running&nbsp;a&nbsp;large&nbsp;set&nbsp;of&nbsp;sequential&nbsp;test&nbsp;cases,&nbsp;checking&nbsp;Coverage&nbsp;after&nbsp;each&nbsp;one</span><br>
<span class="lineno"></span><span class="comment" id="5674219">//&nbsp;can&nbsp;be&nbsp;useful&nbsp;for&nbsp;identifying&nbsp;which&nbsp;test&nbsp;cases&nbsp;exercise&nbsp;new&nbsp;code&nbsp;paths.</span><br>
<span class="lineno"></span><span class="comment" id="5674294">//&nbsp;It&nbsp;is&nbsp;not&nbsp;a&nbsp;replacement&nbsp;for&nbsp;the&nbsp;reports&nbsp;generated&nbsp;by&nbsp;&#39;go&nbsp;test&nbsp;-cover&#39;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5674371">//&nbsp;&#39;go&nbsp;tool&nbsp;cover&#39;.</span><br>
<span class="lineno">45</span><span class="keyword" id="5674391">func</span>&nbsp;<span class="ident" id="5674396">Coverage</span><span class="op" id="5674404">(</span><span class="op" id="5674405">)</span>&nbsp;<span class="builtintype" id="5674407">float64</span>&nbsp;<span class="op" id="5674415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5674418">var</span>&nbsp;<span class="ident" id="5674422">n</span><span class="op" id="5674423">,</span>&nbsp;<span class="ident" id="5674425">d</span>&nbsp;<span class="ident" id="5674427">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5674434">for</span>&nbsp;<span class="ident" id="5674438">_</span><span class="op" id="5674439">,</span>&nbsp;<span class="ident" id="5674441">counters</span>&nbsp;<span class="op" id="5674450">:=</span>&nbsp;<span class="keyword" id="5674453">range</span>&nbsp;<span class="ident" id="5674459">cover</span><span class="op" id="5674464">.</span><span class="ident" id="5674465">Counters</span>&nbsp;<span class="op" id="5674474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5674478">for</span>&nbsp;<span class="ident" id="5674482">i</span>&nbsp;<span class="op" id="5674484">:=</span>&nbsp;<span class="keyword" id="5674487">range</span>&nbsp;<span class="ident" id="5674493">counters</span>&nbsp;<span class="op" id="5674502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5674507">if</span>&nbsp;<span class="ident" id="5674510">atomic</span><span class="op" id="5674516">.</span><span class="ident" id="5674517">LoadUint32</span><span class="op" id="5674527">(</span><span class="op" id="5674528">&amp;</span><span class="ident" id="5674529">counters</span><span class="op" id="5674537">[</span><span class="ident" id="5674538">i</span><span class="op" id="5674539">]</span><span class="op" id="5674540">)</span>&nbsp;<span class="op" id="5674542">&gt;</span>&nbsp;<span class="num" id="5674544">0</span>&nbsp;<span class="op" id="5674546">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5674552">n</span><span class="op" id="5674553">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5674559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5674564">d</span><span class="op" id="5674565">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5674570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5674573">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5674576">if</span>&nbsp;<span class="ident" id="5674579">d</span>&nbsp;<span class="op" id="5674581">==</span>&nbsp;<span class="num" id="5674584">0</span>&nbsp;<span class="op" id="5674586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5674590">return</span>&nbsp;<span class="num" id="5674597">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5674600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5674603">return</span>&nbsp;<span class="builtintype" id="5674610">float64</span><span class="op" id="5674617">(</span><span class="ident" id="5674618">n</span><span class="op" id="5674619">)</span>&nbsp;<span class="op" id="5674621">/</span>&nbsp;<span class="builtintype" id="5674623">float64</span><span class="op" id="5674630">(</span><span class="ident" id="5674631">d</span><span class="op" id="5674632">)</span><br>
<span class="lineno"></span><span class="op" id="5674634">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="5674637">//&nbsp;RegisterCover&nbsp;records&nbsp;the&nbsp;coverage&nbsp;data&nbsp;accumulators&nbsp;for&nbsp;the&nbsp;tests.</span><br>
<span class="lineno"></span><span class="comment" id="5674708">//&nbsp;NOTE:&nbsp;This&nbsp;function&nbsp;is&nbsp;internal&nbsp;to&nbsp;the&nbsp;testing&nbsp;infrastructure&nbsp;and&nbsp;may&nbsp;change.</span><br>
<span class="lineno"></span><span class="comment" id="5674789">//&nbsp;It&nbsp;is&nbsp;not&nbsp;covered&nbsp;(yet)&nbsp;by&nbsp;the&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;guidelines.</span><br>
<span class="lineno"></span><span class="keyword" id="5674854">func</span>&nbsp;<span class="ident" id="5674859">RegisterCover</span><span class="op" id="5674872">(</span><span class="ident" id="5674873">c</span>&nbsp;<span class="ident" id="5674875">Cover</span><span class="op" id="5674880">)</span>&nbsp;<span class="op" id="5674882">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5674885">cover</span>&nbsp;<span class="op" id="5674891">=</span>&nbsp;<span class="ident" id="5674893">c</span><br>
<span class="lineno"></span><span class="op" id="5674895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5674898">//&nbsp;mustBeNil&nbsp;checks&nbsp;the&nbsp;error&nbsp;and,&nbsp;if&nbsp;present,&nbsp;reports&nbsp;it&nbsp;and&nbsp;exits.</span><br>
<span class="lineno"></span><span class="keyword" id="5674967">func</span>&nbsp;<span class="ident" id="5674972">mustBeNil</span><span class="op" id="5674981">(</span><span class="ident" id="5674982">err</span>&nbsp;<span class="builtintype" id="5674986">error</span><span class="op" id="5674991">)</span>&nbsp;<span class="op" id="5674993">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5674996">if</span>&nbsp;<span class="ident" id="5674999">err</span>&nbsp;<span class="op" id="5675003">!=</span>&nbsp;<span class="ident" id="5675006">nil</span>&nbsp;<span class="op" id="5675010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675014">fmt</span><span class="op" id="5675017">.</span><span class="ident" id="5675018">Fprintf</span><span class="op" id="5675025">(</span><span class="ident" id="5675026">os</span><span class="op" id="5675028">.</span><span class="ident" id="5675029">Stderr</span><span class="op" id="5675035">,</span>&nbsp;<span class="string" id="5675037">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="5675052">,</span>&nbsp;<span class="ident" id="5675054">err</span><span class="op" id="5675057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675061">os</span><span class="op" id="5675063">.</span><span class="ident" id="5675064">Exit</span><span class="op" id="5675068">(</span><span class="num" id="5675069">2</span><span class="op" id="5675070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5675073">}</span><br>
<span class="lineno"></span><span class="op" id="5675075">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="5675078">//&nbsp;coverReport&nbsp;reports&nbsp;the&nbsp;coverage&nbsp;percentage&nbsp;and&nbsp;writes&nbsp;a&nbsp;coverage&nbsp;profile&nbsp;if&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="5675169">func</span>&nbsp;<span class="ident" id="5675174">coverReport</span><span class="op" id="5675185">(</span><span class="op" id="5675186">)</span>&nbsp;<span class="op" id="5675188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5675191">var</span>&nbsp;<span class="ident" id="5675195">f</span>&nbsp;<span class="op" id="5675197">*</span><span class="ident" id="5675198">os</span><span class="op" id="5675200">.</span><span class="ident" id="5675201">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5675207">var</span>&nbsp;<span class="ident" id="5675211">err</span>&nbsp;<span class="builtintype" id="5675215">error</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5675222">if</span>&nbsp;<span class="op" id="5675225">*</span><span class="ident" id="5675226">coverProfile</span>&nbsp;<span class="op" id="5675239">!=</span>&nbsp;<span class="string" id="5675242">&#34;&#34;</span>&nbsp;<span class="op" id="5675245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675249">f</span><span class="op" id="5675250">,</span>&nbsp;<span class="ident" id="5675252">err</span>&nbsp;<span class="op" id="5675256">=</span>&nbsp;<span class="ident" id="5675258">os</span><span class="op" id="5675260">.</span><span class="ident" id="5675261">Create</span><span class="op" id="5675267">(</span><span class="ident" id="5675268">toOutputDir</span><span class="op" id="5675279">(</span><span class="op" id="5675280">*</span><span class="ident" id="5675281">coverProfile</span><span class="op" id="5675293">)</span><span class="op" id="5675294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675298">mustBeNil</span><span class="op" id="5675307">(</span><span class="ident" id="5675308">err</span><span class="op" id="5675311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675315">fmt</span><span class="op" id="5675318">.</span><span class="ident" id="5675319">Fprintf</span><span class="op" id="5675326">(</span><span class="ident" id="5675327">f</span><span class="op" id="5675328">,</span>&nbsp;<span class="string" id="5675330">&#34;mode:&nbsp;%s\n&#34;</span><span class="op" id="5675342">,</span>&nbsp;<span class="ident" id="5675344">cover</span><span class="op" id="5675349">.</span><span class="ident" id="5675350">Mode</span><span class="op" id="5675354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5675358">defer</span>&nbsp;<span class="keyword" id="5675364">func</span><span class="op" id="5675368">(</span><span class="op" id="5675369">)</span>&nbsp;<span class="op" id="5675371">{</span>&nbsp;<span class="ident" id="5675373">mustBeNil</span><span class="op" id="5675382">(</span><span class="ident" id="5675383">f</span><span class="op" id="5675384">.</span><span class="ident" id="5675385">Close</span><span class="op" id="5675390">(</span><span class="op" id="5675391">)</span><span class="op" id="5675392">)</span>&nbsp;<span class="op" id="5675394">}</span><span class="op" id="5675395">(</span><span class="op" id="5675396">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5675399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5675403">var</span>&nbsp;<span class="ident" id="5675407">active</span><span class="op" id="5675413">,</span>&nbsp;<span class="ident" id="5675415">total</span>&nbsp;<span class="ident" id="5675421">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5675428">var</span>&nbsp;<span class="ident" id="5675432">count</span>&nbsp;<span class="builtintype" id="5675438">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5675446">for</span>&nbsp;<span class="ident" id="5675450">name</span><span class="op" id="5675454">,</span>&nbsp;<span class="ident" id="5675456">counts</span>&nbsp;<span class="op" id="5675463">:=</span>&nbsp;<span class="keyword" id="5675466">range</span>&nbsp;<span class="ident" id="5675472">cover</span><span class="op" id="5675477">.</span><span class="ident" id="5675478">Counters</span>&nbsp;<span class="op" id="5675487">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675491">blocks</span>&nbsp;<span class="op" id="5675498">:=</span>&nbsp;<span class="ident" id="5675501">cover</span><span class="op" id="5675506">.</span><span class="ident" id="5675507">Blocks</span><span class="op" id="5675513">[</span><span class="ident" id="5675514">name</span><span class="op" id="5675518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5675522">for</span>&nbsp;<span class="ident" id="5675526">i</span>&nbsp;<span class="op" id="5675528">:=</span>&nbsp;<span class="keyword" id="5675531">range</span>&nbsp;<span class="ident" id="5675537">counts</span>&nbsp;<span class="op" id="5675544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675549">stmts</span>&nbsp;<span class="op" id="5675555">:=</span>&nbsp;<span class="ident" id="5675558">int64</span><span class="op" id="5675563">(</span><span class="ident" id="5675564">blocks</span><span class="op" id="5675570">[</span><span class="ident" id="5675571">i</span><span class="op" id="5675572">]</span><span class="op" id="5675573">.</span><span class="ident" id="5675574">Stmts</span><span class="op" id="5675579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675584">total</span>&nbsp;<span class="op" id="5675590">+=</span>&nbsp;<span class="ident" id="5675593">stmts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675602">count</span>&nbsp;<span class="op" id="5675608">=</span>&nbsp;<span class="ident" id="5675610">atomic</span><span class="op" id="5675616">.</span><span class="ident" id="5675617">LoadUint32</span><span class="op" id="5675627">(</span><span class="op" id="5675628">&amp;</span><span class="ident" id="5675629">counts</span><span class="op" id="5675635">[</span><span class="ident" id="5675636">i</span><span class="op" id="5675637">]</span><span class="op" id="5675638">)</span>&nbsp;<span class="comment" id="5675640">//&nbsp;For&nbsp;-mode=atomic.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5675664">if</span>&nbsp;<span class="ident" id="5675667">count</span>&nbsp;<span class="op" id="5675673">&gt;</span>&nbsp;<span class="num" id="5675675">0</span>&nbsp;<span class="op" id="5675677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675683">active</span>&nbsp;<span class="op" id="5675690">+=</span>&nbsp;<span class="ident" id="5675693">stmts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5675702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5675707">if</span>&nbsp;<span class="ident" id="5675710">f</span>&nbsp;<span class="op" id="5675712">!=</span>&nbsp;<span class="ident" id="5675715">nil</span>&nbsp;<span class="op" id="5675719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675725">_</span><span class="op" id="5675726">,</span>&nbsp;<span class="ident" id="5675728">err</span>&nbsp;<span class="op" id="5675732">:=</span>&nbsp;<span class="ident" id="5675735">fmt</span><span class="op" id="5675738">.</span><span class="ident" id="5675739">Fprintf</span><span class="op" id="5675746">(</span><span class="ident" id="5675747">f</span><span class="op" id="5675748">,</span>&nbsp;<span class="string" id="5675750">&#34;%s:%d.%d,%d.%d&nbsp;%d&nbsp;%d\n&#34;</span><span class="op" id="5675774">,</span>&nbsp;<span class="ident" id="5675776">name</span><span class="op" id="5675780">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675787">blocks</span><span class="op" id="5675793">[</span><span class="ident" id="5675794">i</span><span class="op" id="5675795">]</span><span class="op" id="5675796">.</span><span class="ident" id="5675797">Line0</span><span class="op" id="5675802">,</span>&nbsp;<span class="ident" id="5675804">blocks</span><span class="op" id="5675810">[</span><span class="ident" id="5675811">i</span><span class="op" id="5675812">]</span><span class="op" id="5675813">.</span><span class="ident" id="5675814">Col0</span><span class="op" id="5675818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675825">blocks</span><span class="op" id="5675831">[</span><span class="ident" id="5675832">i</span><span class="op" id="5675833">]</span><span class="op" id="5675834">.</span><span class="ident" id="5675835">Line1</span><span class="op" id="5675840">,</span>&nbsp;<span class="ident" id="5675842">blocks</span><span class="op" id="5675848">[</span><span class="ident" id="5675849">i</span><span class="op" id="5675850">]</span><span class="op" id="5675851">.</span><span class="ident" id="5675852">Col1</span><span class="op" id="5675856">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675863">stmts</span><span class="op" id="5675868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675875">count</span><span class="op" id="5675880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675886">mustBeNil</span><span class="op" id="5675895">(</span><span class="ident" id="5675896">err</span><span class="op" id="5675899">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5675904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5675908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5675911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5675914">if</span>&nbsp;<span class="ident" id="5675917">total</span>&nbsp;<span class="op" id="5675923">==</span>&nbsp;<span class="num" id="5675926">0</span>&nbsp;<span class="op" id="5675928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675932">total</span>&nbsp;<span class="op" id="5675938">=</span>&nbsp;<span class="num" id="5675940">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5675943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5675946">fmt</span><span class="op" id="5675949">.</span><span class="ident" id="5675950">Printf</span><span class="op" id="5675956">(</span><span class="string" id="5675957">&#34;coverage:&nbsp;%.1f%%&nbsp;of&nbsp;statements%s\n&#34;</span><span class="op" id="5675993">,</span>&nbsp;<span class="num" id="5675995">100</span><span class="op" id="5675998">*</span><span class="builtintype" id="5675999">float64</span><span class="op" id="5676006">(</span><span class="ident" id="5676007">active</span><span class="op" id="5676013">)</span><span class="op" id="5676014">/</span><span class="builtintype" id="5676015">float64</span><span class="op" id="5676022">(</span><span class="ident" id="5676023">total</span><span class="op" id="5676028">)</span><span class="op" id="5676029">,</span>&nbsp;<span class="ident" id="5676031">cover</span><span class="op" id="5676036">.</span><span class="ident" id="5676037">CoveredPackages</span><span class="op" id="5676052">)</span><br>
<span class="lineno"></span><span class="op" id="5676054">}</span>
</div>
</body>
</html>
