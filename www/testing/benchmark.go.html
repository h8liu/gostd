<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5602963">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5603018">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5603072">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5603123">package</span>&nbsp;<span class="ident" id="5603131">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5603140">import</span>&nbsp;<span class="op" id="5603147">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5603150">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5603158">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5603165">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5603171">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5603182">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5603190">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5603205">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5603212">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5603215">var</span>&nbsp;<span class="ident" id="5603219">matchBenchmarks</span>&nbsp;<span class="op" id="5603235">=</span>&nbsp;<span class="ident" id="5603237">flag</span><span class="op" id="5603241">.</span><span class="ident" id="5603242">String</span><span class="op" id="5603248">(</span><span class="string" id="5603249">&#34;test.bench&#34;</span><span class="op" id="5603261">,</span>&nbsp;<span class="string" id="5603263">&#34;&#34;</span><span class="op" id="5603265">,</span>&nbsp;<span class="string" id="5603267">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;benchmarks&nbsp;to&nbsp;run&#34;</span><span class="op" id="5603315">)</span><br>
<span class="lineno"></span><span class="keyword" id="5603317">var</span>&nbsp;<span class="ident" id="5603321">benchTime</span>&nbsp;<span class="op" id="5603331">=</span>&nbsp;<span class="ident" id="5603333">flag</span><span class="op" id="5603337">.</span><span class="ident" id="5603338">Duration</span><span class="op" id="5603346">(</span><span class="string" id="5603347">&#34;test.benchtime&#34;</span><span class="op" id="5603363">,</span>&nbsp;<span class="num" id="5603365">1</span><span class="op" id="5603366">*</span><span class="ident" id="5603367">time</span><span class="op" id="5603371">.</span><span class="ident" id="5603372">Second</span><span class="op" id="5603378">,</span>&nbsp;<span class="string" id="5603380">&#34;approximate&nbsp;run&nbsp;time&nbsp;for&nbsp;each&nbsp;benchmark&#34;</span><span class="op" id="5603421">)</span><br>
<span class="lineno"></span><span class="keyword" id="5603423">var</span>&nbsp;<span class="ident" id="5603427">benchmarkMemory</span>&nbsp;<span class="op" id="5603443">=</span>&nbsp;<span class="ident" id="5603445">flag</span><span class="op" id="5603449">.</span><span class="ident" id="5603450">Bool</span><span class="op" id="5603454">(</span><span class="string" id="5603455">&#34;test.benchmem&#34;</span><span class="op" id="5603470">,</span>&nbsp;<span class="ident" id="5603472">false</span><span class="op" id="5603477">,</span>&nbsp;<span class="string" id="5603479">&#34;print&nbsp;memory&nbsp;allocations&nbsp;for&nbsp;benchmarks&#34;</span><span class="op" id="5603520">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5603523">//&nbsp;Global&nbsp;lock&nbsp;to&nbsp;ensure&nbsp;only&nbsp;one&nbsp;benchmark&nbsp;runs&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="5603583">var</span>&nbsp;<span class="ident" id="5603587">benchmarkLock</span>&nbsp;<span class="ident" id="5603601">sync</span><span class="op" id="5603605">.</span><span class="ident" id="5603606">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5603613">//&nbsp;Used&nbsp;for&nbsp;every&nbsp;benchmark&nbsp;for&nbsp;measuring&nbsp;memory.</span><br>
<span class="lineno">25</span><span class="keyword" id="5603663">var</span>&nbsp;<span class="ident" id="5603667">memStats</span>&nbsp;<span class="ident" id="5603676">runtime</span><span class="op" id="5603683">.</span><span class="ident" id="5603684">MemStats</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5603694">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5603783">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5603812">type</span>&nbsp;<span class="ident" id="5603817">InternalBenchmark</span>&nbsp;<span class="keyword" id="5603835">struct</span>&nbsp;<span class="op" id="5603842">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603845">Name</span>&nbsp;<span class="builtintype" id="5603850">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603858">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5603863">func</span><span class="op" id="5603867">(</span><span class="ident" id="5603868">b</span>&nbsp;<span class="op" id="5603870">*</span><span class="ident" id="5603871">B</span><span class="op" id="5603872">)</span><br>
<span class="lineno"></span><span class="op" id="5603874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5603877">//&nbsp;B&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Benchmark&nbsp;functions&nbsp;to&nbsp;manage&nbsp;benchmark</span><br>
<span class="lineno">35</span><span class="comment" id="5603942">//&nbsp;timing&nbsp;and&nbsp;to&nbsp;specify&nbsp;the&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="5604000">type</span>&nbsp;<span class="ident" id="5604005">B</span>&nbsp;<span class="keyword" id="5604007">struct</span>&nbsp;<span class="op" id="5604014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604017">common</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604025">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5604042">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604047">previousN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5604064">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5604078">//&nbsp;number&nbsp;of&nbsp;iterations&nbsp;in&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604123">previousDuration</span>&nbsp;<span class="ident" id="5604140">time</span><span class="op" id="5604144">.</span><span class="ident" id="5604145">Duration</span>&nbsp;<span class="comment" id="5604154">//&nbsp;total&nbsp;duration&nbsp;of&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604193">benchmark</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604210">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604229">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604246">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604253">timerOn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5604270">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604276">showAllocResult</span>&nbsp;&nbsp;<span class="builtintype" id="5604293">bool</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604299">result</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5604316">BenchmarkResult</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604333">parallelism</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5604350">int</span>&nbsp;<span class="comment" id="5604354">//&nbsp;RunParallel&nbsp;creates&nbsp;parallelism*GOMAXPROCS&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5604412">//&nbsp;The&nbsp;initial&nbsp;states&nbsp;of&nbsp;memStats.Mallocs&nbsp;and&nbsp;memStats.TotalAlloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604480">startAllocs</span>&nbsp;<span class="ident" id="5604492">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604500">startBytes</span>&nbsp;&nbsp;<span class="ident" id="5604512">uint64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5604520">//&nbsp;The&nbsp;net&nbsp;total&nbsp;of&nbsp;this&nbsp;test&nbsp;after&nbsp;being&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604568">netAllocs</span>&nbsp;<span class="ident" id="5604578">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604586">netBytes</span>&nbsp;&nbsp;<span class="ident" id="5604596">uint64</span><br>
<span class="lineno"></span><span class="op" id="5604603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="5604606">//&nbsp;StartTimer&nbsp;starts&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;automatically</span><br>
<span class="lineno"></span><span class="comment" id="5604681">//&nbsp;before&nbsp;a&nbsp;benchmark&nbsp;starts,&nbsp;but&nbsp;it&nbsp;can&nbsp;also&nbsp;used&nbsp;to&nbsp;resume&nbsp;timing&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="5604755">//&nbsp;a&nbsp;call&nbsp;to&nbsp;StopTimer.</span><br>
<span class="lineno"></span><span class="keyword" id="5604779">func</span>&nbsp;<span class="op" id="5604784">(</span><span class="ident" id="5604785">b</span>&nbsp;<span class="op" id="5604787">*</span><span class="ident" id="5604788">B</span><span class="op" id="5604789">)</span>&nbsp;<span class="ident" id="5604791">StartTimer</span><span class="op" id="5604801">(</span><span class="op" id="5604802">)</span>&nbsp;<span class="op" id="5604804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604807">if</span>&nbsp;<span class="op" id="5604810">!</span><span class="ident" id="5604811">b</span><span class="op" id="5604812">.</span><span class="ident" id="5604813">timerOn</span>&nbsp;<span class="op" id="5604821">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604825">runtime</span><span class="op" id="5604832">.</span><span class="ident" id="5604833">ReadMemStats</span><span class="op" id="5604845">(</span><span class="op" id="5604846">&amp;</span><span class="ident" id="5604847">memStats</span><span class="op" id="5604855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604859">b</span><span class="op" id="5604860">.</span><span class="ident" id="5604861">startAllocs</span>&nbsp;<span class="op" id="5604873">=</span>&nbsp;<span class="ident" id="5604875">memStats</span><span class="op" id="5604883">.</span><span class="ident" id="5604884">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604894">b</span><span class="op" id="5604895">.</span><span class="ident" id="5604896">startBytes</span>&nbsp;<span class="op" id="5604907">=</span>&nbsp;<span class="ident" id="5604909">memStats</span><span class="op" id="5604917">.</span><span class="ident" id="5604918">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604931">b</span><span class="op" id="5604932">.</span><span class="ident" id="5604933">start</span>&nbsp;<span class="op" id="5604939">=</span>&nbsp;<span class="ident" id="5604941">time</span><span class="op" id="5604945">.</span><span class="ident" id="5604946">Now</span><span class="op" id="5604949">(</span><span class="op" id="5604950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604954">b</span><span class="op" id="5604955">.</span><span class="ident" id="5604956">timerOn</span>&nbsp;<span class="op" id="5604964">=</span>&nbsp;<span class="ident" id="5604966">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5604972">}</span><br>
<span class="lineno"></span><span class="op" id="5604974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5604977">//&nbsp;StopTimer&nbsp;stops&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;pause&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="5605048">//&nbsp;while&nbsp;performing&nbsp;complex&nbsp;initialization&nbsp;that&nbsp;you&nbsp;don&#39;t</span><br>
<span class="lineno">70</span><span class="comment" id="5605106">//&nbsp;want&nbsp;to&nbsp;measure.</span><br>
<span class="lineno"></span><span class="keyword" id="5605126">func</span>&nbsp;<span class="op" id="5605131">(</span><span class="ident" id="5605132">b</span>&nbsp;<span class="op" id="5605134">*</span><span class="ident" id="5605135">B</span><span class="op" id="5605136">)</span>&nbsp;<span class="ident" id="5605138">StopTimer</span><span class="op" id="5605147">(</span><span class="op" id="5605148">)</span>&nbsp;<span class="op" id="5605150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5605153">if</span>&nbsp;<span class="ident" id="5605156">b</span><span class="op" id="5605157">.</span><span class="ident" id="5605158">timerOn</span>&nbsp;<span class="op" id="5605166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605170">b</span><span class="op" id="5605171">.</span><span class="ident" id="5605172">duration</span>&nbsp;<span class="op" id="5605181">+=</span>&nbsp;<span class="ident" id="5605184">time</span><span class="op" id="5605188">.</span><span class="ident" id="5605189">Now</span><span class="op" id="5605192">(</span><span class="op" id="5605193">)</span><span class="op" id="5605194">.</span><span class="ident" id="5605195">Sub</span><span class="op" id="5605198">(</span><span class="ident" id="5605199">b</span><span class="op" id="5605200">.</span><span class="ident" id="5605201">start</span><span class="op" id="5605206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605210">runtime</span><span class="op" id="5605217">.</span><span class="ident" id="5605218">ReadMemStats</span><span class="op" id="5605230">(</span><span class="op" id="5605231">&amp;</span><span class="ident" id="5605232">memStats</span><span class="op" id="5605240">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605244">b</span><span class="op" id="5605245">.</span><span class="ident" id="5605246">netAllocs</span>&nbsp;<span class="op" id="5605256">+=</span>&nbsp;<span class="ident" id="5605259">memStats</span><span class="op" id="5605267">.</span><span class="ident" id="5605268">Mallocs</span>&nbsp;<span class="op" id="5605276">-</span>&nbsp;<span class="ident" id="5605278">b</span><span class="op" id="5605279">.</span><span class="ident" id="5605280">startAllocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605294">b</span><span class="op" id="5605295">.</span><span class="ident" id="5605296">netBytes</span>&nbsp;<span class="op" id="5605305">+=</span>&nbsp;<span class="ident" id="5605308">memStats</span><span class="op" id="5605316">.</span><span class="ident" id="5605317">TotalAlloc</span>&nbsp;<span class="op" id="5605328">-</span>&nbsp;<span class="ident" id="5605330">b</span><span class="op" id="5605331">.</span><span class="ident" id="5605332">startBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605345">b</span><span class="op" id="5605346">.</span><span class="ident" id="5605347">timerOn</span>&nbsp;<span class="op" id="5605355">=</span>&nbsp;<span class="ident" id="5605357">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5605364">}</span><br>
<span class="lineno"></span><span class="op" id="5605366">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="5605369">//&nbsp;ResetTimer&nbsp;zeros&nbsp;the&nbsp;elapsed&nbsp;benchmark&nbsp;time&nbsp;and&nbsp;memory&nbsp;allocation&nbsp;counters.</span><br>
<span class="lineno"></span><span class="comment" id="5605448">//&nbsp;It&nbsp;does&nbsp;not&nbsp;affect&nbsp;whether&nbsp;the&nbsp;timer&nbsp;is&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="5605500">func</span>&nbsp;<span class="op" id="5605505">(</span><span class="ident" id="5605506">b</span>&nbsp;<span class="op" id="5605508">*</span><span class="ident" id="5605509">B</span><span class="op" id="5605510">)</span>&nbsp;<span class="ident" id="5605512">ResetTimer</span><span class="op" id="5605522">(</span><span class="op" id="5605523">)</span>&nbsp;<span class="op" id="5605525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5605528">if</span>&nbsp;<span class="ident" id="5605531">b</span><span class="op" id="5605532">.</span><span class="ident" id="5605533">timerOn</span>&nbsp;<span class="op" id="5605541">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605545">runtime</span><span class="op" id="5605552">.</span><span class="ident" id="5605553">ReadMemStats</span><span class="op" id="5605565">(</span><span class="op" id="5605566">&amp;</span><span class="ident" id="5605567">memStats</span><span class="op" id="5605575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605579">b</span><span class="op" id="5605580">.</span><span class="ident" id="5605581">startAllocs</span>&nbsp;<span class="op" id="5605593">=</span>&nbsp;<span class="ident" id="5605595">memStats</span><span class="op" id="5605603">.</span><span class="ident" id="5605604">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605614">b</span><span class="op" id="5605615">.</span><span class="ident" id="5605616">startBytes</span>&nbsp;<span class="op" id="5605627">=</span>&nbsp;<span class="ident" id="5605629">memStats</span><span class="op" id="5605637">.</span><span class="ident" id="5605638">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605651">b</span><span class="op" id="5605652">.</span><span class="ident" id="5605653">start</span>&nbsp;<span class="op" id="5605659">=</span>&nbsp;<span class="ident" id="5605661">time</span><span class="op" id="5605665">.</span><span class="ident" id="5605666">Now</span><span class="op" id="5605669">(</span><span class="op" id="5605670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5605673">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605676">b</span><span class="op" id="5605677">.</span><span class="ident" id="5605678">duration</span>&nbsp;<span class="op" id="5605687">=</span>&nbsp;<span class="num" id="5605689">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605692">b</span><span class="op" id="5605693">.</span><span class="ident" id="5605694">netAllocs</span>&nbsp;<span class="op" id="5605704">=</span>&nbsp;<span class="num" id="5605706">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5605709">b</span><span class="op" id="5605710">.</span><span class="ident" id="5605711">netBytes</span>&nbsp;<span class="op" id="5605720">=</span>&nbsp;<span class="num" id="5605722">0</span><br>
<span class="lineno"></span><span class="op" id="5605724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5605727">//&nbsp;SetBytes&nbsp;records&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;processed&nbsp;in&nbsp;a&nbsp;single&nbsp;operation.</span><br>
<span class="lineno"></span><span class="comment" id="5605800">//&nbsp;If&nbsp;this&nbsp;is&nbsp;called,&nbsp;the&nbsp;benchmark&nbsp;will&nbsp;report&nbsp;ns/op&nbsp;and&nbsp;MB/s.</span><br>
<span class="lineno"></span><span class="keyword" id="5605864">func</span>&nbsp;<span class="op" id="5605869">(</span><span class="ident" id="5605870">b</span>&nbsp;<span class="op" id="5605872">*</span><span class="ident" id="5605873">B</span><span class="op" id="5605874">)</span>&nbsp;<span class="ident" id="5605876">SetBytes</span><span class="op" id="5605884">(</span><span class="ident" id="5605885">n</span>&nbsp;<span class="ident" id="5605887">int64</span><span class="op" id="5605892">)</span>&nbsp;<span class="op" id="5605894">{</span>&nbsp;<span class="ident" id="5605896">b</span><span class="op" id="5605897">.</span><span class="ident" id="5605898">bytes</span>&nbsp;<span class="op" id="5605904">=</span>&nbsp;<span class="ident" id="5605906">n</span>&nbsp;<span class="op" id="5605908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5605911">//&nbsp;ReportAllocs&nbsp;enables&nbsp;malloc&nbsp;statistics&nbsp;for&nbsp;this&nbsp;benchmark.</span><br>
<span class="lineno">100</span><span class="comment" id="5605973">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;setting&nbsp;-test.benchmem,&nbsp;but&nbsp;it&nbsp;only&nbsp;affects&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5606044">//&nbsp;benchmark&nbsp;function&nbsp;that&nbsp;calls&nbsp;ReportAllocs.</span><br>
<span class="lineno"></span><span class="keyword" id="5606091">func</span>&nbsp;<span class="op" id="5606096">(</span><span class="ident" id="5606097">b</span>&nbsp;<span class="op" id="5606099">*</span><span class="ident" id="5606100">B</span><span class="op" id="5606101">)</span>&nbsp;<span class="ident" id="5606103">ReportAllocs</span><span class="op" id="5606115">(</span><span class="op" id="5606116">)</span>&nbsp;<span class="op" id="5606118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606121">b</span><span class="op" id="5606122">.</span><span class="ident" id="5606123">showAllocResult</span>&nbsp;<span class="op" id="5606139">=</span>&nbsp;<span class="ident" id="5606141">true</span><br>
<span class="lineno"></span><span class="op" id="5606146">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="5606149">func</span>&nbsp;<span class="op" id="5606154">(</span><span class="ident" id="5606155">b</span>&nbsp;<span class="op" id="5606157">*</span><span class="ident" id="5606158">B</span><span class="op" id="5606159">)</span>&nbsp;<span class="ident" id="5606161">nsPerOp</span><span class="op" id="5606168">(</span><span class="op" id="5606169">)</span>&nbsp;<span class="ident" id="5606171">int64</span>&nbsp;<span class="op" id="5606177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606180">if</span>&nbsp;<span class="ident" id="5606183">b</span><span class="op" id="5606184">.</span><span class="ident" id="5606185">N</span>&nbsp;<span class="op" id="5606187">&lt;=</span>&nbsp;<span class="num" id="5606190">0</span>&nbsp;<span class="op" id="5606192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606196">return</span>&nbsp;<span class="num" id="5606203">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5606206">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606209">return</span>&nbsp;<span class="ident" id="5606216">b</span><span class="op" id="5606217">.</span><span class="ident" id="5606218">duration</span><span class="op" id="5606226">.</span><span class="ident" id="5606227">Nanoseconds</span><span class="op" id="5606238">(</span><span class="op" id="5606239">)</span>&nbsp;<span class="op" id="5606241">/</span>&nbsp;<span class="ident" id="5606243">int64</span><span class="op" id="5606248">(</span><span class="ident" id="5606249">b</span><span class="op" id="5606250">.</span><span class="ident" id="5606251">N</span><span class="op" id="5606252">)</span><br>
<span class="lineno"></span><span class="op" id="5606254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5606257">//&nbsp;runN&nbsp;runs&nbsp;a&nbsp;single&nbsp;benchmark&nbsp;for&nbsp;the&nbsp;specified&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span><span class="keyword" id="5606329">func</span>&nbsp;<span class="op" id="5606334">(</span><span class="ident" id="5606335">b</span>&nbsp;<span class="op" id="5606337">*</span><span class="ident" id="5606338">B</span><span class="op" id="5606339">)</span>&nbsp;<span class="ident" id="5606341">runN</span><span class="op" id="5606345">(</span><span class="ident" id="5606346">n</span>&nbsp;<span class="builtintype" id="5606348">int</span><span class="op" id="5606351">)</span>&nbsp;<span class="op" id="5606353">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606356">benchmarkLock</span><span class="op" id="5606369">.</span><span class="ident" id="5606370">Lock</span><span class="op" id="5606374">(</span><span class="op" id="5606375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606378">defer</span>&nbsp;<span class="ident" id="5606384">benchmarkLock</span><span class="op" id="5606397">.</span><span class="ident" id="5606398">Unlock</span><span class="op" id="5606404">(</span><span class="op" id="5606405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5606408">//&nbsp;Try&nbsp;to&nbsp;get&nbsp;a&nbsp;comparable&nbsp;environment&nbsp;for&nbsp;each&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5606461">//&nbsp;by&nbsp;clearing&nbsp;garbage&nbsp;from&nbsp;previous&nbsp;runs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606505">runtime</span><span class="op" id="5606512">.</span><span class="ident" id="5606513">GC</span><span class="op" id="5606515">(</span><span class="op" id="5606516">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606519">b</span><span class="op" id="5606520">.</span><span class="ident" id="5606521">N</span>&nbsp;<span class="op" id="5606523">=</span>&nbsp;<span class="ident" id="5606525">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606528">b</span><span class="op" id="5606529">.</span><span class="ident" id="5606530">parallelism</span>&nbsp;<span class="op" id="5606542">=</span>&nbsp;<span class="num" id="5606544">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606547">b</span><span class="op" id="5606548">.</span><span class="ident" id="5606549">ResetTimer</span><span class="op" id="5606559">(</span><span class="op" id="5606560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606563">b</span><span class="op" id="5606564">.</span><span class="ident" id="5606565">StartTimer</span><span class="op" id="5606575">(</span><span class="op" id="5606576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606579">b</span><span class="op" id="5606580">.</span><span class="ident" id="5606581">benchmark</span><span class="op" id="5606590">.</span><span class="ident" id="5606591">F</span><span class="op" id="5606592">(</span><span class="ident" id="5606593">b</span><span class="op" id="5606594">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606597">b</span><span class="op" id="5606598">.</span><span class="ident" id="5606599">StopTimer</span><span class="op" id="5606608">(</span><span class="op" id="5606609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606612">b</span><span class="op" id="5606613">.</span><span class="ident" id="5606614">previousN</span>&nbsp;<span class="op" id="5606624">=</span>&nbsp;<span class="ident" id="5606626">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606629">b</span><span class="op" id="5606630">.</span><span class="ident" id="5606631">previousDuration</span>&nbsp;<span class="op" id="5606648">=</span>&nbsp;<span class="ident" id="5606650">b</span><span class="op" id="5606651">.</span><span class="ident" id="5606652">duration</span><br>
<span class="lineno"></span><span class="op" id="5606661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5606664">func</span>&nbsp;<span class="ident" id="5606669">min</span><span class="op" id="5606672">(</span><span class="ident" id="5606673">x</span><span class="op" id="5606674">,</span>&nbsp;<span class="ident" id="5606676">y</span>&nbsp;<span class="builtintype" id="5606678">int</span><span class="op" id="5606681">)</span>&nbsp;<span class="builtintype" id="5606683">int</span>&nbsp;<span class="op" id="5606687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606690">if</span>&nbsp;<span class="ident" id="5606693">x</span>&nbsp;<span class="op" id="5606695">&gt;</span>&nbsp;<span class="ident" id="5606697">y</span>&nbsp;<span class="op" id="5606699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606703">return</span>&nbsp;<span class="ident" id="5606710">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5606713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606716">return</span>&nbsp;<span class="ident" id="5606723">x</span><br>
<span class="lineno">135</span><span class="op" id="5606725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5606728">func</span>&nbsp;<span class="ident" id="5606733">max</span><span class="op" id="5606736">(</span><span class="ident" id="5606737">x</span><span class="op" id="5606738">,</span>&nbsp;<span class="ident" id="5606740">y</span>&nbsp;<span class="builtintype" id="5606742">int</span><span class="op" id="5606745">)</span>&nbsp;<span class="builtintype" id="5606747">int</span>&nbsp;<span class="op" id="5606751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606754">if</span>&nbsp;<span class="ident" id="5606757">x</span>&nbsp;<span class="op" id="5606759">&lt;</span>&nbsp;<span class="ident" id="5606761">y</span>&nbsp;<span class="op" id="5606763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606767">return</span>&nbsp;<span class="ident" id="5606774">y</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5606777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606780">return</span>&nbsp;<span class="ident" id="5606787">x</span><br>
<span class="lineno"></span><span class="op" id="5606789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5606792">//&nbsp;roundDown10&nbsp;rounds&nbsp;a&nbsp;number&nbsp;down&nbsp;to&nbsp;the&nbsp;nearest&nbsp;power&nbsp;of&nbsp;10.</span><br>
<span class="lineno">145</span><span class="keyword" id="5606856">func</span>&nbsp;<span class="ident" id="5606861">roundDown10</span><span class="op" id="5606872">(</span><span class="ident" id="5606873">n</span>&nbsp;<span class="builtintype" id="5606875">int</span><span class="op" id="5606878">)</span>&nbsp;<span class="builtintype" id="5606880">int</span>&nbsp;<span class="op" id="5606884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606887">var</span>&nbsp;<span class="ident" id="5606891">tens</span>&nbsp;<span class="op" id="5606896">=</span>&nbsp;<span class="num" id="5606898">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5606901">//&nbsp;tens&nbsp;=&nbsp;floor(log_10(n))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5606929">for</span>&nbsp;<span class="ident" id="5606933">n</span>&nbsp;<span class="op" id="5606935">&gt;=</span>&nbsp;<span class="num" id="5606938">10</span>&nbsp;<span class="op" id="5606941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606945">n</span>&nbsp;<span class="op" id="5606947">=</span>&nbsp;<span class="ident" id="5606949">n</span>&nbsp;<span class="op" id="5606951">/</span>&nbsp;<span class="num" id="5606953">10</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606958">tens</span><span class="op" id="5606962">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5606966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5606969">//&nbsp;result&nbsp;=&nbsp;10^tens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5606990">result</span>&nbsp;<span class="op" id="5606997">:=</span>&nbsp;<span class="num" id="5607000">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607003">for</span>&nbsp;<span class="ident" id="5607007">i</span>&nbsp;<span class="op" id="5607009">:=</span>&nbsp;<span class="num" id="5607012">0</span><span class="op" id="5607013">;</span>&nbsp;<span class="ident" id="5607015">i</span>&nbsp;<span class="op" id="5607017">&lt;</span>&nbsp;<span class="ident" id="5607019">tens</span><span class="op" id="5607023">;</span>&nbsp;<span class="ident" id="5607025">i</span><span class="op" id="5607026">++</span>&nbsp;<span class="op" id="5607029">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607033">result</span>&nbsp;<span class="op" id="5607040">*=</span>&nbsp;<span class="num" id="5607043">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5607047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607050">return</span>&nbsp;<span class="ident" id="5607057">result</span><br>
<span class="lineno"></span><span class="op" id="5607064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5607067">//&nbsp;roundUp&nbsp;rounds&nbsp;x&nbsp;up&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;the&nbsp;form&nbsp;[1eX,&nbsp;2eX,&nbsp;3eX,&nbsp;5eX].</span><br>
<span class="lineno"></span><span class="keyword" id="5607136">func</span>&nbsp;<span class="ident" id="5607141">roundUp</span><span class="op" id="5607148">(</span><span class="ident" id="5607149">n</span>&nbsp;<span class="builtintype" id="5607151">int</span><span class="op" id="5607154">)</span>&nbsp;<span class="builtintype" id="5607156">int</span>&nbsp;<span class="op" id="5607160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607163">base</span>&nbsp;<span class="op" id="5607168">:=</span>&nbsp;<span class="ident" id="5607171">roundDown10</span><span class="op" id="5607182">(</span><span class="ident" id="5607183">n</span><span class="op" id="5607184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607187">switch</span>&nbsp;<span class="op" id="5607194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607197">case</span>&nbsp;<span class="ident" id="5607202">n</span>&nbsp;<span class="op" id="5607204">&lt;=</span>&nbsp;<span class="ident" id="5607207">base</span><span class="op" id="5607211">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607215">return</span>&nbsp;<span class="ident" id="5607222">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607228">case</span>&nbsp;<span class="ident" id="5607233">n</span>&nbsp;<span class="op" id="5607235">&lt;=</span>&nbsp;<span class="op" id="5607238">(</span><span class="num" id="5607239">2</span>&nbsp;<span class="op" id="5607241">*</span>&nbsp;<span class="ident" id="5607243">base</span><span class="op" id="5607247">)</span><span class="op" id="5607248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607252">return</span>&nbsp;<span class="num" id="5607259">2</span>&nbsp;<span class="op" id="5607261">*</span>&nbsp;<span class="ident" id="5607263">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607269">case</span>&nbsp;<span class="ident" id="5607274">n</span>&nbsp;<span class="op" id="5607276">&lt;=</span>&nbsp;<span class="op" id="5607279">(</span><span class="num" id="5607280">3</span>&nbsp;<span class="op" id="5607282">*</span>&nbsp;<span class="ident" id="5607284">base</span><span class="op" id="5607288">)</span><span class="op" id="5607289">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607293">return</span>&nbsp;<span class="num" id="5607300">3</span>&nbsp;<span class="op" id="5607302">*</span>&nbsp;<span class="ident" id="5607304">base</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607310">case</span>&nbsp;<span class="ident" id="5607315">n</span>&nbsp;<span class="op" id="5607317">&lt;=</span>&nbsp;<span class="op" id="5607320">(</span><span class="num" id="5607321">5</span>&nbsp;<span class="op" id="5607323">*</span>&nbsp;<span class="ident" id="5607325">base</span><span class="op" id="5607329">)</span><span class="op" id="5607330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607334">return</span>&nbsp;<span class="num" id="5607341">5</span>&nbsp;<span class="op" id="5607343">*</span>&nbsp;<span class="ident" id="5607345">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607351">default</span><span class="op" id="5607358">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607362">return</span>&nbsp;<span class="num" id="5607369">10</span>&nbsp;<span class="op" id="5607372">*</span>&nbsp;<span class="ident" id="5607374">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5607380">}</span><br>
<span class="lineno">175</span><span class="op" id="5607382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5607385">//&nbsp;run&nbsp;times&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="5607446">func</span>&nbsp;<span class="op" id="5607451">(</span><span class="ident" id="5607452">b</span>&nbsp;<span class="op" id="5607454">*</span><span class="ident" id="5607455">B</span><span class="op" id="5607456">)</span>&nbsp;<span class="ident" id="5607458">run</span><span class="op" id="5607461">(</span><span class="op" id="5607462">)</span>&nbsp;<span class="ident" id="5607464">BenchmarkResult</span>&nbsp;<span class="op" id="5607480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607483">go</span>&nbsp;<span class="ident" id="5607486">b</span><span class="op" id="5607487">.</span><span class="ident" id="5607488">launch</span><span class="op" id="5607494">(</span><span class="op" id="5607495">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5607498">&lt;-</span><span class="ident" id="5607500">b</span><span class="op" id="5607501">.</span><span class="ident" id="5607502">signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5607510">return</span>&nbsp;<span class="ident" id="5607517">b</span><span class="op" id="5607518">.</span><span class="ident" id="5607519">result</span><br>
<span class="lineno"></span><span class="op" id="5607526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5607529">//&nbsp;launch&nbsp;launches&nbsp;the&nbsp;benchmark&nbsp;function.&nbsp;&nbsp;It&nbsp;gradually&nbsp;increases&nbsp;the&nbsp;number</span><br>
<span class="lineno">185</span><span class="comment" id="5607607">//&nbsp;of&nbsp;benchmark&nbsp;iterations&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;runs&nbsp;for&nbsp;the&nbsp;requested&nbsp;benchtime.</span><br>
<span class="lineno"></span><span class="comment" id="5607688">//&nbsp;It&nbsp;prints&nbsp;timing&nbsp;information&nbsp;in&nbsp;this&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5607733">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptesting.BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp100000&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp19&nbsp;ns/op</span><br>
<span class="lineno"></span><span class="comment" id="5607777">//&nbsp;launch&nbsp;is&nbsp;run&nbsp;by&nbsp;the&nbsp;run&nbsp;function&nbsp;as&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="5607839">func</span>&nbsp;<span class="op" id="5607844">(</span><span class="ident" id="5607845">b</span>&nbsp;<span class="op" id="5607847">*</span><span class="ident" id="5607848">B</span><span class="op" id="5607849">)</span>&nbsp;<span class="ident" id="5607851">launch</span><span class="op" id="5607857">(</span><span class="op" id="5607858">)</span>&nbsp;<span class="op" id="5607860">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5607863">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;a&nbsp;single&nbsp;iteration&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;expensive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5607932">n</span>&nbsp;<span class="op" id="5607934">:=</span>&nbsp;<span class="num" id="5607937">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5607941">//&nbsp;Signal&nbsp;that&nbsp;we&#39;re&nbsp;done&nbsp;whether&nbsp;we&nbsp;return&nbsp;normally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5607995">//&nbsp;or&nbsp;by&nbsp;FailNow&#39;s&nbsp;runtime.Goexit.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608031">defer</span>&nbsp;<span class="keyword" id="5608037">func</span><span class="op" id="5608041">(</span><span class="op" id="5608042">)</span>&nbsp;<span class="op" id="5608044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608048">b</span><span class="op" id="5608049">.</span><span class="ident" id="5608050">signal</span>&nbsp;<span class="op" id="5608057">&lt;-</span>&nbsp;<span class="ident" id="5608060">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608063">}</span><span class="op" id="5608064">(</span><span class="op" id="5608065">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608069">b</span><span class="op" id="5608070">.</span><span class="ident" id="5608071">runN</span><span class="op" id="5608075">(</span><span class="ident" id="5608076">n</span><span class="op" id="5608077">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5608080">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;specified&nbsp;amount&nbsp;of&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608145">d</span>&nbsp;<span class="op" id="5608147">:=</span>&nbsp;<span class="op" id="5608150">*</span><span class="ident" id="5608151">benchTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608162">for</span>&nbsp;<span class="op" id="5608166">!</span><span class="ident" id="5608167">b</span><span class="op" id="5608168">.</span><span class="ident" id="5608169">failed</span>&nbsp;<span class="op" id="5608176">&amp;&amp;</span>&nbsp;<span class="ident" id="5608179">b</span><span class="op" id="5608180">.</span><span class="ident" id="5608181">duration</span>&nbsp;<span class="op" id="5608190">&lt;</span>&nbsp;<span class="ident" id="5608192">d</span>&nbsp;<span class="op" id="5608194">&amp;&amp;</span>&nbsp;<span class="ident" id="5608197">n</span>&nbsp;<span class="op" id="5608199">&lt;</span>&nbsp;<span class="num" id="5608201">1e9</span>&nbsp;<span class="op" id="5608205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608209">last</span>&nbsp;<span class="op" id="5608214">:=</span>&nbsp;<span class="ident" id="5608217">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5608221">//&nbsp;Predict&nbsp;required&nbsp;iterations.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608255">if</span>&nbsp;<span class="ident" id="5608258">b</span><span class="op" id="5608259">.</span><span class="ident" id="5608260">nsPerOp</span><span class="op" id="5608267">(</span><span class="op" id="5608268">)</span>&nbsp;<span class="op" id="5608270">==</span>&nbsp;<span class="num" id="5608273">0</span>&nbsp;<span class="op" id="5608275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608280">n</span>&nbsp;<span class="op" id="5608282">=</span>&nbsp;<span class="num" id="5608284">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608290">}</span>&nbsp;<span class="keyword" id="5608292">else</span>&nbsp;<span class="op" id="5608297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608302">n</span>&nbsp;<span class="op" id="5608304">=</span>&nbsp;<span class="builtintype" id="5608306">int</span><span class="op" id="5608309">(</span><span class="ident" id="5608310">d</span><span class="op" id="5608311">.</span><span class="ident" id="5608312">Nanoseconds</span><span class="op" id="5608323">(</span><span class="op" id="5608324">)</span>&nbsp;<span class="op" id="5608326">/</span>&nbsp;<span class="ident" id="5608328">b</span><span class="op" id="5608329">.</span><span class="ident" id="5608330">nsPerOp</span><span class="op" id="5608337">(</span><span class="op" id="5608338">)</span><span class="op" id="5608339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608343">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5608347">//&nbsp;Run&nbsp;more&nbsp;iterations&nbsp;than&nbsp;we&nbsp;think&nbsp;we&#39;ll&nbsp;need&nbsp;(1.2x).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5608405">//&nbsp;Don&#39;t&nbsp;grow&nbsp;too&nbsp;fast&nbsp;in&nbsp;case&nbsp;we&nbsp;had&nbsp;timing&nbsp;errors&nbsp;previously.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5608471">//&nbsp;Be&nbsp;sure&nbsp;to&nbsp;run&nbsp;at&nbsp;least&nbsp;one&nbsp;more&nbsp;than&nbsp;last&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608525">n</span>&nbsp;<span class="op" id="5608527">=</span>&nbsp;<span class="ident" id="5608529">max</span><span class="op" id="5608532">(</span><span class="ident" id="5608533">min</span><span class="op" id="5608536">(</span><span class="ident" id="5608537">n</span><span class="op" id="5608538">+</span><span class="ident" id="5608539">n</span><span class="op" id="5608540">/</span><span class="num" id="5608541">5</span><span class="op" id="5608542">,</span>&nbsp;<span class="num" id="5608544">100</span><span class="op" id="5608547">*</span><span class="ident" id="5608548">last</span><span class="op" id="5608552">)</span><span class="op" id="5608553">,</span>&nbsp;<span class="ident" id="5608555">last</span><span class="op" id="5608559">+</span><span class="num" id="5608560">1</span><span class="op" id="5608561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5608565">//&nbsp;Round&nbsp;up&nbsp;to&nbsp;something&nbsp;easy&nbsp;to&nbsp;read.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608606">n</span>&nbsp;<span class="op" id="5608608">=</span>&nbsp;<span class="ident" id="5608610">roundUp</span><span class="op" id="5608617">(</span><span class="ident" id="5608618">n</span><span class="op" id="5608619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608623">b</span><span class="op" id="5608624">.</span><span class="ident" id="5608625">runN</span><span class="op" id="5608629">(</span><span class="ident" id="5608630">n</span><span class="op" id="5608631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608637">b</span><span class="op" id="5608638">.</span><span class="ident" id="5608639">result</span>&nbsp;<span class="op" id="5608646">=</span>&nbsp;<span class="ident" id="5608648">BenchmarkResult</span><span class="op" id="5608663">{</span><span class="ident" id="5608664">b</span><span class="op" id="5608665">.</span><span class="ident" id="5608666">N</span><span class="op" id="5608667">,</span>&nbsp;<span class="ident" id="5608669">b</span><span class="op" id="5608670">.</span><span class="ident" id="5608671">duration</span><span class="op" id="5608679">,</span>&nbsp;<span class="ident" id="5608681">b</span><span class="op" id="5608682">.</span><span class="ident" id="5608683">bytes</span><span class="op" id="5608688">,</span>&nbsp;<span class="ident" id="5608690">b</span><span class="op" id="5608691">.</span><span class="ident" id="5608692">netAllocs</span><span class="op" id="5608701">,</span>&nbsp;<span class="ident" id="5608703">b</span><span class="op" id="5608704">.</span><span class="ident" id="5608705">netBytes</span><span class="op" id="5608713">}</span><br>
<span class="lineno"></span><span class="op" id="5608715">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5608718">//&nbsp;The&nbsp;results&nbsp;of&nbsp;a&nbsp;benchmark&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="5608753">type</span>&nbsp;<span class="ident" id="5608758">BenchmarkResult</span>&nbsp;<span class="keyword" id="5608774">struct</span>&nbsp;<span class="op" id="5608781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608784">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5608794">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5608808">//&nbsp;The&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608838">T</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5608848">time</span><span class="op" id="5608852">.</span><span class="ident" id="5608853">Duration</span>&nbsp;<span class="comment" id="5608862">//&nbsp;The&nbsp;total&nbsp;time&nbsp;taken.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608888">Bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5608898">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5608912">//&nbsp;Bytes&nbsp;processed&nbsp;in&nbsp;one&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608950">MemAllocs</span>&nbsp;<span class="ident" id="5608960">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5608974">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;memory&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609018">MemBytes</span>&nbsp;&nbsp;<span class="ident" id="5609028">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5609042">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno"></span><span class="op" id="5609082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="5609085">func</span>&nbsp;<span class="op" id="5609090">(</span><span class="ident" id="5609091">r</span>&nbsp;<span class="ident" id="5609093">BenchmarkResult</span><span class="op" id="5609108">)</span>&nbsp;<span class="ident" id="5609110">NsPerOp</span><span class="op" id="5609117">(</span><span class="op" id="5609118">)</span>&nbsp;<span class="ident" id="5609120">int64</span>&nbsp;<span class="op" id="5609126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609129">if</span>&nbsp;<span class="ident" id="5609132">r</span><span class="op" id="5609133">.</span><span class="ident" id="5609134">N</span>&nbsp;<span class="op" id="5609136">&lt;=</span>&nbsp;<span class="num" id="5609139">0</span>&nbsp;<span class="op" id="5609141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609145">return</span>&nbsp;<span class="num" id="5609152">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609158">return</span>&nbsp;<span class="ident" id="5609165">r</span><span class="op" id="5609166">.</span><span class="ident" id="5609167">T</span><span class="op" id="5609168">.</span><span class="ident" id="5609169">Nanoseconds</span><span class="op" id="5609180">(</span><span class="op" id="5609181">)</span>&nbsp;<span class="op" id="5609183">/</span>&nbsp;<span class="ident" id="5609185">int64</span><span class="op" id="5609190">(</span><span class="ident" id="5609191">r</span><span class="op" id="5609192">.</span><span class="ident" id="5609193">N</span><span class="op" id="5609194">)</span><br>
<span class="lineno">235</span><span class="op" id="5609196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5609199">func</span>&nbsp;<span class="op" id="5609204">(</span><span class="ident" id="5609205">r</span>&nbsp;<span class="ident" id="5609207">BenchmarkResult</span><span class="op" id="5609222">)</span>&nbsp;<span class="ident" id="5609224">mbPerSec</span><span class="op" id="5609232">(</span><span class="op" id="5609233">)</span>&nbsp;<span class="builtintype" id="5609235">float64</span>&nbsp;<span class="op" id="5609243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609246">if</span>&nbsp;<span class="ident" id="5609249">r</span><span class="op" id="5609250">.</span><span class="ident" id="5609251">Bytes</span>&nbsp;<span class="op" id="5609257">&lt;=</span>&nbsp;<span class="num" id="5609260">0</span>&nbsp;<span class="op" id="5609262">||</span>&nbsp;<span class="ident" id="5609265">r</span><span class="op" id="5609266">.</span><span class="ident" id="5609267">T</span>&nbsp;<span class="op" id="5609269">&lt;=</span>&nbsp;<span class="num" id="5609272">0</span>&nbsp;<span class="op" id="5609274">||</span>&nbsp;<span class="ident" id="5609277">r</span><span class="op" id="5609278">.</span><span class="ident" id="5609279">N</span>&nbsp;<span class="op" id="5609281">&lt;=</span>&nbsp;<span class="num" id="5609284">0</span>&nbsp;<span class="op" id="5609286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609290">return</span>&nbsp;<span class="num" id="5609297">0</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609303">return</span>&nbsp;<span class="op" id="5609310">(</span><span class="builtintype" id="5609311">float64</span><span class="op" id="5609318">(</span><span class="ident" id="5609319">r</span><span class="op" id="5609320">.</span><span class="ident" id="5609321">Bytes</span><span class="op" id="5609326">)</span>&nbsp;<span class="op" id="5609328">*</span>&nbsp;<span class="builtintype" id="5609330">float64</span><span class="op" id="5609337">(</span><span class="ident" id="5609338">r</span><span class="op" id="5609339">.</span><span class="ident" id="5609340">N</span><span class="op" id="5609341">)</span>&nbsp;<span class="op" id="5609343">/</span>&nbsp;<span class="num" id="5609345">1e6</span><span class="op" id="5609348">)</span>&nbsp;<span class="op" id="5609350">/</span>&nbsp;<span class="ident" id="5609352">r</span><span class="op" id="5609353">.</span><span class="ident" id="5609354">T</span><span class="op" id="5609355">.</span><span class="ident" id="5609356">Seconds</span><span class="op" id="5609363">(</span><span class="op" id="5609364">)</span><br>
<span class="lineno"></span><span class="op" id="5609366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5609369">func</span>&nbsp;<span class="op" id="5609374">(</span><span class="ident" id="5609375">r</span>&nbsp;<span class="ident" id="5609377">BenchmarkResult</span><span class="op" id="5609392">)</span>&nbsp;<span class="ident" id="5609394">AllocsPerOp</span><span class="op" id="5609405">(</span><span class="op" id="5609406">)</span>&nbsp;<span class="ident" id="5609408">int64</span>&nbsp;<span class="op" id="5609414">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609417">if</span>&nbsp;<span class="ident" id="5609420">r</span><span class="op" id="5609421">.</span><span class="ident" id="5609422">N</span>&nbsp;<span class="op" id="5609424">&lt;=</span>&nbsp;<span class="num" id="5609427">0</span>&nbsp;<span class="op" id="5609429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609433">return</span>&nbsp;<span class="num" id="5609440">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609446">return</span>&nbsp;<span class="ident" id="5609453">int64</span><span class="op" id="5609458">(</span><span class="ident" id="5609459">r</span><span class="op" id="5609460">.</span><span class="ident" id="5609461">MemAllocs</span><span class="op" id="5609470">)</span>&nbsp;<span class="op" id="5609472">/</span>&nbsp;<span class="ident" id="5609474">int64</span><span class="op" id="5609479">(</span><span class="ident" id="5609480">r</span><span class="op" id="5609481">.</span><span class="ident" id="5609482">N</span><span class="op" id="5609483">)</span><br>
<span class="lineno"></span><span class="op" id="5609485">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="5609488">func</span>&nbsp;<span class="op" id="5609493">(</span><span class="ident" id="5609494">r</span>&nbsp;<span class="ident" id="5609496">BenchmarkResult</span><span class="op" id="5609511">)</span>&nbsp;<span class="ident" id="5609513">AllocedBytesPerOp</span><span class="op" id="5609530">(</span><span class="op" id="5609531">)</span>&nbsp;<span class="ident" id="5609533">int64</span>&nbsp;<span class="op" id="5609539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609542">if</span>&nbsp;<span class="ident" id="5609545">r</span><span class="op" id="5609546">.</span><span class="ident" id="5609547">N</span>&nbsp;<span class="op" id="5609549">&lt;=</span>&nbsp;<span class="num" id="5609552">0</span>&nbsp;<span class="op" id="5609554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609558">return</span>&nbsp;<span class="num" id="5609565">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609568">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609571">return</span>&nbsp;<span class="ident" id="5609578">int64</span><span class="op" id="5609583">(</span><span class="ident" id="5609584">r</span><span class="op" id="5609585">.</span><span class="ident" id="5609586">MemBytes</span><span class="op" id="5609594">)</span>&nbsp;<span class="op" id="5609596">/</span>&nbsp;<span class="ident" id="5609598">int64</span><span class="op" id="5609603">(</span><span class="ident" id="5609604">r</span><span class="op" id="5609605">.</span><span class="ident" id="5609606">N</span><span class="op" id="5609607">)</span><br>
<span class="lineno"></span><span class="op" id="5609609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5609612">func</span>&nbsp;<span class="op" id="5609617">(</span><span class="ident" id="5609618">r</span>&nbsp;<span class="ident" id="5609620">BenchmarkResult</span><span class="op" id="5609635">)</span>&nbsp;<span class="ident" id="5609637">String</span><span class="op" id="5609643">(</span><span class="op" id="5609644">)</span>&nbsp;<span class="builtintype" id="5609646">string</span>&nbsp;<span class="op" id="5609653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609656">mbs</span>&nbsp;<span class="op" id="5609660">:=</span>&nbsp;<span class="ident" id="5609663">r</span><span class="op" id="5609664">.</span><span class="ident" id="5609665">mbPerSec</span><span class="op" id="5609673">(</span><span class="op" id="5609674">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609677">mb</span>&nbsp;<span class="op" id="5609680">:=</span>&nbsp;<span class="string" id="5609683">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609687">if</span>&nbsp;<span class="ident" id="5609690">mbs</span>&nbsp;<span class="op" id="5609694">!=</span>&nbsp;<span class="num" id="5609697">0</span>&nbsp;<span class="op" id="5609699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609703">mb</span>&nbsp;<span class="op" id="5609706">=</span>&nbsp;<span class="ident" id="5609708">fmt</span><span class="op" id="5609711">.</span><span class="ident" id="5609712">Sprintf</span><span class="op" id="5609719">(</span><span class="string" id="5609720">&#34;\t%7.2f&nbsp;MB/s&#34;</span><span class="op" id="5609734">,</span>&nbsp;<span class="ident" id="5609736">mbs</span><span class="op" id="5609739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609745">nsop</span>&nbsp;<span class="op" id="5609750">:=</span>&nbsp;<span class="ident" id="5609753">r</span><span class="op" id="5609754">.</span><span class="ident" id="5609755">NsPerOp</span><span class="op" id="5609762">(</span><span class="op" id="5609763">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609766">ns</span>&nbsp;<span class="op" id="5609769">:=</span>&nbsp;<span class="ident" id="5609772">fmt</span><span class="op" id="5609775">.</span><span class="ident" id="5609776">Sprintf</span><span class="op" id="5609783">(</span><span class="string" id="5609784">&#34;%10d&nbsp;ns/op&#34;</span><span class="op" id="5609796">,</span>&nbsp;<span class="ident" id="5609798">nsop</span><span class="op" id="5609802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609805">if</span>&nbsp;<span class="ident" id="5609808">r</span><span class="op" id="5609809">.</span><span class="ident" id="5609810">N</span>&nbsp;<span class="op" id="5609812">&gt;</span>&nbsp;<span class="num" id="5609814">0</span>&nbsp;<span class="op" id="5609816">&amp;&amp;</span>&nbsp;<span class="ident" id="5609819">nsop</span>&nbsp;<span class="op" id="5609824">&lt;</span>&nbsp;<span class="num" id="5609826">100</span>&nbsp;<span class="op" id="5609830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5609834">//&nbsp;The&nbsp;format&nbsp;specifiers&nbsp;here&nbsp;make&nbsp;sure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5609881">//&nbsp;the&nbsp;ones&nbsp;digits&nbsp;line&nbsp;up&nbsp;for&nbsp;all&nbsp;three&nbsp;possible&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609942">if</span>&nbsp;<span class="ident" id="5609945">nsop</span>&nbsp;<span class="op" id="5609950">&lt;</span>&nbsp;<span class="num" id="5609952">10</span>&nbsp;<span class="op" id="5609955">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609960">ns</span>&nbsp;<span class="op" id="5609963">=</span>&nbsp;<span class="ident" id="5609965">fmt</span><span class="op" id="5609968">.</span><span class="ident" id="5609969">Sprintf</span><span class="op" id="5609976">(</span><span class="string" id="5609977">&#34;%13.2f&nbsp;ns/op&#34;</span><span class="op" id="5609991">,</span>&nbsp;<span class="builtintype" id="5609993">float64</span><span class="op" id="5610000">(</span><span class="ident" id="5610001">r</span><span class="op" id="5610002">.</span><span class="ident" id="5610003">T</span><span class="op" id="5610004">.</span><span class="ident" id="5610005">Nanoseconds</span><span class="op" id="5610016">(</span><span class="op" id="5610017">)</span><span class="op" id="5610018">)</span><span class="op" id="5610019">/</span><span class="builtintype" id="5610020">float64</span><span class="op" id="5610027">(</span><span class="ident" id="5610028">r</span><span class="op" id="5610029">.</span><span class="ident" id="5610030">N</span><span class="op" id="5610031">)</span><span class="op" id="5610032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610036">}</span>&nbsp;<span class="keyword" id="5610038">else</span>&nbsp;<span class="op" id="5610043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610048">ns</span>&nbsp;<span class="op" id="5610051">=</span>&nbsp;<span class="ident" id="5610053">fmt</span><span class="op" id="5610056">.</span><span class="ident" id="5610057">Sprintf</span><span class="op" id="5610064">(</span><span class="string" id="5610065">&#34;%12.1f&nbsp;ns/op&#34;</span><span class="op" id="5610079">,</span>&nbsp;<span class="builtintype" id="5610081">float64</span><span class="op" id="5610088">(</span><span class="ident" id="5610089">r</span><span class="op" id="5610090">.</span><span class="ident" id="5610091">T</span><span class="op" id="5610092">.</span><span class="ident" id="5610093">Nanoseconds</span><span class="op" id="5610104">(</span><span class="op" id="5610105">)</span><span class="op" id="5610106">)</span><span class="op" id="5610107">/</span><span class="builtintype" id="5610108">float64</span><span class="op" id="5610115">(</span><span class="ident" id="5610116">r</span><span class="op" id="5610117">.</span><span class="ident" id="5610118">N</span><span class="op" id="5610119">)</span><span class="op" id="5610120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610127">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610130">return</span>&nbsp;<span class="ident" id="5610137">fmt</span><span class="op" id="5610140">.</span><span class="ident" id="5610141">Sprintf</span><span class="op" id="5610148">(</span><span class="string" id="5610149">&#34;%8d\t%s%s&#34;</span><span class="op" id="5610160">,</span>&nbsp;<span class="ident" id="5610162">r</span><span class="op" id="5610163">.</span><span class="ident" id="5610164">N</span><span class="op" id="5610165">,</span>&nbsp;<span class="ident" id="5610167">ns</span><span class="op" id="5610169">,</span>&nbsp;<span class="ident" id="5610171">mb</span><span class="op" id="5610173">)</span><br>
<span class="lineno"></span><span class="op" id="5610175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5610178">func</span>&nbsp;<span class="op" id="5610183">(</span><span class="ident" id="5610184">r</span>&nbsp;<span class="ident" id="5610186">BenchmarkResult</span><span class="op" id="5610201">)</span>&nbsp;<span class="ident" id="5610203">MemString</span><span class="op" id="5610212">(</span><span class="op" id="5610213">)</span>&nbsp;<span class="builtintype" id="5610215">string</span>&nbsp;<span class="op" id="5610222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610225">return</span>&nbsp;<span class="ident" id="5610232">fmt</span><span class="op" id="5610235">.</span><span class="ident" id="5610236">Sprintf</span><span class="op" id="5610243">(</span><span class="string" id="5610244">&#34;%8d&nbsp;B/op\t%8d&nbsp;allocs/op&#34;</span><span class="op" id="5610269">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610273">r</span><span class="op" id="5610274">.</span><span class="ident" id="5610275">AllocedBytesPerOp</span><span class="op" id="5610292">(</span><span class="op" id="5610293">)</span><span class="op" id="5610294">,</span>&nbsp;<span class="ident" id="5610296">r</span><span class="op" id="5610297">.</span><span class="ident" id="5610298">AllocsPerOp</span><span class="op" id="5610309">(</span><span class="op" id="5610310">)</span><span class="op" id="5610311">)</span><br>
<span class="lineno"></span><span class="op" id="5610313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5610316">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5610409">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno">285</span><span class="keyword" id="5610438">func</span>&nbsp;<span class="ident" id="5610443">RunBenchmarks</span><span class="op" id="5610456">(</span><span class="ident" id="5610457">matchString</span>&nbsp;<span class="keyword" id="5610469">func</span><span class="op" id="5610473">(</span><span class="ident" id="5610474">pat</span><span class="op" id="5610477">,</span>&nbsp;<span class="ident" id="5610479">str</span>&nbsp;<span class="builtintype" id="5610483">string</span><span class="op" id="5610489">)</span>&nbsp;<span class="op" id="5610491">(</span><span class="builtintype" id="5610492">bool</span><span class="op" id="5610496">,</span>&nbsp;<span class="builtintype" id="5610498">error</span><span class="op" id="5610503">)</span><span class="op" id="5610504">,</span>&nbsp;<span class="ident" id="5610506">benchmarks</span>&nbsp;<span class="op" id="5610517">[</span><span class="op" id="5610518">]</span><span class="ident" id="5610519">InternalBenchmark</span><span class="op" id="5610536">)</span>&nbsp;<span class="op" id="5610538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5610541">//&nbsp;If&nbsp;no&nbsp;flag&nbsp;was&nbsp;specified,&nbsp;don&#39;t&nbsp;run&nbsp;benchmarks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610593">if</span>&nbsp;<span class="builtinfunc" id="5610596">len</span><span class="op" id="5610599">(</span><span class="op" id="5610600">*</span><span class="ident" id="5610601">matchBenchmarks</span><span class="op" id="5610616">)</span>&nbsp;<span class="op" id="5610618">==</span>&nbsp;<span class="num" id="5610621">0</span>&nbsp;<span class="op" id="5610623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610627">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610635">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610638">for</span>&nbsp;<span class="ident" id="5610642">_</span><span class="op" id="5610643">,</span>&nbsp;<span class="ident" id="5610645">Benchmark</span>&nbsp;<span class="op" id="5610655">:=</span>&nbsp;<span class="keyword" id="5610658">range</span>&nbsp;<span class="ident" id="5610664">benchmarks</span>&nbsp;<span class="op" id="5610675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610679">matched</span><span class="op" id="5610686">,</span>&nbsp;<span class="ident" id="5610688">err</span>&nbsp;<span class="op" id="5610692">:=</span>&nbsp;<span class="ident" id="5610695">matchString</span><span class="op" id="5610706">(</span><span class="op" id="5610707">*</span><span class="ident" id="5610708">matchBenchmarks</span><span class="op" id="5610723">,</span>&nbsp;<span class="ident" id="5610725">Benchmark</span><span class="op" id="5610734">.</span><span class="ident" id="5610735">Name</span><span class="op" id="5610739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610743">if</span>&nbsp;<span class="ident" id="5610746">err</span>&nbsp;<span class="op" id="5610750">!=</span>&nbsp;<span class="ident" id="5610753">nil</span>&nbsp;<span class="op" id="5610757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610762">fmt</span><span class="op" id="5610765">.</span><span class="ident" id="5610766">Fprintf</span><span class="op" id="5610773">(</span><span class="ident" id="5610774">os</span><span class="op" id="5610776">.</span><span class="ident" id="5610777">Stderr</span><span class="op" id="5610783">,</span>&nbsp;<span class="string" id="5610785">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.bench:&nbsp;%s\n&#34;</span><span class="op" id="5610832">,</span>&nbsp;<span class="ident" id="5610834">err</span><span class="op" id="5610837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610842">os</span><span class="op" id="5610844">.</span><span class="ident" id="5610845">Exit</span><span class="op" id="5610849">(</span><span class="num" id="5610850">1</span><span class="op" id="5610851">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610859">if</span>&nbsp;<span class="op" id="5610862">!</span><span class="ident" id="5610863">matched</span>&nbsp;<span class="op" id="5610871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610876">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610891">for</span>&nbsp;<span class="ident" id="5610895">_</span><span class="op" id="5610896">,</span>&nbsp;<span class="ident" id="5610898">procs</span>&nbsp;<span class="op" id="5610904">:=</span>&nbsp;<span class="keyword" id="5610907">range</span>&nbsp;<span class="ident" id="5610913">cpuList</span>&nbsp;<span class="op" id="5610921">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610926">runtime</span><span class="op" id="5610933">.</span><span class="ident" id="5610934">GOMAXPROCS</span><span class="op" id="5610944">(</span><span class="ident" id="5610945">procs</span><span class="op" id="5610950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610955">b</span>&nbsp;<span class="op" id="5610957">:=</span>&nbsp;<span class="op" id="5610960">&amp;</span><span class="ident" id="5610961">B</span><span class="op" id="5610962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610968">common</span><span class="op" id="5610974">:</span>&nbsp;<span class="ident" id="5610976">common</span><span class="op" id="5610982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610989">signal</span><span class="op" id="5610995">:</span>&nbsp;<span class="builtinfunc" id="5610997">make</span><span class="op" id="5611001">(</span><span class="keyword" id="5611002">chan</span>&nbsp;<span class="keyword" id="5611007">interface</span><span class="op" id="5611016">{</span><span class="op" id="5611017">}</span><span class="op" id="5611018">)</span><span class="op" id="5611019">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611025">}</span><span class="op" id="5611026">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611032">benchmark</span><span class="op" id="5611041">:</span>&nbsp;<span class="ident" id="5611043">Benchmark</span><span class="op" id="5611052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611062">benchName</span>&nbsp;<span class="op" id="5611072">:=</span>&nbsp;<span class="ident" id="5611075">Benchmark</span><span class="op" id="5611084">.</span><span class="ident" id="5611085">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611093">if</span>&nbsp;<span class="ident" id="5611096">procs</span>&nbsp;<span class="op" id="5611102">!=</span>&nbsp;<span class="num" id="5611105">1</span>&nbsp;<span class="op" id="5611107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611113">benchName</span>&nbsp;<span class="op" id="5611123">=</span>&nbsp;<span class="ident" id="5611125">fmt</span><span class="op" id="5611128">.</span><span class="ident" id="5611129">Sprintf</span><span class="op" id="5611136">(</span><span class="string" id="5611137">&#34;%s-%d&#34;</span><span class="op" id="5611144">,</span>&nbsp;<span class="ident" id="5611146">Benchmark</span><span class="op" id="5611155">.</span><span class="ident" id="5611156">Name</span><span class="op" id="5611160">,</span>&nbsp;<span class="ident" id="5611162">procs</span><span class="op" id="5611167">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611177">fmt</span><span class="op" id="5611180">.</span><span class="ident" id="5611181">Printf</span><span class="op" id="5611187">(</span><span class="string" id="5611188">&#34;%s\t&#34;</span><span class="op" id="5611194">,</span>&nbsp;<span class="ident" id="5611196">benchName</span><span class="op" id="5611205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611210">r</span>&nbsp;<span class="op" id="5611212">:=</span>&nbsp;<span class="ident" id="5611215">b</span><span class="op" id="5611216">.</span><span class="ident" id="5611217">run</span><span class="op" id="5611220">(</span><span class="op" id="5611221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611226">if</span>&nbsp;<span class="ident" id="5611229">b</span><span class="op" id="5611230">.</span><span class="ident" id="5611231">failed</span>&nbsp;<span class="op" id="5611238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5611244">//&nbsp;The&nbsp;output&nbsp;could&nbsp;be&nbsp;very&nbsp;long&nbsp;here,&nbsp;but&nbsp;probably&nbsp;isn&#39;t.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5611307">//&nbsp;We&nbsp;print&nbsp;it&nbsp;all,&nbsp;regardless,&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;trim&nbsp;the&nbsp;reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5611384">//&nbsp;the&nbsp;benchmark&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611413">fmt</span><span class="op" id="5611416">.</span><span class="ident" id="5611417">Printf</span><span class="op" id="5611423">(</span><span class="string" id="5611424">&#34;---&nbsp;FAIL:&nbsp;%s\n%s&#34;</span><span class="op" id="5611442">,</span>&nbsp;<span class="ident" id="5611444">benchName</span><span class="op" id="5611453">,</span>&nbsp;<span class="ident" id="5611455">b</span><span class="op" id="5611456">.</span><span class="ident" id="5611457">output</span><span class="op" id="5611463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611469">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611481">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611486">results</span>&nbsp;<span class="op" id="5611494">:=</span>&nbsp;<span class="ident" id="5611497">r</span><span class="op" id="5611498">.</span><span class="ident" id="5611499">String</span><span class="op" id="5611505">(</span><span class="op" id="5611506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611511">if</span>&nbsp;<span class="op" id="5611514">*</span><span class="ident" id="5611515">benchmarkMemory</span>&nbsp;<span class="op" id="5611531">||</span>&nbsp;<span class="ident" id="5611534">b</span><span class="op" id="5611535">.</span><span class="ident" id="5611536">showAllocResult</span>&nbsp;<span class="op" id="5611552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611558">results</span>&nbsp;<span class="op" id="5611566">+=</span>&nbsp;<span class="string" id="5611569">&#34;\t&#34;</span>&nbsp;<span class="op" id="5611574">+</span>&nbsp;<span class="ident" id="5611576">r</span><span class="op" id="5611577">.</span><span class="ident" id="5611578">MemString</span><span class="op" id="5611587">(</span><span class="op" id="5611588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611598">fmt</span><span class="op" id="5611601">.</span><span class="ident" id="5611602">Println</span><span class="op" id="5611609">(</span><span class="ident" id="5611610">results</span><span class="op" id="5611617">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5611622">//&nbsp;Unlike&nbsp;with&nbsp;tests,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;-chatty&nbsp;flag&nbsp;and&nbsp;always&nbsp;print&nbsp;output&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5611702">//&nbsp;benchmarks&nbsp;since&nbsp;the&nbsp;output&nbsp;generation&nbsp;time&nbsp;will&nbsp;skew&nbsp;the&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611775">if</span>&nbsp;<span class="builtinfunc" id="5611778">len</span><span class="op" id="5611781">(</span><span class="ident" id="5611782">b</span><span class="op" id="5611783">.</span><span class="ident" id="5611784">output</span><span class="op" id="5611790">)</span>&nbsp;<span class="op" id="5611792">&gt;</span>&nbsp;<span class="num" id="5611794">0</span>&nbsp;<span class="op" id="5611796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611802">b</span><span class="op" id="5611803">.</span><span class="ident" id="5611804">trimOutput</span><span class="op" id="5611814">(</span><span class="op" id="5611815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611821">fmt</span><span class="op" id="5611824">.</span><span class="ident" id="5611825">Printf</span><span class="op" id="5611831">(</span><span class="string" id="5611832">&#34;---&nbsp;BENCH:&nbsp;%s\n%s&#34;</span><span class="op" id="5611851">,</span>&nbsp;<span class="ident" id="5611853">benchName</span><span class="op" id="5611862">,</span>&nbsp;<span class="ident" id="5611864">b</span><span class="op" id="5611865">.</span><span class="ident" id="5611866">output</span><span class="op" id="5611872">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611882">if</span>&nbsp;<span class="ident" id="5611885">p</span>&nbsp;<span class="op" id="5611887">:=</span>&nbsp;<span class="ident" id="5611890">runtime</span><span class="op" id="5611897">.</span><span class="ident" id="5611898">GOMAXPROCS</span><span class="op" id="5611908">(</span><span class="op" id="5611909">-</span><span class="num" id="5611910">1</span><span class="op" id="5611911">)</span><span class="op" id="5611912">;</span>&nbsp;<span class="ident" id="5611914">p</span>&nbsp;<span class="op" id="5611916">!=</span>&nbsp;<span class="ident" id="5611919">procs</span>&nbsp;<span class="op" id="5611925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611931">fmt</span><span class="op" id="5611934">.</span><span class="ident" id="5611935">Fprintf</span><span class="op" id="5611942">(</span><span class="ident" id="5611943">os</span><span class="op" id="5611945">.</span><span class="ident" id="5611946">Stderr</span><span class="op" id="5611952">,</span>&nbsp;<span class="string" id="5611954">&#34;testing:&nbsp;%s&nbsp;left&nbsp;GOMAXPROCS&nbsp;set&nbsp;to&nbsp;%d\n&#34;</span><span class="op" id="5611995">,</span>&nbsp;<span class="ident" id="5611997">benchName</span><span class="op" id="5612006">,</span>&nbsp;<span class="ident" id="5612008">p</span><span class="op" id="5612009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612018">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612021">}</span><br>
<span class="lineno"></span><span class="op" id="5612023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5612026">//&nbsp;trimOutput&nbsp;shortens&nbsp;the&nbsp;output&nbsp;from&nbsp;a&nbsp;benchmark,&nbsp;which&nbsp;can&nbsp;be&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="5612102">func</span>&nbsp;<span class="op" id="5612107">(</span><span class="ident" id="5612108">b</span>&nbsp;<span class="op" id="5612110">*</span><span class="ident" id="5612111">B</span><span class="op" id="5612112">)</span>&nbsp;<span class="ident" id="5612114">trimOutput</span><span class="op" id="5612124">(</span><span class="op" id="5612125">)</span>&nbsp;<span class="op" id="5612127">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5612130">//&nbsp;The&nbsp;output&nbsp;is&nbsp;likely&nbsp;to&nbsp;appear&nbsp;multiple&nbsp;times&nbsp;because&nbsp;the&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5612202">//&nbsp;is&nbsp;run&nbsp;multiple&nbsp;times,&nbsp;but&nbsp;at&nbsp;least&nbsp;it&nbsp;will&nbsp;be&nbsp;seen.&nbsp;This&nbsp;is&nbsp;not&nbsp;a&nbsp;big&nbsp;deal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5612282">//&nbsp;because&nbsp;benchmarks&nbsp;rarely&nbsp;print,&nbsp;but&nbsp;just&nbsp;in&nbsp;case,&nbsp;we&nbsp;trim&nbsp;it&nbsp;if&nbsp;it&#39;s&nbsp;too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612366">const</span>&nbsp;<span class="ident" id="5612372">maxNewlines</span>&nbsp;<span class="op" id="5612384">=</span>&nbsp;<span class="num" id="5612386">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612390">for</span>&nbsp;<span class="ident" id="5612394">nlCount</span><span class="op" id="5612401">,</span>&nbsp;<span class="ident" id="5612403">j</span>&nbsp;<span class="op" id="5612405">:=</span>&nbsp;<span class="num" id="5612408">0</span><span class="op" id="5612409">,</span>&nbsp;<span class="num" id="5612411">0</span><span class="op" id="5612412">;</span>&nbsp;<span class="ident" id="5612414">j</span>&nbsp;<span class="op" id="5612416">&lt;</span>&nbsp;<span class="builtinfunc" id="5612418">len</span><span class="op" id="5612421">(</span><span class="ident" id="5612422">b</span><span class="op" id="5612423">.</span><span class="ident" id="5612424">output</span><span class="op" id="5612430">)</span><span class="op" id="5612431">;</span>&nbsp;<span class="ident" id="5612433">j</span><span class="op" id="5612434">++</span>&nbsp;<span class="op" id="5612437">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612441">if</span>&nbsp;<span class="ident" id="5612444">b</span><span class="op" id="5612445">.</span><span class="ident" id="5612446">output</span><span class="op" id="5612452">[</span><span class="ident" id="5612453">j</span><span class="op" id="5612454">]</span>&nbsp;<span class="op" id="5612456">==</span>&nbsp;<span class="string" id="5612459">&#39;\n&#39;</span>&nbsp;<span class="op" id="5612464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612469">nlCount</span><span class="op" id="5612476">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612482">if</span>&nbsp;<span class="ident" id="5612485">nlCount</span>&nbsp;<span class="op" id="5612493">&gt;=</span>&nbsp;<span class="ident" id="5612496">maxNewlines</span>&nbsp;<span class="op" id="5612508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612514">b</span><span class="op" id="5612515">.</span><span class="ident" id="5612516">output</span>&nbsp;<span class="op" id="5612523">=</span>&nbsp;<span class="builtinfunc" id="5612525">append</span><span class="op" id="5612531">(</span><span class="ident" id="5612532">b</span><span class="op" id="5612533">.</span><span class="ident" id="5612534">output</span><span class="op" id="5612540">[</span><span class="op" id="5612541">:</span><span class="ident" id="5612542">j</span><span class="op" id="5612543">]</span><span class="op" id="5612544">,</span>&nbsp;<span class="string" id="5612546">&#34;\n\t...&nbsp;[output&nbsp;truncated]\n&#34;</span><span class="op" id="5612576">...</span><span class="op" id="5612579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5612585">break</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5612601">}</span><br>
<span class="lineno"></span><span class="op" id="5612603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="5612606">//&nbsp;A&nbsp;PB&nbsp;is&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;for&nbsp;running&nbsp;parallel&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="keyword" id="5612670">type</span>&nbsp;<span class="ident" id="5612675">PB</span>&nbsp;<span class="keyword" id="5612678">struct</span>&nbsp;<span class="op" id="5612685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612688">globalN</span>&nbsp;<span class="op" id="5612696">*</span><span class="ident" id="5612697">uint64</span>&nbsp;<span class="comment" id="5612704">//&nbsp;shared&nbsp;between&nbsp;all&nbsp;worker&nbsp;goroutines&nbsp;iteration&nbsp;counter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612763">grain</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5612771">uint64</span>&nbsp;&nbsp;<span class="comment" id="5612779">//&nbsp;acquire&nbsp;that&nbsp;many&nbsp;iterations&nbsp;from&nbsp;globalN&nbsp;at&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612833">cache</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5612841">uint64</span>&nbsp;&nbsp;<span class="comment" id="5612849">//&nbsp;local&nbsp;cache&nbsp;of&nbsp;acquired&nbsp;iterations</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5612888">bN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5612896">uint64</span>&nbsp;&nbsp;<span class="comment" id="5612904">//&nbsp;total&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;execute&nbsp;(b.N)</span><br>
<span class="lineno"></span><span class="op" id="5612951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5612954">//&nbsp;Next&nbsp;reports&nbsp;whether&nbsp;there&nbsp;are&nbsp;more&nbsp;iterations&nbsp;to&nbsp;execute.</span><br>
<span class="lineno"></span><span class="keyword" id="5613016">func</span>&nbsp;<span class="op" id="5613021">(</span><span class="ident" id="5613022">pb</span>&nbsp;<span class="op" id="5613025">*</span><span class="ident" id="5613026">PB</span><span class="op" id="5613028">)</span>&nbsp;<span class="ident" id="5613030">Next</span><span class="op" id="5613034">(</span><span class="op" id="5613035">)</span>&nbsp;<span class="builtintype" id="5613037">bool</span>&nbsp;<span class="op" id="5613042">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613045">if</span>&nbsp;<span class="ident" id="5613048">pb</span><span class="op" id="5613050">.</span><span class="ident" id="5613051">cache</span>&nbsp;<span class="op" id="5613057">==</span>&nbsp;<span class="num" id="5613060">0</span>&nbsp;<span class="op" id="5613062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613066">n</span>&nbsp;<span class="op" id="5613068">:=</span>&nbsp;<span class="ident" id="5613071">atomic</span><span class="op" id="5613077">.</span><span class="ident" id="5613078">AddUint64</span><span class="op" id="5613087">(</span><span class="ident" id="5613088">pb</span><span class="op" id="5613090">.</span><span class="ident" id="5613091">globalN</span><span class="op" id="5613098">,</span>&nbsp;<span class="ident" id="5613100">pb</span><span class="op" id="5613102">.</span><span class="ident" id="5613103">grain</span><span class="op" id="5613108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613112">if</span>&nbsp;<span class="ident" id="5613115">n</span>&nbsp;<span class="op" id="5613117">&lt;=</span>&nbsp;<span class="ident" id="5613120">pb</span><span class="op" id="5613122">.</span><span class="ident" id="5613123">bN</span>&nbsp;<span class="op" id="5613126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613131">pb</span><span class="op" id="5613133">.</span><span class="ident" id="5613134">cache</span>&nbsp;<span class="op" id="5613140">=</span>&nbsp;<span class="ident" id="5613142">pb</span><span class="op" id="5613144">.</span><span class="ident" id="5613145">grain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5613153">}</span>&nbsp;<span class="keyword" id="5613155">else</span>&nbsp;<span class="keyword" id="5613160">if</span>&nbsp;<span class="ident" id="5613163">n</span>&nbsp;<span class="op" id="5613165">&lt;</span>&nbsp;<span class="ident" id="5613167">pb</span><span class="op" id="5613169">.</span><span class="ident" id="5613170">bN</span><span class="op" id="5613172">+</span><span class="ident" id="5613173">pb</span><span class="op" id="5613175">.</span><span class="ident" id="5613176">grain</span>&nbsp;<span class="op" id="5613182">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613187">pb</span><span class="op" id="5613189">.</span><span class="ident" id="5613190">cache</span>&nbsp;<span class="op" id="5613196">=</span>&nbsp;<span class="ident" id="5613198">pb</span><span class="op" id="5613200">.</span><span class="ident" id="5613201">bN</span>&nbsp;<span class="op" id="5613204">+</span>&nbsp;<span class="ident" id="5613206">pb</span><span class="op" id="5613208">.</span><span class="ident" id="5613209">grain</span>&nbsp;<span class="op" id="5613215">-</span>&nbsp;<span class="ident" id="5613217">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5613221">}</span>&nbsp;<span class="keyword" id="5613223">else</span>&nbsp;<span class="op" id="5613228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613233">return</span>&nbsp;<span class="ident" id="5613240">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5613248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5613251">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5613254">pb</span><span class="op" id="5613256">.</span><span class="ident" id="5613257">cache</span><span class="op" id="5613262">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5613266">return</span>&nbsp;<span class="ident" id="5613273">true</span><br>
<span class="lineno"></span><span class="op" id="5613278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5613281">//&nbsp;RunParallel&nbsp;runs&nbsp;a&nbsp;benchmark&nbsp;in&nbsp;parallel.</span><br>
<span class="lineno">380</span><span class="comment" id="5613326">//&nbsp;It&nbsp;creates&nbsp;multiple&nbsp;goroutines&nbsp;and&nbsp;distributes&nbsp;b.N&nbsp;iterations&nbsp;among&nbsp;them.</span><br>
<span class="lineno"></span><span class="comment" id="5613403">//&nbsp;The&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;defaults&nbsp;to&nbsp;GOMAXPROCS.&nbsp;To&nbsp;increase&nbsp;parallelism&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5613483">//&nbsp;non-CPU-bound&nbsp;benchmarks,&nbsp;call&nbsp;SetParallelism&nbsp;before&nbsp;RunParallel.</span><br>
<span class="lineno"></span><span class="comment" id="5613552">//&nbsp;RunParallel&nbsp;is&nbsp;usually&nbsp;used&nbsp;with&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="5613611">//</span><br>
<span class="lineno">385</span><span class="comment" id="5613614">//&nbsp;The&nbsp;body&nbsp;function&nbsp;will&nbsp;be&nbsp;run&nbsp;in&nbsp;each&nbsp;goroutine.&nbsp;It&nbsp;should&nbsp;set&nbsp;up&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5613687">//&nbsp;goroutine-local&nbsp;state&nbsp;and&nbsp;then&nbsp;iterate&nbsp;until&nbsp;pb.Next&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5613758">//&nbsp;It&nbsp;should&nbsp;not&nbsp;use&nbsp;the&nbsp;StartTimer,&nbsp;StopTimer,&nbsp;or&nbsp;ResetTimer&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="5613831">//&nbsp;because&nbsp;they&nbsp;have&nbsp;global&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="5613867">func</span>&nbsp;<span class="op" id="5613872">(</span><span class="ident" id="5613873">b</span>&nbsp;<span class="op" id="5613875">*</span><span class="ident" id="5613876">B</span><span class="op" id="5613877">)</span>&nbsp;<span class="ident" id="5613879">RunParallel</span><span class="op" id="5613890">(</span><span class="ident" id="5613891">body</span>&nbsp;<span class="keyword" id="5613896">func</span><span class="op" id="5613900">(</span><span class="op" id="5613901">*</span><span class="ident" id="5613902">PB</span><span class="op" id="5613904">)</span><span class="op" id="5613905">)</span>&nbsp;<span class="op" id="5613907">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5613910">//&nbsp;Calculate&nbsp;grain&nbsp;size&nbsp;as&nbsp;number&nbsp;of&nbsp;iterations&nbsp;that&nbsp;take&nbsp;~100s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5613978">//&nbsp;100s&nbsp;is&nbsp;enough&nbsp;to&nbsp;amortize&nbsp;the&nbsp;overhead&nbsp;and&nbsp;provide&nbsp;sufficient</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5614047">//&nbsp;dynamic&nbsp;load&nbsp;balancing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614075">grain</span>&nbsp;<span class="op" id="5614081">:=</span>&nbsp;<span class="ident" id="5614084">uint64</span><span class="op" id="5614090">(</span><span class="num" id="5614091">0</span><span class="op" id="5614092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614095">if</span>&nbsp;<span class="ident" id="5614098">b</span><span class="op" id="5614099">.</span><span class="ident" id="5614100">previousN</span>&nbsp;<span class="op" id="5614110">&gt;</span>&nbsp;<span class="num" id="5614112">0</span>&nbsp;<span class="op" id="5614114">&amp;&amp;</span>&nbsp;<span class="ident" id="5614117">b</span><span class="op" id="5614118">.</span><span class="ident" id="5614119">previousDuration</span>&nbsp;<span class="op" id="5614136">&gt;</span>&nbsp;<span class="num" id="5614138">0</span>&nbsp;<span class="op" id="5614140">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614144">grain</span>&nbsp;<span class="op" id="5614150">=</span>&nbsp;<span class="num" id="5614152">1e5</span>&nbsp;<span class="op" id="5614156">*</span>&nbsp;<span class="ident" id="5614158">uint64</span><span class="op" id="5614164">(</span><span class="ident" id="5614165">b</span><span class="op" id="5614166">.</span><span class="ident" id="5614167">previousN</span><span class="op" id="5614176">)</span>&nbsp;<span class="op" id="5614178">/</span>&nbsp;<span class="ident" id="5614180">uint64</span><span class="op" id="5614186">(</span><span class="ident" id="5614187">b</span><span class="op" id="5614188">.</span><span class="ident" id="5614189">previousDuration</span><span class="op" id="5614205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5614208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614211">if</span>&nbsp;<span class="ident" id="5614214">grain</span>&nbsp;<span class="op" id="5614220">&lt;</span>&nbsp;<span class="num" id="5614222">1</span>&nbsp;<span class="op" id="5614224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614228">grain</span>&nbsp;<span class="op" id="5614234">=</span>&nbsp;<span class="num" id="5614236">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5614239">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5614242">//&nbsp;We&nbsp;expect&nbsp;the&nbsp;inner&nbsp;loop&nbsp;and&nbsp;function&nbsp;call&nbsp;to&nbsp;take&nbsp;at&nbsp;least&nbsp;10ns,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5614312">//&nbsp;so&nbsp;do&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;100s/10ns=1e4&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614367">if</span>&nbsp;<span class="ident" id="5614370">grain</span>&nbsp;<span class="op" id="5614376">&gt;</span>&nbsp;<span class="num" id="5614378">1e4</span>&nbsp;<span class="op" id="5614382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614386">grain</span>&nbsp;<span class="op" id="5614392">=</span>&nbsp;<span class="num" id="5614394">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5614399">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614403">n</span>&nbsp;<span class="op" id="5614405">:=</span>&nbsp;<span class="ident" id="5614408">uint64</span><span class="op" id="5614414">(</span><span class="num" id="5614415">0</span><span class="op" id="5614416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614419">numProcs</span>&nbsp;<span class="op" id="5614428">:=</span>&nbsp;<span class="ident" id="5614431">b</span><span class="op" id="5614432">.</span><span class="ident" id="5614433">parallelism</span>&nbsp;<span class="op" id="5614445">*</span>&nbsp;<span class="ident" id="5614447">runtime</span><span class="op" id="5614454">.</span><span class="ident" id="5614455">GOMAXPROCS</span><span class="op" id="5614465">(</span><span class="num" id="5614466">0</span><span class="op" id="5614467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614470">var</span>&nbsp;<span class="ident" id="5614474">wg</span>&nbsp;<span class="ident" id="5614477">sync</span><span class="op" id="5614481">.</span><span class="ident" id="5614482">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614493">wg</span><span class="op" id="5614495">.</span><span class="ident" id="5614496">Add</span><span class="op" id="5614499">(</span><span class="ident" id="5614500">numProcs</span><span class="op" id="5614508">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614511">for</span>&nbsp;<span class="ident" id="5614515">p</span>&nbsp;<span class="op" id="5614517">:=</span>&nbsp;<span class="num" id="5614520">0</span><span class="op" id="5614521">;</span>&nbsp;<span class="ident" id="5614523">p</span>&nbsp;<span class="op" id="5614525">&lt;</span>&nbsp;<span class="ident" id="5614527">numProcs</span><span class="op" id="5614535">;</span>&nbsp;<span class="ident" id="5614537">p</span><span class="op" id="5614538">++</span>&nbsp;<span class="op" id="5614541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614545">go</span>&nbsp;<span class="keyword" id="5614548">func</span><span class="op" id="5614552">(</span><span class="op" id="5614553">)</span>&nbsp;<span class="op" id="5614555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614560">defer</span>&nbsp;<span class="ident" id="5614566">wg</span><span class="op" id="5614568">.</span><span class="ident" id="5614569">Done</span><span class="op" id="5614573">(</span><span class="op" id="5614574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614579">pb</span>&nbsp;<span class="op" id="5614582">:=</span>&nbsp;<span class="op" id="5614585">&amp;</span><span class="ident" id="5614586">PB</span><span class="op" id="5614588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614594">globalN</span><span class="op" id="5614601">:</span>&nbsp;<span class="op" id="5614603">&amp;</span><span class="ident" id="5614604">n</span><span class="op" id="5614605">,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614611">grain</span><span class="op" id="5614616">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5614620">grain</span><span class="op" id="5614625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614631">bN</span><span class="op" id="5614633">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5614640">uint64</span><span class="op" id="5614646">(</span><span class="ident" id="5614647">b</span><span class="op" id="5614648">.</span><span class="ident" id="5614649">N</span><span class="op" id="5614650">)</span><span class="op" id="5614651">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5614656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614661">body</span><span class="op" id="5614665">(</span><span class="ident" id="5614666">pb</span><span class="op" id="5614668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5614672">}</span><span class="op" id="5614673">(</span><span class="op" id="5614674">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5614677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614680">wg</span><span class="op" id="5614682">.</span><span class="ident" id="5614683">Wait</span><span class="op" id="5614687">(</span><span class="op" id="5614688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5614691">if</span>&nbsp;<span class="ident" id="5614694">n</span>&nbsp;<span class="op" id="5614696">&lt;=</span>&nbsp;<span class="ident" id="5614699">uint64</span><span class="op" id="5614705">(</span><span class="ident" id="5614706">b</span><span class="op" id="5614707">.</span><span class="ident" id="5614708">N</span><span class="op" id="5614709">)</span>&nbsp;<span class="op" id="5614711">&amp;&amp;</span>&nbsp;<span class="op" id="5614714">!</span><span class="ident" id="5614715">b</span><span class="op" id="5614716">.</span><span class="ident" id="5614717">Failed</span><span class="op" id="5614723">(</span><span class="op" id="5614724">)</span>&nbsp;<span class="op" id="5614726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5614730">b</span><span class="op" id="5614731">.</span><span class="ident" id="5614732">Fatal</span><span class="op" id="5614737">(</span><span class="string" id="5614738">&#34;RunParallel:&nbsp;body&nbsp;exited&nbsp;without&nbsp;pb.Next()&nbsp;==&nbsp;false&#34;</span><span class="op" id="5614791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5614794">}</span><br>
<span class="lineno">425</span><span class="op" id="5614796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5614799">//&nbsp;SetParallelism&nbsp;sets&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;to&nbsp;p*GOMAXPROCS.</span><br>
<span class="lineno"></span><span class="comment" id="5614884">//&nbsp;There&nbsp;is&nbsp;usually&nbsp;no&nbsp;need&nbsp;to&nbsp;call&nbsp;SetParallelism&nbsp;for&nbsp;CPU-bound&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="comment" id="5614961">//&nbsp;If&nbsp;p&nbsp;is&nbsp;less&nbsp;than&nbsp;1,&nbsp;this&nbsp;call&nbsp;will&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">430</span><span class="keyword" id="5615016">func</span>&nbsp;<span class="op" id="5615021">(</span><span class="ident" id="5615022">b</span>&nbsp;<span class="op" id="5615024">*</span><span class="ident" id="5615025">B</span><span class="op" id="5615026">)</span>&nbsp;<span class="ident" id="5615028">SetParallelism</span><span class="op" id="5615042">(</span><span class="ident" id="5615043">p</span>&nbsp;<span class="builtintype" id="5615045">int</span><span class="op" id="5615048">)</span>&nbsp;<span class="op" id="5615050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5615053">if</span>&nbsp;<span class="ident" id="5615056">p</span>&nbsp;<span class="op" id="5615058">&gt;=</span>&nbsp;<span class="num" id="5615061">1</span>&nbsp;<span class="op" id="5615063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5615067">b</span><span class="op" id="5615068">.</span><span class="ident" id="5615069">parallelism</span>&nbsp;<span class="op" id="5615081">=</span>&nbsp;<span class="ident" id="5615083">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5615086">}</span><br>
<span class="lineno"></span><span class="op" id="5615088">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="5615091">//&nbsp;Benchmark&nbsp;benchmarks&nbsp;a&nbsp;single&nbsp;function.&nbsp;Useful&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span><span class="comment" id="5615154">//&nbsp;custom&nbsp;benchmarks&nbsp;that&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5615214">func</span>&nbsp;<span class="ident" id="5615219">Benchmark</span><span class="op" id="5615228">(</span><span class="ident" id="5615229">f</span>&nbsp;<span class="keyword" id="5615231">func</span><span class="op" id="5615235">(</span><span class="ident" id="5615236">b</span>&nbsp;<span class="op" id="5615238">*</span><span class="ident" id="5615239">B</span><span class="op" id="5615240">)</span><span class="op" id="5615241">)</span>&nbsp;<span class="ident" id="5615243">BenchmarkResult</span>&nbsp;<span class="op" id="5615259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5615262">b</span>&nbsp;<span class="op" id="5615264">:=</span>&nbsp;<span class="op" id="5615267">&amp;</span><span class="ident" id="5615268">B</span><span class="op" id="5615269">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5615273">common</span><span class="op" id="5615279">:</span>&nbsp;<span class="ident" id="5615281">common</span><span class="op" id="5615287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5615292">signal</span><span class="op" id="5615298">:</span>&nbsp;<span class="builtinfunc" id="5615300">make</span><span class="op" id="5615304">(</span><span class="keyword" id="5615305">chan</span>&nbsp;<span class="keyword" id="5615310">interface</span><span class="op" id="5615319">{</span><span class="op" id="5615320">}</span><span class="op" id="5615321">)</span><span class="op" id="5615322">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5615326">}</span><span class="op" id="5615327">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5615331">benchmark</span><span class="op" id="5615340">:</span>&nbsp;<span class="ident" id="5615342">InternalBenchmark</span><span class="op" id="5615359">{</span><span class="string" id="5615360">&#34;&#34;</span><span class="op" id="5615362">,</span>&nbsp;<span class="ident" id="5615364">f</span><span class="op" id="5615365">}</span><span class="op" id="5615366">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5615369">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5615372">return</span>&nbsp;<span class="ident" id="5615379">b</span><span class="op" id="5615380">.</span><span class="ident" id="5615381">run</span><span class="op" id="5615384">(</span><span class="op" id="5615385">)</span><br>
<span class="lineno"></span><span class="op" id="5615387">}</span>
</div>
</body>
</html>
