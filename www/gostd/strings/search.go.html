<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html" class="current">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2302310">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2302365">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2302419">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2302470">package</span>&nbsp;<span class="ident" id="2302478">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2302487">//&nbsp;stringFinder&nbsp;efficiently&nbsp;finds&nbsp;strings&nbsp;in&nbsp;a&nbsp;source&nbsp;text.&nbsp;It&#39;s&nbsp;implemented</span><br>
<span class="lineno"></span><span class="comment" id="2302564">//&nbsp;using&nbsp;the&nbsp;Boyer-Moore&nbsp;string&nbsp;search&nbsp;algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2302614">//&nbsp;http://en.wikipedia.org/wiki/Boyer-Moore_string_search_algorithm</span><br>
<span class="lineno">10</span><span class="comment" id="2302682">//&nbsp;http://www.cs.utexas.edu/~moore/publications/fstrpos.pdf&nbsp;(note:&nbsp;this&nbsp;aged</span><br>
<span class="lineno"></span><span class="comment" id="2302759">//&nbsp;document&nbsp;uses&nbsp;1-based&nbsp;indexing)</span><br>
<span class="lineno"></span><span class="keyword" id="2302794">type</span>&nbsp;<span class="ident" id="2302799">stringFinder</span>&nbsp;<span class="keyword" id="2302812">struct</span>&nbsp;<span class="op" id="2302819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2302822">//&nbsp;pattern&nbsp;is&nbsp;the&nbsp;string&nbsp;that&nbsp;we&nbsp;are&nbsp;searching&nbsp;for&nbsp;in&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2302887">pattern</span>&nbsp;<span class="builtintype" id="2302895">string</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2302904">//&nbsp;badCharSkip[b]&nbsp;contains&nbsp;the&nbsp;distance&nbsp;between&nbsp;the&nbsp;last&nbsp;byte&nbsp;of&nbsp;pattern</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2302978">//&nbsp;and&nbsp;the&nbsp;rightmost&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;pattern.&nbsp;If&nbsp;b&nbsp;is&nbsp;not&nbsp;in&nbsp;pattern,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303052">//&nbsp;badCharSkip[b]&nbsp;is&nbsp;len(pattern).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303088">//</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303092">//&nbsp;Whenever&nbsp;a&nbsp;mismatch&nbsp;is&nbsp;found&nbsp;with&nbsp;byte&nbsp;b&nbsp;in&nbsp;the&nbsp;text,&nbsp;we&nbsp;can&nbsp;safely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303164">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;at&nbsp;least&nbsp;badCharSkip[b]&nbsp;until&nbsp;the&nbsp;next&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303237">//&nbsp;the&nbsp;matching&nbsp;char&nbsp;could&nbsp;be&nbsp;in&nbsp;alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2303282">badCharSkip</span>&nbsp;<span class="op" id="2303294">[</span><span class="num" id="2303295">256</span><span class="op" id="2303298">]</span><span class="builtintype" id="2303299">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303305">//&nbsp;goodSuffixSkip[i]&nbsp;defines&nbsp;how&nbsp;far&nbsp;we&nbsp;can&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303381">//&nbsp;that&nbsp;the&nbsp;suffix&nbsp;pattern[i+1:]&nbsp;matches,&nbsp;but&nbsp;the&nbsp;byte&nbsp;pattern[i]&nbsp;does</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303453">//&nbsp;not.&nbsp;There&nbsp;are&nbsp;two&nbsp;cases&nbsp;to&nbsp;consider:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303495">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303499">//&nbsp;1.&nbsp;The&nbsp;matched&nbsp;suffix&nbsp;occurs&nbsp;elsewhere&nbsp;in&nbsp;pattern&nbsp;(with&nbsp;a&nbsp;different</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303571">//&nbsp;byte&nbsp;preceding&nbsp;it&nbsp;that&nbsp;we&nbsp;might&nbsp;possibly&nbsp;match).&nbsp;In&nbsp;this&nbsp;case,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303645">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;to&nbsp;align&nbsp;with&nbsp;the&nbsp;next&nbsp;suffix&nbsp;chunk.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303715">//&nbsp;example,&nbsp;the&nbsp;pattern&nbsp;&#34;mississi&#34;&nbsp;has&nbsp;the&nbsp;suffix&nbsp;&#34;issi&#34;&nbsp;next&nbsp;occurring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303788">//&nbsp;(in&nbsp;right-to-left&nbsp;order)&nbsp;at&nbsp;index&nbsp;1,&nbsp;so&nbsp;goodSuffixSkip[3]&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303853">//&nbsp;shift+len(suffix)&nbsp;==&nbsp;3+4&nbsp;==&nbsp;7.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303888">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303892">//&nbsp;2.&nbsp;If&nbsp;the&nbsp;matched&nbsp;suffix&nbsp;does&nbsp;not&nbsp;occur&nbsp;elsewhere&nbsp;in&nbsp;pattern,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2303967">//&nbsp;matching&nbsp;frame&nbsp;may&nbsp;share&nbsp;part&nbsp;of&nbsp;its&nbsp;prefix&nbsp;with&nbsp;the&nbsp;end&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2304035">//&nbsp;matching&nbsp;suffix.&nbsp;In&nbsp;this&nbsp;case,&nbsp;goodSuffixSkip[i]&nbsp;will&nbsp;contain&nbsp;how&nbsp;far</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2304109">//&nbsp;to&nbsp;shift&nbsp;the&nbsp;frame&nbsp;to&nbsp;align&nbsp;this&nbsp;portion&nbsp;of&nbsp;the&nbsp;prefix&nbsp;to&nbsp;the</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2304175">//&nbsp;suffix.&nbsp;For&nbsp;example,&nbsp;in&nbsp;the&nbsp;pattern&nbsp;&#34;abcxxxabc&#34;,&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2304243">//&nbsp;mismatch&nbsp;from&nbsp;the&nbsp;back&nbsp;is&nbsp;found&nbsp;to&nbsp;be&nbsp;in&nbsp;position&nbsp;3,&nbsp;the&nbsp;matching</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2304313">//&nbsp;suffix&nbsp;&#34;xxabc&#34;&nbsp;is&nbsp;not&nbsp;found&nbsp;elsewhere&nbsp;in&nbsp;the&nbsp;pattern.&nbsp;However,&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2304384">//&nbsp;rightmost&nbsp;&#34;abc&#34;&nbsp;(at&nbsp;position&nbsp;6)&nbsp;is&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;whole&nbsp;pattern,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2304457">//&nbsp;goodSuffixSkip[3]&nbsp;==&nbsp;shift+len(suffix)&nbsp;==&nbsp;6+5&nbsp;==&nbsp;11.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2304514">goodSuffixSkip</span>&nbsp;<span class="op" id="2304529">[</span><span class="op" id="2304530">]</span><span class="builtintype" id="2304531">int</span><br>
<span class="lineno"></span><span class="op" id="2304535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2304538">func</span>&nbsp;<span class="ident" id="2304543">makeStringFinder</span><span class="op" id="2304559">(</span><span class="ident" id="2304560">pattern</span>&nbsp;<span class="builtintype" id="2304568">string</span><span class="op" id="2304574">)</span>&nbsp;<span class="op" id="2304576">*</span><span class="ident" id="2304577">stringFinder</span>&nbsp;<span class="op" id="2304590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2304593">f</span>&nbsp;<span class="op" id="2304595">:=</span>&nbsp;<span class="op" id="2304598">&amp;</span><span class="ident" id="2304599">stringFinder</span><span class="op" id="2304611">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2304615">pattern</span><span class="op" id="2304622">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2304631">pattern</span><span class="op" id="2304638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2304642">goodSuffixSkip</span><span class="op" id="2304656">:</span>&nbsp;<span class="builtinfunc" id="2304658">make</span><span class="op" id="2304662">(</span><span class="op" id="2304663">[</span><span class="op" id="2304664">]</span><span class="builtintype" id="2304665">int</span><span class="op" id="2304668">,</span>&nbsp;<span class="builtinfunc" id="2304670">len</span><span class="op" id="2304673">(</span><span class="ident" id="2304674">pattern</span><span class="op" id="2304681">)</span><span class="op" id="2304682">)</span><span class="op" id="2304683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2304686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2304689">//&nbsp;last&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;character&nbsp;in&nbsp;the&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2304749">last</span>&nbsp;<span class="op" id="2304754">:=</span>&nbsp;<span class="builtinfunc" id="2304757">len</span><span class="op" id="2304760">(</span><span class="ident" id="2304761">pattern</span><span class="op" id="2304768">)</span>&nbsp;<span class="op" id="2304770">-</span>&nbsp;<span class="num" id="2304772">1</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2304776">//&nbsp;Build&nbsp;bad&nbsp;character&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2304807">//&nbsp;Bytes&nbsp;not&nbsp;in&nbsp;the&nbsp;pattern&nbsp;can&nbsp;skip&nbsp;one&nbsp;pattern&#39;s&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2304867">for</span>&nbsp;<span class="ident" id="2304871">i</span>&nbsp;<span class="op" id="2304873">:=</span>&nbsp;<span class="keyword" id="2304876">range</span>&nbsp;<span class="ident" id="2304882">f</span><span class="op" id="2304883">.</span><span class="ident" id="2304884">badCharSkip</span>&nbsp;<span class="op" id="2304896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2304900">f</span><span class="op" id="2304901">.</span><span class="ident" id="2304902">badCharSkip</span><span class="op" id="2304913">[</span><span class="ident" id="2304914">i</span><span class="op" id="2304915">]</span>&nbsp;<span class="op" id="2304917">=</span>&nbsp;<span class="builtinfunc" id="2304919">len</span><span class="op" id="2304922">(</span><span class="ident" id="2304923">pattern</span><span class="op" id="2304930">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2304933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2304936">//&nbsp;The&nbsp;loop&nbsp;condition&nbsp;is&nbsp;&lt;&nbsp;instead&nbsp;of&nbsp;&lt;=&nbsp;so&nbsp;that&nbsp;the&nbsp;last&nbsp;byte&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2305009">//&nbsp;have&nbsp;a&nbsp;zero&nbsp;distance&nbsp;to&nbsp;itself.&nbsp;Finding&nbsp;this&nbsp;byte&nbsp;out&nbsp;of&nbsp;place&nbsp;implies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2305084">//&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;last&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2305125">for</span>&nbsp;<span class="ident" id="2305129">i</span>&nbsp;<span class="op" id="2305131">:=</span>&nbsp;<span class="num" id="2305134">0</span><span class="op" id="2305135">;</span>&nbsp;<span class="ident" id="2305137">i</span>&nbsp;<span class="op" id="2305139">&lt;</span>&nbsp;<span class="ident" id="2305141">last</span><span class="op" id="2305145">;</span>&nbsp;<span class="ident" id="2305147">i</span><span class="op" id="2305148">++</span>&nbsp;<span class="op" id="2305151">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2305155">f</span><span class="op" id="2305156">.</span><span class="ident" id="2305157">badCharSkip</span><span class="op" id="2305168">[</span><span class="ident" id="2305169">pattern</span><span class="op" id="2305176">[</span><span class="ident" id="2305177">i</span><span class="op" id="2305178">]</span><span class="op" id="2305179">]</span>&nbsp;<span class="op" id="2305181">=</span>&nbsp;<span class="ident" id="2305183">last</span>&nbsp;<span class="op" id="2305188">-</span>&nbsp;<span class="ident" id="2305190">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2305193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2305197">//&nbsp;Build&nbsp;good&nbsp;suffix&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2305226">//&nbsp;First&nbsp;pass:&nbsp;set&nbsp;each&nbsp;value&nbsp;to&nbsp;the&nbsp;next&nbsp;index&nbsp;which&nbsp;starts&nbsp;a&nbsp;prefix&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2305300">//&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2305313">lastPrefix</span>&nbsp;<span class="op" id="2305324">:=</span>&nbsp;<span class="ident" id="2305327">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2305333">for</span>&nbsp;<span class="ident" id="2305337">i</span>&nbsp;<span class="op" id="2305339">:=</span>&nbsp;<span class="ident" id="2305342">last</span><span class="op" id="2305346">;</span>&nbsp;<span class="ident" id="2305348">i</span>&nbsp;<span class="op" id="2305350">&gt;=</span>&nbsp;<span class="num" id="2305353">0</span><span class="op" id="2305354">;</span>&nbsp;<span class="ident" id="2305356">i</span><span class="op" id="2305357">--</span>&nbsp;<span class="op" id="2305360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2305364">if</span>&nbsp;<span class="ident" id="2305367">HasPrefix</span><span class="op" id="2305376">(</span><span class="ident" id="2305377">pattern</span><span class="op" id="2305384">,</span>&nbsp;<span class="ident" id="2305386">pattern</span><span class="op" id="2305393">[</span><span class="ident" id="2305394">i</span><span class="op" id="2305395">+</span><span class="num" id="2305396">1</span><span class="op" id="2305397">:</span><span class="op" id="2305398">]</span><span class="op" id="2305399">)</span>&nbsp;<span class="op" id="2305401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2305406">lastPrefix</span>&nbsp;<span class="op" id="2305417">=</span>&nbsp;<span class="ident" id="2305419">i</span>&nbsp;<span class="op" id="2305421">+</span>&nbsp;<span class="num" id="2305423">1</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2305427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2305431">//&nbsp;lastPrefix&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;(last-i)&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2305490">f</span><span class="op" id="2305491">.</span><span class="ident" id="2305492">goodSuffixSkip</span><span class="op" id="2305506">[</span><span class="ident" id="2305507">i</span><span class="op" id="2305508">]</span>&nbsp;<span class="op" id="2305510">=</span>&nbsp;<span class="ident" id="2305512">lastPrefix</span>&nbsp;<span class="op" id="2305523">+</span>&nbsp;<span class="ident" id="2305525">last</span>&nbsp;<span class="op" id="2305530">-</span>&nbsp;<span class="ident" id="2305532">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2305535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2305538">//&nbsp;Second&nbsp;pass:&nbsp;find&nbsp;repeats&nbsp;of&nbsp;pattern&#39;s&nbsp;suffix&nbsp;starting&nbsp;from&nbsp;the&nbsp;front.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2305613">for</span>&nbsp;<span class="ident" id="2305617">i</span>&nbsp;<span class="op" id="2305619">:=</span>&nbsp;<span class="num" id="2305622">0</span><span class="op" id="2305623">;</span>&nbsp;<span class="ident" id="2305625">i</span>&nbsp;<span class="op" id="2305627">&lt;</span>&nbsp;<span class="ident" id="2305629">last</span><span class="op" id="2305633">;</span>&nbsp;<span class="ident" id="2305635">i</span><span class="op" id="2305636">++</span>&nbsp;<span class="op" id="2305639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2305643">lenSuffix</span>&nbsp;<span class="op" id="2305653">:=</span>&nbsp;<span class="ident" id="2305656">longestCommonSuffix</span><span class="op" id="2305675">(</span><span class="ident" id="2305676">pattern</span><span class="op" id="2305683">,</span>&nbsp;<span class="ident" id="2305685">pattern</span><span class="op" id="2305692">[</span><span class="num" id="2305693">1</span><span class="op" id="2305694">:</span><span class="ident" id="2305695">i</span><span class="op" id="2305696">+</span><span class="num" id="2305697">1</span><span class="op" id="2305698">]</span><span class="op" id="2305699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2305703">if</span>&nbsp;<span class="ident" id="2305706">pattern</span><span class="op" id="2305713">[</span><span class="ident" id="2305714">i</span><span class="op" id="2305715">-</span><span class="ident" id="2305716">lenSuffix</span><span class="op" id="2305725">]</span>&nbsp;<span class="op" id="2305727">!=</span>&nbsp;<span class="ident" id="2305730">pattern</span><span class="op" id="2305737">[</span><span class="ident" id="2305738">last</span><span class="op" id="2305742">-</span><span class="ident" id="2305743">lenSuffix</span><span class="op" id="2305752">]</span>&nbsp;<span class="op" id="2305754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2305759">//&nbsp;(last-i)&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;lenSuffix&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2305818">f</span><span class="op" id="2305819">.</span><span class="ident" id="2305820">goodSuffixSkip</span><span class="op" id="2305834">[</span><span class="ident" id="2305835">last</span><span class="op" id="2305839">-</span><span class="ident" id="2305840">lenSuffix</span><span class="op" id="2305849">]</span>&nbsp;<span class="op" id="2305851">=</span>&nbsp;<span class="ident" id="2305853">lenSuffix</span>&nbsp;<span class="op" id="2305863">+</span>&nbsp;<span class="ident" id="2305865">last</span>&nbsp;<span class="op" id="2305870">-</span>&nbsp;<span class="ident" id="2305872">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2305876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2305879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2305883">return</span>&nbsp;<span class="ident" id="2305890">f</span><br>
<span class="lineno"></span><span class="op" id="2305892">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="2305895">func</span>&nbsp;<span class="ident" id="2305900">longestCommonSuffix</span><span class="op" id="2305919">(</span><span class="ident" id="2305920">a</span><span class="op" id="2305921">,</span>&nbsp;<span class="ident" id="2305923">b</span>&nbsp;<span class="builtintype" id="2305925">string</span><span class="op" id="2305931">)</span>&nbsp;<span class="op" id="2305933">(</span><span class="ident" id="2305934">i</span>&nbsp;<span class="builtintype" id="2305936">int</span><span class="op" id="2305939">)</span>&nbsp;<span class="op" id="2305941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2305944">for</span>&nbsp;<span class="op" id="2305948">;</span>&nbsp;<span class="ident" id="2305950">i</span>&nbsp;<span class="op" id="2305952">&lt;</span>&nbsp;<span class="builtinfunc" id="2305954">len</span><span class="op" id="2305957">(</span><span class="ident" id="2305958">a</span><span class="op" id="2305959">)</span>&nbsp;<span class="op" id="2305961">&amp;&amp;</span>&nbsp;<span class="ident" id="2305964">i</span>&nbsp;<span class="op" id="2305966">&lt;</span>&nbsp;<span class="builtinfunc" id="2305968">len</span><span class="op" id="2305971">(</span><span class="ident" id="2305972">b</span><span class="op" id="2305973">)</span><span class="op" id="2305974">;</span>&nbsp;<span class="ident" id="2305976">i</span><span class="op" id="2305977">++</span>&nbsp;<span class="op" id="2305980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2305984">if</span>&nbsp;<span class="ident" id="2305987">a</span><span class="op" id="2305988">[</span><span class="builtinfunc" id="2305989">len</span><span class="op" id="2305992">(</span><span class="ident" id="2305993">a</span><span class="op" id="2305994">)</span><span class="op" id="2305995">-</span><span class="num" id="2305996">1</span><span class="op" id="2305997">-</span><span class="ident" id="2305998">i</span><span class="op" id="2305999">]</span>&nbsp;<span class="op" id="2306001">!=</span>&nbsp;<span class="ident" id="2306004">b</span><span class="op" id="2306005">[</span><span class="builtinfunc" id="2306006">len</span><span class="op" id="2306009">(</span><span class="ident" id="2306010">b</span><span class="op" id="2306011">)</span><span class="op" id="2306012">-</span><span class="num" id="2306013">1</span><span class="op" id="2306014">-</span><span class="ident" id="2306015">i</span><span class="op" id="2306016">]</span>&nbsp;<span class="op" id="2306018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2306023">break</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2306031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2306034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2306037">return</span><br>
<span class="lineno"></span><span class="op" id="2306044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2306047">//&nbsp;next&nbsp;returns&nbsp;the&nbsp;index&nbsp;in&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;the&nbsp;pattern.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="2306124">//&nbsp;the&nbsp;pattern&nbsp;is&nbsp;not&nbsp;found,&nbsp;it&nbsp;returns&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2306168">func</span>&nbsp;<span class="op" id="2306173">(</span><span class="ident" id="2306174">f</span>&nbsp;<span class="op" id="2306176">*</span><span class="ident" id="2306177">stringFinder</span><span class="op" id="2306189">)</span>&nbsp;<span class="ident" id="2306191">next</span><span class="op" id="2306195">(</span><span class="ident" id="2306196">text</span>&nbsp;<span class="builtintype" id="2306201">string</span><span class="op" id="2306207">)</span>&nbsp;<span class="builtintype" id="2306209">int</span>&nbsp;<span class="op" id="2306213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2306216">i</span>&nbsp;<span class="op" id="2306218">:=</span>&nbsp;<span class="builtinfunc" id="2306221">len</span><span class="op" id="2306224">(</span><span class="ident" id="2306225">f</span><span class="op" id="2306226">.</span><span class="ident" id="2306227">pattern</span><span class="op" id="2306234">)</span>&nbsp;<span class="op" id="2306236">-</span>&nbsp;<span class="num" id="2306238">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2306241">for</span>&nbsp;<span class="ident" id="2306245">i</span>&nbsp;<span class="op" id="2306247">&lt;</span>&nbsp;<span class="builtinfunc" id="2306249">len</span><span class="op" id="2306252">(</span><span class="ident" id="2306253">text</span><span class="op" id="2306257">)</span>&nbsp;<span class="op" id="2306259">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2306263">//&nbsp;Compare&nbsp;backwards&nbsp;from&nbsp;the&nbsp;end&nbsp;until&nbsp;the&nbsp;first&nbsp;unmatching&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2306337">j</span>&nbsp;<span class="op" id="2306339">:=</span>&nbsp;<span class="builtinfunc" id="2306342">len</span><span class="op" id="2306345">(</span><span class="ident" id="2306346">f</span><span class="op" id="2306347">.</span><span class="ident" id="2306348">pattern</span><span class="op" id="2306355">)</span>&nbsp;<span class="op" id="2306357">-</span>&nbsp;<span class="num" id="2306359">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2306363">for</span>&nbsp;<span class="ident" id="2306367">j</span>&nbsp;<span class="op" id="2306369">&gt;=</span>&nbsp;<span class="num" id="2306372">0</span>&nbsp;<span class="op" id="2306374">&amp;&amp;</span>&nbsp;<span class="ident" id="2306377">text</span><span class="op" id="2306381">[</span><span class="ident" id="2306382">i</span><span class="op" id="2306383">]</span>&nbsp;<span class="op" id="2306385">==</span>&nbsp;<span class="ident" id="2306388">f</span><span class="op" id="2306389">.</span><span class="ident" id="2306390">pattern</span><span class="op" id="2306397">[</span><span class="ident" id="2306398">j</span><span class="op" id="2306399">]</span>&nbsp;<span class="op" id="2306401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2306406">i</span><span class="op" id="2306407">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2306413">j</span><span class="op" id="2306414">--</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2306419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2306423">if</span>&nbsp;<span class="ident" id="2306426">j</span>&nbsp;<span class="op" id="2306428">&lt;</span>&nbsp;<span class="num" id="2306430">0</span>&nbsp;<span class="op" id="2306432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2306437">return</span>&nbsp;<span class="ident" id="2306444">i</span>&nbsp;<span class="op" id="2306446">+</span>&nbsp;<span class="num" id="2306448">1</span>&nbsp;<span class="comment" id="2306450">//&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2306461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2306465">i</span>&nbsp;<span class="op" id="2306467">+=</span>&nbsp;<span class="ident" id="2306470">max</span><span class="op" id="2306473">(</span><span class="ident" id="2306474">f</span><span class="op" id="2306475">.</span><span class="ident" id="2306476">badCharSkip</span><span class="op" id="2306487">[</span><span class="ident" id="2306488">text</span><span class="op" id="2306492">[</span><span class="ident" id="2306493">i</span><span class="op" id="2306494">]</span><span class="op" id="2306495">]</span><span class="op" id="2306496">,</span>&nbsp;<span class="ident" id="2306498">f</span><span class="op" id="2306499">.</span><span class="ident" id="2306500">goodSuffixSkip</span><span class="op" id="2306514">[</span><span class="ident" id="2306515">j</span><span class="op" id="2306516">]</span><span class="op" id="2306517">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2306520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2306523">return</span>&nbsp;<span class="op" id="2306530">-</span><span class="num" id="2306531">1</span><br>
<span class="lineno"></span><span class="op" id="2306533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2306536">func</span>&nbsp;<span class="ident" id="2306541">max</span><span class="op" id="2306544">(</span><span class="ident" id="2306545">a</span><span class="op" id="2306546">,</span>&nbsp;<span class="ident" id="2306548">b</span>&nbsp;<span class="builtintype" id="2306550">int</span><span class="op" id="2306553">)</span>&nbsp;<span class="builtintype" id="2306555">int</span>&nbsp;<span class="op" id="2306559">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2306562">if</span>&nbsp;<span class="ident" id="2306565">a</span>&nbsp;<span class="op" id="2306567">&gt;</span>&nbsp;<span class="ident" id="2306569">b</span>&nbsp;<span class="op" id="2306571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2306575">return</span>&nbsp;<span class="ident" id="2306582">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2306585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2306588">return</span>&nbsp;<span class="ident" id="2306595">b</span><br>
<span class="lineno"></span><span class="op" id="2306597">}</span>
</div>
</body>
</html>
