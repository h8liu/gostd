<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp</h2>
<ul>
<li><a href="/gostd/regexp/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/regexp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/regexp/exec.go.html" class="current">exec.go</a></li>
<li><a href="/gostd/regexp/exec2_test.go.html">exec2_test.go</a></li>
<li><a href="/gostd/regexp/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/regexp/find_test.go.html">find_test.go</a></li>
<li><a href="/gostd/regexp/onepass.go.html">onepass.go</a></li>
<li><a href="/gostd/regexp/onepass_test.go.html">onepass_test.go</a></li>
<li><a href="/gostd/regexp/regexp.go.html">regexp.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5266044">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5266099">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5266153">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5266204">package</span>&nbsp;<span class="ident" id="5266212">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5266220">import</span>&nbsp;<span class="op" id="5266227">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5266230">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5266236">&#34;regexp/syntax&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5266252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5266255">//&nbsp;A&nbsp;queue&nbsp;is&nbsp;a&nbsp;&#39;sparse&nbsp;array&#39;&nbsp;holding&nbsp;pending&nbsp;threads&nbsp;of&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="5266324">//&nbsp;See&nbsp;http://research.swtch.com/2008/03/using-uninitialized-memory-for-fun-and.html</span><br>
<span class="lineno"></span><span class="keyword" id="5266409">type</span>&nbsp;<span class="ident" id="5266414">queue</span>&nbsp;<span class="keyword" id="5266420">struct</span>&nbsp;<span class="op" id="5266427">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5266430">sparse</span>&nbsp;<span class="op" id="5266437">[</span><span class="op" id="5266438">]</span><span class="builtintype" id="5266439">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5266447">dense</span>&nbsp;&nbsp;<span class="op" id="5266454">[</span><span class="op" id="5266455">]</span><span class="ident" id="5266456">entry</span><br>
<span class="lineno"></span><span class="op" id="5266462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5266465">//&nbsp;A&nbsp;entry&nbsp;is&nbsp;an&nbsp;entry&nbsp;on&nbsp;a&nbsp;queue.</span><br>
<span class="lineno">20</span><span class="comment" id="5266500">//&nbsp;It&nbsp;holds&nbsp;both&nbsp;the&nbsp;instruction&nbsp;pc&nbsp;and&nbsp;the&nbsp;actual&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="5266559">//&nbsp;Some&nbsp;queue&nbsp;entries&nbsp;are&nbsp;just&nbsp;place&nbsp;holders&nbsp;so&nbsp;that&nbsp;the&nbsp;machine</span><br>
<span class="lineno"></span><span class="comment" id="5266624">//&nbsp;knows&nbsp;it&nbsp;has&nbsp;considered&nbsp;that&nbsp;pc.&nbsp;&nbsp;Such&nbsp;entries&nbsp;have&nbsp;t&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5266689">type</span>&nbsp;<span class="ident" id="5266694">entry</span>&nbsp;<span class="keyword" id="5266700">struct</span>&nbsp;<span class="op" id="5266707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5266710">pc</span>&nbsp;<span class="builtintype" id="5266713">uint32</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5266721">t</span>&nbsp;&nbsp;<span class="op" id="5266724">*</span><span class="ident" id="5266725">thread</span><br>
<span class="lineno"></span><span class="op" id="5266732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5266735">//&nbsp;A&nbsp;thread&nbsp;is&nbsp;the&nbsp;state&nbsp;of&nbsp;a&nbsp;single&nbsp;path&nbsp;through&nbsp;the&nbsp;machine:</span><br>
<span class="lineno"></span><span class="comment" id="5266798">//&nbsp;an&nbsp;instruction&nbsp;and&nbsp;a&nbsp;corresponding&nbsp;capture&nbsp;array.</span><br>
<span class="lineno">30</span><span class="comment" id="5266851">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html</span><br>
<span class="lineno"></span><span class="keyword" id="5266900">type</span>&nbsp;<span class="ident" id="5266905">thread</span>&nbsp;<span class="keyword" id="5266912">struct</span>&nbsp;<span class="op" id="5266919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5266922">inst</span>&nbsp;<span class="op" id="5266927">*</span><span class="ident" id="5266928">syntax</span><span class="op" id="5266934">.</span><span class="ident" id="5266935">Inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5266941">cap</span>&nbsp;&nbsp;<span class="op" id="5266946">[</span><span class="op" id="5266947">]</span><span class="builtintype" id="5266948">int</span><br>
<span class="lineno"></span><span class="op" id="5266952">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="5266955">//&nbsp;A&nbsp;machine&nbsp;holds&nbsp;all&nbsp;the&nbsp;state&nbsp;during&nbsp;an&nbsp;NFA&nbsp;simulation&nbsp;for&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="5267020">type</span>&nbsp;<span class="ident" id="5267025">machine</span>&nbsp;<span class="keyword" id="5267033">struct</span>&nbsp;<span class="op" id="5267040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5267043">re</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5267052">*</span><span class="ident" id="5267053">Regexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5267065">//&nbsp;corresponding&nbsp;Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5267090">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5267099">*</span><span class="ident" id="5267100">syntax</span><span class="op" id="5267106">.</span><span class="ident" id="5267107">Prog</span>&nbsp;<span class="comment" id="5267112">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5267133">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5267142">*</span><span class="ident" id="5267143">onePassProg</span>&nbsp;<span class="comment" id="5267155">//&nbsp;compiled&nbsp;onepass&nbsp;program,&nbsp;or&nbsp;notOnePass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5267199">q0</span><span class="op" id="5267201">,</span>&nbsp;<span class="ident" id="5267203">q1</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5267208">queue</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5267221">//&nbsp;two&nbsp;queues&nbsp;for&nbsp;runq,&nbsp;nextq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5267252">pool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5267261">[</span><span class="op" id="5267262">]</span><span class="op" id="5267263">*</span><span class="ident" id="5267264">thread</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5267274">//&nbsp;pool&nbsp;of&nbsp;available&nbsp;threads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5267304">matched</span>&nbsp;&nbsp;<span class="builtintype" id="5267313">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5267326">//&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5267356">matchcap</span>&nbsp;<span class="op" id="5267365">[</span><span class="op" id="5267366">]</span><span class="builtintype" id="5267367">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5267378">//&nbsp;capture&nbsp;information&nbsp;for&nbsp;the&nbsp;match</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5267417">//&nbsp;cached&nbsp;inputs,&nbsp;to&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5267456">inputBytes</span>&nbsp;&nbsp;<span class="ident" id="5267468">inputBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5267480">inputString</span>&nbsp;<span class="ident" id="5267492">inputString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5267505">inputReader</span>&nbsp;<span class="ident" id="5267517">inputReader</span><br>
<span class="lineno">50</span><span class="op" id="5267529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5267532">func</span>&nbsp;<span class="op" id="5267537">(</span><span class="ident" id="5267538">m</span>&nbsp;<span class="op" id="5267540">*</span><span class="ident" id="5267541">machine</span><span class="op" id="5267548">)</span>&nbsp;<span class="ident" id="5267550">newInputBytes</span><span class="op" id="5267563">(</span><span class="ident" id="5267564">b</span>&nbsp;<span class="op" id="5267566">[</span><span class="op" id="5267567">]</span><span class="builtintype" id="5267568">byte</span><span class="op" id="5267572">)</span>&nbsp;<span class="ident" id="5267574">input</span>&nbsp;<span class="op" id="5267580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5267583">m</span><span class="op" id="5267584">.</span><span class="ident" id="5267585">inputBytes</span><span class="op" id="5267595">.</span><span class="ident" id="5267596">str</span>&nbsp;<span class="op" id="5267600">=</span>&nbsp;<span class="ident" id="5267602">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5267605">return</span>&nbsp;<span class="op" id="5267612">&amp;</span><span class="ident" id="5267613">m</span><span class="op" id="5267614">.</span><span class="ident" id="5267615">inputBytes</span><br>
<span class="lineno">55</span><span class="op" id="5267626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5267629">func</span>&nbsp;<span class="op" id="5267634">(</span><span class="ident" id="5267635">m</span>&nbsp;<span class="op" id="5267637">*</span><span class="ident" id="5267638">machine</span><span class="op" id="5267645">)</span>&nbsp;<span class="ident" id="5267647">newInputString</span><span class="op" id="5267661">(</span><span class="ident" id="5267662">s</span>&nbsp;<span class="builtintype" id="5267664">string</span><span class="op" id="5267670">)</span>&nbsp;<span class="ident" id="5267672">input</span>&nbsp;<span class="op" id="5267678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5267681">m</span><span class="op" id="5267682">.</span><span class="ident" id="5267683">inputString</span><span class="op" id="5267694">.</span><span class="ident" id="5267695">str</span>&nbsp;<span class="op" id="5267699">=</span>&nbsp;<span class="ident" id="5267701">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5267704">return</span>&nbsp;<span class="op" id="5267711">&amp;</span><span class="ident" id="5267712">m</span><span class="op" id="5267713">.</span><span class="ident" id="5267714">inputString</span><br>
<span class="lineno">60</span><span class="op" id="5267726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5267729">func</span>&nbsp;<span class="op" id="5267734">(</span><span class="ident" id="5267735">m</span>&nbsp;<span class="op" id="5267737">*</span><span class="ident" id="5267738">machine</span><span class="op" id="5267745">)</span>&nbsp;<span class="ident" id="5267747">newInputReader</span><span class="op" id="5267761">(</span><span class="ident" id="5267762">r</span>&nbsp;<span class="ident" id="5267764">io</span><span class="op" id="5267766">.</span><span class="ident" id="5267767">RuneReader</span><span class="op" id="5267777">)</span>&nbsp;<span class="ident" id="5267779">input</span>&nbsp;<span class="op" id="5267785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5267788">m</span><span class="op" id="5267789">.</span><span class="ident" id="5267790">inputReader</span><span class="op" id="5267801">.</span><span class="ident" id="5267802">r</span>&nbsp;<span class="op" id="5267804">=</span>&nbsp;<span class="ident" id="5267806">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5267809">m</span><span class="op" id="5267810">.</span><span class="ident" id="5267811">inputReader</span><span class="op" id="5267822">.</span><span class="ident" id="5267823">atEOT</span>&nbsp;<span class="op" id="5267829">=</span>&nbsp;<span class="builtintype" id="5267831">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5267838">m</span><span class="op" id="5267839">.</span><span class="ident" id="5267840">inputReader</span><span class="op" id="5267851">.</span><span class="ident" id="5267852">pos</span>&nbsp;<span class="op" id="5267856">=</span>&nbsp;<span class="num" id="5267858">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5267861">return</span>&nbsp;<span class="op" id="5267868">&amp;</span><span class="ident" id="5267869">m</span><span class="op" id="5267870">.</span><span class="ident" id="5267871">inputReader</span><br>
<span class="lineno"></span><span class="op" id="5267883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5267886">//&nbsp;progMachine&nbsp;returns&nbsp;a&nbsp;new&nbsp;machine&nbsp;running&nbsp;the&nbsp;prog&nbsp;p.</span><br>
<span class="lineno">70</span><span class="keyword" id="5267943">func</span>&nbsp;<span class="ident" id="5267948">progMachine</span><span class="op" id="5267959">(</span><span class="ident" id="5267960">p</span>&nbsp;<span class="op" id="5267962">*</span><span class="ident" id="5267963">syntax</span><span class="op" id="5267969">.</span><span class="ident" id="5267970">Prog</span><span class="op" id="5267974">,</span>&nbsp;<span class="ident" id="5267976">op</span>&nbsp;<span class="op" id="5267979">*</span><span class="ident" id="5267980">onePassProg</span><span class="op" id="5267991">)</span>&nbsp;<span class="op" id="5267993">*</span><span class="ident" id="5267994">machine</span>&nbsp;<span class="op" id="5268002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268005">m</span>&nbsp;<span class="op" id="5268007">:=</span>&nbsp;<span class="op" id="5268010">&amp;</span><span class="ident" id="5268011">machine</span><span class="op" id="5268018">{</span><span class="ident" id="5268019">p</span><span class="op" id="5268020">:</span>&nbsp;<span class="ident" id="5268022">p</span><span class="op" id="5268023">,</span>&nbsp;<span class="ident" id="5268025">op</span><span class="op" id="5268027">:</span>&nbsp;<span class="ident" id="5268029">op</span><span class="op" id="5268031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268034">n</span>&nbsp;<span class="op" id="5268036">:=</span>&nbsp;<span class="builtinfunc" id="5268039">len</span><span class="op" id="5268042">(</span><span class="ident" id="5268043">m</span><span class="op" id="5268044">.</span><span class="ident" id="5268045">p</span><span class="op" id="5268046">.</span><span class="ident" id="5268047">Inst</span><span class="op" id="5268051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268054">m</span><span class="op" id="5268055">.</span><span class="ident" id="5268056">q0</span>&nbsp;<span class="op" id="5268059">=</span>&nbsp;<span class="ident" id="5268061">queue</span><span class="op" id="5268066">{</span><span class="builtinfunc" id="5268067">make</span><span class="op" id="5268071">(</span><span class="op" id="5268072">[</span><span class="op" id="5268073">]</span><span class="builtintype" id="5268074">uint32</span><span class="op" id="5268080">,</span>&nbsp;<span class="ident" id="5268082">n</span><span class="op" id="5268083">)</span><span class="op" id="5268084">,</span>&nbsp;<span class="builtinfunc" id="5268086">make</span><span class="op" id="5268090">(</span><span class="op" id="5268091">[</span><span class="op" id="5268092">]</span><span class="ident" id="5268093">entry</span><span class="op" id="5268098">,</span>&nbsp;<span class="num" id="5268100">0</span><span class="op" id="5268101">,</span>&nbsp;<span class="ident" id="5268103">n</span><span class="op" id="5268104">)</span><span class="op" id="5268105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268108">m</span><span class="op" id="5268109">.</span><span class="ident" id="5268110">q1</span>&nbsp;<span class="op" id="5268113">=</span>&nbsp;<span class="ident" id="5268115">queue</span><span class="op" id="5268120">{</span><span class="builtinfunc" id="5268121">make</span><span class="op" id="5268125">(</span><span class="op" id="5268126">[</span><span class="op" id="5268127">]</span><span class="builtintype" id="5268128">uint32</span><span class="op" id="5268134">,</span>&nbsp;<span class="ident" id="5268136">n</span><span class="op" id="5268137">)</span><span class="op" id="5268138">,</span>&nbsp;<span class="builtinfunc" id="5268140">make</span><span class="op" id="5268144">(</span><span class="op" id="5268145">[</span><span class="op" id="5268146">]</span><span class="ident" id="5268147">entry</span><span class="op" id="5268152">,</span>&nbsp;<span class="num" id="5268154">0</span><span class="op" id="5268155">,</span>&nbsp;<span class="ident" id="5268157">n</span><span class="op" id="5268158">)</span><span class="op" id="5268159">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268162">ncap</span>&nbsp;<span class="op" id="5268167">:=</span>&nbsp;<span class="ident" id="5268170">p</span><span class="op" id="5268171">.</span><span class="ident" id="5268172">NumCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5268180">if</span>&nbsp;<span class="ident" id="5268183">ncap</span>&nbsp;<span class="op" id="5268188">&lt;</span>&nbsp;<span class="num" id="5268190">2</span>&nbsp;<span class="op" id="5268192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268196">ncap</span>&nbsp;<span class="op" id="5268201">=</span>&nbsp;<span class="num" id="5268203">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5268206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268209">m</span><span class="op" id="5268210">.</span><span class="ident" id="5268211">matchcap</span>&nbsp;<span class="op" id="5268220">=</span>&nbsp;<span class="builtinfunc" id="5268222">make</span><span class="op" id="5268226">(</span><span class="op" id="5268227">[</span><span class="op" id="5268228">]</span><span class="builtintype" id="5268229">int</span><span class="op" id="5268232">,</span>&nbsp;<span class="ident" id="5268234">ncap</span><span class="op" id="5268238">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5268241">return</span>&nbsp;<span class="ident" id="5268248">m</span><br>
<span class="lineno"></span><span class="op" id="5268250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5268253">func</span>&nbsp;<span class="op" id="5268258">(</span><span class="ident" id="5268259">m</span>&nbsp;<span class="op" id="5268261">*</span><span class="ident" id="5268262">machine</span><span class="op" id="5268269">)</span>&nbsp;<span class="ident" id="5268271">init</span><span class="op" id="5268275">(</span><span class="ident" id="5268276">ncap</span>&nbsp;<span class="builtintype" id="5268281">int</span><span class="op" id="5268284">)</span>&nbsp;<span class="op" id="5268286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5268289">for</span>&nbsp;<span class="ident" id="5268293">_</span><span class="op" id="5268294">,</span>&nbsp;<span class="ident" id="5268296">t</span>&nbsp;<span class="op" id="5268298">:=</span>&nbsp;<span class="keyword" id="5268301">range</span>&nbsp;<span class="ident" id="5268307">m</span><span class="op" id="5268308">.</span><span class="ident" id="5268309">pool</span>&nbsp;<span class="op" id="5268314">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268318">t</span><span class="op" id="5268319">.</span><span class="builtinfunc" id="5268320">cap</span>&nbsp;<span class="op" id="5268324">=</span>&nbsp;<span class="ident" id="5268326">t</span><span class="op" id="5268327">.</span><span class="builtinfunc" id="5268328">cap</span><span class="op" id="5268331">[</span><span class="op" id="5268332">:</span><span class="ident" id="5268333">ncap</span><span class="op" id="5268337">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5268340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268343">m</span><span class="op" id="5268344">.</span><span class="ident" id="5268345">matchcap</span>&nbsp;<span class="op" id="5268354">=</span>&nbsp;<span class="ident" id="5268356">m</span><span class="op" id="5268357">.</span><span class="ident" id="5268358">matchcap</span><span class="op" id="5268366">[</span><span class="op" id="5268367">:</span><span class="ident" id="5268368">ncap</span><span class="op" id="5268372">]</span><br>
<span class="lineno"></span><span class="op" id="5268374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5268377">//&nbsp;alloc&nbsp;allocates&nbsp;a&nbsp;new&nbsp;thread&nbsp;with&nbsp;the&nbsp;given&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="5268437">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;free&nbsp;pool&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="5268475">func</span>&nbsp;<span class="op" id="5268480">(</span><span class="ident" id="5268481">m</span>&nbsp;<span class="op" id="5268483">*</span><span class="ident" id="5268484">machine</span><span class="op" id="5268491">)</span>&nbsp;<span class="ident" id="5268493">alloc</span><span class="op" id="5268498">(</span><span class="ident" id="5268499">i</span>&nbsp;<span class="op" id="5268501">*</span><span class="ident" id="5268502">syntax</span><span class="op" id="5268508">.</span><span class="ident" id="5268509">Inst</span><span class="op" id="5268513">)</span>&nbsp;<span class="op" id="5268515">*</span><span class="ident" id="5268516">thread</span>&nbsp;<span class="op" id="5268523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5268526">var</span>&nbsp;<span class="ident" id="5268530">t</span>&nbsp;<span class="op" id="5268532">*</span><span class="ident" id="5268533">thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5268541">if</span>&nbsp;<span class="ident" id="5268544">n</span>&nbsp;<span class="op" id="5268546">:=</span>&nbsp;<span class="builtinfunc" id="5268549">len</span><span class="op" id="5268552">(</span><span class="ident" id="5268553">m</span><span class="op" id="5268554">.</span><span class="ident" id="5268555">pool</span><span class="op" id="5268559">)</span><span class="op" id="5268560">;</span>&nbsp;<span class="ident" id="5268562">n</span>&nbsp;<span class="op" id="5268564">&gt;</span>&nbsp;<span class="num" id="5268566">0</span>&nbsp;<span class="op" id="5268568">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268572">t</span>&nbsp;<span class="op" id="5268574">=</span>&nbsp;<span class="ident" id="5268576">m</span><span class="op" id="5268577">.</span><span class="ident" id="5268578">pool</span><span class="op" id="5268582">[</span><span class="ident" id="5268583">n</span><span class="op" id="5268584">-</span><span class="num" id="5268585">1</span><span class="op" id="5268586">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268590">m</span><span class="op" id="5268591">.</span><span class="ident" id="5268592">pool</span>&nbsp;<span class="op" id="5268597">=</span>&nbsp;<span class="ident" id="5268599">m</span><span class="op" id="5268600">.</span><span class="ident" id="5268601">pool</span><span class="op" id="5268605">[</span><span class="op" id="5268606">:</span><span class="ident" id="5268607">n</span><span class="op" id="5268608">-</span><span class="num" id="5268609">1</span><span class="op" id="5268610">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5268613">}</span>&nbsp;<span class="keyword" id="5268615">else</span>&nbsp;<span class="op" id="5268620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268624">t</span>&nbsp;<span class="op" id="5268626">=</span>&nbsp;<span class="builtinfunc" id="5268628">new</span><span class="op" id="5268631">(</span><span class="ident" id="5268632">thread</span><span class="op" id="5268638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268642">t</span><span class="op" id="5268643">.</span><span class="builtinfunc" id="5268644">cap</span>&nbsp;<span class="op" id="5268648">=</span>&nbsp;<span class="builtinfunc" id="5268650">make</span><span class="op" id="5268654">(</span><span class="op" id="5268655">[</span><span class="op" id="5268656">]</span><span class="builtintype" id="5268657">int</span><span class="op" id="5268660">,</span>&nbsp;<span class="builtinfunc" id="5268662">len</span><span class="op" id="5268665">(</span><span class="ident" id="5268666">m</span><span class="op" id="5268667">.</span><span class="ident" id="5268668">matchcap</span><span class="op" id="5268676">)</span><span class="op" id="5268677">,</span>&nbsp;<span class="builtinfunc" id="5268679">cap</span><span class="op" id="5268682">(</span><span class="ident" id="5268683">m</span><span class="op" id="5268684">.</span><span class="ident" id="5268685">matchcap</span><span class="op" id="5268693">)</span><span class="op" id="5268694">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5268697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268700">t</span><span class="op" id="5268701">.</span><span class="ident" id="5268702">inst</span>&nbsp;<span class="op" id="5268707">=</span>&nbsp;<span class="ident" id="5268709">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5268712">return</span>&nbsp;<span class="ident" id="5268719">t</span><br>
<span class="lineno"></span><span class="op" id="5268721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5268724">//&nbsp;free&nbsp;returns&nbsp;t&nbsp;to&nbsp;the&nbsp;free&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="5268760">func</span>&nbsp;<span class="op" id="5268765">(</span><span class="ident" id="5268766">m</span>&nbsp;<span class="op" id="5268768">*</span><span class="ident" id="5268769">machine</span><span class="op" id="5268776">)</span>&nbsp;<span class="ident" id="5268778">free</span><span class="op" id="5268782">(</span><span class="ident" id="5268783">t</span>&nbsp;<span class="op" id="5268785">*</span><span class="ident" id="5268786">thread</span><span class="op" id="5268792">)</span>&nbsp;<span class="op" id="5268794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268797">m</span><span class="op" id="5268798">.</span><span class="ident" id="5268799">inputBytes</span><span class="op" id="5268809">.</span><span class="ident" id="5268810">str</span>&nbsp;<span class="op" id="5268814">=</span>&nbsp;<span class="builtintype" id="5268816">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268821">m</span><span class="op" id="5268822">.</span><span class="ident" id="5268823">inputString</span><span class="op" id="5268834">.</span><span class="ident" id="5268835">str</span>&nbsp;<span class="op" id="5268839">=</span>&nbsp;<span class="string" id="5268841">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268845">m</span><span class="op" id="5268846">.</span><span class="ident" id="5268847">inputReader</span><span class="op" id="5268858">.</span><span class="ident" id="5268859">r</span>&nbsp;<span class="op" id="5268861">=</span>&nbsp;<span class="builtintype" id="5268863">nil</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268868">m</span><span class="op" id="5268869">.</span><span class="ident" id="5268870">pool</span>&nbsp;<span class="op" id="5268875">=</span>&nbsp;<span class="builtinfunc" id="5268877">append</span><span class="op" id="5268883">(</span><span class="ident" id="5268884">m</span><span class="op" id="5268885">.</span><span class="ident" id="5268886">pool</span><span class="op" id="5268890">,</span>&nbsp;<span class="ident" id="5268892">t</span><span class="op" id="5268893">)</span><br>
<span class="lineno"></span><span class="op" id="5268895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5268898">//&nbsp;match&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="5268956">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno">115</span><span class="comment" id="5268997">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5269050">func</span>&nbsp;<span class="op" id="5269055">(</span><span class="ident" id="5269056">m</span>&nbsp;<span class="op" id="5269058">*</span><span class="ident" id="5269059">machine</span><span class="op" id="5269066">)</span>&nbsp;<span class="ident" id="5269068">match</span><span class="op" id="5269073">(</span><span class="ident" id="5269074">i</span>&nbsp;<span class="ident" id="5269076">input</span><span class="op" id="5269081">,</span>&nbsp;<span class="ident" id="5269083">pos</span>&nbsp;<span class="builtintype" id="5269087">int</span><span class="op" id="5269090">)</span>&nbsp;<span class="builtintype" id="5269092">bool</span>&nbsp;<span class="op" id="5269097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5269100">startCond</span>&nbsp;<span class="op" id="5269110">:=</span>&nbsp;<span class="ident" id="5269113">m</span><span class="op" id="5269114">.</span><span class="ident" id="5269115">re</span><span class="op" id="5269117">.</span><span class="ident" id="5269118">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5269124">if</span>&nbsp;<span class="ident" id="5269127">startCond</span>&nbsp;<span class="op" id="5269137">==</span>&nbsp;<span class="op" id="5269140">^</span><span class="ident" id="5269141">syntax</span><span class="op" id="5269147">.</span><span class="ident" id="5269148">EmptyOp</span><span class="op" id="5269155">(</span><span class="num" id="5269156">0</span><span class="op" id="5269157">)</span>&nbsp;<span class="op" id="5269159">{</span>&nbsp;<span class="comment" id="5269161">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5269177">return</span>&nbsp;<span class="builtintype" id="5269184">false</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5269191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5269194">m</span><span class="op" id="5269195">.</span><span class="ident" id="5269196">matched</span>&nbsp;<span class="op" id="5269204">=</span>&nbsp;<span class="builtintype" id="5269206">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5269213">for</span>&nbsp;<span class="ident" id="5269217">i</span>&nbsp;<span class="op" id="5269219">:=</span>&nbsp;<span class="keyword" id="5269222">range</span>&nbsp;<span class="ident" id="5269228">m</span><span class="op" id="5269229">.</span><span class="ident" id="5269230">matchcap</span>&nbsp;<span class="op" id="5269239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5269243">m</span><span class="op" id="5269244">.</span><span class="ident" id="5269245">matchcap</span><span class="op" id="5269253">[</span><span class="ident" id="5269254">i</span><span class="op" id="5269255">]</span>&nbsp;<span class="op" id="5269257">=</span>&nbsp;<span class="op" id="5269259">-</span><span class="num" id="5269260">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5269263">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5269266">runq</span><span class="op" id="5269270">,</span>&nbsp;<span class="ident" id="5269272">nextq</span>&nbsp;<span class="op" id="5269278">:=</span>&nbsp;<span class="op" id="5269281">&amp;</span><span class="ident" id="5269282">m</span><span class="op" id="5269283">.</span><span class="ident" id="5269284">q0</span><span class="op" id="5269286">,</span>&nbsp;<span class="op" id="5269288">&amp;</span><span class="ident" id="5269289">m</span><span class="op" id="5269290">.</span><span class="ident" id="5269291">q1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5269295">r</span><span class="op" id="5269296">,</span>&nbsp;<span class="ident" id="5269298">r1</span>&nbsp;<span class="op" id="5269301">:=</span>&nbsp;<span class="ident" id="5269304">endOfText</span><span class="op" id="5269313">,</span>&nbsp;<span class="ident" id="5269315">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5269326">width</span><span class="op" id="5269331">,</span>&nbsp;<span class="ident" id="5269333">width1</span>&nbsp;<span class="op" id="5269340">:=</span>&nbsp;<span class="num" id="5269343">0</span><span class="op" id="5269344">,</span>&nbsp;<span class="num" id="5269346">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5269349">r</span><span class="op" id="5269350">,</span>&nbsp;<span class="ident" id="5269352">width</span>&nbsp;<span class="op" id="5269358">=</span>&nbsp;<span class="ident" id="5269360">i</span><span class="op" id="5269361">.</span><span class="ident" id="5269362">step</span><span class="op" id="5269366">(</span><span class="ident" id="5269367">pos</span><span class="op" id="5269370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5269373">if</span>&nbsp;<span class="ident" id="5269376">r</span>&nbsp;<span class="op" id="5269378">!=</span>&nbsp;<span class="ident" id="5269381">endOfText</span>&nbsp;<span class="op" id="5269391">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5269395">r1</span><span class="op" id="5269397">,</span>&nbsp;<span class="ident" id="5269399">width1</span>&nbsp;<span class="op" id="5269406">=</span>&nbsp;<span class="ident" id="5269408">i</span><span class="op" id="5269409">.</span><span class="ident" id="5269410">step</span><span class="op" id="5269414">(</span><span class="ident" id="5269415">pos</span>&nbsp;<span class="op" id="5269419">+</span>&nbsp;<span class="ident" id="5269421">width</span><span class="op" id="5269426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5269429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5269432">var</span>&nbsp;<span class="ident" id="5269436">flag</span>&nbsp;<span class="ident" id="5269441">syntax</span><span class="op" id="5269447">.</span><span class="ident" id="5269448">EmptyOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5269457">if</span>&nbsp;<span class="ident" id="5269460">pos</span>&nbsp;<span class="op" id="5269464">==</span>&nbsp;<span class="num" id="5269467">0</span>&nbsp;<span class="op" id="5269469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5269473">flag</span>&nbsp;<span class="op" id="5269478">=</span>&nbsp;<span class="ident" id="5269480">syntax</span><span class="op" id="5269486">.</span><span class="ident" id="5269487">EmptyOpContext</span><span class="op" id="5269501">(</span><span class="op" id="5269502">-</span><span class="num" id="5269503">1</span><span class="op" id="5269504">,</span>&nbsp;<span class="ident" id="5269506">r</span><span class="op" id="5269507">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5269510">}</span>&nbsp;<span class="keyword" id="5269512">else</span>&nbsp;<span class="op" id="5269517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5269521">flag</span>&nbsp;<span class="op" id="5269526">=</span>&nbsp;<span class="ident" id="5269528">i</span><span class="op" id="5269529">.</span><span class="ident" id="5269530">context</span><span class="op" id="5269537">(</span><span class="ident" id="5269538">pos</span><span class="op" id="5269541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5269544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5269547">for</span>&nbsp;<span class="op" id="5269551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5269555">if</span>&nbsp;<span class="builtinfunc" id="5269558">len</span><span class="op" id="5269561">(</span><span class="ident" id="5269562">runq</span><span class="op" id="5269566">.</span><span class="ident" id="5269567">dense</span><span class="op" id="5269572">)</span>&nbsp;<span class="op" id="5269574">==</span>&nbsp;<span class="num" id="5269577">0</span>&nbsp;<span class="op" id="5269579">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5269584">if</span>&nbsp;<span class="ident" id="5269587">startCond</span><span class="op" id="5269596">&amp;</span><span class="ident" id="5269597">syntax</span><span class="op" id="5269603">.</span><span class="ident" id="5269604">EmptyBeginText</span>&nbsp;<span class="op" id="5269619">!=</span>&nbsp;<span class="num" id="5269622">0</span>&nbsp;<span class="op" id="5269624">&amp;&amp;</span>&nbsp;<span class="ident" id="5269627">pos</span>&nbsp;<span class="op" id="5269631">!=</span>&nbsp;<span class="num" id="5269634">0</span>&nbsp;<span class="op" id="5269636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5269642">//&nbsp;Anchored&nbsp;match,&nbsp;past&nbsp;beginning&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5269689">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5269698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5269703">if</span>&nbsp;<span class="ident" id="5269706">m</span><span class="op" id="5269707">.</span><span class="ident" id="5269708">matched</span>&nbsp;<span class="op" id="5269716">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5269722">//&nbsp;Have&nbsp;match;&nbsp;finished&nbsp;exploring&nbsp;alternatives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5269774">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5269783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5269788">if</span>&nbsp;<span class="builtinfunc" id="5269791">len</span><span class="op" id="5269794">(</span><span class="ident" id="5269795">m</span><span class="op" id="5269796">.</span><span class="ident" id="5269797">re</span><span class="op" id="5269799">.</span><span class="ident" id="5269800">prefix</span><span class="op" id="5269806">)</span>&nbsp;<span class="op" id="5269808">&gt;</span>&nbsp;<span class="num" id="5269810">0</span>&nbsp;<span class="op" id="5269812">&amp;&amp;</span>&nbsp;<span class="ident" id="5269815">r1</span>&nbsp;<span class="op" id="5269818">!=</span>&nbsp;<span class="ident" id="5269821">m</span><span class="op" id="5269822">.</span><span class="ident" id="5269823">re</span><span class="op" id="5269825">.</span><span class="ident" id="5269826">prefixRune</span>&nbsp;<span class="op" id="5269837">&amp;&amp;</span>&nbsp;<span class="ident" id="5269840">i</span><span class="op" id="5269841">.</span><span class="ident" id="5269842">canCheckPrefix</span><span class="op" id="5269856">(</span><span class="op" id="5269857">)</span>&nbsp;<span class="op" id="5269859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5269865">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5269923">advance</span>&nbsp;<span class="op" id="5269931">:=</span>&nbsp;<span class="ident" id="5269934">i</span><span class="op" id="5269935">.</span><span class="ident" id="5269936">index</span><span class="op" id="5269941">(</span><span class="ident" id="5269942">m</span><span class="op" id="5269943">.</span><span class="ident" id="5269944">re</span><span class="op" id="5269946">,</span>&nbsp;<span class="ident" id="5269948">pos</span><span class="op" id="5269951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5269957">if</span>&nbsp;<span class="ident" id="5269960">advance</span>&nbsp;<span class="op" id="5269968">&lt;</span>&nbsp;<span class="num" id="5269970">0</span>&nbsp;<span class="op" id="5269972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5269979">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5269989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5269995">pos</span>&nbsp;<span class="op" id="5269999">+=</span>&nbsp;<span class="ident" id="5270002">advance</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5270014">r</span><span class="op" id="5270015">,</span>&nbsp;<span class="ident" id="5270017">width</span>&nbsp;<span class="op" id="5270023">=</span>&nbsp;<span class="ident" id="5270025">i</span><span class="op" id="5270026">.</span><span class="ident" id="5270027">step</span><span class="op" id="5270031">(</span><span class="ident" id="5270032">pos</span><span class="op" id="5270035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5270041">r1</span><span class="op" id="5270043">,</span>&nbsp;<span class="ident" id="5270045">width1</span>&nbsp;<span class="op" id="5270052">=</span>&nbsp;<span class="ident" id="5270054">i</span><span class="op" id="5270055">.</span><span class="ident" id="5270056">step</span><span class="op" id="5270060">(</span><span class="ident" id="5270061">pos</span>&nbsp;<span class="op" id="5270065">+</span>&nbsp;<span class="ident" id="5270067">width</span><span class="op" id="5270072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5270077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5270081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5270085">if</span>&nbsp;<span class="op" id="5270088">!</span><span class="ident" id="5270089">m</span><span class="op" id="5270090">.</span><span class="ident" id="5270091">matched</span>&nbsp;<span class="op" id="5270099">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5270104">if</span>&nbsp;<span class="builtinfunc" id="5270107">len</span><span class="op" id="5270110">(</span><span class="ident" id="5270111">m</span><span class="op" id="5270112">.</span><span class="ident" id="5270113">matchcap</span><span class="op" id="5270121">)</span>&nbsp;<span class="op" id="5270123">&gt;</span>&nbsp;<span class="num" id="5270125">0</span>&nbsp;<span class="op" id="5270127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5270133">m</span><span class="op" id="5270134">.</span><span class="ident" id="5270135">matchcap</span><span class="op" id="5270143">[</span><span class="num" id="5270144">0</span><span class="op" id="5270145">]</span>&nbsp;<span class="op" id="5270147">=</span>&nbsp;<span class="ident" id="5270149">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5270156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5270161">m</span><span class="op" id="5270162">.</span><span class="ident" id="5270163">add</span><span class="op" id="5270166">(</span><span class="ident" id="5270167">runq</span><span class="op" id="5270171">,</span>&nbsp;<span class="builtintype" id="5270173">uint32</span><span class="op" id="5270179">(</span><span class="ident" id="5270180">m</span><span class="op" id="5270181">.</span><span class="ident" id="5270182">p</span><span class="op" id="5270183">.</span><span class="ident" id="5270184">Start</span><span class="op" id="5270189">)</span><span class="op" id="5270190">,</span>&nbsp;<span class="ident" id="5270192">pos</span><span class="op" id="5270195">,</span>&nbsp;<span class="ident" id="5270197">m</span><span class="op" id="5270198">.</span><span class="ident" id="5270199">matchcap</span><span class="op" id="5270207">,</span>&nbsp;<span class="ident" id="5270209">flag</span><span class="op" id="5270213">,</span>&nbsp;<span class="builtintype" id="5270215">nil</span><span class="op" id="5270218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5270222">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5270226">flag</span>&nbsp;<span class="op" id="5270231">=</span>&nbsp;<span class="ident" id="5270233">syntax</span><span class="op" id="5270239">.</span><span class="ident" id="5270240">EmptyOpContext</span><span class="op" id="5270254">(</span><span class="ident" id="5270255">r</span><span class="op" id="5270256">,</span>&nbsp;<span class="ident" id="5270258">r1</span><span class="op" id="5270260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5270264">m</span><span class="op" id="5270265">.</span><span class="ident" id="5270266">step</span><span class="op" id="5270270">(</span><span class="ident" id="5270271">runq</span><span class="op" id="5270275">,</span>&nbsp;<span class="ident" id="5270277">nextq</span><span class="op" id="5270282">,</span>&nbsp;<span class="ident" id="5270284">pos</span><span class="op" id="5270287">,</span>&nbsp;<span class="ident" id="5270289">pos</span><span class="op" id="5270292">+</span><span class="ident" id="5270293">width</span><span class="op" id="5270298">,</span>&nbsp;<span class="ident" id="5270300">r</span><span class="op" id="5270301">,</span>&nbsp;<span class="ident" id="5270303">flag</span><span class="op" id="5270307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5270311">if</span>&nbsp;<span class="ident" id="5270314">width</span>&nbsp;<span class="op" id="5270320">==</span>&nbsp;<span class="num" id="5270323">0</span>&nbsp;<span class="op" id="5270325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5270330">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5270338">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5270342">if</span>&nbsp;<span class="builtinfunc" id="5270345">len</span><span class="op" id="5270348">(</span><span class="ident" id="5270349">m</span><span class="op" id="5270350">.</span><span class="ident" id="5270351">matchcap</span><span class="op" id="5270359">)</span>&nbsp;<span class="op" id="5270361">==</span>&nbsp;<span class="num" id="5270364">0</span>&nbsp;<span class="op" id="5270366">&amp;&amp;</span>&nbsp;<span class="ident" id="5270369">m</span><span class="op" id="5270370">.</span><span class="ident" id="5270371">matched</span>&nbsp;<span class="op" id="5270379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5270384">//&nbsp;Found&nbsp;a&nbsp;match&nbsp;and&nbsp;not&nbsp;paying&nbsp;attention</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5270429">//&nbsp;to&nbsp;where&nbsp;it&nbsp;is,&nbsp;so&nbsp;any&nbsp;match&nbsp;will&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5270473">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5270481">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5270485">pos</span>&nbsp;<span class="op" id="5270489">+=</span>&nbsp;<span class="ident" id="5270492">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5270500">r</span><span class="op" id="5270501">,</span>&nbsp;<span class="ident" id="5270503">width</span>&nbsp;<span class="op" id="5270509">=</span>&nbsp;<span class="ident" id="5270511">r1</span><span class="op" id="5270513">,</span>&nbsp;<span class="ident" id="5270515">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5270524">if</span>&nbsp;<span class="ident" id="5270527">r</span>&nbsp;<span class="op" id="5270529">!=</span>&nbsp;<span class="ident" id="5270532">endOfText</span>&nbsp;<span class="op" id="5270542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5270547">r1</span><span class="op" id="5270549">,</span>&nbsp;<span class="ident" id="5270551">width1</span>&nbsp;<span class="op" id="5270558">=</span>&nbsp;<span class="ident" id="5270560">i</span><span class="op" id="5270561">.</span><span class="ident" id="5270562">step</span><span class="op" id="5270566">(</span><span class="ident" id="5270567">pos</span>&nbsp;<span class="op" id="5270571">+</span>&nbsp;<span class="ident" id="5270573">width</span><span class="op" id="5270578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5270582">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5270586">runq</span><span class="op" id="5270590">,</span>&nbsp;<span class="ident" id="5270592">nextq</span>&nbsp;<span class="op" id="5270598">=</span>&nbsp;<span class="ident" id="5270600">nextq</span><span class="op" id="5270605">,</span>&nbsp;<span class="ident" id="5270607">runq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5270613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5270616">m</span><span class="op" id="5270617">.</span><span class="ident" id="5270618">clear</span><span class="op" id="5270623">(</span><span class="ident" id="5270624">nextq</span><span class="op" id="5270629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5270632">return</span>&nbsp;<span class="ident" id="5270639">m</span><span class="op" id="5270640">.</span><span class="ident" id="5270641">matched</span><br>
<span class="lineno"></span><span class="op" id="5270649">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="5270652">//&nbsp;clear&nbsp;frees&nbsp;all&nbsp;threads&nbsp;on&nbsp;the&nbsp;thread&nbsp;queue.</span><br>
<span class="lineno"></span><span class="keyword" id="5270700">func</span>&nbsp;<span class="op" id="5270705">(</span><span class="ident" id="5270706">m</span>&nbsp;<span class="op" id="5270708">*</span><span class="ident" id="5270709">machine</span><span class="op" id="5270716">)</span>&nbsp;<span class="ident" id="5270718">clear</span><span class="op" id="5270723">(</span><span class="ident" id="5270724">q</span>&nbsp;<span class="op" id="5270726">*</span><span class="ident" id="5270727">queue</span><span class="op" id="5270732">)</span>&nbsp;<span class="op" id="5270734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5270737">for</span>&nbsp;<span class="ident" id="5270741">_</span><span class="op" id="5270742">,</span>&nbsp;<span class="ident" id="5270744">d</span>&nbsp;<span class="op" id="5270746">:=</span>&nbsp;<span class="keyword" id="5270749">range</span>&nbsp;<span class="ident" id="5270755">q</span><span class="op" id="5270756">.</span><span class="ident" id="5270757">dense</span>&nbsp;<span class="op" id="5270763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5270767">if</span>&nbsp;<span class="ident" id="5270770">d</span><span class="op" id="5270771">.</span><span class="ident" id="5270772">t</span>&nbsp;<span class="op" id="5270774">!=</span>&nbsp;<span class="builtintype" id="5270777">nil</span>&nbsp;<span class="op" id="5270781">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5270786">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5270804">m</span><span class="op" id="5270805">.</span><span class="ident" id="5270806">pool</span>&nbsp;<span class="op" id="5270811">=</span>&nbsp;<span class="builtinfunc" id="5270813">append</span><span class="op" id="5270819">(</span><span class="ident" id="5270820">m</span><span class="op" id="5270821">.</span><span class="ident" id="5270822">pool</span><span class="op" id="5270826">,</span>&nbsp;<span class="ident" id="5270828">d</span><span class="op" id="5270829">.</span><span class="ident" id="5270830">t</span><span class="op" id="5270831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5270835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5270838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5270841">q</span><span class="op" id="5270842">.</span><span class="ident" id="5270843">dense</span>&nbsp;<span class="op" id="5270849">=</span>&nbsp;<span class="ident" id="5270851">q</span><span class="op" id="5270852">.</span><span class="ident" id="5270853">dense</span><span class="op" id="5270858">[</span><span class="op" id="5270859">:</span><span class="num" id="5270860">0</span><span class="op" id="5270861">]</span><br>
<span class="lineno">195</span><span class="op" id="5270863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5270866">//&nbsp;step&nbsp;executes&nbsp;one&nbsp;step&nbsp;of&nbsp;the&nbsp;machine,&nbsp;running&nbsp;each&nbsp;of&nbsp;the&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="5270936">//&nbsp;on&nbsp;runq&nbsp;and&nbsp;appending&nbsp;new&nbsp;threads&nbsp;to&nbsp;nextq.</span><br>
<span class="lineno"></span><span class="comment" id="5270983">//&nbsp;The&nbsp;step&nbsp;processes&nbsp;the&nbsp;rune&nbsp;c&nbsp;(which&nbsp;may&nbsp;be&nbsp;endOfText),</span><br>
<span class="lineno">200</span><span class="comment" id="5271042">//&nbsp;which&nbsp;starts&nbsp;at&nbsp;position&nbsp;pos&nbsp;and&nbsp;ends&nbsp;at&nbsp;nextPos.</span><br>
<span class="lineno"></span><span class="comment" id="5271095">//&nbsp;nextCond&nbsp;gives&nbsp;the&nbsp;setting&nbsp;for&nbsp;the&nbsp;empty-width&nbsp;flags&nbsp;after&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="5271160">func</span>&nbsp;<span class="op" id="5271165">(</span><span class="ident" id="5271166">m</span>&nbsp;<span class="op" id="5271168">*</span><span class="ident" id="5271169">machine</span><span class="op" id="5271176">)</span>&nbsp;<span class="ident" id="5271178">step</span><span class="op" id="5271182">(</span><span class="ident" id="5271183">runq</span><span class="op" id="5271187">,</span>&nbsp;<span class="ident" id="5271189">nextq</span>&nbsp;<span class="op" id="5271195">*</span><span class="ident" id="5271196">queue</span><span class="op" id="5271201">,</span>&nbsp;<span class="ident" id="5271203">pos</span><span class="op" id="5271206">,</span>&nbsp;<span class="ident" id="5271208">nextPos</span>&nbsp;<span class="builtintype" id="5271216">int</span><span class="op" id="5271219">,</span>&nbsp;<span class="ident" id="5271221">c</span>&nbsp;<span class="builtintype" id="5271223">rune</span><span class="op" id="5271227">,</span>&nbsp;<span class="ident" id="5271229">nextCond</span>&nbsp;<span class="ident" id="5271238">syntax</span><span class="op" id="5271244">.</span><span class="ident" id="5271245">EmptyOp</span><span class="op" id="5271252">)</span>&nbsp;<span class="op" id="5271254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5271257">longest</span>&nbsp;<span class="op" id="5271265">:=</span>&nbsp;<span class="ident" id="5271268">m</span><span class="op" id="5271269">.</span><span class="ident" id="5271270">re</span><span class="op" id="5271272">.</span><span class="ident" id="5271273">longest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5271282">for</span>&nbsp;<span class="ident" id="5271286">j</span>&nbsp;<span class="op" id="5271288">:=</span>&nbsp;<span class="num" id="5271291">0</span><span class="op" id="5271292">;</span>&nbsp;<span class="ident" id="5271294">j</span>&nbsp;<span class="op" id="5271296">&lt;</span>&nbsp;<span class="builtinfunc" id="5271298">len</span><span class="op" id="5271301">(</span><span class="ident" id="5271302">runq</span><span class="op" id="5271306">.</span><span class="ident" id="5271307">dense</span><span class="op" id="5271312">)</span><span class="op" id="5271313">;</span>&nbsp;<span class="ident" id="5271315">j</span><span class="op" id="5271316">++</span>&nbsp;<span class="op" id="5271319">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5271323">d</span>&nbsp;<span class="op" id="5271325">:=</span>&nbsp;<span class="op" id="5271328">&amp;</span><span class="ident" id="5271329">runq</span><span class="op" id="5271333">.</span><span class="ident" id="5271334">dense</span><span class="op" id="5271339">[</span><span class="ident" id="5271340">j</span><span class="op" id="5271341">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5271345">t</span>&nbsp;<span class="op" id="5271347">:=</span>&nbsp;<span class="ident" id="5271350">d</span><span class="op" id="5271351">.</span><span class="ident" id="5271352">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5271356">if</span>&nbsp;<span class="ident" id="5271359">t</span>&nbsp;<span class="op" id="5271361">==</span>&nbsp;<span class="builtintype" id="5271364">nil</span>&nbsp;<span class="op" id="5271368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5271373">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5271384">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5271388">if</span>&nbsp;<span class="ident" id="5271391">longest</span>&nbsp;<span class="op" id="5271399">&amp;&amp;</span>&nbsp;<span class="ident" id="5271402">m</span><span class="op" id="5271403">.</span><span class="ident" id="5271404">matched</span>&nbsp;<span class="op" id="5271412">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5271415">len</span><span class="op" id="5271418">(</span><span class="ident" id="5271419">t</span><span class="op" id="5271420">.</span><span class="builtinfunc" id="5271421">cap</span><span class="op" id="5271424">)</span>&nbsp;<span class="op" id="5271426">&gt;</span>&nbsp;<span class="num" id="5271428">0</span>&nbsp;<span class="op" id="5271430">&amp;&amp;</span>&nbsp;<span class="ident" id="5271433">m</span><span class="op" id="5271434">.</span><span class="ident" id="5271435">matchcap</span><span class="op" id="5271443">[</span><span class="num" id="5271444">0</span><span class="op" id="5271445">]</span>&nbsp;<span class="op" id="5271447">&lt;</span>&nbsp;<span class="ident" id="5271449">t</span><span class="op" id="5271450">.</span><span class="builtinfunc" id="5271451">cap</span><span class="op" id="5271454">[</span><span class="num" id="5271455">0</span><span class="op" id="5271456">]</span>&nbsp;<span class="op" id="5271458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5271463">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5271479">m</span><span class="op" id="5271480">.</span><span class="ident" id="5271481">pool</span>&nbsp;<span class="op" id="5271486">=</span>&nbsp;<span class="builtinfunc" id="5271488">append</span><span class="op" id="5271494">(</span><span class="ident" id="5271495">m</span><span class="op" id="5271496">.</span><span class="ident" id="5271497">pool</span><span class="op" id="5271501">,</span>&nbsp;<span class="ident" id="5271503">t</span><span class="op" id="5271504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5271509">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5271520">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5271524">i</span>&nbsp;<span class="op" id="5271526">:=</span>&nbsp;<span class="ident" id="5271529">t</span><span class="op" id="5271530">.</span><span class="ident" id="5271531">inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5271538">add</span>&nbsp;<span class="op" id="5271542">:=</span>&nbsp;<span class="builtintype" id="5271545">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5271553">switch</span>&nbsp;<span class="ident" id="5271560">i</span><span class="op" id="5271561">.</span><span class="ident" id="5271562">Op</span>&nbsp;<span class="op" id="5271565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5271569">default</span><span class="op" id="5271576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5271581">panic</span><span class="op" id="5271586">(</span><span class="string" id="5271587">&#34;bad&nbsp;inst&#34;</span><span class="op" id="5271597">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5271602">case</span>&nbsp;<span class="ident" id="5271607">syntax</span><span class="op" id="5271613">.</span><span class="ident" id="5271614">InstMatch</span><span class="op" id="5271623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5271628">if</span>&nbsp;<span class="builtinfunc" id="5271631">len</span><span class="op" id="5271634">(</span><span class="ident" id="5271635">t</span><span class="op" id="5271636">.</span><span class="builtinfunc" id="5271637">cap</span><span class="op" id="5271640">)</span>&nbsp;<span class="op" id="5271642">&gt;</span>&nbsp;<span class="num" id="5271644">0</span>&nbsp;<span class="op" id="5271646">&amp;&amp;</span>&nbsp;<span class="op" id="5271649">(</span><span class="op" id="5271650">!</span><span class="ident" id="5271651">longest</span>&nbsp;<span class="op" id="5271659">||</span>&nbsp;<span class="op" id="5271662">!</span><span class="ident" id="5271663">m</span><span class="op" id="5271664">.</span><span class="ident" id="5271665">matched</span>&nbsp;<span class="op" id="5271673">||</span>&nbsp;<span class="ident" id="5271676">m</span><span class="op" id="5271677">.</span><span class="ident" id="5271678">matchcap</span><span class="op" id="5271686">[</span><span class="num" id="5271687">1</span><span class="op" id="5271688">]</span>&nbsp;<span class="op" id="5271690">&lt;</span>&nbsp;<span class="ident" id="5271692">pos</span><span class="op" id="5271695">)</span>&nbsp;<span class="op" id="5271697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5271703">t</span><span class="op" id="5271704">.</span><span class="builtinfunc" id="5271705">cap</span><span class="op" id="5271708">[</span><span class="num" id="5271709">1</span><span class="op" id="5271710">]</span>&nbsp;<span class="op" id="5271712">=</span>&nbsp;<span class="ident" id="5271714">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5271722">copy</span><span class="op" id="5271726">(</span><span class="ident" id="5271727">m</span><span class="op" id="5271728">.</span><span class="ident" id="5271729">matchcap</span><span class="op" id="5271737">,</span>&nbsp;<span class="ident" id="5271739">t</span><span class="op" id="5271740">.</span><span class="builtinfunc" id="5271741">cap</span><span class="op" id="5271744">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5271749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5271754">if</span>&nbsp;<span class="op" id="5271757">!</span><span class="ident" id="5271758">longest</span>&nbsp;<span class="op" id="5271766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5271772">//&nbsp;First-match&nbsp;mode:&nbsp;cut&nbsp;off&nbsp;all&nbsp;lower-priority&nbsp;threads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5271833">for</span>&nbsp;<span class="ident" id="5271837">_</span><span class="op" id="5271838">,</span>&nbsp;<span class="ident" id="5271840">d</span>&nbsp;<span class="op" id="5271842">:=</span>&nbsp;<span class="keyword" id="5271845">range</span>&nbsp;<span class="ident" id="5271851">runq</span><span class="op" id="5271855">.</span><span class="ident" id="5271856">dense</span><span class="op" id="5271861">[</span><span class="ident" id="5271862">j</span><span class="op" id="5271863">+</span><span class="num" id="5271864">1</span><span class="op" id="5271865">:</span><span class="op" id="5271866">]</span>&nbsp;<span class="op" id="5271868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5271875">if</span>&nbsp;<span class="ident" id="5271878">d</span><span class="op" id="5271879">.</span><span class="ident" id="5271880">t</span>&nbsp;<span class="op" id="5271882">!=</span>&nbsp;<span class="builtintype" id="5271885">nil</span>&nbsp;<span class="op" id="5271889">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5271897">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5271918">m</span><span class="op" id="5271919">.</span><span class="ident" id="5271920">pool</span>&nbsp;<span class="op" id="5271925">=</span>&nbsp;<span class="builtinfunc" id="5271927">append</span><span class="op" id="5271933">(</span><span class="ident" id="5271934">m</span><span class="op" id="5271935">.</span><span class="ident" id="5271936">pool</span><span class="op" id="5271940">,</span>&nbsp;<span class="ident" id="5271942">d</span><span class="op" id="5271943">.</span><span class="ident" id="5271944">t</span><span class="op" id="5271945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5271952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5271958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5271964">runq</span><span class="op" id="5271968">.</span><span class="ident" id="5271969">dense</span>&nbsp;<span class="op" id="5271975">=</span>&nbsp;<span class="ident" id="5271977">runq</span><span class="op" id="5271981">.</span><span class="ident" id="5271982">dense</span><span class="op" id="5271987">[</span><span class="op" id="5271988">:</span><span class="num" id="5271989">0</span><span class="op" id="5271990">]</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5271995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5272000">m</span><span class="op" id="5272001">.</span><span class="ident" id="5272002">matched</span>&nbsp;<span class="op" id="5272010">=</span>&nbsp;<span class="builtintype" id="5272012">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5272020">case</span>&nbsp;<span class="ident" id="5272025">syntax</span><span class="op" id="5272031">.</span><span class="ident" id="5272032">InstRune</span><span class="op" id="5272040">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5272045">add</span>&nbsp;<span class="op" id="5272049">=</span>&nbsp;<span class="ident" id="5272051">i</span><span class="op" id="5272052">.</span><span class="ident" id="5272053">MatchRune</span><span class="op" id="5272062">(</span><span class="ident" id="5272063">c</span><span class="op" id="5272064">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5272068">case</span>&nbsp;<span class="ident" id="5272073">syntax</span><span class="op" id="5272079">.</span><span class="ident" id="5272080">InstRune1</span><span class="op" id="5272089">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5272094">add</span>&nbsp;<span class="op" id="5272098">=</span>&nbsp;<span class="ident" id="5272100">c</span>&nbsp;<span class="op" id="5272102">==</span>&nbsp;<span class="ident" id="5272105">i</span><span class="op" id="5272106">.</span><span class="ident" id="5272107">Rune</span><span class="op" id="5272111">[</span><span class="num" id="5272112">0</span><span class="op" id="5272113">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5272117">case</span>&nbsp;<span class="ident" id="5272122">syntax</span><span class="op" id="5272128">.</span><span class="ident" id="5272129">InstRuneAny</span><span class="op" id="5272140">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5272145">add</span>&nbsp;<span class="op" id="5272149">=</span>&nbsp;<span class="builtintype" id="5272151">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5272158">case</span>&nbsp;<span class="ident" id="5272163">syntax</span><span class="op" id="5272169">.</span><span class="ident" id="5272170">InstRuneAnyNotNL</span><span class="op" id="5272186">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5272191">add</span>&nbsp;<span class="op" id="5272195">=</span>&nbsp;<span class="ident" id="5272197">c</span>&nbsp;<span class="op" id="5272199">!=</span>&nbsp;<span class="string" id="5272202">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5272209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5272213">if</span>&nbsp;<span class="ident" id="5272216">add</span>&nbsp;<span class="op" id="5272220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5272225">t</span>&nbsp;<span class="op" id="5272227">=</span>&nbsp;<span class="ident" id="5272229">m</span><span class="op" id="5272230">.</span><span class="ident" id="5272231">add</span><span class="op" id="5272234">(</span><span class="ident" id="5272235">nextq</span><span class="op" id="5272240">,</span>&nbsp;<span class="ident" id="5272242">i</span><span class="op" id="5272243">.</span><span class="ident" id="5272244">Out</span><span class="op" id="5272247">,</span>&nbsp;<span class="ident" id="5272249">nextPos</span><span class="op" id="5272256">,</span>&nbsp;<span class="ident" id="5272258">t</span><span class="op" id="5272259">.</span><span class="builtinfunc" id="5272260">cap</span><span class="op" id="5272263">,</span>&nbsp;<span class="ident" id="5272265">nextCond</span><span class="op" id="5272273">,</span>&nbsp;<span class="ident" id="5272275">t</span><span class="op" id="5272276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5272280">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5272284">if</span>&nbsp;<span class="ident" id="5272287">t</span>&nbsp;<span class="op" id="5272289">!=</span>&nbsp;<span class="builtintype" id="5272292">nil</span>&nbsp;<span class="op" id="5272296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5272301">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5272317">m</span><span class="op" id="5272318">.</span><span class="ident" id="5272319">pool</span>&nbsp;<span class="op" id="5272324">=</span>&nbsp;<span class="builtinfunc" id="5272326">append</span><span class="op" id="5272332">(</span><span class="ident" id="5272333">m</span><span class="op" id="5272334">.</span><span class="ident" id="5272335">pool</span><span class="op" id="5272339">,</span>&nbsp;<span class="ident" id="5272341">t</span><span class="op" id="5272342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5272346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5272349">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5272352">runq</span><span class="op" id="5272356">.</span><span class="ident" id="5272357">dense</span>&nbsp;<span class="op" id="5272363">=</span>&nbsp;<span class="ident" id="5272365">runq</span><span class="op" id="5272369">.</span><span class="ident" id="5272370">dense</span><span class="op" id="5272375">[</span><span class="op" id="5272376">:</span><span class="num" id="5272377">0</span><span class="op" id="5272378">]</span><br>
<span class="lineno"></span><span class="op" id="5272380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5272383">//&nbsp;add&nbsp;adds&nbsp;an&nbsp;entry&nbsp;to&nbsp;q&nbsp;for&nbsp;pc,&nbsp;unless&nbsp;the&nbsp;q&nbsp;already&nbsp;has&nbsp;such&nbsp;an&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="5272457">//&nbsp;It&nbsp;also&nbsp;recursively&nbsp;adds&nbsp;an&nbsp;entry&nbsp;for&nbsp;all&nbsp;instructions&nbsp;reachable&nbsp;from&nbsp;pc&nbsp;by&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="5272546">//&nbsp;empty-width&nbsp;conditions&nbsp;satisfied&nbsp;by&nbsp;cond.&nbsp;&nbsp;pos&nbsp;gives&nbsp;the&nbsp;current&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5272623">//&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5272640">func</span>&nbsp;<span class="op" id="5272645">(</span><span class="ident" id="5272646">m</span>&nbsp;<span class="op" id="5272648">*</span><span class="ident" id="5272649">machine</span><span class="op" id="5272656">)</span>&nbsp;<span class="ident" id="5272658">add</span><span class="op" id="5272661">(</span><span class="ident" id="5272662">q</span>&nbsp;<span class="op" id="5272664">*</span><span class="ident" id="5272665">queue</span><span class="op" id="5272670">,</span>&nbsp;<span class="ident" id="5272672">pc</span>&nbsp;<span class="builtintype" id="5272675">uint32</span><span class="op" id="5272681">,</span>&nbsp;<span class="ident" id="5272683">pos</span>&nbsp;<span class="builtintype" id="5272687">int</span><span class="op" id="5272690">,</span>&nbsp;<span class="builtinfunc" id="5272692">cap</span>&nbsp;<span class="op" id="5272696">[</span><span class="op" id="5272697">]</span><span class="builtintype" id="5272698">int</span><span class="op" id="5272701">,</span>&nbsp;<span class="ident" id="5272703">cond</span>&nbsp;<span class="ident" id="5272708">syntax</span><span class="op" id="5272714">.</span><span class="ident" id="5272715">EmptyOp</span><span class="op" id="5272722">,</span>&nbsp;<span class="ident" id="5272724">t</span>&nbsp;<span class="op" id="5272726">*</span><span class="ident" id="5272727">thread</span><span class="op" id="5272733">)</span>&nbsp;<span class="op" id="5272735">*</span><span class="ident" id="5272736">thread</span>&nbsp;<span class="op" id="5272743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5272746">if</span>&nbsp;<span class="ident" id="5272749">pc</span>&nbsp;<span class="op" id="5272752">==</span>&nbsp;<span class="num" id="5272755">0</span>&nbsp;<span class="op" id="5272757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5272761">return</span>&nbsp;<span class="ident" id="5272768">t</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5272771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5272774">if</span>&nbsp;<span class="ident" id="5272777">j</span>&nbsp;<span class="op" id="5272779">:=</span>&nbsp;<span class="ident" id="5272782">q</span><span class="op" id="5272783">.</span><span class="ident" id="5272784">sparse</span><span class="op" id="5272790">[</span><span class="ident" id="5272791">pc</span><span class="op" id="5272793">]</span><span class="op" id="5272794">;</span>&nbsp;<span class="ident" id="5272796">j</span>&nbsp;<span class="op" id="5272798">&lt;</span>&nbsp;<span class="builtintype" id="5272800">uint32</span><span class="op" id="5272806">(</span><span class="builtinfunc" id="5272807">len</span><span class="op" id="5272810">(</span><span class="ident" id="5272811">q</span><span class="op" id="5272812">.</span><span class="ident" id="5272813">dense</span><span class="op" id="5272818">)</span><span class="op" id="5272819">)</span>&nbsp;<span class="op" id="5272821">&amp;&amp;</span>&nbsp;<span class="ident" id="5272824">q</span><span class="op" id="5272825">.</span><span class="ident" id="5272826">dense</span><span class="op" id="5272831">[</span><span class="ident" id="5272832">j</span><span class="op" id="5272833">]</span><span class="op" id="5272834">.</span><span class="ident" id="5272835">pc</span>&nbsp;<span class="op" id="5272838">==</span>&nbsp;<span class="ident" id="5272841">pc</span>&nbsp;<span class="op" id="5272844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5272848">return</span>&nbsp;<span class="ident" id="5272855">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5272858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5272862">j</span>&nbsp;<span class="op" id="5272864">:=</span>&nbsp;<span class="builtinfunc" id="5272867">len</span><span class="op" id="5272870">(</span><span class="ident" id="5272871">q</span><span class="op" id="5272872">.</span><span class="ident" id="5272873">dense</span><span class="op" id="5272878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5272881">q</span><span class="op" id="5272882">.</span><span class="ident" id="5272883">dense</span>&nbsp;<span class="op" id="5272889">=</span>&nbsp;<span class="ident" id="5272891">q</span><span class="op" id="5272892">.</span><span class="ident" id="5272893">dense</span><span class="op" id="5272898">[</span><span class="op" id="5272899">:</span><span class="ident" id="5272900">j</span><span class="op" id="5272901">+</span><span class="num" id="5272902">1</span><span class="op" id="5272903">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5272906">d</span>&nbsp;<span class="op" id="5272908">:=</span>&nbsp;<span class="op" id="5272911">&amp;</span><span class="ident" id="5272912">q</span><span class="op" id="5272913">.</span><span class="ident" id="5272914">dense</span><span class="op" id="5272919">[</span><span class="ident" id="5272920">j</span><span class="op" id="5272921">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5272924">d</span><span class="op" id="5272925">.</span><span class="ident" id="5272926">t</span>&nbsp;<span class="op" id="5272928">=</span>&nbsp;<span class="builtintype" id="5272930">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5272935">d</span><span class="op" id="5272936">.</span><span class="ident" id="5272937">pc</span>&nbsp;<span class="op" id="5272940">=</span>&nbsp;<span class="ident" id="5272942">pc</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5272946">q</span><span class="op" id="5272947">.</span><span class="ident" id="5272948">sparse</span><span class="op" id="5272954">[</span><span class="ident" id="5272955">pc</span><span class="op" id="5272957">]</span>&nbsp;<span class="op" id="5272959">=</span>&nbsp;<span class="builtintype" id="5272961">uint32</span><span class="op" id="5272967">(</span><span class="ident" id="5272968">j</span><span class="op" id="5272969">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5272973">i</span>&nbsp;<span class="op" id="5272975">:=</span>&nbsp;<span class="op" id="5272978">&amp;</span><span class="ident" id="5272979">m</span><span class="op" id="5272980">.</span><span class="ident" id="5272981">p</span><span class="op" id="5272982">.</span><span class="ident" id="5272983">Inst</span><span class="op" id="5272987">[</span><span class="ident" id="5272988">pc</span><span class="op" id="5272990">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5272993">switch</span>&nbsp;<span class="ident" id="5273000">i</span><span class="op" id="5273001">.</span><span class="ident" id="5273002">Op</span>&nbsp;<span class="op" id="5273005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5273008">default</span><span class="op" id="5273015">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5273019">panic</span><span class="op" id="5273024">(</span><span class="string" id="5273025">&#34;unhandled&#34;</span><span class="op" id="5273036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5273039">case</span>&nbsp;<span class="ident" id="5273044">syntax</span><span class="op" id="5273050">.</span><span class="ident" id="5273051">InstFail</span><span class="op" id="5273059">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5273063">//&nbsp;nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5273075">case</span>&nbsp;<span class="ident" id="5273080">syntax</span><span class="op" id="5273086">.</span><span class="ident" id="5273087">InstAlt</span><span class="op" id="5273094">,</span>&nbsp;<span class="ident" id="5273096">syntax</span><span class="op" id="5273102">.</span><span class="ident" id="5273103">InstAltMatch</span><span class="op" id="5273115">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5273119">t</span>&nbsp;<span class="op" id="5273121">=</span>&nbsp;<span class="ident" id="5273123">m</span><span class="op" id="5273124">.</span><span class="ident" id="5273125">add</span><span class="op" id="5273128">(</span><span class="ident" id="5273129">q</span><span class="op" id="5273130">,</span>&nbsp;<span class="ident" id="5273132">i</span><span class="op" id="5273133">.</span><span class="ident" id="5273134">Out</span><span class="op" id="5273137">,</span>&nbsp;<span class="ident" id="5273139">pos</span><span class="op" id="5273142">,</span>&nbsp;<span class="builtinfunc" id="5273144">cap</span><span class="op" id="5273147">,</span>&nbsp;<span class="ident" id="5273149">cond</span><span class="op" id="5273153">,</span>&nbsp;<span class="ident" id="5273155">t</span><span class="op" id="5273156">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5273160">t</span>&nbsp;<span class="op" id="5273162">=</span>&nbsp;<span class="ident" id="5273164">m</span><span class="op" id="5273165">.</span><span class="ident" id="5273166">add</span><span class="op" id="5273169">(</span><span class="ident" id="5273170">q</span><span class="op" id="5273171">,</span>&nbsp;<span class="ident" id="5273173">i</span><span class="op" id="5273174">.</span><span class="ident" id="5273175">Arg</span><span class="op" id="5273178">,</span>&nbsp;<span class="ident" id="5273180">pos</span><span class="op" id="5273183">,</span>&nbsp;<span class="builtinfunc" id="5273185">cap</span><span class="op" id="5273188">,</span>&nbsp;<span class="ident" id="5273190">cond</span><span class="op" id="5273194">,</span>&nbsp;<span class="ident" id="5273196">t</span><span class="op" id="5273197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5273200">case</span>&nbsp;<span class="ident" id="5273205">syntax</span><span class="op" id="5273211">.</span><span class="ident" id="5273212">InstEmptyWidth</span><span class="op" id="5273226">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5273230">if</span>&nbsp;<span class="ident" id="5273233">syntax</span><span class="op" id="5273239">.</span><span class="ident" id="5273240">EmptyOp</span><span class="op" id="5273247">(</span><span class="ident" id="5273248">i</span><span class="op" id="5273249">.</span><span class="ident" id="5273250">Arg</span><span class="op" id="5273253">)</span><span class="op" id="5273254">&amp;^</span><span class="ident" id="5273256">cond</span>&nbsp;<span class="op" id="5273261">==</span>&nbsp;<span class="num" id="5273264">0</span>&nbsp;<span class="op" id="5273266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5273271">t</span>&nbsp;<span class="op" id="5273273">=</span>&nbsp;<span class="ident" id="5273275">m</span><span class="op" id="5273276">.</span><span class="ident" id="5273277">add</span><span class="op" id="5273280">(</span><span class="ident" id="5273281">q</span><span class="op" id="5273282">,</span>&nbsp;<span class="ident" id="5273284">i</span><span class="op" id="5273285">.</span><span class="ident" id="5273286">Out</span><span class="op" id="5273289">,</span>&nbsp;<span class="ident" id="5273291">pos</span><span class="op" id="5273294">,</span>&nbsp;<span class="builtinfunc" id="5273296">cap</span><span class="op" id="5273299">,</span>&nbsp;<span class="ident" id="5273301">cond</span><span class="op" id="5273305">,</span>&nbsp;<span class="ident" id="5273307">t</span><span class="op" id="5273308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5273312">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5273315">case</span>&nbsp;<span class="ident" id="5273320">syntax</span><span class="op" id="5273326">.</span><span class="ident" id="5273327">InstNop</span><span class="op" id="5273334">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5273338">t</span>&nbsp;<span class="op" id="5273340">=</span>&nbsp;<span class="ident" id="5273342">m</span><span class="op" id="5273343">.</span><span class="ident" id="5273344">add</span><span class="op" id="5273347">(</span><span class="ident" id="5273348">q</span><span class="op" id="5273349">,</span>&nbsp;<span class="ident" id="5273351">i</span><span class="op" id="5273352">.</span><span class="ident" id="5273353">Out</span><span class="op" id="5273356">,</span>&nbsp;<span class="ident" id="5273358">pos</span><span class="op" id="5273361">,</span>&nbsp;<span class="builtinfunc" id="5273363">cap</span><span class="op" id="5273366">,</span>&nbsp;<span class="ident" id="5273368">cond</span><span class="op" id="5273372">,</span>&nbsp;<span class="ident" id="5273374">t</span><span class="op" id="5273375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5273378">case</span>&nbsp;<span class="ident" id="5273383">syntax</span><span class="op" id="5273389">.</span><span class="ident" id="5273390">InstCapture</span><span class="op" id="5273401">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5273405">if</span>&nbsp;<span class="builtintype" id="5273408">int</span><span class="op" id="5273411">(</span><span class="ident" id="5273412">i</span><span class="op" id="5273413">.</span><span class="ident" id="5273414">Arg</span><span class="op" id="5273417">)</span>&nbsp;<span class="op" id="5273419">&lt;</span>&nbsp;<span class="builtinfunc" id="5273421">len</span><span class="op" id="5273424">(</span><span class="builtinfunc" id="5273425">cap</span><span class="op" id="5273428">)</span>&nbsp;<span class="op" id="5273430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5273435">opos</span>&nbsp;<span class="op" id="5273440">:=</span>&nbsp;<span class="builtinfunc" id="5273443">cap</span><span class="op" id="5273446">[</span><span class="ident" id="5273447">i</span><span class="op" id="5273448">.</span><span class="ident" id="5273449">Arg</span><span class="op" id="5273452">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5273457">cap</span><span class="op" id="5273460">[</span><span class="ident" id="5273461">i</span><span class="op" id="5273462">.</span><span class="ident" id="5273463">Arg</span><span class="op" id="5273466">]</span>&nbsp;<span class="op" id="5273468">=</span>&nbsp;<span class="ident" id="5273470">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5273477">m</span><span class="op" id="5273478">.</span><span class="ident" id="5273479">add</span><span class="op" id="5273482">(</span><span class="ident" id="5273483">q</span><span class="op" id="5273484">,</span>&nbsp;<span class="ident" id="5273486">i</span><span class="op" id="5273487">.</span><span class="ident" id="5273488">Out</span><span class="op" id="5273491">,</span>&nbsp;<span class="ident" id="5273493">pos</span><span class="op" id="5273496">,</span>&nbsp;<span class="builtinfunc" id="5273498">cap</span><span class="op" id="5273501">,</span>&nbsp;<span class="ident" id="5273503">cond</span><span class="op" id="5273507">,</span>&nbsp;<span class="builtintype" id="5273509">nil</span><span class="op" id="5273512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5273517">cap</span><span class="op" id="5273520">[</span><span class="ident" id="5273521">i</span><span class="op" id="5273522">.</span><span class="ident" id="5273523">Arg</span><span class="op" id="5273526">]</span>&nbsp;<span class="op" id="5273528">=</span>&nbsp;<span class="ident" id="5273530">opos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5273537">}</span>&nbsp;<span class="keyword" id="5273539">else</span>&nbsp;<span class="op" id="5273544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5273549">t</span>&nbsp;<span class="op" id="5273551">=</span>&nbsp;<span class="ident" id="5273553">m</span><span class="op" id="5273554">.</span><span class="ident" id="5273555">add</span><span class="op" id="5273558">(</span><span class="ident" id="5273559">q</span><span class="op" id="5273560">,</span>&nbsp;<span class="ident" id="5273562">i</span><span class="op" id="5273563">.</span><span class="ident" id="5273564">Out</span><span class="op" id="5273567">,</span>&nbsp;<span class="ident" id="5273569">pos</span><span class="op" id="5273572">,</span>&nbsp;<span class="builtinfunc" id="5273574">cap</span><span class="op" id="5273577">,</span>&nbsp;<span class="ident" id="5273579">cond</span><span class="op" id="5273583">,</span>&nbsp;<span class="ident" id="5273585">t</span><span class="op" id="5273586">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5273590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5273593">case</span>&nbsp;<span class="ident" id="5273598">syntax</span><span class="op" id="5273604">.</span><span class="ident" id="5273605">InstMatch</span><span class="op" id="5273614">,</span>&nbsp;<span class="ident" id="5273616">syntax</span><span class="op" id="5273622">.</span><span class="ident" id="5273623">InstRune</span><span class="op" id="5273631">,</span>&nbsp;<span class="ident" id="5273633">syntax</span><span class="op" id="5273639">.</span><span class="ident" id="5273640">InstRune1</span><span class="op" id="5273649">,</span>&nbsp;<span class="ident" id="5273651">syntax</span><span class="op" id="5273657">.</span><span class="ident" id="5273658">InstRuneAny</span><span class="op" id="5273669">,</span>&nbsp;<span class="ident" id="5273671">syntax</span><span class="op" id="5273677">.</span><span class="ident" id="5273678">InstRuneAnyNotNL</span><span class="op" id="5273694">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5273698">if</span>&nbsp;<span class="ident" id="5273701">t</span>&nbsp;<span class="op" id="5273703">==</span>&nbsp;<span class="builtintype" id="5273706">nil</span>&nbsp;<span class="op" id="5273710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5273715">t</span>&nbsp;<span class="op" id="5273717">=</span>&nbsp;<span class="ident" id="5273719">m</span><span class="op" id="5273720">.</span><span class="ident" id="5273721">alloc</span><span class="op" id="5273726">(</span><span class="ident" id="5273727">i</span><span class="op" id="5273728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5273732">}</span>&nbsp;<span class="keyword" id="5273734">else</span>&nbsp;<span class="op" id="5273739">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5273744">t</span><span class="op" id="5273745">.</span><span class="ident" id="5273746">inst</span>&nbsp;<span class="op" id="5273751">=</span>&nbsp;<span class="ident" id="5273753">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5273757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5273761">if</span>&nbsp;<span class="builtinfunc" id="5273764">len</span><span class="op" id="5273767">(</span><span class="builtinfunc" id="5273768">cap</span><span class="op" id="5273771">)</span>&nbsp;<span class="op" id="5273773">&gt;</span>&nbsp;<span class="num" id="5273775">0</span>&nbsp;<span class="op" id="5273777">&amp;&amp;</span>&nbsp;<span class="op" id="5273780">&amp;</span><span class="ident" id="5273781">t</span><span class="op" id="5273782">.</span><span class="builtinfunc" id="5273783">cap</span><span class="op" id="5273786">[</span><span class="num" id="5273787">0</span><span class="op" id="5273788">]</span>&nbsp;<span class="op" id="5273790">!=</span>&nbsp;<span class="op" id="5273793">&amp;</span><span class="builtinfunc" id="5273794">cap</span><span class="op" id="5273797">[</span><span class="num" id="5273798">0</span><span class="op" id="5273799">]</span>&nbsp;<span class="op" id="5273801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5273806">copy</span><span class="op" id="5273810">(</span><span class="ident" id="5273811">t</span><span class="op" id="5273812">.</span><span class="builtinfunc" id="5273813">cap</span><span class="op" id="5273816">,</span>&nbsp;<span class="builtinfunc" id="5273818">cap</span><span class="op" id="5273821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5273825">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5273829">d</span><span class="op" id="5273830">.</span><span class="ident" id="5273831">t</span>&nbsp;<span class="op" id="5273833">=</span>&nbsp;<span class="ident" id="5273835">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5273839">t</span>&nbsp;<span class="op" id="5273841">=</span>&nbsp;<span class="builtintype" id="5273843">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5273848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5273851">return</span>&nbsp;<span class="ident" id="5273858">t</span><br>
<span class="lineno"></span><span class="op" id="5273860">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="5273863">//&nbsp;onepass&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="5273923">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="5273964">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5274017">func</span>&nbsp;<span class="op" id="5274022">(</span><span class="ident" id="5274023">m</span>&nbsp;<span class="op" id="5274025">*</span><span class="ident" id="5274026">machine</span><span class="op" id="5274033">)</span>&nbsp;<span class="ident" id="5274035">onepass</span><span class="op" id="5274042">(</span><span class="ident" id="5274043">i</span>&nbsp;<span class="ident" id="5274045">input</span><span class="op" id="5274050">,</span>&nbsp;<span class="ident" id="5274052">pos</span>&nbsp;<span class="builtintype" id="5274056">int</span><span class="op" id="5274059">)</span>&nbsp;<span class="builtintype" id="5274061">bool</span>&nbsp;<span class="op" id="5274066">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274069">startCond</span>&nbsp;<span class="op" id="5274079">:=</span>&nbsp;<span class="ident" id="5274082">m</span><span class="op" id="5274083">.</span><span class="ident" id="5274084">re</span><span class="op" id="5274086">.</span><span class="ident" id="5274087">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5274093">if</span>&nbsp;<span class="ident" id="5274096">startCond</span>&nbsp;<span class="op" id="5274106">==</span>&nbsp;<span class="op" id="5274109">^</span><span class="ident" id="5274110">syntax</span><span class="op" id="5274116">.</span><span class="ident" id="5274117">EmptyOp</span><span class="op" id="5274124">(</span><span class="num" id="5274125">0</span><span class="op" id="5274126">)</span>&nbsp;<span class="op" id="5274128">{</span>&nbsp;<span class="comment" id="5274130">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5274146">return</span>&nbsp;<span class="builtintype" id="5274153">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5274160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274163">m</span><span class="op" id="5274164">.</span><span class="ident" id="5274165">matched</span>&nbsp;<span class="op" id="5274173">=</span>&nbsp;<span class="builtintype" id="5274175">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5274182">for</span>&nbsp;<span class="ident" id="5274186">i</span>&nbsp;<span class="op" id="5274188">:=</span>&nbsp;<span class="keyword" id="5274191">range</span>&nbsp;<span class="ident" id="5274197">m</span><span class="op" id="5274198">.</span><span class="ident" id="5274199">matchcap</span>&nbsp;<span class="op" id="5274208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274212">m</span><span class="op" id="5274213">.</span><span class="ident" id="5274214">matchcap</span><span class="op" id="5274222">[</span><span class="ident" id="5274223">i</span><span class="op" id="5274224">]</span>&nbsp;<span class="op" id="5274226">=</span>&nbsp;<span class="op" id="5274228">-</span><span class="num" id="5274229">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5274232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274235">r</span><span class="op" id="5274236">,</span>&nbsp;<span class="ident" id="5274238">r1</span>&nbsp;<span class="op" id="5274241">:=</span>&nbsp;<span class="ident" id="5274244">endOfText</span><span class="op" id="5274253">,</span>&nbsp;<span class="ident" id="5274255">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274266">width</span><span class="op" id="5274271">,</span>&nbsp;<span class="ident" id="5274273">width1</span>&nbsp;<span class="op" id="5274280">:=</span>&nbsp;<span class="num" id="5274283">0</span><span class="op" id="5274284">,</span>&nbsp;<span class="num" id="5274286">0</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274289">r</span><span class="op" id="5274290">,</span>&nbsp;<span class="ident" id="5274292">width</span>&nbsp;<span class="op" id="5274298">=</span>&nbsp;<span class="ident" id="5274300">i</span><span class="op" id="5274301">.</span><span class="ident" id="5274302">step</span><span class="op" id="5274306">(</span><span class="ident" id="5274307">pos</span><span class="op" id="5274310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5274313">if</span>&nbsp;<span class="ident" id="5274316">r</span>&nbsp;<span class="op" id="5274318">!=</span>&nbsp;<span class="ident" id="5274321">endOfText</span>&nbsp;<span class="op" id="5274331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274335">r1</span><span class="op" id="5274337">,</span>&nbsp;<span class="ident" id="5274339">width1</span>&nbsp;<span class="op" id="5274346">=</span>&nbsp;<span class="ident" id="5274348">i</span><span class="op" id="5274349">.</span><span class="ident" id="5274350">step</span><span class="op" id="5274354">(</span><span class="ident" id="5274355">pos</span>&nbsp;<span class="op" id="5274359">+</span>&nbsp;<span class="ident" id="5274361">width</span><span class="op" id="5274366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5274369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5274372">var</span>&nbsp;<span class="ident" id="5274376">flag</span>&nbsp;<span class="ident" id="5274381">syntax</span><span class="op" id="5274387">.</span><span class="ident" id="5274388">EmptyOp</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5274397">if</span>&nbsp;<span class="ident" id="5274400">pos</span>&nbsp;<span class="op" id="5274404">==</span>&nbsp;<span class="num" id="5274407">0</span>&nbsp;<span class="op" id="5274409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274413">flag</span>&nbsp;<span class="op" id="5274418">=</span>&nbsp;<span class="ident" id="5274420">syntax</span><span class="op" id="5274426">.</span><span class="ident" id="5274427">EmptyOpContext</span><span class="op" id="5274441">(</span><span class="op" id="5274442">-</span><span class="num" id="5274443">1</span><span class="op" id="5274444">,</span>&nbsp;<span class="ident" id="5274446">r</span><span class="op" id="5274447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5274450">}</span>&nbsp;<span class="keyword" id="5274452">else</span>&nbsp;<span class="op" id="5274457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274461">flag</span>&nbsp;<span class="op" id="5274466">=</span>&nbsp;<span class="ident" id="5274468">i</span><span class="op" id="5274469">.</span><span class="ident" id="5274470">context</span><span class="op" id="5274477">(</span><span class="ident" id="5274478">pos</span><span class="op" id="5274481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5274484">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274487">pc</span>&nbsp;<span class="op" id="5274490">:=</span>&nbsp;<span class="ident" id="5274493">m</span><span class="op" id="5274494">.</span><span class="ident" id="5274495">op</span><span class="op" id="5274497">.</span><span class="ident" id="5274498">Start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274505">inst</span>&nbsp;<span class="op" id="5274510">:=</span>&nbsp;<span class="ident" id="5274513">m</span><span class="op" id="5274514">.</span><span class="ident" id="5274515">op</span><span class="op" id="5274517">.</span><span class="ident" id="5274518">Inst</span><span class="op" id="5274522">[</span><span class="ident" id="5274523">pc</span><span class="op" id="5274525">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5274528">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;simple&nbsp;literal&nbsp;prefix,&nbsp;skip&nbsp;over&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5274583">if</span>&nbsp;<span class="ident" id="5274586">pos</span>&nbsp;<span class="op" id="5274590">==</span>&nbsp;<span class="num" id="5274593">0</span>&nbsp;<span class="op" id="5274595">&amp;&amp;</span>&nbsp;<span class="ident" id="5274598">syntax</span><span class="op" id="5274604">.</span><span class="ident" id="5274605">EmptyOp</span><span class="op" id="5274612">(</span><span class="ident" id="5274613">inst</span><span class="op" id="5274617">.</span><span class="ident" id="5274618">Arg</span><span class="op" id="5274621">)</span><span class="op" id="5274622">&amp;^</span><span class="ident" id="5274624">flag</span>&nbsp;<span class="op" id="5274629">==</span>&nbsp;<span class="num" id="5274632">0</span>&nbsp;<span class="op" id="5274634">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5274639">len</span><span class="op" id="5274642">(</span><span class="ident" id="5274643">m</span><span class="op" id="5274644">.</span><span class="ident" id="5274645">re</span><span class="op" id="5274647">.</span><span class="ident" id="5274648">prefix</span><span class="op" id="5274654">)</span>&nbsp;<span class="op" id="5274656">&gt;</span>&nbsp;<span class="num" id="5274658">0</span>&nbsp;<span class="op" id="5274660">&amp;&amp;</span>&nbsp;<span class="ident" id="5274663">i</span><span class="op" id="5274664">.</span><span class="ident" id="5274665">canCheckPrefix</span><span class="op" id="5274679">(</span><span class="op" id="5274680">)</span>&nbsp;<span class="op" id="5274682">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5274686">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5274742">if</span>&nbsp;<span class="ident" id="5274745">i</span><span class="op" id="5274746">.</span><span class="ident" id="5274747">hasPrefix</span><span class="op" id="5274756">(</span><span class="ident" id="5274757">m</span><span class="op" id="5274758">.</span><span class="ident" id="5274759">re</span><span class="op" id="5274761">)</span>&nbsp;<span class="op" id="5274763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274768">pos</span>&nbsp;<span class="op" id="5274772">+=</span>&nbsp;<span class="builtinfunc" id="5274775">len</span><span class="op" id="5274778">(</span><span class="ident" id="5274779">m</span><span class="op" id="5274780">.</span><span class="ident" id="5274781">re</span><span class="op" id="5274783">.</span><span class="ident" id="5274784">prefix</span><span class="op" id="5274790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274795">r</span><span class="op" id="5274796">,</span>&nbsp;<span class="ident" id="5274798">width</span>&nbsp;<span class="op" id="5274804">=</span>&nbsp;<span class="ident" id="5274806">i</span><span class="op" id="5274807">.</span><span class="ident" id="5274808">step</span><span class="op" id="5274812">(</span><span class="ident" id="5274813">pos</span><span class="op" id="5274816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274821">r1</span><span class="op" id="5274823">,</span>&nbsp;<span class="ident" id="5274825">width1</span>&nbsp;<span class="op" id="5274832">=</span>&nbsp;<span class="ident" id="5274834">i</span><span class="op" id="5274835">.</span><span class="ident" id="5274836">step</span><span class="op" id="5274840">(</span><span class="ident" id="5274841">pos</span>&nbsp;<span class="op" id="5274845">+</span>&nbsp;<span class="ident" id="5274847">width</span><span class="op" id="5274852">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274857">flag</span>&nbsp;<span class="op" id="5274862">=</span>&nbsp;<span class="ident" id="5274864">i</span><span class="op" id="5274865">.</span><span class="ident" id="5274866">context</span><span class="op" id="5274873">(</span><span class="ident" id="5274874">pos</span><span class="op" id="5274877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274882">pc</span>&nbsp;<span class="op" id="5274885">=</span>&nbsp;<span class="builtintype" id="5274887">int</span><span class="op" id="5274890">(</span><span class="ident" id="5274891">m</span><span class="op" id="5274892">.</span><span class="ident" id="5274893">re</span><span class="op" id="5274895">.</span><span class="ident" id="5274896">prefixEnd</span><span class="op" id="5274905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5274909">}</span>&nbsp;<span class="keyword" id="5274911">else</span>&nbsp;<span class="op" id="5274916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5274921">return</span>&nbsp;<span class="ident" id="5274928">m</span><span class="op" id="5274929">.</span><span class="ident" id="5274930">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5274940">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5274943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5274946">for</span>&nbsp;<span class="op" id="5274950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274954">inst</span>&nbsp;<span class="op" id="5274959">=</span>&nbsp;<span class="ident" id="5274961">m</span><span class="op" id="5274962">.</span><span class="ident" id="5274963">op</span><span class="op" id="5274965">.</span><span class="ident" id="5274966">Inst</span><span class="op" id="5274970">[</span><span class="ident" id="5274971">pc</span><span class="op" id="5274973">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5274977">pc</span>&nbsp;<span class="op" id="5274980">=</span>&nbsp;<span class="builtintype" id="5274982">int</span><span class="op" id="5274985">(</span><span class="ident" id="5274986">inst</span><span class="op" id="5274990">.</span><span class="ident" id="5274991">Out</span><span class="op" id="5274994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5274998">switch</span>&nbsp;<span class="ident" id="5275005">inst</span><span class="op" id="5275009">.</span><span class="ident" id="5275010">Op</span>&nbsp;<span class="op" id="5275013">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275017">default</span><span class="op" id="5275024">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5275029">panic</span><span class="op" id="5275034">(</span><span class="string" id="5275035">&#34;bad&nbsp;inst&#34;</span><span class="op" id="5275045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275049">case</span>&nbsp;<span class="ident" id="5275054">syntax</span><span class="op" id="5275060">.</span><span class="ident" id="5275061">InstMatch</span><span class="op" id="5275070">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5275075">m</span><span class="op" id="5275076">.</span><span class="ident" id="5275077">matched</span>&nbsp;<span class="op" id="5275085">=</span>&nbsp;<span class="builtintype" id="5275087">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275095">if</span>&nbsp;<span class="builtinfunc" id="5275098">len</span><span class="op" id="5275101">(</span><span class="ident" id="5275102">m</span><span class="op" id="5275103">.</span><span class="ident" id="5275104">matchcap</span><span class="op" id="5275112">)</span>&nbsp;<span class="op" id="5275114">&gt;</span>&nbsp;<span class="num" id="5275116">0</span>&nbsp;<span class="op" id="5275118">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5275124">m</span><span class="op" id="5275125">.</span><span class="ident" id="5275126">matchcap</span><span class="op" id="5275134">[</span><span class="num" id="5275135">0</span><span class="op" id="5275136">]</span>&nbsp;<span class="op" id="5275138">=</span>&nbsp;<span class="num" id="5275140">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5275146">m</span><span class="op" id="5275147">.</span><span class="ident" id="5275148">matchcap</span><span class="op" id="5275156">[</span><span class="num" id="5275157">1</span><span class="op" id="5275158">]</span>&nbsp;<span class="op" id="5275160">=</span>&nbsp;<span class="ident" id="5275162">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5275169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275174">return</span>&nbsp;<span class="ident" id="5275181">m</span><span class="op" id="5275182">.</span><span class="ident" id="5275183">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275193">case</span>&nbsp;<span class="ident" id="5275198">syntax</span><span class="op" id="5275204">.</span><span class="ident" id="5275205">InstRune</span><span class="op" id="5275213">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275218">if</span>&nbsp;<span class="op" id="5275221">!</span><span class="ident" id="5275222">inst</span><span class="op" id="5275226">.</span><span class="ident" id="5275227">MatchRune</span><span class="op" id="5275236">(</span><span class="ident" id="5275237">r</span><span class="op" id="5275238">)</span>&nbsp;<span class="op" id="5275240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275246">return</span>&nbsp;<span class="ident" id="5275253">m</span><span class="op" id="5275254">.</span><span class="ident" id="5275255">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5275266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275270">case</span>&nbsp;<span class="ident" id="5275275">syntax</span><span class="op" id="5275281">.</span><span class="ident" id="5275282">InstRune1</span><span class="op" id="5275291">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275296">if</span>&nbsp;<span class="ident" id="5275299">r</span>&nbsp;<span class="op" id="5275301">!=</span>&nbsp;<span class="ident" id="5275304">inst</span><span class="op" id="5275308">.</span><span class="ident" id="5275309">Rune</span><span class="op" id="5275313">[</span><span class="num" id="5275314">0</span><span class="op" id="5275315">]</span>&nbsp;<span class="op" id="5275317">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275323">return</span>&nbsp;<span class="ident" id="5275330">m</span><span class="op" id="5275331">.</span><span class="ident" id="5275332">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5275343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275347">case</span>&nbsp;<span class="ident" id="5275352">syntax</span><span class="op" id="5275358">.</span><span class="ident" id="5275359">InstRuneAny</span><span class="op" id="5275370">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5275375">//&nbsp;Nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275388">case</span>&nbsp;<span class="ident" id="5275393">syntax</span><span class="op" id="5275399">.</span><span class="ident" id="5275400">InstRuneAnyNotNL</span><span class="op" id="5275416">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275421">if</span>&nbsp;<span class="ident" id="5275424">r</span>&nbsp;<span class="op" id="5275426">==</span>&nbsp;<span class="string" id="5275429">&#39;\n&#39;</span>&nbsp;<span class="op" id="5275434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275440">return</span>&nbsp;<span class="ident" id="5275447">m</span><span class="op" id="5275448">.</span><span class="ident" id="5275449">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5275460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5275464">//&nbsp;peek&nbsp;at&nbsp;the&nbsp;input&nbsp;rune&nbsp;to&nbsp;see&nbsp;which&nbsp;branch&nbsp;of&nbsp;the&nbsp;Alt&nbsp;to&nbsp;take</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275531">case</span>&nbsp;<span class="ident" id="5275536">syntax</span><span class="op" id="5275542">.</span><span class="ident" id="5275543">InstAlt</span><span class="op" id="5275550">,</span>&nbsp;<span class="ident" id="5275552">syntax</span><span class="op" id="5275558">.</span><span class="ident" id="5275559">InstAltMatch</span><span class="op" id="5275571">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5275576">pc</span>&nbsp;<span class="op" id="5275579">=</span>&nbsp;<span class="builtintype" id="5275581">int</span><span class="op" id="5275584">(</span><span class="ident" id="5275585">onePassNext</span><span class="op" id="5275596">(</span><span class="op" id="5275597">&amp;</span><span class="ident" id="5275598">inst</span><span class="op" id="5275602">,</span>&nbsp;<span class="ident" id="5275604">r</span><span class="op" id="5275605">)</span><span class="op" id="5275606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275611">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275622">case</span>&nbsp;<span class="ident" id="5275627">syntax</span><span class="op" id="5275633">.</span><span class="ident" id="5275634">InstFail</span><span class="op" id="5275642">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275647">return</span>&nbsp;<span class="ident" id="5275654">m</span><span class="op" id="5275655">.</span><span class="ident" id="5275656">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275666">case</span>&nbsp;<span class="ident" id="5275671">syntax</span><span class="op" id="5275677">.</span><span class="ident" id="5275678">InstNop</span><span class="op" id="5275685">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275690">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275701">case</span>&nbsp;<span class="ident" id="5275706">syntax</span><span class="op" id="5275712">.</span><span class="ident" id="5275713">InstEmptyWidth</span><span class="op" id="5275727">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275732">if</span>&nbsp;<span class="ident" id="5275735">syntax</span><span class="op" id="5275741">.</span><span class="ident" id="5275742">EmptyOp</span><span class="op" id="5275749">(</span><span class="ident" id="5275750">inst</span><span class="op" id="5275754">.</span><span class="ident" id="5275755">Arg</span><span class="op" id="5275758">)</span><span class="op" id="5275759">&amp;^</span><span class="ident" id="5275761">flag</span>&nbsp;<span class="op" id="5275766">!=</span>&nbsp;<span class="num" id="5275769">0</span>&nbsp;<span class="op" id="5275771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275777">return</span>&nbsp;<span class="ident" id="5275784">m</span><span class="op" id="5275785">.</span><span class="ident" id="5275786">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5275797">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275802">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275813">case</span>&nbsp;<span class="ident" id="5275818">syntax</span><span class="op" id="5275824">.</span><span class="ident" id="5275825">InstCapture</span><span class="op" id="5275836">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275841">if</span>&nbsp;<span class="builtintype" id="5275844">int</span><span class="op" id="5275847">(</span><span class="ident" id="5275848">inst</span><span class="op" id="5275852">.</span><span class="ident" id="5275853">Arg</span><span class="op" id="5275856">)</span>&nbsp;<span class="op" id="5275858">&lt;</span>&nbsp;<span class="builtinfunc" id="5275860">len</span><span class="op" id="5275863">(</span><span class="ident" id="5275864">m</span><span class="op" id="5275865">.</span><span class="ident" id="5275866">matchcap</span><span class="op" id="5275874">)</span>&nbsp;<span class="op" id="5275876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5275882">m</span><span class="op" id="5275883">.</span><span class="ident" id="5275884">matchcap</span><span class="op" id="5275892">[</span><span class="ident" id="5275893">inst</span><span class="op" id="5275897">.</span><span class="ident" id="5275898">Arg</span><span class="op" id="5275901">]</span>&nbsp;<span class="op" id="5275903">=</span>&nbsp;<span class="ident" id="5275905">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5275912">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275917">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5275928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275932">if</span>&nbsp;<span class="ident" id="5275935">width</span>&nbsp;<span class="op" id="5275941">==</span>&nbsp;<span class="num" id="5275944">0</span>&nbsp;<span class="op" id="5275946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5275951">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5275959">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5275963">flag</span>&nbsp;<span class="op" id="5275968">=</span>&nbsp;<span class="ident" id="5275970">syntax</span><span class="op" id="5275976">.</span><span class="ident" id="5275977">EmptyOpContext</span><span class="op" id="5275991">(</span><span class="ident" id="5275992">r</span><span class="op" id="5275993">,</span>&nbsp;<span class="ident" id="5275995">r1</span><span class="op" id="5275997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276001">pos</span>&nbsp;<span class="op" id="5276005">+=</span>&nbsp;<span class="ident" id="5276008">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276016">r</span><span class="op" id="5276017">,</span>&nbsp;<span class="ident" id="5276019">width</span>&nbsp;<span class="op" id="5276025">=</span>&nbsp;<span class="ident" id="5276027">r1</span><span class="op" id="5276029">,</span>&nbsp;<span class="ident" id="5276031">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5276040">if</span>&nbsp;<span class="ident" id="5276043">r</span>&nbsp;<span class="op" id="5276045">!=</span>&nbsp;<span class="ident" id="5276048">endOfText</span>&nbsp;<span class="op" id="5276058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276063">r1</span><span class="op" id="5276065">,</span>&nbsp;<span class="ident" id="5276067">width1</span>&nbsp;<span class="op" id="5276074">=</span>&nbsp;<span class="ident" id="5276076">i</span><span class="op" id="5276077">.</span><span class="ident" id="5276078">step</span><span class="op" id="5276082">(</span><span class="ident" id="5276083">pos</span>&nbsp;<span class="op" id="5276087">+</span>&nbsp;<span class="ident" id="5276089">width</span><span class="op" id="5276094">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5276098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5276101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5276104">return</span>&nbsp;<span class="ident" id="5276111">m</span><span class="op" id="5276112">.</span><span class="ident" id="5276113">matched</span><br>
<span class="lineno"></span><span class="op" id="5276121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="5276124">//&nbsp;empty&nbsp;is&nbsp;a&nbsp;non-nil&nbsp;0-element&nbsp;slice,</span><br>
<span class="lineno"></span><span class="comment" id="5276163">//&nbsp;so&nbsp;doExecute&nbsp;can&nbsp;avoid&nbsp;an&nbsp;allocation</span><br>
<span class="lineno"></span><span class="comment" id="5276203">//&nbsp;when&nbsp;0&nbsp;captures&nbsp;are&nbsp;requested&nbsp;from&nbsp;a&nbsp;successful&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5276261">var</span>&nbsp;<span class="ident" id="5276265">empty</span>&nbsp;<span class="op" id="5276271">=</span>&nbsp;<span class="builtinfunc" id="5276273">make</span><span class="op" id="5276277">(</span><span class="op" id="5276278">[</span><span class="op" id="5276279">]</span><span class="builtintype" id="5276280">int</span><span class="op" id="5276283">,</span>&nbsp;<span class="num" id="5276285">0</span><span class="op" id="5276286">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="5276289">//&nbsp;doExecute&nbsp;finds&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;the&nbsp;input&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5276352">//&nbsp;the&nbsp;position&nbsp;of&nbsp;its&nbsp;subexpressions.</span><br>
<span class="lineno"></span><span class="keyword" id="5276391">func</span>&nbsp;<span class="op" id="5276396">(</span><span class="ident" id="5276397">re</span>&nbsp;<span class="op" id="5276400">*</span><span class="ident" id="5276401">Regexp</span><span class="op" id="5276407">)</span>&nbsp;<span class="ident" id="5276409">doExecute</span><span class="op" id="5276418">(</span><span class="ident" id="5276419">r</span>&nbsp;<span class="ident" id="5276421">io</span><span class="op" id="5276423">.</span><span class="ident" id="5276424">RuneReader</span><span class="op" id="5276434">,</span>&nbsp;<span class="ident" id="5276436">b</span>&nbsp;<span class="op" id="5276438">[</span><span class="op" id="5276439">]</span><span class="builtintype" id="5276440">byte</span><span class="op" id="5276444">,</span>&nbsp;<span class="ident" id="5276446">s</span>&nbsp;<span class="builtintype" id="5276448">string</span><span class="op" id="5276454">,</span>&nbsp;<span class="ident" id="5276456">pos</span>&nbsp;<span class="builtintype" id="5276460">int</span><span class="op" id="5276463">,</span>&nbsp;<span class="ident" id="5276465">ncap</span>&nbsp;<span class="builtintype" id="5276470">int</span><span class="op" id="5276473">)</span>&nbsp;<span class="op" id="5276475">[</span><span class="op" id="5276476">]</span><span class="builtintype" id="5276477">int</span>&nbsp;<span class="op" id="5276481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276484">m</span>&nbsp;<span class="op" id="5276486">:=</span>&nbsp;<span class="ident" id="5276489">re</span><span class="op" id="5276491">.</span><span class="ident" id="5276492">get</span><span class="op" id="5276495">(</span><span class="op" id="5276496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5276499">var</span>&nbsp;<span class="ident" id="5276503">i</span>&nbsp;<span class="ident" id="5276505">input</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5276512">if</span>&nbsp;<span class="ident" id="5276515">r</span>&nbsp;<span class="op" id="5276517">!=</span>&nbsp;<span class="builtintype" id="5276520">nil</span>&nbsp;<span class="op" id="5276524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276528">i</span>&nbsp;<span class="op" id="5276530">=</span>&nbsp;<span class="ident" id="5276532">m</span><span class="op" id="5276533">.</span><span class="ident" id="5276534">newInputReader</span><span class="op" id="5276548">(</span><span class="ident" id="5276549">r</span><span class="op" id="5276550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5276553">}</span>&nbsp;<span class="keyword" id="5276555">else</span>&nbsp;<span class="keyword" id="5276560">if</span>&nbsp;<span class="ident" id="5276563">b</span>&nbsp;<span class="op" id="5276565">!=</span>&nbsp;<span class="builtintype" id="5276568">nil</span>&nbsp;<span class="op" id="5276572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276576">i</span>&nbsp;<span class="op" id="5276578">=</span>&nbsp;<span class="ident" id="5276580">m</span><span class="op" id="5276581">.</span><span class="ident" id="5276582">newInputBytes</span><span class="op" id="5276595">(</span><span class="ident" id="5276596">b</span><span class="op" id="5276597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5276600">}</span>&nbsp;<span class="keyword" id="5276602">else</span>&nbsp;<span class="op" id="5276607">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276611">i</span>&nbsp;<span class="op" id="5276613">=</span>&nbsp;<span class="ident" id="5276615">m</span><span class="op" id="5276616">.</span><span class="ident" id="5276617">newInputString</span><span class="op" id="5276631">(</span><span class="ident" id="5276632">s</span><span class="op" id="5276633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5276636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5276639">if</span>&nbsp;<span class="ident" id="5276642">m</span><span class="op" id="5276643">.</span><span class="ident" id="5276644">op</span>&nbsp;<span class="op" id="5276647">!=</span>&nbsp;<span class="ident" id="5276650">notOnePass</span>&nbsp;<span class="op" id="5276661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5276665">if</span>&nbsp;<span class="op" id="5276668">!</span><span class="ident" id="5276669">m</span><span class="op" id="5276670">.</span><span class="ident" id="5276671">onepass</span><span class="op" id="5276678">(</span><span class="ident" id="5276679">i</span><span class="op" id="5276680">,</span>&nbsp;<span class="ident" id="5276682">pos</span><span class="op" id="5276685">)</span>&nbsp;<span class="op" id="5276687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276692">re</span><span class="op" id="5276694">.</span><span class="ident" id="5276695">put</span><span class="op" id="5276698">(</span><span class="ident" id="5276699">m</span><span class="op" id="5276700">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5276705">return</span>&nbsp;<span class="builtintype" id="5276712">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5276718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5276721">}</span>&nbsp;<span class="keyword" id="5276723">else</span>&nbsp;<span class="op" id="5276728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276732">m</span><span class="op" id="5276733">.</span><span class="ident" id="5276734">init</span><span class="op" id="5276738">(</span><span class="ident" id="5276739">ncap</span><span class="op" id="5276743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5276747">if</span>&nbsp;<span class="op" id="5276750">!</span><span class="ident" id="5276751">m</span><span class="op" id="5276752">.</span><span class="ident" id="5276753">match</span><span class="op" id="5276758">(</span><span class="ident" id="5276759">i</span><span class="op" id="5276760">,</span>&nbsp;<span class="ident" id="5276762">pos</span><span class="op" id="5276765">)</span>&nbsp;<span class="op" id="5276767">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276772">re</span><span class="op" id="5276774">.</span><span class="ident" id="5276775">put</span><span class="op" id="5276778">(</span><span class="ident" id="5276779">m</span><span class="op" id="5276780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5276785">return</span>&nbsp;<span class="builtintype" id="5276792">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5276798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5276801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5276804">if</span>&nbsp;<span class="ident" id="5276807">ncap</span>&nbsp;<span class="op" id="5276812">==</span>&nbsp;<span class="num" id="5276815">0</span>&nbsp;<span class="op" id="5276817">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276821">re</span><span class="op" id="5276823">.</span><span class="ident" id="5276824">put</span><span class="op" id="5276827">(</span><span class="ident" id="5276828">m</span><span class="op" id="5276829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5276833">return</span>&nbsp;<span class="ident" id="5276840">empty</span>&nbsp;<span class="comment" id="5276846">//&nbsp;empty&nbsp;but&nbsp;not&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5276868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5276871">cap</span>&nbsp;<span class="op" id="5276875">:=</span>&nbsp;<span class="builtinfunc" id="5276878">make</span><span class="op" id="5276882">(</span><span class="op" id="5276883">[</span><span class="op" id="5276884">]</span><span class="builtintype" id="5276885">int</span><span class="op" id="5276888">,</span>&nbsp;<span class="builtinfunc" id="5276890">len</span><span class="op" id="5276893">(</span><span class="ident" id="5276894">m</span><span class="op" id="5276895">.</span><span class="ident" id="5276896">matchcap</span><span class="op" id="5276904">)</span><span class="op" id="5276905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5276908">copy</span><span class="op" id="5276912">(</span><span class="builtinfunc" id="5276913">cap</span><span class="op" id="5276916">,</span>&nbsp;<span class="ident" id="5276918">m</span><span class="op" id="5276919">.</span><span class="ident" id="5276920">matchcap</span><span class="op" id="5276928">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5276931">re</span><span class="op" id="5276933">.</span><span class="ident" id="5276934">put</span><span class="op" id="5276937">(</span><span class="ident" id="5276938">m</span><span class="op" id="5276939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5276942">return</span>&nbsp;<span class="builtinfunc" id="5276949">cap</span><br>
<span class="lineno"></span><span class="op" id="5276953">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
