<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4631011">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4631066">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4631120">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4631171">package</span>&nbsp;<span class="ident" id="4631179">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4631186">import</span>&nbsp;<span class="op" id="4631193">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4631196">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4631204">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4631211">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4631214">type</span>&nbsp;<span class="ident" id="4631219">huffmanEncoder</span>&nbsp;<span class="keyword" id="4631234">struct</span>&nbsp;<span class="op" id="4631241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631244">codeBits</span>&nbsp;<span class="op" id="4631253">[</span><span class="op" id="4631254">]</span><span class="builtintype" id="4631255">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631262">code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4631271">[</span><span class="op" id="4631272">]</span><span class="builtintype" id="4631273">uint16</span><br>
<span class="lineno">15</span><span class="op" id="4631280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4631283">type</span>&nbsp;<span class="ident" id="4631288">literalNode</span>&nbsp;<span class="keyword" id="4631300">struct</span>&nbsp;<span class="op" id="4631307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631310">literal</span>&nbsp;<span class="builtintype" id="4631318">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631326">freq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4631334">int32</span><br>
<span class="lineno">20</span><span class="op" id="4631340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4631343">//&nbsp;A&nbsp;levelInfo&nbsp;describes&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;constructed&nbsp;tree&nbsp;for&nbsp;a&nbsp;given&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="4631421">type</span>&nbsp;<span class="ident" id="4631426">levelInfo</span>&nbsp;<span class="keyword" id="4631436">struct</span>&nbsp;<span class="op" id="4631443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4631446">//&nbsp;Our&nbsp;level.&nbsp;&nbsp;for&nbsp;better&nbsp;printing</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631482">level</span>&nbsp;<span class="builtintype" id="4631488">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4631496">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;last&nbsp;node&nbsp;at&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631545">lastFreq</span>&nbsp;<span class="builtintype" id="4631554">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4631562">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;character&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631623">nextCharFreq</span>&nbsp;<span class="builtintype" id="4631636">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4631644">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;pair&nbsp;(from&nbsp;level&nbsp;below)&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4631720">//&nbsp;Only&nbsp;valid&nbsp;if&nbsp;the&nbsp;&#34;needed&#34;&nbsp;value&nbsp;of&nbsp;the&nbsp;next&nbsp;lower&nbsp;level&nbsp;is&nbsp;0.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631787">nextPairFreq</span>&nbsp;<span class="builtintype" id="4631800">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4631808">//&nbsp;The&nbsp;number&nbsp;of&nbsp;chains&nbsp;remaining&nbsp;to&nbsp;generate&nbsp;for&nbsp;this&nbsp;level&nbsp;before&nbsp;moving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4631884">//&nbsp;up&nbsp;to&nbsp;the&nbsp;next&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631909">needed</span>&nbsp;<span class="builtintype" id="4631916">int32</span><br>
<span class="lineno">40</span><span class="op" id="4631922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4631925">func</span>&nbsp;<span class="ident" id="4631930">maxNode</span><span class="op" id="4631937">(</span><span class="op" id="4631938">)</span>&nbsp;<span class="ident" id="4631940">literalNode</span>&nbsp;<span class="op" id="4631952">{</span>&nbsp;<span class="keyword" id="4631954">return</span>&nbsp;<span class="ident" id="4631961">literalNode</span><span class="op" id="4631972">{</span><span class="ident" id="4631973">math</span><span class="op" id="4631977">.</span><span class="ident" id="4631978">MaxUint16</span><span class="op" id="4631987">,</span>&nbsp;<span class="ident" id="4631989">math</span><span class="op" id="4631993">.</span><span class="ident" id="4631994">MaxInt32</span><span class="op" id="4632002">}</span>&nbsp;<span class="op" id="4632004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4632007">func</span>&nbsp;<span class="ident" id="4632012">newHuffmanEncoder</span><span class="op" id="4632029">(</span><span class="ident" id="4632030">size</span>&nbsp;<span class="builtintype" id="4632035">int</span><span class="op" id="4632038">)</span>&nbsp;<span class="op" id="4632040">*</span><span class="ident" id="4632041">huffmanEncoder</span>&nbsp;<span class="op" id="4632056">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632059">return</span>&nbsp;<span class="op" id="4632066">&amp;</span><span class="ident" id="4632067">huffmanEncoder</span><span class="op" id="4632081">{</span><span class="builtinfunc" id="4632082">make</span><span class="op" id="4632086">(</span><span class="op" id="4632087">[</span><span class="op" id="4632088">]</span><span class="builtintype" id="4632089">uint8</span><span class="op" id="4632094">,</span>&nbsp;<span class="ident" id="4632096">size</span><span class="op" id="4632100">)</span><span class="op" id="4632101">,</span>&nbsp;<span class="builtinfunc" id="4632103">make</span><span class="op" id="4632107">(</span><span class="op" id="4632108">[</span><span class="op" id="4632109">]</span><span class="builtintype" id="4632110">uint16</span><span class="op" id="4632116">,</span>&nbsp;<span class="ident" id="4632118">size</span><span class="op" id="4632122">)</span><span class="op" id="4632123">}</span><br>
<span class="lineno"></span><span class="op" id="4632125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4632128">//&nbsp;Generates&nbsp;a&nbsp;HuffmanCode&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;fixed&nbsp;literal&nbsp;table</span><br>
<span class="lineno"></span><span class="keyword" id="4632196">func</span>&nbsp;<span class="ident" id="4632201">generateFixedLiteralEncoding</span><span class="op" id="4632229">(</span><span class="op" id="4632230">)</span>&nbsp;<span class="op" id="4632232">*</span><span class="ident" id="4632233">huffmanEncoder</span>&nbsp;<span class="op" id="4632248">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632251">h</span>&nbsp;<span class="op" id="4632253">:=</span>&nbsp;<span class="ident" id="4632256">newHuffmanEncoder</span><span class="op" id="4632273">(</span><span class="ident" id="4632274">maxLit</span><span class="op" id="4632280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632283">codeBits</span>&nbsp;<span class="op" id="4632292">:=</span>&nbsp;<span class="ident" id="4632295">h</span><span class="op" id="4632296">.</span><span class="ident" id="4632297">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632307">code</span>&nbsp;<span class="op" id="4632312">:=</span>&nbsp;<span class="ident" id="4632315">h</span><span class="op" id="4632316">.</span><span class="ident" id="4632317">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632323">var</span>&nbsp;<span class="ident" id="4632327">ch</span>&nbsp;<span class="builtintype" id="4632330">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632338">for</span>&nbsp;<span class="ident" id="4632342">ch</span>&nbsp;<span class="op" id="4632345">=</span>&nbsp;<span class="num" id="4632347">0</span><span class="op" id="4632348">;</span>&nbsp;<span class="ident" id="4632350">ch</span>&nbsp;<span class="op" id="4632353">&lt;</span>&nbsp;<span class="ident" id="4632355">maxLit</span><span class="op" id="4632361">;</span>&nbsp;<span class="ident" id="4632363">ch</span><span class="op" id="4632365">++</span>&nbsp;<span class="op" id="4632368">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632372">var</span>&nbsp;<span class="ident" id="4632376">bits</span>&nbsp;<span class="builtintype" id="4632381">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632390">var</span>&nbsp;<span class="ident" id="4632394">size</span>&nbsp;<span class="builtintype" id="4632399">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632407">switch</span>&nbsp;<span class="op" id="4632414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632418">case</span>&nbsp;<span class="ident" id="4632423">ch</span>&nbsp;<span class="op" id="4632426">&lt;</span>&nbsp;<span class="num" id="4632428">144</span><span class="op" id="4632431">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632436">//&nbsp;size&nbsp;8,&nbsp;000110000&nbsp;&nbsp;..&nbsp;10111111</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632473">bits</span>&nbsp;<span class="op" id="4632478">=</span>&nbsp;<span class="ident" id="4632480">ch</span>&nbsp;<span class="op" id="4632483">+</span>&nbsp;<span class="num" id="4632485">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632491">size</span>&nbsp;<span class="op" id="4632496">=</span>&nbsp;<span class="num" id="4632498">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632503">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632511">case</span>&nbsp;<span class="ident" id="4632516">ch</span>&nbsp;<span class="op" id="4632519">&lt;</span>&nbsp;<span class="num" id="4632521">256</span><span class="op" id="4632524">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632529">//&nbsp;size&nbsp;9,&nbsp;110010000&nbsp;..&nbsp;111111111</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632566">bits</span>&nbsp;<span class="op" id="4632571">=</span>&nbsp;<span class="ident" id="4632573">ch</span>&nbsp;<span class="op" id="4632576">+</span>&nbsp;<span class="num" id="4632578">400</span>&nbsp;<span class="op" id="4632582">-</span>&nbsp;<span class="num" id="4632584">144</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632591">size</span>&nbsp;<span class="op" id="4632596">=</span>&nbsp;<span class="num" id="4632598">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632603">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632611">case</span>&nbsp;<span class="ident" id="4632616">ch</span>&nbsp;<span class="op" id="4632619">&lt;</span>&nbsp;<span class="num" id="4632621">280</span><span class="op" id="4632624">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632629">//&nbsp;size&nbsp;7,&nbsp;0000000&nbsp;..&nbsp;0010111</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632662">bits</span>&nbsp;<span class="op" id="4632667">=</span>&nbsp;<span class="ident" id="4632669">ch</span>&nbsp;<span class="op" id="4632672">-</span>&nbsp;<span class="num" id="4632674">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632681">size</span>&nbsp;<span class="op" id="4632686">=</span>&nbsp;<span class="num" id="4632688">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632693">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632701">default</span><span class="op" id="4632708">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632713">//&nbsp;size&nbsp;8,&nbsp;11000000&nbsp;..&nbsp;11000111</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632748">bits</span>&nbsp;<span class="op" id="4632753">=</span>&nbsp;<span class="ident" id="4632755">ch</span>&nbsp;<span class="op" id="4632758">+</span>&nbsp;<span class="num" id="4632760">192</span>&nbsp;<span class="op" id="4632764">-</span>&nbsp;<span class="num" id="4632766">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632773">size</span>&nbsp;<span class="op" id="4632778">=</span>&nbsp;<span class="num" id="4632780">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4632784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632788">codeBits</span><span class="op" id="4632796">[</span><span class="ident" id="4632797">ch</span><span class="op" id="4632799">]</span>&nbsp;<span class="op" id="4632801">=</span>&nbsp;<span class="ident" id="4632803">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632810">code</span><span class="op" id="4632814">[</span><span class="ident" id="4632815">ch</span><span class="op" id="4632817">]</span>&nbsp;<span class="op" id="4632819">=</span>&nbsp;<span class="ident" id="4632821">reverseBits</span><span class="op" id="4632832">(</span><span class="ident" id="4632833">bits</span><span class="op" id="4632837">,</span>&nbsp;<span class="ident" id="4632839">size</span><span class="op" id="4632843">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4632846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632849">return</span>&nbsp;<span class="ident" id="4632856">h</span><br>
<span class="lineno"></span><span class="op" id="4632858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4632861">func</span>&nbsp;<span class="ident" id="4632866">generateFixedOffsetEncoding</span><span class="op" id="4632893">(</span><span class="op" id="4632894">)</span>&nbsp;<span class="op" id="4632896">*</span><span class="ident" id="4632897">huffmanEncoder</span>&nbsp;<span class="op" id="4632912">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632915">h</span>&nbsp;<span class="op" id="4632917">:=</span>&nbsp;<span class="ident" id="4632920">newHuffmanEncoder</span><span class="op" id="4632937">(</span><span class="num" id="4632938">30</span><span class="op" id="4632940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632943">codeBits</span>&nbsp;<span class="op" id="4632952">:=</span>&nbsp;<span class="ident" id="4632955">h</span><span class="op" id="4632956">.</span><span class="ident" id="4632957">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632967">code</span>&nbsp;<span class="op" id="4632972">:=</span>&nbsp;<span class="ident" id="4632975">h</span><span class="op" id="4632976">.</span><span class="ident" id="4632977">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632983">for</span>&nbsp;<span class="ident" id="4632987">ch</span>&nbsp;<span class="op" id="4632990">:=</span>&nbsp;<span class="builtintype" id="4632993">uint16</span><span class="op" id="4632999">(</span><span class="num" id="4633000">0</span><span class="op" id="4633001">)</span><span class="op" id="4633002">;</span>&nbsp;<span class="ident" id="4633004">ch</span>&nbsp;<span class="op" id="4633007">&lt;</span>&nbsp;<span class="num" id="4633009">30</span><span class="op" id="4633011">;</span>&nbsp;<span class="ident" id="4633013">ch</span><span class="op" id="4633015">++</span>&nbsp;<span class="op" id="4633018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633022">codeBits</span><span class="op" id="4633030">[</span><span class="ident" id="4633031">ch</span><span class="op" id="4633033">]</span>&nbsp;<span class="op" id="4633035">=</span>&nbsp;<span class="num" id="4633037">5</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633041">code</span><span class="op" id="4633045">[</span><span class="ident" id="4633046">ch</span><span class="op" id="4633048">]</span>&nbsp;<span class="op" id="4633050">=</span>&nbsp;<span class="ident" id="4633052">reverseBits</span><span class="op" id="4633063">(</span><span class="ident" id="4633064">ch</span><span class="op" id="4633066">,</span>&nbsp;<span class="num" id="4633068">5</span><span class="op" id="4633069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633075">return</span>&nbsp;<span class="ident" id="4633082">h</span><br>
<span class="lineno"></span><span class="op" id="4633084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4633087">var</span>&nbsp;<span class="ident" id="4633091">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4633112">*</span><span class="ident" id="4633113">huffmanEncoder</span>&nbsp;<span class="op" id="4633128">=</span>&nbsp;<span class="ident" id="4633130">generateFixedLiteralEncoding</span><span class="op" id="4633158">(</span><span class="op" id="4633159">)</span><br>
<span class="lineno"></span><span class="keyword" id="4633161">var</span>&nbsp;<span class="ident" id="4633165">fixedOffsetEncoding</span>&nbsp;<span class="op" id="4633185">*</span><span class="ident" id="4633186">huffmanEncoder</span>&nbsp;<span class="op" id="4633201">=</span>&nbsp;<span class="ident" id="4633203">generateFixedOffsetEncoding</span><span class="op" id="4633230">(</span><span class="op" id="4633231">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4633234">func</span>&nbsp;<span class="op" id="4633239">(</span><span class="ident" id="4633240">h</span>&nbsp;<span class="op" id="4633242">*</span><span class="ident" id="4633243">huffmanEncoder</span><span class="op" id="4633257">)</span>&nbsp;<span class="ident" id="4633259">bitLength</span><span class="op" id="4633268">(</span><span class="ident" id="4633269">freq</span>&nbsp;<span class="op" id="4633274">[</span><span class="op" id="4633275">]</span><span class="builtintype" id="4633276">int32</span><span class="op" id="4633281">)</span>&nbsp;<span class="ident" id="4633283">int64</span>&nbsp;<span class="op" id="4633289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633292">var</span>&nbsp;<span class="ident" id="4633296">total</span>&nbsp;<span class="ident" id="4633302">int64</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633309">for</span>&nbsp;<span class="ident" id="4633313">i</span><span class="op" id="4633314">,</span>&nbsp;<span class="ident" id="4633316">f</span>&nbsp;<span class="op" id="4633318">:=</span>&nbsp;<span class="keyword" id="4633321">range</span>&nbsp;<span class="ident" id="4633327">freq</span>&nbsp;<span class="op" id="4633332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633336">if</span>&nbsp;<span class="ident" id="4633339">f</span>&nbsp;<span class="op" id="4633341">!=</span>&nbsp;<span class="num" id="4633344">0</span>&nbsp;<span class="op" id="4633346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633351">total</span>&nbsp;<span class="op" id="4633357">+=</span>&nbsp;<span class="ident" id="4633360">int64</span><span class="op" id="4633365">(</span><span class="ident" id="4633366">f</span><span class="op" id="4633367">)</span>&nbsp;<span class="op" id="4633369">*</span>&nbsp;<span class="ident" id="4633371">int64</span><span class="op" id="4633376">(</span><span class="ident" id="4633377">h</span><span class="op" id="4633378">.</span><span class="ident" id="4633379">codeBits</span><span class="op" id="4633387">[</span><span class="ident" id="4633388">i</span><span class="op" id="4633389">]</span><span class="op" id="4633390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633397">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633400">return</span>&nbsp;<span class="ident" id="4633407">total</span><br>
<span class="lineno"></span><span class="op" id="4633413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4633416">const</span>&nbsp;<span class="ident" id="4633422">maxBitsLimit</span>&nbsp;<span class="op" id="4633435">=</span>&nbsp;<span class="num" id="4633437">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="4633441">//&nbsp;Return&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;assigned&nbsp;to&nbsp;each&nbsp;bit&nbsp;size&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="4633524">//</span><br>
<span class="lineno"></span><span class="comment" id="4633527">//&nbsp;This&nbsp;method&nbsp;is&nbsp;only&nbsp;called&nbsp;when&nbsp;list.length&nbsp;&gt;=&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="4633579">//&nbsp;The&nbsp;cases&nbsp;of&nbsp;0,&nbsp;1,&nbsp;and&nbsp;2&nbsp;literals&nbsp;are&nbsp;handled&nbsp;by&nbsp;special&nbsp;case&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4633650">//</span><br>
<span class="lineno">115</span><span class="comment" id="4633653">//&nbsp;list&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;the&nbsp;literals&nbsp;with&nbsp;non-zero&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4633713">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;their&nbsp;associated&nbsp;frequencies.&nbsp;&nbsp;The&nbsp;array&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing</span><br>
<span class="lineno"></span><span class="comment" id="4633799">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frequency,&nbsp;and&nbsp;has&nbsp;as&nbsp;its&nbsp;last&nbsp;element&nbsp;a&nbsp;special&nbsp;element&nbsp;with&nbsp;frequency</span><br>
<span class="lineno"></span><span class="comment" id="4633886">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MaxInt32</span><br>
<span class="lineno"></span><span class="comment" id="4633910">//&nbsp;maxBits&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;that&nbsp;should&nbsp;be&nbsp;used&nbsp;to&nbsp;encode&nbsp;any&nbsp;literal.</span><br>
<span class="lineno">120</span><span class="comment" id="4633995">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Must&nbsp;be&nbsp;less&nbsp;than&nbsp;16.</span><br>
<span class="lineno"></span><span class="comment" id="4634032">//&nbsp;return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An&nbsp;integer&nbsp;array&nbsp;in&nbsp;which&nbsp;array[i]&nbsp;indicates&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span><span class="comment" id="4634115">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;should&nbsp;be&nbsp;encoded&nbsp;in&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4634164">func</span>&nbsp;<span class="op" id="4634169">(</span><span class="ident" id="4634170">h</span>&nbsp;<span class="op" id="4634172">*</span><span class="ident" id="4634173">huffmanEncoder</span><span class="op" id="4634187">)</span>&nbsp;<span class="ident" id="4634189">bitCounts</span><span class="op" id="4634198">(</span><span class="ident" id="4634199">list</span>&nbsp;<span class="op" id="4634204">[</span><span class="op" id="4634205">]</span><span class="ident" id="4634206">literalNode</span><span class="op" id="4634217">,</span>&nbsp;<span class="ident" id="4634219">maxBits</span>&nbsp;<span class="builtintype" id="4634227">int32</span><span class="op" id="4634232">)</span>&nbsp;<span class="op" id="4634234">[</span><span class="op" id="4634235">]</span><span class="builtintype" id="4634236">int32</span>&nbsp;<span class="op" id="4634242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634245">if</span>&nbsp;<span class="ident" id="4634248">maxBits</span>&nbsp;<span class="op" id="4634256">&gt;=</span>&nbsp;<span class="ident" id="4634259">maxBitsLimit</span>&nbsp;<span class="op" id="4634272">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4634276">panic</span><span class="op" id="4634281">(</span><span class="string" id="4634282">&#34;flate:&nbsp;maxBits&nbsp;too&nbsp;large&#34;</span><span class="op" id="4634308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634314">n</span>&nbsp;<span class="op" id="4634316">:=</span>&nbsp;<span class="builtintype" id="4634319">int32</span><span class="op" id="4634324">(</span><span class="builtinfunc" id="4634325">len</span><span class="op" id="4634328">(</span><span class="ident" id="4634329">list</span><span class="op" id="4634333">)</span><span class="op" id="4634334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634337">list</span>&nbsp;<span class="op" id="4634342">=</span>&nbsp;<span class="ident" id="4634344">list</span><span class="op" id="4634348">[</span><span class="num" id="4634349">0</span>&nbsp;<span class="op" id="4634351">:</span>&nbsp;<span class="ident" id="4634353">n</span><span class="op" id="4634354">+</span><span class="num" id="4634355">1</span><span class="op" id="4634356">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634359">list</span><span class="op" id="4634363">[</span><span class="ident" id="4634364">n</span><span class="op" id="4634365">]</span>&nbsp;<span class="op" id="4634367">=</span>&nbsp;<span class="ident" id="4634369">maxNode</span><span class="op" id="4634376">(</span><span class="op" id="4634377">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4634381">//&nbsp;The&nbsp;tree&nbsp;can&#39;t&nbsp;have&nbsp;greater&nbsp;depth&nbsp;than&nbsp;n&nbsp;-&nbsp;1,&nbsp;no&nbsp;matter&nbsp;what.&nbsp;&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4634453">//&nbsp;saves&nbsp;a&nbsp;little&nbsp;bit&nbsp;of&nbsp;work&nbsp;in&nbsp;some&nbsp;small&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634504">if</span>&nbsp;<span class="ident" id="4634507">maxBits</span>&nbsp;<span class="op" id="4634515">&gt;</span>&nbsp;<span class="ident" id="4634517">n</span><span class="op" id="4634518">-</span><span class="num" id="4634519">1</span>&nbsp;<span class="op" id="4634521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634525">maxBits</span>&nbsp;<span class="op" id="4634533">=</span>&nbsp;<span class="ident" id="4634535">n</span>&nbsp;<span class="op" id="4634537">-</span>&nbsp;<span class="num" id="4634539">1</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4634546">//&nbsp;Create&nbsp;information&nbsp;about&nbsp;each&nbsp;of&nbsp;the&nbsp;levels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4634595">//&nbsp;A&nbsp;bogus&nbsp;&#34;Level&nbsp;0&#34;&nbsp;whose&nbsp;sole&nbsp;purpose&nbsp;is&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4634647">//&nbsp;level1.prev.needed==0.&nbsp;&nbsp;This&nbsp;makes&nbsp;level1.nextPairFreq</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4634706">//&nbsp;be&nbsp;a&nbsp;legitimate&nbsp;value&nbsp;that&nbsp;never&nbsp;gets&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634756">var</span>&nbsp;<span class="ident" id="4634760">levels</span>&nbsp;<span class="op" id="4634767">[</span><span class="ident" id="4634768">maxBitsLimit</span><span class="op" id="4634780">]</span><span class="ident" id="4634781">levelInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4634792">//&nbsp;leafCounts[i]&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4634852">//&nbsp;of&nbsp;ancestors&nbsp;of&nbsp;the&nbsp;rightmost&nbsp;node&nbsp;at&nbsp;level&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4634903">//&nbsp;leafCounts[i][j]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4634962">//&nbsp;of&nbsp;the&nbsp;level&nbsp;j&nbsp;ancestor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634991">var</span>&nbsp;<span class="ident" id="4634995">leafCounts</span>&nbsp;<span class="op" id="4635006">[</span><span class="ident" id="4635007">maxBitsLimit</span><span class="op" id="4635019">]</span><span class="op" id="4635020">[</span><span class="ident" id="4635021">maxBitsLimit</span><span class="op" id="4635033">]</span><span class="builtintype" id="4635034">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635042">for</span>&nbsp;<span class="ident" id="4635046">level</span>&nbsp;<span class="op" id="4635052">:=</span>&nbsp;<span class="builtintype" id="4635055">int32</span><span class="op" id="4635060">(</span><span class="num" id="4635061">1</span><span class="op" id="4635062">)</span><span class="op" id="4635063">;</span>&nbsp;<span class="ident" id="4635065">level</span>&nbsp;<span class="op" id="4635071">&lt;=</span>&nbsp;<span class="ident" id="4635074">maxBits</span><span class="op" id="4635081">;</span>&nbsp;<span class="ident" id="4635083">level</span><span class="op" id="4635088">++</span>&nbsp;<span class="op" id="4635091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635095">//&nbsp;For&nbsp;every&nbsp;level,&nbsp;the&nbsp;first&nbsp;two&nbsp;items&nbsp;are&nbsp;the&nbsp;first&nbsp;two&nbsp;characters.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635167">//&nbsp;We&nbsp;initialize&nbsp;the&nbsp;levels&nbsp;as&nbsp;if&nbsp;we&nbsp;had&nbsp;already&nbsp;figured&nbsp;this&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635236">levels</span><span class="op" id="4635242">[</span><span class="ident" id="4635243">level</span><span class="op" id="4635248">]</span>&nbsp;<span class="op" id="4635250">=</span>&nbsp;<span class="ident" id="4635252">levelInfo</span><span class="op" id="4635261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635266">level</span><span class="op" id="4635271">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635280">level</span><span class="op" id="4635285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635290">lastFreq</span><span class="op" id="4635298">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4635304">list</span><span class="op" id="4635308">[</span><span class="num" id="4635309">1</span><span class="op" id="4635310">]</span><span class="op" id="4635311">.</span><span class="ident" id="4635312">freq</span><span class="op" id="4635316">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635321">nextCharFreq</span><span class="op" id="4635333">:</span>&nbsp;<span class="ident" id="4635335">list</span><span class="op" id="4635339">[</span><span class="num" id="4635340">2</span><span class="op" id="4635341">]</span><span class="op" id="4635342">.</span><span class="ident" id="4635343">freq</span><span class="op" id="4635347">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635352">nextPairFreq</span><span class="op" id="4635364">:</span>&nbsp;<span class="ident" id="4635366">list</span><span class="op" id="4635370">[</span><span class="num" id="4635371">0</span><span class="op" id="4635372">]</span><span class="op" id="4635373">.</span><span class="ident" id="4635374">freq</span>&nbsp;<span class="op" id="4635379">+</span>&nbsp;<span class="ident" id="4635381">list</span><span class="op" id="4635385">[</span><span class="num" id="4635386">1</span><span class="op" id="4635387">]</span><span class="op" id="4635388">.</span><span class="ident" id="4635389">freq</span><span class="op" id="4635393">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4635397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635401">leafCounts</span><span class="op" id="4635411">[</span><span class="ident" id="4635412">level</span><span class="op" id="4635417">]</span><span class="op" id="4635418">[</span><span class="ident" id="4635419">level</span><span class="op" id="4635424">]</span>&nbsp;<span class="op" id="4635426">=</span>&nbsp;<span class="num" id="4635428">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635432">if</span>&nbsp;<span class="ident" id="4635435">level</span>&nbsp;<span class="op" id="4635441">==</span>&nbsp;<span class="num" id="4635444">1</span>&nbsp;<span class="op" id="4635446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635451">levels</span><span class="op" id="4635457">[</span><span class="ident" id="4635458">level</span><span class="op" id="4635463">]</span><span class="op" id="4635464">.</span><span class="ident" id="4635465">nextPairFreq</span>&nbsp;<span class="op" id="4635478">=</span>&nbsp;<span class="ident" id="4635480">math</span><span class="op" id="4635484">.</span><span class="ident" id="4635485">MaxInt32</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4635496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4635499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635503">//&nbsp;We&nbsp;need&nbsp;a&nbsp;total&nbsp;of&nbsp;2*n&nbsp;-&nbsp;2&nbsp;items&nbsp;at&nbsp;top&nbsp;level&nbsp;and&nbsp;have&nbsp;already&nbsp;generated&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635583">levels</span><span class="op" id="4635589">[</span><span class="ident" id="4635590">maxBits</span><span class="op" id="4635597">]</span><span class="op" id="4635598">.</span><span class="ident" id="4635599">needed</span>&nbsp;<span class="op" id="4635606">=</span>&nbsp;<span class="num" id="4635608">2</span><span class="op" id="4635609">*</span><span class="ident" id="4635610">n</span>&nbsp;<span class="op" id="4635612">-</span>&nbsp;<span class="num" id="4635614">4</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635618">level</span>&nbsp;<span class="op" id="4635624">:=</span>&nbsp;<span class="ident" id="4635627">maxBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635636">for</span>&nbsp;<span class="op" id="4635640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635644">l</span>&nbsp;<span class="op" id="4635646">:=</span>&nbsp;<span class="op" id="4635649">&amp;</span><span class="ident" id="4635650">levels</span><span class="op" id="4635656">[</span><span class="ident" id="4635657">level</span><span class="op" id="4635662">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635666">if</span>&nbsp;<span class="ident" id="4635669">l</span><span class="op" id="4635670">.</span><span class="ident" id="4635671">nextPairFreq</span>&nbsp;<span class="op" id="4635684">==</span>&nbsp;<span class="ident" id="4635687">math</span><span class="op" id="4635691">.</span><span class="ident" id="4635692">MaxInt32</span>&nbsp;<span class="op" id="4635701">&amp;&amp;</span>&nbsp;<span class="ident" id="4635704">l</span><span class="op" id="4635705">.</span><span class="ident" id="4635706">nextCharFreq</span>&nbsp;<span class="op" id="4635719">==</span>&nbsp;<span class="ident" id="4635722">math</span><span class="op" id="4635726">.</span><span class="ident" id="4635727">MaxInt32</span>&nbsp;<span class="op" id="4635736">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635741">//&nbsp;We&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;both&nbsp;leafs&nbsp;and&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635786">//&nbsp;End&nbsp;all&nbsp;calculations&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635829">//&nbsp;To&nbsp;make&nbsp;sure&nbsp;we&nbsp;never&nbsp;come&nbsp;back&nbsp;to&nbsp;this&nbsp;level&nbsp;or&nbsp;any&nbsp;lower&nbsp;level,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635901">//&nbsp;set&nbsp;nextPairFreq&nbsp;impossibly&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635942">l</span><span class="op" id="4635943">.</span><span class="ident" id="4635944">needed</span>&nbsp;<span class="op" id="4635951">=</span>&nbsp;<span class="num" id="4635953">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635958">levels</span><span class="op" id="4635964">[</span><span class="ident" id="4635965">level</span><span class="op" id="4635970">+</span><span class="num" id="4635971">1</span><span class="op" id="4635972">]</span><span class="op" id="4635973">.</span><span class="ident" id="4635974">nextPairFreq</span>&nbsp;<span class="op" id="4635987">=</span>&nbsp;<span class="ident" id="4635989">math</span><span class="op" id="4635993">.</span><span class="ident" id="4635994">MaxInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636006">level</span><span class="op" id="4636011">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636017">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4636028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636033">prevFreq</span>&nbsp;<span class="op" id="4636042">:=</span>&nbsp;<span class="ident" id="4636045">l</span><span class="op" id="4636046">.</span><span class="ident" id="4636047">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636058">if</span>&nbsp;<span class="ident" id="4636061">l</span><span class="op" id="4636062">.</span><span class="ident" id="4636063">nextCharFreq</span>&nbsp;<span class="op" id="4636076">&lt;</span>&nbsp;<span class="ident" id="4636078">l</span><span class="op" id="4636079">.</span><span class="ident" id="4636080">nextPairFreq</span>&nbsp;<span class="op" id="4636093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636098">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;leaf&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636146">n</span>&nbsp;<span class="op" id="4636148">:=</span>&nbsp;<span class="ident" id="4636151">leafCounts</span><span class="op" id="4636161">[</span><span class="ident" id="4636162">level</span><span class="op" id="4636167">]</span><span class="op" id="4636168">[</span><span class="ident" id="4636169">level</span><span class="op" id="4636174">]</span>&nbsp;<span class="op" id="4636176">+</span>&nbsp;<span class="num" id="4636178">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636183">l</span><span class="op" id="4636184">.</span><span class="ident" id="4636185">lastFreq</span>&nbsp;<span class="op" id="4636194">=</span>&nbsp;<span class="ident" id="4636196">l</span><span class="op" id="4636197">.</span><span class="ident" id="4636198">nextCharFreq</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636214">//&nbsp;Lower&nbsp;leafCounts&nbsp;are&nbsp;the&nbsp;same&nbsp;of&nbsp;the&nbsp;previous&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636272">leafCounts</span><span class="op" id="4636282">[</span><span class="ident" id="4636283">level</span><span class="op" id="4636288">]</span><span class="op" id="4636289">[</span><span class="ident" id="4636290">level</span><span class="op" id="4636295">]</span>&nbsp;<span class="op" id="4636297">=</span>&nbsp;<span class="ident" id="4636299">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636304">l</span><span class="op" id="4636305">.</span><span class="ident" id="4636306">nextCharFreq</span>&nbsp;<span class="op" id="4636319">=</span>&nbsp;<span class="ident" id="4636321">list</span><span class="op" id="4636325">[</span><span class="ident" id="4636326">n</span><span class="op" id="4636327">]</span><span class="op" id="4636328">.</span><span class="ident" id="4636329">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4636336">}</span>&nbsp;<span class="keyword" id="4636338">else</span>&nbsp;<span class="op" id="4636343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636348">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;pair&nbsp;from&nbsp;the&nbsp;previous&nbsp;row.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636413">//&nbsp;nextPairFreq&nbsp;isn&#39;t&nbsp;valid&nbsp;until&nbsp;we&nbsp;generate&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636466">//&nbsp;more&nbsp;values&nbsp;in&nbsp;the&nbsp;level&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636503">l</span><span class="op" id="4636504">.</span><span class="ident" id="4636505">lastFreq</span>&nbsp;<span class="op" id="4636514">=</span>&nbsp;<span class="ident" id="4636516">l</span><span class="op" id="4636517">.</span><span class="ident" id="4636518">nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636534">//&nbsp;Take&nbsp;leaf&nbsp;counts&nbsp;from&nbsp;the&nbsp;lower&nbsp;level,&nbsp;except&nbsp;counts[level]&nbsp;remains&nbsp;the&nbsp;same.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4636618">copy</span><span class="op" id="4636622">(</span><span class="ident" id="4636623">leafCounts</span><span class="op" id="4636633">[</span><span class="ident" id="4636634">level</span><span class="op" id="4636639">]</span><span class="op" id="4636640">[</span><span class="op" id="4636641">:</span><span class="ident" id="4636642">level</span><span class="op" id="4636647">]</span><span class="op" id="4636648">,</span>&nbsp;<span class="ident" id="4636650">leafCounts</span><span class="op" id="4636660">[</span><span class="ident" id="4636661">level</span><span class="op" id="4636666">-</span><span class="num" id="4636667">1</span><span class="op" id="4636668">]</span><span class="op" id="4636669">[</span><span class="op" id="4636670">:</span><span class="ident" id="4636671">level</span><span class="op" id="4636676">]</span><span class="op" id="4636677">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636682">levels</span><span class="op" id="4636688">[</span><span class="ident" id="4636689">l</span><span class="op" id="4636690">.</span><span class="ident" id="4636691">level</span><span class="op" id="4636696">-</span><span class="num" id="4636697">1</span><span class="op" id="4636698">]</span><span class="op" id="4636699">.</span><span class="ident" id="4636700">needed</span>&nbsp;<span class="op" id="4636707">=</span>&nbsp;<span class="num" id="4636709">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4636713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636718">if</span>&nbsp;<span class="ident" id="4636721">l</span><span class="op" id="4636722">.</span><span class="ident" id="4636723">needed</span><span class="op" id="4636729">--</span><span class="op" id="4636731">;</span>&nbsp;<span class="ident" id="4636733">l</span><span class="op" id="4636734">.</span><span class="ident" id="4636735">needed</span>&nbsp;<span class="op" id="4636742">==</span>&nbsp;<span class="num" id="4636745">0</span>&nbsp;<span class="op" id="4636747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636752">//&nbsp;We&#39;ve&nbsp;done&nbsp;everything&nbsp;we&nbsp;need&nbsp;to&nbsp;do&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636810">//&nbsp;Continue&nbsp;calculating&nbsp;one&nbsp;level&nbsp;up.&nbsp;&nbsp;Fill&nbsp;in&nbsp;nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636873">//&nbsp;of&nbsp;that&nbsp;level&nbsp;with&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;two&nbsp;nodes&nbsp;we&#39;ve&nbsp;just&nbsp;calculated&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636948">//&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636966">if</span>&nbsp;<span class="ident" id="4636969">l</span><span class="op" id="4636970">.</span><span class="ident" id="4636971">level</span>&nbsp;<span class="op" id="4636977">==</span>&nbsp;<span class="ident" id="4636980">maxBits</span>&nbsp;<span class="op" id="4636988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636994">//&nbsp;All&nbsp;done!</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637011">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637025">levels</span><span class="op" id="4637031">[</span><span class="ident" id="4637032">l</span><span class="op" id="4637033">.</span><span class="ident" id="4637034">level</span><span class="op" id="4637039">+</span><span class="num" id="4637040">1</span><span class="op" id="4637041">]</span><span class="op" id="4637042">.</span><span class="ident" id="4637043">nextPairFreq</span>&nbsp;<span class="op" id="4637056">=</span>&nbsp;<span class="ident" id="4637058">prevFreq</span>&nbsp;<span class="op" id="4637067">+</span>&nbsp;<span class="ident" id="4637069">l</span><span class="op" id="4637070">.</span><span class="ident" id="4637071">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637083">level</span><span class="op" id="4637088">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637093">}</span>&nbsp;<span class="keyword" id="4637095">else</span>&nbsp;<span class="op" id="4637100">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4637105">//&nbsp;If&nbsp;we&nbsp;stole&nbsp;from&nbsp;below,&nbsp;move&nbsp;down&nbsp;temporarily&nbsp;to&nbsp;replenish&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637174">for</span>&nbsp;<span class="ident" id="4637178">levels</span><span class="op" id="4637184">[</span><span class="ident" id="4637185">level</span><span class="op" id="4637190">-</span><span class="num" id="4637191">1</span><span class="op" id="4637192">]</span><span class="op" id="4637193">.</span><span class="ident" id="4637194">needed</span>&nbsp;<span class="op" id="4637201">&gt;</span>&nbsp;<span class="num" id="4637203">0</span>&nbsp;<span class="op" id="4637205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637211">level</span><span class="op" id="4637216">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637226">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4637233">//&nbsp;Somethings&nbsp;is&nbsp;wrong&nbsp;if&nbsp;at&nbsp;the&nbsp;end,&nbsp;the&nbsp;top&nbsp;level&nbsp;is&nbsp;null&nbsp;or&nbsp;hasn&#39;t&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4637309">//&nbsp;all&nbsp;of&nbsp;the&nbsp;leaves.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637332">if</span>&nbsp;<span class="ident" id="4637335">leafCounts</span><span class="op" id="4637345">[</span><span class="ident" id="4637346">maxBits</span><span class="op" id="4637353">]</span><span class="op" id="4637354">[</span><span class="ident" id="4637355">maxBits</span><span class="op" id="4637362">]</span>&nbsp;<span class="op" id="4637364">!=</span>&nbsp;<span class="ident" id="4637367">n</span>&nbsp;<span class="op" id="4637369">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4637373">panic</span><span class="op" id="4637378">(</span><span class="string" id="4637379">&#34;leafCounts[maxBits][maxBits]&nbsp;!=&nbsp;n&#34;</span><span class="op" id="4637414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637421">bitCount</span>&nbsp;<span class="op" id="4637430">:=</span>&nbsp;<span class="builtinfunc" id="4637433">make</span><span class="op" id="4637437">(</span><span class="op" id="4637438">[</span><span class="op" id="4637439">]</span><span class="builtintype" id="4637440">int32</span><span class="op" id="4637445">,</span>&nbsp;<span class="ident" id="4637447">maxBits</span><span class="op" id="4637454">+</span><span class="num" id="4637455">1</span><span class="op" id="4637456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637459">bits</span>&nbsp;<span class="op" id="4637464">:=</span>&nbsp;<span class="num" id="4637467">1</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637470">counts</span>&nbsp;<span class="op" id="4637477">:=</span>&nbsp;<span class="op" id="4637480">&amp;</span><span class="ident" id="4637481">leafCounts</span><span class="op" id="4637491">[</span><span class="ident" id="4637492">maxBits</span><span class="op" id="4637499">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637502">for</span>&nbsp;<span class="ident" id="4637506">level</span>&nbsp;<span class="op" id="4637512">:=</span>&nbsp;<span class="ident" id="4637515">maxBits</span><span class="op" id="4637522">;</span>&nbsp;<span class="ident" id="4637524">level</span>&nbsp;<span class="op" id="4637530">&gt;</span>&nbsp;<span class="num" id="4637532">0</span><span class="op" id="4637533">;</span>&nbsp;<span class="ident" id="4637535">level</span><span class="op" id="4637540">--</span>&nbsp;<span class="op" id="4637543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4637547">//&nbsp;chain.leafCount&nbsp;gives&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;requiring&nbsp;at&nbsp;least&nbsp;&#34;bits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4637623">//&nbsp;bits&nbsp;to&nbsp;encode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637644">bitCount</span><span class="op" id="4637652">[</span><span class="ident" id="4637653">bits</span><span class="op" id="4637657">]</span>&nbsp;<span class="op" id="4637659">=</span>&nbsp;<span class="ident" id="4637661">counts</span><span class="op" id="4637667">[</span><span class="ident" id="4637668">level</span><span class="op" id="4637673">]</span>&nbsp;<span class="op" id="4637675">-</span>&nbsp;<span class="ident" id="4637677">counts</span><span class="op" id="4637683">[</span><span class="ident" id="4637684">level</span><span class="op" id="4637689">-</span><span class="num" id="4637690">1</span><span class="op" id="4637691">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637695">bits</span><span class="op" id="4637699">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637706">return</span>&nbsp;<span class="ident" id="4637713">bitCount</span><br>
<span class="lineno"></span><span class="op" id="4637722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4637725">//&nbsp;Look&nbsp;at&nbsp;the&nbsp;leaves&nbsp;and&nbsp;assign&nbsp;them&nbsp;a&nbsp;bit&nbsp;count&nbsp;and&nbsp;an&nbsp;encoding&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="4637804">//&nbsp;in&nbsp;RFC&nbsp;1951&nbsp;3.2.2</span><br>
<span class="lineno"></span><span class="keyword" id="4637825">func</span>&nbsp;<span class="op" id="4637830">(</span><span class="ident" id="4637831">h</span>&nbsp;<span class="op" id="4637833">*</span><span class="ident" id="4637834">huffmanEncoder</span><span class="op" id="4637848">)</span>&nbsp;<span class="ident" id="4637850">assignEncodingAndSize</span><span class="op" id="4637871">(</span><span class="ident" id="4637872">bitCount</span>&nbsp;<span class="op" id="4637881">[</span><span class="op" id="4637882">]</span><span class="builtintype" id="4637883">int32</span><span class="op" id="4637888">,</span>&nbsp;<span class="ident" id="4637890">list</span>&nbsp;<span class="op" id="4637895">[</span><span class="op" id="4637896">]</span><span class="ident" id="4637897">literalNode</span><span class="op" id="4637908">)</span>&nbsp;<span class="op" id="4637910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637913">code</span>&nbsp;<span class="op" id="4637918">:=</span>&nbsp;<span class="builtintype" id="4637921">uint16</span><span class="op" id="4637927">(</span><span class="num" id="4637928">0</span><span class="op" id="4637929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637932">for</span>&nbsp;<span class="ident" id="4637936">n</span><span class="op" id="4637937">,</span>&nbsp;<span class="ident" id="4637939">bits</span>&nbsp;<span class="op" id="4637944">:=</span>&nbsp;<span class="keyword" id="4637947">range</span>&nbsp;<span class="ident" id="4637953">bitCount</span>&nbsp;<span class="op" id="4637962">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637966">code</span>&nbsp;<span class="op" id="4637971">&lt;&lt;=</span>&nbsp;<span class="num" id="4637975">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637979">if</span>&nbsp;<span class="ident" id="4637982">n</span>&nbsp;<span class="op" id="4637984">==</span>&nbsp;<span class="num" id="4637987">0</span>&nbsp;<span class="op" id="4637989">||</span>&nbsp;<span class="ident" id="4637992">bits</span>&nbsp;<span class="op" id="4637997">==</span>&nbsp;<span class="num" id="4638000">0</span>&nbsp;<span class="op" id="4638002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638007">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4638022">//&nbsp;The&nbsp;literals&nbsp;list[len(list)-bits]&nbsp;..&nbsp;list[len(list)-bits]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4638085">//&nbsp;are&nbsp;encoded&nbsp;using&nbsp;&#34;bits&#34;&nbsp;bits,&nbsp;and&nbsp;get&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4638140">//&nbsp;code,&nbsp;code&nbsp;+&nbsp;1,&nbsp;....&nbsp;&nbsp;The&nbsp;code&nbsp;values&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4638187">//&nbsp;assigned&nbsp;in&nbsp;literal&nbsp;order&nbsp;(not&nbsp;frequency&nbsp;order).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638241">chunk</span>&nbsp;<span class="op" id="4638247">:=</span>&nbsp;<span class="ident" id="4638250">list</span><span class="op" id="4638254">[</span><span class="builtinfunc" id="4638255">len</span><span class="op" id="4638258">(</span><span class="ident" id="4638259">list</span><span class="op" id="4638263">)</span><span class="op" id="4638264">-</span><span class="builtintype" id="4638265">int</span><span class="op" id="4638268">(</span><span class="ident" id="4638269">bits</span><span class="op" id="4638273">)</span><span class="op" id="4638274">:</span><span class="op" id="4638275">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638279">sortByLiteral</span><span class="op" id="4638292">(</span><span class="ident" id="4638293">chunk</span><span class="op" id="4638298">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638302">for</span>&nbsp;<span class="ident" id="4638306">_</span><span class="op" id="4638307">,</span>&nbsp;<span class="ident" id="4638309">node</span>&nbsp;<span class="op" id="4638314">:=</span>&nbsp;<span class="keyword" id="4638317">range</span>&nbsp;<span class="ident" id="4638323">chunk</span>&nbsp;<span class="op" id="4638329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638334">h</span><span class="op" id="4638335">.</span><span class="ident" id="4638336">codeBits</span><span class="op" id="4638344">[</span><span class="ident" id="4638345">node</span><span class="op" id="4638349">.</span><span class="ident" id="4638350">literal</span><span class="op" id="4638357">]</span>&nbsp;<span class="op" id="4638359">=</span>&nbsp;<span class="builtintype" id="4638361">uint8</span><span class="op" id="4638366">(</span><span class="ident" id="4638367">n</span><span class="op" id="4638368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638373">h</span><span class="op" id="4638374">.</span><span class="ident" id="4638375">code</span><span class="op" id="4638379">[</span><span class="ident" id="4638380">node</span><span class="op" id="4638384">.</span><span class="ident" id="4638385">literal</span><span class="op" id="4638392">]</span>&nbsp;<span class="op" id="4638394">=</span>&nbsp;<span class="ident" id="4638396">reverseBits</span><span class="op" id="4638407">(</span><span class="ident" id="4638408">code</span><span class="op" id="4638412">,</span>&nbsp;<span class="builtintype" id="4638414">uint8</span><span class="op" id="4638419">(</span><span class="ident" id="4638420">n</span><span class="op" id="4638421">)</span><span class="op" id="4638422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638427">code</span><span class="op" id="4638431">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638436">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638440">list</span>&nbsp;<span class="op" id="4638445">=</span>&nbsp;<span class="ident" id="4638447">list</span><span class="op" id="4638451">[</span><span class="num" id="4638452">0</span>&nbsp;<span class="op" id="4638454">:</span>&nbsp;<span class="builtinfunc" id="4638456">len</span><span class="op" id="4638459">(</span><span class="ident" id="4638460">list</span><span class="op" id="4638464">)</span><span class="op" id="4638465">-</span><span class="builtintype" id="4638466">int</span><span class="op" id="4638469">(</span><span class="ident" id="4638470">bits</span><span class="op" id="4638474">)</span><span class="op" id="4638475">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638478">}</span><br>
<span class="lineno"></span><span class="op" id="4638480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4638483">//&nbsp;Update&nbsp;this&nbsp;Huffman&nbsp;Code&nbsp;object&nbsp;to&nbsp;be&nbsp;the&nbsp;minimum&nbsp;code&nbsp;for&nbsp;the&nbsp;specified&nbsp;frequency&nbsp;count.</span><br>
<span class="lineno">260</span><span class="comment" id="4638576">//</span><br>
<span class="lineno"></span><span class="comment" id="4638579">//&nbsp;freq&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;frequencies,&nbsp;in&nbsp;which&nbsp;frequency[i]&nbsp;gives&nbsp;the&nbsp;frequency&nbsp;of&nbsp;literal&nbsp;i.</span><br>
<span class="lineno"></span><span class="comment" id="4638669">//&nbsp;maxBits&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;any&nbsp;literal.</span><br>
<span class="lineno"></span><span class="keyword" id="4638732">func</span>&nbsp;<span class="op" id="4638737">(</span><span class="ident" id="4638738">h</span>&nbsp;<span class="op" id="4638740">*</span><span class="ident" id="4638741">huffmanEncoder</span><span class="op" id="4638755">)</span>&nbsp;<span class="ident" id="4638757">generate</span><span class="op" id="4638765">(</span><span class="ident" id="4638766">freq</span>&nbsp;<span class="op" id="4638771">[</span><span class="op" id="4638772">]</span><span class="builtintype" id="4638773">int32</span><span class="op" id="4638778">,</span>&nbsp;<span class="ident" id="4638780">maxBits</span>&nbsp;<span class="builtintype" id="4638788">int32</span><span class="op" id="4638793">)</span>&nbsp;<span class="op" id="4638795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638798">list</span>&nbsp;<span class="op" id="4638803">:=</span>&nbsp;<span class="builtinfunc" id="4638806">make</span><span class="op" id="4638810">(</span><span class="op" id="4638811">[</span><span class="op" id="4638812">]</span><span class="ident" id="4638813">literalNode</span><span class="op" id="4638824">,</span>&nbsp;<span class="builtinfunc" id="4638826">len</span><span class="op" id="4638829">(</span><span class="ident" id="4638830">freq</span><span class="op" id="4638834">)</span><span class="op" id="4638835">+</span><span class="num" id="4638836">1</span><span class="op" id="4638837">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4638840">//&nbsp;Number&nbsp;of&nbsp;non-zero&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638872">count</span>&nbsp;<span class="op" id="4638878">:=</span>&nbsp;<span class="num" id="4638881">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4638884">//&nbsp;Set&nbsp;list&nbsp;to&nbsp;be&nbsp;the&nbsp;set&nbsp;of&nbsp;all&nbsp;non-zero&nbsp;literals&nbsp;and&nbsp;their&nbsp;frequencies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638958">for</span>&nbsp;<span class="ident" id="4638962">i</span><span class="op" id="4638963">,</span>&nbsp;<span class="ident" id="4638965">f</span>&nbsp;<span class="op" id="4638967">:=</span>&nbsp;<span class="keyword" id="4638970">range</span>&nbsp;<span class="ident" id="4638976">freq</span>&nbsp;<span class="op" id="4638981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638985">if</span>&nbsp;<span class="ident" id="4638988">f</span>&nbsp;<span class="op" id="4638990">!=</span>&nbsp;<span class="num" id="4638993">0</span>&nbsp;<span class="op" id="4638995">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639000">list</span><span class="op" id="4639004">[</span><span class="ident" id="4639005">count</span><span class="op" id="4639010">]</span>&nbsp;<span class="op" id="4639012">=</span>&nbsp;<span class="ident" id="4639014">literalNode</span><span class="op" id="4639025">{</span><span class="builtintype" id="4639026">uint16</span><span class="op" id="4639032">(</span><span class="ident" id="4639033">i</span><span class="op" id="4639034">)</span><span class="op" id="4639035">,</span>&nbsp;<span class="ident" id="4639037">f</span><span class="op" id="4639038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639043">count</span><span class="op" id="4639048">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639053">}</span>&nbsp;<span class="keyword" id="4639055">else</span>&nbsp;<span class="op" id="4639060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639065">h</span><span class="op" id="4639066">.</span><span class="ident" id="4639067">codeBits</span><span class="op" id="4639075">[</span><span class="ident" id="4639076">i</span><span class="op" id="4639077">]</span>&nbsp;<span class="op" id="4639079">=</span>&nbsp;<span class="num" id="4639081">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639085">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639091">//&nbsp;If&nbsp;freq[]&nbsp;is&nbsp;shorter&nbsp;than&nbsp;codeBits[],&nbsp;fill&nbsp;rest&nbsp;of&nbsp;codeBits[]&nbsp;with&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639168">h</span><span class="op" id="4639169">.</span><span class="ident" id="4639170">codeBits</span>&nbsp;<span class="op" id="4639179">=</span>&nbsp;<span class="ident" id="4639181">h</span><span class="op" id="4639182">.</span><span class="ident" id="4639183">codeBits</span><span class="op" id="4639191">[</span><span class="num" id="4639192">0</span><span class="op" id="4639193">:</span><span class="builtinfunc" id="4639194">len</span><span class="op" id="4639197">(</span><span class="ident" id="4639198">freq</span><span class="op" id="4639202">)</span><span class="op" id="4639203">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639206">list</span>&nbsp;<span class="op" id="4639211">=</span>&nbsp;<span class="ident" id="4639213">list</span><span class="op" id="4639217">[</span><span class="num" id="4639218">0</span><span class="op" id="4639219">:</span><span class="ident" id="4639220">count</span><span class="op" id="4639225">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639228">if</span>&nbsp;<span class="ident" id="4639231">count</span>&nbsp;<span class="op" id="4639237">&lt;=</span>&nbsp;<span class="num" id="4639240">2</span>&nbsp;<span class="op" id="4639242">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639246">//&nbsp;Handle&nbsp;the&nbsp;small&nbsp;cases&nbsp;here,&nbsp;because&nbsp;they&nbsp;are&nbsp;awkward&nbsp;for&nbsp;the&nbsp;general&nbsp;case&nbsp;code.&nbsp;&nbsp;With</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639338">//&nbsp;two&nbsp;or&nbsp;fewer&nbsp;literals,&nbsp;everything&nbsp;has&nbsp;bit&nbsp;length&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639395">for</span>&nbsp;<span class="ident" id="4639399">i</span><span class="op" id="4639400">,</span>&nbsp;<span class="ident" id="4639402">node</span>&nbsp;<span class="op" id="4639407">:=</span>&nbsp;<span class="keyword" id="4639410">range</span>&nbsp;<span class="ident" id="4639416">list</span>&nbsp;<span class="op" id="4639421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639426">//&nbsp;&#34;list&#34;&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing&nbsp;literal&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639480">h</span><span class="op" id="4639481">.</span><span class="ident" id="4639482">codeBits</span><span class="op" id="4639490">[</span><span class="ident" id="4639491">node</span><span class="op" id="4639495">.</span><span class="ident" id="4639496">literal</span><span class="op" id="4639503">]</span>&nbsp;<span class="op" id="4639505">=</span>&nbsp;<span class="num" id="4639507">1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639512">h</span><span class="op" id="4639513">.</span><span class="ident" id="4639514">code</span><span class="op" id="4639518">[</span><span class="ident" id="4639519">node</span><span class="op" id="4639523">.</span><span class="ident" id="4639524">literal</span><span class="op" id="4639531">]</span>&nbsp;<span class="op" id="4639533">=</span>&nbsp;<span class="builtintype" id="4639535">uint16</span><span class="op" id="4639541">(</span><span class="ident" id="4639542">i</span><span class="op" id="4639543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639551">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639562">sortByFreq</span><span class="op" id="4639572">(</span><span class="ident" id="4639573">list</span><span class="op" id="4639577">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639581">//&nbsp;Get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;for&nbsp;each&nbsp;bit&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639631">bitCount</span>&nbsp;<span class="op" id="4639640">:=</span>&nbsp;<span class="ident" id="4639643">h</span><span class="op" id="4639644">.</span><span class="ident" id="4639645">bitCounts</span><span class="op" id="4639654">(</span><span class="ident" id="4639655">list</span><span class="op" id="4639659">,</span>&nbsp;<span class="ident" id="4639661">maxBits</span><span class="op" id="4639668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639671">//&nbsp;And&nbsp;do&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639697">h</span><span class="op" id="4639698">.</span><span class="ident" id="4639699">assignEncodingAndSize</span><span class="op" id="4639720">(</span><span class="ident" id="4639721">bitCount</span><span class="op" id="4639729">,</span>&nbsp;<span class="ident" id="4639731">list</span><span class="op" id="4639735">)</span><br>
<span class="lineno">295</span><span class="op" id="4639737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4639740">type</span>&nbsp;<span class="ident" id="4639745">literalNodeSorter</span>&nbsp;<span class="keyword" id="4639763">struct</span>&nbsp;<span class="op" id="4639770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639773">a</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4639778">[</span><span class="op" id="4639779">]</span><span class="ident" id="4639780">literalNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639793">less</span>&nbsp;<span class="keyword" id="4639798">func</span><span class="op" id="4639802">(</span><span class="ident" id="4639803">i</span><span class="op" id="4639804">,</span>&nbsp;<span class="ident" id="4639806">j</span>&nbsp;<span class="builtintype" id="4639808">int</span><span class="op" id="4639811">)</span>&nbsp;<span class="builtintype" id="4639813">bool</span><br>
<span class="lineno">300</span><span class="op" id="4639818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4639821">func</span>&nbsp;<span class="op" id="4639826">(</span><span class="ident" id="4639827">s</span>&nbsp;<span class="ident" id="4639829">literalNodeSorter</span><span class="op" id="4639846">)</span>&nbsp;<span class="ident" id="4639848">Len</span><span class="op" id="4639851">(</span><span class="op" id="4639852">)</span>&nbsp;<span class="builtintype" id="4639854">int</span>&nbsp;<span class="op" id="4639858">{</span>&nbsp;<span class="keyword" id="4639860">return</span>&nbsp;<span class="builtinfunc" id="4639867">len</span><span class="op" id="4639870">(</span><span class="ident" id="4639871">s</span><span class="op" id="4639872">.</span><span class="ident" id="4639873">a</span><span class="op" id="4639874">)</span>&nbsp;<span class="op" id="4639876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4639879">func</span>&nbsp;<span class="op" id="4639884">(</span><span class="ident" id="4639885">s</span>&nbsp;<span class="ident" id="4639887">literalNodeSorter</span><span class="op" id="4639904">)</span>&nbsp;<span class="ident" id="4639906">Less</span><span class="op" id="4639910">(</span><span class="ident" id="4639911">i</span><span class="op" id="4639912">,</span>&nbsp;<span class="ident" id="4639914">j</span>&nbsp;<span class="builtintype" id="4639916">int</span><span class="op" id="4639919">)</span>&nbsp;<span class="builtintype" id="4639921">bool</span>&nbsp;<span class="op" id="4639926">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639929">return</span>&nbsp;<span class="ident" id="4639936">s</span><span class="op" id="4639937">.</span><span class="ident" id="4639938">less</span><span class="op" id="4639942">(</span><span class="ident" id="4639943">i</span><span class="op" id="4639944">,</span>&nbsp;<span class="ident" id="4639946">j</span><span class="op" id="4639947">)</span><br>
<span class="lineno"></span><span class="op" id="4639949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4639952">func</span>&nbsp;<span class="op" id="4639957">(</span><span class="ident" id="4639958">s</span>&nbsp;<span class="ident" id="4639960">literalNodeSorter</span><span class="op" id="4639977">)</span>&nbsp;<span class="ident" id="4639979">Swap</span><span class="op" id="4639983">(</span><span class="ident" id="4639984">i</span><span class="op" id="4639985">,</span>&nbsp;<span class="ident" id="4639987">j</span>&nbsp;<span class="builtintype" id="4639989">int</span><span class="op" id="4639992">)</span>&nbsp;<span class="op" id="4639994">{</span>&nbsp;<span class="ident" id="4639996">s</span><span class="op" id="4639997">.</span><span class="ident" id="4639998">a</span><span class="op" id="4639999">[</span><span class="ident" id="4640000">i</span><span class="op" id="4640001">]</span><span class="op" id="4640002">,</span>&nbsp;<span class="ident" id="4640004">s</span><span class="op" id="4640005">.</span><span class="ident" id="4640006">a</span><span class="op" id="4640007">[</span><span class="ident" id="4640008">j</span><span class="op" id="4640009">]</span>&nbsp;<span class="op" id="4640011">=</span>&nbsp;<span class="ident" id="4640013">s</span><span class="op" id="4640014">.</span><span class="ident" id="4640015">a</span><span class="op" id="4640016">[</span><span class="ident" id="4640017">j</span><span class="op" id="4640018">]</span><span class="op" id="4640019">,</span>&nbsp;<span class="ident" id="4640021">s</span><span class="op" id="4640022">.</span><span class="ident" id="4640023">a</span><span class="op" id="4640024">[</span><span class="ident" id="4640025">i</span><span class="op" id="4640026">]</span>&nbsp;<span class="op" id="4640028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="keyword" id="4640031">func</span>&nbsp;<span class="ident" id="4640036">sortByFreq</span><span class="op" id="4640046">(</span><span class="ident" id="4640047">a</span>&nbsp;<span class="op" id="4640049">[</span><span class="op" id="4640050">]</span><span class="ident" id="4640051">literalNode</span><span class="op" id="4640062">)</span>&nbsp;<span class="op" id="4640064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640067">s</span>&nbsp;<span class="op" id="4640069">:=</span>&nbsp;<span class="op" id="4640072">&amp;</span><span class="ident" id="4640073">literalNodeSorter</span><span class="op" id="4640090">{</span><span class="ident" id="4640091">a</span><span class="op" id="4640092">,</span>&nbsp;<span class="keyword" id="4640094">func</span><span class="op" id="4640098">(</span><span class="ident" id="4640099">i</span><span class="op" id="4640100">,</span>&nbsp;<span class="ident" id="4640102">j</span>&nbsp;<span class="builtintype" id="4640104">int</span><span class="op" id="4640107">)</span>&nbsp;<span class="builtintype" id="4640109">bool</span>&nbsp;<span class="op" id="4640114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640118">if</span>&nbsp;<span class="ident" id="4640121">a</span><span class="op" id="4640122">[</span><span class="ident" id="4640123">i</span><span class="op" id="4640124">]</span><span class="op" id="4640125">.</span><span class="ident" id="4640126">freq</span>&nbsp;<span class="op" id="4640131">==</span>&nbsp;<span class="ident" id="4640134">a</span><span class="op" id="4640135">[</span><span class="ident" id="4640136">j</span><span class="op" id="4640137">]</span><span class="op" id="4640138">.</span><span class="ident" id="4640139">freq</span>&nbsp;<span class="op" id="4640144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640149">return</span>&nbsp;<span class="ident" id="4640156">a</span><span class="op" id="4640157">[</span><span class="ident" id="4640158">i</span><span class="op" id="4640159">]</span><span class="op" id="4640160">.</span><span class="ident" id="4640161">literal</span>&nbsp;<span class="op" id="4640169">&lt;</span>&nbsp;<span class="ident" id="4640171">a</span><span class="op" id="4640172">[</span><span class="ident" id="4640173">j</span><span class="op" id="4640174">]</span><span class="op" id="4640175">.</span><span class="ident" id="4640176">literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640186">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640190">return</span>&nbsp;<span class="ident" id="4640197">a</span><span class="op" id="4640198">[</span><span class="ident" id="4640199">i</span><span class="op" id="4640200">]</span><span class="op" id="4640201">.</span><span class="ident" id="4640202">freq</span>&nbsp;<span class="op" id="4640207">&lt;</span>&nbsp;<span class="ident" id="4640209">a</span><span class="op" id="4640210">[</span><span class="ident" id="4640211">j</span><span class="op" id="4640212">]</span><span class="op" id="4640213">.</span><span class="ident" id="4640214">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640220">}</span><span class="op" id="4640221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640224">sort</span><span class="op" id="4640228">.</span><span class="ident" id="4640229">Sort</span><span class="op" id="4640233">(</span><span class="ident" id="4640234">s</span><span class="op" id="4640235">)</span><br>
<span class="lineno"></span><span class="op" id="4640237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="keyword" id="4640240">func</span>&nbsp;<span class="ident" id="4640245">sortByLiteral</span><span class="op" id="4640258">(</span><span class="ident" id="4640259">a</span>&nbsp;<span class="op" id="4640261">[</span><span class="op" id="4640262">]</span><span class="ident" id="4640263">literalNode</span><span class="op" id="4640274">)</span>&nbsp;<span class="op" id="4640276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640279">s</span>&nbsp;<span class="op" id="4640281">:=</span>&nbsp;<span class="op" id="4640284">&amp;</span><span class="ident" id="4640285">literalNodeSorter</span><span class="op" id="4640302">{</span><span class="ident" id="4640303">a</span><span class="op" id="4640304">,</span>&nbsp;<span class="keyword" id="4640306">func</span><span class="op" id="4640310">(</span><span class="ident" id="4640311">i</span><span class="op" id="4640312">,</span>&nbsp;<span class="ident" id="4640314">j</span>&nbsp;<span class="builtintype" id="4640316">int</span><span class="op" id="4640319">)</span>&nbsp;<span class="builtintype" id="4640321">bool</span>&nbsp;<span class="op" id="4640326">{</span>&nbsp;<span class="keyword" id="4640328">return</span>&nbsp;<span class="ident" id="4640335">a</span><span class="op" id="4640336">[</span><span class="ident" id="4640337">i</span><span class="op" id="4640338">]</span><span class="op" id="4640339">.</span><span class="ident" id="4640340">literal</span>&nbsp;<span class="op" id="4640348">&lt;</span>&nbsp;<span class="ident" id="4640350">a</span><span class="op" id="4640351">[</span><span class="ident" id="4640352">j</span><span class="op" id="4640353">]</span><span class="op" id="4640354">.</span><span class="ident" id="4640355">literal</span>&nbsp;<span class="op" id="4640363">}</span><span class="op" id="4640364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640367">sort</span><span class="op" id="4640371">.</span><span class="ident" id="4640372">Sort</span><span class="op" id="4640376">(</span><span class="ident" id="4640377">s</span><span class="op" id="4640378">)</span><br>
<span class="lineno"></span><span class="op" id="4640380">}</span>
</div>
</body>
</html>
