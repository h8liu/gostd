<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5791122">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5791177">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5791231">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5791282">//&nbsp;Package&nbsp;testing&nbsp;provides&nbsp;support&nbsp;for&nbsp;automated&nbsp;testing&nbsp;of&nbsp;Go&nbsp;packages.</span><br>
<span class="lineno"></span><span class="comment" id="5791356">//&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;in&nbsp;concert&nbsp;with&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command,&nbsp;which&nbsp;automates</span><br>
<span class="lineno"></span><span class="comment" id="5791442">//&nbsp;execution&nbsp;of&nbsp;any&nbsp;function&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5791483">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestXxx(*testing.T)</span><br>
<span class="lineno"></span><span class="comment" id="5791515">//&nbsp;where&nbsp;Xxx&nbsp;can&nbsp;be&nbsp;any&nbsp;alphanumeric&nbsp;string&nbsp;(but&nbsp;the&nbsp;first&nbsp;letter&nbsp;must&nbsp;not&nbsp;be&nbsp;in</span><br>
<span class="lineno">10</span><span class="comment" id="5791596">//&nbsp;[a-z])&nbsp;and&nbsp;serves&nbsp;to&nbsp;identify&nbsp;the&nbsp;test&nbsp;routine.</span><br>
<span class="lineno"></span><span class="comment" id="5791647">//</span><br>
<span class="lineno"></span><span class="comment" id="5791650">//&nbsp;Within&nbsp;these&nbsp;functions,&nbsp;use&nbsp;the&nbsp;Error,&nbsp;Fail&nbsp;or&nbsp;related&nbsp;methods&nbsp;to&nbsp;signal&nbsp;failure.</span><br>
<span class="lineno"></span><span class="comment" id="5791735">//</span><br>
<span class="lineno"></span><span class="comment" id="5791738">//&nbsp;To&nbsp;write&nbsp;a&nbsp;new&nbsp;test&nbsp;suite,&nbsp;create&nbsp;a&nbsp;file&nbsp;whose&nbsp;name&nbsp;ends&nbsp;_test.go&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="5791812">//&nbsp;contains&nbsp;the&nbsp;TestXxx&nbsp;functions&nbsp;as&nbsp;described&nbsp;here.&nbsp;Put&nbsp;the&nbsp;file&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="5791890">//&nbsp;package&nbsp;as&nbsp;the&nbsp;one&nbsp;being&nbsp;tested.&nbsp;The&nbsp;file&nbsp;will&nbsp;be&nbsp;excluded&nbsp;from&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="5791965">//&nbsp;package&nbsp;builds&nbsp;but&nbsp;will&nbsp;be&nbsp;included&nbsp;when&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span><span class="comment" id="5792041">//&nbsp;For&nbsp;more&nbsp;detail,&nbsp;run&nbsp;``go&nbsp;help&nbsp;test&#39;&#39;&nbsp;and&nbsp;``go&nbsp;help&nbsp;testflag&#39;&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="5792108">//</span><br>
<span class="lineno">20</span><span class="comment" id="5792111">//&nbsp;Tests&nbsp;and&nbsp;benchmarks&nbsp;may&nbsp;be&nbsp;skipped&nbsp;if&nbsp;not&nbsp;applicable&nbsp;with&nbsp;a&nbsp;call&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5792183">//&nbsp;the&nbsp;Skip&nbsp;method&nbsp;of&nbsp;*T&nbsp;and&nbsp;*B:</span><br>
<span class="lineno"></span><span class="comment" id="5792216">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestTimeConsuming(t&nbsp;*testing.T)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5792262">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;testing.Short()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5792294">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.Skip(&#34;skipping&nbsp;test&nbsp;in&nbsp;short&nbsp;mode.&#34;)</span><br>
<span class="lineno">25</span><span class="comment" id="5792348">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5792361">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5792376">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5792385">//</span><br>
<span class="lineno"></span><span class="comment" id="5792388">//&nbsp;Benchmarks</span><br>
<span class="lineno">30</span><span class="comment" id="5792402">//</span><br>
<span class="lineno"></span><span class="comment" id="5792405">//&nbsp;Functions&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5792430">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkXxx(*testing.B)</span><br>
<span class="lineno"></span><span class="comment" id="5792467">//&nbsp;are&nbsp;considered&nbsp;benchmarks,&nbsp;and&nbsp;are&nbsp;executed&nbsp;by&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="5792544">//&nbsp;its&nbsp;-bench&nbsp;flag&nbsp;is&nbsp;provided.&nbsp;Benchmarks&nbsp;are&nbsp;run&nbsp;sequentially.</span><br>
<span class="lineno">35</span><span class="comment" id="5792609">//</span><br>
<span class="lineno"></span><span class="comment" id="5792612">//&nbsp;For&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;testing&nbsp;flags,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="5792659">//&nbsp;http://golang.org/cmd/go/#hdr-Description_of_testing_flags.</span><br>
<span class="lineno"></span><span class="comment" id="5792722">//</span><br>
<span class="lineno"></span><span class="comment" id="5792725">//&nbsp;A&nbsp;sample&nbsp;benchmark&nbsp;function&nbsp;looks&nbsp;like&nbsp;this:</span><br>
<span class="lineno">40</span><span class="comment" id="5792773">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkHello(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5792816">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5792854">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Sprintf(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5792890">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5792903">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">45</span><span class="comment" id="5792912">//</span><br>
<span class="lineno"></span><span class="comment" id="5792915">//&nbsp;The&nbsp;benchmark&nbsp;function&nbsp;must&nbsp;run&nbsp;the&nbsp;target&nbsp;code&nbsp;b.N&nbsp;times.</span><br>
<span class="lineno"></span><span class="comment" id="5792977">//&nbsp;During&nbsp;benchark&nbsp;execution,&nbsp;b.N&nbsp;is&nbsp;adjusted&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;lasts</span><br>
<span class="lineno"></span><span class="comment" id="5793058">//&nbsp;long&nbsp;enough&nbsp;to&nbsp;be&nbsp;timed&nbsp;reliably.&nbsp;&nbsp;The&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="5793107">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp;10000000&nbsp;&nbsp;&nbsp;&nbsp;282&nbsp;ns/op</span><br>
<span class="lineno">50</span><span class="comment" id="5793154">//&nbsp;means&nbsp;that&nbsp;the&nbsp;loop&nbsp;ran&nbsp;10000000&nbsp;times&nbsp;at&nbsp;a&nbsp;speed&nbsp;of&nbsp;282&nbsp;ns&nbsp;per&nbsp;loop.</span><br>
<span class="lineno"></span><span class="comment" id="5793227">//</span><br>
<span class="lineno"></span><span class="comment" id="5793230">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;some&nbsp;expensive&nbsp;setup&nbsp;before&nbsp;running,&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="5793301">//&nbsp;may&nbsp;be&nbsp;reset:</span><br>
<span class="lineno"></span><span class="comment" id="5793318">//</span><br>
<span class="lineno">55</span><span class="comment" id="5793321">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkBigLen(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5793365">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big&nbsp;:=&nbsp;NewBig()</span><br>
<span class="lineno"></span><span class="comment" id="5793392">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.ResetTimer()</span><br>
<span class="lineno"></span><span class="comment" id="5793418">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5793456">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big.Len()</span><br>
<span class="lineno">60</span><span class="comment" id="5793481">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5793494">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5793503">//</span><br>
<span class="lineno"></span><span class="comment" id="5793506">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;to&nbsp;test&nbsp;performance&nbsp;in&nbsp;a&nbsp;parallel&nbsp;setting,&nbsp;it&nbsp;may&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="5793584">//&nbsp;the&nbsp;RunParallel&nbsp;helper&nbsp;function;&nbsp;such&nbsp;benchmarks&nbsp;are&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;with</span><br>
<span class="lineno">65</span><span class="comment" id="5793665">//&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag:</span><br>
<span class="lineno"></span><span class="comment" id="5793691">//</span><br>
<span class="lineno"></span><span class="comment" id="5793694">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkTemplateParallel(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5793748">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ&nbsp;:=&nbsp;template.Must(template.New(&#34;test&#34;).Parse(&#34;Hello,&nbsp;{{.}}!&#34;))</span><br>
<span class="lineno"></span><span class="comment" id="5793827">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.RunParallel(func(pb&nbsp;*testing.PB)&nbsp;{</span><br>
<span class="lineno">70</span><span class="comment" id="5793875">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;buf&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span><span class="comment" id="5793911">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;pb.Next()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5793942">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.Reset()</span><br>
<span class="lineno"></span><span class="comment" id="5793973">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ.Execute(&amp;buf,&nbsp;&#34;World&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5794021">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">75</span><span class="comment" id="5794038">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><br>
<span class="lineno"></span><span class="comment" id="5794052">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5794061">//</span><br>
<span class="lineno"></span><span class="comment" id="5794064">//&nbsp;Examples</span><br>
<span class="lineno"></span><span class="comment" id="5794076">//</span><br>
<span class="lineno">80</span><span class="comment" id="5794079">//&nbsp;The&nbsp;package&nbsp;also&nbsp;runs&nbsp;and&nbsp;verifies&nbsp;example&nbsp;code.&nbsp;Example&nbsp;functions&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="5794153">//&nbsp;include&nbsp;a&nbsp;concluding&nbsp;line&nbsp;comment&nbsp;that&nbsp;begins&nbsp;with&nbsp;&#34;Output:&#34;&nbsp;and&nbsp;is&nbsp;compared&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5794238">//&nbsp;the&nbsp;standard&nbsp;output&nbsp;of&nbsp;the&nbsp;function&nbsp;when&nbsp;the&nbsp;tests&nbsp;are&nbsp;run.&nbsp;(The&nbsp;comparison</span><br>
<span class="lineno"></span><span class="comment" id="5794317">//&nbsp;ignores&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.)&nbsp;These&nbsp;are&nbsp;examples&nbsp;of&nbsp;an&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="5794391">//</span><br>
<span class="lineno">85</span><span class="comment" id="5794394">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleHello()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5794423">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5794459">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:&nbsp;hello</span><br>
<span class="lineno"></span><span class="comment" id="5794491">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5794500">//</span><br>
<span class="lineno">90</span><span class="comment" id="5794503">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleSalutations()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5794538">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello,&nbsp;and&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5794579">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;goodbye&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5794617">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:</span><br>
<span class="lineno"></span><span class="comment" id="5794643">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;hello,&nbsp;and</span><br>
<span class="lineno">95</span><span class="comment" id="5794672">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;goodbye</span><br>
<span class="lineno"></span><span class="comment" id="5794698">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5794707">//</span><br>
<span class="lineno"></span><span class="comment" id="5794710">//&nbsp;Example&nbsp;functions&nbsp;without&nbsp;output&nbsp;comments&nbsp;are&nbsp;compiled&nbsp;but&nbsp;not&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="5794786">//</span><br>
<span class="lineno">100</span><span class="comment" id="5794789">//&nbsp;The&nbsp;naming&nbsp;convention&nbsp;to&nbsp;declare&nbsp;examples&nbsp;for&nbsp;the&nbsp;package,&nbsp;a&nbsp;function&nbsp;F,&nbsp;a&nbsp;type&nbsp;T&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5794878">//&nbsp;method&nbsp;M&nbsp;on&nbsp;type&nbsp;T&nbsp;are:</span><br>
<span class="lineno"></span><span class="comment" id="5794905">//</span><br>
<span class="lineno"></span><span class="comment" id="5794908">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5794938">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">105</span><span class="comment" id="5794969">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5795000">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5795033">//</span><br>
<span class="lineno"></span><span class="comment" id="5795036">//&nbsp;Multiple&nbsp;example&nbsp;functions&nbsp;for&nbsp;a&nbsp;package/type/function/method&nbsp;may&nbsp;be&nbsp;provided&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5795120">//&nbsp;appending&nbsp;a&nbsp;distinct&nbsp;suffix&nbsp;to&nbsp;the&nbsp;name.&nbsp;The&nbsp;suffix&nbsp;must&nbsp;start&nbsp;with&nbsp;a</span><br>
<span class="lineno">110</span><span class="comment" id="5795193">//&nbsp;lower-case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="comment" id="5795215">//</span><br>
<span class="lineno"></span><span class="comment" id="5795218">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5795255">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5795293">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">115</span><span class="comment" id="5795331">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5795371">//</span><br>
<span class="lineno"></span><span class="comment" id="5795374">//&nbsp;The&nbsp;entire&nbsp;test&nbsp;file&nbsp;is&nbsp;presented&nbsp;as&nbsp;the&nbsp;example&nbsp;when&nbsp;it&nbsp;contains&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="5795452">//&nbsp;example&nbsp;function,&nbsp;at&nbsp;least&nbsp;one&nbsp;other&nbsp;function,&nbsp;type,&nbsp;variable,&nbsp;or&nbsp;constant</span><br>
<span class="lineno"></span><span class="comment" id="5795530">//&nbsp;declaration,&nbsp;and&nbsp;no&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;functions.</span><br>
<span class="lineno">120</span><span class="comment" id="5795582">//</span><br>
<span class="lineno"></span><span class="comment" id="5795585">//&nbsp;Main</span><br>
<span class="lineno"></span><span class="comment" id="5795593">//</span><br>
<span class="lineno"></span><span class="comment" id="5795596">//&nbsp;It&nbsp;is&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;program&nbsp;to&nbsp;do&nbsp;extra&nbsp;setup&nbsp;or&nbsp;teardown</span><br>
<span class="lineno"></span><span class="comment" id="5795674">//&nbsp;before&nbsp;or&nbsp;after&nbsp;testing.&nbsp;It&nbsp;is&nbsp;also&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;to&nbsp;control</span><br>
<span class="lineno">125</span><span class="comment" id="5795755">//&nbsp;which&nbsp;code&nbsp;runs&nbsp;on&nbsp;the&nbsp;main&nbsp;thread.&nbsp;To&nbsp;support&nbsp;these&nbsp;and&nbsp;other&nbsp;cases,</span><br>
<span class="lineno"></span><span class="comment" id="5795828">//&nbsp;if&nbsp;a&nbsp;test&nbsp;file&nbsp;contains&nbsp;a&nbsp;function:</span><br>
<span class="lineno"></span><span class="comment" id="5795867">//</span><br>
<span class="lineno"></span><span class="comment" id="5795870">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)</span><br>
<span class="lineno"></span><span class="comment" id="5795901">//</span><br>
<span class="lineno">130</span><span class="comment" id="5795904">//&nbsp;then&nbsp;the&nbsp;generated&nbsp;test&nbsp;will&nbsp;call&nbsp;TestMain(m)&nbsp;instead&nbsp;of&nbsp;running&nbsp;the&nbsp;tests</span><br>
<span class="lineno"></span><span class="comment" id="5795982">//&nbsp;directly.&nbsp;TestMain&nbsp;runs&nbsp;in&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;and&nbsp;can&nbsp;do&nbsp;whatever&nbsp;setup</span><br>
<span class="lineno"></span><span class="comment" id="5796057">//&nbsp;and&nbsp;teardown&nbsp;is&nbsp;necessary&nbsp;around&nbsp;a&nbsp;call&nbsp;to&nbsp;m.Run.&nbsp;It&nbsp;should&nbsp;then&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="5796130">//&nbsp;os.Exit&nbsp;with&nbsp;the&nbsp;result&nbsp;of&nbsp;m.Run.</span><br>
<span class="lineno"></span><span class="comment" id="5796167">//</span><br>
<span class="lineno">135</span><span class="comment" id="5796170">//&nbsp;The&nbsp;minimal&nbsp;implementation&nbsp;of&nbsp;TestMain&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="5796216">//</span><br>
<span class="lineno"></span><span class="comment" id="5796219">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)&nbsp;{&nbsp;os.Exit(m.Run())&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5796271">//</span><br>
<span class="lineno"></span><span class="comment" id="5796274">//&nbsp;In&nbsp;effect,&nbsp;that&nbsp;is&nbsp;the&nbsp;implementation&nbsp;used&nbsp;when&nbsp;no&nbsp;TestMain&nbsp;is&nbsp;explicitly&nbsp;defined.</span><br>
<span class="lineno">140</span><span class="keyword" id="5796360">package</span>&nbsp;<span class="ident" id="5796368">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5796377">import</span>&nbsp;<span class="op" id="5796384">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5796387">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5796396">&#34;flag&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5796404">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5796411">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5796417">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5796428">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5796445">&#34;strconv&#34;</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5796456">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5796467">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5796475">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5796482">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="5796485">var</span>&nbsp;<span class="op" id="5796489">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5796492">//&nbsp;The&nbsp;short&nbsp;flag&nbsp;requests&nbsp;that&nbsp;tests&nbsp;run&nbsp;more&nbsp;quickly,&nbsp;but&nbsp;its&nbsp;functionality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5796571">//&nbsp;is&nbsp;provided&nbsp;by&nbsp;test&nbsp;writers&nbsp;themselves.&nbsp;&nbsp;The&nbsp;testing&nbsp;package&nbsp;is&nbsp;just&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5796648">//&nbsp;home.&nbsp;&nbsp;The&nbsp;all.bash&nbsp;installation&nbsp;script&nbsp;sets&nbsp;it&nbsp;to&nbsp;make&nbsp;installation&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5796726">//&nbsp;efficient,&nbsp;but&nbsp;by&nbsp;default&nbsp;the&nbsp;flag&nbsp;is&nbsp;off&nbsp;so&nbsp;a&nbsp;plain&nbsp;&#34;go&nbsp;test&#34;&nbsp;will&nbsp;do&nbsp;a</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5796803">//&nbsp;full&nbsp;test&nbsp;of&nbsp;the&nbsp;package.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5796833">short</span>&nbsp;<span class="op" id="5796839">=</span>&nbsp;<span class="ident" id="5796841">flag</span><span class="op" id="5796845">.</span><span class="ident" id="5796846">Bool</span><span class="op" id="5796850">(</span><span class="string" id="5796851">&#34;test.short&#34;</span><span class="op" id="5796863">,</span>&nbsp;<span class="builtintype" id="5796865">false</span><span class="op" id="5796870">,</span>&nbsp;<span class="string" id="5796872">&#34;run&nbsp;smaller&nbsp;test&nbsp;suite&nbsp;to&nbsp;save&nbsp;time&#34;</span><span class="op" id="5796909">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5796913">//&nbsp;The&nbsp;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;create&nbsp;profile&nbsp;files&nbsp;and&nbsp;the&nbsp;like.&nbsp;When&nbsp;run&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5796992">//&nbsp;&#34;go&nbsp;test&#34;,&nbsp;the&nbsp;binary&nbsp;always&nbsp;runs&nbsp;in&nbsp;the&nbsp;source&nbsp;directory&nbsp;for&nbsp;the&nbsp;package;</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5797071">//&nbsp;this&nbsp;flag&nbsp;lets&nbsp;&#34;go&nbsp;test&#34;&nbsp;tell&nbsp;the&nbsp;binary&nbsp;to&nbsp;write&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;directory&nbsp;where</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5797158">//&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797192">outputDir</span>&nbsp;<span class="op" id="5797202">=</span>&nbsp;<span class="ident" id="5797204">flag</span><span class="op" id="5797208">.</span><span class="ident" id="5797209">String</span><span class="op" id="5797215">(</span><span class="string" id="5797216">&#34;test.outputdir&#34;</span><span class="op" id="5797232">,</span>&nbsp;<span class="string" id="5797234">&#34;&#34;</span><span class="op" id="5797236">,</span>&nbsp;<span class="string" id="5797238">&#34;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;write&nbsp;profiles&#34;</span><span class="op" id="5797276">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5797280">//&nbsp;Report&nbsp;as&nbsp;tests&nbsp;are&nbsp;run;&nbsp;default&nbsp;is&nbsp;silent&nbsp;for&nbsp;success.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797340">chatty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5797357">=</span>&nbsp;<span class="ident" id="5797359">flag</span><span class="op" id="5797363">.</span><span class="ident" id="5797364">Bool</span><span class="op" id="5797368">(</span><span class="string" id="5797369">&#34;test.v&#34;</span><span class="op" id="5797377">,</span>&nbsp;<span class="builtintype" id="5797379">false</span><span class="op" id="5797384">,</span>&nbsp;<span class="string" id="5797386">&#34;verbose:&nbsp;print&nbsp;additional&nbsp;output&#34;</span><span class="op" id="5797420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797423">coverProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5797440">=</span>&nbsp;<span class="ident" id="5797442">flag</span><span class="op" id="5797446">.</span><span class="ident" id="5797447">String</span><span class="op" id="5797453">(</span><span class="string" id="5797454">&#34;test.coverprofile&#34;</span><span class="op" id="5797473">,</span>&nbsp;<span class="string" id="5797475">&#34;&#34;</span><span class="op" id="5797477">,</span>&nbsp;<span class="string" id="5797479">&#34;write&nbsp;a&nbsp;coverage&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="5797539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797542">match</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5797559">=</span>&nbsp;<span class="ident" id="5797561">flag</span><span class="op" id="5797565">.</span><span class="ident" id="5797566">String</span><span class="op" id="5797572">(</span><span class="string" id="5797573">&#34;test.run&#34;</span><span class="op" id="5797583">,</span>&nbsp;<span class="string" id="5797585">&#34;&#34;</span><span class="op" id="5797587">,</span>&nbsp;<span class="string" id="5797589">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;tests&nbsp;and&nbsp;examples&nbsp;to&nbsp;run&#34;</span><span class="op" id="5797645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797648">memProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5797665">=</span>&nbsp;<span class="ident" id="5797667">flag</span><span class="op" id="5797671">.</span><span class="ident" id="5797672">String</span><span class="op" id="5797678">(</span><span class="string" id="5797679">&#34;test.memprofile&#34;</span><span class="op" id="5797696">,</span>&nbsp;<span class="string" id="5797698">&#34;&#34;</span><span class="op" id="5797700">,</span>&nbsp;<span class="string" id="5797702">&#34;write&nbsp;a&nbsp;memory&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="5797760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797763">memProfileRate</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5797780">=</span>&nbsp;<span class="ident" id="5797782">flag</span><span class="op" id="5797786">.</span><span class="ident" id="5797787">Int</span><span class="op" id="5797790">(</span><span class="string" id="5797791">&#34;test.memprofilerate&#34;</span><span class="op" id="5797812">,</span>&nbsp;<span class="num" id="5797814">0</span><span class="op" id="5797815">,</span>&nbsp;<span class="string" id="5797817">&#34;if&nbsp;&gt;=0,&nbsp;sets&nbsp;runtime.MemProfileRate&#34;</span><span class="op" id="5797854">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797857">cpuProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5797874">=</span>&nbsp;<span class="ident" id="5797876">flag</span><span class="op" id="5797880">.</span><span class="ident" id="5797881">String</span><span class="op" id="5797887">(</span><span class="string" id="5797888">&#34;test.cpuprofile&#34;</span><span class="op" id="5797905">,</span>&nbsp;<span class="string" id="5797907">&#34;&#34;</span><span class="op" id="5797909">,</span>&nbsp;<span class="string" id="5797911">&#34;write&nbsp;a&nbsp;cpu&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;during&nbsp;execution&#34;</span><span class="op" id="5797967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797970">blockProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5797987">=</span>&nbsp;<span class="ident" id="5797989">flag</span><span class="op" id="5797993">.</span><span class="ident" id="5797994">String</span><span class="op" id="5798000">(</span><span class="string" id="5798001">&#34;test.blockprofile&#34;</span><span class="op" id="5798020">,</span>&nbsp;<span class="string" id="5798022">&#34;&#34;</span><span class="op" id="5798024">,</span>&nbsp;<span class="string" id="5798026">&#34;write&nbsp;a&nbsp;goroutine&nbsp;blocking&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="5798096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798099">blockProfileRate</span>&nbsp;<span class="op" id="5798116">=</span>&nbsp;<span class="ident" id="5798118">flag</span><span class="op" id="5798122">.</span><span class="ident" id="5798123">Int</span><span class="op" id="5798126">(</span><span class="string" id="5798127">&#34;test.blockprofilerate&#34;</span><span class="op" id="5798150">,</span>&nbsp;<span class="num" id="5798152">1</span><span class="op" id="5798153">,</span>&nbsp;<span class="string" id="5798155">&#34;if&nbsp;&gt;=&nbsp;0,&nbsp;calls&nbsp;runtime.SetBlockProfileRate()&#34;</span><span class="op" id="5798201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798204">timeout</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5798221">=</span>&nbsp;<span class="ident" id="5798223">flag</span><span class="op" id="5798227">.</span><span class="ident" id="5798228">Duration</span><span class="op" id="5798236">(</span><span class="string" id="5798237">&#34;test.timeout&#34;</span><span class="op" id="5798251">,</span>&nbsp;<span class="num" id="5798253">0</span><span class="op" id="5798254">,</span>&nbsp;<span class="string" id="5798256">&#34;if&nbsp;positive,&nbsp;sets&nbsp;an&nbsp;aggregate&nbsp;time&nbsp;limit&nbsp;for&nbsp;all&nbsp;tests&#34;</span><span class="op" id="5798313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798316">cpuListStr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5798333">=</span>&nbsp;<span class="ident" id="5798335">flag</span><span class="op" id="5798339">.</span><span class="ident" id="5798340">String</span><span class="op" id="5798346">(</span><span class="string" id="5798347">&#34;test.cpu&#34;</span><span class="op" id="5798357">,</span>&nbsp;<span class="string" id="5798359">&#34;&#34;</span><span class="op" id="5798361">,</span>&nbsp;<span class="string" id="5798363">&#34;comma-separated&nbsp;list&nbsp;of&nbsp;number&nbsp;of&nbsp;CPUs&nbsp;to&nbsp;use&nbsp;for&nbsp;each&nbsp;test&#34;</span><span class="op" id="5798424">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798427">parallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5798444">=</span>&nbsp;<span class="ident" id="5798446">flag</span><span class="op" id="5798450">.</span><span class="ident" id="5798451">Int</span><span class="op" id="5798454">(</span><span class="string" id="5798455">&#34;test.parallel&#34;</span><span class="op" id="5798470">,</span>&nbsp;<span class="ident" id="5798472">runtime</span><span class="op" id="5798479">.</span><span class="ident" id="5798480">GOMAXPROCS</span><span class="op" id="5798490">(</span><span class="num" id="5798491">0</span><span class="op" id="5798492">)</span><span class="op" id="5798493">,</span>&nbsp;<span class="string" id="5798495">&#34;maximum&nbsp;test&nbsp;parallelism&#34;</span><span class="op" id="5798521">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798525">haveExamples</span>&nbsp;<span class="builtintype" id="5798538">bool</span>&nbsp;<span class="comment" id="5798543">//&nbsp;are&nbsp;there&nbsp;examples?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798568">cpuList</span>&nbsp;<span class="op" id="5798576">[</span><span class="op" id="5798577">]</span><span class="builtintype" id="5798578">int</span><br>
<span class="lineno">185</span><span class="op" id="5798582">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5798585">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;elements&nbsp;common&nbsp;between&nbsp;T&nbsp;and&nbsp;B&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5798641">//&nbsp;captures&nbsp;common&nbsp;methods&nbsp;such&nbsp;as&nbsp;Errorf.</span><br>
<span class="lineno"></span><span class="keyword" id="5798684">type</span>&nbsp;<span class="ident" id="5798689">common</span>&nbsp;<span class="keyword" id="5798696">struct</span>&nbsp;<span class="op" id="5798703">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798706">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5798715">sync</span><span class="op" id="5798719">.</span><span class="ident" id="5798720">RWMutex</span>&nbsp;<span class="comment" id="5798728">//&nbsp;guards&nbsp;output&nbsp;and&nbsp;failed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798757">output</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5798766">[</span><span class="op" id="5798767">]</span><span class="builtintype" id="5798768">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5798779">//&nbsp;Output&nbsp;generated&nbsp;by&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798822">failed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5798831">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5798844">//&nbsp;Test&nbsp;or&nbsp;benchmark&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798878">skipped</span>&nbsp;&nbsp;<span class="builtintype" id="5798887">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5798900">//&nbsp;Test&nbsp;of&nbsp;benchmark&nbsp;has&nbsp;been&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798940">finished</span>&nbsp;<span class="builtintype" id="5798949">bool</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798956">start</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5798965">time</span><span class="op" id="5798969">.</span><span class="ident" id="5798970">Time</span>&nbsp;<span class="comment" id="5798975">//&nbsp;Time&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;started</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5799010">duration</span>&nbsp;<span class="ident" id="5799019">time</span><span class="op" id="5799023">.</span><span class="ident" id="5799024">Duration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5799034">self</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5799043">interface</span><span class="op" id="5799052">{</span><span class="op" id="5799053">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5799060">//&nbsp;To&nbsp;be&nbsp;sent&nbsp;on&nbsp;signal&nbsp;channel&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5799104">signal</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="5799113">chan</span>&nbsp;<span class="keyword" id="5799118">interface</span><span class="op" id="5799127">{</span><span class="op" id="5799128">}</span>&nbsp;<span class="comment" id="5799130">//&nbsp;Output&nbsp;for&nbsp;serial&nbsp;tests.</span><br>
<span class="lineno">200</span><span class="op" id="5799158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5799161">//&nbsp;Short&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.short&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="5799215">func</span>&nbsp;<span class="ident" id="5799220">Short</span><span class="op" id="5799225">(</span><span class="op" id="5799226">)</span>&nbsp;<span class="builtintype" id="5799228">bool</span>&nbsp;<span class="op" id="5799233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5799236">return</span>&nbsp;<span class="op" id="5799243">*</span><span class="ident" id="5799244">short</span><br>
<span class="lineno">205</span><span class="op" id="5799250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5799253">//&nbsp;Verbose&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="5799305">func</span>&nbsp;<span class="ident" id="5799310">Verbose</span><span class="op" id="5799317">(</span><span class="op" id="5799318">)</span>&nbsp;<span class="builtintype" id="5799320">bool</span>&nbsp;<span class="op" id="5799325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5799328">return</span>&nbsp;<span class="op" id="5799335">*</span><span class="ident" id="5799336">chatty</span><br>
<span class="lineno">210</span><span class="op" id="5799343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5799346">//&nbsp;decorate&nbsp;prefixes&nbsp;the&nbsp;string&nbsp;with&nbsp;the&nbsp;file&nbsp;and&nbsp;line&nbsp;of&nbsp;the&nbsp;call&nbsp;site</span><br>
<span class="lineno"></span><span class="comment" id="5799418">//&nbsp;and&nbsp;inserts&nbsp;the&nbsp;final&nbsp;newline&nbsp;if&nbsp;needed&nbsp;and&nbsp;indentation&nbsp;tabs&nbsp;for&nbsp;formatting.</span><br>
<span class="lineno"></span><span class="keyword" id="5799498">func</span>&nbsp;<span class="ident" id="5799503">decorate</span><span class="op" id="5799511">(</span><span class="ident" id="5799512">s</span>&nbsp;<span class="builtintype" id="5799514">string</span><span class="op" id="5799520">)</span>&nbsp;<span class="builtintype" id="5799522">string</span>&nbsp;<span class="op" id="5799529">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5799532">_</span><span class="op" id="5799533">,</span>&nbsp;<span class="ident" id="5799535">file</span><span class="op" id="5799539">,</span>&nbsp;<span class="ident" id="5799541">line</span><span class="op" id="5799545">,</span>&nbsp;<span class="ident" id="5799547">ok</span>&nbsp;<span class="op" id="5799550">:=</span>&nbsp;<span class="ident" id="5799553">runtime</span><span class="op" id="5799560">.</span><span class="ident" id="5799561">Caller</span><span class="op" id="5799567">(</span><span class="num" id="5799568">3</span><span class="op" id="5799569">)</span>&nbsp;<span class="comment" id="5799571">//&nbsp;decorate&nbsp;+&nbsp;log&nbsp;+&nbsp;public&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5799609">if</span>&nbsp;<span class="ident" id="5799612">ok</span>&nbsp;<span class="op" id="5799615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5799619">//&nbsp;Truncate&nbsp;file&nbsp;name&nbsp;at&nbsp;last&nbsp;file&nbsp;name&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5799672">if</span>&nbsp;<span class="ident" id="5799675">index</span>&nbsp;<span class="op" id="5799681">:=</span>&nbsp;<span class="ident" id="5799684">strings</span><span class="op" id="5799691">.</span><span class="ident" id="5799692">LastIndex</span><span class="op" id="5799701">(</span><span class="ident" id="5799702">file</span><span class="op" id="5799706">,</span>&nbsp;<span class="string" id="5799708">&#34;/&#34;</span><span class="op" id="5799711">)</span><span class="op" id="5799712">;</span>&nbsp;<span class="ident" id="5799714">index</span>&nbsp;<span class="op" id="5799720">&gt;=</span>&nbsp;<span class="num" id="5799723">0</span>&nbsp;<span class="op" id="5799725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5799730">file</span>&nbsp;<span class="op" id="5799735">=</span>&nbsp;<span class="ident" id="5799737">file</span><span class="op" id="5799741">[</span><span class="ident" id="5799742">index</span><span class="op" id="5799747">+</span><span class="num" id="5799748">1</span><span class="op" id="5799749">:</span><span class="op" id="5799750">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5799754">}</span>&nbsp;<span class="keyword" id="5799756">else</span>&nbsp;<span class="keyword" id="5799761">if</span>&nbsp;<span class="ident" id="5799764">index</span>&nbsp;<span class="op" id="5799770">=</span>&nbsp;<span class="ident" id="5799772">strings</span><span class="op" id="5799779">.</span><span class="ident" id="5799780">LastIndex</span><span class="op" id="5799789">(</span><span class="ident" id="5799790">file</span><span class="op" id="5799794">,</span>&nbsp;<span class="string" id="5799796">&#34;\\&#34;</span><span class="op" id="5799800">)</span><span class="op" id="5799801">;</span>&nbsp;<span class="ident" id="5799803">index</span>&nbsp;<span class="op" id="5799809">&gt;=</span>&nbsp;<span class="num" id="5799812">0</span>&nbsp;<span class="op" id="5799814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5799819">file</span>&nbsp;<span class="op" id="5799824">=</span>&nbsp;<span class="ident" id="5799826">file</span><span class="op" id="5799830">[</span><span class="ident" id="5799831">index</span><span class="op" id="5799836">+</span><span class="num" id="5799837">1</span><span class="op" id="5799838">:</span><span class="op" id="5799839">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5799843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5799846">}</span>&nbsp;<span class="keyword" id="5799848">else</span>&nbsp;<span class="op" id="5799853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5799857">file</span>&nbsp;<span class="op" id="5799862">=</span>&nbsp;<span class="string" id="5799864">&#34;???&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5799872">line</span>&nbsp;<span class="op" id="5799877">=</span>&nbsp;<span class="num" id="5799879">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5799882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5799885">buf</span>&nbsp;<span class="op" id="5799889">:=</span>&nbsp;<span class="builtinfunc" id="5799892">new</span><span class="op" id="5799895">(</span><span class="ident" id="5799896">bytes</span><span class="op" id="5799901">.</span><span class="ident" id="5799902">Buffer</span><span class="op" id="5799908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5799911">//&nbsp;Every&nbsp;line&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5799956">buf</span><span class="op" id="5799959">.</span><span class="ident" id="5799960">WriteByte</span><span class="op" id="5799969">(</span><span class="string" id="5799970">&#39;\t&#39;</span><span class="op" id="5799974">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5799977">fmt</span><span class="op" id="5799980">.</span><span class="ident" id="5799981">Fprintf</span><span class="op" id="5799988">(</span><span class="ident" id="5799989">buf</span><span class="op" id="5799992">,</span>&nbsp;<span class="string" id="5799994">&#34;%s:%d:&nbsp;&#34;</span><span class="op" id="5800003">,</span>&nbsp;<span class="ident" id="5800005">file</span><span class="op" id="5800009">,</span>&nbsp;<span class="ident" id="5800011">line</span><span class="op" id="5800015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800018">lines</span>&nbsp;<span class="op" id="5800024">:=</span>&nbsp;<span class="ident" id="5800027">strings</span><span class="op" id="5800034">.</span><span class="ident" id="5800035">Split</span><span class="op" id="5800040">(</span><span class="ident" id="5800041">s</span><span class="op" id="5800042">,</span>&nbsp;<span class="string" id="5800044">&#34;\n&#34;</span><span class="op" id="5800048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5800051">if</span>&nbsp;<span class="ident" id="5800054">l</span>&nbsp;<span class="op" id="5800056">:=</span>&nbsp;<span class="builtinfunc" id="5800059">len</span><span class="op" id="5800062">(</span><span class="ident" id="5800063">lines</span><span class="op" id="5800068">)</span><span class="op" id="5800069">;</span>&nbsp;<span class="ident" id="5800071">l</span>&nbsp;<span class="op" id="5800073">&gt;</span>&nbsp;<span class="num" id="5800075">1</span>&nbsp;<span class="op" id="5800077">&amp;&amp;</span>&nbsp;<span class="ident" id="5800080">lines</span><span class="op" id="5800085">[</span><span class="ident" id="5800086">l</span><span class="op" id="5800087">-</span><span class="num" id="5800088">1</span><span class="op" id="5800089">]</span>&nbsp;<span class="op" id="5800091">==</span>&nbsp;<span class="string" id="5800094">&#34;&#34;</span>&nbsp;<span class="op" id="5800097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800101">lines</span>&nbsp;<span class="op" id="5800107">=</span>&nbsp;<span class="ident" id="5800109">lines</span><span class="op" id="5800114">[</span><span class="op" id="5800115">:</span><span class="ident" id="5800116">l</span><span class="op" id="5800117">-</span><span class="num" id="5800118">1</span><span class="op" id="5800119">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5800122">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5800125">for</span>&nbsp;<span class="ident" id="5800129">i</span><span class="op" id="5800130">,</span>&nbsp;<span class="ident" id="5800132">line</span>&nbsp;<span class="op" id="5800137">:=</span>&nbsp;<span class="keyword" id="5800140">range</span>&nbsp;<span class="ident" id="5800146">lines</span>&nbsp;<span class="op" id="5800152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5800156">if</span>&nbsp;<span class="ident" id="5800159">i</span>&nbsp;<span class="op" id="5800161">&gt;</span>&nbsp;<span class="num" id="5800163">0</span>&nbsp;<span class="op" id="5800165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5800170">//&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;lines&nbsp;are&nbsp;indented&nbsp;an&nbsp;extra&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800231">buf</span><span class="op" id="5800234">.</span><span class="ident" id="5800235">WriteString</span><span class="op" id="5800246">(</span><span class="string" id="5800247">&#34;\n\t\t&#34;</span><span class="op" id="5800255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5800259">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800263">buf</span><span class="op" id="5800266">.</span><span class="ident" id="5800267">WriteString</span><span class="op" id="5800278">(</span><span class="ident" id="5800279">line</span><span class="op" id="5800283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5800286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800289">buf</span><span class="op" id="5800292">.</span><span class="ident" id="5800293">WriteByte</span><span class="op" id="5800302">(</span><span class="string" id="5800303">&#39;\n&#39;</span><span class="op" id="5800307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5800310">return</span>&nbsp;<span class="ident" id="5800317">buf</span><span class="op" id="5800320">.</span><span class="ident" id="5800321">String</span><span class="op" id="5800327">(</span><span class="op" id="5800328">)</span><br>
<span class="lineno"></span><span class="op" id="5800330">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="5800333">//&nbsp;fmtDuration&nbsp;returns&nbsp;a&nbsp;string&nbsp;representing&nbsp;d&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;87.00s&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5800402">func</span>&nbsp;<span class="ident" id="5800407">fmtDuration</span><span class="op" id="5800418">(</span><span class="ident" id="5800419">d</span>&nbsp;<span class="ident" id="5800421">time</span><span class="op" id="5800425">.</span><span class="ident" id="5800426">Duration</span><span class="op" id="5800434">)</span>&nbsp;<span class="builtintype" id="5800436">string</span>&nbsp;<span class="op" id="5800443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5800446">return</span>&nbsp;<span class="ident" id="5800453">fmt</span><span class="op" id="5800456">.</span><span class="ident" id="5800457">Sprintf</span><span class="op" id="5800464">(</span><span class="string" id="5800465">&#34;%.2fs&#34;</span><span class="op" id="5800472">,</span>&nbsp;<span class="ident" id="5800474">d</span><span class="op" id="5800475">.</span><span class="ident" id="5800476">Seconds</span><span class="op" id="5800483">(</span><span class="op" id="5800484">)</span><span class="op" id="5800485">)</span><br>
<span class="lineno"></span><span class="op" id="5800487">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="comment" id="5800490">//&nbsp;TB&nbsp;is&nbsp;the&nbsp;interface&nbsp;common&nbsp;to&nbsp;T&nbsp;and&nbsp;B.</span><br>
<span class="lineno"></span><span class="keyword" id="5800532">type</span>&nbsp;<span class="ident" id="5800537">TB</span>&nbsp;<span class="keyword" id="5800540">interface</span>&nbsp;<span class="op" id="5800550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800553">Error</span><span class="op" id="5800558">(</span><span class="ident" id="5800559">args</span>&nbsp;<span class="op" id="5800564">...</span><span class="keyword" id="5800567">interface</span><span class="op" id="5800576">{</span><span class="op" id="5800577">}</span><span class="op" id="5800578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800581">Errorf</span><span class="op" id="5800587">(</span><span class="ident" id="5800588">format</span>&nbsp;<span class="builtintype" id="5800595">string</span><span class="op" id="5800601">,</span>&nbsp;<span class="ident" id="5800603">args</span>&nbsp;<span class="op" id="5800608">...</span><span class="keyword" id="5800611">interface</span><span class="op" id="5800620">{</span><span class="op" id="5800621">}</span><span class="op" id="5800622">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800625">Fail</span><span class="op" id="5800629">(</span><span class="op" id="5800630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800633">FailNow</span><span class="op" id="5800640">(</span><span class="op" id="5800641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800644">Failed</span><span class="op" id="5800650">(</span><span class="op" id="5800651">)</span>&nbsp;<span class="builtintype" id="5800653">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800659">Fatal</span><span class="op" id="5800664">(</span><span class="ident" id="5800665">args</span>&nbsp;<span class="op" id="5800670">...</span><span class="keyword" id="5800673">interface</span><span class="op" id="5800682">{</span><span class="op" id="5800683">}</span><span class="op" id="5800684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800687">Fatalf</span><span class="op" id="5800693">(</span><span class="ident" id="5800694">format</span>&nbsp;<span class="builtintype" id="5800701">string</span><span class="op" id="5800707">,</span>&nbsp;<span class="ident" id="5800709">args</span>&nbsp;<span class="op" id="5800714">...</span><span class="keyword" id="5800717">interface</span><span class="op" id="5800726">{</span><span class="op" id="5800727">}</span><span class="op" id="5800728">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800731">Log</span><span class="op" id="5800734">(</span><span class="ident" id="5800735">args</span>&nbsp;<span class="op" id="5800740">...</span><span class="keyword" id="5800743">interface</span><span class="op" id="5800752">{</span><span class="op" id="5800753">}</span><span class="op" id="5800754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800757">Logf</span><span class="op" id="5800761">(</span><span class="ident" id="5800762">format</span>&nbsp;<span class="builtintype" id="5800769">string</span><span class="op" id="5800775">,</span>&nbsp;<span class="ident" id="5800777">args</span>&nbsp;<span class="op" id="5800782">...</span><span class="keyword" id="5800785">interface</span><span class="op" id="5800794">{</span><span class="op" id="5800795">}</span><span class="op" id="5800796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800799">Skip</span><span class="op" id="5800803">(</span><span class="ident" id="5800804">args</span>&nbsp;<span class="op" id="5800809">...</span><span class="keyword" id="5800812">interface</span><span class="op" id="5800821">{</span><span class="op" id="5800822">}</span><span class="op" id="5800823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800826">SkipNow</span><span class="op" id="5800833">(</span><span class="op" id="5800834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800837">Skipf</span><span class="op" id="5800842">(</span><span class="ident" id="5800843">format</span>&nbsp;<span class="builtintype" id="5800850">string</span><span class="op" id="5800856">,</span>&nbsp;<span class="ident" id="5800858">args</span>&nbsp;<span class="op" id="5800863">...</span><span class="keyword" id="5800866">interface</span><span class="op" id="5800875">{</span><span class="op" id="5800876">}</span><span class="op" id="5800877">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800880">Skipped</span><span class="op" id="5800887">(</span><span class="op" id="5800888">)</span>&nbsp;<span class="builtintype" id="5800890">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5800897">//&nbsp;A&nbsp;private&nbsp;method&nbsp;to&nbsp;prevent&nbsp;users&nbsp;implementing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5800952">//&nbsp;interface&nbsp;and&nbsp;so&nbsp;future&nbsp;additions&nbsp;to&nbsp;it&nbsp;will&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5801005">//&nbsp;violate&nbsp;Go&nbsp;1&nbsp;compatibility.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5801037">private</span><span class="op" id="5801044">(</span><span class="op" id="5801045">)</span><br>
<span class="lineno"></span><span class="op" id="5801047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5801050">var</span>&nbsp;<span class="ident" id="5801054">_</span>&nbsp;<span class="ident" id="5801056">TB</span>&nbsp;<span class="op" id="5801059">=</span>&nbsp;<span class="op" id="5801061">(</span><span class="op" id="5801062">*</span><span class="ident" id="5801063">T</span><span class="op" id="5801064">)</span><span class="op" id="5801065">(</span><span class="ident" id="5801066">nil</span><span class="op" id="5801069">)</span><br>
<span class="lineno"></span><span class="keyword" id="5801071">var</span>&nbsp;<span class="ident" id="5801075">_</span>&nbsp;<span class="ident" id="5801077">TB</span>&nbsp;<span class="op" id="5801080">=</span>&nbsp;<span class="op" id="5801082">(</span><span class="op" id="5801083">*</span><span class="ident" id="5801084">B</span><span class="op" id="5801085">)</span><span class="op" id="5801086">(</span><span class="ident" id="5801087">nil</span><span class="op" id="5801090">)</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="5801093">//&nbsp;T&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Test&nbsp;functions&nbsp;to&nbsp;manage&nbsp;test&nbsp;state&nbsp;and&nbsp;support&nbsp;formatted&nbsp;test&nbsp;logs.</span><br>
<span class="lineno"></span><span class="comment" id="5801187">//&nbsp;Logs&nbsp;are&nbsp;accumulated&nbsp;during&nbsp;execution&nbsp;and&nbsp;dumped&nbsp;to&nbsp;standard&nbsp;error&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="5801268">type</span>&nbsp;<span class="ident" id="5801273">T</span>&nbsp;<span class="keyword" id="5801275">struct</span>&nbsp;<span class="op" id="5801282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5801285">common</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5801293">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5801307">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5801317">//&nbsp;Name&nbsp;of&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5801335">startParallel</span>&nbsp;<span class="keyword" id="5801349">chan</span>&nbsp;<span class="builtintype" id="5801354">bool</span>&nbsp;<span class="comment" id="5801359">//&nbsp;Parallel&nbsp;tests&nbsp;will&nbsp;wait&nbsp;on&nbsp;this.</span><br>
<span class="lineno"></span><span class="op" id="5801396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5801399">func</span>&nbsp;<span class="op" id="5801404">(</span><span class="ident" id="5801405">c</span>&nbsp;<span class="op" id="5801407">*</span><span class="ident" id="5801408">common</span><span class="op" id="5801414">)</span>&nbsp;<span class="ident" id="5801416">private</span><span class="op" id="5801423">(</span><span class="op" id="5801424">)</span>&nbsp;<span class="op" id="5801426">{</span><span class="op" id="5801427">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="5801430">//&nbsp;Fail&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;but&nbsp;continues&nbsp;execution.</span><br>
<span class="lineno"></span><span class="keyword" id="5801499">func</span>&nbsp;<span class="op" id="5801504">(</span><span class="ident" id="5801505">c</span>&nbsp;<span class="op" id="5801507">*</span><span class="ident" id="5801508">common</span><span class="op" id="5801514">)</span>&nbsp;<span class="ident" id="5801516">Fail</span><span class="op" id="5801520">(</span><span class="op" id="5801521">)</span>&nbsp;<span class="op" id="5801523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5801526">c</span><span class="op" id="5801527">.</span><span class="ident" id="5801528">mu</span><span class="op" id="5801530">.</span><span class="ident" id="5801531">Lock</span><span class="op" id="5801535">(</span><span class="op" id="5801536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5801539">defer</span>&nbsp;<span class="ident" id="5801545">c</span><span class="op" id="5801546">.</span><span class="ident" id="5801547">mu</span><span class="op" id="5801549">.</span><span class="ident" id="5801550">Unlock</span><span class="op" id="5801556">(</span><span class="op" id="5801557">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5801560">c</span><span class="op" id="5801561">.</span><span class="ident" id="5801562">failed</span>&nbsp;<span class="op" id="5801569">=</span>&nbsp;<span class="builtintype" id="5801571">true</span><br>
<span class="lineno"></span><span class="op" id="5801576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5801579">//&nbsp;Failed&nbsp;reports&nbsp;whether&nbsp;the&nbsp;function&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="5801630">func</span>&nbsp;<span class="op" id="5801635">(</span><span class="ident" id="5801636">c</span>&nbsp;<span class="op" id="5801638">*</span><span class="ident" id="5801639">common</span><span class="op" id="5801645">)</span>&nbsp;<span class="ident" id="5801647">Failed</span><span class="op" id="5801653">(</span><span class="op" id="5801654">)</span>&nbsp;<span class="builtintype" id="5801656">bool</span>&nbsp;<span class="op" id="5801661">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5801664">c</span><span class="op" id="5801665">.</span><span class="ident" id="5801666">mu</span><span class="op" id="5801668">.</span><span class="ident" id="5801669">RLock</span><span class="op" id="5801674">(</span><span class="op" id="5801675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5801678">defer</span>&nbsp;<span class="ident" id="5801684">c</span><span class="op" id="5801685">.</span><span class="ident" id="5801686">mu</span><span class="op" id="5801688">.</span><span class="ident" id="5801689">RUnlock</span><span class="op" id="5801696">(</span><span class="op" id="5801697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5801700">return</span>&nbsp;<span class="ident" id="5801707">c</span><span class="op" id="5801708">.</span><span class="ident" id="5801709">failed</span><br>
<span class="lineno"></span><span class="op" id="5801716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="5801719">//&nbsp;FailNow&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="5801791">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span><span class="comment" id="5801849">//&nbsp;FailNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5801906">//&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;function,&nbsp;not&nbsp;from&nbsp;other&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="5801963">//&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;FailNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno">305</span><span class="comment" id="5802021">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="5802048">func</span>&nbsp;<span class="op" id="5802053">(</span><span class="ident" id="5802054">c</span>&nbsp;<span class="op" id="5802056">*</span><span class="ident" id="5802057">common</span><span class="op" id="5802063">)</span>&nbsp;<span class="ident" id="5802065">FailNow</span><span class="op" id="5802072">(</span><span class="op" id="5802073">)</span>&nbsp;<span class="op" id="5802075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5802078">c</span><span class="op" id="5802079">.</span><span class="ident" id="5802080">Fail</span><span class="op" id="5802084">(</span><span class="op" id="5802085">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802089">//&nbsp;Calling&nbsp;runtime.Goexit&nbsp;will&nbsp;exit&nbsp;the&nbsp;goroutine,&nbsp;which</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802147">//&nbsp;will&nbsp;run&nbsp;the&nbsp;deferred&nbsp;functions&nbsp;in&nbsp;this&nbsp;goroutine,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802202">//&nbsp;which&nbsp;will&nbsp;eventually&nbsp;run&nbsp;the&nbsp;deferred&nbsp;lines&nbsp;in&nbsp;tRunner,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802263">//&nbsp;which&nbsp;will&nbsp;signal&nbsp;to&nbsp;the&nbsp;test&nbsp;loop&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802326">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802330">//&nbsp;A&nbsp;previous&nbsp;version&nbsp;of&nbsp;this&nbsp;code&nbsp;said:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802372">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802376">//&nbsp;&nbsp;&nbsp;&nbspc.duration&nbsp;=&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802397">//&nbsp;&nbsp;&nbsp;&nbspc.signal&nbsp;&lt;-&nbsp;c.self</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802420">//&nbsp;&nbsp;&nbsp;&nbspruntime.Goexit()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802441">//</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802445">//&nbsp;This&nbsp;previous&nbsp;version&nbsp;duplicated&nbsp;code&nbsp;(those&nbsp;lines&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802507">//&nbsp;tRunner&nbsp;no&nbsp;matter&nbsp;what),&nbsp;but&nbsp;worse&nbsp;the&nbsp;goroutine&nbsp;teardown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802569">//&nbsp;implicit&nbsp;in&nbsp;runtime.Goexit&nbsp;was&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802631">//&nbsp;before&nbsp;the&nbsp;test&nbsp;exited.&nbsp;&nbsp;If&nbsp;a&nbsp;test&nbsp;deferred&nbsp;an&nbsp;important&nbsp;cleanup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802700">//&nbsp;function&nbsp;(like&nbsp;removing&nbsp;temporary&nbsp;files),&nbsp;there&nbsp;was&nbsp;no&nbsp;guarantee</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802769">//&nbsp;it&nbsp;would&nbsp;run&nbsp;on&nbsp;a&nbsp;test&nbsp;failure.&nbsp;&nbsp;Because&nbsp;we&nbsp;send&nbsp;on&nbsp;c.signal&nbsp;during</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802841">//&nbsp;a&nbsp;top-of-stack&nbsp;deferred&nbsp;function&nbsp;now,&nbsp;we&nbsp;know&nbsp;that&nbsp;the&nbsp;send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802905">//&nbsp;only&nbsp;happens&nbsp;after&nbsp;any&nbsp;other&nbsp;stacked&nbsp;defers&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5802969">c</span><span class="op" id="5802970">.</span><span class="ident" id="5802971">finished</span>&nbsp;<span class="op" id="5802980">=</span>&nbsp;<span class="builtintype" id="5802982">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5802988">runtime</span><span class="op" id="5802995">.</span><span class="ident" id="5802996">Goexit</span><span class="op" id="5803002">(</span><span class="op" id="5803003">)</span><br>
<span class="lineno">330</span><span class="op" id="5803005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5803008">//&nbsp;log&nbsp;generates&nbsp;the&nbsp;output.&nbsp;It&#39;s&nbsp;always&nbsp;at&nbsp;the&nbsp;same&nbsp;stack&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5803074">func</span>&nbsp;<span class="op" id="5803079">(</span><span class="ident" id="5803080">c</span>&nbsp;<span class="op" id="5803082">*</span><span class="ident" id="5803083">common</span><span class="op" id="5803089">)</span>&nbsp;<span class="ident" id="5803091">log</span><span class="op" id="5803094">(</span><span class="ident" id="5803095">s</span>&nbsp;<span class="builtintype" id="5803097">string</span><span class="op" id="5803103">)</span>&nbsp;<span class="op" id="5803105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5803108">c</span><span class="op" id="5803109">.</span><span class="ident" id="5803110">mu</span><span class="op" id="5803112">.</span><span class="ident" id="5803113">Lock</span><span class="op" id="5803117">(</span><span class="op" id="5803118">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5803121">defer</span>&nbsp;<span class="ident" id="5803127">c</span><span class="op" id="5803128">.</span><span class="ident" id="5803129">mu</span><span class="op" id="5803131">.</span><span class="ident" id="5803132">Unlock</span><span class="op" id="5803138">(</span><span class="op" id="5803139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5803142">c</span><span class="op" id="5803143">.</span><span class="ident" id="5803144">output</span>&nbsp;<span class="op" id="5803151">=</span>&nbsp;<span class="builtinfunc" id="5803153">append</span><span class="op" id="5803159">(</span><span class="ident" id="5803160">c</span><span class="op" id="5803161">.</span><span class="ident" id="5803162">output</span><span class="op" id="5803168">,</span>&nbsp;<span class="ident" id="5803170">decorate</span><span class="op" id="5803178">(</span><span class="ident" id="5803179">s</span><span class="op" id="5803180">)</span><span class="op" id="5803181">...</span><span class="op" id="5803184">)</span><br>
<span class="lineno"></span><span class="op" id="5803186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5803189">//&nbsp;Log&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;using&nbsp;default&nbsp;formatting,&nbsp;analogous&nbsp;to&nbsp;Println,</span><br>
<span class="lineno">340</span><span class="comment" id="5803266">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5803341">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="5803387">func</span>&nbsp;<span class="op" id="5803392">(</span><span class="ident" id="5803393">c</span>&nbsp;<span class="op" id="5803395">*</span><span class="ident" id="5803396">common</span><span class="op" id="5803402">)</span>&nbsp;<span class="ident" id="5803404">Log</span><span class="op" id="5803407">(</span><span class="ident" id="5803408">args</span>&nbsp;<span class="op" id="5803413">...</span><span class="keyword" id="5803416">interface</span><span class="op" id="5803425">{</span><span class="op" id="5803426">}</span><span class="op" id="5803427">)</span>&nbsp;<span class="op" id="5803429">{</span>&nbsp;<span class="ident" id="5803431">c</span><span class="op" id="5803432">.</span><span class="ident" id="5803433">log</span><span class="op" id="5803436">(</span><span class="ident" id="5803437">fmt</span><span class="op" id="5803440">.</span><span class="ident" id="5803441">Sprintln</span><span class="op" id="5803449">(</span><span class="ident" id="5803450">args</span><span class="op" id="5803454">...</span><span class="op" id="5803457">)</span><span class="op" id="5803458">)</span>&nbsp;<span class="op" id="5803460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5803463">//&nbsp;Logf&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;according&nbsp;to&nbsp;the&nbsp;format,&nbsp;analogous&nbsp;to&nbsp;Printf,</span><br>
<span class="lineno">345</span><span class="comment" id="5803539">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5803614">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="5803660">func</span>&nbsp;<span class="op" id="5803665">(</span><span class="ident" id="5803666">c</span>&nbsp;<span class="op" id="5803668">*</span><span class="ident" id="5803669">common</span><span class="op" id="5803675">)</span>&nbsp;<span class="ident" id="5803677">Logf</span><span class="op" id="5803681">(</span><span class="ident" id="5803682">format</span>&nbsp;<span class="builtintype" id="5803689">string</span><span class="op" id="5803695">,</span>&nbsp;<span class="ident" id="5803697">args</span>&nbsp;<span class="op" id="5803702">...</span><span class="keyword" id="5803705">interface</span><span class="op" id="5803714">{</span><span class="op" id="5803715">}</span><span class="op" id="5803716">)</span>&nbsp;<span class="op" id="5803718">{</span>&nbsp;<span class="ident" id="5803720">c</span><span class="op" id="5803721">.</span><span class="ident" id="5803722">log</span><span class="op" id="5803725">(</span><span class="ident" id="5803726">fmt</span><span class="op" id="5803729">.</span><span class="ident" id="5803730">Sprintf</span><span class="op" id="5803737">(</span><span class="ident" id="5803738">format</span><span class="op" id="5803744">,</span>&nbsp;<span class="ident" id="5803746">args</span><span class="op" id="5803750">...</span><span class="op" id="5803753">)</span><span class="op" id="5803754">)</span>&nbsp;<span class="op" id="5803756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5803759">//&nbsp;Error&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno">350</span><span class="keyword" id="5803807">func</span>&nbsp;<span class="op" id="5803812">(</span><span class="ident" id="5803813">c</span>&nbsp;<span class="op" id="5803815">*</span><span class="ident" id="5803816">common</span><span class="op" id="5803822">)</span>&nbsp;<span class="ident" id="5803824">Error</span><span class="op" id="5803829">(</span><span class="ident" id="5803830">args</span>&nbsp;<span class="op" id="5803835">...</span><span class="keyword" id="5803838">interface</span><span class="op" id="5803847">{</span><span class="op" id="5803848">}</span><span class="op" id="5803849">)</span>&nbsp;<span class="op" id="5803851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5803854">c</span><span class="op" id="5803855">.</span><span class="ident" id="5803856">log</span><span class="op" id="5803859">(</span><span class="ident" id="5803860">fmt</span><span class="op" id="5803863">.</span><span class="ident" id="5803864">Sprintln</span><span class="op" id="5803872">(</span><span class="ident" id="5803873">args</span><span class="op" id="5803877">...</span><span class="op" id="5803880">)</span><span class="op" id="5803881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5803884">c</span><span class="op" id="5803885">.</span><span class="ident" id="5803886">Fail</span><span class="op" id="5803890">(</span><span class="op" id="5803891">)</span><br>
<span class="lineno"></span><span class="op" id="5803893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="5803896">//&nbsp;Errorf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno"></span><span class="keyword" id="5803946">func</span>&nbsp;<span class="op" id="5803951">(</span><span class="ident" id="5803952">c</span>&nbsp;<span class="op" id="5803954">*</span><span class="ident" id="5803955">common</span><span class="op" id="5803961">)</span>&nbsp;<span class="ident" id="5803963">Errorf</span><span class="op" id="5803969">(</span><span class="ident" id="5803970">format</span>&nbsp;<span class="builtintype" id="5803977">string</span><span class="op" id="5803983">,</span>&nbsp;<span class="ident" id="5803985">args</span>&nbsp;<span class="op" id="5803990">...</span><span class="keyword" id="5803993">interface</span><span class="op" id="5804002">{</span><span class="op" id="5804003">}</span><span class="op" id="5804004">)</span>&nbsp;<span class="op" id="5804006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804009">c</span><span class="op" id="5804010">.</span><span class="ident" id="5804011">log</span><span class="op" id="5804014">(</span><span class="ident" id="5804015">fmt</span><span class="op" id="5804018">.</span><span class="ident" id="5804019">Sprintf</span><span class="op" id="5804026">(</span><span class="ident" id="5804027">format</span><span class="op" id="5804033">,</span>&nbsp;<span class="ident" id="5804035">args</span><span class="op" id="5804039">...</span><span class="op" id="5804042">)</span><span class="op" id="5804043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804046">c</span><span class="op" id="5804047">.</span><span class="ident" id="5804048">Fail</span><span class="op" id="5804052">(</span><span class="op" id="5804053">)</span><br>
<span class="lineno"></span><span class="op" id="5804055">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="5804058">//&nbsp;Fatal&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="5804109">func</span>&nbsp;<span class="op" id="5804114">(</span><span class="ident" id="5804115">c</span>&nbsp;<span class="op" id="5804117">*</span><span class="ident" id="5804118">common</span><span class="op" id="5804124">)</span>&nbsp;<span class="ident" id="5804126">Fatal</span><span class="op" id="5804131">(</span><span class="ident" id="5804132">args</span>&nbsp;<span class="op" id="5804137">...</span><span class="keyword" id="5804140">interface</span><span class="op" id="5804149">{</span><span class="op" id="5804150">}</span><span class="op" id="5804151">)</span>&nbsp;<span class="op" id="5804153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804156">c</span><span class="op" id="5804157">.</span><span class="ident" id="5804158">log</span><span class="op" id="5804161">(</span><span class="ident" id="5804162">fmt</span><span class="op" id="5804165">.</span><span class="ident" id="5804166">Sprintln</span><span class="op" id="5804174">(</span><span class="ident" id="5804175">args</span><span class="op" id="5804179">...</span><span class="op" id="5804182">)</span><span class="op" id="5804183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804186">c</span><span class="op" id="5804187">.</span><span class="ident" id="5804188">FailNow</span><span class="op" id="5804195">(</span><span class="op" id="5804196">)</span><br>
<span class="lineno">365</span><span class="op" id="5804198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5804201">//&nbsp;Fatalf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="5804254">func</span>&nbsp;<span class="op" id="5804259">(</span><span class="ident" id="5804260">c</span>&nbsp;<span class="op" id="5804262">*</span><span class="ident" id="5804263">common</span><span class="op" id="5804269">)</span>&nbsp;<span class="ident" id="5804271">Fatalf</span><span class="op" id="5804277">(</span><span class="ident" id="5804278">format</span>&nbsp;<span class="builtintype" id="5804285">string</span><span class="op" id="5804291">,</span>&nbsp;<span class="ident" id="5804293">args</span>&nbsp;<span class="op" id="5804298">...</span><span class="keyword" id="5804301">interface</span><span class="op" id="5804310">{</span><span class="op" id="5804311">}</span><span class="op" id="5804312">)</span>&nbsp;<span class="op" id="5804314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804317">c</span><span class="op" id="5804318">.</span><span class="ident" id="5804319">log</span><span class="op" id="5804322">(</span><span class="ident" id="5804323">fmt</span><span class="op" id="5804326">.</span><span class="ident" id="5804327">Sprintf</span><span class="op" id="5804334">(</span><span class="ident" id="5804335">format</span><span class="op" id="5804341">,</span>&nbsp;<span class="ident" id="5804343">args</span><span class="op" id="5804347">...</span><span class="op" id="5804350">)</span><span class="op" id="5804351">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804354">c</span><span class="op" id="5804355">.</span><span class="ident" id="5804356">FailNow</span><span class="op" id="5804363">(</span><span class="op" id="5804364">)</span><br>
<span class="lineno"></span><span class="op" id="5804366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5804369">//&nbsp;Skip&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno"></span><span class="keyword" id="5804419">func</span>&nbsp;<span class="op" id="5804424">(</span><span class="ident" id="5804425">c</span>&nbsp;<span class="op" id="5804427">*</span><span class="ident" id="5804428">common</span><span class="op" id="5804434">)</span>&nbsp;<span class="ident" id="5804436">Skip</span><span class="op" id="5804440">(</span><span class="ident" id="5804441">args</span>&nbsp;<span class="op" id="5804446">...</span><span class="keyword" id="5804449">interface</span><span class="op" id="5804458">{</span><span class="op" id="5804459">}</span><span class="op" id="5804460">)</span>&nbsp;<span class="op" id="5804462">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804465">c</span><span class="op" id="5804466">.</span><span class="ident" id="5804467">log</span><span class="op" id="5804470">(</span><span class="ident" id="5804471">fmt</span><span class="op" id="5804474">.</span><span class="ident" id="5804475">Sprintln</span><span class="op" id="5804483">(</span><span class="ident" id="5804484">args</span><span class="op" id="5804488">...</span><span class="op" id="5804491">)</span><span class="op" id="5804492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804495">c</span><span class="op" id="5804496">.</span><span class="ident" id="5804497">SkipNow</span><span class="op" id="5804504">(</span><span class="op" id="5804505">)</span><br>
<span class="lineno"></span><span class="op" id="5804507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5804510">//&nbsp;Skipf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno">380</span><span class="keyword" id="5804562">func</span>&nbsp;<span class="op" id="5804567">(</span><span class="ident" id="5804568">c</span>&nbsp;<span class="op" id="5804570">*</span><span class="ident" id="5804571">common</span><span class="op" id="5804577">)</span>&nbsp;<span class="ident" id="5804579">Skipf</span><span class="op" id="5804584">(</span><span class="ident" id="5804585">format</span>&nbsp;<span class="builtintype" id="5804592">string</span><span class="op" id="5804598">,</span>&nbsp;<span class="ident" id="5804600">args</span>&nbsp;<span class="op" id="5804605">...</span><span class="keyword" id="5804608">interface</span><span class="op" id="5804617">{</span><span class="op" id="5804618">}</span><span class="op" id="5804619">)</span>&nbsp;<span class="op" id="5804621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804624">c</span><span class="op" id="5804625">.</span><span class="ident" id="5804626">log</span><span class="op" id="5804629">(</span><span class="ident" id="5804630">fmt</span><span class="op" id="5804633">.</span><span class="ident" id="5804634">Sprintf</span><span class="op" id="5804641">(</span><span class="ident" id="5804642">format</span><span class="op" id="5804648">,</span>&nbsp;<span class="ident" id="5804650">args</span><span class="op" id="5804654">...</span><span class="op" id="5804657">)</span><span class="op" id="5804658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804661">c</span><span class="op" id="5804662">.</span><span class="ident" id="5804663">SkipNow</span><span class="op" id="5804670">(</span><span class="op" id="5804671">)</span><br>
<span class="lineno"></span><span class="op" id="5804673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="5804676">//&nbsp;SkipNow&nbsp;marks&nbsp;the&nbsp;test&nbsp;as&nbsp;having&nbsp;been&nbsp;skipped&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="5804750">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.&nbsp;See&nbsp;also&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="comment" id="5804826">//&nbsp;SkipNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the&nbsp;test,&nbsp;not&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5804898">//&nbsp;other&nbsp;goroutines&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;SkipNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno"></span><span class="comment" id="5804973">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno">390</span><span class="keyword" id="5805000">func</span>&nbsp;<span class="op" id="5805005">(</span><span class="ident" id="5805006">c</span>&nbsp;<span class="op" id="5805008">*</span><span class="ident" id="5805009">common</span><span class="op" id="5805015">)</span>&nbsp;<span class="ident" id="5805017">SkipNow</span><span class="op" id="5805024">(</span><span class="op" id="5805025">)</span>&nbsp;<span class="op" id="5805027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805030">c</span><span class="op" id="5805031">.</span><span class="ident" id="5805032">skip</span><span class="op" id="5805036">(</span><span class="op" id="5805037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805040">c</span><span class="op" id="5805041">.</span><span class="ident" id="5805042">finished</span>&nbsp;<span class="op" id="5805051">=</span>&nbsp;<span class="builtintype" id="5805053">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805059">runtime</span><span class="op" id="5805066">.</span><span class="ident" id="5805067">Goexit</span><span class="op" id="5805073">(</span><span class="op" id="5805074">)</span><br>
<span class="lineno"></span><span class="op" id="5805076">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="5805079">func</span>&nbsp;<span class="op" id="5805084">(</span><span class="ident" id="5805085">c</span>&nbsp;<span class="op" id="5805087">*</span><span class="ident" id="5805088">common</span><span class="op" id="5805094">)</span>&nbsp;<span class="ident" id="5805096">skip</span><span class="op" id="5805100">(</span><span class="op" id="5805101">)</span>&nbsp;<span class="op" id="5805103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805106">c</span><span class="op" id="5805107">.</span><span class="ident" id="5805108">mu</span><span class="op" id="5805110">.</span><span class="ident" id="5805111">Lock</span><span class="op" id="5805115">(</span><span class="op" id="5805116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5805119">defer</span>&nbsp;<span class="ident" id="5805125">c</span><span class="op" id="5805126">.</span><span class="ident" id="5805127">mu</span><span class="op" id="5805129">.</span><span class="ident" id="5805130">Unlock</span><span class="op" id="5805136">(</span><span class="op" id="5805137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805140">c</span><span class="op" id="5805141">.</span><span class="ident" id="5805142">skipped</span>&nbsp;<span class="op" id="5805150">=</span>&nbsp;<span class="builtintype" id="5805152">true</span><br>
<span class="lineno">400</span><span class="op" id="5805157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5805160">//&nbsp;Skipped&nbsp;reports&nbsp;whether&nbsp;the&nbsp;test&nbsp;was&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="5805209">func</span>&nbsp;<span class="op" id="5805214">(</span><span class="ident" id="5805215">c</span>&nbsp;<span class="op" id="5805217">*</span><span class="ident" id="5805218">common</span><span class="op" id="5805224">)</span>&nbsp;<span class="ident" id="5805226">Skipped</span><span class="op" id="5805233">(</span><span class="op" id="5805234">)</span>&nbsp;<span class="builtintype" id="5805236">bool</span>&nbsp;<span class="op" id="5805241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805244">c</span><span class="op" id="5805245">.</span><span class="ident" id="5805246">mu</span><span class="op" id="5805248">.</span><span class="ident" id="5805249">RLock</span><span class="op" id="5805254">(</span><span class="op" id="5805255">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5805258">defer</span>&nbsp;<span class="ident" id="5805264">c</span><span class="op" id="5805265">.</span><span class="ident" id="5805266">mu</span><span class="op" id="5805268">.</span><span class="ident" id="5805269">RUnlock</span><span class="op" id="5805276">(</span><span class="op" id="5805277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5805280">return</span>&nbsp;<span class="ident" id="5805287">c</span><span class="op" id="5805288">.</span><span class="ident" id="5805289">skipped</span><br>
<span class="lineno"></span><span class="op" id="5805297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5805300">//&nbsp;Parallel&nbsp;signals&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;to&nbsp;be&nbsp;run&nbsp;in&nbsp;parallel&nbsp;with&nbsp;(and&nbsp;only&nbsp;with)</span><br>
<span class="lineno">410</span><span class="comment" id="5805381">//&nbsp;other&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="5805406">func</span>&nbsp;<span class="op" id="5805411">(</span><span class="ident" id="5805412">t</span>&nbsp;<span class="op" id="5805414">*</span><span class="ident" id="5805415">T</span><span class="op" id="5805416">)</span>&nbsp;<span class="ident" id="5805418">Parallel</span><span class="op" id="5805426">(</span><span class="op" id="5805427">)</span>&nbsp;<span class="op" id="5805429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805432">t</span><span class="op" id="5805433">.</span><span class="ident" id="5805434">signal</span>&nbsp;<span class="op" id="5805441">&lt;-</span>&nbsp;<span class="op" id="5805444">(</span><span class="op" id="5805445">*</span><span class="ident" id="5805446">T</span><span class="op" id="5805447">)</span><span class="op" id="5805448">(</span><span class="ident" id="5805449">nil</span><span class="op" id="5805452">)</span>&nbsp;<span class="comment" id="5805454">//&nbsp;Release&nbsp;main&nbsp;testing&nbsp;loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5805484">&lt;-</span><span class="ident" id="5805486">t</span><span class="op" id="5805487">.</span><span class="ident" id="5805488">startParallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5805506">//&nbsp;Wait&nbsp;for&nbsp;serial&nbsp;tests&nbsp;to&nbsp;finish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5805542">//&nbsp;Assuming&nbsp;Parallel&nbsp;is&nbsp;the&nbsp;first&nbsp;thing&nbsp;a&nbsp;test&nbsp;does,&nbsp;which&nbsp;is&nbsp;reasonable,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5805617">//&nbsp;reinitialize&nbsp;the&nbsp;test&#39;s&nbsp;start&nbsp;time&nbsp;because&nbsp;it&#39;s&nbsp;actually&nbsp;starting&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805692">t</span><span class="op" id="5805693">.</span><span class="ident" id="5805694">start</span>&nbsp;<span class="op" id="5805700">=</span>&nbsp;<span class="ident" id="5805702">time</span><span class="op" id="5805706">.</span><span class="ident" id="5805707">Now</span><span class="op" id="5805710">(</span><span class="op" id="5805711">)</span><br>
<span class="lineno"></span><span class="op" id="5805713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5805716">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno">420</span><span class="comment" id="5805805">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5805834">type</span>&nbsp;<span class="ident" id="5805839">InternalTest</span>&nbsp;<span class="keyword" id="5805852">struct</span>&nbsp;<span class="op" id="5805859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805862">Name</span>&nbsp;<span class="builtintype" id="5805867">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805875">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5805880">func</span><span class="op" id="5805884">(</span><span class="op" id="5805885">*</span><span class="ident" id="5805886">T</span><span class="op" id="5805887">)</span><br>
<span class="lineno"></span><span class="op" id="5805889">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="5805892">func</span>&nbsp;<span class="ident" id="5805897">tRunner</span><span class="op" id="5805904">(</span><span class="ident" id="5805905">t</span>&nbsp;<span class="op" id="5805907">*</span><span class="ident" id="5805908">T</span><span class="op" id="5805909">,</span>&nbsp;<span class="ident" id="5805911">test</span>&nbsp;<span class="op" id="5805916">*</span><span class="ident" id="5805917">InternalTest</span><span class="op" id="5805929">)</span>&nbsp;<span class="op" id="5805931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5805934">//&nbsp;When&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;done,&nbsp;either&nbsp;because&nbsp;test.F(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5805992">//&nbsp;returned&nbsp;normally&nbsp;or&nbsp;because&nbsp;a&nbsp;test&nbsp;failure&nbsp;triggered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5806050">//&nbsp;a&nbsp;call&nbsp;to&nbsp;runtime.Goexit,&nbsp;record&nbsp;the&nbsp;duration&nbsp;and&nbsp;send</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5806109">//&nbsp;a&nbsp;signal&nbsp;saying&nbsp;that&nbsp;the&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5806152">defer</span>&nbsp;<span class="keyword" id="5806158">func</span><span class="op" id="5806162">(</span><span class="op" id="5806163">)</span>&nbsp;<span class="op" id="5806165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806169">t</span><span class="op" id="5806170">.</span><span class="ident" id="5806171">duration</span>&nbsp;<span class="op" id="5806180">=</span>&nbsp;<span class="ident" id="5806182">time</span><span class="op" id="5806186">.</span><span class="ident" id="5806187">Now</span><span class="op" id="5806190">(</span><span class="op" id="5806191">)</span><span class="op" id="5806192">.</span><span class="ident" id="5806193">Sub</span><span class="op" id="5806196">(</span><span class="ident" id="5806197">t</span><span class="op" id="5806198">.</span><span class="ident" id="5806199">start</span><span class="op" id="5806204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5806208">//&nbsp;If&nbsp;the&nbsp;test&nbsp;panicked,&nbsp;print&nbsp;any&nbsp;test&nbsp;output&nbsp;before&nbsp;dying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806271">err</span>&nbsp;<span class="op" id="5806275">:=</span>&nbsp;<span class="builtinfunc" id="5806278">recover</span><span class="op" id="5806285">(</span><span class="op" id="5806286">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5806290">if</span>&nbsp;<span class="op" id="5806293">!</span><span class="ident" id="5806294">t</span><span class="op" id="5806295">.</span><span class="ident" id="5806296">finished</span>&nbsp;<span class="op" id="5806305">&amp;&amp;</span>&nbsp;<span class="ident" id="5806308">err</span>&nbsp;<span class="op" id="5806312">==</span>&nbsp;<span class="ident" id="5806315">nil</span>&nbsp;<span class="op" id="5806319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806324">err</span>&nbsp;<span class="op" id="5806328">=</span>&nbsp;<span class="ident" id="5806330">fmt</span><span class="op" id="5806333">.</span><span class="ident" id="5806334">Errorf</span><span class="op" id="5806340">(</span><span class="string" id="5806341">&#34;test&nbsp;executed&nbsp;panic(nil)&nbsp;or&nbsp;runtime.Goexit&#34;</span><span class="op" id="5806385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5806389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5806393">if</span>&nbsp;<span class="ident" id="5806396">err</span>&nbsp;<span class="op" id="5806400">!=</span>&nbsp;<span class="ident" id="5806403">nil</span>&nbsp;<span class="op" id="5806407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806412">t</span><span class="op" id="5806413">.</span><span class="ident" id="5806414">Fail</span><span class="op" id="5806418">(</span><span class="op" id="5806419">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806424">t</span><span class="op" id="5806425">.</span><span class="ident" id="5806426">report</span><span class="op" id="5806432">(</span><span class="op" id="5806433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5806438">panic</span><span class="op" id="5806443">(</span><span class="ident" id="5806444">err</span><span class="op" id="5806447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5806451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806455">t</span><span class="op" id="5806456">.</span><span class="ident" id="5806457">signal</span>&nbsp;<span class="op" id="5806464">&lt;-</span>&nbsp;<span class="ident" id="5806467">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5806470">}</span><span class="op" id="5806471">(</span><span class="op" id="5806472">)</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806476">t</span><span class="op" id="5806477">.</span><span class="ident" id="5806478">start</span>&nbsp;<span class="op" id="5806484">=</span>&nbsp;<span class="ident" id="5806486">time</span><span class="op" id="5806490">.</span><span class="ident" id="5806491">Now</span><span class="op" id="5806494">(</span><span class="op" id="5806495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806498">test</span><span class="op" id="5806502">.</span><span class="ident" id="5806503">F</span><span class="op" id="5806504">(</span><span class="ident" id="5806505">t</span><span class="op" id="5806506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806509">t</span><span class="op" id="5806510">.</span><span class="ident" id="5806511">finished</span>&nbsp;<span class="op" id="5806520">=</span>&nbsp;<span class="builtintype" id="5806522">true</span><br>
<span class="lineno"></span><span class="op" id="5806527">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="comment" id="5806530">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5806623">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5806652">func</span>&nbsp;<span class="ident" id="5806657">Main</span><span class="op" id="5806661">(</span><span class="ident" id="5806662">matchString</span>&nbsp;<span class="keyword" id="5806674">func</span><span class="op" id="5806678">(</span><span class="ident" id="5806679">pat</span><span class="op" id="5806682">,</span>&nbsp;<span class="ident" id="5806684">str</span>&nbsp;<span class="builtintype" id="5806688">string</span><span class="op" id="5806694">)</span>&nbsp;<span class="op" id="5806696">(</span><span class="builtintype" id="5806697">bool</span><span class="op" id="5806701">,</span>&nbsp;<span class="builtintype" id="5806703">error</span><span class="op" id="5806708">)</span><span class="op" id="5806709">,</span>&nbsp;<span class="ident" id="5806711">tests</span>&nbsp;<span class="op" id="5806717">[</span><span class="op" id="5806718">]</span><span class="ident" id="5806719">InternalTest</span><span class="op" id="5806731">,</span>&nbsp;<span class="ident" id="5806733">benchmarks</span>&nbsp;<span class="op" id="5806744">[</span><span class="op" id="5806745">]</span><span class="ident" id="5806746">InternalBenchmark</span><span class="op" id="5806763">,</span>&nbsp;<span class="ident" id="5806765">examples</span>&nbsp;<span class="op" id="5806774">[</span><span class="op" id="5806775">]</span><span class="ident" id="5806776">InternalExample</span><span class="op" id="5806791">)</span>&nbsp;<span class="op" id="5806793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806796">os</span><span class="op" id="5806798">.</span><span class="ident" id="5806799">Exit</span><span class="op" id="5806803">(</span><span class="ident" id="5806804">MainStart</span><span class="op" id="5806813">(</span><span class="ident" id="5806814">matchString</span><span class="op" id="5806825">,</span>&nbsp;<span class="ident" id="5806827">tests</span><span class="op" id="5806832">,</span>&nbsp;<span class="ident" id="5806834">benchmarks</span><span class="op" id="5806844">,</span>&nbsp;<span class="ident" id="5806846">examples</span><span class="op" id="5806854">)</span><span class="op" id="5806855">.</span><span class="ident" id="5806856">Run</span><span class="op" id="5806859">(</span><span class="op" id="5806860">)</span><span class="op" id="5806861">)</span><br>
<span class="lineno">455</span><span class="op" id="5806863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5806866">//&nbsp;M&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;a&nbsp;TestMain&nbsp;function&nbsp;to&nbsp;run&nbsp;the&nbsp;actual&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="5806936">type</span>&nbsp;<span class="ident" id="5806941">M</span>&nbsp;<span class="keyword" id="5806943">struct</span>&nbsp;<span class="op" id="5806950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806953">matchString</span>&nbsp;<span class="keyword" id="5806965">func</span><span class="op" id="5806969">(</span><span class="ident" id="5806970">pat</span><span class="op" id="5806973">,</span>&nbsp;<span class="ident" id="5806975">str</span>&nbsp;<span class="builtintype" id="5806979">string</span><span class="op" id="5806985">)</span>&nbsp;<span class="op" id="5806987">(</span><span class="builtintype" id="5806988">bool</span><span class="op" id="5806992">,</span>&nbsp;<span class="builtintype" id="5806994">error</span><span class="op" id="5806999">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807002">tests</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5807014">[</span><span class="op" id="5807015">]</span><span class="ident" id="5807016">InternalTest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807030">benchmarks</span>&nbsp;&nbsp;<span class="op" id="5807042">[</span><span class="op" id="5807043">]</span><span class="ident" id="5807044">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807063">examples</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5807075">[</span><span class="op" id="5807076">]</span><span class="ident" id="5807077">InternalExample</span><br>
<span class="lineno"></span><span class="op" id="5807093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="comment" id="5807096">//&nbsp;MainStart&nbsp;is&nbsp;meant&nbsp;for&nbsp;use&nbsp;by&nbsp;tests&nbsp;generated&nbsp;by&nbsp;&#39;go&nbsp;test&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="5807159">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;called&nbsp;directly&nbsp;and&nbsp;is&nbsp;not&nbsp;subject&nbsp;to&nbsp;the&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;document.</span><br>
<span class="lineno"></span><span class="comment" id="5807255">//&nbsp;It&nbsp;may&nbsp;change&nbsp;signature&nbsp;from&nbsp;release&nbsp;to&nbsp;release.</span><br>
<span class="lineno"></span><span class="keyword" id="5807307">func</span>&nbsp;<span class="ident" id="5807312">MainStart</span><span class="op" id="5807321">(</span><span class="ident" id="5807322">matchString</span>&nbsp;<span class="keyword" id="5807334">func</span><span class="op" id="5807338">(</span><span class="ident" id="5807339">pat</span><span class="op" id="5807342">,</span>&nbsp;<span class="ident" id="5807344">str</span>&nbsp;<span class="builtintype" id="5807348">string</span><span class="op" id="5807354">)</span>&nbsp;<span class="op" id="5807356">(</span><span class="builtintype" id="5807357">bool</span><span class="op" id="5807361">,</span>&nbsp;<span class="builtintype" id="5807363">error</span><span class="op" id="5807368">)</span><span class="op" id="5807369">,</span>&nbsp;<span class="ident" id="5807371">tests</span>&nbsp;<span class="op" id="5807377">[</span><span class="op" id="5807378">]</span><span class="ident" id="5807379">InternalTest</span><span class="op" id="5807391">,</span>&nbsp;<span class="ident" id="5807393">benchmarks</span>&nbsp;<span class="op" id="5807404">[</span><span class="op" id="5807405">]</span><span class="ident" id="5807406">InternalBenchmark</span><span class="op" id="5807423">,</span>&nbsp;<span class="ident" id="5807425">examples</span>&nbsp;<span class="op" id="5807434">[</span><span class="op" id="5807435">]</span><span class="ident" id="5807436">InternalExample</span><span class="op" id="5807451">)</span>&nbsp;<span class="op" id="5807453">*</span><span class="ident" id="5807454">M</span>&nbsp;<span class="op" id="5807456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5807459">return</span>&nbsp;<span class="op" id="5807466">&amp;</span><span class="ident" id="5807467">M</span><span class="op" id="5807468">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807472">matchString</span><span class="op" id="5807483">:</span>&nbsp;<span class="ident" id="5807485">matchString</span><span class="op" id="5807496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807500">tests</span><span class="op" id="5807505">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5807513">tests</span><span class="op" id="5807518">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807522">benchmarks</span><span class="op" id="5807532">:</span>&nbsp;&nbsp;<span class="ident" id="5807535">benchmarks</span><span class="op" id="5807545">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807549">examples</span><span class="op" id="5807557">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5807562">examples</span><span class="op" id="5807570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5807573">}</span><br>
<span class="lineno">475</span><span class="op" id="5807575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5807578">//&nbsp;Run&nbsp;runs&nbsp;the&nbsp;tests.&nbsp;It&nbsp;returns&nbsp;an&nbsp;exit&nbsp;code&nbsp;to&nbsp;pass&nbsp;to&nbsp;os.Exit.</span><br>
<span class="lineno"></span><span class="keyword" id="5807645">func</span>&nbsp;<span class="op" id="5807650">(</span><span class="ident" id="5807651">m</span>&nbsp;<span class="op" id="5807653">*</span><span class="ident" id="5807654">M</span><span class="op" id="5807655">)</span>&nbsp;<span class="ident" id="5807657">Run</span><span class="op" id="5807660">(</span><span class="op" id="5807661">)</span>&nbsp;<span class="builtintype" id="5807663">int</span>&nbsp;<span class="op" id="5807667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807670">flag</span><span class="op" id="5807674">.</span><span class="ident" id="5807675">Parse</span><span class="op" id="5807680">(</span><span class="op" id="5807681">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807684">parseCpuList</span><span class="op" id="5807696">(</span><span class="op" id="5807697">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807701">before</span><span class="op" id="5807707">(</span><span class="op" id="5807708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807711">startAlarm</span><span class="op" id="5807721">(</span><span class="op" id="5807722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807725">haveExamples</span>&nbsp;<span class="op" id="5807738">=</span>&nbsp;<span class="builtinfunc" id="5807740">len</span><span class="op" id="5807743">(</span><span class="ident" id="5807744">m</span><span class="op" id="5807745">.</span><span class="ident" id="5807746">examples</span><span class="op" id="5807754">)</span>&nbsp;<span class="op" id="5807756">&gt;</span>&nbsp;<span class="num" id="5807758">0</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807761">testOk</span>&nbsp;<span class="op" id="5807768">:=</span>&nbsp;<span class="ident" id="5807771">RunTests</span><span class="op" id="5807779">(</span><span class="ident" id="5807780">m</span><span class="op" id="5807781">.</span><span class="ident" id="5807782">matchString</span><span class="op" id="5807793">,</span>&nbsp;<span class="ident" id="5807795">m</span><span class="op" id="5807796">.</span><span class="ident" id="5807797">tests</span><span class="op" id="5807802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807805">exampleOk</span>&nbsp;<span class="op" id="5807815">:=</span>&nbsp;<span class="ident" id="5807818">RunExamples</span><span class="op" id="5807829">(</span><span class="ident" id="5807830">m</span><span class="op" id="5807831">.</span><span class="ident" id="5807832">matchString</span><span class="op" id="5807843">,</span>&nbsp;<span class="ident" id="5807845">m</span><span class="op" id="5807846">.</span><span class="ident" id="5807847">examples</span><span class="op" id="5807855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807858">stopAlarm</span><span class="op" id="5807867">(</span><span class="op" id="5807868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5807871">if</span>&nbsp;<span class="op" id="5807874">!</span><span class="ident" id="5807875">testOk</span>&nbsp;<span class="op" id="5807882">||</span>&nbsp;<span class="op" id="5807885">!</span><span class="ident" id="5807886">exampleOk</span>&nbsp;<span class="op" id="5807896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807900">fmt</span><span class="op" id="5807903">.</span><span class="ident" id="5807904">Println</span><span class="op" id="5807911">(</span><span class="string" id="5807912">&#34;FAIL&#34;</span><span class="op" id="5807918">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807922">after</span><span class="op" id="5807927">(</span><span class="op" id="5807928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5807932">return</span>&nbsp;<span class="num" id="5807939">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5807942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807945">fmt</span><span class="op" id="5807948">.</span><span class="ident" id="5807949">Println</span><span class="op" id="5807956">(</span><span class="string" id="5807957">&#34;PASS&#34;</span><span class="op" id="5807963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807966">RunBenchmarks</span><span class="op" id="5807979">(</span><span class="ident" id="5807980">m</span><span class="op" id="5807981">.</span><span class="ident" id="5807982">matchString</span><span class="op" id="5807993">,</span>&nbsp;<span class="ident" id="5807995">m</span><span class="op" id="5807996">.</span><span class="ident" id="5807997">benchmarks</span><span class="op" id="5808007">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808010">after</span><span class="op" id="5808015">(</span><span class="op" id="5808016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5808019">return</span>&nbsp;<span class="num" id="5808026">0</span><br>
<span class="lineno"></span><span class="op" id="5808028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5808031">func</span>&nbsp;<span class="op" id="5808036">(</span><span class="ident" id="5808037">t</span>&nbsp;<span class="op" id="5808039">*</span><span class="ident" id="5808040">T</span><span class="op" id="5808041">)</span>&nbsp;<span class="ident" id="5808043">report</span><span class="op" id="5808049">(</span><span class="op" id="5808050">)</span>&nbsp;<span class="op" id="5808052">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808055">dstr</span>&nbsp;<span class="op" id="5808060">:=</span>&nbsp;<span class="ident" id="5808063">fmtDuration</span><span class="op" id="5808074">(</span><span class="ident" id="5808075">t</span><span class="op" id="5808076">.</span><span class="ident" id="5808077">duration</span><span class="op" id="5808085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808088">format</span>&nbsp;<span class="op" id="5808095">:=</span>&nbsp;<span class="string" id="5808098">&#34;---&nbsp;%s:&nbsp;%s&nbsp;(%s)\n%s&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5808121">if</span>&nbsp;<span class="ident" id="5808124">t</span><span class="op" id="5808125">.</span><span class="ident" id="5808126">Failed</span><span class="op" id="5808132">(</span><span class="op" id="5808133">)</span>&nbsp;<span class="op" id="5808135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808139">fmt</span><span class="op" id="5808142">.</span><span class="ident" id="5808143">Printf</span><span class="op" id="5808149">(</span><span class="ident" id="5808150">format</span><span class="op" id="5808156">,</span>&nbsp;<span class="string" id="5808158">&#34;FAIL&#34;</span><span class="op" id="5808164">,</span>&nbsp;<span class="ident" id="5808166">t</span><span class="op" id="5808167">.</span><span class="ident" id="5808168">name</span><span class="op" id="5808172">,</span>&nbsp;<span class="ident" id="5808174">dstr</span><span class="op" id="5808178">,</span>&nbsp;<span class="ident" id="5808180">t</span><span class="op" id="5808181">.</span><span class="ident" id="5808182">output</span><span class="op" id="5808188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5808191">}</span>&nbsp;<span class="keyword" id="5808193">else</span>&nbsp;<span class="keyword" id="5808198">if</span>&nbsp;<span class="op" id="5808201">*</span><span class="ident" id="5808202">chatty</span>&nbsp;<span class="op" id="5808209">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5808213">if</span>&nbsp;<span class="ident" id="5808216">t</span><span class="op" id="5808217">.</span><span class="ident" id="5808218">Skipped</span><span class="op" id="5808225">(</span><span class="op" id="5808226">)</span>&nbsp;<span class="op" id="5808228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808233">fmt</span><span class="op" id="5808236">.</span><span class="ident" id="5808237">Printf</span><span class="op" id="5808243">(</span><span class="ident" id="5808244">format</span><span class="op" id="5808250">,</span>&nbsp;<span class="string" id="5808252">&#34;SKIP&#34;</span><span class="op" id="5808258">,</span>&nbsp;<span class="ident" id="5808260">t</span><span class="op" id="5808261">.</span><span class="ident" id="5808262">name</span><span class="op" id="5808266">,</span>&nbsp;<span class="ident" id="5808268">dstr</span><span class="op" id="5808272">,</span>&nbsp;<span class="ident" id="5808274">t</span><span class="op" id="5808275">.</span><span class="ident" id="5808276">output</span><span class="op" id="5808282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5808286">}</span>&nbsp;<span class="keyword" id="5808288">else</span>&nbsp;<span class="op" id="5808293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808298">fmt</span><span class="op" id="5808301">.</span><span class="ident" id="5808302">Printf</span><span class="op" id="5808308">(</span><span class="ident" id="5808309">format</span><span class="op" id="5808315">,</span>&nbsp;<span class="string" id="5808317">&#34;PASS&#34;</span><span class="op" id="5808323">,</span>&nbsp;<span class="ident" id="5808325">t</span><span class="op" id="5808326">.</span><span class="ident" id="5808327">name</span><span class="op" id="5808331">,</span>&nbsp;<span class="ident" id="5808333">dstr</span><span class="op" id="5808337">,</span>&nbsp;<span class="ident" id="5808339">t</span><span class="op" id="5808340">.</span><span class="ident" id="5808341">output</span><span class="op" id="5808347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5808351">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5808354">}</span><br>
<span class="lineno"></span><span class="op" id="5808356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5808359">func</span>&nbsp;<span class="ident" id="5808364">RunTests</span><span class="op" id="5808372">(</span><span class="ident" id="5808373">matchString</span>&nbsp;<span class="keyword" id="5808385">func</span><span class="op" id="5808389">(</span><span class="ident" id="5808390">pat</span><span class="op" id="5808393">,</span>&nbsp;<span class="ident" id="5808395">str</span>&nbsp;<span class="builtintype" id="5808399">string</span><span class="op" id="5808405">)</span>&nbsp;<span class="op" id="5808407">(</span><span class="builtintype" id="5808408">bool</span><span class="op" id="5808412">,</span>&nbsp;<span class="builtintype" id="5808414">error</span><span class="op" id="5808419">)</span><span class="op" id="5808420">,</span>&nbsp;<span class="ident" id="5808422">tests</span>&nbsp;<span class="op" id="5808428">[</span><span class="op" id="5808429">]</span><span class="ident" id="5808430">InternalTest</span><span class="op" id="5808442">)</span>&nbsp;<span class="op" id="5808444">(</span><span class="ident" id="5808445">ok</span>&nbsp;<span class="builtintype" id="5808448">bool</span><span class="op" id="5808452">)</span>&nbsp;<span class="op" id="5808454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808457">ok</span>&nbsp;<span class="op" id="5808460">=</span>&nbsp;<span class="builtintype" id="5808462">true</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5808468">if</span>&nbsp;<span class="builtinfunc" id="5808471">len</span><span class="op" id="5808474">(</span><span class="ident" id="5808475">tests</span><span class="op" id="5808480">)</span>&nbsp;<span class="op" id="5808482">==</span>&nbsp;<span class="num" id="5808485">0</span>&nbsp;<span class="op" id="5808487">&amp;&amp;</span>&nbsp;<span class="op" id="5808490">!</span><span class="ident" id="5808491">haveExamples</span>&nbsp;<span class="op" id="5808504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808508">fmt</span><span class="op" id="5808511">.</span><span class="ident" id="5808512">Fprintln</span><span class="op" id="5808520">(</span><span class="ident" id="5808521">os</span><span class="op" id="5808523">.</span><span class="ident" id="5808524">Stderr</span><span class="op" id="5808530">,</span>&nbsp;<span class="string" id="5808532">&#34;testing:&nbsp;warning:&nbsp;no&nbsp;tests&nbsp;to&nbsp;run&#34;</span><span class="op" id="5808567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5808571">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5808579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5808582">for</span>&nbsp;<span class="ident" id="5808586">_</span><span class="op" id="5808587">,</span>&nbsp;<span class="ident" id="5808589">procs</span>&nbsp;<span class="op" id="5808595">:=</span>&nbsp;<span class="keyword" id="5808598">range</span>&nbsp;<span class="ident" id="5808604">cpuList</span>&nbsp;<span class="op" id="5808612">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808616">runtime</span><span class="op" id="5808623">.</span><span class="ident" id="5808624">GOMAXPROCS</span><span class="op" id="5808634">(</span><span class="ident" id="5808635">procs</span><span class="op" id="5808640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5808644">//&nbsp;We&nbsp;build&nbsp;a&nbsp;new&nbsp;channel&nbsp;tree&nbsp;for&nbsp;each&nbsp;run&nbsp;of&nbsp;the&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5808703">//&nbsp;collector&nbsp;merges&nbsp;in&nbsp;one&nbsp;channel&nbsp;all&nbsp;the&nbsp;upstream&nbsp;signals&nbsp;from&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5808786">//&nbsp;If&nbsp;all&nbsp;tests&nbsp;pump&nbsp;to&nbsp;the&nbsp;same&nbsp;channel,&nbsp;a&nbsp;bug&nbsp;can&nbsp;occur&nbsp;where&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5808859">//&nbsp;kicks&nbsp;off&nbsp;a&nbsp;goroutine&nbsp;that&nbsp;Fails,&nbsp;yet&nbsp;the&nbsp;test&nbsp;still&nbsp;delivers&nbsp;a&nbsp;completion&nbsp;signal,</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5808947">//&nbsp;which&nbsp;skews&nbsp;the&nbsp;counting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5808978">var</span>&nbsp;<span class="ident" id="5808982">collector</span>&nbsp;<span class="op" id="5808992">=</span>&nbsp;<span class="builtinfunc" id="5808994">make</span><span class="op" id="5808998">(</span><span class="keyword" id="5808999">chan</span>&nbsp;<span class="keyword" id="5809004">interface</span><span class="op" id="5809013">{</span><span class="op" id="5809014">}</span><span class="op" id="5809015">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809020">numParallel</span>&nbsp;<span class="op" id="5809032">:=</span>&nbsp;<span class="num" id="5809035">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809039">startParallel</span>&nbsp;<span class="op" id="5809053">:=</span>&nbsp;<span class="builtinfunc" id="5809056">make</span><span class="op" id="5809060">(</span><span class="keyword" id="5809061">chan</span>&nbsp;<span class="builtintype" id="5809066">bool</span><span class="op" id="5809070">)</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809075">for</span>&nbsp;<span class="ident" id="5809079">i</span>&nbsp;<span class="op" id="5809081">:=</span>&nbsp;<span class="num" id="5809084">0</span><span class="op" id="5809085">;</span>&nbsp;<span class="ident" id="5809087">i</span>&nbsp;<span class="op" id="5809089">&lt;</span>&nbsp;<span class="builtinfunc" id="5809091">len</span><span class="op" id="5809094">(</span><span class="ident" id="5809095">tests</span><span class="op" id="5809100">)</span><span class="op" id="5809101">;</span>&nbsp;<span class="ident" id="5809103">i</span><span class="op" id="5809104">++</span>&nbsp;<span class="op" id="5809107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809112">matched</span><span class="op" id="5809119">,</span>&nbsp;<span class="ident" id="5809121">err</span>&nbsp;<span class="op" id="5809125">:=</span>&nbsp;<span class="ident" id="5809128">matchString</span><span class="op" id="5809139">(</span><span class="op" id="5809140">*</span><span class="ident" id="5809141">match</span><span class="op" id="5809146">,</span>&nbsp;<span class="ident" id="5809148">tests</span><span class="op" id="5809153">[</span><span class="ident" id="5809154">i</span><span class="op" id="5809155">]</span><span class="op" id="5809156">.</span><span class="ident" id="5809157">Name</span><span class="op" id="5809161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809166">if</span>&nbsp;<span class="ident" id="5809169">err</span>&nbsp;<span class="op" id="5809173">!=</span>&nbsp;<span class="ident" id="5809176">nil</span>&nbsp;<span class="op" id="5809180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809186">fmt</span><span class="op" id="5809189">.</span><span class="ident" id="5809190">Fprintf</span><span class="op" id="5809197">(</span><span class="ident" id="5809198">os</span><span class="op" id="5809200">.</span><span class="ident" id="5809201">Stderr</span><span class="op" id="5809207">,</span>&nbsp;<span class="string" id="5809209">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.run:&nbsp;%s\n&#34;</span><span class="op" id="5809254">,</span>&nbsp;<span class="ident" id="5809256">err</span><span class="op" id="5809259">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809265">os</span><span class="op" id="5809267">.</span><span class="ident" id="5809268">Exit</span><span class="op" id="5809272">(</span><span class="num" id="5809273">1</span><span class="op" id="5809274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809284">if</span>&nbsp;<span class="op" id="5809287">!</span><span class="ident" id="5809288">matched</span>&nbsp;<span class="op" id="5809296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809302">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809314">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809319">testName</span>&nbsp;<span class="op" id="5809328">:=</span>&nbsp;<span class="ident" id="5809331">tests</span><span class="op" id="5809336">[</span><span class="ident" id="5809337">i</span><span class="op" id="5809338">]</span><span class="op" id="5809339">.</span><span class="ident" id="5809340">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809348">if</span>&nbsp;<span class="ident" id="5809351">procs</span>&nbsp;<span class="op" id="5809357">!=</span>&nbsp;<span class="num" id="5809360">1</span>&nbsp;<span class="op" id="5809362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809368">testName</span>&nbsp;<span class="op" id="5809377">=</span>&nbsp;<span class="ident" id="5809379">fmt</span><span class="op" id="5809382">.</span><span class="ident" id="5809383">Sprintf</span><span class="op" id="5809390">(</span><span class="string" id="5809391">&#34;%s-%d&#34;</span><span class="op" id="5809398">,</span>&nbsp;<span class="ident" id="5809400">tests</span><span class="op" id="5809405">[</span><span class="ident" id="5809406">i</span><span class="op" id="5809407">]</span><span class="op" id="5809408">.</span><span class="ident" id="5809409">Name</span><span class="op" id="5809413">,</span>&nbsp;<span class="ident" id="5809415">procs</span><span class="op" id="5809420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809430">t</span>&nbsp;<span class="op" id="5809432">:=</span>&nbsp;<span class="op" id="5809435">&amp;</span><span class="ident" id="5809436">T</span><span class="op" id="5809437">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809443">common</span><span class="op" id="5809449">:</span>&nbsp;<span class="ident" id="5809451">common</span><span class="op" id="5809457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809464">signal</span><span class="op" id="5809470">:</span>&nbsp;<span class="builtinfunc" id="5809472">make</span><span class="op" id="5809476">(</span><span class="keyword" id="5809477">chan</span>&nbsp;<span class="keyword" id="5809482">interface</span><span class="op" id="5809491">{</span><span class="op" id="5809492">}</span><span class="op" id="5809493">)</span><span class="op" id="5809494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809500">}</span><span class="op" id="5809501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809507">name</span><span class="op" id="5809511">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5809522">testName</span><span class="op" id="5809530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809536">startParallel</span><span class="op" id="5809549">:</span>&nbsp;<span class="ident" id="5809551">startParallel</span><span class="op" id="5809564">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809574">t</span><span class="op" id="5809575">.</span><span class="ident" id="5809576">self</span>&nbsp;<span class="op" id="5809581">=</span>&nbsp;<span class="ident" id="5809583">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809588">if</span>&nbsp;<span class="op" id="5809591">*</span><span class="ident" id="5809592">chatty</span>&nbsp;<span class="op" id="5809599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809605">fmt</span><span class="op" id="5809608">.</span><span class="ident" id="5809609">Printf</span><span class="op" id="5809615">(</span><span class="string" id="5809616">&#34;===&nbsp;RUN&nbsp;%s\n&#34;</span><span class="op" id="5809630">,</span>&nbsp;<span class="ident" id="5809632">t</span><span class="op" id="5809633">.</span><span class="ident" id="5809634">name</span><span class="op" id="5809638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809643">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809648">go</span>&nbsp;<span class="ident" id="5809651">tRunner</span><span class="op" id="5809658">(</span><span class="ident" id="5809659">t</span><span class="op" id="5809660">,</span>&nbsp;<span class="op" id="5809662">&amp;</span><span class="ident" id="5809663">tests</span><span class="op" id="5809668">[</span><span class="ident" id="5809669">i</span><span class="op" id="5809670">]</span><span class="op" id="5809671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809676">out</span>&nbsp;<span class="op" id="5809680">:=</span>&nbsp;<span class="op" id="5809683">(</span><span class="op" id="5809684">&lt;-</span><span class="ident" id="5809686">t</span><span class="op" id="5809687">.</span><span class="ident" id="5809688">signal</span><span class="op" id="5809694">)</span><span class="op" id="5809695">.</span><span class="op" id="5809696">(</span><span class="op" id="5809697">*</span><span class="ident" id="5809698">T</span><span class="op" id="5809699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809704">if</span>&nbsp;<span class="ident" id="5809707">out</span>&nbsp;<span class="op" id="5809711">==</span>&nbsp;<span class="ident" id="5809714">nil</span>&nbsp;<span class="op" id="5809718">{</span>&nbsp;<span class="comment" id="5809720">//&nbsp;Parallel&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809741">go</span>&nbsp;<span class="keyword" id="5809744">func</span><span class="op" id="5809748">(</span><span class="op" id="5809749">)</span>&nbsp;<span class="op" id="5809751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809758">collector</span>&nbsp;<span class="op" id="5809768">&lt;-</span>&nbsp;<span class="op" id="5809771">&lt;-</span><span class="ident" id="5809773">t</span><span class="op" id="5809774">.</span><span class="ident" id="5809775">signal</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809786">}</span><span class="op" id="5809787">(</span><span class="op" id="5809788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809794">numParallel</span><span class="op" id="5809805">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809812">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809829">t</span><span class="op" id="5809830">.</span><span class="ident" id="5809831">report</span><span class="op" id="5809837">(</span><span class="op" id="5809838">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809843">ok</span>&nbsp;<span class="op" id="5809846">=</span>&nbsp;<span class="ident" id="5809848">ok</span>&nbsp;<span class="op" id="5809851">&amp;&amp;</span>&nbsp;<span class="op" id="5809854">!</span><span class="ident" id="5809855">out</span><span class="op" id="5809858">.</span><span class="ident" id="5809859">Failed</span><span class="op" id="5809865">(</span><span class="op" id="5809866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809875">running</span>&nbsp;<span class="op" id="5809883">:=</span>&nbsp;<span class="num" id="5809886">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809890">for</span>&nbsp;<span class="ident" id="5809894">numParallel</span><span class="op" id="5809905">+</span><span class="ident" id="5809906">running</span>&nbsp;<span class="op" id="5809914">&gt;</span>&nbsp;<span class="num" id="5809916">0</span>&nbsp;<span class="op" id="5809918">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809923">if</span>&nbsp;<span class="ident" id="5809926">running</span>&nbsp;<span class="op" id="5809934">&lt;</span>&nbsp;<span class="op" id="5809936">*</span><span class="ident" id="5809937">parallel</span>&nbsp;<span class="op" id="5809946">&amp;&amp;</span>&nbsp;<span class="ident" id="5809949">numParallel</span>&nbsp;<span class="op" id="5809961">&gt;</span>&nbsp;<span class="num" id="5809963">0</span>&nbsp;<span class="op" id="5809965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809971">startParallel</span>&nbsp;<span class="op" id="5809985">&lt;-</span>&nbsp;<span class="builtintype" id="5809988">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809997">running</span><span class="op" id="5810004">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810011">numParallel</span><span class="op" id="5810022">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810029">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810046">t</span>&nbsp;<span class="op" id="5810048">:=</span>&nbsp;<span class="op" id="5810051">(</span><span class="op" id="5810052">&lt;-</span><span class="ident" id="5810054">collector</span><span class="op" id="5810063">)</span><span class="op" id="5810064">.</span><span class="op" id="5810065">(</span><span class="op" id="5810066">*</span><span class="ident" id="5810067">T</span><span class="op" id="5810068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810073">t</span><span class="op" id="5810074">.</span><span class="ident" id="5810075">report</span><span class="op" id="5810081">(</span><span class="op" id="5810082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810087">ok</span>&nbsp;<span class="op" id="5810090">=</span>&nbsp;<span class="ident" id="5810092">ok</span>&nbsp;<span class="op" id="5810095">&amp;&amp;</span>&nbsp;<span class="op" id="5810098">!</span><span class="ident" id="5810099">t</span><span class="op" id="5810100">.</span><span class="ident" id="5810101">Failed</span><span class="op" id="5810107">(</span><span class="op" id="5810108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810113">running</span><span class="op" id="5810120">--</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810131">return</span><br>
<span class="lineno"></span><span class="op" id="5810138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="comment" id="5810141">//&nbsp;before&nbsp;runs&nbsp;before&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="5810176">func</span>&nbsp;<span class="ident" id="5810181">before</span><span class="op" id="5810187">(</span><span class="op" id="5810188">)</span>&nbsp;<span class="op" id="5810190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810193">if</span>&nbsp;<span class="op" id="5810196">*</span><span class="ident" id="5810197">memProfileRate</span>&nbsp;<span class="op" id="5810212">&gt;</span>&nbsp;<span class="num" id="5810214">0</span>&nbsp;<span class="op" id="5810216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810220">runtime</span><span class="op" id="5810227">.</span><span class="ident" id="5810228">MemProfileRate</span>&nbsp;<span class="op" id="5810243">=</span>&nbsp;<span class="op" id="5810245">*</span><span class="ident" id="5810246">memProfileRate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810262">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810265">if</span>&nbsp;<span class="op" id="5810268">*</span><span class="ident" id="5810269">cpuProfile</span>&nbsp;<span class="op" id="5810280">!=</span>&nbsp;<span class="string" id="5810283">&#34;&#34;</span>&nbsp;<span class="op" id="5810286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810290">f</span><span class="op" id="5810291">,</span>&nbsp;<span class="ident" id="5810293">err</span>&nbsp;<span class="op" id="5810297">:=</span>&nbsp;<span class="ident" id="5810300">os</span><span class="op" id="5810302">.</span><span class="ident" id="5810303">Create</span><span class="op" id="5810309">(</span><span class="ident" id="5810310">toOutputDir</span><span class="op" id="5810321">(</span><span class="op" id="5810322">*</span><span class="ident" id="5810323">cpuProfile</span><span class="op" id="5810333">)</span><span class="op" id="5810334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810338">if</span>&nbsp;<span class="ident" id="5810341">err</span>&nbsp;<span class="op" id="5810345">!=</span>&nbsp;<span class="ident" id="5810348">nil</span>&nbsp;<span class="op" id="5810352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810357">fmt</span><span class="op" id="5810360">.</span><span class="ident" id="5810361">Fprintf</span><span class="op" id="5810368">(</span><span class="ident" id="5810369">os</span><span class="op" id="5810371">.</span><span class="ident" id="5810372">Stderr</span><span class="op" id="5810378">,</span>&nbsp;<span class="string" id="5810380">&#34;testing:&nbsp;%s&#34;</span><span class="op" id="5810393">,</span>&nbsp;<span class="ident" id="5810395">err</span><span class="op" id="5810398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810403">return</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810416">if</span>&nbsp;<span class="ident" id="5810419">err</span>&nbsp;<span class="op" id="5810423">:=</span>&nbsp;<span class="ident" id="5810426">pprof</span><span class="op" id="5810431">.</span><span class="ident" id="5810432">StartCPUProfile</span><span class="op" id="5810447">(</span><span class="ident" id="5810448">f</span><span class="op" id="5810449">)</span><span class="op" id="5810450">;</span>&nbsp;<span class="ident" id="5810452">err</span>&nbsp;<span class="op" id="5810456">!=</span>&nbsp;<span class="ident" id="5810459">nil</span>&nbsp;<span class="op" id="5810463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810468">fmt</span><span class="op" id="5810471">.</span><span class="ident" id="5810472">Fprintf</span><span class="op" id="5810479">(</span><span class="ident" id="5810480">os</span><span class="op" id="5810482">.</span><span class="ident" id="5810483">Stderr</span><span class="op" id="5810489">,</span>&nbsp;<span class="string" id="5810491">&#34;testing:&nbsp;can&#39;t&nbsp;start&nbsp;cpu&nbsp;profile:&nbsp;%s&#34;</span><span class="op" id="5810529">,</span>&nbsp;<span class="ident" id="5810531">err</span><span class="op" id="5810534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810539">f</span><span class="op" id="5810540">.</span><span class="ident" id="5810541">Close</span><span class="op" id="5810546">(</span><span class="op" id="5810547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810552">return</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5810565">//&nbsp;Could&nbsp;save&nbsp;f&nbsp;so&nbsp;after&nbsp;can&nbsp;call&nbsp;f.Close;&nbsp;not&nbsp;worth&nbsp;the&nbsp;effort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810634">if</span>&nbsp;<span class="op" id="5810637">*</span><span class="ident" id="5810638">blockProfile</span>&nbsp;<span class="op" id="5810651">!=</span>&nbsp;<span class="string" id="5810654">&#34;&#34;</span>&nbsp;<span class="op" id="5810657">&amp;&amp;</span>&nbsp;<span class="op" id="5810660">*</span><span class="ident" id="5810661">blockProfileRate</span>&nbsp;<span class="op" id="5810678">&gt;=</span>&nbsp;<span class="num" id="5810681">0</span>&nbsp;<span class="op" id="5810683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810687">runtime</span><span class="op" id="5810694">.</span><span class="ident" id="5810695">SetBlockProfileRate</span><span class="op" id="5810714">(</span><span class="op" id="5810715">*</span><span class="ident" id="5810716">blockProfileRate</span><span class="op" id="5810732">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810738">if</span>&nbsp;<span class="op" id="5810741">*</span><span class="ident" id="5810742">coverProfile</span>&nbsp;<span class="op" id="5810755">!=</span>&nbsp;<span class="string" id="5810758">&#34;&#34;</span>&nbsp;<span class="op" id="5810761">&amp;&amp;</span>&nbsp;<span class="ident" id="5810764">cover</span><span class="op" id="5810769">.</span><span class="ident" id="5810770">Mode</span>&nbsp;<span class="op" id="5810775">==</span>&nbsp;<span class="string" id="5810778">&#34;&#34;</span>&nbsp;<span class="op" id="5810781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810785">fmt</span><span class="op" id="5810788">.</span><span class="ident" id="5810789">Fprintf</span><span class="op" id="5810796">(</span><span class="ident" id="5810797">os</span><span class="op" id="5810799">.</span><span class="ident" id="5810800">Stderr</span><span class="op" id="5810806">,</span>&nbsp;<span class="string" id="5810808">&#34;testing:&nbsp;cannot&nbsp;use&nbsp;-test.coverprofile&nbsp;because&nbsp;test&nbsp;binary&nbsp;was&nbsp;not&nbsp;built&nbsp;with&nbsp;coverage&nbsp;enabled\n&#34;</span><span class="op" id="5810906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810910">os</span><span class="op" id="5810912">.</span><span class="ident" id="5810913">Exit</span><span class="op" id="5810917">(</span><span class="num" id="5810918">2</span><span class="op" id="5810919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810922">}</span><br>
<span class="lineno">610</span><span class="op" id="5810924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5810927">//&nbsp;after&nbsp;runs&nbsp;after&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="5810960">func</span>&nbsp;<span class="ident" id="5810965">after</span><span class="op" id="5810970">(</span><span class="op" id="5810971">)</span>&nbsp;<span class="op" id="5810973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810976">if</span>&nbsp;<span class="op" id="5810979">*</span><span class="ident" id="5810980">cpuProfile</span>&nbsp;<span class="op" id="5810991">!=</span>&nbsp;<span class="string" id="5810994">&#34;&#34;</span>&nbsp;<span class="op" id="5810997">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811001">pprof</span><span class="op" id="5811006">.</span><span class="ident" id="5811007">StopCPUProfile</span><span class="op" id="5811021">(</span><span class="op" id="5811022">)</span>&nbsp;<span class="comment" id="5811024">//&nbsp;flushes&nbsp;profile&nbsp;to&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811055">if</span>&nbsp;<span class="op" id="5811058">*</span><span class="ident" id="5811059">memProfile</span>&nbsp;<span class="op" id="5811070">!=</span>&nbsp;<span class="string" id="5811073">&#34;&#34;</span>&nbsp;<span class="op" id="5811076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811080">f</span><span class="op" id="5811081">,</span>&nbsp;<span class="ident" id="5811083">err</span>&nbsp;<span class="op" id="5811087">:=</span>&nbsp;<span class="ident" id="5811090">os</span><span class="op" id="5811092">.</span><span class="ident" id="5811093">Create</span><span class="op" id="5811099">(</span><span class="ident" id="5811100">toOutputDir</span><span class="op" id="5811111">(</span><span class="op" id="5811112">*</span><span class="ident" id="5811113">memProfile</span><span class="op" id="5811123">)</span><span class="op" id="5811124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811128">if</span>&nbsp;<span class="ident" id="5811131">err</span>&nbsp;<span class="op" id="5811135">!=</span>&nbsp;<span class="ident" id="5811138">nil</span>&nbsp;<span class="op" id="5811142">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811147">fmt</span><span class="op" id="5811150">.</span><span class="ident" id="5811151">Fprintf</span><span class="op" id="5811158">(</span><span class="ident" id="5811159">os</span><span class="op" id="5811161">.</span><span class="ident" id="5811162">Stderr</span><span class="op" id="5811168">,</span>&nbsp;<span class="string" id="5811170">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="5811185">,</span>&nbsp;<span class="ident" id="5811187">err</span><span class="op" id="5811190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811195">os</span><span class="op" id="5811197">.</span><span class="ident" id="5811198">Exit</span><span class="op" id="5811202">(</span><span class="num" id="5811203">2</span><span class="op" id="5811204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811212">runtime</span><span class="op" id="5811219">.</span><span class="ident" id="5811220">GC</span><span class="op" id="5811222">(</span><span class="op" id="5811223">)</span>&nbsp;<span class="comment" id="5811225">//&nbsp;materialize&nbsp;all&nbsp;statistics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811257">if</span>&nbsp;<span class="ident" id="5811260">err</span>&nbsp;<span class="op" id="5811264">=</span>&nbsp;<span class="ident" id="5811266">pprof</span><span class="op" id="5811271">.</span><span class="ident" id="5811272">WriteHeapProfile</span><span class="op" id="5811288">(</span><span class="ident" id="5811289">f</span><span class="op" id="5811290">)</span><span class="op" id="5811291">;</span>&nbsp;<span class="ident" id="5811293">err</span>&nbsp;<span class="op" id="5811297">!=</span>&nbsp;<span class="ident" id="5811300">nil</span>&nbsp;<span class="op" id="5811304">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811309">fmt</span><span class="op" id="5811312">.</span><span class="ident" id="5811313">Fprintf</span><span class="op" id="5811320">(</span><span class="ident" id="5811321">os</span><span class="op" id="5811323">.</span><span class="ident" id="5811324">Stderr</span><span class="op" id="5811330">,</span>&nbsp;<span class="string" id="5811332">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="5811363">,</span>&nbsp;<span class="op" id="5811365">*</span><span class="ident" id="5811366">memProfile</span><span class="op" id="5811376">,</span>&nbsp;<span class="ident" id="5811378">err</span><span class="op" id="5811381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811386">os</span><span class="op" id="5811388">.</span><span class="ident" id="5811389">Exit</span><span class="op" id="5811393">(</span><span class="num" id="5811394">2</span><span class="op" id="5811395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811403">f</span><span class="op" id="5811404">.</span><span class="ident" id="5811405">Close</span><span class="op" id="5811410">(</span><span class="op" id="5811411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811414">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811417">if</span>&nbsp;<span class="op" id="5811420">*</span><span class="ident" id="5811421">blockProfile</span>&nbsp;<span class="op" id="5811434">!=</span>&nbsp;<span class="string" id="5811437">&#34;&#34;</span>&nbsp;<span class="op" id="5811440">&amp;&amp;</span>&nbsp;<span class="op" id="5811443">*</span><span class="ident" id="5811444">blockProfileRate</span>&nbsp;<span class="op" id="5811461">&gt;=</span>&nbsp;<span class="num" id="5811464">0</span>&nbsp;<span class="op" id="5811466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811470">f</span><span class="op" id="5811471">,</span>&nbsp;<span class="ident" id="5811473">err</span>&nbsp;<span class="op" id="5811477">:=</span>&nbsp;<span class="ident" id="5811480">os</span><span class="op" id="5811482">.</span><span class="ident" id="5811483">Create</span><span class="op" id="5811489">(</span><span class="ident" id="5811490">toOutputDir</span><span class="op" id="5811501">(</span><span class="op" id="5811502">*</span><span class="ident" id="5811503">blockProfile</span><span class="op" id="5811515">)</span><span class="op" id="5811516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811520">if</span>&nbsp;<span class="ident" id="5811523">err</span>&nbsp;<span class="op" id="5811527">!=</span>&nbsp;<span class="ident" id="5811530">nil</span>&nbsp;<span class="op" id="5811534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811539">fmt</span><span class="op" id="5811542">.</span><span class="ident" id="5811543">Fprintf</span><span class="op" id="5811550">(</span><span class="ident" id="5811551">os</span><span class="op" id="5811553">.</span><span class="ident" id="5811554">Stderr</span><span class="op" id="5811560">,</span>&nbsp;<span class="string" id="5811562">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="5811577">,</span>&nbsp;<span class="ident" id="5811579">err</span><span class="op" id="5811582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811587">os</span><span class="op" id="5811589">.</span><span class="ident" id="5811590">Exit</span><span class="op" id="5811594">(</span><span class="num" id="5811595">2</span><span class="op" id="5811596">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811604">if</span>&nbsp;<span class="ident" id="5811607">err</span>&nbsp;<span class="op" id="5811611">=</span>&nbsp;<span class="ident" id="5811613">pprof</span><span class="op" id="5811618">.</span><span class="ident" id="5811619">Lookup</span><span class="op" id="5811625">(</span><span class="string" id="5811626">&#34;block&#34;</span><span class="op" id="5811633">)</span><span class="op" id="5811634">.</span><span class="ident" id="5811635">WriteTo</span><span class="op" id="5811642">(</span><span class="ident" id="5811643">f</span><span class="op" id="5811644">,</span>&nbsp;<span class="num" id="5811646">0</span><span class="op" id="5811647">)</span><span class="op" id="5811648">;</span>&nbsp;<span class="ident" id="5811650">err</span>&nbsp;<span class="op" id="5811654">!=</span>&nbsp;<span class="ident" id="5811657">nil</span>&nbsp;<span class="op" id="5811661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811666">fmt</span><span class="op" id="5811669">.</span><span class="ident" id="5811670">Fprintf</span><span class="op" id="5811677">(</span><span class="ident" id="5811678">os</span><span class="op" id="5811680">.</span><span class="ident" id="5811681">Stderr</span><span class="op" id="5811687">,</span>&nbsp;<span class="string" id="5811689">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="5811720">,</span>&nbsp;<span class="op" id="5811722">*</span><span class="ident" id="5811723">blockProfile</span><span class="op" id="5811735">,</span>&nbsp;<span class="ident" id="5811737">err</span><span class="op" id="5811740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811745">os</span><span class="op" id="5811747">.</span><span class="ident" id="5811748">Exit</span><span class="op" id="5811752">(</span><span class="num" id="5811753">2</span><span class="op" id="5811754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811758">}</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811762">f</span><span class="op" id="5811763">.</span><span class="ident" id="5811764">Close</span><span class="op" id="5811769">(</span><span class="op" id="5811770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811776">if</span>&nbsp;<span class="ident" id="5811779">cover</span><span class="op" id="5811784">.</span><span class="ident" id="5811785">Mode</span>&nbsp;<span class="op" id="5811790">!=</span>&nbsp;<span class="string" id="5811793">&#34;&#34;</span>&nbsp;<span class="op" id="5811796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811800">coverReport</span><span class="op" id="5811811">(</span><span class="op" id="5811812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811815">}</span><br>
<span class="lineno">645</span><span class="op" id="5811817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5811820">//&nbsp;toOutputDir&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;relocated,&nbsp;if&nbsp;required,&nbsp;to&nbsp;outputDir.</span><br>
<span class="lineno"></span><span class="comment" id="5811895">//&nbsp;Simple&nbsp;implementation&nbsp;to&nbsp;avoid&nbsp;pulling&nbsp;in&nbsp;path/filepath.</span><br>
<span class="lineno"></span><span class="keyword" id="5811955">func</span>&nbsp;<span class="ident" id="5811960">toOutputDir</span><span class="op" id="5811971">(</span><span class="ident" id="5811972">path</span>&nbsp;<span class="builtintype" id="5811977">string</span><span class="op" id="5811983">)</span>&nbsp;<span class="builtintype" id="5811985">string</span>&nbsp;<span class="op" id="5811992">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811995">if</span>&nbsp;<span class="op" id="5811998">*</span><span class="ident" id="5811999">outputDir</span>&nbsp;<span class="op" id="5812009">==</span>&nbsp;<span class="string" id="5812012">&#34;&#34;</span>&nbsp;<span class="op" id="5812015">||</span>&nbsp;<span class="ident" id="5812018">path</span>&nbsp;<span class="op" id="5812023">==</span>&nbsp;<span class="string" id="5812026">&#34;&#34;</span>&nbsp;<span class="op" id="5812029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812033">return</span>&nbsp;<span class="ident" id="5812040">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812049">if</span>&nbsp;<span class="ident" id="5812052">runtime</span><span class="op" id="5812059">.</span><span class="ident" id="5812060">GOOS</span>&nbsp;<span class="op" id="5812065">==</span>&nbsp;<span class="string" id="5812068">&#34;windows&#34;</span>&nbsp;<span class="op" id="5812078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5812082">//&nbsp;On&nbsp;Windows,&nbsp;it&#39;s&nbsp;clumsy,&nbsp;but&nbsp;we&nbsp;can&nbsp;be&nbsp;almost&nbsp;always&nbsp;correct</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5812148">//&nbsp;by&nbsp;just&nbsp;looking&nbsp;for&nbsp;a&nbsp;drive&nbsp;letter&nbsp;and&nbsp;a&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5812201">//&nbsp;Absolute&nbsp;paths&nbsp;always&nbsp;have&nbsp;a&nbsp;drive&nbsp;letter&nbsp;(ignoring&nbsp;UNC).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5812264">//&nbsp;Problem:&nbsp;if&nbsp;path&nbsp;==&nbsp;&#34;C:A&#34;&nbsp;and&nbsp;outputdir&nbsp;==&nbsp;&#34;C:\Go&#34;&nbsp;it&#39;s&nbsp;unclear</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5812333">//&nbsp;what&nbsp;to&nbsp;do,&nbsp;but&nbsp;even&nbsp;then&nbsp;path/filepath&nbsp;doesn&#39;t&nbsp;help.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5812392">//&nbsp;TODO:&nbsp;Worth&nbsp;doing&nbsp;better?&nbsp;Probably&nbsp;not,&nbsp;because&nbsp;we&#39;re&nbsp;here&nbsp;only</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5812461">//&nbsp;under&nbsp;the&nbsp;management&nbsp;of&nbsp;go&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812499">if</span>&nbsp;<span class="builtinfunc" id="5812502">len</span><span class="op" id="5812505">(</span><span class="ident" id="5812506">path</span><span class="op" id="5812510">)</span>&nbsp;<span class="op" id="5812512">&gt;=</span>&nbsp;<span class="num" id="5812515">2</span>&nbsp;<span class="op" id="5812517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812522">letter</span><span class="op" id="5812528">,</span>&nbsp;<span class="ident" id="5812530">colon</span>&nbsp;<span class="op" id="5812536">:=</span>&nbsp;<span class="ident" id="5812539">path</span><span class="op" id="5812543">[</span><span class="num" id="5812544">0</span><span class="op" id="5812545">]</span><span class="op" id="5812546">,</span>&nbsp;<span class="ident" id="5812548">path</span><span class="op" id="5812552">[</span><span class="num" id="5812553">1</span><span class="op" id="5812554">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812559">if</span>&nbsp;<span class="op" id="5812562">(</span><span class="string" id="5812563">&#39;a&#39;</span>&nbsp;<span class="op" id="5812567">&lt;=</span>&nbsp;<span class="ident" id="5812570">letter</span>&nbsp;<span class="op" id="5812577">&amp;&amp;</span>&nbsp;<span class="ident" id="5812580">letter</span>&nbsp;<span class="op" id="5812587">&lt;=</span>&nbsp;<span class="string" id="5812590">&#39;z&#39;</span>&nbsp;<span class="op" id="5812594">||</span>&nbsp;<span class="string" id="5812597">&#39;A&#39;</span>&nbsp;<span class="op" id="5812601">&lt;=</span>&nbsp;<span class="ident" id="5812604">letter</span>&nbsp;<span class="op" id="5812611">&amp;&amp;</span>&nbsp;<span class="ident" id="5812614">letter</span>&nbsp;<span class="op" id="5812621">&lt;=</span>&nbsp;<span class="string" id="5812624">&#39;Z&#39;</span><span class="op" id="5812627">)</span>&nbsp;<span class="op" id="5812629">&amp;&amp;</span>&nbsp;<span class="ident" id="5812632">colon</span>&nbsp;<span class="op" id="5812638">==</span>&nbsp;<span class="string" id="5812641">&#39;:&#39;</span>&nbsp;<span class="op" id="5812645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5812651">//&nbsp;If&nbsp;path&nbsp;starts&nbsp;with&nbsp;a&nbsp;drive&nbsp;letter&nbsp;we&#39;re&nbsp;stuck&nbsp;with&nbsp;it&nbsp;regardless.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812725">return</span>&nbsp;<span class="ident" id="5812732">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812750">if</span>&nbsp;<span class="ident" id="5812753">os</span><span class="op" id="5812755">.</span><span class="ident" id="5812756">IsPathSeparator</span><span class="op" id="5812771">(</span><span class="ident" id="5812772">path</span><span class="op" id="5812776">[</span><span class="num" id="5812777">0</span><span class="op" id="5812778">]</span><span class="op" id="5812779">)</span>&nbsp;<span class="op" id="5812781">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812785">return</span>&nbsp;<span class="ident" id="5812792">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812801">return</span>&nbsp;<span class="ident" id="5812808">fmt</span><span class="op" id="5812811">.</span><span class="ident" id="5812812">Sprintf</span><span class="op" id="5812819">(</span><span class="string" id="5812820">&#34;%s%c%s&#34;</span><span class="op" id="5812828">,</span>&nbsp;<span class="op" id="5812830">*</span><span class="ident" id="5812831">outputDir</span><span class="op" id="5812840">,</span>&nbsp;<span class="ident" id="5812842">os</span><span class="op" id="5812844">.</span><span class="ident" id="5812845">PathSeparator</span><span class="op" id="5812858">,</span>&nbsp;<span class="ident" id="5812860">path</span><span class="op" id="5812864">)</span><br>
<span class="lineno"></span><span class="op" id="5812866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="5812869">var</span>&nbsp;<span class="ident" id="5812873">timer</span>&nbsp;<span class="op" id="5812879">*</span><span class="ident" id="5812880">time</span><span class="op" id="5812884">.</span><span class="ident" id="5812885">Timer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5812892">//&nbsp;startAlarm&nbsp;starts&nbsp;an&nbsp;alarm&nbsp;if&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="5812936">func</span>&nbsp;<span class="ident" id="5812941">startAlarm</span><span class="op" id="5812951">(</span><span class="op" id="5812952">)</span>&nbsp;<span class="op" id="5812954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812957">if</span>&nbsp;<span class="op" id="5812960">*</span><span class="ident" id="5812961">timeout</span>&nbsp;<span class="op" id="5812969">&gt;</span>&nbsp;<span class="num" id="5812971">0</span>&nbsp;<span class="op" id="5812973">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812977">timer</span>&nbsp;<span class="op" id="5812983">=</span>&nbsp;<span class="ident" id="5812985">time</span><span class="op" id="5812989">.</span><span class="ident" id="5812990">AfterFunc</span><span class="op" id="5812999">(</span><span class="op" id="5813000">*</span><span class="ident" id="5813001">timeout</span><span class="op" id="5813008">,</span>&nbsp;<span class="keyword" id="5813010">func</span><span class="op" id="5813014">(</span><span class="op" id="5813015">)</span>&nbsp;<span class="op" id="5813017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5813022">panic</span><span class="op" id="5813027">(</span><span class="ident" id="5813028">fmt</span><span class="op" id="5813031">.</span><span class="ident" id="5813032">Sprintf</span><span class="op" id="5813039">(</span><span class="string" id="5813040">&#34;test&nbsp;timed&nbsp;out&nbsp;after&nbsp;%v&#34;</span><span class="op" id="5813065">,</span>&nbsp;<span class="op" id="5813067">*</span><span class="ident" id="5813068">timeout</span><span class="op" id="5813075">)</span><span class="op" id="5813076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813080">}</span><span class="op" id="5813081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813084">}</span><br>
<span class="lineno"></span><span class="op" id="5813086">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="5813089">//&nbsp;stopAlarm&nbsp;turns&nbsp;off&nbsp;the&nbsp;alarm.</span><br>
<span class="lineno"></span><span class="keyword" id="5813123">func</span>&nbsp;<span class="ident" id="5813128">stopAlarm</span><span class="op" id="5813137">(</span><span class="op" id="5813138">)</span>&nbsp;<span class="op" id="5813140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813143">if</span>&nbsp;<span class="op" id="5813146">*</span><span class="ident" id="5813147">timeout</span>&nbsp;<span class="op" id="5813155">&gt;</span>&nbsp;<span class="num" id="5813157">0</span>&nbsp;<span class="op" id="5813159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813163">timer</span><span class="op" id="5813168">.</span><span class="ident" id="5813169">Stop</span><span class="op" id="5813173">(</span><span class="op" id="5813174">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813177">}</span><br>
<span class="lineno"></span><span class="op" id="5813179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5813182">func</span>&nbsp;<span class="ident" id="5813187">parseCpuList</span><span class="op" id="5813199">(</span><span class="op" id="5813200">)</span>&nbsp;<span class="op" id="5813202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813205">for</span>&nbsp;<span class="ident" id="5813209">_</span><span class="op" id="5813210">,</span>&nbsp;<span class="ident" id="5813212">val</span>&nbsp;<span class="op" id="5813216">:=</span>&nbsp;<span class="keyword" id="5813219">range</span>&nbsp;<span class="ident" id="5813225">strings</span><span class="op" id="5813232">.</span><span class="ident" id="5813233">Split</span><span class="op" id="5813238">(</span><span class="op" id="5813239">*</span><span class="ident" id="5813240">cpuListStr</span><span class="op" id="5813250">,</span>&nbsp;<span class="string" id="5813252">&#34;,&#34;</span><span class="op" id="5813255">)</span>&nbsp;<span class="op" id="5813257">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813261">val</span>&nbsp;<span class="op" id="5813265">=</span>&nbsp;<span class="ident" id="5813267">strings</span><span class="op" id="5813274">.</span><span class="ident" id="5813275">TrimSpace</span><span class="op" id="5813284">(</span><span class="ident" id="5813285">val</span><span class="op" id="5813288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813292">if</span>&nbsp;<span class="ident" id="5813295">val</span>&nbsp;<span class="op" id="5813299">==</span>&nbsp;<span class="string" id="5813302">&#34;&#34;</span>&nbsp;<span class="op" id="5813305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813310">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813325">cpu</span><span class="op" id="5813328">,</span>&nbsp;<span class="ident" id="5813330">err</span>&nbsp;<span class="op" id="5813334">:=</span>&nbsp;<span class="ident" id="5813337">strconv</span><span class="op" id="5813344">.</span><span class="ident" id="5813345">Atoi</span><span class="op" id="5813349">(</span><span class="ident" id="5813350">val</span><span class="op" id="5813353">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813357">if</span>&nbsp;<span class="ident" id="5813360">err</span>&nbsp;<span class="op" id="5813364">!=</span>&nbsp;<span class="ident" id="5813367">nil</span>&nbsp;<span class="op" id="5813371">||</span>&nbsp;<span class="ident" id="5813374">cpu</span>&nbsp;<span class="op" id="5813378">&lt;=</span>&nbsp;<span class="num" id="5813381">0</span>&nbsp;<span class="op" id="5813383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813388">fmt</span><span class="op" id="5813391">.</span><span class="ident" id="5813392">Fprintf</span><span class="op" id="5813399">(</span><span class="ident" id="5813400">os</span><span class="op" id="5813402">.</span><span class="ident" id="5813403">Stderr</span><span class="op" id="5813409">,</span>&nbsp;<span class="string" id="5813411">&#34;testing:&nbsp;invalid&nbsp;value&nbsp;%q&nbsp;for&nbsp;-test.cpu\n&#34;</span><span class="op" id="5813454">,</span>&nbsp;<span class="ident" id="5813456">val</span><span class="op" id="5813459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813464">os</span><span class="op" id="5813466">.</span><span class="ident" id="5813467">Exit</span><span class="op" id="5813471">(</span><span class="num" id="5813472">1</span><span class="op" id="5813473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813481">cpuList</span>&nbsp;<span class="op" id="5813489">=</span>&nbsp;<span class="builtinfunc" id="5813491">append</span><span class="op" id="5813497">(</span><span class="ident" id="5813498">cpuList</span><span class="op" id="5813505">,</span>&nbsp;<span class="ident" id="5813507">cpu</span><span class="op" id="5813510">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813516">if</span>&nbsp;<span class="ident" id="5813519">cpuList</span>&nbsp;<span class="op" id="5813527">==</span>&nbsp;<span class="ident" id="5813530">nil</span>&nbsp;<span class="op" id="5813534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813538">cpuList</span>&nbsp;<span class="op" id="5813546">=</span>&nbsp;<span class="builtinfunc" id="5813548">append</span><span class="op" id="5813554">(</span><span class="ident" id="5813555">cpuList</span><span class="op" id="5813562">,</span>&nbsp;<span class="ident" id="5813564">runtime</span><span class="op" id="5813571">.</span><span class="ident" id="5813572">GOMAXPROCS</span><span class="op" id="5813582">(</span><span class="op" id="5813583">-</span><span class="num" id="5813584">1</span><span class="op" id="5813585">)</span><span class="op" id="5813586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813589">}</span><br>
<span class="lineno"></span><span class="op" id="5813591">}</span>
</div>
</body>
</html>
