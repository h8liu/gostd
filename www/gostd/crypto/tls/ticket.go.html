<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4551895">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4551950">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4552004">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4552055">package</span>&nbsp;<span class="ident" id="4552063">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4552068">import</span>&nbsp;<span class="op" id="4552075">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4552078">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4552087">&#34;crypto/aes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4552101">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4552118">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4552133">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4552150">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4552167">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4552177">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4552182">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4552185">//&nbsp;sessionState&nbsp;contains&nbsp;the&nbsp;information&nbsp;that&nbsp;is&nbsp;serialized&nbsp;into&nbsp;a&nbsp;session</span><br>
<span class="lineno"></span><span class="comment" id="4552260">//&nbsp;ticket&nbsp;in&nbsp;order&nbsp;to&nbsp;later&nbsp;resume&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="4552309">type</span>&nbsp;<span class="ident" id="4552314">sessionState</span>&nbsp;<span class="keyword" id="4552327">struct</span>&nbsp;<span class="op" id="4552334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552337">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4552350">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552358">cipherSuite</span>&nbsp;&nbsp;<span class="builtintype" id="4552371">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552379">masterSecret</span>&nbsp;<span class="op" id="4552392">[</span><span class="op" id="4552393">]</span><span class="builtintype" id="4552394">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552400">certificates</span>&nbsp;<span class="op" id="4552413">[</span><span class="op" id="4552414">]</span><span class="op" id="4552415">[</span><span class="op" id="4552416">]</span><span class="builtintype" id="4552417">byte</span><br>
<span class="lineno">25</span><span class="op" id="4552422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4552425">func</span>&nbsp;<span class="op" id="4552430">(</span><span class="ident" id="4552431">s</span>&nbsp;<span class="op" id="4552433">*</span><span class="ident" id="4552434">sessionState</span><span class="op" id="4552446">)</span>&nbsp;<span class="ident" id="4552448">equal</span><span class="op" id="4552453">(</span><span class="ident" id="4552454">i</span>&nbsp;<span class="keyword" id="4552456">interface</span><span class="op" id="4552465">{</span><span class="op" id="4552466">}</span><span class="op" id="4552467">)</span>&nbsp;<span class="builtintype" id="4552469">bool</span>&nbsp;<span class="op" id="4552474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552477">s1</span><span class="op" id="4552479">,</span>&nbsp;<span class="ident" id="4552481">ok</span>&nbsp;<span class="op" id="4552484">:=</span>&nbsp;<span class="ident" id="4552487">i</span><span class="op" id="4552488">.</span><span class="op" id="4552489">(</span><span class="op" id="4552490">*</span><span class="ident" id="4552491">sessionState</span><span class="op" id="4552503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552506">if</span>&nbsp;<span class="op" id="4552509">!</span><span class="ident" id="4552510">ok</span>&nbsp;<span class="op" id="4552513">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552517">return</span>&nbsp;<span class="builtintype" id="4552524">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4552531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552535">if</span>&nbsp;<span class="ident" id="4552538">s</span><span class="op" id="4552539">.</span><span class="ident" id="4552540">vers</span>&nbsp;<span class="op" id="4552545">!=</span>&nbsp;<span class="ident" id="4552548">s1</span><span class="op" id="4552550">.</span><span class="ident" id="4552551">vers</span>&nbsp;<span class="op" id="4552556">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552561">s</span><span class="op" id="4552562">.</span><span class="ident" id="4552563">cipherSuite</span>&nbsp;<span class="op" id="4552575">!=</span>&nbsp;<span class="ident" id="4552578">s1</span><span class="op" id="4552580">.</span><span class="ident" id="4552581">cipherSuite</span>&nbsp;<span class="op" id="4552593">||</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4552598">!</span><span class="ident" id="4552599">bytes</span><span class="op" id="4552604">.</span><span class="ident" id="4552605">Equal</span><span class="op" id="4552610">(</span><span class="ident" id="4552611">s</span><span class="op" id="4552612">.</span><span class="ident" id="4552613">masterSecret</span><span class="op" id="4552625">,</span>&nbsp;<span class="ident" id="4552627">s1</span><span class="op" id="4552629">.</span><span class="ident" id="4552630">masterSecret</span><span class="op" id="4552642">)</span>&nbsp;<span class="op" id="4552644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552648">return</span>&nbsp;<span class="builtintype" id="4552655">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4552662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552666">if</span>&nbsp;<span class="builtinfunc" id="4552669">len</span><span class="op" id="4552672">(</span><span class="ident" id="4552673">s</span><span class="op" id="4552674">.</span><span class="ident" id="4552675">certificates</span><span class="op" id="4552687">)</span>&nbsp;<span class="op" id="4552689">!=</span>&nbsp;<span class="builtinfunc" id="4552692">len</span><span class="op" id="4552695">(</span><span class="ident" id="4552696">s1</span><span class="op" id="4552698">.</span><span class="ident" id="4552699">certificates</span><span class="op" id="4552711">)</span>&nbsp;<span class="op" id="4552713">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552717">return</span>&nbsp;<span class="builtintype" id="4552724">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4552731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552735">for</span>&nbsp;<span class="ident" id="4552739">i</span>&nbsp;<span class="op" id="4552741">:=</span>&nbsp;<span class="keyword" id="4552744">range</span>&nbsp;<span class="ident" id="4552750">s</span><span class="op" id="4552751">.</span><span class="ident" id="4552752">certificates</span>&nbsp;<span class="op" id="4552765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552769">if</span>&nbsp;<span class="op" id="4552772">!</span><span class="ident" id="4552773">bytes</span><span class="op" id="4552778">.</span><span class="ident" id="4552779">Equal</span><span class="op" id="4552784">(</span><span class="ident" id="4552785">s</span><span class="op" id="4552786">.</span><span class="ident" id="4552787">certificates</span><span class="op" id="4552799">[</span><span class="ident" id="4552800">i</span><span class="op" id="4552801">]</span><span class="op" id="4552802">,</span>&nbsp;<span class="ident" id="4552804">s1</span><span class="op" id="4552806">.</span><span class="ident" id="4552807">certificates</span><span class="op" id="4552819">[</span><span class="ident" id="4552820">i</span><span class="op" id="4552821">]</span><span class="op" id="4552822">)</span>&nbsp;<span class="op" id="4552824">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552829">return</span>&nbsp;<span class="builtintype" id="4552836">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4552844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4552847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552851">return</span>&nbsp;<span class="builtintype" id="4552858">true</span><br>
<span class="lineno">50</span><span class="op" id="4552863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4552866">func</span>&nbsp;<span class="op" id="4552871">(</span><span class="ident" id="4552872">s</span>&nbsp;<span class="op" id="4552874">*</span><span class="ident" id="4552875">sessionState</span><span class="op" id="4552887">)</span>&nbsp;<span class="ident" id="4552889">marshal</span><span class="op" id="4552896">(</span><span class="op" id="4552897">)</span>&nbsp;<span class="op" id="4552899">[</span><span class="op" id="4552900">]</span><span class="builtintype" id="4552901">byte</span>&nbsp;<span class="op" id="4552906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552909">length</span>&nbsp;<span class="op" id="4552916">:=</span>&nbsp;<span class="num" id="4552919">2</span>&nbsp;<span class="op" id="4552921">+</span>&nbsp;<span class="num" id="4552923">2</span>&nbsp;<span class="op" id="4552925">+</span>&nbsp;<span class="num" id="4552927">2</span>&nbsp;<span class="op" id="4552929">+</span>&nbsp;<span class="builtinfunc" id="4552931">len</span><span class="op" id="4552934">(</span><span class="ident" id="4552935">s</span><span class="op" id="4552936">.</span><span class="ident" id="4552937">masterSecret</span><span class="op" id="4552949">)</span>&nbsp;<span class="op" id="4552951">+</span>&nbsp;<span class="num" id="4552953">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552956">for</span>&nbsp;<span class="ident" id="4552960">_</span><span class="op" id="4552961">,</span>&nbsp;<span class="ident" id="4552963">cert</span>&nbsp;<span class="op" id="4552968">:=</span>&nbsp;<span class="keyword" id="4552971">range</span>&nbsp;<span class="ident" id="4552977">s</span><span class="op" id="4552978">.</span><span class="ident" id="4552979">certificates</span>&nbsp;<span class="op" id="4552992">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552996">length</span>&nbsp;<span class="op" id="4553003">+=</span>&nbsp;<span class="num" id="4553006">4</span>&nbsp;<span class="op" id="4553008">+</span>&nbsp;<span class="builtinfunc" id="4553010">len</span><span class="op" id="4553013">(</span><span class="ident" id="4553014">cert</span><span class="op" id="4553018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553025">ret</span>&nbsp;<span class="op" id="4553029">:=</span>&nbsp;<span class="builtinfunc" id="4553032">make</span><span class="op" id="4553036">(</span><span class="op" id="4553037">[</span><span class="op" id="4553038">]</span><span class="builtintype" id="4553039">byte</span><span class="op" id="4553043">,</span>&nbsp;<span class="ident" id="4553045">length</span><span class="op" id="4553051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553054">x</span>&nbsp;<span class="op" id="4553056">:=</span>&nbsp;<span class="ident" id="4553059">ret</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553064">x</span><span class="op" id="4553065">[</span><span class="num" id="4553066">0</span><span class="op" id="4553067">]</span>&nbsp;<span class="op" id="4553069">=</span>&nbsp;<span class="builtintype" id="4553071">byte</span><span class="op" id="4553075">(</span><span class="ident" id="4553076">s</span><span class="op" id="4553077">.</span><span class="ident" id="4553078">vers</span>&nbsp;<span class="op" id="4553083">&gt;&gt;</span>&nbsp;<span class="num" id="4553086">8</span><span class="op" id="4553087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553090">x</span><span class="op" id="4553091">[</span><span class="num" id="4553092">1</span><span class="op" id="4553093">]</span>&nbsp;<span class="op" id="4553095">=</span>&nbsp;<span class="builtintype" id="4553097">byte</span><span class="op" id="4553101">(</span><span class="ident" id="4553102">s</span><span class="op" id="4553103">.</span><span class="ident" id="4553104">vers</span><span class="op" id="4553108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553111">x</span><span class="op" id="4553112">[</span><span class="num" id="4553113">2</span><span class="op" id="4553114">]</span>&nbsp;<span class="op" id="4553116">=</span>&nbsp;<span class="builtintype" id="4553118">byte</span><span class="op" id="4553122">(</span><span class="ident" id="4553123">s</span><span class="op" id="4553124">.</span><span class="ident" id="4553125">cipherSuite</span>&nbsp;<span class="op" id="4553137">&gt;&gt;</span>&nbsp;<span class="num" id="4553140">8</span><span class="op" id="4553141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553144">x</span><span class="op" id="4553145">[</span><span class="num" id="4553146">3</span><span class="op" id="4553147">]</span>&nbsp;<span class="op" id="4553149">=</span>&nbsp;<span class="builtintype" id="4553151">byte</span><span class="op" id="4553155">(</span><span class="ident" id="4553156">s</span><span class="op" id="4553157">.</span><span class="ident" id="4553158">cipherSuite</span><span class="op" id="4553169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553172">x</span><span class="op" id="4553173">[</span><span class="num" id="4553174">4</span><span class="op" id="4553175">]</span>&nbsp;<span class="op" id="4553177">=</span>&nbsp;<span class="builtintype" id="4553179">byte</span><span class="op" id="4553183">(</span><span class="builtinfunc" id="4553184">len</span><span class="op" id="4553187">(</span><span class="ident" id="4553188">s</span><span class="op" id="4553189">.</span><span class="ident" id="4553190">masterSecret</span><span class="op" id="4553202">)</span>&nbsp;<span class="op" id="4553204">&gt;&gt;</span>&nbsp;<span class="num" id="4553207">8</span><span class="op" id="4553208">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553211">x</span><span class="op" id="4553212">[</span><span class="num" id="4553213">5</span><span class="op" id="4553214">]</span>&nbsp;<span class="op" id="4553216">=</span>&nbsp;<span class="builtintype" id="4553218">byte</span><span class="op" id="4553222">(</span><span class="builtinfunc" id="4553223">len</span><span class="op" id="4553226">(</span><span class="ident" id="4553227">s</span><span class="op" id="4553228">.</span><span class="ident" id="4553229">masterSecret</span><span class="op" id="4553241">)</span><span class="op" id="4553242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553245">x</span>&nbsp;<span class="op" id="4553247">=</span>&nbsp;<span class="ident" id="4553249">x</span><span class="op" id="4553250">[</span><span class="num" id="4553251">6</span><span class="op" id="4553252">:</span><span class="op" id="4553253">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4553256">copy</span><span class="op" id="4553260">(</span><span class="ident" id="4553261">x</span><span class="op" id="4553262">,</span>&nbsp;<span class="ident" id="4553264">s</span><span class="op" id="4553265">.</span><span class="ident" id="4553266">masterSecret</span><span class="op" id="4553278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553281">x</span>&nbsp;<span class="op" id="4553283">=</span>&nbsp;<span class="ident" id="4553285">x</span><span class="op" id="4553286">[</span><span class="builtinfunc" id="4553287">len</span><span class="op" id="4553290">(</span><span class="ident" id="4553291">s</span><span class="op" id="4553292">.</span><span class="ident" id="4553293">masterSecret</span><span class="op" id="4553305">)</span><span class="op" id="4553306">:</span><span class="op" id="4553307">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553311">x</span><span class="op" id="4553312">[</span><span class="num" id="4553313">0</span><span class="op" id="4553314">]</span>&nbsp;<span class="op" id="4553316">=</span>&nbsp;<span class="builtintype" id="4553318">byte</span><span class="op" id="4553322">(</span><span class="builtinfunc" id="4553323">len</span><span class="op" id="4553326">(</span><span class="ident" id="4553327">s</span><span class="op" id="4553328">.</span><span class="ident" id="4553329">certificates</span><span class="op" id="4553341">)</span>&nbsp;<span class="op" id="4553343">&gt;&gt;</span>&nbsp;<span class="num" id="4553346">8</span><span class="op" id="4553347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553350">x</span><span class="op" id="4553351">[</span><span class="num" id="4553352">1</span><span class="op" id="4553353">]</span>&nbsp;<span class="op" id="4553355">=</span>&nbsp;<span class="builtintype" id="4553357">byte</span><span class="op" id="4553361">(</span><span class="builtinfunc" id="4553362">len</span><span class="op" id="4553365">(</span><span class="ident" id="4553366">s</span><span class="op" id="4553367">.</span><span class="ident" id="4553368">certificates</span><span class="op" id="4553380">)</span><span class="op" id="4553381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553384">x</span>&nbsp;<span class="op" id="4553386">=</span>&nbsp;<span class="ident" id="4553388">x</span><span class="op" id="4553389">[</span><span class="num" id="4553390">2</span><span class="op" id="4553391">:</span><span class="op" id="4553392">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553396">for</span>&nbsp;<span class="ident" id="4553400">_</span><span class="op" id="4553401">,</span>&nbsp;<span class="ident" id="4553403">cert</span>&nbsp;<span class="op" id="4553408">:=</span>&nbsp;<span class="keyword" id="4553411">range</span>&nbsp;<span class="ident" id="4553417">s</span><span class="op" id="4553418">.</span><span class="ident" id="4553419">certificates</span>&nbsp;<span class="op" id="4553432">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553436">x</span><span class="op" id="4553437">[</span><span class="num" id="4553438">0</span><span class="op" id="4553439">]</span>&nbsp;<span class="op" id="4553441">=</span>&nbsp;<span class="builtintype" id="4553443">byte</span><span class="op" id="4553447">(</span><span class="builtinfunc" id="4553448">len</span><span class="op" id="4553451">(</span><span class="ident" id="4553452">cert</span><span class="op" id="4553456">)</span>&nbsp;<span class="op" id="4553458">&gt;&gt;</span>&nbsp;<span class="num" id="4553461">24</span><span class="op" id="4553463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553467">x</span><span class="op" id="4553468">[</span><span class="num" id="4553469">1</span><span class="op" id="4553470">]</span>&nbsp;<span class="op" id="4553472">=</span>&nbsp;<span class="builtintype" id="4553474">byte</span><span class="op" id="4553478">(</span><span class="builtinfunc" id="4553479">len</span><span class="op" id="4553482">(</span><span class="ident" id="4553483">cert</span><span class="op" id="4553487">)</span>&nbsp;<span class="op" id="4553489">&gt;&gt;</span>&nbsp;<span class="num" id="4553492">16</span><span class="op" id="4553494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553498">x</span><span class="op" id="4553499">[</span><span class="num" id="4553500">2</span><span class="op" id="4553501">]</span>&nbsp;<span class="op" id="4553503">=</span>&nbsp;<span class="builtintype" id="4553505">byte</span><span class="op" id="4553509">(</span><span class="builtinfunc" id="4553510">len</span><span class="op" id="4553513">(</span><span class="ident" id="4553514">cert</span><span class="op" id="4553518">)</span>&nbsp;<span class="op" id="4553520">&gt;&gt;</span>&nbsp;<span class="num" id="4553523">8</span><span class="op" id="4553524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553528">x</span><span class="op" id="4553529">[</span><span class="num" id="4553530">3</span><span class="op" id="4553531">]</span>&nbsp;<span class="op" id="4553533">=</span>&nbsp;<span class="builtintype" id="4553535">byte</span><span class="op" id="4553539">(</span><span class="builtinfunc" id="4553540">len</span><span class="op" id="4553543">(</span><span class="ident" id="4553544">cert</span><span class="op" id="4553548">)</span><span class="op" id="4553549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4553553">copy</span><span class="op" id="4553557">(</span><span class="ident" id="4553558">x</span><span class="op" id="4553559">[</span><span class="num" id="4553560">4</span><span class="op" id="4553561">:</span><span class="op" id="4553562">]</span><span class="op" id="4553563">,</span>&nbsp;<span class="ident" id="4553565">cert</span><span class="op" id="4553569">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553573">x</span>&nbsp;<span class="op" id="4553575">=</span>&nbsp;<span class="ident" id="4553577">x</span><span class="op" id="4553578">[</span><span class="num" id="4553579">4</span><span class="op" id="4553580">+</span><span class="builtinfunc" id="4553581">len</span><span class="op" id="4553584">(</span><span class="ident" id="4553585">cert</span><span class="op" id="4553589">)</span><span class="op" id="4553590">:</span><span class="op" id="4553591">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553598">return</span>&nbsp;<span class="ident" id="4553605">ret</span><br>
<span class="lineno"></span><span class="op" id="4553609">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="4553612">func</span>&nbsp;<span class="op" id="4553617">(</span><span class="ident" id="4553618">s</span>&nbsp;<span class="op" id="4553620">*</span><span class="ident" id="4553621">sessionState</span><span class="op" id="4553633">)</span>&nbsp;<span class="ident" id="4553635">unmarshal</span><span class="op" id="4553644">(</span><span class="ident" id="4553645">data</span>&nbsp;<span class="op" id="4553650">[</span><span class="op" id="4553651">]</span><span class="builtintype" id="4553652">byte</span><span class="op" id="4553656">)</span>&nbsp;<span class="builtintype" id="4553658">bool</span>&nbsp;<span class="op" id="4553663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553666">if</span>&nbsp;<span class="builtinfunc" id="4553669">len</span><span class="op" id="4553672">(</span><span class="ident" id="4553673">data</span><span class="op" id="4553677">)</span>&nbsp;<span class="op" id="4553679">&lt;</span>&nbsp;<span class="num" id="4553681">8</span>&nbsp;<span class="op" id="4553683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553687">return</span>&nbsp;<span class="builtintype" id="4553694">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553701">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553705">s</span><span class="op" id="4553706">.</span><span class="ident" id="4553707">vers</span>&nbsp;<span class="op" id="4553712">=</span>&nbsp;<span class="builtintype" id="4553714">uint16</span><span class="op" id="4553720">(</span><span class="ident" id="4553721">data</span><span class="op" id="4553725">[</span><span class="num" id="4553726">0</span><span class="op" id="4553727">]</span><span class="op" id="4553728">)</span><span class="op" id="4553729">&lt;&lt;</span><span class="num" id="4553731">8</span>&nbsp;<span class="op" id="4553733">|</span>&nbsp;<span class="builtintype" id="4553735">uint16</span><span class="op" id="4553741">(</span><span class="ident" id="4553742">data</span><span class="op" id="4553746">[</span><span class="num" id="4553747">1</span><span class="op" id="4553748">]</span><span class="op" id="4553749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553752">s</span><span class="op" id="4553753">.</span><span class="ident" id="4553754">cipherSuite</span>&nbsp;<span class="op" id="4553766">=</span>&nbsp;<span class="builtintype" id="4553768">uint16</span><span class="op" id="4553774">(</span><span class="ident" id="4553775">data</span><span class="op" id="4553779">[</span><span class="num" id="4553780">2</span><span class="op" id="4553781">]</span><span class="op" id="4553782">)</span><span class="op" id="4553783">&lt;&lt;</span><span class="num" id="4553785">8</span>&nbsp;<span class="op" id="4553787">|</span>&nbsp;<span class="builtintype" id="4553789">uint16</span><span class="op" id="4553795">(</span><span class="ident" id="4553796">data</span><span class="op" id="4553800">[</span><span class="num" id="4553801">3</span><span class="op" id="4553802">]</span><span class="op" id="4553803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553806">masterSecretLen</span>&nbsp;<span class="op" id="4553822">:=</span>&nbsp;<span class="builtintype" id="4553825">int</span><span class="op" id="4553828">(</span><span class="ident" id="4553829">data</span><span class="op" id="4553833">[</span><span class="num" id="4553834">4</span><span class="op" id="4553835">]</span><span class="op" id="4553836">)</span><span class="op" id="4553837">&lt;&lt;</span><span class="num" id="4553839">8</span>&nbsp;<span class="op" id="4553841">|</span>&nbsp;<span class="builtintype" id="4553843">int</span><span class="op" id="4553846">(</span><span class="ident" id="4553847">data</span><span class="op" id="4553851">[</span><span class="num" id="4553852">5</span><span class="op" id="4553853">]</span><span class="op" id="4553854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553857">data</span>&nbsp;<span class="op" id="4553862">=</span>&nbsp;<span class="ident" id="4553864">data</span><span class="op" id="4553868">[</span><span class="num" id="4553869">6</span><span class="op" id="4553870">:</span><span class="op" id="4553871">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553874">if</span>&nbsp;<span class="builtinfunc" id="4553877">len</span><span class="op" id="4553880">(</span><span class="ident" id="4553881">data</span><span class="op" id="4553885">)</span>&nbsp;<span class="op" id="4553887">&lt;</span>&nbsp;<span class="ident" id="4553889">masterSecretLen</span>&nbsp;<span class="op" id="4553905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553909">return</span>&nbsp;<span class="builtintype" id="4553916">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553927">s</span><span class="op" id="4553928">.</span><span class="ident" id="4553929">masterSecret</span>&nbsp;<span class="op" id="4553942">=</span>&nbsp;<span class="ident" id="4553944">data</span><span class="op" id="4553948">[</span><span class="op" id="4553949">:</span><span class="ident" id="4553950">masterSecretLen</span><span class="op" id="4553965">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553968">data</span>&nbsp;<span class="op" id="4553973">=</span>&nbsp;<span class="ident" id="4553975">data</span><span class="op" id="4553979">[</span><span class="ident" id="4553980">masterSecretLen</span><span class="op" id="4553995">:</span><span class="op" id="4553996">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554000">if</span>&nbsp;<span class="builtinfunc" id="4554003">len</span><span class="op" id="4554006">(</span><span class="ident" id="4554007">data</span><span class="op" id="4554011">)</span>&nbsp;<span class="op" id="4554013">&lt;</span>&nbsp;<span class="num" id="4554015">2</span>&nbsp;<span class="op" id="4554017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554021">return</span>&nbsp;<span class="builtintype" id="4554028">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4554035">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554039">numCerts</span>&nbsp;<span class="op" id="4554048">:=</span>&nbsp;<span class="builtintype" id="4554051">int</span><span class="op" id="4554054">(</span><span class="ident" id="4554055">data</span><span class="op" id="4554059">[</span><span class="num" id="4554060">0</span><span class="op" id="4554061">]</span><span class="op" id="4554062">)</span><span class="op" id="4554063">&lt;&lt;</span><span class="num" id="4554065">8</span>&nbsp;<span class="op" id="4554067">|</span>&nbsp;<span class="builtintype" id="4554069">int</span><span class="op" id="4554072">(</span><span class="ident" id="4554073">data</span><span class="op" id="4554077">[</span><span class="num" id="4554078">1</span><span class="op" id="4554079">]</span><span class="op" id="4554080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554083">data</span>&nbsp;<span class="op" id="4554088">=</span>&nbsp;<span class="ident" id="4554090">data</span><span class="op" id="4554094">[</span><span class="num" id="4554095">2</span><span class="op" id="4554096">:</span><span class="op" id="4554097">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554101">s</span><span class="op" id="4554102">.</span><span class="ident" id="4554103">certificates</span>&nbsp;<span class="op" id="4554116">=</span>&nbsp;<span class="builtinfunc" id="4554118">make</span><span class="op" id="4554122">(</span><span class="op" id="4554123">[</span><span class="op" id="4554124">]</span><span class="op" id="4554125">[</span><span class="op" id="4554126">]</span><span class="builtintype" id="4554127">byte</span><span class="op" id="4554131">,</span>&nbsp;<span class="ident" id="4554133">numCerts</span><span class="op" id="4554141">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554144">for</span>&nbsp;<span class="ident" id="4554148">i</span>&nbsp;<span class="op" id="4554150">:=</span>&nbsp;<span class="keyword" id="4554153">range</span>&nbsp;<span class="ident" id="4554159">s</span><span class="op" id="4554160">.</span><span class="ident" id="4554161">certificates</span>&nbsp;<span class="op" id="4554174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554178">if</span>&nbsp;<span class="builtinfunc" id="4554181">len</span><span class="op" id="4554184">(</span><span class="ident" id="4554185">data</span><span class="op" id="4554189">)</span>&nbsp;<span class="op" id="4554191">&lt;</span>&nbsp;<span class="num" id="4554193">4</span>&nbsp;<span class="op" id="4554195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554200">return</span>&nbsp;<span class="builtintype" id="4554207">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4554215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554219">certLen</span>&nbsp;<span class="op" id="4554227">:=</span>&nbsp;<span class="builtintype" id="4554230">int</span><span class="op" id="4554233">(</span><span class="ident" id="4554234">data</span><span class="op" id="4554238">[</span><span class="num" id="4554239">0</span><span class="op" id="4554240">]</span><span class="op" id="4554241">)</span><span class="op" id="4554242">&lt;&lt;</span><span class="num" id="4554244">24</span>&nbsp;<span class="op" id="4554247">|</span>&nbsp;<span class="builtintype" id="4554249">int</span><span class="op" id="4554252">(</span><span class="ident" id="4554253">data</span><span class="op" id="4554257">[</span><span class="num" id="4554258">1</span><span class="op" id="4554259">]</span><span class="op" id="4554260">)</span><span class="op" id="4554261">&lt;&lt;</span><span class="num" id="4554263">16</span>&nbsp;<span class="op" id="4554266">|</span>&nbsp;<span class="builtintype" id="4554268">int</span><span class="op" id="4554271">(</span><span class="ident" id="4554272">data</span><span class="op" id="4554276">[</span><span class="num" id="4554277">2</span><span class="op" id="4554278">]</span><span class="op" id="4554279">)</span><span class="op" id="4554280">&lt;&lt;</span><span class="num" id="4554282">8</span>&nbsp;<span class="op" id="4554284">|</span>&nbsp;<span class="builtintype" id="4554286">int</span><span class="op" id="4554289">(</span><span class="ident" id="4554290">data</span><span class="op" id="4554294">[</span><span class="num" id="4554295">3</span><span class="op" id="4554296">]</span><span class="op" id="4554297">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554301">data</span>&nbsp;<span class="op" id="4554306">=</span>&nbsp;<span class="ident" id="4554308">data</span><span class="op" id="4554312">[</span><span class="num" id="4554313">4</span><span class="op" id="4554314">:</span><span class="op" id="4554315">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554319">if</span>&nbsp;<span class="ident" id="4554322">certLen</span>&nbsp;<span class="op" id="4554330">&lt;</span>&nbsp;<span class="num" id="4554332">0</span>&nbsp;<span class="op" id="4554334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554339">return</span>&nbsp;<span class="builtintype" id="4554346">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4554354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554358">if</span>&nbsp;<span class="builtinfunc" id="4554361">len</span><span class="op" id="4554364">(</span><span class="ident" id="4554365">data</span><span class="op" id="4554369">)</span>&nbsp;<span class="op" id="4554371">&lt;</span>&nbsp;<span class="ident" id="4554373">certLen</span>&nbsp;<span class="op" id="4554381">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554386">return</span>&nbsp;<span class="builtintype" id="4554393">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4554401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554405">s</span><span class="op" id="4554406">.</span><span class="ident" id="4554407">certificates</span><span class="op" id="4554419">[</span><span class="ident" id="4554420">i</span><span class="op" id="4554421">]</span>&nbsp;<span class="op" id="4554423">=</span>&nbsp;<span class="ident" id="4554425">data</span><span class="op" id="4554429">[</span><span class="op" id="4554430">:</span><span class="ident" id="4554431">certLen</span><span class="op" id="4554438">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554442">data</span>&nbsp;<span class="op" id="4554447">=</span>&nbsp;<span class="ident" id="4554449">data</span><span class="op" id="4554453">[</span><span class="ident" id="4554454">certLen</span><span class="op" id="4554461">:</span><span class="op" id="4554462">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4554465">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554469">if</span>&nbsp;<span class="builtinfunc" id="4554472">len</span><span class="op" id="4554475">(</span><span class="ident" id="4554476">data</span><span class="op" id="4554480">)</span>&nbsp;<span class="op" id="4554482">&gt;</span>&nbsp;<span class="num" id="4554484">0</span>&nbsp;<span class="op" id="4554486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554490">return</span>&nbsp;<span class="builtintype" id="4554497">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4554504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554508">return</span>&nbsp;<span class="builtintype" id="4554515">true</span><br>
<span class="lineno"></span><span class="op" id="4554520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4554523">func</span>&nbsp;<span class="op" id="4554528">(</span><span class="ident" id="4554529">c</span>&nbsp;<span class="op" id="4554531">*</span><span class="ident" id="4554532">Conn</span><span class="op" id="4554536">)</span>&nbsp;<span class="ident" id="4554538">encryptTicket</span><span class="op" id="4554551">(</span><span class="ident" id="4554552">state</span>&nbsp;<span class="op" id="4554558">*</span><span class="ident" id="4554559">sessionState</span><span class="op" id="4554571">)</span>&nbsp;<span class="op" id="4554573">(</span><span class="op" id="4554574">[</span><span class="op" id="4554575">]</span><span class="builtintype" id="4554576">byte</span><span class="op" id="4554580">,</span>&nbsp;<span class="builtintype" id="4554582">error</span><span class="op" id="4554587">)</span>&nbsp;<span class="op" id="4554589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554592">serialized</span>&nbsp;<span class="op" id="4554603">:=</span>&nbsp;<span class="ident" id="4554606">state</span><span class="op" id="4554611">.</span><span class="ident" id="4554612">marshal</span><span class="op" id="4554619">(</span><span class="op" id="4554620">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554623">encrypted</span>&nbsp;<span class="op" id="4554633">:=</span>&nbsp;<span class="builtinfunc" id="4554636">make</span><span class="op" id="4554640">(</span><span class="op" id="4554641">[</span><span class="op" id="4554642">]</span><span class="builtintype" id="4554643">byte</span><span class="op" id="4554647">,</span>&nbsp;<span class="ident" id="4554649">aes</span><span class="op" id="4554652">.</span><span class="ident" id="4554653">BlockSize</span><span class="op" id="4554662">+</span><span class="builtinfunc" id="4554663">len</span><span class="op" id="4554666">(</span><span class="ident" id="4554667">serialized</span><span class="op" id="4554677">)</span><span class="op" id="4554678">+</span><span class="ident" id="4554679">sha256</span><span class="op" id="4554685">.</span><span class="ident" id="4554686">Size</span><span class="op" id="4554690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554693">iv</span>&nbsp;<span class="op" id="4554696">:=</span>&nbsp;<span class="ident" id="4554699">encrypted</span><span class="op" id="4554708">[</span><span class="op" id="4554709">:</span><span class="ident" id="4554710">aes</span><span class="op" id="4554713">.</span><span class="ident" id="4554714">BlockSize</span><span class="op" id="4554723">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554726">macBytes</span>&nbsp;<span class="op" id="4554735">:=</span>&nbsp;<span class="ident" id="4554738">encrypted</span><span class="op" id="4554747">[</span><span class="builtinfunc" id="4554748">len</span><span class="op" id="4554751">(</span><span class="ident" id="4554752">encrypted</span><span class="op" id="4554761">)</span><span class="op" id="4554762">-</span><span class="ident" id="4554763">sha256</span><span class="op" id="4554769">.</span><span class="ident" id="4554770">Size</span><span class="op" id="4554774">:</span><span class="op" id="4554775">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554779">if</span>&nbsp;<span class="ident" id="4554782">_</span><span class="op" id="4554783">,</span>&nbsp;<span class="ident" id="4554785">err</span>&nbsp;<span class="op" id="4554789">:=</span>&nbsp;<span class="ident" id="4554792">io</span><span class="op" id="4554794">.</span><span class="ident" id="4554795">ReadFull</span><span class="op" id="4554803">(</span><span class="ident" id="4554804">c</span><span class="op" id="4554805">.</span><span class="ident" id="4554806">config</span><span class="op" id="4554812">.</span><span class="ident" id="4554813">rand</span><span class="op" id="4554817">(</span><span class="op" id="4554818">)</span><span class="op" id="4554819">,</span>&nbsp;<span class="ident" id="4554821">iv</span><span class="op" id="4554823">)</span><span class="op" id="4554824">;</span>&nbsp;<span class="ident" id="4554826">err</span>&nbsp;<span class="op" id="4554830">!=</span>&nbsp;<span class="ident" id="4554833">nil</span>&nbsp;<span class="op" id="4554837">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554841">return</span>&nbsp;<span class="ident" id="4554848">nil</span><span class="op" id="4554851">,</span>&nbsp;<span class="ident" id="4554853">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4554858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554861">block</span><span class="op" id="4554866">,</span>&nbsp;<span class="ident" id="4554868">err</span>&nbsp;<span class="op" id="4554872">:=</span>&nbsp;<span class="ident" id="4554875">aes</span><span class="op" id="4554878">.</span><span class="ident" id="4554879">NewCipher</span><span class="op" id="4554888">(</span><span class="ident" id="4554889">c</span><span class="op" id="4554890">.</span><span class="ident" id="4554891">config</span><span class="op" id="4554897">.</span><span class="ident" id="4554898">SessionTicketKey</span><span class="op" id="4554914">[</span><span class="op" id="4554915">:</span><span class="num" id="4554916">16</span><span class="op" id="4554918">]</span><span class="op" id="4554919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554922">if</span>&nbsp;<span class="ident" id="4554925">err</span>&nbsp;<span class="op" id="4554929">!=</span>&nbsp;<span class="ident" id="4554932">nil</span>&nbsp;<span class="op" id="4554936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554940">return</span>&nbsp;<span class="ident" id="4554947">nil</span><span class="op" id="4554950">,</span>&nbsp;<span class="ident" id="4554952">errors</span><span class="op" id="4554958">.</span><span class="ident" id="4554959">New</span><span class="op" id="4554962">(</span><span class="string" id="4554963">&#34;tls:&nbsp;failed&nbsp;to&nbsp;create&nbsp;cipher&nbsp;while&nbsp;encrypting&nbsp;ticket:&nbsp;&#34;</span>&nbsp;<span class="op" id="4555020">+</span>&nbsp;<span class="ident" id="4555022">err</span><span class="op" id="4555025">.</span><span class="ident" id="4555026">Error</span><span class="op" id="4555031">(</span><span class="op" id="4555032">)</span><span class="op" id="4555033">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555039">cipher</span><span class="op" id="4555045">.</span><span class="ident" id="4555046">NewCTR</span><span class="op" id="4555052">(</span><span class="ident" id="4555053">block</span><span class="op" id="4555058">,</span>&nbsp;<span class="ident" id="4555060">iv</span><span class="op" id="4555062">)</span><span class="op" id="4555063">.</span><span class="ident" id="4555064">XORKeyStream</span><span class="op" id="4555076">(</span><span class="ident" id="4555077">encrypted</span><span class="op" id="4555086">[</span><span class="ident" id="4555087">aes</span><span class="op" id="4555090">.</span><span class="ident" id="4555091">BlockSize</span><span class="op" id="4555100">:</span><span class="op" id="4555101">]</span><span class="op" id="4555102">,</span>&nbsp;<span class="ident" id="4555104">serialized</span><span class="op" id="4555114">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555118">mac</span>&nbsp;<span class="op" id="4555122">:=</span>&nbsp;<span class="ident" id="4555125">hmac</span><span class="op" id="4555129">.</span><span class="ident" id="4555130">New</span><span class="op" id="4555133">(</span><span class="ident" id="4555134">sha256</span><span class="op" id="4555140">.</span><span class="ident" id="4555141">New</span><span class="op" id="4555144">,</span>&nbsp;<span class="ident" id="4555146">c</span><span class="op" id="4555147">.</span><span class="ident" id="4555148">config</span><span class="op" id="4555154">.</span><span class="ident" id="4555155">SessionTicketKey</span><span class="op" id="4555171">[</span><span class="num" id="4555172">16</span><span class="op" id="4555174">:</span><span class="num" id="4555175">32</span><span class="op" id="4555177">]</span><span class="op" id="4555178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555181">mac</span><span class="op" id="4555184">.</span><span class="ident" id="4555185">Write</span><span class="op" id="4555190">(</span><span class="ident" id="4555191">encrypted</span><span class="op" id="4555200">[</span><span class="op" id="4555201">:</span><span class="builtinfunc" id="4555202">len</span><span class="op" id="4555205">(</span><span class="ident" id="4555206">encrypted</span><span class="op" id="4555215">)</span><span class="op" id="4555216">-</span><span class="ident" id="4555217">sha256</span><span class="op" id="4555223">.</span><span class="ident" id="4555224">Size</span><span class="op" id="4555228">]</span><span class="op" id="4555229">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555232">mac</span><span class="op" id="4555235">.</span><span class="ident" id="4555236">Sum</span><span class="op" id="4555239">(</span><span class="ident" id="4555240">macBytes</span><span class="op" id="4555248">[</span><span class="op" id="4555249">:</span><span class="num" id="4555250">0</span><span class="op" id="4555251">]</span><span class="op" id="4555252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555256">return</span>&nbsp;<span class="ident" id="4555263">encrypted</span><span class="op" id="4555272">,</span>&nbsp;<span class="ident" id="4555274">nil</span><br>
<span class="lineno"></span><span class="op" id="4555278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="4555281">func</span>&nbsp;<span class="op" id="4555286">(</span><span class="ident" id="4555287">c</span>&nbsp;<span class="op" id="4555289">*</span><span class="ident" id="4555290">Conn</span><span class="op" id="4555294">)</span>&nbsp;<span class="ident" id="4555296">decryptTicket</span><span class="op" id="4555309">(</span><span class="ident" id="4555310">encrypted</span>&nbsp;<span class="op" id="4555320">[</span><span class="op" id="4555321">]</span><span class="builtintype" id="4555322">byte</span><span class="op" id="4555326">)</span>&nbsp;<span class="op" id="4555328">(</span><span class="op" id="4555329">*</span><span class="ident" id="4555330">sessionState</span><span class="op" id="4555342">,</span>&nbsp;<span class="builtintype" id="4555344">bool</span><span class="op" id="4555348">)</span>&nbsp;<span class="op" id="4555350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555353">if</span>&nbsp;<span class="ident" id="4555356">c</span><span class="op" id="4555357">.</span><span class="ident" id="4555358">config</span><span class="op" id="4555364">.</span><span class="ident" id="4555365">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4555388">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4555393">len</span><span class="op" id="4555396">(</span><span class="ident" id="4555397">encrypted</span><span class="op" id="4555406">)</span>&nbsp;<span class="op" id="4555408">&lt;</span>&nbsp;<span class="ident" id="4555410">aes</span><span class="op" id="4555413">.</span><span class="ident" id="4555414">BlockSize</span><span class="op" id="4555423">+</span><span class="ident" id="4555424">sha256</span><span class="op" id="4555430">.</span><span class="ident" id="4555431">Size</span>&nbsp;<span class="op" id="4555436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555440">return</span>&nbsp;<span class="ident" id="4555447">nil</span><span class="op" id="4555450">,</span>&nbsp;<span class="builtintype" id="4555452">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555459">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555463">iv</span>&nbsp;<span class="op" id="4555466">:=</span>&nbsp;<span class="ident" id="4555469">encrypted</span><span class="op" id="4555478">[</span><span class="op" id="4555479">:</span><span class="ident" id="4555480">aes</span><span class="op" id="4555483">.</span><span class="ident" id="4555484">BlockSize</span><span class="op" id="4555493">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555496">macBytes</span>&nbsp;<span class="op" id="4555505">:=</span>&nbsp;<span class="ident" id="4555508">encrypted</span><span class="op" id="4555517">[</span><span class="builtinfunc" id="4555518">len</span><span class="op" id="4555521">(</span><span class="ident" id="4555522">encrypted</span><span class="op" id="4555531">)</span><span class="op" id="4555532">-</span><span class="ident" id="4555533">sha256</span><span class="op" id="4555539">.</span><span class="ident" id="4555540">Size</span><span class="op" id="4555544">:</span><span class="op" id="4555545">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555549">mac</span>&nbsp;<span class="op" id="4555553">:=</span>&nbsp;<span class="ident" id="4555556">hmac</span><span class="op" id="4555560">.</span><span class="ident" id="4555561">New</span><span class="op" id="4555564">(</span><span class="ident" id="4555565">sha256</span><span class="op" id="4555571">.</span><span class="ident" id="4555572">New</span><span class="op" id="4555575">,</span>&nbsp;<span class="ident" id="4555577">c</span><span class="op" id="4555578">.</span><span class="ident" id="4555579">config</span><span class="op" id="4555585">.</span><span class="ident" id="4555586">SessionTicketKey</span><span class="op" id="4555602">[</span><span class="num" id="4555603">16</span><span class="op" id="4555605">:</span><span class="num" id="4555606">32</span><span class="op" id="4555608">]</span><span class="op" id="4555609">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555612">mac</span><span class="op" id="4555615">.</span><span class="ident" id="4555616">Write</span><span class="op" id="4555621">(</span><span class="ident" id="4555622">encrypted</span><span class="op" id="4555631">[</span><span class="op" id="4555632">:</span><span class="builtinfunc" id="4555633">len</span><span class="op" id="4555636">(</span><span class="ident" id="4555637">encrypted</span><span class="op" id="4555646">)</span><span class="op" id="4555647">-</span><span class="ident" id="4555648">sha256</span><span class="op" id="4555654">.</span><span class="ident" id="4555655">Size</span><span class="op" id="4555659">]</span><span class="op" id="4555660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555663">expected</span>&nbsp;<span class="op" id="4555672">:=</span>&nbsp;<span class="ident" id="4555675">mac</span><span class="op" id="4555678">.</span><span class="ident" id="4555679">Sum</span><span class="op" id="4555682">(</span><span class="ident" id="4555683">nil</span><span class="op" id="4555686">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555690">if</span>&nbsp;<span class="ident" id="4555693">subtle</span><span class="op" id="4555699">.</span><span class="ident" id="4555700">ConstantTimeCompare</span><span class="op" id="4555719">(</span><span class="ident" id="4555720">macBytes</span><span class="op" id="4555728">,</span>&nbsp;<span class="ident" id="4555730">expected</span><span class="op" id="4555738">)</span>&nbsp;<span class="op" id="4555740">!=</span>&nbsp;<span class="num" id="4555743">1</span>&nbsp;<span class="op" id="4555745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555749">return</span>&nbsp;<span class="ident" id="4555756">nil</span><span class="op" id="4555759">,</span>&nbsp;<span class="builtintype" id="4555761">false</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555772">block</span><span class="op" id="4555777">,</span>&nbsp;<span class="ident" id="4555779">err</span>&nbsp;<span class="op" id="4555783">:=</span>&nbsp;<span class="ident" id="4555786">aes</span><span class="op" id="4555789">.</span><span class="ident" id="4555790">NewCipher</span><span class="op" id="4555799">(</span><span class="ident" id="4555800">c</span><span class="op" id="4555801">.</span><span class="ident" id="4555802">config</span><span class="op" id="4555808">.</span><span class="ident" id="4555809">SessionTicketKey</span><span class="op" id="4555825">[</span><span class="op" id="4555826">:</span><span class="num" id="4555827">16</span><span class="op" id="4555829">]</span><span class="op" id="4555830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555833">if</span>&nbsp;<span class="ident" id="4555836">err</span>&nbsp;<span class="op" id="4555840">!=</span>&nbsp;<span class="ident" id="4555843">nil</span>&nbsp;<span class="op" id="4555847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555851">return</span>&nbsp;<span class="ident" id="4555858">nil</span><span class="op" id="4555861">,</span>&nbsp;<span class="builtintype" id="4555863">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555873">ciphertext</span>&nbsp;<span class="op" id="4555884">:=</span>&nbsp;<span class="ident" id="4555887">encrypted</span><span class="op" id="4555896">[</span><span class="ident" id="4555897">aes</span><span class="op" id="4555900">.</span><span class="ident" id="4555901">BlockSize</span>&nbsp;<span class="op" id="4555911">:</span>&nbsp;<span class="builtinfunc" id="4555913">len</span><span class="op" id="4555916">(</span><span class="ident" id="4555917">encrypted</span><span class="op" id="4555926">)</span><span class="op" id="4555927">-</span><span class="ident" id="4555928">sha256</span><span class="op" id="4555934">.</span><span class="ident" id="4555935">Size</span><span class="op" id="4555939">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555942">plaintext</span>&nbsp;<span class="op" id="4555952">:=</span>&nbsp;<span class="ident" id="4555955">ciphertext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555967">cipher</span><span class="op" id="4555973">.</span><span class="ident" id="4555974">NewCTR</span><span class="op" id="4555980">(</span><span class="ident" id="4555981">block</span><span class="op" id="4555986">,</span>&nbsp;<span class="ident" id="4555988">iv</span><span class="op" id="4555990">)</span><span class="op" id="4555991">.</span><span class="ident" id="4555992">XORKeyStream</span><span class="op" id="4556004">(</span><span class="ident" id="4556005">plaintext</span><span class="op" id="4556014">,</span>&nbsp;<span class="ident" id="4556016">ciphertext</span><span class="op" id="4556026">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556030">state</span>&nbsp;<span class="op" id="4556036">:=</span>&nbsp;<span class="builtinfunc" id="4556039">new</span><span class="op" id="4556042">(</span><span class="ident" id="4556043">sessionState</span><span class="op" id="4556055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556058">ok</span>&nbsp;<span class="op" id="4556061">:=</span>&nbsp;<span class="ident" id="4556064">state</span><span class="op" id="4556069">.</span><span class="ident" id="4556070">unmarshal</span><span class="op" id="4556079">(</span><span class="ident" id="4556080">plaintext</span><span class="op" id="4556089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4556092">return</span>&nbsp;<span class="ident" id="4556099">state</span><span class="op" id="4556104">,</span>&nbsp;<span class="ident" id="4556106">ok</span><br>
<span class="lineno"></span><span class="op" id="4556109">}</span>
</div>
</body>
</html>
