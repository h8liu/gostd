<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1818592">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1818647">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1818701">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1818752">package</span>&nbsp;<span class="ident" id="1818760">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1818769">import</span>&nbsp;<span class="op" id="1818776">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1818779">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1818788">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1818791">const</span>&nbsp;<span class="op" id="1818797">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1818800">debugMalloc</span>&nbsp;<span class="op" id="1818812">=</span>&nbsp;<span class="ident" id="1818814">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1818822">flagNoScan</span>&nbsp;<span class="op" id="1818833">=</span>&nbsp;<span class="ident" id="1818835"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025056">_FlagNoScan</a></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1818848">flagNoZero</span>&nbsp;<span class="op" id="1818859">=</span>&nbsp;<span class="ident" id="1818861"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025078">_FlagNoZero</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1818875">maxTinySize</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1818889">=</span>&nbsp;<span class="ident" id="1818891"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021949">_TinySize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1818902">tinySizeClass</span>&nbsp;<span class="op" id="1818916">=</span>&nbsp;<span class="ident" id="1818918"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021970">_TinySizeClass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1818934">maxSmallSize</span>&nbsp;&nbsp;<span class="op" id="1818948">=</span>&nbsp;<span class="ident" id="1818950"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021921">_MaxSmallSize</a></span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1818966">pageShift</span>&nbsp;<span class="op" id="1818976">=</span>&nbsp;<span class="ident" id="1818978"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021826">_PageShift</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1818990">pageSize</span>&nbsp;&nbsp;<span class="op" id="1819000">=</span>&nbsp;<span class="ident" id="1819002"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021848">_PageSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819013">pageMask</span>&nbsp;&nbsp;<span class="op" id="1819023">=</span>&nbsp;<span class="ident" id="1819025"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021871">_PageMask</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819037">bitsPerPointer</span>&nbsp;&nbsp;<span class="op" id="1819053">=</span>&nbsp;<span class="ident" id="1819055"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032154">_BitsPerPointer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819072">bitsMask</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1819088">=</span>&nbsp;<span class="ident" id="1819090"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032180">_BitsMask</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819101">pointersPerByte</span>&nbsp;<span class="op" id="1819117">=</span>&nbsp;<span class="ident" id="1819119"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032200">_PointersPerByte</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819137">maxGCMask</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1819153">=</span>&nbsp;<span class="ident" id="1819155"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032359">_MaxGCMask</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819167">bitsDead</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1819183">=</span>&nbsp;<span class="ident" id="1819185"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032227">_BitsDead</a></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819196">bitsPointer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1819212">=</span>&nbsp;<span class="ident" id="1819214"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032269">_BitsPointer</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819229">mSpanInUse</span>&nbsp;<span class="op" id="1819240">=</span>&nbsp;<span class="ident" id="1819242"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023907">_MSpanInUse</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819256">concurrentSweep</span>&nbsp;<span class="op" id="1819272">=</span>&nbsp;<span class="ident" id="1819274"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032515">_ConcurrentSweep</a></span>&nbsp;<span class="op" id="1819291">!=</span>&nbsp;<span class="num" id="1819294">0</span><br>
<span class="lineno">35</span><span class="op" id="1819296">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1819299">//&nbsp;Page&nbsp;number&nbsp;(address&gt;&gt;pageShift)</span><br>
<span class="lineno"></span><span class="keyword" id="1819335">type</span>&nbsp;<span class="ident" id="1819340">pageID</span>&nbsp;<span class="builtintype" id="1819347">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="1819356">//&nbsp;base&nbsp;address&nbsp;for&nbsp;all&nbsp;0-byte&nbsp;allocations</span><br>
<span class="lineno"></span><span class="keyword" id="1819399">var</span>&nbsp;<span class="ident" id="1819403">zerobase</span>&nbsp;<span class="builtintype" id="1819412">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1819421">//&nbsp;Allocate&nbsp;an&nbsp;object&nbsp;of&nbsp;size&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1819458">//&nbsp;Small&nbsp;objects&nbsp;are&nbsp;allocated&nbsp;from&nbsp;the&nbsp;per-P&nbsp;cache&#39;s&nbsp;free&nbsp;lists.</span><br>
<span class="lineno">45</span><span class="comment" id="1819524">//&nbsp;Large&nbsp;objects&nbsp;(&gt;&nbsp;32&nbsp;kB)&nbsp;are&nbsp;allocated&nbsp;straight&nbsp;from&nbsp;the&nbsp;heap.</span><br>
<span class="lineno"></span><span class="keyword" id="1819589">func</span>&nbsp;<span class="ident" id="1819594">mallocgc</span><span class="op" id="1819602">(</span><span class="ident" id="1819603">size</span>&nbsp;<span class="builtintype" id="1819608">uintptr</span><span class="op" id="1819615">,</span>&nbsp;<span class="ident" id="1819617">typ</span>&nbsp;<span class="op" id="1819621">*</span><span class="ident" id="1819622"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025572">_type</a></span><span class="op" id="1819627">,</span>&nbsp;<span class="ident" id="1819629">flags</span>&nbsp;<span class="builtintype" id="1819635">uint32</span><span class="op" id="1819641">)</span>&nbsp;<span class="ident" id="1819643"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1819649">.</span><span class="ident" id="1819650">Pointer</span>&nbsp;<span class="op" id="1819658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1819661">if</span>&nbsp;<span class="ident" id="1819664"><a href="/runtime/malloc.go.html#1819603">size</a></span>&nbsp;<span class="op" id="1819669">==</span>&nbsp;<span class="num" id="1819672">0</span>&nbsp;<span class="op" id="1819674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1819678">return</span>&nbsp;<span class="ident" id="1819685"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1819691">.</span><span class="ident" id="1819692">Pointer</span><span class="op" id="1819699">(</span><span class="op" id="1819700">&amp;</span><span class="ident" id="1819701"><a href="/runtime/malloc.go.html#1819403">zerobase</a></span><span class="op" id="1819709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1819712">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819715">size0</span>&nbsp;<span class="op" id="1819721">:=</span>&nbsp;<span class="ident" id="1819724"><a href="/runtime/malloc.go.html#1819603">size</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1819731">if</span>&nbsp;<span class="ident" id="1819734"><a href="/runtime/malloc.go.html#1819629">flags</a></span><span class="op" id="1819739">&amp;</span><span class="ident" id="1819740"><a href="/runtime/malloc.go.html#1818822">flagNoScan</a></span>&nbsp;<span class="op" id="1819751">==</span>&nbsp;<span class="num" id="1819754">0</span>&nbsp;<span class="op" id="1819756">&amp;&amp;</span>&nbsp;<span class="ident" id="1819759"><a href="/runtime/malloc.go.html#1819617">typ</a></span>&nbsp;<span class="op" id="1819763">==</span>&nbsp;<span class="ident" id="1819766">nil</span>&nbsp;<span class="op" id="1819770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1819774"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1819781">(</span><span class="string" id="1819782">&#34;malloc&nbsp;missing&nbsp;type&#34;</span><span class="op" id="1819803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1819806">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1819810">//&nbsp;This&nbsp;function&nbsp;must&nbsp;be&nbsp;atomic&nbsp;wrt&nbsp;GC,&nbsp;but&nbsp;for&nbsp;performance&nbsp;reasons</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1819879">//&nbsp;we&nbsp;don&#39;t&nbsp;acquirem/releasem&nbsp;on&nbsp;fast&nbsp;path.&nbsp;The&nbsp;code&nbsp;below&nbsp;does&nbsp;not&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1819953">//&nbsp;split&nbsp;stack&nbsp;checks,&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;preempted&nbsp;by&nbsp;GC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1820009">//&nbsp;Functions&nbsp;like&nbsp;roundup/add&nbsp;are&nbsp;inlined.&nbsp;And&nbsp;onM/racemalloc&nbsp;are&nbsp;nosplit.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1820085">//&nbsp;If&nbsp;debugMalloc&nbsp;=&nbsp;true,&nbsp;these&nbsp;assumptions&nbsp;are&nbsp;checked&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820149">if</span>&nbsp;<span class="ident" id="1820152"><a href="/runtime/malloc.go.html#1818800">debugMalloc</a></span>&nbsp;<span class="op" id="1820164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1820168">mp</span>&nbsp;<span class="op" id="1820171">:=</span>&nbsp;<span class="ident" id="1820174"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1820182">(</span><span class="op" id="1820183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820187">if</span>&nbsp;<span class="ident" id="1820190"><a href="/runtime/malloc.go.html#1820168">mp</a></span><span class="op" id="1820192">.</span><span class="ident" id="1820193">mallocing</span>&nbsp;<span class="op" id="1820203">!=</span>&nbsp;<span class="num" id="1820206">0</span>&nbsp;<span class="op" id="1820208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1820213"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1820220">(</span><span class="string" id="1820221">&#34;malloc&nbsp;deadlock&#34;</span><span class="op" id="1820238">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1820242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1820246"><a href="/runtime/malloc.go.html#1820168">mp</a></span><span class="op" id="1820248">.</span><span class="ident" id="1820249">mallocing</span>&nbsp;<span class="op" id="1820259">=</span>&nbsp;<span class="num" id="1820261">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820265">if</span>&nbsp;<span class="ident" id="1820268"><a href="/runtime/malloc.go.html#1820168">mp</a></span><span class="op" id="1820270">.</span><span class="ident" id="1820271">curg</span>&nbsp;<span class="op" id="1820276">!=</span>&nbsp;<span class="ident" id="1820279">nil</span>&nbsp;<span class="op" id="1820283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1820288"><a href="/runtime/malloc.go.html#1820168">mp</a></span><span class="op" id="1820290">.</span><span class="ident" id="1820291">curg</span><span class="op" id="1820295">.</span><span class="ident" id="1820296">stackguard0</span>&nbsp;<span class="op" id="1820308">=</span>&nbsp;<span class="op" id="1820310">^</span><span class="builtintype" id="1820311">uintptr</span><span class="op" id="1820318">(</span><span class="num" id="1820319">0xfff</span><span class="op" id="1820324">)</span>&nbsp;<span class="op" id="1820326">|</span>&nbsp;<span class="num" id="1820328">0xbad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1820336">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1820339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1820343">c</span>&nbsp;<span class="op" id="1820345">:=</span>&nbsp;<span class="ident" id="1820348"><a href="/runtime/stubs.go.html#1968941">gomcache</a></span><span class="op" id="1820356">(</span><span class="op" id="1820357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820360">var</span>&nbsp;<span class="ident" id="1820364">s</span>&nbsp;<span class="op" id="1820366">*</span><span class="ident" id="1820367"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2024017">mspan</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820374">var</span>&nbsp;<span class="ident" id="1820378">x</span>&nbsp;<span class="ident" id="1820380"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1820386">.</span><span class="ident" id="1820387">Pointer</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820396">if</span>&nbsp;<span class="ident" id="1820399"><a href="/runtime/malloc.go.html#1819603">size</a></span>&nbsp;<span class="op" id="1820404">&lt;=</span>&nbsp;<span class="ident" id="1820407"><a href="/runtime/malloc.go.html#1818934">maxSmallSize</a></span>&nbsp;<span class="op" id="1820420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1820424">if</span>&nbsp;<span class="ident" id="1820427"><a href="/runtime/malloc.go.html#1819629">flags</a></span><span class="op" id="1820432">&amp;</span><span class="ident" id="1820433"><a href="/runtime/malloc.go.html#1818822">flagNoScan</a></span>&nbsp;<span class="op" id="1820444">!=</span>&nbsp;<span class="num" id="1820447">0</span>&nbsp;<span class="op" id="1820449">&amp;&amp;</span>&nbsp;<span class="ident" id="1820452"><a href="/runtime/malloc.go.html#1819603">size</a></span>&nbsp;<span class="op" id="1820457">&lt;</span>&nbsp;<span class="ident" id="1820459"><a href="/runtime/malloc.go.html#1818875">maxTinySize</a></span>&nbsp;<span class="op" id="1820471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1820476">//&nbsp;Tiny&nbsp;allocator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1820498">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1820504">//&nbsp;Tiny&nbsp;allocator&nbsp;combines&nbsp;several&nbsp;tiny&nbsp;allocation&nbsp;requests</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1820567">//&nbsp;into&nbsp;a&nbsp;single&nbsp;memory&nbsp;block.&nbsp;The&nbsp;resulting&nbsp;memory&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1820628">//&nbsp;is&nbsp;freed&nbsp;when&nbsp;all&nbsp;subobjects&nbsp;are&nbsp;unreachable.&nbsp;The&nbsp;subobjects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1820695">//&nbsp;must&nbsp;be&nbsp;FlagNoScan&nbsp;(don&#39;t&nbsp;have&nbsp;pointers),&nbsp;this&nbsp;ensures&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1820761">//&nbsp;the&nbsp;amount&nbsp;of&nbsp;potentially&nbsp;wasted&nbsp;memory&nbsp;is&nbsp;bounded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1820819">//</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1820825">//&nbsp;Size&nbsp;of&nbsp;the&nbsp;memory&nbsp;block&nbsp;used&nbsp;for&nbsp;combining&nbsp;(maxTinySize)&nbsp;is&nbsp;tunable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1820901">//&nbsp;Current&nbsp;setting&nbsp;is&nbsp;16&nbsp;bytes,&nbsp;which&nbsp;relates&nbsp;to&nbsp;2x&nbsp;worst&nbsp;case&nbsp;memory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1820974">//&nbsp;wastage&nbsp;(when&nbsp;all&nbsp;but&nbsp;one&nbsp;subobjects&nbsp;are&nbsp;unreachable).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821035">//&nbsp;8&nbsp;bytes&nbsp;would&nbsp;result&nbsp;in&nbsp;no&nbsp;wastage&nbsp;at&nbsp;all,&nbsp;but&nbsp;provides&nbsp;less</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821102">//&nbsp;opportunities&nbsp;for&nbsp;combining.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821137">//&nbsp;32&nbsp;bytes&nbsp;provides&nbsp;more&nbsp;opportunities&nbsp;for&nbsp;combining,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821195">//&nbsp;but&nbsp;can&nbsp;lead&nbsp;to&nbsp;4x&nbsp;worst&nbsp;case&nbsp;wastage.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821240">//&nbsp;The&nbsp;best&nbsp;case&nbsp;winning&nbsp;is&nbsp;8x&nbsp;regardless&nbsp;of&nbsp;block&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821300">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821306">//&nbsp;Objects&nbsp;obtained&nbsp;from&nbsp;tiny&nbsp;allocator&nbsp;must&nbsp;not&nbsp;be&nbsp;freed&nbsp;explicitly.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821379">//&nbsp;So&nbsp;when&nbsp;an&nbsp;object&nbsp;will&nbsp;be&nbsp;freed&nbsp;explicitly,&nbsp;we&nbsp;ensure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821444">//&nbsp;its&nbsp;size&nbsp;&gt;=&nbsp;maxTinySize.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821475">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821481">//&nbsp;SetFinalizer&nbsp;has&nbsp;a&nbsp;special&nbsp;case&nbsp;for&nbsp;objects&nbsp;potentially&nbsp;coming</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821550">//&nbsp;from&nbsp;tiny&nbsp;allocator,&nbsp;it&nbsp;such&nbsp;case&nbsp;it&nbsp;allows&nbsp;to&nbsp;set&nbsp;finalizers</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821618">//&nbsp;for&nbsp;an&nbsp;inner&nbsp;byte&nbsp;of&nbsp;a&nbsp;memory&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821661">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821667">//&nbsp;The&nbsp;main&nbsp;targets&nbsp;of&nbsp;tiny&nbsp;allocator&nbsp;are&nbsp;small&nbsp;strings&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821730">//&nbsp;standalone&nbsp;escaping&nbsp;variables.&nbsp;On&nbsp;a&nbsp;json&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821787">//&nbsp;the&nbsp;allocator&nbsp;reduces&nbsp;number&nbsp;of&nbsp;allocations&nbsp;by&nbsp;~12%&nbsp;and</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821849">//&nbsp;reduces&nbsp;heap&nbsp;size&nbsp;by&nbsp;~20%.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1821882">tinysize</span>&nbsp;<span class="op" id="1821891">:=</span>&nbsp;<span class="builtintype" id="1821894">uintptr</span><span class="op" id="1821901">(</span><span class="ident" id="1821902"><a href="/runtime/malloc.go.html#1820343">c</a></span><span class="op" id="1821903">.</span><span class="ident" id="1821904">tinysize</span><span class="op" id="1821912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1821917">if</span>&nbsp;<span class="ident" id="1821920"><a href="/runtime/malloc.go.html#1819603">size</a></span>&nbsp;<span class="op" id="1821925">&lt;=</span>&nbsp;<span class="ident" id="1821928"><a href="/runtime/malloc.go.html#1821882">tinysize</a></span>&nbsp;<span class="op" id="1821937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1821943">tiny</span>&nbsp;<span class="op" id="1821948">:=</span>&nbsp;<span class="ident" id="1821951"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1821957">.</span><span class="ident" id="1821958">Pointer</span><span class="op" id="1821965">(</span><span class="ident" id="1821966"><a href="/runtime/malloc.go.html#1820343">c</a></span><span class="op" id="1821967">.</span><span class="ident" id="1821968">tiny</span><span class="op" id="1821972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1821978">//&nbsp;Align&nbsp;tiny&nbsp;pointer&nbsp;for&nbsp;required&nbsp;(conservative)&nbsp;alignment.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1822043">if</span>&nbsp;<span class="ident" id="1822046"><a href="/runtime/malloc.go.html#1819603">size</a></span><span class="op" id="1822050">&amp;</span><span class="num" id="1822051">7</span>&nbsp;<span class="op" id="1822053">==</span>&nbsp;<span class="num" id="1822056">0</span>&nbsp;<span class="op" id="1822058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822065"><a href="/runtime/malloc.go.html#1821943">tiny</a></span>&nbsp;<span class="op" id="1822070">=</span>&nbsp;<span class="ident" id="1822072"><a href="/runtime/stubs.go.html#1968733">roundup</a></span><span class="op" id="1822079">(</span><span class="ident" id="1822080"><a href="/runtime/malloc.go.html#1821943">tiny</a></span><span class="op" id="1822084">,</span>&nbsp;<span class="num" id="1822086">8</span><span class="op" id="1822087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1822093">}</span>&nbsp;<span class="keyword" id="1822095">else</span>&nbsp;<span class="keyword" id="1822100">if</span>&nbsp;<span class="ident" id="1822103"><a href="/runtime/malloc.go.html#1819603">size</a></span><span class="op" id="1822107">&amp;</span><span class="num" id="1822108">3</span>&nbsp;<span class="op" id="1822110">==</span>&nbsp;<span class="num" id="1822113">0</span>&nbsp;<span class="op" id="1822115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822122"><a href="/runtime/malloc.go.html#1821943">tiny</a></span>&nbsp;<span class="op" id="1822127">=</span>&nbsp;<span class="ident" id="1822129"><a href="/runtime/stubs.go.html#1968733">roundup</a></span><span class="op" id="1822136">(</span><span class="ident" id="1822137"><a href="/runtime/malloc.go.html#1821943">tiny</a></span><span class="op" id="1822141">,</span>&nbsp;<span class="num" id="1822143">4</span><span class="op" id="1822144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1822150">}</span>&nbsp;<span class="keyword" id="1822152">else</span>&nbsp;<span class="keyword" id="1822157">if</span>&nbsp;<span class="ident" id="1822160"><a href="/runtime/malloc.go.html#1819603">size</a></span><span class="op" id="1822164">&amp;</span><span class="num" id="1822165">1</span>&nbsp;<span class="op" id="1822167">==</span>&nbsp;<span class="num" id="1822170">0</span>&nbsp;<span class="op" id="1822172">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822179"><a href="/runtime/malloc.go.html#1821943">tiny</a></span>&nbsp;<span class="op" id="1822184">=</span>&nbsp;<span class="ident" id="1822186"><a href="/runtime/stubs.go.html#1968733">roundup</a></span><span class="op" id="1822193">(</span><span class="ident" id="1822194"><a href="/runtime/malloc.go.html#1821943">tiny</a></span><span class="op" id="1822198">,</span>&nbsp;<span class="num" id="1822200">2</span><span class="op" id="1822201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1822207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822213">size1</span>&nbsp;<span class="op" id="1822219">:=</span>&nbsp;<span class="ident" id="1822222"><a href="/runtime/malloc.go.html#1819603">size</a></span>&nbsp;<span class="op" id="1822227">+</span>&nbsp;<span class="op" id="1822229">(</span><span class="builtintype" id="1822230">uintptr</span><span class="op" id="1822237">(</span><span class="ident" id="1822238"><a href="/runtime/malloc.go.html#1821943">tiny</a></span><span class="op" id="1822242">)</span>&nbsp;<span class="op" id="1822244">-</span>&nbsp;<span class="builtintype" id="1822246">uintptr</span><span class="op" id="1822253">(</span><span class="ident" id="1822254"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1822260">.</span><span class="ident" id="1822261">Pointer</span><span class="op" id="1822268">(</span><span class="ident" id="1822269"><a href="/runtime/malloc.go.html#1820343">c</a></span><span class="op" id="1822270">.</span><span class="ident" id="1822271">tiny</span><span class="op" id="1822275">)</span><span class="op" id="1822276">)</span><span class="op" id="1822277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1822283">if</span>&nbsp;<span class="ident" id="1822286"><a href="/runtime/malloc.go.html#1822213">size1</a></span>&nbsp;<span class="op" id="1822292">&lt;=</span>&nbsp;<span class="ident" id="1822295"><a href="/runtime/malloc.go.html#1821882">tinysize</a></span>&nbsp;<span class="op" id="1822304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1822311">//&nbsp;The&nbsp;object&nbsp;fits&nbsp;into&nbsp;existing&nbsp;tiny&nbsp;block.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822361"><a href="/runtime/malloc.go.html#1820378">x</a></span>&nbsp;<span class="op" id="1822363">=</span>&nbsp;<span class="ident" id="1822365"><a href="/runtime/malloc.go.html#1821943">tiny</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822375"><a href="/runtime/malloc.go.html#1820343">c</a></span><span class="op" id="1822376">.</span><span class="ident" id="1822377">tiny</span>&nbsp;<span class="op" id="1822382">=</span>&nbsp;<span class="op" id="1822384">(</span><span class="op" id="1822385">*</span><span class="builtintype" id="1822386">byte</span><span class="op" id="1822390">)</span><span class="op" id="1822391">(</span><span class="ident" id="1822392"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1822395">(</span><span class="ident" id="1822396"><a href="/runtime/malloc.go.html#1820378">x</a></span><span class="op" id="1822397">,</span>&nbsp;<span class="ident" id="1822399"><a href="/runtime/malloc.go.html#1819603">size</a></span><span class="op" id="1822403">)</span><span class="op" id="1822404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822411"><a href="/runtime/malloc.go.html#1820343">c</a></span><span class="op" id="1822412">.</span><span class="ident" id="1822413">tinysize</span>&nbsp;<span class="op" id="1822422">-=</span>&nbsp;<span class="builtintype" id="1822425">uintptr</span><span class="op" id="1822432">(</span><span class="ident" id="1822433"><a href="/runtime/malloc.go.html#1822213">size1</a></span><span class="op" id="1822438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822445"><a href="/runtime/malloc.go.html#1820343">c</a></span><span class="op" id="1822446">.</span><span class="ident" id="1822447">local_tinyallocs</span><span class="op" id="1822463">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1822471">if</span>&nbsp;<span class="ident" id="1822474"><a href="/runtime/malloc.go.html#1818800">debugMalloc</a></span>&nbsp;<span class="op" id="1822486">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822494">mp</span>&nbsp;<span class="op" id="1822497">:=</span>&nbsp;<span class="ident" id="1822500"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1822508">(</span><span class="op" id="1822509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1822517">if</span>&nbsp;<span class="ident" id="1822520"><a href="/runtime/malloc.go.html#1822494">mp</a></span><span class="op" id="1822522">.</span><span class="ident" id="1822523">mallocing</span>&nbsp;<span class="op" id="1822533">==</span>&nbsp;<span class="num" id="1822536">0</span>&nbsp;<span class="op" id="1822538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822547"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1822554">(</span><span class="string" id="1822555">&#34;bad&nbsp;malloc&#34;</span><span class="op" id="1822567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1822575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822583"><a href="/runtime/malloc.go.html#1822494">mp</a></span><span class="op" id="1822585">.</span><span class="ident" id="1822586">mallocing</span>&nbsp;<span class="op" id="1822596">=</span>&nbsp;<span class="num" id="1822598">0</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1822606">if</span>&nbsp;<span class="ident" id="1822609"><a href="/runtime/malloc.go.html#1822494">mp</a></span><span class="op" id="1822611">.</span><span class="ident" id="1822612">curg</span>&nbsp;<span class="op" id="1822617">!=</span>&nbsp;<span class="ident" id="1822620">nil</span>&nbsp;<span class="op" id="1822624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822633"><a href="/runtime/malloc.go.html#1822494">mp</a></span><span class="op" id="1822635">.</span><span class="ident" id="1822636">curg</span><span class="op" id="1822640">.</span><span class="ident" id="1822641">stackguard0</span>&nbsp;<span class="op" id="1822653">=</span>&nbsp;<span class="ident" id="1822655"><a href="/runtime/malloc.go.html#1822494">mp</a></span><span class="op" id="1822657">.</span><span class="ident" id="1822658">curg</span><span class="op" id="1822662">.</span><span class="ident" id="1822663">stack</span><span class="op" id="1822668">.</span><span class="ident" id="1822669">lo</span>&nbsp;<span class="op" id="1822672">+</span>&nbsp;<span class="ident" id="1822674"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2031757">_StackGuard</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1822692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1822700">//&nbsp;Note:&nbsp;one&nbsp;releasem&nbsp;for&nbsp;the&nbsp;acquirem&nbsp;just&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1822757">//&nbsp;The&nbsp;other&nbsp;for&nbsp;the&nbsp;acquirem&nbsp;at&nbsp;start&nbsp;of&nbsp;malloc.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822813"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1822821">(</span><span class="ident" id="1822822"><a href="/runtime/malloc.go.html#1822494">mp</a></span><span class="op" id="1822824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822832"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1822840">(</span><span class="ident" id="1822841"><a href="/runtime/malloc.go.html#1822494">mp</a></span><span class="op" id="1822843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1822850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1822857">return</span>&nbsp;<span class="ident" id="1822864"><a href="/runtime/malloc.go.html#1820378">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1822870">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1822875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1822880">//&nbsp;Allocate&nbsp;a&nbsp;new&nbsp;maxTinySize&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822920"><a href="/runtime/malloc.go.html#1820364">s</a></span>&nbsp;<span class="op" id="1822922">=</span>&nbsp;<span class="ident" id="1822924"><a href="/runtime/malloc.go.html#1820343">c</a></span><span class="op" id="1822925">.</span><span class="ident" id="1822926">alloc</span><span class="op" id="1822931">[</span><span class="ident" id="1822932"><a href="/runtime/malloc.go.html#1818902">tinySizeClass</a></span><span class="op" id="1822945">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822950">v</span>&nbsp;<span class="op" id="1822952">:=</span>&nbsp;<span class="ident" id="1822955"><a href="/runtime/malloc.go.html#1820364">s</a></span><span class="op" id="1822956">.</span><span class="ident" id="1822957">freelist</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1822969">if</span>&nbsp;<span class="ident" id="1822972"><a href="/runtime/malloc.go.html#1822950">v</a></span>&nbsp;<span class="op" id="1822974">==</span>&nbsp;<span class="ident" id="1822977">nil</span>&nbsp;<span class="op" id="1822981">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1822987">mp</span>&nbsp;<span class="op" id="1822990">:=</span>&nbsp;<span class="ident" id="1822993"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1823001">(</span><span class="op" id="1823002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823008"><a href="/runtime/malloc.go.html#1822987">mp</a></span><span class="op" id="1823010">.</span><span class="ident" id="1823011">scalararg</span><span class="op" id="1823020">[</span><span class="num" id="1823021">0</span><span class="op" id="1823022">]</span>&nbsp;<span class="op" id="1823024">=</span>&nbsp;<span class="ident" id="1823026"><a href="/runtime/malloc.go.html#1818902">tinySizeClass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823044"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1823047">(</span><span class="ident" id="1823048"><a href="/runtime/stubs.go.html#1972108">mcacheRefill_m</a></span><span class="op" id="1823062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823068"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1823076">(</span><span class="ident" id="1823077"><a href="/runtime/malloc.go.html#1822987">mp</a></span><span class="op" id="1823079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823085"><a href="/runtime/malloc.go.html#1820364">s</a></span>&nbsp;<span class="op" id="1823087">=</span>&nbsp;<span class="ident" id="1823089"><a href="/runtime/malloc.go.html#1820343">c</a></span><span class="op" id="1823090">.</span><span class="ident" id="1823091">alloc</span><span class="op" id="1823096">[</span><span class="ident" id="1823097"><a href="/runtime/malloc.go.html#1818902">tinySizeClass</a></span><span class="op" id="1823110">]</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823116"><a href="/runtime/malloc.go.html#1822950">v</a></span>&nbsp;<span class="op" id="1823118">=</span>&nbsp;<span class="ident" id="1823120"><a href="/runtime/malloc.go.html#1820364">s</a></span><span class="op" id="1823121">.</span><span class="ident" id="1823122">freelist</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1823134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823139"><a href="/runtime/malloc.go.html#1820364">s</a></span><span class="op" id="1823140">.</span><span class="ident" id="1823141">freelist</span>&nbsp;<span class="op" id="1823150">=</span>&nbsp;<span class="ident" id="1823152"><a href="/runtime/malloc.go.html#1822950">v</a></span><span class="op" id="1823153">.</span><span class="ident" id="1823154">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823162"><a href="/runtime/malloc.go.html#1820364">s</a></span><span class="op" id="1823163">.</span><span class="ident" id="1823164">ref</span><span class="op" id="1823167">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1823173">//TODO:&nbsp;prefetch&nbsp;v.next</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823200"><a href="/runtime/malloc.go.html#1820378">x</a></span>&nbsp;<span class="op" id="1823202">=</span>&nbsp;<span class="ident" id="1823204"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1823210">.</span><span class="ident" id="1823211">Pointer</span><span class="op" id="1823218">(</span><span class="ident" id="1823219"><a href="/runtime/malloc.go.html#1822950">v</a></span><span class="op" id="1823220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1823225">(</span><span class="op" id="1823226">*</span><span class="op" id="1823227">[</span><span class="num" id="1823228">2</span><span class="op" id="1823229">]</span><span class="ident" id="1823230">uint64</span><span class="op" id="1823236">)</span><span class="op" id="1823237">(</span><span class="ident" id="1823238"><a href="/runtime/malloc.go.html#1820378">x</a></span><span class="op" id="1823239">)</span><span class="op" id="1823240">[</span><span class="num" id="1823241">0</span><span class="op" id="1823242">]</span>&nbsp;<span class="op" id="1823244">=</span>&nbsp;<span class="num" id="1823246">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1823251">(</span><span class="op" id="1823252">*</span><span class="op" id="1823253">[</span><span class="num" id="1823254">2</span><span class="op" id="1823255">]</span><span class="ident" id="1823256">uint64</span><span class="op" id="1823262">)</span><span class="op" id="1823263">(</span><span class="ident" id="1823264"><a href="/runtime/malloc.go.html#1820378">x</a></span><span class="op" id="1823265">)</span><span class="op" id="1823266">[</span><span class="num" id="1823267">1</span><span class="op" id="1823268">]</span>&nbsp;<span class="op" id="1823270">=</span>&nbsp;<span class="num" id="1823272">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1823277">//&nbsp;See&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;replace&nbsp;the&nbsp;existing&nbsp;tiny&nbsp;block&nbsp;with&nbsp;the&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1823350">//&nbsp;based&nbsp;on&nbsp;amount&nbsp;of&nbsp;remaining&nbsp;free&nbsp;space.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1823397">if</span>&nbsp;<span class="ident" id="1823400"><a href="/runtime/malloc.go.html#1818875">maxTinySize</a></span><span class="op" id="1823411">-</span><span class="ident" id="1823412"><a href="/runtime/malloc.go.html#1819603">size</a></span>&nbsp;<span class="op" id="1823417">&gt;</span>&nbsp;<span class="ident" id="1823419"><a href="/runtime/malloc.go.html#1821882">tinysize</a></span>&nbsp;<span class="op" id="1823428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823434"><a href="/runtime/malloc.go.html#1820343">c</a></span><span class="op" id="1823435">.</span><span class="ident" id="1823436">tiny</span>&nbsp;<span class="op" id="1823441">=</span>&nbsp;<span class="op" id="1823443">(</span><span class="op" id="1823444">*</span><span class="builtintype" id="1823445">byte</span><span class="op" id="1823449">)</span><span class="op" id="1823450">(</span><span class="ident" id="1823451"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1823454">(</span><span class="ident" id="1823455"><a href="/runtime/malloc.go.html#1820378">x</a></span><span class="op" id="1823456">,</span>&nbsp;<span class="ident" id="1823458"><a href="/runtime/malloc.go.html#1819603">size</a></span><span class="op" id="1823462">)</span><span class="op" id="1823463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823469"><a href="/runtime/malloc.go.html#1820343">c</a></span><span class="op" id="1823470">.</span><span class="ident" id="1823471">tinysize</span>&nbsp;<span class="op" id="1823480">=</span>&nbsp;<span class="builtintype" id="1823482">uintptr</span><span class="op" id="1823489">(</span><span class="ident" id="1823490"><a href="/runtime/malloc.go.html#1818875">maxTinySize</a></span>&nbsp;<span class="op" id="1823502">-</span>&nbsp;<span class="ident" id="1823504"><a href="/runtime/malloc.go.html#1819603">size</a></span><span class="op" id="1823508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1823513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823518"><a href="/runtime/malloc.go.html#1819603">size</a></span>&nbsp;<span class="op" id="1823523">=</span>&nbsp;<span class="ident" id="1823525"><a href="/runtime/malloc.go.html#1818875">maxTinySize</a></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1823539">}</span>&nbsp;<span class="keyword" id="1823541">else</span>&nbsp;<span class="op" id="1823546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1823551">var</span>&nbsp;<span class="ident" id="1823555">sizeclass</span>&nbsp;<span class="builtintype" id="1823565">int8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1823573">if</span>&nbsp;<span class="ident" id="1823576"><a href="/runtime/malloc.go.html#1819603">size</a></span>&nbsp;<span class="op" id="1823581">&lt;=</span>&nbsp;<span class="num" id="1823584">1024</span><span class="op" id="1823588">-</span><span class="num" id="1823589">8</span>&nbsp;<span class="op" id="1823591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823597"><a href="/runtime/malloc.go.html#1823555">sizeclass</a></span>&nbsp;<span class="op" id="1823607">=</span>&nbsp;<span class="ident" id="1823609"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023120">size_to_class8</a></span><span class="op" id="1823623">[</span><span class="op" id="1823624">(</span><span class="ident" id="1823625"><a href="/runtime/malloc.go.html#1819603">size</a></span><span class="op" id="1823629">+</span><span class="num" id="1823630">7</span><span class="op" id="1823631">)</span><span class="op" id="1823632">&gt;&gt;</span><span class="num" id="1823634">3</span><span class="op" id="1823635">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1823640">}</span>&nbsp;<span class="keyword" id="1823642">else</span>&nbsp;<span class="op" id="1823647">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823653"><a href="/runtime/malloc.go.html#1823555">sizeclass</a></span>&nbsp;<span class="op" id="1823663">=</span>&nbsp;<span class="ident" id="1823665"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023149">size_to_class128</a></span><span class="op" id="1823681">[</span><span class="op" id="1823682">(</span><span class="ident" id="1823683"><a href="/runtime/malloc.go.html#1819603">size</a></span><span class="op" id="1823687">-</span><span class="num" id="1823688">1024</span><span class="op" id="1823692">+</span><span class="num" id="1823693">127</span><span class="op" id="1823696">)</span><span class="op" id="1823697">&gt;&gt;</span><span class="num" id="1823699">7</span><span class="op" id="1823700">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1823705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823710"><a href="/runtime/malloc.go.html#1819603">size</a></span>&nbsp;<span class="op" id="1823715">=</span>&nbsp;<span class="builtintype" id="1823717">uintptr</span><span class="op" id="1823724">(</span><span class="ident" id="1823725"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023057">class_to_size</a></span><span class="op" id="1823738">[</span><span class="ident" id="1823739"><a href="/runtime/malloc.go.html#1823555">sizeclass</a></span><span class="op" id="1823748">]</span><span class="op" id="1823749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823754"><a href="/runtime/malloc.go.html#1820364">s</a></span>&nbsp;<span class="op" id="1823756">=</span>&nbsp;<span class="ident" id="1823758"><a href="/runtime/malloc.go.html#1820343">c</a></span><span class="op" id="1823759">.</span><span class="ident" id="1823760">alloc</span><span class="op" id="1823765">[</span><span class="ident" id="1823766"><a href="/runtime/malloc.go.html#1823555">sizeclass</a></span><span class="op" id="1823775">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823780">v</span>&nbsp;<span class="op" id="1823782">:=</span>&nbsp;<span class="ident" id="1823785"><a href="/runtime/malloc.go.html#1820364">s</a></span><span class="op" id="1823786">.</span><span class="ident" id="1823787">freelist</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1823799">if</span>&nbsp;<span class="ident" id="1823802"><a href="/runtime/malloc.go.html#1823780">v</a></span>&nbsp;<span class="op" id="1823804">==</span>&nbsp;<span class="ident" id="1823807">nil</span>&nbsp;<span class="op" id="1823811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823817">mp</span>&nbsp;<span class="op" id="1823820">:=</span>&nbsp;<span class="ident" id="1823823"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1823831">(</span><span class="op" id="1823832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823838"><a href="/runtime/malloc.go.html#1823817">mp</a></span><span class="op" id="1823840">.</span><span class="ident" id="1823841">scalararg</span><span class="op" id="1823850">[</span><span class="num" id="1823851">0</span><span class="op" id="1823852">]</span>&nbsp;<span class="op" id="1823854">=</span>&nbsp;<span class="builtintype" id="1823856">uintptr</span><span class="op" id="1823863">(</span><span class="ident" id="1823864"><a href="/runtime/malloc.go.html#1823555">sizeclass</a></span><span class="op" id="1823873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823879"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1823882">(</span><span class="ident" id="1823883"><a href="/runtime/stubs.go.html#1972108">mcacheRefill_m</a></span><span class="op" id="1823897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823903"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1823911">(</span><span class="ident" id="1823912"><a href="/runtime/malloc.go.html#1823817">mp</a></span><span class="op" id="1823914">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823920"><a href="/runtime/malloc.go.html#1820364">s</a></span>&nbsp;<span class="op" id="1823922">=</span>&nbsp;<span class="ident" id="1823924"><a href="/runtime/malloc.go.html#1820343">c</a></span><span class="op" id="1823925">.</span><span class="ident" id="1823926">alloc</span><span class="op" id="1823931">[</span><span class="ident" id="1823932"><a href="/runtime/malloc.go.html#1823555">sizeclass</a></span><span class="op" id="1823941">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823947"><a href="/runtime/malloc.go.html#1823780">v</a></span>&nbsp;<span class="op" id="1823949">=</span>&nbsp;<span class="ident" id="1823951"><a href="/runtime/malloc.go.html#1820364">s</a></span><span class="op" id="1823952">.</span><span class="ident" id="1823953">freelist</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1823965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823970"><a href="/runtime/malloc.go.html#1820364">s</a></span><span class="op" id="1823971">.</span><span class="ident" id="1823972">freelist</span>&nbsp;<span class="op" id="1823981">=</span>&nbsp;<span class="ident" id="1823983"><a href="/runtime/malloc.go.html#1823780">v</a></span><span class="op" id="1823984">.</span><span class="ident" id="1823985">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1823993"><a href="/runtime/malloc.go.html#1820364">s</a></span><span class="op" id="1823994">.</span><span class="ident" id="1823995">ref</span><span class="op" id="1823998">++</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1824004">//TODO:&nbsp;prefetch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824024"><a href="/runtime/malloc.go.html#1820378">x</a></span>&nbsp;<span class="op" id="1824026">=</span>&nbsp;<span class="ident" id="1824028"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1824034">.</span><span class="ident" id="1824035">Pointer</span><span class="op" id="1824042">(</span><span class="ident" id="1824043"><a href="/runtime/malloc.go.html#1823780">v</a></span><span class="op" id="1824044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824049">if</span>&nbsp;<span class="ident" id="1824052"><a href="/runtime/malloc.go.html#1819629">flags</a></span><span class="op" id="1824057">&amp;</span><span class="ident" id="1824058"><a href="/runtime/malloc.go.html#1818848">flagNoZero</a></span>&nbsp;<span class="op" id="1824069">==</span>&nbsp;<span class="num" id="1824072">0</span>&nbsp;<span class="op" id="1824074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824080"><a href="/runtime/malloc.go.html#1823780">v</a></span><span class="op" id="1824081">.</span><span class="ident" id="1824082">next</span>&nbsp;<span class="op" id="1824087">=</span>&nbsp;<span class="ident" id="1824089">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824097">if</span>&nbsp;<span class="ident" id="1824100"><a href="/runtime/malloc.go.html#1819603">size</a></span>&nbsp;<span class="op" id="1824105">&gt;</span>&nbsp;<span class="num" id="1824107">2</span><span class="op" id="1824108">*</span><span class="ident" id="1824109"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span>&nbsp;<span class="op" id="1824117">&amp;&amp;</span>&nbsp;<span class="op" id="1824120">(</span><span class="op" id="1824121">(</span><span class="op" id="1824122">*</span><span class="op" id="1824123">[</span><span class="num" id="1824124">2</span><span class="op" id="1824125">]</span><span class="builtintype" id="1824126">uintptr</span><span class="op" id="1824133">)</span><span class="op" id="1824134">(</span><span class="ident" id="1824135"><a href="/runtime/malloc.go.html#1820378">x</a></span><span class="op" id="1824136">)</span><span class="op" id="1824137">)</span><span class="op" id="1824138">[</span><span class="num" id="1824139">1</span><span class="op" id="1824140">]</span>&nbsp;<span class="op" id="1824142">!=</span>&nbsp;<span class="num" id="1824145">0</span>&nbsp;<span class="op" id="1824147">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824154"><a href="/runtime/stubs.go.html#1972552">memclr</a></span><span class="op" id="1824160">(</span><span class="ident" id="1824161"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1824167">.</span><span class="ident" id="1824168">Pointer</span><span class="op" id="1824175">(</span><span class="ident" id="1824176"><a href="/runtime/malloc.go.html#1823780">v</a></span><span class="op" id="1824177">)</span><span class="op" id="1824178">,</span>&nbsp;<span class="ident" id="1824180"><a href="/runtime/malloc.go.html#1819603">size</a></span><span class="op" id="1824184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1824190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1824195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1824199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824203"><a href="/runtime/malloc.go.html#1820343">c</a></span><span class="op" id="1824204">.</span><span class="ident" id="1824205">local_cachealloc</span>&nbsp;<span class="op" id="1824222">+=</span>&nbsp;<span class="ident" id="1824225"><a href="/runtime/arch_amd64.go.html#1710650">intptr</a></span><span class="op" id="1824231">(</span><span class="ident" id="1824232"><a href="/runtime/malloc.go.html#1819603">size</a></span><span class="op" id="1824236">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1824239">}</span>&nbsp;<span class="keyword" id="1824241">else</span>&nbsp;<span class="op" id="1824246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824250">mp</span>&nbsp;<span class="op" id="1824253">:=</span>&nbsp;<span class="ident" id="1824256"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1824264">(</span><span class="op" id="1824265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824269"><a href="/runtime/malloc.go.html#1824250">mp</a></span><span class="op" id="1824271">.</span><span class="ident" id="1824272">scalararg</span><span class="op" id="1824281">[</span><span class="num" id="1824282">0</span><span class="op" id="1824283">]</span>&nbsp;<span class="op" id="1824285">=</span>&nbsp;<span class="builtintype" id="1824287">uintptr</span><span class="op" id="1824294">(</span><span class="ident" id="1824295"><a href="/runtime/malloc.go.html#1819603">size</a></span><span class="op" id="1824299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824303"><a href="/runtime/malloc.go.html#1824250">mp</a></span><span class="op" id="1824305">.</span><span class="ident" id="1824306">scalararg</span><span class="op" id="1824315">[</span><span class="num" id="1824316">1</span><span class="op" id="1824317">]</span>&nbsp;<span class="op" id="1824319">=</span>&nbsp;<span class="builtintype" id="1824321">uintptr</span><span class="op" id="1824328">(</span><span class="ident" id="1824329"><a href="/runtime/malloc.go.html#1819629">flags</a></span><span class="op" id="1824334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824338"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1824341">(</span><span class="ident" id="1824342"><a href="/runtime/stubs.go.html#1972130">largeAlloc_m</a></span><span class="op" id="1824354">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824358"><a href="/runtime/malloc.go.html#1820364">s</a></span>&nbsp;<span class="op" id="1824360">=</span>&nbsp;<span class="op" id="1824362">(</span><span class="op" id="1824363">*</span><span class="ident" id="1824364"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2024017">mspan</a></span><span class="op" id="1824369">)</span><span class="op" id="1824370">(</span><span class="ident" id="1824371"><a href="/runtime/malloc.go.html#1824250">mp</a></span><span class="op" id="1824373">.</span><span class="ident" id="1824374">ptrarg</span><span class="op" id="1824380">[</span><span class="num" id="1824381">0</span><span class="op" id="1824382">]</span><span class="op" id="1824383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824387"><a href="/runtime/malloc.go.html#1824250">mp</a></span><span class="op" id="1824389">.</span><span class="ident" id="1824390">ptrarg</span><span class="op" id="1824396">[</span><span class="num" id="1824397">0</span><span class="op" id="1824398">]</span>&nbsp;<span class="op" id="1824400">=</span>&nbsp;<span class="ident" id="1824402">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824408"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1824416">(</span><span class="ident" id="1824417"><a href="/runtime/malloc.go.html#1824250">mp</a></span><span class="op" id="1824419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824423"><a href="/runtime/malloc.go.html#1820378">x</a></span>&nbsp;<span class="op" id="1824425">=</span>&nbsp;<span class="ident" id="1824427"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1824433">.</span><span class="ident" id="1824434">Pointer</span><span class="op" id="1824441">(</span><span class="builtintype" id="1824442">uintptr</span><span class="op" id="1824449">(</span><span class="ident" id="1824450"><a href="/runtime/malloc.go.html#1820364">s</a></span><span class="op" id="1824451">.</span><span class="ident" id="1824452">start</span>&nbsp;<span class="op" id="1824458">&lt;&lt;</span>&nbsp;<span class="ident" id="1824461"><a href="/runtime/malloc.go.html#1818966">pageShift</a></span><span class="op" id="1824470">)</span><span class="op" id="1824471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1824475"><a href="/runtime/malloc.go.html#1819603">size</a></span>&nbsp;<span class="op" id="1824480">=</span>&nbsp;<span class="builtintype" id="1824482">uintptr</span><span class="op" id="1824489">(</span><span class="ident" id="1824490"><a href="/runtime/malloc.go.html#1820364">s</a></span><span class="op" id="1824491">.</span><span class="ident" id="1824492">elemsize</span><span class="op" id="1824500">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1824503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824507">if</span>&nbsp;<span class="ident" id="1824510"><a href="/runtime/malloc.go.html#1819629">flags</a></span><span class="op" id="1824515">&amp;</span><span class="ident" id="1824516"><a href="/runtime/malloc.go.html#1818822">flagNoScan</a></span>&nbsp;<span class="op" id="1824527">!=</span>&nbsp;<span class="num" id="1824530">0</span>&nbsp;<span class="op" id="1824532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1824536">//&nbsp;All&nbsp;objects&nbsp;are&nbsp;pre-marked&nbsp;as&nbsp;noscan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824579">goto</span>&nbsp;<span class="ident" id="1824584">marked</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1824592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1824596">//&nbsp;If&nbsp;allocating&nbsp;a&nbsp;defer+arg&nbsp;block,&nbsp;now&nbsp;that&nbsp;we&#39;ve&nbsp;picked&nbsp;a&nbsp;malloc&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1824669">//&nbsp;large&nbsp;enough&nbsp;to&nbsp;hold&nbsp;everything,&nbsp;cut&nbsp;the&nbsp;&#34;asked&nbsp;for&#34;&nbsp;size&nbsp;down&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1824739">//&nbsp;just&nbsp;the&nbsp;defer&nbsp;header,&nbsp;so&nbsp;that&nbsp;the&nbsp;GC&nbsp;bitmap&nbsp;will&nbsp;record&nbsp;the&nbsp;arg&nbsp;block</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1824814">//&nbsp;as&nbsp;containing&nbsp;nothing&nbsp;at&nbsp;all&nbsp;(as&nbsp;if&nbsp;it&nbsp;were&nbsp;unused&nbsp;space&nbsp;at&nbsp;the&nbsp;end&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1824889">//&nbsp;a&nbsp;malloc&nbsp;block&nbsp;caused&nbsp;by&nbsp;size&nbsp;rounding).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1824934">//&nbsp;The&nbsp;defer&nbsp;arg&nbsp;areas&nbsp;are&nbsp;scanned&nbsp;as&nbsp;part&nbsp;of&nbsp;scanstack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1824992">if</span>&nbsp;<span class="ident" id="1824995"><a href="/runtime/malloc.go.html#1819617">typ</a></span>&nbsp;<span class="op" id="1824999">==</span>&nbsp;<span class="ident" id="1825002"><a href="/runtime/panic.go.html#1885301">deferType</a></span>&nbsp;<span class="op" id="1825012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825016"><a href="/runtime/malloc.go.html#1819715">size0</a></span>&nbsp;<span class="op" id="1825022">=</span>&nbsp;<span class="ident" id="1825024"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1825030">.</span><span class="ident" id="1825031">Sizeof</span><span class="op" id="1825037">(</span><span class="ident" id="1825038"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2020668">_defer</a></span><span class="op" id="1825044">{</span><span class="op" id="1825045">}</span><span class="op" id="1825046">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1825053">//&nbsp;From&nbsp;here&nbsp;till&nbsp;marked&nbsp;label&nbsp;marking&nbsp;the&nbsp;object&nbsp;as&nbsp;allocated</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1825117">//&nbsp;and&nbsp;storing&nbsp;type&nbsp;info&nbsp;in&nbsp;the&nbsp;GC&nbsp;bitmap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825161">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825165">arena_start</span>&nbsp;<span class="op" id="1825177">:=</span>&nbsp;<span class="builtintype" id="1825180">uintptr</span><span class="op" id="1825187">(</span><span class="ident" id="1825188"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1825194">.</span><span class="ident" id="1825195">Pointer</span><span class="op" id="1825202">(</span><span class="ident" id="1825203"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025017">mheap_</a></span><span class="op" id="1825209">.</span><span class="ident" id="1825210">arena_start</span><span class="op" id="1825221">)</span><span class="op" id="1825222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825226">off</span>&nbsp;<span class="op" id="1825230">:=</span>&nbsp;<span class="op" id="1825233">(</span><span class="builtintype" id="1825234">uintptr</span><span class="op" id="1825241">(</span><span class="ident" id="1825242"><a href="/runtime/malloc.go.html#1820378">x</a></span><span class="op" id="1825243">)</span>&nbsp;<span class="op" id="1825245">-</span>&nbsp;<span class="ident" id="1825247"><a href="/runtime/malloc.go.html#1825165">arena_start</a></span><span class="op" id="1825258">)</span>&nbsp;<span class="op" id="1825260">/</span>&nbsp;<span class="ident" id="1825262"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825272">xbits</span>&nbsp;<span class="op" id="1825278">:=</span>&nbsp;<span class="op" id="1825281">(</span><span class="op" id="1825282">*</span><span class="builtintype" id="1825283">uint8</span><span class="op" id="1825288">)</span><span class="op" id="1825289">(</span><span class="ident" id="1825290"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1825296">.</span><span class="ident" id="1825297">Pointer</span><span class="op" id="1825304">(</span><span class="ident" id="1825305"><a href="/runtime/malloc.go.html#1825165">arena_start</a></span>&nbsp;<span class="op" id="1825317">-</span>&nbsp;<span class="ident" id="1825319"><a href="/runtime/malloc.go.html#1825226">off</a></span><span class="op" id="1825322">/</span><span class="ident" id="1825323"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032049">wordsPerBitmapByte</a></span>&nbsp;<span class="op" id="1825342">-</span>&nbsp;<span class="num" id="1825344">1</span><span class="op" id="1825345">)</span><span class="op" id="1825346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825350">shift</span>&nbsp;<span class="op" id="1825356">:=</span>&nbsp;<span class="op" id="1825359">(</span><span class="ident" id="1825360"><a href="/runtime/malloc.go.html#1825226">off</a></span>&nbsp;<span class="op" id="1825364">%</span>&nbsp;<span class="ident" id="1825366"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032049">wordsPerBitmapByte</a></span><span class="op" id="1825384">)</span>&nbsp;<span class="op" id="1825386">*</span>&nbsp;<span class="ident" id="1825388"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032032">gcBits</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825397">if</span>&nbsp;<span class="ident" id="1825400"><a href="/runtime/malloc.go.html#1818800">debugMalloc</a></span>&nbsp;<span class="op" id="1825412">&amp;&amp;</span>&nbsp;<span class="op" id="1825415">(</span><span class="op" id="1825416">(</span><span class="op" id="1825417">*</span><span class="ident" id="1825418"><a href="/runtime/malloc.go.html#1825272">xbits</a></span><span class="op" id="1825423">&gt;&gt;</span><span class="ident" id="1825425"><a href="/runtime/malloc.go.html#1825350">shift</a></span><span class="op" id="1825430">)</span><span class="op" id="1825431">&amp;</span><span class="op" id="1825432">(</span><span class="ident" id="1825433"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032423">bitMask</a></span><span class="op" id="1825440">|</span><span class="ident" id="1825441"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032441">bitPtrMask</a></span><span class="op" id="1825451">)</span><span class="op" id="1825452">)</span>&nbsp;<span class="op" id="1825454">!=</span>&nbsp;<span class="ident" id="1825457"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032381">bitBoundary</a></span>&nbsp;<span class="op" id="1825469">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1825474">println</span><span class="op" id="1825481">(</span><span class="string" id="1825482">&#34;runtime:&nbsp;bits&nbsp;=&#34;</span><span class="op" id="1825499">,</span>&nbsp;<span class="op" id="1825501">(</span><span class="op" id="1825502">*</span><span class="ident" id="1825503"><a href="/runtime/malloc.go.html#1825272">xbits</a></span><span class="op" id="1825508">&gt;&gt;</span><span class="ident" id="1825510"><a href="/runtime/malloc.go.html#1825350">shift</a></span><span class="op" id="1825515">)</span><span class="op" id="1825516">&amp;</span><span class="op" id="1825517">(</span><span class="ident" id="1825518"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032423">bitMask</a></span><span class="op" id="1825525">|</span><span class="ident" id="1825526"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032441">bitPtrMask</a></span><span class="op" id="1825536">)</span><span class="op" id="1825537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825542"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1825549">(</span><span class="string" id="1825550">&#34;bad&nbsp;bits&nbsp;in&nbsp;markallocated&#34;</span><span class="op" id="1825577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825586">var</span>&nbsp;<span class="ident" id="1825590">ti</span><span class="op" id="1825592">,</span>&nbsp;<span class="ident" id="1825594">te</span>&nbsp;<span class="builtintype" id="1825597">uintptr</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825607">var</span>&nbsp;<span class="ident" id="1825611">ptrmask</span>&nbsp;<span class="op" id="1825619">*</span><span class="builtintype" id="1825620">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825628">if</span>&nbsp;<span class="ident" id="1825631"><a href="/runtime/malloc.go.html#1819603">size</a></span>&nbsp;<span class="op" id="1825636">==</span>&nbsp;<span class="ident" id="1825639"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span>&nbsp;<span class="op" id="1825647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1825652">//&nbsp;It&#39;s&nbsp;one&nbsp;word&nbsp;and&nbsp;it&nbsp;has&nbsp;pointers,&nbsp;it&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825715">*</span><span class="ident" id="1825716"><a href="/runtime/malloc.go.html#1825272">xbits</a></span>&nbsp;<span class="op" id="1825722">|=</span>&nbsp;<span class="op" id="1825725">(</span><span class="ident" id="1825726"><a href="/runtime/malloc.go.html#1819196">bitsPointer</a></span>&nbsp;<span class="op" id="1825738">&lt;&lt;</span>&nbsp;<span class="num" id="1825741">2</span><span class="op" id="1825742">)</span>&nbsp;<span class="op" id="1825744">&lt;&lt;</span>&nbsp;<span class="ident" id="1825747"><a href="/runtime/malloc.go.html#1825350">shift</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825756">goto</span>&nbsp;<span class="ident" id="1825761">marked</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825774">if</span>&nbsp;<span class="ident" id="1825777"><a href="/runtime/malloc.go.html#1819617">typ</a></span><span class="op" id="1825780">.</span><span class="ident" id="1825781">kind</span><span class="op" id="1825785">&amp;</span><span class="ident" id="1825786"><a href="/runtime/typekind.go.html#2015183">kindGCProg</a></span>&nbsp;<span class="op" id="1825797">!=</span>&nbsp;<span class="num" id="1825800">0</span>&nbsp;<span class="op" id="1825802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825807">nptr</span>&nbsp;<span class="op" id="1825812">:=</span>&nbsp;<span class="op" id="1825815">(</span><span class="builtintype" id="1825816">uintptr</span><span class="op" id="1825823">(</span><span class="ident" id="1825824"><a href="/runtime/malloc.go.html#1819617">typ</a></span><span class="op" id="1825827">.</span><span class="ident" id="1825828">size</span><span class="op" id="1825832">)</span>&nbsp;<span class="op" id="1825834">+</span>&nbsp;<span class="ident" id="1825836"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span>&nbsp;<span class="op" id="1825844">-</span>&nbsp;<span class="num" id="1825846">1</span><span class="op" id="1825847">)</span>&nbsp;<span class="op" id="1825849">/</span>&nbsp;<span class="ident" id="1825851"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825862">masksize</span>&nbsp;<span class="op" id="1825871">:=</span>&nbsp;<span class="ident" id="1825874"><a href="/runtime/malloc.go.html#1825807">nptr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1825882">if</span>&nbsp;<span class="ident" id="1825885"><a href="/runtime/malloc.go.html#1825862">masksize</a></span><span class="op" id="1825893">%</span><span class="num" id="1825894">2</span>&nbsp;<span class="op" id="1825896">!=</span>&nbsp;<span class="num" id="1825899">0</span>&nbsp;<span class="op" id="1825901">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825907"><a href="/runtime/malloc.go.html#1825862">masksize</a></span>&nbsp;<span class="op" id="1825916">*=</span>&nbsp;<span class="num" id="1825919">2</span>&nbsp;<span class="comment" id="1825921">//&nbsp;repeated</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1825936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1825941"><a href="/runtime/malloc.go.html#1825862">masksize</a></span>&nbsp;<span class="op" id="1825950">=</span>&nbsp;<span class="ident" id="1825952"><a href="/runtime/malloc.go.html#1825862">masksize</a></span>&nbsp;<span class="op" id="1825961">*</span>&nbsp;<span class="ident" id="1825963"><a href="/runtime/malloc.go.html#1819101">pointersPerByte</a></span>&nbsp;<span class="op" id="1825979">/</span>&nbsp;<span class="num" id="1825981">8</span>&nbsp;<span class="comment" id="1825983">//&nbsp;4&nbsp;bits&nbsp;per&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826005"><a href="/runtime/malloc.go.html#1825862">masksize</a></span><span class="op" id="1826013">++</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1826047">//&nbsp;unroll&nbsp;flag&nbsp;in&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1826082">if</span>&nbsp;<span class="ident" id="1826085"><a href="/runtime/malloc.go.html#1825862">masksize</a></span>&nbsp;<span class="op" id="1826094">&gt;</span>&nbsp;<span class="ident" id="1826096"><a href="/runtime/malloc.go.html#1819137">maxGCMask</a></span>&nbsp;<span class="op" id="1826106">&amp;&amp;</span>&nbsp;<span class="ident" id="1826109"><a href="/runtime/malloc.go.html#1819617">typ</a></span><span class="op" id="1826112">.</span><span class="ident" id="1826113">gc</span><span class="op" id="1826115">[</span><span class="num" id="1826116">1</span><span class="op" id="1826117">]</span>&nbsp;<span class="op" id="1826119">!=</span>&nbsp;<span class="num" id="1826122">0</span>&nbsp;<span class="op" id="1826124">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1826130">//&nbsp;If&nbsp;the&nbsp;mask&nbsp;is&nbsp;too&nbsp;large,&nbsp;unroll&nbsp;the&nbsp;program&nbsp;directly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1826191">//&nbsp;into&nbsp;the&nbsp;GC&nbsp;bitmap.&nbsp;It&#39;s&nbsp;7&nbsp;times&nbsp;slower&nbsp;than&nbsp;copying</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1826251">//&nbsp;from&nbsp;the&nbsp;pre-unrolled&nbsp;mask,&nbsp;but&nbsp;saves&nbsp;1/16&nbsp;of&nbsp;type&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1826314">//&nbsp;memory&nbsp;for&nbsp;the&nbsp;mask.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826342">mp</span>&nbsp;<span class="op" id="1826345">:=</span>&nbsp;<span class="ident" id="1826348"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1826356">(</span><span class="op" id="1826357">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826363"><a href="/runtime/malloc.go.html#1826342">mp</a></span><span class="op" id="1826365">.</span><span class="ident" id="1826366">ptrarg</span><span class="op" id="1826372">[</span><span class="num" id="1826373">0</span><span class="op" id="1826374">]</span>&nbsp;<span class="op" id="1826376">=</span>&nbsp;<span class="ident" id="1826378"><a href="/runtime/malloc.go.html#1820378">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826384"><a href="/runtime/malloc.go.html#1826342">mp</a></span><span class="op" id="1826386">.</span><span class="ident" id="1826387">ptrarg</span><span class="op" id="1826393">[</span><span class="num" id="1826394">1</span><span class="op" id="1826395">]</span>&nbsp;<span class="op" id="1826397">=</span>&nbsp;<span class="ident" id="1826399"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1826405">.</span><span class="ident" id="1826406">Pointer</span><span class="op" id="1826413">(</span><span class="ident" id="1826414"><a href="/runtime/malloc.go.html#1819617">typ</a></span><span class="op" id="1826417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826423"><a href="/runtime/malloc.go.html#1826342">mp</a></span><span class="op" id="1826425">.</span><span class="ident" id="1826426">scalararg</span><span class="op" id="1826435">[</span><span class="num" id="1826436">0</span><span class="op" id="1826437">]</span>&nbsp;<span class="op" id="1826439">=</span>&nbsp;<span class="builtintype" id="1826441">uintptr</span><span class="op" id="1826448">(</span><span class="ident" id="1826449"><a href="/runtime/malloc.go.html#1819603">size</a></span><span class="op" id="1826453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826459"><a href="/runtime/malloc.go.html#1826342">mp</a></span><span class="op" id="1826461">.</span><span class="ident" id="1826462">scalararg</span><span class="op" id="1826471">[</span><span class="num" id="1826472">1</span><span class="op" id="1826473">]</span>&nbsp;<span class="op" id="1826475">=</span>&nbsp;<span class="builtintype" id="1826477">uintptr</span><span class="op" id="1826484">(</span><span class="ident" id="1826485"><a href="/runtime/malloc.go.html#1819715">size0</a></span><span class="op" id="1826490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826496"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1826499">(</span><span class="ident" id="1826500"><a href="/runtime/stubs.go.html#1972272">unrollgcproginplace_m</a></span><span class="op" id="1826521">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826527"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1826535">(</span><span class="ident" id="1826536"><a href="/runtime/malloc.go.html#1826342">mp</a></span><span class="op" id="1826538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1826544">goto</span>&nbsp;<span class="ident" id="1826549">marked</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1826559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826564"><a href="/runtime/malloc.go.html#1825611">ptrmask</a></span>&nbsp;<span class="op" id="1826572">=</span>&nbsp;<span class="op" id="1826574">(</span><span class="op" id="1826575">*</span><span class="builtintype" id="1826576">uint8</span><span class="op" id="1826581">)</span><span class="op" id="1826582">(</span><span class="ident" id="1826583"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1826589">.</span><span class="ident" id="1826590">Pointer</span><span class="op" id="1826597">(</span><span class="builtintype" id="1826598">uintptr</span><span class="op" id="1826605">(</span><span class="ident" id="1826606"><a href="/runtime/malloc.go.html#1819617">typ</a></span><span class="op" id="1826609">.</span><span class="ident" id="1826610">gc</span><span class="op" id="1826612">[</span><span class="num" id="1826613">0</span><span class="op" id="1826614">]</span><span class="op" id="1826615">)</span><span class="op" id="1826616">)</span><span class="op" id="1826617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1826622">//&nbsp;Check&nbsp;whether&nbsp;the&nbsp;program&nbsp;is&nbsp;already&nbsp;unrolled.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1826675">if</span>&nbsp;<span class="builtintype" id="1826678">uintptr</span><span class="op" id="1826685">(</span><span class="ident" id="1826686"><a href="/runtime/atomic.go.html#1711401">atomicloadp</a></span><span class="op" id="1826697">(</span><span class="ident" id="1826698"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1826704">.</span><span class="ident" id="1826705">Pointer</span><span class="op" id="1826712">(</span><span class="ident" id="1826713"><a href="/runtime/malloc.go.html#1825611">ptrmask</a></span><span class="op" id="1826720">)</span><span class="op" id="1826721">)</span><span class="op" id="1826722">)</span><span class="op" id="1826723">&amp;</span><span class="num" id="1826724">0xff</span>&nbsp;<span class="op" id="1826729">==</span>&nbsp;<span class="num" id="1826732">0</span>&nbsp;<span class="op" id="1826734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826740">mp</span>&nbsp;<span class="op" id="1826743">:=</span>&nbsp;<span class="ident" id="1826746"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1826754">(</span><span class="op" id="1826755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826761"><a href="/runtime/malloc.go.html#1826740">mp</a></span><span class="op" id="1826763">.</span><span class="ident" id="1826764">ptrarg</span><span class="op" id="1826770">[</span><span class="num" id="1826771">0</span><span class="op" id="1826772">]</span>&nbsp;<span class="op" id="1826774">=</span>&nbsp;<span class="ident" id="1826776"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1826782">.</span><span class="ident" id="1826783">Pointer</span><span class="op" id="1826790">(</span><span class="ident" id="1826791"><a href="/runtime/malloc.go.html#1819617">typ</a></span><span class="op" id="1826794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826800"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1826803">(</span><span class="ident" id="1826804"><a href="/runtime/stubs.go.html#1972250">unrollgcprog_m</a></span><span class="op" id="1826818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826824"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1826832">(</span><span class="ident" id="1826833"><a href="/runtime/malloc.go.html#1826740">mp</a></span><span class="op" id="1826835">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1826840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826845"><a href="/runtime/malloc.go.html#1825611">ptrmask</a></span>&nbsp;<span class="op" id="1826853">=</span>&nbsp;<span class="op" id="1826855">(</span><span class="op" id="1826856">*</span><span class="builtintype" id="1826857">uint8</span><span class="op" id="1826862">)</span><span class="op" id="1826863">(</span><span class="ident" id="1826864"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1826867">(</span><span class="ident" id="1826868"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1826874">.</span><span class="ident" id="1826875">Pointer</span><span class="op" id="1826882">(</span><span class="ident" id="1826883"><a href="/runtime/malloc.go.html#1825611">ptrmask</a></span><span class="op" id="1826890">)</span><span class="op" id="1826891">,</span>&nbsp;<span class="num" id="1826893">1</span><span class="op" id="1826894">)</span><span class="op" id="1826895">)</span>&nbsp;<span class="comment" id="1826897">//&nbsp;skip&nbsp;the&nbsp;unroll&nbsp;flag&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1826928">}</span>&nbsp;<span class="keyword" id="1826930">else</span>&nbsp;<span class="op" id="1826935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1826940"><a href="/runtime/malloc.go.html#1825611">ptrmask</a></span>&nbsp;<span class="op" id="1826948">=</span>&nbsp;<span class="op" id="1826950">(</span><span class="op" id="1826951">*</span><span class="builtintype" id="1826952">uint8</span><span class="op" id="1826957">)</span><span class="op" id="1826958">(</span><span class="ident" id="1826959"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1826965">.</span><span class="ident" id="1826966">Pointer</span><span class="op" id="1826973">(</span><span class="ident" id="1826974"><a href="/runtime/malloc.go.html#1819617">typ</a></span><span class="op" id="1826977">.</span><span class="ident" id="1826978">gc</span><span class="op" id="1826980">[</span><span class="num" id="1826981">0</span><span class="op" id="1826982">]</span><span class="op" id="1826983">)</span><span class="op" id="1826984">)</span>&nbsp;<span class="comment" id="1826986">//&nbsp;pointer&nbsp;to&nbsp;unrolled&nbsp;mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827016">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827020">if</span>&nbsp;<span class="ident" id="1827023"><a href="/runtime/malloc.go.html#1819603">size</a></span>&nbsp;<span class="op" id="1827028">==</span>&nbsp;<span class="num" id="1827031">2</span><span class="op" id="1827032">*</span><span class="ident" id="1827033"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span>&nbsp;<span class="op" id="1827041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827046">*</span><span class="ident" id="1827047"><a href="/runtime/malloc.go.html#1825272">xbits</a></span>&nbsp;<span class="op" id="1827053">=</span>&nbsp;<span class="op" id="1827055">*</span><span class="ident" id="1827056"><a href="/runtime/malloc.go.html#1825611">ptrmask</a></span>&nbsp;<span class="op" id="1827064">|</span>&nbsp;<span class="ident" id="1827066"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032381">bitBoundary</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827081">goto</span>&nbsp;<span class="ident" id="1827086">marked</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827099"><a href="/runtime/malloc.go.html#1825594">te</a></span>&nbsp;<span class="op" id="1827102">=</span>&nbsp;<span class="builtintype" id="1827104">uintptr</span><span class="op" id="1827111">(</span><span class="ident" id="1827112"><a href="/runtime/malloc.go.html#1819617">typ</a></span><span class="op" id="1827115">.</span><span class="ident" id="1827116">size</span><span class="op" id="1827120">)</span>&nbsp;<span class="op" id="1827122">/</span>&nbsp;<span class="ident" id="1827124"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827134">//&nbsp;If&nbsp;the&nbsp;type&nbsp;occupies&nbsp;odd&nbsp;number&nbsp;of&nbsp;words,&nbsp;its&nbsp;mask&nbsp;is&nbsp;repeated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827203">if</span>&nbsp;<span class="ident" id="1827206"><a href="/runtime/malloc.go.html#1825594">te</a></span><span class="op" id="1827208">%</span><span class="num" id="1827209">2</span>&nbsp;<span class="op" id="1827211">==</span>&nbsp;<span class="num" id="1827214">0</span>&nbsp;<span class="op" id="1827216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827221"><a href="/runtime/malloc.go.html#1825594">te</a></span>&nbsp;<span class="op" id="1827224">/=</span>&nbsp;<span class="num" id="1827227">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827235">//&nbsp;Copy&nbsp;pointer&nbsp;bitmask&nbsp;into&nbsp;the&nbsp;bitmap.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827278">for</span>&nbsp;<span class="ident" id="1827282">i</span>&nbsp;<span class="op" id="1827284">:=</span>&nbsp;<span class="builtintype" id="1827287">uintptr</span><span class="op" id="1827294">(</span><span class="num" id="1827295">0</span><span class="op" id="1827296">)</span><span class="op" id="1827297">;</span>&nbsp;<span class="ident" id="1827299"><a href="/runtime/malloc.go.html#1827282">i</a></span>&nbsp;<span class="op" id="1827301">&lt;</span>&nbsp;<span class="ident" id="1827303"><a href="/runtime/malloc.go.html#1819715">size0</a></span><span class="op" id="1827308">;</span>&nbsp;<span class="ident" id="1827310"><a href="/runtime/malloc.go.html#1827282">i</a></span>&nbsp;<span class="op" id="1827312">+=</span>&nbsp;<span class="num" id="1827315">2</span>&nbsp;<span class="op" id="1827317">*</span>&nbsp;<span class="ident" id="1827319"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span>&nbsp;<span class="op" id="1827327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827332">v</span>&nbsp;<span class="op" id="1827334">:=</span>&nbsp;<span class="op" id="1827337">*</span><span class="op" id="1827338">(</span><span class="op" id="1827339">*</span><span class="builtintype" id="1827340">uint8</span><span class="op" id="1827345">)</span><span class="op" id="1827346">(</span><span class="ident" id="1827347"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1827350">(</span><span class="ident" id="1827351"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1827357">.</span><span class="ident" id="1827358">Pointer</span><span class="op" id="1827365">(</span><span class="ident" id="1827366"><a href="/runtime/malloc.go.html#1825611">ptrmask</a></span><span class="op" id="1827373">)</span><span class="op" id="1827374">,</span>&nbsp;<span class="ident" id="1827376"><a href="/runtime/malloc.go.html#1825590">ti</a></span><span class="op" id="1827378">)</span><span class="op" id="1827379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827384"><a href="/runtime/malloc.go.html#1825590">ti</a></span><span class="op" id="1827386">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827392">if</span>&nbsp;<span class="ident" id="1827395"><a href="/runtime/malloc.go.html#1825590">ti</a></span>&nbsp;<span class="op" id="1827398">==</span>&nbsp;<span class="ident" id="1827401"><a href="/runtime/malloc.go.html#1825594">te</a></span>&nbsp;<span class="op" id="1827404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827410"><a href="/runtime/malloc.go.html#1825590">ti</a></span>&nbsp;<span class="op" id="1827413">=</span>&nbsp;<span class="num" id="1827415">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827425">if</span>&nbsp;<span class="ident" id="1827428"><a href="/runtime/malloc.go.html#1827282">i</a></span>&nbsp;<span class="op" id="1827430">==</span>&nbsp;<span class="num" id="1827433">0</span>&nbsp;<span class="op" id="1827435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827441"><a href="/runtime/malloc.go.html#1827332">v</a></span>&nbsp;<span class="op" id="1827443">|=</span>&nbsp;<span class="ident" id="1827446"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032381">bitBoundary</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827466">if</span>&nbsp;<span class="ident" id="1827469"><a href="/runtime/malloc.go.html#1827282">i</a></span><span class="op" id="1827470">+</span><span class="ident" id="1827471"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span>&nbsp;<span class="op" id="1827479">==</span>&nbsp;<span class="ident" id="1827482"><a href="/runtime/malloc.go.html#1819715">size0</a></span>&nbsp;<span class="op" id="1827488">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827494"><a href="/runtime/malloc.go.html#1827332">v</a></span>&nbsp;<span class="op" id="1827496">&amp;^=</span>&nbsp;<span class="builtintype" id="1827500">uint8</span><span class="op" id="1827505">(</span><span class="ident" id="1827506"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032441">bitPtrMask</a></span>&nbsp;<span class="op" id="1827517">&lt;&lt;</span>&nbsp;<span class="num" id="1827520">4</span><span class="op" id="1827521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827532">*</span><span class="ident" id="1827533"><a href="/runtime/malloc.go.html#1825272">xbits</a></span>&nbsp;<span class="op" id="1827539">=</span>&nbsp;<span class="ident" id="1827541"><a href="/runtime/malloc.go.html#1827332">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827546"><a href="/runtime/malloc.go.html#1825272">xbits</a></span>&nbsp;<span class="op" id="1827552">=</span>&nbsp;<span class="op" id="1827554">(</span><span class="op" id="1827555">*</span><span class="builtintype" id="1827556">byte</span><span class="op" id="1827560">)</span><span class="op" id="1827561">(</span><span class="ident" id="1827562"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1827565">(</span><span class="ident" id="1827566"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1827572">.</span><span class="ident" id="1827573">Pointer</span><span class="op" id="1827580">(</span><span class="ident" id="1827581"><a href="/runtime/malloc.go.html#1825272">xbits</a></span><span class="op" id="1827586">)</span><span class="op" id="1827587">,</span>&nbsp;<span class="op" id="1827589">^</span><span class="builtintype" id="1827590">uintptr</span><span class="op" id="1827597">(</span><span class="num" id="1827598">0</span><span class="op" id="1827599">)</span><span class="op" id="1827600">)</span><span class="op" id="1827601">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827609">if</span>&nbsp;<span class="ident" id="1827612"><a href="/runtime/malloc.go.html#1819715">size0</a></span><span class="op" id="1827617">%</span><span class="op" id="1827618">(</span><span class="num" id="1827619">2</span><span class="op" id="1827620">*</span><span class="ident" id="1827621"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span><span class="op" id="1827628">)</span>&nbsp;<span class="op" id="1827630">==</span>&nbsp;<span class="num" id="1827633">0</span>&nbsp;<span class="op" id="1827635">&amp;&amp;</span>&nbsp;<span class="ident" id="1827638"><a href="/runtime/malloc.go.html#1819715">size0</a></span>&nbsp;<span class="op" id="1827644">&lt;</span>&nbsp;<span class="ident" id="1827646"><a href="/runtime/malloc.go.html#1819603">size</a></span>&nbsp;<span class="op" id="1827651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827656">//&nbsp;Mark&nbsp;the&nbsp;word&nbsp;after&nbsp;last&nbsp;object&#39;s&nbsp;word&nbsp;as&nbsp;bitsDead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827714">*</span><span class="ident" id="1827715"><a href="/runtime/malloc.go.html#1825272">xbits</a></span>&nbsp;<span class="op" id="1827721">=</span>&nbsp;<span class="ident" id="1827723"><a href="/runtime/malloc.go.html#1819167">bitsDead</a></span>&nbsp;<span class="op" id="1827732">&lt;&lt;</span>&nbsp;<span class="num" id="1827735">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827739">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827742">}</span><br>
<span class="lineno"></span><span class="ident" id="1827744">marked</span><span class="op" id="1827750">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827753">if</span>&nbsp;<span class="ident" id="1827756"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1827768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827772"><a href="/runtime/race0.go.html#1908119">racemalloc</a></span><span class="op" id="1827782">(</span><span class="ident" id="1827783"><a href="/runtime/malloc.go.html#1820378">x</a></span><span class="op" id="1827784">,</span>&nbsp;<span class="ident" id="1827786"><a href="/runtime/malloc.go.html#1819603">size</a></span><span class="op" id="1827790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827793">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827797">if</span>&nbsp;<span class="ident" id="1827800"><a href="/runtime/malloc.go.html#1818800">debugMalloc</a></span>&nbsp;<span class="op" id="1827812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827816">mp</span>&nbsp;<span class="op" id="1827819">:=</span>&nbsp;<span class="ident" id="1827822"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1827830">(</span><span class="op" id="1827831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827835">if</span>&nbsp;<span class="ident" id="1827838"><a href="/runtime/malloc.go.html#1827816">mp</a></span><span class="op" id="1827840">.</span><span class="ident" id="1827841">mallocing</span>&nbsp;<span class="op" id="1827851">==</span>&nbsp;<span class="num" id="1827854">0</span>&nbsp;<span class="op" id="1827856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827861"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1827868">(</span><span class="string" id="1827869">&#34;bad&nbsp;malloc&#34;</span><span class="op" id="1827881">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827889"><a href="/runtime/malloc.go.html#1827816">mp</a></span><span class="op" id="1827891">.</span><span class="ident" id="1827892">mallocing</span>&nbsp;<span class="op" id="1827902">=</span>&nbsp;<span class="num" id="1827904">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1827908">if</span>&nbsp;<span class="ident" id="1827911"><a href="/runtime/malloc.go.html#1827816">mp</a></span><span class="op" id="1827913">.</span><span class="ident" id="1827914">curg</span>&nbsp;<span class="op" id="1827919">!=</span>&nbsp;<span class="ident" id="1827922">nil</span>&nbsp;<span class="op" id="1827926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1827931"><a href="/runtime/malloc.go.html#1827816">mp</a></span><span class="op" id="1827933">.</span><span class="ident" id="1827934">curg</span><span class="op" id="1827938">.</span><span class="ident" id="1827939">stackguard0</span>&nbsp;<span class="op" id="1827951">=</span>&nbsp;<span class="ident" id="1827953"><a href="/runtime/malloc.go.html#1827816">mp</a></span><span class="op" id="1827955">.</span><span class="ident" id="1827956">curg</span><span class="op" id="1827960">.</span><span class="ident" id="1827961">stack</span><span class="op" id="1827966">.</span><span class="ident" id="1827967">lo</span>&nbsp;<span class="op" id="1827970">+</span>&nbsp;<span class="ident" id="1827972"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2031757">_StackGuard</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1827986">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1827990">//&nbsp;Note:&nbsp;one&nbsp;releasem&nbsp;for&nbsp;the&nbsp;acquirem&nbsp;just&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1828043">//&nbsp;The&nbsp;other&nbsp;for&nbsp;the&nbsp;acquirem&nbsp;at&nbsp;start&nbsp;of&nbsp;malloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828095"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1828103">(</span><span class="ident" id="1828104"><a href="/runtime/malloc.go.html#1827816">mp</a></span><span class="op" id="1828106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828110"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1828118">(</span><span class="ident" id="1828119"><a href="/runtime/malloc.go.html#1827816">mp</a></span><span class="op" id="1828121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1828124">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828128">if</span>&nbsp;<span class="ident" id="1828131"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021438">debug</a></span><span class="op" id="1828136">.</span><span class="ident" id="1828137">allocfreetrace</span>&nbsp;<span class="op" id="1828152">!=</span>&nbsp;<span class="num" id="1828155">0</span>&nbsp;<span class="op" id="1828157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828161"><a href="/runtime/mprof.go.html#1865650">tracealloc</a></span><span class="op" id="1828171">(</span><span class="ident" id="1828172"><a href="/runtime/malloc.go.html#1820378">x</a></span><span class="op" id="1828173">,</span>&nbsp;<span class="ident" id="1828175"><a href="/runtime/malloc.go.html#1819603">size</a></span><span class="op" id="1828179">,</span>&nbsp;<span class="ident" id="1828181"><a href="/runtime/malloc.go.html#1819617">typ</a></span><span class="op" id="1828184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1828187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828191">if</span>&nbsp;<span class="ident" id="1828194">rate</span>&nbsp;<span class="op" id="1828199">:=</span>&nbsp;<span class="ident" id="1828202"><a href="/runtime/mprof.go.html#1858617">MemProfileRate</a></span><span class="op" id="1828216">;</span>&nbsp;<span class="ident" id="1828218"><a href="/runtime/malloc.go.html#1828194">rate</a></span>&nbsp;<span class="op" id="1828223">&gt;</span>&nbsp;<span class="num" id="1828225">0</span>&nbsp;<span class="op" id="1828227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828231">if</span>&nbsp;<span class="ident" id="1828234"><a href="/runtime/malloc.go.html#1819603">size</a></span>&nbsp;<span class="op" id="1828239">&lt;</span>&nbsp;<span class="builtintype" id="1828241">uintptr</span><span class="op" id="1828248">(</span><span class="ident" id="1828249"><a href="/runtime/malloc.go.html#1828194">rate</a></span><span class="op" id="1828253">)</span>&nbsp;<span class="op" id="1828255">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1828258">int32</span><span class="op" id="1828263">(</span><span class="ident" id="1828264"><a href="/runtime/malloc.go.html#1819603">size</a></span><span class="op" id="1828268">)</span>&nbsp;<span class="op" id="1828270">&lt;</span>&nbsp;<span class="ident" id="1828272"><a href="/runtime/malloc.go.html#1820343">c</a></span><span class="op" id="1828273">.</span><span class="ident" id="1828274">next_sample</span>&nbsp;<span class="op" id="1828286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828291"><a href="/runtime/malloc.go.html#1820343">c</a></span><span class="op" id="1828292">.</span><span class="ident" id="1828293">next_sample</span>&nbsp;<span class="op" id="1828305">-=</span>&nbsp;<span class="builtintype" id="1828308">int32</span><span class="op" id="1828313">(</span><span class="ident" id="1828314"><a href="/runtime/malloc.go.html#1819603">size</a></span><span class="op" id="1828318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1828322">}</span>&nbsp;<span class="keyword" id="1828324">else</span>&nbsp;<span class="op" id="1828329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828334">mp</span>&nbsp;<span class="op" id="1828337">:=</span>&nbsp;<span class="ident" id="1828340"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1828348">(</span><span class="op" id="1828349">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828354"><a href="/runtime/malloc.go.html#1829564">profilealloc</a></span><span class="op" id="1828366">(</span><span class="ident" id="1828367"><a href="/runtime/malloc.go.html#1828334">mp</a></span><span class="op" id="1828369">,</span>&nbsp;<span class="ident" id="1828371"><a href="/runtime/malloc.go.html#1820378">x</a></span><span class="op" id="1828372">,</span>&nbsp;<span class="ident" id="1828374"><a href="/runtime/malloc.go.html#1819603">size</a></span><span class="op" id="1828378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828383"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1828391">(</span><span class="ident" id="1828392"><a href="/runtime/malloc.go.html#1828334">mp</a></span><span class="op" id="1828394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1828398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1828401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828405">if</span>&nbsp;<span class="ident" id="1828408"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023037">memstats</a></span><span class="op" id="1828416">.</span><span class="ident" id="1828417">heap_alloc</span>&nbsp;<span class="op" id="1828428">&gt;=</span>&nbsp;<span class="ident" id="1828431"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023037">memstats</a></span><span class="op" id="1828439">.</span><span class="ident" id="1828440">next_gc</span>&nbsp;<span class="op" id="1828448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828452"><a href="/runtime/malloc.go.html#1830307">gogc</a></span><span class="op" id="1828456">(</span><span class="num" id="1828457">0</span><span class="op" id="1828458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1828461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828465">return</span>&nbsp;<span class="ident" id="1828472"><a href="/runtime/malloc.go.html#1820378">x</a></span><br>
<span class="lineno">345</span><span class="op" id="1828474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1828477">//&nbsp;implementation&nbsp;of&nbsp;new&nbsp;builtin</span><br>
<span class="lineno"></span><span class="keyword" id="1828510">func</span>&nbsp;<span class="ident" id="1828515">newobject</span><span class="op" id="1828524">(</span><span class="ident" id="1828525">typ</span>&nbsp;<span class="op" id="1828529">*</span><span class="ident" id="1828530"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025572">_type</a></span><span class="op" id="1828535">)</span>&nbsp;<span class="ident" id="1828537"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1828543">.</span><span class="ident" id="1828544">Pointer</span>&nbsp;<span class="op" id="1828552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828555">flags</span>&nbsp;<span class="op" id="1828561">:=</span>&nbsp;<span class="builtintype" id="1828564">uint32</span><span class="op" id="1828570">(</span><span class="num" id="1828571">0</span><span class="op" id="1828572">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828575">if</span>&nbsp;<span class="ident" id="1828578"><a href="/runtime/malloc.go.html#1828525">typ</a></span><span class="op" id="1828581">.</span><span class="ident" id="1828582">kind</span><span class="op" id="1828586">&amp;</span><span class="ident" id="1828587"><a href="/runtime/typekind.go.html#2015214">kindNoPointers</a></span>&nbsp;<span class="op" id="1828602">!=</span>&nbsp;<span class="num" id="1828605">0</span>&nbsp;<span class="op" id="1828607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828611"><a href="/runtime/malloc.go.html#1828555">flags</a></span>&nbsp;<span class="op" id="1828617">|=</span>&nbsp;<span class="ident" id="1828620"><a href="/runtime/malloc.go.html#1818822">flagNoScan</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1828632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828635">return</span>&nbsp;<span class="ident" id="1828642"><a href="/runtime/malloc.go.html#1819594">mallocgc</a></span><span class="op" id="1828650">(</span><span class="builtintype" id="1828651">uintptr</span><span class="op" id="1828658">(</span><span class="ident" id="1828659"><a href="/runtime/malloc.go.html#1828525">typ</a></span><span class="op" id="1828662">.</span><span class="ident" id="1828663">size</span><span class="op" id="1828667">)</span><span class="op" id="1828668">,</span>&nbsp;<span class="ident" id="1828670"><a href="/runtime/malloc.go.html#1828525">typ</a></span><span class="op" id="1828673">,</span>&nbsp;<span class="ident" id="1828675"><a href="/runtime/malloc.go.html#1828555">flags</a></span><span class="op" id="1828680">)</span><br>
<span class="lineno"></span><span class="op" id="1828682">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="1828685">//&nbsp;implementation&nbsp;of&nbsp;make&nbsp;builtin&nbsp;for&nbsp;slices</span><br>
<span class="lineno"></span><span class="keyword" id="1828730">func</span>&nbsp;<span class="ident" id="1828735">newarray</span><span class="op" id="1828743">(</span><span class="ident" id="1828744">typ</span>&nbsp;<span class="op" id="1828748">*</span><span class="ident" id="1828749"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025572">_type</a></span><span class="op" id="1828754">,</span>&nbsp;<span class="ident" id="1828756">n</span>&nbsp;<span class="builtintype" id="1828758">uintptr</span><span class="op" id="1828765">)</span>&nbsp;<span class="ident" id="1828767"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1828773">.</span><span class="ident" id="1828774">Pointer</span>&nbsp;<span class="op" id="1828782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828785">flags</span>&nbsp;<span class="op" id="1828791">:=</span>&nbsp;<span class="builtintype" id="1828794">uint32</span><span class="op" id="1828800">(</span><span class="num" id="1828801">0</span><span class="op" id="1828802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828805">if</span>&nbsp;<span class="ident" id="1828808"><a href="/runtime/malloc.go.html#1828744">typ</a></span><span class="op" id="1828811">.</span><span class="ident" id="1828812">kind</span><span class="op" id="1828816">&amp;</span><span class="ident" id="1828817"><a href="/runtime/typekind.go.html#2015214">kindNoPointers</a></span>&nbsp;<span class="op" id="1828832">!=</span>&nbsp;<span class="num" id="1828835">0</span>&nbsp;<span class="op" id="1828837">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1828841"><a href="/runtime/malloc.go.html#1828785">flags</a></span>&nbsp;<span class="op" id="1828847">|=</span>&nbsp;<span class="ident" id="1828850"><a href="/runtime/malloc.go.html#1818822">flagNoScan</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1828862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828865">if</span>&nbsp;<span class="builtintype" id="1828868">int</span><span class="op" id="1828871">(</span><span class="ident" id="1828872"><a href="/runtime/malloc.go.html#1828756">n</a></span><span class="op" id="1828873">)</span>&nbsp;<span class="op" id="1828875">&lt;</span>&nbsp;<span class="num" id="1828877">0</span>&nbsp;<span class="op" id="1828879">||</span>&nbsp;<span class="op" id="1828882">(</span><span class="ident" id="1828883"><a href="/runtime/malloc.go.html#1828744">typ</a></span><span class="op" id="1828886">.</span><span class="ident" id="1828887">size</span>&nbsp;<span class="op" id="1828892">&gt;</span>&nbsp;<span class="num" id="1828894">0</span>&nbsp;<span class="op" id="1828896">&amp;&amp;</span>&nbsp;<span class="ident" id="1828899"><a href="/runtime/malloc.go.html#1828756">n</a></span>&nbsp;<span class="op" id="1828901">&gt;</span>&nbsp;<span class="ident" id="1828903"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2031855">maxmem</a></span><span class="op" id="1828909">/</span><span class="builtintype" id="1828910">uintptr</span><span class="op" id="1828917">(</span><span class="ident" id="1828918"><a href="/runtime/malloc.go.html#1828744">typ</a></span><span class="op" id="1828921">.</span><span class="ident" id="1828922">size</span><span class="op" id="1828926">)</span><span class="op" id="1828927">)</span>&nbsp;<span class="op" id="1828929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1828933">panic</span><span class="op" id="1828938">(</span><span class="string" id="1828939">&#34;runtime:&nbsp;allocation&nbsp;size&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1828978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1828981">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1828984">return</span>&nbsp;<span class="ident" id="1828991"><a href="/runtime/malloc.go.html#1819594">mallocgc</a></span><span class="op" id="1828999">(</span><span class="builtintype" id="1829000">uintptr</span><span class="op" id="1829007">(</span><span class="ident" id="1829008"><a href="/runtime/malloc.go.html#1828744">typ</a></span><span class="op" id="1829011">.</span><span class="ident" id="1829012">size</span><span class="op" id="1829016">)</span><span class="op" id="1829017">*</span><span class="ident" id="1829018"><a href="/runtime/malloc.go.html#1828756">n</a></span><span class="op" id="1829019">,</span>&nbsp;<span class="ident" id="1829021"><a href="/runtime/malloc.go.html#1828744">typ</a></span><span class="op" id="1829024">,</span>&nbsp;<span class="ident" id="1829026"><a href="/runtime/malloc.go.html#1828785">flags</a></span><span class="op" id="1829031">)</span><br>
<span class="lineno"></span><span class="op" id="1829033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1829036">//&nbsp;rawmem&nbsp;returns&nbsp;a&nbsp;chunk&nbsp;of&nbsp;pointerless&nbsp;memory.&nbsp;&nbsp;It&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1829092">//&nbsp;not&nbsp;zeroed.</span><br>
<span class="lineno">370</span><span class="keyword" id="1829107">func</span>&nbsp;<span class="ident" id="1829112">rawmem</span><span class="op" id="1829118">(</span><span class="ident" id="1829119">size</span>&nbsp;<span class="builtintype" id="1829124">uintptr</span><span class="op" id="1829131">)</span>&nbsp;<span class="ident" id="1829133"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1829139">.</span><span class="ident" id="1829140">Pointer</span>&nbsp;<span class="op" id="1829148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829151">return</span>&nbsp;<span class="ident" id="1829158"><a href="/runtime/malloc.go.html#1819594">mallocgc</a></span><span class="op" id="1829166">(</span><span class="ident" id="1829167"><a href="/runtime/malloc.go.html#1829119">size</a></span><span class="op" id="1829171">,</span>&nbsp;<span class="ident" id="1829173">nil</span><span class="op" id="1829176">,</span>&nbsp;<span class="ident" id="1829178"><a href="/runtime/malloc.go.html#1818822">flagNoScan</a></span><span class="op" id="1829188">|</span><span class="ident" id="1829189"><a href="/runtime/malloc.go.html#1818848">flagNoZero</a></span><span class="op" id="1829199">)</span><br>
<span class="lineno"></span><span class="op" id="1829201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1829204">//&nbsp;round&nbsp;size&nbsp;up&nbsp;to&nbsp;next&nbsp;size&nbsp;class</span><br>
<span class="lineno">375</span><span class="keyword" id="1829240">func</span>&nbsp;<span class="ident" id="1829245">goroundupsize</span><span class="op" id="1829258">(</span><span class="ident" id="1829259">size</span>&nbsp;<span class="builtintype" id="1829264">uintptr</span><span class="op" id="1829271">)</span>&nbsp;<span class="builtintype" id="1829273">uintptr</span>&nbsp;<span class="op" id="1829281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829284">if</span>&nbsp;<span class="ident" id="1829287"><a href="/runtime/malloc.go.html#1829259">size</a></span>&nbsp;<span class="op" id="1829292">&lt;</span>&nbsp;<span class="ident" id="1829294"><a href="/runtime/malloc.go.html#1818934">maxSmallSize</a></span>&nbsp;<span class="op" id="1829307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829311">if</span>&nbsp;<span class="ident" id="1829314"><a href="/runtime/malloc.go.html#1829259">size</a></span>&nbsp;<span class="op" id="1829319">&lt;=</span>&nbsp;<span class="num" id="1829322">1024</span><span class="op" id="1829326">-</span><span class="num" id="1829327">8</span>&nbsp;<span class="op" id="1829329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829334">return</span>&nbsp;<span class="builtintype" id="1829341">uintptr</span><span class="op" id="1829348">(</span><span class="ident" id="1829349"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023057">class_to_size</a></span><span class="op" id="1829362">[</span><span class="ident" id="1829363"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023120">size_to_class8</a></span><span class="op" id="1829377">[</span><span class="op" id="1829378">(</span><span class="ident" id="1829379"><a href="/runtime/malloc.go.html#1829259">size</a></span><span class="op" id="1829383">+</span><span class="num" id="1829384">7</span><span class="op" id="1829385">)</span><span class="op" id="1829386">&gt;&gt;</span><span class="num" id="1829388">3</span><span class="op" id="1829389">]</span><span class="op" id="1829390">]</span><span class="op" id="1829391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1829395">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829399">return</span>&nbsp;<span class="builtintype" id="1829406">uintptr</span><span class="op" id="1829413">(</span><span class="ident" id="1829414"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023057">class_to_size</a></span><span class="op" id="1829427">[</span><span class="ident" id="1829428"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023149">size_to_class128</a></span><span class="op" id="1829444">[</span><span class="op" id="1829445">(</span><span class="ident" id="1829446"><a href="/runtime/malloc.go.html#1829259">size</a></span><span class="op" id="1829450">-</span><span class="num" id="1829451">1024</span><span class="op" id="1829455">+</span><span class="num" id="1829456">127</span><span class="op" id="1829459">)</span><span class="op" id="1829460">&gt;&gt;</span><span class="num" id="1829462">7</span><span class="op" id="1829463">]</span><span class="op" id="1829464">]</span><span class="op" id="1829465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1829468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829471">if</span>&nbsp;<span class="ident" id="1829474"><a href="/runtime/malloc.go.html#1829259">size</a></span><span class="op" id="1829478">+</span><span class="ident" id="1829479"><a href="/runtime/malloc.go.html#1818990">pageSize</a></span>&nbsp;<span class="op" id="1829488">&lt;</span>&nbsp;<span class="ident" id="1829490"><a href="/runtime/malloc.go.html#1829259">size</a></span>&nbsp;<span class="op" id="1829495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829499">return</span>&nbsp;<span class="ident" id="1829506"><a href="/runtime/malloc.go.html#1829259">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1829512">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829515">return</span>&nbsp;<span class="op" id="1829522">(</span><span class="ident" id="1829523"><a href="/runtime/malloc.go.html#1829259">size</a></span>&nbsp;<span class="op" id="1829528">+</span>&nbsp;<span class="ident" id="1829530"><a href="/runtime/malloc.go.html#1818990">pageSize</a></span>&nbsp;<span class="op" id="1829539">-</span>&nbsp;<span class="num" id="1829541">1</span><span class="op" id="1829542">)</span>&nbsp;<span class="op" id="1829544">&amp;^</span>&nbsp;<span class="ident" id="1829547"><a href="/runtime/malloc.go.html#1819013">pageMask</a></span><br>
<span class="lineno"></span><span class="op" id="1829556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1829559">func</span>&nbsp;<span class="ident" id="1829564">profilealloc</span><span class="op" id="1829576">(</span><span class="ident" id="1829577">mp</span>&nbsp;<span class="op" id="1829580">*</span><span class="ident" id="1829581"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017777">m</a></span><span class="op" id="1829582">,</span>&nbsp;<span class="ident" id="1829584">x</span>&nbsp;<span class="ident" id="1829586"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1829592">.</span><span class="ident" id="1829593">Pointer</span><span class="op" id="1829600">,</span>&nbsp;<span class="ident" id="1829602">size</span>&nbsp;<span class="builtintype" id="1829607">uintptr</span><span class="op" id="1829614">)</span>&nbsp;<span class="op" id="1829616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829619">c</span>&nbsp;<span class="op" id="1829621">:=</span>&nbsp;<span class="ident" id="1829624"><a href="/runtime/malloc.go.html#1829577">mp</a></span><span class="op" id="1829626">.</span><span class="ident" id="1829627">mcache</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829635">rate</span>&nbsp;<span class="op" id="1829640">:=</span>&nbsp;<span class="ident" id="1829643"><a href="/runtime/mprof.go.html#1858617">MemProfileRate</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829659">if</span>&nbsp;<span class="ident" id="1829662"><a href="/runtime/malloc.go.html#1829602">size</a></span>&nbsp;<span class="op" id="1829667">&lt;</span>&nbsp;<span class="builtintype" id="1829669">uintptr</span><span class="op" id="1829676">(</span><span class="ident" id="1829677"><a href="/runtime/malloc.go.html#1829635">rate</a></span><span class="op" id="1829681">)</span>&nbsp;<span class="op" id="1829683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829687">//&nbsp;pick&nbsp;next&nbsp;profile&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829715">//&nbsp;If&nbsp;you&nbsp;change&nbsp;this,&nbsp;also&nbsp;change&nbsp;allocmcache.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1829765">if</span>&nbsp;<span class="ident" id="1829768"><a href="/runtime/malloc.go.html#1829635">rate</a></span>&nbsp;<span class="op" id="1829773">&gt;</span>&nbsp;<span class="num" id="1829775">0x3fffffff</span>&nbsp;<span class="op" id="1829786">{</span>&nbsp;<span class="comment" id="1829788">//&nbsp;make&nbsp;2*rate&nbsp;not&nbsp;overflow</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829819"><a href="/runtime/malloc.go.html#1829635">rate</a></span>&nbsp;<span class="op" id="1829824">=</span>&nbsp;<span class="num" id="1829826">0x3fffffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1829839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1829843">next</span>&nbsp;<span class="op" id="1829848">:=</span>&nbsp;<span class="builtintype" id="1829851">int32</span><span class="op" id="1829856">(</span><span class="ident" id="1829857"><a href="/runtime/stubs.go.html#1972912">fastrand1</a></span><span class="op" id="1829866">(</span><span class="op" id="1829867">)</span><span class="op" id="1829868">)</span>&nbsp;<span class="op" id="1829870">%</span>&nbsp;<span class="op" id="1829872">(</span><span class="num" id="1829873">2</span>&nbsp;<span class="op" id="1829875">*</span>&nbsp;<span class="builtintype" id="1829877">int32</span><span class="op" id="1829882">(</span><span class="ident" id="1829883"><a href="/runtime/malloc.go.html#1829635">rate</a></span><span class="op" id="1829887">)</span><span class="op" id="1829888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829892">//&nbsp;Subtract&nbsp;the&nbsp;&#34;remainder&#34;&nbsp;of&nbsp;the&nbsp;current&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1829949">//&nbsp;Otherwise&nbsp;objects&nbsp;that&nbsp;are&nbsp;close&nbsp;in&nbsp;size&nbsp;to&nbsp;sampling&nbsp;rate</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830012">//&nbsp;will&nbsp;be&nbsp;under-sampled,&nbsp;because&nbsp;we&nbsp;consistently&nbsp;discard&nbsp;this&nbsp;remainder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830088"><a href="/runtime/malloc.go.html#1829843">next</a></span>&nbsp;<span class="op" id="1830093">-=</span>&nbsp;<span class="op" id="1830096">(</span><span class="builtintype" id="1830097">int32</span><span class="op" id="1830102">(</span><span class="ident" id="1830103"><a href="/runtime/malloc.go.html#1829602">size</a></span><span class="op" id="1830107">)</span>&nbsp;<span class="op" id="1830109">-</span>&nbsp;<span class="ident" id="1830111"><a href="/runtime/malloc.go.html#1829619">c</a></span><span class="op" id="1830112">.</span><span class="ident" id="1830113">next_sample</span><span class="op" id="1830124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830128">if</span>&nbsp;<span class="ident" id="1830131"><a href="/runtime/malloc.go.html#1829843">next</a></span>&nbsp;<span class="op" id="1830136">&lt;</span>&nbsp;<span class="num" id="1830138">0</span>&nbsp;<span class="op" id="1830140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830145"><a href="/runtime/malloc.go.html#1829843">next</a></span>&nbsp;<span class="op" id="1830150">=</span>&nbsp;<span class="num" id="1830152">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1830156">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830160"><a href="/runtime/malloc.go.html#1829619">c</a></span><span class="op" id="1830161">.</span><span class="ident" id="1830162">next_sample</span>&nbsp;<span class="op" id="1830174">=</span>&nbsp;<span class="ident" id="1830176"><a href="/runtime/malloc.go.html#1829843">next</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1830182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830186"><a href="/runtime/mprof.go.html#1855165">mProf_Malloc</a></span><span class="op" id="1830198">(</span><span class="ident" id="1830199"><a href="/runtime/malloc.go.html#1829584">x</a></span><span class="op" id="1830200">,</span>&nbsp;<span class="ident" id="1830202"><a href="/runtime/malloc.go.html#1829602">size</a></span><span class="op" id="1830206">)</span><br>
<span class="lineno"></span><span class="op" id="1830208">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span><span class="comment" id="1830211">//&nbsp;force&nbsp;=&nbsp;1&nbsp;-&nbsp;do&nbsp;GC&nbsp;regardless&nbsp;of&nbsp;current&nbsp;heap&nbsp;usage</span><br>
<span class="lineno"></span><span class="comment" id="1830265">//&nbsp;force&nbsp;=&nbsp;2&nbsp;-&nbsp;go&nbsp;GC&nbsp;and&nbsp;eager&nbsp;sweep</span><br>
<span class="lineno"></span><span class="keyword" id="1830302">func</span>&nbsp;<span class="ident" id="1830307">gogc</span><span class="op" id="1830311">(</span><span class="ident" id="1830312">force</span>&nbsp;<span class="builtintype" id="1830318">int32</span><span class="op" id="1830323">)</span>&nbsp;<span class="op" id="1830325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830328">//&nbsp;The&nbsp;gc&nbsp;is&nbsp;turned&nbsp;off&nbsp;(via&nbsp;enablegc)&nbsp;until&nbsp;the&nbsp;bootstrap&nbsp;has&nbsp;completed.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830403">//&nbsp;Also,&nbsp;malloc&nbsp;gets&nbsp;called&nbsp;in&nbsp;the&nbsp;guts&nbsp;of&nbsp;a&nbsp;number&nbsp;of&nbsp;libraries&nbsp;that&nbsp;might&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830483">//&nbsp;holding&nbsp;locks.&nbsp;To&nbsp;avoid&nbsp;deadlocks&nbsp;during&nbsp;stoptheworld,&nbsp;don&#39;t&nbsp;bother</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830555">//&nbsp;trying&nbsp;to&nbsp;run&nbsp;gc&nbsp;while&nbsp;holding&nbsp;a&nbsp;lock.&nbsp;The&nbsp;next&nbsp;mallocgc&nbsp;without&nbsp;a&nbsp;lock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830631">//&nbsp;will&nbsp;do&nbsp;the&nbsp;gc&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830659">mp</span>&nbsp;<span class="op" id="1830662">:=</span>&nbsp;<span class="ident" id="1830665"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1830673">(</span><span class="op" id="1830674">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830677">if</span>&nbsp;<span class="ident" id="1830680">gp</span>&nbsp;<span class="op" id="1830683">:=</span>&nbsp;<span class="ident" id="1830686"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1830690">(</span><span class="op" id="1830691">)</span><span class="op" id="1830692">;</span>&nbsp;<span class="ident" id="1830694"><a href="/runtime/malloc.go.html#1830680">gp</a></span>&nbsp;<span class="op" id="1830697">==</span>&nbsp;<span class="ident" id="1830700"><a href="/runtime/malloc.go.html#1830659">mp</a></span><span class="op" id="1830702">.</span><span class="ident" id="1830703">g0</span>&nbsp;<span class="op" id="1830706">||</span>&nbsp;<span class="ident" id="1830709"><a href="/runtime/malloc.go.html#1830659">mp</a></span><span class="op" id="1830711">.</span><span class="ident" id="1830712">locks</span>&nbsp;<span class="op" id="1830718">&gt;</span>&nbsp;<span class="num" id="1830720">1</span>&nbsp;<span class="op" id="1830722">||</span>&nbsp;<span class="op" id="1830725">!</span><span class="ident" id="1830726"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023037">memstats</a></span><span class="op" id="1830734">.</span><span class="ident" id="1830735">enablegc</span>&nbsp;<span class="op" id="1830744">||</span>&nbsp;<span class="ident" id="1830747"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021281">panicking</a></span>&nbsp;<span class="op" id="1830757">!=</span>&nbsp;<span class="num" id="1830760">0</span>&nbsp;<span class="op" id="1830762">||</span>&nbsp;<span class="ident" id="1830765"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025034">gcpercent</a></span>&nbsp;<span class="op" id="1830775">&lt;</span>&nbsp;<span class="num" id="1830777">0</span>&nbsp;<span class="op" id="1830779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830783"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1830791">(</span><span class="ident" id="1830792"><a href="/runtime/malloc.go.html#1830659">mp</a></span><span class="op" id="1830794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830798">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1830806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830809"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1830817">(</span><span class="ident" id="1830818"><a href="/runtime/malloc.go.html#1830659">mp</a></span><span class="op" id="1830820">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830823"><a href="/runtime/malloc.go.html#1830659">mp</a></span>&nbsp;<span class="op" id="1830826">=</span>&nbsp;<span class="ident" id="1830828">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1830834"><a href="/runtime/sema.go.html#1932865">semacquire</a></span><span class="op" id="1830844">(</span><span class="op" id="1830845">&amp;</span><span class="ident" id="1830846"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021561">worldsema</a></span><span class="op" id="1830855">,</span>&nbsp;<span class="ident" id="1830857">false</span><span class="op" id="1830862">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1830866">if</span>&nbsp;<span class="ident" id="1830869"><a href="/runtime/malloc.go.html#1830312">force</a></span>&nbsp;<span class="op" id="1830875">==</span>&nbsp;<span class="num" id="1830878">0</span>&nbsp;<span class="op" id="1830880">&amp;&amp;</span>&nbsp;<span class="ident" id="1830883"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023037">memstats</a></span><span class="op" id="1830891">.</span><span class="ident" id="1830892">heap_alloc</span>&nbsp;<span class="op" id="1830903">&lt;</span>&nbsp;<span class="ident" id="1830905"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023037">memstats</a></span><span class="op" id="1830913">.</span><span class="ident" id="1830914">next_gc</span>&nbsp;<span class="op" id="1830922">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830926">//&nbsp;typically&nbsp;threads&nbsp;which&nbsp;lost&nbsp;the&nbsp;race&nbsp;to&nbsp;grab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1830977">//&nbsp;worldsema&nbsp;exit&nbsp;here&nbsp;when&nbsp;gc&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831019"><a href="/runtime/sema.go.html#1933949">semrelease</a></span><span class="op" id="1831029">(</span><span class="op" id="1831030">&amp;</span><span class="ident" id="1831031"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021561">worldsema</a></span><span class="op" id="1831040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1831044">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1831052">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831056">//&nbsp;Ok,&nbsp;we&#39;re&nbsp;doing&nbsp;it!&nbsp;&nbsp;Stop&nbsp;everybody&nbsp;else</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831101">startTime</span>&nbsp;<span class="op" id="1831111">:=</span>&nbsp;<span class="ident" id="1831114"><a href="/runtime/stubs.go.html#1973903">nanotime</a></span><span class="op" id="1831122">(</span><span class="op" id="1831123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831126"><a href="/runtime/malloc.go.html#1830659">mp</a></span>&nbsp;<span class="op" id="1831129">=</span>&nbsp;<span class="ident" id="1831131"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1831139">(</span><span class="op" id="1831140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831143"><a href="/runtime/malloc.go.html#1830659">mp</a></span><span class="op" id="1831145">.</span><span class="ident" id="1831146">gcing</span>&nbsp;<span class="op" id="1831152">=</span>&nbsp;<span class="num" id="1831154">1</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831157"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1831165">(</span><span class="ident" id="1831166"><a href="/runtime/malloc.go.html#1830659">mp</a></span><span class="op" id="1831168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831171"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1831174">(</span><span class="ident" id="1831175"><a href="/runtime/stubs.go.html#1972761">stoptheworld</a></span><span class="op" id="1831187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1831190">if</span>&nbsp;<span class="ident" id="1831193"><a href="/runtime/malloc.go.html#1830659">mp</a></span>&nbsp;<span class="op" id="1831196">!=</span>&nbsp;<span class="ident" id="1831199"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1831207">(</span><span class="op" id="1831208">)</span>&nbsp;<span class="op" id="1831210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831214"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1831221">(</span><span class="string" id="1831222">&#34;gogc:&nbsp;rescheduled&#34;</span><span class="op" id="1831241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1831244">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831248"><a href="/runtime/mgc0.go.html#1846991">clearpools</a></span><span class="op" id="1831258">(</span><span class="op" id="1831259">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831263">//&nbsp;Run&nbsp;gc&nbsp;on&nbsp;the&nbsp;g0&nbsp;stack.&nbsp;&nbsp;We&nbsp;do&nbsp;this&nbsp;so&nbsp;that&nbsp;the&nbsp;g&nbsp;stack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831323">//&nbsp;we&#39;re&nbsp;currently&nbsp;running&nbsp;on&nbsp;will&nbsp;no&nbsp;longer&nbsp;change.&nbsp;&nbsp;Cuts</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831383">//&nbsp;the&nbsp;root&nbsp;set&nbsp;down&nbsp;a&nbsp;bit&nbsp;(g0&nbsp;stacks&nbsp;are&nbsp;not&nbsp;scanned,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831443">//&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;scan&nbsp;gc&#39;s&nbsp;internal&nbsp;state).&nbsp;&nbsp;We&nbsp;also</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831500">//&nbsp;need&nbsp;to&nbsp;switch&nbsp;to&nbsp;g0&nbsp;so&nbsp;we&nbsp;can&nbsp;shrink&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831553">n</span>&nbsp;<span class="op" id="1831555">:=</span>&nbsp;<span class="num" id="1831558">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1831561">if</span>&nbsp;<span class="ident" id="1831564"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021438">debug</a></span><span class="op" id="1831569">.</span><span class="ident" id="1831570">gctrace</span>&nbsp;<span class="op" id="1831578">&gt;</span>&nbsp;<span class="num" id="1831580">1</span>&nbsp;<span class="op" id="1831582">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831586"><a href="/runtime/malloc.go.html#1831553">n</a></span>&nbsp;<span class="op" id="1831588">=</span>&nbsp;<span class="num" id="1831590">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1831593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1831596">for</span>&nbsp;<span class="ident" id="1831600">i</span>&nbsp;<span class="op" id="1831602">:=</span>&nbsp;<span class="num" id="1831605">0</span><span class="op" id="1831606">;</span>&nbsp;<span class="ident" id="1831608"><a href="/runtime/malloc.go.html#1831600">i</a></span>&nbsp;<span class="op" id="1831610">&lt;</span>&nbsp;<span class="ident" id="1831612"><a href="/runtime/malloc.go.html#1831553">n</a></span><span class="op" id="1831613">;</span>&nbsp;<span class="ident" id="1831615"><a href="/runtime/malloc.go.html#1831600">i</a></span><span class="op" id="1831616">++</span>&nbsp;<span class="op" id="1831619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1831623">if</span>&nbsp;<span class="ident" id="1831626"><a href="/runtime/malloc.go.html#1831600">i</a></span>&nbsp;<span class="op" id="1831628">&gt;</span>&nbsp;<span class="num" id="1831630">0</span>&nbsp;<span class="op" id="1831632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831637"><a href="/runtime/malloc.go.html#1831101">startTime</a></span>&nbsp;<span class="op" id="1831647">=</span>&nbsp;<span class="ident" id="1831649"><a href="/runtime/stubs.go.html#1973903">nanotime</a></span><span class="op" id="1831657">(</span><span class="op" id="1831658">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1831662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831666">//&nbsp;switch&nbsp;to&nbsp;g0,&nbsp;call&nbsp;gc,&nbsp;then&nbsp;switch&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831711"><a href="/runtime/malloc.go.html#1830659">mp</a></span><span class="op" id="1831713">.</span><span class="ident" id="1831714">scalararg</span><span class="op" id="1831723">[</span><span class="num" id="1831724">0</span><span class="op" id="1831725">]</span>&nbsp;<span class="op" id="1831727">=</span>&nbsp;<span class="builtintype" id="1831729">uintptr</span><span class="op" id="1831736">(</span><span class="builtintype" id="1831737">uint32</span><span class="op" id="1831743">(</span><span class="ident" id="1831744"><a href="/runtime/malloc.go.html#1831101">startTime</a></span><span class="op" id="1831753">)</span><span class="op" id="1831754">)</span>&nbsp;<span class="comment" id="1831756">//&nbsp;low&nbsp;32&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831773"><a href="/runtime/malloc.go.html#1830659">mp</a></span><span class="op" id="1831775">.</span><span class="ident" id="1831776">scalararg</span><span class="op" id="1831785">[</span><span class="num" id="1831786">1</span><span class="op" id="1831787">]</span>&nbsp;<span class="op" id="1831789">=</span>&nbsp;<span class="builtintype" id="1831791">uintptr</span><span class="op" id="1831798">(</span><span class="ident" id="1831799"><a href="/runtime/malloc.go.html#1831101">startTime</a></span>&nbsp;<span class="op" id="1831809">&gt;&gt;</span>&nbsp;<span class="num" id="1831812">32</span><span class="op" id="1831814">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1831818">//&nbsp;high&nbsp;32&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1831836">if</span>&nbsp;<span class="ident" id="1831839"><a href="/runtime/malloc.go.html#1830312">force</a></span>&nbsp;<span class="op" id="1831845">&gt;=</span>&nbsp;<span class="num" id="1831848">2</span>&nbsp;<span class="op" id="1831850">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831855"><a href="/runtime/malloc.go.html#1830659">mp</a></span><span class="op" id="1831857">.</span><span class="ident" id="1831858">scalararg</span><span class="op" id="1831867">[</span><span class="num" id="1831868">2</span><span class="op" id="1831869">]</span>&nbsp;<span class="op" id="1831871">=</span>&nbsp;<span class="num" id="1831873">1</span>&nbsp;<span class="comment" id="1831875">//&nbsp;eagersweep</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1831891">}</span>&nbsp;<span class="keyword" id="1831893">else</span>&nbsp;<span class="op" id="1831898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831903"><a href="/runtime/malloc.go.html#1830659">mp</a></span><span class="op" id="1831905">.</span><span class="ident" id="1831906">scalararg</span><span class="op" id="1831915">[</span><span class="num" id="1831916">2</span><span class="op" id="1831917">]</span>&nbsp;<span class="op" id="1831919">=</span>&nbsp;<span class="num" id="1831921">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1831925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831929"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1831932">(</span><span class="ident" id="1831933"><a href="/runtime/stubs.go.html#1972150">gc_m</a></span><span class="op" id="1831937">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1831940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1831944">//&nbsp;all&nbsp;done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831957"><a href="/runtime/malloc.go.html#1830659">mp</a></span><span class="op" id="1831959">.</span><span class="ident" id="1831960">gcing</span>&nbsp;<span class="op" id="1831966">=</span>&nbsp;<span class="num" id="1831968">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831971"><a href="/runtime/sema.go.html#1933949">semrelease</a></span><span class="op" id="1831981">(</span><span class="op" id="1831982">&amp;</span><span class="ident" id="1831983"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021561">worldsema</a></span><span class="op" id="1831992">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1831995"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1831998">(</span><span class="ident" id="1831999"><a href="/runtime/stubs.go.html#1972740">starttheworld</a></span><span class="op" id="1832012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832015"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1832023">(</span><span class="ident" id="1832024"><a href="/runtime/malloc.go.html#1830659">mp</a></span><span class="op" id="1832026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832029"><a href="/runtime/malloc.go.html#1830659">mp</a></span>&nbsp;<span class="op" id="1832032">=</span>&nbsp;<span class="ident" id="1832034">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1832040">//&nbsp;now&nbsp;that&nbsp;gc&nbsp;is&nbsp;done,&nbsp;kick&nbsp;off&nbsp;finalizer&nbsp;thread&nbsp;if&nbsp;needed</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1832101">if</span>&nbsp;<span class="op" id="1832104">!</span><span class="ident" id="1832105"><a href="/runtime/malloc.go.html#1819256">concurrentSweep</a></span>&nbsp;<span class="op" id="1832121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1832125">//&nbsp;give&nbsp;the&nbsp;queued&nbsp;finalizers,&nbsp;if&nbsp;any,&nbsp;a&nbsp;chance&nbsp;to&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832182"><a href="/runtime/proc.go.html#1903075">Gosched</a></span><span class="op" id="1832189">(</span><span class="op" id="1832190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1832193">}</span><br>
<span class="lineno"></span><span class="op" id="1832195">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="comment" id="1832198">//&nbsp;GC&nbsp;runs&nbsp;a&nbsp;garbage&nbsp;collection.</span><br>
<span class="lineno"></span><span class="keyword" id="1832231">func</span>&nbsp;<span class="ident" id="1832236">GC</span><span class="op" id="1832238">(</span><span class="op" id="1832239">)</span>&nbsp;<span class="op" id="1832241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1832244"><a href="/runtime/malloc.go.html#1830307">gogc</a></span><span class="op" id="1832248">(</span><span class="num" id="1832249">2</span><span class="op" id="1832250">)</span><br>
<span class="lineno"></span><span class="op" id="1832252">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="comment" id="1832255">//&nbsp;linker-provided</span><br>
<span class="lineno"></span><span class="keyword" id="1832274">var</span>&nbsp;<span class="ident" id="1832278">noptrdata</span>&nbsp;<span class="keyword" id="1832288">struct</span><span class="op" id="1832294">{</span><span class="op" id="1832295">}</span><br>
<span class="lineno"></span><span class="keyword" id="1832297">var</span>&nbsp;<span class="ident" id="1832301">enoptrdata</span>&nbsp;<span class="keyword" id="1832312">struct</span><span class="op" id="1832318">{</span><span class="op" id="1832319">}</span><br>
<span class="lineno"></span><span class="keyword" id="1832321">var</span>&nbsp;<span class="ident" id="1832325">noptrbss</span>&nbsp;<span class="keyword" id="1832334">struct</span><span class="op" id="1832340">{</span><span class="op" id="1832341">}</span><br>
<span class="lineno">495</span><span class="keyword" id="1832343">var</span>&nbsp;<span class="ident" id="1832347">enoptrbss</span>&nbsp;<span class="keyword" id="1832357">struct</span><span class="op" id="1832363">{</span><span class="op" id="1832364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1832367">//&nbsp;SetFinalizer&nbsp;sets&nbsp;the&nbsp;finalizer&nbsp;associated&nbsp;with&nbsp;x&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="1832426">//&nbsp;When&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;finds&nbsp;an&nbsp;unreachable&nbsp;block</span><br>
<span class="lineno"></span><span class="comment" id="1832483">//&nbsp;with&nbsp;an&nbsp;associated&nbsp;finalizer,&nbsp;it&nbsp;clears&nbsp;the&nbsp;association&nbsp;and&nbsp;runs</span><br>
<span class="lineno">500</span><span class="comment" id="1832551">//&nbsp;f(x)&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.&nbsp;&nbsp;This&nbsp;makes&nbsp;x&nbsp;reachable&nbsp;again,&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="1832619">//&nbsp;now&nbsp;without&nbsp;an&nbsp;associated&nbsp;finalizer.&nbsp;&nbsp;Assuming&nbsp;that&nbsp;SetFinalizer</span><br>
<span class="lineno"></span><span class="comment" id="1832687">//&nbsp;is&nbsp;not&nbsp;called&nbsp;again,&nbsp;the&nbsp;next&nbsp;time&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;sees</span><br>
<span class="lineno"></span><span class="comment" id="1832752">//&nbsp;that&nbsp;x&nbsp;is&nbsp;unreachable,&nbsp;it&nbsp;will&nbsp;free&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1832794">//</span><br>
<span class="lineno">505</span><span class="comment" id="1832797">//&nbsp;SetFinalizer(x,&nbsp;nil)&nbsp;clears&nbsp;any&nbsp;finalizer&nbsp;associated&nbsp;with&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1832861">//</span><br>
<span class="lineno"></span><span class="comment" id="1832864">//&nbsp;The&nbsp;argument&nbsp;x&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer&nbsp;to&nbsp;an&nbsp;object&nbsp;allocated&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1832926">//&nbsp;calling&nbsp;new&nbsp;or&nbsp;by&nbsp;taking&nbsp;the&nbsp;address&nbsp;of&nbsp;a&nbsp;composite&nbsp;literal.</span><br>
<span class="lineno"></span><span class="comment" id="1832990">//&nbsp;The&nbsp;argument&nbsp;f&nbsp;must&nbsp;be&nbsp;a&nbsp;function&nbsp;that&nbsp;takes&nbsp;a&nbsp;single&nbsp;argument</span><br>
<span class="lineno">510</span><span class="comment" id="1833056">//&nbsp;to&nbsp;which&nbsp;x&#39;s&nbsp;type&nbsp;can&nbsp;be&nbsp;assigned,&nbsp;and&nbsp;can&nbsp;have&nbsp;arbitrary&nbsp;ignored&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="1833132">//&nbsp;values.&nbsp;If&nbsp;either&nbsp;of&nbsp;these&nbsp;is&nbsp;not&nbsp;true,&nbsp;SetFinalizer&nbsp;aborts&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1833199">//&nbsp;program.</span><br>
<span class="lineno"></span><span class="comment" id="1833211">//</span><br>
<span class="lineno"></span><span class="comment" id="1833214">//&nbsp;Finalizers&nbsp;are&nbsp;run&nbsp;in&nbsp;dependency&nbsp;order:&nbsp;if&nbsp;A&nbsp;points&nbsp;at&nbsp;B,&nbsp;both&nbsp;have</span><br>
<span class="lineno">515</span><span class="comment" id="1833285">//&nbsp;finalizers,&nbsp;and&nbsp;they&nbsp;are&nbsp;otherwise&nbsp;unreachable,&nbsp;only&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="1833355">//&nbsp;for&nbsp;A&nbsp;runs;&nbsp;once&nbsp;A&nbsp;is&nbsp;freed,&nbsp;the&nbsp;finalizer&nbsp;for&nbsp;B&nbsp;can&nbsp;run.</span><br>
<span class="lineno"></span><span class="comment" id="1833416">//&nbsp;If&nbsp;a&nbsp;cyclic&nbsp;structure&nbsp;includes&nbsp;a&nbsp;block&nbsp;with&nbsp;a&nbsp;finalizer,&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="1833481">//&nbsp;cycle&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;garbage&nbsp;collected&nbsp;and&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="1833550">//&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;run,&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;ordering&nbsp;that</span><br>
<span class="lineno">520</span><span class="comment" id="1833613">//&nbsp;respects&nbsp;the&nbsp;dependencies.</span><br>
<span class="lineno"></span><span class="comment" id="1833643">//</span><br>
<span class="lineno"></span><span class="comment" id="1833646">//&nbsp;The&nbsp;finalizer&nbsp;for&nbsp;x&nbsp;is&nbsp;scheduled&nbsp;to&nbsp;run&nbsp;at&nbsp;some&nbsp;arbitrary&nbsp;time&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="1833718">//&nbsp;x&nbsp;becomes&nbsp;unreachable.</span><br>
<span class="lineno"></span><span class="comment" id="1833744">//&nbsp;There&nbsp;is&nbsp;no&nbsp;guarantee&nbsp;that&nbsp;finalizers&nbsp;will&nbsp;run&nbsp;before&nbsp;a&nbsp;program&nbsp;exits,</span><br>
<span class="lineno">525</span><span class="comment" id="1833818">//&nbsp;so&nbsp;typically&nbsp;they&nbsp;are&nbsp;useful&nbsp;only&nbsp;for&nbsp;releasing&nbsp;non-memory&nbsp;resources</span><br>
<span class="lineno"></span><span class="comment" id="1833890">//&nbsp;associated&nbsp;with&nbsp;an&nbsp;object&nbsp;during&nbsp;a&nbsp;long-running&nbsp;program.</span><br>
<span class="lineno"></span><span class="comment" id="1833950">//&nbsp;For&nbsp;example,&nbsp;an&nbsp;os.File&nbsp;object&nbsp;could&nbsp;use&nbsp;a&nbsp;finalizer&nbsp;to&nbsp;close&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1834019">//&nbsp;associated&nbsp;operating&nbsp;system&nbsp;file&nbsp;descriptor&nbsp;when&nbsp;a&nbsp;program&nbsp;discards</span><br>
<span class="lineno"></span><span class="comment" id="1834090">//&nbsp;an&nbsp;os.File&nbsp;without&nbsp;calling&nbsp;Close,&nbsp;but&nbsp;it&nbsp;would&nbsp;be&nbsp;a&nbsp;mistake</span><br>
<span class="lineno">530</span><span class="comment" id="1834153">//&nbsp;to&nbsp;depend&nbsp;on&nbsp;a&nbsp;finalizer&nbsp;to&nbsp;flush&nbsp;an&nbsp;in-memory&nbsp;I/O&nbsp;buffer&nbsp;such&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1834224">//&nbsp;bufio.Writer,&nbsp;because&nbsp;the&nbsp;buffer&nbsp;would&nbsp;not&nbsp;be&nbsp;flushed&nbsp;at&nbsp;program&nbsp;exit.</span><br>
<span class="lineno"></span><span class="comment" id="1834298">//</span><br>
<span class="lineno"></span><span class="comment" id="1834301">//&nbsp;It&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;that&nbsp;a&nbsp;finalizer&nbsp;will&nbsp;run&nbsp;if&nbsp;the&nbsp;size&nbsp;of&nbsp;*x&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1834372">//&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno">535</span><span class="comment" id="1834387">//</span><br>
<span class="lineno"></span><span class="comment" id="1834390">//&nbsp;It&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;that&nbsp;a&nbsp;finalizer&nbsp;will&nbsp;run&nbsp;for&nbsp;objects&nbsp;allocated</span><br>
<span class="lineno"></span><span class="comment" id="1834462">//&nbsp;in&nbsp;initializers&nbsp;for&nbsp;package-level&nbsp;variables.&nbsp;Such&nbsp;objects&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1834530">//&nbsp;linker-allocated,&nbsp;not&nbsp;heap-allocated.</span><br>
<span class="lineno"></span><span class="comment" id="1834571">//</span><br>
<span class="lineno">540</span><span class="comment" id="1834574">//&nbsp;A&nbsp;single&nbsp;goroutine&nbsp;runs&nbsp;all&nbsp;finalizers&nbsp;for&nbsp;a&nbsp;program,&nbsp;sequentially.</span><br>
<span class="lineno"></span><span class="comment" id="1834645">//&nbsp;If&nbsp;a&nbsp;finalizer&nbsp;must&nbsp;run&nbsp;for&nbsp;a&nbsp;long&nbsp;time,&nbsp;it&nbsp;should&nbsp;do&nbsp;so&nbsp;by&nbsp;starting</span><br>
<span class="lineno"></span><span class="comment" id="1834717">//&nbsp;a&nbsp;new&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="1834737">func</span>&nbsp;<span class="ident" id="1834742">SetFinalizer</span><span class="op" id="1834754">(</span><span class="ident" id="1834755">obj</span>&nbsp;<span class="keyword" id="1834759">interface</span><span class="op" id="1834768">{</span><span class="op" id="1834769">}</span><span class="op" id="1834770">,</span>&nbsp;<span class="ident" id="1834772">finalizer</span>&nbsp;<span class="keyword" id="1834782">interface</span><span class="op" id="1834791">{</span><span class="op" id="1834792">}</span><span class="op" id="1834793">)</span>&nbsp;<span class="op" id="1834795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834798">e</span>&nbsp;<span class="op" id="1834800">:=</span>&nbsp;<span class="op" id="1834803">(</span><span class="op" id="1834804">*</span><span class="ident" id="1834805"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016390">eface</a></span><span class="op" id="1834810">)</span><span class="op" id="1834811">(</span><span class="ident" id="1834812"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1834818">.</span><span class="ident" id="1834819">Pointer</span><span class="op" id="1834826">(</span><span class="op" id="1834827">&amp;</span><span class="ident" id="1834828"><a href="/runtime/malloc.go.html#1834755">obj</a></span><span class="op" id="1834831">)</span><span class="op" id="1834832">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834835">etyp</span>&nbsp;<span class="op" id="1834840">:=</span>&nbsp;<span class="ident" id="1834843"><a href="/runtime/malloc.go.html#1834798">e</a></span><span class="op" id="1834844">.</span><span class="ident" id="1834845">_type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1834852">if</span>&nbsp;<span class="ident" id="1834855"><a href="/runtime/malloc.go.html#1834835">etyp</a></span>&nbsp;<span class="op" id="1834860">==</span>&nbsp;<span class="ident" id="1834863">nil</span>&nbsp;<span class="op" id="1834867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834871"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1834878">(</span><span class="string" id="1834879">&#34;runtime.SetFinalizer:&nbsp;first&nbsp;argument&nbsp;is&nbsp;nil&#34;</span><span class="op" id="1834924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1834927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1834930">if</span>&nbsp;<span class="ident" id="1834933"><a href="/runtime/malloc.go.html#1834835">etyp</a></span><span class="op" id="1834937">.</span><span class="ident" id="1834938">kind</span><span class="op" id="1834942">&amp;</span><span class="ident" id="1834943"><a href="/runtime/typekind.go.html#2015249">kindMask</a></span>&nbsp;<span class="op" id="1834952">!=</span>&nbsp;<span class="ident" id="1834955"><a href="/runtime/typekind.go.html#2014978">kindPtr</a></span>&nbsp;<span class="op" id="1834963">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1834967"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1834974">(</span><span class="string" id="1834975">&#34;runtime.SetFinalizer:&nbsp;first&nbsp;argument&nbsp;is&nbsp;&#34;</span>&nbsp;<span class="op" id="1835018">+</span>&nbsp;<span class="op" id="1835020">*</span><span class="ident" id="1835021"><a href="/runtime/malloc.go.html#1834835">etyp</a></span><span class="op" id="1835025">.</span><span class="ident" id="1835026">_string</span>&nbsp;<span class="op" id="1835034">+</span>&nbsp;<span class="string" id="1835036">&#34;,&nbsp;not&nbsp;pointer&#34;</span><span class="op" id="1835051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1835054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1835057">ot</span>&nbsp;<span class="op" id="1835060">:=</span>&nbsp;<span class="op" id="1835063">(</span><span class="op" id="1835064">*</span><span class="ident" id="1835065"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026489">ptrtype</a></span><span class="op" id="1835072">)</span><span class="op" id="1835073">(</span><span class="ident" id="1835074"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1835080">.</span><span class="ident" id="1835081">Pointer</span><span class="op" id="1835088">(</span><span class="ident" id="1835089"><a href="/runtime/malloc.go.html#1834835">etyp</a></span><span class="op" id="1835093">)</span><span class="op" id="1835094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1835097">if</span>&nbsp;<span class="ident" id="1835100"><a href="/runtime/malloc.go.html#1835057">ot</a></span><span class="op" id="1835102">.</span><span class="ident" id="1835103">elem</span>&nbsp;<span class="op" id="1835108">==</span>&nbsp;<span class="ident" id="1835111">nil</span>&nbsp;<span class="op" id="1835115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1835119"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1835126">(</span><span class="string" id="1835127">&#34;nil&nbsp;elem&nbsp;type!&#34;</span><span class="op" id="1835143">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1835146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1835150">//&nbsp;find&nbsp;the&nbsp;containing&nbsp;object</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1835181">_</span><span class="op" id="1835182">,</span>&nbsp;<span class="ident" id="1835184">base</span><span class="op" id="1835188">,</span>&nbsp;<span class="ident" id="1835190">_</span>&nbsp;<span class="op" id="1835192">:=</span>&nbsp;<span class="ident" id="1835195"><a href="/runtime/malloc.go.html#1838735">findObject</a></span><span class="op" id="1835205">(</span><span class="ident" id="1835206"><a href="/runtime/malloc.go.html#1834798">e</a></span><span class="op" id="1835207">.</span><span class="ident" id="1835208">data</span><span class="op" id="1835212">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1835216">if</span>&nbsp;<span class="ident" id="1835219"><a href="/runtime/malloc.go.html#1835184">base</a></span>&nbsp;<span class="op" id="1835224">==</span>&nbsp;<span class="ident" id="1835227">nil</span>&nbsp;<span class="op" id="1835231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1835235">//&nbsp;0-length&nbsp;objects&nbsp;are&nbsp;okay.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1835267">if</span>&nbsp;<span class="ident" id="1835270"><a href="/runtime/malloc.go.html#1834798">e</a></span><span class="op" id="1835271">.</span><span class="ident" id="1835272">data</span>&nbsp;<span class="op" id="1835277">==</span>&nbsp;<span class="ident" id="1835280"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1835286">.</span><span class="ident" id="1835287">Pointer</span><span class="op" id="1835294">(</span><span class="op" id="1835295">&amp;</span><span class="ident" id="1835296"><a href="/runtime/malloc.go.html#1819403">zerobase</a></span><span class="op" id="1835304">)</span>&nbsp;<span class="op" id="1835306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1835311">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1835320">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1835325">//&nbsp;Global&nbsp;initializers&nbsp;might&nbsp;be&nbsp;linker-allocated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1835377">//&nbsp;&nbsp;&nbsp;&nbspvar&nbsp;Foo&nbsp;=&nbsp;&amp;Object{}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1835402">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;main()&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1835421">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspruntime.SetFinalizer(Foo,&nbsp;nil)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1835458">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1835465">//&nbsp;The&nbsp;relevant&nbsp;segments&nbsp;are:&nbsp;noptrdata,&nbsp;data,&nbsp;bss,&nbsp;noptrbss.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1835529">//&nbsp;We&nbsp;cannot&nbsp;assume&nbsp;they&nbsp;are&nbsp;in&nbsp;any&nbsp;order&nbsp;or&nbsp;even&nbsp;contiguous,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1835593">//&nbsp;due&nbsp;to&nbsp;external&nbsp;linking.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1835623">if</span>&nbsp;<span class="builtintype" id="1835626">uintptr</span><span class="op" id="1835633">(</span><span class="ident" id="1835634"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1835640">.</span><span class="ident" id="1835641">Pointer</span><span class="op" id="1835648">(</span><span class="op" id="1835649">&amp;</span><span class="ident" id="1835650"><a href="/runtime/malloc.go.html#1832278">noptrdata</a></span><span class="op" id="1835659">)</span><span class="op" id="1835660">)</span>&nbsp;<span class="op" id="1835662">&lt;=</span>&nbsp;<span class="builtintype" id="1835665">uintptr</span><span class="op" id="1835672">(</span><span class="ident" id="1835673"><a href="/runtime/malloc.go.html#1834798">e</a></span><span class="op" id="1835674">.</span><span class="ident" id="1835675">data</span><span class="op" id="1835679">)</span>&nbsp;<span class="op" id="1835681">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1835684">uintptr</span><span class="op" id="1835691">(</span><span class="ident" id="1835692"><a href="/runtime/malloc.go.html#1834798">e</a></span><span class="op" id="1835693">.</span><span class="ident" id="1835694">data</span><span class="op" id="1835698">)</span>&nbsp;<span class="op" id="1835700">&lt;</span>&nbsp;<span class="builtintype" id="1835702">uintptr</span><span class="op" id="1835709">(</span><span class="ident" id="1835710"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1835716">.</span><span class="ident" id="1835717">Pointer</span><span class="op" id="1835724">(</span><span class="op" id="1835725">&amp;</span><span class="ident" id="1835726"><a href="/runtime/malloc.go.html#1832301">enoptrdata</a></span><span class="op" id="1835736">)</span><span class="op" id="1835737">)</span>&nbsp;<span class="op" id="1835739">||</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="1835745">uintptr</span><span class="op" id="1835752">(</span><span class="ident" id="1835753"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1835759">.</span><span class="ident" id="1835760">Pointer</span><span class="op" id="1835767">(</span><span class="op" id="1835768">&amp;</span><span class="ident" id="1835769"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032814">data</a></span><span class="op" id="1835773">)</span><span class="op" id="1835774">)</span>&nbsp;<span class="op" id="1835776">&lt;=</span>&nbsp;<span class="builtintype" id="1835779">uintptr</span><span class="op" id="1835786">(</span><span class="ident" id="1835787"><a href="/runtime/malloc.go.html#1834798">e</a></span><span class="op" id="1835788">.</span><span class="ident" id="1835789">data</span><span class="op" id="1835793">)</span>&nbsp;<span class="op" id="1835795">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1835798">uintptr</span><span class="op" id="1835805">(</span><span class="ident" id="1835806"><a href="/runtime/malloc.go.html#1834798">e</a></span><span class="op" id="1835807">.</span><span class="ident" id="1835808">data</span><span class="op" id="1835812">)</span>&nbsp;<span class="op" id="1835814">&lt;</span>&nbsp;<span class="builtintype" id="1835816">uintptr</span><span class="op" id="1835823">(</span><span class="ident" id="1835824"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1835830">.</span><span class="ident" id="1835831">Pointer</span><span class="op" id="1835838">(</span><span class="op" id="1835839">&amp;</span><span class="ident" id="1835840"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032831">edata</a></span><span class="op" id="1835845">)</span><span class="op" id="1835846">)</span>&nbsp;<span class="op" id="1835848">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="1835854">uintptr</span><span class="op" id="1835861">(</span><span class="ident" id="1835862"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1835868">.</span><span class="ident" id="1835869">Pointer</span><span class="op" id="1835876">(</span><span class="op" id="1835877">&amp;</span><span class="ident" id="1835878"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032849">bss</a></span><span class="op" id="1835881">)</span><span class="op" id="1835882">)</span>&nbsp;<span class="op" id="1835884">&lt;=</span>&nbsp;<span class="builtintype" id="1835887">uintptr</span><span class="op" id="1835894">(</span><span class="ident" id="1835895"><a href="/runtime/malloc.go.html#1834798">e</a></span><span class="op" id="1835896">.</span><span class="ident" id="1835897">data</span><span class="op" id="1835901">)</span>&nbsp;<span class="op" id="1835903">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1835906">uintptr</span><span class="op" id="1835913">(</span><span class="ident" id="1835914"><a href="/runtime/malloc.go.html#1834798">e</a></span><span class="op" id="1835915">.</span><span class="ident" id="1835916">data</span><span class="op" id="1835920">)</span>&nbsp;<span class="op" id="1835922">&lt;</span>&nbsp;<span class="builtintype" id="1835924">uintptr</span><span class="op" id="1835931">(</span><span class="ident" id="1835932"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1835938">.</span><span class="ident" id="1835939">Pointer</span><span class="op" id="1835946">(</span><span class="op" id="1835947">&amp;</span><span class="ident" id="1835948"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2032865">ebss</a></span><span class="op" id="1835952">)</span><span class="op" id="1835953">)</span>&nbsp;<span class="op" id="1835955">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="1835961">uintptr</span><span class="op" id="1835968">(</span><span class="ident" id="1835969"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1835975">.</span><span class="ident" id="1835976">Pointer</span><span class="op" id="1835983">(</span><span class="op" id="1835984">&amp;</span><span class="ident" id="1835985"><a href="/runtime/malloc.go.html#1832325">noptrbss</a></span><span class="op" id="1835993">)</span><span class="op" id="1835994">)</span>&nbsp;<span class="op" id="1835996">&lt;=</span>&nbsp;<span class="builtintype" id="1835999">uintptr</span><span class="op" id="1836006">(</span><span class="ident" id="1836007"><a href="/runtime/malloc.go.html#1834798">e</a></span><span class="op" id="1836008">.</span><span class="ident" id="1836009">data</span><span class="op" id="1836013">)</span>&nbsp;<span class="op" id="1836015">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1836018">uintptr</span><span class="op" id="1836025">(</span><span class="ident" id="1836026"><a href="/runtime/malloc.go.html#1834798">e</a></span><span class="op" id="1836027">.</span><span class="ident" id="1836028">data</span><span class="op" id="1836032">)</span>&nbsp;<span class="op" id="1836034">&lt;</span>&nbsp;<span class="builtintype" id="1836036">uintptr</span><span class="op" id="1836043">(</span><span class="ident" id="1836044"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1836050">.</span><span class="ident" id="1836051">Pointer</span><span class="op" id="1836058">(</span><span class="op" id="1836059">&amp;</span><span class="ident" id="1836060"><a href="/runtime/malloc.go.html#1832347">enoptrbss</a></span><span class="op" id="1836069">)</span><span class="op" id="1836070">)</span>&nbsp;<span class="op" id="1836072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1836077">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1836086">}</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1836090"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1836097">(</span><span class="string" id="1836098">&#34;runtime.SetFinalizer:&nbsp;pointer&nbsp;not&nbsp;in&nbsp;allocated&nbsp;block&#34;</span><span class="op" id="1836152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1836155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1836159">if</span>&nbsp;<span class="ident" id="1836162"><a href="/runtime/malloc.go.html#1834798">e</a></span><span class="op" id="1836163">.</span><span class="ident" id="1836164">data</span>&nbsp;<span class="op" id="1836169">!=</span>&nbsp;<span class="ident" id="1836172"><a href="/runtime/malloc.go.html#1835184">base</a></span>&nbsp;<span class="op" id="1836177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1836181">//&nbsp;As&nbsp;an&nbsp;implementation&nbsp;detail&nbsp;we&nbsp;allow&nbsp;to&nbsp;set&nbsp;finalizers&nbsp;for&nbsp;an&nbsp;inner&nbsp;byte</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1836259">//&nbsp;of&nbsp;an&nbsp;object&nbsp;if&nbsp;it&nbsp;could&nbsp;come&nbsp;from&nbsp;tiny&nbsp;alloc&nbsp;(see&nbsp;mallocgc&nbsp;for&nbsp;details).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1836338">if</span>&nbsp;<span class="ident" id="1836341"><a href="/runtime/malloc.go.html#1835057">ot</a></span><span class="op" id="1836343">.</span><span class="ident" id="1836344">elem</span>&nbsp;<span class="op" id="1836349">==</span>&nbsp;<span class="ident" id="1836352">nil</span>&nbsp;<span class="op" id="1836356">||</span>&nbsp;<span class="ident" id="1836359"><a href="/runtime/malloc.go.html#1835057">ot</a></span><span class="op" id="1836361">.</span><span class="ident" id="1836362">elem</span><span class="op" id="1836366">.</span><span class="ident" id="1836367">kind</span><span class="op" id="1836371">&amp;</span><span class="ident" id="1836372"><a href="/runtime/typekind.go.html#2015214">kindNoPointers</a></span>&nbsp;<span class="op" id="1836387">==</span>&nbsp;<span class="num" id="1836390">0</span>&nbsp;<span class="op" id="1836392">||</span>&nbsp;<span class="ident" id="1836395"><a href="/runtime/malloc.go.html#1835057">ot</a></span><span class="op" id="1836397">.</span><span class="ident" id="1836398">elem</span><span class="op" id="1836402">.</span><span class="ident" id="1836403">size</span>&nbsp;<span class="op" id="1836408">&gt;=</span>&nbsp;<span class="ident" id="1836411"><a href="/runtime/malloc.go.html#1818875">maxTinySize</a></span>&nbsp;<span class="op" id="1836423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1836428"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1836435">(</span><span class="string" id="1836436">&#34;runtime.SetFinalizer:&nbsp;pointer&nbsp;not&nbsp;at&nbsp;beginning&nbsp;of&nbsp;allocated&nbsp;block&#34;</span><span class="op" id="1836503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1836507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1836510">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1836514">f</span>&nbsp;<span class="op" id="1836516">:=</span>&nbsp;<span class="op" id="1836519">(</span><span class="op" id="1836520">*</span><span class="ident" id="1836521"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016390">eface</a></span><span class="op" id="1836526">)</span><span class="op" id="1836527">(</span><span class="ident" id="1836528"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1836534">.</span><span class="ident" id="1836535">Pointer</span><span class="op" id="1836542">(</span><span class="op" id="1836543">&amp;</span><span class="ident" id="1836544"><a href="/runtime/malloc.go.html#1834772">finalizer</a></span><span class="op" id="1836553">)</span><span class="op" id="1836554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1836557">ftyp</span>&nbsp;<span class="op" id="1836562">:=</span>&nbsp;<span class="ident" id="1836565"><a href="/runtime/malloc.go.html#1836514">f</a></span><span class="op" id="1836566">.</span><span class="ident" id="1836567">_type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1836574">if</span>&nbsp;<span class="ident" id="1836577"><a href="/runtime/malloc.go.html#1836557">ftyp</a></span>&nbsp;<span class="op" id="1836582">==</span>&nbsp;<span class="ident" id="1836585">nil</span>&nbsp;<span class="op" id="1836589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1836593">//&nbsp;switch&nbsp;to&nbsp;M&nbsp;stack&nbsp;and&nbsp;remove&nbsp;finalizer</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1836637">mp</span>&nbsp;<span class="op" id="1836640">:=</span>&nbsp;<span class="ident" id="1836643"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1836651">(</span><span class="op" id="1836652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1836656"><a href="/runtime/malloc.go.html#1836637">mp</a></span><span class="op" id="1836658">.</span><span class="ident" id="1836659">ptrarg</span><span class="op" id="1836665">[</span><span class="num" id="1836666">0</span><span class="op" id="1836667">]</span>&nbsp;<span class="op" id="1836669">=</span>&nbsp;<span class="ident" id="1836671"><a href="/runtime/malloc.go.html#1834798">e</a></span><span class="op" id="1836672">.</span><span class="ident" id="1836673">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1836680"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1836683">(</span><span class="ident" id="1836684"><a href="/runtime/stubs.go.html#1972202">removeFinalizer_m</a></span><span class="op" id="1836701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1836705"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1836713">(</span><span class="ident" id="1836714"><a href="/runtime/malloc.go.html#1836637">mp</a></span><span class="op" id="1836716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1836720">return</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1836728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1836732">if</span>&nbsp;<span class="ident" id="1836735"><a href="/runtime/malloc.go.html#1836557">ftyp</a></span><span class="op" id="1836739">.</span><span class="ident" id="1836740">kind</span><span class="op" id="1836744">&amp;</span><span class="ident" id="1836745"><a href="/runtime/typekind.go.html#2015249">kindMask</a></span>&nbsp;<span class="op" id="1836754">!=</span>&nbsp;<span class="ident" id="1836757"><a href="/runtime/typekind.go.html#2014881">kindFunc</a></span>&nbsp;<span class="op" id="1836766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1836770"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1836777">(</span><span class="string" id="1836778">&#34;runtime.SetFinalizer:&nbsp;second&nbsp;argument&nbsp;is&nbsp;&#34;</span>&nbsp;<span class="op" id="1836822">+</span>&nbsp;<span class="op" id="1836824">*</span><span class="ident" id="1836825"><a href="/runtime/malloc.go.html#1836557">ftyp</a></span><span class="op" id="1836829">.</span><span class="ident" id="1836830">_string</span>&nbsp;<span class="op" id="1836838">+</span>&nbsp;<span class="string" id="1836840">&#34;,&nbsp;not&nbsp;a&nbsp;function&#34;</span><span class="op" id="1836858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1836861">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1836864">ft</span>&nbsp;<span class="op" id="1836867">:=</span>&nbsp;<span class="op" id="1836870">(</span><span class="op" id="1836871">*</span><span class="ident" id="1836872"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026413">functype</a></span><span class="op" id="1836880">)</span><span class="op" id="1836881">(</span><span class="ident" id="1836882"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1836888">.</span><span class="ident" id="1836889">Pointer</span><span class="op" id="1836896">(</span><span class="ident" id="1836897"><a href="/runtime/malloc.go.html#1836557">ftyp</a></span><span class="op" id="1836901">)</span><span class="op" id="1836902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1836905">ins</span>&nbsp;<span class="op" id="1836909">:=</span>&nbsp;<span class="op" id="1836912">*</span><span class="op" id="1836913">(</span><span class="op" id="1836914">*</span><span class="op" id="1836915">[</span><span class="op" id="1836916">]</span><span class="op" id="1836917">*</span><span class="ident" id="1836918"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025572">_type</a></span><span class="op" id="1836923">)</span><span class="op" id="1836924">(</span><span class="ident" id="1836925"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1836931">.</span><span class="ident" id="1836932">Pointer</span><span class="op" id="1836939">(</span><span class="op" id="1836940">&amp;</span><span class="ident" id="1836941"><a href="/runtime/malloc.go.html#1836864">ft</a></span><span class="op" id="1836943">.</span><span class="ident" id="1836944">in</span><span class="op" id="1836946">)</span><span class="op" id="1836947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1836950">if</span>&nbsp;<span class="ident" id="1836953"><a href="/runtime/malloc.go.html#1836864">ft</a></span><span class="op" id="1836955">.</span><span class="ident" id="1836956">dotdotdot</span>&nbsp;<span class="op" id="1836966">||</span>&nbsp;<span class="builtinfunc" id="1836969">len</span><span class="op" id="1836972">(</span><span class="ident" id="1836973"><a href="/runtime/malloc.go.html#1836905">ins</a></span><span class="op" id="1836976">)</span>&nbsp;<span class="op" id="1836978">!=</span>&nbsp;<span class="num" id="1836981">1</span>&nbsp;<span class="op" id="1836983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1836987"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1836994">(</span><span class="string" id="1836995">&#34;runtime.SetFinalizer:&nbsp;cannot&nbsp;pass&nbsp;&#34;</span>&nbsp;<span class="op" id="1837032">+</span>&nbsp;<span class="op" id="1837034">*</span><span class="ident" id="1837035"><a href="/runtime/malloc.go.html#1834835">etyp</a></span><span class="op" id="1837039">.</span><span class="ident" id="1837040">_string</span>&nbsp;<span class="op" id="1837048">+</span>&nbsp;<span class="string" id="1837050">&#34;&nbsp;to&nbsp;finalizer&nbsp;&#34;</span>&nbsp;<span class="op" id="1837067">+</span>&nbsp;<span class="op" id="1837069">*</span><span class="ident" id="1837070"><a href="/runtime/malloc.go.html#1836557">ftyp</a></span><span class="op" id="1837074">.</span><span class="ident" id="1837075">_string</span><span class="op" id="1837082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1837085">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837088">fint</span>&nbsp;<span class="op" id="1837093">:=</span>&nbsp;<span class="ident" id="1837096"><a href="/runtime/malloc.go.html#1836905">ins</a></span><span class="op" id="1837099">[</span><span class="num" id="1837100">0</span><span class="op" id="1837101">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837104">switch</span>&nbsp;<span class="op" id="1837111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837114">case</span>&nbsp;<span class="ident" id="1837119"><a href="/runtime/malloc.go.html#1837088">fint</a></span>&nbsp;<span class="op" id="1837124">==</span>&nbsp;<span class="ident" id="1837127"><a href="/runtime/malloc.go.html#1834835">etyp</a></span><span class="op" id="1837131">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1837135">//&nbsp;ok&nbsp;-&nbsp;same&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837155">goto</span>&nbsp;<span class="ident" id="1837160">okarg</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837167">case</span>&nbsp;<span class="ident" id="1837172"><a href="/runtime/malloc.go.html#1837088">fint</a></span><span class="op" id="1837176">.</span><span class="ident" id="1837177">kind</span><span class="op" id="1837181">&amp;</span><span class="ident" id="1837182"><a href="/runtime/typekind.go.html#2015249">kindMask</a></span>&nbsp;<span class="op" id="1837191">==</span>&nbsp;<span class="ident" id="1837194"><a href="/runtime/typekind.go.html#2014978">kindPtr</a></span><span class="op" id="1837201">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837205">if</span>&nbsp;<span class="op" id="1837208">(</span><span class="ident" id="1837209"><a href="/runtime/malloc.go.html#1837088">fint</a></span><span class="op" id="1837213">.</span><span class="ident" id="1837214">x</span>&nbsp;<span class="op" id="1837216">==</span>&nbsp;<span class="ident" id="1837219">nil</span>&nbsp;<span class="op" id="1837223">||</span>&nbsp;<span class="ident" id="1837226"><a href="/runtime/malloc.go.html#1837088">fint</a></span><span class="op" id="1837230">.</span><span class="ident" id="1837231">x</span><span class="op" id="1837232">.</span><span class="ident" id="1837233">name</span>&nbsp;<span class="op" id="1837238">==</span>&nbsp;<span class="ident" id="1837241">nil</span>&nbsp;<span class="op" id="1837245">||</span>&nbsp;<span class="ident" id="1837248"><a href="/runtime/malloc.go.html#1834835">etyp</a></span><span class="op" id="1837252">.</span><span class="ident" id="1837253">x</span>&nbsp;<span class="op" id="1837255">==</span>&nbsp;<span class="ident" id="1837258">nil</span>&nbsp;<span class="op" id="1837262">||</span>&nbsp;<span class="ident" id="1837265"><a href="/runtime/malloc.go.html#1834835">etyp</a></span><span class="op" id="1837269">.</span><span class="ident" id="1837270">x</span><span class="op" id="1837271">.</span><span class="ident" id="1837272">name</span>&nbsp;<span class="op" id="1837277">==</span>&nbsp;<span class="ident" id="1837280">nil</span><span class="op" id="1837283">)</span>&nbsp;<span class="op" id="1837285">&amp;&amp;</span>&nbsp;<span class="op" id="1837288">(</span><span class="op" id="1837289">*</span><span class="ident" id="1837290"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026489">ptrtype</a></span><span class="op" id="1837297">)</span><span class="op" id="1837298">(</span><span class="ident" id="1837299"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1837305">.</span><span class="ident" id="1837306">Pointer</span><span class="op" id="1837313">(</span><span class="ident" id="1837314"><a href="/runtime/malloc.go.html#1837088">fint</a></span><span class="op" id="1837318">)</span><span class="op" id="1837319">)</span><span class="op" id="1837320">.</span><span class="ident" id="1837321">elem</span>&nbsp;<span class="op" id="1837326">==</span>&nbsp;<span class="ident" id="1837329"><a href="/runtime/malloc.go.html#1835057">ot</a></span><span class="op" id="1837331">.</span><span class="ident" id="1837332">elem</span>&nbsp;<span class="op" id="1837337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1837342">//&nbsp;ok&nbsp;-&nbsp;not&nbsp;same&nbsp;type,&nbsp;but&nbsp;both&nbsp;pointers,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1837387">//&nbsp;one&nbsp;or&nbsp;the&nbsp;other&nbsp;is&nbsp;unnamed,&nbsp;and&nbsp;same&nbsp;element&nbsp;type,&nbsp;so&nbsp;assignable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837460">goto</span>&nbsp;<span class="ident" id="1837465">okarg</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1837473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837476">case</span>&nbsp;<span class="ident" id="1837481"><a href="/runtime/malloc.go.html#1837088">fint</a></span><span class="op" id="1837485">.</span><span class="ident" id="1837486">kind</span><span class="op" id="1837490">&amp;</span><span class="ident" id="1837491"><a href="/runtime/typekind.go.html#2015249">kindMask</a></span>&nbsp;<span class="op" id="1837500">==</span>&nbsp;<span class="ident" id="1837503"><a href="/runtime/typekind.go.html#2014912">kindInterface</a></span><span class="op" id="1837516">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837520">ityp</span>&nbsp;<span class="op" id="1837525">:=</span>&nbsp;<span class="op" id="1837528">(</span><span class="op" id="1837529">*</span><span class="ident" id="1837530"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026052">interfacetype</a></span><span class="op" id="1837543">)</span><span class="op" id="1837544">(</span><span class="ident" id="1837545"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1837551">.</span><span class="ident" id="1837552">Pointer</span><span class="op" id="1837559">(</span><span class="ident" id="1837560"><a href="/runtime/malloc.go.html#1837088">fint</a></span><span class="op" id="1837564">)</span><span class="op" id="1837565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837569">if</span>&nbsp;<span class="builtinfunc" id="1837572">len</span><span class="op" id="1837575">(</span><span class="ident" id="1837576"><a href="/runtime/malloc.go.html#1837520">ityp</a></span><span class="op" id="1837580">.</span><span class="ident" id="1837581">mhdr</span><span class="op" id="1837585">)</span>&nbsp;<span class="op" id="1837587">==</span>&nbsp;<span class="num" id="1837590">0</span>&nbsp;<span class="op" id="1837592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1837597">//&nbsp;ok&nbsp;-&nbsp;satisfies&nbsp;empty&nbsp;interface</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837634">goto</span>&nbsp;<span class="ident" id="1837639">okarg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1837647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837651">if</span>&nbsp;<span class="ident" id="1837654">_</span><span class="op" id="1837655">,</span>&nbsp;<span class="ident" id="1837657">ok</span>&nbsp;<span class="op" id="1837660">:=</span>&nbsp;<span class="ident" id="1837663"><a href="/runtime/iface.go.html#1812693">assertE2I2</a></span><span class="op" id="1837673">(</span><span class="ident" id="1837674"><a href="/runtime/malloc.go.html#1837520">ityp</a></span><span class="op" id="1837678">,</span>&nbsp;<span class="ident" id="1837680"><a href="/runtime/malloc.go.html#1834755">obj</a></span><span class="op" id="1837683">)</span><span class="op" id="1837684">;</span>&nbsp;<span class="ident" id="1837686"><a href="/runtime/malloc.go.html#1837657">ok</a></span>&nbsp;<span class="op" id="1837689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837694">goto</span>&nbsp;<span class="ident" id="1837699">okarg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1837707">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1837710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837713"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1837720">(</span><span class="string" id="1837721">&#34;runtime.SetFinalizer:&nbsp;cannot&nbsp;pass&nbsp;&#34;</span>&nbsp;<span class="op" id="1837758">+</span>&nbsp;<span class="op" id="1837760">*</span><span class="ident" id="1837761"><a href="/runtime/malloc.go.html#1834835">etyp</a></span><span class="op" id="1837765">.</span><span class="ident" id="1837766">_string</span>&nbsp;<span class="op" id="1837774">+</span>&nbsp;<span class="string" id="1837776">&#34;&nbsp;to&nbsp;finalizer&nbsp;&#34;</span>&nbsp;<span class="op" id="1837793">+</span>&nbsp;<span class="op" id="1837795">*</span><span class="ident" id="1837796"><a href="/runtime/malloc.go.html#1836557">ftyp</a></span><span class="op" id="1837800">.</span><span class="ident" id="1837801">_string</span><span class="op" id="1837808">)</span><br>
<span class="lineno"></span><span class="ident" id="1837810">okarg</span><span class="op" id="1837815">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1837818">//&nbsp;compute&nbsp;size&nbsp;needed&nbsp;for&nbsp;return&nbsp;parameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837864">nret</span>&nbsp;<span class="op" id="1837869">:=</span>&nbsp;<span class="builtintype" id="1837872">uintptr</span><span class="op" id="1837879">(</span><span class="num" id="1837880">0</span><span class="op" id="1837881">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1837884">for</span>&nbsp;<span class="ident" id="1837888">_</span><span class="op" id="1837889">,</span>&nbsp;<span class="ident" id="1837891">t</span>&nbsp;<span class="op" id="1837893">:=</span>&nbsp;<span class="keyword" id="1837896">range</span>&nbsp;<span class="op" id="1837902">*</span><span class="op" id="1837903">(</span><span class="op" id="1837904">*</span><span class="op" id="1837905">[</span><span class="op" id="1837906">]</span><span class="op" id="1837907">*</span><span class="ident" id="1837908"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025572">_type</a></span><span class="op" id="1837913">)</span><span class="op" id="1837914">(</span><span class="ident" id="1837915"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1837921">.</span><span class="ident" id="1837922">Pointer</span><span class="op" id="1837929">(</span><span class="op" id="1837930">&amp;</span><span class="ident" id="1837931"><a href="/runtime/malloc.go.html#1836864">ft</a></span><span class="op" id="1837933">.</span><span class="ident" id="1837934">out</span><span class="op" id="1837937">)</span><span class="op" id="1837938">)</span>&nbsp;<span class="op" id="1837940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1837944"><a href="/runtime/malloc.go.html#1837864">nret</a></span>&nbsp;<span class="op" id="1837949">=</span>&nbsp;<span class="ident" id="1837951"><a href="/runtime/malloc.go.html#1838486">round</a></span><span class="op" id="1837956">(</span><span class="ident" id="1837957"><a href="/runtime/malloc.go.html#1837864">nret</a></span><span class="op" id="1837961">,</span>&nbsp;<span class="builtintype" id="1837963">uintptr</span><span class="op" id="1837970">(</span><span class="ident" id="1837971"><a href="/runtime/malloc.go.html#1837891">t</a></span><span class="op" id="1837972">.</span><span class="ident" id="1837973">align</span><span class="op" id="1837978">)</span><span class="op" id="1837979">)</span>&nbsp;<span class="op" id="1837981">+</span>&nbsp;<span class="builtintype" id="1837983">uintptr</span><span class="op" id="1837990">(</span><span class="ident" id="1837991"><a href="/runtime/malloc.go.html#1837891">t</a></span><span class="op" id="1837992">.</span><span class="ident" id="1837993">size</span><span class="op" id="1837997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1838000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838003"><a href="/runtime/malloc.go.html#1837864">nret</a></span>&nbsp;<span class="op" id="1838008">=</span>&nbsp;<span class="ident" id="1838010"><a href="/runtime/malloc.go.html#1838486">round</a></span><span class="op" id="1838015">(</span><span class="ident" id="1838016"><a href="/runtime/malloc.go.html#1837864">nret</a></span><span class="op" id="1838020">,</span>&nbsp;<span class="ident" id="1838022"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span><span class="op" id="1838029">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1838033">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;have&nbsp;a&nbsp;finalizer&nbsp;goroutine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838077"><a href="/runtime/malloc.go.html#1839679">createfing</a></span><span class="op" id="1838087">(</span><span class="op" id="1838088">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1838092">//&nbsp;switch&nbsp;to&nbsp;M&nbsp;stack&nbsp;to&nbsp;add&nbsp;finalizer&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838138">mp</span>&nbsp;<span class="op" id="1838141">:=</span>&nbsp;<span class="ident" id="1838144"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1838152">(</span><span class="op" id="1838153">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838156"><a href="/runtime/malloc.go.html#1838138">mp</a></span><span class="op" id="1838158">.</span><span class="ident" id="1838159">ptrarg</span><span class="op" id="1838165">[</span><span class="num" id="1838166">0</span><span class="op" id="1838167">]</span>&nbsp;<span class="op" id="1838169">=</span>&nbsp;<span class="ident" id="1838171"><a href="/runtime/malloc.go.html#1836514">f</a></span><span class="op" id="1838172">.</span><span class="ident" id="1838173">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838179"><a href="/runtime/malloc.go.html#1838138">mp</a></span><span class="op" id="1838181">.</span><span class="ident" id="1838182">ptrarg</span><span class="op" id="1838188">[</span><span class="num" id="1838189">1</span><span class="op" id="1838190">]</span>&nbsp;<span class="op" id="1838192">=</span>&nbsp;<span class="ident" id="1838194"><a href="/runtime/malloc.go.html#1834798">e</a></span><span class="op" id="1838195">.</span><span class="ident" id="1838196">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838202"><a href="/runtime/malloc.go.html#1838138">mp</a></span><span class="op" id="1838204">.</span><span class="ident" id="1838205">scalararg</span><span class="op" id="1838214">[</span><span class="num" id="1838215">0</span><span class="op" id="1838216">]</span>&nbsp;<span class="op" id="1838218">=</span>&nbsp;<span class="ident" id="1838220"><a href="/runtime/malloc.go.html#1837864">nret</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838226"><a href="/runtime/malloc.go.html#1838138">mp</a></span><span class="op" id="1838228">.</span><span class="ident" id="1838229">ptrarg</span><span class="op" id="1838235">[</span><span class="num" id="1838236">2</span><span class="op" id="1838237">]</span>&nbsp;<span class="op" id="1838239">=</span>&nbsp;<span class="ident" id="1838241"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1838247">.</span><span class="ident" id="1838248">Pointer</span><span class="op" id="1838255">(</span><span class="ident" id="1838256"><a href="/runtime/malloc.go.html#1837088">fint</a></span><span class="op" id="1838260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838263"><a href="/runtime/malloc.go.html#1838138">mp</a></span><span class="op" id="1838265">.</span><span class="ident" id="1838266">ptrarg</span><span class="op" id="1838272">[</span><span class="num" id="1838273">3</span><span class="op" id="1838274">]</span>&nbsp;<span class="op" id="1838276">=</span>&nbsp;<span class="ident" id="1838278"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1838284">.</span><span class="ident" id="1838285">Pointer</span><span class="op" id="1838292">(</span><span class="ident" id="1838293"><a href="/runtime/malloc.go.html#1835057">ot</a></span><span class="op" id="1838295">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838298"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1838301">(</span><span class="ident" id="1838302"><a href="/runtime/stubs.go.html#1972180">setFinalizer_m</a></span><span class="op" id="1838316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1838319">if</span>&nbsp;<span class="ident" id="1838322"><a href="/runtime/malloc.go.html#1838138">mp</a></span><span class="op" id="1838324">.</span><span class="ident" id="1838325">scalararg</span><span class="op" id="1838334">[</span><span class="num" id="1838335">0</span><span class="op" id="1838336">]</span>&nbsp;<span class="op" id="1838338">!=</span>&nbsp;<span class="num" id="1838341">1</span>&nbsp;<span class="op" id="1838343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838347"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1838354">(</span><span class="string" id="1838355">&#34;runtime.SetFinalizer:&nbsp;finalizer&nbsp;already&nbsp;set&#34;</span><span class="op" id="1838400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1838403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838406"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1838414">(</span><span class="ident" id="1838415"><a href="/runtime/malloc.go.html#1838138">mp</a></span><span class="op" id="1838417">)</span><br>
<span class="lineno">655</span><span class="op" id="1838419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1838422">//&nbsp;round&nbsp;n&nbsp;up&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;a.&nbsp;&nbsp;a&nbsp;must&nbsp;be&nbsp;a&nbsp;power&nbsp;of&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="1838481">func</span>&nbsp;<span class="ident" id="1838486">round</span><span class="op" id="1838491">(</span><span class="ident" id="1838492">n</span><span class="op" id="1838493">,</span>&nbsp;<span class="ident" id="1838495">a</span>&nbsp;<span class="builtintype" id="1838497">uintptr</span><span class="op" id="1838504">)</span>&nbsp;<span class="builtintype" id="1838506">uintptr</span>&nbsp;<span class="op" id="1838514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1838517">return</span>&nbsp;<span class="op" id="1838524">(</span><span class="ident" id="1838525"><a href="/runtime/malloc.go.html#1838492">n</a></span>&nbsp;<span class="op" id="1838527">+</span>&nbsp;<span class="ident" id="1838529"><a href="/runtime/malloc.go.html#1838495">a</a></span>&nbsp;<span class="op" id="1838531">-</span>&nbsp;<span class="num" id="1838533">1</span><span class="op" id="1838534">)</span>&nbsp;<span class="op" id="1838536">&amp;^</span>&nbsp;<span class="op" id="1838539">(</span><span class="ident" id="1838540"><a href="/runtime/malloc.go.html#1838495">a</a></span>&nbsp;<span class="op" id="1838542">-</span>&nbsp;<span class="num" id="1838544">1</span><span class="op" id="1838545">)</span><br>
<span class="lineno">660</span><span class="op" id="1838547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1838550">//&nbsp;Look&nbsp;up&nbsp;pointer&nbsp;v&nbsp;in&nbsp;heap.&nbsp;&nbsp;Return&nbsp;the&nbsp;span&nbsp;containing&nbsp;the&nbsp;object,</span><br>
<span class="lineno"></span><span class="comment" id="1838620">//&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;object,&nbsp;and&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;object.&nbsp;&nbsp;If&nbsp;the&nbsp;object</span><br>
<span class="lineno"></span><span class="comment" id="1838691">//&nbsp;does&nbsp;not&nbsp;exist,&nbsp;return&nbsp;nil,&nbsp;nil,&nbsp;0.</span><br>
<span class="lineno">665</span><span class="keyword" id="1838730">func</span>&nbsp;<span class="ident" id="1838735">findObject</span><span class="op" id="1838745">(</span><span class="ident" id="1838746">v</span>&nbsp;<span class="ident" id="1838748"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1838754">.</span><span class="ident" id="1838755">Pointer</span><span class="op" id="1838762">)</span>&nbsp;<span class="op" id="1838764">(</span><span class="ident" id="1838765">s</span>&nbsp;<span class="op" id="1838767">*</span><span class="ident" id="1838768"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2024017">mspan</a></span><span class="op" id="1838773">,</span>&nbsp;<span class="ident" id="1838775">x</span>&nbsp;<span class="ident" id="1838777"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1838783">.</span><span class="ident" id="1838784">Pointer</span><span class="op" id="1838791">,</span>&nbsp;<span class="ident" id="1838793">n</span>&nbsp;<span class="builtintype" id="1838795">uintptr</span><span class="op" id="1838802">)</span>&nbsp;<span class="op" id="1838804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838807">c</span>&nbsp;<span class="op" id="1838809">:=</span>&nbsp;<span class="ident" id="1838812"><a href="/runtime/stubs.go.html#1968941">gomcache</a></span><span class="op" id="1838820">(</span><span class="op" id="1838821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838824"><a href="/runtime/malloc.go.html#1838807">c</a></span><span class="op" id="1838825">.</span><span class="ident" id="1838826">local_nlookup</span><span class="op" id="1838839">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1838843">if</span>&nbsp;<span class="ident" id="1838846"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span>&nbsp;<span class="op" id="1838854">==</span>&nbsp;<span class="num" id="1838857">4</span>&nbsp;<span class="op" id="1838859">&amp;&amp;</span>&nbsp;<span class="ident" id="1838862"><a href="/runtime/malloc.go.html#1838807">c</a></span><span class="op" id="1838863">.</span><span class="ident" id="1838864">local_nlookup</span>&nbsp;<span class="op" id="1838878">&gt;=</span>&nbsp;<span class="num" id="1838881">1</span><span class="op" id="1838882">&lt;&lt;</span><span class="num" id="1838884">30</span>&nbsp;<span class="op" id="1838887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1838891">//&nbsp;purge&nbsp;cache&nbsp;stats&nbsp;to&nbsp;prevent&nbsp;overflow</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838934"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1838938">(</span><span class="op" id="1838939">&amp;</span><span class="ident" id="1838940"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025017">mheap_</a></span><span class="op" id="1838946">.</span><span class="ident" id="1838947">lock</span><span class="op" id="1838951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838955"><a href="/runtime/stubs.go.html#1974542">purgecachedstats</a></span><span class="op" id="1838971">(</span><span class="ident" id="1838972"><a href="/runtime/malloc.go.html#1838807">c</a></span><span class="op" id="1838973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1838977"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1838983">(</span><span class="op" id="1838984">&amp;</span><span class="ident" id="1838985"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025017">mheap_</a></span><span class="op" id="1838991">.</span><span class="ident" id="1838992">lock</span><span class="op" id="1838996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1838999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1839003">//&nbsp;find&nbsp;span</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839017">arena_start</span>&nbsp;<span class="op" id="1839029">:=</span>&nbsp;<span class="builtintype" id="1839032">uintptr</span><span class="op" id="1839039">(</span><span class="ident" id="1839040"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1839046">.</span><span class="ident" id="1839047">Pointer</span><span class="op" id="1839054">(</span><span class="ident" id="1839055"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025017">mheap_</a></span><span class="op" id="1839061">.</span><span class="ident" id="1839062">arena_start</span><span class="op" id="1839073">)</span><span class="op" id="1839074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839077">arena_used</span>&nbsp;<span class="op" id="1839088">:=</span>&nbsp;<span class="builtintype" id="1839091">uintptr</span><span class="op" id="1839098">(</span><span class="ident" id="1839099"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1839105">.</span><span class="ident" id="1839106">Pointer</span><span class="op" id="1839113">(</span><span class="ident" id="1839114"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025017">mheap_</a></span><span class="op" id="1839120">.</span><span class="ident" id="1839121">arena_used</span><span class="op" id="1839131">)</span><span class="op" id="1839132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839135">if</span>&nbsp;<span class="builtintype" id="1839138">uintptr</span><span class="op" id="1839145">(</span><span class="ident" id="1839146"><a href="/runtime/malloc.go.html#1838746">v</a></span><span class="op" id="1839147">)</span>&nbsp;<span class="op" id="1839149">&lt;</span>&nbsp;<span class="ident" id="1839151"><a href="/runtime/malloc.go.html#1839017">arena_start</a></span>&nbsp;<span class="op" id="1839163">||</span>&nbsp;<span class="builtintype" id="1839166">uintptr</span><span class="op" id="1839173">(</span><span class="ident" id="1839174"><a href="/runtime/malloc.go.html#1838746">v</a></span><span class="op" id="1839175">)</span>&nbsp;<span class="op" id="1839177">&gt;=</span>&nbsp;<span class="ident" id="1839180"><a href="/runtime/malloc.go.html#1839077">arena_used</a></span>&nbsp;<span class="op" id="1839191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839195">return</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1839203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839206">p</span>&nbsp;<span class="op" id="1839208">:=</span>&nbsp;<span class="builtintype" id="1839211">uintptr</span><span class="op" id="1839218">(</span><span class="ident" id="1839219"><a href="/runtime/malloc.go.html#1838746">v</a></span><span class="op" id="1839220">)</span>&nbsp;<span class="op" id="1839222">&gt;&gt;</span>&nbsp;<span class="ident" id="1839225"><a href="/runtime/malloc.go.html#1818966">pageShift</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839236">q</span>&nbsp;<span class="op" id="1839238">:=</span>&nbsp;<span class="ident" id="1839241"><a href="/runtime/malloc.go.html#1839206">p</a></span>&nbsp;<span class="op" id="1839243">-</span>&nbsp;<span class="ident" id="1839245"><a href="/runtime/malloc.go.html#1839017">arena_start</a></span><span class="op" id="1839256">&gt;&gt;</span><span class="ident" id="1839258"><a href="/runtime/malloc.go.html#1818966">pageShift</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839269"><a href="/runtime/malloc.go.html#1838765">s</a></span>&nbsp;<span class="op" id="1839271">=</span>&nbsp;<span class="op" id="1839273">*</span><span class="op" id="1839274">(</span><span class="op" id="1839275">*</span><span class="op" id="1839276">*</span><span class="ident" id="1839277"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2024017">mspan</a></span><span class="op" id="1839282">)</span><span class="op" id="1839283">(</span><span class="ident" id="1839284"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1839287">(</span><span class="ident" id="1839288"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1839294">.</span><span class="ident" id="1839295">Pointer</span><span class="op" id="1839302">(</span><span class="ident" id="1839303"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025017">mheap_</a></span><span class="op" id="1839309">.</span><span class="ident" id="1839310">spans</span><span class="op" id="1839315">)</span><span class="op" id="1839316">,</span>&nbsp;<span class="ident" id="1839318"><a href="/runtime/malloc.go.html#1839236">q</a></span><span class="op" id="1839319">*</span><span class="ident" id="1839320"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span><span class="op" id="1839327">)</span><span class="op" id="1839328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839331">if</span>&nbsp;<span class="ident" id="1839334"><a href="/runtime/malloc.go.html#1838765">s</a></span>&nbsp;<span class="op" id="1839336">==</span>&nbsp;<span class="ident" id="1839339">nil</span>&nbsp;<span class="op" id="1839343">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839347">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1839355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839358"><a href="/runtime/malloc.go.html#1838775">x</a></span>&nbsp;<span class="op" id="1839360">=</span>&nbsp;<span class="ident" id="1839362"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1839368">.</span><span class="ident" id="1839369">Pointer</span><span class="op" id="1839376">(</span><span class="builtintype" id="1839377">uintptr</span><span class="op" id="1839384">(</span><span class="ident" id="1839385"><a href="/runtime/malloc.go.html#1838765">s</a></span><span class="op" id="1839386">.</span><span class="ident" id="1839387">start</span><span class="op" id="1839392">)</span>&nbsp;<span class="op" id="1839394">&lt;&lt;</span>&nbsp;<span class="ident" id="1839397"><a href="/runtime/malloc.go.html#1818966">pageShift</a></span><span class="op" id="1839406">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839410">if</span>&nbsp;<span class="builtintype" id="1839413">uintptr</span><span class="op" id="1839420">(</span><span class="ident" id="1839421"><a href="/runtime/malloc.go.html#1838746">v</a></span><span class="op" id="1839422">)</span>&nbsp;<span class="op" id="1839424">&lt;</span>&nbsp;<span class="builtintype" id="1839426">uintptr</span><span class="op" id="1839433">(</span><span class="ident" id="1839434"><a href="/runtime/malloc.go.html#1838775">x</a></span><span class="op" id="1839435">)</span>&nbsp;<span class="op" id="1839437">||</span>&nbsp;<span class="builtintype" id="1839440">uintptr</span><span class="op" id="1839447">(</span><span class="ident" id="1839448"><a href="/runtime/malloc.go.html#1838746">v</a></span><span class="op" id="1839449">)</span>&nbsp;<span class="op" id="1839451">&gt;=</span>&nbsp;<span class="builtintype" id="1839454">uintptr</span><span class="op" id="1839461">(</span><span class="ident" id="1839462"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1839468">.</span><span class="ident" id="1839469">Pointer</span><span class="op" id="1839476">(</span><span class="ident" id="1839477"><a href="/runtime/malloc.go.html#1838765">s</a></span><span class="op" id="1839478">.</span><span class="ident" id="1839479">limit</span><span class="op" id="1839484">)</span><span class="op" id="1839485">)</span>&nbsp;<span class="op" id="1839487">||</span>&nbsp;<span class="ident" id="1839490"><a href="/runtime/malloc.go.html#1838765">s</a></span><span class="op" id="1839491">.</span><span class="ident" id="1839492">state</span>&nbsp;<span class="op" id="1839498">!=</span>&nbsp;<span class="ident" id="1839501"><a href="/runtime/malloc.go.html#1819229">mSpanInUse</a></span>&nbsp;<span class="op" id="1839512">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839516"><a href="/runtime/malloc.go.html#1838765">s</a></span>&nbsp;<span class="op" id="1839518">=</span>&nbsp;<span class="ident" id="1839520">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839526"><a href="/runtime/malloc.go.html#1838775">x</a></span>&nbsp;<span class="op" id="1839528">=</span>&nbsp;<span class="ident" id="1839530">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839536">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1839544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839548"><a href="/runtime/malloc.go.html#1838793">n</a></span>&nbsp;<span class="op" id="1839550">=</span>&nbsp;<span class="builtintype" id="1839552">uintptr</span><span class="op" id="1839559">(</span><span class="ident" id="1839560"><a href="/runtime/malloc.go.html#1838765">s</a></span><span class="op" id="1839561">.</span><span class="ident" id="1839562">elemsize</span><span class="op" id="1839570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839573">if</span>&nbsp;<span class="ident" id="1839576"><a href="/runtime/malloc.go.html#1838765">s</a></span><span class="op" id="1839577">.</span><span class="ident" id="1839578">sizeclass</span>&nbsp;<span class="op" id="1839588">!=</span>&nbsp;<span class="num" id="1839591">0</span>&nbsp;<span class="op" id="1839593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839597"><a href="/runtime/malloc.go.html#1838775">x</a></span>&nbsp;<span class="op" id="1839599">=</span>&nbsp;<span class="ident" id="1839601"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1839604">(</span><span class="ident" id="1839605"><a href="/runtime/malloc.go.html#1838775">x</a></span><span class="op" id="1839606">,</span>&nbsp;<span class="op" id="1839608">(</span><span class="builtintype" id="1839609">uintptr</span><span class="op" id="1839616">(</span><span class="ident" id="1839617"><a href="/runtime/malloc.go.html#1838746">v</a></span><span class="op" id="1839618">)</span><span class="op" id="1839619">-</span><span class="builtintype" id="1839620">uintptr</span><span class="op" id="1839627">(</span><span class="ident" id="1839628"><a href="/runtime/malloc.go.html#1838775">x</a></span><span class="op" id="1839629">)</span><span class="op" id="1839630">)</span><span class="op" id="1839631">/</span><span class="ident" id="1839632"><a href="/runtime/malloc.go.html#1838793">n</a></span><span class="op" id="1839633">*</span><span class="ident" id="1839634"><a href="/runtime/malloc.go.html#1838793">n</a></span><span class="op" id="1839635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1839638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839641">return</span><br>
<span class="lineno">700</span><span class="op" id="1839648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1839651">var</span>&nbsp;<span class="ident" id="1839655">fingCreate</span>&nbsp;<span class="builtintype" id="1839666">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1839674">func</span>&nbsp;<span class="ident" id="1839679">createfing</span><span class="op" id="1839689">(</span><span class="op" id="1839690">)</span>&nbsp;<span class="op" id="1839692">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1839695">//&nbsp;start&nbsp;the&nbsp;finalizer&nbsp;goroutine&nbsp;exactly&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839742">if</span>&nbsp;<span class="ident" id="1839745"><a href="/runtime/malloc.go.html#1839655">fingCreate</a></span>&nbsp;<span class="op" id="1839756">==</span>&nbsp;<span class="num" id="1839759">0</span>&nbsp;<span class="op" id="1839761">&amp;&amp;</span>&nbsp;<span class="ident" id="1839764"><a href="/runtime/stubs.go.html#1974711">cas</a></span><span class="op" id="1839767">(</span><span class="op" id="1839768">&amp;</span><span class="ident" id="1839769"><a href="/runtime/malloc.go.html#1839655">fingCreate</a></span><span class="op" id="1839779">,</span>&nbsp;<span class="num" id="1839781">0</span><span class="op" id="1839782">,</span>&nbsp;<span class="num" id="1839784">1</span><span class="op" id="1839785">)</span>&nbsp;<span class="op" id="1839787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839791">go</span>&nbsp;<span class="ident" id="1839794"><a href="/runtime/malloc.go.html#1839872">runfinq</a></span><span class="op" id="1839801">(</span><span class="op" id="1839802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1839805">}</span><br>
<span class="lineno"></span><span class="op" id="1839807">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="1839810">//&nbsp;This&nbsp;is&nbsp;the&nbsp;goroutine&nbsp;that&nbsp;runs&nbsp;all&nbsp;of&nbsp;the&nbsp;finalizers</span><br>
<span class="lineno"></span><span class="keyword" id="1839867">func</span>&nbsp;<span class="ident" id="1839872">runfinq</span><span class="op" id="1839879">(</span><span class="op" id="1839880">)</span>&nbsp;<span class="op" id="1839882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839885">var</span>&nbsp;<span class="op" id="1839889">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839893">frame</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1839902"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1839908">.</span><span class="ident" id="1839909">Pointer</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839919">framecap</span>&nbsp;<span class="builtintype" id="1839928">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1839937">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839941">for</span>&nbsp;<span class="op" id="1839945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839949"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1839953">(</span><span class="op" id="1839954">&amp;</span><span class="ident" id="1839955"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025299">finlock</a></span><span class="op" id="1839962">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839966">fb</span>&nbsp;<span class="op" id="1839969">:=</span>&nbsp;<span class="ident" id="1839972"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025365">finq</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1839979"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025365">finq</a></span>&nbsp;<span class="op" id="1839984">=</span>&nbsp;<span class="ident" id="1839986">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1839992">if</span>&nbsp;<span class="ident" id="1839995"><a href="/runtime/malloc.go.html#1839966">fb</a></span>&nbsp;<span class="op" id="1839998">==</span>&nbsp;<span class="ident" id="1840001">nil</span>&nbsp;<span class="op" id="1840005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840010">gp</span>&nbsp;<span class="op" id="1840013">:=</span>&nbsp;<span class="ident" id="1840016"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1840020">(</span><span class="op" id="1840021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840026"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025317">fing</a></span>&nbsp;<span class="op" id="1840031">=</span>&nbsp;<span class="ident" id="1840033"><a href="/runtime/malloc.go.html#1840010">gp</a></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840039"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025329">fingwait</a></span>&nbsp;<span class="op" id="1840048">=</span>&nbsp;<span class="ident" id="1840050">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840058"><a href="/runtime/malloc.go.html#1840010">gp</a></span><span class="op" id="1840060">.</span><span class="ident" id="1840061">issystem</span>&nbsp;<span class="op" id="1840070">=</span>&nbsp;<span class="ident" id="1840072">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840080"><a href="/runtime/proc.go.html#1903766">goparkunlock</a></span><span class="op" id="1840092">(</span><span class="op" id="1840093">&amp;</span><span class="ident" id="1840094"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025299">finlock</a></span><span class="op" id="1840101">,</span>&nbsp;<span class="string" id="1840103">&#34;finalizer&nbsp;wait&#34;</span><span class="op" id="1840119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840124"><a href="/runtime/malloc.go.html#1840010">gp</a></span><span class="op" id="1840126">.</span><span class="ident" id="1840127">issystem</span>&nbsp;<span class="op" id="1840136">=</span>&nbsp;<span class="ident" id="1840138">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1840147">continue</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1840158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840162"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1840168">(</span><span class="op" id="1840169">&amp;</span><span class="ident" id="1840170"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025299">finlock</a></span><span class="op" id="1840177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1840181">if</span>&nbsp;<span class="ident" id="1840184"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1840196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840201"><a href="/runtime/race0.go.html#1908023">racefingo</a></span><span class="op" id="1840210">(</span><span class="op" id="1840211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1840215">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1840219">for</span>&nbsp;<span class="ident" id="1840223"><a href="/runtime/malloc.go.html#1839966">fb</a></span>&nbsp;<span class="op" id="1840226">!=</span>&nbsp;<span class="ident" id="1840229">nil</span>&nbsp;<span class="op" id="1840233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1840238">for</span>&nbsp;<span class="ident" id="1840242">i</span>&nbsp;<span class="op" id="1840244">:=</span>&nbsp;<span class="builtintype" id="1840247">int32</span><span class="op" id="1840252">(</span><span class="num" id="1840253">0</span><span class="op" id="1840254">)</span><span class="op" id="1840255">;</span>&nbsp;<span class="ident" id="1840257"><a href="/runtime/malloc.go.html#1840242">i</a></span>&nbsp;<span class="op" id="1840259">&lt;</span>&nbsp;<span class="ident" id="1840261"><a href="/runtime/malloc.go.html#1839966">fb</a></span><span class="op" id="1840263">.</span><span class="ident" id="1840264">cnt</span><span class="op" id="1840267">;</span>&nbsp;<span class="ident" id="1840269"><a href="/runtime/malloc.go.html#1840242">i</a></span><span class="op" id="1840270">++</span>&nbsp;<span class="op" id="1840273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840279">f</span>&nbsp;<span class="op" id="1840281">:=</span>&nbsp;<span class="op" id="1840284">(</span><span class="op" id="1840285">*</span><span class="ident" id="1840286"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025099">finalizer</a></span><span class="op" id="1840295">)</span><span class="op" id="1840296">(</span><span class="ident" id="1840297"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1840300">(</span><span class="ident" id="1840301"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1840307">.</span><span class="ident" id="1840308">Pointer</span><span class="op" id="1840315">(</span><span class="op" id="1840316">&amp;</span><span class="ident" id="1840317"><a href="/runtime/malloc.go.html#1839966">fb</a></span><span class="op" id="1840319">.</span><span class="ident" id="1840320">fin</span><span class="op" id="1840323">)</span><span class="op" id="1840324">,</span>&nbsp;<span class="builtintype" id="1840326">uintptr</span><span class="op" id="1840333">(</span><span class="ident" id="1840334"><a href="/runtime/malloc.go.html#1840242">i</a></span><span class="op" id="1840335">)</span><span class="op" id="1840336">*</span><span class="ident" id="1840337"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1840343">.</span><span class="ident" id="1840344">Sizeof</span><span class="op" id="1840350">(</span><span class="ident" id="1840351"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025099">finalizer</a></span><span class="op" id="1840360">{</span><span class="op" id="1840361">}</span><span class="op" id="1840362">)</span><span class="op" id="1840363">)</span><span class="op" id="1840364">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840371">framesz</span>&nbsp;<span class="op" id="1840379">:=</span>&nbsp;<span class="ident" id="1840382"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1840388">.</span><span class="ident" id="1840389">Sizeof</span><span class="op" id="1840395">(</span><span class="op" id="1840396">(</span><span class="keyword" id="1840397">interface</span><span class="op" id="1840406">{</span><span class="op" id="1840407">}</span><span class="op" id="1840408">)</span><span class="op" id="1840409">(</span><span class="ident" id="1840410">nil</span><span class="op" id="1840413">)</span><span class="op" id="1840414">)</span>&nbsp;<span class="op" id="1840416">+</span>&nbsp;<span class="builtintype" id="1840418">uintptr</span><span class="op" id="1840425">(</span><span class="ident" id="1840426"><a href="/runtime/malloc.go.html#1840279">f</a></span><span class="op" id="1840427">.</span><span class="ident" id="1840428">nret</span><span class="op" id="1840432">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1840438">if</span>&nbsp;<span class="ident" id="1840441"><a href="/runtime/malloc.go.html#1839919">framecap</a></span>&nbsp;<span class="op" id="1840450">&lt;</span>&nbsp;<span class="ident" id="1840452"><a href="/runtime/malloc.go.html#1840371">framesz</a></span>&nbsp;<span class="op" id="1840460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1840467">//&nbsp;The&nbsp;frame&nbsp;does&nbsp;not&nbsp;contain&nbsp;pointers&nbsp;interesting&nbsp;for&nbsp;GC,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1840531">//&nbsp;all&nbsp;not&nbsp;yet&nbsp;finalized&nbsp;objects&nbsp;are&nbsp;stored&nbsp;in&nbsp;finq.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1840589">//&nbsp;If&nbsp;we&nbsp;do&nbsp;not&nbsp;mark&nbsp;it&nbsp;as&nbsp;FlagNoScan,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1840633">//&nbsp;the&nbsp;last&nbsp;finalized&nbsp;object&nbsp;is&nbsp;not&nbsp;collected.</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840685"><a href="/runtime/malloc.go.html#1839893">frame</a></span>&nbsp;<span class="op" id="1840691">=</span>&nbsp;<span class="ident" id="1840693"><a href="/runtime/malloc.go.html#1819594">mallocgc</a></span><span class="op" id="1840701">(</span><span class="ident" id="1840702"><a href="/runtime/malloc.go.html#1840371">framesz</a></span><span class="op" id="1840709">,</span>&nbsp;<span class="ident" id="1840711">nil</span><span class="op" id="1840714">,</span>&nbsp;<span class="ident" id="1840716"><a href="/runtime/malloc.go.html#1818822">flagNoScan</a></span><span class="op" id="1840726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840733"><a href="/runtime/malloc.go.html#1839919">framecap</a></span>&nbsp;<span class="op" id="1840742">=</span>&nbsp;<span class="ident" id="1840744"><a href="/runtime/malloc.go.html#1840371">framesz</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1840756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1840763">if</span>&nbsp;<span class="ident" id="1840766"><a href="/runtime/malloc.go.html#1840279">f</a></span><span class="op" id="1840767">.</span><span class="ident" id="1840768">fint</span>&nbsp;<span class="op" id="1840773">==</span>&nbsp;<span class="ident" id="1840776">nil</span>&nbsp;<span class="op" id="1840780">{</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840787"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1840794">(</span><span class="string" id="1840795">&#34;missing&nbsp;type&nbsp;in&nbsp;runfinq&#34;</span><span class="op" id="1840820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1840826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1840832">switch</span>&nbsp;<span class="ident" id="1840839"><a href="/runtime/malloc.go.html#1840279">f</a></span><span class="op" id="1840840">.</span><span class="ident" id="1840841">fint</span><span class="op" id="1840845">.</span><span class="ident" id="1840846">kind</span>&nbsp;<span class="op" id="1840851">&amp;</span>&nbsp;<span class="ident" id="1840853"><a href="/runtime/typekind.go.html#2015249">kindMask</a></span>&nbsp;<span class="op" id="1840862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1840868">case</span>&nbsp;<span class="ident" id="1840873"><a href="/runtime/typekind.go.html#2014978">kindPtr</a></span><span class="op" id="1840880">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1840887">//&nbsp;direct&nbsp;use&nbsp;of&nbsp;pointer</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1840917">*</span><span class="op" id="1840918">(</span><span class="op" id="1840919">*</span><span class="ident" id="1840920"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1840926">.</span><span class="ident" id="1840927">Pointer</span><span class="op" id="1840934">)</span><span class="op" id="1840935">(</span><span class="ident" id="1840936"><a href="/runtime/malloc.go.html#1839893">frame</a></span><span class="op" id="1840941">)</span>&nbsp;<span class="op" id="1840943">=</span>&nbsp;<span class="ident" id="1840945"><a href="/runtime/malloc.go.html#1840279">f</a></span><span class="op" id="1840946">.</span><span class="ident" id="1840947">arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1840955">case</span>&nbsp;<span class="ident" id="1840960"><a href="/runtime/typekind.go.html#2014912">kindInterface</a></span><span class="op" id="1840973">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840980">ityp</span>&nbsp;<span class="op" id="1840985">:=</span>&nbsp;<span class="op" id="1840988">(</span><span class="op" id="1840989">*</span><span class="ident" id="1840990"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026052">interfacetype</a></span><span class="op" id="1841003">)</span><span class="op" id="1841004">(</span><span class="ident" id="1841005"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1841011">.</span><span class="ident" id="1841012">Pointer</span><span class="op" id="1841019">(</span><span class="ident" id="1841020"><a href="/runtime/malloc.go.html#1840279">f</a></span><span class="op" id="1841021">.</span><span class="ident" id="1841022">fint</span><span class="op" id="1841026">)</span><span class="op" id="1841027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1841034">//&nbsp;set&nbsp;up&nbsp;with&nbsp;empty&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1841070">(</span><span class="op" id="1841071">*</span><span class="ident" id="1841072"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016390">eface</a></span><span class="op" id="1841077">)</span><span class="op" id="1841078">(</span><span class="ident" id="1841079"><a href="/runtime/malloc.go.html#1839893">frame</a></span><span class="op" id="1841084">)</span><span class="op" id="1841085">.</span><span class="ident" id="1841086">_type</span>&nbsp;<span class="op" id="1841092">=</span>&nbsp;<span class="op" id="1841094">&amp;</span><span class="ident" id="1841095"><a href="/runtime/malloc.go.html#1840279">f</a></span><span class="op" id="1841096">.</span><span class="ident" id="1841097">ot</span><span class="op" id="1841099">.</span><span class="ident" id="1841100">typ</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1841109">(</span><span class="op" id="1841110">*</span><span class="ident" id="1841111"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016390">eface</a></span><span class="op" id="1841116">)</span><span class="op" id="1841117">(</span><span class="ident" id="1841118"><a href="/runtime/malloc.go.html#1839893">frame</a></span><span class="op" id="1841123">)</span><span class="op" id="1841124">.</span><span class="ident" id="1841125">data</span>&nbsp;<span class="op" id="1841130">=</span>&nbsp;<span class="ident" id="1841132"><a href="/runtime/malloc.go.html#1840279">f</a></span><span class="op" id="1841133">.</span><span class="ident" id="1841134">arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1841143">if</span>&nbsp;<span class="builtinfunc" id="1841146">len</span><span class="op" id="1841149">(</span><span class="ident" id="1841150"><a href="/runtime/malloc.go.html#1840980">ityp</a></span><span class="op" id="1841154">.</span><span class="ident" id="1841155">mhdr</span><span class="op" id="1841159">)</span>&nbsp;<span class="op" id="1841161">!=</span>&nbsp;<span class="num" id="1841164">0</span>&nbsp;<span class="op" id="1841166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1841174">//&nbsp;convert&nbsp;to&nbsp;interface&nbsp;with&nbsp;methods</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1841217">//&nbsp;this&nbsp;conversion&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;succeed&nbsp;-&nbsp;we&nbsp;checked&nbsp;in&nbsp;SetFinalizer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1841296">*</span><span class="op" id="1841297">(</span><span class="op" id="1841298">*</span><span class="ident" id="1841299"><a href="/runtime/iface.go.html#1804262">fInterface</a></span><span class="op" id="1841309">)</span><span class="op" id="1841310">(</span><span class="ident" id="1841311"><a href="/runtime/malloc.go.html#1839893">frame</a></span><span class="op" id="1841316">)</span>&nbsp;<span class="op" id="1841318">=</span>&nbsp;<span class="ident" id="1841320"><a href="/runtime/iface.go.html#1812334">assertE2I</a></span><span class="op" id="1841329">(</span><span class="ident" id="1841330"><a href="/runtime/malloc.go.html#1840980">ityp</a></span><span class="op" id="1841334">,</span>&nbsp;<span class="op" id="1841336">*</span><span class="op" id="1841337">(</span><span class="op" id="1841338">*</span><span class="keyword" id="1841339">interface</span><span class="op" id="1841348">{</span><span class="op" id="1841349">}</span><span class="op" id="1841350">)</span><span class="op" id="1841351">(</span><span class="ident" id="1841352"><a href="/runtime/malloc.go.html#1839893">frame</a></span><span class="op" id="1841357">)</span><span class="op" id="1841358">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1841365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1841371">default</span><span class="op" id="1841378">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841385"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1841392">(</span><span class="string" id="1841393">&#34;bad&nbsp;kind&nbsp;in&nbsp;runfinq&#34;</span><span class="op" id="1841414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1841420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841426"><a href="/runtime/stubs.go.html#1974328">reflectcall</a></span><span class="op" id="1841437">(</span><span class="ident" id="1841438"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1841444">.</span><span class="ident" id="1841445">Pointer</span><span class="op" id="1841452">(</span><span class="ident" id="1841453"><a href="/runtime/malloc.go.html#1840279">f</a></span><span class="op" id="1841454">.</span><span class="ident" id="1841455">fn</span><span class="op" id="1841457">)</span><span class="op" id="1841458">,</span>&nbsp;<span class="ident" id="1841460"><a href="/runtime/malloc.go.html#1839893">frame</a></span><span class="op" id="1841465">,</span>&nbsp;<span class="builtintype" id="1841467">uint32</span><span class="op" id="1841473">(</span><span class="ident" id="1841474"><a href="/runtime/malloc.go.html#1840371">framesz</a></span><span class="op" id="1841481">)</span><span class="op" id="1841482">,</span>&nbsp;<span class="builtintype" id="1841484">uint32</span><span class="op" id="1841490">(</span><span class="ident" id="1841491"><a href="/runtime/malloc.go.html#1840371">framesz</a></span><span class="op" id="1841498">)</span><span class="op" id="1841499">)</span><br>
<span class="lineno">770</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1841506">//&nbsp;drop&nbsp;finalizer&nbsp;queue&nbsp;references&nbsp;to&nbsp;finalized&nbsp;object</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841565"><a href="/runtime/malloc.go.html#1840279">f</a></span><span class="op" id="1841566">.</span><span class="ident" id="1841567">fn</span>&nbsp;<span class="op" id="1841570">=</span>&nbsp;<span class="ident" id="1841572">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841580"><a href="/runtime/malloc.go.html#1840279">f</a></span><span class="op" id="1841581">.</span><span class="ident" id="1841582">arg</span>&nbsp;<span class="op" id="1841586">=</span>&nbsp;<span class="ident" id="1841588">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841596"><a href="/runtime/malloc.go.html#1840279">f</a></span><span class="op" id="1841597">.</span><span class="ident" id="1841598">ot</span>&nbsp;<span class="op" id="1841601">=</span>&nbsp;<span class="ident" id="1841603">nil</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1841610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841615"><a href="/runtime/malloc.go.html#1839966">fb</a></span><span class="op" id="1841617">.</span><span class="ident" id="1841618">cnt</span>&nbsp;<span class="op" id="1841622">=</span>&nbsp;<span class="num" id="1841624">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841629">next</span>&nbsp;<span class="op" id="1841634">:=</span>&nbsp;<span class="ident" id="1841637"><a href="/runtime/malloc.go.html#1839966">fb</a></span><span class="op" id="1841639">.</span><span class="ident" id="1841640">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841648"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1841652">(</span><span class="op" id="1841653">&amp;</span><span class="ident" id="1841654"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025299">finlock</a></span><span class="op" id="1841661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841666"><a href="/runtime/malloc.go.html#1839966">fb</a></span><span class="op" id="1841668">.</span><span class="ident" id="1841669">next</span>&nbsp;<span class="op" id="1841674">=</span>&nbsp;<span class="ident" id="1841676"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025384">finc</a></span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841684"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025384">finc</a></span>&nbsp;<span class="op" id="1841689">=</span>&nbsp;<span class="ident" id="1841691"><a href="/runtime/malloc.go.html#1839966">fb</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841697"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1841703">(</span><span class="op" id="1841704">&amp;</span><span class="ident" id="1841705"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2025299">finlock</a></span><span class="op" id="1841712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841717"><a href="/runtime/malloc.go.html#1839966">fb</a></span>&nbsp;<span class="op" id="1841720">=</span>&nbsp;<span class="ident" id="1841722"><a href="/runtime/malloc.go.html#1841629">next</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1841729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1841732">}</span><br>
<span class="lineno">785</span><span class="op" id="1841734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1841737">var</span>&nbsp;<span class="ident" id="1841741">persistent</span>&nbsp;<span class="keyword" id="1841752">struct</span>&nbsp;<span class="op" id="1841759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841762">lock</span>&nbsp;<span class="ident" id="1841767"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016175">mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841774">pos</span>&nbsp;&nbsp;<span class="ident" id="1841779"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1841785">.</span><span class="ident" id="1841786">Pointer</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841795">end</span>&nbsp;&nbsp;<span class="ident" id="1841800"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1841806">.</span><span class="ident" id="1841807">Pointer</span><br>
<span class="lineno"></span><span class="op" id="1841815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1841818">//&nbsp;Wrapper&nbsp;around&nbsp;sysAlloc&nbsp;that&nbsp;can&nbsp;allocate&nbsp;small&nbsp;chunks.</span><br>
<span class="lineno"></span><span class="comment" id="1841877">//&nbsp;There&nbsp;is&nbsp;no&nbsp;associated&nbsp;free&nbsp;operation.</span><br>
<span class="lineno">795</span><span class="comment" id="1841919">//&nbsp;Intended&nbsp;for&nbsp;things&nbsp;like&nbsp;function/type/debug-related&nbsp;persistent&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="1841992">//&nbsp;If&nbsp;align&nbsp;is&nbsp;0,&nbsp;uses&nbsp;default&nbsp;align&nbsp;(currently&nbsp;8).</span><br>
<span class="lineno"></span><span class="keyword" id="1842044">func</span>&nbsp;<span class="ident" id="1842049">persistentalloc</span><span class="op" id="1842064">(</span><span class="ident" id="1842065">size</span><span class="op" id="1842069">,</span>&nbsp;<span class="ident" id="1842071">align</span>&nbsp;<span class="builtintype" id="1842077">uintptr</span><span class="op" id="1842084">,</span>&nbsp;<span class="ident" id="1842086">stat</span>&nbsp;<span class="op" id="1842091">*</span><span class="ident" id="1842092">uint64</span><span class="op" id="1842098">)</span>&nbsp;<span class="ident" id="1842100"><a href="/runtime/malloc.go.html#1818779">unsafe</a></span><span class="op" id="1842106">.</span><span class="ident" id="1842107">Pointer</span>&nbsp;<span class="op" id="1842115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842118">const</span>&nbsp;<span class="op" id="1842124">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842128">chunk</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1842137">=</span>&nbsp;<span class="num" id="1842139">256</span>&nbsp;<span class="op" id="1842143">&lt;&lt;</span>&nbsp;<span class="num" id="1842146">10</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842151">maxBlock</span>&nbsp;<span class="op" id="1842160">=</span>&nbsp;<span class="num" id="1842162">64</span>&nbsp;<span class="op" id="1842165">&lt;&lt;</span>&nbsp;<span class="num" id="1842168">10</span>&nbsp;<span class="comment" id="1842171">//&nbsp;VM&nbsp;reservation&nbsp;granularity&nbsp;is&nbsp;64K&nbsp;on&nbsp;windows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1842220">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842224">if</span>&nbsp;<span class="ident" id="1842227"><a href="/runtime/malloc.go.html#1842071">align</a></span>&nbsp;<span class="op" id="1842233">!=</span>&nbsp;<span class="num" id="1842236">0</span>&nbsp;<span class="op" id="1842238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842242">if</span>&nbsp;<span class="ident" id="1842245"><a href="/runtime/malloc.go.html#1842071">align</a></span><span class="op" id="1842250">&amp;</span><span class="op" id="1842251">(</span><span class="ident" id="1842252"><a href="/runtime/malloc.go.html#1842071">align</a></span><span class="op" id="1842257">-</span><span class="num" id="1842258">1</span><span class="op" id="1842259">)</span>&nbsp;<span class="op" id="1842261">!=</span>&nbsp;<span class="num" id="1842264">0</span>&nbsp;<span class="op" id="1842266">{</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842271"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1842278">(</span><span class="string" id="1842279">&#34;persistentalloc:&nbsp;align&nbsp;is&nbsp;not&nbsp;a&nbsp;power&nbsp;of&nbsp;2&#34;</span><span class="op" id="1842323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1842327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842331">if</span>&nbsp;<span class="ident" id="1842334"><a href="/runtime/malloc.go.html#1842071">align</a></span>&nbsp;<span class="op" id="1842340">&gt;</span>&nbsp;<span class="ident" id="1842342"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021848">_PageSize</a></span>&nbsp;<span class="op" id="1842352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842357"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1842364">(</span><span class="string" id="1842365">&#34;persistentalloc:&nbsp;align&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="1842402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1842406">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1842409">}</span>&nbsp;<span class="keyword" id="1842411">else</span>&nbsp;<span class="op" id="1842416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842420"><a href="/runtime/malloc.go.html#1842071">align</a></span>&nbsp;<span class="op" id="1842426">=</span>&nbsp;<span class="num" id="1842428">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1842431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842435">if</span>&nbsp;<span class="ident" id="1842438"><a href="/runtime/malloc.go.html#1842065">size</a></span>&nbsp;<span class="op" id="1842443">&gt;=</span>&nbsp;<span class="ident" id="1842446"><a href="/runtime/malloc.go.html#1842151">maxBlock</a></span>&nbsp;<span class="op" id="1842455">{</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842459">return</span>&nbsp;<span class="ident" id="1842466"><a href="/runtime/mprof.go.html#1854275">sysAlloc</a></span><span class="op" id="1842474">(</span><span class="ident" id="1842475"><a href="/runtime/malloc.go.html#1842065">size</a></span><span class="op" id="1842479">,</span>&nbsp;<span class="ident" id="1842481"><a href="/runtime/malloc.go.html#1842086">stat</a></span><span class="op" id="1842485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1842488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842492"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1842496">(</span><span class="op" id="1842497">&amp;</span><span class="ident" id="1842498"><a href="/runtime/malloc.go.html#1841741">persistent</a></span><span class="op" id="1842508">.</span><span class="ident" id="1842509">lock</span><span class="op" id="1842513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842516"><a href="/runtime/malloc.go.html#1841741">persistent</a></span><span class="op" id="1842526">.</span><span class="ident" id="1842527">pos</span>&nbsp;<span class="op" id="1842531">=</span>&nbsp;<span class="ident" id="1842533"><a href="/runtime/stubs.go.html#1968733">roundup</a></span><span class="op" id="1842540">(</span><span class="ident" id="1842541"><a href="/runtime/malloc.go.html#1841741">persistent</a></span><span class="op" id="1842551">.</span><span class="ident" id="1842552">pos</span><span class="op" id="1842555">,</span>&nbsp;<span class="ident" id="1842557"><a href="/runtime/malloc.go.html#1842071">align</a></span><span class="op" id="1842562">)</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842565">if</span>&nbsp;<span class="builtintype" id="1842568">uintptr</span><span class="op" id="1842575">(</span><span class="ident" id="1842576"><a href="/runtime/malloc.go.html#1841741">persistent</a></span><span class="op" id="1842586">.</span><span class="ident" id="1842587">pos</span><span class="op" id="1842590">)</span><span class="op" id="1842591">+</span><span class="ident" id="1842592"><a href="/runtime/malloc.go.html#1842065">size</a></span>&nbsp;<span class="op" id="1842597">&gt;</span>&nbsp;<span class="builtintype" id="1842599">uintptr</span><span class="op" id="1842606">(</span><span class="ident" id="1842607"><a href="/runtime/malloc.go.html#1841741">persistent</a></span><span class="op" id="1842617">.</span><span class="ident" id="1842618">end</span><span class="op" id="1842621">)</span>&nbsp;<span class="op" id="1842623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842627"><a href="/runtime/malloc.go.html#1841741">persistent</a></span><span class="op" id="1842637">.</span><span class="ident" id="1842638">pos</span>&nbsp;<span class="op" id="1842642">=</span>&nbsp;<span class="ident" id="1842644"><a href="/runtime/mprof.go.html#1854275">sysAlloc</a></span><span class="op" id="1842652">(</span><span class="ident" id="1842653"><a href="/runtime/malloc.go.html#1842128">chunk</a></span><span class="op" id="1842658">,</span>&nbsp;<span class="op" id="1842660">&amp;</span><span class="ident" id="1842661"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023037">memstats</a></span><span class="op" id="1842669">.</span><span class="ident" id="1842670">other_sys</span><span class="op" id="1842679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842683">if</span>&nbsp;<span class="ident" id="1842686"><a href="/runtime/malloc.go.html#1841741">persistent</a></span><span class="op" id="1842696">.</span><span class="ident" id="1842697">pos</span>&nbsp;<span class="op" id="1842701">==</span>&nbsp;<span class="ident" id="1842704">nil</span>&nbsp;<span class="op" id="1842708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842713"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1842719">(</span><span class="op" id="1842720">&amp;</span><span class="ident" id="1842721"><a href="/runtime/malloc.go.html#1841741">persistent</a></span><span class="op" id="1842731">.</span><span class="ident" id="1842732">lock</span><span class="op" id="1842736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842741"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1842748">(</span><span class="string" id="1842749">&#34;runtime:&nbsp;cannot&nbsp;allocate&nbsp;memory&#34;</span><span class="op" id="1842782">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1842786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842790"><a href="/runtime/malloc.go.html#1841741">persistent</a></span><span class="op" id="1842800">.</span><span class="ident" id="1842801">end</span>&nbsp;<span class="op" id="1842805">=</span>&nbsp;<span class="ident" id="1842807"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1842810">(</span><span class="ident" id="1842811"><a href="/runtime/malloc.go.html#1841741">persistent</a></span><span class="op" id="1842821">.</span><span class="ident" id="1842822">pos</span><span class="op" id="1842825">,</span>&nbsp;<span class="ident" id="1842827"><a href="/runtime/malloc.go.html#1842128">chunk</a></span><span class="op" id="1842832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1842835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842838">p</span>&nbsp;<span class="op" id="1842840">:=</span>&nbsp;<span class="ident" id="1842843"><a href="/runtime/malloc.go.html#1841741">persistent</a></span><span class="op" id="1842853">.</span><span class="ident" id="1842854">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842859"><a href="/runtime/malloc.go.html#1841741">persistent</a></span><span class="op" id="1842869">.</span><span class="ident" id="1842870">pos</span>&nbsp;<span class="op" id="1842874">=</span>&nbsp;<span class="ident" id="1842876"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1842879">(</span><span class="ident" id="1842880"><a href="/runtime/malloc.go.html#1841741">persistent</a></span><span class="op" id="1842890">.</span><span class="ident" id="1842891">pos</span><span class="op" id="1842894">,</span>&nbsp;<span class="ident" id="1842896"><a href="/runtime/malloc.go.html#1842065">size</a></span><span class="op" id="1842900">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842903"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1842909">(</span><span class="op" id="1842910">&amp;</span><span class="ident" id="1842911"><a href="/runtime/malloc.go.html#1841741">persistent</a></span><span class="op" id="1842921">.</span><span class="ident" id="1842922">lock</span><span class="op" id="1842926">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842930">if</span>&nbsp;<span class="ident" id="1842933"><a href="/runtime/malloc.go.html#1842086">stat</a></span>&nbsp;<span class="op" id="1842938">!=</span>&nbsp;<span class="op" id="1842941">&amp;</span><span class="ident" id="1842942"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023037">memstats</a></span><span class="op" id="1842950">.</span><span class="ident" id="1842951">other_sys</span>&nbsp;<span class="op" id="1842961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842965"><a href="/runtime/atomic.go.html#1710973">xadd64</a></span><span class="op" id="1842971">(</span><span class="ident" id="1842972"><a href="/runtime/malloc.go.html#1842086">stat</a></span><span class="op" id="1842976">,</span>&nbsp;<span class="ident" id="1842978">int64</span><span class="op" id="1842983">(</span><span class="ident" id="1842984"><a href="/runtime/malloc.go.html#1842065">size</a></span><span class="op" id="1842988">)</span><span class="op" id="1842989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842993"><a href="/runtime/atomic.go.html#1710973">xadd64</a></span><span class="op" id="1842999">(</span><span class="op" id="1843000">&amp;</span><span class="ident" id="1843001"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023037">memstats</a></span><span class="op" id="1843009">.</span><span class="ident" id="1843010">other_sys</span><span class="op" id="1843019">,</span>&nbsp;<span class="op" id="1843021">-</span><span class="ident" id="1843022">int64</span><span class="op" id="1843027">(</span><span class="ident" id="1843028"><a href="/runtime/malloc.go.html#1842065">size</a></span><span class="op" id="1843032">)</span><span class="op" id="1843033">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1843036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1843039">return</span>&nbsp;<span class="ident" id="1843046"><a href="/runtime/malloc.go.html#1842838">p</a></span><br>
<span class="lineno"></span><span class="op" id="1843048">}</span>
</div>
</body>
</html>
