<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/link8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/link8/func.go.html">func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/layout.go.html">layout.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/link.go.html">link.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/linker.go.html">linker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/package.go.html">package.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/pkg_sym.go.html">pkg_sym.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/symbol.go.html">symbol.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/trace_used.go.html">trace_used.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/var.go.html">var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="3680645">package</span>&nbsp;<span class="ident" id="3680653">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3680660">type</span>&nbsp;<span class="ident" id="3680665">tracer</span>&nbsp;<span class="keyword" id="3680672">struct</span>&nbsp;<span class="op" id="3680679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680682">lnk</span>&nbsp;&nbsp;<span class="op" id="3680687">*</span><span class="ident" id="3680688">Linker</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680696">hits</span>&nbsp;<span class="op" id="3680701">[</span><span class="op" id="3680702">]</span><span class="op" id="3680703">[</span><span class="op" id="3680704">]</span><span class="builtintype" id="3680705">bool</span><br>
<span class="lineno"></span><span class="op" id="3680710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3680713">func</span>&nbsp;<span class="ident" id="3680718">newTracer</span><span class="op" id="3680727">(</span><span class="ident" id="3680728">lnk</span>&nbsp;<span class="op" id="3680732">*</span><span class="ident" id="3680733">Linker</span><span class="op" id="3680739">)</span>&nbsp;<span class="op" id="3680741">*</span><span class="ident" id="3680742">tracer</span>&nbsp;<span class="op" id="3680749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680752">npkg</span>&nbsp;<span class="op" id="3680757">:=</span>&nbsp;<span class="ident" id="3680760">lnk</span><span class="op" id="3680763">.</span><span class="ident" id="3680764">Npkg</span><span class="op" id="3680768">(</span><span class="op" id="3680769">)</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680772">ret</span>&nbsp;<span class="op" id="3680776">:=</span>&nbsp;<span class="builtinfunc" id="3680779">new</span><span class="op" id="3680782">(</span><span class="ident" id="3680783">tracer</span><span class="op" id="3680789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680792">ret</span><span class="op" id="3680795">.</span><span class="ident" id="3680796">lnk</span>&nbsp;<span class="op" id="3680800">=</span>&nbsp;<span class="ident" id="3680802">lnk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680807">ret</span><span class="op" id="3680810">.</span><span class="ident" id="3680811">hits</span>&nbsp;<span class="op" id="3680816">=</span>&nbsp;<span class="builtinfunc" id="3680818">make</span><span class="op" id="3680822">(</span><span class="op" id="3680823">[</span><span class="op" id="3680824">]</span><span class="op" id="3680825">[</span><span class="op" id="3680826">]</span><span class="builtintype" id="3680827">bool</span><span class="op" id="3680831">,</span>&nbsp;<span class="ident" id="3680833">npkg</span><span class="op" id="3680837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3680840">for</span>&nbsp;<span class="ident" id="3680844">i</span>&nbsp;<span class="op" id="3680846">:=</span>&nbsp;<span class="num" id="3680849">0</span><span class="op" id="3680850">;</span>&nbsp;<span class="ident" id="3680852">i</span>&nbsp;<span class="op" id="3680854">&lt;</span>&nbsp;<span class="ident" id="3680856">npkg</span><span class="op" id="3680860">;</span>&nbsp;<span class="ident" id="3680862">i</span><span class="op" id="3680863">++</span>&nbsp;<span class="op" id="3680866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680870">p</span>&nbsp;<span class="op" id="3680872">:=</span>&nbsp;<span class="ident" id="3680875">lnk</span><span class="op" id="3680878">.</span><span class="ident" id="3680879">Pkg</span><span class="op" id="3680882">(</span><span class="ident" id="3680883">i</span><span class="op" id="3680884">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680888">ret</span><span class="op" id="3680891">.</span><span class="ident" id="3680892">hits</span><span class="op" id="3680896">[</span><span class="ident" id="3680897">i</span><span class="op" id="3680898">]</span>&nbsp;<span class="op" id="3680900">=</span>&nbsp;<span class="builtinfunc" id="3680902">make</span><span class="op" id="3680906">(</span><span class="op" id="3680907">[</span><span class="op" id="3680908">]</span><span class="builtintype" id="3680909">bool</span><span class="op" id="3680913">,</span>&nbsp;<span class="builtinfunc" id="3680915">len</span><span class="op" id="3680918">(</span><span class="ident" id="3680919">p</span><span class="op" id="3680920">.</span><span class="ident" id="3680921">symbols</span><span class="op" id="3680928">)</span><span class="op" id="3680929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3680932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3680936">return</span>&nbsp;<span class="ident" id="3680943">ret</span><br>
<span class="lineno"></span><span class="op" id="3680947">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3680950">func</span>&nbsp;<span class="op" id="3680955">(</span><span class="ident" id="3680956">t</span>&nbsp;<span class="op" id="3680958">*</span><span class="ident" id="3680959">tracer</span><span class="op" id="3680965">)</span>&nbsp;<span class="ident" id="3680967">hit</span><span class="op" id="3680970">(</span><span class="ident" id="3680971">pkg</span>&nbsp;<span class="op" id="3680975">*</span><span class="ident" id="3680976">Package</span><span class="op" id="3680983">,</span>&nbsp;<span class="ident" id="3680985">sym</span>&nbsp;<span class="builtintype" id="3680989">uint32</span><span class="op" id="3680995">)</span>&nbsp;<span class="builtintype" id="3680997">bool</span>&nbsp;<span class="op" id="3681002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681005">i</span>&nbsp;<span class="op" id="3681007">:=</span>&nbsp;<span class="ident" id="3681010">t</span><span class="op" id="3681011">.</span><span class="ident" id="3681012">lnk</span><span class="op" id="3681015">.</span><span class="ident" id="3681016">PkgIndex</span><span class="op" id="3681024">(</span><span class="ident" id="3681025">pkg</span><span class="op" id="3681028">.</span><span class="ident" id="3681029">path</span><span class="op" id="3681033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681036">pt</span>&nbsp;<span class="op" id="3681039">:=</span>&nbsp;<span class="op" id="3681042">&amp;</span><span class="ident" id="3681043">t</span><span class="op" id="3681044">.</span><span class="ident" id="3681045">hits</span><span class="op" id="3681049">[</span><span class="ident" id="3681050">i</span><span class="op" id="3681051">]</span><span class="op" id="3681052">[</span><span class="ident" id="3681053">sym</span><span class="op" id="3681056">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681059">ret</span>&nbsp;<span class="op" id="3681063">:=</span>&nbsp;<span class="op" id="3681066">*</span><span class="ident" id="3681067">pt</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681071">*</span><span class="ident" id="3681072">pt</span>&nbsp;<span class="op" id="3681075">=</span>&nbsp;<span class="builtintype" id="3681077">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681083">return</span>&nbsp;<span class="ident" id="3681090">ret</span><br>
<span class="lineno"></span><span class="op" id="3681094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3681097">func</span>&nbsp;<span class="ident" id="3681102">traceUsed</span><span class="op" id="3681111">(</span><span class="ident" id="3681112">lnk</span>&nbsp;<span class="op" id="3681116">*</span><span class="ident" id="3681117">Linker</span><span class="op" id="3681123">,</span>&nbsp;<span class="ident" id="3681125">p</span>&nbsp;<span class="op" id="3681127">*</span><span class="ident" id="3681128">Package</span><span class="op" id="3681135">,</span>&nbsp;<span class="ident" id="3681137">index</span>&nbsp;<span class="builtintype" id="3681143">uint32</span><span class="op" id="3681149">)</span>&nbsp;<span class="op" id="3681151">[</span><span class="op" id="3681152">]</span><span class="ident" id="3681153">pkgSym</span>&nbsp;<span class="op" id="3681160">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681163">t</span>&nbsp;<span class="op" id="3681165">:=</span>&nbsp;<span class="ident" id="3681168">newTracer</span><span class="op" id="3681177">(</span><span class="ident" id="3681178">lnk</span><span class="op" id="3681181">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681185">cur</span>&nbsp;<span class="op" id="3681189">:=</span>&nbsp;<span class="op" id="3681192">[</span><span class="op" id="3681193">]</span><span class="ident" id="3681194">pkgSym</span><span class="op" id="3681200">{</span><span class="op" id="3681201">{</span><span class="ident" id="3681202">p</span><span class="op" id="3681203">,</span>&nbsp;<span class="ident" id="3681205">index</span><span class="op" id="3681210">}</span><span class="op" id="3681211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681214">var</span>&nbsp;<span class="ident" id="3681218">next</span>&nbsp;<span class="op" id="3681223">[</span><span class="op" id="3681224">]</span><span class="ident" id="3681225">pkgSym</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681233">var</span>&nbsp;<span class="ident" id="3681237">ret</span>&nbsp;<span class="op" id="3681241">[</span><span class="op" id="3681242">]</span><span class="ident" id="3681243">pkgSym</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3681252">//&nbsp;BFS&nbsp;traverse&nbsp;all&nbsp;the&nbsp;symbols&nbsp;used&nbsp;by&nbsp;the&nbsp;symbol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681304">for</span>&nbsp;<span class="builtinfunc" id="3681308">len</span><span class="op" id="3681311">(</span><span class="ident" id="3681312">cur</span><span class="op" id="3681315">)</span>&nbsp;<span class="op" id="3681317">&gt;</span>&nbsp;<span class="num" id="3681319">0</span>&nbsp;<span class="op" id="3681321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681325">for</span>&nbsp;<span class="ident" id="3681329">_</span><span class="op" id="3681330">,</span>&nbsp;<span class="ident" id="3681332">ps</span>&nbsp;<span class="op" id="3681335">:=</span>&nbsp;<span class="keyword" id="3681338">range</span>&nbsp;<span class="ident" id="3681344">cur</span>&nbsp;<span class="op" id="3681348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681353">ret</span>&nbsp;<span class="op" id="3681357">=</span>&nbsp;<span class="builtinfunc" id="3681359">append</span><span class="op" id="3681365">(</span><span class="ident" id="3681366">ret</span><span class="op" id="3681369">,</span>&nbsp;<span class="ident" id="3681371">ps</span><span class="op" id="3681373">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681379">typ</span>&nbsp;<span class="op" id="3681383">:=</span>&nbsp;<span class="ident" id="3681386">ps</span><span class="op" id="3681388">.</span><span class="ident" id="3681389">Type</span><span class="op" id="3681393">(</span><span class="op" id="3681394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681399">if</span>&nbsp;<span class="ident" id="3681402">typ</span>&nbsp;<span class="op" id="3681406">==</span>&nbsp;<span class="ident" id="3681409">SymFunc</span>&nbsp;<span class="op" id="3681417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681423">f</span>&nbsp;<span class="op" id="3681425">:=</span>&nbsp;<span class="ident" id="3681428">ps</span><span class="op" id="3681430">.</span><span class="ident" id="3681431">Func</span><span class="op" id="3681435">(</span><span class="op" id="3681436">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681443">for</span>&nbsp;<span class="ident" id="3681447">_</span><span class="op" id="3681448">,</span>&nbsp;<span class="ident" id="3681450">link</span>&nbsp;<span class="op" id="3681455">:=</span>&nbsp;<span class="keyword" id="3681458">range</span>&nbsp;<span class="ident" id="3681464">f</span><span class="op" id="3681465">.</span><span class="ident" id="3681466">links</span>&nbsp;<span class="op" id="3681472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681479">pkg</span>&nbsp;<span class="op" id="3681483">:=</span>&nbsp;<span class="ident" id="3681486">ps</span><span class="op" id="3681488">.</span><span class="ident" id="3681489">Import</span><span class="op" id="3681495">(</span><span class="ident" id="3681496">link</span><span class="op" id="3681500">.</span><span class="ident" id="3681501">pkg</span><span class="op" id="3681504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681511">if</span>&nbsp;<span class="ident" id="3681514">t</span><span class="op" id="3681515">.</span><span class="ident" id="3681516">hit</span><span class="op" id="3681519">(</span><span class="ident" id="3681520">pkg</span><span class="op" id="3681523">,</span>&nbsp;<span class="ident" id="3681525">link</span><span class="op" id="3681529">.</span><span class="ident" id="3681530">sym</span><span class="op" id="3681533">)</span>&nbsp;<span class="op" id="3681535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681543">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681557">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681565">item</span>&nbsp;<span class="op" id="3681570">:=</span>&nbsp;<span class="ident" id="3681573">pkgSym</span><span class="op" id="3681579">{</span><span class="ident" id="3681580">pkg</span><span class="op" id="3681583">,</span>&nbsp;<span class="ident" id="3681585">link</span><span class="op" id="3681589">.</span><span class="ident" id="3681590">sym</span><span class="op" id="3681593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681600">next</span>&nbsp;<span class="op" id="3681605">=</span>&nbsp;<span class="builtinfunc" id="3681607">append</span><span class="op" id="3681613">(</span><span class="ident" id="3681614">next</span><span class="op" id="3681618">,</span>&nbsp;<span class="ident" id="3681620">item</span><span class="op" id="3681624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681635">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681644">cur</span>&nbsp;<span class="op" id="3681648">=</span>&nbsp;<span class="ident" id="3681650">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681657">next</span>&nbsp;<span class="op" id="3681662">=</span>&nbsp;<span class="ident" id="3681664">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681669">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681673">return</span>&nbsp;<span class="ident" id="3681680">ret</span><br>
<span class="lineno"></span><span class="op" id="3681684">}</span>
</div>
</body>
</html>
