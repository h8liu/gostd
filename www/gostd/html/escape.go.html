<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html</h2>
<ul>
<li><a href="/gostd/html/entity.go.html">entity.go</a></li>
<li><a href="/gostd/html/entity_test.go.html">entity_test.go</a></li>
<li><a href="/gostd/html/escape.go.html" class="current">escape.go</a></li>
<li><a href="/gostd/html/escape_test.go.html">escape_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5281644">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5281699">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5281753">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5281804">//&nbsp;Package&nbsp;html&nbsp;provides&nbsp;functions&nbsp;for&nbsp;escaping&nbsp;and&nbsp;unescaping&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5281878">package</span>&nbsp;<span class="ident" id="5281886">html</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5281892">import</span>&nbsp;<span class="op" id="5281899">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5281902">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5281911">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5281922">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5281937">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5281940">type</span>&nbsp;<span class="ident" id="5281945">writer</span>&nbsp;<span class="keyword" id="5281952">interface</span>&nbsp;<span class="op" id="5281962">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5281965">WriteString</span><span class="op" id="5281976">(</span><span class="builtintype" id="5281977">string</span><span class="op" id="5281983">)</span>&nbsp;<span class="op" id="5281985">(</span><span class="builtintype" id="5281986">int</span><span class="op" id="5281989">,</span>&nbsp;<span class="builtintype" id="5281991">error</span><span class="op" id="5281996">)</span><br>
<span class="lineno"></span><span class="op" id="5281998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5282001">//&nbsp;These&nbsp;replacements&nbsp;permit&nbsp;compatibility&nbsp;with&nbsp;old&nbsp;numeric&nbsp;entities&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5282075">//&nbsp;assumed&nbsp;Windows-1252&nbsp;encoding.</span><br>
<span class="lineno">20</span><span class="comment" id="5282109">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><span class="keyword" id="5282220">var</span>&nbsp;<span class="ident" id="5282224">replacementTable</span>&nbsp;<span class="op" id="5282241">=</span>&nbsp;<span class="op" id="5282243">[</span><span class="op" id="5282244">...</span><span class="op" id="5282247">]</span><span class="builtintype" id="5282248">rune</span><span class="op" id="5282252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282255">&#39;\u20AC&#39;</span><span class="op" id="5282263">,</span>&nbsp;<span class="comment" id="5282265">//&nbsp;First&nbsp;entry&nbsp;is&nbsp;what&nbsp;0x80&nbsp;should&nbsp;be&nbsp;replaced&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282319">&#39;\u0081&#39;</span><span class="op" id="5282327">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282330">&#39;\u201A&#39;</span><span class="op" id="5282338">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282341">&#39;\u0192&#39;</span><span class="op" id="5282349">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282352">&#39;\u201E&#39;</span><span class="op" id="5282360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282363">&#39;\u2026&#39;</span><span class="op" id="5282371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282374">&#39;\u2020&#39;</span><span class="op" id="5282382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282385">&#39;\u2021&#39;</span><span class="op" id="5282393">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282396">&#39;\u02C6&#39;</span><span class="op" id="5282404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282407">&#39;\u2030&#39;</span><span class="op" id="5282415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282418">&#39;\u0160&#39;</span><span class="op" id="5282426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282429">&#39;\u2039&#39;</span><span class="op" id="5282437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282440">&#39;\u0152&#39;</span><span class="op" id="5282448">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282451">&#39;\u008D&#39;</span><span class="op" id="5282459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282462">&#39;\u017D&#39;</span><span class="op" id="5282470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282473">&#39;\u008F&#39;</span><span class="op" id="5282481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282484">&#39;\u0090&#39;</span><span class="op" id="5282492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282495">&#39;\u2018&#39;</span><span class="op" id="5282503">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282506">&#39;\u2019&#39;</span><span class="op" id="5282514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282517">&#39;\u201C&#39;</span><span class="op" id="5282525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282528">&#39;\u201D&#39;</span><span class="op" id="5282536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282539">&#39;\u2022&#39;</span><span class="op" id="5282547">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282550">&#39;\u2013&#39;</span><span class="op" id="5282558">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282561">&#39;\u2014&#39;</span><span class="op" id="5282569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282572">&#39;\u02DC&#39;</span><span class="op" id="5282580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282583">&#39;\u2122&#39;</span><span class="op" id="5282591">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282594">&#39;\u0161&#39;</span><span class="op" id="5282602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282605">&#39;\u203A&#39;</span><span class="op" id="5282613">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282616">&#39;\u0153&#39;</span><span class="op" id="5282624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282627">&#39;\u009D&#39;</span><span class="op" id="5282635">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282638">&#39;\u017E&#39;</span><span class="op" id="5282646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5282649">&#39;\u0178&#39;</span><span class="op" id="5282657">,</span>&nbsp;<span class="comment" id="5282659">//&nbsp;Last&nbsp;entry&nbsp;is&nbsp;0x9F.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5282683">//&nbsp;0x00-&gt;&#39;\uFFFD&#39;&nbsp;is&nbsp;handled&nbsp;programmatically.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5282731">//&nbsp;0x0D-&gt;&#39;\u000D&#39;&nbsp;is&nbsp;a&nbsp;no-op.</span><br>
<span class="lineno"></span><span class="op" id="5282761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5282764">//&nbsp;unescapeEntity&nbsp;reads&nbsp;an&nbsp;entity&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;from&nbsp;b[src:]&nbsp;and&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5282838">//&nbsp;corresponding&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;b[dst:],&nbsp;returning&nbsp;the&nbsp;incremented&nbsp;dst&nbsp;and&nbsp;src&nbsp;cursors.</span><br>
<span class="lineno">60</span><span class="comment" id="5282918">//&nbsp;Precondition:&nbsp;b[src]&nbsp;==&nbsp;&#39;&amp;&#39;&nbsp;&amp;&amp;&nbsp;dst&nbsp;&lt;=&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="5282964">//&nbsp;attribute&nbsp;should&nbsp;be&nbsp;true&nbsp;if&nbsp;parsing&nbsp;an&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5283023">func</span>&nbsp;<span class="ident" id="5283028">unescapeEntity</span><span class="op" id="5283042">(</span><span class="ident" id="5283043">b</span>&nbsp;<span class="op" id="5283045">[</span><span class="op" id="5283046">]</span><span class="builtintype" id="5283047">byte</span><span class="op" id="5283051">,</span>&nbsp;<span class="ident" id="5283053">dst</span><span class="op" id="5283056">,</span>&nbsp;<span class="ident" id="5283058">src</span>&nbsp;<span class="builtintype" id="5283062">int</span><span class="op" id="5283065">,</span>&nbsp;<span class="ident" id="5283067">attribute</span>&nbsp;<span class="builtintype" id="5283077">bool</span><span class="op" id="5283081">)</span>&nbsp;<span class="op" id="5283083">(</span><span class="ident" id="5283084">dst1</span><span class="op" id="5283088">,</span>&nbsp;<span class="ident" id="5283090">src1</span>&nbsp;<span class="builtintype" id="5283095">int</span><span class="op" id="5283098">)</span>&nbsp;<span class="op" id="5283100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5283103">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5283216">//&nbsp;i&nbsp;starts&nbsp;at&nbsp;1&nbsp;because&nbsp;we&nbsp;already&nbsp;know&nbsp;that&nbsp;s[0]&nbsp;==&nbsp;&#39;&amp;&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283276">i</span><span class="op" id="5283277">,</span>&nbsp;<span class="ident" id="5283279">s</span>&nbsp;<span class="op" id="5283281">:=</span>&nbsp;<span class="num" id="5283284">1</span><span class="op" id="5283285">,</span>&nbsp;<span class="ident" id="5283287">b</span><span class="op" id="5283288">[</span><span class="ident" id="5283289">src</span><span class="op" id="5283292">:</span><span class="op" id="5283293">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283297">if</span>&nbsp;<span class="builtinfunc" id="5283300">len</span><span class="op" id="5283303">(</span><span class="ident" id="5283304">s</span><span class="op" id="5283305">)</span>&nbsp;<span class="op" id="5283307">&lt;=</span>&nbsp;<span class="num" id="5283310">1</span>&nbsp;<span class="op" id="5283312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283316">b</span><span class="op" id="5283317">[</span><span class="ident" id="5283318">dst</span><span class="op" id="5283321">]</span>&nbsp;<span class="op" id="5283323">=</span>&nbsp;<span class="ident" id="5283325">b</span><span class="op" id="5283326">[</span><span class="ident" id="5283327">src</span><span class="op" id="5283330">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283334">return</span>&nbsp;<span class="ident" id="5283341">dst</span>&nbsp;<span class="op" id="5283345">+</span>&nbsp;<span class="num" id="5283347">1</span><span class="op" id="5283348">,</span>&nbsp;<span class="ident" id="5283350">src</span>&nbsp;<span class="op" id="5283354">+</span>&nbsp;<span class="num" id="5283356">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5283359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283363">if</span>&nbsp;<span class="ident" id="5283366">s</span><span class="op" id="5283367">[</span><span class="ident" id="5283368">i</span><span class="op" id="5283369">]</span>&nbsp;<span class="op" id="5283371">==</span>&nbsp;<span class="string" id="5283374">&#39;#&#39;</span>&nbsp;<span class="op" id="5283378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283382">if</span>&nbsp;<span class="builtinfunc" id="5283385">len</span><span class="op" id="5283388">(</span><span class="ident" id="5283389">s</span><span class="op" id="5283390">)</span>&nbsp;<span class="op" id="5283392">&lt;=</span>&nbsp;<span class="num" id="5283395">3</span>&nbsp;<span class="op" id="5283397">{</span>&nbsp;<span class="comment" id="5283399">//&nbsp;We&nbsp;need&nbsp;to&nbsp;have&nbsp;at&nbsp;least&nbsp;&#34;&amp;#.&#34;.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283437">b</span><span class="op" id="5283438">[</span><span class="ident" id="5283439">dst</span><span class="op" id="5283442">]</span>&nbsp;<span class="op" id="5283444">=</span>&nbsp;<span class="ident" id="5283446">b</span><span class="op" id="5283447">[</span><span class="ident" id="5283448">src</span><span class="op" id="5283451">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283456">return</span>&nbsp;<span class="ident" id="5283463">dst</span>&nbsp;<span class="op" id="5283467">+</span>&nbsp;<span class="num" id="5283469">1</span><span class="op" id="5283470">,</span>&nbsp;<span class="ident" id="5283472">src</span>&nbsp;<span class="op" id="5283476">+</span>&nbsp;<span class="num" id="5283478">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5283482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283486">i</span><span class="op" id="5283487">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283492">c</span>&nbsp;<span class="op" id="5283494">:=</span>&nbsp;<span class="ident" id="5283497">s</span><span class="op" id="5283498">[</span><span class="ident" id="5283499">i</span><span class="op" id="5283500">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283504">hex</span>&nbsp;<span class="op" id="5283508">:=</span>&nbsp;<span class="builtintype" id="5283511">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283519">if</span>&nbsp;<span class="ident" id="5283522">c</span>&nbsp;<span class="op" id="5283524">==</span>&nbsp;<span class="string" id="5283527">&#39;x&#39;</span>&nbsp;<span class="op" id="5283531">||</span>&nbsp;<span class="ident" id="5283534">c</span>&nbsp;<span class="op" id="5283536">==</span>&nbsp;<span class="string" id="5283539">&#39;X&#39;</span>&nbsp;<span class="op" id="5283543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283548">hex</span>&nbsp;<span class="op" id="5283552">=</span>&nbsp;<span class="builtintype" id="5283554">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283562">i</span><span class="op" id="5283563">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5283568">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283573">x</span>&nbsp;<span class="op" id="5283575">:=</span>&nbsp;<span class="string" id="5283578">&#39;\x00&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283587">for</span>&nbsp;<span class="ident" id="5283591">i</span>&nbsp;<span class="op" id="5283593">&lt;</span>&nbsp;<span class="builtinfunc" id="5283595">len</span><span class="op" id="5283598">(</span><span class="ident" id="5283599">s</span><span class="op" id="5283600">)</span>&nbsp;<span class="op" id="5283602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283607">c</span>&nbsp;<span class="op" id="5283609">=</span>&nbsp;<span class="ident" id="5283611">s</span><span class="op" id="5283612">[</span><span class="ident" id="5283613">i</span><span class="op" id="5283614">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283619">i</span><span class="op" id="5283620">++</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283626">if</span>&nbsp;<span class="ident" id="5283629">hex</span>&nbsp;<span class="op" id="5283633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283639">if</span>&nbsp;<span class="string" id="5283642">&#39;0&#39;</span>&nbsp;<span class="op" id="5283646">&lt;=</span>&nbsp;<span class="ident" id="5283649">c</span>&nbsp;<span class="op" id="5283651">&amp;&amp;</span>&nbsp;<span class="ident" id="5283654">c</span>&nbsp;<span class="op" id="5283656">&lt;=</span>&nbsp;<span class="string" id="5283659">&#39;9&#39;</span>&nbsp;<span class="op" id="5283663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283670">x</span>&nbsp;<span class="op" id="5283672">=</span>&nbsp;<span class="num" id="5283674">16</span><span class="op" id="5283676">*</span><span class="ident" id="5283677">x</span>&nbsp;<span class="op" id="5283679">+</span>&nbsp;<span class="builtintype" id="5283681">rune</span><span class="op" id="5283685">(</span><span class="ident" id="5283686">c</span><span class="op" id="5283687">)</span>&nbsp;<span class="op" id="5283689">-</span>&nbsp;<span class="string" id="5283691">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283700">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5283713">}</span>&nbsp;<span class="keyword" id="5283715">else</span>&nbsp;<span class="keyword" id="5283720">if</span>&nbsp;<span class="string" id="5283723">&#39;a&#39;</span>&nbsp;<span class="op" id="5283727">&lt;=</span>&nbsp;<span class="ident" id="5283730">c</span>&nbsp;<span class="op" id="5283732">&amp;&amp;</span>&nbsp;<span class="ident" id="5283735">c</span>&nbsp;<span class="op" id="5283737">&lt;=</span>&nbsp;<span class="string" id="5283740">&#39;f&#39;</span>&nbsp;<span class="op" id="5283744">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283751">x</span>&nbsp;<span class="op" id="5283753">=</span>&nbsp;<span class="num" id="5283755">16</span><span class="op" id="5283757">*</span><span class="ident" id="5283758">x</span>&nbsp;<span class="op" id="5283760">+</span>&nbsp;<span class="builtintype" id="5283762">rune</span><span class="op" id="5283766">(</span><span class="ident" id="5283767">c</span><span class="op" id="5283768">)</span>&nbsp;<span class="op" id="5283770">-</span>&nbsp;<span class="string" id="5283772">&#39;a&#39;</span>&nbsp;<span class="op" id="5283776">+</span>&nbsp;<span class="num" id="5283778">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283786">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5283799">}</span>&nbsp;<span class="keyword" id="5283801">else</span>&nbsp;<span class="keyword" id="5283806">if</span>&nbsp;<span class="string" id="5283809">&#39;A&#39;</span>&nbsp;<span class="op" id="5283813">&lt;=</span>&nbsp;<span class="ident" id="5283816">c</span>&nbsp;<span class="op" id="5283818">&amp;&amp;</span>&nbsp;<span class="ident" id="5283821">c</span>&nbsp;<span class="op" id="5283823">&lt;=</span>&nbsp;<span class="string" id="5283826">&#39;F&#39;</span>&nbsp;<span class="op" id="5283830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283837">x</span>&nbsp;<span class="op" id="5283839">=</span>&nbsp;<span class="num" id="5283841">16</span><span class="op" id="5283843">*</span><span class="ident" id="5283844">x</span>&nbsp;<span class="op" id="5283846">+</span>&nbsp;<span class="builtintype" id="5283848">rune</span><span class="op" id="5283852">(</span><span class="ident" id="5283853">c</span><span class="op" id="5283854">)</span>&nbsp;<span class="op" id="5283856">-</span>&nbsp;<span class="string" id="5283858">&#39;A&#39;</span>&nbsp;<span class="op" id="5283862">+</span>&nbsp;<span class="num" id="5283864">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283872">continue</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5283885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5283890">}</span>&nbsp;<span class="keyword" id="5283892">else</span>&nbsp;<span class="keyword" id="5283897">if</span>&nbsp;<span class="string" id="5283900">&#39;0&#39;</span>&nbsp;<span class="op" id="5283904">&lt;=</span>&nbsp;<span class="ident" id="5283907">c</span>&nbsp;<span class="op" id="5283909">&amp;&amp;</span>&nbsp;<span class="ident" id="5283912">c</span>&nbsp;<span class="op" id="5283914">&lt;=</span>&nbsp;<span class="string" id="5283917">&#39;9&#39;</span>&nbsp;<span class="op" id="5283921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283927">x</span>&nbsp;<span class="op" id="5283929">=</span>&nbsp;<span class="num" id="5283931">10</span><span class="op" id="5283933">*</span><span class="ident" id="5283934">x</span>&nbsp;<span class="op" id="5283936">+</span>&nbsp;<span class="builtintype" id="5283938">rune</span><span class="op" id="5283942">(</span><span class="ident" id="5283943">c</span><span class="op" id="5283944">)</span>&nbsp;<span class="op" id="5283946">-</span>&nbsp;<span class="string" id="5283948">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283956">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5283968">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5283973">if</span>&nbsp;<span class="ident" id="5283976">c</span>&nbsp;<span class="op" id="5283978">!=</span>&nbsp;<span class="string" id="5283981">&#39;;&#39;</span>&nbsp;<span class="op" id="5283985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5283991">i</span><span class="op" id="5283992">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5283998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284003">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5284011">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284016">if</span>&nbsp;<span class="ident" id="5284019">i</span>&nbsp;<span class="op" id="5284021">&lt;=</span>&nbsp;<span class="num" id="5284024">3</span>&nbsp;<span class="op" id="5284026">{</span>&nbsp;<span class="comment" id="5284028">//&nbsp;No&nbsp;characters&nbsp;matched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284057">b</span><span class="op" id="5284058">[</span><span class="ident" id="5284059">dst</span><span class="op" id="5284062">]</span>&nbsp;<span class="op" id="5284064">=</span>&nbsp;<span class="ident" id="5284066">b</span><span class="op" id="5284067">[</span><span class="ident" id="5284068">src</span><span class="op" id="5284071">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284076">return</span>&nbsp;<span class="ident" id="5284083">dst</span>&nbsp;<span class="op" id="5284087">+</span>&nbsp;<span class="num" id="5284089">1</span><span class="op" id="5284090">,</span>&nbsp;<span class="ident" id="5284092">src</span>&nbsp;<span class="op" id="5284096">+</span>&nbsp;<span class="num" id="5284098">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5284102">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284107">if</span>&nbsp;<span class="num" id="5284110">0x80</span>&nbsp;<span class="op" id="5284115">&lt;=</span>&nbsp;<span class="ident" id="5284118">x</span>&nbsp;<span class="op" id="5284120">&amp;&amp;</span>&nbsp;<span class="ident" id="5284123">x</span>&nbsp;<span class="op" id="5284125">&lt;=</span>&nbsp;<span class="num" id="5284128">0x9F</span>&nbsp;<span class="op" id="5284133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5284138">//&nbsp;Replace&nbsp;characters&nbsp;from&nbsp;Windows-1252&nbsp;with&nbsp;UTF-8&nbsp;equivalents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284205">x</span>&nbsp;<span class="op" id="5284207">=</span>&nbsp;<span class="ident" id="5284209">replacementTable</span><span class="op" id="5284225">[</span><span class="ident" id="5284226">x</span><span class="op" id="5284227">-</span><span class="num" id="5284228">0x80</span><span class="op" id="5284232">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5284236">}</span>&nbsp;<span class="keyword" id="5284238">else</span>&nbsp;<span class="keyword" id="5284243">if</span>&nbsp;<span class="ident" id="5284246">x</span>&nbsp;<span class="op" id="5284248">==</span>&nbsp;<span class="num" id="5284251">0</span>&nbsp;<span class="op" id="5284253">||</span>&nbsp;<span class="op" id="5284256">(</span><span class="num" id="5284257">0xD800</span>&nbsp;<span class="op" id="5284264">&lt;=</span>&nbsp;<span class="ident" id="5284267">x</span>&nbsp;<span class="op" id="5284269">&amp;&amp;</span>&nbsp;<span class="ident" id="5284272">x</span>&nbsp;<span class="op" id="5284274">&lt;=</span>&nbsp;<span class="num" id="5284277">0xDFFF</span><span class="op" id="5284283">)</span>&nbsp;<span class="op" id="5284285">||</span>&nbsp;<span class="ident" id="5284288">x</span>&nbsp;<span class="op" id="5284290">&gt;</span>&nbsp;<span class="num" id="5284292">0x10FFFF</span>&nbsp;<span class="op" id="5284301">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5284306">//&nbsp;Replace&nbsp;invalid&nbsp;characters&nbsp;with&nbsp;the&nbsp;replacement&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284371">x</span>&nbsp;<span class="op" id="5284373">=</span>&nbsp;<span class="string" id="5284375">&#39;\uFFFD&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5284386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284391">return</span>&nbsp;<span class="ident" id="5284398">dst</span>&nbsp;<span class="op" id="5284402">+</span>&nbsp;<span class="ident" id="5284404">utf8</span><span class="op" id="5284408">.</span><span class="ident" id="5284409">EncodeRune</span><span class="op" id="5284419">(</span><span class="ident" id="5284420">b</span><span class="op" id="5284421">[</span><span class="ident" id="5284422">dst</span><span class="op" id="5284425">:</span><span class="op" id="5284426">]</span><span class="op" id="5284427">,</span>&nbsp;<span class="ident" id="5284429">x</span><span class="op" id="5284430">)</span><span class="op" id="5284431">,</span>&nbsp;<span class="ident" id="5284433">src</span>&nbsp;<span class="op" id="5284437">+</span>&nbsp;<span class="ident" id="5284439">i</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5284442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5284446">//&nbsp;Consume&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;characters&nbsp;possible,&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5284510">//&nbsp;consumed&nbsp;characters&nbsp;matching&nbsp;one&nbsp;of&nbsp;the&nbsp;named&nbsp;references.</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284573">for</span>&nbsp;<span class="ident" id="5284577">i</span>&nbsp;<span class="op" id="5284579">&lt;</span>&nbsp;<span class="builtinfunc" id="5284581">len</span><span class="op" id="5284584">(</span><span class="ident" id="5284585">s</span><span class="op" id="5284586">)</span>&nbsp;<span class="op" id="5284588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284592">c</span>&nbsp;<span class="op" id="5284594">:=</span>&nbsp;<span class="ident" id="5284597">s</span><span class="op" id="5284598">[</span><span class="ident" id="5284599">i</span><span class="op" id="5284600">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284604">i</span><span class="op" id="5284605">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5284610">//&nbsp;Lower-cased&nbsp;characters&nbsp;are&nbsp;more&nbsp;common&nbsp;in&nbsp;entities,&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;them&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284695">if</span>&nbsp;<span class="string" id="5284698">&#39;a&#39;</span>&nbsp;<span class="op" id="5284702">&lt;=</span>&nbsp;<span class="ident" id="5284705">c</span>&nbsp;<span class="op" id="5284707">&amp;&amp;</span>&nbsp;<span class="ident" id="5284710">c</span>&nbsp;<span class="op" id="5284712">&lt;=</span>&nbsp;<span class="string" id="5284715">&#39;z&#39;</span>&nbsp;<span class="op" id="5284719">||</span>&nbsp;<span class="string" id="5284722">&#39;A&#39;</span>&nbsp;<span class="op" id="5284726">&lt;=</span>&nbsp;<span class="ident" id="5284729">c</span>&nbsp;<span class="op" id="5284731">&amp;&amp;</span>&nbsp;<span class="ident" id="5284734">c</span>&nbsp;<span class="op" id="5284736">&lt;=</span>&nbsp;<span class="string" id="5284739">&#39;Z&#39;</span>&nbsp;<span class="op" id="5284743">||</span>&nbsp;<span class="string" id="5284746">&#39;0&#39;</span>&nbsp;<span class="op" id="5284750">&lt;=</span>&nbsp;<span class="ident" id="5284753">c</span>&nbsp;<span class="op" id="5284755">&amp;&amp;</span>&nbsp;<span class="ident" id="5284758">c</span>&nbsp;<span class="op" id="5284760">&lt;=</span>&nbsp;<span class="string" id="5284763">&#39;9&#39;</span>&nbsp;<span class="op" id="5284767">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284772">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5284783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284787">if</span>&nbsp;<span class="ident" id="5284790">c</span>&nbsp;<span class="op" id="5284792">!=</span>&nbsp;<span class="string" id="5284795">&#39;;&#39;</span>&nbsp;<span class="op" id="5284799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284804">i</span><span class="op" id="5284805">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5284810">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284814">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5284821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5284825">entityName</span>&nbsp;<span class="op" id="5284836">:=</span>&nbsp;<span class="builtintype" id="5284839">string</span><span class="op" id="5284845">(</span><span class="ident" id="5284846">s</span><span class="op" id="5284847">[</span><span class="num" id="5284848">1</span><span class="op" id="5284849">:</span><span class="ident" id="5284850">i</span><span class="op" id="5284851">]</span><span class="op" id="5284852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5284855">if</span>&nbsp;<span class="ident" id="5284858">entityName</span>&nbsp;<span class="op" id="5284869">==</span>&nbsp;<span class="string" id="5284872">&#34;&#34;</span>&nbsp;<span class="op" id="5284875">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5284879">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5284890">}</span>&nbsp;<span class="keyword" id="5284892">else</span>&nbsp;<span class="keyword" id="5284897">if</span>&nbsp;<span class="ident" id="5284900">attribute</span>&nbsp;<span class="op" id="5284910">&amp;&amp;</span>&nbsp;<span class="ident" id="5284913">entityName</span><span class="op" id="5284923">[</span><span class="builtinfunc" id="5284924">len</span><span class="op" id="5284927">(</span><span class="ident" id="5284928">entityName</span><span class="op" id="5284938">)</span><span class="op" id="5284939">-</span><span class="num" id="5284940">1</span><span class="op" id="5284941">]</span>&nbsp;<span class="op" id="5284943">!=</span>&nbsp;<span class="string" id="5284946">&#39;;&#39;</span>&nbsp;<span class="op" id="5284950">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5284953">len</span><span class="op" id="5284956">(</span><span class="ident" id="5284957">s</span><span class="op" id="5284958">)</span>&nbsp;<span class="op" id="5284960">&gt;</span>&nbsp;<span class="ident" id="5284962">i</span>&nbsp;<span class="op" id="5284964">&amp;&amp;</span>&nbsp;<span class="ident" id="5284967">s</span><span class="op" id="5284968">[</span><span class="ident" id="5284969">i</span><span class="op" id="5284970">]</span>&nbsp;<span class="op" id="5284972">==</span>&nbsp;<span class="string" id="5284975">&#39;=&#39;</span>&nbsp;<span class="op" id="5284979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5284983">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5284994">}</span>&nbsp;<span class="keyword" id="5284996">else</span>&nbsp;<span class="keyword" id="5285001">if</span>&nbsp;<span class="ident" id="5285004">x</span>&nbsp;<span class="op" id="5285006">:=</span>&nbsp;<span class="ident" id="5285009">entity</span><span class="op" id="5285015">[</span><span class="ident" id="5285016">entityName</span><span class="op" id="5285026">]</span><span class="op" id="5285027">;</span>&nbsp;<span class="ident" id="5285029">x</span>&nbsp;<span class="op" id="5285031">!=</span>&nbsp;<span class="num" id="5285034">0</span>&nbsp;<span class="op" id="5285036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5285040">return</span>&nbsp;<span class="ident" id="5285047">dst</span>&nbsp;<span class="op" id="5285051">+</span>&nbsp;<span class="ident" id="5285053">utf8</span><span class="op" id="5285057">.</span><span class="ident" id="5285058">EncodeRune</span><span class="op" id="5285068">(</span><span class="ident" id="5285069">b</span><span class="op" id="5285070">[</span><span class="ident" id="5285071">dst</span><span class="op" id="5285074">:</span><span class="op" id="5285075">]</span><span class="op" id="5285076">,</span>&nbsp;<span class="ident" id="5285078">x</span><span class="op" id="5285079">)</span><span class="op" id="5285080">,</span>&nbsp;<span class="ident" id="5285082">src</span>&nbsp;<span class="op" id="5285086">+</span>&nbsp;<span class="ident" id="5285088">i</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5285091">}</span>&nbsp;<span class="keyword" id="5285093">else</span>&nbsp;<span class="keyword" id="5285098">if</span>&nbsp;<span class="ident" id="5285101">x</span>&nbsp;<span class="op" id="5285103">:=</span>&nbsp;<span class="ident" id="5285106">entity2</span><span class="op" id="5285113">[</span><span class="ident" id="5285114">entityName</span><span class="op" id="5285124">]</span><span class="op" id="5285125">;</span>&nbsp;<span class="ident" id="5285127">x</span><span class="op" id="5285128">[</span><span class="num" id="5285129">0</span><span class="op" id="5285130">]</span>&nbsp;<span class="op" id="5285132">!=</span>&nbsp;<span class="num" id="5285135">0</span>&nbsp;<span class="op" id="5285137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285141">dst1</span>&nbsp;<span class="op" id="5285146">:=</span>&nbsp;<span class="ident" id="5285149">dst</span>&nbsp;<span class="op" id="5285153">+</span>&nbsp;<span class="ident" id="5285155">utf8</span><span class="op" id="5285159">.</span><span class="ident" id="5285160">EncodeRune</span><span class="op" id="5285170">(</span><span class="ident" id="5285171">b</span><span class="op" id="5285172">[</span><span class="ident" id="5285173">dst</span><span class="op" id="5285176">:</span><span class="op" id="5285177">]</span><span class="op" id="5285178">,</span>&nbsp;<span class="ident" id="5285180">x</span><span class="op" id="5285181">[</span><span class="num" id="5285182">0</span><span class="op" id="5285183">]</span><span class="op" id="5285184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5285188">return</span>&nbsp;<span class="ident" id="5285195">dst1</span>&nbsp;<span class="op" id="5285200">+</span>&nbsp;<span class="ident" id="5285202">utf8</span><span class="op" id="5285206">.</span><span class="ident" id="5285207">EncodeRune</span><span class="op" id="5285217">(</span><span class="ident" id="5285218">b</span><span class="op" id="5285219">[</span><span class="ident" id="5285220">dst1</span><span class="op" id="5285224">:</span><span class="op" id="5285225">]</span><span class="op" id="5285226">,</span>&nbsp;<span class="ident" id="5285228">x</span><span class="op" id="5285229">[</span><span class="num" id="5285230">1</span><span class="op" id="5285231">]</span><span class="op" id="5285232">)</span><span class="op" id="5285233">,</span>&nbsp;<span class="ident" id="5285235">src</span>&nbsp;<span class="op" id="5285239">+</span>&nbsp;<span class="ident" id="5285241">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5285244">}</span>&nbsp;<span class="keyword" id="5285246">else</span>&nbsp;<span class="keyword" id="5285251">if</span>&nbsp;<span class="op" id="5285254">!</span><span class="ident" id="5285255">attribute</span>&nbsp;<span class="op" id="5285265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285269">maxLen</span>&nbsp;<span class="op" id="5285276">:=</span>&nbsp;<span class="builtinfunc" id="5285279">len</span><span class="op" id="5285282">(</span><span class="ident" id="5285283">entityName</span><span class="op" id="5285293">)</span>&nbsp;<span class="op" id="5285295">-</span>&nbsp;<span class="num" id="5285297">1</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5285301">if</span>&nbsp;<span class="ident" id="5285304">maxLen</span>&nbsp;<span class="op" id="5285311">&gt;</span>&nbsp;<span class="ident" id="5285313">longestEntityWithoutSemicolon</span>&nbsp;<span class="op" id="5285343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285348">maxLen</span>&nbsp;<span class="op" id="5285355">=</span>&nbsp;<span class="ident" id="5285357">longestEntityWithoutSemicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5285389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5285393">for</span>&nbsp;<span class="ident" id="5285397">j</span>&nbsp;<span class="op" id="5285399">:=</span>&nbsp;<span class="ident" id="5285402">maxLen</span><span class="op" id="5285408">;</span>&nbsp;<span class="ident" id="5285410">j</span>&nbsp;<span class="op" id="5285412">&gt;</span>&nbsp;<span class="num" id="5285414">1</span><span class="op" id="5285415">;</span>&nbsp;<span class="ident" id="5285417">j</span><span class="op" id="5285418">--</span>&nbsp;<span class="op" id="5285421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5285426">if</span>&nbsp;<span class="ident" id="5285429">x</span>&nbsp;<span class="op" id="5285431">:=</span>&nbsp;<span class="ident" id="5285434">entity</span><span class="op" id="5285440">[</span><span class="ident" id="5285441">entityName</span><span class="op" id="5285451">[</span><span class="op" id="5285452">:</span><span class="ident" id="5285453">j</span><span class="op" id="5285454">]</span><span class="op" id="5285455">]</span><span class="op" id="5285456">;</span>&nbsp;<span class="ident" id="5285458">x</span>&nbsp;<span class="op" id="5285460">!=</span>&nbsp;<span class="num" id="5285463">0</span>&nbsp;<span class="op" id="5285465">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5285471">return</span>&nbsp;<span class="ident" id="5285478">dst</span>&nbsp;<span class="op" id="5285482">+</span>&nbsp;<span class="ident" id="5285484">utf8</span><span class="op" id="5285488">.</span><span class="ident" id="5285489">EncodeRune</span><span class="op" id="5285499">(</span><span class="ident" id="5285500">b</span><span class="op" id="5285501">[</span><span class="ident" id="5285502">dst</span><span class="op" id="5285505">:</span><span class="op" id="5285506">]</span><span class="op" id="5285507">,</span>&nbsp;<span class="ident" id="5285509">x</span><span class="op" id="5285510">)</span><span class="op" id="5285511">,</span>&nbsp;<span class="ident" id="5285513">src</span>&nbsp;<span class="op" id="5285517">+</span>&nbsp;<span class="ident" id="5285519">j</span>&nbsp;<span class="op" id="5285521">+</span>&nbsp;<span class="num" id="5285523">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5285528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5285532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5285535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285539">dst1</span><span class="op" id="5285543">,</span>&nbsp;<span class="ident" id="5285545">src1</span>&nbsp;<span class="op" id="5285550">=</span>&nbsp;<span class="ident" id="5285552">dst</span><span class="op" id="5285555">+</span><span class="ident" id="5285556">i</span><span class="op" id="5285557">,</span>&nbsp;<span class="ident" id="5285559">src</span><span class="op" id="5285562">+</span><span class="ident" id="5285563">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5285566">copy</span><span class="op" id="5285570">(</span><span class="ident" id="5285571">b</span><span class="op" id="5285572">[</span><span class="ident" id="5285573">dst</span><span class="op" id="5285576">:</span><span class="ident" id="5285577">dst1</span><span class="op" id="5285581">]</span><span class="op" id="5285582">,</span>&nbsp;<span class="ident" id="5285584">b</span><span class="op" id="5285585">[</span><span class="ident" id="5285586">src</span><span class="op" id="5285589">:</span><span class="ident" id="5285590">src1</span><span class="op" id="5285594">]</span><span class="op" id="5285595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5285598">return</span>&nbsp;<span class="ident" id="5285605">dst1</span><span class="op" id="5285609">,</span>&nbsp;<span class="ident" id="5285611">src1</span><br>
<span class="lineno"></span><span class="op" id="5285616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="5285619">//&nbsp;unescape&nbsp;unescapes&nbsp;b&#39;s&nbsp;entities&nbsp;in-place,&nbsp;so&nbsp;that&nbsp;&#34;a&amp;lt;b&#34;&nbsp;becomes&nbsp;&#34;a&lt;b&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5285696">func</span>&nbsp;<span class="ident" id="5285701">unescape</span><span class="op" id="5285709">(</span><span class="ident" id="5285710">b</span>&nbsp;<span class="op" id="5285712">[</span><span class="op" id="5285713">]</span><span class="builtintype" id="5285714">byte</span><span class="op" id="5285718">)</span>&nbsp;<span class="op" id="5285720">[</span><span class="op" id="5285721">]</span><span class="builtintype" id="5285722">byte</span>&nbsp;<span class="op" id="5285727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5285730">for</span>&nbsp;<span class="ident" id="5285734">i</span><span class="op" id="5285735">,</span>&nbsp;<span class="ident" id="5285737">c</span>&nbsp;<span class="op" id="5285739">:=</span>&nbsp;<span class="keyword" id="5285742">range</span>&nbsp;<span class="ident" id="5285748">b</span>&nbsp;<span class="op" id="5285750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5285754">if</span>&nbsp;<span class="ident" id="5285757">c</span>&nbsp;<span class="op" id="5285759">==</span>&nbsp;<span class="string" id="5285762">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5285766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285771">dst</span><span class="op" id="5285774">,</span>&nbsp;<span class="ident" id="5285776">src</span>&nbsp;<span class="op" id="5285780">:=</span>&nbsp;<span class="ident" id="5285783">unescapeEntity</span><span class="op" id="5285797">(</span><span class="ident" id="5285798">b</span><span class="op" id="5285799">,</span>&nbsp;<span class="ident" id="5285801">i</span><span class="op" id="5285802">,</span>&nbsp;<span class="ident" id="5285804">i</span><span class="op" id="5285805">,</span>&nbsp;<span class="builtintype" id="5285807">false</span><span class="op" id="5285812">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5285817">for</span>&nbsp;<span class="ident" id="5285821">src</span>&nbsp;<span class="op" id="5285825">&lt;</span>&nbsp;<span class="builtinfunc" id="5285827">len</span><span class="op" id="5285830">(</span><span class="ident" id="5285831">b</span><span class="op" id="5285832">)</span>&nbsp;<span class="op" id="5285834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285840">c</span>&nbsp;<span class="op" id="5285842">:=</span>&nbsp;<span class="ident" id="5285845">b</span><span class="op" id="5285846">[</span><span class="ident" id="5285847">src</span><span class="op" id="5285850">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5285856">if</span>&nbsp;<span class="ident" id="5285859">c</span>&nbsp;<span class="op" id="5285861">==</span>&nbsp;<span class="string" id="5285864">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5285868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285875">dst</span><span class="op" id="5285878">,</span>&nbsp;<span class="ident" id="5285880">src</span>&nbsp;<span class="op" id="5285884">=</span>&nbsp;<span class="ident" id="5285886">unescapeEntity</span><span class="op" id="5285900">(</span><span class="ident" id="5285901">b</span><span class="op" id="5285902">,</span>&nbsp;<span class="ident" id="5285904">dst</span><span class="op" id="5285907">,</span>&nbsp;<span class="ident" id="5285909">src</span><span class="op" id="5285912">,</span>&nbsp;<span class="builtintype" id="5285914">false</span><span class="op" id="5285919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5285925">}</span>&nbsp;<span class="keyword" id="5285927">else</span>&nbsp;<span class="op" id="5285932">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285939">b</span><span class="op" id="5285940">[</span><span class="ident" id="5285941">dst</span><span class="op" id="5285944">]</span>&nbsp;<span class="op" id="5285946">=</span>&nbsp;<span class="ident" id="5285948">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5285955">dst</span><span class="op" id="5285958">,</span>&nbsp;<span class="ident" id="5285960">src</span>&nbsp;<span class="op" id="5285964">=</span>&nbsp;<span class="ident" id="5285966">dst</span><span class="op" id="5285969">+</span><span class="num" id="5285970">1</span><span class="op" id="5285971">,</span>&nbsp;<span class="ident" id="5285973">src</span><span class="op" id="5285976">+</span><span class="num" id="5285977">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5285983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5285988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5285993">return</span>&nbsp;<span class="ident" id="5286000">b</span><span class="op" id="5286001">[</span><span class="num" id="5286002">0</span><span class="op" id="5286003">:</span><span class="ident" id="5286004">dst</span><span class="op" id="5286007">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5286011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5286014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286017">return</span>&nbsp;<span class="ident" id="5286024">b</span><br>
<span class="lineno"></span><span class="op" id="5286026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="5286029">const</span>&nbsp;<span class="ident" id="5286035">escapedChars</span>&nbsp;<span class="op" id="5286048">=</span>&nbsp;<span class="string" id="5286050">`&amp;&#39;&lt;&gt;&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5286059">func</span>&nbsp;<span class="ident" id="5286064">escape</span><span class="op" id="5286070">(</span><span class="ident" id="5286071">w</span>&nbsp;<span class="ident" id="5286073">writer</span><span class="op" id="5286079">,</span>&nbsp;<span class="ident" id="5286081">s</span>&nbsp;<span class="builtintype" id="5286083">string</span><span class="op" id="5286089">)</span>&nbsp;<span class="builtintype" id="5286091">error</span>&nbsp;<span class="op" id="5286097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5286100">i</span>&nbsp;<span class="op" id="5286102">:=</span>&nbsp;<span class="ident" id="5286105">strings</span><span class="op" id="5286112">.</span><span class="ident" id="5286113">IndexAny</span><span class="op" id="5286121">(</span><span class="ident" id="5286122">s</span><span class="op" id="5286123">,</span>&nbsp;<span class="ident" id="5286125">escapedChars</span><span class="op" id="5286137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286140">for</span>&nbsp;<span class="ident" id="5286144">i</span>&nbsp;<span class="op" id="5286146">!=</span>&nbsp;<span class="op" id="5286149">-</span><span class="num" id="5286150">1</span>&nbsp;<span class="op" id="5286152">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286156">if</span>&nbsp;<span class="ident" id="5286159">_</span><span class="op" id="5286160">,</span>&nbsp;<span class="ident" id="5286162">err</span>&nbsp;<span class="op" id="5286166">:=</span>&nbsp;<span class="ident" id="5286169">w</span><span class="op" id="5286170">.</span><span class="ident" id="5286171">WriteString</span><span class="op" id="5286182">(</span><span class="ident" id="5286183">s</span><span class="op" id="5286184">[</span><span class="op" id="5286185">:</span><span class="ident" id="5286186">i</span><span class="op" id="5286187">]</span><span class="op" id="5286188">)</span><span class="op" id="5286189">;</span>&nbsp;<span class="ident" id="5286191">err</span>&nbsp;<span class="op" id="5286195">!=</span>&nbsp;<span class="ident" id="5286198">nil</span>&nbsp;<span class="op" id="5286202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286207">return</span>&nbsp;<span class="ident" id="5286214">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5286220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286224">var</span>&nbsp;<span class="ident" id="5286228">esc</span>&nbsp;<span class="builtintype" id="5286232">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286241">switch</span>&nbsp;<span class="ident" id="5286248">s</span><span class="op" id="5286249">[</span><span class="ident" id="5286250">i</span><span class="op" id="5286251">]</span>&nbsp;<span class="op" id="5286253">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286257">case</span>&nbsp;<span class="string" id="5286262">&#39;&amp;&#39;</span><span class="op" id="5286265">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5286270">esc</span>&nbsp;<span class="op" id="5286274">=</span>&nbsp;<span class="string" id="5286276">&#34;&amp;amp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286286">case</span>&nbsp;<span class="string" id="5286291">&#39;\&#39;&#39;</span><span class="op" id="5286295">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5286300">//&nbsp;&#34;&amp;#39;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;apos;&#34;&nbsp;and&nbsp;apos&nbsp;was&nbsp;not&nbsp;in&nbsp;HTML&nbsp;until&nbsp;HTML5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5286377">esc</span>&nbsp;<span class="op" id="5286381">=</span>&nbsp;<span class="string" id="5286383">&#34;&amp;#39;&#34;</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286393">case</span>&nbsp;<span class="string" id="5286398">&#39;&lt;&#39;</span><span class="op" id="5286401">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5286406">esc</span>&nbsp;<span class="op" id="5286410">=</span>&nbsp;<span class="string" id="5286412">&#34;&amp;lt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286421">case</span>&nbsp;<span class="string" id="5286426">&#39;&gt;&#39;</span><span class="op" id="5286429">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5286434">esc</span>&nbsp;<span class="op" id="5286438">=</span>&nbsp;<span class="string" id="5286440">&#34;&amp;gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286449">case</span>&nbsp;<span class="string" id="5286454">&#39;&#34;&#39;</span><span class="op" id="5286457">:</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5286462">//&nbsp;&#34;&amp;#34;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;quot;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5286502">esc</span>&nbsp;<span class="op" id="5286506">=</span>&nbsp;<span class="string" id="5286508">&#34;&amp;#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286518">default</span><span class="op" id="5286525">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5286530">panic</span><span class="op" id="5286535">(</span><span class="string" id="5286536">&#34;unrecognized&nbsp;escape&nbsp;character&#34;</span><span class="op" id="5286567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5286571">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5286575">s</span>&nbsp;<span class="op" id="5286577">=</span>&nbsp;<span class="ident" id="5286579">s</span><span class="op" id="5286580">[</span><span class="ident" id="5286581">i</span><span class="op" id="5286582">+</span><span class="num" id="5286583">1</span><span class="op" id="5286584">:</span><span class="op" id="5286585">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286589">if</span>&nbsp;<span class="ident" id="5286592">_</span><span class="op" id="5286593">,</span>&nbsp;<span class="ident" id="5286595">err</span>&nbsp;<span class="op" id="5286599">:=</span>&nbsp;<span class="ident" id="5286602">w</span><span class="op" id="5286603">.</span><span class="ident" id="5286604">WriteString</span><span class="op" id="5286615">(</span><span class="ident" id="5286616">esc</span><span class="op" id="5286619">)</span><span class="op" id="5286620">;</span>&nbsp;<span class="ident" id="5286622">err</span>&nbsp;<span class="op" id="5286626">!=</span>&nbsp;<span class="ident" id="5286629">nil</span>&nbsp;<span class="op" id="5286633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286638">return</span>&nbsp;<span class="ident" id="5286645">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5286651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5286655">i</span>&nbsp;<span class="op" id="5286657">=</span>&nbsp;<span class="ident" id="5286659">strings</span><span class="op" id="5286666">.</span><span class="ident" id="5286667">IndexAny</span><span class="op" id="5286675">(</span><span class="ident" id="5286676">s</span><span class="op" id="5286677">,</span>&nbsp;<span class="ident" id="5286679">escapedChars</span><span class="op" id="5286691">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5286694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5286697">_</span><span class="op" id="5286698">,</span>&nbsp;<span class="ident" id="5286700">err</span>&nbsp;<span class="op" id="5286704">:=</span>&nbsp;<span class="ident" id="5286707">w</span><span class="op" id="5286708">.</span><span class="ident" id="5286709">WriteString</span><span class="op" id="5286720">(</span><span class="ident" id="5286721">s</span><span class="op" id="5286722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286725">return</span>&nbsp;<span class="ident" id="5286732">err</span><br>
<span class="lineno"></span><span class="op" id="5286736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="comment" id="5286739">//&nbsp;EscapeString&nbsp;escapes&nbsp;special&nbsp;characters&nbsp;like&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&amp;lt;&#34;.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="5286812">//&nbsp;escapes&nbsp;only&nbsp;five&nbsp;such&nbsp;characters:&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;&#39;&nbsp;and&nbsp;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5286868">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5286945">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5286961">func</span>&nbsp;<span class="ident" id="5286966">EscapeString</span><span class="op" id="5286978">(</span><span class="ident" id="5286979">s</span>&nbsp;<span class="builtintype" id="5286981">string</span><span class="op" id="5286987">)</span>&nbsp;<span class="builtintype" id="5286989">string</span>&nbsp;<span class="op" id="5286996">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5286999">if</span>&nbsp;<span class="ident" id="5287002">strings</span><span class="op" id="5287009">.</span><span class="ident" id="5287010">IndexAny</span><span class="op" id="5287018">(</span><span class="ident" id="5287019">s</span><span class="op" id="5287020">,</span>&nbsp;<span class="ident" id="5287022">escapedChars</span><span class="op" id="5287034">)</span>&nbsp;<span class="op" id="5287036">==</span>&nbsp;<span class="op" id="5287039">-</span><span class="num" id="5287040">1</span>&nbsp;<span class="op" id="5287042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5287046">return</span>&nbsp;<span class="ident" id="5287053">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5287056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5287059">var</span>&nbsp;<span class="ident" id="5287063">buf</span>&nbsp;<span class="ident" id="5287067">bytes</span><span class="op" id="5287072">.</span><span class="ident" id="5287073">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5287081">escape</span><span class="op" id="5287087">(</span><span class="op" id="5287088">&amp;</span><span class="ident" id="5287089">buf</span><span class="op" id="5287092">,</span>&nbsp;<span class="ident" id="5287094">s</span><span class="op" id="5287095">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5287098">return</span>&nbsp;<span class="ident" id="5287105">buf</span><span class="op" id="5287108">.</span><span class="ident" id="5287109">String</span><span class="op" id="5287115">(</span><span class="op" id="5287116">)</span><br>
<span class="lineno"></span><span class="op" id="5287118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5287121">//&nbsp;UnescapeString&nbsp;unescapes&nbsp;entities&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&lt;&#34;.&nbsp;It&nbsp;unescapes&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5287200">//&nbsp;larger&nbsp;range&nbsp;of&nbsp;entities&nbsp;than&nbsp;EscapeString&nbsp;escapes.&nbsp;For&nbsp;example,&nbsp;&#34;&amp;aacute;&#34;</span><br>
<span class="lineno">240</span><span class="comment" id="5287279">//&nbsp;unescapes&nbsp;to&nbsp;&#34;&#34;,&nbsp;as&nbsp;does&nbsp;&#34;&amp;#225;&#34;&nbsp;and&nbsp;&#34;&amp;xE1;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="5287331">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5287408">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5287424">func</span>&nbsp;<span class="ident" id="5287429">UnescapeString</span><span class="op" id="5287443">(</span><span class="ident" id="5287444">s</span>&nbsp;<span class="builtintype" id="5287446">string</span><span class="op" id="5287452">)</span>&nbsp;<span class="builtintype" id="5287454">string</span>&nbsp;<span class="op" id="5287461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5287464">for</span>&nbsp;<span class="ident" id="5287468">_</span><span class="op" id="5287469">,</span>&nbsp;<span class="ident" id="5287471">c</span>&nbsp;<span class="op" id="5287473">:=</span>&nbsp;<span class="keyword" id="5287476">range</span>&nbsp;<span class="ident" id="5287482">s</span>&nbsp;<span class="op" id="5287484">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5287488">if</span>&nbsp;<span class="ident" id="5287491">c</span>&nbsp;<span class="op" id="5287493">==</span>&nbsp;<span class="string" id="5287496">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="5287500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5287505">return</span>&nbsp;<span class="builtintype" id="5287512">string</span><span class="op" id="5287518">(</span><span class="ident" id="5287519">unescape</span><span class="op" id="5287527">(</span><span class="op" id="5287528">[</span><span class="op" id="5287529">]</span><span class="builtintype" id="5287530">byte</span><span class="op" id="5287534">(</span><span class="ident" id="5287535">s</span><span class="op" id="5287536">)</span><span class="op" id="5287537">)</span><span class="op" id="5287538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5287542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5287545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5287548">return</span>&nbsp;<span class="ident" id="5287555">s</span><br>
<span class="lineno">250</span><span class="op" id="5287557">}</span>
</div>
</body>
</html>
