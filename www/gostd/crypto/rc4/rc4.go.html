<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rc4</h2>
<ul>
<li><a href="/gostd/crypto/rc4/rc4.go.html">rc4.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_asm.go.html">rc4_asm.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_test.go.html">rc4_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4605879">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4605934">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4605988">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4606039">//&nbsp;Package&nbsp;rc4&nbsp;implements&nbsp;RC4&nbsp;encryption,&nbsp;as&nbsp;defined&nbsp;in&nbsp;Bruce&nbsp;Schneier&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4606112">//&nbsp;Applied&nbsp;Cryptography.</span><br>
<span class="lineno"></span><span class="keyword" id="4606137">package</span>&nbsp;<span class="ident" id="4606145">rc4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4606150">//&nbsp;BUG(agl):&nbsp;RC4&nbsp;is&nbsp;in&nbsp;common&nbsp;use&nbsp;but&nbsp;has&nbsp;design&nbsp;weaknesses&nbsp;that&nbsp;make</span><br>
<span class="lineno">10</span><span class="comment" id="4606220">//&nbsp;it&nbsp;a&nbsp;poor&nbsp;choice&nbsp;for&nbsp;new&nbsp;protocols.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4606260">import</span>&nbsp;<span class="string" id="4606267">&#34;strconv&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4606278">//&nbsp;A&nbsp;Cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;RC4&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno">15</span><span class="keyword" id="4606336">type</span>&nbsp;<span class="ident" id="4606341">Cipher</span>&nbsp;<span class="keyword" id="4606348">struct</span>&nbsp;<span class="op" id="4606355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4606358">s</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4606363">[</span><span class="num" id="4606364">256</span><span class="op" id="4606367">]</span><span class="builtintype" id="4606368">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4606376">i</span><span class="op" id="4606377">,</span>&nbsp;<span class="ident" id="4606379">j</span>&nbsp;<span class="builtintype" id="4606381">uint8</span><br>
<span class="lineno"></span><span class="op" id="4606387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4606390">type</span>&nbsp;<span class="ident" id="4606395">KeySizeError</span>&nbsp;<span class="builtintype" id="4606408">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4606413">func</span>&nbsp;<span class="op" id="4606418">(</span><span class="ident" id="4606419">k</span>&nbsp;<span class="ident" id="4606421">KeySizeError</span><span class="op" id="4606433">)</span>&nbsp;<span class="ident" id="4606435">Error</span><span class="op" id="4606440">(</span><span class="op" id="4606441">)</span>&nbsp;<span class="builtintype" id="4606443">string</span>&nbsp;<span class="op" id="4606450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4606453">return</span>&nbsp;<span class="string" id="4606460">&#34;crypto/rc4:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="4606492">+</span>&nbsp;<span class="ident" id="4606494">strconv</span><span class="op" id="4606501">.</span><span class="ident" id="4606502">Itoa</span><span class="op" id="4606506">(</span><span class="builtintype" id="4606507">int</span><span class="op" id="4606510">(</span><span class="ident" id="4606511">k</span><span class="op" id="4606512">)</span><span class="op" id="4606513">)</span><br>
<span class="lineno"></span><span class="op" id="4606515">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4606518">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;Cipher.&nbsp;&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4606597">//&nbsp;RC4&nbsp;key,&nbsp;at&nbsp;least&nbsp;1&nbsp;byte&nbsp;and&nbsp;at&nbsp;most&nbsp;256&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4606648">func</span>&nbsp;<span class="ident" id="4606653">NewCipher</span><span class="op" id="4606662">(</span><span class="ident" id="4606663">key</span>&nbsp;<span class="op" id="4606667">[</span><span class="op" id="4606668">]</span><span class="builtintype" id="4606669">byte</span><span class="op" id="4606673">)</span>&nbsp;<span class="op" id="4606675">(</span><span class="op" id="4606676">*</span><span class="ident" id="4606677">Cipher</span><span class="op" id="4606683">,</span>&nbsp;<span class="builtintype" id="4606685">error</span><span class="op" id="4606690">)</span>&nbsp;<span class="op" id="4606692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4606695">k</span>&nbsp;<span class="op" id="4606697">:=</span>&nbsp;<span class="builtinfunc" id="4606700">len</span><span class="op" id="4606703">(</span><span class="ident" id="4606704">key</span><span class="op" id="4606707">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4606710">if</span>&nbsp;<span class="ident" id="4606713">k</span>&nbsp;<span class="op" id="4606715">&lt;</span>&nbsp;<span class="num" id="4606717">1</span>&nbsp;<span class="op" id="4606719">||</span>&nbsp;<span class="ident" id="4606722">k</span>&nbsp;<span class="op" id="4606724">&gt;</span>&nbsp;<span class="num" id="4606726">256</span>&nbsp;<span class="op" id="4606730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4606734">return</span>&nbsp;<span class="ident" id="4606741">nil</span><span class="op" id="4606744">,</span>&nbsp;<span class="ident" id="4606746">KeySizeError</span><span class="op" id="4606758">(</span><span class="ident" id="4606759">k</span><span class="op" id="4606760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4606763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4606766">var</span>&nbsp;<span class="ident" id="4606770">c</span>&nbsp;<span class="ident" id="4606772">Cipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4606780">for</span>&nbsp;<span class="ident" id="4606784">i</span>&nbsp;<span class="op" id="4606786">:=</span>&nbsp;<span class="num" id="4606789">0</span><span class="op" id="4606790">;</span>&nbsp;<span class="ident" id="4606792">i</span>&nbsp;<span class="op" id="4606794">&lt;</span>&nbsp;<span class="num" id="4606796">256</span><span class="op" id="4606799">;</span>&nbsp;<span class="ident" id="4606801">i</span><span class="op" id="4606802">++</span>&nbsp;<span class="op" id="4606805">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4606809">c</span><span class="op" id="4606810">.</span><span class="ident" id="4606811">s</span><span class="op" id="4606812">[</span><span class="ident" id="4606813">i</span><span class="op" id="4606814">]</span>&nbsp;<span class="op" id="4606816">=</span>&nbsp;<span class="builtintype" id="4606818">uint32</span><span class="op" id="4606824">(</span><span class="ident" id="4606825">i</span><span class="op" id="4606826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4606829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4606832">var</span>&nbsp;<span class="ident" id="4606836">j</span>&nbsp;<span class="builtintype" id="4606838">uint8</span>&nbsp;<span class="op" id="4606844">=</span>&nbsp;<span class="num" id="4606846">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4606849">for</span>&nbsp;<span class="ident" id="4606853">i</span>&nbsp;<span class="op" id="4606855">:=</span>&nbsp;<span class="num" id="4606858">0</span><span class="op" id="4606859">;</span>&nbsp;<span class="ident" id="4606861">i</span>&nbsp;<span class="op" id="4606863">&lt;</span>&nbsp;<span class="num" id="4606865">256</span><span class="op" id="4606868">;</span>&nbsp;<span class="ident" id="4606870">i</span><span class="op" id="4606871">++</span>&nbsp;<span class="op" id="4606874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4606878">j</span>&nbsp;<span class="op" id="4606880">+=</span>&nbsp;<span class="builtintype" id="4606883">uint8</span><span class="op" id="4606888">(</span><span class="ident" id="4606889">c</span><span class="op" id="4606890">.</span><span class="ident" id="4606891">s</span><span class="op" id="4606892">[</span><span class="ident" id="4606893">i</span><span class="op" id="4606894">]</span><span class="op" id="4606895">)</span>&nbsp;<span class="op" id="4606897">+</span>&nbsp;<span class="ident" id="4606899">key</span><span class="op" id="4606902">[</span><span class="ident" id="4606903">i</span><span class="op" id="4606904">%</span><span class="ident" id="4606905">k</span><span class="op" id="4606906">]</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4606910">c</span><span class="op" id="4606911">.</span><span class="ident" id="4606912">s</span><span class="op" id="4606913">[</span><span class="ident" id="4606914">i</span><span class="op" id="4606915">]</span><span class="op" id="4606916">,</span>&nbsp;<span class="ident" id="4606918">c</span><span class="op" id="4606919">.</span><span class="ident" id="4606920">s</span><span class="op" id="4606921">[</span><span class="ident" id="4606922">j</span><span class="op" id="4606923">]</span>&nbsp;<span class="op" id="4606925">=</span>&nbsp;<span class="ident" id="4606927">c</span><span class="op" id="4606928">.</span><span class="ident" id="4606929">s</span><span class="op" id="4606930">[</span><span class="ident" id="4606931">j</span><span class="op" id="4606932">]</span><span class="op" id="4606933">,</span>&nbsp;<span class="ident" id="4606935">c</span><span class="op" id="4606936">.</span><span class="ident" id="4606937">s</span><span class="op" id="4606938">[</span><span class="ident" id="4606939">i</span><span class="op" id="4606940">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4606943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4606946">return</span>&nbsp;<span class="op" id="4606953">&amp;</span><span class="ident" id="4606954">c</span><span class="op" id="4606955">,</span>&nbsp;<span class="ident" id="4606957">nil</span><br>
<span class="lineno"></span><span class="op" id="4606961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="4606964">//&nbsp;Reset&nbsp;zeros&nbsp;the&nbsp;key&nbsp;data&nbsp;so&nbsp;that&nbsp;it&nbsp;will&nbsp;no&nbsp;longer&nbsp;appear&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4607032">//&nbsp;process&#39;s&nbsp;memory.</span><br>
<span class="lineno"></span><span class="keyword" id="4607053">func</span>&nbsp;<span class="op" id="4607058">(</span><span class="ident" id="4607059">c</span>&nbsp;<span class="op" id="4607061">*</span><span class="ident" id="4607062">Cipher</span><span class="op" id="4607068">)</span>&nbsp;<span class="ident" id="4607070">Reset</span><span class="op" id="4607075">(</span><span class="op" id="4607076">)</span>&nbsp;<span class="op" id="4607078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4607081">for</span>&nbsp;<span class="ident" id="4607085">i</span>&nbsp;<span class="op" id="4607087">:=</span>&nbsp;<span class="keyword" id="4607090">range</span>&nbsp;<span class="ident" id="4607096">c</span><span class="op" id="4607097">.</span><span class="ident" id="4607098">s</span>&nbsp;<span class="op" id="4607100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4607104">c</span><span class="op" id="4607105">.</span><span class="ident" id="4607106">s</span><span class="op" id="4607107">[</span><span class="ident" id="4607108">i</span><span class="op" id="4607109">]</span>&nbsp;<span class="op" id="4607111">=</span>&nbsp;<span class="num" id="4607113">0</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4607116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4607119">c</span><span class="op" id="4607120">.</span><span class="ident" id="4607121">i</span><span class="op" id="4607122">,</span>&nbsp;<span class="ident" id="4607124">c</span><span class="op" id="4607125">.</span><span class="ident" id="4607126">j</span>&nbsp;<span class="op" id="4607128">=</span>&nbsp;<span class="num" id="4607130">0</span><span class="op" id="4607131">,</span>&nbsp;<span class="num" id="4607133">0</span><br>
<span class="lineno"></span><span class="op" id="4607135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4607138">//&nbsp;xorKeyStreamGeneric&nbsp;sets&nbsp;dst&nbsp;to&nbsp;the&nbsp;result&nbsp;of&nbsp;XORing&nbsp;src&nbsp;with&nbsp;the</span><br>
<span class="lineno">55</span><span class="comment" id="4607207">//&nbsp;key&nbsp;stream.&nbsp;&nbsp;Dst&nbsp;and&nbsp;src&nbsp;may&nbsp;be&nbsp;the&nbsp;same&nbsp;slice&nbsp;but&nbsp;otherwise&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="4607278">//&nbsp;not&nbsp;overlap.</span><br>
<span class="lineno"></span><span class="comment" id="4607294">//</span><br>
<span class="lineno"></span><span class="comment" id="4607297">//&nbsp;This&nbsp;is&nbsp;the&nbsp;pure&nbsp;Go&nbsp;version.&nbsp;rc4_{amd64,386,arm}*&nbsp;contain&nbsp;assembly</span><br>
<span class="lineno"></span><span class="comment" id="4607367">//&nbsp;implementations.&nbsp;This&nbsp;is&nbsp;here&nbsp;for&nbsp;tests&nbsp;and&nbsp;to&nbsp;prevent&nbsp;bitrot.</span><br>
<span class="lineno">60</span><span class="keyword" id="4607433">func</span>&nbsp;<span class="op" id="4607438">(</span><span class="ident" id="4607439">c</span>&nbsp;<span class="op" id="4607441">*</span><span class="ident" id="4607442">Cipher</span><span class="op" id="4607448">)</span>&nbsp;<span class="ident" id="4607450">xorKeyStreamGeneric</span><span class="op" id="4607469">(</span><span class="ident" id="4607470">dst</span><span class="op" id="4607473">,</span>&nbsp;<span class="ident" id="4607475">src</span>&nbsp;<span class="op" id="4607479">[</span><span class="op" id="4607480">]</span><span class="builtintype" id="4607481">byte</span><span class="op" id="4607485">)</span>&nbsp;<span class="op" id="4607487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4607490">i</span><span class="op" id="4607491">,</span>&nbsp;<span class="ident" id="4607493">j</span>&nbsp;<span class="op" id="4607495">:=</span>&nbsp;<span class="ident" id="4607498">c</span><span class="op" id="4607499">.</span><span class="ident" id="4607500">i</span><span class="op" id="4607501">,</span>&nbsp;<span class="ident" id="4607503">c</span><span class="op" id="4607504">.</span><span class="ident" id="4607505">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4607508">for</span>&nbsp;<span class="ident" id="4607512">k</span><span class="op" id="4607513">,</span>&nbsp;<span class="ident" id="4607515">v</span>&nbsp;<span class="op" id="4607517">:=</span>&nbsp;<span class="keyword" id="4607520">range</span>&nbsp;<span class="ident" id="4607526">src</span>&nbsp;<span class="op" id="4607530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4607534">i</span>&nbsp;<span class="op" id="4607536">+=</span>&nbsp;<span class="num" id="4607539">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4607543">j</span>&nbsp;<span class="op" id="4607545">+=</span>&nbsp;<span class="builtintype" id="4607548">uint8</span><span class="op" id="4607553">(</span><span class="ident" id="4607554">c</span><span class="op" id="4607555">.</span><span class="ident" id="4607556">s</span><span class="op" id="4607557">[</span><span class="ident" id="4607558">i</span><span class="op" id="4607559">]</span><span class="op" id="4607560">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4607564">c</span><span class="op" id="4607565">.</span><span class="ident" id="4607566">s</span><span class="op" id="4607567">[</span><span class="ident" id="4607568">i</span><span class="op" id="4607569">]</span><span class="op" id="4607570">,</span>&nbsp;<span class="ident" id="4607572">c</span><span class="op" id="4607573">.</span><span class="ident" id="4607574">s</span><span class="op" id="4607575">[</span><span class="ident" id="4607576">j</span><span class="op" id="4607577">]</span>&nbsp;<span class="op" id="4607579">=</span>&nbsp;<span class="ident" id="4607581">c</span><span class="op" id="4607582">.</span><span class="ident" id="4607583">s</span><span class="op" id="4607584">[</span><span class="ident" id="4607585">j</span><span class="op" id="4607586">]</span><span class="op" id="4607587">,</span>&nbsp;<span class="ident" id="4607589">c</span><span class="op" id="4607590">.</span><span class="ident" id="4607591">s</span><span class="op" id="4607592">[</span><span class="ident" id="4607593">i</span><span class="op" id="4607594">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4607598">dst</span><span class="op" id="4607601">[</span><span class="ident" id="4607602">k</span><span class="op" id="4607603">]</span>&nbsp;<span class="op" id="4607605">=</span>&nbsp;<span class="ident" id="4607607">v</span>&nbsp;<span class="op" id="4607609">^</span>&nbsp;<span class="builtintype" id="4607611">uint8</span><span class="op" id="4607616">(</span><span class="ident" id="4607617">c</span><span class="op" id="4607618">.</span><span class="ident" id="4607619">s</span><span class="op" id="4607620">[</span><span class="builtintype" id="4607621">uint8</span><span class="op" id="4607626">(</span><span class="ident" id="4607627">c</span><span class="op" id="4607628">.</span><span class="ident" id="4607629">s</span><span class="op" id="4607630">[</span><span class="ident" id="4607631">i</span><span class="op" id="4607632">]</span><span class="op" id="4607633">+</span><span class="ident" id="4607634">c</span><span class="op" id="4607635">.</span><span class="ident" id="4607636">s</span><span class="op" id="4607637">[</span><span class="ident" id="4607638">j</span><span class="op" id="4607639">]</span><span class="op" id="4607640">)</span><span class="op" id="4607641">]</span><span class="op" id="4607642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4607645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4607648">c</span><span class="op" id="4607649">.</span><span class="ident" id="4607650">i</span><span class="op" id="4607651">,</span>&nbsp;<span class="ident" id="4607653">c</span><span class="op" id="4607654">.</span><span class="ident" id="4607655">j</span>&nbsp;<span class="op" id="4607657">=</span>&nbsp;<span class="ident" id="4607659">i</span><span class="op" id="4607660">,</span>&nbsp;<span class="ident" id="4607662">j</span><br>
<span class="lineno"></span><span class="op" id="4607664">}</span>
</div>
</body>
</html>
