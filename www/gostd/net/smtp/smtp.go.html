<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html" class="current">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6071442">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6071497">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6071551">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6071602">//&nbsp;Package&nbsp;smtp&nbsp;implements&nbsp;the&nbsp;Simple&nbsp;Mail&nbsp;Transfer&nbsp;Protocol&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5321.</span><br>
<span class="lineno"></span><span class="comment" id="6071687">//&nbsp;It&nbsp;also&nbsp;implements&nbsp;the&nbsp;following&nbsp;extensions:</span><br>
<span class="lineno"></span><span class="comment" id="6071735">//&nbsp;&nbsp;&nbsp;&nbsp;8BITMIME&nbsp;&nbsp;RFC&nbsp;1652</span><br>
<span class="lineno"></span><span class="comment" id="6071757">//&nbsp;&nbsp;&nbsp;&nbsp;AUTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RFC&nbsp;2554</span><br>
<span class="lineno"></span><span class="comment" id="6071779">//&nbsp;&nbsp;&nbsp;&nbsp;STARTTLS&nbsp;&nbsp;RFC&nbsp;3207</span><br>
<span class="lineno">10</span><span class="comment" id="6071801">//&nbsp;Additional&nbsp;extensions&nbsp;may&nbsp;be&nbsp;handled&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="6071853">package</span>&nbsp;<span class="ident" id="6071861">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6071867">import</span>&nbsp;<span class="op" id="6071874">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6071877">&#34;crypto/tls&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6071891">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6071910">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6071920">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6071926">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6071933">&#34;net/textproto&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6071950">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="6071960">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6071963">//&nbsp;A&nbsp;Client&nbsp;represents&nbsp;a&nbsp;client&nbsp;connection&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6072025">type</span>&nbsp;<span class="ident" id="6072030">Client</span>&nbsp;<span class="keyword" id="6072037">struct</span>&nbsp;<span class="op" id="6072044">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072047">//&nbsp;Text&nbsp;is&nbsp;the&nbsp;textproto.Conn&nbsp;used&nbsp;by&nbsp;the&nbsp;Client.&nbsp;It&nbsp;is&nbsp;exported&nbsp;to&nbsp;allow&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072126">//&nbsp;clients&nbsp;to&nbsp;add&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6072157">Text</span>&nbsp;<span class="op" id="6072162">*</span><span class="ident" id="6072163">textproto</span><span class="op" id="6072172">.</span><span class="ident" id="6072173">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072179">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;connection&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;a&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072252">//&nbsp;connection&nbsp;later</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6072273">conn</span>&nbsp;<span class="ident" id="6072278">net</span><span class="op" id="6072281">.</span><span class="ident" id="6072282">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072288">//&nbsp;whether&nbsp;the&nbsp;Client&nbsp;is&nbsp;using&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6072324">tls</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6072335">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6072341">serverName</span>&nbsp;<span class="builtintype" id="6072352">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072360">//&nbsp;map&nbsp;of&nbsp;supported&nbsp;extensions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6072392">ext</span>&nbsp;<span class="keyword" id="6072396">map</span><span class="op" id="6072399">[</span><span class="builtintype" id="6072400">string</span><span class="op" id="6072406">]</span><span class="builtintype" id="6072407">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072415">//&nbsp;supported&nbsp;auth&nbsp;mechanisms</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6072445">auth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6072456">[</span><span class="op" id="6072457">]</span><span class="builtintype" id="6072458">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6072466">localName</span>&nbsp;&nbsp;<span class="builtintype" id="6072477">string</span>&nbsp;<span class="comment" id="6072484">//&nbsp;the&nbsp;name&nbsp;to&nbsp;use&nbsp;in&nbsp;HELO/EHLO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6072517">didHello</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6072528">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6072535">//&nbsp;whether&nbsp;we&#39;ve&nbsp;said&nbsp;HELO/EHLO</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6072568">helloError</span>&nbsp;<span class="builtintype" id="6072579">error</span>&nbsp;&nbsp;<span class="comment" id="6072586">//&nbsp;the&nbsp;error&nbsp;from&nbsp;the&nbsp;hello</span><br>
<span class="lineno"></span><span class="op" id="6072614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6072617">//&nbsp;Dial&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;connected&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server&nbsp;at&nbsp;addr.</span><br>
<span class="lineno"></span><span class="comment" id="6072683">//&nbsp;The&nbsp;addr&nbsp;must&nbsp;include&nbsp;a&nbsp;port&nbsp;number.</span><br>
<span class="lineno">45</span><span class="keyword" id="6072723">func</span>&nbsp;<span class="ident" id="6072728">Dial</span><span class="op" id="6072732">(</span><span class="ident" id="6072733">addr</span>&nbsp;<span class="builtintype" id="6072738">string</span><span class="op" id="6072744">)</span>&nbsp;<span class="op" id="6072746">(</span><span class="op" id="6072747">*</span><span class="ident" id="6072748">Client</span><span class="op" id="6072754">,</span>&nbsp;<span class="builtintype" id="6072756">error</span><span class="op" id="6072761">)</span>&nbsp;<span class="op" id="6072763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6072766">conn</span><span class="op" id="6072770">,</span>&nbsp;<span class="ident" id="6072772">err</span>&nbsp;<span class="op" id="6072776">:=</span>&nbsp;<span class="ident" id="6072779">net</span><span class="op" id="6072782">.</span><span class="ident" id="6072783">Dial</span><span class="op" id="6072787">(</span><span class="string" id="6072788">&#34;tcp&#34;</span><span class="op" id="6072793">,</span>&nbsp;<span class="ident" id="6072795">addr</span><span class="op" id="6072799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6072802">if</span>&nbsp;<span class="ident" id="6072805">err</span>&nbsp;<span class="op" id="6072809">!=</span>&nbsp;<span class="builtintype" id="6072812">nil</span>&nbsp;<span class="op" id="6072816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6072820">return</span>&nbsp;<span class="builtintype" id="6072827">nil</span><span class="op" id="6072830">,</span>&nbsp;<span class="ident" id="6072832">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6072837">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6072840">host</span><span class="op" id="6072844">,</span>&nbsp;<span class="ident" id="6072846">_</span><span class="op" id="6072847">,</span>&nbsp;<span class="ident" id="6072849">_</span>&nbsp;<span class="op" id="6072851">:=</span>&nbsp;<span class="ident" id="6072854">net</span><span class="op" id="6072857">.</span><span class="ident" id="6072858">SplitHostPort</span><span class="op" id="6072871">(</span><span class="ident" id="6072872">addr</span><span class="op" id="6072876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6072879">return</span>&nbsp;<span class="ident" id="6072886">NewClient</span><span class="op" id="6072895">(</span><span class="ident" id="6072896">conn</span><span class="op" id="6072900">,</span>&nbsp;<span class="ident" id="6072902">host</span><span class="op" id="6072906">)</span><br>
<span class="lineno"></span><span class="op" id="6072908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6072911">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;using&nbsp;an&nbsp;existing&nbsp;connection&nbsp;and&nbsp;host&nbsp;as&nbsp;a</span><br>
<span class="lineno">55</span><span class="comment" id="6072988">//&nbsp;server&nbsp;name&nbsp;to&nbsp;be&nbsp;used&nbsp;when&nbsp;authenticating.</span><br>
<span class="lineno"></span><span class="keyword" id="6073035">func</span>&nbsp;<span class="ident" id="6073040">NewClient</span><span class="op" id="6073049">(</span><span class="ident" id="6073050">conn</span>&nbsp;<span class="ident" id="6073055">net</span><span class="op" id="6073058">.</span><span class="ident" id="6073059">Conn</span><span class="op" id="6073063">,</span>&nbsp;<span class="ident" id="6073065">host</span>&nbsp;<span class="builtintype" id="6073070">string</span><span class="op" id="6073076">)</span>&nbsp;<span class="op" id="6073078">(</span><span class="op" id="6073079">*</span><span class="ident" id="6073080">Client</span><span class="op" id="6073086">,</span>&nbsp;<span class="builtintype" id="6073088">error</span><span class="op" id="6073093">)</span>&nbsp;<span class="op" id="6073095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6073098">text</span>&nbsp;<span class="op" id="6073103">:=</span>&nbsp;<span class="ident" id="6073106">textproto</span><span class="op" id="6073115">.</span><span class="ident" id="6073116">NewConn</span><span class="op" id="6073123">(</span><span class="ident" id="6073124">conn</span><span class="op" id="6073128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6073131">_</span><span class="op" id="6073132">,</span>&nbsp;<span class="ident" id="6073134">_</span><span class="op" id="6073135">,</span>&nbsp;<span class="ident" id="6073137">err</span>&nbsp;<span class="op" id="6073141">:=</span>&nbsp;<span class="ident" id="6073144">text</span><span class="op" id="6073148">.</span><span class="ident" id="6073149">ReadResponse</span><span class="op" id="6073161">(</span><span class="num" id="6073162">220</span><span class="op" id="6073165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073168">if</span>&nbsp;<span class="ident" id="6073171">err</span>&nbsp;<span class="op" id="6073175">!=</span>&nbsp;<span class="builtintype" id="6073178">nil</span>&nbsp;<span class="op" id="6073182">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6073186">text</span><span class="op" id="6073190">.</span><span class="ident" id="6073191">Close</span><span class="op" id="6073196">(</span><span class="op" id="6073197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073201">return</span>&nbsp;<span class="builtintype" id="6073208">nil</span><span class="op" id="6073211">,</span>&nbsp;<span class="ident" id="6073213">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6073218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6073221">c</span>&nbsp;<span class="op" id="6073223">:=</span>&nbsp;<span class="op" id="6073226">&amp;</span><span class="ident" id="6073227">Client</span><span class="op" id="6073233">{</span><span class="ident" id="6073234">Text</span><span class="op" id="6073238">:</span>&nbsp;<span class="ident" id="6073240">text</span><span class="op" id="6073244">,</span>&nbsp;<span class="ident" id="6073246">conn</span><span class="op" id="6073250">:</span>&nbsp;<span class="ident" id="6073252">conn</span><span class="op" id="6073256">,</span>&nbsp;<span class="ident" id="6073258">serverName</span><span class="op" id="6073268">:</span>&nbsp;<span class="ident" id="6073270">host</span><span class="op" id="6073274">,</span>&nbsp;<span class="ident" id="6073276">localName</span><span class="op" id="6073285">:</span>&nbsp;<span class="string" id="6073287">&#34;localhost&#34;</span><span class="op" id="6073298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073301">return</span>&nbsp;<span class="ident" id="6073308">c</span><span class="op" id="6073309">,</span>&nbsp;<span class="builtintype" id="6073311">nil</span><br>
<span class="lineno">65</span><span class="op" id="6073315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6073318">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6073350">func</span>&nbsp;<span class="op" id="6073355">(</span><span class="ident" id="6073356">c</span>&nbsp;<span class="op" id="6073358">*</span><span class="ident" id="6073359">Client</span><span class="op" id="6073365">)</span>&nbsp;<span class="ident" id="6073367">Close</span><span class="op" id="6073372">(</span><span class="op" id="6073373">)</span>&nbsp;<span class="builtintype" id="6073375">error</span>&nbsp;<span class="op" id="6073381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073384">return</span>&nbsp;<span class="ident" id="6073391">c</span><span class="op" id="6073392">.</span><span class="ident" id="6073393">Text</span><span class="op" id="6073397">.</span><span class="ident" id="6073398">Close</span><span class="op" id="6073403">(</span><span class="op" id="6073404">)</span><br>
<span class="lineno">70</span><span class="op" id="6073406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6073409">//&nbsp;hello&nbsp;runs&nbsp;a&nbsp;hello&nbsp;exchange&nbsp;if&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="6073451">func</span>&nbsp;<span class="op" id="6073456">(</span><span class="ident" id="6073457">c</span>&nbsp;<span class="op" id="6073459">*</span><span class="ident" id="6073460">Client</span><span class="op" id="6073466">)</span>&nbsp;<span class="ident" id="6073468">hello</span><span class="op" id="6073473">(</span><span class="op" id="6073474">)</span>&nbsp;<span class="builtintype" id="6073476">error</span>&nbsp;<span class="op" id="6073482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073485">if</span>&nbsp;<span class="op" id="6073488">!</span><span class="ident" id="6073489">c</span><span class="op" id="6073490">.</span><span class="ident" id="6073491">didHello</span>&nbsp;<span class="op" id="6073500">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6073504">c</span><span class="op" id="6073505">.</span><span class="ident" id="6073506">didHello</span>&nbsp;<span class="op" id="6073515">=</span>&nbsp;<span class="builtintype" id="6073517">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6073524">err</span>&nbsp;<span class="op" id="6073528">:=</span>&nbsp;<span class="ident" id="6073531">c</span><span class="op" id="6073532">.</span><span class="ident" id="6073533">ehlo</span><span class="op" id="6073537">(</span><span class="op" id="6073538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073542">if</span>&nbsp;<span class="ident" id="6073545">err</span>&nbsp;<span class="op" id="6073549">!=</span>&nbsp;<span class="builtintype" id="6073552">nil</span>&nbsp;<span class="op" id="6073556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6073561">c</span><span class="op" id="6073562">.</span><span class="ident" id="6073563">helloError</span>&nbsp;<span class="op" id="6073574">=</span>&nbsp;<span class="ident" id="6073576">c</span><span class="op" id="6073577">.</span><span class="ident" id="6073578">helo</span><span class="op" id="6073582">(</span><span class="op" id="6073583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6073587">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6073590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073593">return</span>&nbsp;<span class="ident" id="6073600">c</span><span class="op" id="6073601">.</span><span class="ident" id="6073602">helloError</span><br>
<span class="lineno"></span><span class="op" id="6073613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6073616">//&nbsp;Hello&nbsp;sends&nbsp;a&nbsp;HELO&nbsp;or&nbsp;EHLO&nbsp;to&nbsp;the&nbsp;server&nbsp;as&nbsp;the&nbsp;given&nbsp;host&nbsp;name.</span><br>
<span class="lineno">85</span><span class="comment" id="6073684">//&nbsp;Calling&nbsp;this&nbsp;method&nbsp;is&nbsp;only&nbsp;necessary&nbsp;if&nbsp;the&nbsp;client&nbsp;needs&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="6073753">//&nbsp;over&nbsp;the&nbsp;host&nbsp;name&nbsp;used.&nbsp;&nbsp;The&nbsp;client&nbsp;will&nbsp;introduce&nbsp;itself&nbsp;as&nbsp;&#34;localhost&#34;</span><br>
<span class="lineno"></span><span class="comment" id="6073830">//&nbsp;automatically&nbsp;otherwise.&nbsp;&nbsp;If&nbsp;Hello&nbsp;is&nbsp;called,&nbsp;it&nbsp;must&nbsp;be&nbsp;called&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="6073904">//&nbsp;any&nbsp;of&nbsp;the&nbsp;other&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="6073933">func</span>&nbsp;<span class="op" id="6073938">(</span><span class="ident" id="6073939">c</span>&nbsp;<span class="op" id="6073941">*</span><span class="ident" id="6073942">Client</span><span class="op" id="6073948">)</span>&nbsp;<span class="ident" id="6073950">Hello</span><span class="op" id="6073955">(</span><span class="ident" id="6073956">localName</span>&nbsp;<span class="builtintype" id="6073966">string</span><span class="op" id="6073972">)</span>&nbsp;<span class="builtintype" id="6073974">error</span>&nbsp;<span class="op" id="6073980">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073983">if</span>&nbsp;<span class="ident" id="6073986">c</span><span class="op" id="6073987">.</span><span class="ident" id="6073988">didHello</span>&nbsp;<span class="op" id="6073997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074001">return</span>&nbsp;<span class="ident" id="6074008">errors</span><span class="op" id="6074014">.</span><span class="ident" id="6074015">New</span><span class="op" id="6074018">(</span><span class="string" id="6074019">&#34;smtp:&nbsp;Hello&nbsp;called&nbsp;after&nbsp;other&nbsp;methods&#34;</span><span class="op" id="6074059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6074062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074065">c</span><span class="op" id="6074066">.</span><span class="ident" id="6074067">localName</span>&nbsp;<span class="op" id="6074077">=</span>&nbsp;<span class="ident" id="6074079">localName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074090">return</span>&nbsp;<span class="ident" id="6074097">c</span><span class="op" id="6074098">.</span><span class="ident" id="6074099">hello</span><span class="op" id="6074104">(</span><span class="op" id="6074105">)</span><br>
<span class="lineno">95</span><span class="op" id="6074107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6074110">//&nbsp;cmd&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;that&nbsp;sends&nbsp;a&nbsp;command&nbsp;and&nbsp;returns&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span><span class="keyword" id="6074189">func</span>&nbsp;<span class="op" id="6074194">(</span><span class="ident" id="6074195">c</span>&nbsp;<span class="op" id="6074197">*</span><span class="ident" id="6074198">Client</span><span class="op" id="6074204">)</span>&nbsp;<span class="ident" id="6074206">cmd</span><span class="op" id="6074209">(</span><span class="ident" id="6074210">expectCode</span>&nbsp;<span class="builtintype" id="6074221">int</span><span class="op" id="6074224">,</span>&nbsp;<span class="ident" id="6074226">format</span>&nbsp;<span class="builtintype" id="6074233">string</span><span class="op" id="6074239">,</span>&nbsp;<span class="ident" id="6074241">args</span>&nbsp;<span class="op" id="6074246">...</span><span class="keyword" id="6074249">interface</span><span class="op" id="6074258">{</span><span class="op" id="6074259">}</span><span class="op" id="6074260">)</span>&nbsp;<span class="op" id="6074262">(</span><span class="builtintype" id="6074263">int</span><span class="op" id="6074266">,</span>&nbsp;<span class="builtintype" id="6074268">string</span><span class="op" id="6074274">,</span>&nbsp;<span class="builtintype" id="6074276">error</span><span class="op" id="6074281">)</span>&nbsp;<span class="op" id="6074283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074286">id</span><span class="op" id="6074288">,</span>&nbsp;<span class="ident" id="6074290">err</span>&nbsp;<span class="op" id="6074294">:=</span>&nbsp;<span class="ident" id="6074297">c</span><span class="op" id="6074298">.</span><span class="ident" id="6074299">Text</span><span class="op" id="6074303">.</span><span class="ident" id="6074304">Cmd</span><span class="op" id="6074307">(</span><span class="ident" id="6074308">format</span><span class="op" id="6074314">,</span>&nbsp;<span class="ident" id="6074316">args</span><span class="op" id="6074320">...</span><span class="op" id="6074323">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074326">if</span>&nbsp;<span class="ident" id="6074329">err</span>&nbsp;<span class="op" id="6074333">!=</span>&nbsp;<span class="builtintype" id="6074336">nil</span>&nbsp;<span class="op" id="6074340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074344">return</span>&nbsp;<span class="num" id="6074351">0</span><span class="op" id="6074352">,</span>&nbsp;<span class="string" id="6074354">&#34;&#34;</span><span class="op" id="6074356">,</span>&nbsp;<span class="ident" id="6074358">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6074363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074366">c</span><span class="op" id="6074367">.</span><span class="ident" id="6074368">Text</span><span class="op" id="6074372">.</span><span class="ident" id="6074373">StartResponse</span><span class="op" id="6074386">(</span><span class="ident" id="6074387">id</span><span class="op" id="6074389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074392">defer</span>&nbsp;<span class="ident" id="6074398">c</span><span class="op" id="6074399">.</span><span class="ident" id="6074400">Text</span><span class="op" id="6074404">.</span><span class="ident" id="6074405">EndResponse</span><span class="op" id="6074416">(</span><span class="ident" id="6074417">id</span><span class="op" id="6074419">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074422">code</span><span class="op" id="6074426">,</span>&nbsp;<span class="ident" id="6074428">msg</span><span class="op" id="6074431">,</span>&nbsp;<span class="ident" id="6074433">err</span>&nbsp;<span class="op" id="6074437">:=</span>&nbsp;<span class="ident" id="6074440">c</span><span class="op" id="6074441">.</span><span class="ident" id="6074442">Text</span><span class="op" id="6074446">.</span><span class="ident" id="6074447">ReadResponse</span><span class="op" id="6074459">(</span><span class="ident" id="6074460">expectCode</span><span class="op" id="6074470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074473">return</span>&nbsp;<span class="ident" id="6074480">code</span><span class="op" id="6074484">,</span>&nbsp;<span class="ident" id="6074486">msg</span><span class="op" id="6074489">,</span>&nbsp;<span class="ident" id="6074491">err</span><br>
<span class="lineno"></span><span class="op" id="6074495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6074498">//&nbsp;helo&nbsp;sends&nbsp;the&nbsp;HELO&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;when&nbsp;the</span><br>
<span class="lineno">110</span><span class="comment" id="6074577">//&nbsp;server&nbsp;does&nbsp;not&nbsp;support&nbsp;ehlo.</span><br>
<span class="lineno"></span><span class="keyword" id="6074610">func</span>&nbsp;<span class="op" id="6074615">(</span><span class="ident" id="6074616">c</span>&nbsp;<span class="op" id="6074618">*</span><span class="ident" id="6074619">Client</span><span class="op" id="6074625">)</span>&nbsp;<span class="ident" id="6074627">helo</span><span class="op" id="6074631">(</span><span class="op" id="6074632">)</span>&nbsp;<span class="builtintype" id="6074634">error</span>&nbsp;<span class="op" id="6074640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074643">c</span><span class="op" id="6074644">.</span><span class="ident" id="6074645">ext</span>&nbsp;<span class="op" id="6074649">=</span>&nbsp;<span class="builtintype" id="6074651">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074656">_</span><span class="op" id="6074657">,</span>&nbsp;<span class="ident" id="6074659">_</span><span class="op" id="6074660">,</span>&nbsp;<span class="ident" id="6074662">err</span>&nbsp;<span class="op" id="6074666">:=</span>&nbsp;<span class="ident" id="6074669">c</span><span class="op" id="6074670">.</span><span class="ident" id="6074671">cmd</span><span class="op" id="6074674">(</span><span class="num" id="6074675">250</span><span class="op" id="6074678">,</span>&nbsp;<span class="string" id="6074680">&#34;HELO&nbsp;%s&#34;</span><span class="op" id="6074689">,</span>&nbsp;<span class="ident" id="6074691">c</span><span class="op" id="6074692">.</span><span class="ident" id="6074693">localName</span><span class="op" id="6074702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074705">return</span>&nbsp;<span class="ident" id="6074712">err</span><br>
<span class="lineno">115</span><span class="op" id="6074716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6074719">//&nbsp;ehlo&nbsp;sends&nbsp;the&nbsp;EHLO&nbsp;(extended&nbsp;hello)&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="6074786">//&nbsp;should&nbsp;be&nbsp;the&nbsp;preferred&nbsp;greeting&nbsp;for&nbsp;servers&nbsp;that&nbsp;support&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="6074851">func</span>&nbsp;<span class="op" id="6074856">(</span><span class="ident" id="6074857">c</span>&nbsp;<span class="op" id="6074859">*</span><span class="ident" id="6074860">Client</span><span class="op" id="6074866">)</span>&nbsp;<span class="ident" id="6074868">ehlo</span><span class="op" id="6074872">(</span><span class="op" id="6074873">)</span>&nbsp;<span class="builtintype" id="6074875">error</span>&nbsp;<span class="op" id="6074881">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074884">_</span><span class="op" id="6074885">,</span>&nbsp;<span class="ident" id="6074887">msg</span><span class="op" id="6074890">,</span>&nbsp;<span class="ident" id="6074892">err</span>&nbsp;<span class="op" id="6074896">:=</span>&nbsp;<span class="ident" id="6074899">c</span><span class="op" id="6074900">.</span><span class="ident" id="6074901">cmd</span><span class="op" id="6074904">(</span><span class="num" id="6074905">250</span><span class="op" id="6074908">,</span>&nbsp;<span class="string" id="6074910">&#34;EHLO&nbsp;%s&#34;</span><span class="op" id="6074919">,</span>&nbsp;<span class="ident" id="6074921">c</span><span class="op" id="6074922">.</span><span class="ident" id="6074923">localName</span><span class="op" id="6074932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074935">if</span>&nbsp;<span class="ident" id="6074938">err</span>&nbsp;<span class="op" id="6074942">!=</span>&nbsp;<span class="builtintype" id="6074945">nil</span>&nbsp;<span class="op" id="6074949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074953">return</span>&nbsp;<span class="ident" id="6074960">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6074965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074968">ext</span>&nbsp;<span class="op" id="6074972">:=</span>&nbsp;<span class="builtinfunc" id="6074975">make</span><span class="op" id="6074979">(</span><span class="keyword" id="6074980">map</span><span class="op" id="6074983">[</span><span class="builtintype" id="6074984">string</span><span class="op" id="6074990">]</span><span class="builtintype" id="6074991">string</span><span class="op" id="6074997">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075000">extList</span>&nbsp;<span class="op" id="6075008">:=</span>&nbsp;<span class="ident" id="6075011">strings</span><span class="op" id="6075018">.</span><span class="ident" id="6075019">Split</span><span class="op" id="6075024">(</span><span class="ident" id="6075025">msg</span><span class="op" id="6075028">,</span>&nbsp;<span class="string" id="6075030">&#34;\n&#34;</span><span class="op" id="6075034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075037">if</span>&nbsp;<span class="builtinfunc" id="6075040">len</span><span class="op" id="6075043">(</span><span class="ident" id="6075044">extList</span><span class="op" id="6075051">)</span>&nbsp;<span class="op" id="6075053">&gt;</span>&nbsp;<span class="num" id="6075055">1</span>&nbsp;<span class="op" id="6075057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075061">extList</span>&nbsp;<span class="op" id="6075069">=</span>&nbsp;<span class="ident" id="6075071">extList</span><span class="op" id="6075078">[</span><span class="num" id="6075079">1</span><span class="op" id="6075080">:</span><span class="op" id="6075081">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075085">for</span>&nbsp;<span class="ident" id="6075089">_</span><span class="op" id="6075090">,</span>&nbsp;<span class="ident" id="6075092">line</span>&nbsp;<span class="op" id="6075097">:=</span>&nbsp;<span class="keyword" id="6075100">range</span>&nbsp;<span class="ident" id="6075106">extList</span>&nbsp;<span class="op" id="6075114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075119">args</span>&nbsp;<span class="op" id="6075124">:=</span>&nbsp;<span class="ident" id="6075127">strings</span><span class="op" id="6075134">.</span><span class="ident" id="6075135">SplitN</span><span class="op" id="6075141">(</span><span class="ident" id="6075142">line</span><span class="op" id="6075146">,</span>&nbsp;<span class="string" id="6075148">&#34;&nbsp;&#34;</span><span class="op" id="6075151">,</span>&nbsp;<span class="num" id="6075153">2</span><span class="op" id="6075154">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075159">if</span>&nbsp;<span class="builtinfunc" id="6075162">len</span><span class="op" id="6075165">(</span><span class="ident" id="6075166">args</span><span class="op" id="6075170">)</span>&nbsp;<span class="op" id="6075172">&gt;</span>&nbsp;<span class="num" id="6075174">1</span>&nbsp;<span class="op" id="6075176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075182">ext</span><span class="op" id="6075185">[</span><span class="ident" id="6075186">args</span><span class="op" id="6075190">[</span><span class="num" id="6075191">0</span><span class="op" id="6075192">]</span><span class="op" id="6075193">]</span>&nbsp;<span class="op" id="6075195">=</span>&nbsp;<span class="ident" id="6075197">args</span><span class="op" id="6075201">[</span><span class="num" id="6075202">1</span><span class="op" id="6075203">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6075208">}</span>&nbsp;<span class="keyword" id="6075210">else</span>&nbsp;<span class="op" id="6075215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075221">ext</span><span class="op" id="6075224">[</span><span class="ident" id="6075225">args</span><span class="op" id="6075229">[</span><span class="num" id="6075230">0</span><span class="op" id="6075231">]</span><span class="op" id="6075232">]</span>&nbsp;<span class="op" id="6075234">=</span>&nbsp;<span class="string" id="6075236">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6075242">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6075246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6075249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075252">if</span>&nbsp;<span class="ident" id="6075255">mechs</span><span class="op" id="6075260">,</span>&nbsp;<span class="ident" id="6075262">ok</span>&nbsp;<span class="op" id="6075265">:=</span>&nbsp;<span class="ident" id="6075268">ext</span><span class="op" id="6075271">[</span><span class="string" id="6075272">&#34;AUTH&#34;</span><span class="op" id="6075278">]</span><span class="op" id="6075279">;</span>&nbsp;<span class="ident" id="6075281">ok</span>&nbsp;<span class="op" id="6075284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075288">c</span><span class="op" id="6075289">.</span><span class="ident" id="6075290">auth</span>&nbsp;<span class="op" id="6075295">=</span>&nbsp;<span class="ident" id="6075297">strings</span><span class="op" id="6075304">.</span><span class="ident" id="6075305">Split</span><span class="op" id="6075310">(</span><span class="ident" id="6075311">mechs</span><span class="op" id="6075316">,</span>&nbsp;<span class="string" id="6075318">&#34;&nbsp;&#34;</span><span class="op" id="6075321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6075324">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075327">c</span><span class="op" id="6075328">.</span><span class="ident" id="6075329">ext</span>&nbsp;<span class="op" id="6075333">=</span>&nbsp;<span class="ident" id="6075335">ext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075340">return</span>&nbsp;<span class="ident" id="6075347">err</span><br>
<span class="lineno"></span><span class="op" id="6075351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6075354">//&nbsp;StartTLS&nbsp;sends&nbsp;the&nbsp;STARTTLS&nbsp;command&nbsp;and&nbsp;encrypts&nbsp;all&nbsp;further&nbsp;communication.</span><br>
<span class="lineno">145</span><span class="comment" id="6075433">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;STARTTLS&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="6075510">func</span>&nbsp;<span class="op" id="6075515">(</span><span class="ident" id="6075516">c</span>&nbsp;<span class="op" id="6075518">*</span><span class="ident" id="6075519">Client</span><span class="op" id="6075525">)</span>&nbsp;<span class="ident" id="6075527">StartTLS</span><span class="op" id="6075535">(</span><span class="ident" id="6075536">config</span>&nbsp;<span class="op" id="6075543">*</span><span class="ident" id="6075544">tls</span><span class="op" id="6075547">.</span><span class="ident" id="6075548">Config</span><span class="op" id="6075554">)</span>&nbsp;<span class="builtintype" id="6075556">error</span>&nbsp;<span class="op" id="6075562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075565">if</span>&nbsp;<span class="ident" id="6075568">err</span>&nbsp;<span class="op" id="6075572">:=</span>&nbsp;<span class="ident" id="6075575">c</span><span class="op" id="6075576">.</span><span class="ident" id="6075577">hello</span><span class="op" id="6075582">(</span><span class="op" id="6075583">)</span><span class="op" id="6075584">;</span>&nbsp;<span class="ident" id="6075586">err</span>&nbsp;<span class="op" id="6075590">!=</span>&nbsp;<span class="builtintype" id="6075593">nil</span>&nbsp;<span class="op" id="6075597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075601">return</span>&nbsp;<span class="ident" id="6075608">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6075613">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075616">_</span><span class="op" id="6075617">,</span>&nbsp;<span class="ident" id="6075619">_</span><span class="op" id="6075620">,</span>&nbsp;<span class="ident" id="6075622">err</span>&nbsp;<span class="op" id="6075626">:=</span>&nbsp;<span class="ident" id="6075629">c</span><span class="op" id="6075630">.</span><span class="ident" id="6075631">cmd</span><span class="op" id="6075634">(</span><span class="num" id="6075635">220</span><span class="op" id="6075638">,</span>&nbsp;<span class="string" id="6075640">&#34;STARTTLS&#34;</span><span class="op" id="6075650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075653">if</span>&nbsp;<span class="ident" id="6075656">err</span>&nbsp;<span class="op" id="6075660">!=</span>&nbsp;<span class="builtintype" id="6075663">nil</span>&nbsp;<span class="op" id="6075667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075671">return</span>&nbsp;<span class="ident" id="6075678">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6075683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075686">c</span><span class="op" id="6075687">.</span><span class="ident" id="6075688">conn</span>&nbsp;<span class="op" id="6075693">=</span>&nbsp;<span class="ident" id="6075695">tls</span><span class="op" id="6075698">.</span><span class="ident" id="6075699">Client</span><span class="op" id="6075705">(</span><span class="ident" id="6075706">c</span><span class="op" id="6075707">.</span><span class="ident" id="6075708">conn</span><span class="op" id="6075712">,</span>&nbsp;<span class="ident" id="6075714">config</span><span class="op" id="6075720">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075723">c</span><span class="op" id="6075724">.</span><span class="ident" id="6075725">Text</span>&nbsp;<span class="op" id="6075730">=</span>&nbsp;<span class="ident" id="6075732">textproto</span><span class="op" id="6075741">.</span><span class="ident" id="6075742">NewConn</span><span class="op" id="6075749">(</span><span class="ident" id="6075750">c</span><span class="op" id="6075751">.</span><span class="ident" id="6075752">conn</span><span class="op" id="6075756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075759">c</span><span class="op" id="6075760">.</span><span class="ident" id="6075761">tls</span>&nbsp;<span class="op" id="6075765">=</span>&nbsp;<span class="builtintype" id="6075767">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075773">return</span>&nbsp;<span class="ident" id="6075780">c</span><span class="op" id="6075781">.</span><span class="ident" id="6075782">ehlo</span><span class="op" id="6075786">(</span><span class="op" id="6075787">)</span><br>
<span class="lineno"></span><span class="op" id="6075789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6075792">//&nbsp;Verify&nbsp;checks&nbsp;the&nbsp;validity&nbsp;of&nbsp;an&nbsp;email&nbsp;address&nbsp;on&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6075857">//&nbsp;If&nbsp;Verify&nbsp;returns&nbsp;nil,&nbsp;the&nbsp;address&nbsp;is&nbsp;valid.&nbsp;A&nbsp;non-nil&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="6075922">//&nbsp;does&nbsp;not&nbsp;necessarily&nbsp;indicate&nbsp;an&nbsp;invalid&nbsp;address.&nbsp;Many&nbsp;servers</span><br>
<span class="lineno"></span><span class="comment" id="6075988">//&nbsp;will&nbsp;not&nbsp;verify&nbsp;addresses&nbsp;for&nbsp;security&nbsp;reasons.</span><br>
<span class="lineno"></span><span class="keyword" id="6076039">func</span>&nbsp;<span class="op" id="6076044">(</span><span class="ident" id="6076045">c</span>&nbsp;<span class="op" id="6076047">*</span><span class="ident" id="6076048">Client</span><span class="op" id="6076054">)</span>&nbsp;<span class="ident" id="6076056">Verify</span><span class="op" id="6076062">(</span><span class="ident" id="6076063">addr</span>&nbsp;<span class="builtintype" id="6076068">string</span><span class="op" id="6076074">)</span>&nbsp;<span class="builtintype" id="6076076">error</span>&nbsp;<span class="op" id="6076082">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076085">if</span>&nbsp;<span class="ident" id="6076088">err</span>&nbsp;<span class="op" id="6076092">:=</span>&nbsp;<span class="ident" id="6076095">c</span><span class="op" id="6076096">.</span><span class="ident" id="6076097">hello</span><span class="op" id="6076102">(</span><span class="op" id="6076103">)</span><span class="op" id="6076104">;</span>&nbsp;<span class="ident" id="6076106">err</span>&nbsp;<span class="op" id="6076110">!=</span>&nbsp;<span class="builtintype" id="6076113">nil</span>&nbsp;<span class="op" id="6076117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076121">return</span>&nbsp;<span class="ident" id="6076128">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6076133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076136">_</span><span class="op" id="6076137">,</span>&nbsp;<span class="ident" id="6076139">_</span><span class="op" id="6076140">,</span>&nbsp;<span class="ident" id="6076142">err</span>&nbsp;<span class="op" id="6076146">:=</span>&nbsp;<span class="ident" id="6076149">c</span><span class="op" id="6076150">.</span><span class="ident" id="6076151">cmd</span><span class="op" id="6076154">(</span><span class="num" id="6076155">250</span><span class="op" id="6076158">,</span>&nbsp;<span class="string" id="6076160">&#34;VRFY&nbsp;%s&#34;</span><span class="op" id="6076169">,</span>&nbsp;<span class="ident" id="6076171">addr</span><span class="op" id="6076175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076178">return</span>&nbsp;<span class="ident" id="6076185">err</span><br>
<span class="lineno">170</span><span class="op" id="6076189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6076192">//&nbsp;Auth&nbsp;authenticates&nbsp;a&nbsp;client&nbsp;using&nbsp;the&nbsp;provided&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="comment" id="6076268">//&nbsp;A&nbsp;failed&nbsp;authentication&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="6076318">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;AUTH&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno">175</span><span class="keyword" id="6076391">func</span>&nbsp;<span class="op" id="6076396">(</span><span class="ident" id="6076397">c</span>&nbsp;<span class="op" id="6076399">*</span><span class="ident" id="6076400">Client</span><span class="op" id="6076406">)</span>&nbsp;<span class="ident" id="6076408">Auth</span><span class="op" id="6076412">(</span><span class="ident" id="6076413">a</span>&nbsp;<span class="ident" id="6076415">Auth</span><span class="op" id="6076419">)</span>&nbsp;<span class="builtintype" id="6076421">error</span>&nbsp;<span class="op" id="6076427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076430">if</span>&nbsp;<span class="ident" id="6076433">err</span>&nbsp;<span class="op" id="6076437">:=</span>&nbsp;<span class="ident" id="6076440">c</span><span class="op" id="6076441">.</span><span class="ident" id="6076442">hello</span><span class="op" id="6076447">(</span><span class="op" id="6076448">)</span><span class="op" id="6076449">;</span>&nbsp;<span class="ident" id="6076451">err</span>&nbsp;<span class="op" id="6076455">!=</span>&nbsp;<span class="builtintype" id="6076458">nil</span>&nbsp;<span class="op" id="6076462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076466">return</span>&nbsp;<span class="ident" id="6076473">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6076478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076481">encoding</span>&nbsp;<span class="op" id="6076490">:=</span>&nbsp;<span class="ident" id="6076493">base64</span><span class="op" id="6076499">.</span><span class="ident" id="6076500">StdEncoding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076513">mech</span><span class="op" id="6076517">,</span>&nbsp;<span class="ident" id="6076519">resp</span><span class="op" id="6076523">,</span>&nbsp;<span class="ident" id="6076525">err</span>&nbsp;<span class="op" id="6076529">:=</span>&nbsp;<span class="ident" id="6076532">a</span><span class="op" id="6076533">.</span><span class="ident" id="6076534">Start</span><span class="op" id="6076539">(</span><span class="op" id="6076540">&amp;</span><span class="ident" id="6076541">ServerInfo</span><span class="op" id="6076551">{</span><span class="ident" id="6076552">c</span><span class="op" id="6076553">.</span><span class="ident" id="6076554">serverName</span><span class="op" id="6076564">,</span>&nbsp;<span class="ident" id="6076566">c</span><span class="op" id="6076567">.</span><span class="ident" id="6076568">tls</span><span class="op" id="6076571">,</span>&nbsp;<span class="ident" id="6076573">c</span><span class="op" id="6076574">.</span><span class="ident" id="6076575">auth</span><span class="op" id="6076579">}</span><span class="op" id="6076580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076583">if</span>&nbsp;<span class="ident" id="6076586">err</span>&nbsp;<span class="op" id="6076590">!=</span>&nbsp;<span class="builtintype" id="6076593">nil</span>&nbsp;<span class="op" id="6076597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076601">c</span><span class="op" id="6076602">.</span><span class="ident" id="6076603">Quit</span><span class="op" id="6076607">(</span><span class="op" id="6076608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076612">return</span>&nbsp;<span class="ident" id="6076619">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6076624">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076627">resp64</span>&nbsp;<span class="op" id="6076634">:=</span>&nbsp;<span class="builtinfunc" id="6076637">make</span><span class="op" id="6076641">(</span><span class="op" id="6076642">[</span><span class="op" id="6076643">]</span><span class="builtintype" id="6076644">byte</span><span class="op" id="6076648">,</span>&nbsp;<span class="ident" id="6076650">encoding</span><span class="op" id="6076658">.</span><span class="ident" id="6076659">EncodedLen</span><span class="op" id="6076669">(</span><span class="builtinfunc" id="6076670">len</span><span class="op" id="6076673">(</span><span class="ident" id="6076674">resp</span><span class="op" id="6076678">)</span><span class="op" id="6076679">)</span><span class="op" id="6076680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076683">encoding</span><span class="op" id="6076691">.</span><span class="ident" id="6076692">Encode</span><span class="op" id="6076698">(</span><span class="ident" id="6076699">resp64</span><span class="op" id="6076705">,</span>&nbsp;<span class="ident" id="6076707">resp</span><span class="op" id="6076711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076714">code</span><span class="op" id="6076718">,</span>&nbsp;<span class="ident" id="6076720">msg64</span><span class="op" id="6076725">,</span>&nbsp;<span class="ident" id="6076727">err</span>&nbsp;<span class="op" id="6076731">:=</span>&nbsp;<span class="ident" id="6076734">c</span><span class="op" id="6076735">.</span><span class="ident" id="6076736">cmd</span><span class="op" id="6076739">(</span><span class="num" id="6076740">0</span><span class="op" id="6076741">,</span>&nbsp;<span class="string" id="6076743">&#34;AUTH&nbsp;%s&nbsp;%s&#34;</span><span class="op" id="6076755">,</span>&nbsp;<span class="ident" id="6076757">mech</span><span class="op" id="6076761">,</span>&nbsp;<span class="ident" id="6076763">resp64</span><span class="op" id="6076769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076772">for</span>&nbsp;<span class="ident" id="6076776">err</span>&nbsp;<span class="op" id="6076780">==</span>&nbsp;<span class="builtintype" id="6076783">nil</span>&nbsp;<span class="op" id="6076787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076791">var</span>&nbsp;<span class="ident" id="6076795">msg</span>&nbsp;<span class="op" id="6076799">[</span><span class="op" id="6076800">]</span><span class="builtintype" id="6076801">byte</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076808">switch</span>&nbsp;<span class="ident" id="6076815">code</span>&nbsp;<span class="op" id="6076820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076824">case</span>&nbsp;<span class="num" id="6076829">334</span><span class="op" id="6076832">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076837">msg</span><span class="op" id="6076840">,</span>&nbsp;<span class="ident" id="6076842">err</span>&nbsp;<span class="op" id="6076846">=</span>&nbsp;<span class="ident" id="6076848">encoding</span><span class="op" id="6076856">.</span><span class="ident" id="6076857">DecodeString</span><span class="op" id="6076869">(</span><span class="ident" id="6076870">msg64</span><span class="op" id="6076875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076879">case</span>&nbsp;<span class="num" id="6076884">235</span><span class="op" id="6076887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6076892">//&nbsp;the&nbsp;last&nbsp;message&nbsp;isn&#39;t&nbsp;base64&nbsp;because&nbsp;it&nbsp;isn&#39;t&nbsp;a&nbsp;challenge</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076957">msg</span>&nbsp;<span class="op" id="6076961">=</span>&nbsp;<span class="op" id="6076963">[</span><span class="op" id="6076964">]</span><span class="builtintype" id="6076965">byte</span><span class="op" id="6076969">(</span><span class="ident" id="6076970">msg64</span><span class="op" id="6076975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076979">default</span><span class="op" id="6076986">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076991">err</span>&nbsp;<span class="op" id="6076995">=</span>&nbsp;<span class="op" id="6076997">&amp;</span><span class="ident" id="6076998">textproto</span><span class="op" id="6077007">.</span><span class="ident" id="6077008">Error</span><span class="op" id="6077013">{</span><span class="ident" id="6077014">Code</span><span class="op" id="6077018">:</span>&nbsp;<span class="ident" id="6077020">code</span><span class="op" id="6077024">,</span>&nbsp;<span class="ident" id="6077026">Msg</span><span class="op" id="6077029">:</span>&nbsp;<span class="ident" id="6077031">msg64</span><span class="op" id="6077036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6077040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6077044">if</span>&nbsp;<span class="ident" id="6077047">err</span>&nbsp;<span class="op" id="6077051">==</span>&nbsp;<span class="builtintype" id="6077054">nil</span>&nbsp;<span class="op" id="6077058">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6077063">resp</span><span class="op" id="6077067">,</span>&nbsp;<span class="ident" id="6077069">err</span>&nbsp;<span class="op" id="6077073">=</span>&nbsp;<span class="ident" id="6077075">a</span><span class="op" id="6077076">.</span><span class="ident" id="6077077">Next</span><span class="op" id="6077081">(</span><span class="ident" id="6077082">msg</span><span class="op" id="6077085">,</span>&nbsp;<span class="ident" id="6077087">code</span>&nbsp;<span class="op" id="6077092">==</span>&nbsp;<span class="num" id="6077095">334</span><span class="op" id="6077098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6077102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6077106">if</span>&nbsp;<span class="ident" id="6077109">err</span>&nbsp;<span class="op" id="6077113">!=</span>&nbsp;<span class="builtintype" id="6077116">nil</span>&nbsp;<span class="op" id="6077120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6077125">//&nbsp;abort&nbsp;the&nbsp;AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6077146">c</span><span class="op" id="6077147">.</span><span class="ident" id="6077148">cmd</span><span class="op" id="6077151">(</span><span class="num" id="6077152">501</span><span class="op" id="6077155">,</span>&nbsp;<span class="string" id="6077157">&#34;*&#34;</span><span class="op" id="6077160">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6077165">c</span><span class="op" id="6077166">.</span><span class="ident" id="6077167">Quit</span><span class="op" id="6077171">(</span><span class="op" id="6077172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6077177">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6077185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6077189">if</span>&nbsp;<span class="ident" id="6077192">resp</span>&nbsp;<span class="op" id="6077197">==</span>&nbsp;<span class="builtintype" id="6077200">nil</span>&nbsp;<span class="op" id="6077204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6077209">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6077217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6077221">resp64</span>&nbsp;<span class="op" id="6077228">=</span>&nbsp;<span class="builtinfunc" id="6077230">make</span><span class="op" id="6077234">(</span><span class="op" id="6077235">[</span><span class="op" id="6077236">]</span><span class="builtintype" id="6077237">byte</span><span class="op" id="6077241">,</span>&nbsp;<span class="ident" id="6077243">encoding</span><span class="op" id="6077251">.</span><span class="ident" id="6077252">EncodedLen</span><span class="op" id="6077262">(</span><span class="builtinfunc" id="6077263">len</span><span class="op" id="6077266">(</span><span class="ident" id="6077267">resp</span><span class="op" id="6077271">)</span><span class="op" id="6077272">)</span><span class="op" id="6077273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6077277">encoding</span><span class="op" id="6077285">.</span><span class="ident" id="6077286">Encode</span><span class="op" id="6077292">(</span><span class="ident" id="6077293">resp64</span><span class="op" id="6077299">,</span>&nbsp;<span class="ident" id="6077301">resp</span><span class="op" id="6077305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6077309">code</span><span class="op" id="6077313">,</span>&nbsp;<span class="ident" id="6077315">msg64</span><span class="op" id="6077320">,</span>&nbsp;<span class="ident" id="6077322">err</span>&nbsp;<span class="op" id="6077326">=</span>&nbsp;<span class="ident" id="6077328">c</span><span class="op" id="6077329">.</span><span class="ident" id="6077330">cmd</span><span class="op" id="6077333">(</span><span class="num" id="6077334">0</span><span class="op" id="6077335">,</span>&nbsp;<span class="builtintype" id="6077337">string</span><span class="op" id="6077343">(</span><span class="ident" id="6077344">resp64</span><span class="op" id="6077350">)</span><span class="op" id="6077351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6077354">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6077357">return</span>&nbsp;<span class="ident" id="6077364">err</span><br>
<span class="lineno"></span><span class="op" id="6077368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6077371">//&nbsp;Mail&nbsp;issues&nbsp;a&nbsp;MAIL&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="6077449">//&nbsp;If&nbsp;the&nbsp;server&nbsp;supports&nbsp;the&nbsp;8BITMIME&nbsp;extension,&nbsp;Mail&nbsp;adds&nbsp;the&nbsp;BODY=8BITMIME</span><br>
<span class="lineno">220</span><span class="comment" id="6077527">//&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="6077541">//&nbsp;This&nbsp;initiates&nbsp;a&nbsp;mail&nbsp;transaction&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;Rcpt&nbsp;calls.</span><br>
<span class="lineno"></span><span class="keyword" id="6077621">func</span>&nbsp;<span class="op" id="6077626">(</span><span class="ident" id="6077627">c</span>&nbsp;<span class="op" id="6077629">*</span><span class="ident" id="6077630">Client</span><span class="op" id="6077636">)</span>&nbsp;<span class="ident" id="6077638">Mail</span><span class="op" id="6077642">(</span><span class="ident" id="6077643">from</span>&nbsp;<span class="builtintype" id="6077648">string</span><span class="op" id="6077654">)</span>&nbsp;<span class="builtintype" id="6077656">error</span>&nbsp;<span class="op" id="6077662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6077665">if</span>&nbsp;<span class="ident" id="6077668">err</span>&nbsp;<span class="op" id="6077672">:=</span>&nbsp;<span class="ident" id="6077675">c</span><span class="op" id="6077676">.</span><span class="ident" id="6077677">hello</span><span class="op" id="6077682">(</span><span class="op" id="6077683">)</span><span class="op" id="6077684">;</span>&nbsp;<span class="ident" id="6077686">err</span>&nbsp;<span class="op" id="6077690">!=</span>&nbsp;<span class="builtintype" id="6077693">nil</span>&nbsp;<span class="op" id="6077697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6077701">return</span>&nbsp;<span class="ident" id="6077708">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6077713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6077716">cmdStr</span>&nbsp;<span class="op" id="6077723">:=</span>&nbsp;<span class="string" id="6077726">&#34;MAIL&nbsp;FROM:&lt;%s&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6077744">if</span>&nbsp;<span class="ident" id="6077747">c</span><span class="op" id="6077748">.</span><span class="ident" id="6077749">ext</span>&nbsp;<span class="op" id="6077753">!=</span>&nbsp;<span class="builtintype" id="6077756">nil</span>&nbsp;<span class="op" id="6077760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6077764">if</span>&nbsp;<span class="ident" id="6077767">_</span><span class="op" id="6077768">,</span>&nbsp;<span class="ident" id="6077770">ok</span>&nbsp;<span class="op" id="6077773">:=</span>&nbsp;<span class="ident" id="6077776">c</span><span class="op" id="6077777">.</span><span class="ident" id="6077778">ext</span><span class="op" id="6077781">[</span><span class="string" id="6077782">&#34;8BITMIME&#34;</span><span class="op" id="6077792">]</span><span class="op" id="6077793">;</span>&nbsp;<span class="ident" id="6077795">ok</span>&nbsp;<span class="op" id="6077798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6077803">cmdStr</span>&nbsp;<span class="op" id="6077810">+=</span>&nbsp;<span class="string" id="6077813">&#34;&nbsp;BODY=8BITMIME&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6077832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6077835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6077838">_</span><span class="op" id="6077839">,</span>&nbsp;<span class="ident" id="6077841">_</span><span class="op" id="6077842">,</span>&nbsp;<span class="ident" id="6077844">err</span>&nbsp;<span class="op" id="6077848">:=</span>&nbsp;<span class="ident" id="6077851">c</span><span class="op" id="6077852">.</span><span class="ident" id="6077853">cmd</span><span class="op" id="6077856">(</span><span class="num" id="6077857">250</span><span class="op" id="6077860">,</span>&nbsp;<span class="ident" id="6077862">cmdStr</span><span class="op" id="6077868">,</span>&nbsp;<span class="ident" id="6077870">from</span><span class="op" id="6077874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6077877">return</span>&nbsp;<span class="ident" id="6077884">err</span><br>
<span class="lineno"></span><span class="op" id="6077888">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="6077891">//&nbsp;Rcpt&nbsp;issues&nbsp;a&nbsp;RCPT&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="6077969">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Rcpt&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Mail&nbsp;and&nbsp;may&nbsp;be&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6078045">//&nbsp;a&nbsp;Data&nbsp;call&nbsp;or&nbsp;another&nbsp;Rcpt&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="6078082">func</span>&nbsp;<span class="op" id="6078087">(</span><span class="ident" id="6078088">c</span>&nbsp;<span class="op" id="6078090">*</span><span class="ident" id="6078091">Client</span><span class="op" id="6078097">)</span>&nbsp;<span class="ident" id="6078099">Rcpt</span><span class="op" id="6078103">(</span><span class="ident" id="6078104">to</span>&nbsp;<span class="builtintype" id="6078107">string</span><span class="op" id="6078113">)</span>&nbsp;<span class="builtintype" id="6078115">error</span>&nbsp;<span class="op" id="6078121">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6078124">_</span><span class="op" id="6078125">,</span>&nbsp;<span class="ident" id="6078127">_</span><span class="op" id="6078128">,</span>&nbsp;<span class="ident" id="6078130">err</span>&nbsp;<span class="op" id="6078134">:=</span>&nbsp;<span class="ident" id="6078137">c</span><span class="op" id="6078138">.</span><span class="ident" id="6078139">cmd</span><span class="op" id="6078142">(</span><span class="num" id="6078143">25</span><span class="op" id="6078145">,</span>&nbsp;<span class="string" id="6078147">&#34;RCPT&nbsp;TO:&lt;%s&gt;&#34;</span><span class="op" id="6078161">,</span>&nbsp;<span class="ident" id="6078163">to</span><span class="op" id="6078165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6078168">return</span>&nbsp;<span class="ident" id="6078175">err</span><br>
<span class="lineno"></span><span class="op" id="6078179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6078182">type</span>&nbsp;<span class="ident" id="6078187">dataCloser</span>&nbsp;<span class="keyword" id="6078198">struct</span>&nbsp;<span class="op" id="6078205">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6078208">c</span>&nbsp;<span class="op" id="6078210">*</span><span class="ident" id="6078211">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6078219">io</span><span class="op" id="6078221">.</span><span class="ident" id="6078222">WriteCloser</span><br>
<span class="lineno"></span><span class="op" id="6078234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6078237">func</span>&nbsp;<span class="op" id="6078242">(</span><span class="ident" id="6078243">d</span>&nbsp;<span class="op" id="6078245">*</span><span class="ident" id="6078246">dataCloser</span><span class="op" id="6078256">)</span>&nbsp;<span class="ident" id="6078258">Close</span><span class="op" id="6078263">(</span><span class="op" id="6078264">)</span>&nbsp;<span class="builtintype" id="6078266">error</span>&nbsp;<span class="op" id="6078272">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6078275">d</span><span class="op" id="6078276">.</span><span class="ident" id="6078277">WriteCloser</span><span class="op" id="6078288">.</span><span class="ident" id="6078289">Close</span><span class="op" id="6078294">(</span><span class="op" id="6078295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6078298">_</span><span class="op" id="6078299">,</span>&nbsp;<span class="ident" id="6078301">_</span><span class="op" id="6078302">,</span>&nbsp;<span class="ident" id="6078304">err</span>&nbsp;<span class="op" id="6078308">:=</span>&nbsp;<span class="ident" id="6078311">d</span><span class="op" id="6078312">.</span><span class="ident" id="6078313">c</span><span class="op" id="6078314">.</span><span class="ident" id="6078315">Text</span><span class="op" id="6078319">.</span><span class="ident" id="6078320">ReadResponse</span><span class="op" id="6078332">(</span><span class="num" id="6078333">250</span><span class="op" id="6078336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6078339">return</span>&nbsp;<span class="ident" id="6078346">err</span><br>
<span class="lineno"></span><span class="op" id="6078350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="6078353">//&nbsp;Data&nbsp;issues&nbsp;a&nbsp;DATA&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;and&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="6078423">//&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;the&nbsp;data.&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the&nbsp;writer</span><br>
<span class="lineno"></span><span class="comment" id="6078492">//&nbsp;before&nbsp;calling&nbsp;any&nbsp;more&nbsp;methods&nbsp;on&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6078533">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Data&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;calls&nbsp;to&nbsp;Rcpt.</span><br>
<span class="lineno"></span><span class="keyword" id="6078598">func</span>&nbsp;<span class="op" id="6078603">(</span><span class="ident" id="6078604">c</span>&nbsp;<span class="op" id="6078606">*</span><span class="ident" id="6078607">Client</span><span class="op" id="6078613">)</span>&nbsp;<span class="ident" id="6078615">Data</span><span class="op" id="6078619">(</span><span class="op" id="6078620">)</span>&nbsp;<span class="op" id="6078622">(</span><span class="ident" id="6078623">io</span><span class="op" id="6078625">.</span><span class="ident" id="6078626">WriteCloser</span><span class="op" id="6078637">,</span>&nbsp;<span class="builtintype" id="6078639">error</span><span class="op" id="6078644">)</span>&nbsp;<span class="op" id="6078646">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6078649">_</span><span class="op" id="6078650">,</span>&nbsp;<span class="ident" id="6078652">_</span><span class="op" id="6078653">,</span>&nbsp;<span class="ident" id="6078655">err</span>&nbsp;<span class="op" id="6078659">:=</span>&nbsp;<span class="ident" id="6078662">c</span><span class="op" id="6078663">.</span><span class="ident" id="6078664">cmd</span><span class="op" id="6078667">(</span><span class="num" id="6078668">354</span><span class="op" id="6078671">,</span>&nbsp;<span class="string" id="6078673">&#34;DATA&#34;</span><span class="op" id="6078679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6078682">if</span>&nbsp;<span class="ident" id="6078685">err</span>&nbsp;<span class="op" id="6078689">!=</span>&nbsp;<span class="builtintype" id="6078692">nil</span>&nbsp;<span class="op" id="6078696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6078700">return</span>&nbsp;<span class="builtintype" id="6078707">nil</span><span class="op" id="6078710">,</span>&nbsp;<span class="ident" id="6078712">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6078717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6078720">return</span>&nbsp;<span class="op" id="6078727">&amp;</span><span class="ident" id="6078728">dataCloser</span><span class="op" id="6078738">{</span><span class="ident" id="6078739">c</span><span class="op" id="6078740">,</span>&nbsp;<span class="ident" id="6078742">c</span><span class="op" id="6078743">.</span><span class="ident" id="6078744">Text</span><span class="op" id="6078748">.</span><span class="ident" id="6078749">DotWriter</span><span class="op" id="6078758">(</span><span class="op" id="6078759">)</span><span class="op" id="6078760">}</span><span class="op" id="6078761">,</span>&nbsp;<span class="builtintype" id="6078763">nil</span><br>
<span class="lineno">265</span><span class="op" id="6078767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6078770">var</span>&nbsp;<span class="ident" id="6078774">testHookStartTLS</span>&nbsp;<span class="keyword" id="6078791">func</span><span class="op" id="6078795">(</span><span class="op" id="6078796">*</span><span class="ident" id="6078797">tls</span><span class="op" id="6078800">.</span><span class="ident" id="6078801">Config</span><span class="op" id="6078807">)</span>&nbsp;<span class="comment" id="6078809">//&nbsp;nil,&nbsp;except&nbsp;for&nbsp;tests</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6078835">//&nbsp;SendMail&nbsp;connects&nbsp;to&nbsp;the&nbsp;server&nbsp;at&nbsp;addr,&nbsp;switches&nbsp;to&nbsp;TLS&nbsp;if</span><br>
<span class="lineno">270</span><span class="comment" id="6078898">//&nbsp;possible,&nbsp;authenticates&nbsp;with&nbsp;the&nbsp;optional&nbsp;mechanism&nbsp;a&nbsp;if&nbsp;possible,</span><br>
<span class="lineno"></span><span class="comment" id="6078968">//&nbsp;and&nbsp;then&nbsp;sends&nbsp;an&nbsp;email&nbsp;from&nbsp;address&nbsp;from,&nbsp;to&nbsp;addresses&nbsp;to,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6079036">//&nbsp;message&nbsp;msg.</span><br>
<span class="lineno"></span><span class="keyword" id="6079052">func</span>&nbsp;<span class="ident" id="6079057">SendMail</span><span class="op" id="6079065">(</span><span class="ident" id="6079066">addr</span>&nbsp;<span class="builtintype" id="6079071">string</span><span class="op" id="6079077">,</span>&nbsp;<span class="ident" id="6079079">a</span>&nbsp;<span class="ident" id="6079081">Auth</span><span class="op" id="6079085">,</span>&nbsp;<span class="ident" id="6079087">from</span>&nbsp;<span class="builtintype" id="6079092">string</span><span class="op" id="6079098">,</span>&nbsp;<span class="ident" id="6079100">to</span>&nbsp;<span class="op" id="6079103">[</span><span class="op" id="6079104">]</span><span class="builtintype" id="6079105">string</span><span class="op" id="6079111">,</span>&nbsp;<span class="ident" id="6079113">msg</span>&nbsp;<span class="op" id="6079117">[</span><span class="op" id="6079118">]</span><span class="builtintype" id="6079119">byte</span><span class="op" id="6079123">)</span>&nbsp;<span class="builtintype" id="6079125">error</span>&nbsp;<span class="op" id="6079131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079134">c</span><span class="op" id="6079135">,</span>&nbsp;<span class="ident" id="6079137">err</span>&nbsp;<span class="op" id="6079141">:=</span>&nbsp;<span class="ident" id="6079144">Dial</span><span class="op" id="6079148">(</span><span class="ident" id="6079149">addr</span><span class="op" id="6079153">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079156">if</span>&nbsp;<span class="ident" id="6079159">err</span>&nbsp;<span class="op" id="6079163">!=</span>&nbsp;<span class="builtintype" id="6079166">nil</span>&nbsp;<span class="op" id="6079170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079174">return</span>&nbsp;<span class="ident" id="6079181">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079189">defer</span>&nbsp;<span class="ident" id="6079195">c</span><span class="op" id="6079196">.</span><span class="ident" id="6079197">Close</span><span class="op" id="6079202">(</span><span class="op" id="6079203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079206">if</span>&nbsp;<span class="ident" id="6079209">err</span>&nbsp;<span class="op" id="6079213">=</span>&nbsp;<span class="ident" id="6079215">c</span><span class="op" id="6079216">.</span><span class="ident" id="6079217">hello</span><span class="op" id="6079222">(</span><span class="op" id="6079223">)</span><span class="op" id="6079224">;</span>&nbsp;<span class="ident" id="6079226">err</span>&nbsp;<span class="op" id="6079230">!=</span>&nbsp;<span class="builtintype" id="6079233">nil</span>&nbsp;<span class="op" id="6079237">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079241">return</span>&nbsp;<span class="ident" id="6079248">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079256">if</span>&nbsp;<span class="ident" id="6079259">ok</span><span class="op" id="6079261">,</span>&nbsp;<span class="ident" id="6079263">_</span>&nbsp;<span class="op" id="6079265">:=</span>&nbsp;<span class="ident" id="6079268">c</span><span class="op" id="6079269">.</span><span class="ident" id="6079270">Extension</span><span class="op" id="6079279">(</span><span class="string" id="6079280">&#34;STARTTLS&#34;</span><span class="op" id="6079290">)</span><span class="op" id="6079291">;</span>&nbsp;<span class="ident" id="6079293">ok</span>&nbsp;<span class="op" id="6079296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079300">config</span>&nbsp;<span class="op" id="6079307">:=</span>&nbsp;<span class="op" id="6079310">&amp;</span><span class="ident" id="6079311">tls</span><span class="op" id="6079314">.</span><span class="ident" id="6079315">Config</span><span class="op" id="6079321">{</span><span class="ident" id="6079322">ServerName</span><span class="op" id="6079332">:</span>&nbsp;<span class="ident" id="6079334">c</span><span class="op" id="6079335">.</span><span class="ident" id="6079336">serverName</span><span class="op" id="6079346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079350">if</span>&nbsp;<span class="ident" id="6079353">testHookStartTLS</span>&nbsp;<span class="op" id="6079370">!=</span>&nbsp;<span class="builtintype" id="6079373">nil</span>&nbsp;<span class="op" id="6079377">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079382">testHookStartTLS</span><span class="op" id="6079398">(</span><span class="ident" id="6079399">config</span><span class="op" id="6079405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079413">if</span>&nbsp;<span class="ident" id="6079416">err</span>&nbsp;<span class="op" id="6079420">=</span>&nbsp;<span class="ident" id="6079422">c</span><span class="op" id="6079423">.</span><span class="ident" id="6079424">StartTLS</span><span class="op" id="6079432">(</span><span class="ident" id="6079433">config</span><span class="op" id="6079439">)</span><span class="op" id="6079440">;</span>&nbsp;<span class="ident" id="6079442">err</span>&nbsp;<span class="op" id="6079446">!=</span>&nbsp;<span class="builtintype" id="6079449">nil</span>&nbsp;<span class="op" id="6079453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079458">return</span>&nbsp;<span class="ident" id="6079465">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079471">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079477">if</span>&nbsp;<span class="ident" id="6079480">a</span>&nbsp;<span class="op" id="6079482">!=</span>&nbsp;<span class="builtintype" id="6079485">nil</span>&nbsp;<span class="op" id="6079489">&amp;&amp;</span>&nbsp;<span class="ident" id="6079492">c</span><span class="op" id="6079493">.</span><span class="ident" id="6079494">ext</span>&nbsp;<span class="op" id="6079498">!=</span>&nbsp;<span class="builtintype" id="6079501">nil</span>&nbsp;<span class="op" id="6079505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079509">if</span>&nbsp;<span class="ident" id="6079512">_</span><span class="op" id="6079513">,</span>&nbsp;<span class="ident" id="6079515">ok</span>&nbsp;<span class="op" id="6079518">:=</span>&nbsp;<span class="ident" id="6079521">c</span><span class="op" id="6079522">.</span><span class="ident" id="6079523">ext</span><span class="op" id="6079526">[</span><span class="string" id="6079527">&#34;AUTH&#34;</span><span class="op" id="6079533">]</span><span class="op" id="6079534">;</span>&nbsp;<span class="ident" id="6079536">ok</span>&nbsp;<span class="op" id="6079539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079544">if</span>&nbsp;<span class="ident" id="6079547">err</span>&nbsp;<span class="op" id="6079551">=</span>&nbsp;<span class="ident" id="6079553">c</span><span class="op" id="6079554">.</span><span class="ident" id="6079555">Auth</span><span class="op" id="6079559">(</span><span class="ident" id="6079560">a</span><span class="op" id="6079561">)</span><span class="op" id="6079562">;</span>&nbsp;<span class="ident" id="6079564">err</span>&nbsp;<span class="op" id="6079568">!=</span>&nbsp;<span class="builtintype" id="6079571">nil</span>&nbsp;<span class="op" id="6079575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079581">return</span>&nbsp;<span class="ident" id="6079588">err</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079605">if</span>&nbsp;<span class="ident" id="6079608">err</span>&nbsp;<span class="op" id="6079612">=</span>&nbsp;<span class="ident" id="6079614">c</span><span class="op" id="6079615">.</span><span class="ident" id="6079616">Mail</span><span class="op" id="6079620">(</span><span class="ident" id="6079621">from</span><span class="op" id="6079625">)</span><span class="op" id="6079626">;</span>&nbsp;<span class="ident" id="6079628">err</span>&nbsp;<span class="op" id="6079632">!=</span>&nbsp;<span class="builtintype" id="6079635">nil</span>&nbsp;<span class="op" id="6079639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079643">return</span>&nbsp;<span class="ident" id="6079650">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079658">for</span>&nbsp;<span class="ident" id="6079662">_</span><span class="op" id="6079663">,</span>&nbsp;<span class="ident" id="6079665">addr</span>&nbsp;<span class="op" id="6079670">:=</span>&nbsp;<span class="keyword" id="6079673">range</span>&nbsp;<span class="ident" id="6079679">to</span>&nbsp;<span class="op" id="6079682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079686">if</span>&nbsp;<span class="ident" id="6079689">err</span>&nbsp;<span class="op" id="6079693">=</span>&nbsp;<span class="ident" id="6079695">c</span><span class="op" id="6079696">.</span><span class="ident" id="6079697">Rcpt</span><span class="op" id="6079701">(</span><span class="ident" id="6079702">addr</span><span class="op" id="6079706">)</span><span class="op" id="6079707">;</span>&nbsp;<span class="ident" id="6079709">err</span>&nbsp;<span class="op" id="6079713">!=</span>&nbsp;<span class="builtintype" id="6079716">nil</span>&nbsp;<span class="op" id="6079720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079725">return</span>&nbsp;<span class="ident" id="6079732">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079738">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079744">w</span><span class="op" id="6079745">,</span>&nbsp;<span class="ident" id="6079747">err</span>&nbsp;<span class="op" id="6079751">:=</span>&nbsp;<span class="ident" id="6079754">c</span><span class="op" id="6079755">.</span><span class="ident" id="6079756">Data</span><span class="op" id="6079760">(</span><span class="op" id="6079761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079764">if</span>&nbsp;<span class="ident" id="6079767">err</span>&nbsp;<span class="op" id="6079771">!=</span>&nbsp;<span class="builtintype" id="6079774">nil</span>&nbsp;<span class="op" id="6079778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079782">return</span>&nbsp;<span class="ident" id="6079789">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079794">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079797">_</span><span class="op" id="6079798">,</span>&nbsp;<span class="ident" id="6079800">err</span>&nbsp;<span class="op" id="6079804">=</span>&nbsp;<span class="ident" id="6079806">w</span><span class="op" id="6079807">.</span><span class="ident" id="6079808">Write</span><span class="op" id="6079813">(</span><span class="ident" id="6079814">msg</span><span class="op" id="6079817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079820">if</span>&nbsp;<span class="ident" id="6079823">err</span>&nbsp;<span class="op" id="6079827">!=</span>&nbsp;<span class="builtintype" id="6079830">nil</span>&nbsp;<span class="op" id="6079834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079838">return</span>&nbsp;<span class="ident" id="6079845">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079853">err</span>&nbsp;<span class="op" id="6079857">=</span>&nbsp;<span class="ident" id="6079859">w</span><span class="op" id="6079860">.</span><span class="ident" id="6079861">Close</span><span class="op" id="6079866">(</span><span class="op" id="6079867">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079870">if</span>&nbsp;<span class="ident" id="6079873">err</span>&nbsp;<span class="op" id="6079877">!=</span>&nbsp;<span class="builtintype" id="6079880">nil</span>&nbsp;<span class="op" id="6079884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079888">return</span>&nbsp;<span class="ident" id="6079895">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079903">return</span>&nbsp;<span class="ident" id="6079910">c</span><span class="op" id="6079911">.</span><span class="ident" id="6079912">Quit</span><span class="op" id="6079916">(</span><span class="op" id="6079917">)</span><br>
<span class="lineno"></span><span class="op" id="6079919">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="6079922">//&nbsp;Extension&nbsp;reports&nbsp;whether&nbsp;an&nbsp;extension&nbsp;is&nbsp;support&nbsp;by&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6079990">//&nbsp;The&nbsp;extension&nbsp;name&nbsp;is&nbsp;case-insensitive.&nbsp;If&nbsp;the&nbsp;extension&nbsp;is&nbsp;supported,</span><br>
<span class="lineno"></span><span class="comment" id="6080064">//&nbsp;Extension&nbsp;also&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;contains&nbsp;any&nbsp;parameters&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6080132">//&nbsp;server&nbsp;specifies&nbsp;for&nbsp;the&nbsp;extension.</span><br>
<span class="lineno">325</span><span class="keyword" id="6080171">func</span>&nbsp;<span class="op" id="6080176">(</span><span class="ident" id="6080177">c</span>&nbsp;<span class="op" id="6080179">*</span><span class="ident" id="6080180">Client</span><span class="op" id="6080186">)</span>&nbsp;<span class="ident" id="6080188">Extension</span><span class="op" id="6080197">(</span><span class="ident" id="6080198">ext</span>&nbsp;<span class="builtintype" id="6080202">string</span><span class="op" id="6080208">)</span>&nbsp;<span class="op" id="6080210">(</span><span class="builtintype" id="6080211">bool</span><span class="op" id="6080215">,</span>&nbsp;<span class="builtintype" id="6080217">string</span><span class="op" id="6080223">)</span>&nbsp;<span class="op" id="6080225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080228">if</span>&nbsp;<span class="ident" id="6080231">err</span>&nbsp;<span class="op" id="6080235">:=</span>&nbsp;<span class="ident" id="6080238">c</span><span class="op" id="6080239">.</span><span class="ident" id="6080240">hello</span><span class="op" id="6080245">(</span><span class="op" id="6080246">)</span><span class="op" id="6080247">;</span>&nbsp;<span class="ident" id="6080249">err</span>&nbsp;<span class="op" id="6080253">!=</span>&nbsp;<span class="builtintype" id="6080256">nil</span>&nbsp;<span class="op" id="6080260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080264">return</span>&nbsp;<span class="builtintype" id="6080271">false</span><span class="op" id="6080276">,</span>&nbsp;<span class="string" id="6080278">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6080282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080285">if</span>&nbsp;<span class="ident" id="6080288">c</span><span class="op" id="6080289">.</span><span class="ident" id="6080290">ext</span>&nbsp;<span class="op" id="6080294">==</span>&nbsp;<span class="builtintype" id="6080297">nil</span>&nbsp;<span class="op" id="6080301">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080305">return</span>&nbsp;<span class="builtintype" id="6080312">false</span><span class="op" id="6080317">,</span>&nbsp;<span class="string" id="6080319">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6080323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6080326">ext</span>&nbsp;<span class="op" id="6080330">=</span>&nbsp;<span class="ident" id="6080332">strings</span><span class="op" id="6080339">.</span><span class="ident" id="6080340">ToUpper</span><span class="op" id="6080347">(</span><span class="ident" id="6080348">ext</span><span class="op" id="6080351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6080354">param</span><span class="op" id="6080359">,</span>&nbsp;<span class="ident" id="6080361">ok</span>&nbsp;<span class="op" id="6080364">:=</span>&nbsp;<span class="ident" id="6080367">c</span><span class="op" id="6080368">.</span><span class="ident" id="6080369">ext</span><span class="op" id="6080372">[</span><span class="ident" id="6080373">ext</span><span class="op" id="6080376">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080379">return</span>&nbsp;<span class="ident" id="6080386">ok</span><span class="op" id="6080388">,</span>&nbsp;<span class="ident" id="6080390">param</span><br>
<span class="lineno">335</span><span class="op" id="6080396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6080399">//&nbsp;Reset&nbsp;sends&nbsp;the&nbsp;RSET&nbsp;command&nbsp;to&nbsp;the&nbsp;server,&nbsp;aborting&nbsp;the&nbsp;current&nbsp;mail</span><br>
<span class="lineno"></span><span class="comment" id="6080472">//&nbsp;transaction.</span><br>
<span class="lineno"></span><span class="keyword" id="6080488">func</span>&nbsp;<span class="op" id="6080493">(</span><span class="ident" id="6080494">c</span>&nbsp;<span class="op" id="6080496">*</span><span class="ident" id="6080497">Client</span><span class="op" id="6080503">)</span>&nbsp;<span class="ident" id="6080505">Reset</span><span class="op" id="6080510">(</span><span class="op" id="6080511">)</span>&nbsp;<span class="builtintype" id="6080513">error</span>&nbsp;<span class="op" id="6080519">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080522">if</span>&nbsp;<span class="ident" id="6080525">err</span>&nbsp;<span class="op" id="6080529">:=</span>&nbsp;<span class="ident" id="6080532">c</span><span class="op" id="6080533">.</span><span class="ident" id="6080534">hello</span><span class="op" id="6080539">(</span><span class="op" id="6080540">)</span><span class="op" id="6080541">;</span>&nbsp;<span class="ident" id="6080543">err</span>&nbsp;<span class="op" id="6080547">!=</span>&nbsp;<span class="builtintype" id="6080550">nil</span>&nbsp;<span class="op" id="6080554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080558">return</span>&nbsp;<span class="ident" id="6080565">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6080570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6080573">_</span><span class="op" id="6080574">,</span>&nbsp;<span class="ident" id="6080576">_</span><span class="op" id="6080577">,</span>&nbsp;<span class="ident" id="6080579">err</span>&nbsp;<span class="op" id="6080583">:=</span>&nbsp;<span class="ident" id="6080586">c</span><span class="op" id="6080587">.</span><span class="ident" id="6080588">cmd</span><span class="op" id="6080591">(</span><span class="num" id="6080592">250</span><span class="op" id="6080595">,</span>&nbsp;<span class="string" id="6080597">&#34;RSET&#34;</span><span class="op" id="6080603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080606">return</span>&nbsp;<span class="ident" id="6080613">err</span><br>
<span class="lineno">345</span><span class="op" id="6080617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6080620">//&nbsp;Quit&nbsp;sends&nbsp;the&nbsp;QUIT&nbsp;command&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6080692">func</span>&nbsp;<span class="op" id="6080697">(</span><span class="ident" id="6080698">c</span>&nbsp;<span class="op" id="6080700">*</span><span class="ident" id="6080701">Client</span><span class="op" id="6080707">)</span>&nbsp;<span class="ident" id="6080709">Quit</span><span class="op" id="6080713">(</span><span class="op" id="6080714">)</span>&nbsp;<span class="builtintype" id="6080716">error</span>&nbsp;<span class="op" id="6080722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080725">if</span>&nbsp;<span class="ident" id="6080728">err</span>&nbsp;<span class="op" id="6080732">:=</span>&nbsp;<span class="ident" id="6080735">c</span><span class="op" id="6080736">.</span><span class="ident" id="6080737">hello</span><span class="op" id="6080742">(</span><span class="op" id="6080743">)</span><span class="op" id="6080744">;</span>&nbsp;<span class="ident" id="6080746">err</span>&nbsp;<span class="op" id="6080750">!=</span>&nbsp;<span class="builtintype" id="6080753">nil</span>&nbsp;<span class="op" id="6080757">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080761">return</span>&nbsp;<span class="ident" id="6080768">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6080773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6080776">_</span><span class="op" id="6080777">,</span>&nbsp;<span class="ident" id="6080779">_</span><span class="op" id="6080780">,</span>&nbsp;<span class="ident" id="6080782">err</span>&nbsp;<span class="op" id="6080786">:=</span>&nbsp;<span class="ident" id="6080789">c</span><span class="op" id="6080790">.</span><span class="ident" id="6080791">cmd</span><span class="op" id="6080794">(</span><span class="num" id="6080795">221</span><span class="op" id="6080798">,</span>&nbsp;<span class="string" id="6080800">&#34;QUIT&#34;</span><span class="op" id="6080806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080809">if</span>&nbsp;<span class="ident" id="6080812">err</span>&nbsp;<span class="op" id="6080816">!=</span>&nbsp;<span class="builtintype" id="6080819">nil</span>&nbsp;<span class="op" id="6080823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080827">return</span>&nbsp;<span class="ident" id="6080834">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6080839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080842">return</span>&nbsp;<span class="ident" id="6080849">c</span><span class="op" id="6080850">.</span><span class="ident" id="6080851">Text</span><span class="op" id="6080855">.</span><span class="ident" id="6080856">Close</span><span class="op" id="6080861">(</span><span class="op" id="6080862">)</span><br>
<span class="lineno"></span><span class="op" id="6080864">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
