<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3391381">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3391437">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3391491">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3391542">package</span>&nbsp;<span class="ident" id="3391550">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3391555">import</span>&nbsp;<span class="op" id="3391562">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3391565">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3391571">&#34;syscall&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3391581">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3391584">func</span>&nbsp;<span class="ident" id="3391589">setDefaultSockopts</span><span class="op" id="3391607">(</span><span class="ident" id="3391608">s</span><span class="op" id="3391609">,</span>&nbsp;<span class="ident" id="3391611">family</span><span class="op" id="3391617">,</span>&nbsp;<span class="ident" id="3391619">sotype</span>&nbsp;<span class="builtintype" id="3391626">int</span><span class="op" id="3391629">,</span>&nbsp;<span class="ident" id="3391631">ipv6only</span>&nbsp;<span class="builtintype" id="3391640">bool</span><span class="op" id="3391644">)</span>&nbsp;<span class="builtintype" id="3391646">error</span>&nbsp;<span class="op" id="3391652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391655">if</span>&nbsp;<span class="ident" id="3391658">family</span>&nbsp;<span class="op" id="3391665">==</span>&nbsp;<span class="ident" id="3391668">syscall</span><span class="op" id="3391675">.</span><span class="ident" id="3391676">AF_INET6</span>&nbsp;<span class="op" id="3391685">&amp;&amp;</span>&nbsp;<span class="ident" id="3391688">sotype</span>&nbsp;<span class="op" id="3391695">!=</span>&nbsp;<span class="ident" id="3391698">syscall</span><span class="op" id="3391705">.</span><span class="ident" id="3391706">SOCK_RAW</span>&nbsp;<span class="op" id="3391715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3391719">//&nbsp;Allow&nbsp;both&nbsp;IP&nbsp;versions&nbsp;even&nbsp;if&nbsp;the&nbsp;OS&nbsp;default</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3391770">//&nbsp;is&nbsp;otherwise.&nbsp;&nbsp;Note&nbsp;that&nbsp;some&nbsp;operating&nbsp;systems</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3391823">//&nbsp;never&nbsp;admit&nbsp;this&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391853">syscall</span><span class="op" id="3391860">.</span><span class="ident" id="3391861">SetsockoptInt</span><span class="op" id="3391874">(</span><span class="ident" id="3391875">s</span><span class="op" id="3391876">,</span>&nbsp;<span class="ident" id="3391878">syscall</span><span class="op" id="3391885">.</span><span class="ident" id="3391886">IPPROTO_IPV6</span><span class="op" id="3391898">,</span>&nbsp;<span class="ident" id="3391900">syscall</span><span class="op" id="3391907">.</span><span class="ident" id="3391908">IPV6_V6ONLY</span><span class="op" id="3391919">,</span>&nbsp;<span class="ident" id="3391921">boolint</span><span class="op" id="3391928">(</span><span class="ident" id="3391929">ipv6only</span><span class="op" id="3391937">)</span><span class="op" id="3391938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3391944">//&nbsp;Allow&nbsp;broadcast.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391965">return</span>&nbsp;<span class="ident" id="3391972">os</span><span class="op" id="3391974">.</span><span class="ident" id="3391975">NewSyscallError</span><span class="op" id="3391990">(</span><span class="string" id="3391991">&#34;setsockopt&#34;</span><span class="op" id="3392003">,</span>&nbsp;<span class="ident" id="3392005">syscall</span><span class="op" id="3392012">.</span><span class="ident" id="3392013">SetsockoptInt</span><span class="op" id="3392026">(</span><span class="ident" id="3392027">s</span><span class="op" id="3392028">,</span>&nbsp;<span class="ident" id="3392030">syscall</span><span class="op" id="3392037">.</span><span class="ident" id="3392038">SOL_SOCKET</span><span class="op" id="3392048">,</span>&nbsp;<span class="ident" id="3392050">syscall</span><span class="op" id="3392057">.</span><span class="ident" id="3392058">SO_BROADCAST</span><span class="op" id="3392070">,</span>&nbsp;<span class="num" id="3392072">1</span><span class="op" id="3392073">)</span><span class="op" id="3392074">)</span><br>
<span class="lineno"></span><span class="op" id="3392076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3392079">func</span>&nbsp;<span class="ident" id="3392084">setDefaultListenerSockopts</span><span class="op" id="3392110">(</span><span class="ident" id="3392111">s</span>&nbsp;<span class="builtintype" id="3392113">int</span><span class="op" id="3392116">)</span>&nbsp;<span class="builtintype" id="3392118">error</span>&nbsp;<span class="op" id="3392124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392127">//&nbsp;Allow&nbsp;reuse&nbsp;of&nbsp;recently-used&nbsp;addresses.</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392171">return</span>&nbsp;<span class="ident" id="3392178">os</span><span class="op" id="3392180">.</span><span class="ident" id="3392181">NewSyscallError</span><span class="op" id="3392196">(</span><span class="string" id="3392197">&#34;setsockopt&#34;</span><span class="op" id="3392209">,</span>&nbsp;<span class="ident" id="3392211">syscall</span><span class="op" id="3392218">.</span><span class="ident" id="3392219">SetsockoptInt</span><span class="op" id="3392232">(</span><span class="ident" id="3392233">s</span><span class="op" id="3392234">,</span>&nbsp;<span class="ident" id="3392236">syscall</span><span class="op" id="3392243">.</span><span class="ident" id="3392244">SOL_SOCKET</span><span class="op" id="3392254">,</span>&nbsp;<span class="ident" id="3392256">syscall</span><span class="op" id="3392263">.</span><span class="ident" id="3392264">SO_REUSEADDR</span><span class="op" id="3392276">,</span>&nbsp;<span class="num" id="3392278">1</span><span class="op" id="3392279">)</span><span class="op" id="3392280">)</span><br>
<span class="lineno"></span><span class="op" id="3392282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3392285">func</span>&nbsp;<span class="ident" id="3392290">setDefaultMulticastSockopts</span><span class="op" id="3392317">(</span><span class="ident" id="3392318">s</span>&nbsp;<span class="builtintype" id="3392320">int</span><span class="op" id="3392323">)</span>&nbsp;<span class="builtintype" id="3392325">error</span>&nbsp;<span class="op" id="3392331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392334">//&nbsp;Allow&nbsp;multicast&nbsp;UDP&nbsp;and&nbsp;raw&nbsp;IP&nbsp;datagram&nbsp;sockets&nbsp;to&nbsp;listen</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392396">//&nbsp;concurrently&nbsp;across&nbsp;multiple&nbsp;listeners.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392440">return</span>&nbsp;<span class="ident" id="3392447">os</span><span class="op" id="3392449">.</span><span class="ident" id="3392450">NewSyscallError</span><span class="op" id="3392465">(</span><span class="string" id="3392466">&#34;setsockopt&#34;</span><span class="op" id="3392478">,</span>&nbsp;<span class="ident" id="3392480">syscall</span><span class="op" id="3392487">.</span><span class="ident" id="3392488">SetsockoptInt</span><span class="op" id="3392501">(</span><span class="ident" id="3392502">s</span><span class="op" id="3392503">,</span>&nbsp;<span class="ident" id="3392505">syscall</span><span class="op" id="3392512">.</span><span class="ident" id="3392513">SOL_SOCKET</span><span class="op" id="3392523">,</span>&nbsp;<span class="ident" id="3392525">syscall</span><span class="op" id="3392532">.</span><span class="ident" id="3392533">SO_REUSEADDR</span><span class="op" id="3392545">,</span>&nbsp;<span class="num" id="3392547">1</span><span class="op" id="3392548">)</span><span class="op" id="3392549">)</span><br>
<span class="lineno"></span><span class="op" id="3392551">}</span>
</div>
</body>
</html>
