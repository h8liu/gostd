<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5994813">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5994868">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5994922">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5994973">//&nbsp;This&nbsp;algorithm&nbsp;is&nbsp;based&nbsp;on&nbsp;&#34;Faster&nbsp;Suffix&nbsp;Sorting&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5995027">//&nbsp;&nbsp;&nbsp;by&nbsp;N.&nbsp;Jesper&nbsp;Larsson&nbsp;and&nbsp;Kunihiko&nbsp;Sadakane</span><br>
<span class="lineno"></span><span class="comment" id="5995075">//&nbsp;paper:&nbsp;http://www.larsson.dogma.net/ssrev-tr.pdf</span><br>
<span class="lineno"></span><span class="comment" id="5995127">//&nbsp;code:&nbsp;&nbsp;http://www.larsson.dogma.net/qsufsort.c</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="5995178">//&nbsp;This&nbsp;algorithm&nbsp;computes&nbsp;the&nbsp;suffix&nbsp;array&nbsp;sa&nbsp;by&nbsp;computing&nbsp;its&nbsp;inverse.</span><br>
<span class="lineno"></span><span class="comment" id="5995251">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;in&nbsp;sa&nbsp;are&nbsp;labeled&nbsp;as&nbsp;sorted&nbsp;groups&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5995323">//&nbsp;unsorted&nbsp;groups.&nbsp;For&nbsp;a&nbsp;given&nbsp;pass&nbsp;of&nbsp;the&nbsp;sorter,&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;ordered</span><br>
<span class="lineno"></span><span class="comment" id="5995400">//&nbsp;up&nbsp;to&nbsp;their&nbsp;first&nbsp;h&nbsp;characters,&nbsp;and&nbsp;sa&nbsp;is&nbsp;h-ordered.&nbsp;Suffixes&nbsp;in&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="5995474">//&nbsp;final&nbsp;positions&nbsp;and&nbsp;unambiguously&nbsp;sorted&nbsp;in&nbsp;h-order&nbsp;are&nbsp;in&nbsp;a&nbsp;sorted&nbsp;group.</span><br>
<span class="lineno">15</span><span class="comment" id="5995552">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;with&nbsp;identical&nbsp;first&nbsp;h&nbsp;characters&nbsp;are&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5995627">//&nbsp;unsorted&nbsp;group.&nbsp;In&nbsp;each&nbsp;pass&nbsp;of&nbsp;the&nbsp;algorithm,&nbsp;unsorted&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span><span class="comment" id="5995704">//&nbsp;according&nbsp;to&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;their&nbsp;following&nbsp;suffix.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5995765">//&nbsp;In&nbsp;the&nbsp;implementation,&nbsp;if&nbsp;sa[i]&nbsp;is&nbsp;negative,&nbsp;it&nbsp;indicates&nbsp;that&nbsp;i&nbsp;is</span><br>
<span class="lineno">20</span><span class="comment" id="5995836">//&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;a&nbsp;sorted&nbsp;group&nbsp;of&nbsp;length&nbsp;-sa[i],&nbsp;and&nbsp;can&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="comment" id="5995913">//&nbsp;An&nbsp;unsorted&nbsp;group&nbsp;sa[i:k]&nbsp;is&nbsp;given&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;the&nbsp;index&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5995988">//&nbsp;last&nbsp;element,&nbsp;k-1.&nbsp;The&nbsp;group&nbsp;numbers&nbsp;are&nbsp;stored&nbsp;in&nbsp;the&nbsp;inverse&nbsp;slice&nbsp;(inv),</span><br>
<span class="lineno"></span><span class="comment" id="5996067">//&nbsp;and&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted,&nbsp;this&nbsp;slice&nbsp;is&nbsp;the&nbsp;inverse&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5996143">package</span>&nbsp;<span class="ident" id="5996151">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5996164">import</span>&nbsp;<span class="string" id="5996171">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5996179">func</span>&nbsp;<span class="ident" id="5996184">qsufsort</span><span class="op" id="5996192">(</span><span class="ident" id="5996193">data</span>&nbsp;<span class="op" id="5996198">[</span><span class="op" id="5996199">]</span><span class="builtintype" id="5996200">byte</span><span class="op" id="5996204">)</span>&nbsp;<span class="op" id="5996206">[</span><span class="op" id="5996207">]</span><span class="builtintype" id="5996208">int</span>&nbsp;<span class="op" id="5996212">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5996215">//&nbsp;initial&nbsp;sorting&nbsp;by&nbsp;first&nbsp;byte&nbsp;of&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996259">sa</span>&nbsp;<span class="op" id="5996262">:=</span>&nbsp;<span class="ident" id="5996265">sortedByFirstByte</span><span class="op" id="5996282">(</span><span class="ident" id="5996283">data</span><span class="op" id="5996287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996290">if</span>&nbsp;<span class="builtinfunc" id="5996293">len</span><span class="op" id="5996296">(</span><span class="ident" id="5996297">sa</span><span class="op" id="5996299">)</span>&nbsp;<span class="op" id="5996301">&lt;</span>&nbsp;<span class="num" id="5996303">2</span>&nbsp;<span class="op" id="5996305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996309">return</span>&nbsp;<span class="ident" id="5996316">sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996320">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5996323">//&nbsp;initialize&nbsp;the&nbsp;group&nbsp;lookup&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5996361">//&nbsp;this&nbsp;becomes&nbsp;the&nbsp;inverse&nbsp;of&nbsp;the&nbsp;suffix&nbsp;array&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996437">inv</span>&nbsp;<span class="op" id="5996441">:=</span>&nbsp;<span class="ident" id="5996444">initGroups</span><span class="op" id="5996454">(</span><span class="ident" id="5996455">sa</span><span class="op" id="5996457">,</span>&nbsp;<span class="ident" id="5996459">data</span><span class="op" id="5996463">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5996467">//&nbsp;the&nbsp;index&nbsp;starts&nbsp;1-ordered</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996498">sufSortable</span>&nbsp;<span class="op" id="5996510">:=</span>&nbsp;<span class="op" id="5996513">&amp;</span><span class="ident" id="5996514">suffixSortable</span><span class="op" id="5996528">{</span><span class="ident" id="5996529">sa</span><span class="op" id="5996531">:</span>&nbsp;<span class="ident" id="5996533">sa</span><span class="op" id="5996535">,</span>&nbsp;<span class="ident" id="5996537">inv</span><span class="op" id="5996540">:</span>&nbsp;<span class="ident" id="5996542">inv</span><span class="op" id="5996545">,</span>&nbsp;<span class="ident" id="5996547">h</span><span class="op" id="5996548">:</span>&nbsp;<span class="num" id="5996550">1</span><span class="op" id="5996551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996555">for</span>&nbsp;<span class="ident" id="5996559">sa</span><span class="op" id="5996561">[</span><span class="num" id="5996562">0</span><span class="op" id="5996563">]</span>&nbsp;<span class="op" id="5996565">&gt;</span>&nbsp;<span class="op" id="5996567">-</span><span class="builtinfunc" id="5996568">len</span><span class="op" id="5996571">(</span><span class="ident" id="5996572">sa</span><span class="op" id="5996574">)</span>&nbsp;<span class="op" id="5996576">{</span>&nbsp;<span class="comment" id="5996578">//&nbsp;until&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;one&nbsp;big&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5996627">//&nbsp;The&nbsp;suffixes&nbsp;are&nbsp;h-ordered,&nbsp;make&nbsp;them&nbsp;2*h-ordered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996682">pi</span>&nbsp;<span class="op" id="5996685">:=</span>&nbsp;<span class="num" id="5996688">0</span>&nbsp;<span class="comment" id="5996690">//&nbsp;pi&nbsp;is&nbsp;first&nbsp;position&nbsp;of&nbsp;first&nbsp;group</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996731">sl</span>&nbsp;<span class="op" id="5996734">:=</span>&nbsp;<span class="num" id="5996737">0</span>&nbsp;<span class="comment" id="5996739">//&nbsp;sl&nbsp;is&nbsp;negated&nbsp;length&nbsp;of&nbsp;sorted&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996782">for</span>&nbsp;<span class="ident" id="5996786">pi</span>&nbsp;<span class="op" id="5996789">&lt;</span>&nbsp;<span class="builtinfunc" id="5996791">len</span><span class="op" id="5996794">(</span><span class="ident" id="5996795">sa</span><span class="op" id="5996797">)</span>&nbsp;<span class="op" id="5996799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996804">if</span>&nbsp;<span class="ident" id="5996807">s</span>&nbsp;<span class="op" id="5996809">:=</span>&nbsp;<span class="ident" id="5996812">sa</span><span class="op" id="5996814">[</span><span class="ident" id="5996815">pi</span><span class="op" id="5996817">]</span><span class="op" id="5996818">;</span>&nbsp;<span class="ident" id="5996820">s</span>&nbsp;<span class="op" id="5996822">&lt;</span>&nbsp;<span class="num" id="5996824">0</span>&nbsp;<span class="op" id="5996826">{</span>&nbsp;<span class="comment" id="5996828">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996861">pi</span>&nbsp;<span class="op" id="5996864">-=</span>&nbsp;<span class="ident" id="5996867">s</span>&nbsp;<span class="comment" id="5996869">//&nbsp;skip&nbsp;over&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996899">sl</span>&nbsp;<span class="op" id="5996902">+=</span>&nbsp;<span class="ident" id="5996905">s</span>&nbsp;<span class="comment" id="5996907">//&nbsp;add&nbsp;negated&nbsp;length&nbsp;to&nbsp;sl</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996938">}</span>&nbsp;<span class="keyword" id="5996940">else</span>&nbsp;<span class="op" id="5996945">{</span>&nbsp;<span class="comment" id="5996947">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996982">if</span>&nbsp;<span class="ident" id="5996985">sl</span>&nbsp;<span class="op" id="5996988">!=</span>&nbsp;<span class="num" id="5996991">0</span>&nbsp;<span class="op" id="5996993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997000">sa</span><span class="op" id="5997002">[</span><span class="ident" id="5997003">pi</span><span class="op" id="5997005">+</span><span class="ident" id="5997006">sl</span><span class="op" id="5997008">]</span>&nbsp;<span class="op" id="5997010">=</span>&nbsp;<span class="ident" id="5997012">sl</span>&nbsp;<span class="comment" id="5997015">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;before&nbsp;pi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997055">sl</span>&nbsp;<span class="op" id="5997058">=</span>&nbsp;<span class="num" id="5997060">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997066">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997072">pk</span>&nbsp;<span class="op" id="5997075">:=</span>&nbsp;<span class="ident" id="5997078">inv</span><span class="op" id="5997081">[</span><span class="ident" id="5997082">s</span><span class="op" id="5997083">]</span>&nbsp;<span class="op" id="5997085">+</span>&nbsp;<span class="num" id="5997087">1</span>&nbsp;<span class="comment" id="5997089">//&nbsp;pk-1&nbsp;is&nbsp;last&nbsp;position&nbsp;of&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997136">sufSortable</span><span class="op" id="5997147">.</span><span class="ident" id="5997148">sa</span>&nbsp;<span class="op" id="5997151">=</span>&nbsp;<span class="ident" id="5997153">sa</span><span class="op" id="5997155">[</span><span class="ident" id="5997156">pi</span><span class="op" id="5997158">:</span><span class="ident" id="5997159">pk</span><span class="op" id="5997161">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997167">sort</span><span class="op" id="5997171">.</span><span class="ident" id="5997172">Sort</span><span class="op" id="5997176">(</span><span class="ident" id="5997177">sufSortable</span><span class="op" id="5997188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997194">sufSortable</span><span class="op" id="5997205">.</span><span class="ident" id="5997206">updateGroups</span><span class="op" id="5997218">(</span><span class="ident" id="5997219">pi</span><span class="op" id="5997221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997227">pi</span>&nbsp;<span class="op" id="5997230">=</span>&nbsp;<span class="ident" id="5997232">pk</span>&nbsp;<span class="comment" id="5997235">//&nbsp;next&nbsp;group</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997260">if</span>&nbsp;<span class="ident" id="5997263">sl</span>&nbsp;<span class="op" id="5997266">!=</span>&nbsp;<span class="num" id="5997269">0</span>&nbsp;<span class="op" id="5997271">{</span>&nbsp;<span class="comment" id="5997273">//&nbsp;if&nbsp;the&nbsp;array&nbsp;ends&nbsp;with&nbsp;a&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997317">sa</span><span class="op" id="5997319">[</span><span class="ident" id="5997320">pi</span><span class="op" id="5997322">+</span><span class="ident" id="5997323">sl</span><span class="op" id="5997325">]</span>&nbsp;<span class="op" id="5997327">=</span>&nbsp;<span class="ident" id="5997329">sl</span>&nbsp;<span class="comment" id="5997332">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;at&nbsp;end&nbsp;of&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997372">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997377">sufSortable</span><span class="op" id="5997388">.</span><span class="ident" id="5997389">h</span>&nbsp;<span class="op" id="5997391">*=</span>&nbsp;<span class="num" id="5997394">2</span>&nbsp;<span class="comment" id="5997396">//&nbsp;double&nbsp;sorted&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997424">for</span>&nbsp;<span class="ident" id="5997428">i</span>&nbsp;<span class="op" id="5997430">:=</span>&nbsp;<span class="keyword" id="5997433">range</span>&nbsp;<span class="ident" id="5997439">sa</span>&nbsp;<span class="op" id="5997442">{</span>&nbsp;<span class="comment" id="5997444">//&nbsp;reconstruct&nbsp;suffix&nbsp;array&nbsp;from&nbsp;inverse</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997487">sa</span><span class="op" id="5997489">[</span><span class="ident" id="5997490">inv</span><span class="op" id="5997493">[</span><span class="ident" id="5997494">i</span><span class="op" id="5997495">]</span><span class="op" id="5997496">]</span>&nbsp;<span class="op" id="5997498">=</span>&nbsp;<span class="ident" id="5997500">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997506">return</span>&nbsp;<span class="ident" id="5997513">sa</span><br>
<span class="lineno"></span><span class="op" id="5997516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5997519">func</span>&nbsp;<span class="ident" id="5997524">sortedByFirstByte</span><span class="op" id="5997541">(</span><span class="ident" id="5997542">data</span>&nbsp;<span class="op" id="5997547">[</span><span class="op" id="5997548">]</span><span class="builtintype" id="5997549">byte</span><span class="op" id="5997553">)</span>&nbsp;<span class="op" id="5997555">[</span><span class="op" id="5997556">]</span><span class="builtintype" id="5997557">int</span>&nbsp;<span class="op" id="5997561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5997564">//&nbsp;total&nbsp;byte&nbsp;counts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997586">var</span>&nbsp;<span class="ident" id="5997590">count</span>&nbsp;<span class="op" id="5997596">[</span><span class="num" id="5997597">256</span><span class="op" id="5997600">]</span><span class="builtintype" id="5997601">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997606">for</span>&nbsp;<span class="ident" id="5997610">_</span><span class="op" id="5997611">,</span>&nbsp;<span class="ident" id="5997613">b</span>&nbsp;<span class="op" id="5997615">:=</span>&nbsp;<span class="keyword" id="5997618">range</span>&nbsp;<span class="ident" id="5997624">data</span>&nbsp;<span class="op" id="5997629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997633">count</span><span class="op" id="5997638">[</span><span class="ident" id="5997639">b</span><span class="op" id="5997640">]</span><span class="op" id="5997641">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5997648">//&nbsp;make&nbsp;count[b]&nbsp;equal&nbsp;index&nbsp;of&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;sorted&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997719">sum</span>&nbsp;<span class="op" id="5997723">:=</span>&nbsp;<span class="num" id="5997726">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997729">for</span>&nbsp;<span class="ident" id="5997733">b</span>&nbsp;<span class="op" id="5997735">:=</span>&nbsp;<span class="keyword" id="5997738">range</span>&nbsp;<span class="ident" id="5997744">count</span>&nbsp;<span class="op" id="5997750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997754">count</span><span class="op" id="5997759">[</span><span class="ident" id="5997760">b</span><span class="op" id="5997761">]</span><span class="op" id="5997762">,</span>&nbsp;<span class="ident" id="5997764">sum</span>&nbsp;<span class="op" id="5997768">=</span>&nbsp;<span class="ident" id="5997770">sum</span><span class="op" id="5997773">,</span>&nbsp;<span class="ident" id="5997775">count</span><span class="op" id="5997780">[</span><span class="ident" id="5997781">b</span><span class="op" id="5997782">]</span><span class="op" id="5997783">+</span><span class="ident" id="5997784">sum</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5997792">//&nbsp;iterate&nbsp;through&nbsp;bytes,&nbsp;placing&nbsp;index&nbsp;into&nbsp;the&nbsp;correct&nbsp;spot&nbsp;in&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997861">sa</span>&nbsp;<span class="op" id="5997864">:=</span>&nbsp;<span class="builtinfunc" id="5997867">make</span><span class="op" id="5997871">(</span><span class="op" id="5997872">[</span><span class="op" id="5997873">]</span><span class="builtintype" id="5997874">int</span><span class="op" id="5997877">,</span>&nbsp;<span class="builtinfunc" id="5997879">len</span><span class="op" id="5997882">(</span><span class="ident" id="5997883">data</span><span class="op" id="5997887">)</span><span class="op" id="5997888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997891">for</span>&nbsp;<span class="ident" id="5997895">i</span><span class="op" id="5997896">,</span>&nbsp;<span class="ident" id="5997898">b</span>&nbsp;<span class="op" id="5997900">:=</span>&nbsp;<span class="keyword" id="5997903">range</span>&nbsp;<span class="ident" id="5997909">data</span>&nbsp;<span class="op" id="5997914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997918">sa</span><span class="op" id="5997920">[</span><span class="ident" id="5997921">count</span><span class="op" id="5997926">[</span><span class="ident" id="5997927">b</span><span class="op" id="5997928">]</span><span class="op" id="5997929">]</span>&nbsp;<span class="op" id="5997931">=</span>&nbsp;<span class="ident" id="5997933">i</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997937">count</span><span class="op" id="5997942">[</span><span class="ident" id="5997943">b</span><span class="op" id="5997944">]</span><span class="op" id="5997945">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997952">return</span>&nbsp;<span class="ident" id="5997959">sa</span><br>
<span class="lineno"></span><span class="op" id="5997962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5997965">func</span>&nbsp;<span class="ident" id="5997970">initGroups</span><span class="op" id="5997980">(</span><span class="ident" id="5997981">sa</span>&nbsp;<span class="op" id="5997984">[</span><span class="op" id="5997985">]</span><span class="builtintype" id="5997986">int</span><span class="op" id="5997989">,</span>&nbsp;<span class="ident" id="5997991">data</span>&nbsp;<span class="op" id="5997996">[</span><span class="op" id="5997997">]</span><span class="builtintype" id="5997998">byte</span><span class="op" id="5998002">)</span>&nbsp;<span class="op" id="5998004">[</span><span class="op" id="5998005">]</span><span class="builtintype" id="5998006">int</span>&nbsp;<span class="op" id="5998010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5998013">//&nbsp;label&nbsp;contiguous&nbsp;same-letter&nbsp;groups&nbsp;with&nbsp;the&nbsp;same&nbsp;group&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998080">inv</span>&nbsp;<span class="op" id="5998084">:=</span>&nbsp;<span class="builtinfunc" id="5998087">make</span><span class="op" id="5998091">(</span><span class="op" id="5998092">[</span><span class="op" id="5998093">]</span><span class="builtintype" id="5998094">int</span><span class="op" id="5998097">,</span>&nbsp;<span class="builtinfunc" id="5998099">len</span><span class="op" id="5998102">(</span><span class="ident" id="5998103">data</span><span class="op" id="5998107">)</span><span class="op" id="5998108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998111">prevGroup</span>&nbsp;<span class="op" id="5998121">:=</span>&nbsp;<span class="builtinfunc" id="5998124">len</span><span class="op" id="5998127">(</span><span class="ident" id="5998128">sa</span><span class="op" id="5998130">)</span>&nbsp;<span class="op" id="5998132">-</span>&nbsp;<span class="num" id="5998134">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998137">groupByte</span>&nbsp;<span class="op" id="5998147">:=</span>&nbsp;<span class="ident" id="5998150">data</span><span class="op" id="5998154">[</span><span class="ident" id="5998155">sa</span><span class="op" id="5998157">[</span><span class="ident" id="5998158">prevGroup</span><span class="op" id="5998167">]</span><span class="op" id="5998168">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998171">for</span>&nbsp;<span class="ident" id="5998175">i</span>&nbsp;<span class="op" id="5998177">:=</span>&nbsp;<span class="builtinfunc" id="5998180">len</span><span class="op" id="5998183">(</span><span class="ident" id="5998184">sa</span><span class="op" id="5998186">)</span>&nbsp;<span class="op" id="5998188">-</span>&nbsp;<span class="num" id="5998190">1</span><span class="op" id="5998191">;</span>&nbsp;<span class="ident" id="5998193">i</span>&nbsp;<span class="op" id="5998195">&gt;=</span>&nbsp;<span class="num" id="5998198">0</span><span class="op" id="5998199">;</span>&nbsp;<span class="ident" id="5998201">i</span><span class="op" id="5998202">--</span>&nbsp;<span class="op" id="5998205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998209">if</span>&nbsp;<span class="ident" id="5998212">b</span>&nbsp;<span class="op" id="5998214">:=</span>&nbsp;<span class="ident" id="5998217">data</span><span class="op" id="5998221">[</span><span class="ident" id="5998222">sa</span><span class="op" id="5998224">[</span><span class="ident" id="5998225">i</span><span class="op" id="5998226">]</span><span class="op" id="5998227">]</span><span class="op" id="5998228">;</span>&nbsp;<span class="ident" id="5998230">b</span>&nbsp;<span class="op" id="5998232">&lt;</span>&nbsp;<span class="ident" id="5998234">groupByte</span>&nbsp;<span class="op" id="5998244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998249">if</span>&nbsp;<span class="ident" id="5998252">prevGroup</span>&nbsp;<span class="op" id="5998262">==</span>&nbsp;<span class="ident" id="5998265">i</span><span class="op" id="5998266">+</span><span class="num" id="5998267">1</span>&nbsp;<span class="op" id="5998269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998275">sa</span><span class="op" id="5998277">[</span><span class="ident" id="5998278">i</span><span class="op" id="5998279">+</span><span class="num" id="5998280">1</span><span class="op" id="5998281">]</span>&nbsp;<span class="op" id="5998283">=</span>&nbsp;<span class="op" id="5998285">-</span><span class="num" id="5998286">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998291">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998296">groupByte</span>&nbsp;<span class="op" id="5998306">=</span>&nbsp;<span class="ident" id="5998308">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998313">prevGroup</span>&nbsp;<span class="op" id="5998323">=</span>&nbsp;<span class="ident" id="5998325">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998333">inv</span><span class="op" id="5998336">[</span><span class="ident" id="5998337">sa</span><span class="op" id="5998339">[</span><span class="ident" id="5998340">i</span><span class="op" id="5998341">]</span><span class="op" id="5998342">]</span>&nbsp;<span class="op" id="5998344">=</span>&nbsp;<span class="ident" id="5998346">prevGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998358">if</span>&nbsp;<span class="ident" id="5998361">prevGroup</span>&nbsp;<span class="op" id="5998371">==</span>&nbsp;<span class="num" id="5998374">0</span>&nbsp;<span class="op" id="5998376">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998381">sa</span><span class="op" id="5998383">[</span><span class="num" id="5998384">0</span><span class="op" id="5998385">]</span>&nbsp;<span class="op" id="5998387">=</span>&nbsp;<span class="op" id="5998389">-</span><span class="num" id="5998390">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5998400">//&nbsp;Separate&nbsp;out&nbsp;the&nbsp;final&nbsp;suffix&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;its&nbsp;group.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5998461">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;to&nbsp;ensure&nbsp;the&nbsp;suffix&nbsp;&#34;a&#34;&nbsp;is&nbsp;before&nbsp;&#34;aba&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5998524">//&nbsp;when&nbsp;using&nbsp;a&nbsp;potentially&nbsp;unstable&nbsp;sort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998568">lastByte</span>&nbsp;<span class="op" id="5998577">:=</span>&nbsp;<span class="ident" id="5998580">data</span><span class="op" id="5998584">[</span><span class="builtinfunc" id="5998585">len</span><span class="op" id="5998588">(</span><span class="ident" id="5998589">data</span><span class="op" id="5998593">)</span><span class="op" id="5998594">-</span><span class="num" id="5998595">1</span><span class="op" id="5998596">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998599">s</span>&nbsp;<span class="op" id="5998601">:=</span>&nbsp;<span class="op" id="5998604">-</span><span class="num" id="5998605">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998608">for</span>&nbsp;<span class="ident" id="5998612">i</span>&nbsp;<span class="op" id="5998614">:=</span>&nbsp;<span class="keyword" id="5998617">range</span>&nbsp;<span class="ident" id="5998623">sa</span>&nbsp;<span class="op" id="5998626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998630">if</span>&nbsp;<span class="ident" id="5998633">sa</span><span class="op" id="5998635">[</span><span class="ident" id="5998636">i</span><span class="op" id="5998637">]</span>&nbsp;<span class="op" id="5998639">&gt;=</span>&nbsp;<span class="num" id="5998642">0</span>&nbsp;<span class="op" id="5998644">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998649">if</span>&nbsp;<span class="ident" id="5998652">data</span><span class="op" id="5998656">[</span><span class="ident" id="5998657">sa</span><span class="op" id="5998659">[</span><span class="ident" id="5998660">i</span><span class="op" id="5998661">]</span><span class="op" id="5998662">]</span>&nbsp;<span class="op" id="5998664">==</span>&nbsp;<span class="ident" id="5998667">lastByte</span>&nbsp;<span class="op" id="5998676">&amp;&amp;</span>&nbsp;<span class="ident" id="5998679">s</span>&nbsp;<span class="op" id="5998681">==</span>&nbsp;<span class="op" id="5998684">-</span><span class="num" id="5998685">1</span>&nbsp;<span class="op" id="5998687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998693">s</span>&nbsp;<span class="op" id="5998695">=</span>&nbsp;<span class="ident" id="5998697">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998707">if</span>&nbsp;<span class="ident" id="5998710">sa</span><span class="op" id="5998712">[</span><span class="ident" id="5998713">i</span><span class="op" id="5998714">]</span>&nbsp;<span class="op" id="5998716">==</span>&nbsp;<span class="builtinfunc" id="5998719">len</span><span class="op" id="5998722">(</span><span class="ident" id="5998723">sa</span><span class="op" id="5998725">)</span><span class="op" id="5998726">-</span><span class="num" id="5998727">1</span>&nbsp;<span class="op" id="5998729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998735">sa</span><span class="op" id="5998737">[</span><span class="ident" id="5998738">i</span><span class="op" id="5998739">]</span><span class="op" id="5998740">,</span>&nbsp;<span class="ident" id="5998742">sa</span><span class="op" id="5998744">[</span><span class="ident" id="5998745">s</span><span class="op" id="5998746">]</span>&nbsp;<span class="op" id="5998748">=</span>&nbsp;<span class="ident" id="5998750">sa</span><span class="op" id="5998752">[</span><span class="ident" id="5998753">s</span><span class="op" id="5998754">]</span><span class="op" id="5998755">,</span>&nbsp;<span class="ident" id="5998757">sa</span><span class="op" id="5998759">[</span><span class="ident" id="5998760">i</span><span class="op" id="5998761">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998767">inv</span><span class="op" id="5998770">[</span><span class="ident" id="5998771">sa</span><span class="op" id="5998773">[</span><span class="ident" id="5998774">s</span><span class="op" id="5998775">]</span><span class="op" id="5998776">]</span>&nbsp;<span class="op" id="5998778">=</span>&nbsp;<span class="ident" id="5998780">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998786">sa</span><span class="op" id="5998788">[</span><span class="ident" id="5998789">s</span><span class="op" id="5998790">]</span>&nbsp;<span class="op" id="5998792">=</span>&nbsp;<span class="op" id="5998794">-</span><span class="num" id="5998795">1</span>&nbsp;<span class="comment" id="5998797">//&nbsp;mark&nbsp;it&nbsp;as&nbsp;an&nbsp;isolated&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998840">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998853">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998859">return</span>&nbsp;<span class="ident" id="5998866">inv</span><br>
<span class="lineno"></span><span class="op" id="5998870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5998873">type</span>&nbsp;<span class="ident" id="5998878">suffixSortable</span>&nbsp;<span class="keyword" id="5998893">struct</span>&nbsp;<span class="op" id="5998900">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998903">sa</span>&nbsp;&nbsp;<span class="op" id="5998907">[</span><span class="op" id="5998908">]</span><span class="builtintype" id="5998909">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998914">inv</span>&nbsp;<span class="op" id="5998918">[</span><span class="op" id="5998919">]</span><span class="builtintype" id="5998920">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998925">h</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5998929">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998934">buf</span>&nbsp;<span class="op" id="5998938">[</span><span class="op" id="5998939">]</span><span class="builtintype" id="5998940">int</span>&nbsp;<span class="comment" id="5998944">//&nbsp;common&nbsp;scratch&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="5998968">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="5998971">func</span>&nbsp;<span class="op" id="5998976">(</span><span class="ident" id="5998977">x</span>&nbsp;<span class="op" id="5998979">*</span><span class="ident" id="5998980">suffixSortable</span><span class="op" id="5998994">)</span>&nbsp;<span class="ident" id="5998996">Len</span><span class="op" id="5998999">(</span><span class="op" id="5999000">)</span>&nbsp;<span class="builtintype" id="5999002">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5999016">{</span>&nbsp;<span class="keyword" id="5999018">return</span>&nbsp;<span class="builtinfunc" id="5999025">len</span><span class="op" id="5999028">(</span><span class="ident" id="5999029">x</span><span class="op" id="5999030">.</span><span class="ident" id="5999031">sa</span><span class="op" id="5999033">)</span>&nbsp;<span class="op" id="5999035">}</span><br>
<span class="lineno"></span><span class="keyword" id="5999037">func</span>&nbsp;<span class="op" id="5999042">(</span><span class="ident" id="5999043">x</span>&nbsp;<span class="op" id="5999045">*</span><span class="ident" id="5999046">suffixSortable</span><span class="op" id="5999060">)</span>&nbsp;<span class="ident" id="5999062">Less</span><span class="op" id="5999066">(</span><span class="ident" id="5999067">i</span><span class="op" id="5999068">,</span>&nbsp;<span class="ident" id="5999070">j</span>&nbsp;<span class="builtintype" id="5999072">int</span><span class="op" id="5999075">)</span>&nbsp;<span class="builtintype" id="5999077">bool</span>&nbsp;<span class="op" id="5999082">{</span>&nbsp;<span class="keyword" id="5999084">return</span>&nbsp;<span class="ident" id="5999091">x</span><span class="op" id="5999092">.</span><span class="ident" id="5999093">inv</span><span class="op" id="5999096">[</span><span class="ident" id="5999097">x</span><span class="op" id="5999098">.</span><span class="ident" id="5999099">sa</span><span class="op" id="5999101">[</span><span class="ident" id="5999102">i</span><span class="op" id="5999103">]</span><span class="op" id="5999104">+</span><span class="ident" id="5999105">x</span><span class="op" id="5999106">.</span><span class="ident" id="5999107">h</span><span class="op" id="5999108">]</span>&nbsp;<span class="op" id="5999110">&lt;</span>&nbsp;<span class="ident" id="5999112">x</span><span class="op" id="5999113">.</span><span class="ident" id="5999114">inv</span><span class="op" id="5999117">[</span><span class="ident" id="5999118">x</span><span class="op" id="5999119">.</span><span class="ident" id="5999120">sa</span><span class="op" id="5999122">[</span><span class="ident" id="5999123">j</span><span class="op" id="5999124">]</span><span class="op" id="5999125">+</span><span class="ident" id="5999126">x</span><span class="op" id="5999127">.</span><span class="ident" id="5999128">h</span><span class="op" id="5999129">]</span>&nbsp;<span class="op" id="5999131">}</span><br>
<span class="lineno"></span><span class="keyword" id="5999133">func</span>&nbsp;<span class="op" id="5999138">(</span><span class="ident" id="5999139">x</span>&nbsp;<span class="op" id="5999141">*</span><span class="ident" id="5999142">suffixSortable</span><span class="op" id="5999156">)</span>&nbsp;<span class="ident" id="5999158">Swap</span><span class="op" id="5999162">(</span><span class="ident" id="5999163">i</span><span class="op" id="5999164">,</span>&nbsp;<span class="ident" id="5999166">j</span>&nbsp;<span class="builtintype" id="5999168">int</span><span class="op" id="5999171">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5999178">{</span>&nbsp;<span class="ident" id="5999180">x</span><span class="op" id="5999181">.</span><span class="ident" id="5999182">sa</span><span class="op" id="5999184">[</span><span class="ident" id="5999185">i</span><span class="op" id="5999186">]</span><span class="op" id="5999187">,</span>&nbsp;<span class="ident" id="5999189">x</span><span class="op" id="5999190">.</span><span class="ident" id="5999191">sa</span><span class="op" id="5999193">[</span><span class="ident" id="5999194">j</span><span class="op" id="5999195">]</span>&nbsp;<span class="op" id="5999197">=</span>&nbsp;<span class="ident" id="5999199">x</span><span class="op" id="5999200">.</span><span class="ident" id="5999201">sa</span><span class="op" id="5999203">[</span><span class="ident" id="5999204">j</span><span class="op" id="5999205">]</span><span class="op" id="5999206">,</span>&nbsp;<span class="ident" id="5999208">x</span><span class="op" id="5999209">.</span><span class="ident" id="5999210">sa</span><span class="op" id="5999212">[</span><span class="ident" id="5999213">i</span><span class="op" id="5999214">]</span>&nbsp;<span class="op" id="5999216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="5999219">func</span>&nbsp;<span class="op" id="5999224">(</span><span class="ident" id="5999225">x</span>&nbsp;<span class="op" id="5999227">*</span><span class="ident" id="5999228">suffixSortable</span><span class="op" id="5999242">)</span>&nbsp;<span class="ident" id="5999244">updateGroups</span><span class="op" id="5999256">(</span><span class="ident" id="5999257">offset</span>&nbsp;<span class="builtintype" id="5999264">int</span><span class="op" id="5999267">)</span>&nbsp;<span class="op" id="5999269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999272">bounds</span>&nbsp;<span class="op" id="5999279">:=</span>&nbsp;<span class="ident" id="5999282">x</span><span class="op" id="5999283">.</span><span class="ident" id="5999284">buf</span><span class="op" id="5999287">[</span><span class="num" id="5999288">0</span><span class="op" id="5999289">:</span><span class="num" id="5999290">0</span><span class="op" id="5999291">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999294">group</span>&nbsp;<span class="op" id="5999300">:=</span>&nbsp;<span class="ident" id="5999303">x</span><span class="op" id="5999304">.</span><span class="ident" id="5999305">inv</span><span class="op" id="5999308">[</span><span class="ident" id="5999309">x</span><span class="op" id="5999310">.</span><span class="ident" id="5999311">sa</span><span class="op" id="5999313">[</span><span class="num" id="5999314">0</span><span class="op" id="5999315">]</span><span class="op" id="5999316">+</span><span class="ident" id="5999317">x</span><span class="op" id="5999318">.</span><span class="ident" id="5999319">h</span><span class="op" id="5999320">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999323">for</span>&nbsp;<span class="ident" id="5999327">i</span>&nbsp;<span class="op" id="5999329">:=</span>&nbsp;<span class="num" id="5999332">1</span><span class="op" id="5999333">;</span>&nbsp;<span class="ident" id="5999335">i</span>&nbsp;<span class="op" id="5999337">&lt;</span>&nbsp;<span class="builtinfunc" id="5999339">len</span><span class="op" id="5999342">(</span><span class="ident" id="5999343">x</span><span class="op" id="5999344">.</span><span class="ident" id="5999345">sa</span><span class="op" id="5999347">)</span><span class="op" id="5999348">;</span>&nbsp;<span class="ident" id="5999350">i</span><span class="op" id="5999351">++</span>&nbsp;<span class="op" id="5999354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999358">if</span>&nbsp;<span class="ident" id="5999361">g</span>&nbsp;<span class="op" id="5999363">:=</span>&nbsp;<span class="ident" id="5999366">x</span><span class="op" id="5999367">.</span><span class="ident" id="5999368">inv</span><span class="op" id="5999371">[</span><span class="ident" id="5999372">x</span><span class="op" id="5999373">.</span><span class="ident" id="5999374">sa</span><span class="op" id="5999376">[</span><span class="ident" id="5999377">i</span><span class="op" id="5999378">]</span><span class="op" id="5999379">+</span><span class="ident" id="5999380">x</span><span class="op" id="5999381">.</span><span class="ident" id="5999382">h</span><span class="op" id="5999383">]</span><span class="op" id="5999384">;</span>&nbsp;<span class="ident" id="5999386">g</span>&nbsp;<span class="op" id="5999388">&gt;</span>&nbsp;<span class="ident" id="5999390">group</span>&nbsp;<span class="op" id="5999396">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999401">bounds</span>&nbsp;<span class="op" id="5999408">=</span>&nbsp;<span class="builtinfunc" id="5999410">append</span><span class="op" id="5999416">(</span><span class="ident" id="5999417">bounds</span><span class="op" id="5999423">,</span>&nbsp;<span class="ident" id="5999425">i</span><span class="op" id="5999426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999431">group</span>&nbsp;<span class="op" id="5999437">=</span>&nbsp;<span class="ident" id="5999439">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999449">bounds</span>&nbsp;<span class="op" id="5999456">=</span>&nbsp;<span class="builtinfunc" id="5999458">append</span><span class="op" id="5999464">(</span><span class="ident" id="5999465">bounds</span><span class="op" id="5999471">,</span>&nbsp;<span class="builtinfunc" id="5999473">len</span><span class="op" id="5999476">(</span><span class="ident" id="5999477">x</span><span class="op" id="5999478">.</span><span class="ident" id="5999479">sa</span><span class="op" id="5999481">)</span><span class="op" id="5999482">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999485">x</span><span class="op" id="5999486">.</span><span class="ident" id="5999487">buf</span>&nbsp;<span class="op" id="5999491">=</span>&nbsp;<span class="ident" id="5999493">bounds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5999502">//&nbsp;update&nbsp;the&nbsp;group&nbsp;numberings&nbsp;after&nbsp;all&nbsp;new&nbsp;groups&nbsp;are&nbsp;determined</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999570">prev</span>&nbsp;<span class="op" id="5999575">:=</span>&nbsp;<span class="num" id="5999578">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999581">for</span>&nbsp;<span class="ident" id="5999585">_</span><span class="op" id="5999586">,</span>&nbsp;<span class="ident" id="5999588">b</span>&nbsp;<span class="op" id="5999590">:=</span>&nbsp;<span class="keyword" id="5999593">range</span>&nbsp;<span class="ident" id="5999599">bounds</span>&nbsp;<span class="op" id="5999606">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999610">for</span>&nbsp;<span class="ident" id="5999614">i</span>&nbsp;<span class="op" id="5999616">:=</span>&nbsp;<span class="ident" id="5999619">prev</span><span class="op" id="5999623">;</span>&nbsp;<span class="ident" id="5999625">i</span>&nbsp;<span class="op" id="5999627">&lt;</span>&nbsp;<span class="ident" id="5999629">b</span><span class="op" id="5999630">;</span>&nbsp;<span class="ident" id="5999632">i</span><span class="op" id="5999633">++</span>&nbsp;<span class="op" id="5999636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999641">x</span><span class="op" id="5999642">.</span><span class="ident" id="5999643">inv</span><span class="op" id="5999646">[</span><span class="ident" id="5999647">x</span><span class="op" id="5999648">.</span><span class="ident" id="5999649">sa</span><span class="op" id="5999651">[</span><span class="ident" id="5999652">i</span><span class="op" id="5999653">]</span><span class="op" id="5999654">]</span>&nbsp;<span class="op" id="5999656">=</span>&nbsp;<span class="ident" id="5999658">offset</span>&nbsp;<span class="op" id="5999665">+</span>&nbsp;<span class="ident" id="5999667">b</span>&nbsp;<span class="op" id="5999669">-</span>&nbsp;<span class="num" id="5999671">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999679">if</span>&nbsp;<span class="ident" id="5999682">b</span><span class="op" id="5999683">-</span><span class="ident" id="5999684">prev</span>&nbsp;<span class="op" id="5999689">==</span>&nbsp;<span class="num" id="5999692">1</span>&nbsp;<span class="op" id="5999694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999699">x</span><span class="op" id="5999700">.</span><span class="ident" id="5999701">sa</span><span class="op" id="5999703">[</span><span class="ident" id="5999704">prev</span><span class="op" id="5999708">]</span>&nbsp;<span class="op" id="5999710">=</span>&nbsp;<span class="op" id="5999712">-</span><span class="num" id="5999713">1</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999721">prev</span>&nbsp;<span class="op" id="5999726">=</span>&nbsp;<span class="ident" id="5999728">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999731">}</span><br>
<span class="lineno"></span><span class="op" id="5999733">}</span>
</div>
</body>
</html>
