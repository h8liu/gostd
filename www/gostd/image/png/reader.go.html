<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5806680">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5806735">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5806789">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5806840">//&nbsp;Package&nbsp;png&nbsp;implements&nbsp;a&nbsp;PNG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5806899">//</span><br>
<span class="lineno"></span><span class="comment" id="5806902">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/TR/PNG/.</span><br>
<span class="lineno"></span><span class="keyword" id="5806960">package</span>&nbsp;<span class="ident" id="5806968">png</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5806973">import</span>&nbsp;<span class="op" id="5806980">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5806983">&#34;compress/zlib&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5807000">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5807019">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5807026">&#34;hash&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5807034">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5807048">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5807057">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5807072">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5807077">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5807080">//&nbsp;Color&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5807116">const</span>&nbsp;<span class="op" id="5807122">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807125">ctGrayscale</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5807142">=</span>&nbsp;<span class="num" id="5807144">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807147">ctTrueColor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5807164">=</span>&nbsp;<span class="num" id="5807166">2</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807169">ctPaletted</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5807186">=</span>&nbsp;<span class="num" id="5807188">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807191">ctGrayscaleAlpha</span>&nbsp;<span class="op" id="5807208">=</span>&nbsp;<span class="num" id="5807210">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807213">ctTrueColorAlpha</span>&nbsp;<span class="op" id="5807230">=</span>&nbsp;<span class="num" id="5807232">6</span><br>
<span class="lineno"></span><span class="op" id="5807234">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5807237">//&nbsp;A&nbsp;cb&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;color&nbsp;type&nbsp;and&nbsp;bit&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5807291">const</span>&nbsp;<span class="op" id="5807297">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807300">cbInvalid</span>&nbsp;<span class="op" id="5807310">=</span>&nbsp;<span class="ident" id="5807312">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807318">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807324">cbG2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807330">cbG4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807336">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807342">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807349">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807356">cbP1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807362">cbP2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807368">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807374">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807380">cbTCA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807388">cbG16</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807395">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807403">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807411">cbTCA16</span><br>
<span class="lineno"></span><span class="op" id="5807419">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5807422">//&nbsp;Filter&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5807459">const</span>&nbsp;<span class="op" id="5807465">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807468">ftNone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5807478">=</span>&nbsp;<span class="num" id="5807480">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807483">ftSub</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5807493">=</span>&nbsp;<span class="num" id="5807495">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807498">ftUp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5807508">=</span>&nbsp;<span class="num" id="5807510">2</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807513">ftAverage</span>&nbsp;<span class="op" id="5807523">=</span>&nbsp;<span class="num" id="5807525">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807528">ftPaeth</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5807538">=</span>&nbsp;<span class="num" id="5807540">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807543">nFilter</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5807553">=</span>&nbsp;<span class="num" id="5807555">5</span><br>
<span class="lineno"></span><span class="op" id="5807557">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5807560">//&nbsp;Interlace&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5807579">const</span>&nbsp;<span class="op" id="5807585">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807588">itNone</span>&nbsp;&nbsp;<span class="op" id="5807596">=</span>&nbsp;<span class="num" id="5807598">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807601">itAdam7</span>&nbsp;<span class="op" id="5807609">=</span>&nbsp;<span class="num" id="5807611">1</span><br>
<span class="lineno"></span><span class="op" id="5807613">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="5807616">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;placement&nbsp;and&nbsp;size&nbsp;of&nbsp;a&nbsp;pass&nbsp;for&nbsp;Adam7&nbsp;interlacing.</span><br>
<span class="lineno"></span><span class="keyword" id="5807697">type</span>&nbsp;<span class="ident" id="5807702">interlaceScan</span>&nbsp;<span class="keyword" id="5807716">struct</span>&nbsp;<span class="op" id="5807723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807726">xFactor</span><span class="op" id="5807733">,</span>&nbsp;<span class="ident" id="5807735">yFactor</span><span class="op" id="5807742">,</span>&nbsp;<span class="ident" id="5807744">xOffset</span><span class="op" id="5807751">,</span>&nbsp;<span class="ident" id="5807753">yOffset</span>&nbsp;<span class="builtintype" id="5807761">int</span><br>
<span class="lineno"></span><span class="op" id="5807765">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="5807768">//&nbsp;interlacing&nbsp;defines&nbsp;Adam7&nbsp;interlacing,&nbsp;with&nbsp;7&nbsp;passes&nbsp;of&nbsp;reduced&nbsp;images.</span><br>
<span class="lineno"></span><span class="comment" id="5807843">//&nbsp;See&nbsp;http://www.w3.org/TR/PNG/#8Interlace</span><br>
<span class="lineno"></span><span class="keyword" id="5807887">var</span>&nbsp;<span class="ident" id="5807891">interlacing</span>&nbsp;<span class="op" id="5807903">=</span>&nbsp;<span class="op" id="5807905">[</span><span class="op" id="5807906">]</span><span class="ident" id="5807907">interlaceScan</span><span class="op" id="5807920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5807923">{</span><span class="num" id="5807924">8</span><span class="op" id="5807925">,</span>&nbsp;<span class="num" id="5807927">8</span><span class="op" id="5807928">,</span>&nbsp;<span class="num" id="5807930">0</span><span class="op" id="5807931">,</span>&nbsp;<span class="num" id="5807933">0</span><span class="op" id="5807934">}</span><span class="op" id="5807935">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5807938">{</span><span class="num" id="5807939">8</span><span class="op" id="5807940">,</span>&nbsp;<span class="num" id="5807942">8</span><span class="op" id="5807943">,</span>&nbsp;<span class="num" id="5807945">4</span><span class="op" id="5807946">,</span>&nbsp;<span class="num" id="5807948">0</span><span class="op" id="5807949">}</span><span class="op" id="5807950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5807953">{</span><span class="num" id="5807954">4</span><span class="op" id="5807955">,</span>&nbsp;<span class="num" id="5807957">8</span><span class="op" id="5807958">,</span>&nbsp;<span class="num" id="5807960">0</span><span class="op" id="5807961">,</span>&nbsp;<span class="num" id="5807963">4</span><span class="op" id="5807964">}</span><span class="op" id="5807965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5807968">{</span><span class="num" id="5807969">4</span><span class="op" id="5807970">,</span>&nbsp;<span class="num" id="5807972">4</span><span class="op" id="5807973">,</span>&nbsp;<span class="num" id="5807975">2</span><span class="op" id="5807976">,</span>&nbsp;<span class="num" id="5807978">0</span><span class="op" id="5807979">}</span><span class="op" id="5807980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5807983">{</span><span class="num" id="5807984">2</span><span class="op" id="5807985">,</span>&nbsp;<span class="num" id="5807987">4</span><span class="op" id="5807988">,</span>&nbsp;<span class="num" id="5807990">0</span><span class="op" id="5807991">,</span>&nbsp;<span class="num" id="5807993">2</span><span class="op" id="5807994">}</span><span class="op" id="5807995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5807998">{</span><span class="num" id="5807999">2</span><span class="op" id="5808000">,</span>&nbsp;<span class="num" id="5808002">2</span><span class="op" id="5808003">,</span>&nbsp;<span class="num" id="5808005">1</span><span class="op" id="5808006">,</span>&nbsp;<span class="num" id="5808008">0</span><span class="op" id="5808009">}</span><span class="op" id="5808010">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5808013">{</span><span class="num" id="5808014">1</span><span class="op" id="5808015">,</span>&nbsp;<span class="num" id="5808017">2</span><span class="op" id="5808018">,</span>&nbsp;<span class="num" id="5808020">0</span><span class="op" id="5808021">,</span>&nbsp;<span class="num" id="5808023">1</span><span class="op" id="5808024">}</span><span class="op" id="5808025">,</span><br>
<span class="lineno"></span><span class="op" id="5808027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5808030">//&nbsp;Decoding&nbsp;stage.</span><br>
<span class="lineno"></span><span class="comment" id="5808049">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;says&nbsp;that&nbsp;the&nbsp;IHDR,&nbsp;PLTE&nbsp;(if&nbsp;present),&nbsp;IDAT&nbsp;and&nbsp;IEND</span><br>
<span class="lineno">85</span><span class="comment" id="5808127">//&nbsp;chunks&nbsp;must&nbsp;appear&nbsp;in&nbsp;that&nbsp;order.&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;IDAT&nbsp;chunks,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5808203">//&nbsp;IDAT&nbsp;chunks&nbsp;must&nbsp;be&nbsp;sequential&nbsp;(i.e.&nbsp;they&nbsp;may&nbsp;not&nbsp;have&nbsp;any&nbsp;other&nbsp;chunks</span><br>
<span class="lineno"></span><span class="comment" id="5808278">//&nbsp;between&nbsp;them).</span><br>
<span class="lineno"></span><span class="comment" id="5808296">//&nbsp;http://www.w3.org/TR/PNG/#5ChunkOrdering</span><br>
<span class="lineno"></span><span class="keyword" id="5808340">const</span>&nbsp;<span class="op" id="5808346">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808349">dsStart</span>&nbsp;<span class="op" id="5808357">=</span>&nbsp;<span class="ident" id="5808359">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808365">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808377">dsSeenPLTE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808389">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808401">dsSeenIEND</span><br>
<span class="lineno">95</span><span class="op" id="5808412">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5808415">const</span>&nbsp;<span class="ident" id="5808421">pngHeader</span>&nbsp;<span class="op" id="5808431">=</span>&nbsp;<span class="string" id="5808433">&#34;\x89PNG\r\n\x1a\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5808454">type</span>&nbsp;<span class="ident" id="5808459">decoder</span>&nbsp;<span class="keyword" id="5808467">struct</span>&nbsp;<span class="op" id="5808474">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808477">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5808491">io</span><span class="op" id="5808493">.</span><span class="ident" id="5808494">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808502">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5808516">image</span><span class="op" id="5808521">.</span><span class="ident" id="5808522">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808529">crc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5808543">hash</span><span class="op" id="5808547">.</span><span class="ident" id="5808548">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808556">width</span><span class="op" id="5808561">,</span>&nbsp;<span class="ident" id="5808563">height</span>&nbsp;<span class="builtintype" id="5808570">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808575">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5808589">int</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808594">palette</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5808608">color</span><span class="op" id="5808613">.</span><span class="ident" id="5808614">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808623">cb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5808637">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808642">stage</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5808656">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808661">idatLength</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5808675">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808683">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5808697">[</span><span class="num" id="5808698">3</span>&nbsp;<span class="op" id="5808700">*</span>&nbsp;<span class="num" id="5808702">256</span><span class="op" id="5808705">]</span><span class="builtintype" id="5808706">byte</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808712">interlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5808726">int</span><br>
<span class="lineno"></span><span class="op" id="5808730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5808733">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;PNG.</span><br>
<span class="lineno"></span><span class="keyword" id="5808793">type</span>&nbsp;<span class="ident" id="5808798">FormatError</span>&nbsp;<span class="builtintype" id="5808810">string</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="5808818">func</span>&nbsp;<span class="op" id="5808823">(</span><span class="ident" id="5808824">e</span>&nbsp;<span class="ident" id="5808826">FormatError</span><span class="op" id="5808837">)</span>&nbsp;<span class="ident" id="5808839">Error</span><span class="op" id="5808844">(</span><span class="op" id="5808845">)</span>&nbsp;<span class="builtintype" id="5808847">string</span>&nbsp;<span class="op" id="5808854">{</span>&nbsp;<span class="keyword" id="5808856">return</span>&nbsp;<span class="string" id="5808863">&#34;png:&nbsp;invalid&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="5808887">+</span>&nbsp;<span class="builtintype" id="5808889">string</span><span class="op" id="5808895">(</span><span class="ident" id="5808896">e</span><span class="op" id="5808897">)</span>&nbsp;<span class="op" id="5808899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5808902">var</span>&nbsp;<span class="ident" id="5808906">chunkOrderError</span>&nbsp;<span class="op" id="5808922">=</span>&nbsp;<span class="ident" id="5808924">FormatError</span><span class="op" id="5808935">(</span><span class="string" id="5808936">&#34;chunk&nbsp;out&nbsp;of&nbsp;order&#34;</span><span class="op" id="5808956">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="5808959">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;PNG&nbsp;feature.</span><br>
<span class="lineno"></span><span class="keyword" id="5809049">type</span>&nbsp;<span class="ident" id="5809054">UnsupportedError</span>&nbsp;<span class="builtintype" id="5809071">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5809079">func</span>&nbsp;<span class="op" id="5809084">(</span><span class="ident" id="5809085">e</span>&nbsp;<span class="ident" id="5809087">UnsupportedError</span><span class="op" id="5809103">)</span>&nbsp;<span class="ident" id="5809105">Error</span><span class="op" id="5809110">(</span><span class="op" id="5809111">)</span>&nbsp;<span class="builtintype" id="5809113">string</span>&nbsp;<span class="op" id="5809120">{</span>&nbsp;<span class="keyword" id="5809122">return</span>&nbsp;<span class="string" id="5809129">&#34;png:&nbsp;unsupported&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="5809158">+</span>&nbsp;<span class="builtintype" id="5809160">string</span><span class="op" id="5809166">(</span><span class="ident" id="5809167">e</span><span class="op" id="5809168">)</span>&nbsp;<span class="op" id="5809170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="5809173">func</span>&nbsp;<span class="ident" id="5809178">min</span><span class="op" id="5809181">(</span><span class="ident" id="5809182">a</span><span class="op" id="5809183">,</span>&nbsp;<span class="ident" id="5809185">b</span>&nbsp;<span class="builtintype" id="5809187">int</span><span class="op" id="5809190">)</span>&nbsp;<span class="builtintype" id="5809192">int</span>&nbsp;<span class="op" id="5809196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809199">if</span>&nbsp;<span class="ident" id="5809202">a</span>&nbsp;<span class="op" id="5809204">&lt;</span>&nbsp;<span class="ident" id="5809206">b</span>&nbsp;<span class="op" id="5809208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809212">return</span>&nbsp;<span class="ident" id="5809219">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809225">return</span>&nbsp;<span class="ident" id="5809232">b</span><br>
<span class="lineno">130</span><span class="op" id="5809234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5809237">func</span>&nbsp;<span class="op" id="5809242">(</span><span class="ident" id="5809243">d</span>&nbsp;<span class="op" id="5809245">*</span><span class="ident" id="5809246">decoder</span><span class="op" id="5809253">)</span>&nbsp;<span class="ident" id="5809255">parseIHDR</span><span class="op" id="5809264">(</span><span class="ident" id="5809265">length</span>&nbsp;<span class="builtintype" id="5809272">uint32</span><span class="op" id="5809278">)</span>&nbsp;<span class="builtintype" id="5809280">error</span>&nbsp;<span class="op" id="5809286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809289">if</span>&nbsp;<span class="ident" id="5809292">length</span>&nbsp;<span class="op" id="5809299">!=</span>&nbsp;<span class="num" id="5809302">13</span>&nbsp;<span class="op" id="5809305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809309">return</span>&nbsp;<span class="ident" id="5809316">FormatError</span><span class="op" id="5809327">(</span><span class="string" id="5809328">&#34;bad&nbsp;IHDR&nbsp;length&#34;</span><span class="op" id="5809345">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809351">if</span>&nbsp;<span class="ident" id="5809354">_</span><span class="op" id="5809355">,</span>&nbsp;<span class="ident" id="5809357">err</span>&nbsp;<span class="op" id="5809361">:=</span>&nbsp;<span class="ident" id="5809364">io</span><span class="op" id="5809366">.</span><span class="ident" id="5809367">ReadFull</span><span class="op" id="5809375">(</span><span class="ident" id="5809376">d</span><span class="op" id="5809377">.</span><span class="ident" id="5809378">r</span><span class="op" id="5809379">,</span>&nbsp;<span class="ident" id="5809381">d</span><span class="op" id="5809382">.</span><span class="ident" id="5809383">tmp</span><span class="op" id="5809386">[</span><span class="op" id="5809387">:</span><span class="num" id="5809388">13</span><span class="op" id="5809390">]</span><span class="op" id="5809391">)</span><span class="op" id="5809392">;</span>&nbsp;<span class="ident" id="5809394">err</span>&nbsp;<span class="op" id="5809398">!=</span>&nbsp;<span class="ident" id="5809401">nil</span>&nbsp;<span class="op" id="5809405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809409">return</span>&nbsp;<span class="ident" id="5809416">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809424">d</span><span class="op" id="5809425">.</span><span class="ident" id="5809426">crc</span><span class="op" id="5809429">.</span><span class="ident" id="5809430">Write</span><span class="op" id="5809435">(</span><span class="ident" id="5809436">d</span><span class="op" id="5809437">.</span><span class="ident" id="5809438">tmp</span><span class="op" id="5809441">[</span><span class="op" id="5809442">:</span><span class="num" id="5809443">13</span><span class="op" id="5809445">]</span><span class="op" id="5809446">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809449">if</span>&nbsp;<span class="ident" id="5809452">d</span><span class="op" id="5809453">.</span><span class="ident" id="5809454">tmp</span><span class="op" id="5809457">[</span><span class="num" id="5809458">10</span><span class="op" id="5809460">]</span>&nbsp;<span class="op" id="5809462">!=</span>&nbsp;<span class="num" id="5809465">0</span>&nbsp;<span class="op" id="5809467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809471">return</span>&nbsp;<span class="ident" id="5809478">UnsupportedError</span><span class="op" id="5809494">(</span><span class="string" id="5809495">&#34;compression&nbsp;method&#34;</span><span class="op" id="5809515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809521">if</span>&nbsp;<span class="ident" id="5809524">d</span><span class="op" id="5809525">.</span><span class="ident" id="5809526">tmp</span><span class="op" id="5809529">[</span><span class="num" id="5809530">11</span><span class="op" id="5809532">]</span>&nbsp;<span class="op" id="5809534">!=</span>&nbsp;<span class="num" id="5809537">0</span>&nbsp;<span class="op" id="5809539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809543">return</span>&nbsp;<span class="ident" id="5809550">UnsupportedError</span><span class="op" id="5809566">(</span><span class="string" id="5809567">&#34;filter&nbsp;method&#34;</span><span class="op" id="5809582">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809588">if</span>&nbsp;<span class="ident" id="5809591">d</span><span class="op" id="5809592">.</span><span class="ident" id="5809593">tmp</span><span class="op" id="5809596">[</span><span class="num" id="5809597">12</span><span class="op" id="5809599">]</span>&nbsp;<span class="op" id="5809601">!=</span>&nbsp;<span class="ident" id="5809604">itNone</span>&nbsp;<span class="op" id="5809611">&amp;&amp;</span>&nbsp;<span class="ident" id="5809614">d</span><span class="op" id="5809615">.</span><span class="ident" id="5809616">tmp</span><span class="op" id="5809619">[</span><span class="num" id="5809620">12</span><span class="op" id="5809622">]</span>&nbsp;<span class="op" id="5809624">!=</span>&nbsp;<span class="ident" id="5809627">itAdam7</span>&nbsp;<span class="op" id="5809635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809639">return</span>&nbsp;<span class="ident" id="5809646">FormatError</span><span class="op" id="5809657">(</span><span class="string" id="5809658">&#34;invalid&nbsp;interlace&nbsp;method&#34;</span><span class="op" id="5809684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809690">d</span><span class="op" id="5809691">.</span><span class="ident" id="5809692">interlace</span>&nbsp;<span class="op" id="5809702">=</span>&nbsp;<span class="builtintype" id="5809704">int</span><span class="op" id="5809707">(</span><span class="ident" id="5809708">d</span><span class="op" id="5809709">.</span><span class="ident" id="5809710">tmp</span><span class="op" id="5809713">[</span><span class="num" id="5809714">12</span><span class="op" id="5809716">]</span><span class="op" id="5809717">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809720">w</span>&nbsp;<span class="op" id="5809722">:=</span>&nbsp;<span class="builtintype" id="5809725">int32</span><span class="op" id="5809730">(</span><span class="ident" id="5809731">binary</span><span class="op" id="5809737">.</span><span class="ident" id="5809738">BigEndian</span><span class="op" id="5809747">.</span><span class="ident" id="5809748">Uint32</span><span class="op" id="5809754">(</span><span class="ident" id="5809755">d</span><span class="op" id="5809756">.</span><span class="ident" id="5809757">tmp</span><span class="op" id="5809760">[</span><span class="num" id="5809761">0</span><span class="op" id="5809762">:</span><span class="num" id="5809763">4</span><span class="op" id="5809764">]</span><span class="op" id="5809765">)</span><span class="op" id="5809766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809769">h</span>&nbsp;<span class="op" id="5809771">:=</span>&nbsp;<span class="builtintype" id="5809774">int32</span><span class="op" id="5809779">(</span><span class="ident" id="5809780">binary</span><span class="op" id="5809786">.</span><span class="ident" id="5809787">BigEndian</span><span class="op" id="5809796">.</span><span class="ident" id="5809797">Uint32</span><span class="op" id="5809803">(</span><span class="ident" id="5809804">d</span><span class="op" id="5809805">.</span><span class="ident" id="5809806">tmp</span><span class="op" id="5809809">[</span><span class="num" id="5809810">4</span><span class="op" id="5809811">:</span><span class="num" id="5809812">8</span><span class="op" id="5809813">]</span><span class="op" id="5809814">)</span><span class="op" id="5809815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809818">if</span>&nbsp;<span class="ident" id="5809821">w</span>&nbsp;<span class="op" id="5809823">&lt;</span>&nbsp;<span class="num" id="5809825">0</span>&nbsp;<span class="op" id="5809827">||</span>&nbsp;<span class="ident" id="5809830">h</span>&nbsp;<span class="op" id="5809832">&lt;</span>&nbsp;<span class="num" id="5809834">0</span>&nbsp;<span class="op" id="5809836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809840">return</span>&nbsp;<span class="ident" id="5809847">FormatError</span><span class="op" id="5809858">(</span><span class="string" id="5809859">&#34;negative&nbsp;dimension&#34;</span><span class="op" id="5809879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809882">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809885">nPixels</span>&nbsp;<span class="op" id="5809893">:=</span>&nbsp;<span class="ident" id="5809896">int64</span><span class="op" id="5809901">(</span><span class="ident" id="5809902">w</span><span class="op" id="5809903">)</span>&nbsp;<span class="op" id="5809905">*</span>&nbsp;<span class="ident" id="5809907">int64</span><span class="op" id="5809912">(</span><span class="ident" id="5809913">h</span><span class="op" id="5809914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809917">if</span>&nbsp;<span class="ident" id="5809920">nPixels</span>&nbsp;<span class="op" id="5809928">!=</span>&nbsp;<span class="ident" id="5809931">int64</span><span class="op" id="5809936">(</span><span class="builtintype" id="5809937">int</span><span class="op" id="5809940">(</span><span class="ident" id="5809941">nPixels</span><span class="op" id="5809948">)</span><span class="op" id="5809949">)</span>&nbsp;<span class="op" id="5809951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809955">return</span>&nbsp;<span class="ident" id="5809962">UnsupportedError</span><span class="op" id="5809978">(</span><span class="string" id="5809979">&#34;dimension&nbsp;overflow&#34;</span><span class="op" id="5809999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810005">d</span><span class="op" id="5810006">.</span><span class="ident" id="5810007">cb</span>&nbsp;<span class="op" id="5810010">=</span>&nbsp;<span class="ident" id="5810012">cbInvalid</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810023">d</span><span class="op" id="5810024">.</span><span class="ident" id="5810025">depth</span>&nbsp;<span class="op" id="5810031">=</span>&nbsp;<span class="builtintype" id="5810033">int</span><span class="op" id="5810036">(</span><span class="ident" id="5810037">d</span><span class="op" id="5810038">.</span><span class="ident" id="5810039">tmp</span><span class="op" id="5810042">[</span><span class="num" id="5810043">8</span><span class="op" id="5810044">]</span><span class="op" id="5810045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810048">switch</span>&nbsp;<span class="ident" id="5810055">d</span><span class="op" id="5810056">.</span><span class="ident" id="5810057">depth</span>&nbsp;<span class="op" id="5810063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810066">case</span>&nbsp;<span class="num" id="5810071">1</span><span class="op" id="5810072">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810076">switch</span>&nbsp;<span class="ident" id="5810083">d</span><span class="op" id="5810084">.</span><span class="ident" id="5810085">tmp</span><span class="op" id="5810088">[</span><span class="num" id="5810089">9</span><span class="op" id="5810090">]</span>&nbsp;<span class="op" id="5810092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810096">case</span>&nbsp;<span class="ident" id="5810101">ctGrayscale</span><span class="op" id="5810112">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810117">d</span><span class="op" id="5810118">.</span><span class="ident" id="5810119">cb</span>&nbsp;<span class="op" id="5810122">=</span>&nbsp;<span class="ident" id="5810124">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810131">case</span>&nbsp;<span class="ident" id="5810136">ctPaletted</span><span class="op" id="5810146">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810151">d</span><span class="op" id="5810152">.</span><span class="ident" id="5810153">cb</span>&nbsp;<span class="op" id="5810156">=</span>&nbsp;<span class="ident" id="5810158">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810168">case</span>&nbsp;<span class="num" id="5810173">2</span><span class="op" id="5810174">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810178">switch</span>&nbsp;<span class="ident" id="5810185">d</span><span class="op" id="5810186">.</span><span class="ident" id="5810187">tmp</span><span class="op" id="5810190">[</span><span class="num" id="5810191">9</span><span class="op" id="5810192">]</span>&nbsp;<span class="op" id="5810194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810198">case</span>&nbsp;<span class="ident" id="5810203">ctGrayscale</span><span class="op" id="5810214">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810219">d</span><span class="op" id="5810220">.</span><span class="ident" id="5810221">cb</span>&nbsp;<span class="op" id="5810224">=</span>&nbsp;<span class="ident" id="5810226">cbG2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810233">case</span>&nbsp;<span class="ident" id="5810238">ctPaletted</span><span class="op" id="5810248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810253">d</span><span class="op" id="5810254">.</span><span class="ident" id="5810255">cb</span>&nbsp;<span class="op" id="5810258">=</span>&nbsp;<span class="ident" id="5810260">cbP2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810270">case</span>&nbsp;<span class="num" id="5810275">4</span><span class="op" id="5810276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810280">switch</span>&nbsp;<span class="ident" id="5810287">d</span><span class="op" id="5810288">.</span><span class="ident" id="5810289">tmp</span><span class="op" id="5810292">[</span><span class="num" id="5810293">9</span><span class="op" id="5810294">]</span>&nbsp;<span class="op" id="5810296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810300">case</span>&nbsp;<span class="ident" id="5810305">ctGrayscale</span><span class="op" id="5810316">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810321">d</span><span class="op" id="5810322">.</span><span class="ident" id="5810323">cb</span>&nbsp;<span class="op" id="5810326">=</span>&nbsp;<span class="ident" id="5810328">cbG4</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810335">case</span>&nbsp;<span class="ident" id="5810340">ctPaletted</span><span class="op" id="5810350">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810355">d</span><span class="op" id="5810356">.</span><span class="ident" id="5810357">cb</span>&nbsp;<span class="op" id="5810360">=</span>&nbsp;<span class="ident" id="5810362">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810372">case</span>&nbsp;<span class="num" id="5810377">8</span><span class="op" id="5810378">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810382">switch</span>&nbsp;<span class="ident" id="5810389">d</span><span class="op" id="5810390">.</span><span class="ident" id="5810391">tmp</span><span class="op" id="5810394">[</span><span class="num" id="5810395">9</span><span class="op" id="5810396">]</span>&nbsp;<span class="op" id="5810398">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810402">case</span>&nbsp;<span class="ident" id="5810407">ctGrayscale</span><span class="op" id="5810418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810423">d</span><span class="op" id="5810424">.</span><span class="ident" id="5810425">cb</span>&nbsp;<span class="op" id="5810428">=</span>&nbsp;<span class="ident" id="5810430">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810437">case</span>&nbsp;<span class="ident" id="5810442">ctTrueColor</span><span class="op" id="5810453">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810458">d</span><span class="op" id="5810459">.</span><span class="ident" id="5810460">cb</span>&nbsp;<span class="op" id="5810463">=</span>&nbsp;<span class="ident" id="5810465">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810473">case</span>&nbsp;<span class="ident" id="5810478">ctPaletted</span><span class="op" id="5810488">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810493">d</span><span class="op" id="5810494">.</span><span class="ident" id="5810495">cb</span>&nbsp;<span class="op" id="5810498">=</span>&nbsp;<span class="ident" id="5810500">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810507">case</span>&nbsp;<span class="ident" id="5810512">ctGrayscaleAlpha</span><span class="op" id="5810528">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810533">d</span><span class="op" id="5810534">.</span><span class="ident" id="5810535">cb</span>&nbsp;<span class="op" id="5810538">=</span>&nbsp;<span class="ident" id="5810540">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810548">case</span>&nbsp;<span class="ident" id="5810553">ctTrueColorAlpha</span><span class="op" id="5810569">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810574">d</span><span class="op" id="5810575">.</span><span class="ident" id="5810576">cb</span>&nbsp;<span class="op" id="5810579">=</span>&nbsp;<span class="ident" id="5810581">cbTCA8</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810593">case</span>&nbsp;<span class="num" id="5810598">16</span><span class="op" id="5810600">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810604">switch</span>&nbsp;<span class="ident" id="5810611">d</span><span class="op" id="5810612">.</span><span class="ident" id="5810613">tmp</span><span class="op" id="5810616">[</span><span class="num" id="5810617">9</span><span class="op" id="5810618">]</span>&nbsp;<span class="op" id="5810620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810624">case</span>&nbsp;<span class="ident" id="5810629">ctGrayscale</span><span class="op" id="5810640">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810645">d</span><span class="op" id="5810646">.</span><span class="ident" id="5810647">cb</span>&nbsp;<span class="op" id="5810650">=</span>&nbsp;<span class="ident" id="5810652">cbG16</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810660">case</span>&nbsp;<span class="ident" id="5810665">ctTrueColor</span><span class="op" id="5810676">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810681">d</span><span class="op" id="5810682">.</span><span class="ident" id="5810683">cb</span>&nbsp;<span class="op" id="5810686">=</span>&nbsp;<span class="ident" id="5810688">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810697">case</span>&nbsp;<span class="ident" id="5810702">ctGrayscaleAlpha</span><span class="op" id="5810718">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810723">d</span><span class="op" id="5810724">.</span><span class="ident" id="5810725">cb</span>&nbsp;<span class="op" id="5810728">=</span>&nbsp;<span class="ident" id="5810730">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810739">case</span>&nbsp;<span class="ident" id="5810744">ctTrueColorAlpha</span><span class="op" id="5810760">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810765">d</span><span class="op" id="5810766">.</span><span class="ident" id="5810767">cb</span>&nbsp;<span class="op" id="5810770">=</span>&nbsp;<span class="ident" id="5810772">cbTCA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810788">if</span>&nbsp;<span class="ident" id="5810791">d</span><span class="op" id="5810792">.</span><span class="ident" id="5810793">cb</span>&nbsp;<span class="op" id="5810796">==</span>&nbsp;<span class="ident" id="5810799">cbInvalid</span>&nbsp;<span class="op" id="5810809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810813">return</span>&nbsp;<span class="ident" id="5810820">UnsupportedError</span><span class="op" id="5810836">(</span><span class="ident" id="5810837">fmt</span><span class="op" id="5810840">.</span><span class="ident" id="5810841">Sprintf</span><span class="op" id="5810848">(</span><span class="string" id="5810849">&#34;bit&nbsp;depth&nbsp;%d,&nbsp;color&nbsp;type&nbsp;%d&#34;</span><span class="op" id="5810878">,</span>&nbsp;<span class="ident" id="5810880">d</span><span class="op" id="5810881">.</span><span class="ident" id="5810882">tmp</span><span class="op" id="5810885">[</span><span class="num" id="5810886">8</span><span class="op" id="5810887">]</span><span class="op" id="5810888">,</span>&nbsp;<span class="ident" id="5810890">d</span><span class="op" id="5810891">.</span><span class="ident" id="5810892">tmp</span><span class="op" id="5810895">[</span><span class="num" id="5810896">9</span><span class="op" id="5810897">]</span><span class="op" id="5810898">)</span><span class="op" id="5810899">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810905">d</span><span class="op" id="5810906">.</span><span class="ident" id="5810907">width</span><span class="op" id="5810912">,</span>&nbsp;<span class="ident" id="5810914">d</span><span class="op" id="5810915">.</span><span class="ident" id="5810916">height</span>&nbsp;<span class="op" id="5810923">=</span>&nbsp;<span class="builtintype" id="5810925">int</span><span class="op" id="5810928">(</span><span class="ident" id="5810929">w</span><span class="op" id="5810930">)</span><span class="op" id="5810931">,</span>&nbsp;<span class="builtintype" id="5810933">int</span><span class="op" id="5810936">(</span><span class="ident" id="5810937">h</span><span class="op" id="5810938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810941">return</span>&nbsp;<span class="ident" id="5810948">d</span><span class="op" id="5810949">.</span><span class="ident" id="5810950">verifyChecksum</span><span class="op" id="5810964">(</span><span class="op" id="5810965">)</span><br>
<span class="lineno"></span><span class="op" id="5810967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="5810970">func</span>&nbsp;<span class="op" id="5810975">(</span><span class="ident" id="5810976">d</span>&nbsp;<span class="op" id="5810978">*</span><span class="ident" id="5810979">decoder</span><span class="op" id="5810986">)</span>&nbsp;<span class="ident" id="5810988">parsePLTE</span><span class="op" id="5810997">(</span><span class="ident" id="5810998">length</span>&nbsp;<span class="builtintype" id="5811005">uint32</span><span class="op" id="5811011">)</span>&nbsp;<span class="builtintype" id="5811013">error</span>&nbsp;<span class="op" id="5811019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811022">np</span>&nbsp;<span class="op" id="5811025">:=</span>&nbsp;<span class="builtintype" id="5811028">int</span><span class="op" id="5811031">(</span><span class="ident" id="5811032">length</span>&nbsp;<span class="op" id="5811039">/</span>&nbsp;<span class="num" id="5811041">3</span><span class="op" id="5811042">)</span>&nbsp;<span class="comment" id="5811044">//&nbsp;The&nbsp;number&nbsp;of&nbsp;palette&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811079">if</span>&nbsp;<span class="ident" id="5811082">length</span><span class="op" id="5811088">%</span><span class="num" id="5811089">3</span>&nbsp;<span class="op" id="5811091">!=</span>&nbsp;<span class="num" id="5811094">0</span>&nbsp;<span class="op" id="5811096">||</span>&nbsp;<span class="ident" id="5811099">np</span>&nbsp;<span class="op" id="5811102">&lt;=</span>&nbsp;<span class="num" id="5811105">0</span>&nbsp;<span class="op" id="5811107">||</span>&nbsp;<span class="ident" id="5811110">np</span>&nbsp;<span class="op" id="5811113">&gt;</span>&nbsp;<span class="num" id="5811115">256</span>&nbsp;<span class="op" id="5811119">||</span>&nbsp;<span class="ident" id="5811122">np</span>&nbsp;<span class="op" id="5811125">&gt;</span>&nbsp;<span class="num" id="5811127">1</span><span class="op" id="5811128">&lt;&lt;</span><span class="builtintype" id="5811130">uint</span><span class="op" id="5811134">(</span><span class="ident" id="5811135">d</span><span class="op" id="5811136">.</span><span class="ident" id="5811137">depth</span><span class="op" id="5811142">)</span>&nbsp;<span class="op" id="5811144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811148">return</span>&nbsp;<span class="ident" id="5811155">FormatError</span><span class="op" id="5811166">(</span><span class="string" id="5811167">&#34;bad&nbsp;PLTE&nbsp;length&#34;</span><span class="op" id="5811184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811187">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811190">n</span><span class="op" id="5811191">,</span>&nbsp;<span class="ident" id="5811193">err</span>&nbsp;<span class="op" id="5811197">:=</span>&nbsp;<span class="ident" id="5811200">io</span><span class="op" id="5811202">.</span><span class="ident" id="5811203">ReadFull</span><span class="op" id="5811211">(</span><span class="ident" id="5811212">d</span><span class="op" id="5811213">.</span><span class="ident" id="5811214">r</span><span class="op" id="5811215">,</span>&nbsp;<span class="ident" id="5811217">d</span><span class="op" id="5811218">.</span><span class="ident" id="5811219">tmp</span><span class="op" id="5811222">[</span><span class="op" id="5811223">:</span><span class="num" id="5811224">3</span><span class="op" id="5811225">*</span><span class="ident" id="5811226">np</span><span class="op" id="5811228">]</span><span class="op" id="5811229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811232">if</span>&nbsp;<span class="ident" id="5811235">err</span>&nbsp;<span class="op" id="5811239">!=</span>&nbsp;<span class="ident" id="5811242">nil</span>&nbsp;<span class="op" id="5811246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811250">return</span>&nbsp;<span class="ident" id="5811257">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811265">d</span><span class="op" id="5811266">.</span><span class="ident" id="5811267">crc</span><span class="op" id="5811270">.</span><span class="ident" id="5811271">Write</span><span class="op" id="5811276">(</span><span class="ident" id="5811277">d</span><span class="op" id="5811278">.</span><span class="ident" id="5811279">tmp</span><span class="op" id="5811282">[</span><span class="op" id="5811283">:</span><span class="ident" id="5811284">n</span><span class="op" id="5811285">]</span><span class="op" id="5811286">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811289">switch</span>&nbsp;<span class="ident" id="5811296">d</span><span class="op" id="5811297">.</span><span class="ident" id="5811298">cb</span>&nbsp;<span class="op" id="5811301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811304">case</span>&nbsp;<span class="ident" id="5811309">cbP1</span><span class="op" id="5811313">,</span>&nbsp;<span class="ident" id="5811315">cbP2</span><span class="op" id="5811319">,</span>&nbsp;<span class="ident" id="5811321">cbP4</span><span class="op" id="5811325">,</span>&nbsp;<span class="ident" id="5811327">cbP8</span><span class="op" id="5811331">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811335">d</span><span class="op" id="5811336">.</span><span class="ident" id="5811337">palette</span>&nbsp;<span class="op" id="5811345">=</span>&nbsp;<span class="builtinfunc" id="5811347">make</span><span class="op" id="5811351">(</span><span class="ident" id="5811352">color</span><span class="op" id="5811357">.</span><span class="ident" id="5811358">Palette</span><span class="op" id="5811365">,</span>&nbsp;<span class="num" id="5811367">256</span><span class="op" id="5811370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811374">for</span>&nbsp;<span class="ident" id="5811378">i</span>&nbsp;<span class="op" id="5811380">:=</span>&nbsp;<span class="num" id="5811383">0</span><span class="op" id="5811384">;</span>&nbsp;<span class="ident" id="5811386">i</span>&nbsp;<span class="op" id="5811388">&lt;</span>&nbsp;<span class="ident" id="5811390">np</span><span class="op" id="5811392">;</span>&nbsp;<span class="ident" id="5811394">i</span><span class="op" id="5811395">++</span>&nbsp;<span class="op" id="5811398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811403">d</span><span class="op" id="5811404">.</span><span class="ident" id="5811405">palette</span><span class="op" id="5811412">[</span><span class="ident" id="5811413">i</span><span class="op" id="5811414">]</span>&nbsp;<span class="op" id="5811416">=</span>&nbsp;<span class="ident" id="5811418">color</span><span class="op" id="5811423">.</span><span class="ident" id="5811424">RGBA</span><span class="op" id="5811428">{</span><span class="ident" id="5811429">d</span><span class="op" id="5811430">.</span><span class="ident" id="5811431">tmp</span><span class="op" id="5811434">[</span><span class="num" id="5811435">3</span><span class="op" id="5811436">*</span><span class="ident" id="5811437">i</span><span class="op" id="5811438">+</span><span class="num" id="5811439">0</span><span class="op" id="5811440">]</span><span class="op" id="5811441">,</span>&nbsp;<span class="ident" id="5811443">d</span><span class="op" id="5811444">.</span><span class="ident" id="5811445">tmp</span><span class="op" id="5811448">[</span><span class="num" id="5811449">3</span><span class="op" id="5811450">*</span><span class="ident" id="5811451">i</span><span class="op" id="5811452">+</span><span class="num" id="5811453">1</span><span class="op" id="5811454">]</span><span class="op" id="5811455">,</span>&nbsp;<span class="ident" id="5811457">d</span><span class="op" id="5811458">.</span><span class="ident" id="5811459">tmp</span><span class="op" id="5811462">[</span><span class="num" id="5811463">3</span><span class="op" id="5811464">*</span><span class="ident" id="5811465">i</span><span class="op" id="5811466">+</span><span class="num" id="5811467">2</span><span class="op" id="5811468">]</span><span class="op" id="5811469">,</span>&nbsp;<span class="num" id="5811471">0xff</span><span class="op" id="5811475">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811483">for</span>&nbsp;<span class="ident" id="5811487">i</span>&nbsp;<span class="op" id="5811489">:=</span>&nbsp;<span class="ident" id="5811492">np</span><span class="op" id="5811494">;</span>&nbsp;<span class="ident" id="5811496">i</span>&nbsp;<span class="op" id="5811498">&lt;</span>&nbsp;<span class="num" id="5811500">256</span><span class="op" id="5811503">;</span>&nbsp;<span class="ident" id="5811505">i</span><span class="op" id="5811506">++</span>&nbsp;<span class="op" id="5811509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5811514">//&nbsp;Initialize&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;palette&nbsp;to&nbsp;opaque&nbsp;black.&nbsp;The&nbsp;spec&nbsp;(section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5811590">//&nbsp;11.2.3)&nbsp;says&nbsp;that&nbsp;&#34;any&nbsp;out-of-range&nbsp;pixel&nbsp;value&nbsp;found&nbsp;in&nbsp;the&nbsp;image&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5811668">//&nbsp;is&nbsp;an&nbsp;error&#34;,&nbsp;but&nbsp;some&nbsp;real-world&nbsp;PNG&nbsp;files&nbsp;have&nbsp;out-of-range&nbsp;pixel</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5811742">//&nbsp;values.&nbsp;We&nbsp;fall&nbsp;back&nbsp;to&nbsp;opaque&nbsp;black,&nbsp;the&nbsp;same&nbsp;as&nbsp;libpng&nbsp;1.5.13;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5811813">//&nbsp;ImageMagick&nbsp;6.5.7&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811855">d</span><span class="op" id="5811856">.</span><span class="ident" id="5811857">palette</span><span class="op" id="5811864">[</span><span class="ident" id="5811865">i</span><span class="op" id="5811866">]</span>&nbsp;<span class="op" id="5811868">=</span>&nbsp;<span class="ident" id="5811870">color</span><span class="op" id="5811875">.</span><span class="ident" id="5811876">RGBA</span><span class="op" id="5811880">{</span><span class="num" id="5811881">0x00</span><span class="op" id="5811885">,</span>&nbsp;<span class="num" id="5811887">0x00</span><span class="op" id="5811891">,</span>&nbsp;<span class="num" id="5811893">0x00</span><span class="op" id="5811897">,</span>&nbsp;<span class="num" id="5811899">0xff</span><span class="op" id="5811903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5811907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5811911">d</span><span class="op" id="5811912">.</span><span class="ident" id="5811913">palette</span>&nbsp;<span class="op" id="5811921">=</span>&nbsp;<span class="ident" id="5811923">d</span><span class="op" id="5811924">.</span><span class="ident" id="5811925">palette</span><span class="op" id="5811932">[</span><span class="op" id="5811933">:</span><span class="ident" id="5811934">np</span><span class="op" id="5811936">]</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5811939">case</span>&nbsp;<span class="ident" id="5811944">cbTC8</span><span class="op" id="5811949">,</span>&nbsp;<span class="ident" id="5811951">cbTCA8</span><span class="op" id="5811957">,</span>&nbsp;<span class="ident" id="5811959">cbTC16</span><span class="op" id="5811965">,</span>&nbsp;<span class="ident" id="5811967">cbTCA16</span><span class="op" id="5811974">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5811978">//&nbsp;As&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec,&nbsp;a&nbsp;PLTE&nbsp;chunk&nbsp;is&nbsp;optional&nbsp;(and&nbsp;for&nbsp;practical&nbsp;purposes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5812058">//&nbsp;ignorable)&nbsp;for&nbsp;the&nbsp;ctTrueColor&nbsp;and&nbsp;ctTrueColorAlpha&nbsp;color&nbsp;types&nbsp;(section&nbsp;4.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812143">default</span><span class="op" id="5812150">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812154">return</span>&nbsp;<span class="ident" id="5812161">FormatError</span><span class="op" id="5812172">(</span><span class="string" id="5812173">&#34;PLTE,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="5812200">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812206">return</span>&nbsp;<span class="ident" id="5812213">d</span><span class="op" id="5812214">.</span><span class="ident" id="5812215">verifyChecksum</span><span class="op" id="5812229">(</span><span class="op" id="5812230">)</span><br>
<span class="lineno"></span><span class="op" id="5812232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5812235">func</span>&nbsp;<span class="op" id="5812240">(</span><span class="ident" id="5812241">d</span>&nbsp;<span class="op" id="5812243">*</span><span class="ident" id="5812244">decoder</span><span class="op" id="5812251">)</span>&nbsp;<span class="ident" id="5812253">parsetRNS</span><span class="op" id="5812262">(</span><span class="ident" id="5812263">length</span>&nbsp;<span class="builtintype" id="5812270">uint32</span><span class="op" id="5812276">)</span>&nbsp;<span class="builtintype" id="5812278">error</span>&nbsp;<span class="op" id="5812284">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812287">if</span>&nbsp;<span class="ident" id="5812290">length</span>&nbsp;<span class="op" id="5812297">&gt;</span>&nbsp;<span class="num" id="5812299">256</span>&nbsp;<span class="op" id="5812303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812307">return</span>&nbsp;<span class="ident" id="5812314">FormatError</span><span class="op" id="5812325">(</span><span class="string" id="5812326">&#34;bad&nbsp;tRNS&nbsp;length&#34;</span><span class="op" id="5812343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812349">n</span><span class="op" id="5812350">,</span>&nbsp;<span class="ident" id="5812352">err</span>&nbsp;<span class="op" id="5812356">:=</span>&nbsp;<span class="ident" id="5812359">io</span><span class="op" id="5812361">.</span><span class="ident" id="5812362">ReadFull</span><span class="op" id="5812370">(</span><span class="ident" id="5812371">d</span><span class="op" id="5812372">.</span><span class="ident" id="5812373">r</span><span class="op" id="5812374">,</span>&nbsp;<span class="ident" id="5812376">d</span><span class="op" id="5812377">.</span><span class="ident" id="5812378">tmp</span><span class="op" id="5812381">[</span><span class="op" id="5812382">:</span><span class="ident" id="5812383">length</span><span class="op" id="5812389">]</span><span class="op" id="5812390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812393">if</span>&nbsp;<span class="ident" id="5812396">err</span>&nbsp;<span class="op" id="5812400">!=</span>&nbsp;<span class="ident" id="5812403">nil</span>&nbsp;<span class="op" id="5812407">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812411">return</span>&nbsp;<span class="ident" id="5812418">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812426">d</span><span class="op" id="5812427">.</span><span class="ident" id="5812428">crc</span><span class="op" id="5812431">.</span><span class="ident" id="5812432">Write</span><span class="op" id="5812437">(</span><span class="ident" id="5812438">d</span><span class="op" id="5812439">.</span><span class="ident" id="5812440">tmp</span><span class="op" id="5812443">[</span><span class="op" id="5812444">:</span><span class="ident" id="5812445">n</span><span class="op" id="5812446">]</span><span class="op" id="5812447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812450">switch</span>&nbsp;<span class="ident" id="5812457">d</span><span class="op" id="5812458">.</span><span class="ident" id="5812459">cb</span>&nbsp;<span class="op" id="5812462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812465">case</span>&nbsp;<span class="ident" id="5812470">cbG8</span><span class="op" id="5812474">,</span>&nbsp;<span class="ident" id="5812476">cbG16</span><span class="op" id="5812481">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812485">return</span>&nbsp;<span class="ident" id="5812492">UnsupportedError</span><span class="op" id="5812508">(</span><span class="string" id="5812509">&#34;grayscale&nbsp;transparency&#34;</span><span class="op" id="5812533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812536">case</span>&nbsp;<span class="ident" id="5812541">cbTC8</span><span class="op" id="5812546">,</span>&nbsp;<span class="ident" id="5812548">cbTC16</span><span class="op" id="5812554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812558">return</span>&nbsp;<span class="ident" id="5812565">UnsupportedError</span><span class="op" id="5812581">(</span><span class="string" id="5812582">&#34;truecolor&nbsp;transparency&#34;</span><span class="op" id="5812606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812609">case</span>&nbsp;<span class="ident" id="5812614">cbP1</span><span class="op" id="5812618">,</span>&nbsp;<span class="ident" id="5812620">cbP2</span><span class="op" id="5812624">,</span>&nbsp;<span class="ident" id="5812626">cbP4</span><span class="op" id="5812630">,</span>&nbsp;<span class="ident" id="5812632">cbP8</span><span class="op" id="5812636">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812640">if</span>&nbsp;<span class="builtinfunc" id="5812643">len</span><span class="op" id="5812646">(</span><span class="ident" id="5812647">d</span><span class="op" id="5812648">.</span><span class="ident" id="5812649">palette</span><span class="op" id="5812656">)</span>&nbsp;<span class="op" id="5812658">&lt;</span>&nbsp;<span class="ident" id="5812660">n</span>&nbsp;<span class="op" id="5812662">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812667">d</span><span class="op" id="5812668">.</span><span class="ident" id="5812669">palette</span>&nbsp;<span class="op" id="5812677">=</span>&nbsp;<span class="ident" id="5812679">d</span><span class="op" id="5812680">.</span><span class="ident" id="5812681">palette</span><span class="op" id="5812688">[</span><span class="op" id="5812689">:</span><span class="ident" id="5812690">n</span><span class="op" id="5812691">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812699">for</span>&nbsp;<span class="ident" id="5812703">i</span>&nbsp;<span class="op" id="5812705">:=</span>&nbsp;<span class="num" id="5812708">0</span><span class="op" id="5812709">;</span>&nbsp;<span class="ident" id="5812711">i</span>&nbsp;<span class="op" id="5812713">&lt;</span>&nbsp;<span class="ident" id="5812715">n</span><span class="op" id="5812716">;</span>&nbsp;<span class="ident" id="5812718">i</span><span class="op" id="5812719">++</span>&nbsp;<span class="op" id="5812722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812727">rgba</span>&nbsp;<span class="op" id="5812732">:=</span>&nbsp;<span class="ident" id="5812735">d</span><span class="op" id="5812736">.</span><span class="ident" id="5812737">palette</span><span class="op" id="5812744">[</span><span class="ident" id="5812745">i</span><span class="op" id="5812746">]</span><span class="op" id="5812747">.</span><span class="op" id="5812748">(</span><span class="ident" id="5812749">color</span><span class="op" id="5812754">.</span><span class="ident" id="5812755">RGBA</span><span class="op" id="5812759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5812764">d</span><span class="op" id="5812765">.</span><span class="ident" id="5812766">palette</span><span class="op" id="5812773">[</span><span class="ident" id="5812774">i</span><span class="op" id="5812775">]</span>&nbsp;<span class="op" id="5812777">=</span>&nbsp;<span class="ident" id="5812779">color</span><span class="op" id="5812784">.</span><span class="ident" id="5812785">NRGBA</span><span class="op" id="5812790">{</span><span class="ident" id="5812791">rgba</span><span class="op" id="5812795">.</span><span class="ident" id="5812796">R</span><span class="op" id="5812797">,</span>&nbsp;<span class="ident" id="5812799">rgba</span><span class="op" id="5812803">.</span><span class="ident" id="5812804">G</span><span class="op" id="5812805">,</span>&nbsp;<span class="ident" id="5812807">rgba</span><span class="op" id="5812811">.</span><span class="ident" id="5812812">B</span><span class="op" id="5812813">,</span>&nbsp;<span class="ident" id="5812815">d</span><span class="op" id="5812816">.</span><span class="ident" id="5812817">tmp</span><span class="op" id="5812820">[</span><span class="ident" id="5812821">i</span><span class="op" id="5812822">]</span><span class="op" id="5812823">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812830">case</span>&nbsp;<span class="ident" id="5812835">cbGA8</span><span class="op" id="5812840">,</span>&nbsp;<span class="ident" id="5812842">cbGA16</span><span class="op" id="5812848">,</span>&nbsp;<span class="ident" id="5812850">cbTCA8</span><span class="op" id="5812856">,</span>&nbsp;<span class="ident" id="5812858">cbTCA16</span><span class="op" id="5812865">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812869">return</span>&nbsp;<span class="ident" id="5812876">FormatError</span><span class="op" id="5812887">(</span><span class="string" id="5812888">&#34;tRNS,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="5812915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5812918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5812921">return</span>&nbsp;<span class="ident" id="5812928">d</span><span class="op" id="5812929">.</span><span class="ident" id="5812930">verifyChecksum</span><span class="op" id="5812944">(</span><span class="op" id="5812945">)</span><br>
<span class="lineno">275</span><span class="op" id="5812947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5812950">//&nbsp;Read&nbsp;presents&nbsp;one&nbsp;or&nbsp;more&nbsp;IDAT&nbsp;chunks&nbsp;as&nbsp;one&nbsp;continuous&nbsp;stream&nbsp;(minus&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5813027">//&nbsp;intermediate&nbsp;chunk&nbsp;headers&nbsp;and&nbsp;footers).&nbsp;If&nbsp;the&nbsp;PNG&nbsp;data&nbsp;looked&nbsp;like:</span><br>
<span class="lineno"></span><span class="comment" id="5813100">//&nbsp;&nbsp;&nbsp;...&nbsp;len0&nbsp;IDAT&nbsp;xxx&nbsp;crc0&nbsp;len1&nbsp;IDAT&nbsp;yy&nbsp;crc1&nbsp;len2&nbsp;IEND&nbsp;crc2</span><br>
<span class="lineno">280</span><span class="comment" id="5813161">//&nbsp;then&nbsp;this&nbsp;reader&nbsp;presents&nbsp;xxxyy.&nbsp;For&nbsp;well-formed&nbsp;PNG&nbsp;data,&nbsp;the&nbsp;decoder&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="5813241">//&nbsp;immediately&nbsp;before&nbsp;the&nbsp;first&nbsp;Read&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5813321">//&nbsp;first&nbsp;IDAT&nbsp;and&nbsp;xxx,&nbsp;and&nbsp;the&nbsp;decoder&nbsp;state&nbsp;immediately&nbsp;after&nbsp;the&nbsp;last&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="5813398">//&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;yy&nbsp;and&nbsp;crc1.</span><br>
<span class="lineno"></span><span class="keyword" id="5813453">func</span>&nbsp;<span class="op" id="5813458">(</span><span class="ident" id="5813459">d</span>&nbsp;<span class="op" id="5813461">*</span><span class="ident" id="5813462">decoder</span><span class="op" id="5813469">)</span>&nbsp;<span class="ident" id="5813471">Read</span><span class="op" id="5813475">(</span><span class="ident" id="5813476">p</span>&nbsp;<span class="op" id="5813478">[</span><span class="op" id="5813479">]</span><span class="builtintype" id="5813480">byte</span><span class="op" id="5813484">)</span>&nbsp;<span class="op" id="5813486">(</span><span class="builtintype" id="5813487">int</span><span class="op" id="5813490">,</span>&nbsp;<span class="builtintype" id="5813492">error</span><span class="op" id="5813497">)</span>&nbsp;<span class="op" id="5813499">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813502">if</span>&nbsp;<span class="builtinfunc" id="5813505">len</span><span class="op" id="5813508">(</span><span class="ident" id="5813509">p</span><span class="op" id="5813510">)</span>&nbsp;<span class="op" id="5813512">==</span>&nbsp;<span class="num" id="5813515">0</span>&nbsp;<span class="op" id="5813517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813521">return</span>&nbsp;<span class="num" id="5813528">0</span><span class="op" id="5813529">,</span>&nbsp;<span class="ident" id="5813531">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813539">for</span>&nbsp;<span class="ident" id="5813543">d</span><span class="op" id="5813544">.</span><span class="ident" id="5813545">idatLength</span>&nbsp;<span class="op" id="5813556">==</span>&nbsp;<span class="num" id="5813559">0</span>&nbsp;<span class="op" id="5813561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5813565">//&nbsp;We&nbsp;have&nbsp;exhausted&nbsp;an&nbsp;IDAT&nbsp;chunk.&nbsp;Verify&nbsp;the&nbsp;checksum&nbsp;of&nbsp;that&nbsp;chunk.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813638">if</span>&nbsp;<span class="ident" id="5813641">err</span>&nbsp;<span class="op" id="5813645">:=</span>&nbsp;<span class="ident" id="5813648">d</span><span class="op" id="5813649">.</span><span class="ident" id="5813650">verifyChecksum</span><span class="op" id="5813664">(</span><span class="op" id="5813665">)</span><span class="op" id="5813666">;</span>&nbsp;<span class="ident" id="5813668">err</span>&nbsp;<span class="op" id="5813672">!=</span>&nbsp;<span class="ident" id="5813675">nil</span>&nbsp;<span class="op" id="5813679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813684">return</span>&nbsp;<span class="num" id="5813691">0</span><span class="op" id="5813692">,</span>&nbsp;<span class="ident" id="5813694">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5813704">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type&nbsp;of&nbsp;the&nbsp;next&nbsp;chunk,&nbsp;and&nbsp;check&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5813774">//&nbsp;it&nbsp;is&nbsp;an&nbsp;IDAT&nbsp;chunk.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813800">if</span>&nbsp;<span class="ident" id="5813803">_</span><span class="op" id="5813804">,</span>&nbsp;<span class="ident" id="5813806">err</span>&nbsp;<span class="op" id="5813810">:=</span>&nbsp;<span class="ident" id="5813813">io</span><span class="op" id="5813815">.</span><span class="ident" id="5813816">ReadFull</span><span class="op" id="5813824">(</span><span class="ident" id="5813825">d</span><span class="op" id="5813826">.</span><span class="ident" id="5813827">r</span><span class="op" id="5813828">,</span>&nbsp;<span class="ident" id="5813830">d</span><span class="op" id="5813831">.</span><span class="ident" id="5813832">tmp</span><span class="op" id="5813835">[</span><span class="op" id="5813836">:</span><span class="num" id="5813837">8</span><span class="op" id="5813838">]</span><span class="op" id="5813839">)</span><span class="op" id="5813840">;</span>&nbsp;<span class="ident" id="5813842">err</span>&nbsp;<span class="op" id="5813846">!=</span>&nbsp;<span class="ident" id="5813849">nil</span>&nbsp;<span class="op" id="5813853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813858">return</span>&nbsp;<span class="num" id="5813865">0</span><span class="op" id="5813866">,</span>&nbsp;<span class="ident" id="5813868">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5813874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5813878">d</span><span class="op" id="5813879">.</span><span class="ident" id="5813880">idatLength</span>&nbsp;<span class="op" id="5813891">=</span>&nbsp;<span class="ident" id="5813893">binary</span><span class="op" id="5813899">.</span><span class="ident" id="5813900">BigEndian</span><span class="op" id="5813909">.</span><span class="ident" id="5813910">Uint32</span><span class="op" id="5813916">(</span><span class="ident" id="5813917">d</span><span class="op" id="5813918">.</span><span class="ident" id="5813919">tmp</span><span class="op" id="5813922">[</span><span class="op" id="5813923">:</span><span class="num" id="5813924">4</span><span class="op" id="5813925">]</span><span class="op" id="5813926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813930">if</span>&nbsp;<span class="builtintype" id="5813933">string</span><span class="op" id="5813939">(</span><span class="ident" id="5813940">d</span><span class="op" id="5813941">.</span><span class="ident" id="5813942">tmp</span><span class="op" id="5813945">[</span><span class="num" id="5813946">4</span><span class="op" id="5813947">:</span><span class="num" id="5813948">8</span><span class="op" id="5813949">]</span><span class="op" id="5813950">)</span>&nbsp;<span class="op" id="5813952">!=</span>&nbsp;<span class="string" id="5813955">&#34;IDAT&#34;</span>&nbsp;<span class="op" id="5813962">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5813967">return</span>&nbsp;<span class="num" id="5813974">0</span><span class="op" id="5813975">,</span>&nbsp;<span class="ident" id="5813977">FormatError</span><span class="op" id="5813988">(</span><span class="string" id="5813989">&#34;not&nbsp;enough&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="5814012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5814016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814020">d</span><span class="op" id="5814021">.</span><span class="ident" id="5814022">crc</span><span class="op" id="5814025">.</span><span class="ident" id="5814026">Reset</span><span class="op" id="5814031">(</span><span class="op" id="5814032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814036">d</span><span class="op" id="5814037">.</span><span class="ident" id="5814038">crc</span><span class="op" id="5814041">.</span><span class="ident" id="5814042">Write</span><span class="op" id="5814047">(</span><span class="ident" id="5814048">d</span><span class="op" id="5814049">.</span><span class="ident" id="5814050">tmp</span><span class="op" id="5814053">[</span><span class="num" id="5814054">4</span><span class="op" id="5814055">:</span><span class="num" id="5814056">8</span><span class="op" id="5814057">]</span><span class="op" id="5814058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5814061">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814064">if</span>&nbsp;<span class="builtintype" id="5814067">int</span><span class="op" id="5814070">(</span><span class="ident" id="5814071">d</span><span class="op" id="5814072">.</span><span class="ident" id="5814073">idatLength</span><span class="op" id="5814083">)</span>&nbsp;<span class="op" id="5814085">&lt;</span>&nbsp;<span class="num" id="5814087">0</span>&nbsp;<span class="op" id="5814089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814093">return</span>&nbsp;<span class="num" id="5814100">0</span><span class="op" id="5814101">,</span>&nbsp;<span class="ident" id="5814103">UnsupportedError</span><span class="op" id="5814119">(</span><span class="string" id="5814120">&#34;IDAT&nbsp;chunk&nbsp;length&nbsp;overflow&#34;</span><span class="op" id="5814148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5814151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814154">n</span><span class="op" id="5814155">,</span>&nbsp;<span class="ident" id="5814157">err</span>&nbsp;<span class="op" id="5814161">:=</span>&nbsp;<span class="ident" id="5814164">d</span><span class="op" id="5814165">.</span><span class="ident" id="5814166">r</span><span class="op" id="5814167">.</span><span class="ident" id="5814168">Read</span><span class="op" id="5814172">(</span><span class="ident" id="5814173">p</span><span class="op" id="5814174">[</span><span class="op" id="5814175">:</span><span class="ident" id="5814176">min</span><span class="op" id="5814179">(</span><span class="builtinfunc" id="5814180">len</span><span class="op" id="5814183">(</span><span class="ident" id="5814184">p</span><span class="op" id="5814185">)</span><span class="op" id="5814186">,</span>&nbsp;<span class="builtintype" id="5814188">int</span><span class="op" id="5814191">(</span><span class="ident" id="5814192">d</span><span class="op" id="5814193">.</span><span class="ident" id="5814194">idatLength</span><span class="op" id="5814204">)</span><span class="op" id="5814205">)</span><span class="op" id="5814206">]</span><span class="op" id="5814207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814210">d</span><span class="op" id="5814211">.</span><span class="ident" id="5814212">crc</span><span class="op" id="5814215">.</span><span class="ident" id="5814216">Write</span><span class="op" id="5814221">(</span><span class="ident" id="5814222">p</span><span class="op" id="5814223">[</span><span class="op" id="5814224">:</span><span class="ident" id="5814225">n</span><span class="op" id="5814226">]</span><span class="op" id="5814227">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814230">d</span><span class="op" id="5814231">.</span><span class="ident" id="5814232">idatLength</span>&nbsp;<span class="op" id="5814243">-=</span>&nbsp;<span class="builtintype" id="5814246">uint32</span><span class="op" id="5814252">(</span><span class="ident" id="5814253">n</span><span class="op" id="5814254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814257">return</span>&nbsp;<span class="ident" id="5814264">n</span><span class="op" id="5814265">,</span>&nbsp;<span class="ident" id="5814267">err</span><br>
<span class="lineno"></span><span class="op" id="5814271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5814274">//&nbsp;decode&nbsp;decodes&nbsp;the&nbsp;IDAT&nbsp;data&nbsp;into&nbsp;an&nbsp;image.</span><br>
<span class="lineno">315</span><span class="keyword" id="5814321">func</span>&nbsp;<span class="op" id="5814326">(</span><span class="ident" id="5814327">d</span>&nbsp;<span class="op" id="5814329">*</span><span class="ident" id="5814330">decoder</span><span class="op" id="5814337">)</span>&nbsp;<span class="ident" id="5814339">decode</span><span class="op" id="5814345">(</span><span class="op" id="5814346">)</span>&nbsp;<span class="op" id="5814348">(</span><span class="ident" id="5814349">image</span><span class="op" id="5814354">.</span><span class="ident" id="5814355">Image</span><span class="op" id="5814360">,</span>&nbsp;<span class="builtintype" id="5814362">error</span><span class="op" id="5814367">)</span>&nbsp;<span class="op" id="5814369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814372">r</span><span class="op" id="5814373">,</span>&nbsp;<span class="ident" id="5814375">err</span>&nbsp;<span class="op" id="5814379">:=</span>&nbsp;<span class="ident" id="5814382">zlib</span><span class="op" id="5814386">.</span><span class="ident" id="5814387">NewReader</span><span class="op" id="5814396">(</span><span class="ident" id="5814397">d</span><span class="op" id="5814398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814401">if</span>&nbsp;<span class="ident" id="5814404">err</span>&nbsp;<span class="op" id="5814408">!=</span>&nbsp;<span class="ident" id="5814411">nil</span>&nbsp;<span class="op" id="5814415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814419">return</span>&nbsp;<span class="ident" id="5814426">nil</span><span class="op" id="5814429">,</span>&nbsp;<span class="ident" id="5814431">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5814436">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814439">defer</span>&nbsp;<span class="ident" id="5814445">r</span><span class="op" id="5814446">.</span><span class="ident" id="5814447">Close</span><span class="op" id="5814452">(</span><span class="op" id="5814453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814456">var</span>&nbsp;<span class="ident" id="5814460">img</span>&nbsp;<span class="ident" id="5814464">image</span><span class="op" id="5814469">.</span><span class="ident" id="5814470">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814477">if</span>&nbsp;<span class="ident" id="5814480">d</span><span class="op" id="5814481">.</span><span class="ident" id="5814482">interlace</span>&nbsp;<span class="op" id="5814492">==</span>&nbsp;<span class="ident" id="5814495">itNone</span>&nbsp;<span class="op" id="5814502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814506">img</span><span class="op" id="5814509">,</span>&nbsp;<span class="ident" id="5814511">err</span>&nbsp;<span class="op" id="5814515">=</span>&nbsp;<span class="ident" id="5814517">d</span><span class="op" id="5814518">.</span><span class="ident" id="5814519">readImagePass</span><span class="op" id="5814532">(</span><span class="ident" id="5814533">r</span><span class="op" id="5814534">,</span>&nbsp;<span class="num" id="5814536">0</span><span class="op" id="5814537">,</span>&nbsp;<span class="builtintype" id="5814539">false</span><span class="op" id="5814544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5814547">}</span>&nbsp;<span class="keyword" id="5814549">else</span>&nbsp;<span class="keyword" id="5814554">if</span>&nbsp;<span class="ident" id="5814557">d</span><span class="op" id="5814558">.</span><span class="ident" id="5814559">interlace</span>&nbsp;<span class="op" id="5814569">==</span>&nbsp;<span class="ident" id="5814572">itAdam7</span>&nbsp;<span class="op" id="5814580">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5814584">//&nbsp;Allocate&nbsp;a&nbsp;blank&nbsp;image&nbsp;of&nbsp;the&nbsp;full&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814630">img</span><span class="op" id="5814633">,</span>&nbsp;<span class="ident" id="5814635">err</span>&nbsp;<span class="op" id="5814639">=</span>&nbsp;<span class="ident" id="5814641">d</span><span class="op" id="5814642">.</span><span class="ident" id="5814643">readImagePass</span><span class="op" id="5814656">(</span><span class="ident" id="5814657">nil</span><span class="op" id="5814660">,</span>&nbsp;<span class="num" id="5814662">0</span><span class="op" id="5814663">,</span>&nbsp;<span class="builtintype" id="5814665">true</span><span class="op" id="5814669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814673">for</span>&nbsp;<span class="ident" id="5814677">pass</span>&nbsp;<span class="op" id="5814682">:=</span>&nbsp;<span class="num" id="5814685">0</span><span class="op" id="5814686">;</span>&nbsp;<span class="ident" id="5814688">pass</span>&nbsp;<span class="op" id="5814693">&lt;</span>&nbsp;<span class="num" id="5814695">7</span><span class="op" id="5814696">;</span>&nbsp;<span class="ident" id="5814698">pass</span><span class="op" id="5814702">++</span>&nbsp;<span class="op" id="5814705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814710">imagePass</span><span class="op" id="5814719">,</span>&nbsp;<span class="ident" id="5814721">err</span>&nbsp;<span class="op" id="5814725">:=</span>&nbsp;<span class="ident" id="5814728">d</span><span class="op" id="5814729">.</span><span class="ident" id="5814730">readImagePass</span><span class="op" id="5814743">(</span><span class="ident" id="5814744">r</span><span class="op" id="5814745">,</span>&nbsp;<span class="ident" id="5814747">pass</span><span class="op" id="5814751">,</span>&nbsp;<span class="builtintype" id="5814753">false</span><span class="op" id="5814758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814763">if</span>&nbsp;<span class="ident" id="5814766">err</span>&nbsp;<span class="op" id="5814770">!=</span>&nbsp;<span class="ident" id="5814773">nil</span>&nbsp;<span class="op" id="5814777">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814783">return</span>&nbsp;<span class="ident" id="5814790">nil</span><span class="op" id="5814793">,</span>&nbsp;<span class="ident" id="5814795">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5814802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814807">d</span><span class="op" id="5814808">.</span><span class="ident" id="5814809">mergePassInto</span><span class="op" id="5814822">(</span><span class="ident" id="5814823">img</span><span class="op" id="5814826">,</span>&nbsp;<span class="ident" id="5814828">imagePass</span><span class="op" id="5814837">,</span>&nbsp;<span class="ident" id="5814839">pass</span><span class="op" id="5814843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5814847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5814850">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5814854">//&nbsp;Check&nbsp;for&nbsp;EOF,&nbsp;to&nbsp;verify&nbsp;the&nbsp;zlib&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5814902">n</span>&nbsp;<span class="op" id="5814904">:=</span>&nbsp;<span class="num" id="5814907">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814910">for</span>&nbsp;<span class="ident" id="5814914">i</span>&nbsp;<span class="op" id="5814916">:=</span>&nbsp;<span class="num" id="5814919">0</span><span class="op" id="5814920">;</span>&nbsp;<span class="ident" id="5814922">n</span>&nbsp;<span class="op" id="5814924">==</span>&nbsp;<span class="num" id="5814927">0</span>&nbsp;<span class="op" id="5814929">&amp;&amp;</span>&nbsp;<span class="ident" id="5814932">err</span>&nbsp;<span class="op" id="5814936">==</span>&nbsp;<span class="ident" id="5814939">nil</span><span class="op" id="5814942">;</span>&nbsp;<span class="ident" id="5814944">i</span><span class="op" id="5814945">++</span>&nbsp;<span class="op" id="5814948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814952">if</span>&nbsp;<span class="ident" id="5814955">i</span>&nbsp;<span class="op" id="5814957">==</span>&nbsp;<span class="num" id="5814960">100</span>&nbsp;<span class="op" id="5814964">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5814969">return</span>&nbsp;<span class="ident" id="5814976">nil</span><span class="op" id="5814979">,</span>&nbsp;<span class="ident" id="5814981">io</span><span class="op" id="5814983">.</span><span class="ident" id="5814984">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815004">n</span><span class="op" id="5815005">,</span>&nbsp;<span class="ident" id="5815007">err</span>&nbsp;<span class="op" id="5815011">=</span>&nbsp;<span class="ident" id="5815013">r</span><span class="op" id="5815014">.</span><span class="ident" id="5815015">Read</span><span class="op" id="5815019">(</span><span class="ident" id="5815020">d</span><span class="op" id="5815021">.</span><span class="ident" id="5815022">tmp</span><span class="op" id="5815025">[</span><span class="op" id="5815026">:</span><span class="num" id="5815027">1</span><span class="op" id="5815028">]</span><span class="op" id="5815029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815035">if</span>&nbsp;<span class="ident" id="5815038">err</span>&nbsp;<span class="op" id="5815042">!=</span>&nbsp;<span class="ident" id="5815045">nil</span>&nbsp;<span class="op" id="5815049">&amp;&amp;</span>&nbsp;<span class="ident" id="5815052">err</span>&nbsp;<span class="op" id="5815056">!=</span>&nbsp;<span class="ident" id="5815059">io</span><span class="op" id="5815061">.</span><span class="ident" id="5815062">EOF</span>&nbsp;<span class="op" id="5815066">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815070">return</span>&nbsp;<span class="ident" id="5815077">nil</span><span class="op" id="5815080">,</span>&nbsp;<span class="ident" id="5815082">FormatError</span><span class="op" id="5815093">(</span><span class="ident" id="5815094">err</span><span class="op" id="5815097">.</span><span class="ident" id="5815098">Error</span><span class="op" id="5815103">(</span><span class="op" id="5815104">)</span><span class="op" id="5815105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815111">if</span>&nbsp;<span class="ident" id="5815114">n</span>&nbsp;<span class="op" id="5815116">!=</span>&nbsp;<span class="num" id="5815119">0</span>&nbsp;<span class="op" id="5815121">||</span>&nbsp;<span class="ident" id="5815124">d</span><span class="op" id="5815125">.</span><span class="ident" id="5815126">idatLength</span>&nbsp;<span class="op" id="5815137">!=</span>&nbsp;<span class="num" id="5815140">0</span>&nbsp;<span class="op" id="5815142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815146">return</span>&nbsp;<span class="ident" id="5815153">nil</span><span class="op" id="5815156">,</span>&nbsp;<span class="ident" id="5815158">FormatError</span><span class="op" id="5815169">(</span><span class="string" id="5815170">&#34;too&nbsp;much&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="5815191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815194">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815198">return</span>&nbsp;<span class="ident" id="5815205">img</span><span class="op" id="5815208">,</span>&nbsp;<span class="ident" id="5815210">nil</span><br>
<span class="lineno"></span><span class="op" id="5815214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5815217">//&nbsp;readImagePass&nbsp;reads&nbsp;a&nbsp;single&nbsp;image&nbsp;pass,&nbsp;sized&nbsp;according&nbsp;to&nbsp;the&nbsp;pass&nbsp;number.</span><br>
<span class="lineno">355</span><span class="keyword" id="5815297">func</span>&nbsp;<span class="op" id="5815302">(</span><span class="ident" id="5815303">d</span>&nbsp;<span class="op" id="5815305">*</span><span class="ident" id="5815306">decoder</span><span class="op" id="5815313">)</span>&nbsp;<span class="ident" id="5815315">readImagePass</span><span class="op" id="5815328">(</span><span class="ident" id="5815329">r</span>&nbsp;<span class="ident" id="5815331">io</span><span class="op" id="5815333">.</span><span class="ident" id="5815334">Reader</span><span class="op" id="5815340">,</span>&nbsp;<span class="ident" id="5815342">pass</span>&nbsp;<span class="builtintype" id="5815347">int</span><span class="op" id="5815350">,</span>&nbsp;<span class="ident" id="5815352">allocateOnly</span>&nbsp;<span class="builtintype" id="5815365">bool</span><span class="op" id="5815369">)</span>&nbsp;<span class="op" id="5815371">(</span><span class="ident" id="5815372">image</span><span class="op" id="5815377">.</span><span class="ident" id="5815378">Image</span><span class="op" id="5815383">,</span>&nbsp;<span class="builtintype" id="5815385">error</span><span class="op" id="5815390">)</span>&nbsp;<span class="op" id="5815392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815395">var</span>&nbsp;<span class="ident" id="5815399">bitsPerPixel</span>&nbsp;<span class="builtintype" id="5815412">int</span>&nbsp;<span class="op" id="5815416">=</span>&nbsp;<span class="num" id="5815418">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815421">pixOffset</span>&nbsp;<span class="op" id="5815431">:=</span>&nbsp;<span class="num" id="5815434">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815437">var</span>&nbsp;<span class="op" id="5815441">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815445">gray</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5815454">*</span><span class="ident" id="5815455">image</span><span class="op" id="5815460">.</span><span class="ident" id="5815461">Gray</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815468">rgba</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5815477">*</span><span class="ident" id="5815478">image</span><span class="op" id="5815483">.</span><span class="ident" id="5815484">RGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815491">paletted</span>&nbsp;<span class="op" id="5815500">*</span><span class="ident" id="5815501">image</span><span class="op" id="5815506">.</span><span class="ident" id="5815507">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815518">nrgba</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5815527">*</span><span class="ident" id="5815528">image</span><span class="op" id="5815533">.</span><span class="ident" id="5815534">NRGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815542">gray16</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5815551">*</span><span class="ident" id="5815552">image</span><span class="op" id="5815557">.</span><span class="ident" id="5815558">Gray16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815567">rgba64</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5815576">*</span><span class="ident" id="5815577">image</span><span class="op" id="5815582">.</span><span class="ident" id="5815583">RGBA64</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815592">nrgba64</span>&nbsp;&nbsp;<span class="op" id="5815601">*</span><span class="ident" id="5815602">image</span><span class="op" id="5815607">.</span><span class="ident" id="5815608">NRGBA64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815618">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5815627">image</span><span class="op" id="5815632">.</span><span class="ident" id="5815633">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815643">width</span><span class="op" id="5815648">,</span>&nbsp;<span class="ident" id="5815650">height</span>&nbsp;<span class="op" id="5815657">:=</span>&nbsp;<span class="ident" id="5815660">d</span><span class="op" id="5815661">.</span><span class="ident" id="5815662">width</span><span class="op" id="5815667">,</span>&nbsp;<span class="ident" id="5815669">d</span><span class="op" id="5815670">.</span><span class="ident" id="5815671">height</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815679">if</span>&nbsp;<span class="ident" id="5815682">d</span><span class="op" id="5815683">.</span><span class="ident" id="5815684">interlace</span>&nbsp;<span class="op" id="5815694">==</span>&nbsp;<span class="ident" id="5815697">itAdam7</span>&nbsp;<span class="op" id="5815705">&amp;&amp;</span>&nbsp;<span class="op" id="5815708">!</span><span class="ident" id="5815709">allocateOnly</span>&nbsp;<span class="op" id="5815722">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815726">p</span>&nbsp;<span class="op" id="5815728">:=</span>&nbsp;<span class="ident" id="5815731">interlacing</span><span class="op" id="5815742">[</span><span class="ident" id="5815743">pass</span><span class="op" id="5815747">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5815751">//&nbsp;Add&nbsp;the&nbsp;multiplication&nbsp;factor&nbsp;and&nbsp;subtract&nbsp;one,&nbsp;effectively&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815829">width</span>&nbsp;<span class="op" id="5815835">=</span>&nbsp;<span class="op" id="5815837">(</span><span class="ident" id="5815838">width</span>&nbsp;<span class="op" id="5815844">-</span>&nbsp;<span class="ident" id="5815846">p</span><span class="op" id="5815847">.</span><span class="ident" id="5815848">xOffset</span>&nbsp;<span class="op" id="5815856">+</span>&nbsp;<span class="ident" id="5815858">p</span><span class="op" id="5815859">.</span><span class="ident" id="5815860">xFactor</span>&nbsp;<span class="op" id="5815868">-</span>&nbsp;<span class="num" id="5815870">1</span><span class="op" id="5815871">)</span>&nbsp;<span class="op" id="5815873">/</span>&nbsp;<span class="ident" id="5815875">p</span><span class="op" id="5815876">.</span><span class="ident" id="5815877">xFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815887">height</span>&nbsp;<span class="op" id="5815894">=</span>&nbsp;<span class="op" id="5815896">(</span><span class="ident" id="5815897">height</span>&nbsp;<span class="op" id="5815904">-</span>&nbsp;<span class="ident" id="5815906">p</span><span class="op" id="5815907">.</span><span class="ident" id="5815908">yOffset</span>&nbsp;<span class="op" id="5815916">+</span>&nbsp;<span class="ident" id="5815918">p</span><span class="op" id="5815919">.</span><span class="ident" id="5815920">yFactor</span>&nbsp;<span class="op" id="5815928">-</span>&nbsp;<span class="num" id="5815930">1</span><span class="op" id="5815931">)</span>&nbsp;<span class="op" id="5815933">/</span>&nbsp;<span class="ident" id="5815935">p</span><span class="op" id="5815936">.</span><span class="ident" id="5815937">yFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5815946">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815949">switch</span>&nbsp;<span class="ident" id="5815956">d</span><span class="op" id="5815957">.</span><span class="ident" id="5815958">cb</span>&nbsp;<span class="op" id="5815961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5815964">case</span>&nbsp;<span class="ident" id="5815969">cbG1</span><span class="op" id="5815973">,</span>&nbsp;<span class="ident" id="5815975">cbG2</span><span class="op" id="5815979">,</span>&nbsp;<span class="ident" id="5815981">cbG4</span><span class="op" id="5815985">,</span>&nbsp;<span class="ident" id="5815987">cbG8</span><span class="op" id="5815991">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5815995">bitsPerPixel</span>&nbsp;<span class="op" id="5816008">=</span>&nbsp;<span class="ident" id="5816010">d</span><span class="op" id="5816011">.</span><span class="ident" id="5816012">depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816020">gray</span>&nbsp;<span class="op" id="5816025">=</span>&nbsp;<span class="ident" id="5816027">image</span><span class="op" id="5816032">.</span><span class="ident" id="5816033">NewGray</span><span class="op" id="5816040">(</span><span class="ident" id="5816041">image</span><span class="op" id="5816046">.</span><span class="ident" id="5816047">Rect</span><span class="op" id="5816051">(</span><span class="num" id="5816052">0</span><span class="op" id="5816053">,</span>&nbsp;<span class="num" id="5816055">0</span><span class="op" id="5816056">,</span>&nbsp;<span class="ident" id="5816058">width</span><span class="op" id="5816063">,</span>&nbsp;<span class="ident" id="5816065">height</span><span class="op" id="5816071">)</span><span class="op" id="5816072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816076">img</span>&nbsp;<span class="op" id="5816080">=</span>&nbsp;<span class="ident" id="5816082">gray</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816088">case</span>&nbsp;<span class="ident" id="5816093">cbGA8</span><span class="op" id="5816098">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816102">bitsPerPixel</span>&nbsp;<span class="op" id="5816115">=</span>&nbsp;<span class="num" id="5816117">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816122">nrgba</span>&nbsp;<span class="op" id="5816128">=</span>&nbsp;<span class="ident" id="5816130">image</span><span class="op" id="5816135">.</span><span class="ident" id="5816136">NewNRGBA</span><span class="op" id="5816144">(</span><span class="ident" id="5816145">image</span><span class="op" id="5816150">.</span><span class="ident" id="5816151">Rect</span><span class="op" id="5816155">(</span><span class="num" id="5816156">0</span><span class="op" id="5816157">,</span>&nbsp;<span class="num" id="5816159">0</span><span class="op" id="5816160">,</span>&nbsp;<span class="ident" id="5816162">width</span><span class="op" id="5816167">,</span>&nbsp;<span class="ident" id="5816169">height</span><span class="op" id="5816175">)</span><span class="op" id="5816176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816180">img</span>&nbsp;<span class="op" id="5816184">=</span>&nbsp;<span class="ident" id="5816186">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816193">case</span>&nbsp;<span class="ident" id="5816198">cbTC8</span><span class="op" id="5816203">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816207">bitsPerPixel</span>&nbsp;<span class="op" id="5816220">=</span>&nbsp;<span class="num" id="5816222">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816227">rgba</span>&nbsp;<span class="op" id="5816232">=</span>&nbsp;<span class="ident" id="5816234">image</span><span class="op" id="5816239">.</span><span class="ident" id="5816240">NewRGBA</span><span class="op" id="5816247">(</span><span class="ident" id="5816248">image</span><span class="op" id="5816253">.</span><span class="ident" id="5816254">Rect</span><span class="op" id="5816258">(</span><span class="num" id="5816259">0</span><span class="op" id="5816260">,</span>&nbsp;<span class="num" id="5816262">0</span><span class="op" id="5816263">,</span>&nbsp;<span class="ident" id="5816265">width</span><span class="op" id="5816270">,</span>&nbsp;<span class="ident" id="5816272">height</span><span class="op" id="5816278">)</span><span class="op" id="5816279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816283">img</span>&nbsp;<span class="op" id="5816287">=</span>&nbsp;<span class="ident" id="5816289">rgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816295">case</span>&nbsp;<span class="ident" id="5816300">cbP1</span><span class="op" id="5816304">,</span>&nbsp;<span class="ident" id="5816306">cbP2</span><span class="op" id="5816310">,</span>&nbsp;<span class="ident" id="5816312">cbP4</span><span class="op" id="5816316">,</span>&nbsp;<span class="ident" id="5816318">cbP8</span><span class="op" id="5816322">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816326">bitsPerPixel</span>&nbsp;<span class="op" id="5816339">=</span>&nbsp;<span class="ident" id="5816341">d</span><span class="op" id="5816342">.</span><span class="ident" id="5816343">depth</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816351">paletted</span>&nbsp;<span class="op" id="5816360">=</span>&nbsp;<span class="ident" id="5816362">image</span><span class="op" id="5816367">.</span><span class="ident" id="5816368">NewPaletted</span><span class="op" id="5816379">(</span><span class="ident" id="5816380">image</span><span class="op" id="5816385">.</span><span class="ident" id="5816386">Rect</span><span class="op" id="5816390">(</span><span class="num" id="5816391">0</span><span class="op" id="5816392">,</span>&nbsp;<span class="num" id="5816394">0</span><span class="op" id="5816395">,</span>&nbsp;<span class="ident" id="5816397">width</span><span class="op" id="5816402">,</span>&nbsp;<span class="ident" id="5816404">height</span><span class="op" id="5816410">)</span><span class="op" id="5816411">,</span>&nbsp;<span class="ident" id="5816413">d</span><span class="op" id="5816414">.</span><span class="ident" id="5816415">palette</span><span class="op" id="5816422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816426">img</span>&nbsp;<span class="op" id="5816430">=</span>&nbsp;<span class="ident" id="5816432">paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816442">case</span>&nbsp;<span class="ident" id="5816447">cbTCA8</span><span class="op" id="5816453">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816457">bitsPerPixel</span>&nbsp;<span class="op" id="5816470">=</span>&nbsp;<span class="num" id="5816472">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816477">nrgba</span>&nbsp;<span class="op" id="5816483">=</span>&nbsp;<span class="ident" id="5816485">image</span><span class="op" id="5816490">.</span><span class="ident" id="5816491">NewNRGBA</span><span class="op" id="5816499">(</span><span class="ident" id="5816500">image</span><span class="op" id="5816505">.</span><span class="ident" id="5816506">Rect</span><span class="op" id="5816510">(</span><span class="num" id="5816511">0</span><span class="op" id="5816512">,</span>&nbsp;<span class="num" id="5816514">0</span><span class="op" id="5816515">,</span>&nbsp;<span class="ident" id="5816517">width</span><span class="op" id="5816522">,</span>&nbsp;<span class="ident" id="5816524">height</span><span class="op" id="5816530">)</span><span class="op" id="5816531">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816535">img</span>&nbsp;<span class="op" id="5816539">=</span>&nbsp;<span class="ident" id="5816541">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816548">case</span>&nbsp;<span class="ident" id="5816553">cbG16</span><span class="op" id="5816558">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816562">bitsPerPixel</span>&nbsp;<span class="op" id="5816575">=</span>&nbsp;<span class="num" id="5816577">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816582">gray16</span>&nbsp;<span class="op" id="5816589">=</span>&nbsp;<span class="ident" id="5816591">image</span><span class="op" id="5816596">.</span><span class="ident" id="5816597">NewGray16</span><span class="op" id="5816606">(</span><span class="ident" id="5816607">image</span><span class="op" id="5816612">.</span><span class="ident" id="5816613">Rect</span><span class="op" id="5816617">(</span><span class="num" id="5816618">0</span><span class="op" id="5816619">,</span>&nbsp;<span class="num" id="5816621">0</span><span class="op" id="5816622">,</span>&nbsp;<span class="ident" id="5816624">width</span><span class="op" id="5816629">,</span>&nbsp;<span class="ident" id="5816631">height</span><span class="op" id="5816637">)</span><span class="op" id="5816638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816642">img</span>&nbsp;<span class="op" id="5816646">=</span>&nbsp;<span class="ident" id="5816648">gray16</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816656">case</span>&nbsp;<span class="ident" id="5816661">cbGA16</span><span class="op" id="5816667">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816671">bitsPerPixel</span>&nbsp;<span class="op" id="5816684">=</span>&nbsp;<span class="num" id="5816686">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816691">nrgba64</span>&nbsp;<span class="op" id="5816699">=</span>&nbsp;<span class="ident" id="5816701">image</span><span class="op" id="5816706">.</span><span class="ident" id="5816707">NewNRGBA64</span><span class="op" id="5816717">(</span><span class="ident" id="5816718">image</span><span class="op" id="5816723">.</span><span class="ident" id="5816724">Rect</span><span class="op" id="5816728">(</span><span class="num" id="5816729">0</span><span class="op" id="5816730">,</span>&nbsp;<span class="num" id="5816732">0</span><span class="op" id="5816733">,</span>&nbsp;<span class="ident" id="5816735">width</span><span class="op" id="5816740">,</span>&nbsp;<span class="ident" id="5816742">height</span><span class="op" id="5816748">)</span><span class="op" id="5816749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816753">img</span>&nbsp;<span class="op" id="5816757">=</span>&nbsp;<span class="ident" id="5816759">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816768">case</span>&nbsp;<span class="ident" id="5816773">cbTC16</span><span class="op" id="5816779">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816783">bitsPerPixel</span>&nbsp;<span class="op" id="5816796">=</span>&nbsp;<span class="num" id="5816798">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816803">rgba64</span>&nbsp;<span class="op" id="5816810">=</span>&nbsp;<span class="ident" id="5816812">image</span><span class="op" id="5816817">.</span><span class="ident" id="5816818">NewRGBA64</span><span class="op" id="5816827">(</span><span class="ident" id="5816828">image</span><span class="op" id="5816833">.</span><span class="ident" id="5816834">Rect</span><span class="op" id="5816838">(</span><span class="num" id="5816839">0</span><span class="op" id="5816840">,</span>&nbsp;<span class="num" id="5816842">0</span><span class="op" id="5816843">,</span>&nbsp;<span class="ident" id="5816845">width</span><span class="op" id="5816850">,</span>&nbsp;<span class="ident" id="5816852">height</span><span class="op" id="5816858">)</span><span class="op" id="5816859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816863">img</span>&nbsp;<span class="op" id="5816867">=</span>&nbsp;<span class="ident" id="5816869">rgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816877">case</span>&nbsp;<span class="ident" id="5816882">cbTCA16</span><span class="op" id="5816889">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816893">bitsPerPixel</span>&nbsp;<span class="op" id="5816906">=</span>&nbsp;<span class="num" id="5816908">64</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816913">nrgba64</span>&nbsp;<span class="op" id="5816921">=</span>&nbsp;<span class="ident" id="5816923">image</span><span class="op" id="5816928">.</span><span class="ident" id="5816929">NewNRGBA64</span><span class="op" id="5816939">(</span><span class="ident" id="5816940">image</span><span class="op" id="5816945">.</span><span class="ident" id="5816946">Rect</span><span class="op" id="5816950">(</span><span class="num" id="5816951">0</span><span class="op" id="5816952">,</span>&nbsp;<span class="num" id="5816954">0</span><span class="op" id="5816955">,</span>&nbsp;<span class="ident" id="5816957">width</span><span class="op" id="5816962">,</span>&nbsp;<span class="ident" id="5816964">height</span><span class="op" id="5816970">)</span><span class="op" id="5816971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816975">img</span>&nbsp;<span class="op" id="5816979">=</span>&nbsp;<span class="ident" id="5816981">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5816990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816993">if</span>&nbsp;<span class="ident" id="5816996">allocateOnly</span>&nbsp;<span class="op" id="5817009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817013">return</span>&nbsp;<span class="ident" id="5817020">img</span><span class="op" id="5817023">,</span>&nbsp;<span class="ident" id="5817025">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5817030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817033">bytesPerPixel</span>&nbsp;<span class="op" id="5817047">:=</span>&nbsp;<span class="op" id="5817050">(</span><span class="ident" id="5817051">bitsPerPixel</span>&nbsp;<span class="op" id="5817064">+</span>&nbsp;<span class="num" id="5817066">7</span><span class="op" id="5817067">)</span>&nbsp;<span class="op" id="5817069">/</span>&nbsp;<span class="num" id="5817071">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817075">//&nbsp;The&nbsp;+1&nbsp;is&nbsp;for&nbsp;the&nbsp;per-row&nbsp;filter&nbsp;type,&nbsp;which&nbsp;is&nbsp;at&nbsp;cr[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817137">rowSize</span>&nbsp;<span class="op" id="5817145">:=</span>&nbsp;<span class="num" id="5817148">1</span>&nbsp;<span class="op" id="5817150">+</span>&nbsp;<span class="op" id="5817152">(</span><span class="ident" id="5817153">bitsPerPixel</span><span class="op" id="5817165">*</span><span class="ident" id="5817166">width</span><span class="op" id="5817171">+</span><span class="num" id="5817172">7</span><span class="op" id="5817173">)</span><span class="op" id="5817174">/</span><span class="num" id="5817175">8</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817178">//&nbsp;cr&nbsp;and&nbsp;pr&nbsp;are&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;current&nbsp;and&nbsp;previous&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817240">cr</span>&nbsp;<span class="op" id="5817243">:=</span>&nbsp;<span class="builtinfunc" id="5817246">make</span><span class="op" id="5817250">(</span><span class="op" id="5817251">[</span><span class="op" id="5817252">]</span><span class="builtintype" id="5817253">uint8</span><span class="op" id="5817258">,</span>&nbsp;<span class="ident" id="5817260">rowSize</span><span class="op" id="5817267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817270">pr</span>&nbsp;<span class="op" id="5817273">:=</span>&nbsp;<span class="builtinfunc" id="5817276">make</span><span class="op" id="5817280">(</span><span class="op" id="5817281">[</span><span class="op" id="5817282">]</span><span class="builtintype" id="5817283">uint8</span><span class="op" id="5817288">,</span>&nbsp;<span class="ident" id="5817290">rowSize</span><span class="op" id="5817297">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817301">for</span>&nbsp;<span class="ident" id="5817305">y</span>&nbsp;<span class="op" id="5817307">:=</span>&nbsp;<span class="num" id="5817310">0</span><span class="op" id="5817311">;</span>&nbsp;<span class="ident" id="5817313">y</span>&nbsp;<span class="op" id="5817315">&lt;</span>&nbsp;<span class="ident" id="5817317">height</span><span class="op" id="5817323">;</span>&nbsp;<span class="ident" id="5817325">y</span><span class="op" id="5817326">++</span>&nbsp;<span class="op" id="5817329">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817333">//&nbsp;Read&nbsp;the&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817367">_</span><span class="op" id="5817368">,</span>&nbsp;<span class="ident" id="5817370">err</span>&nbsp;<span class="op" id="5817374">:=</span>&nbsp;<span class="ident" id="5817377">io</span><span class="op" id="5817379">.</span><span class="ident" id="5817380">ReadFull</span><span class="op" id="5817388">(</span><span class="ident" id="5817389">r</span><span class="op" id="5817390">,</span>&nbsp;<span class="ident" id="5817392">cr</span><span class="op" id="5817394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817398">if</span>&nbsp;<span class="ident" id="5817401">err</span>&nbsp;<span class="op" id="5817405">!=</span>&nbsp;<span class="ident" id="5817408">nil</span>&nbsp;<span class="op" id="5817412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817417">return</span>&nbsp;<span class="ident" id="5817424">nil</span><span class="op" id="5817427">,</span>&nbsp;<span class="ident" id="5817429">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5817435">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817440">//&nbsp;Apply&nbsp;the&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817463">cdat</span>&nbsp;<span class="op" id="5817468">:=</span>&nbsp;<span class="ident" id="5817471">cr</span><span class="op" id="5817473">[</span><span class="num" id="5817474">1</span><span class="op" id="5817475">:</span><span class="op" id="5817476">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817480">pdat</span>&nbsp;<span class="op" id="5817485">:=</span>&nbsp;<span class="ident" id="5817488">pr</span><span class="op" id="5817490">[</span><span class="num" id="5817491">1</span><span class="op" id="5817492">:</span><span class="op" id="5817493">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817497">switch</span>&nbsp;<span class="ident" id="5817504">cr</span><span class="op" id="5817506">[</span><span class="num" id="5817507">0</span><span class="op" id="5817508">]</span>&nbsp;<span class="op" id="5817510">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817514">case</span>&nbsp;<span class="ident" id="5817519">ftNone</span><span class="op" id="5817525">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817530">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817542">case</span>&nbsp;<span class="ident" id="5817547">ftSub</span><span class="op" id="5817552">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817557">for</span>&nbsp;<span class="ident" id="5817561">i</span>&nbsp;<span class="op" id="5817563">:=</span>&nbsp;<span class="ident" id="5817566">bytesPerPixel</span><span class="op" id="5817579">;</span>&nbsp;<span class="ident" id="5817581">i</span>&nbsp;<span class="op" id="5817583">&lt;</span>&nbsp;<span class="builtinfunc" id="5817585">len</span><span class="op" id="5817588">(</span><span class="ident" id="5817589">cdat</span><span class="op" id="5817593">)</span><span class="op" id="5817594">;</span>&nbsp;<span class="ident" id="5817596">i</span><span class="op" id="5817597">++</span>&nbsp;<span class="op" id="5817600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817606">cdat</span><span class="op" id="5817610">[</span><span class="ident" id="5817611">i</span><span class="op" id="5817612">]</span>&nbsp;<span class="op" id="5817614">+=</span>&nbsp;<span class="ident" id="5817617">cdat</span><span class="op" id="5817621">[</span><span class="ident" id="5817622">i</span><span class="op" id="5817623">-</span><span class="ident" id="5817624">bytesPerPixel</span><span class="op" id="5817637">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5817642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817646">case</span>&nbsp;<span class="ident" id="5817651">ftUp</span><span class="op" id="5817655">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817660">for</span>&nbsp;<span class="ident" id="5817664">i</span><span class="op" id="5817665">,</span>&nbsp;<span class="ident" id="5817667">p</span>&nbsp;<span class="op" id="5817669">:=</span>&nbsp;<span class="keyword" id="5817672">range</span>&nbsp;<span class="ident" id="5817678">pdat</span>&nbsp;<span class="op" id="5817683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817689">cdat</span><span class="op" id="5817693">[</span><span class="ident" id="5817694">i</span><span class="op" id="5817695">]</span>&nbsp;<span class="op" id="5817697">+=</span>&nbsp;<span class="ident" id="5817700">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5817705">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817709">case</span>&nbsp;<span class="ident" id="5817714">ftAverage</span><span class="op" id="5817723">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817728">for</span>&nbsp;<span class="ident" id="5817732">i</span>&nbsp;<span class="op" id="5817734">:=</span>&nbsp;<span class="num" id="5817737">0</span><span class="op" id="5817738">;</span>&nbsp;<span class="ident" id="5817740">i</span>&nbsp;<span class="op" id="5817742">&lt;</span>&nbsp;<span class="ident" id="5817744">bytesPerPixel</span><span class="op" id="5817757">;</span>&nbsp;<span class="ident" id="5817759">i</span><span class="op" id="5817760">++</span>&nbsp;<span class="op" id="5817763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817769">cdat</span><span class="op" id="5817773">[</span><span class="ident" id="5817774">i</span><span class="op" id="5817775">]</span>&nbsp;<span class="op" id="5817777">+=</span>&nbsp;<span class="ident" id="5817780">pdat</span><span class="op" id="5817784">[</span><span class="ident" id="5817785">i</span><span class="op" id="5817786">]</span>&nbsp;<span class="op" id="5817788">/</span>&nbsp;<span class="num" id="5817790">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5817795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817800">for</span>&nbsp;<span class="ident" id="5817804">i</span>&nbsp;<span class="op" id="5817806">:=</span>&nbsp;<span class="ident" id="5817809">bytesPerPixel</span><span class="op" id="5817822">;</span>&nbsp;<span class="ident" id="5817824">i</span>&nbsp;<span class="op" id="5817826">&lt;</span>&nbsp;<span class="builtinfunc" id="5817828">len</span><span class="op" id="5817831">(</span><span class="ident" id="5817832">cdat</span><span class="op" id="5817836">)</span><span class="op" id="5817837">;</span>&nbsp;<span class="ident" id="5817839">i</span><span class="op" id="5817840">++</span>&nbsp;<span class="op" id="5817843">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817849">cdat</span><span class="op" id="5817853">[</span><span class="ident" id="5817854">i</span><span class="op" id="5817855">]</span>&nbsp;<span class="op" id="5817857">+=</span>&nbsp;<span class="builtintype" id="5817860">uint8</span><span class="op" id="5817865">(</span><span class="op" id="5817866">(</span><span class="builtintype" id="5817867">int</span><span class="op" id="5817870">(</span><span class="ident" id="5817871">cdat</span><span class="op" id="5817875">[</span><span class="ident" id="5817876">i</span><span class="op" id="5817877">-</span><span class="ident" id="5817878">bytesPerPixel</span><span class="op" id="5817891">]</span><span class="op" id="5817892">)</span>&nbsp;<span class="op" id="5817894">+</span>&nbsp;<span class="builtintype" id="5817896">int</span><span class="op" id="5817899">(</span><span class="ident" id="5817900">pdat</span><span class="op" id="5817904">[</span><span class="ident" id="5817905">i</span><span class="op" id="5817906">]</span><span class="op" id="5817907">)</span><span class="op" id="5817908">)</span>&nbsp;<span class="op" id="5817910">/</span>&nbsp;<span class="num" id="5817912">2</span><span class="op" id="5817913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5817918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817922">case</span>&nbsp;<span class="ident" id="5817927">ftPaeth</span><span class="op" id="5817934">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817939">filterPaeth</span><span class="op" id="5817950">(</span><span class="ident" id="5817951">cdat</span><span class="op" id="5817955">,</span>&nbsp;<span class="ident" id="5817957">pdat</span><span class="op" id="5817961">,</span>&nbsp;<span class="ident" id="5817963">bytesPerPixel</span><span class="op" id="5817976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817980">default</span><span class="op" id="5817987">:</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817992">return</span>&nbsp;<span class="ident" id="5817999">nil</span><span class="op" id="5818002">,</span>&nbsp;<span class="ident" id="5818004">FormatError</span><span class="op" id="5818015">(</span><span class="string" id="5818016">&#34;bad&nbsp;filter&nbsp;type&#34;</span><span class="op" id="5818033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5818042">//&nbsp;Convert&nbsp;from&nbsp;bytes&nbsp;to&nbsp;colors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818077">switch</span>&nbsp;<span class="ident" id="5818084">d</span><span class="op" id="5818085">.</span><span class="ident" id="5818086">cb</span>&nbsp;<span class="op" id="5818089">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818093">case</span>&nbsp;<span class="ident" id="5818098">cbG1</span><span class="op" id="5818102">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818107">for</span>&nbsp;<span class="ident" id="5818111">x</span>&nbsp;<span class="op" id="5818113">:=</span>&nbsp;<span class="num" id="5818116">0</span><span class="op" id="5818117">;</span>&nbsp;<span class="ident" id="5818119">x</span>&nbsp;<span class="op" id="5818121">&lt;</span>&nbsp;<span class="ident" id="5818123">width</span><span class="op" id="5818128">;</span>&nbsp;<span class="ident" id="5818130">x</span>&nbsp;<span class="op" id="5818132">+=</span>&nbsp;<span class="num" id="5818135">8</span>&nbsp;<span class="op" id="5818137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818143">b</span>&nbsp;<span class="op" id="5818145">:=</span>&nbsp;<span class="ident" id="5818148">cdat</span><span class="op" id="5818152">[</span><span class="ident" id="5818153">x</span><span class="op" id="5818154">/</span><span class="num" id="5818155">8</span><span class="op" id="5818156">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818162">for</span>&nbsp;<span class="ident" id="5818166">x2</span>&nbsp;<span class="op" id="5818169">:=</span>&nbsp;<span class="num" id="5818172">0</span><span class="op" id="5818173">;</span>&nbsp;<span class="ident" id="5818175">x2</span>&nbsp;<span class="op" id="5818178">&lt;</span>&nbsp;<span class="num" id="5818180">8</span>&nbsp;<span class="op" id="5818182">&amp;&amp;</span>&nbsp;<span class="ident" id="5818185">x</span><span class="op" id="5818186">+</span><span class="ident" id="5818187">x2</span>&nbsp;<span class="op" id="5818190">&lt;</span>&nbsp;<span class="ident" id="5818192">width</span><span class="op" id="5818197">;</span>&nbsp;<span class="ident" id="5818199">x2</span><span class="op" id="5818201">++</span>&nbsp;<span class="op" id="5818204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818211">gray</span><span class="op" id="5818215">.</span><span class="ident" id="5818216">SetGray</span><span class="op" id="5818223">(</span><span class="ident" id="5818224">x</span><span class="op" id="5818225">+</span><span class="ident" id="5818226">x2</span><span class="op" id="5818228">,</span>&nbsp;<span class="ident" id="5818230">y</span><span class="op" id="5818231">,</span>&nbsp;<span class="ident" id="5818233">color</span><span class="op" id="5818238">.</span><span class="ident" id="5818239">Gray</span><span class="op" id="5818243">{</span><span class="op" id="5818244">(</span><span class="ident" id="5818245">b</span>&nbsp;<span class="op" id="5818247">&gt;&gt;</span>&nbsp;<span class="num" id="5818250">7</span><span class="op" id="5818251">)</span>&nbsp;<span class="op" id="5818253">*</span>&nbsp;<span class="num" id="5818255">0xff</span><span class="op" id="5818259">}</span><span class="op" id="5818260">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818267">b</span>&nbsp;<span class="op" id="5818269">&lt;&lt;=</span>&nbsp;<span class="num" id="5818273">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818288">case</span>&nbsp;<span class="ident" id="5818293">cbG2</span><span class="op" id="5818297">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818302">for</span>&nbsp;<span class="ident" id="5818306">x</span>&nbsp;<span class="op" id="5818308">:=</span>&nbsp;<span class="num" id="5818311">0</span><span class="op" id="5818312">;</span>&nbsp;<span class="ident" id="5818314">x</span>&nbsp;<span class="op" id="5818316">&lt;</span>&nbsp;<span class="ident" id="5818318">width</span><span class="op" id="5818323">;</span>&nbsp;<span class="ident" id="5818325">x</span>&nbsp;<span class="op" id="5818327">+=</span>&nbsp;<span class="num" id="5818330">4</span>&nbsp;<span class="op" id="5818332">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818338">b</span>&nbsp;<span class="op" id="5818340">:=</span>&nbsp;<span class="ident" id="5818343">cdat</span><span class="op" id="5818347">[</span><span class="ident" id="5818348">x</span><span class="op" id="5818349">/</span><span class="num" id="5818350">4</span><span class="op" id="5818351">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818357">for</span>&nbsp;<span class="ident" id="5818361">x2</span>&nbsp;<span class="op" id="5818364">:=</span>&nbsp;<span class="num" id="5818367">0</span><span class="op" id="5818368">;</span>&nbsp;<span class="ident" id="5818370">x2</span>&nbsp;<span class="op" id="5818373">&lt;</span>&nbsp;<span class="num" id="5818375">4</span>&nbsp;<span class="op" id="5818377">&amp;&amp;</span>&nbsp;<span class="ident" id="5818380">x</span><span class="op" id="5818381">+</span><span class="ident" id="5818382">x2</span>&nbsp;<span class="op" id="5818385">&lt;</span>&nbsp;<span class="ident" id="5818387">width</span><span class="op" id="5818392">;</span>&nbsp;<span class="ident" id="5818394">x2</span><span class="op" id="5818396">++</span>&nbsp;<span class="op" id="5818399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818406">gray</span><span class="op" id="5818410">.</span><span class="ident" id="5818411">SetGray</span><span class="op" id="5818418">(</span><span class="ident" id="5818419">x</span><span class="op" id="5818420">+</span><span class="ident" id="5818421">x2</span><span class="op" id="5818423">,</span>&nbsp;<span class="ident" id="5818425">y</span><span class="op" id="5818426">,</span>&nbsp;<span class="ident" id="5818428">color</span><span class="op" id="5818433">.</span><span class="ident" id="5818434">Gray</span><span class="op" id="5818438">{</span><span class="op" id="5818439">(</span><span class="ident" id="5818440">b</span>&nbsp;<span class="op" id="5818442">&gt;&gt;</span>&nbsp;<span class="num" id="5818445">6</span><span class="op" id="5818446">)</span>&nbsp;<span class="op" id="5818448">*</span>&nbsp;<span class="num" id="5818450">0x55</span><span class="op" id="5818454">}</span><span class="op" id="5818455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818462">b</span>&nbsp;<span class="op" id="5818464">&lt;&lt;=</span>&nbsp;<span class="num" id="5818468">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818474">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818483">case</span>&nbsp;<span class="ident" id="5818488">cbG4</span><span class="op" id="5818492">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818497">for</span>&nbsp;<span class="ident" id="5818501">x</span>&nbsp;<span class="op" id="5818503">:=</span>&nbsp;<span class="num" id="5818506">0</span><span class="op" id="5818507">;</span>&nbsp;<span class="ident" id="5818509">x</span>&nbsp;<span class="op" id="5818511">&lt;</span>&nbsp;<span class="ident" id="5818513">width</span><span class="op" id="5818518">;</span>&nbsp;<span class="ident" id="5818520">x</span>&nbsp;<span class="op" id="5818522">+=</span>&nbsp;<span class="num" id="5818525">2</span>&nbsp;<span class="op" id="5818527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818533">b</span>&nbsp;<span class="op" id="5818535">:=</span>&nbsp;<span class="ident" id="5818538">cdat</span><span class="op" id="5818542">[</span><span class="ident" id="5818543">x</span><span class="op" id="5818544">/</span><span class="num" id="5818545">2</span><span class="op" id="5818546">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818552">for</span>&nbsp;<span class="ident" id="5818556">x2</span>&nbsp;<span class="op" id="5818559">:=</span>&nbsp;<span class="num" id="5818562">0</span><span class="op" id="5818563">;</span>&nbsp;<span class="ident" id="5818565">x2</span>&nbsp;<span class="op" id="5818568">&lt;</span>&nbsp;<span class="num" id="5818570">2</span>&nbsp;<span class="op" id="5818572">&amp;&amp;</span>&nbsp;<span class="ident" id="5818575">x</span><span class="op" id="5818576">+</span><span class="ident" id="5818577">x2</span>&nbsp;<span class="op" id="5818580">&lt;</span>&nbsp;<span class="ident" id="5818582">width</span><span class="op" id="5818587">;</span>&nbsp;<span class="ident" id="5818589">x2</span><span class="op" id="5818591">++</span>&nbsp;<span class="op" id="5818594">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818601">gray</span><span class="op" id="5818605">.</span><span class="ident" id="5818606">SetGray</span><span class="op" id="5818613">(</span><span class="ident" id="5818614">x</span><span class="op" id="5818615">+</span><span class="ident" id="5818616">x2</span><span class="op" id="5818618">,</span>&nbsp;<span class="ident" id="5818620">y</span><span class="op" id="5818621">,</span>&nbsp;<span class="ident" id="5818623">color</span><span class="op" id="5818628">.</span><span class="ident" id="5818629">Gray</span><span class="op" id="5818633">{</span><span class="op" id="5818634">(</span><span class="ident" id="5818635">b</span>&nbsp;<span class="op" id="5818637">&gt;&gt;</span>&nbsp;<span class="num" id="5818640">4</span><span class="op" id="5818641">)</span>&nbsp;<span class="op" id="5818643">*</span>&nbsp;<span class="num" id="5818645">0x11</span><span class="op" id="5818649">}</span><span class="op" id="5818650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818657">b</span>&nbsp;<span class="op" id="5818659">&lt;&lt;=</span>&nbsp;<span class="num" id="5818663">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818678">case</span>&nbsp;<span class="ident" id="5818683">cbG8</span><span class="op" id="5818687">:</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5818692">copy</span><span class="op" id="5818696">(</span><span class="ident" id="5818697">gray</span><span class="op" id="5818701">.</span><span class="ident" id="5818702">Pix</span><span class="op" id="5818705">[</span><span class="ident" id="5818706">pixOffset</span><span class="op" id="5818715">:</span><span class="op" id="5818716">]</span><span class="op" id="5818717">,</span>&nbsp;<span class="ident" id="5818719">cdat</span><span class="op" id="5818723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818728">pixOffset</span>&nbsp;<span class="op" id="5818738">+=</span>&nbsp;<span class="ident" id="5818741">gray</span><span class="op" id="5818745">.</span><span class="ident" id="5818746">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818755">case</span>&nbsp;<span class="ident" id="5818760">cbGA8</span><span class="op" id="5818765">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818770">for</span>&nbsp;<span class="ident" id="5818774">x</span>&nbsp;<span class="op" id="5818776">:=</span>&nbsp;<span class="num" id="5818779">0</span><span class="op" id="5818780">;</span>&nbsp;<span class="ident" id="5818782">x</span>&nbsp;<span class="op" id="5818784">&lt;</span>&nbsp;<span class="ident" id="5818786">width</span><span class="op" id="5818791">;</span>&nbsp;<span class="ident" id="5818793">x</span><span class="op" id="5818794">++</span>&nbsp;<span class="op" id="5818797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818803">ycol</span>&nbsp;<span class="op" id="5818808">:=</span>&nbsp;<span class="ident" id="5818811">cdat</span><span class="op" id="5818815">[</span><span class="num" id="5818816">2</span><span class="op" id="5818817">*</span><span class="ident" id="5818818">x</span><span class="op" id="5818819">+</span><span class="num" id="5818820">0</span><span class="op" id="5818821">]</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818827">nrgba</span><span class="op" id="5818832">.</span><span class="ident" id="5818833">SetNRGBA</span><span class="op" id="5818841">(</span><span class="ident" id="5818842">x</span><span class="op" id="5818843">,</span>&nbsp;<span class="ident" id="5818845">y</span><span class="op" id="5818846">,</span>&nbsp;<span class="ident" id="5818848">color</span><span class="op" id="5818853">.</span><span class="ident" id="5818854">NRGBA</span><span class="op" id="5818859">{</span><span class="ident" id="5818860">ycol</span><span class="op" id="5818864">,</span>&nbsp;<span class="ident" id="5818866">ycol</span><span class="op" id="5818870">,</span>&nbsp;<span class="ident" id="5818872">ycol</span><span class="op" id="5818876">,</span>&nbsp;<span class="ident" id="5818878">cdat</span><span class="op" id="5818882">[</span><span class="num" id="5818883">2</span><span class="op" id="5818884">*</span><span class="ident" id="5818885">x</span><span class="op" id="5818886">+</span><span class="num" id="5818887">1</span><span class="op" id="5818888">]</span><span class="op" id="5818889">}</span><span class="op" id="5818890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5818895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818899">case</span>&nbsp;<span class="ident" id="5818904">cbTC8</span><span class="op" id="5818909">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818914">pix</span><span class="op" id="5818917">,</span>&nbsp;<span class="ident" id="5818919">i</span><span class="op" id="5818920">,</span>&nbsp;<span class="ident" id="5818922">j</span>&nbsp;<span class="op" id="5818924">:=</span>&nbsp;<span class="ident" id="5818927">rgba</span><span class="op" id="5818931">.</span><span class="ident" id="5818932">Pix</span><span class="op" id="5818935">,</span>&nbsp;<span class="ident" id="5818937">pixOffset</span><span class="op" id="5818946">,</span>&nbsp;<span class="num" id="5818948">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5818953">for</span>&nbsp;<span class="ident" id="5818957">x</span>&nbsp;<span class="op" id="5818959">:=</span>&nbsp;<span class="num" id="5818962">0</span><span class="op" id="5818963">;</span>&nbsp;<span class="ident" id="5818965">x</span>&nbsp;<span class="op" id="5818967">&lt;</span>&nbsp;<span class="ident" id="5818969">width</span><span class="op" id="5818974">;</span>&nbsp;<span class="ident" id="5818976">x</span><span class="op" id="5818977">++</span>&nbsp;<span class="op" id="5818980">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5818986">pix</span><span class="op" id="5818989">[</span><span class="ident" id="5818990">i</span><span class="op" id="5818991">+</span><span class="num" id="5818992">0</span><span class="op" id="5818993">]</span>&nbsp;<span class="op" id="5818995">=</span>&nbsp;<span class="ident" id="5818997">cdat</span><span class="op" id="5819001">[</span><span class="ident" id="5819002">j</span><span class="op" id="5819003">+</span><span class="num" id="5819004">0</span><span class="op" id="5819005">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819011">pix</span><span class="op" id="5819014">[</span><span class="ident" id="5819015">i</span><span class="op" id="5819016">+</span><span class="num" id="5819017">1</span><span class="op" id="5819018">]</span>&nbsp;<span class="op" id="5819020">=</span>&nbsp;<span class="ident" id="5819022">cdat</span><span class="op" id="5819026">[</span><span class="ident" id="5819027">j</span><span class="op" id="5819028">+</span><span class="num" id="5819029">1</span><span class="op" id="5819030">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819036">pix</span><span class="op" id="5819039">[</span><span class="ident" id="5819040">i</span><span class="op" id="5819041">+</span><span class="num" id="5819042">2</span><span class="op" id="5819043">]</span>&nbsp;<span class="op" id="5819045">=</span>&nbsp;<span class="ident" id="5819047">cdat</span><span class="op" id="5819051">[</span><span class="ident" id="5819052">j</span><span class="op" id="5819053">+</span><span class="num" id="5819054">2</span><span class="op" id="5819055">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819061">pix</span><span class="op" id="5819064">[</span><span class="ident" id="5819065">i</span><span class="op" id="5819066">+</span><span class="num" id="5819067">3</span><span class="op" id="5819068">]</span>&nbsp;<span class="op" id="5819070">=</span>&nbsp;<span class="num" id="5819072">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819081">i</span>&nbsp;<span class="op" id="5819083">+=</span>&nbsp;<span class="num" id="5819086">4</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819092">j</span>&nbsp;<span class="op" id="5819094">+=</span>&nbsp;<span class="num" id="5819097">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5819102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819107">pixOffset</span>&nbsp;<span class="op" id="5819117">+=</span>&nbsp;<span class="ident" id="5819120">rgba</span><span class="op" id="5819124">.</span><span class="ident" id="5819125">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819134">case</span>&nbsp;<span class="ident" id="5819139">cbP1</span><span class="op" id="5819143">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819148">for</span>&nbsp;<span class="ident" id="5819152">x</span>&nbsp;<span class="op" id="5819154">:=</span>&nbsp;<span class="num" id="5819157">0</span><span class="op" id="5819158">;</span>&nbsp;<span class="ident" id="5819160">x</span>&nbsp;<span class="op" id="5819162">&lt;</span>&nbsp;<span class="ident" id="5819164">width</span><span class="op" id="5819169">;</span>&nbsp;<span class="ident" id="5819171">x</span>&nbsp;<span class="op" id="5819173">+=</span>&nbsp;<span class="num" id="5819176">8</span>&nbsp;<span class="op" id="5819178">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819184">b</span>&nbsp;<span class="op" id="5819186">:=</span>&nbsp;<span class="ident" id="5819189">cdat</span><span class="op" id="5819193">[</span><span class="ident" id="5819194">x</span><span class="op" id="5819195">/</span><span class="num" id="5819196">8</span><span class="op" id="5819197">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819203">for</span>&nbsp;<span class="ident" id="5819207">x2</span>&nbsp;<span class="op" id="5819210">:=</span>&nbsp;<span class="num" id="5819213">0</span><span class="op" id="5819214">;</span>&nbsp;<span class="ident" id="5819216">x2</span>&nbsp;<span class="op" id="5819219">&lt;</span>&nbsp;<span class="num" id="5819221">8</span>&nbsp;<span class="op" id="5819223">&amp;&amp;</span>&nbsp;<span class="ident" id="5819226">x</span><span class="op" id="5819227">+</span><span class="ident" id="5819228">x2</span>&nbsp;<span class="op" id="5819231">&lt;</span>&nbsp;<span class="ident" id="5819233">width</span><span class="op" id="5819238">;</span>&nbsp;<span class="ident" id="5819240">x2</span><span class="op" id="5819242">++</span>&nbsp;<span class="op" id="5819245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819252">idx</span>&nbsp;<span class="op" id="5819256">:=</span>&nbsp;<span class="ident" id="5819259">b</span>&nbsp;<span class="op" id="5819261">&gt;&gt;</span>&nbsp;<span class="num" id="5819264">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819271">if</span>&nbsp;<span class="builtinfunc" id="5819274">len</span><span class="op" id="5819277">(</span><span class="ident" id="5819278">paletted</span><span class="op" id="5819286">.</span><span class="ident" id="5819287">Palette</span><span class="op" id="5819294">)</span>&nbsp;<span class="op" id="5819296">&lt;=</span>&nbsp;<span class="builtintype" id="5819299">int</span><span class="op" id="5819302">(</span><span class="ident" id="5819303">idx</span><span class="op" id="5819306">)</span>&nbsp;<span class="op" id="5819308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819316">paletted</span><span class="op" id="5819324">.</span><span class="ident" id="5819325">Palette</span>&nbsp;<span class="op" id="5819333">=</span>&nbsp;<span class="ident" id="5819335">paletted</span><span class="op" id="5819343">.</span><span class="ident" id="5819344">Palette</span><span class="op" id="5819351">[</span><span class="op" id="5819352">:</span><span class="builtintype" id="5819353">int</span><span class="op" id="5819356">(</span><span class="ident" id="5819357">idx</span><span class="op" id="5819360">)</span><span class="op" id="5819361">+</span><span class="num" id="5819362">1</span><span class="op" id="5819363">]</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5819370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819377">paletted</span><span class="op" id="5819385">.</span><span class="ident" id="5819386">SetColorIndex</span><span class="op" id="5819399">(</span><span class="ident" id="5819400">x</span><span class="op" id="5819401">+</span><span class="ident" id="5819402">x2</span><span class="op" id="5819404">,</span>&nbsp;<span class="ident" id="5819406">y</span><span class="op" id="5819407">,</span>&nbsp;<span class="ident" id="5819409">idx</span><span class="op" id="5819412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819419">b</span>&nbsp;<span class="op" id="5819421">&lt;&lt;=</span>&nbsp;<span class="num" id="5819425">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5819431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5819436">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819440">case</span>&nbsp;<span class="ident" id="5819445">cbP2</span><span class="op" id="5819449">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819454">for</span>&nbsp;<span class="ident" id="5819458">x</span>&nbsp;<span class="op" id="5819460">:=</span>&nbsp;<span class="num" id="5819463">0</span><span class="op" id="5819464">;</span>&nbsp;<span class="ident" id="5819466">x</span>&nbsp;<span class="op" id="5819468">&lt;</span>&nbsp;<span class="ident" id="5819470">width</span><span class="op" id="5819475">;</span>&nbsp;<span class="ident" id="5819477">x</span>&nbsp;<span class="op" id="5819479">+=</span>&nbsp;<span class="num" id="5819482">4</span>&nbsp;<span class="op" id="5819484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819490">b</span>&nbsp;<span class="op" id="5819492">:=</span>&nbsp;<span class="ident" id="5819495">cdat</span><span class="op" id="5819499">[</span><span class="ident" id="5819500">x</span><span class="op" id="5819501">/</span><span class="num" id="5819502">4</span><span class="op" id="5819503">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819509">for</span>&nbsp;<span class="ident" id="5819513">x2</span>&nbsp;<span class="op" id="5819516">:=</span>&nbsp;<span class="num" id="5819519">0</span><span class="op" id="5819520">;</span>&nbsp;<span class="ident" id="5819522">x2</span>&nbsp;<span class="op" id="5819525">&lt;</span>&nbsp;<span class="num" id="5819527">4</span>&nbsp;<span class="op" id="5819529">&amp;&amp;</span>&nbsp;<span class="ident" id="5819532">x</span><span class="op" id="5819533">+</span><span class="ident" id="5819534">x2</span>&nbsp;<span class="op" id="5819537">&lt;</span>&nbsp;<span class="ident" id="5819539">width</span><span class="op" id="5819544">;</span>&nbsp;<span class="ident" id="5819546">x2</span><span class="op" id="5819548">++</span>&nbsp;<span class="op" id="5819551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819558">idx</span>&nbsp;<span class="op" id="5819562">:=</span>&nbsp;<span class="ident" id="5819565">b</span>&nbsp;<span class="op" id="5819567">&gt;&gt;</span>&nbsp;<span class="num" id="5819570">6</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819577">if</span>&nbsp;<span class="builtinfunc" id="5819580">len</span><span class="op" id="5819583">(</span><span class="ident" id="5819584">paletted</span><span class="op" id="5819592">.</span><span class="ident" id="5819593">Palette</span><span class="op" id="5819600">)</span>&nbsp;<span class="op" id="5819602">&lt;=</span>&nbsp;<span class="builtintype" id="5819605">int</span><span class="op" id="5819608">(</span><span class="ident" id="5819609">idx</span><span class="op" id="5819612">)</span>&nbsp;<span class="op" id="5819614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819622">paletted</span><span class="op" id="5819630">.</span><span class="ident" id="5819631">Palette</span>&nbsp;<span class="op" id="5819639">=</span>&nbsp;<span class="ident" id="5819641">paletted</span><span class="op" id="5819649">.</span><span class="ident" id="5819650">Palette</span><span class="op" id="5819657">[</span><span class="op" id="5819658">:</span><span class="builtintype" id="5819659">int</span><span class="op" id="5819662">(</span><span class="ident" id="5819663">idx</span><span class="op" id="5819666">)</span><span class="op" id="5819667">+</span><span class="num" id="5819668">1</span><span class="op" id="5819669">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5819676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819683">paletted</span><span class="op" id="5819691">.</span><span class="ident" id="5819692">SetColorIndex</span><span class="op" id="5819705">(</span><span class="ident" id="5819706">x</span><span class="op" id="5819707">+</span><span class="ident" id="5819708">x2</span><span class="op" id="5819710">,</span>&nbsp;<span class="ident" id="5819712">y</span><span class="op" id="5819713">,</span>&nbsp;<span class="ident" id="5819715">idx</span><span class="op" id="5819718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819725">b</span>&nbsp;<span class="op" id="5819727">&lt;&lt;=</span>&nbsp;<span class="num" id="5819731">2</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5819737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5819742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819746">case</span>&nbsp;<span class="ident" id="5819751">cbP4</span><span class="op" id="5819755">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819760">for</span>&nbsp;<span class="ident" id="5819764">x</span>&nbsp;<span class="op" id="5819766">:=</span>&nbsp;<span class="num" id="5819769">0</span><span class="op" id="5819770">;</span>&nbsp;<span class="ident" id="5819772">x</span>&nbsp;<span class="op" id="5819774">&lt;</span>&nbsp;<span class="ident" id="5819776">width</span><span class="op" id="5819781">;</span>&nbsp;<span class="ident" id="5819783">x</span>&nbsp;<span class="op" id="5819785">+=</span>&nbsp;<span class="num" id="5819788">2</span>&nbsp;<span class="op" id="5819790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819796">b</span>&nbsp;<span class="op" id="5819798">:=</span>&nbsp;<span class="ident" id="5819801">cdat</span><span class="op" id="5819805">[</span><span class="ident" id="5819806">x</span><span class="op" id="5819807">/</span><span class="num" id="5819808">2</span><span class="op" id="5819809">]</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819815">for</span>&nbsp;<span class="ident" id="5819819">x2</span>&nbsp;<span class="op" id="5819822">:=</span>&nbsp;<span class="num" id="5819825">0</span><span class="op" id="5819826">;</span>&nbsp;<span class="ident" id="5819828">x2</span>&nbsp;<span class="op" id="5819831">&lt;</span>&nbsp;<span class="num" id="5819833">2</span>&nbsp;<span class="op" id="5819835">&amp;&amp;</span>&nbsp;<span class="ident" id="5819838">x</span><span class="op" id="5819839">+</span><span class="ident" id="5819840">x2</span>&nbsp;<span class="op" id="5819843">&lt;</span>&nbsp;<span class="ident" id="5819845">width</span><span class="op" id="5819850">;</span>&nbsp;<span class="ident" id="5819852">x2</span><span class="op" id="5819854">++</span>&nbsp;<span class="op" id="5819857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819864">idx</span>&nbsp;<span class="op" id="5819868">:=</span>&nbsp;<span class="ident" id="5819871">b</span>&nbsp;<span class="op" id="5819873">&gt;&gt;</span>&nbsp;<span class="num" id="5819876">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5819883">if</span>&nbsp;<span class="builtinfunc" id="5819886">len</span><span class="op" id="5819889">(</span><span class="ident" id="5819890">paletted</span><span class="op" id="5819898">.</span><span class="ident" id="5819899">Palette</span><span class="op" id="5819906">)</span>&nbsp;<span class="op" id="5819908">&lt;=</span>&nbsp;<span class="builtintype" id="5819911">int</span><span class="op" id="5819914">(</span><span class="ident" id="5819915">idx</span><span class="op" id="5819918">)</span>&nbsp;<span class="op" id="5819920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819928">paletted</span><span class="op" id="5819936">.</span><span class="ident" id="5819937">Palette</span>&nbsp;<span class="op" id="5819945">=</span>&nbsp;<span class="ident" id="5819947">paletted</span><span class="op" id="5819955">.</span><span class="ident" id="5819956">Palette</span><span class="op" id="5819963">[</span><span class="op" id="5819964">:</span><span class="builtintype" id="5819965">int</span><span class="op" id="5819968">(</span><span class="ident" id="5819969">idx</span><span class="op" id="5819972">)</span><span class="op" id="5819973">+</span><span class="num" id="5819974">1</span><span class="op" id="5819975">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5819982">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5819989">paletted</span><span class="op" id="5819997">.</span><span class="ident" id="5819998">SetColorIndex</span><span class="op" id="5820011">(</span><span class="ident" id="5820012">x</span><span class="op" id="5820013">+</span><span class="ident" id="5820014">x2</span><span class="op" id="5820016">,</span>&nbsp;<span class="ident" id="5820018">y</span><span class="op" id="5820019">,</span>&nbsp;<span class="ident" id="5820021">idx</span><span class="op" id="5820024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5820031">b</span>&nbsp;<span class="op" id="5820033">&lt;&lt;=</span>&nbsp;<span class="num" id="5820037">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5820043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5820048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820052">case</span>&nbsp;<span class="ident" id="5820057">cbP8</span><span class="op" id="5820061">:</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820066">if</span>&nbsp;<span class="builtinfunc" id="5820069">len</span><span class="op" id="5820072">(</span><span class="ident" id="5820073">paletted</span><span class="op" id="5820081">.</span><span class="ident" id="5820082">Palette</span><span class="op" id="5820089">)</span>&nbsp;<span class="op" id="5820091">!=</span>&nbsp;<span class="num" id="5820094">255</span>&nbsp;<span class="op" id="5820098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820104">for</span>&nbsp;<span class="ident" id="5820108">x</span>&nbsp;<span class="op" id="5820110">:=</span>&nbsp;<span class="num" id="5820113">0</span><span class="op" id="5820114">;</span>&nbsp;<span class="ident" id="5820116">x</span>&nbsp;<span class="op" id="5820118">&lt;</span>&nbsp;<span class="ident" id="5820120">width</span><span class="op" id="5820125">;</span>&nbsp;<span class="ident" id="5820127">x</span><span class="op" id="5820128">++</span>&nbsp;<span class="op" id="5820131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820138">if</span>&nbsp;<span class="builtinfunc" id="5820141">len</span><span class="op" id="5820144">(</span><span class="ident" id="5820145">paletted</span><span class="op" id="5820153">.</span><span class="ident" id="5820154">Palette</span><span class="op" id="5820161">)</span>&nbsp;<span class="op" id="5820163">&lt;=</span>&nbsp;<span class="builtintype" id="5820166">int</span><span class="op" id="5820169">(</span><span class="ident" id="5820170">cdat</span><span class="op" id="5820174">[</span><span class="ident" id="5820175">x</span><span class="op" id="5820176">]</span><span class="op" id="5820177">)</span>&nbsp;<span class="op" id="5820179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5820187">paletted</span><span class="op" id="5820195">.</span><span class="ident" id="5820196">Palette</span>&nbsp;<span class="op" id="5820204">=</span>&nbsp;<span class="ident" id="5820206">paletted</span><span class="op" id="5820214">.</span><span class="ident" id="5820215">Palette</span><span class="op" id="5820222">[</span><span class="op" id="5820223">:</span><span class="builtintype" id="5820224">int</span><span class="op" id="5820227">(</span><span class="ident" id="5820228">cdat</span><span class="op" id="5820232">[</span><span class="ident" id="5820233">x</span><span class="op" id="5820234">]</span><span class="op" id="5820235">)</span><span class="op" id="5820236">+</span><span class="num" id="5820237">1</span><span class="op" id="5820238">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5820245">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5820251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5820256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5820261">copy</span><span class="op" id="5820265">(</span><span class="ident" id="5820266">paletted</span><span class="op" id="5820274">.</span><span class="ident" id="5820275">Pix</span><span class="op" id="5820278">[</span><span class="ident" id="5820279">pixOffset</span><span class="op" id="5820288">:</span><span class="op" id="5820289">]</span><span class="op" id="5820290">,</span>&nbsp;<span class="ident" id="5820292">cdat</span><span class="op" id="5820296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5820301">pixOffset</span>&nbsp;<span class="op" id="5820311">+=</span>&nbsp;<span class="ident" id="5820314">paletted</span><span class="op" id="5820322">.</span><span class="ident" id="5820323">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820332">case</span>&nbsp;<span class="ident" id="5820337">cbTCA8</span><span class="op" id="5820343">:</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5820348">copy</span><span class="op" id="5820352">(</span><span class="ident" id="5820353">nrgba</span><span class="op" id="5820358">.</span><span class="ident" id="5820359">Pix</span><span class="op" id="5820362">[</span><span class="ident" id="5820363">pixOffset</span><span class="op" id="5820372">:</span><span class="op" id="5820373">]</span><span class="op" id="5820374">,</span>&nbsp;<span class="ident" id="5820376">cdat</span><span class="op" id="5820380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5820385">pixOffset</span>&nbsp;<span class="op" id="5820395">+=</span>&nbsp;<span class="ident" id="5820398">nrgba</span><span class="op" id="5820403">.</span><span class="ident" id="5820404">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820413">case</span>&nbsp;<span class="ident" id="5820418">cbG16</span><span class="op" id="5820423">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820428">for</span>&nbsp;<span class="ident" id="5820432">x</span>&nbsp;<span class="op" id="5820434">:=</span>&nbsp;<span class="num" id="5820437">0</span><span class="op" id="5820438">;</span>&nbsp;<span class="ident" id="5820440">x</span>&nbsp;<span class="op" id="5820442">&lt;</span>&nbsp;<span class="ident" id="5820444">width</span><span class="op" id="5820449">;</span>&nbsp;<span class="ident" id="5820451">x</span><span class="op" id="5820452">++</span>&nbsp;<span class="op" id="5820455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5820461">ycol</span>&nbsp;<span class="op" id="5820466">:=</span>&nbsp;<span class="builtintype" id="5820469">uint16</span><span class="op" id="5820475">(</span><span class="ident" id="5820476">cdat</span><span class="op" id="5820480">[</span><span class="num" id="5820481">2</span><span class="op" id="5820482">*</span><span class="ident" id="5820483">x</span><span class="op" id="5820484">+</span><span class="num" id="5820485">0</span><span class="op" id="5820486">]</span><span class="op" id="5820487">)</span><span class="op" id="5820488">&lt;&lt;</span><span class="num" id="5820490">8</span>&nbsp;<span class="op" id="5820492">|</span>&nbsp;<span class="builtintype" id="5820494">uint16</span><span class="op" id="5820500">(</span><span class="ident" id="5820501">cdat</span><span class="op" id="5820505">[</span><span class="num" id="5820506">2</span><span class="op" id="5820507">*</span><span class="ident" id="5820508">x</span><span class="op" id="5820509">+</span><span class="num" id="5820510">1</span><span class="op" id="5820511">]</span><span class="op" id="5820512">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5820518">gray16</span><span class="op" id="5820524">.</span><span class="ident" id="5820525">SetGray16</span><span class="op" id="5820534">(</span><span class="ident" id="5820535">x</span><span class="op" id="5820536">,</span>&nbsp;<span class="ident" id="5820538">y</span><span class="op" id="5820539">,</span>&nbsp;<span class="ident" id="5820541">color</span><span class="op" id="5820546">.</span><span class="ident" id="5820547">Gray16</span><span class="op" id="5820553">{</span><span class="ident" id="5820554">ycol</span><span class="op" id="5820558">}</span><span class="op" id="5820559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5820564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820568">case</span>&nbsp;<span class="ident" id="5820573">cbGA16</span><span class="op" id="5820579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820584">for</span>&nbsp;<span class="ident" id="5820588">x</span>&nbsp;<span class="op" id="5820590">:=</span>&nbsp;<span class="num" id="5820593">0</span><span class="op" id="5820594">;</span>&nbsp;<span class="ident" id="5820596">x</span>&nbsp;<span class="op" id="5820598">&lt;</span>&nbsp;<span class="ident" id="5820600">width</span><span class="op" id="5820605">;</span>&nbsp;<span class="ident" id="5820607">x</span><span class="op" id="5820608">++</span>&nbsp;<span class="op" id="5820611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5820617">ycol</span>&nbsp;<span class="op" id="5820622">:=</span>&nbsp;<span class="builtintype" id="5820625">uint16</span><span class="op" id="5820631">(</span><span class="ident" id="5820632">cdat</span><span class="op" id="5820636">[</span><span class="num" id="5820637">4</span><span class="op" id="5820638">*</span><span class="ident" id="5820639">x</span><span class="op" id="5820640">+</span><span class="num" id="5820641">0</span><span class="op" id="5820642">]</span><span class="op" id="5820643">)</span><span class="op" id="5820644">&lt;&lt;</span><span class="num" id="5820646">8</span>&nbsp;<span class="op" id="5820648">|</span>&nbsp;<span class="builtintype" id="5820650">uint16</span><span class="op" id="5820656">(</span><span class="ident" id="5820657">cdat</span><span class="op" id="5820661">[</span><span class="num" id="5820662">4</span><span class="op" id="5820663">*</span><span class="ident" id="5820664">x</span><span class="op" id="5820665">+</span><span class="num" id="5820666">1</span><span class="op" id="5820667">]</span><span class="op" id="5820668">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5820674">acol</span>&nbsp;<span class="op" id="5820679">:=</span>&nbsp;<span class="builtintype" id="5820682">uint16</span><span class="op" id="5820688">(</span><span class="ident" id="5820689">cdat</span><span class="op" id="5820693">[</span><span class="num" id="5820694">4</span><span class="op" id="5820695">*</span><span class="ident" id="5820696">x</span><span class="op" id="5820697">+</span><span class="num" id="5820698">2</span><span class="op" id="5820699">]</span><span class="op" id="5820700">)</span><span class="op" id="5820701">&lt;&lt;</span><span class="num" id="5820703">8</span>&nbsp;<span class="op" id="5820705">|</span>&nbsp;<span class="builtintype" id="5820707">uint16</span><span class="op" id="5820713">(</span><span class="ident" id="5820714">cdat</span><span class="op" id="5820718">[</span><span class="num" id="5820719">4</span><span class="op" id="5820720">*</span><span class="ident" id="5820721">x</span><span class="op" id="5820722">+</span><span class="num" id="5820723">3</span><span class="op" id="5820724">]</span><span class="op" id="5820725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5820731">nrgba64</span><span class="op" id="5820738">.</span><span class="ident" id="5820739">SetNRGBA64</span><span class="op" id="5820749">(</span><span class="ident" id="5820750">x</span><span class="op" id="5820751">,</span>&nbsp;<span class="ident" id="5820753">y</span><span class="op" id="5820754">,</span>&nbsp;<span class="ident" id="5820756">color</span><span class="op" id="5820761">.</span><span class="ident" id="5820762">NRGBA64</span><span class="op" id="5820769">{</span><span class="ident" id="5820770">ycol</span><span class="op" id="5820774">,</span>&nbsp;<span class="ident" id="5820776">ycol</span><span class="op" id="5820780">,</span>&nbsp;<span class="ident" id="5820782">ycol</span><span class="op" id="5820786">,</span>&nbsp;<span class="ident" id="5820788">acol</span><span class="op" id="5820792">}</span><span class="op" id="5820793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5820798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820802">case</span>&nbsp;<span class="ident" id="5820807">cbTC16</span><span class="op" id="5820813">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5820818">for</span>&nbsp;<span class="ident" id="5820822">x</span>&nbsp;<span class="op" id="5820824">:=</span>&nbsp;<span class="num" id="5820827">0</span><span class="op" id="5820828">;</span>&nbsp;<span class="ident" id="5820830">x</span>&nbsp;<span class="op" id="5820832">&lt;</span>&nbsp;<span class="ident" id="5820834">width</span><span class="op" id="5820839">;</span>&nbsp;<span class="ident" id="5820841">x</span><span class="op" id="5820842">++</span>&nbsp;<span class="op" id="5820845">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5820851">rcol</span>&nbsp;<span class="op" id="5820856">:=</span>&nbsp;<span class="builtintype" id="5820859">uint16</span><span class="op" id="5820865">(</span><span class="ident" id="5820866">cdat</span><span class="op" id="5820870">[</span><span class="num" id="5820871">6</span><span class="op" id="5820872">*</span><span class="ident" id="5820873">x</span><span class="op" id="5820874">+</span><span class="num" id="5820875">0</span><span class="op" id="5820876">]</span><span class="op" id="5820877">)</span><span class="op" id="5820878">&lt;&lt;</span><span class="num" id="5820880">8</span>&nbsp;<span class="op" id="5820882">|</span>&nbsp;<span class="builtintype" id="5820884">uint16</span><span class="op" id="5820890">(</span><span class="ident" id="5820891">cdat</span><span class="op" id="5820895">[</span><span class="num" id="5820896">6</span><span class="op" id="5820897">*</span><span class="ident" id="5820898">x</span><span class="op" id="5820899">+</span><span class="num" id="5820900">1</span><span class="op" id="5820901">]</span><span class="op" id="5820902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5820908">gcol</span>&nbsp;<span class="op" id="5820913">:=</span>&nbsp;<span class="builtintype" id="5820916">uint16</span><span class="op" id="5820922">(</span><span class="ident" id="5820923">cdat</span><span class="op" id="5820927">[</span><span class="num" id="5820928">6</span><span class="op" id="5820929">*</span><span class="ident" id="5820930">x</span><span class="op" id="5820931">+</span><span class="num" id="5820932">2</span><span class="op" id="5820933">]</span><span class="op" id="5820934">)</span><span class="op" id="5820935">&lt;&lt;</span><span class="num" id="5820937">8</span>&nbsp;<span class="op" id="5820939">|</span>&nbsp;<span class="builtintype" id="5820941">uint16</span><span class="op" id="5820947">(</span><span class="ident" id="5820948">cdat</span><span class="op" id="5820952">[</span><span class="num" id="5820953">6</span><span class="op" id="5820954">*</span><span class="ident" id="5820955">x</span><span class="op" id="5820956">+</span><span class="num" id="5820957">3</span><span class="op" id="5820958">]</span><span class="op" id="5820959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5820965">bcol</span>&nbsp;<span class="op" id="5820970">:=</span>&nbsp;<span class="builtintype" id="5820973">uint16</span><span class="op" id="5820979">(</span><span class="ident" id="5820980">cdat</span><span class="op" id="5820984">[</span><span class="num" id="5820985">6</span><span class="op" id="5820986">*</span><span class="ident" id="5820987">x</span><span class="op" id="5820988">+</span><span class="num" id="5820989">4</span><span class="op" id="5820990">]</span><span class="op" id="5820991">)</span><span class="op" id="5820992">&lt;&lt;</span><span class="num" id="5820994">8</span>&nbsp;<span class="op" id="5820996">|</span>&nbsp;<span class="builtintype" id="5820998">uint16</span><span class="op" id="5821004">(</span><span class="ident" id="5821005">cdat</span><span class="op" id="5821009">[</span><span class="num" id="5821010">6</span><span class="op" id="5821011">*</span><span class="ident" id="5821012">x</span><span class="op" id="5821013">+</span><span class="num" id="5821014">5</span><span class="op" id="5821015">]</span><span class="op" id="5821016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821022">rgba64</span><span class="op" id="5821028">.</span><span class="ident" id="5821029">SetRGBA64</span><span class="op" id="5821038">(</span><span class="ident" id="5821039">x</span><span class="op" id="5821040">,</span>&nbsp;<span class="ident" id="5821042">y</span><span class="op" id="5821043">,</span>&nbsp;<span class="ident" id="5821045">color</span><span class="op" id="5821050">.</span><span class="ident" id="5821051">RGBA64</span><span class="op" id="5821057">{</span><span class="ident" id="5821058">rcol</span><span class="op" id="5821062">,</span>&nbsp;<span class="ident" id="5821064">gcol</span><span class="op" id="5821068">,</span>&nbsp;<span class="ident" id="5821070">bcol</span><span class="op" id="5821074">,</span>&nbsp;<span class="num" id="5821076">0xffff</span><span class="op" id="5821082">}</span><span class="op" id="5821083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5821088">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5821092">case</span>&nbsp;<span class="ident" id="5821097">cbTCA16</span><span class="op" id="5821104">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5821109">for</span>&nbsp;<span class="ident" id="5821113">x</span>&nbsp;<span class="op" id="5821115">:=</span>&nbsp;<span class="num" id="5821118">0</span><span class="op" id="5821119">;</span>&nbsp;<span class="ident" id="5821121">x</span>&nbsp;<span class="op" id="5821123">&lt;</span>&nbsp;<span class="ident" id="5821125">width</span><span class="op" id="5821130">;</span>&nbsp;<span class="ident" id="5821132">x</span><span class="op" id="5821133">++</span>&nbsp;<span class="op" id="5821136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821142">rcol</span>&nbsp;<span class="op" id="5821147">:=</span>&nbsp;<span class="builtintype" id="5821150">uint16</span><span class="op" id="5821156">(</span><span class="ident" id="5821157">cdat</span><span class="op" id="5821161">[</span><span class="num" id="5821162">8</span><span class="op" id="5821163">*</span><span class="ident" id="5821164">x</span><span class="op" id="5821165">+</span><span class="num" id="5821166">0</span><span class="op" id="5821167">]</span><span class="op" id="5821168">)</span><span class="op" id="5821169">&lt;&lt;</span><span class="num" id="5821171">8</span>&nbsp;<span class="op" id="5821173">|</span>&nbsp;<span class="builtintype" id="5821175">uint16</span><span class="op" id="5821181">(</span><span class="ident" id="5821182">cdat</span><span class="op" id="5821186">[</span><span class="num" id="5821187">8</span><span class="op" id="5821188">*</span><span class="ident" id="5821189">x</span><span class="op" id="5821190">+</span><span class="num" id="5821191">1</span><span class="op" id="5821192">]</span><span class="op" id="5821193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821199">gcol</span>&nbsp;<span class="op" id="5821204">:=</span>&nbsp;<span class="builtintype" id="5821207">uint16</span><span class="op" id="5821213">(</span><span class="ident" id="5821214">cdat</span><span class="op" id="5821218">[</span><span class="num" id="5821219">8</span><span class="op" id="5821220">*</span><span class="ident" id="5821221">x</span><span class="op" id="5821222">+</span><span class="num" id="5821223">2</span><span class="op" id="5821224">]</span><span class="op" id="5821225">)</span><span class="op" id="5821226">&lt;&lt;</span><span class="num" id="5821228">8</span>&nbsp;<span class="op" id="5821230">|</span>&nbsp;<span class="builtintype" id="5821232">uint16</span><span class="op" id="5821238">(</span><span class="ident" id="5821239">cdat</span><span class="op" id="5821243">[</span><span class="num" id="5821244">8</span><span class="op" id="5821245">*</span><span class="ident" id="5821246">x</span><span class="op" id="5821247">+</span><span class="num" id="5821248">3</span><span class="op" id="5821249">]</span><span class="op" id="5821250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821256">bcol</span>&nbsp;<span class="op" id="5821261">:=</span>&nbsp;<span class="builtintype" id="5821264">uint16</span><span class="op" id="5821270">(</span><span class="ident" id="5821271">cdat</span><span class="op" id="5821275">[</span><span class="num" id="5821276">8</span><span class="op" id="5821277">*</span><span class="ident" id="5821278">x</span><span class="op" id="5821279">+</span><span class="num" id="5821280">4</span><span class="op" id="5821281">]</span><span class="op" id="5821282">)</span><span class="op" id="5821283">&lt;&lt;</span><span class="num" id="5821285">8</span>&nbsp;<span class="op" id="5821287">|</span>&nbsp;<span class="builtintype" id="5821289">uint16</span><span class="op" id="5821295">(</span><span class="ident" id="5821296">cdat</span><span class="op" id="5821300">[</span><span class="num" id="5821301">8</span><span class="op" id="5821302">*</span><span class="ident" id="5821303">x</span><span class="op" id="5821304">+</span><span class="num" id="5821305">5</span><span class="op" id="5821306">]</span><span class="op" id="5821307">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821313">acol</span>&nbsp;<span class="op" id="5821318">:=</span>&nbsp;<span class="builtintype" id="5821321">uint16</span><span class="op" id="5821327">(</span><span class="ident" id="5821328">cdat</span><span class="op" id="5821332">[</span><span class="num" id="5821333">8</span><span class="op" id="5821334">*</span><span class="ident" id="5821335">x</span><span class="op" id="5821336">+</span><span class="num" id="5821337">6</span><span class="op" id="5821338">]</span><span class="op" id="5821339">)</span><span class="op" id="5821340">&lt;&lt;</span><span class="num" id="5821342">8</span>&nbsp;<span class="op" id="5821344">|</span>&nbsp;<span class="builtintype" id="5821346">uint16</span><span class="op" id="5821352">(</span><span class="ident" id="5821353">cdat</span><span class="op" id="5821357">[</span><span class="num" id="5821358">8</span><span class="op" id="5821359">*</span><span class="ident" id="5821360">x</span><span class="op" id="5821361">+</span><span class="num" id="5821362">7</span><span class="op" id="5821363">]</span><span class="op" id="5821364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821370">nrgba64</span><span class="op" id="5821377">.</span><span class="ident" id="5821378">SetNRGBA64</span><span class="op" id="5821388">(</span><span class="ident" id="5821389">x</span><span class="op" id="5821390">,</span>&nbsp;<span class="ident" id="5821392">y</span><span class="op" id="5821393">,</span>&nbsp;<span class="ident" id="5821395">color</span><span class="op" id="5821400">.</span><span class="ident" id="5821401">NRGBA64</span><span class="op" id="5821408">{</span><span class="ident" id="5821409">rcol</span><span class="op" id="5821413">,</span>&nbsp;<span class="ident" id="5821415">gcol</span><span class="op" id="5821419">,</span>&nbsp;<span class="ident" id="5821421">bcol</span><span class="op" id="5821425">,</span>&nbsp;<span class="ident" id="5821427">acol</span><span class="op" id="5821431">}</span><span class="op" id="5821432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5821437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5821441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5821446">//&nbsp;The&nbsp;current&nbsp;row&nbsp;for&nbsp;y&nbsp;is&nbsp;the&nbsp;previous&nbsp;row&nbsp;for&nbsp;y+1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821502">pr</span><span class="op" id="5821504">,</span>&nbsp;<span class="ident" id="5821506">cr</span>&nbsp;<span class="op" id="5821509">=</span>&nbsp;<span class="ident" id="5821511">cr</span><span class="op" id="5821513">,</span>&nbsp;<span class="ident" id="5821515">pr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5821519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5821523">return</span>&nbsp;<span class="ident" id="5821530">img</span><span class="op" id="5821533">,</span>&nbsp;<span class="ident" id="5821535">nil</span><br>
<span class="lineno">585</span><span class="op" id="5821539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5821542">//&nbsp;mergePassInto&nbsp;merges&nbsp;a&nbsp;single&nbsp;pass&nbsp;into&nbsp;a&nbsp;full&nbsp;sized&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5821605">func</span>&nbsp;<span class="op" id="5821610">(</span><span class="ident" id="5821611">d</span>&nbsp;<span class="op" id="5821613">*</span><span class="ident" id="5821614">decoder</span><span class="op" id="5821621">)</span>&nbsp;<span class="ident" id="5821623">mergePassInto</span><span class="op" id="5821636">(</span><span class="ident" id="5821637">dst</span>&nbsp;<span class="ident" id="5821641">image</span><span class="op" id="5821646">.</span><span class="ident" id="5821647">Image</span><span class="op" id="5821652">,</span>&nbsp;<span class="ident" id="5821654">src</span>&nbsp;<span class="ident" id="5821658">image</span><span class="op" id="5821663">.</span><span class="ident" id="5821664">Image</span><span class="op" id="5821669">,</span>&nbsp;<span class="ident" id="5821671">pass</span>&nbsp;<span class="builtintype" id="5821676">int</span><span class="op" id="5821679">)</span>&nbsp;<span class="op" id="5821681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821684">p</span>&nbsp;<span class="op" id="5821686">:=</span>&nbsp;<span class="ident" id="5821689">interlacing</span><span class="op" id="5821700">[</span><span class="ident" id="5821701">pass</span><span class="op" id="5821705">]</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5821708">var</span>&nbsp;<span class="op" id="5821712">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821716">srcPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5821730">[</span><span class="op" id="5821731">]</span><span class="builtintype" id="5821732">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821740">dstPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5821754">[</span><span class="op" id="5821755">]</span><span class="builtintype" id="5821756">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821764">stride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5821778">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821784">rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5821798">image</span><span class="op" id="5821803">.</span><span class="ident" id="5821804">Rectangle</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821816">bytesPerPixel</span>&nbsp;<span class="builtintype" id="5821830">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5821835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5821838">switch</span>&nbsp;<span class="ident" id="5821845">target</span>&nbsp;<span class="op" id="5821852">:=</span>&nbsp;<span class="ident" id="5821855">dst</span><span class="op" id="5821858">.</span><span class="op" id="5821859">(</span><span class="keyword" id="5821860">type</span><span class="op" id="5821864">)</span>&nbsp;<span class="op" id="5821866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5821869">case</span>&nbsp;<span class="op" id="5821874">*</span><span class="ident" id="5821875">image</span><span class="op" id="5821880">.</span><span class="ident" id="5821881">Alpha</span><span class="op" id="5821886">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821890">srcPix</span>&nbsp;<span class="op" id="5821897">=</span>&nbsp;<span class="ident" id="5821899">src</span><span class="op" id="5821902">.</span><span class="op" id="5821903">(</span><span class="op" id="5821904">*</span><span class="ident" id="5821905">image</span><span class="op" id="5821910">.</span><span class="ident" id="5821911">Alpha</span><span class="op" id="5821916">)</span><span class="op" id="5821917">.</span><span class="ident" id="5821918">Pix</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821924">dstPix</span><span class="op" id="5821930">,</span>&nbsp;<span class="ident" id="5821932">stride</span><span class="op" id="5821938">,</span>&nbsp;<span class="ident" id="5821940">rect</span>&nbsp;<span class="op" id="5821945">=</span>&nbsp;<span class="ident" id="5821947">target</span><span class="op" id="5821953">.</span><span class="ident" id="5821954">Pix</span><span class="op" id="5821957">,</span>&nbsp;<span class="ident" id="5821959">target</span><span class="op" id="5821965">.</span><span class="ident" id="5821966">Stride</span><span class="op" id="5821972">,</span>&nbsp;<span class="ident" id="5821974">target</span><span class="op" id="5821980">.</span><span class="ident" id="5821981">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5821988">bytesPerPixel</span>&nbsp;<span class="op" id="5822002">=</span>&nbsp;<span class="num" id="5822004">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5822007">case</span>&nbsp;<span class="op" id="5822012">*</span><span class="ident" id="5822013">image</span><span class="op" id="5822018">.</span><span class="ident" id="5822019">Alpha16</span><span class="op" id="5822026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822030">srcPix</span>&nbsp;<span class="op" id="5822037">=</span>&nbsp;<span class="ident" id="5822039">src</span><span class="op" id="5822042">.</span><span class="op" id="5822043">(</span><span class="op" id="5822044">*</span><span class="ident" id="5822045">image</span><span class="op" id="5822050">.</span><span class="ident" id="5822051">Alpha16</span><span class="op" id="5822058">)</span><span class="op" id="5822059">.</span><span class="ident" id="5822060">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822066">dstPix</span><span class="op" id="5822072">,</span>&nbsp;<span class="ident" id="5822074">stride</span><span class="op" id="5822080">,</span>&nbsp;<span class="ident" id="5822082">rect</span>&nbsp;<span class="op" id="5822087">=</span>&nbsp;<span class="ident" id="5822089">target</span><span class="op" id="5822095">.</span><span class="ident" id="5822096">Pix</span><span class="op" id="5822099">,</span>&nbsp;<span class="ident" id="5822101">target</span><span class="op" id="5822107">.</span><span class="ident" id="5822108">Stride</span><span class="op" id="5822114">,</span>&nbsp;<span class="ident" id="5822116">target</span><span class="op" id="5822122">.</span><span class="ident" id="5822123">Rect</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822130">bytesPerPixel</span>&nbsp;<span class="op" id="5822144">=</span>&nbsp;<span class="num" id="5822146">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5822149">case</span>&nbsp;<span class="op" id="5822154">*</span><span class="ident" id="5822155">image</span><span class="op" id="5822160">.</span><span class="ident" id="5822161">Gray</span><span class="op" id="5822165">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822169">srcPix</span>&nbsp;<span class="op" id="5822176">=</span>&nbsp;<span class="ident" id="5822178">src</span><span class="op" id="5822181">.</span><span class="op" id="5822182">(</span><span class="op" id="5822183">*</span><span class="ident" id="5822184">image</span><span class="op" id="5822189">.</span><span class="ident" id="5822190">Gray</span><span class="op" id="5822194">)</span><span class="op" id="5822195">.</span><span class="ident" id="5822196">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822202">dstPix</span><span class="op" id="5822208">,</span>&nbsp;<span class="ident" id="5822210">stride</span><span class="op" id="5822216">,</span>&nbsp;<span class="ident" id="5822218">rect</span>&nbsp;<span class="op" id="5822223">=</span>&nbsp;<span class="ident" id="5822225">target</span><span class="op" id="5822231">.</span><span class="ident" id="5822232">Pix</span><span class="op" id="5822235">,</span>&nbsp;<span class="ident" id="5822237">target</span><span class="op" id="5822243">.</span><span class="ident" id="5822244">Stride</span><span class="op" id="5822250">,</span>&nbsp;<span class="ident" id="5822252">target</span><span class="op" id="5822258">.</span><span class="ident" id="5822259">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822266">bytesPerPixel</span>&nbsp;<span class="op" id="5822280">=</span>&nbsp;<span class="num" id="5822282">1</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5822285">case</span>&nbsp;<span class="op" id="5822290">*</span><span class="ident" id="5822291">image</span><span class="op" id="5822296">.</span><span class="ident" id="5822297">Gray16</span><span class="op" id="5822303">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822307">srcPix</span>&nbsp;<span class="op" id="5822314">=</span>&nbsp;<span class="ident" id="5822316">src</span><span class="op" id="5822319">.</span><span class="op" id="5822320">(</span><span class="op" id="5822321">*</span><span class="ident" id="5822322">image</span><span class="op" id="5822327">.</span><span class="ident" id="5822328">Gray16</span><span class="op" id="5822334">)</span><span class="op" id="5822335">.</span><span class="ident" id="5822336">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822342">dstPix</span><span class="op" id="5822348">,</span>&nbsp;<span class="ident" id="5822350">stride</span><span class="op" id="5822356">,</span>&nbsp;<span class="ident" id="5822358">rect</span>&nbsp;<span class="op" id="5822363">=</span>&nbsp;<span class="ident" id="5822365">target</span><span class="op" id="5822371">.</span><span class="ident" id="5822372">Pix</span><span class="op" id="5822375">,</span>&nbsp;<span class="ident" id="5822377">target</span><span class="op" id="5822383">.</span><span class="ident" id="5822384">Stride</span><span class="op" id="5822390">,</span>&nbsp;<span class="ident" id="5822392">target</span><span class="op" id="5822398">.</span><span class="ident" id="5822399">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822406">bytesPerPixel</span>&nbsp;<span class="op" id="5822420">=</span>&nbsp;<span class="num" id="5822422">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5822425">case</span>&nbsp;<span class="op" id="5822430">*</span><span class="ident" id="5822431">image</span><span class="op" id="5822436">.</span><span class="ident" id="5822437">NRGBA</span><span class="op" id="5822442">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822446">srcPix</span>&nbsp;<span class="op" id="5822453">=</span>&nbsp;<span class="ident" id="5822455">src</span><span class="op" id="5822458">.</span><span class="op" id="5822459">(</span><span class="op" id="5822460">*</span><span class="ident" id="5822461">image</span><span class="op" id="5822466">.</span><span class="ident" id="5822467">NRGBA</span><span class="op" id="5822472">)</span><span class="op" id="5822473">.</span><span class="ident" id="5822474">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822480">dstPix</span><span class="op" id="5822486">,</span>&nbsp;<span class="ident" id="5822488">stride</span><span class="op" id="5822494">,</span>&nbsp;<span class="ident" id="5822496">rect</span>&nbsp;<span class="op" id="5822501">=</span>&nbsp;<span class="ident" id="5822503">target</span><span class="op" id="5822509">.</span><span class="ident" id="5822510">Pix</span><span class="op" id="5822513">,</span>&nbsp;<span class="ident" id="5822515">target</span><span class="op" id="5822521">.</span><span class="ident" id="5822522">Stride</span><span class="op" id="5822528">,</span>&nbsp;<span class="ident" id="5822530">target</span><span class="op" id="5822536">.</span><span class="ident" id="5822537">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822544">bytesPerPixel</span>&nbsp;<span class="op" id="5822558">=</span>&nbsp;<span class="num" id="5822560">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5822563">case</span>&nbsp;<span class="op" id="5822568">*</span><span class="ident" id="5822569">image</span><span class="op" id="5822574">.</span><span class="ident" id="5822575">NRGBA64</span><span class="op" id="5822582">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822586">srcPix</span>&nbsp;<span class="op" id="5822593">=</span>&nbsp;<span class="ident" id="5822595">src</span><span class="op" id="5822598">.</span><span class="op" id="5822599">(</span><span class="op" id="5822600">*</span><span class="ident" id="5822601">image</span><span class="op" id="5822606">.</span><span class="ident" id="5822607">NRGBA64</span><span class="op" id="5822614">)</span><span class="op" id="5822615">.</span><span class="ident" id="5822616">Pix</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822622">dstPix</span><span class="op" id="5822628">,</span>&nbsp;<span class="ident" id="5822630">stride</span><span class="op" id="5822636">,</span>&nbsp;<span class="ident" id="5822638">rect</span>&nbsp;<span class="op" id="5822643">=</span>&nbsp;<span class="ident" id="5822645">target</span><span class="op" id="5822651">.</span><span class="ident" id="5822652">Pix</span><span class="op" id="5822655">,</span>&nbsp;<span class="ident" id="5822657">target</span><span class="op" id="5822663">.</span><span class="ident" id="5822664">Stride</span><span class="op" id="5822670">,</span>&nbsp;<span class="ident" id="5822672">target</span><span class="op" id="5822678">.</span><span class="ident" id="5822679">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822686">bytesPerPixel</span>&nbsp;<span class="op" id="5822700">=</span>&nbsp;<span class="num" id="5822702">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5822705">case</span>&nbsp;<span class="op" id="5822710">*</span><span class="ident" id="5822711">image</span><span class="op" id="5822716">.</span><span class="ident" id="5822717">Paletted</span><span class="op" id="5822725">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822729">srcPix</span>&nbsp;<span class="op" id="5822736">=</span>&nbsp;<span class="ident" id="5822738">src</span><span class="op" id="5822741">.</span><span class="op" id="5822742">(</span><span class="op" id="5822743">*</span><span class="ident" id="5822744">image</span><span class="op" id="5822749">.</span><span class="ident" id="5822750">Paletted</span><span class="op" id="5822758">)</span><span class="op" id="5822759">.</span><span class="ident" id="5822760">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822766">dstPix</span><span class="op" id="5822772">,</span>&nbsp;<span class="ident" id="5822774">stride</span><span class="op" id="5822780">,</span>&nbsp;<span class="ident" id="5822782">rect</span>&nbsp;<span class="op" id="5822787">=</span>&nbsp;<span class="ident" id="5822789">target</span><span class="op" id="5822795">.</span><span class="ident" id="5822796">Pix</span><span class="op" id="5822799">,</span>&nbsp;<span class="ident" id="5822801">target</span><span class="op" id="5822807">.</span><span class="ident" id="5822808">Stride</span><span class="op" id="5822814">,</span>&nbsp;<span class="ident" id="5822816">target</span><span class="op" id="5822822">.</span><span class="ident" id="5822823">Rect</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822830">bytesPerPixel</span>&nbsp;<span class="op" id="5822844">=</span>&nbsp;<span class="num" id="5822846">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5822849">case</span>&nbsp;<span class="op" id="5822854">*</span><span class="ident" id="5822855">image</span><span class="op" id="5822860">.</span><span class="ident" id="5822861">RGBA</span><span class="op" id="5822865">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822869">srcPix</span>&nbsp;<span class="op" id="5822876">=</span>&nbsp;<span class="ident" id="5822878">src</span><span class="op" id="5822881">.</span><span class="op" id="5822882">(</span><span class="op" id="5822883">*</span><span class="ident" id="5822884">image</span><span class="op" id="5822889">.</span><span class="ident" id="5822890">RGBA</span><span class="op" id="5822894">)</span><span class="op" id="5822895">.</span><span class="ident" id="5822896">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822902">dstPix</span><span class="op" id="5822908">,</span>&nbsp;<span class="ident" id="5822910">stride</span><span class="op" id="5822916">,</span>&nbsp;<span class="ident" id="5822918">rect</span>&nbsp;<span class="op" id="5822923">=</span>&nbsp;<span class="ident" id="5822925">target</span><span class="op" id="5822931">.</span><span class="ident" id="5822932">Pix</span><span class="op" id="5822935">,</span>&nbsp;<span class="ident" id="5822937">target</span><span class="op" id="5822943">.</span><span class="ident" id="5822944">Stride</span><span class="op" id="5822950">,</span>&nbsp;<span class="ident" id="5822952">target</span><span class="op" id="5822958">.</span><span class="ident" id="5822959">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5822966">bytesPerPixel</span>&nbsp;<span class="op" id="5822980">=</span>&nbsp;<span class="num" id="5822982">4</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5822985">case</span>&nbsp;<span class="op" id="5822990">*</span><span class="ident" id="5822991">image</span><span class="op" id="5822996">.</span><span class="ident" id="5822997">RGBA64</span><span class="op" id="5823003">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823007">srcPix</span>&nbsp;<span class="op" id="5823014">=</span>&nbsp;<span class="ident" id="5823016">src</span><span class="op" id="5823019">.</span><span class="op" id="5823020">(</span><span class="op" id="5823021">*</span><span class="ident" id="5823022">image</span><span class="op" id="5823027">.</span><span class="ident" id="5823028">RGBA64</span><span class="op" id="5823034">)</span><span class="op" id="5823035">.</span><span class="ident" id="5823036">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823042">dstPix</span><span class="op" id="5823048">,</span>&nbsp;<span class="ident" id="5823050">stride</span><span class="op" id="5823056">,</span>&nbsp;<span class="ident" id="5823058">rect</span>&nbsp;<span class="op" id="5823063">=</span>&nbsp;<span class="ident" id="5823065">target</span><span class="op" id="5823071">.</span><span class="ident" id="5823072">Pix</span><span class="op" id="5823075">,</span>&nbsp;<span class="ident" id="5823077">target</span><span class="op" id="5823083">.</span><span class="ident" id="5823084">Stride</span><span class="op" id="5823090">,</span>&nbsp;<span class="ident" id="5823092">target</span><span class="op" id="5823098">.</span><span class="ident" id="5823099">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823106">bytesPerPixel</span>&nbsp;<span class="op" id="5823120">=</span>&nbsp;<span class="num" id="5823122">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5823125">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823128">s</span><span class="op" id="5823129">,</span>&nbsp;<span class="ident" id="5823131">bounds</span>&nbsp;<span class="op" id="5823138">:=</span>&nbsp;<span class="num" id="5823141">0</span><span class="op" id="5823142">,</span>&nbsp;<span class="ident" id="5823144">src</span><span class="op" id="5823147">.</span><span class="ident" id="5823148">Bounds</span><span class="op" id="5823154">(</span><span class="op" id="5823155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823158">for</span>&nbsp;<span class="ident" id="5823162">y</span>&nbsp;<span class="op" id="5823164">:=</span>&nbsp;<span class="ident" id="5823167">bounds</span><span class="op" id="5823173">.</span><span class="ident" id="5823174">Min</span><span class="op" id="5823177">.</span><span class="ident" id="5823178">Y</span><span class="op" id="5823179">;</span>&nbsp;<span class="ident" id="5823181">y</span>&nbsp;<span class="op" id="5823183">&lt;</span>&nbsp;<span class="ident" id="5823185">bounds</span><span class="op" id="5823191">.</span><span class="ident" id="5823192">Max</span><span class="op" id="5823195">.</span><span class="ident" id="5823196">Y</span><span class="op" id="5823197">;</span>&nbsp;<span class="ident" id="5823199">y</span><span class="op" id="5823200">++</span>&nbsp;<span class="op" id="5823203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823207">dBase</span>&nbsp;<span class="op" id="5823213">:=</span>&nbsp;<span class="op" id="5823216">(</span><span class="ident" id="5823217">y</span><span class="op" id="5823218">*</span><span class="ident" id="5823219">p</span><span class="op" id="5823220">.</span><span class="ident" id="5823221">yFactor</span><span class="op" id="5823228">+</span><span class="ident" id="5823229">p</span><span class="op" id="5823230">.</span><span class="ident" id="5823231">yOffset</span><span class="op" id="5823238">-</span><span class="ident" id="5823239">rect</span><span class="op" id="5823243">.</span><span class="ident" id="5823244">Min</span><span class="op" id="5823247">.</span><span class="ident" id="5823248">Y</span><span class="op" id="5823249">)</span><span class="op" id="5823250">*</span><span class="ident" id="5823251">stride</span>&nbsp;<span class="op" id="5823258">+</span>&nbsp;<span class="op" id="5823260">(</span><span class="ident" id="5823261">p</span><span class="op" id="5823262">.</span><span class="ident" id="5823263">xOffset</span><span class="op" id="5823270">-</span><span class="ident" id="5823271">rect</span><span class="op" id="5823275">.</span><span class="ident" id="5823276">Min</span><span class="op" id="5823279">.</span><span class="ident" id="5823280">X</span><span class="op" id="5823281">)</span><span class="op" id="5823282">*</span><span class="ident" id="5823283">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823299">for</span>&nbsp;<span class="ident" id="5823303">x</span>&nbsp;<span class="op" id="5823305">:=</span>&nbsp;<span class="ident" id="5823308">bounds</span><span class="op" id="5823314">.</span><span class="ident" id="5823315">Min</span><span class="op" id="5823318">.</span><span class="ident" id="5823319">X</span><span class="op" id="5823320">;</span>&nbsp;<span class="ident" id="5823322">x</span>&nbsp;<span class="op" id="5823324">&lt;</span>&nbsp;<span class="ident" id="5823326">bounds</span><span class="op" id="5823332">.</span><span class="ident" id="5823333">Max</span><span class="op" id="5823336">.</span><span class="ident" id="5823337">X</span><span class="op" id="5823338">;</span>&nbsp;<span class="ident" id="5823340">x</span><span class="op" id="5823341">++</span>&nbsp;<span class="op" id="5823344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823349">d</span>&nbsp;<span class="op" id="5823351">:=</span>&nbsp;<span class="ident" id="5823354">dBase</span>&nbsp;<span class="op" id="5823360">+</span>&nbsp;<span class="ident" id="5823362">x</span><span class="op" id="5823363">*</span><span class="ident" id="5823364">p</span><span class="op" id="5823365">.</span><span class="ident" id="5823366">xFactor</span><span class="op" id="5823373">*</span><span class="ident" id="5823374">bytesPerPixel</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5823391">copy</span><span class="op" id="5823395">(</span><span class="ident" id="5823396">dstPix</span><span class="op" id="5823402">[</span><span class="ident" id="5823403">d</span><span class="op" id="5823404">:</span><span class="op" id="5823405">]</span><span class="op" id="5823406">,</span>&nbsp;<span class="ident" id="5823408">srcPix</span><span class="op" id="5823414">[</span><span class="ident" id="5823415">s</span><span class="op" id="5823416">:</span><span class="ident" id="5823417">s</span><span class="op" id="5823418">+</span><span class="ident" id="5823419">bytesPerPixel</span><span class="op" id="5823432">]</span><span class="op" id="5823433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823438">s</span>&nbsp;<span class="op" id="5823440">+=</span>&nbsp;<span class="ident" id="5823443">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5823459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5823462">}</span><br>
<span class="lineno"></span><span class="op" id="5823464">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span><span class="keyword" id="5823467">func</span>&nbsp;<span class="op" id="5823472">(</span><span class="ident" id="5823473">d</span>&nbsp;<span class="op" id="5823475">*</span><span class="ident" id="5823476">decoder</span><span class="op" id="5823483">)</span>&nbsp;<span class="ident" id="5823485">parseIDAT</span><span class="op" id="5823494">(</span><span class="ident" id="5823495">length</span>&nbsp;<span class="builtintype" id="5823502">uint32</span><span class="op" id="5823508">)</span>&nbsp;<span class="op" id="5823510">(</span><span class="ident" id="5823511">err</span>&nbsp;<span class="builtintype" id="5823515">error</span><span class="op" id="5823520">)</span>&nbsp;<span class="op" id="5823522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823525">d</span><span class="op" id="5823526">.</span><span class="ident" id="5823527">idatLength</span>&nbsp;<span class="op" id="5823538">=</span>&nbsp;<span class="ident" id="5823540">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823548">d</span><span class="op" id="5823549">.</span><span class="ident" id="5823550">img</span><span class="op" id="5823553">,</span>&nbsp;<span class="ident" id="5823555">err</span>&nbsp;<span class="op" id="5823559">=</span>&nbsp;<span class="ident" id="5823561">d</span><span class="op" id="5823562">.</span><span class="ident" id="5823563">decode</span><span class="op" id="5823569">(</span><span class="op" id="5823570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823573">if</span>&nbsp;<span class="ident" id="5823576">err</span>&nbsp;<span class="op" id="5823580">!=</span>&nbsp;<span class="ident" id="5823583">nil</span>&nbsp;<span class="op" id="5823587">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823591">return</span>&nbsp;<span class="ident" id="5823598">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5823603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823606">return</span>&nbsp;<span class="ident" id="5823613">d</span><span class="op" id="5823614">.</span><span class="ident" id="5823615">verifyChecksum</span><span class="op" id="5823629">(</span><span class="op" id="5823630">)</span><br>
<span class="lineno"></span><span class="op" id="5823632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">655</span><span class="keyword" id="5823635">func</span>&nbsp;<span class="op" id="5823640">(</span><span class="ident" id="5823641">d</span>&nbsp;<span class="op" id="5823643">*</span><span class="ident" id="5823644">decoder</span><span class="op" id="5823651">)</span>&nbsp;<span class="ident" id="5823653">parseIEND</span><span class="op" id="5823662">(</span><span class="ident" id="5823663">length</span>&nbsp;<span class="builtintype" id="5823670">uint32</span><span class="op" id="5823676">)</span>&nbsp;<span class="builtintype" id="5823678">error</span>&nbsp;<span class="op" id="5823684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823687">if</span>&nbsp;<span class="ident" id="5823690">length</span>&nbsp;<span class="op" id="5823697">!=</span>&nbsp;<span class="num" id="5823700">0</span>&nbsp;<span class="op" id="5823702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823706">return</span>&nbsp;<span class="ident" id="5823713">FormatError</span><span class="op" id="5823724">(</span><span class="string" id="5823725">&#34;bad&nbsp;IEND&nbsp;length&#34;</span><span class="op" id="5823742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5823745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823748">return</span>&nbsp;<span class="ident" id="5823755">d</span><span class="op" id="5823756">.</span><span class="ident" id="5823757">verifyChecksum</span><span class="op" id="5823771">(</span><span class="op" id="5823772">)</span><br>
<span class="lineno">660</span><span class="op" id="5823774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5823777">func</span>&nbsp;<span class="op" id="5823782">(</span><span class="ident" id="5823783">d</span>&nbsp;<span class="op" id="5823785">*</span><span class="ident" id="5823786">decoder</span><span class="op" id="5823793">)</span>&nbsp;<span class="ident" id="5823795">parseChunk</span><span class="op" id="5823805">(</span><span class="op" id="5823806">)</span>&nbsp;<span class="builtintype" id="5823808">error</span>&nbsp;<span class="op" id="5823814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5823817">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823853">n</span><span class="op" id="5823854">,</span>&nbsp;<span class="ident" id="5823856">err</span>&nbsp;<span class="op" id="5823860">:=</span>&nbsp;<span class="ident" id="5823863">io</span><span class="op" id="5823865">.</span><span class="ident" id="5823866">ReadFull</span><span class="op" id="5823874">(</span><span class="ident" id="5823875">d</span><span class="op" id="5823876">.</span><span class="ident" id="5823877">r</span><span class="op" id="5823878">,</span>&nbsp;<span class="ident" id="5823880">d</span><span class="op" id="5823881">.</span><span class="ident" id="5823882">tmp</span><span class="op" id="5823885">[</span><span class="op" id="5823886">:</span><span class="num" id="5823887">8</span><span class="op" id="5823888">]</span><span class="op" id="5823889">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823892">if</span>&nbsp;<span class="ident" id="5823895">err</span>&nbsp;<span class="op" id="5823899">!=</span>&nbsp;<span class="ident" id="5823902">nil</span>&nbsp;<span class="op" id="5823906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5823910">return</span>&nbsp;<span class="ident" id="5823917">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5823922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823925">length</span>&nbsp;<span class="op" id="5823932">:=</span>&nbsp;<span class="ident" id="5823935">binary</span><span class="op" id="5823941">.</span><span class="ident" id="5823942">BigEndian</span><span class="op" id="5823951">.</span><span class="ident" id="5823952">Uint32</span><span class="op" id="5823958">(</span><span class="ident" id="5823959">d</span><span class="op" id="5823960">.</span><span class="ident" id="5823961">tmp</span><span class="op" id="5823964">[</span><span class="op" id="5823965">:</span><span class="num" id="5823966">4</span><span class="op" id="5823967">]</span><span class="op" id="5823968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823971">d</span><span class="op" id="5823972">.</span><span class="ident" id="5823973">crc</span><span class="op" id="5823976">.</span><span class="ident" id="5823977">Reset</span><span class="op" id="5823982">(</span><span class="op" id="5823983">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5823986">d</span><span class="op" id="5823987">.</span><span class="ident" id="5823988">crc</span><span class="op" id="5823991">.</span><span class="ident" id="5823992">Write</span><span class="op" id="5823997">(</span><span class="ident" id="5823998">d</span><span class="op" id="5823999">.</span><span class="ident" id="5824000">tmp</span><span class="op" id="5824003">[</span><span class="num" id="5824004">4</span><span class="op" id="5824005">:</span><span class="num" id="5824006">8</span><span class="op" id="5824007">]</span><span class="op" id="5824008">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5824012">//&nbsp;Read&nbsp;the&nbsp;chunk&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824037">switch</span>&nbsp;<span class="builtintype" id="5824044">string</span><span class="op" id="5824050">(</span><span class="ident" id="5824051">d</span><span class="op" id="5824052">.</span><span class="ident" id="5824053">tmp</span><span class="op" id="5824056">[</span><span class="num" id="5824057">4</span><span class="op" id="5824058">:</span><span class="num" id="5824059">8</span><span class="op" id="5824060">]</span><span class="op" id="5824061">)</span>&nbsp;<span class="op" id="5824063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824066">case</span>&nbsp;<span class="string" id="5824071">&#34;IHDR&#34;</span><span class="op" id="5824077">:</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824081">if</span>&nbsp;<span class="ident" id="5824084">d</span><span class="op" id="5824085">.</span><span class="ident" id="5824086">stage</span>&nbsp;<span class="op" id="5824092">!=</span>&nbsp;<span class="ident" id="5824095">dsStart</span>&nbsp;<span class="op" id="5824103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824108">return</span>&nbsp;<span class="ident" id="5824115">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5824137">d</span><span class="op" id="5824138">.</span><span class="ident" id="5824139">stage</span>&nbsp;<span class="op" id="5824145">=</span>&nbsp;<span class="ident" id="5824147">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824160">return</span>&nbsp;<span class="ident" id="5824167">d</span><span class="op" id="5824168">.</span><span class="ident" id="5824169">parseIHDR</span><span class="op" id="5824178">(</span><span class="ident" id="5824179">length</span><span class="op" id="5824185">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824188">case</span>&nbsp;<span class="string" id="5824193">&#34;PLTE&#34;</span><span class="op" id="5824199">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824203">if</span>&nbsp;<span class="ident" id="5824206">d</span><span class="op" id="5824207">.</span><span class="ident" id="5824208">stage</span>&nbsp;<span class="op" id="5824214">!=</span>&nbsp;<span class="ident" id="5824217">dsSeenIHDR</span>&nbsp;<span class="op" id="5824228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824233">return</span>&nbsp;<span class="ident" id="5824240">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5824262">d</span><span class="op" id="5824263">.</span><span class="ident" id="5824264">stage</span>&nbsp;<span class="op" id="5824270">=</span>&nbsp;<span class="ident" id="5824272">dsSeenPLTE</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824285">return</span>&nbsp;<span class="ident" id="5824292">d</span><span class="op" id="5824293">.</span><span class="ident" id="5824294">parsePLTE</span><span class="op" id="5824303">(</span><span class="ident" id="5824304">length</span><span class="op" id="5824310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824313">case</span>&nbsp;<span class="string" id="5824318">&#34;tRNS&#34;</span><span class="op" id="5824324">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824328">if</span>&nbsp;<span class="ident" id="5824331">d</span><span class="op" id="5824332">.</span><span class="ident" id="5824333">stage</span>&nbsp;<span class="op" id="5824339">!=</span>&nbsp;<span class="ident" id="5824342">dsSeenPLTE</span>&nbsp;<span class="op" id="5824353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824358">return</span>&nbsp;<span class="ident" id="5824365">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824383">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824387">return</span>&nbsp;<span class="ident" id="5824394">d</span><span class="op" id="5824395">.</span><span class="ident" id="5824396">parsetRNS</span><span class="op" id="5824405">(</span><span class="ident" id="5824406">length</span><span class="op" id="5824412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824415">case</span>&nbsp;<span class="string" id="5824420">&#34;IDAT&#34;</span><span class="op" id="5824426">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824430">if</span>&nbsp;<span class="ident" id="5824433">d</span><span class="op" id="5824434">.</span><span class="ident" id="5824435">stage</span>&nbsp;<span class="op" id="5824441">&lt;</span>&nbsp;<span class="ident" id="5824443">dsSeenIHDR</span>&nbsp;<span class="op" id="5824454">||</span>&nbsp;<span class="ident" id="5824457">d</span><span class="op" id="5824458">.</span><span class="ident" id="5824459">stage</span>&nbsp;<span class="op" id="5824465">&gt;</span>&nbsp;<span class="ident" id="5824467">dsSeenIDAT</span>&nbsp;<span class="op" id="5824478">||</span>&nbsp;<span class="op" id="5824481">(</span><span class="ident" id="5824482">d</span><span class="op" id="5824483">.</span><span class="ident" id="5824484">cb</span>&nbsp;<span class="op" id="5824487">==</span>&nbsp;<span class="ident" id="5824490">cbP8</span>&nbsp;<span class="op" id="5824495">&amp;&amp;</span>&nbsp;<span class="ident" id="5824498">d</span><span class="op" id="5824499">.</span><span class="ident" id="5824500">stage</span>&nbsp;<span class="op" id="5824506">==</span>&nbsp;<span class="ident" id="5824509">dsSeenIHDR</span><span class="op" id="5824519">)</span>&nbsp;<span class="op" id="5824521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824526">return</span>&nbsp;<span class="ident" id="5824533">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824551">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5824555">d</span><span class="op" id="5824556">.</span><span class="ident" id="5824557">stage</span>&nbsp;<span class="op" id="5824563">=</span>&nbsp;<span class="ident" id="5824565">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824578">return</span>&nbsp;<span class="ident" id="5824585">d</span><span class="op" id="5824586">.</span><span class="ident" id="5824587">parseIDAT</span><span class="op" id="5824596">(</span><span class="ident" id="5824597">length</span><span class="op" id="5824603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824606">case</span>&nbsp;<span class="string" id="5824611">&#34;IEND&#34;</span><span class="op" id="5824617">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824621">if</span>&nbsp;<span class="ident" id="5824624">d</span><span class="op" id="5824625">.</span><span class="ident" id="5824626">stage</span>&nbsp;<span class="op" id="5824632">!=</span>&nbsp;<span class="ident" id="5824635">dsSeenIDAT</span>&nbsp;<span class="op" id="5824646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824651">return</span>&nbsp;<span class="ident" id="5824658">chunkOrderError</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5824680">d</span><span class="op" id="5824681">.</span><span class="ident" id="5824682">stage</span>&nbsp;<span class="op" id="5824688">=</span>&nbsp;<span class="ident" id="5824690">dsSeenIEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824703">return</span>&nbsp;<span class="ident" id="5824710">d</span><span class="op" id="5824711">.</span><span class="ident" id="5824712">parseIEND</span><span class="op" id="5824721">(</span><span class="ident" id="5824722">length</span><span class="op" id="5824728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5824734">//&nbsp;Ignore&nbsp;this&nbsp;chunk&nbsp;(of&nbsp;a&nbsp;known&nbsp;length).</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824777">var</span>&nbsp;<span class="ident" id="5824781">ignored</span>&nbsp;<span class="op" id="5824789">[</span><span class="num" id="5824790">4096</span><span class="op" id="5824794">]</span><span class="builtintype" id="5824795">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824801">for</span>&nbsp;<span class="ident" id="5824805">length</span>&nbsp;<span class="op" id="5824812">&gt;</span>&nbsp;<span class="num" id="5824814">0</span>&nbsp;<span class="op" id="5824816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5824820">n</span><span class="op" id="5824821">,</span>&nbsp;<span class="ident" id="5824823">err</span>&nbsp;<span class="op" id="5824827">=</span>&nbsp;<span class="ident" id="5824829">io</span><span class="op" id="5824831">.</span><span class="ident" id="5824832">ReadFull</span><span class="op" id="5824840">(</span><span class="ident" id="5824841">d</span><span class="op" id="5824842">.</span><span class="ident" id="5824843">r</span><span class="op" id="5824844">,</span>&nbsp;<span class="ident" id="5824846">ignored</span><span class="op" id="5824853">[</span><span class="op" id="5824854">:</span><span class="ident" id="5824855">min</span><span class="op" id="5824858">(</span><span class="builtinfunc" id="5824859">len</span><span class="op" id="5824862">(</span><span class="ident" id="5824863">ignored</span><span class="op" id="5824870">)</span><span class="op" id="5824871">,</span>&nbsp;<span class="builtintype" id="5824873">int</span><span class="op" id="5824876">(</span><span class="ident" id="5824877">length</span><span class="op" id="5824883">)</span><span class="op" id="5824884">)</span><span class="op" id="5824885">]</span><span class="op" id="5824886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824890">if</span>&nbsp;<span class="ident" id="5824893">err</span>&nbsp;<span class="op" id="5824897">!=</span>&nbsp;<span class="ident" id="5824900">nil</span>&nbsp;<span class="op" id="5824904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824909">return</span>&nbsp;<span class="ident" id="5824916">err</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5824926">d</span><span class="op" id="5824927">.</span><span class="ident" id="5824928">crc</span><span class="op" id="5824931">.</span><span class="ident" id="5824932">Write</span><span class="op" id="5824937">(</span><span class="ident" id="5824938">ignored</span><span class="op" id="5824945">[</span><span class="op" id="5824946">:</span><span class="ident" id="5824947">n</span><span class="op" id="5824948">]</span><span class="op" id="5824949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5824953">length</span>&nbsp;<span class="op" id="5824960">-=</span>&nbsp;<span class="builtintype" id="5824963">uint32</span><span class="op" id="5824969">(</span><span class="ident" id="5824970">n</span><span class="op" id="5824971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5824974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5824977">return</span>&nbsp;<span class="ident" id="5824984">d</span><span class="op" id="5824985">.</span><span class="ident" id="5824986">verifyChecksum</span><span class="op" id="5825000">(</span><span class="op" id="5825001">)</span><br>
<span class="lineno">715</span><span class="op" id="5825003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5825006">func</span>&nbsp;<span class="op" id="5825011">(</span><span class="ident" id="5825012">d</span>&nbsp;<span class="op" id="5825014">*</span><span class="ident" id="5825015">decoder</span><span class="op" id="5825022">)</span>&nbsp;<span class="ident" id="5825024">verifyChecksum</span><span class="op" id="5825038">(</span><span class="op" id="5825039">)</span>&nbsp;<span class="builtintype" id="5825041">error</span>&nbsp;<span class="op" id="5825047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825050">if</span>&nbsp;<span class="ident" id="5825053">_</span><span class="op" id="5825054">,</span>&nbsp;<span class="ident" id="5825056">err</span>&nbsp;<span class="op" id="5825060">:=</span>&nbsp;<span class="ident" id="5825063">io</span><span class="op" id="5825065">.</span><span class="ident" id="5825066">ReadFull</span><span class="op" id="5825074">(</span><span class="ident" id="5825075">d</span><span class="op" id="5825076">.</span><span class="ident" id="5825077">r</span><span class="op" id="5825078">,</span>&nbsp;<span class="ident" id="5825080">d</span><span class="op" id="5825081">.</span><span class="ident" id="5825082">tmp</span><span class="op" id="5825085">[</span><span class="op" id="5825086">:</span><span class="num" id="5825087">4</span><span class="op" id="5825088">]</span><span class="op" id="5825089">)</span><span class="op" id="5825090">;</span>&nbsp;<span class="ident" id="5825092">err</span>&nbsp;<span class="op" id="5825096">!=</span>&nbsp;<span class="ident" id="5825099">nil</span>&nbsp;<span class="op" id="5825103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825107">return</span>&nbsp;<span class="ident" id="5825114">err</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5825119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825122">if</span>&nbsp;<span class="ident" id="5825125">binary</span><span class="op" id="5825131">.</span><span class="ident" id="5825132">BigEndian</span><span class="op" id="5825141">.</span><span class="ident" id="5825142">Uint32</span><span class="op" id="5825148">(</span><span class="ident" id="5825149">d</span><span class="op" id="5825150">.</span><span class="ident" id="5825151">tmp</span><span class="op" id="5825154">[</span><span class="op" id="5825155">:</span><span class="num" id="5825156">4</span><span class="op" id="5825157">]</span><span class="op" id="5825158">)</span>&nbsp;<span class="op" id="5825160">!=</span>&nbsp;<span class="ident" id="5825163">d</span><span class="op" id="5825164">.</span><span class="ident" id="5825165">crc</span><span class="op" id="5825168">.</span><span class="ident" id="5825169">Sum32</span><span class="op" id="5825174">(</span><span class="op" id="5825175">)</span>&nbsp;<span class="op" id="5825177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825181">return</span>&nbsp;<span class="ident" id="5825188">FormatError</span><span class="op" id="5825199">(</span><span class="string" id="5825200">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="5825218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5825221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825224">return</span>&nbsp;<span class="ident" id="5825231">nil</span><br>
<span class="lineno">725</span><span class="op" id="5825235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5825238">func</span>&nbsp;<span class="op" id="5825243">(</span><span class="ident" id="5825244">d</span>&nbsp;<span class="op" id="5825246">*</span><span class="ident" id="5825247">decoder</span><span class="op" id="5825254">)</span>&nbsp;<span class="ident" id="5825256">checkHeader</span><span class="op" id="5825267">(</span><span class="op" id="5825268">)</span>&nbsp;<span class="builtintype" id="5825270">error</span>&nbsp;<span class="op" id="5825276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5825279">_</span><span class="op" id="5825280">,</span>&nbsp;<span class="ident" id="5825282">err</span>&nbsp;<span class="op" id="5825286">:=</span>&nbsp;<span class="ident" id="5825289">io</span><span class="op" id="5825291">.</span><span class="ident" id="5825292">ReadFull</span><span class="op" id="5825300">(</span><span class="ident" id="5825301">d</span><span class="op" id="5825302">.</span><span class="ident" id="5825303">r</span><span class="op" id="5825304">,</span>&nbsp;<span class="ident" id="5825306">d</span><span class="op" id="5825307">.</span><span class="ident" id="5825308">tmp</span><span class="op" id="5825311">[</span><span class="op" id="5825312">:</span><span class="builtinfunc" id="5825313">len</span><span class="op" id="5825316">(</span><span class="ident" id="5825317">pngHeader</span><span class="op" id="5825326">)</span><span class="op" id="5825327">]</span><span class="op" id="5825328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825331">if</span>&nbsp;<span class="ident" id="5825334">err</span>&nbsp;<span class="op" id="5825338">!=</span>&nbsp;<span class="ident" id="5825341">nil</span>&nbsp;<span class="op" id="5825345">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825349">return</span>&nbsp;<span class="ident" id="5825356">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5825361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825364">if</span>&nbsp;<span class="builtintype" id="5825367">string</span><span class="op" id="5825373">(</span><span class="ident" id="5825374">d</span><span class="op" id="5825375">.</span><span class="ident" id="5825376">tmp</span><span class="op" id="5825379">[</span><span class="op" id="5825380">:</span><span class="builtinfunc" id="5825381">len</span><span class="op" id="5825384">(</span><span class="ident" id="5825385">pngHeader</span><span class="op" id="5825394">)</span><span class="op" id="5825395">]</span><span class="op" id="5825396">)</span>&nbsp;<span class="op" id="5825398">!=</span>&nbsp;<span class="ident" id="5825401">pngHeader</span>&nbsp;<span class="op" id="5825411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825415">return</span>&nbsp;<span class="ident" id="5825422">FormatError</span><span class="op" id="5825433">(</span><span class="string" id="5825434">&#34;not&nbsp;a&nbsp;PNG&nbsp;file&#34;</span><span class="op" id="5825450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5825453">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825456">return</span>&nbsp;<span class="ident" id="5825463">nil</span><br>
<span class="lineno"></span><span class="op" id="5825467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5825470">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;PNG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="comment" id="5825539">//&nbsp;The&nbsp;type&nbsp;of&nbsp;Image&nbsp;returned&nbsp;depends&nbsp;on&nbsp;the&nbsp;PNG&nbsp;contents.</span><br>
<span class="lineno">740</span><span class="keyword" id="5825598">func</span>&nbsp;<span class="ident" id="5825603">Decode</span><span class="op" id="5825609">(</span><span class="ident" id="5825610">r</span>&nbsp;<span class="ident" id="5825612">io</span><span class="op" id="5825614">.</span><span class="ident" id="5825615">Reader</span><span class="op" id="5825621">)</span>&nbsp;<span class="op" id="5825623">(</span><span class="ident" id="5825624">image</span><span class="op" id="5825629">.</span><span class="ident" id="5825630">Image</span><span class="op" id="5825635">,</span>&nbsp;<span class="builtintype" id="5825637">error</span><span class="op" id="5825642">)</span>&nbsp;<span class="op" id="5825644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5825647">d</span>&nbsp;<span class="op" id="5825649">:=</span>&nbsp;<span class="op" id="5825652">&amp;</span><span class="ident" id="5825653">decoder</span><span class="op" id="5825660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5825664">r</span><span class="op" id="5825665">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5825669">r</span><span class="op" id="5825670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5825674">crc</span><span class="op" id="5825677">:</span>&nbsp;<span class="ident" id="5825679">crc32</span><span class="op" id="5825684">.</span><span class="ident" id="5825685">NewIEEE</span><span class="op" id="5825692">(</span><span class="op" id="5825693">)</span><span class="op" id="5825694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5825697">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825700">if</span>&nbsp;<span class="ident" id="5825703">err</span>&nbsp;<span class="op" id="5825707">:=</span>&nbsp;<span class="ident" id="5825710">d</span><span class="op" id="5825711">.</span><span class="ident" id="5825712">checkHeader</span><span class="op" id="5825723">(</span><span class="op" id="5825724">)</span><span class="op" id="5825725">;</span>&nbsp;<span class="ident" id="5825727">err</span>&nbsp;<span class="op" id="5825731">!=</span>&nbsp;<span class="ident" id="5825734">nil</span>&nbsp;<span class="op" id="5825738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825742">if</span>&nbsp;<span class="ident" id="5825745">err</span>&nbsp;<span class="op" id="5825749">==</span>&nbsp;<span class="ident" id="5825752">io</span><span class="op" id="5825754">.</span><span class="ident" id="5825755">EOF</span>&nbsp;<span class="op" id="5825759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5825764">err</span>&nbsp;<span class="op" id="5825768">=</span>&nbsp;<span class="ident" id="5825770">io</span><span class="op" id="5825772">.</span><span class="ident" id="5825773">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5825792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825796">return</span>&nbsp;<span class="ident" id="5825803">nil</span><span class="op" id="5825806">,</span>&nbsp;<span class="ident" id="5825808">err</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5825813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825816">for</span>&nbsp;<span class="ident" id="5825820">d</span><span class="op" id="5825821">.</span><span class="ident" id="5825822">stage</span>&nbsp;<span class="op" id="5825828">!=</span>&nbsp;<span class="ident" id="5825831">dsSeenIEND</span>&nbsp;<span class="op" id="5825842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825846">if</span>&nbsp;<span class="ident" id="5825849">err</span>&nbsp;<span class="op" id="5825853">:=</span>&nbsp;<span class="ident" id="5825856">d</span><span class="op" id="5825857">.</span><span class="ident" id="5825858">parseChunk</span><span class="op" id="5825868">(</span><span class="op" id="5825869">)</span><span class="op" id="5825870">;</span>&nbsp;<span class="ident" id="5825872">err</span>&nbsp;<span class="op" id="5825876">!=</span>&nbsp;<span class="ident" id="5825879">nil</span>&nbsp;<span class="op" id="5825883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825888">if</span>&nbsp;<span class="ident" id="5825891">err</span>&nbsp;<span class="op" id="5825895">==</span>&nbsp;<span class="ident" id="5825898">io</span><span class="op" id="5825900">.</span><span class="ident" id="5825901">EOF</span>&nbsp;<span class="op" id="5825905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5825911">err</span>&nbsp;<span class="op" id="5825915">=</span>&nbsp;<span class="ident" id="5825917">io</span><span class="op" id="5825919">.</span><span class="ident" id="5825920">ErrUnexpectedEOF</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5825940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825945">return</span>&nbsp;<span class="ident" id="5825952">nil</span><span class="op" id="5825955">,</span>&nbsp;<span class="ident" id="5825957">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5825963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5825966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825969">return</span>&nbsp;<span class="ident" id="5825976">d</span><span class="op" id="5825977">.</span><span class="ident" id="5825978">img</span><span class="op" id="5825981">,</span>&nbsp;<span class="ident" id="5825983">nil</span><br>
<span class="lineno">760</span><span class="op" id="5825987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5825990">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;PNG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5826068">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5826098">func</span>&nbsp;<span class="ident" id="5826103">DecodeConfig</span><span class="op" id="5826115">(</span><span class="ident" id="5826116">r</span>&nbsp;<span class="ident" id="5826118">io</span><span class="op" id="5826120">.</span><span class="ident" id="5826121">Reader</span><span class="op" id="5826127">)</span>&nbsp;<span class="op" id="5826129">(</span><span class="ident" id="5826130">image</span><span class="op" id="5826135">.</span><span class="ident" id="5826136">Config</span><span class="op" id="5826142">,</span>&nbsp;<span class="builtintype" id="5826144">error</span><span class="op" id="5826149">)</span>&nbsp;<span class="op" id="5826151">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5826154">d</span>&nbsp;<span class="op" id="5826156">:=</span>&nbsp;<span class="op" id="5826159">&amp;</span><span class="ident" id="5826160">decoder</span><span class="op" id="5826167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5826171">r</span><span class="op" id="5826172">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5826176">r</span><span class="op" id="5826177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5826181">crc</span><span class="op" id="5826184">:</span>&nbsp;<span class="ident" id="5826186">crc32</span><span class="op" id="5826191">.</span><span class="ident" id="5826192">NewIEEE</span><span class="op" id="5826199">(</span><span class="op" id="5826200">)</span><span class="op" id="5826201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5826204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826207">if</span>&nbsp;<span class="ident" id="5826210">err</span>&nbsp;<span class="op" id="5826214">:=</span>&nbsp;<span class="ident" id="5826217">d</span><span class="op" id="5826218">.</span><span class="ident" id="5826219">checkHeader</span><span class="op" id="5826230">(</span><span class="op" id="5826231">)</span><span class="op" id="5826232">;</span>&nbsp;<span class="ident" id="5826234">err</span>&nbsp;<span class="op" id="5826238">!=</span>&nbsp;<span class="ident" id="5826241">nil</span>&nbsp;<span class="op" id="5826245">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826249">if</span>&nbsp;<span class="ident" id="5826252">err</span>&nbsp;<span class="op" id="5826256">==</span>&nbsp;<span class="ident" id="5826259">io</span><span class="op" id="5826261">.</span><span class="ident" id="5826262">EOF</span>&nbsp;<span class="op" id="5826266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5826271">err</span>&nbsp;<span class="op" id="5826275">=</span>&nbsp;<span class="ident" id="5826277">io</span><span class="op" id="5826279">.</span><span class="ident" id="5826280">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5826299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826303">return</span>&nbsp;<span class="ident" id="5826310">image</span><span class="op" id="5826315">.</span><span class="ident" id="5826316">Config</span><span class="op" id="5826322">{</span><span class="op" id="5826323">}</span><span class="op" id="5826324">,</span>&nbsp;<span class="ident" id="5826326">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5826331">}</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826334">for</span>&nbsp;<span class="op" id="5826338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826342">if</span>&nbsp;<span class="ident" id="5826345">err</span>&nbsp;<span class="op" id="5826349">:=</span>&nbsp;<span class="ident" id="5826352">d</span><span class="op" id="5826353">.</span><span class="ident" id="5826354">parseChunk</span><span class="op" id="5826364">(</span><span class="op" id="5826365">)</span><span class="op" id="5826366">;</span>&nbsp;<span class="ident" id="5826368">err</span>&nbsp;<span class="op" id="5826372">!=</span>&nbsp;<span class="ident" id="5826375">nil</span>&nbsp;<span class="op" id="5826379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826384">if</span>&nbsp;<span class="ident" id="5826387">err</span>&nbsp;<span class="op" id="5826391">==</span>&nbsp;<span class="ident" id="5826394">io</span><span class="op" id="5826396">.</span><span class="ident" id="5826397">EOF</span>&nbsp;<span class="op" id="5826401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5826407">err</span>&nbsp;<span class="op" id="5826411">=</span>&nbsp;<span class="ident" id="5826413">io</span><span class="op" id="5826415">.</span><span class="ident" id="5826416">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5826436">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826441">return</span>&nbsp;<span class="ident" id="5826448">image</span><span class="op" id="5826453">.</span><span class="ident" id="5826454">Config</span><span class="op" id="5826460">{</span><span class="op" id="5826461">}</span><span class="op" id="5826462">,</span>&nbsp;<span class="ident" id="5826464">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5826470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5826474">paletted</span>&nbsp;<span class="op" id="5826483">:=</span>&nbsp;<span class="ident" id="5826486">d</span><span class="op" id="5826487">.</span><span class="ident" id="5826488">cb</span>&nbsp;<span class="op" id="5826491">==</span>&nbsp;<span class="ident" id="5826494">cbP8</span>&nbsp;<span class="op" id="5826499">||</span>&nbsp;<span class="ident" id="5826502">d</span><span class="op" id="5826503">.</span><span class="ident" id="5826504">cb</span>&nbsp;<span class="op" id="5826507">==</span>&nbsp;<span class="ident" id="5826510">cbP4</span>&nbsp;<span class="op" id="5826515">||</span>&nbsp;<span class="ident" id="5826518">d</span><span class="op" id="5826519">.</span><span class="ident" id="5826520">cb</span>&nbsp;<span class="op" id="5826523">==</span>&nbsp;<span class="ident" id="5826526">cbP2</span>&nbsp;<span class="op" id="5826531">||</span>&nbsp;<span class="ident" id="5826534">d</span><span class="op" id="5826535">.</span><span class="ident" id="5826536">cb</span>&nbsp;<span class="op" id="5826539">==</span>&nbsp;<span class="ident" id="5826542">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826549">if</span>&nbsp;<span class="ident" id="5826552">d</span><span class="op" id="5826553">.</span><span class="ident" id="5826554">stage</span>&nbsp;<span class="op" id="5826560">==</span>&nbsp;<span class="ident" id="5826563">dsSeenIHDR</span>&nbsp;<span class="op" id="5826574">&amp;&amp;</span>&nbsp;<span class="op" id="5826577">!</span><span class="ident" id="5826578">paletted</span>&nbsp;<span class="op" id="5826587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826592">break</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5826600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826604">if</span>&nbsp;<span class="ident" id="5826607">d</span><span class="op" id="5826608">.</span><span class="ident" id="5826609">stage</span>&nbsp;<span class="op" id="5826615">==</span>&nbsp;<span class="ident" id="5826618">dsSeenPLTE</span>&nbsp;<span class="op" id="5826629">&amp;&amp;</span>&nbsp;<span class="ident" id="5826632">paletted</span>&nbsp;<span class="op" id="5826641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826646">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5826654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5826657">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826660">var</span>&nbsp;<span class="ident" id="5826664">cm</span>&nbsp;<span class="ident" id="5826667">color</span><span class="op" id="5826672">.</span><span class="ident" id="5826673">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826680">switch</span>&nbsp;<span class="ident" id="5826687">d</span><span class="op" id="5826688">.</span><span class="ident" id="5826689">cb</span>&nbsp;<span class="op" id="5826692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826695">case</span>&nbsp;<span class="ident" id="5826700">cbG1</span><span class="op" id="5826704">,</span>&nbsp;<span class="ident" id="5826706">cbG2</span><span class="op" id="5826710">,</span>&nbsp;<span class="ident" id="5826712">cbG4</span><span class="op" id="5826716">,</span>&nbsp;<span class="ident" id="5826718">cbG8</span><span class="op" id="5826722">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5826726">cm</span>&nbsp;<span class="op" id="5826729">=</span>&nbsp;<span class="ident" id="5826731">color</span><span class="op" id="5826736">.</span><span class="ident" id="5826737">GrayModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826748">case</span>&nbsp;<span class="ident" id="5826753">cbGA8</span><span class="op" id="5826758">:</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5826762">cm</span>&nbsp;<span class="op" id="5826765">=</span>&nbsp;<span class="ident" id="5826767">color</span><span class="op" id="5826772">.</span><span class="ident" id="5826773">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826785">case</span>&nbsp;<span class="ident" id="5826790">cbTC8</span><span class="op" id="5826795">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5826799">cm</span>&nbsp;<span class="op" id="5826802">=</span>&nbsp;<span class="ident" id="5826804">color</span><span class="op" id="5826809">.</span><span class="ident" id="5826810">RGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826821">case</span>&nbsp;<span class="ident" id="5826826">cbP1</span><span class="op" id="5826830">,</span>&nbsp;<span class="ident" id="5826832">cbP2</span><span class="op" id="5826836">,</span>&nbsp;<span class="ident" id="5826838">cbP4</span><span class="op" id="5826842">,</span>&nbsp;<span class="ident" id="5826844">cbP8</span><span class="op" id="5826848">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5826852">cm</span>&nbsp;<span class="op" id="5826855">=</span>&nbsp;<span class="ident" id="5826857">d</span><span class="op" id="5826858">.</span><span class="ident" id="5826859">palette</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826868">case</span>&nbsp;<span class="ident" id="5826873">cbTCA8</span><span class="op" id="5826879">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5826883">cm</span>&nbsp;<span class="op" id="5826886">=</span>&nbsp;<span class="ident" id="5826888">color</span><span class="op" id="5826893">.</span><span class="ident" id="5826894">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826906">case</span>&nbsp;<span class="ident" id="5826911">cbG16</span><span class="op" id="5826916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5826920">cm</span>&nbsp;<span class="op" id="5826923">=</span>&nbsp;<span class="ident" id="5826925">color</span><span class="op" id="5826930">.</span><span class="ident" id="5826931">Gray16Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826944">case</span>&nbsp;<span class="ident" id="5826949">cbGA16</span><span class="op" id="5826955">:</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5826959">cm</span>&nbsp;<span class="op" id="5826962">=</span>&nbsp;<span class="ident" id="5826964">color</span><span class="op" id="5826969">.</span><span class="ident" id="5826970">NRGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5826984">case</span>&nbsp;<span class="ident" id="5826989">cbTC16</span><span class="op" id="5826995">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5826999">cm</span>&nbsp;<span class="op" id="5827002">=</span>&nbsp;<span class="ident" id="5827004">color</span><span class="op" id="5827009">.</span><span class="ident" id="5827010">RGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5827023">case</span>&nbsp;<span class="ident" id="5827028">cbTCA16</span><span class="op" id="5827035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5827039">cm</span>&nbsp;<span class="op" id="5827042">=</span>&nbsp;<span class="ident" id="5827044">color</span><span class="op" id="5827049">.</span><span class="ident" id="5827050">NRGBA64Model</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5827064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5827067">return</span>&nbsp;<span class="ident" id="5827074">image</span><span class="op" id="5827079">.</span><span class="ident" id="5827080">Config</span><span class="op" id="5827086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5827090">ColorModel</span><span class="op" id="5827100">:</span>&nbsp;<span class="ident" id="5827102">cm</span><span class="op" id="5827104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5827108">Width</span><span class="op" id="5827113">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5827120">d</span><span class="op" id="5827121">.</span><span class="ident" id="5827122">width</span><span class="op" id="5827127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5827131">Height</span><span class="op" id="5827137">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5827143">d</span><span class="op" id="5827144">.</span><span class="ident" id="5827145">height</span><span class="op" id="5827151">,</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5827154">}</span><span class="op" id="5827155">,</span>&nbsp;<span class="ident" id="5827157">nil</span><br>
<span class="lineno"></span><span class="op" id="5827161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5827164">func</span>&nbsp;<span class="ident" id="5827169">init</span><span class="op" id="5827173">(</span><span class="op" id="5827174">)</span>&nbsp;<span class="op" id="5827176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5827179">image</span><span class="op" id="5827184">.</span><span class="ident" id="5827185">RegisterFormat</span><span class="op" id="5827199">(</span><span class="string" id="5827200">&#34;png&#34;</span><span class="op" id="5827205">,</span>&nbsp;<span class="ident" id="5827207">pngHeader</span><span class="op" id="5827216">,</span>&nbsp;<span class="ident" id="5827218">Decode</span><span class="op" id="5827224">,</span>&nbsp;<span class="ident" id="5827226">DecodeConfig</span><span class="op" id="5827238">)</span><br>
<span class="lineno">820</span><span class="op" id="5827240">}</span>
</div>
</body>
</html>
