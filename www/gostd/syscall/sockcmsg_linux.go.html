<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html" class="current">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2561247">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2561303">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2561357">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2561408">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2561436">package</span>&nbsp;<span class="ident" id="2561444">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2561453">import</span>&nbsp;<span class="string" id="2561460">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2561470">//&nbsp;UnixCredentials&nbsp;encodes&nbsp;credentials&nbsp;into&nbsp;a&nbsp;socket&nbsp;control&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="2561539">//&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2561595">//&nbsp;authentication.</span><br>
<span class="lineno"></span><span class="keyword" id="2561614">func</span>&nbsp;<span class="ident" id="2561619">UnixCredentials</span><span class="op" id="2561634">(</span><span class="ident" id="2561635">ucred</span>&nbsp;<span class="op" id="2561641">*</span><span class="ident" id="2561642">Ucred</span><span class="op" id="2561647">)</span>&nbsp;<span class="op" id="2561649">[</span><span class="op" id="2561650">]</span><span class="builtintype" id="2561651">byte</span>&nbsp;<span class="op" id="2561656">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2561659">b</span>&nbsp;<span class="op" id="2561661">:=</span>&nbsp;<span class="builtinfunc" id="2561664">make</span><span class="op" id="2561668">(</span><span class="op" id="2561669">[</span><span class="op" id="2561670">]</span><span class="builtintype" id="2561671">byte</span><span class="op" id="2561675">,</span>&nbsp;<span class="ident" id="2561677">CmsgSpace</span><span class="op" id="2561686">(</span><span class="ident" id="2561687">SizeofUcred</span><span class="op" id="2561698">)</span><span class="op" id="2561699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2561702">h</span>&nbsp;<span class="op" id="2561704">:=</span>&nbsp;<span class="op" id="2561707">(</span><span class="op" id="2561708">*</span><span class="ident" id="2561709">Cmsghdr</span><span class="op" id="2561716">)</span><span class="op" id="2561717">(</span><span class="ident" id="2561718">unsafe</span><span class="op" id="2561724">.</span><span class="ident" id="2561725">Pointer</span><span class="op" id="2561732">(</span><span class="op" id="2561733">&amp;</span><span class="ident" id="2561734">b</span><span class="op" id="2561735">[</span><span class="num" id="2561736">0</span><span class="op" id="2561737">]</span><span class="op" id="2561738">)</span><span class="op" id="2561739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2561742">h</span><span class="op" id="2561743">.</span><span class="ident" id="2561744">Level</span>&nbsp;<span class="op" id="2561750">=</span>&nbsp;<span class="ident" id="2561752">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2561764">h</span><span class="op" id="2561765">.</span><span class="ident" id="2561766">Type</span>&nbsp;<span class="op" id="2561771">=</span>&nbsp;<span class="ident" id="2561773">SCM_CREDENTIALS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2561790">h</span><span class="op" id="2561791">.</span><span class="ident" id="2561792">SetLen</span><span class="op" id="2561798">(</span><span class="ident" id="2561799">CmsgLen</span><span class="op" id="2561806">(</span><span class="ident" id="2561807">SizeofUcred</span><span class="op" id="2561818">)</span><span class="op" id="2561819">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2561822">*</span><span class="op" id="2561823">(</span><span class="op" id="2561824">(</span><span class="op" id="2561825">*</span><span class="ident" id="2561826">Ucred</span><span class="op" id="2561831">)</span><span class="op" id="2561832">(</span><span class="ident" id="2561833">cmsgData</span><span class="op" id="2561841">(</span><span class="ident" id="2561842">h</span><span class="op" id="2561843">)</span><span class="op" id="2561844">)</span><span class="op" id="2561845">)</span>&nbsp;<span class="op" id="2561847">=</span>&nbsp;<span class="op" id="2561849">*</span><span class="ident" id="2561850">ucred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2561857">return</span>&nbsp;<span class="ident" id="2561864">b</span><br>
<span class="lineno"></span><span class="op" id="2561866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2561869">//&nbsp;ParseUnixCredentials&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains</span><br>
<span class="lineno">25</span><span class="comment" id="2561940">//&nbsp;credentials&nbsp;in&nbsp;a&nbsp;Ucred&nbsp;structure.&nbsp;To&nbsp;receive&nbsp;such&nbsp;a&nbsp;message,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2562008">//&nbsp;SO_PASSCRED&nbsp;option&nbsp;must&nbsp;be&nbsp;enabled&nbsp;on&nbsp;the&nbsp;socket.</span><br>
<span class="lineno"></span><span class="keyword" id="2562061">func</span>&nbsp;<span class="ident" id="2562066">ParseUnixCredentials</span><span class="op" id="2562086">(</span><span class="ident" id="2562087">m</span>&nbsp;<span class="op" id="2562089">*</span><span class="ident" id="2562090">SocketControlMessage</span><span class="op" id="2562110">)</span>&nbsp;<span class="op" id="2562112">(</span><span class="op" id="2562113">*</span><span class="ident" id="2562114">Ucred</span><span class="op" id="2562119">,</span>&nbsp;<span class="builtintype" id="2562121">error</span><span class="op" id="2562126">)</span>&nbsp;<span class="op" id="2562128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2562131">if</span>&nbsp;<span class="ident" id="2562134">m</span><span class="op" id="2562135">.</span><span class="ident" id="2562136">Header</span><span class="op" id="2562142">.</span><span class="ident" id="2562143">Level</span>&nbsp;<span class="op" id="2562149">!=</span>&nbsp;<span class="ident" id="2562152">SOL_SOCKET</span>&nbsp;<span class="op" id="2562163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2562167">return</span>&nbsp;<span class="ident" id="2562174">nil</span><span class="op" id="2562177">,</span>&nbsp;<span class="ident" id="2562179">EINVAL</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2562187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2562190">if</span>&nbsp;<span class="ident" id="2562193">m</span><span class="op" id="2562194">.</span><span class="ident" id="2562195">Header</span><span class="op" id="2562201">.</span><span class="ident" id="2562202">Type</span>&nbsp;<span class="op" id="2562207">!=</span>&nbsp;<span class="ident" id="2562210">SCM_CREDENTIALS</span>&nbsp;<span class="op" id="2562226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2562230">return</span>&nbsp;<span class="ident" id="2562237">nil</span><span class="op" id="2562240">,</span>&nbsp;<span class="ident" id="2562242">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2562250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2562253">ucred</span>&nbsp;<span class="op" id="2562259">:=</span>&nbsp;<span class="op" id="2562262">*</span><span class="op" id="2562263">(</span><span class="op" id="2562264">*</span><span class="ident" id="2562265">Ucred</span><span class="op" id="2562270">)</span><span class="op" id="2562271">(</span><span class="ident" id="2562272">unsafe</span><span class="op" id="2562278">.</span><span class="ident" id="2562279">Pointer</span><span class="op" id="2562286">(</span><span class="op" id="2562287">&amp;</span><span class="ident" id="2562288">m</span><span class="op" id="2562289">.</span><span class="ident" id="2562290">Data</span><span class="op" id="2562294">[</span><span class="num" id="2562295">0</span><span class="op" id="2562296">]</span><span class="op" id="2562297">)</span><span class="op" id="2562298">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2562301">return</span>&nbsp;<span class="op" id="2562308">&amp;</span><span class="ident" id="2562309">ucred</span><span class="op" id="2562314">,</span>&nbsp;<span class="ident" id="2562316">nil</span><br>
<span class="lineno"></span><span class="op" id="2562320">}</span>
</div>
</body>
</html>
