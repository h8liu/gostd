<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5475268">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5475323">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5475377">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5475428">//&nbsp;Package&nbsp;adler32&nbsp;implements&nbsp;the&nbsp;Adler-32&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="comment" id="5475481">//</span><br>
<span class="lineno"></span><span class="comment" id="5475484">//&nbsp;It&nbsp;is&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;1950:</span><br>
<span class="lineno"></span><span class="comment" id="5475514">//&nbsp;&nbsp;&nbsp;&nbspAdler-32&nbsp;is&nbsp;composed&nbsp;of&nbsp;two&nbsp;sums&nbsp;accumulated&nbsp;per&nbsp;byte:&nbsp;s1&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5475578">//&nbsp;&nbsp;&nbsp;&nbspthe&nbsp;sum&nbsp;of&nbsp;all&nbsp;bytes,&nbsp;s2&nbsp;is&nbsp;the&nbsp;sum&nbsp;of&nbsp;all&nbsp;s1&nbsp;values.&nbsp;Both&nbsp;sums</span><br>
<span class="lineno">10</span><span class="comment" id="5475645">//&nbsp;&nbsp;&nbsp;&nbspare&nbsp;done&nbsp;modulo&nbsp;65521.&nbsp;s1&nbsp;is&nbsp;initialized&nbsp;to&nbsp;1,&nbsp;s2&nbsp;to&nbsp;zero.&nbsp;&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5475712">//&nbsp;&nbsp;&nbsp;&nbspAdler-32&nbsp;checksum&nbsp;is&nbsp;stored&nbsp;as&nbsp;s2*65536&nbsp;+&nbsp;s1&nbsp;in&nbsp;most-</span><br>
<span class="lineno"></span><span class="comment" id="5475769">//&nbsp;&nbsp;&nbsp;&nbspsignificant-byte&nbsp;first&nbsp;(network)&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5475812">package</span>&nbsp;<span class="ident" id="5475820">adler32</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5475829">import</span>&nbsp;<span class="string" id="5475836">&#34;hash&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5475844">const</span>&nbsp;<span class="op" id="5475850">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475853">//&nbsp;mod&nbsp;is&nbsp;the&nbsp;largest&nbsp;prime&nbsp;that&nbsp;is&nbsp;less&nbsp;than&nbsp;65536.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475907">mod</span>&nbsp;<span class="op" id="5475911">=</span>&nbsp;<span class="num" id="5475913">65521</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475920">//&nbsp;nmax&nbsp;is&nbsp;the&nbsp;largest&nbsp;n&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475956">//&nbsp;255&nbsp;*&nbsp;n&nbsp;*&nbsp;(n+1)&nbsp;/&nbsp;2&nbsp;+&nbsp;(n+1)&nbsp;*&nbsp;(mod-1)&nbsp;&lt;=&nbsp;2^32-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476009">//&nbsp;It&nbsp;is&nbsp;mentioned&nbsp;in&nbsp;RFC&nbsp;1950&nbsp;(search&nbsp;for&nbsp;&#34;5552&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476062">nmax</span>&nbsp;<span class="op" id="5476067">=</span>&nbsp;<span class="num" id="5476069">5552</span><br>
<span class="lineno"></span><span class="op" id="5476074">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="5476077">//&nbsp;The&nbsp;size&nbsp;of&nbsp;an&nbsp;Adler-32&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5476123">const</span>&nbsp;<span class="ident" id="5476129">Size</span>&nbsp;<span class="op" id="5476134">=</span>&nbsp;<span class="num" id="5476136">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5476139">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno">30</span><span class="comment" id="5476198">//&nbsp;The&nbsp;low&nbsp;16&nbsp;bits&nbsp;are&nbsp;s1,&nbsp;the&nbsp;high&nbsp;16&nbsp;bits&nbsp;are&nbsp;s2.</span><br>
<span class="lineno"></span><span class="keyword" id="5476250">type</span>&nbsp;<span class="ident" id="5476255">digest</span>&nbsp;<span class="builtintype" id="5476262">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5476270">func</span>&nbsp;<span class="op" id="5476275">(</span><span class="ident" id="5476276">d</span>&nbsp;<span class="op" id="5476278">*</span><span class="ident" id="5476279">digest</span><span class="op" id="5476285">)</span>&nbsp;<span class="ident" id="5476287">Reset</span><span class="op" id="5476292">(</span><span class="op" id="5476293">)</span>&nbsp;<span class="op" id="5476295">{</span>&nbsp;<span class="op" id="5476297">*</span><span class="ident" id="5476298">d</span>&nbsp;<span class="op" id="5476300">=</span>&nbsp;<span class="num" id="5476302">1</span>&nbsp;<span class="op" id="5476304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5476307">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash32&nbsp;computing&nbsp;the&nbsp;Adler-32&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="5476373">func</span>&nbsp;<span class="ident" id="5476378">New</span><span class="op" id="5476381">(</span><span class="op" id="5476382">)</span>&nbsp;<span class="ident" id="5476384">hash</span><span class="op" id="5476388">.</span><span class="ident" id="5476389">Hash32</span>&nbsp;<span class="op" id="5476396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476399">d</span>&nbsp;<span class="op" id="5476401">:=</span>&nbsp;<span class="builtinfunc" id="5476404">new</span><span class="op" id="5476407">(</span><span class="ident" id="5476408">digest</span><span class="op" id="5476414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476417">d</span><span class="op" id="5476418">.</span><span class="ident" id="5476419">Reset</span><span class="op" id="5476424">(</span><span class="op" id="5476425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476428">return</span>&nbsp;<span class="ident" id="5476435">d</span><br>
<span class="lineno">40</span><span class="op" id="5476437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5476440">func</span>&nbsp;<span class="op" id="5476445">(</span><span class="ident" id="5476446">d</span>&nbsp;<span class="op" id="5476448">*</span><span class="ident" id="5476449">digest</span><span class="op" id="5476455">)</span>&nbsp;<span class="ident" id="5476457">Size</span><span class="op" id="5476461">(</span><span class="op" id="5476462">)</span>&nbsp;<span class="builtintype" id="5476464">int</span>&nbsp;<span class="op" id="5476468">{</span>&nbsp;<span class="keyword" id="5476470">return</span>&nbsp;<span class="ident" id="5476477">Size</span>&nbsp;<span class="op" id="5476482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5476485">func</span>&nbsp;<span class="op" id="5476490">(</span><span class="ident" id="5476491">d</span>&nbsp;<span class="op" id="5476493">*</span><span class="ident" id="5476494">digest</span><span class="op" id="5476500">)</span>&nbsp;<span class="ident" id="5476502">BlockSize</span><span class="op" id="5476511">(</span><span class="op" id="5476512">)</span>&nbsp;<span class="builtintype" id="5476514">int</span>&nbsp;<span class="op" id="5476518">{</span>&nbsp;<span class="keyword" id="5476520">return</span>&nbsp;<span class="num" id="5476527">1</span>&nbsp;<span class="op" id="5476529">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5476532">//&nbsp;Add&nbsp;p&nbsp;to&nbsp;the&nbsp;running&nbsp;checksum&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="5476568">func</span>&nbsp;<span class="ident" id="5476573">update</span><span class="op" id="5476579">(</span><span class="ident" id="5476580">d</span>&nbsp;<span class="ident" id="5476582">digest</span><span class="op" id="5476588">,</span>&nbsp;<span class="ident" id="5476590">p</span>&nbsp;<span class="op" id="5476592">[</span><span class="op" id="5476593">]</span><span class="builtintype" id="5476594">byte</span><span class="op" id="5476598">)</span>&nbsp;<span class="ident" id="5476600">digest</span>&nbsp;<span class="op" id="5476607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476610">s1</span><span class="op" id="5476612">,</span>&nbsp;<span class="ident" id="5476614">s2</span>&nbsp;<span class="op" id="5476617">:=</span>&nbsp;<span class="builtintype" id="5476620">uint32</span><span class="op" id="5476626">(</span><span class="ident" id="5476627">d</span><span class="op" id="5476628">&amp;</span><span class="num" id="5476629">0xffff</span><span class="op" id="5476635">)</span><span class="op" id="5476636">,</span>&nbsp;<span class="builtintype" id="5476638">uint32</span><span class="op" id="5476644">(</span><span class="ident" id="5476645">d</span><span class="op" id="5476646">&gt;&gt;</span><span class="num" id="5476648">16</span><span class="op" id="5476650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476653">for</span>&nbsp;<span class="builtinfunc" id="5476657">len</span><span class="op" id="5476660">(</span><span class="ident" id="5476661">p</span><span class="op" id="5476662">)</span>&nbsp;<span class="op" id="5476664">&gt;</span>&nbsp;<span class="num" id="5476666">0</span>&nbsp;<span class="op" id="5476668">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476672">var</span>&nbsp;<span class="ident" id="5476676">q</span>&nbsp;<span class="op" id="5476678">[</span><span class="op" id="5476679">]</span><span class="builtintype" id="5476680">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476687">if</span>&nbsp;<span class="builtinfunc" id="5476690">len</span><span class="op" id="5476693">(</span><span class="ident" id="5476694">p</span><span class="op" id="5476695">)</span>&nbsp;<span class="op" id="5476697">&gt;</span>&nbsp;<span class="ident" id="5476699">nmax</span>&nbsp;<span class="op" id="5476704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476709">p</span><span class="op" id="5476710">,</span>&nbsp;<span class="ident" id="5476712">q</span>&nbsp;<span class="op" id="5476714">=</span>&nbsp;<span class="ident" id="5476716">p</span><span class="op" id="5476717">[</span><span class="op" id="5476718">:</span><span class="ident" id="5476719">nmax</span><span class="op" id="5476723">]</span><span class="op" id="5476724">,</span>&nbsp;<span class="ident" id="5476726">p</span><span class="op" id="5476727">[</span><span class="ident" id="5476728">nmax</span><span class="op" id="5476732">:</span><span class="op" id="5476733">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476741">for</span>&nbsp;<span class="ident" id="5476745">_</span><span class="op" id="5476746">,</span>&nbsp;<span class="ident" id="5476748">x</span>&nbsp;<span class="op" id="5476750">:=</span>&nbsp;<span class="keyword" id="5476753">range</span>&nbsp;<span class="ident" id="5476759">p</span>&nbsp;<span class="op" id="5476761">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476766">s1</span>&nbsp;<span class="op" id="5476769">+=</span>&nbsp;<span class="builtintype" id="5476772">uint32</span><span class="op" id="5476778">(</span><span class="ident" id="5476779">x</span><span class="op" id="5476780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476785">s2</span>&nbsp;<span class="op" id="5476788">+=</span>&nbsp;<span class="ident" id="5476791">s1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476800">s1</span>&nbsp;<span class="op" id="5476803">%=</span>&nbsp;<span class="ident" id="5476806">mod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476812">s2</span>&nbsp;<span class="op" id="5476815">%=</span>&nbsp;<span class="ident" id="5476818">mod</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476824">p</span>&nbsp;<span class="op" id="5476826">=</span>&nbsp;<span class="ident" id="5476828">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476834">return</span>&nbsp;<span class="ident" id="5476841">digest</span><span class="op" id="5476847">(</span><span class="ident" id="5476848">s2</span><span class="op" id="5476850">&lt;&lt;</span><span class="num" id="5476852">16</span>&nbsp;<span class="op" id="5476855">|</span>&nbsp;<span class="ident" id="5476857">s1</span><span class="op" id="5476859">)</span><br>
<span class="lineno"></span><span class="op" id="5476861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="5476864">func</span>&nbsp;<span class="op" id="5476869">(</span><span class="ident" id="5476870">d</span>&nbsp;<span class="op" id="5476872">*</span><span class="ident" id="5476873">digest</span><span class="op" id="5476879">)</span>&nbsp;<span class="ident" id="5476881">Write</span><span class="op" id="5476886">(</span><span class="ident" id="5476887">p</span>&nbsp;<span class="op" id="5476889">[</span><span class="op" id="5476890">]</span><span class="builtintype" id="5476891">byte</span><span class="op" id="5476895">)</span>&nbsp;<span class="op" id="5476897">(</span><span class="ident" id="5476898">nn</span>&nbsp;<span class="builtintype" id="5476901">int</span><span class="op" id="5476904">,</span>&nbsp;<span class="ident" id="5476906">err</span>&nbsp;<span class="builtintype" id="5476910">error</span><span class="op" id="5476915">)</span>&nbsp;<span class="op" id="5476917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476920">*</span><span class="ident" id="5476921">d</span>&nbsp;<span class="op" id="5476923">=</span>&nbsp;<span class="ident" id="5476925">update</span><span class="op" id="5476931">(</span><span class="op" id="5476932">*</span><span class="ident" id="5476933">d</span><span class="op" id="5476934">,</span>&nbsp;<span class="ident" id="5476936">p</span><span class="op" id="5476937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476940">return</span>&nbsp;<span class="builtinfunc" id="5476947">len</span><span class="op" id="5476950">(</span><span class="ident" id="5476951">p</span><span class="op" id="5476952">)</span><span class="op" id="5476953">,</span>&nbsp;<span class="ident" id="5476955">nil</span><br>
<span class="lineno"></span><span class="op" id="5476959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="5476962">func</span>&nbsp;<span class="op" id="5476967">(</span><span class="ident" id="5476968">d</span>&nbsp;<span class="op" id="5476970">*</span><span class="ident" id="5476971">digest</span><span class="op" id="5476977">)</span>&nbsp;<span class="ident" id="5476979">Sum32</span><span class="op" id="5476984">(</span><span class="op" id="5476985">)</span>&nbsp;<span class="builtintype" id="5476987">uint32</span>&nbsp;<span class="op" id="5476994">{</span>&nbsp;<span class="keyword" id="5476996">return</span>&nbsp;<span class="builtintype" id="5477003">uint32</span><span class="op" id="5477009">(</span><span class="op" id="5477010">*</span><span class="ident" id="5477011">d</span><span class="op" id="5477012">)</span>&nbsp;<span class="op" id="5477014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5477017">func</span>&nbsp;<span class="op" id="5477022">(</span><span class="ident" id="5477023">d</span>&nbsp;<span class="op" id="5477025">*</span><span class="ident" id="5477026">digest</span><span class="op" id="5477032">)</span>&nbsp;<span class="ident" id="5477034">Sum</span><span class="op" id="5477037">(</span><span class="ident" id="5477038">in</span>&nbsp;<span class="op" id="5477041">[</span><span class="op" id="5477042">]</span><span class="builtintype" id="5477043">byte</span><span class="op" id="5477047">)</span>&nbsp;<span class="op" id="5477049">[</span><span class="op" id="5477050">]</span><span class="builtintype" id="5477051">byte</span>&nbsp;<span class="op" id="5477056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477059">s</span>&nbsp;<span class="op" id="5477061">:=</span>&nbsp;<span class="builtintype" id="5477064">uint32</span><span class="op" id="5477070">(</span><span class="op" id="5477071">*</span><span class="ident" id="5477072">d</span><span class="op" id="5477073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477076">return</span>&nbsp;<span class="builtinfunc" id="5477083">append</span><span class="op" id="5477089">(</span><span class="ident" id="5477090">in</span><span class="op" id="5477092">,</span>&nbsp;<span class="builtintype" id="5477094">byte</span><span class="op" id="5477098">(</span><span class="ident" id="5477099">s</span><span class="op" id="5477100">&gt;&gt;</span><span class="num" id="5477102">24</span><span class="op" id="5477104">)</span><span class="op" id="5477105">,</span>&nbsp;<span class="builtintype" id="5477107">byte</span><span class="op" id="5477111">(</span><span class="ident" id="5477112">s</span><span class="op" id="5477113">&gt;&gt;</span><span class="num" id="5477115">16</span><span class="op" id="5477117">)</span><span class="op" id="5477118">,</span>&nbsp;<span class="builtintype" id="5477120">byte</span><span class="op" id="5477124">(</span><span class="ident" id="5477125">s</span><span class="op" id="5477126">&gt;&gt;</span><span class="num" id="5477128">8</span><span class="op" id="5477129">)</span><span class="op" id="5477130">,</span>&nbsp;<span class="builtintype" id="5477132">byte</span><span class="op" id="5477136">(</span><span class="ident" id="5477137">s</span><span class="op" id="5477138">)</span><span class="op" id="5477139">)</span><br>
<span class="lineno">75</span><span class="op" id="5477141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5477144">//&nbsp;Checksum&nbsp;returns&nbsp;the&nbsp;Adler-32&nbsp;checksum&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5477195">func</span>&nbsp;<span class="ident" id="5477200">Checksum</span><span class="op" id="5477208">(</span><span class="ident" id="5477209">data</span>&nbsp;<span class="op" id="5477214">[</span><span class="op" id="5477215">]</span><span class="builtintype" id="5477216">byte</span><span class="op" id="5477220">)</span>&nbsp;<span class="builtintype" id="5477222">uint32</span>&nbsp;<span class="op" id="5477229">{</span>&nbsp;<span class="keyword" id="5477231">return</span>&nbsp;<span class="builtintype" id="5477238">uint32</span><span class="op" id="5477244">(</span><span class="ident" id="5477245">update</span><span class="op" id="5477251">(</span><span class="num" id="5477252">1</span><span class="op" id="5477253">,</span>&nbsp;<span class="ident" id="5477255">data</span><span class="op" id="5477259">)</span><span class="op" id="5477260">)</span>&nbsp;<span class="op" id="5477262">}</span>
</div>
</body>
</html>
