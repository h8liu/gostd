<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html" class="current">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2608596">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2608652">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2608706">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2608757">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2608822">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2608850">package</span>&nbsp;<span class="ident" id="2608858">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2608867">import</span>&nbsp;<span class="string" id="2608874">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2608884">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;raw&nbsp;sockaddr&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2608947">func</span>&nbsp;<span class="ident" id="2608952">cmsgAlignOf</span><span class="op" id="2608963">(</span><span class="ident" id="2608964">salen</span>&nbsp;<span class="builtintype" id="2608970">int</span><span class="op" id="2608973">)</span>&nbsp;<span class="builtintype" id="2608975">int</span>&nbsp;<span class="op" id="2608979">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2608982">salign</span>&nbsp;<span class="op" id="2608989">:=</span>&nbsp;<span class="ident" id="2608992">sizeofPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2609003">//&nbsp;NOTE:&nbsp;It&nbsp;seems&nbsp;like&nbsp;64-bit&nbsp;Darwin&nbsp;and&nbsp;DragonFly&nbsp;BSD&nbsp;kernels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2609067">//&nbsp;still&nbsp;require&nbsp;32-bit&nbsp;aligned&nbsp;access&nbsp;to&nbsp;network&nbsp;subsystem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2609129">if</span>&nbsp;<span class="ident" id="2609132">darwin64Bit</span>&nbsp;<span class="op" id="2609144">||</span>&nbsp;<span class="ident" id="2609147">dragonfly64Bit</span>&nbsp;<span class="op" id="2609162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2609166">salign</span>&nbsp;<span class="op" id="2609173">=</span>&nbsp;<span class="num" id="2609175">4</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2609178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2609181">return</span>&nbsp;<span class="op" id="2609188">(</span><span class="ident" id="2609189">salen</span>&nbsp;<span class="op" id="2609195">+</span>&nbsp;<span class="ident" id="2609197">salign</span>&nbsp;<span class="op" id="2609204">-</span>&nbsp;<span class="num" id="2609206">1</span><span class="op" id="2609207">)</span>&nbsp;<span class="op" id="2609209">&amp;</span>&nbsp;<span class="op" id="2609211">^</span><span class="op" id="2609212">(</span><span class="ident" id="2609213">salign</span>&nbsp;<span class="op" id="2609220">-</span>&nbsp;<span class="num" id="2609222">1</span><span class="op" id="2609223">)</span><br>
<span class="lineno"></span><span class="op" id="2609225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2609228">//&nbsp;CmsgLen&nbsp;returns&nbsp;the&nbsp;value&nbsp;to&nbsp;store&nbsp;in&nbsp;the&nbsp;Len&nbsp;field&nbsp;of&nbsp;the&nbsp;Cmsghdr</span><br>
<span class="lineno">25</span><span class="comment" id="2609298">//&nbsp;structure,&nbsp;taking&nbsp;into&nbsp;account&nbsp;any&nbsp;necessary&nbsp;alignment.</span><br>
<span class="lineno"></span><span class="keyword" id="2609357">func</span>&nbsp;<span class="ident" id="2609362">CmsgLen</span><span class="op" id="2609369">(</span><span class="ident" id="2609370">datalen</span>&nbsp;<span class="builtintype" id="2609378">int</span><span class="op" id="2609381">)</span>&nbsp;<span class="builtintype" id="2609383">int</span>&nbsp;<span class="op" id="2609387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2609390">return</span>&nbsp;<span class="ident" id="2609397">cmsgAlignOf</span><span class="op" id="2609408">(</span><span class="ident" id="2609409">SizeofCmsghdr</span><span class="op" id="2609422">)</span>&nbsp;<span class="op" id="2609424">+</span>&nbsp;<span class="ident" id="2609426">datalen</span><br>
<span class="lineno"></span><span class="op" id="2609434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2609437">//&nbsp;CmsgSpace&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;an&nbsp;ancillary&nbsp;element&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="2609504">//&nbsp;payload&nbsp;of&nbsp;the&nbsp;passed&nbsp;data&nbsp;length&nbsp;occupies.</span><br>
<span class="lineno"></span><span class="keyword" id="2609551">func</span>&nbsp;<span class="ident" id="2609556">CmsgSpace</span><span class="op" id="2609565">(</span><span class="ident" id="2609566">datalen</span>&nbsp;<span class="builtintype" id="2609574">int</span><span class="op" id="2609577">)</span>&nbsp;<span class="builtintype" id="2609579">int</span>&nbsp;<span class="op" id="2609583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2609586">return</span>&nbsp;<span class="ident" id="2609593">cmsgAlignOf</span><span class="op" id="2609604">(</span><span class="ident" id="2609605">SizeofCmsghdr</span><span class="op" id="2609618">)</span>&nbsp;<span class="op" id="2609620">+</span>&nbsp;<span class="ident" id="2609622">cmsgAlignOf</span><span class="op" id="2609633">(</span><span class="ident" id="2609634">datalen</span><span class="op" id="2609641">)</span><br>
<span class="lineno"></span><span class="op" id="2609643">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2609646">func</span>&nbsp;<span class="ident" id="2609651">cmsgData</span><span class="op" id="2609659">(</span><span class="ident" id="2609660">h</span>&nbsp;<span class="op" id="2609662">*</span><span class="ident" id="2609663">Cmsghdr</span><span class="op" id="2609670">)</span>&nbsp;<span class="ident" id="2609672">unsafe</span><span class="op" id="2609678">.</span><span class="ident" id="2609679">Pointer</span>&nbsp;<span class="op" id="2609687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2609690">return</span>&nbsp;<span class="ident" id="2609697">unsafe</span><span class="op" id="2609703">.</span><span class="ident" id="2609704">Pointer</span><span class="op" id="2609711">(</span><span class="builtintype" id="2609712">uintptr</span><span class="op" id="2609719">(</span><span class="ident" id="2609720">unsafe</span><span class="op" id="2609726">.</span><span class="ident" id="2609727">Pointer</span><span class="op" id="2609734">(</span><span class="ident" id="2609735">h</span><span class="op" id="2609736">)</span><span class="op" id="2609737">)</span>&nbsp;<span class="op" id="2609739">+</span>&nbsp;<span class="builtintype" id="2609741">uintptr</span><span class="op" id="2609748">(</span><span class="ident" id="2609749">cmsgAlignOf</span><span class="op" id="2609760">(</span><span class="ident" id="2609761">SizeofCmsghdr</span><span class="op" id="2609774">)</span><span class="op" id="2609775">)</span><span class="op" id="2609776">)</span><br>
<span class="lineno"></span><span class="op" id="2609778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2609781">//&nbsp;SocketControlMessage&nbsp;represents&nbsp;a&nbsp;socket&nbsp;control&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2609842">type</span>&nbsp;<span class="ident" id="2609847">SocketControlMessage</span>&nbsp;<span class="keyword" id="2609868">struct</span>&nbsp;<span class="op" id="2609875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2609878">Header</span>&nbsp;<span class="ident" id="2609885">Cmsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2609894">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2609901">[</span><span class="op" id="2609902">]</span><span class="builtintype" id="2609903">byte</span><br>
<span class="lineno"></span><span class="op" id="2609908">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2609911">//&nbsp;ParseSocketControlMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;socket&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="2609979">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="2609992">func</span>&nbsp;<span class="ident" id="2609997">ParseSocketControlMessage</span><span class="op" id="2610022">(</span><span class="ident" id="2610023">b</span>&nbsp;<span class="op" id="2610025">[</span><span class="op" id="2610026">]</span><span class="builtintype" id="2610027">byte</span><span class="op" id="2610031">)</span>&nbsp;<span class="op" id="2610033">(</span><span class="op" id="2610034">[</span><span class="op" id="2610035">]</span><span class="ident" id="2610036">SocketControlMessage</span><span class="op" id="2610056">,</span>&nbsp;<span class="builtintype" id="2610058">error</span><span class="op" id="2610063">)</span>&nbsp;<span class="op" id="2610065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2610068">var</span>&nbsp;<span class="ident" id="2610072">msgs</span>&nbsp;<span class="op" id="2610077">[</span><span class="op" id="2610078">]</span><span class="ident" id="2610079">SocketControlMessage</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2610101">i</span>&nbsp;<span class="op" id="2610103">:=</span>&nbsp;<span class="num" id="2610106">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2610109">for</span>&nbsp;<span class="ident" id="2610113">i</span><span class="op" id="2610114">+</span><span class="ident" id="2610115">CmsgLen</span><span class="op" id="2610122">(</span><span class="num" id="2610123">0</span><span class="op" id="2610124">)</span>&nbsp;<span class="op" id="2610126">&lt;=</span>&nbsp;<span class="builtinfunc" id="2610129">len</span><span class="op" id="2610132">(</span><span class="ident" id="2610133">b</span><span class="op" id="2610134">)</span>&nbsp;<span class="op" id="2610136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2610140">h</span><span class="op" id="2610141">,</span>&nbsp;<span class="ident" id="2610143">dbuf</span><span class="op" id="2610147">,</span>&nbsp;<span class="ident" id="2610149">err</span>&nbsp;<span class="op" id="2610153">:=</span>&nbsp;<span class="ident" id="2610156">socketControlMessageHeaderAndData</span><span class="op" id="2610189">(</span><span class="ident" id="2610190">b</span><span class="op" id="2610191">[</span><span class="ident" id="2610192">i</span><span class="op" id="2610193">:</span><span class="op" id="2610194">]</span><span class="op" id="2610195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2610199">if</span>&nbsp;<span class="ident" id="2610202">err</span>&nbsp;<span class="op" id="2610206">!=</span>&nbsp;<span class="ident" id="2610209">nil</span>&nbsp;<span class="op" id="2610213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2610218">return</span>&nbsp;<span class="ident" id="2610225">nil</span><span class="op" id="2610228">,</span>&nbsp;<span class="ident" id="2610230">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2610236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2610240">m</span>&nbsp;<span class="op" id="2610242">:=</span>&nbsp;<span class="ident" id="2610245">SocketControlMessage</span><span class="op" id="2610265">{</span><span class="ident" id="2610266">Header</span><span class="op" id="2610272">:</span>&nbsp;<span class="op" id="2610274">*</span><span class="ident" id="2610275">h</span><span class="op" id="2610276">,</span>&nbsp;<span class="ident" id="2610278">Data</span><span class="op" id="2610282">:</span>&nbsp;<span class="ident" id="2610284">dbuf</span><span class="op" id="2610288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2610292">msgs</span>&nbsp;<span class="op" id="2610297">=</span>&nbsp;<span class="builtinfunc" id="2610299">append</span><span class="op" id="2610305">(</span><span class="ident" id="2610306">msgs</span><span class="op" id="2610310">,</span>&nbsp;<span class="ident" id="2610312">m</span><span class="op" id="2610313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2610317">i</span>&nbsp;<span class="op" id="2610319">+=</span>&nbsp;<span class="ident" id="2610322">cmsgAlignOf</span><span class="op" id="2610333">(</span><span class="builtintype" id="2610334">int</span><span class="op" id="2610337">(</span><span class="ident" id="2610338">h</span><span class="op" id="2610339">.</span><span class="ident" id="2610340">Len</span><span class="op" id="2610343">)</span><span class="op" id="2610344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2610347">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2610350">return</span>&nbsp;<span class="ident" id="2610357">msgs</span><span class="op" id="2610361">,</span>&nbsp;<span class="ident" id="2610363">nil</span><br>
<span class="lineno"></span><span class="op" id="2610367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2610370">func</span>&nbsp;<span class="ident" id="2610375">socketControlMessageHeaderAndData</span><span class="op" id="2610408">(</span><span class="ident" id="2610409">b</span>&nbsp;<span class="op" id="2610411">[</span><span class="op" id="2610412">]</span><span class="builtintype" id="2610413">byte</span><span class="op" id="2610417">)</span>&nbsp;<span class="op" id="2610419">(</span><span class="op" id="2610420">*</span><span class="ident" id="2610421">Cmsghdr</span><span class="op" id="2610428">,</span>&nbsp;<span class="op" id="2610430">[</span><span class="op" id="2610431">]</span><span class="builtintype" id="2610432">byte</span><span class="op" id="2610436">,</span>&nbsp;<span class="builtintype" id="2610438">error</span><span class="op" id="2610443">)</span>&nbsp;<span class="op" id="2610445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2610448">h</span>&nbsp;<span class="op" id="2610450">:=</span>&nbsp;<span class="op" id="2610453">(</span><span class="op" id="2610454">*</span><span class="ident" id="2610455">Cmsghdr</span><span class="op" id="2610462">)</span><span class="op" id="2610463">(</span><span class="ident" id="2610464">unsafe</span><span class="op" id="2610470">.</span><span class="ident" id="2610471">Pointer</span><span class="op" id="2610478">(</span><span class="op" id="2610479">&amp;</span><span class="ident" id="2610480">b</span><span class="op" id="2610481">[</span><span class="num" id="2610482">0</span><span class="op" id="2610483">]</span><span class="op" id="2610484">)</span><span class="op" id="2610485">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2610488">if</span>&nbsp;<span class="ident" id="2610491">h</span><span class="op" id="2610492">.</span><span class="ident" id="2610493">Len</span>&nbsp;<span class="op" id="2610497">&lt;</span>&nbsp;<span class="ident" id="2610499">SizeofCmsghdr</span>&nbsp;<span class="op" id="2610513">||</span>&nbsp;<span class="builtintype" id="2610516">int</span><span class="op" id="2610519">(</span><span class="ident" id="2610520">h</span><span class="op" id="2610521">.</span><span class="ident" id="2610522">Len</span><span class="op" id="2610525">)</span>&nbsp;<span class="op" id="2610527">&gt;</span>&nbsp;<span class="builtinfunc" id="2610529">len</span><span class="op" id="2610532">(</span><span class="ident" id="2610533">b</span><span class="op" id="2610534">)</span>&nbsp;<span class="op" id="2610536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2610540">return</span>&nbsp;<span class="ident" id="2610547">nil</span><span class="op" id="2610550">,</span>&nbsp;<span class="ident" id="2610552">nil</span><span class="op" id="2610555">,</span>&nbsp;<span class="ident" id="2610557">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2610565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2610568">return</span>&nbsp;<span class="ident" id="2610575">h</span><span class="op" id="2610576">,</span>&nbsp;<span class="ident" id="2610578">b</span><span class="op" id="2610579">[</span><span class="ident" id="2610580">cmsgAlignOf</span><span class="op" id="2610591">(</span><span class="ident" id="2610592">SizeofCmsghdr</span><span class="op" id="2610605">)</span><span class="op" id="2610606">:</span><span class="ident" id="2610607">h</span><span class="op" id="2610608">.</span><span class="ident" id="2610609">Len</span><span class="op" id="2610612">]</span><span class="op" id="2610613">,</span>&nbsp;<span class="ident" id="2610615">nil</span><br>
<span class="lineno"></span><span class="op" id="2610619">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="2610622">//&nbsp;UnixRights&nbsp;encodes&nbsp;a&nbsp;set&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;into&nbsp;a&nbsp;socket</span><br>
<span class="lineno"></span><span class="comment" id="2610689">//&nbsp;control&nbsp;message&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="2610740">func</span>&nbsp;<span class="ident" id="2610745">UnixRights</span><span class="op" id="2610755">(</span><span class="ident" id="2610756">fds</span>&nbsp;<span class="op" id="2610760">...</span><span class="builtintype" id="2610763">int</span><span class="op" id="2610766">)</span>&nbsp;<span class="op" id="2610768">[</span><span class="op" id="2610769">]</span><span class="builtintype" id="2610770">byte</span>&nbsp;<span class="op" id="2610775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2610778">datalen</span>&nbsp;<span class="op" id="2610786">:=</span>&nbsp;<span class="builtinfunc" id="2610789">len</span><span class="op" id="2610792">(</span><span class="ident" id="2610793">fds</span><span class="op" id="2610796">)</span>&nbsp;<span class="op" id="2610798">*</span>&nbsp;<span class="num" id="2610800">4</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2610803">b</span>&nbsp;<span class="op" id="2610805">:=</span>&nbsp;<span class="builtinfunc" id="2610808">make</span><span class="op" id="2610812">(</span><span class="op" id="2610813">[</span><span class="op" id="2610814">]</span><span class="builtintype" id="2610815">byte</span><span class="op" id="2610819">,</span>&nbsp;<span class="ident" id="2610821">CmsgSpace</span><span class="op" id="2610830">(</span><span class="ident" id="2610831">datalen</span><span class="op" id="2610838">)</span><span class="op" id="2610839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2610842">h</span>&nbsp;<span class="op" id="2610844">:=</span>&nbsp;<span class="op" id="2610847">(</span><span class="op" id="2610848">*</span><span class="ident" id="2610849">Cmsghdr</span><span class="op" id="2610856">)</span><span class="op" id="2610857">(</span><span class="ident" id="2610858">unsafe</span><span class="op" id="2610864">.</span><span class="ident" id="2610865">Pointer</span><span class="op" id="2610872">(</span><span class="op" id="2610873">&amp;</span><span class="ident" id="2610874">b</span><span class="op" id="2610875">[</span><span class="num" id="2610876">0</span><span class="op" id="2610877">]</span><span class="op" id="2610878">)</span><span class="op" id="2610879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2610882">h</span><span class="op" id="2610883">.</span><span class="ident" id="2610884">Level</span>&nbsp;<span class="op" id="2610890">=</span>&nbsp;<span class="ident" id="2610892">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2610904">h</span><span class="op" id="2610905">.</span><span class="ident" id="2610906">Type</span>&nbsp;<span class="op" id="2610911">=</span>&nbsp;<span class="ident" id="2610913">SCM_RIGHTS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2610925">h</span><span class="op" id="2610926">.</span><span class="ident" id="2610927">SetLen</span><span class="op" id="2610933">(</span><span class="ident" id="2610934">CmsgLen</span><span class="op" id="2610941">(</span><span class="ident" id="2610942">datalen</span><span class="op" id="2610949">)</span><span class="op" id="2610950">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2610953">data</span>&nbsp;<span class="op" id="2610958">:=</span>&nbsp;<span class="builtintype" id="2610961">uintptr</span><span class="op" id="2610968">(</span><span class="ident" id="2610969">cmsgData</span><span class="op" id="2610977">(</span><span class="ident" id="2610978">h</span><span class="op" id="2610979">)</span><span class="op" id="2610980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2610983">for</span>&nbsp;<span class="ident" id="2610987">_</span><span class="op" id="2610988">,</span>&nbsp;<span class="ident" id="2610990">fd</span>&nbsp;<span class="op" id="2610993">:=</span>&nbsp;<span class="keyword" id="2610996">range</span>&nbsp;<span class="ident" id="2611002">fds</span>&nbsp;<span class="op" id="2611006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2611010">*</span><span class="op" id="2611011">(</span><span class="op" id="2611012">*</span><span class="builtintype" id="2611013">int32</span><span class="op" id="2611018">)</span><span class="op" id="2611019">(</span><span class="ident" id="2611020">unsafe</span><span class="op" id="2611026">.</span><span class="ident" id="2611027">Pointer</span><span class="op" id="2611034">(</span><span class="ident" id="2611035">data</span><span class="op" id="2611039">)</span><span class="op" id="2611040">)</span>&nbsp;<span class="op" id="2611042">=</span>&nbsp;<span class="builtintype" id="2611044">int32</span><span class="op" id="2611049">(</span><span class="ident" id="2611050">fd</span><span class="op" id="2611052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2611056">data</span>&nbsp;<span class="op" id="2611061">+=</span>&nbsp;<span class="num" id="2611064">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2611067">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2611070">return</span>&nbsp;<span class="ident" id="2611077">b</span><br>
<span class="lineno"></span><span class="op" id="2611079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2611082">//&nbsp;ParseUnixRights&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2611151">//&nbsp;integer&nbsp;array&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;from&nbsp;another&nbsp;process.</span><br>
<span class="lineno">90</span><span class="keyword" id="2611215">func</span>&nbsp;<span class="ident" id="2611220">ParseUnixRights</span><span class="op" id="2611235">(</span><span class="ident" id="2611236">m</span>&nbsp;<span class="op" id="2611238">*</span><span class="ident" id="2611239">SocketControlMessage</span><span class="op" id="2611259">)</span>&nbsp;<span class="op" id="2611261">(</span><span class="op" id="2611262">[</span><span class="op" id="2611263">]</span><span class="builtintype" id="2611264">int</span><span class="op" id="2611267">,</span>&nbsp;<span class="builtintype" id="2611269">error</span><span class="op" id="2611274">)</span>&nbsp;<span class="op" id="2611276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2611279">if</span>&nbsp;<span class="ident" id="2611282">m</span><span class="op" id="2611283">.</span><span class="ident" id="2611284">Header</span><span class="op" id="2611290">.</span><span class="ident" id="2611291">Level</span>&nbsp;<span class="op" id="2611297">!=</span>&nbsp;<span class="ident" id="2611300">SOL_SOCKET</span>&nbsp;<span class="op" id="2611311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2611315">return</span>&nbsp;<span class="ident" id="2611322">nil</span><span class="op" id="2611325">,</span>&nbsp;<span class="ident" id="2611327">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2611335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2611338">if</span>&nbsp;<span class="ident" id="2611341">m</span><span class="op" id="2611342">.</span><span class="ident" id="2611343">Header</span><span class="op" id="2611349">.</span><span class="ident" id="2611350">Type</span>&nbsp;<span class="op" id="2611355">!=</span>&nbsp;<span class="ident" id="2611358">SCM_RIGHTS</span>&nbsp;<span class="op" id="2611369">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2611373">return</span>&nbsp;<span class="ident" id="2611380">nil</span><span class="op" id="2611383">,</span>&nbsp;<span class="ident" id="2611385">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2611393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2611396">fds</span>&nbsp;<span class="op" id="2611400">:=</span>&nbsp;<span class="builtinfunc" id="2611403">make</span><span class="op" id="2611407">(</span><span class="op" id="2611408">[</span><span class="op" id="2611409">]</span><span class="builtintype" id="2611410">int</span><span class="op" id="2611413">,</span>&nbsp;<span class="builtinfunc" id="2611415">len</span><span class="op" id="2611418">(</span><span class="ident" id="2611419">m</span><span class="op" id="2611420">.</span><span class="ident" id="2611421">Data</span><span class="op" id="2611425">)</span><span class="op" id="2611426">&gt;&gt;</span><span class="num" id="2611428">2</span><span class="op" id="2611429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2611432">for</span>&nbsp;<span class="ident" id="2611436">i</span><span class="op" id="2611437">,</span>&nbsp;<span class="ident" id="2611439">j</span>&nbsp;<span class="op" id="2611441">:=</span>&nbsp;<span class="num" id="2611444">0</span><span class="op" id="2611445">,</span>&nbsp;<span class="num" id="2611447">0</span><span class="op" id="2611448">;</span>&nbsp;<span class="ident" id="2611450">i</span>&nbsp;<span class="op" id="2611452">&lt;</span>&nbsp;<span class="builtinfunc" id="2611454">len</span><span class="op" id="2611457">(</span><span class="ident" id="2611458">m</span><span class="op" id="2611459">.</span><span class="ident" id="2611460">Data</span><span class="op" id="2611464">)</span><span class="op" id="2611465">;</span>&nbsp;<span class="ident" id="2611467">i</span>&nbsp;<span class="op" id="2611469">+=</span>&nbsp;<span class="num" id="2611472">4</span>&nbsp;<span class="op" id="2611474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2611478">fds</span><span class="op" id="2611481">[</span><span class="ident" id="2611482">j</span><span class="op" id="2611483">]</span>&nbsp;<span class="op" id="2611485">=</span>&nbsp;<span class="builtintype" id="2611487">int</span><span class="op" id="2611490">(</span><span class="op" id="2611491">*</span><span class="op" id="2611492">(</span><span class="op" id="2611493">*</span><span class="builtintype" id="2611494">int32</span><span class="op" id="2611499">)</span><span class="op" id="2611500">(</span><span class="ident" id="2611501">unsafe</span><span class="op" id="2611507">.</span><span class="ident" id="2611508">Pointer</span><span class="op" id="2611515">(</span><span class="op" id="2611516">&amp;</span><span class="ident" id="2611517">m</span><span class="op" id="2611518">.</span><span class="ident" id="2611519">Data</span><span class="op" id="2611523">[</span><span class="ident" id="2611524">i</span><span class="op" id="2611525">]</span><span class="op" id="2611526">)</span><span class="op" id="2611527">)</span><span class="op" id="2611528">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2611532">j</span><span class="op" id="2611533">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2611537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2611540">return</span>&nbsp;<span class="ident" id="2611547">fds</span><span class="op" id="2611550">,</span>&nbsp;<span class="ident" id="2611552">nil</span><br>
<span class="lineno"></span><span class="op" id="2611556">}</span>
</div>
</body>
</html>
