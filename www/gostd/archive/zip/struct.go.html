<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5899041">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5899096">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5899150">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5899201">/*<br>
<span class="lineno"></span>Package&nbsp;zip&nbsp;provides&nbsp;support&nbsp;for&nbsp;reading&nbsp;and&nbsp;writing&nbsp;ZIP&nbsp;archives.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>See:&nbsp;http://www.pkware.com/documents/casestudies/APPNOTE.TXT<br>
<span class="lineno"></span><br>
<span class="lineno">10</span>This&nbsp;package&nbsp;does&nbsp;not&nbsp;support&nbsp;disk&nbsp;spanning.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>A&nbsp;note&nbsp;about&nbsp;ZIP64:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>To&nbsp;be&nbsp;backwards&nbsp;compatible&nbsp;the&nbsp;FileHeader&nbsp;has&nbsp;both&nbsp;32&nbsp;and&nbsp;64&nbsp;bit&nbsp;Size<br>
<span class="lineno">15</span>fields.&nbsp;The&nbsp;64&nbsp;bit&nbsp;fields&nbsp;will&nbsp;always&nbsp;contain&nbsp;the&nbsp;correct&nbsp;value&nbsp;and<br>
<span class="lineno"></span>for&nbsp;normal&nbsp;archives&nbsp;both&nbsp;fields&nbsp;will&nbsp;be&nbsp;the&nbsp;same.&nbsp;For&nbsp;files&nbsp;requiring<br>
<span class="lineno"></span>the&nbsp;ZIP64&nbsp;format&nbsp;the&nbsp;32&nbsp;bit&nbsp;fields&nbsp;will&nbsp;be&nbsp;0xffffffff&nbsp;and&nbsp;the&nbsp;64&nbsp;bit<br>
<span class="lineno"></span>fields&nbsp;must&nbsp;be&nbsp;used&nbsp;instead.<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno">20</span><span class="keyword" id="5899710">package</span>&nbsp;<span class="ident" id="5899718">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5899723">import</span>&nbsp;<span class="op" id="5899730">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5899733">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5899739">&#34;path&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5899747">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5899754">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5899757">//&nbsp;Compression&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="5899781">const</span>&nbsp;<span class="op" id="5899787">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899790">Store</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5899798">uint16</span>&nbsp;<span class="op" id="5899805">=</span>&nbsp;<span class="num" id="5899807">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899810">Deflate</span>&nbsp;<span class="builtintype" id="5899818">uint16</span>&nbsp;<span class="op" id="5899825">=</span>&nbsp;<span class="num" id="5899827">8</span><br>
<span class="lineno"></span><span class="op" id="5899829">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5899832">const</span>&nbsp;<span class="op" id="5899838">(</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899841">fileHeaderSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5899866">=</span>&nbsp;<span class="num" id="5899868">0x04034b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899880">directoryHeaderSignature</span>&nbsp;<span class="op" id="5899905">=</span>&nbsp;<span class="num" id="5899907">0x02014b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899919">directoryEndSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5899944">=</span>&nbsp;<span class="num" id="5899946">0x06054b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899958">directory64LocSignature</span>&nbsp;&nbsp;<span class="op" id="5899983">=</span>&nbsp;<span class="num" id="5899985">0x07064b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5899997">directory64EndSignature</span>&nbsp;&nbsp;<span class="op" id="5900022">=</span>&nbsp;<span class="num" id="5900024">0x06064b50</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900036">dataDescriptorSignature</span>&nbsp;&nbsp;<span class="op" id="5900061">=</span>&nbsp;<span class="num" id="5900063">0x08074b50</span>&nbsp;<span class="comment" id="5900074">//&nbsp;de-facto&nbsp;standard;&nbsp;required&nbsp;by&nbsp;OS&nbsp;X&nbsp;Finder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900121">fileHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900146">=</span>&nbsp;<span class="num" id="5900148">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900159">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900182">directoryHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900207">=</span>&nbsp;<span class="num" id="5900209">46</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900220">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900253">directoryEndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900278">=</span>&nbsp;<span class="num" id="5900280">22</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900291">//&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900305">dataDescriptorLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900330">=</span>&nbsp;<span class="num" id="5900332">16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900343">//&nbsp;four&nbsp;uint32:&nbsp;descriptor&nbsp;signature,&nbsp;crc32,&nbsp;compressed&nbsp;size,&nbsp;size</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900411">dataDescriptor64Len</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900436">=</span>&nbsp;<span class="num" id="5900438">24</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900449">//&nbsp;descriptor&nbsp;with&nbsp;8&nbsp;byte&nbsp;sizes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900482">directory64LocLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900507">=</span>&nbsp;<span class="num" id="5900509">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900520">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900524">directory64EndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900549">=</span>&nbsp;<span class="num" id="5900551">56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5900562">//&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5900575">//&nbsp;Constants&nbsp;for&nbsp;the&nbsp;first&nbsp;byte&nbsp;in&nbsp;CreatorVersion</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900626">creatorFAT</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5900640">=</span>&nbsp;<span class="num" id="5900642">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900645">creatorUnix</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5900659">=</span>&nbsp;<span class="num" id="5900661">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900664">creatorNTFS</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5900678">=</span>&nbsp;<span class="num" id="5900680">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900684">creatorVFAT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5900698">=</span>&nbsp;<span class="num" id="5900700">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900704">creatorMacOSX</span>&nbsp;<span class="op" id="5900718">=</span>&nbsp;<span class="num" id="5900720">19</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5900725">//&nbsp;version&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900745">zipVersion20</span>&nbsp;<span class="op" id="5900758">=</span>&nbsp;<span class="num" id="5900760">20</span>&nbsp;<span class="comment" id="5900763">//&nbsp;2.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900771">zipVersion45</span>&nbsp;<span class="op" id="5900784">=</span>&nbsp;<span class="num" id="5900786">45</span>&nbsp;<span class="comment" id="5900789">//&nbsp;4.5&nbsp;(reads&nbsp;and&nbsp;writes&nbsp;zip64&nbsp;archives)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5900832">//&nbsp;limits&nbsp;for&nbsp;non&nbsp;zip64&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900863">uint16max</span>&nbsp;<span class="op" id="5900873">=</span>&nbsp;<span class="op" id="5900875">(</span><span class="num" id="5900876">1</span>&nbsp;<span class="op" id="5900878">&lt;&lt;</span>&nbsp;<span class="num" id="5900881">16</span><span class="op" id="5900883">)</span>&nbsp;<span class="op" id="5900885">-</span>&nbsp;<span class="num" id="5900887">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900890">uint32max</span>&nbsp;<span class="op" id="5900900">=</span>&nbsp;<span class="op" id="5900902">(</span><span class="num" id="5900903">1</span>&nbsp;<span class="op" id="5900905">&lt;&lt;</span>&nbsp;<span class="num" id="5900908">32</span><span class="op" id="5900910">)</span>&nbsp;<span class="op" id="5900912">-</span>&nbsp;<span class="num" id="5900914">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5900918">//&nbsp;extra&nbsp;header&nbsp;id&#39;s</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5900940">zip64ExtraId</span>&nbsp;<span class="op" id="5900953">=</span>&nbsp;<span class="num" id="5900955">0x0001</span>&nbsp;<span class="comment" id="5900962">//&nbsp;zip64&nbsp;Extended&nbsp;Information&nbsp;Extra&nbsp;Field</span><br>
<span class="lineno"></span><span class="op" id="5901004">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5901007">//&nbsp;FileHeader&nbsp;describes&nbsp;a&nbsp;file&nbsp;within&nbsp;a&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5901057">//&nbsp;See&nbsp;the&nbsp;zip&nbsp;spec&nbsp;for&nbsp;details.</span><br>
<span class="lineno">70</span><span class="keyword" id="5901090">type</span>&nbsp;<span class="ident" id="5901095">FileHeader</span>&nbsp;<span class="keyword" id="5901106">struct</span>&nbsp;<span class="op" id="5901113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5901116">//&nbsp;Name&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5901150">//&nbsp;It&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5901213">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5901277">//&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901294">Name</span>&nbsp;<span class="builtintype" id="5901299">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901308">CreatorVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5901327">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901335">ReaderVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5901354">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901362">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5901381">uint16</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901389">Method</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5901408">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901416">ModifiedTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5901435">uint16</span>&nbsp;<span class="comment" id="5901442">//&nbsp;MS-DOS&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901458">ModifiedDate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5901477">uint16</span>&nbsp;<span class="comment" id="5901484">//&nbsp;MS-DOS&nbsp;date</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901500">CRC32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5901519">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901527">CompressedSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5901546">uint32</span>&nbsp;<span class="comment" id="5901553">//&nbsp;deprecated;&nbsp;use&nbsp;CompressedSize64</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901590">UncompressedSize</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5901609">uint32</span>&nbsp;<span class="comment" id="5901616">//&nbsp;deprecated;&nbsp;use&nbsp;UncompressedSize64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901655">CompressedSize64</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5901674">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901682">UncompressedSize64</span>&nbsp;<span class="ident" id="5901701">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901709">Extra</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5901728">[</span><span class="op" id="5901729">]</span><span class="builtintype" id="5901730">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901736">ExternalAttrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5901755">uint32</span>&nbsp;<span class="comment" id="5901762">//&nbsp;Meaning&nbsp;depends&nbsp;on&nbsp;CreatorVersion</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5901800">Comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5901819">string</span><br>
<span class="lineno"></span><span class="op" id="5901826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5901829">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="5901884">func</span>&nbsp;<span class="op" id="5901889">(</span><span class="ident" id="5901890">h</span>&nbsp;<span class="op" id="5901892">*</span><span class="ident" id="5901893">FileHeader</span><span class="op" id="5901903">)</span>&nbsp;<span class="ident" id="5901905">FileInfo</span><span class="op" id="5901913">(</span><span class="op" id="5901914">)</span>&nbsp;<span class="ident" id="5901916">os</span><span class="op" id="5901918">.</span><span class="ident" id="5901919">FileInfo</span>&nbsp;<span class="op" id="5901928">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5901931">return</span>&nbsp;<span class="ident" id="5901938">headerFileInfo</span><span class="op" id="5901952">{</span><span class="ident" id="5901953">h</span><span class="op" id="5901954">}</span><br>
<span class="lineno"></span><span class="op" id="5901956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5901959">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="5902001">type</span>&nbsp;<span class="ident" id="5902006">headerFileInfo</span>&nbsp;<span class="keyword" id="5902021">struct</span>&nbsp;<span class="op" id="5902028">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902031">fh</span>&nbsp;<span class="op" id="5902034">*</span><span class="ident" id="5902035">FileHeader</span><br>
<span class="lineno"></span><span class="op" id="5902046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5902049">func</span>&nbsp;<span class="op" id="5902054">(</span><span class="ident" id="5902055">fi</span>&nbsp;<span class="ident" id="5902058">headerFileInfo</span><span class="op" id="5902072">)</span>&nbsp;<span class="ident" id="5902074">Name</span><span class="op" id="5902078">(</span><span class="op" id="5902079">)</span>&nbsp;<span class="builtintype" id="5902081">string</span>&nbsp;<span class="op" id="5902088">{</span>&nbsp;<span class="keyword" id="5902090">return</span>&nbsp;<span class="ident" id="5902097">path</span><span class="op" id="5902101">.</span><span class="ident" id="5902102">Base</span><span class="op" id="5902106">(</span><span class="ident" id="5902107">fi</span><span class="op" id="5902109">.</span><span class="ident" id="5902110">fh</span><span class="op" id="5902112">.</span><span class="ident" id="5902113">Name</span><span class="op" id="5902117">)</span>&nbsp;<span class="op" id="5902119">}</span><br>
<span class="lineno"></span><span class="keyword" id="5902121">func</span>&nbsp;<span class="op" id="5902126">(</span><span class="ident" id="5902127">fi</span>&nbsp;<span class="ident" id="5902130">headerFileInfo</span><span class="op" id="5902144">)</span>&nbsp;<span class="ident" id="5902146">Size</span><span class="op" id="5902150">(</span><span class="op" id="5902151">)</span>&nbsp;<span class="ident" id="5902153">int64</span>&nbsp;<span class="op" id="5902159">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902162">if</span>&nbsp;<span class="ident" id="5902165">fi</span><span class="op" id="5902167">.</span><span class="ident" id="5902168">fh</span><span class="op" id="5902170">.</span><span class="ident" id="5902171">UncompressedSize64</span>&nbsp;<span class="op" id="5902190">&gt;</span>&nbsp;<span class="num" id="5902192">0</span>&nbsp;<span class="op" id="5902194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902198">return</span>&nbsp;<span class="ident" id="5902205">int64</span><span class="op" id="5902210">(</span><span class="ident" id="5902211">fi</span><span class="op" id="5902213">.</span><span class="ident" id="5902214">fh</span><span class="op" id="5902216">.</span><span class="ident" id="5902217">UncompressedSize64</span><span class="op" id="5902235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5902238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5902241">return</span>&nbsp;<span class="ident" id="5902248">int64</span><span class="op" id="5902253">(</span><span class="ident" id="5902254">fi</span><span class="op" id="5902256">.</span><span class="ident" id="5902257">fh</span><span class="op" id="5902259">.</span><span class="ident" id="5902260">UncompressedSize</span><span class="op" id="5902276">)</span><br>
<span class="lineno"></span><span class="op" id="5902278">}</span><br>
<span class="lineno">110</span><span class="keyword" id="5902280">func</span>&nbsp;<span class="op" id="5902285">(</span><span class="ident" id="5902286">fi</span>&nbsp;<span class="ident" id="5902289">headerFileInfo</span><span class="op" id="5902303">)</span>&nbsp;<span class="ident" id="5902305">IsDir</span><span class="op" id="5902310">(</span><span class="op" id="5902311">)</span>&nbsp;<span class="builtintype" id="5902313">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5902325">{</span>&nbsp;<span class="keyword" id="5902327">return</span>&nbsp;<span class="ident" id="5902334">fi</span><span class="op" id="5902336">.</span><span class="ident" id="5902337">Mode</span><span class="op" id="5902341">(</span><span class="op" id="5902342">)</span><span class="op" id="5902343">.</span><span class="ident" id="5902344">IsDir</span><span class="op" id="5902349">(</span><span class="op" id="5902350">)</span>&nbsp;<span class="op" id="5902352">}</span><br>
<span class="lineno"></span><span class="keyword" id="5902354">func</span>&nbsp;<span class="op" id="5902359">(</span><span class="ident" id="5902360">fi</span>&nbsp;<span class="ident" id="5902363">headerFileInfo</span><span class="op" id="5902377">)</span>&nbsp;<span class="ident" id="5902379">ModTime</span><span class="op" id="5902386">(</span><span class="op" id="5902387">)</span>&nbsp;<span class="ident" id="5902389">time</span><span class="op" id="5902393">.</span><span class="ident" id="5902394">Time</span>&nbsp;<span class="op" id="5902399">{</span>&nbsp;<span class="keyword" id="5902401">return</span>&nbsp;<span class="ident" id="5902408">fi</span><span class="op" id="5902410">.</span><span class="ident" id="5902411">fh</span><span class="op" id="5902413">.</span><span class="ident" id="5902414">ModTime</span><span class="op" id="5902421">(</span><span class="op" id="5902422">)</span>&nbsp;<span class="op" id="5902424">}</span><br>
<span class="lineno"></span><span class="keyword" id="5902426">func</span>&nbsp;<span class="op" id="5902431">(</span><span class="ident" id="5902432">fi</span>&nbsp;<span class="ident" id="5902435">headerFileInfo</span><span class="op" id="5902449">)</span>&nbsp;<span class="ident" id="5902451">Mode</span><span class="op" id="5902455">(</span><span class="op" id="5902456">)</span>&nbsp;<span class="ident" id="5902458">os</span><span class="op" id="5902460">.</span><span class="ident" id="5902461">FileMode</span>&nbsp;&nbsp;<span class="op" id="5902471">{</span>&nbsp;<span class="keyword" id="5902473">return</span>&nbsp;<span class="ident" id="5902480">fi</span><span class="op" id="5902482">.</span><span class="ident" id="5902483">fh</span><span class="op" id="5902485">.</span><span class="ident" id="5902486">Mode</span><span class="op" id="5902490">(</span><span class="op" id="5902491">)</span>&nbsp;<span class="op" id="5902493">}</span><br>
<span class="lineno"></span><span class="keyword" id="5902495">func</span>&nbsp;<span class="op" id="5902500">(</span><span class="ident" id="5902501">fi</span>&nbsp;<span class="ident" id="5902504">headerFileInfo</span><span class="op" id="5902518">)</span>&nbsp;<span class="ident" id="5902520">Sys</span><span class="op" id="5902523">(</span><span class="op" id="5902524">)</span>&nbsp;<span class="keyword" id="5902526">interface</span><span class="op" id="5902535">{</span><span class="op" id="5902536">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5902540">{</span>&nbsp;<span class="keyword" id="5902542">return</span>&nbsp;<span class="ident" id="5902549">fi</span><span class="op" id="5902551">.</span><span class="ident" id="5902552">fh</span>&nbsp;<span class="op" id="5902555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5902558">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;FileHeader&nbsp;from&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5902625">//&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="comment" id="5902641">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5902708">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5902779">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">120</span><span class="keyword" id="5902848">func</span>&nbsp;<span class="ident" id="5902853">FileInfoHeader</span><span class="op" id="5902867">(</span><span class="ident" id="5902868">fi</span>&nbsp;<span class="ident" id="5902871">os</span><span class="op" id="5902873">.</span><span class="ident" id="5902874">FileInfo</span><span class="op" id="5902882">)</span>&nbsp;<span class="op" id="5902884">(</span><span class="op" id="5902885">*</span><span class="ident" id="5902886">FileHeader</span><span class="op" id="5902896">,</span>&nbsp;<span class="builtintype" id="5902898">error</span><span class="op" id="5902903">)</span>&nbsp;<span class="op" id="5902905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902908">size</span>&nbsp;<span class="op" id="5902913">:=</span>&nbsp;<span class="ident" id="5902916">fi</span><span class="op" id="5902918">.</span><span class="ident" id="5902919">Size</span><span class="op" id="5902923">(</span><span class="op" id="5902924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902927">fh</span>&nbsp;<span class="op" id="5902930">:=</span>&nbsp;<span class="op" id="5902933">&amp;</span><span class="ident" id="5902934">FileHeader</span><span class="op" id="5902944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902948">Name</span><span class="op" id="5902952">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5902968">fi</span><span class="op" id="5902970">.</span><span class="ident" id="5902971">Name</span><span class="op" id="5902975">(</span><span class="op" id="5902976">)</span><span class="op" id="5902977">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5902981">UncompressedSize64</span><span class="op" id="5902999">:</span>&nbsp;<span class="ident" id="5903001">uint64</span><span class="op" id="5903007">(</span><span class="ident" id="5903008">size</span><span class="op" id="5903012">)</span><span class="op" id="5903013">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5903016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903019">fh</span><span class="op" id="5903021">.</span><span class="ident" id="5903022">SetModTime</span><span class="op" id="5903032">(</span><span class="ident" id="5903033">fi</span><span class="op" id="5903035">.</span><span class="ident" id="5903036">ModTime</span><span class="op" id="5903043">(</span><span class="op" id="5903044">)</span><span class="op" id="5903045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903048">fh</span><span class="op" id="5903050">.</span><span class="ident" id="5903051">SetMode</span><span class="op" id="5903058">(</span><span class="ident" id="5903059">fi</span><span class="op" id="5903061">.</span><span class="ident" id="5903062">Mode</span><span class="op" id="5903066">(</span><span class="op" id="5903067">)</span><span class="op" id="5903068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5903071">if</span>&nbsp;<span class="ident" id="5903074">fh</span><span class="op" id="5903076">.</span><span class="ident" id="5903077">UncompressedSize64</span>&nbsp;<span class="op" id="5903096">&gt;</span>&nbsp;<span class="ident" id="5903098">uint32max</span>&nbsp;<span class="op" id="5903108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903112">fh</span><span class="op" id="5903114">.</span><span class="ident" id="5903115">UncompressedSize</span>&nbsp;<span class="op" id="5903132">=</span>&nbsp;<span class="ident" id="5903134">uint32max</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5903145">}</span>&nbsp;<span class="keyword" id="5903147">else</span>&nbsp;<span class="op" id="5903152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903156">fh</span><span class="op" id="5903158">.</span><span class="ident" id="5903159">UncompressedSize</span>&nbsp;<span class="op" id="5903176">=</span>&nbsp;<span class="builtintype" id="5903178">uint32</span><span class="op" id="5903184">(</span><span class="ident" id="5903185">fh</span><span class="op" id="5903187">.</span><span class="ident" id="5903188">UncompressedSize64</span><span class="op" id="5903206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5903209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5903212">return</span>&nbsp;<span class="ident" id="5903219">fh</span><span class="op" id="5903221">,</span>&nbsp;<span class="ident" id="5903223">nil</span><br>
<span class="lineno"></span><span class="op" id="5903227">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="5903230">type</span>&nbsp;<span class="ident" id="5903235">directoryEnd</span>&nbsp;<span class="keyword" id="5903248">struct</span>&nbsp;<span class="op" id="5903255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903258">diskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5903277">uint32</span>&nbsp;<span class="comment" id="5903284">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903295">dirDiskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5903314">uint32</span>&nbsp;<span class="comment" id="5903321">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903332">dirRecordsThisDisk</span>&nbsp;<span class="ident" id="5903351">uint64</span>&nbsp;<span class="comment" id="5903358">//&nbsp;unused</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903369">directoryRecords</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5903388">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903396">directorySize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903415">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903423">directoryOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5903442">uint64</span>&nbsp;<span class="comment" id="5903449">//&nbsp;relative&nbsp;to&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903470">commentLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5903489">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903497">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5903516">string</span><br>
<span class="lineno">145</span><span class="op" id="5903523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5903526">//&nbsp;msDosTimeToTime&nbsp;converts&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time&nbsp;into&nbsp;a&nbsp;time.Time.</span><br>
<span class="lineno"></span><span class="comment" id="5903596">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="5903621">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724247(v=VS.85).aspx</span><br>
<span class="lineno">150</span><span class="keyword" id="5903692">func</span>&nbsp;<span class="ident" id="5903697">msDosTimeToTime</span><span class="op" id="5903712">(</span><span class="ident" id="5903713">dosDate</span><span class="op" id="5903720">,</span>&nbsp;<span class="ident" id="5903722">dosTime</span>&nbsp;<span class="builtintype" id="5903730">uint16</span><span class="op" id="5903736">)</span>&nbsp;<span class="ident" id="5903738">time</span><span class="op" id="5903742">.</span><span class="ident" id="5903743">Time</span>&nbsp;<span class="op" id="5903748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5903751">return</span>&nbsp;<span class="ident" id="5903758">time</span><span class="op" id="5903762">.</span><span class="ident" id="5903763">Date</span><span class="op" id="5903767">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5903771">//&nbsp;date&nbsp;bits&nbsp;0-4:&nbsp;day&nbsp;of&nbsp;month;&nbsp;5-8:&nbsp;month;&nbsp;9-15:&nbsp;years&nbsp;since&nbsp;1980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5903840">int</span><span class="op" id="5903843">(</span><span class="ident" id="5903844">dosDate</span><span class="op" id="5903851">&gt;&gt;</span><span class="num" id="5903853">9</span><span class="op" id="5903854">+</span><span class="num" id="5903855">1980</span><span class="op" id="5903859">)</span><span class="op" id="5903860">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5903864">time</span><span class="op" id="5903868">.</span><span class="ident" id="5903869">Month</span><span class="op" id="5903874">(</span><span class="ident" id="5903875">dosDate</span><span class="op" id="5903882">&gt;&gt;</span><span class="num" id="5903884">5</span><span class="op" id="5903885">&amp;</span><span class="num" id="5903886">0xf</span><span class="op" id="5903889">)</span><span class="op" id="5903890">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5903894">int</span><span class="op" id="5903897">(</span><span class="ident" id="5903898">dosDate</span><span class="op" id="5903905">&amp;</span><span class="num" id="5903906">0x1f</span><span class="op" id="5903910">)</span><span class="op" id="5903911">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5903916">//&nbsp;time&nbsp;bits&nbsp;0-4:&nbsp;second/2;&nbsp;5-10:&nbsp;minute;&nbsp;11-15:&nbsp;hour</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5903972">int</span><span class="op" id="5903975">(</span><span class="ident" id="5903976">dosTime</span><span class="op" id="5903983">&gt;&gt;</span><span class="num" id="5903985">11</span><span class="op" id="5903987">)</span><span class="op" id="5903988">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5903992">int</span><span class="op" id="5903995">(</span><span class="ident" id="5903996">dosTime</span><span class="op" id="5904003">&gt;&gt;</span><span class="num" id="5904005">5</span><span class="op" id="5904006">&amp;</span><span class="num" id="5904007">0x3f</span><span class="op" id="5904011">)</span><span class="op" id="5904012">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5904016">int</span><span class="op" id="5904019">(</span><span class="ident" id="5904020">dosTime</span><span class="op" id="5904027">&amp;</span><span class="num" id="5904028">0x1f</span><span class="op" id="5904032">*</span><span class="num" id="5904033">2</span><span class="op" id="5904034">)</span><span class="op" id="5904035">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5904039">0</span><span class="op" id="5904040">,</span>&nbsp;<span class="comment" id="5904042">//&nbsp;nanoseconds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904060">time</span><span class="op" id="5904064">.</span><span class="ident" id="5904065">UTC</span><span class="op" id="5904068">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5904071">)</span><br>
<span class="lineno">165</span><span class="op" id="5904073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5904076">//&nbsp;timeToMsDosTime&nbsp;converts&nbsp;a&nbsp;time.Time&nbsp;to&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="5904144">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="5904169">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724274(v=VS.85).aspx</span><br>
<span class="lineno">170</span><span class="keyword" id="5904240">func</span>&nbsp;<span class="ident" id="5904245">timeToMsDosTime</span><span class="op" id="5904260">(</span><span class="ident" id="5904261">t</span>&nbsp;<span class="ident" id="5904263">time</span><span class="op" id="5904267">.</span><span class="ident" id="5904268">Time</span><span class="op" id="5904272">)</span>&nbsp;<span class="op" id="5904274">(</span><span class="ident" id="5904275">fDate</span>&nbsp;<span class="builtintype" id="5904281">uint16</span><span class="op" id="5904287">,</span>&nbsp;<span class="ident" id="5904289">fTime</span>&nbsp;<span class="builtintype" id="5904295">uint16</span><span class="op" id="5904301">)</span>&nbsp;<span class="op" id="5904303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904306">t</span>&nbsp;<span class="op" id="5904308">=</span>&nbsp;<span class="ident" id="5904310">t</span><span class="op" id="5904311">.</span><span class="ident" id="5904312">In</span><span class="op" id="5904314">(</span><span class="ident" id="5904315">time</span><span class="op" id="5904319">.</span><span class="ident" id="5904320">UTC</span><span class="op" id="5904323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904326">fDate</span>&nbsp;<span class="op" id="5904332">=</span>&nbsp;<span class="builtintype" id="5904334">uint16</span><span class="op" id="5904340">(</span><span class="ident" id="5904341">t</span><span class="op" id="5904342">.</span><span class="ident" id="5904343">Day</span><span class="op" id="5904346">(</span><span class="op" id="5904347">)</span>&nbsp;<span class="op" id="5904349">+</span>&nbsp;<span class="builtintype" id="5904351">int</span><span class="op" id="5904354">(</span><span class="ident" id="5904355">t</span><span class="op" id="5904356">.</span><span class="ident" id="5904357">Month</span><span class="op" id="5904362">(</span><span class="op" id="5904363">)</span><span class="op" id="5904364">)</span><span class="op" id="5904365">&lt;&lt;</span><span class="num" id="5904367">5</span>&nbsp;<span class="op" id="5904369">+</span>&nbsp;<span class="op" id="5904371">(</span><span class="ident" id="5904372">t</span><span class="op" id="5904373">.</span><span class="ident" id="5904374">Year</span><span class="op" id="5904378">(</span><span class="op" id="5904379">)</span><span class="op" id="5904380">-</span><span class="num" id="5904381">1980</span><span class="op" id="5904385">)</span><span class="op" id="5904386">&lt;&lt;</span><span class="num" id="5904388">9</span><span class="op" id="5904389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904392">fTime</span>&nbsp;<span class="op" id="5904398">=</span>&nbsp;<span class="builtintype" id="5904400">uint16</span><span class="op" id="5904406">(</span><span class="ident" id="5904407">t</span><span class="op" id="5904408">.</span><span class="ident" id="5904409">Second</span><span class="op" id="5904415">(</span><span class="op" id="5904416">)</span><span class="op" id="5904417">/</span><span class="num" id="5904418">2</span>&nbsp;<span class="op" id="5904420">+</span>&nbsp;<span class="ident" id="5904422">t</span><span class="op" id="5904423">.</span><span class="ident" id="5904424">Minute</span><span class="op" id="5904430">(</span><span class="op" id="5904431">)</span><span class="op" id="5904432">&lt;&lt;</span><span class="num" id="5904434">5</span>&nbsp;<span class="op" id="5904436">+</span>&nbsp;<span class="ident" id="5904438">t</span><span class="op" id="5904439">.</span><span class="ident" id="5904440">Hour</span><span class="op" id="5904444">(</span><span class="op" id="5904445">)</span><span class="op" id="5904446">&lt;&lt;</span><span class="num" id="5904448">11</span><span class="op" id="5904450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904453">return</span><br>
<span class="lineno">175</span><span class="op" id="5904460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5904463">//&nbsp;ModTime&nbsp;returns&nbsp;the&nbsp;modification&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="5904512">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="keyword" id="5904537">func</span>&nbsp;<span class="op" id="5904542">(</span><span class="ident" id="5904543">h</span>&nbsp;<span class="op" id="5904545">*</span><span class="ident" id="5904546">FileHeader</span><span class="op" id="5904556">)</span>&nbsp;<span class="ident" id="5904558">ModTime</span><span class="op" id="5904565">(</span><span class="op" id="5904566">)</span>&nbsp;<span class="ident" id="5904568">time</span><span class="op" id="5904572">.</span><span class="ident" id="5904573">Time</span>&nbsp;<span class="op" id="5904578">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5904581">return</span>&nbsp;<span class="ident" id="5904588">msDosTimeToTime</span><span class="op" id="5904603">(</span><span class="ident" id="5904604">h</span><span class="op" id="5904605">.</span><span class="ident" id="5904606">ModifiedDate</span><span class="op" id="5904618">,</span>&nbsp;<span class="ident" id="5904620">h</span><span class="op" id="5904621">.</span><span class="ident" id="5904622">ModifiedTime</span><span class="op" id="5904634">)</span><br>
<span class="lineno"></span><span class="op" id="5904636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5904639">//&nbsp;SetModTime&nbsp;sets&nbsp;the&nbsp;ModifiedTime&nbsp;and&nbsp;ModifiedDate&nbsp;fields&nbsp;to&nbsp;the&nbsp;given&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="5904725">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno">185</span><span class="keyword" id="5904750">func</span>&nbsp;<span class="op" id="5904755">(</span><span class="ident" id="5904756">h</span>&nbsp;<span class="op" id="5904758">*</span><span class="ident" id="5904759">FileHeader</span><span class="op" id="5904769">)</span>&nbsp;<span class="ident" id="5904771">SetModTime</span><span class="op" id="5904781">(</span><span class="ident" id="5904782">t</span>&nbsp;<span class="ident" id="5904784">time</span><span class="op" id="5904788">.</span><span class="ident" id="5904789">Time</span><span class="op" id="5904793">)</span>&nbsp;<span class="op" id="5904795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904798">h</span><span class="op" id="5904799">.</span><span class="ident" id="5904800">ModifiedDate</span><span class="op" id="5904812">,</span>&nbsp;<span class="ident" id="5904814">h</span><span class="op" id="5904815">.</span><span class="ident" id="5904816">ModifiedTime</span>&nbsp;<span class="op" id="5904829">=</span>&nbsp;<span class="ident" id="5904831">timeToMsDosTime</span><span class="op" id="5904846">(</span><span class="ident" id="5904847">t</span><span class="op" id="5904848">)</span><br>
<span class="lineno"></span><span class="op" id="5904850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5904853">const</span>&nbsp;<span class="op" id="5904859">(</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5904862">//&nbsp;Unix&nbsp;constants.&nbsp;The&nbsp;specification&nbsp;doesn&#39;t&nbsp;mention&nbsp;them,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5904922">//&nbsp;but&nbsp;these&nbsp;seem&nbsp;to&nbsp;be&nbsp;the&nbsp;values&nbsp;agreed&nbsp;on&nbsp;by&nbsp;tools.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904978">s_IFMT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5904987">=</span>&nbsp;<span class="num" id="5904989">0xf000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5904997">s_IFSOCK</span>&nbsp;<span class="op" id="5905006">=</span>&nbsp;<span class="num" id="5905008">0xc000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905016">s_IFLNK</span>&nbsp;&nbsp;<span class="op" id="5905025">=</span>&nbsp;<span class="num" id="5905027">0xa000</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905035">s_IFREG</span>&nbsp;&nbsp;<span class="op" id="5905044">=</span>&nbsp;<span class="num" id="5905046">0x8000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905054">s_IFBLK</span>&nbsp;&nbsp;<span class="op" id="5905063">=</span>&nbsp;<span class="num" id="5905065">0x6000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905073">s_IFDIR</span>&nbsp;&nbsp;<span class="op" id="5905082">=</span>&nbsp;<span class="num" id="5905084">0x4000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905092">s_IFCHR</span>&nbsp;&nbsp;<span class="op" id="5905101">=</span>&nbsp;<span class="num" id="5905103">0x2000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905111">s_IFIFO</span>&nbsp;&nbsp;<span class="op" id="5905120">=</span>&nbsp;<span class="num" id="5905122">0x1000</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905130">s_ISUID</span>&nbsp;&nbsp;<span class="op" id="5905139">=</span>&nbsp;<span class="num" id="5905141">0x800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905148">s_ISGID</span>&nbsp;&nbsp;<span class="op" id="5905157">=</span>&nbsp;<span class="num" id="5905159">0x400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905166">s_ISVTX</span>&nbsp;&nbsp;<span class="op" id="5905175">=</span>&nbsp;<span class="num" id="5905177">0x200</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905185">msdosDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5905199">=</span>&nbsp;<span class="num" id="5905201">0x10</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905207">msdosReadOnly</span>&nbsp;<span class="op" id="5905221">=</span>&nbsp;<span class="num" id="5905223">0x01</span><br>
<span class="lineno"></span><span class="op" id="5905228">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5905231">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="5905296">func</span>&nbsp;<span class="op" id="5905301">(</span><span class="ident" id="5905302">h</span>&nbsp;<span class="op" id="5905304">*</span><span class="ident" id="5905305">FileHeader</span><span class="op" id="5905315">)</span>&nbsp;<span class="ident" id="5905317">Mode</span><span class="op" id="5905321">(</span><span class="op" id="5905322">)</span>&nbsp;<span class="op" id="5905324">(</span><span class="ident" id="5905325">mode</span>&nbsp;<span class="ident" id="5905330">os</span><span class="op" id="5905332">.</span><span class="ident" id="5905333">FileMode</span><span class="op" id="5905341">)</span>&nbsp;<span class="op" id="5905343">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905346">switch</span>&nbsp;<span class="ident" id="5905353">h</span><span class="op" id="5905354">.</span><span class="ident" id="5905355">CreatorVersion</span>&nbsp;<span class="op" id="5905370">&gt;&gt;</span>&nbsp;<span class="num" id="5905373">8</span>&nbsp;<span class="op" id="5905375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905378">case</span>&nbsp;<span class="ident" id="5905383">creatorUnix</span><span class="op" id="5905394">,</span>&nbsp;<span class="ident" id="5905396">creatorMacOSX</span><span class="op" id="5905409">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905413">mode</span>&nbsp;<span class="op" id="5905418">=</span>&nbsp;<span class="ident" id="5905420">unixModeToFileMode</span><span class="op" id="5905438">(</span><span class="ident" id="5905439">h</span><span class="op" id="5905440">.</span><span class="ident" id="5905441">ExternalAttrs</span>&nbsp;<span class="op" id="5905455">&gt;&gt;</span>&nbsp;<span class="num" id="5905458">16</span><span class="op" id="5905460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905463">case</span>&nbsp;<span class="ident" id="5905468">creatorNTFS</span><span class="op" id="5905479">,</span>&nbsp;<span class="ident" id="5905481">creatorVFAT</span><span class="op" id="5905492">,</span>&nbsp;<span class="ident" id="5905494">creatorFAT</span><span class="op" id="5905504">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905508">mode</span>&nbsp;<span class="op" id="5905513">=</span>&nbsp;<span class="ident" id="5905515">msdosModeToFileMode</span><span class="op" id="5905534">(</span><span class="ident" id="5905535">h</span><span class="op" id="5905536">.</span><span class="ident" id="5905537">ExternalAttrs</span><span class="op" id="5905550">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5905553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905556">if</span>&nbsp;<span class="builtinfunc" id="5905559">len</span><span class="op" id="5905562">(</span><span class="ident" id="5905563">h</span><span class="op" id="5905564">.</span><span class="ident" id="5905565">Name</span><span class="op" id="5905569">)</span>&nbsp;<span class="op" id="5905571">&gt;</span>&nbsp;<span class="num" id="5905573">0</span>&nbsp;<span class="op" id="5905575">&amp;&amp;</span>&nbsp;<span class="ident" id="5905578">h</span><span class="op" id="5905579">.</span><span class="ident" id="5905580">Name</span><span class="op" id="5905584">[</span><span class="builtinfunc" id="5905585">len</span><span class="op" id="5905588">(</span><span class="ident" id="5905589">h</span><span class="op" id="5905590">.</span><span class="ident" id="5905591">Name</span><span class="op" id="5905595">)</span><span class="op" id="5905596">-</span><span class="num" id="5905597">1</span><span class="op" id="5905598">]</span>&nbsp;<span class="op" id="5905600">==</span>&nbsp;<span class="string" id="5905603">&#39;/&#39;</span>&nbsp;<span class="op" id="5905607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905611">mode</span>&nbsp;<span class="op" id="5905616">|=</span>&nbsp;<span class="ident" id="5905619">os</span><span class="op" id="5905621">.</span><span class="ident" id="5905622">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5905631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905634">return</span>&nbsp;<span class="ident" id="5905641">mode</span><br>
<span class="lineno">220</span><span class="op" id="5905646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5905649">//&nbsp;SetMode&nbsp;changes&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="5905717">func</span>&nbsp;<span class="op" id="5905722">(</span><span class="ident" id="5905723">h</span>&nbsp;<span class="op" id="5905725">*</span><span class="ident" id="5905726">FileHeader</span><span class="op" id="5905736">)</span>&nbsp;<span class="ident" id="5905738">SetMode</span><span class="op" id="5905745">(</span><span class="ident" id="5905746">mode</span>&nbsp;<span class="ident" id="5905751">os</span><span class="op" id="5905753">.</span><span class="ident" id="5905754">FileMode</span><span class="op" id="5905762">)</span>&nbsp;<span class="op" id="5905764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905767">h</span><span class="op" id="5905768">.</span><span class="ident" id="5905769">CreatorVersion</span>&nbsp;<span class="op" id="5905784">=</span>&nbsp;<span class="ident" id="5905786">h</span><span class="op" id="5905787">.</span><span class="ident" id="5905788">CreatorVersion</span><span class="op" id="5905802">&amp;</span><span class="num" id="5905803">0xff</span>&nbsp;<span class="op" id="5905808">|</span>&nbsp;<span class="ident" id="5905810">creatorUnix</span><span class="op" id="5905821">&lt;&lt;</span><span class="num" id="5905823">8</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905826">h</span><span class="op" id="5905827">.</span><span class="ident" id="5905828">ExternalAttrs</span>&nbsp;<span class="op" id="5905842">=</span>&nbsp;<span class="ident" id="5905844">fileModeToUnixMode</span><span class="op" id="5905862">(</span><span class="ident" id="5905863">mode</span><span class="op" id="5905867">)</span>&nbsp;<span class="op" id="5905869">&lt;&lt;</span>&nbsp;<span class="num" id="5905872">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5905877">//&nbsp;set&nbsp;MSDOS&nbsp;attributes&nbsp;too,&nbsp;as&nbsp;the&nbsp;original&nbsp;zip&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905933">if</span>&nbsp;<span class="ident" id="5905936">mode</span><span class="op" id="5905940">&amp;</span><span class="ident" id="5905941">os</span><span class="op" id="5905943">.</span><span class="ident" id="5905944">ModeDir</span>&nbsp;<span class="op" id="5905952">!=</span>&nbsp;<span class="num" id="5905955">0</span>&nbsp;<span class="op" id="5905957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5905961">h</span><span class="op" id="5905962">.</span><span class="ident" id="5905963">ExternalAttrs</span>&nbsp;<span class="op" id="5905977">|=</span>&nbsp;<span class="ident" id="5905980">msdosDir</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5905990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5905993">if</span>&nbsp;<span class="ident" id="5905996">mode</span><span class="op" id="5906000">&amp;</span><span class="num" id="5906001">0200</span>&nbsp;<span class="op" id="5906006">==</span>&nbsp;<span class="num" id="5906009">0</span>&nbsp;<span class="op" id="5906011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906015">h</span><span class="op" id="5906016">.</span><span class="ident" id="5906017">ExternalAttrs</span>&nbsp;<span class="op" id="5906031">|=</span>&nbsp;<span class="ident" id="5906034">msdosReadOnly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906049">}</span><br>
<span class="lineno"></span><span class="op" id="5906051">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="5906054">//&nbsp;isZip64&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;size&nbsp;exceeds&nbsp;the&nbsp;32&nbsp;bit&nbsp;limit</span><br>
<span class="lineno"></span><span class="keyword" id="5906120">func</span>&nbsp;<span class="op" id="5906125">(</span><span class="ident" id="5906126">fh</span>&nbsp;<span class="op" id="5906129">*</span><span class="ident" id="5906130">FileHeader</span><span class="op" id="5906140">)</span>&nbsp;<span class="ident" id="5906142">isZip64</span><span class="op" id="5906149">(</span><span class="op" id="5906150">)</span>&nbsp;<span class="builtintype" id="5906152">bool</span>&nbsp;<span class="op" id="5906157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906160">return</span>&nbsp;<span class="ident" id="5906167">fh</span><span class="op" id="5906169">.</span><span class="ident" id="5906170">CompressedSize64</span>&nbsp;<span class="op" id="5906187">&gt;</span>&nbsp;<span class="ident" id="5906189">uint32max</span>&nbsp;<span class="op" id="5906199">||</span>&nbsp;<span class="ident" id="5906202">fh</span><span class="op" id="5906204">.</span><span class="ident" id="5906205">UncompressedSize64</span>&nbsp;<span class="op" id="5906224">&gt;</span>&nbsp;<span class="ident" id="5906226">uint32max</span><br>
<span class="lineno"></span><span class="op" id="5906236">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="5906239">func</span>&nbsp;<span class="ident" id="5906244">msdosModeToFileMode</span><span class="op" id="5906263">(</span><span class="ident" id="5906264">m</span>&nbsp;<span class="builtintype" id="5906266">uint32</span><span class="op" id="5906272">)</span>&nbsp;<span class="op" id="5906274">(</span><span class="ident" id="5906275">mode</span>&nbsp;<span class="ident" id="5906280">os</span><span class="op" id="5906282">.</span><span class="ident" id="5906283">FileMode</span><span class="op" id="5906291">)</span>&nbsp;<span class="op" id="5906293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906296">if</span>&nbsp;<span class="ident" id="5906299">m</span><span class="op" id="5906300">&amp;</span><span class="ident" id="5906301">msdosDir</span>&nbsp;<span class="op" id="5906310">!=</span>&nbsp;<span class="num" id="5906313">0</span>&nbsp;<span class="op" id="5906315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906319">mode</span>&nbsp;<span class="op" id="5906324">=</span>&nbsp;<span class="ident" id="5906326">os</span><span class="op" id="5906328">.</span><span class="ident" id="5906329">ModeDir</span>&nbsp;<span class="op" id="5906337">|</span>&nbsp;<span class="num" id="5906339">0777</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906345">}</span>&nbsp;<span class="keyword" id="5906347">else</span>&nbsp;<span class="op" id="5906352">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906356">mode</span>&nbsp;<span class="op" id="5906361">=</span>&nbsp;<span class="num" id="5906363">0666</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906372">if</span>&nbsp;<span class="ident" id="5906375">m</span><span class="op" id="5906376">&amp;</span><span class="ident" id="5906377">msdosReadOnly</span>&nbsp;<span class="op" id="5906391">!=</span>&nbsp;<span class="num" id="5906394">0</span>&nbsp;<span class="op" id="5906396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906400">mode</span>&nbsp;<span class="op" id="5906405">&amp;^=</span>&nbsp;<span class="num" id="5906409">0222</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906415">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906418">return</span>&nbsp;<span class="ident" id="5906425">mode</span><br>
<span class="lineno"></span><span class="op" id="5906430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5906433">func</span>&nbsp;<span class="ident" id="5906438">fileModeToUnixMode</span><span class="op" id="5906456">(</span><span class="ident" id="5906457">mode</span>&nbsp;<span class="ident" id="5906462">os</span><span class="op" id="5906464">.</span><span class="ident" id="5906465">FileMode</span><span class="op" id="5906473">)</span>&nbsp;<span class="builtintype" id="5906475">uint32</span>&nbsp;<span class="op" id="5906482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906485">var</span>&nbsp;<span class="ident" id="5906489">m</span>&nbsp;<span class="builtintype" id="5906491">uint32</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906499">switch</span>&nbsp;<span class="ident" id="5906506">mode</span>&nbsp;<span class="op" id="5906511">&amp;</span>&nbsp;<span class="ident" id="5906513">os</span><span class="op" id="5906515">.</span><span class="ident" id="5906516">ModeType</span>&nbsp;<span class="op" id="5906525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906528">default</span><span class="op" id="5906535">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906539">m</span>&nbsp;<span class="op" id="5906541">=</span>&nbsp;<span class="ident" id="5906543">s_IFREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906552">case</span>&nbsp;<span class="ident" id="5906557">os</span><span class="op" id="5906559">.</span><span class="ident" id="5906560">ModeDir</span><span class="op" id="5906567">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906571">m</span>&nbsp;<span class="op" id="5906573">=</span>&nbsp;<span class="ident" id="5906575">s_IFDIR</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906584">case</span>&nbsp;<span class="ident" id="5906589">os</span><span class="op" id="5906591">.</span><span class="ident" id="5906592">ModeSymlink</span><span class="op" id="5906603">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906607">m</span>&nbsp;<span class="op" id="5906609">=</span>&nbsp;<span class="ident" id="5906611">s_IFLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906620">case</span>&nbsp;<span class="ident" id="5906625">os</span><span class="op" id="5906627">.</span><span class="ident" id="5906628">ModeNamedPipe</span><span class="op" id="5906641">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906645">m</span>&nbsp;<span class="op" id="5906647">=</span>&nbsp;<span class="ident" id="5906649">s_IFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906658">case</span>&nbsp;<span class="ident" id="5906663">os</span><span class="op" id="5906665">.</span><span class="ident" id="5906666">ModeSocket</span><span class="op" id="5906676">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906680">m</span>&nbsp;<span class="op" id="5906682">=</span>&nbsp;<span class="ident" id="5906684">s_IFSOCK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906694">case</span>&nbsp;<span class="ident" id="5906699">os</span><span class="op" id="5906701">.</span><span class="ident" id="5906702">ModeDevice</span><span class="op" id="5906712">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906716">if</span>&nbsp;<span class="ident" id="5906719">mode</span><span class="op" id="5906723">&amp;</span><span class="ident" id="5906724">os</span><span class="op" id="5906726">.</span><span class="ident" id="5906727">ModeCharDevice</span>&nbsp;<span class="op" id="5906742">!=</span>&nbsp;<span class="num" id="5906745">0</span>&nbsp;<span class="op" id="5906747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906752">m</span>&nbsp;<span class="op" id="5906754">=</span>&nbsp;<span class="ident" id="5906756">s_IFCHR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906766">}</span>&nbsp;<span class="keyword" id="5906768">else</span>&nbsp;<span class="op" id="5906773">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906778">m</span>&nbsp;<span class="op" id="5906780">=</span>&nbsp;<span class="ident" id="5906782">s_IFBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906798">if</span>&nbsp;<span class="ident" id="5906801">mode</span><span class="op" id="5906805">&amp;</span><span class="ident" id="5906806">os</span><span class="op" id="5906808">.</span><span class="ident" id="5906809">ModeSetuid</span>&nbsp;<span class="op" id="5906820">!=</span>&nbsp;<span class="num" id="5906823">0</span>&nbsp;<span class="op" id="5906825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906829">m</span>&nbsp;<span class="op" id="5906831">|=</span>&nbsp;<span class="ident" id="5906834">s_ISUID</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906846">if</span>&nbsp;<span class="ident" id="5906849">mode</span><span class="op" id="5906853">&amp;</span><span class="ident" id="5906854">os</span><span class="op" id="5906856">.</span><span class="ident" id="5906857">ModeSetgid</span>&nbsp;<span class="op" id="5906868">!=</span>&nbsp;<span class="num" id="5906871">0</span>&nbsp;<span class="op" id="5906873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906877">m</span>&nbsp;<span class="op" id="5906879">|=</span>&nbsp;<span class="ident" id="5906882">s_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906894">if</span>&nbsp;<span class="ident" id="5906897">mode</span><span class="op" id="5906901">&amp;</span><span class="ident" id="5906902">os</span><span class="op" id="5906904">.</span><span class="ident" id="5906905">ModeSticky</span>&nbsp;<span class="op" id="5906916">!=</span>&nbsp;<span class="num" id="5906919">0</span>&nbsp;<span class="op" id="5906921">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906925">m</span>&nbsp;<span class="op" id="5906927">|=</span>&nbsp;<span class="ident" id="5906930">s_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906942">return</span>&nbsp;<span class="ident" id="5906949">m</span>&nbsp;<span class="op" id="5906951">|</span>&nbsp;<span class="builtintype" id="5906953">uint32</span><span class="op" id="5906959">(</span><span class="ident" id="5906960">mode</span><span class="op" id="5906964">&amp;</span><span class="num" id="5906965">0777</span><span class="op" id="5906969">)</span><br>
<span class="lineno"></span><span class="op" id="5906971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5906974">func</span>&nbsp;<span class="ident" id="5906979">unixModeToFileMode</span><span class="op" id="5906997">(</span><span class="ident" id="5906998">m</span>&nbsp;<span class="builtintype" id="5907000">uint32</span><span class="op" id="5907006">)</span>&nbsp;<span class="ident" id="5907008">os</span><span class="op" id="5907010">.</span><span class="ident" id="5907011">FileMode</span>&nbsp;<span class="op" id="5907020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907023">mode</span>&nbsp;<span class="op" id="5907028">:=</span>&nbsp;<span class="ident" id="5907031">os</span><span class="op" id="5907033">.</span><span class="ident" id="5907034">FileMode</span><span class="op" id="5907042">(</span><span class="ident" id="5907043">m</span>&nbsp;<span class="op" id="5907045">&amp;</span>&nbsp;<span class="num" id="5907047">0777</span><span class="op" id="5907051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907054">switch</span>&nbsp;<span class="ident" id="5907061">m</span>&nbsp;<span class="op" id="5907063">&amp;</span>&nbsp;<span class="ident" id="5907065">s_IFMT</span>&nbsp;<span class="op" id="5907072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907075">case</span>&nbsp;<span class="ident" id="5907080">s_IFBLK</span><span class="op" id="5907087">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907091">mode</span>&nbsp;<span class="op" id="5907096">|=</span>&nbsp;<span class="ident" id="5907099">os</span><span class="op" id="5907101">.</span><span class="ident" id="5907102">ModeDevice</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907114">case</span>&nbsp;<span class="ident" id="5907119">s_IFCHR</span><span class="op" id="5907126">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907130">mode</span>&nbsp;<span class="op" id="5907135">|=</span>&nbsp;<span class="ident" id="5907138">os</span><span class="op" id="5907140">.</span><span class="ident" id="5907141">ModeDevice</span>&nbsp;<span class="op" id="5907152">|</span>&nbsp;<span class="ident" id="5907154">os</span><span class="op" id="5907156">.</span><span class="ident" id="5907157">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907173">case</span>&nbsp;<span class="ident" id="5907178">s_IFDIR</span><span class="op" id="5907185">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907189">mode</span>&nbsp;<span class="op" id="5907194">|=</span>&nbsp;<span class="ident" id="5907197">os</span><span class="op" id="5907199">.</span><span class="ident" id="5907200">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907209">case</span>&nbsp;<span class="ident" id="5907214">s_IFIFO</span><span class="op" id="5907221">:</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907225">mode</span>&nbsp;<span class="op" id="5907230">|=</span>&nbsp;<span class="ident" id="5907233">os</span><span class="op" id="5907235">.</span><span class="ident" id="5907236">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907251">case</span>&nbsp;<span class="ident" id="5907256">s_IFLNK</span><span class="op" id="5907263">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907267">mode</span>&nbsp;<span class="op" id="5907272">|=</span>&nbsp;<span class="ident" id="5907275">os</span><span class="op" id="5907277">.</span><span class="ident" id="5907278">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907291">case</span>&nbsp;<span class="ident" id="5907296">s_IFREG</span><span class="op" id="5907303">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5907307">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907325">case</span>&nbsp;<span class="ident" id="5907330">s_IFSOCK</span><span class="op" id="5907338">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907342">mode</span>&nbsp;<span class="op" id="5907347">|=</span>&nbsp;<span class="ident" id="5907350">os</span><span class="op" id="5907352">.</span><span class="ident" id="5907353">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907368">if</span>&nbsp;<span class="ident" id="5907371">m</span><span class="op" id="5907372">&amp;</span><span class="ident" id="5907373">s_ISGID</span>&nbsp;<span class="op" id="5907381">!=</span>&nbsp;<span class="num" id="5907384">0</span>&nbsp;<span class="op" id="5907386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907390">mode</span>&nbsp;<span class="op" id="5907395">|=</span>&nbsp;<span class="ident" id="5907398">os</span><span class="op" id="5907400">.</span><span class="ident" id="5907401">ModeSetgid</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907416">if</span>&nbsp;<span class="ident" id="5907419">m</span><span class="op" id="5907420">&amp;</span><span class="ident" id="5907421">s_ISUID</span>&nbsp;<span class="op" id="5907429">!=</span>&nbsp;<span class="num" id="5907432">0</span>&nbsp;<span class="op" id="5907434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907438">mode</span>&nbsp;<span class="op" id="5907443">|=</span>&nbsp;<span class="ident" id="5907446">os</span><span class="op" id="5907448">.</span><span class="ident" id="5907449">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907464">if</span>&nbsp;<span class="ident" id="5907467">m</span><span class="op" id="5907468">&amp;</span><span class="ident" id="5907469">s_ISVTX</span>&nbsp;<span class="op" id="5907477">!=</span>&nbsp;<span class="num" id="5907480">0</span>&nbsp;<span class="op" id="5907482">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907486">mode</span>&nbsp;<span class="op" id="5907491">|=</span>&nbsp;<span class="ident" id="5907494">os</span><span class="op" id="5907496">.</span><span class="ident" id="5907497">ModeSticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907512">return</span>&nbsp;<span class="ident" id="5907519">mode</span><br>
<span class="lineno"></span><span class="op" id="5907524">}</span>
</div>
</body>
</html>
