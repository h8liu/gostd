<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2733508">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2733563">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2733617">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2733668">package</span>&nbsp;<span class="ident" id="2733676">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2733685">//&nbsp;stringFinder&nbsp;efficiently&nbsp;finds&nbsp;strings&nbsp;in&nbsp;a&nbsp;source&nbsp;text.&nbsp;It&#39;s&nbsp;implemented</span><br>
<span class="lineno"></span><span class="comment" id="2733762">//&nbsp;using&nbsp;the&nbsp;Boyer-Moore&nbsp;string&nbsp;search&nbsp;algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2733812">//&nbsp;http://en.wikipedia.org/wiki/Boyer-Moore_string_search_algorithm</span><br>
<span class="lineno">10</span><span class="comment" id="2733880">//&nbsp;http://www.cs.utexas.edu/~moore/publications/fstrpos.pdf&nbsp;(note:&nbsp;this&nbsp;aged</span><br>
<span class="lineno"></span><span class="comment" id="2733957">//&nbsp;document&nbsp;uses&nbsp;1-based&nbsp;indexing)</span><br>
<span class="lineno"></span><span class="keyword" id="2733992">type</span>&nbsp;<span class="ident" id="2733997">stringFinder</span>&nbsp;<span class="keyword" id="2734010">struct</span>&nbsp;<span class="op" id="2734017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2734020">//&nbsp;pattern&nbsp;is&nbsp;the&nbsp;string&nbsp;that&nbsp;we&nbsp;are&nbsp;searching&nbsp;for&nbsp;in&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2734085">pattern</span>&nbsp;<span class="builtintype" id="2734093">string</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2734102">//&nbsp;badCharSkip[b]&nbsp;contains&nbsp;the&nbsp;distance&nbsp;between&nbsp;the&nbsp;last&nbsp;byte&nbsp;of&nbsp;pattern</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2734176">//&nbsp;and&nbsp;the&nbsp;rightmost&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;pattern.&nbsp;If&nbsp;b&nbsp;is&nbsp;not&nbsp;in&nbsp;pattern,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2734250">//&nbsp;badCharSkip[b]&nbsp;is&nbsp;len(pattern).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2734286">//</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2734290">//&nbsp;Whenever&nbsp;a&nbsp;mismatch&nbsp;is&nbsp;found&nbsp;with&nbsp;byte&nbsp;b&nbsp;in&nbsp;the&nbsp;text,&nbsp;we&nbsp;can&nbsp;safely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2734362">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;at&nbsp;least&nbsp;badCharSkip[b]&nbsp;until&nbsp;the&nbsp;next&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2734435">//&nbsp;the&nbsp;matching&nbsp;char&nbsp;could&nbsp;be&nbsp;in&nbsp;alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2734480">badCharSkip</span>&nbsp;<span class="op" id="2734492">[</span><span class="num" id="2734493">256</span><span class="op" id="2734496">]</span><span class="builtintype" id="2734497">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2734503">//&nbsp;goodSuffixSkip[i]&nbsp;defines&nbsp;how&nbsp;far&nbsp;we&nbsp;can&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2734579">//&nbsp;that&nbsp;the&nbsp;suffix&nbsp;pattern[i+1:]&nbsp;matches,&nbsp;but&nbsp;the&nbsp;byte&nbsp;pattern[i]&nbsp;does</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2734651">//&nbsp;not.&nbsp;There&nbsp;are&nbsp;two&nbsp;cases&nbsp;to&nbsp;consider:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2734693">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2734697">//&nbsp;1.&nbsp;The&nbsp;matched&nbsp;suffix&nbsp;occurs&nbsp;elsewhere&nbsp;in&nbsp;pattern&nbsp;(with&nbsp;a&nbsp;different</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2734769">//&nbsp;byte&nbsp;preceding&nbsp;it&nbsp;that&nbsp;we&nbsp;might&nbsp;possibly&nbsp;match).&nbsp;In&nbsp;this&nbsp;case,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2734843">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;to&nbsp;align&nbsp;with&nbsp;the&nbsp;next&nbsp;suffix&nbsp;chunk.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2734913">//&nbsp;example,&nbsp;the&nbsp;pattern&nbsp;&#34;mississi&#34;&nbsp;has&nbsp;the&nbsp;suffix&nbsp;&#34;issi&#34;&nbsp;next&nbsp;occurring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2734986">//&nbsp;(in&nbsp;right-to-left&nbsp;order)&nbsp;at&nbsp;index&nbsp;1,&nbsp;so&nbsp;goodSuffixSkip[3]&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2735051">//&nbsp;shift+len(suffix)&nbsp;==&nbsp;3+4&nbsp;==&nbsp;7.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2735086">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2735090">//&nbsp;2.&nbsp;If&nbsp;the&nbsp;matched&nbsp;suffix&nbsp;does&nbsp;not&nbsp;occur&nbsp;elsewhere&nbsp;in&nbsp;pattern,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2735165">//&nbsp;matching&nbsp;frame&nbsp;may&nbsp;share&nbsp;part&nbsp;of&nbsp;its&nbsp;prefix&nbsp;with&nbsp;the&nbsp;end&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2735233">//&nbsp;matching&nbsp;suffix.&nbsp;In&nbsp;this&nbsp;case,&nbsp;goodSuffixSkip[i]&nbsp;will&nbsp;contain&nbsp;how&nbsp;far</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2735307">//&nbsp;to&nbsp;shift&nbsp;the&nbsp;frame&nbsp;to&nbsp;align&nbsp;this&nbsp;portion&nbsp;of&nbsp;the&nbsp;prefix&nbsp;to&nbsp;the</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2735373">//&nbsp;suffix.&nbsp;For&nbsp;example,&nbsp;in&nbsp;the&nbsp;pattern&nbsp;&#34;abcxxxabc&#34;,&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2735441">//&nbsp;mismatch&nbsp;from&nbsp;the&nbsp;back&nbsp;is&nbsp;found&nbsp;to&nbsp;be&nbsp;in&nbsp;position&nbsp;3,&nbsp;the&nbsp;matching</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2735511">//&nbsp;suffix&nbsp;&#34;xxabc&#34;&nbsp;is&nbsp;not&nbsp;found&nbsp;elsewhere&nbsp;in&nbsp;the&nbsp;pattern.&nbsp;However,&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2735582">//&nbsp;rightmost&nbsp;&#34;abc&#34;&nbsp;(at&nbsp;position&nbsp;6)&nbsp;is&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;whole&nbsp;pattern,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2735655">//&nbsp;goodSuffixSkip[3]&nbsp;==&nbsp;shift+len(suffix)&nbsp;==&nbsp;6+5&nbsp;==&nbsp;11.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2735712">goodSuffixSkip</span>&nbsp;<span class="op" id="2735727">[</span><span class="op" id="2735728">]</span><span class="builtintype" id="2735729">int</span><br>
<span class="lineno"></span><span class="op" id="2735733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2735736">func</span>&nbsp;<span class="ident" id="2735741">makeStringFinder</span><span class="op" id="2735757">(</span><span class="ident" id="2735758">pattern</span>&nbsp;<span class="builtintype" id="2735766">string</span><span class="op" id="2735772">)</span>&nbsp;<span class="op" id="2735774">*</span><span class="ident" id="2735775">stringFinder</span>&nbsp;<span class="op" id="2735788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2735791">f</span>&nbsp;<span class="op" id="2735793">:=</span>&nbsp;<span class="op" id="2735796">&amp;</span><span class="ident" id="2735797">stringFinder</span><span class="op" id="2735809">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2735813">pattern</span><span class="op" id="2735820">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2735829">pattern</span><span class="op" id="2735836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2735840">goodSuffixSkip</span><span class="op" id="2735854">:</span>&nbsp;<span class="builtinfunc" id="2735856">make</span><span class="op" id="2735860">(</span><span class="op" id="2735861">[</span><span class="op" id="2735862">]</span><span class="builtintype" id="2735863">int</span><span class="op" id="2735866">,</span>&nbsp;<span class="builtinfunc" id="2735868">len</span><span class="op" id="2735871">(</span><span class="ident" id="2735872">pattern</span><span class="op" id="2735879">)</span><span class="op" id="2735880">)</span><span class="op" id="2735881">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2735884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2735887">//&nbsp;last&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;character&nbsp;in&nbsp;the&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2735947">last</span>&nbsp;<span class="op" id="2735952">:=</span>&nbsp;<span class="builtinfunc" id="2735955">len</span><span class="op" id="2735958">(</span><span class="ident" id="2735959">pattern</span><span class="op" id="2735966">)</span>&nbsp;<span class="op" id="2735968">-</span>&nbsp;<span class="num" id="2735970">1</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2735974">//&nbsp;Build&nbsp;bad&nbsp;character&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2736005">//&nbsp;Bytes&nbsp;not&nbsp;in&nbsp;the&nbsp;pattern&nbsp;can&nbsp;skip&nbsp;one&nbsp;pattern&#39;s&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2736065">for</span>&nbsp;<span class="ident" id="2736069">i</span>&nbsp;<span class="op" id="2736071">:=</span>&nbsp;<span class="keyword" id="2736074">range</span>&nbsp;<span class="ident" id="2736080">f</span><span class="op" id="2736081">.</span><span class="ident" id="2736082">badCharSkip</span>&nbsp;<span class="op" id="2736094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2736098">f</span><span class="op" id="2736099">.</span><span class="ident" id="2736100">badCharSkip</span><span class="op" id="2736111">[</span><span class="ident" id="2736112">i</span><span class="op" id="2736113">]</span>&nbsp;<span class="op" id="2736115">=</span>&nbsp;<span class="builtinfunc" id="2736117">len</span><span class="op" id="2736120">(</span><span class="ident" id="2736121">pattern</span><span class="op" id="2736128">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2736131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2736134">//&nbsp;The&nbsp;loop&nbsp;condition&nbsp;is&nbsp;&lt;&nbsp;instead&nbsp;of&nbsp;&lt;=&nbsp;so&nbsp;that&nbsp;the&nbsp;last&nbsp;byte&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2736207">//&nbsp;have&nbsp;a&nbsp;zero&nbsp;distance&nbsp;to&nbsp;itself.&nbsp;Finding&nbsp;this&nbsp;byte&nbsp;out&nbsp;of&nbsp;place&nbsp;implies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2736282">//&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;last&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2736323">for</span>&nbsp;<span class="ident" id="2736327">i</span>&nbsp;<span class="op" id="2736329">:=</span>&nbsp;<span class="num" id="2736332">0</span><span class="op" id="2736333">;</span>&nbsp;<span class="ident" id="2736335">i</span>&nbsp;<span class="op" id="2736337">&lt;</span>&nbsp;<span class="ident" id="2736339">last</span><span class="op" id="2736343">;</span>&nbsp;<span class="ident" id="2736345">i</span><span class="op" id="2736346">++</span>&nbsp;<span class="op" id="2736349">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2736353">f</span><span class="op" id="2736354">.</span><span class="ident" id="2736355">badCharSkip</span><span class="op" id="2736366">[</span><span class="ident" id="2736367">pattern</span><span class="op" id="2736374">[</span><span class="ident" id="2736375">i</span><span class="op" id="2736376">]</span><span class="op" id="2736377">]</span>&nbsp;<span class="op" id="2736379">=</span>&nbsp;<span class="ident" id="2736381">last</span>&nbsp;<span class="op" id="2736386">-</span>&nbsp;<span class="ident" id="2736388">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2736391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2736395">//&nbsp;Build&nbsp;good&nbsp;suffix&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2736424">//&nbsp;First&nbsp;pass:&nbsp;set&nbsp;each&nbsp;value&nbsp;to&nbsp;the&nbsp;next&nbsp;index&nbsp;which&nbsp;starts&nbsp;a&nbsp;prefix&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2736498">//&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2736511">lastPrefix</span>&nbsp;<span class="op" id="2736522">:=</span>&nbsp;<span class="ident" id="2736525">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2736531">for</span>&nbsp;<span class="ident" id="2736535">i</span>&nbsp;<span class="op" id="2736537">:=</span>&nbsp;<span class="ident" id="2736540">last</span><span class="op" id="2736544">;</span>&nbsp;<span class="ident" id="2736546">i</span>&nbsp;<span class="op" id="2736548">&gt;=</span>&nbsp;<span class="num" id="2736551">0</span><span class="op" id="2736552">;</span>&nbsp;<span class="ident" id="2736554">i</span><span class="op" id="2736555">--</span>&nbsp;<span class="op" id="2736558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2736562">if</span>&nbsp;<span class="ident" id="2736565">HasPrefix</span><span class="op" id="2736574">(</span><span class="ident" id="2736575">pattern</span><span class="op" id="2736582">,</span>&nbsp;<span class="ident" id="2736584">pattern</span><span class="op" id="2736591">[</span><span class="ident" id="2736592">i</span><span class="op" id="2736593">+</span><span class="num" id="2736594">1</span><span class="op" id="2736595">:</span><span class="op" id="2736596">]</span><span class="op" id="2736597">)</span>&nbsp;<span class="op" id="2736599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2736604">lastPrefix</span>&nbsp;<span class="op" id="2736615">=</span>&nbsp;<span class="ident" id="2736617">i</span>&nbsp;<span class="op" id="2736619">+</span>&nbsp;<span class="num" id="2736621">1</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2736625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2736629">//&nbsp;lastPrefix&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;(last-i)&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2736688">f</span><span class="op" id="2736689">.</span><span class="ident" id="2736690">goodSuffixSkip</span><span class="op" id="2736704">[</span><span class="ident" id="2736705">i</span><span class="op" id="2736706">]</span>&nbsp;<span class="op" id="2736708">=</span>&nbsp;<span class="ident" id="2736710">lastPrefix</span>&nbsp;<span class="op" id="2736721">+</span>&nbsp;<span class="ident" id="2736723">last</span>&nbsp;<span class="op" id="2736728">-</span>&nbsp;<span class="ident" id="2736730">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2736733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2736736">//&nbsp;Second&nbsp;pass:&nbsp;find&nbsp;repeats&nbsp;of&nbsp;pattern&#39;s&nbsp;suffix&nbsp;starting&nbsp;from&nbsp;the&nbsp;front.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2736811">for</span>&nbsp;<span class="ident" id="2736815">i</span>&nbsp;<span class="op" id="2736817">:=</span>&nbsp;<span class="num" id="2736820">0</span><span class="op" id="2736821">;</span>&nbsp;<span class="ident" id="2736823">i</span>&nbsp;<span class="op" id="2736825">&lt;</span>&nbsp;<span class="ident" id="2736827">last</span><span class="op" id="2736831">;</span>&nbsp;<span class="ident" id="2736833">i</span><span class="op" id="2736834">++</span>&nbsp;<span class="op" id="2736837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2736841">lenSuffix</span>&nbsp;<span class="op" id="2736851">:=</span>&nbsp;<span class="ident" id="2736854">longestCommonSuffix</span><span class="op" id="2736873">(</span><span class="ident" id="2736874">pattern</span><span class="op" id="2736881">,</span>&nbsp;<span class="ident" id="2736883">pattern</span><span class="op" id="2736890">[</span><span class="num" id="2736891">1</span><span class="op" id="2736892">:</span><span class="ident" id="2736893">i</span><span class="op" id="2736894">+</span><span class="num" id="2736895">1</span><span class="op" id="2736896">]</span><span class="op" id="2736897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2736901">if</span>&nbsp;<span class="ident" id="2736904">pattern</span><span class="op" id="2736911">[</span><span class="ident" id="2736912">i</span><span class="op" id="2736913">-</span><span class="ident" id="2736914">lenSuffix</span><span class="op" id="2736923">]</span>&nbsp;<span class="op" id="2736925">!=</span>&nbsp;<span class="ident" id="2736928">pattern</span><span class="op" id="2736935">[</span><span class="ident" id="2736936">last</span><span class="op" id="2736940">-</span><span class="ident" id="2736941">lenSuffix</span><span class="op" id="2736950">]</span>&nbsp;<span class="op" id="2736952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2736957">//&nbsp;(last-i)&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;lenSuffix&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737016">f</span><span class="op" id="2737017">.</span><span class="ident" id="2737018">goodSuffixSkip</span><span class="op" id="2737032">[</span><span class="ident" id="2737033">last</span><span class="op" id="2737037">-</span><span class="ident" id="2737038">lenSuffix</span><span class="op" id="2737047">]</span>&nbsp;<span class="op" id="2737049">=</span>&nbsp;<span class="ident" id="2737051">lenSuffix</span>&nbsp;<span class="op" id="2737061">+</span>&nbsp;<span class="ident" id="2737063">last</span>&nbsp;<span class="op" id="2737068">-</span>&nbsp;<span class="ident" id="2737070">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2737074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2737077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737081">return</span>&nbsp;<span class="ident" id="2737088">f</span><br>
<span class="lineno"></span><span class="op" id="2737090">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="2737093">func</span>&nbsp;<span class="ident" id="2737098">longestCommonSuffix</span><span class="op" id="2737117">(</span><span class="ident" id="2737118">a</span><span class="op" id="2737119">,</span>&nbsp;<span class="ident" id="2737121">b</span>&nbsp;<span class="builtintype" id="2737123">string</span><span class="op" id="2737129">)</span>&nbsp;<span class="op" id="2737131">(</span><span class="ident" id="2737132">i</span>&nbsp;<span class="builtintype" id="2737134">int</span><span class="op" id="2737137">)</span>&nbsp;<span class="op" id="2737139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737142">for</span>&nbsp;<span class="op" id="2737146">;</span>&nbsp;<span class="ident" id="2737148">i</span>&nbsp;<span class="op" id="2737150">&lt;</span>&nbsp;<span class="builtinfunc" id="2737152">len</span><span class="op" id="2737155">(</span><span class="ident" id="2737156">a</span><span class="op" id="2737157">)</span>&nbsp;<span class="op" id="2737159">&amp;&amp;</span>&nbsp;<span class="ident" id="2737162">i</span>&nbsp;<span class="op" id="2737164">&lt;</span>&nbsp;<span class="builtinfunc" id="2737166">len</span><span class="op" id="2737169">(</span><span class="ident" id="2737170">b</span><span class="op" id="2737171">)</span><span class="op" id="2737172">;</span>&nbsp;<span class="ident" id="2737174">i</span><span class="op" id="2737175">++</span>&nbsp;<span class="op" id="2737178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737182">if</span>&nbsp;<span class="ident" id="2737185">a</span><span class="op" id="2737186">[</span><span class="builtinfunc" id="2737187">len</span><span class="op" id="2737190">(</span><span class="ident" id="2737191">a</span><span class="op" id="2737192">)</span><span class="op" id="2737193">-</span><span class="num" id="2737194">1</span><span class="op" id="2737195">-</span><span class="ident" id="2737196">i</span><span class="op" id="2737197">]</span>&nbsp;<span class="op" id="2737199">!=</span>&nbsp;<span class="ident" id="2737202">b</span><span class="op" id="2737203">[</span><span class="builtinfunc" id="2737204">len</span><span class="op" id="2737207">(</span><span class="ident" id="2737208">b</span><span class="op" id="2737209">)</span><span class="op" id="2737210">-</span><span class="num" id="2737211">1</span><span class="op" id="2737212">-</span><span class="ident" id="2737213">i</span><span class="op" id="2737214">]</span>&nbsp;<span class="op" id="2737216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737221">break</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2737229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2737232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737235">return</span><br>
<span class="lineno"></span><span class="op" id="2737242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2737245">//&nbsp;next&nbsp;returns&nbsp;the&nbsp;index&nbsp;in&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;the&nbsp;pattern.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="2737322">//&nbsp;the&nbsp;pattern&nbsp;is&nbsp;not&nbsp;found,&nbsp;it&nbsp;returns&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2737366">func</span>&nbsp;<span class="op" id="2737371">(</span><span class="ident" id="2737372">f</span>&nbsp;<span class="op" id="2737374">*</span><span class="ident" id="2737375">stringFinder</span><span class="op" id="2737387">)</span>&nbsp;<span class="ident" id="2737389">next</span><span class="op" id="2737393">(</span><span class="ident" id="2737394">text</span>&nbsp;<span class="builtintype" id="2737399">string</span><span class="op" id="2737405">)</span>&nbsp;<span class="builtintype" id="2737407">int</span>&nbsp;<span class="op" id="2737411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737414">i</span>&nbsp;<span class="op" id="2737416">:=</span>&nbsp;<span class="builtinfunc" id="2737419">len</span><span class="op" id="2737422">(</span><span class="ident" id="2737423">f</span><span class="op" id="2737424">.</span><span class="ident" id="2737425">pattern</span><span class="op" id="2737432">)</span>&nbsp;<span class="op" id="2737434">-</span>&nbsp;<span class="num" id="2737436">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737439">for</span>&nbsp;<span class="ident" id="2737443">i</span>&nbsp;<span class="op" id="2737445">&lt;</span>&nbsp;<span class="builtinfunc" id="2737447">len</span><span class="op" id="2737450">(</span><span class="ident" id="2737451">text</span><span class="op" id="2737455">)</span>&nbsp;<span class="op" id="2737457">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2737461">//&nbsp;Compare&nbsp;backwards&nbsp;from&nbsp;the&nbsp;end&nbsp;until&nbsp;the&nbsp;first&nbsp;unmatching&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737535">j</span>&nbsp;<span class="op" id="2737537">:=</span>&nbsp;<span class="builtinfunc" id="2737540">len</span><span class="op" id="2737543">(</span><span class="ident" id="2737544">f</span><span class="op" id="2737545">.</span><span class="ident" id="2737546">pattern</span><span class="op" id="2737553">)</span>&nbsp;<span class="op" id="2737555">-</span>&nbsp;<span class="num" id="2737557">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737561">for</span>&nbsp;<span class="ident" id="2737565">j</span>&nbsp;<span class="op" id="2737567">&gt;=</span>&nbsp;<span class="num" id="2737570">0</span>&nbsp;<span class="op" id="2737572">&amp;&amp;</span>&nbsp;<span class="ident" id="2737575">text</span><span class="op" id="2737579">[</span><span class="ident" id="2737580">i</span><span class="op" id="2737581">]</span>&nbsp;<span class="op" id="2737583">==</span>&nbsp;<span class="ident" id="2737586">f</span><span class="op" id="2737587">.</span><span class="ident" id="2737588">pattern</span><span class="op" id="2737595">[</span><span class="ident" id="2737596">j</span><span class="op" id="2737597">]</span>&nbsp;<span class="op" id="2737599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737604">i</span><span class="op" id="2737605">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737611">j</span><span class="op" id="2737612">--</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2737617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737621">if</span>&nbsp;<span class="ident" id="2737624">j</span>&nbsp;<span class="op" id="2737626">&lt;</span>&nbsp;<span class="num" id="2737628">0</span>&nbsp;<span class="op" id="2737630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737635">return</span>&nbsp;<span class="ident" id="2737642">i</span>&nbsp;<span class="op" id="2737644">+</span>&nbsp;<span class="num" id="2737646">1</span>&nbsp;<span class="comment" id="2737648">//&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2737659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737663">i</span>&nbsp;<span class="op" id="2737665">+=</span>&nbsp;<span class="ident" id="2737668">max</span><span class="op" id="2737671">(</span><span class="ident" id="2737672">f</span><span class="op" id="2737673">.</span><span class="ident" id="2737674">badCharSkip</span><span class="op" id="2737685">[</span><span class="ident" id="2737686">text</span><span class="op" id="2737690">[</span><span class="ident" id="2737691">i</span><span class="op" id="2737692">]</span><span class="op" id="2737693">]</span><span class="op" id="2737694">,</span>&nbsp;<span class="ident" id="2737696">f</span><span class="op" id="2737697">.</span><span class="ident" id="2737698">goodSuffixSkip</span><span class="op" id="2737712">[</span><span class="ident" id="2737713">j</span><span class="op" id="2737714">]</span><span class="op" id="2737715">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2737718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737721">return</span>&nbsp;<span class="op" id="2737728">-</span><span class="num" id="2737729">1</span><br>
<span class="lineno"></span><span class="op" id="2737731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2737734">func</span>&nbsp;<span class="ident" id="2737739">max</span><span class="op" id="2737742">(</span><span class="ident" id="2737743">a</span><span class="op" id="2737744">,</span>&nbsp;<span class="ident" id="2737746">b</span>&nbsp;<span class="builtintype" id="2737748">int</span><span class="op" id="2737751">)</span>&nbsp;<span class="builtintype" id="2737753">int</span>&nbsp;<span class="op" id="2737757">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737760">if</span>&nbsp;<span class="ident" id="2737763">a</span>&nbsp;<span class="op" id="2737765">&gt;</span>&nbsp;<span class="ident" id="2737767">b</span>&nbsp;<span class="op" id="2737769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737773">return</span>&nbsp;<span class="ident" id="2737780">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2737783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737786">return</span>&nbsp;<span class="ident" id="2737793">b</span><br>
<span class="lineno"></span><span class="op" id="2737795">}</span>
</div>
</body>
</html>
