<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8523605">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8523660">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8523714">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8523765">package</span>&nbsp;<span class="ident" id="8523773">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8523778">import</span>&nbsp;<span class="op" id="8523785">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8523788">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8523797">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8523813">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8523822">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8523837">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8523848">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8523858">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="8523861">//&nbsp;header,&nbsp;palette&nbsp;and&nbsp;trailer&nbsp;are&nbsp;parts&nbsp;of&nbsp;a&nbsp;valid&nbsp;2x1&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="8523928">const</span>&nbsp;<span class="op" id="8523934">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523937">headerStr</span>&nbsp;<span class="op" id="8523947">=</span>&nbsp;<span class="string" id="8523949">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="8523958">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8523962">&#34;\x02\x00\x01\x00&#34;</span>&nbsp;<span class="op" id="8523981">+</span>&nbsp;<span class="comment" id="8523983">//&nbsp;width=2,&nbsp;height=1</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8524006">&#34;\x80\x00\x00&#34;</span>&nbsp;<span class="comment" id="8524021">//&nbsp;headerFields=(a&nbsp;color&nbsp;map&nbsp;of&nbsp;2&nbsp;pixels),&nbsp;backgroundIndex,&nbsp;aspect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524089">paletteStr</span>&nbsp;<span class="op" id="8524100">=</span>&nbsp;<span class="string" id="8524102">&#34;\x10\x20\x30\x40\x50\x60&#34;</span>&nbsp;<span class="comment" id="8524129">//&nbsp;the&nbsp;color&nbsp;map,&nbsp;also&nbsp;known&nbsp;as&nbsp;a&nbsp;palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524172">trailerStr</span>&nbsp;<span class="op" id="8524183">=</span>&nbsp;<span class="string" id="8524185">&#34;\x3b&#34;</span><br>
<span class="lineno"></span><span class="op" id="8524192">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="8524195">//&nbsp;lzwEncode&nbsp;returns&nbsp;an&nbsp;LZW&nbsp;encoding&nbsp;(with&nbsp;2-bit&nbsp;literals)&nbsp;of&nbsp;n&nbsp;zeroes.</span><br>
<span class="lineno"></span><span class="keyword" id="8524267">func</span>&nbsp;<span class="ident" id="8524272">lzwEncode</span><span class="op" id="8524281">(</span><span class="ident" id="8524282">n</span>&nbsp;<span class="builtintype" id="8524284">int</span><span class="op" id="8524287">)</span>&nbsp;<span class="op" id="8524289">[</span><span class="op" id="8524290">]</span><span class="builtintype" id="8524291">byte</span>&nbsp;<span class="op" id="8524296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524299">b</span>&nbsp;<span class="op" id="8524301">:=</span>&nbsp;<span class="op" id="8524304">&amp;</span><span class="ident" id="8524305">bytes</span><span class="op" id="8524310">.</span><span class="ident" id="8524311">Buffer</span><span class="op" id="8524317">{</span><span class="op" id="8524318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524321">w</span>&nbsp;<span class="op" id="8524323">:=</span>&nbsp;<span class="ident" id="8524326">lzw</span><span class="op" id="8524329">.</span><span class="ident" id="8524330">NewWriter</span><span class="op" id="8524339">(</span><span class="ident" id="8524340">b</span><span class="op" id="8524341">,</span>&nbsp;<span class="ident" id="8524343">lzw</span><span class="op" id="8524346">.</span><span class="ident" id="8524347">LSB</span><span class="op" id="8524350">,</span>&nbsp;<span class="num" id="8524352">2</span><span class="op" id="8524353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524356">w</span><span class="op" id="8524357">.</span><span class="ident" id="8524358">Write</span><span class="op" id="8524363">(</span><span class="builtinfunc" id="8524364">make</span><span class="op" id="8524368">(</span><span class="op" id="8524369">[</span><span class="op" id="8524370">]</span><span class="builtintype" id="8524371">byte</span><span class="op" id="8524375">,</span>&nbsp;<span class="ident" id="8524377">n</span><span class="op" id="8524378">)</span><span class="op" id="8524379">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524382">w</span><span class="op" id="8524383">.</span><span class="ident" id="8524384">Close</span><span class="op" id="8524389">(</span><span class="op" id="8524390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524393">return</span>&nbsp;<span class="ident" id="8524400">b</span><span class="op" id="8524401">.</span><span class="ident" id="8524402">Bytes</span><span class="op" id="8524407">(</span><span class="op" id="8524408">)</span><br>
<span class="lineno"></span><span class="op" id="8524410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8524413">func</span>&nbsp;<span class="ident" id="8524418">TestDecode</span><span class="op" id="8524428">(</span><span class="ident" id="8524429">t</span>&nbsp;<span class="op" id="8524431">*</span><span class="ident" id="8524432">testing</span><span class="op" id="8524439">.</span><span class="ident" id="8524440">T</span><span class="op" id="8524441">)</span>&nbsp;<span class="op" id="8524443">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524446">testCases</span>&nbsp;<span class="op" id="8524456">:=</span>&nbsp;<span class="op" id="8524459">[</span><span class="op" id="8524460">]</span><span class="keyword" id="8524461">struct</span>&nbsp;<span class="op" id="8524468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524472">nPix</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8524480">int</span>&nbsp;&nbsp;<span class="comment" id="8524485">//&nbsp;The&nbsp;number&nbsp;of&nbsp;pixels&nbsp;in&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524530">extra</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8524538">bool</span>&nbsp;<span class="comment" id="8524543">//&nbsp;Whether&nbsp;to&nbsp;write&nbsp;an&nbsp;extra&nbsp;block&nbsp;after&nbsp;the&nbsp;LZW-encoded&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524608">wantErr</span>&nbsp;<span class="builtintype" id="8524616">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524623">}</span><span class="op" id="8524624">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524628">{</span><span class="num" id="8524629">0</span><span class="op" id="8524630">,</span>&nbsp;<span class="builtintype" id="8524632">false</span><span class="op" id="8524637">,</span>&nbsp;<span class="ident" id="8524639">errNotEnough</span><span class="op" id="8524651">}</span><span class="op" id="8524652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524656">{</span><span class="num" id="8524657">1</span><span class="op" id="8524658">,</span>&nbsp;<span class="builtintype" id="8524660">false</span><span class="op" id="8524665">,</span>&nbsp;<span class="ident" id="8524667">errNotEnough</span><span class="op" id="8524679">}</span><span class="op" id="8524680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524684">{</span><span class="num" id="8524685">2</span><span class="op" id="8524686">,</span>&nbsp;<span class="builtintype" id="8524688">false</span><span class="op" id="8524693">,</span>&nbsp;<span class="ident" id="8524695">nil</span><span class="op" id="8524698">}</span><span class="op" id="8524699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524703">{</span><span class="num" id="8524704">2</span><span class="op" id="8524705">,</span>&nbsp;<span class="builtintype" id="8524707">true</span><span class="op" id="8524711">,</span>&nbsp;<span class="ident" id="8524713">errTooMuch</span><span class="op" id="8524723">}</span><span class="op" id="8524724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524728">{</span><span class="num" id="8524729">3</span><span class="op" id="8524730">,</span>&nbsp;<span class="builtintype" id="8524732">false</span><span class="op" id="8524737">,</span>&nbsp;<span class="ident" id="8524739">errTooMuch</span><span class="op" id="8524749">}</span><span class="op" id="8524750">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524756">for</span>&nbsp;<span class="ident" id="8524760">_</span><span class="op" id="8524761">,</span>&nbsp;<span class="ident" id="8524763">tc</span>&nbsp;<span class="op" id="8524766">:=</span>&nbsp;<span class="keyword" id="8524769">range</span>&nbsp;<span class="ident" id="8524775">testCases</span>&nbsp;<span class="op" id="8524785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524789">b</span>&nbsp;<span class="op" id="8524791">:=</span>&nbsp;<span class="op" id="8524794">&amp;</span><span class="ident" id="8524795">bytes</span><span class="op" id="8524800">.</span><span class="ident" id="8524801">Buffer</span><span class="op" id="8524807">{</span><span class="op" id="8524808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524812">b</span><span class="op" id="8524813">.</span><span class="ident" id="8524814">WriteString</span><span class="op" id="8524825">(</span><span class="ident" id="8524826">headerStr</span><span class="op" id="8524835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524839">b</span><span class="op" id="8524840">.</span><span class="ident" id="8524841">WriteString</span><span class="op" id="8524852">(</span><span class="ident" id="8524853">paletteStr</span><span class="op" id="8524863">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8524867">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1&nbsp;but&nbsp;tc.nPix&nbsp;pixels.&nbsp;If&nbsp;tc.nPix&nbsp;!=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8524939">//&nbsp;then&nbsp;this&nbsp;should&nbsp;result&nbsp;in&nbsp;an&nbsp;invalid&nbsp;GIF&nbsp;image.&nbsp;First,&nbsp;write&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8525008">//&nbsp;magic&nbsp;0x2c&nbsp;(image&nbsp;descriptor)&nbsp;byte,&nbsp;bounds=(0,0)-(2,1),&nbsp;a&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8525077">//&nbsp;byte,&nbsp;and&nbsp;2-bit&nbsp;LZW&nbsp;literals.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525112">b</span><span class="op" id="8525113">.</span><span class="ident" id="8525114">WriteString</span><span class="op" id="8525125">(</span><span class="string" id="8525126">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="8525172">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525176">if</span>&nbsp;<span class="ident" id="8525179">tc</span><span class="op" id="8525181">.</span><span class="ident" id="8525182">nPix</span>&nbsp;<span class="op" id="8525187">&gt;</span>&nbsp;<span class="num" id="8525189">0</span>&nbsp;<span class="op" id="8525191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525196">enc</span>&nbsp;<span class="op" id="8525200">:=</span>&nbsp;<span class="ident" id="8525203">lzwEncode</span><span class="op" id="8525212">(</span><span class="ident" id="8525213">tc</span><span class="op" id="8525215">.</span><span class="ident" id="8525216">nPix</span><span class="op" id="8525220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525225">if</span>&nbsp;<span class="builtinfunc" id="8525228">len</span><span class="op" id="8525231">(</span><span class="ident" id="8525232">enc</span><span class="op" id="8525235">)</span>&nbsp;<span class="op" id="8525237">&gt;</span>&nbsp;<span class="num" id="8525239">0xff</span>&nbsp;<span class="op" id="8525244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525250">t</span><span class="op" id="8525251">.</span><span class="ident" id="8525252">Errorf</span><span class="op" id="8525258">(</span><span class="string" id="8525259">&#34;nPix=%d,&nbsp;extra=%t:&nbsp;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="8525313">,</span>&nbsp;<span class="ident" id="8525315">tc</span><span class="op" id="8525317">.</span><span class="ident" id="8525318">nPix</span><span class="op" id="8525322">,</span>&nbsp;<span class="ident" id="8525324">tc</span><span class="op" id="8525326">.</span><span class="ident" id="8525327">extra</span><span class="op" id="8525332">,</span>&nbsp;<span class="builtinfunc" id="8525334">len</span><span class="op" id="8525337">(</span><span class="ident" id="8525338">enc</span><span class="op" id="8525341">)</span><span class="op" id="8525342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525348">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525365">b</span><span class="op" id="8525366">.</span><span class="ident" id="8525367">WriteByte</span><span class="op" id="8525376">(</span><span class="builtintype" id="8525377">byte</span><span class="op" id="8525381">(</span><span class="builtinfunc" id="8525382">len</span><span class="op" id="8525385">(</span><span class="ident" id="8525386">enc</span><span class="op" id="8525389">)</span><span class="op" id="8525390">)</span><span class="op" id="8525391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525396">b</span><span class="op" id="8525397">.</span><span class="ident" id="8525398">Write</span><span class="op" id="8525403">(</span><span class="ident" id="8525404">enc</span><span class="op" id="8525407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525415">if</span>&nbsp;<span class="ident" id="8525418">tc</span><span class="op" id="8525420">.</span><span class="ident" id="8525421">extra</span>&nbsp;<span class="op" id="8525427">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525432">b</span><span class="op" id="8525433">.</span><span class="ident" id="8525434">WriteString</span><span class="op" id="8525445">(</span><span class="string" id="8525446">&#34;\x01\x02&#34;</span><span class="op" id="8525456">)</span>&nbsp;<span class="comment" id="8525458">//&nbsp;A&nbsp;1-byte&nbsp;payload&nbsp;with&nbsp;an&nbsp;0x02&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525503">b</span><span class="op" id="8525504">.</span><span class="ident" id="8525505">WriteByte</span><span class="op" id="8525514">(</span><span class="num" id="8525515">0x00</span><span class="op" id="8525519">)</span>&nbsp;<span class="comment" id="8525521">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525578">b</span><span class="op" id="8525579">.</span><span class="ident" id="8525580">WriteString</span><span class="op" id="8525591">(</span><span class="ident" id="8525592">trailerStr</span><span class="op" id="8525602">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525607">got</span><span class="op" id="8525610">,</span>&nbsp;<span class="ident" id="8525612">err</span>&nbsp;<span class="op" id="8525616">:=</span>&nbsp;<span class="ident" id="8525619">Decode</span><span class="op" id="8525625">(</span><span class="ident" id="8525626">b</span><span class="op" id="8525627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525631">if</span>&nbsp;<span class="ident" id="8525634">err</span>&nbsp;<span class="op" id="8525638">!=</span>&nbsp;<span class="ident" id="8525641">tc</span><span class="op" id="8525643">.</span><span class="ident" id="8525644">wantErr</span>&nbsp;<span class="op" id="8525652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525657">t</span><span class="op" id="8525658">.</span><span class="ident" id="8525659">Errorf</span><span class="op" id="8525665">(</span><span class="string" id="8525666">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="8525703">,</span>&nbsp;<span class="ident" id="8525705">tc</span><span class="op" id="8525707">.</span><span class="ident" id="8525708">nPix</span><span class="op" id="8525712">,</span>&nbsp;<span class="ident" id="8525714">tc</span><span class="op" id="8525716">.</span><span class="ident" id="8525717">extra</span><span class="op" id="8525722">,</span>&nbsp;<span class="ident" id="8525724">err</span><span class="op" id="8525727">,</span>&nbsp;<span class="ident" id="8525729">tc</span><span class="op" id="8525731">.</span><span class="ident" id="8525732">wantErr</span><span class="op" id="8525739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525748">if</span>&nbsp;<span class="ident" id="8525751">tc</span><span class="op" id="8525753">.</span><span class="ident" id="8525754">wantErr</span>&nbsp;<span class="op" id="8525762">!=</span>&nbsp;<span class="ident" id="8525765">nil</span>&nbsp;<span class="op" id="8525769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525774">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525789">want</span>&nbsp;<span class="op" id="8525794">:=</span>&nbsp;<span class="op" id="8525797">&amp;</span><span class="ident" id="8525798">image</span><span class="op" id="8525803">.</span><span class="ident" id="8525804">Paletted</span><span class="op" id="8525812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525817">Pix</span><span class="op" id="8525820">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525825">[</span><span class="op" id="8525826">]</span><span class="builtintype" id="8525827">uint8</span><span class="op" id="8525832">{</span><span class="num" id="8525833">0</span><span class="op" id="8525834">,</span>&nbsp;<span class="num" id="8525836">0</span><span class="op" id="8525837">}</span><span class="op" id="8525838">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525843">Stride</span><span class="op" id="8525849">:</span>&nbsp;<span class="num" id="8525851">2</span><span class="op" id="8525852">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525857">Rect</span><span class="op" id="8525861">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8525865">image</span><span class="op" id="8525870">.</span><span class="ident" id="8525871">Rect</span><span class="op" id="8525875">(</span><span class="num" id="8525876">0</span><span class="op" id="8525877">,</span>&nbsp;<span class="num" id="8525879">0</span><span class="op" id="8525880">,</span>&nbsp;<span class="num" id="8525882">2</span><span class="op" id="8525883">,</span>&nbsp;<span class="num" id="8525885">1</span><span class="op" id="8525886">)</span><span class="op" id="8525887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525892">Palette</span><span class="op" id="8525899">:</span>&nbsp;<span class="ident" id="8525901">color</span><span class="op" id="8525906">.</span><span class="ident" id="8525907">Palette</span><span class="op" id="8525914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525920">color</span><span class="op" id="8525925">.</span><span class="ident" id="8525926">RGBA</span><span class="op" id="8525930">{</span><span class="num" id="8525931">0x10</span><span class="op" id="8525935">,</span>&nbsp;<span class="num" id="8525937">0x20</span><span class="op" id="8525941">,</span>&nbsp;<span class="num" id="8525943">0x30</span><span class="op" id="8525947">,</span>&nbsp;<span class="num" id="8525949">0xff</span><span class="op" id="8525953">}</span><span class="op" id="8525954">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525960">color</span><span class="op" id="8525965">.</span><span class="ident" id="8525966">RGBA</span><span class="op" id="8525970">{</span><span class="num" id="8525971">0x40</span><span class="op" id="8525975">,</span>&nbsp;<span class="num" id="8525977">0x50</span><span class="op" id="8525981">,</span>&nbsp;<span class="num" id="8525983">0x60</span><span class="op" id="8525987">,</span>&nbsp;<span class="num" id="8525989">0xff</span><span class="op" id="8525993">}</span><span class="op" id="8525994">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525999">}</span><span class="op" id="8526000">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526008">if</span>&nbsp;<span class="op" id="8526011">!</span><span class="ident" id="8526012">reflect</span><span class="op" id="8526019">.</span><span class="ident" id="8526020">DeepEqual</span><span class="op" id="8526029">(</span><span class="ident" id="8526030">got</span><span class="op" id="8526033">,</span>&nbsp;<span class="ident" id="8526035">want</span><span class="op" id="8526039">)</span>&nbsp;<span class="op" id="8526041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526046">t</span><span class="op" id="8526047">.</span><span class="ident" id="8526048">Errorf</span><span class="op" id="8526054">(</span><span class="string" id="8526055">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="8526092">,</span>&nbsp;<span class="ident" id="8526094">tc</span><span class="op" id="8526096">.</span><span class="ident" id="8526097">nPix</span><span class="op" id="8526101">,</span>&nbsp;<span class="ident" id="8526103">tc</span><span class="op" id="8526105">.</span><span class="ident" id="8526106">extra</span><span class="op" id="8526111">,</span>&nbsp;<span class="ident" id="8526113">got</span><span class="op" id="8526116">,</span>&nbsp;<span class="ident" id="8526118">want</span><span class="op" id="8526122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526126">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526129">}</span><br>
<span class="lineno"></span><span class="op" id="8526131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8526134">func</span>&nbsp;<span class="ident" id="8526139">TestTransparentIndex</span><span class="op" id="8526159">(</span><span class="ident" id="8526160">t</span>&nbsp;<span class="op" id="8526162">*</span><span class="ident" id="8526163">testing</span><span class="op" id="8526170">.</span><span class="ident" id="8526171">T</span><span class="op" id="8526172">)</span>&nbsp;<span class="op" id="8526174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526177">b</span>&nbsp;<span class="op" id="8526179">:=</span>&nbsp;<span class="op" id="8526182">&amp;</span><span class="ident" id="8526183">bytes</span><span class="op" id="8526188">.</span><span class="ident" id="8526189">Buffer</span><span class="op" id="8526195">{</span><span class="op" id="8526196">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526199">b</span><span class="op" id="8526200">.</span><span class="ident" id="8526201">WriteString</span><span class="op" id="8526212">(</span><span class="ident" id="8526213">headerStr</span><span class="op" id="8526222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526225">b</span><span class="op" id="8526226">.</span><span class="ident" id="8526227">WriteString</span><span class="op" id="8526238">(</span><span class="ident" id="8526239">paletteStr</span><span class="op" id="8526249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526252">for</span>&nbsp;<span class="ident" id="8526256">transparentIndex</span>&nbsp;<span class="op" id="8526273">:=</span>&nbsp;<span class="num" id="8526276">0</span><span class="op" id="8526277">;</span>&nbsp;<span class="ident" id="8526279">transparentIndex</span>&nbsp;<span class="op" id="8526296">&lt;</span>&nbsp;<span class="num" id="8526298">3</span><span class="op" id="8526299">;</span>&nbsp;<span class="ident" id="8526301">transparentIndex</span><span class="op" id="8526317">++</span>&nbsp;<span class="op" id="8526320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526324">if</span>&nbsp;<span class="ident" id="8526327">transparentIndex</span>&nbsp;<span class="op" id="8526344">&lt;</span>&nbsp;<span class="num" id="8526346">2</span>&nbsp;<span class="op" id="8526348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8526353">//&nbsp;Write&nbsp;the&nbsp;graphic&nbsp;control&nbsp;for&nbsp;the&nbsp;transparent&nbsp;index.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526412">b</span><span class="op" id="8526413">.</span><span class="ident" id="8526414">WriteString</span><span class="op" id="8526425">(</span><span class="string" id="8526426">&#34;\x21\xf9\x00\x01\x00\x00&#34;</span><span class="op" id="8526452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526457">b</span><span class="op" id="8526458">.</span><span class="ident" id="8526459">WriteByte</span><span class="op" id="8526468">(</span><span class="builtintype" id="8526469">byte</span><span class="op" id="8526473">(</span><span class="ident" id="8526474">transparentIndex</span><span class="op" id="8526490">)</span><span class="op" id="8526491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526496">b</span><span class="op" id="8526497">.</span><span class="ident" id="8526498">WriteByte</span><span class="op" id="8526507">(</span><span class="num" id="8526508">0</span><span class="op" id="8526509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8526517">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1,&nbsp;as&nbsp;per&nbsp;TestDecode.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526573">b</span><span class="op" id="8526574">.</span><span class="ident" id="8526575">WriteString</span><span class="op" id="8526586">(</span><span class="string" id="8526587">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="8526633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526637">enc</span>&nbsp;<span class="op" id="8526641">:=</span>&nbsp;<span class="ident" id="8526644">lzwEncode</span><span class="op" id="8526653">(</span><span class="num" id="8526654">2</span><span class="op" id="8526655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526659">if</span>&nbsp;<span class="builtinfunc" id="8526662">len</span><span class="op" id="8526665">(</span><span class="ident" id="8526666">enc</span><span class="op" id="8526669">)</span>&nbsp;<span class="op" id="8526671">&gt;</span>&nbsp;<span class="num" id="8526673">0xff</span>&nbsp;<span class="op" id="8526678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526683">t</span><span class="op" id="8526684">.</span><span class="ident" id="8526685">Fatalf</span><span class="op" id="8526691">(</span><span class="string" id="8526692">&#34;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="8526727">,</span>&nbsp;<span class="builtinfunc" id="8526729">len</span><span class="op" id="8526732">(</span><span class="ident" id="8526733">enc</span><span class="op" id="8526736">)</span><span class="op" id="8526737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526741">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526745">b</span><span class="op" id="8526746">.</span><span class="ident" id="8526747">WriteByte</span><span class="op" id="8526756">(</span><span class="builtintype" id="8526757">byte</span><span class="op" id="8526761">(</span><span class="builtinfunc" id="8526762">len</span><span class="op" id="8526765">(</span><span class="ident" id="8526766">enc</span><span class="op" id="8526769">)</span><span class="op" id="8526770">)</span><span class="op" id="8526771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526775">b</span><span class="op" id="8526776">.</span><span class="ident" id="8526777">Write</span><span class="op" id="8526782">(</span><span class="ident" id="8526783">enc</span><span class="op" id="8526786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526790">b</span><span class="op" id="8526791">.</span><span class="ident" id="8526792">WriteByte</span><span class="op" id="8526801">(</span><span class="num" id="8526802">0x00</span><span class="op" id="8526806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526812">b</span><span class="op" id="8526813">.</span><span class="ident" id="8526814">WriteString</span><span class="op" id="8526825">(</span><span class="ident" id="8526826">trailerStr</span><span class="op" id="8526836">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526840">g</span><span class="op" id="8526841">,</span>&nbsp;<span class="ident" id="8526843">err</span>&nbsp;<span class="op" id="8526847">:=</span>&nbsp;<span class="ident" id="8526850">DecodeAll</span><span class="op" id="8526859">(</span><span class="ident" id="8526860">b</span><span class="op" id="8526861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526864">if</span>&nbsp;<span class="ident" id="8526867">err</span>&nbsp;<span class="op" id="8526871">!=</span>&nbsp;<span class="ident" id="8526874">nil</span>&nbsp;<span class="op" id="8526878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526882">t</span><span class="op" id="8526883">.</span><span class="ident" id="8526884">Fatalf</span><span class="op" id="8526890">(</span><span class="string" id="8526891">&#34;DecodeAll:&nbsp;%v&#34;</span><span class="op" id="8526906">,</span>&nbsp;<span class="ident" id="8526908">err</span><span class="op" id="8526911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526914">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526917">c0</span>&nbsp;<span class="op" id="8526920">:=</span>&nbsp;<span class="ident" id="8526923">color</span><span class="op" id="8526928">.</span><span class="ident" id="8526929">RGBA</span><span class="op" id="8526933">{</span><span class="ident" id="8526934">paletteStr</span><span class="op" id="8526944">[</span><span class="num" id="8526945">0</span><span class="op" id="8526946">]</span><span class="op" id="8526947">,</span>&nbsp;<span class="ident" id="8526949">paletteStr</span><span class="op" id="8526959">[</span><span class="num" id="8526960">1</span><span class="op" id="8526961">]</span><span class="op" id="8526962">,</span>&nbsp;<span class="ident" id="8526964">paletteStr</span><span class="op" id="8526974">[</span><span class="num" id="8526975">2</span><span class="op" id="8526976">]</span><span class="op" id="8526977">,</span>&nbsp;<span class="num" id="8526979">0xff</span><span class="op" id="8526983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526986">c1</span>&nbsp;<span class="op" id="8526989">:=</span>&nbsp;<span class="ident" id="8526992">color</span><span class="op" id="8526997">.</span><span class="ident" id="8526998">RGBA</span><span class="op" id="8527002">{</span><span class="ident" id="8527003">paletteStr</span><span class="op" id="8527013">[</span><span class="num" id="8527014">3</span><span class="op" id="8527015">]</span><span class="op" id="8527016">,</span>&nbsp;<span class="ident" id="8527018">paletteStr</span><span class="op" id="8527028">[</span><span class="num" id="8527029">4</span><span class="op" id="8527030">]</span><span class="op" id="8527031">,</span>&nbsp;<span class="ident" id="8527033">paletteStr</span><span class="op" id="8527043">[</span><span class="num" id="8527044">5</span><span class="op" id="8527045">]</span><span class="op" id="8527046">,</span>&nbsp;<span class="num" id="8527048">0xff</span><span class="op" id="8527052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527055">cz</span>&nbsp;<span class="op" id="8527058">:=</span>&nbsp;<span class="ident" id="8527061">color</span><span class="op" id="8527066">.</span><span class="ident" id="8527067">RGBA</span><span class="op" id="8527071">{</span><span class="op" id="8527072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527075">wants</span>&nbsp;<span class="op" id="8527081">:=</span>&nbsp;<span class="op" id="8527084">[</span><span class="op" id="8527085">]</span><span class="ident" id="8527086">color</span><span class="op" id="8527091">.</span><span class="ident" id="8527092">Palette</span><span class="op" id="8527099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527103">{</span><span class="ident" id="8527104">cz</span><span class="op" id="8527106">,</span>&nbsp;<span class="ident" id="8527108">c1</span><span class="op" id="8527110">}</span><span class="op" id="8527111">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527115">{</span><span class="ident" id="8527116">c0</span><span class="op" id="8527118">,</span>&nbsp;<span class="ident" id="8527120">cz</span><span class="op" id="8527122">}</span><span class="op" id="8527123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527127">{</span><span class="ident" id="8527128">c0</span><span class="op" id="8527130">,</span>&nbsp;<span class="ident" id="8527132">c1</span><span class="op" id="8527134">}</span><span class="op" id="8527135">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527141">if</span>&nbsp;<span class="builtinfunc" id="8527144">len</span><span class="op" id="8527147">(</span><span class="ident" id="8527148">g</span><span class="op" id="8527149">.</span><span class="ident" id="8527150">Image</span><span class="op" id="8527155">)</span>&nbsp;<span class="op" id="8527157">!=</span>&nbsp;<span class="builtinfunc" id="8527160">len</span><span class="op" id="8527163">(</span><span class="ident" id="8527164">wants</span><span class="op" id="8527169">)</span>&nbsp;<span class="op" id="8527171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527175">t</span><span class="op" id="8527176">.</span><span class="ident" id="8527177">Fatalf</span><span class="op" id="8527183">(</span><span class="string" id="8527184">&#34;got&nbsp;%d&nbsp;images,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8527208">,</span>&nbsp;<span class="builtinfunc" id="8527210">len</span><span class="op" id="8527213">(</span><span class="ident" id="8527214">g</span><span class="op" id="8527215">.</span><span class="ident" id="8527216">Image</span><span class="op" id="8527221">)</span><span class="op" id="8527222">,</span>&nbsp;<span class="builtinfunc" id="8527224">len</span><span class="op" id="8527227">(</span><span class="ident" id="8527228">wants</span><span class="op" id="8527233">)</span><span class="op" id="8527234">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527240">for</span>&nbsp;<span class="ident" id="8527244">i</span><span class="op" id="8527245">,</span>&nbsp;<span class="ident" id="8527247">want</span>&nbsp;<span class="op" id="8527252">:=</span>&nbsp;<span class="keyword" id="8527255">range</span>&nbsp;<span class="ident" id="8527261">wants</span>&nbsp;<span class="op" id="8527267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527271">got</span>&nbsp;<span class="op" id="8527275">:=</span>&nbsp;<span class="ident" id="8527278">g</span><span class="op" id="8527279">.</span><span class="ident" id="8527280">Image</span><span class="op" id="8527285">[</span><span class="ident" id="8527286">i</span><span class="op" id="8527287">]</span><span class="op" id="8527288">.</span><span class="ident" id="8527289">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527299">if</span>&nbsp;<span class="op" id="8527302">!</span><span class="ident" id="8527303">reflect</span><span class="op" id="8527310">.</span><span class="ident" id="8527311">DeepEqual</span><span class="op" id="8527320">(</span><span class="ident" id="8527321">got</span><span class="op" id="8527324">,</span>&nbsp;<span class="ident" id="8527326">want</span><span class="op" id="8527330">)</span>&nbsp;<span class="op" id="8527332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527337">t</span><span class="op" id="8527338">.</span><span class="ident" id="8527339">Errorf</span><span class="op" id="8527345">(</span><span class="string" id="8527346">&#34;palette&nbsp;#%d:\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="8527378">,</span>&nbsp;<span class="ident" id="8527380">i</span><span class="op" id="8527381">,</span>&nbsp;<span class="ident" id="8527383">got</span><span class="op" id="8527386">,</span>&nbsp;<span class="ident" id="8527388">want</span><span class="op" id="8527392">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527399">}</span><br>
<span class="lineno"></span><span class="op" id="8527401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8527404">//&nbsp;testGIF&nbsp;is&nbsp;a&nbsp;simple&nbsp;GIF&nbsp;that&nbsp;we&nbsp;can&nbsp;modify&nbsp;to&nbsp;test&nbsp;different&nbsp;scenarios.</span><br>
<span class="lineno">140</span><span class="keyword" id="8527479">var</span>&nbsp;<span class="ident" id="8527483">testGIF</span>&nbsp;<span class="op" id="8527491">=</span>&nbsp;<span class="op" id="8527493">[</span><span class="op" id="8527494">]</span><span class="builtintype" id="8527495">byte</span><span class="op" id="8527499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8527502">&#39;G&#39;</span><span class="op" id="8527505">,</span>&nbsp;<span class="string" id="8527507">&#39;I&#39;</span><span class="op" id="8527510">,</span>&nbsp;<span class="string" id="8527512">&#39;F&#39;</span><span class="op" id="8527515">,</span>&nbsp;<span class="string" id="8527517">&#39;8&#39;</span><span class="op" id="8527520">,</span>&nbsp;<span class="string" id="8527522">&#39;9&#39;</span><span class="op" id="8527525">,</span>&nbsp;<span class="string" id="8527527">&#39;a&#39;</span><span class="op" id="8527530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8527533">1</span><span class="op" id="8527534">,</span>&nbsp;<span class="num" id="8527536">0</span><span class="op" id="8527537">,</span>&nbsp;<span class="num" id="8527539">1</span><span class="op" id="8527540">,</span>&nbsp;<span class="num" id="8527542">0</span><span class="op" id="8527543">,</span>&nbsp;<span class="comment" id="8527545">//&nbsp;w=1,&nbsp;h=1&nbsp;(6)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8527562">128</span><span class="op" id="8527565">,</span>&nbsp;<span class="num" id="8527567">0</span><span class="op" id="8527568">,</span>&nbsp;<span class="num" id="8527570">0</span><span class="op" id="8527571">,</span>&nbsp;<span class="comment" id="8527573">//&nbsp;headerFields,&nbsp;bg,&nbsp;aspect&nbsp;(10)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8527607">0</span><span class="op" id="8527608">,</span>&nbsp;<span class="num" id="8527610">0</span><span class="op" id="8527611">,</span>&nbsp;<span class="num" id="8527613">0</span><span class="op" id="8527614">,</span>&nbsp;<span class="num" id="8527616">1</span><span class="op" id="8527617">,</span>&nbsp;<span class="num" id="8527619">1</span><span class="op" id="8527620">,</span>&nbsp;<span class="num" id="8527622">1</span><span class="op" id="8527623">,</span>&nbsp;<span class="comment" id="8527625">//&nbsp;color&nbsp;map&nbsp;and&nbsp;graphics&nbsp;control&nbsp;(13)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8527665">0x21</span><span class="op" id="8527669">,</span>&nbsp;<span class="num" id="8527671">0xf9</span><span class="op" id="8527675">,</span>&nbsp;<span class="num" id="8527677">0x04</span><span class="op" id="8527681">,</span>&nbsp;<span class="num" id="8527683">0x00</span><span class="op" id="8527687">,</span>&nbsp;<span class="num" id="8527689">0x00</span><span class="op" id="8527693">,</span>&nbsp;<span class="num" id="8527695">0x00</span><span class="op" id="8527699">,</span>&nbsp;<span class="num" id="8527701">0xff</span><span class="op" id="8527705">,</span>&nbsp;<span class="num" id="8527707">0x00</span><span class="op" id="8527711">,</span>&nbsp;<span class="comment" id="8527713">//&nbsp;(19)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8527722">//&nbsp;frame&nbsp;1&nbsp;(0,0&nbsp;-&nbsp;1,1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8527746">0x2c</span><span class="op" id="8527750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8527753">0x00</span><span class="op" id="8527757">,</span>&nbsp;<span class="num" id="8527759">0x00</span><span class="op" id="8527763">,</span>&nbsp;<span class="num" id="8527765">0x00</span><span class="op" id="8527769">,</span>&nbsp;<span class="num" id="8527771">0x00</span><span class="op" id="8527775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8527778">0x01</span><span class="op" id="8527782">,</span>&nbsp;<span class="num" id="8527784">0x00</span><span class="op" id="8527788">,</span>&nbsp;<span class="num" id="8527790">0x01</span><span class="op" id="8527794">,</span>&nbsp;<span class="num" id="8527796">0x00</span><span class="op" id="8527800">,</span>&nbsp;<span class="comment" id="8527802">//&nbsp;(32)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8527811">0x00</span><span class="op" id="8527815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8527818">0x02</span><span class="op" id="8527822">,</span>&nbsp;<span class="num" id="8527824">0x02</span><span class="op" id="8527828">,</span>&nbsp;<span class="num" id="8527830">0x4c</span><span class="op" id="8527834">,</span>&nbsp;<span class="num" id="8527836">0x01</span><span class="op" id="8527840">,</span>&nbsp;<span class="num" id="8527842">0x00</span><span class="op" id="8527846">,</span>&nbsp;<span class="comment" id="8527848">//&nbsp;lzw&nbsp;pixels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8527863">//&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8527875">0x3b</span><span class="op" id="8527879">,</span><br>
<span class="lineno"></span><span class="op" id="8527881">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="8527884">func</span>&nbsp;<span class="ident" id="8527889">try</span><span class="op" id="8527892">(</span><span class="ident" id="8527893">t</span>&nbsp;<span class="op" id="8527895">*</span><span class="ident" id="8527896">testing</span><span class="op" id="8527903">.</span><span class="ident" id="8527904">T</span><span class="op" id="8527905">,</span>&nbsp;<span class="ident" id="8527907">b</span>&nbsp;<span class="op" id="8527909">[</span><span class="op" id="8527910">]</span><span class="builtintype" id="8527911">byte</span><span class="op" id="8527915">,</span>&nbsp;<span class="ident" id="8527917">want</span>&nbsp;<span class="builtintype" id="8527922">string</span><span class="op" id="8527928">)</span>&nbsp;<span class="op" id="8527930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527933">_</span><span class="op" id="8527934">,</span>&nbsp;<span class="ident" id="8527936">err</span>&nbsp;<span class="op" id="8527940">:=</span>&nbsp;<span class="ident" id="8527943">DecodeAll</span><span class="op" id="8527952">(</span><span class="ident" id="8527953">bytes</span><span class="op" id="8527958">.</span><span class="ident" id="8527959">NewReader</span><span class="op" id="8527968">(</span><span class="ident" id="8527969">b</span><span class="op" id="8527970">)</span><span class="op" id="8527971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527974">var</span>&nbsp;<span class="ident" id="8527978">got</span>&nbsp;<span class="builtintype" id="8527982">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527990">if</span>&nbsp;<span class="ident" id="8527993">err</span>&nbsp;<span class="op" id="8527997">!=</span>&nbsp;<span class="ident" id="8528000">nil</span>&nbsp;<span class="op" id="8528004">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528008">got</span>&nbsp;<span class="op" id="8528012">=</span>&nbsp;<span class="ident" id="8528014">err</span><span class="op" id="8528017">.</span><span class="ident" id="8528018">Error</span><span class="op" id="8528023">(</span><span class="op" id="8528024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8528027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8528030">if</span>&nbsp;<span class="ident" id="8528033">got</span>&nbsp;<span class="op" id="8528037">!=</span>&nbsp;<span class="ident" id="8528040">want</span>&nbsp;<span class="op" id="8528045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528049">t</span><span class="op" id="8528050">.</span><span class="ident" id="8528051">Fatalf</span><span class="op" id="8528057">(</span><span class="string" id="8528058">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8528075">,</span>&nbsp;<span class="ident" id="8528077">got</span><span class="op" id="8528080">,</span>&nbsp;<span class="ident" id="8528082">want</span><span class="op" id="8528086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8528089">}</span><br>
<span class="lineno">165</span><span class="op" id="8528091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8528094">func</span>&nbsp;<span class="ident" id="8528099">TestBounds</span><span class="op" id="8528109">(</span><span class="ident" id="8528110">t</span>&nbsp;<span class="op" id="8528112">*</span><span class="ident" id="8528113">testing</span><span class="op" id="8528120">.</span><span class="ident" id="8528121">T</span><span class="op" id="8528122">)</span>&nbsp;<span class="op" id="8528124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8528127">//&nbsp;Make&nbsp;a&nbsp;local&nbsp;copy&nbsp;of&nbsp;testGIF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528161">gif</span>&nbsp;<span class="op" id="8528165">:=</span>&nbsp;<span class="builtinfunc" id="8528168">make</span><span class="op" id="8528172">(</span><span class="op" id="8528173">[</span><span class="op" id="8528174">]</span><span class="builtintype" id="8528175">byte</span><span class="op" id="8528179">,</span>&nbsp;<span class="builtinfunc" id="8528181">len</span><span class="op" id="8528184">(</span><span class="ident" id="8528185">testGIF</span><span class="op" id="8528192">)</span><span class="op" id="8528193">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8528196">copy</span><span class="op" id="8528200">(</span><span class="ident" id="8528201">gif</span><span class="op" id="8528204">,</span>&nbsp;<span class="ident" id="8528206">testGIF</span><span class="op" id="8528213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8528216">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;big,&nbsp;just&nbsp;by&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528258">gif</span><span class="op" id="8528261">[</span><span class="num" id="8528262">32</span><span class="op" id="8528264">]</span>&nbsp;<span class="op" id="8528266">=</span>&nbsp;<span class="num" id="8528268">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528271">want</span>&nbsp;<span class="op" id="8528276">:=</span>&nbsp;<span class="string" id="8528279">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528325">try</span><span class="op" id="8528328">(</span><span class="ident" id="8528329">t</span><span class="op" id="8528330">,</span>&nbsp;<span class="ident" id="8528332">gif</span><span class="op" id="8528335">,</span>&nbsp;<span class="ident" id="8528337">want</span><span class="op" id="8528341">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8528345">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;small;&nbsp;does&nbsp;not&nbsp;trigger&nbsp;bounds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8528400">//&nbsp;check,&nbsp;but&nbsp;now&nbsp;there&#39;s&nbsp;too&nbsp;much&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528442">gif</span><span class="op" id="8528445">[</span><span class="num" id="8528446">32</span><span class="op" id="8528448">]</span>&nbsp;<span class="op" id="8528450">=</span>&nbsp;<span class="num" id="8528452">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528455">want</span>&nbsp;<span class="op" id="8528460">=</span>&nbsp;<span class="string" id="8528462">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528490">try</span><span class="op" id="8528493">(</span><span class="ident" id="8528494">t</span><span class="op" id="8528495">,</span>&nbsp;<span class="ident" id="8528497">gif</span><span class="op" id="8528500">,</span>&nbsp;<span class="ident" id="8528502">want</span><span class="op" id="8528506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528509">gif</span><span class="op" id="8528512">[</span><span class="num" id="8528513">32</span><span class="op" id="8528515">]</span>&nbsp;<span class="op" id="8528517">=</span>&nbsp;<span class="num" id="8528519">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8528523">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;really&nbsp;big,&nbsp;expect&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528572">want</span>&nbsp;<span class="op" id="8528577">=</span>&nbsp;<span class="string" id="8528579">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8528625">for</span>&nbsp;<span class="ident" id="8528629">i</span>&nbsp;<span class="op" id="8528631">:=</span>&nbsp;<span class="num" id="8528634">0</span><span class="op" id="8528635">;</span>&nbsp;<span class="ident" id="8528637">i</span>&nbsp;<span class="op" id="8528639">&lt;</span>&nbsp;<span class="num" id="8528641">4</span><span class="op" id="8528642">;</span>&nbsp;<span class="ident" id="8528644">i</span><span class="op" id="8528645">++</span>&nbsp;<span class="op" id="8528648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528652">gif</span><span class="op" id="8528655">[</span><span class="num" id="8528656">32</span><span class="op" id="8528658">+</span><span class="ident" id="8528659">i</span><span class="op" id="8528660">]</span>&nbsp;<span class="op" id="8528662">=</span>&nbsp;<span class="num" id="8528664">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8528670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528673">try</span><span class="op" id="8528676">(</span><span class="ident" id="8528677">t</span><span class="op" id="8528678">,</span>&nbsp;<span class="ident" id="8528680">gif</span><span class="op" id="8528683">,</span>&nbsp;<span class="ident" id="8528685">want</span><span class="op" id="8528689">)</span><br>
<span class="lineno"></span><span class="op" id="8528691">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="8528694">func</span>&nbsp;<span class="ident" id="8528699">TestNoPalette</span><span class="op" id="8528712">(</span><span class="ident" id="8528713">t</span>&nbsp;<span class="op" id="8528715">*</span><span class="ident" id="8528716">testing</span><span class="op" id="8528723">.</span><span class="ident" id="8528724">T</span><span class="op" id="8528725">)</span>&nbsp;<span class="op" id="8528727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528730">b</span>&nbsp;<span class="op" id="8528732">:=</span>&nbsp;<span class="op" id="8528735">&amp;</span><span class="ident" id="8528736">bytes</span><span class="op" id="8528741">.</span><span class="ident" id="8528742">Buffer</span><span class="op" id="8528748">{</span><span class="op" id="8528749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8528753">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;no&nbsp;palette,&nbsp;so&nbsp;any&nbsp;pixel&nbsp;at&nbsp;all</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8528812">//&nbsp;will&nbsp;be&nbsp;invalid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528833">b</span><span class="op" id="8528834">.</span><span class="ident" id="8528835">WriteString</span><span class="op" id="8528846">(</span><span class="ident" id="8528847">headerStr</span><span class="op" id="8528856">[</span><span class="op" id="8528857">:</span><span class="builtinfunc" id="8528858">len</span><span class="op" id="8528861">(</span><span class="ident" id="8528862">headerStr</span><span class="op" id="8528871">)</span><span class="op" id="8528872">-</span><span class="num" id="8528873">3</span><span class="op" id="8528874">]</span><span class="op" id="8528875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528878">b</span><span class="op" id="8528879">.</span><span class="ident" id="8528880">WriteString</span><span class="op" id="8528891">(</span><span class="string" id="8528892">&#34;\x00\x00\x00&#34;</span><span class="op" id="8528906">)</span>&nbsp;<span class="comment" id="8528908">//&nbsp;No&nbsp;global&nbsp;palette.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8528932">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528977">b</span><span class="op" id="8528978">.</span><span class="ident" id="8528979">WriteString</span><span class="op" id="8528990">(</span><span class="string" id="8528991">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="8529037">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8529041">//&nbsp;Encode&nbsp;the&nbsp;pixels:&nbsp;neither&nbsp;is&nbsp;in&nbsp;range,&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529114">pix</span>&nbsp;<span class="op" id="8529118">:=</span>&nbsp;<span class="op" id="8529121">[</span><span class="op" id="8529122">]</span><span class="builtintype" id="8529123">byte</span><span class="op" id="8529127">{</span><span class="num" id="8529128">0</span><span class="op" id="8529129">,</span>&nbsp;<span class="num" id="8529131">128</span><span class="op" id="8529134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529137">enc</span>&nbsp;<span class="op" id="8529141">:=</span>&nbsp;<span class="op" id="8529144">&amp;</span><span class="ident" id="8529145">bytes</span><span class="op" id="8529150">.</span><span class="ident" id="8529151">Buffer</span><span class="op" id="8529157">{</span><span class="op" id="8529158">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529161">w</span>&nbsp;<span class="op" id="8529163">:=</span>&nbsp;<span class="ident" id="8529166">lzw</span><span class="op" id="8529169">.</span><span class="ident" id="8529170">NewWriter</span><span class="op" id="8529179">(</span><span class="ident" id="8529180">enc</span><span class="op" id="8529183">,</span>&nbsp;<span class="ident" id="8529185">lzw</span><span class="op" id="8529188">.</span><span class="ident" id="8529189">LSB</span><span class="op" id="8529192">,</span>&nbsp;<span class="num" id="8529194">2</span><span class="op" id="8529195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529198">w</span><span class="op" id="8529199">.</span><span class="ident" id="8529200">Write</span><span class="op" id="8529205">(</span><span class="ident" id="8529206">pix</span><span class="op" id="8529209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529212">w</span><span class="op" id="8529213">.</span><span class="ident" id="8529214">Close</span><span class="op" id="8529219">(</span><span class="op" id="8529220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529223">b</span><span class="op" id="8529224">.</span><span class="ident" id="8529225">WriteByte</span><span class="op" id="8529234">(</span><span class="builtintype" id="8529235">byte</span><span class="op" id="8529239">(</span><span class="builtinfunc" id="8529240">len</span><span class="op" id="8529243">(</span><span class="ident" id="8529244">enc</span><span class="op" id="8529247">.</span><span class="ident" id="8529248">Bytes</span><span class="op" id="8529253">(</span><span class="op" id="8529254">)</span><span class="op" id="8529255">)</span><span class="op" id="8529256">)</span><span class="op" id="8529257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529260">b</span><span class="op" id="8529261">.</span><span class="ident" id="8529262">Write</span><span class="op" id="8529267">(</span><span class="ident" id="8529268">enc</span><span class="op" id="8529271">.</span><span class="ident" id="8529272">Bytes</span><span class="op" id="8529277">(</span><span class="op" id="8529278">)</span><span class="op" id="8529279">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529282">b</span><span class="op" id="8529283">.</span><span class="ident" id="8529284">WriteByte</span><span class="op" id="8529293">(</span><span class="num" id="8529294">0x00</span><span class="op" id="8529298">)</span>&nbsp;<span class="comment" id="8529300">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529357">b</span><span class="op" id="8529358">.</span><span class="ident" id="8529359">WriteString</span><span class="op" id="8529370">(</span><span class="ident" id="8529371">trailerStr</span><span class="op" id="8529381">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529385">try</span><span class="op" id="8529388">(</span><span class="ident" id="8529389">t</span><span class="op" id="8529390">,</span>&nbsp;<span class="ident" id="8529392">b</span><span class="op" id="8529393">.</span><span class="ident" id="8529394">Bytes</span><span class="op" id="8529399">(</span><span class="op" id="8529400">)</span><span class="op" id="8529401">,</span>&nbsp;<span class="string" id="8529403">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="8529429">)</span><br>
<span class="lineno">215</span><span class="op" id="8529431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8529434">func</span>&nbsp;<span class="ident" id="8529439">TestPixelOutsidePaletteRange</span><span class="op" id="8529467">(</span><span class="ident" id="8529468">t</span>&nbsp;<span class="op" id="8529470">*</span><span class="ident" id="8529471">testing</span><span class="op" id="8529478">.</span><span class="ident" id="8529479">T</span><span class="op" id="8529480">)</span>&nbsp;<span class="op" id="8529482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8529485">for</span>&nbsp;<span class="ident" id="8529489">_</span><span class="op" id="8529490">,</span>&nbsp;<span class="ident" id="8529492">pval</span>&nbsp;<span class="op" id="8529497">:=</span>&nbsp;<span class="keyword" id="8529500">range</span>&nbsp;<span class="op" id="8529506">[</span><span class="op" id="8529507">]</span><span class="builtintype" id="8529508">byte</span><span class="op" id="8529512">{</span><span class="num" id="8529513">0</span><span class="op" id="8529514">,</span>&nbsp;<span class="num" id="8529516">1</span><span class="op" id="8529517">,</span>&nbsp;<span class="num" id="8529519">2</span><span class="op" id="8529520">,</span>&nbsp;<span class="num" id="8529522">3</span><span class="op" id="8529523">,</span>&nbsp;<span class="num" id="8529525">255</span><span class="op" id="8529528">}</span>&nbsp;<span class="op" id="8529530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529534">b</span>&nbsp;<span class="op" id="8529536">:=</span>&nbsp;<span class="op" id="8529539">&amp;</span><span class="ident" id="8529540">bytes</span><span class="op" id="8529545">.</span><span class="ident" id="8529546">Buffer</span><span class="op" id="8529552">{</span><span class="op" id="8529553">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8529558">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;a&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529605">b</span><span class="op" id="8529606">.</span><span class="ident" id="8529607">WriteString</span><span class="op" id="8529618">(</span><span class="ident" id="8529619">headerStr</span><span class="op" id="8529628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529632">b</span><span class="op" id="8529633">.</span><span class="ident" id="8529634">WriteString</span><span class="op" id="8529645">(</span><span class="ident" id="8529646">paletteStr</span><span class="op" id="8529656">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8529661">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529707">b</span><span class="op" id="8529708">.</span><span class="ident" id="8529709">WriteString</span><span class="op" id="8529720">(</span><span class="string" id="8529721">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="8529767">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8529772">//&nbsp;Encode&nbsp;the&nbsp;pixels;&nbsp;some&nbsp;pvals&nbsp;trigger&nbsp;the&nbsp;expected&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529835">pix</span>&nbsp;<span class="op" id="8529839">:=</span>&nbsp;<span class="op" id="8529842">[</span><span class="op" id="8529843">]</span><span class="builtintype" id="8529844">byte</span><span class="op" id="8529848">{</span><span class="ident" id="8529849">pval</span><span class="op" id="8529853">,</span>&nbsp;<span class="ident" id="8529855">pval</span><span class="op" id="8529859">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529863">enc</span>&nbsp;<span class="op" id="8529867">:=</span>&nbsp;<span class="op" id="8529870">&amp;</span><span class="ident" id="8529871">bytes</span><span class="op" id="8529876">.</span><span class="ident" id="8529877">Buffer</span><span class="op" id="8529883">{</span><span class="op" id="8529884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529888">w</span>&nbsp;<span class="op" id="8529890">:=</span>&nbsp;<span class="ident" id="8529893">lzw</span><span class="op" id="8529896">.</span><span class="ident" id="8529897">NewWriter</span><span class="op" id="8529906">(</span><span class="ident" id="8529907">enc</span><span class="op" id="8529910">,</span>&nbsp;<span class="ident" id="8529912">lzw</span><span class="op" id="8529915">.</span><span class="ident" id="8529916">LSB</span><span class="op" id="8529919">,</span>&nbsp;<span class="num" id="8529921">2</span><span class="op" id="8529922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529926">w</span><span class="op" id="8529927">.</span><span class="ident" id="8529928">Write</span><span class="op" id="8529933">(</span><span class="ident" id="8529934">pix</span><span class="op" id="8529937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529941">w</span><span class="op" id="8529942">.</span><span class="ident" id="8529943">Close</span><span class="op" id="8529948">(</span><span class="op" id="8529949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529953">b</span><span class="op" id="8529954">.</span><span class="ident" id="8529955">WriteByte</span><span class="op" id="8529964">(</span><span class="builtintype" id="8529965">byte</span><span class="op" id="8529969">(</span><span class="builtinfunc" id="8529970">len</span><span class="op" id="8529973">(</span><span class="ident" id="8529974">enc</span><span class="op" id="8529977">.</span><span class="ident" id="8529978">Bytes</span><span class="op" id="8529983">(</span><span class="op" id="8529984">)</span><span class="op" id="8529985">)</span><span class="op" id="8529986">)</span><span class="op" id="8529987">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529991">b</span><span class="op" id="8529992">.</span><span class="ident" id="8529993">Write</span><span class="op" id="8529998">(</span><span class="ident" id="8529999">enc</span><span class="op" id="8530002">.</span><span class="ident" id="8530003">Bytes</span><span class="op" id="8530008">(</span><span class="op" id="8530009">)</span><span class="op" id="8530010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530014">b</span><span class="op" id="8530015">.</span><span class="ident" id="8530016">WriteByte</span><span class="op" id="8530025">(</span><span class="num" id="8530026">0x00</span><span class="op" id="8530030">)</span>&nbsp;<span class="comment" id="8530032">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530090">b</span><span class="op" id="8530091">.</span><span class="ident" id="8530092">WriteString</span><span class="op" id="8530103">(</span><span class="ident" id="8530104">trailerStr</span><span class="op" id="8530114">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8530119">//&nbsp;No&nbsp;error&nbsp;expected,&nbsp;unless&nbsp;the&nbsp;pixels&nbsp;are&nbsp;beyond&nbsp;the&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530193">want</span>&nbsp;<span class="op" id="8530198">:=</span>&nbsp;<span class="string" id="8530201">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530206">if</span>&nbsp;<span class="ident" id="8530209">pval</span>&nbsp;<span class="op" id="8530214">&gt;=</span>&nbsp;<span class="num" id="8530217">2</span>&nbsp;<span class="op" id="8530219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530224">want</span>&nbsp;<span class="op" id="8530229">=</span>&nbsp;<span class="string" id="8530231">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8530260">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530264">try</span><span class="op" id="8530267">(</span><span class="ident" id="8530268">t</span><span class="op" id="8530269">,</span>&nbsp;<span class="ident" id="8530271">b</span><span class="op" id="8530272">.</span><span class="ident" id="8530273">Bytes</span><span class="op" id="8530278">(</span><span class="op" id="8530279">)</span><span class="op" id="8530280">,</span>&nbsp;<span class="ident" id="8530282">want</span><span class="op" id="8530286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8530289">}</span><br>
<span class="lineno"></span><span class="op" id="8530291">}</span>
</div>
</body>
</html>
