<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5362059">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5362115">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5362169">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5362220">package</span>&nbsp;<span class="ident" id="5362228">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5362236">//&nbsp;Simplify&nbsp;returns&nbsp;a&nbsp;regexp&nbsp;equivalent&nbsp;to&nbsp;re&nbsp;but&nbsp;without&nbsp;counted&nbsp;repetitions</span><br>
<span class="lineno"></span><span class="comment" id="5362314">//&nbsp;and&nbsp;with&nbsp;various&nbsp;other&nbsp;simplifications,&nbsp;such&nbsp;as&nbsp;rewriting&nbsp;/(?:a+)+/&nbsp;to&nbsp;/a+/.</span><br>
<span class="lineno"></span><span class="comment" id="5362394">//&nbsp;The&nbsp;resulting&nbsp;regexp&nbsp;will&nbsp;execute&nbsp;correctly&nbsp;but&nbsp;its&nbsp;string&nbsp;representation</span><br>
<span class="lineno">10</span><span class="comment" id="5362471">//&nbsp;will&nbsp;not&nbsp;produce&nbsp;the&nbsp;same&nbsp;parse&nbsp;tree,&nbsp;because&nbsp;capturing&nbsp;parentheses</span><br>
<span class="lineno"></span><span class="comment" id="5362542">//&nbsp;may&nbsp;have&nbsp;been&nbsp;duplicated&nbsp;or&nbsp;removed.&nbsp;&nbsp;For&nbsp;example,&nbsp;the&nbsp;simplified&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5362616">//&nbsp;for&nbsp;/(x){1,2}/&nbsp;is&nbsp;/(x)(x)?/&nbsp;but&nbsp;both&nbsp;parentheses&nbsp;capture&nbsp;as&nbsp;$1.</span><br>
<span class="lineno"></span><span class="comment" id="5362683">//&nbsp;The&nbsp;returned&nbsp;regexp&nbsp;may&nbsp;share&nbsp;structure&nbsp;with&nbsp;or&nbsp;be&nbsp;the&nbsp;original.</span><br>
<span class="lineno"></span><span class="keyword" id="5362751">func</span>&nbsp;<span class="op" id="5362756">(</span><span class="ident" id="5362757">re</span>&nbsp;<span class="op" id="5362760">*</span><span class="ident" id="5362761">Regexp</span><span class="op" id="5362767">)</span>&nbsp;<span class="ident" id="5362769">Simplify</span><span class="op" id="5362777">(</span><span class="op" id="5362778">)</span>&nbsp;<span class="op" id="5362780">*</span><span class="ident" id="5362781">Regexp</span>&nbsp;<span class="op" id="5362788">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362791">if</span>&nbsp;<span class="ident" id="5362794">re</span>&nbsp;<span class="op" id="5362797">==</span>&nbsp;<span class="ident" id="5362800">nil</span>&nbsp;<span class="op" id="5362804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362808">return</span>&nbsp;<span class="ident" id="5362815">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5362820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362823">switch</span>&nbsp;<span class="ident" id="5362830">re</span><span class="op" id="5362832">.</span><span class="ident" id="5362833">Op</span>&nbsp;<span class="op" id="5362836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362839">case</span>&nbsp;<span class="ident" id="5362844">OpCapture</span><span class="op" id="5362853">,</span>&nbsp;<span class="ident" id="5362855">OpConcat</span><span class="op" id="5362863">,</span>&nbsp;<span class="ident" id="5362865">OpAlternate</span><span class="op" id="5362876">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5362880">//&nbsp;Simplify&nbsp;children,&nbsp;building&nbsp;new&nbsp;Regexp&nbsp;if&nbsp;children&nbsp;change.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362944">nre</span>&nbsp;<span class="op" id="5362948">:=</span>&nbsp;<span class="ident" id="5362951">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362956">for</span>&nbsp;<span class="ident" id="5362960">i</span><span class="op" id="5362961">,</span>&nbsp;<span class="ident" id="5362963">sub</span>&nbsp;<span class="op" id="5362967">:=</span>&nbsp;<span class="keyword" id="5362970">range</span>&nbsp;<span class="ident" id="5362976">re</span><span class="op" id="5362978">.</span><span class="ident" id="5362979">Sub</span>&nbsp;<span class="op" id="5362983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362988">nsub</span>&nbsp;<span class="op" id="5362993">:=</span>&nbsp;<span class="ident" id="5362996">sub</span><span class="op" id="5362999">.</span><span class="ident" id="5363000">Simplify</span><span class="op" id="5363008">(</span><span class="op" id="5363009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363014">if</span>&nbsp;<span class="ident" id="5363017">nre</span>&nbsp;<span class="op" id="5363021">==</span>&nbsp;<span class="ident" id="5363024">re</span>&nbsp;<span class="op" id="5363027">&amp;&amp;</span>&nbsp;<span class="ident" id="5363030">nsub</span>&nbsp;<span class="op" id="5363035">!=</span>&nbsp;<span class="ident" id="5363038">sub</span>&nbsp;<span class="op" id="5363042">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5363048">//&nbsp;Start&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363069">nre</span>&nbsp;<span class="op" id="5363073">=</span>&nbsp;<span class="builtinfunc" id="5363075">new</span><span class="op" id="5363078">(</span><span class="ident" id="5363079">Regexp</span><span class="op" id="5363085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5363091">*</span><span class="ident" id="5363092">nre</span>&nbsp;<span class="op" id="5363096">=</span>&nbsp;<span class="op" id="5363098">*</span><span class="ident" id="5363099">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363106">nre</span><span class="op" id="5363109">.</span><span class="ident" id="5363110">Rune</span>&nbsp;<span class="op" id="5363115">=</span>&nbsp;<span class="ident" id="5363117">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363125">nre</span><span class="op" id="5363128">.</span><span class="ident" id="5363129">Sub</span>&nbsp;<span class="op" id="5363133">=</span>&nbsp;<span class="builtinfunc" id="5363135">append</span><span class="op" id="5363141">(</span><span class="ident" id="5363142">nre</span><span class="op" id="5363145">.</span><span class="ident" id="5363146">Sub0</span><span class="op" id="5363150">[</span><span class="op" id="5363151">:</span><span class="num" id="5363152">0</span><span class="op" id="5363153">]</span><span class="op" id="5363154">,</span>&nbsp;<span class="ident" id="5363156">re</span><span class="op" id="5363158">.</span><span class="ident" id="5363159">Sub</span><span class="op" id="5363162">[</span><span class="op" id="5363163">:</span><span class="ident" id="5363164">i</span><span class="op" id="5363165">]</span><span class="op" id="5363166">...</span><span class="op" id="5363169">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5363174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363179">if</span>&nbsp;<span class="ident" id="5363182">nre</span>&nbsp;<span class="op" id="5363186">!=</span>&nbsp;<span class="ident" id="5363189">re</span>&nbsp;<span class="op" id="5363192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363198">nre</span><span class="op" id="5363201">.</span><span class="ident" id="5363202">Sub</span>&nbsp;<span class="op" id="5363206">=</span>&nbsp;<span class="builtinfunc" id="5363208">append</span><span class="op" id="5363214">(</span><span class="ident" id="5363215">nre</span><span class="op" id="5363218">.</span><span class="ident" id="5363219">Sub</span><span class="op" id="5363222">,</span>&nbsp;<span class="ident" id="5363224">nsub</span><span class="op" id="5363228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5363233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5363237">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363241">return</span>&nbsp;<span class="ident" id="5363248">nre</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363254">case</span>&nbsp;<span class="ident" id="5363259">OpStar</span><span class="op" id="5363265">,</span>&nbsp;<span class="ident" id="5363267">OpPlus</span><span class="op" id="5363273">,</span>&nbsp;<span class="ident" id="5363275">OpQuest</span><span class="op" id="5363282">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363286">sub</span>&nbsp;<span class="op" id="5363290">:=</span>&nbsp;<span class="ident" id="5363293">re</span><span class="op" id="5363295">.</span><span class="ident" id="5363296">Sub</span><span class="op" id="5363299">[</span><span class="num" id="5363300">0</span><span class="op" id="5363301">]</span><span class="op" id="5363302">.</span><span class="ident" id="5363303">Simplify</span><span class="op" id="5363311">(</span><span class="op" id="5363312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363316">return</span>&nbsp;<span class="ident" id="5363323">simplify1</span><span class="op" id="5363332">(</span><span class="ident" id="5363333">re</span><span class="op" id="5363335">.</span><span class="ident" id="5363336">Op</span><span class="op" id="5363338">,</span>&nbsp;<span class="ident" id="5363340">re</span><span class="op" id="5363342">.</span><span class="ident" id="5363343">Flags</span><span class="op" id="5363348">,</span>&nbsp;<span class="ident" id="5363350">sub</span><span class="op" id="5363353">,</span>&nbsp;<span class="ident" id="5363355">re</span><span class="op" id="5363357">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363361">case</span>&nbsp;<span class="ident" id="5363366">OpRepeat</span><span class="op" id="5363374">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5363378">//&nbsp;Special&nbsp;special&nbsp;case:&nbsp;x{0}&nbsp;matches&nbsp;the&nbsp;empty&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5363435">//&nbsp;and&nbsp;doesn&#39;t&nbsp;even&nbsp;need&nbsp;to&nbsp;consider&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363477">if</span>&nbsp;<span class="ident" id="5363480">re</span><span class="op" id="5363482">.</span><span class="ident" id="5363483">Min</span>&nbsp;<span class="op" id="5363487">==</span>&nbsp;<span class="num" id="5363490">0</span>&nbsp;<span class="op" id="5363492">&amp;&amp;</span>&nbsp;<span class="ident" id="5363495">re</span><span class="op" id="5363497">.</span><span class="ident" id="5363498">Max</span>&nbsp;<span class="op" id="5363502">==</span>&nbsp;<span class="num" id="5363505">0</span>&nbsp;<span class="op" id="5363507">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363512">return</span>&nbsp;<span class="op" id="5363519">&amp;</span><span class="ident" id="5363520">Regexp</span><span class="op" id="5363526">{</span><span class="ident" id="5363527">Op</span><span class="op" id="5363529">:</span>&nbsp;<span class="ident" id="5363531">OpEmptyMatch</span><span class="op" id="5363543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5363547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5363552">//&nbsp;The&nbsp;fun&nbsp;begins.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363573">sub</span>&nbsp;<span class="op" id="5363577">:=</span>&nbsp;<span class="ident" id="5363580">re</span><span class="op" id="5363582">.</span><span class="ident" id="5363583">Sub</span><span class="op" id="5363586">[</span><span class="num" id="5363587">0</span><span class="op" id="5363588">]</span><span class="op" id="5363589">.</span><span class="ident" id="5363590">Simplify</span><span class="op" id="5363598">(</span><span class="op" id="5363599">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5363604">//&nbsp;x{n,}&nbsp;means&nbsp;at&nbsp;least&nbsp;n&nbsp;matches&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363646">if</span>&nbsp;<span class="ident" id="5363649">re</span><span class="op" id="5363651">.</span><span class="ident" id="5363652">Max</span>&nbsp;<span class="op" id="5363656">==</span>&nbsp;<span class="op" id="5363659">-</span><span class="num" id="5363660">1</span>&nbsp;<span class="op" id="5363662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5363667">//&nbsp;Special&nbsp;case:&nbsp;x{0,}&nbsp;is&nbsp;x*.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363700">if</span>&nbsp;<span class="ident" id="5363703">re</span><span class="op" id="5363705">.</span><span class="ident" id="5363706">Min</span>&nbsp;<span class="op" id="5363710">==</span>&nbsp;<span class="num" id="5363713">0</span>&nbsp;<span class="op" id="5363715">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363721">return</span>&nbsp;<span class="ident" id="5363728">simplify1</span><span class="op" id="5363737">(</span><span class="ident" id="5363738">OpStar</span><span class="op" id="5363744">,</span>&nbsp;<span class="ident" id="5363746">re</span><span class="op" id="5363748">.</span><span class="ident" id="5363749">Flags</span><span class="op" id="5363754">,</span>&nbsp;<span class="ident" id="5363756">sub</span><span class="op" id="5363759">,</span>&nbsp;<span class="ident" id="5363761">nil</span><span class="op" id="5363764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5363769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5363775">//&nbsp;Special&nbsp;case:&nbsp;x{1,}&nbsp;is&nbsp;x+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363808">if</span>&nbsp;<span class="ident" id="5363811">re</span><span class="op" id="5363813">.</span><span class="ident" id="5363814">Min</span>&nbsp;<span class="op" id="5363818">==</span>&nbsp;<span class="num" id="5363821">1</span>&nbsp;<span class="op" id="5363823">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363829">return</span>&nbsp;<span class="ident" id="5363836">simplify1</span><span class="op" id="5363845">(</span><span class="ident" id="5363846">OpPlus</span><span class="op" id="5363852">,</span>&nbsp;<span class="ident" id="5363854">re</span><span class="op" id="5363856">.</span><span class="ident" id="5363857">Flags</span><span class="op" id="5363862">,</span>&nbsp;<span class="ident" id="5363864">sub</span><span class="op" id="5363867">,</span>&nbsp;<span class="ident" id="5363869">nil</span><span class="op" id="5363872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5363877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5363883">//&nbsp;General&nbsp;case:&nbsp;x{4,}&nbsp;is&nbsp;xxxx+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363919">nre</span>&nbsp;<span class="op" id="5363923">:=</span>&nbsp;<span class="op" id="5363926">&amp;</span><span class="ident" id="5363927">Regexp</span><span class="op" id="5363933">{</span><span class="ident" id="5363934">Op</span><span class="op" id="5363936">:</span>&nbsp;<span class="ident" id="5363938">OpConcat</span><span class="op" id="5363946">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363951">nre</span><span class="op" id="5363954">.</span><span class="ident" id="5363955">Sub</span>&nbsp;<span class="op" id="5363959">=</span>&nbsp;<span class="ident" id="5363961">nre</span><span class="op" id="5363964">.</span><span class="ident" id="5363965">Sub0</span><span class="op" id="5363969">[</span><span class="op" id="5363970">:</span><span class="num" id="5363971">0</span><span class="op" id="5363972">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363977">for</span>&nbsp;<span class="ident" id="5363981">i</span>&nbsp;<span class="op" id="5363983">:=</span>&nbsp;<span class="num" id="5363986">0</span><span class="op" id="5363987">;</span>&nbsp;<span class="ident" id="5363989">i</span>&nbsp;<span class="op" id="5363991">&lt;</span>&nbsp;<span class="ident" id="5363993">re</span><span class="op" id="5363995">.</span><span class="ident" id="5363996">Min</span><span class="op" id="5363999">-</span><span class="num" id="5364000">1</span><span class="op" id="5364001">;</span>&nbsp;<span class="ident" id="5364003">i</span><span class="op" id="5364004">++</span>&nbsp;<span class="op" id="5364007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364013">nre</span><span class="op" id="5364016">.</span><span class="ident" id="5364017">Sub</span>&nbsp;<span class="op" id="5364021">=</span>&nbsp;<span class="builtinfunc" id="5364023">append</span><span class="op" id="5364029">(</span><span class="ident" id="5364030">nre</span><span class="op" id="5364033">.</span><span class="ident" id="5364034">Sub</span><span class="op" id="5364037">,</span>&nbsp;<span class="ident" id="5364039">sub</span><span class="op" id="5364042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5364047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364052">nre</span><span class="op" id="5364055">.</span><span class="ident" id="5364056">Sub</span>&nbsp;<span class="op" id="5364060">=</span>&nbsp;<span class="builtinfunc" id="5364062">append</span><span class="op" id="5364068">(</span><span class="ident" id="5364069">nre</span><span class="op" id="5364072">.</span><span class="ident" id="5364073">Sub</span><span class="op" id="5364076">,</span>&nbsp;<span class="ident" id="5364078">simplify1</span><span class="op" id="5364087">(</span><span class="ident" id="5364088">OpPlus</span><span class="op" id="5364094">,</span>&nbsp;<span class="ident" id="5364096">re</span><span class="op" id="5364098">.</span><span class="ident" id="5364099">Flags</span><span class="op" id="5364104">,</span>&nbsp;<span class="ident" id="5364106">sub</span><span class="op" id="5364109">,</span>&nbsp;<span class="ident" id="5364111">nil</span><span class="op" id="5364114">)</span><span class="op" id="5364115">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364120">return</span>&nbsp;<span class="ident" id="5364127">nre</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5364133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5364138">//&nbsp;Special&nbsp;case&nbsp;x{0}&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5364177">//&nbsp;Special&nbsp;case:&nbsp;x{1}&nbsp;is&nbsp;just&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364212">if</span>&nbsp;<span class="ident" id="5364215">re</span><span class="op" id="5364217">.</span><span class="ident" id="5364218">Min</span>&nbsp;<span class="op" id="5364222">==</span>&nbsp;<span class="num" id="5364225">1</span>&nbsp;<span class="op" id="5364227">&amp;&amp;</span>&nbsp;<span class="ident" id="5364230">re</span><span class="op" id="5364232">.</span><span class="ident" id="5364233">Max</span>&nbsp;<span class="op" id="5364237">==</span>&nbsp;<span class="num" id="5364240">1</span>&nbsp;<span class="op" id="5364242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364247">return</span>&nbsp;<span class="ident" id="5364254">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5364260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5364265">//&nbsp;General&nbsp;case:&nbsp;x{n,m}&nbsp;means&nbsp;n&nbsp;copies&nbsp;of&nbsp;x&nbsp;and&nbsp;m&nbsp;copies&nbsp;of&nbsp;x?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5364330">//&nbsp;The&nbsp;machine&nbsp;will&nbsp;do&nbsp;less&nbsp;work&nbsp;if&nbsp;we&nbsp;nest&nbsp;the&nbsp;final&nbsp;m&nbsp;copies,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5364396">//&nbsp;so&nbsp;that&nbsp;x{2,5}&nbsp;=&nbsp;xx(x(x(x)?)?)?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5364434">//&nbsp;Build&nbsp;leading&nbsp;prefix:&nbsp;xx.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364465">var</span>&nbsp;<span class="ident" id="5364469">prefix</span>&nbsp;<span class="op" id="5364476">*</span><span class="ident" id="5364477">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364486">if</span>&nbsp;<span class="ident" id="5364489">re</span><span class="op" id="5364491">.</span><span class="ident" id="5364492">Min</span>&nbsp;<span class="op" id="5364496">&gt;</span>&nbsp;<span class="num" id="5364498">0</span>&nbsp;<span class="op" id="5364500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364505">prefix</span>&nbsp;<span class="op" id="5364512">=</span>&nbsp;<span class="op" id="5364514">&amp;</span><span class="ident" id="5364515">Regexp</span><span class="op" id="5364521">{</span><span class="ident" id="5364522">Op</span><span class="op" id="5364524">:</span>&nbsp;<span class="ident" id="5364526">OpConcat</span><span class="op" id="5364534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364539">prefix</span><span class="op" id="5364545">.</span><span class="ident" id="5364546">Sub</span>&nbsp;<span class="op" id="5364550">=</span>&nbsp;<span class="ident" id="5364552">prefix</span><span class="op" id="5364558">.</span><span class="ident" id="5364559">Sub0</span><span class="op" id="5364563">[</span><span class="op" id="5364564">:</span><span class="num" id="5364565">0</span><span class="op" id="5364566">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364571">for</span>&nbsp;<span class="ident" id="5364575">i</span>&nbsp;<span class="op" id="5364577">:=</span>&nbsp;<span class="num" id="5364580">0</span><span class="op" id="5364581">;</span>&nbsp;<span class="ident" id="5364583">i</span>&nbsp;<span class="op" id="5364585">&lt;</span>&nbsp;<span class="ident" id="5364587">re</span><span class="op" id="5364589">.</span><span class="ident" id="5364590">Min</span><span class="op" id="5364593">;</span>&nbsp;<span class="ident" id="5364595">i</span><span class="op" id="5364596">++</span>&nbsp;<span class="op" id="5364599">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364605">prefix</span><span class="op" id="5364611">.</span><span class="ident" id="5364612">Sub</span>&nbsp;<span class="op" id="5364616">=</span>&nbsp;<span class="builtinfunc" id="5364618">append</span><span class="op" id="5364624">(</span><span class="ident" id="5364625">prefix</span><span class="op" id="5364631">.</span><span class="ident" id="5364632">Sub</span><span class="op" id="5364635">,</span>&nbsp;<span class="ident" id="5364637">sub</span><span class="op" id="5364640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5364645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5364649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5364654">//&nbsp;Build&nbsp;and&nbsp;attach&nbsp;suffix:&nbsp;(x(x(x)?)?)?</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364697">if</span>&nbsp;<span class="ident" id="5364700">re</span><span class="op" id="5364702">.</span><span class="ident" id="5364703">Max</span>&nbsp;<span class="op" id="5364707">&gt;</span>&nbsp;<span class="ident" id="5364709">re</span><span class="op" id="5364711">.</span><span class="ident" id="5364712">Min</span>&nbsp;<span class="op" id="5364716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364721">suffix</span>&nbsp;<span class="op" id="5364728">:=</span>&nbsp;<span class="ident" id="5364731">simplify1</span><span class="op" id="5364740">(</span><span class="ident" id="5364741">OpQuest</span><span class="op" id="5364748">,</span>&nbsp;<span class="ident" id="5364750">re</span><span class="op" id="5364752">.</span><span class="ident" id="5364753">Flags</span><span class="op" id="5364758">,</span>&nbsp;<span class="ident" id="5364760">sub</span><span class="op" id="5364763">,</span>&nbsp;<span class="ident" id="5364765">nil</span><span class="op" id="5364768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364773">for</span>&nbsp;<span class="ident" id="5364777">i</span>&nbsp;<span class="op" id="5364779">:=</span>&nbsp;<span class="ident" id="5364782">re</span><span class="op" id="5364784">.</span><span class="ident" id="5364785">Min</span>&nbsp;<span class="op" id="5364789">+</span>&nbsp;<span class="num" id="5364791">1</span><span class="op" id="5364792">;</span>&nbsp;<span class="ident" id="5364794">i</span>&nbsp;<span class="op" id="5364796">&lt;</span>&nbsp;<span class="ident" id="5364798">re</span><span class="op" id="5364800">.</span><span class="ident" id="5364801">Max</span><span class="op" id="5364804">;</span>&nbsp;<span class="ident" id="5364806">i</span><span class="op" id="5364807">++</span>&nbsp;<span class="op" id="5364810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364816">nre2</span>&nbsp;<span class="op" id="5364821">:=</span>&nbsp;<span class="op" id="5364824">&amp;</span><span class="ident" id="5364825">Regexp</span><span class="op" id="5364831">{</span><span class="ident" id="5364832">Op</span><span class="op" id="5364834">:</span>&nbsp;<span class="ident" id="5364836">OpConcat</span><span class="op" id="5364844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364850">nre2</span><span class="op" id="5364854">.</span><span class="ident" id="5364855">Sub</span>&nbsp;<span class="op" id="5364859">=</span>&nbsp;<span class="builtinfunc" id="5364861">append</span><span class="op" id="5364867">(</span><span class="ident" id="5364868">nre2</span><span class="op" id="5364872">.</span><span class="ident" id="5364873">Sub0</span><span class="op" id="5364877">[</span><span class="op" id="5364878">:</span><span class="num" id="5364879">0</span><span class="op" id="5364880">]</span><span class="op" id="5364881">,</span>&nbsp;<span class="ident" id="5364883">sub</span><span class="op" id="5364886">,</span>&nbsp;<span class="ident" id="5364888">suffix</span><span class="op" id="5364894">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364900">suffix</span>&nbsp;<span class="op" id="5364907">=</span>&nbsp;<span class="ident" id="5364909">simplify1</span><span class="op" id="5364918">(</span><span class="ident" id="5364919">OpQuest</span><span class="op" id="5364926">,</span>&nbsp;<span class="ident" id="5364928">re</span><span class="op" id="5364930">.</span><span class="ident" id="5364931">Flags</span><span class="op" id="5364936">,</span>&nbsp;<span class="ident" id="5364938">nre2</span><span class="op" id="5364942">,</span>&nbsp;<span class="ident" id="5364944">nil</span><span class="op" id="5364947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5364952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364957">if</span>&nbsp;<span class="ident" id="5364960">prefix</span>&nbsp;<span class="op" id="5364967">==</span>&nbsp;<span class="ident" id="5364970">nil</span>&nbsp;<span class="op" id="5364974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364980">return</span>&nbsp;<span class="ident" id="5364987">suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5364997">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5365002">prefix</span><span class="op" id="5365008">.</span><span class="ident" id="5365009">Sub</span>&nbsp;<span class="op" id="5365013">=</span>&nbsp;<span class="builtinfunc" id="5365015">append</span><span class="op" id="5365021">(</span><span class="ident" id="5365022">prefix</span><span class="op" id="5365028">.</span><span class="ident" id="5365029">Sub</span><span class="op" id="5365032">,</span>&nbsp;<span class="ident" id="5365034">suffix</span><span class="op" id="5365040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5365044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5365048">if</span>&nbsp;<span class="ident" id="5365051">prefix</span>&nbsp;<span class="op" id="5365058">!=</span>&nbsp;<span class="ident" id="5365061">nil</span>&nbsp;<span class="op" id="5365065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5365070">return</span>&nbsp;<span class="ident" id="5365077">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5365086">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5365091">//&nbsp;Some&nbsp;degenerate&nbsp;case&nbsp;like&nbsp;min&nbsp;&gt;&nbsp;max&nbsp;or&nbsp;min&nbsp;&lt;&nbsp;max&nbsp;&lt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5365150">//&nbsp;Handle&nbsp;as&nbsp;impossible&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5365183">return</span>&nbsp;<span class="op" id="5365190">&amp;</span><span class="ident" id="5365191">Regexp</span><span class="op" id="5365197">{</span><span class="ident" id="5365198">Op</span><span class="op" id="5365200">:</span>&nbsp;<span class="ident" id="5365202">OpNoMatch</span><span class="op" id="5365211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5365214">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5365218">return</span>&nbsp;<span class="ident" id="5365225">re</span><br>
<span class="lineno"></span><span class="op" id="5365228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5365231">//&nbsp;simplify1&nbsp;implements&nbsp;Simplify&nbsp;for&nbsp;the&nbsp;unary&nbsp;OpStar,</span><br>
<span class="lineno">120</span><span class="comment" id="5365286">//&nbsp;OpPlus,&nbsp;and&nbsp;OpQuest&nbsp;operators.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;simple&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5365350">//&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5365367">//</span><br>
<span class="lineno"></span><span class="comment" id="5365370">//&nbsp;&nbsp;&nbsp;&nbspRegexp{Op:&nbsp;op,&nbsp;Flags:&nbsp;flags,&nbsp;Sub:&nbsp;{sub}}</span><br>
<span class="lineno"></span><span class="comment" id="5365414">//</span><br>
<span class="lineno">125</span><span class="comment" id="5365417">//&nbsp;under&nbsp;the&nbsp;assumption&nbsp;that&nbsp;sub&nbsp;is&nbsp;already&nbsp;simple,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5365473">//&nbsp;without&nbsp;first&nbsp;allocating&nbsp;that&nbsp;structure.&nbsp;&nbsp;If&nbsp;the&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5365532">//&nbsp;to&nbsp;be&nbsp;returned&nbsp;turns&nbsp;out&nbsp;to&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;re,&nbsp;simplify1</span><br>
<span class="lineno"></span><span class="comment" id="5365594">//&nbsp;returns&nbsp;re&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5365617">//</span><br>
<span class="lineno">130</span><span class="comment" id="5365620">//&nbsp;simplify1&nbsp;is&nbsp;factored&nbsp;out&nbsp;of&nbsp;Simplify&nbsp;because&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5365688">//&nbsp;for&nbsp;other&nbsp;operators&nbsp;generates&nbsp;these&nbsp;unary&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="comment" id="5365746">//&nbsp;Letting&nbsp;them&nbsp;call&nbsp;simplify1&nbsp;makes&nbsp;sure&nbsp;the&nbsp;expressions&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="5365809">//&nbsp;generate&nbsp;are&nbsp;simple.</span><br>
<span class="lineno"></span><span class="keyword" id="5365833">func</span>&nbsp;<span class="ident" id="5365838">simplify1</span><span class="op" id="5365847">(</span><span class="ident" id="5365848">op</span>&nbsp;<span class="ident" id="5365851">Op</span><span class="op" id="5365853">,</span>&nbsp;<span class="ident" id="5365855">flags</span>&nbsp;<span class="ident" id="5365861">Flags</span><span class="op" id="5365866">,</span>&nbsp;<span class="ident" id="5365868">sub</span><span class="op" id="5365871">,</span>&nbsp;<span class="ident" id="5365873">re</span>&nbsp;<span class="op" id="5365876">*</span><span class="ident" id="5365877">Regexp</span><span class="op" id="5365883">)</span>&nbsp;<span class="op" id="5365885">*</span><span class="ident" id="5365886">Regexp</span>&nbsp;<span class="op" id="5365893">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5365896">//&nbsp;Special&nbsp;case:&nbsp;repeat&nbsp;the&nbsp;empty&nbsp;string&nbsp;as&nbsp;much&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5365949">//&nbsp;you&nbsp;want,&nbsp;but&nbsp;it&#39;s&nbsp;still&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5365996">if</span>&nbsp;<span class="ident" id="5365999">sub</span><span class="op" id="5366002">.</span><span class="ident" id="5366003">Op</span>&nbsp;<span class="op" id="5366006">==</span>&nbsp;<span class="ident" id="5366009">OpEmptyMatch</span>&nbsp;<span class="op" id="5366022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5366026">return</span>&nbsp;<span class="ident" id="5366033">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5366038">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5366041">//&nbsp;The&nbsp;operators&nbsp;are&nbsp;idempotent&nbsp;if&nbsp;the&nbsp;flags&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5366094">if</span>&nbsp;<span class="ident" id="5366097">op</span>&nbsp;<span class="op" id="5366100">==</span>&nbsp;<span class="ident" id="5366103">sub</span><span class="op" id="5366106">.</span><span class="ident" id="5366107">Op</span>&nbsp;<span class="op" id="5366110">&amp;&amp;</span>&nbsp;<span class="ident" id="5366113">flags</span><span class="op" id="5366118">&amp;</span><span class="ident" id="5366119">NonGreedy</span>&nbsp;<span class="op" id="5366129">==</span>&nbsp;<span class="ident" id="5366132">sub</span><span class="op" id="5366135">.</span><span class="ident" id="5366136">Flags</span><span class="op" id="5366141">&amp;</span><span class="ident" id="5366142">NonGreedy</span>&nbsp;<span class="op" id="5366152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5366156">return</span>&nbsp;<span class="ident" id="5366163">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5366168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5366171">if</span>&nbsp;<span class="ident" id="5366174">re</span>&nbsp;<span class="op" id="5366177">!=</span>&nbsp;<span class="ident" id="5366180">nil</span>&nbsp;<span class="op" id="5366184">&amp;&amp;</span>&nbsp;<span class="ident" id="5366187">re</span><span class="op" id="5366189">.</span><span class="ident" id="5366190">Op</span>&nbsp;<span class="op" id="5366193">==</span>&nbsp;<span class="ident" id="5366196">op</span>&nbsp;<span class="op" id="5366199">&amp;&amp;</span>&nbsp;<span class="ident" id="5366202">re</span><span class="op" id="5366204">.</span><span class="ident" id="5366205">Flags</span><span class="op" id="5366210">&amp;</span><span class="ident" id="5366211">NonGreedy</span>&nbsp;<span class="op" id="5366221">==</span>&nbsp;<span class="ident" id="5366224">flags</span><span class="op" id="5366229">&amp;</span><span class="ident" id="5366230">NonGreedy</span>&nbsp;<span class="op" id="5366240">&amp;&amp;</span>&nbsp;<span class="ident" id="5366243">sub</span>&nbsp;<span class="op" id="5366247">==</span>&nbsp;<span class="ident" id="5366250">re</span><span class="op" id="5366252">.</span><span class="ident" id="5366253">Sub</span><span class="op" id="5366256">[</span><span class="num" id="5366257">0</span><span class="op" id="5366258">]</span>&nbsp;<span class="op" id="5366260">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5366264">return</span>&nbsp;<span class="ident" id="5366271">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5366275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5366279">re</span>&nbsp;<span class="op" id="5366282">=</span>&nbsp;<span class="op" id="5366284">&amp;</span><span class="ident" id="5366285">Regexp</span><span class="op" id="5366291">{</span><span class="ident" id="5366292">Op</span><span class="op" id="5366294">:</span>&nbsp;<span class="ident" id="5366296">op</span><span class="op" id="5366298">,</span>&nbsp;<span class="ident" id="5366300">Flags</span><span class="op" id="5366305">:</span>&nbsp;<span class="ident" id="5366307">flags</span><span class="op" id="5366312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5366315">re</span><span class="op" id="5366317">.</span><span class="ident" id="5366318">Sub</span>&nbsp;<span class="op" id="5366322">=</span>&nbsp;<span class="builtinfunc" id="5366324">append</span><span class="op" id="5366330">(</span><span class="ident" id="5366331">re</span><span class="op" id="5366333">.</span><span class="ident" id="5366334">Sub0</span><span class="op" id="5366338">[</span><span class="op" id="5366339">:</span><span class="num" id="5366340">0</span><span class="op" id="5366341">]</span><span class="op" id="5366342">,</span>&nbsp;<span class="ident" id="5366344">sub</span><span class="op" id="5366347">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5366350">return</span>&nbsp;<span class="ident" id="5366357">re</span><br>
<span class="lineno"></span><span class="op" id="5366360">}</span>
</div>
</body>
</html>
